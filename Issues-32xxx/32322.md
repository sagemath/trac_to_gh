# Issue 32322: Random failure in projective_ds.py

archive/issues_032085.json:
```json
{
    "assignees": [],
    "body": "\n```\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 4020, in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points\nFailed example:\n    f.preperiodic_points(2, 1, R=K)\nExpected:\n    [(v : 1), (-v : 1)]\nGot:\n    [(-v : 1), (v : 1)]\n**********************************************************************\n1 item had failures:\n   1 of  68 in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points\n    [1370 tests, 1 failure, 49.74 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nCC:  @bhutz @EnderWannabe\n\nKeywords: **random_fail 32bit, gsoc2021**\n\nBranch/Commit: **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**\n\nReviewer: **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**\n\nAuthor: **Thierry Monteil**\n\nComponent: **dynamics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32322_\n\n",
    "closed_at": "2021-08-08T15:37:05Z",
    "created_at": "2021-08-01T08:48:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20dynamics",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Random failure in projective_ds.py",
    "type": "issue",
    "updated_at": "2021-08-08T15:37:05Z",
    "url": "https://github.com/sagemath/sage/issues/32322",
    "user": "https://github.com/vbraun"
}
```

```
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 4020, in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points
Failed example:
    f.preperiodic_points(2, 1, R=K)
Expected:
    [(v : 1), (-v : 1)]
Got:
    [(-v : 1), (v : 1)]
**********************************************************************
1 item had failures:
   1 of  68 in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points
    [1370 tests, 1 failure, 49.74 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed
----------------------------------------------------------------------
```

CC:  @bhutz @EnderWannabe

Keywords: **random_fail 32bit, gsoc2021**

Branch/Commit: **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**

Reviewer: **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**

Author: **Thierry Monteil**

Component: **dynamics**

_Issue created by migration from https://trac.sagemath.org/ticket/32322_





---

archive/issue_events_442571.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:48:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442571"
}
```



---

archive/issue_events_442572.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:48:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20dynamics",
    "label_color": "0000ff",
    "label_name": "c: dynamics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442572"
}
```



---

archive/issue_events_442573.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:48:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442573"
}
```



---

archive/issue_events_442574.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:48:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442574"
}
```



---

archive/issue_comments_520487.json:
```json
{
    "body": "Changed keywords from **random_fail** to **random_fail 32bit**",
    "created_at": "2021-08-01T08:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520487",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from **random_fail** to **random_fail 32bit**



---

archive/issue_events_442575.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:51:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442575"
}
```



---

archive/issue_events_442576.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-01T08:51:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442576"
}
```



---

archive/issue_comments_520488.json:
```json
{
    "body": "Branch: **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)**",
    "created_at": "2021-08-01T23:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520488",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)**



---

archive/issue_comments_520489.json:
```json
{
    "body": "Commit: **[`6e40da1`](https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6)**",
    "created_at": "2021-08-01T23:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520489",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`6e40da1`](https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6)**



---

archive/issue_comments_520490.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6\"><code>6e40da1</code></a></td><td><code>DynamicalSystem_projective.preperiodic_points: In doctests, use 'sorted' throughout</code></td></tr></table>\n",
    "created_at": "2021-08-01T23:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520490",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6"><code>6e40da1</code></a></td><td><code>DynamicalSystem_projective.preperiodic_points: In doctests, use 'sorted' throughout</code></td></tr></table>




---

archive/issue_comments_520491.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-08-01T23:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520491",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_442577.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-01T23:36:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442577"
}
```



---

archive/issue_events_442578.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-08-02T14:42:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442578"
}
```



---

archive/issue_events_442579.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-08-02T14:42:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442579"
}
```



---

archive/issue_comments_520492.json:
```json
{
    "body": "Reviewer: **Ben Hutz**",
    "created_at": "2021-08-02T14:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520492",
    "user": "https://github.com/bhutz"
}
```

Reviewer: **Ben Hutz**



---

archive/issue_comments_520493.json:
```json
{
    "body": "Changed keywords from **random_fail 32bit** to **random_fail 32bit, gsoc2021**",
    "created_at": "2021-08-02T14:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520493",
    "user": "https://github.com/bhutz"
}
```

Changed keywords from **random_fail 32bit** to **random_fail 32bit, gsoc2021**



---

archive/issue_comments_520494.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIf the issue only comes from 32bit archs, why not separate cases with `# 32-bit` and `# 64-bit` keywords ? Sorting doctest makes them much less readable, and nothing explains the reason to the user (OK for the `TESTS` sections, not for the `EXAMPLES` ones).",
    "created_at": "2021-08-02T16:29:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520494",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:6" align="right">comment:6</div>

If the issue only comes from 32bit archs, why not separate cases with `# 32-bit` and `# 64-bit` keywords ? Sorting doctest makes them much less readable, and nothing explains the reason to the user (OK for the `TESTS` sections, not for the `EXAMPLES` ones).



---

archive/issue_events_442580.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-02T16:29:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442580"
}
```



---

archive/issue_events_442581.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-02T16:29:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442581"
}
```



---

archive/issue_comments_520495.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis problem also appeared in #31994. I would recommend the fix applied there, where the list is returned is sorted before returning. The order of the list is not important, as the preperiodic points are an unordered set.",
    "created_at": "2021-08-02T16:36:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520495",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:7" align="right">comment:7</div>

This problem also appeared in #31994. I would recommend the fix applied there, where the list is returned is sorted before returning. The order of the list is not important, as the preperiodic points are an unordered set.



---

archive/issue_comments_520496.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@sagetrac-tmonteil](#comment:6):\n> If the issue only comes from 32bit archs, why not separate cases with `# 32-bit` and `# 64-bit` keywords ? \n\nThe issue is coming from doctesting implementation/architecture-dependent behavior that is not guaranteed by the spec. It is best practice to avoid this, instead of updating doctests every time a different architecture or Python version is tested. \n\n`#32-bit` markers are best reserved to lower-level code that truly has to distinguish between architectures, such as when exact hash values have to be tested for some reason.\n\n> Sorting doctest makes them much less readable, and nothing explains the reason to the user \n\nWell, that is a shortcoming of the documentation -- or the choice of output type -- of this method. It returns a list (which is an ordered container) but the documentation does not explain anything about the order of the items.\n\nBy the way, in contemporary Python one would probably make functions like this iterators instead of returning a list. Then it is up to the user of the method to choose how to process it.",
    "created_at": "2021-08-02T17:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520496",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@sagetrac-tmonteil](#comment:6):
> If the issue only comes from 32bit archs, why not separate cases with `# 32-bit` and `# 64-bit` keywords ? 

The issue is coming from doctesting implementation/architecture-dependent behavior that is not guaranteed by the spec. It is best practice to avoid this, instead of updating doctests every time a different architecture or Python version is tested. 

`#32-bit` markers are best reserved to lower-level code that truly has to distinguish between architectures, such as when exact hash values have to be tested for some reason.

> Sorting doctest makes them much less readable, and nothing explains the reason to the user 

Well, that is a shortcoming of the documentation -- or the choice of output type -- of this method. It returns a list (which is an ordered container) but the documentation does not explain anything about the order of the items.

By the way, in contemporary Python one would probably make functions like this iterators instead of returning a list. Then it is up to the user of the method to choose how to process it.



---

archive/issue_comments_520497.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@EnderWannabe](#comment:7):\n> This problem also appeared in #31994. I would recommend the fix applied there, where the list is returned is sorted before returning. The order of the list is not important, as the preperiodic points are an unordered set.\n\nRight, I had thought I had seen this failure before on another ticket. \n\nSorting is another solution to make the output deterministic, of course. Feel free to replace my branch by a cherry-pick of https://github.com/sagemath/sagetrac-mirror/commit/abdade36276e7c5c51fc2a818f599c667f0f1627 -- I have no preference either way.\n\nIn any case, it would be a good to add to the description of the output a comment on the order.",
    "created_at": "2021-08-02T17:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520497",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@EnderWannabe](#comment:7):
> This problem also appeared in #31994. I would recommend the fix applied there, where the list is returned is sorted before returning. The order of the list is not important, as the preperiodic points are an unordered set.

Right, I had thought I had seen this failure before on another ticket. 

Sorting is another solution to make the output deterministic, of course. Feel free to replace my branch by a cherry-pick of https://github.com/sagemath/sagetrac-mirror/commit/abdade36276e7c5c51fc2a818f599c667f0f1627 -- I have no preference either way.

In any case, it would be a good to add to the description of the output a comment on the order.



---

archive/issue_comments_520498.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)** to **[u/gh-EnderWannabe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/random_failure_in_projective_ds_py)**",
    "created_at": "2021-08-02T21:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520498",
    "user": "https://github.com/EnderWannabe"
}
```

Changed branch from **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)** to **[u/gh-EnderWannabe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/random_failure_in_projective_ds_py)**



---

archive/issue_comments_520499.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mkoeppe](#comment:9):\n> In any case, it would be a good to add to the description of the output a comment on the order.\n\nAdded such a description.\n\nWhile this fix should work in theory, I don't personally have a 32 bit build of Sage. Could someone test the fix?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c52e5dc7be99be28e5d9b4757de116a65224064\"><code>1c52e5d</code></a></td><td><code>32322: added sorting inside function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547\"><code>258e61f</code></a></td><td><code>32322: added description</code></td></tr></table>\n",
    "created_at": "2021-08-02T21:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520499",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mkoeppe](#comment:9):
> In any case, it would be a good to add to the description of the output a comment on the order.

Added such a description.

While this fix should work in theory, I don't personally have a 32 bit build of Sage. Could someone test the fix?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c52e5dc7be99be28e5d9b4757de116a65224064"><code>1c52e5d</code></a></td><td><code>32322: added sorting inside function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547"><code>258e61f</code></a></td><td><code>32322: added description</code></td></tr></table>




---

archive/issue_comments_520500.json:
```json
{
    "body": "Changed commit from **[`6e40da1`](https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6)** to **[`258e61f`](https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547)**",
    "created_at": "2021-08-02T21:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520500",
    "user": "https://github.com/EnderWannabe"
}
```

Changed commit from **[`6e40da1`](https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6)** to **[`258e61f`](https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547)**



---

archive/issue_events_442582.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-08-02T23:43:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442582"
}
```



---

archive/issue_events_442583.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-08-02T23:43:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442583"
}
```



---

archive/issue_comments_520501.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nLGTM",
    "created_at": "2021-08-03T01:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520501",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

LGTM



---

archive/issue_comments_520502.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Alexander Galarraga**",
    "created_at": "2021-08-03T01:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520502",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Alexander Galarraga**



---

archive/issue_comments_520503.json:
```json
{
    "body": "Changed reviewer from **Ben Hutz** to **Matthias Koeppe**",
    "created_at": "2021-08-03T01:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520503",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Ben Hutz** to **Matthias Koeppe**



---

archive/issue_events_442584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-03T01:52:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442584"
}
```



---

archive/issue_events_442585.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-03T01:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442585"
}
```



---

archive/issue_comments_520504.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNow i am getting confused: on a 32bit VM (with #32080 applied), i still got the exact same failure as @vbraun:\n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ, 1)\nsage: R.<z> = QQ[]\nsage: K.<v> = NumberField(z^4 - z^2 - 1)\nsage: f = DynamicalSystem_projective([x^2 - y^2, y^2])\nsage: g = f.preperiodic_points(2, 1, R=K) ; g\n[(-v : 1), (v : 1)]\nsage: g.sort()\nsage: g\n[(-v : 1), (v : 1)]\n```\n\nHowever:\n\n```\nsage: g[0] < g[1]\nFalse\nsage: g[0] > g[1]\nTrue\nsage: g\n[(-v : 1), (v : 1)]\nsage: sorted(g)\n[(-v : 1), (v : 1)]\n```",
    "created_at": "2021-08-03T10:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520504",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:14" align="right">comment:14</div>

Now i am getting confused: on a 32bit VM (with #32080 applied), i still got the exact same failure as @vbraun:

```
sage: P.<x,y> = ProjectiveSpace(QQ, 1)
sage: R.<z> = QQ[]
sage: K.<v> = NumberField(z^4 - z^2 - 1)
sage: f = DynamicalSystem_projective([x^2 - y^2, y^2])
sage: g = f.preperiodic_points(2, 1, R=K) ; g
[(-v : 1), (v : 1)]
sage: g.sort()
sage: g
[(-v : 1), (v : 1)]
```

However:

```
sage: g[0] < g[1]
False
sage: g[0] > g[1]
True
sage: g
[(-v : 1), (v : 1)]
sage: sorted(g)
[(-v : 1), (v : 1)]
```



---

archive/issue_events_442586.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-03T10:47:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442586"
}
```



---

archive/issue_events_442587.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-03T10:47:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442587"
}
```



---

archive/issue_comments_520505.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe** to **Matthias Koeppe, Thierry Monteil**",
    "created_at": "2021-08-03T10:47:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520505",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed reviewer from **Matthias Koeppe** to **Matthias Koeppe, Thierry Monteil**



---

archive/issue_comments_520506.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nComparison is wrong, both in 32bit and 64bit systems (it is just that Python seems not to handle the case similarly on 32bit and 64bit systems). This is not a doctesting issue.\n\n```\nsage: g[0] < g[1]                                                                                                                                                                                            \nFalse\nsage: g[1] < g[0]                                                                                                                                                                                            \nFalse\nsage: g[0] > g[1]                                                                                                                                                                                            \nTrue\nsage: g[1] > g[0]                                                                                                                                                                                            \nTrue\n\nsage: g[0] <= g[1]\nFalse\nsage: g[1] <= g[0]\nFalse\nsage: g[0] >= g[1]\nTrue\nsage: g[1] >= g[0]\nTrue\n```",
    "created_at": "2021-08-03T12:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520506",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:16" align="right">comment:16</div>

Comparison is wrong, both in 32bit and 64bit systems (it is just that Python seems not to handle the case similarly on 32bit and 64bit systems). This is not a doctesting issue.

```
sage: g[0] < g[1]                                                                                                                                                                                            
False
sage: g[1] < g[0]                                                                                                                                                                                            
False
sage: g[0] > g[1]                                                                                                                                                                                            
True
sage: g[1] > g[0]                                                                                                                                                                                            
True

sage: g[0] <= g[1]
False
sage: g[1] <= g[0]
False
sage: g[0] >= g[1]
True
sage: g[1] >= g[0]
True
```



---

archive/issue_comments_520507.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor such objects, only equality is handled:\n\n```\nsage: a,b = g\nsage: a._richcmp_??\n```",
    "created_at": "2021-08-03T12:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520507",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:17" align="right">comment:17</div>

For such objects, only equality is handled:

```
sage: a,b = g
sage: a._richcmp_??
```



---

archive/issue_comments_520508.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOK, then of course \"sorting\" cannot fix the problem.\n\nI would suggest that we go back to my version (https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6) and add `key=str` to the use of `sorted` in doctests.",
    "created_at": "2021-08-03T12:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520508",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

OK, then of course "sorting" cannot fix the problem.

I would suggest that we go back to my version (https://github.com/sagemath/sagetrac-mirror/commit/6e40da1c50ec6e082ae1326d105a67c76b1d2db6) and add `key=str` to the use of `sorted` in doctests.



---

archive/issue_comments_520509.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThat's a good point for going back to sorting only the doctest output. In general, equality is the only comparison that makes sense for projective points. Over a field, you could do a richcmp lexicographically based on normalized coordinates, but, in general, you'd need a standard set of coordinates to go the sorting with.",
    "created_at": "2021-08-03T13:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520509",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:19" align="right">comment:19</div>

That's a good point for going back to sorting only the doctest output. In general, equality is the only comparison that makes sense for projective points. Over a field, you could do a richcmp lexicographically based on normalized coordinates, but, in general, you'd need a standard set of coordinates to go the sorting with.



---

archive/issue_comments_520510.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nProbably should revisit the #31994 fix too.",
    "created_at": "2021-08-03T13:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520510",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:20" align="right">comment:20</div>

Probably should revisit the #31994 fix too.



---

archive/issue_comments_520511.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@bhutz](#comment:19):\n> Over a field, you could do a richcmp lexicographically based on normalized coordinates, but, in general, you'd need a standard set of coordinates to go the sorting with.\n\nProjective points do implement lexicographic ordering, but comparison of number field elements is undefined. There is a long-standing ticket #20028 that aims to change comparisons of number field elements into an error in order to avoid unexpected behavior like this.",
    "created_at": "2021-08-03T17:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520511",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@bhutz](#comment:19):
> Over a field, you could do a richcmp lexicographically based on normalized coordinates, but, in general, you'd need a standard set of coordinates to go the sorting with.

Projective points do implement lexicographic ordering, but comparison of number field elements is undefined. There is a long-standing ticket #20028 that aims to change comparisons of number field elements into an error in order to avoid unexpected behavior like this.



---

archive/issue_comments_520512.json:
```json
{
    "body": "Changed branch from **[u/gh-EnderWannabe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/random_failure_in_projective_ds_py)** to **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)**",
    "created_at": "2021-08-03T18:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520512",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-EnderWannabe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/random_failure_in_projective_ds_py)** to **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)**



---

archive/issue_comments_520513.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil**",
    "created_at": "2021-08-03T18:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520513",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Matthias Koeppe, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil**



---

archive/issue_comments_520514.json:
```json
{
    "body": "Changed commit from **[`258e61f`](https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547)** to **[`f4f54da`](https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347)**",
    "created_at": "2021-08-03T18:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520514",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`258e61f`](https://github.com/sagemath/sagetrac-mirror/commit/258e61fbcd4ebd03e906c48f284326f4bc1cc547)** to **[`f4f54da`](https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347)**



---

archive/issue_comments_520515.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347\"><code>f4f54da</code></a></td><td><code>DynamicalSystem_projective.preperiodic_points: In doctests, use key=str when sorting</code></td></tr></table>\n",
    "created_at": "2021-08-03T18:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520515",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347"><code>f4f54da</code></a></td><td><code>DynamicalSystem_projective.preperiodic_points: In doctests, use key=str when sorting</code></td></tr></table>




---

archive/issue_events_442588.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-03T18:37:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442588"
}
```



---

archive/issue_events_442589.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-03T18:37:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442589"
}
```



---

archive/issue_comments_520516.json:
```json
{
    "body": "Changed author from **Alexander Galarraga** to **Matthias Koeppe**",
    "created_at": "2021-08-03T18:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520516",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Alexander Galarraga** to **Matthias Koeppe**



---

archive/issue_comments_520517.json:
```json
{
    "body": "Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**",
    "created_at": "2021-08-03T20:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520517",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**



---

archive/issue_events_442590.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-03T20:36:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442590"
}
```



---

archive/issue_events_442591.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-03T20:36:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442591"
}
```



---

archive/issue_comments_520518.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nCoud you please have a look at the branch https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/random_failure_in_projective_ds_py ? It only deals with the problematic doctest, the example is still understandable to the user, and the developer can track the issue.",
    "created_at": "2021-08-03T20:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520518",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:25" align="right">comment:25</div>

Coud you please have a look at the branch https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/random_failure_in_projective_ds_py ? It only deals with the problematic doctest, the example is still understandable to the user, and the developer can track the issue.



---

archive/issue_comments_520519.json:
```json
{
    "body": "Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun** to **Ben Hutz, Alexander Galarraga, Thierry Monteil**",
    "created_at": "2021-08-03T20:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520519",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun** to **Ben Hutz, Alexander Galarraga, Thierry Monteil**



---

archive/issue_comments_520520.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI do not like the way the issue is currently dealt with (sort everything) since:\n\n- we change doctests that are not problematic\n- we might end up with every doctest being sorted\n- doctests are not only tests, they are part of an example section that is important for users\n- the origin of the issue is not understandable",
    "created_at": "2021-08-03T20:45:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520520",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:26" align="right">comment:26</div>

I do not like the way the issue is currently dealt with (sort everything) since:

- we change doctests that are not problematic
- we might end up with every doctest being sorted
- doctests are not only tests, they are part of an example section that is important for users
- the origin of the issue is not understandable



---

archive/issue_comments_520521.json:
```json
{
    "body": "Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, , Volker Braun**",
    "created_at": "2021-08-03T20:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520521",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, , Volker Braun**



---

archive/issue_comments_520522.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n(the fact that Volker and i edited simultaneously changed the list of reviewers)",
    "created_at": "2021-08-03T20:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520522",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:27" align="right">comment:27</div>

(the fact that Volker and i edited simultaneously changed the list of reviewers)



---

archive/issue_comments_520523.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@sagetrac-tmonteil](#comment:25):\n> Coud you please have a look at the branch https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/random_failure_in_projective_ds_py ?\n\nPersonally, I like this fix best (and I think Ben is in agreement with me here). It is clear we need to sort the problematic doc test by string, but the other examples can be left untouched with no errors, as built in sorting works for the rationals and finite fields.",
    "created_at": "2021-08-03T20:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520523",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@sagetrac-tmonteil](#comment:25):
> Coud you please have a look at the branch https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/random_failure_in_projective_ds_py ?

Personally, I like this fix best (and I think Ben is in agreement with me here). It is clear we need to sort the problematic doc test by string, but the other examples can be left untouched with no errors, as built in sorting works for the rationals and finite fields.



---

archive/issue_events_442592.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-03T22:11:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442592"
}
```



---

archive/issue_events_442593.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-08-03T22:11:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442593"
}
```



---

archive/issue_comments_520524.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI would also prefer to only add sorted to the ones that fail to sort consistently.\n\nwrt to the tmonteil branch: yes, something like that. But, I'd rather have only one example with a little text saying something like the point order can be different on 32bit and 64bit architectures.",
    "created_at": "2021-08-03T23:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520524",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:31" align="right">comment:31</div>

I would also prefer to only add sorted to the ones that fail to sort consistently.

wrt to the tmonteil branch: yes, something like that. But, I'd rather have only one example with a little text saying something like the point order can be different on 32bit and 64bit architectures.



---

archive/issue_comments_520525.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@bhutz](#comment:31):\n> I would also prefer to only add sorted to the ones that fail to sort consistently.\n> \n> wrt to the tmonteil branch: yes, something like that. But, I'd rather have only one example with a little text saying something like the point order can be different on 32bit and 64bit architectures.\n\nOK, here is another branch : https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/failure_in_projective_ds_py-depends_on_architecture\n\nDo not hesitate to provide a better explanation.\n\nHowever, while i could reproduce the issue on my 32-bit VM, i could not ensure that this will happen on every 32-bit architecture (this is why i was more conservative in the previous branch).",
    "created_at": "2021-08-04T00:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520525",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@bhutz](#comment:31):
> I would also prefer to only add sorted to the ones that fail to sort consistently.
> 
> wrt to the tmonteil branch: yes, something like that. But, I'd rather have only one example with a little text saying something like the point order can be different on 32bit and 64bit architectures.

OK, here is another branch : https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/failure_in_projective_ds_py-depends_on_architecture

Do not hesitate to provide a better explanation.

However, while i could reproduce the issue on my 32-bit VM, i could not ensure that this will happen on every 32-bit architecture (this is why i was more conservative in the previous branch).



---

archive/issue_comments_520526.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSorry, I was unclear. I'm also not sure this will happen on every 32-bit architecture so I don't know if the new branch will fix all issues or just end up with different ones. I meant to suggested a single example with that explanation which is sorted with the str key. I think the explanation text you provided is fine.",
    "created_at": "2021-08-04T00:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520526",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:33" align="right">comment:33</div>

Sorry, I was unclear. I'm also not sure this will happen on every 32-bit architecture so I don't know if the new branch will fix all issues or just end up with different ones. I meant to suggested a single example with that explanation which is sorted with the str key. I think the explanation text you provided is fine.



---

archive/issue_comments_520527.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@bhutz](#comment:33):\n> Sorry, I was unclear. I'm also not sure this will happen on every 32-bit architecture so I don't know if the new branch will fix all issues or just end up with different ones. I meant to suggested a single example with that explanation which is sorted with the str key. I think the explanation text you provided is fine.\n\nOK, branch https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad",
    "created_at": "2021-08-04T01:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520527",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@bhutz](#comment:33):
> Sorry, I was unclear. I'm also not sure this will happen on every 32-bit architecture so I don't know if the new branch will fix all issues or just end up with different ones. I meant to suggested a single example with that explanation which is sorted with the str key. I think the explanation text you provided is fine.

OK, branch https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad



---

archive/issue_comments_520528.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI think that's fine. Want to set that as the ticket branch so that patch bot can see if that resolves the failures without creating any new ones?",
    "created_at": "2021-08-04T12:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520528",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:35" align="right">comment:35</div>

I think that's fine. Want to set that as the ticket branch so that patch bot can see if that resolves the failures without creating any new ones?



---

archive/issue_comments_520529.json:
```json
{
    "body": "Changed commit from **[`f4f54da`](https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347)** to **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**",
    "created_at": "2021-08-05T18:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520529",
    "user": "https://github.com/bhutz"
}
```

Changed commit from **[`f4f54da`](https://github.com/sagemath/sagetrac-mirror/commit/f4f54da3c1c476833ddc957a96c814840c958347)** to **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**



---

archive/issue_comments_520530.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)** to **[u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted)**",
    "created_at": "2021-08-05T18:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520530",
    "user": "https://github.com/bhutz"
}
```

Changed branch from **[u/mkoeppe/random_failure_in_projective_ds_py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/random_failure_in_projective_ds_py)** to **[u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted)**



---

archive/issue_comments_520531.json:
```json
{
    "body": "Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil, , Volker Braun** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**",
    "created_at": "2021-08-05T18:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520531",
    "user": "https://github.com/bhutz"
}
```

Changed reviewer from **Ben Hutz, Alexander Galarraga, Thierry Monteil, , Volker Braun** to **Ben Hutz, Alexander Galarraga, Thierry Monteil, Volker Braun**



---

archive/issue_comments_520532.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nLet's let the patchbot pick this up",
    "created_at": "2021-08-05T18:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520532",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:37" align="right">comment:37</div>

Let's let the patchbot pick this up



---

archive/issue_comments_520533.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Thierry Monteil**",
    "created_at": "2021-08-05T18:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520533",
    "user": "https://github.com/bhutz"
}
```

Changed author from **Matthias Koeppe** to **Thierry Monteil**



---

archive/issue_events_442594.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-08-05T18:23:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442594"
}
```



---

archive/issue_events_442595.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-08-05T18:23:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442595"
}
```



---

archive/issue_comments_520534.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nTests pass on patchbot, marking this positive",
    "created_at": "2021-08-06T21:50:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520534",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:38" align="right">comment:38</div>

Tests pass on patchbot, marking this positive



---

archive/issue_events_442596.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-08-06T21:50:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442596"
}
```



---

archive/issue_events_442597.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-08-06T21:50:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442597"
}
```



---

archive/issue_events_442598.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-08T15:37:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442598"
}
```



---

archive/issue_events_442599.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5090d3dab17130f3e481fe83bfc31544f38f5896",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-08-08T15:37:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32322#event-442599"
}
```



---

archive/issue_comments_520535.json:
```json
{
    "body": "Changed branch from **[u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted)** to **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**",
    "created_at": "2021-08-08T15:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32322#issuecomment-520535",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/failure_in_projective_ds_py_depends_on_architecture_sorted)** to **[`19acda3`](https://github.com/sagemath/sagetrac-mirror/commit/19acda3b1bd15b8f74d288297c12e5e35bd0fbad)**
