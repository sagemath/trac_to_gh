# Issue 32828: pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 59.2.0

archive/issues_032591.json:
```json
{
    "assignees": [],
    "body": "`pyzmq` fails to build on some platforms. We fix it by \n- upgrading `setuptools` to a version that includes https://github.com/pypa/distutils/pull/65 \n- correcting the `pyzmq` build configuration\n\nWe also upgrade `pyzmq` and `zeromq` to the latest versions.\n\nFor example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)\n\n```\nSetting up build directory for pyzmq-22.2.1\nFinished extraction\nNo patch files found in ../patches\n****************************************************\nHost system:\nLinux dd2167ea4425 5.11.0-1020-azure #21~20.04.1-Ubuntu SMP Mon Oct 11 18:54:28 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib64/gcc/x86_64-suse-linux/11/lto-wrapper\nOFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa\nOFFLOAD_TARGET_DEFAULT=1\nTarget: x86_64-suse-linux\nConfigured with: ../configure --prefix=/usr --infodir=/usr/share/info --mandir=/usr/share/man --libdir=/usr/lib64 --libexecdir=/usr/lib64 --enable-languages=c,c++,objc,fortran,obj-c++,ada,go,d,jit --enable-offload-targets=nvptx-none,amdgcn-amdhsa, --without-cuda-driver --enable-host-shared --enable-checking=release --disable-werror --with-gxx-include-dir=/usr/include/c++/11 --enable-ssp --disable-libssp --disable-libvtv --enable-cet=auto --disable-libcc1 --enable-plugin --with-bugurl=https://bugs.opensuse.org/ --with-pkgversion='SUSE Linux' --with-slibdir=/lib64 --with-system-zlib --enable-libstdcxx-allocator=new --disable-libstdcxx-pch --enable-libphobos --enable-version-specific-runtime-libs --with-gcc-major-version-only --enable-linker-build-id --enable-linux-futex --enable-gnu-indirect-function --program-suffix=-11 --without-system-libunwind --enable-multilib --with-arch-32=x86-64 --with-tune=generic --with-build-config=bootstrap-lto-lean --enable-link-mutex --build=x86_64-suse-linux --host=x86_64-suse-linux\nThread model: posix\nSupported LTO compression algorithms: zlib zstd\ngcc version 11.2.1 20210816 [revision 056e324ce46a7924b5cf10f61010cf9dd2ca10e9] (SUSE Linux) \n****************************************************\nPackage 'pyzmq' is currently not installed\nNo legacy uninstaller found for 'pyzmq'; nothing to do\nInstalling pyzmq-22.2.1\nProcessing /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/pyzmq-22.2.1/src\n    Preparing wheel metadata: started\n    Running command /sage/local/var/lib/sage/venv-python3.9.7/bin/python3 /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpn08jd7qu\n    INFO: Disabling color, you really want to install colorlog.\n    Disabling color, you really want to install colorlog.\n    running dist_info\n    creating /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info\n    writing /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/PKG-INFO\n    writing dependency_links to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/dependency_links.txt\n    writing requirements to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/requires.txt\n    writing top-level names to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/top_level.txt\n    writing manifest file '/tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/SOURCES.txt'\n    running configure\n    Settings obtained from pkg-config: {'library_dirs': [], 'include_dirs': [], 'libraries': ['zmq']}\n    {'libraries': ['zmq'], 'include_dirs': [], 'library_dirs': [], 'runtime_library_dirs': [], 'extra_link_args': []}\n    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC\n\n    compile options: '-c'\n    gcc: build/temp.linux-x86_64-3.9/scratch/check_sys_un.c\n    gcc build/temp.linux-x86_64-3.9/scratch/check_sys_un.o -o build/temp.linux-x86_64-3.9/scratch/check_sys_un\n    Configure: Autodetecting ZMQ settings...\n        Custom ZMQ dir:\n    Checking for timer_create\n    ** Errors about missing timer_create are a normal part of this process **\n    ************************************************\n    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC\n\n    creating build/temp.linux-x86_64-3.9/scratch/tmp\n    compile options: '-c'\n    gcc: /tmp/timer_create7kgvq7_0.c\n    /tmp/timer_create7kgvq7_0.c: In function 'main':\n    /tmp/timer_create7kgvq7_0.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]\n        2 |     timer_create();\n          |     ^~~~~~~~~~~~\n    gcc build/temp.linux-x86_64-3.9/scratch/tmp/timer_create7kgvq7_0.o -o build/temp.linux-x86_64-3.9/scratch/a.out\n\n    error: [Errno 2] No such file or directory: 'a.out'\n    Failed with default libzmq, trying again with /usr/local\n    {'libraries': ['zmq'], 'include_dirs': ['/usr/local/include'], 'library_dirs': ['/usr/local/lib'], 'runtime_library_dirs': ['/usr/local/lib'], 'extra_link_args': []}\n    Configure: Autodetecting ZMQ settings...\n        Custom ZMQ dir:       /usr/local\n    Checking for timer_create\n    ** Errors about missing timer_create are a normal part of this process **\n    ************************************************\n    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC\n\n    compile options: '-c'\n    gcc: /tmp/timer_createl5aoyxgr.c\n    /tmp/timer_createl5aoyxgr.c: In function 'main':\n    /tmp/timer_createl5aoyxgr.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]\n        2 |     timer_create();\n          |     ^~~~~~~~~~~~\n    Assembler messages:\n    Fatal error: can't create build/temp.linux-x86_64-3.9/scratch/tmp/timer_createl5aoyxgr.o: No such file or directory\n    ** The above error about timer_create is normal and not a problem! **\n    no timer_create, linking librt\n    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC\n\n    compile options: '-I/usr/local/include -Izmq/utils -c'\n    gcc: build/temp.linux-x86_64-3.9/scratch/vers.c\n    gcc build/temp.linux-x86_64-3.9/scratch/vers.o -L/usr/local/lib -Wl,--enable-new-dtags,-R/usr/local/lib -lzmq -lrt -o build/temp.linux-x86_64-3.9/scratch/vers\n    Error running version detection script:\n\n    build/temp.linux-x86_64-3.9/scratch/vers: error while loading shared libraries: libzmq.so.5: cannot open shared object file: No such file or directory\n\n\n    error: Error running version detection script:\n\n    build/temp.linux-x86_64-3.9/scratch/vers: error while loading shared libraries: libzmq.so.5: cannot open shared object file: No such file or directory\n\n\n    Warning: Couldn't find an acceptable libzmq on the system.\n\n    If you expected pyzmq to link against an installed libzmq, please check to make sure:\n\n        * You have a C compiler installed\n        * A development version of Python is installed (including headers)\n        * A development version of ZMQ >= 3.2 is installed (including headers)\n        * If ZMQ is not in a default location, supply the argument --zmq=<path>\n        * If you did recently install ZMQ to a default location,\n          try rebuilding the ld cache with `sudo ldconfig`\n          or specify zmq's location with `--zmq=/usr/local`\n\n    You can skip all this detection/waiting nonsense if you know\n    you want pyzmq to bundle libzmq as an extension by passing:\n\n        `--zmq=bundled`\n\n    I will now try to build libzmq as a Python extension\n    unless you interrupt me (^C) in the next 10 seconds...\n\n    ************************************************\n\n    10...\n     9...\n     8...\n     7...\n     6...\n     5...\n     4...\n     3...\n     2...\n     1...\n    Using bundled libzmq\n    already have bundled/zeromq\n    attempting ./configure to generate platform.hpp\n    Warning: failed to configure libzmq:\n    [Errno 2] No such file or directory: './configure'\n    staging platform.hpp from: /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/pyzmq-22.2.1/src/buildutils/include_linux\n    checking for timer_create\n```\n\nAlso reported in [#31855 comment:22](https://github.com/sagemath/sage/issues/31855#comment:22)\n\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nCC:  @enriqueartal @jhpalmieri @dimpase\n\nComponent: **packages: standard**\n\nAuthor: **Matthias Koeppe**\n\nBranch: **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32828_\n\n",
    "closed_at": "2021-12-05T11:15:41Z",
    "created_at": "2021-11-05T17:09:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 59.2.0",
    "type": "issue",
    "updated_at": "2021-12-21T19:09:42Z",
    "url": "https://github.com/sagemath/sage/issues/32828",
    "user": "https://github.com/mkoeppe"
}
```
`pyzmq` fails to build on some platforms. We fix it by 
- upgrading `setuptools` to a version that includes https://github.com/pypa/distutils/pull/65 
- correcting the `pyzmq` build configuration

We also upgrade `pyzmq` and `zeromq` to the latest versions.

For example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)

```
Setting up build directory for pyzmq-22.2.1
Finished extraction
No patch files found in ../patches
****************************************************
Host system:
Linux dd2167ea4425 5.11.0-1020-azure #21~20.04.1-Ubuntu SMP Mon Oct 11 18:54:28 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib64/gcc/x86_64-suse-linux/11/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-suse-linux
Configured with: ../configure --prefix=/usr --infodir=/usr/share/info --mandir=/usr/share/man --libdir=/usr/lib64 --libexecdir=/usr/lib64 --enable-languages=c,c++,objc,fortran,obj-c++,ada,go,d,jit --enable-offload-targets=nvptx-none,amdgcn-amdhsa, --without-cuda-driver --enable-host-shared --enable-checking=release --disable-werror --with-gxx-include-dir=/usr/include/c++/11 --enable-ssp --disable-libssp --disable-libvtv --enable-cet=auto --disable-libcc1 --enable-plugin --with-bugurl=https://bugs.opensuse.org/ --with-pkgversion='SUSE Linux' --with-slibdir=/lib64 --with-system-zlib --enable-libstdcxx-allocator=new --disable-libstdcxx-pch --enable-libphobos --enable-version-specific-runtime-libs --with-gcc-major-version-only --enable-linker-build-id --enable-linux-futex --enable-gnu-indirect-function --program-suffix=-11 --without-system-libunwind --enable-multilib --with-arch-32=x86-64 --with-tune=generic --with-build-config=bootstrap-lto-lean --enable-link-mutex --build=x86_64-suse-linux --host=x86_64-suse-linux
Thread model: posix
Supported LTO compression algorithms: zlib zstd
gcc version 11.2.1 20210816 [revision 056e324ce46a7924b5cf10f61010cf9dd2ca10e9] (SUSE Linux) 
****************************************************
Package 'pyzmq' is currently not installed
No legacy uninstaller found for 'pyzmq'; nothing to do
Installing pyzmq-22.2.1
Processing /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/pyzmq-22.2.1/src
    Preparing wheel metadata: started
    Running command /sage/local/var/lib/sage/venv-python3.9.7/bin/python3 /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpn08jd7qu
    INFO: Disabling color, you really want to install colorlog.
    Disabling color, you really want to install colorlog.
    running dist_info
    creating /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info
    writing /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/PKG-INFO
    writing dependency_links to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/dependency_links.txt
    writing requirements to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/requires.txt
    writing top-level names to /tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/top_level.txt
    writing manifest file '/tmp/pip-modern-metadata-oxt25qia/pyzmq.egg-info/SOURCES.txt'
    running configure
    Settings obtained from pkg-config: {'library_dirs': [], 'include_dirs': [], 'libraries': ['zmq']}
    {'libraries': ['zmq'], 'include_dirs': [], 'library_dirs': [], 'runtime_library_dirs': [], 'extra_link_args': []}
    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC

    compile options: '-c'
    gcc: build/temp.linux-x86_64-3.9/scratch/check_sys_un.c
    gcc build/temp.linux-x86_64-3.9/scratch/check_sys_un.o -o build/temp.linux-x86_64-3.9/scratch/check_sys_un
    Configure: Autodetecting ZMQ settings...
        Custom ZMQ dir:
    Checking for timer_create
    ** Errors about missing timer_create are a normal part of this process **
    ************************************************
    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC

    creating build/temp.linux-x86_64-3.9/scratch/tmp
    compile options: '-c'
    gcc: /tmp/timer_create7kgvq7_0.c
    /tmp/timer_create7kgvq7_0.c: In function 'main':
    /tmp/timer_create7kgvq7_0.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]
        2 |     timer_create();
          |     ^~~~~~~~~~~~
    gcc build/temp.linux-x86_64-3.9/scratch/tmp/timer_create7kgvq7_0.o -o build/temp.linux-x86_64-3.9/scratch/a.out

    error: [Errno 2] No such file or directory: 'a.out'
    Failed with default libzmq, trying again with /usr/local
    {'libraries': ['zmq'], 'include_dirs': ['/usr/local/include'], 'library_dirs': ['/usr/local/lib'], 'runtime_library_dirs': ['/usr/local/lib'], 'extra_link_args': []}
    Configure: Autodetecting ZMQ settings...
        Custom ZMQ dir:       /usr/local
    Checking for timer_create
    ** Errors about missing timer_create are a normal part of this process **
    ************************************************
    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC

    compile options: '-c'
    gcc: /tmp/timer_createl5aoyxgr.c
    /tmp/timer_createl5aoyxgr.c: In function 'main':
    /tmp/timer_createl5aoyxgr.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]
        2 |     timer_create();
          |     ^~~~~~~~~~~~
    Assembler messages:
    Fatal error: can't create build/temp.linux-x86_64-3.9/scratch/tmp/timer_createl5aoyxgr.o: No such file or directory
    ** The above error about timer_create is normal and not a problem! **
    no timer_create, linking librt
    C compiler: gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -fPIC

    compile options: '-I/usr/local/include -Izmq/utils -c'
    gcc: build/temp.linux-x86_64-3.9/scratch/vers.c
    gcc build/temp.linux-x86_64-3.9/scratch/vers.o -L/usr/local/lib -Wl,--enable-new-dtags,-R/usr/local/lib -lzmq -lrt -o build/temp.linux-x86_64-3.9/scratch/vers
    Error running version detection script:

    build/temp.linux-x86_64-3.9/scratch/vers: error while loading shared libraries: libzmq.so.5: cannot open shared object file: No such file or directory


    error: Error running version detection script:

    build/temp.linux-x86_64-3.9/scratch/vers: error while loading shared libraries: libzmq.so.5: cannot open shared object file: No such file or directory


    Warning: Couldn't find an acceptable libzmq on the system.

    If you expected pyzmq to link against an installed libzmq, please check to make sure:

        * You have a C compiler installed
        * A development version of Python is installed (including headers)
        * A development version of ZMQ >= 3.2 is installed (including headers)
        * If ZMQ is not in a default location, supply the argument --zmq=<path>
        * If you did recently install ZMQ to a default location,
          try rebuilding the ld cache with `sudo ldconfig`
          or specify zmq's location with `--zmq=/usr/local`

    You can skip all this detection/waiting nonsense if you know
    you want pyzmq to bundle libzmq as an extension by passing:

        `--zmq=bundled`

    I will now try to build libzmq as a Python extension
    unless you interrupt me (^C) in the next 10 seconds...

    ************************************************

    10...
     9...
     8...
     7...
     6...
     5...
     4...
     3...
     2...
     1...
    Using bundled libzmq
    already have bundled/zeromq
    attempting ./configure to generate platform.hpp
    Warning: failed to configure libzmq:
    [Errno 2] No such file or directory: './configure'
    staging platform.hpp from: /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/pyzmq-22.2.1/src/buildutils/include_linux
    checking for timer_create
```

Also reported in [#31855 comment:22](https://github.com/sagemath/sage/issues/31855#comment:22)


Upstream: **Fixed upstream, in a later stable release.**

CC:  @enriqueartal @jhpalmieri @dimpase

Component: **packages: standard**

Author: **Matthias Koeppe**

Branch: **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/32828_





---

archive/issue_events_448696.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-05T17:09:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448696"
}
```



---

archive/issue_events_448697.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-05T17:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448697"
}
```



---

archive/issue_events_448698.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-05T17:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448698"
}
```



---

archive/issue_events_448699.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-05T17:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448699"
}
```



---

archive/issue_comments_529815.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n\n```\n    Configure: Autodetecting ZMQ settings...\n        Custom ZMQ dir:       /usr/local\n```\nweird.",
    "created_at": "2021-11-05T18:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529815",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>


```
    Configure: Autodetecting ZMQ settings...
        Custom ZMQ dir:       /usr/local
```
weird.



---

archive/issue_comments_529816.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI'd have tried updating zeromq to the latest version, 4.3.4.",
    "created_at": "2021-11-05T18:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529816",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

I'd have tried updating zeromq to the latest version, 4.3.4.



---

archive/issue_comments_529817.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@dimpase](#comment%3A4):\n> I'd have tried updating zeromq to the latest version, 4.3.4.\n\nIt didn't work for me. I tried also to use pyzmq-22.3.0; it fails to download https://github.com/zeromq/libzmq/releases/download/v4.3.4/zeromq-4.3.4.zip and stops (downloading directly works)\n\nCompiling pyzmq outside Sage gives no error; maybe some local variable? Is is possible to use system package?",
    "created_at": "2021-11-05T19:01:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529817",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@dimpase](#comment%3A4):
> I'd have tried updating zeromq to the latest version, 4.3.4.

It didn't work for me. I tried also to use pyzmq-22.3.0; it fails to download https://github.com/zeromq/libzmq/releases/download/v4.3.4/zeromq-4.3.4.zip and stops (downloading directly works)

Compiling pyzmq outside Sage gives no error; maybe some local variable? Is is possible to use system package?



---

archive/issue_comments_529818.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think the attempted configuration with `setup.cfg` does not work at all. This was masked so far by SAGE_VENV and SAGE_LOCAL being the same, which has changed.\n\nThis is another case where the locations discovered by the configure tests in `spkg-configure.m4` are not passed on",
    "created_at": "2021-11-05T19:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529818",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

I think the attempted configuration with `setup.cfg` does not work at all. This was masked so far by SAGE_VENV and SAGE_LOCAL being the same, which has changed.

This is another case where the locations discovered by the configure tests in `spkg-configure.m4` are not passed on



---

archive/issue_comments_529819.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSorry, but the error happens in the minimal build, spkg-configure.m4 is not involved, right?",
    "created_at": "2021-11-05T20:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529819",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

Sorry, but the error happens in the minimal build, spkg-configure.m4 is not involved, right?



---

archive/issue_comments_529820.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYou are right, it isn't; I should have written \"this is *also* another case...\"",
    "created_at": "2021-11-05T21:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529820",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

You are right, it isn't; I should have written "this is *also* another case..."



---

archive/issue_comments_529821.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIs there a temptative solution to test?\n\nReplying to [@mkoeppe](#comment%3A6):\n> I think the attempted configuration with `setup.cfg` does not work at all. This was masked so far by SAGE_VENV and SAGE_LOCAL being the same, which has changed.\n> \n> This is another case where the locations discovered by the configure tests in `spkg-configure.m4` are not passed on",
    "created_at": "2021-11-05T21:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529821",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:9" align="right">comment:9</div>

Is there a temptative solution to test?

Replying to [@mkoeppe](#comment%3A6):
> I think the attempted configuration with `setup.cfg` does not work at all. This was masked so far by SAGE_VENV and SAGE_LOCAL being the same, which has changed.
> 
> This is another case where the locations discovered by the configure tests in `spkg-configure.m4` are not passed on



---

archive/issue_comments_529822.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nDirty trick to test the other changes in Fedora 35:\n\n`sage -pip install pyzmq==22.0.3`\n\nand comment out the install line in `spkg-install.in`. In other installation I did the same thing with the last version of pyzmq. \n\nI am running tests now.",
    "created_at": "2021-11-06T09:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529822",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:10" align="right">comment:10</div>

Dirty trick to test the other changes in Fedora 35:

`sage -pip install pyzmq==22.0.3`

and comment out the install line in `spkg-install.in`. In other installation I did the same thing with the last version of pyzmq. 

I am running tests now.



---

archive/issue_comments_529823.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI finished two compilations in Fedora 35, in both cases using a package of cysignals from https://github.com/enriqueartal/cysignals/commit/b404fbef69ddd5cfd0085ab15885e9f0315f9471 which is actually https://github.com/kliem/cysignals/tree/fix_non_constant_MINSIGSTKSZ up to a right parenthesis and installing pymzq as in [comment:10](#comment%3A10).\n\nOne compilation is for 9.4. The test gave the following failures:\n\n```\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 9 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/doctest/test.py  # 7 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/symbolic/integration/integral.py  # 1 doctest failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/rings/polynomial/polynomial_zmod_flint.pyx  # Timed out\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/tests/cmdline.py  # 2 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/modular/abvar/abvar.py  # 1 doctest failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/modular/hecke/submodule.py  # 1 doctest failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/sympow.py  # 13 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/schemes/elliptic_curves/lseries_ell.py  # 3 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/libs/giac/__init__.py  # 13 doctests failed\nsage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/lcalc.py  # 2 doctests failed\n```\nSome of them seem to be harmless (right permissions), other ones may reflect some problems between giac and cysignals.\n\nThe second one is for the branch #30766 merged with develop, with the above cysignals and pyzmq and also gmpy2-2.1.0rc1. Besides the errors below, I did not find jupyter in `$SAGE_ROOT/local/share` but in `$SAGE_ROOT/local/var/lib/sage/venv-python3.10/share`:\n\n```\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 9 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/polynomial_zmod_flint.pyx  # Timed out\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/function_field/function_field.py  # Timed out\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/doctest/test.py  # 25 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/tests/cmdline.py  # 4 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/misc/sageinspect.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/abvar/abvar.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/hecke/submodule.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/sympow.py  # 13 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/lseries_ell.py  # 3 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/plot/colors.py  # 5 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage_docbuild/utils.py  # 2 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/libs/giac/__init__.py  # 13 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/structure/unique_representation.py  # 1 doctest failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/lcalc.py  # 2 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/modform/numerical.py  # 3 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/symbolic/callable.py  # 5 doctests failed\nsage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/cpython/atexit.pyx  # 6 doctests failed\n```",
    "created_at": "2021-11-06T22:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529823",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:11" align="right">comment:11</div>

I finished two compilations in Fedora 35, in both cases using a package of cysignals from https://github.com/enriqueartal/cysignals/commit/b404fbef69ddd5cfd0085ab15885e9f0315f9471 which is actually https://github.com/kliem/cysignals/tree/fix_non_constant_MINSIGSTKSZ up to a right parenthesis and installing pymzq as in [comment:10](#comment%3A10).

One compilation is for 9.4. The test gave the following failures:

```
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 9 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/doctest/test.py  # 7 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/symbolic/integration/integral.py  # 1 doctest failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/rings/polynomial/polynomial_zmod_flint.pyx  # Timed out
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/tests/cmdline.py  # 2 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/modular/abvar/abvar.py  # 1 doctest failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/modular/hecke/submodule.py  # 1 doctest failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/sympow.py  # 13 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/schemes/elliptic_curves/lseries_ell.py  # 3 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/libs/giac/__init__.py  # 13 doctests failed
sage -t --long --warn-long 212.7 --random-seed=0 src/sage/lfunctions/lcalc.py  # 2 doctests failed
```
Some of them seem to be harmless (right permissions), other ones may reflect some problems between giac and cysignals.

The second one is for the branch #30766 merged with develop, with the above cysignals and pyzmq and also gmpy2-2.1.0rc1. Besides the errors below, I did not find jupyter in `$SAGE_ROOT/local/share` but in `$SAGE_ROOT/local/var/lib/sage/venv-python3.10/share`:

```
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 9 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/polynomial_zmod_flint.pyx  # Timed out
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/function_field/function_field.py  # Timed out
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/doctest/test.py  # 25 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/tests/cmdline.py  # 4 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/abvar/abvar.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/hecke/submodule.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/sympow.py  # 13 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/lseries_ell.py  # 3 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/plot/colors.py  # 5 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage_docbuild/utils.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/libs/giac/__init__.py  # 13 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/structure/unique_representation.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/lcalc.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/modform/numerical.py  # 3 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/symbolic/callable.py  # 5 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/cpython/atexit.pyx  # 6 doctests failed
```



---

archive/issue_comments_529824.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think the above would be better to discuss in #30767.\nLet's please keep this ticket focused on the pyzmq build failures.",
    "created_at": "2021-11-06T22:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529824",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I think the above would be better to discuss in #30767.
Let's please keep this ticket focused on the pyzmq build failures.



---

archive/issue_comments_529825.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIt looks like `pyzmq` is incompatible with our use of `SETUPTOOLS_USE_DISTUTILS=local`.",
    "created_at": "2021-11-06T22:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529825",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

It looks like `pyzmq` is incompatible with our use of `SETUPTOOLS_USE_DISTUTILS=local`.



---

archive/issue_comments_529826.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@mkoeppe](#comment%3A12):\n> I think the above would be better to discuss in #30767.\n> Let's please keep this ticket focused on the pyzmq build failures.\n\nOK, sorry for the noise (#32576 is also involved)",
    "created_at": "2021-11-06T22:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529826",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@mkoeppe](#comment%3A12):
> I think the above would be better to discuss in #30767.
> Let's please keep this ticket focused on the pyzmq build failures.

OK, sorry for the noise (#32576 is also involved)



---

archive/issue_comments_529827.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mkoeppe](#comment%3A13):\n> It looks like `pyzmq` is incompatible with our use of `SETUPTOOLS_USE_DISTUTILS=local`.\n\nThe recent `setuptools` versions vendor a version of distutils that has a bug described in https://github.com/pypa/distutils/issues/64",
    "created_at": "2021-11-06T23:02:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529827",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mkoeppe](#comment%3A13):
> It looks like `pyzmq` is incompatible with our use of `SETUPTOOLS_USE_DISTUTILS=local`.

The recent `setuptools` versions vendor a version of distutils that has a bug described in https://github.com/pypa/distutils/issues/64



---

archive/issue_comments_529828.json:
```json
{
    "body": "Branch: **[u/mkoeppe/pyzmq__build_errors](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pyzmq__build_errors)**",
    "created_at": "2021-11-07T01:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529828",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/pyzmq__build_errors](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pyzmq__build_errors)**



---

archive/issue_comments_529829.json:
```json
{
    "body": "Commit: **[`89e1dea`](https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057)**",
    "created_at": "2021-11-07T02:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529829",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`89e1dea`](https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057)**



---

archive/issue_comments_529830.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb48e082f7b30942aeaa3b3fe6a3ba407ebc8e4d\"><code>fb48e08</code></a></td><td><code>build/pkgs/pyzmq/spkg-install.in: Do not overwrite library_dirs, include_dirs here, instead use zmq_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057\"><code>89e1dea</code></a></td><td><code>build/pkgs/setuptools: Instead of bumping the patch level, upgrade to 58.5.3</code></td></tr></table>\n",
    "created_at": "2021-11-07T02:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529830",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb48e082f7b30942aeaa3b3fe6a3ba407ebc8e4d"><code>fb48e08</code></a></td><td><code>build/pkgs/pyzmq/spkg-install.in: Do not overwrite library_dirs, include_dirs here, instead use zmq_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057"><code>89e1dea</code></a></td><td><code>build/pkgs/setuptools: Instead of bumping the patch level, upgrade to 58.5.3</code></td></tr></table>




---

archive/issue_events_448700.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-07T02:11:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "title_is": "pyzmq: Fix build errors, upgrade and patch setuptools",
    "title_was": "pyzmq: Build errors",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448700"
}
```



---

archive/issue_events_448701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-07T02:11:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448701"
}
```



---

archive/issue_comments_529831.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-11-07T02:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529831",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_529832.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7\"><code>129d0fb</code></a></td><td><code>build/pkgs/pyzmq/spkg-install.in: Fix up</code></td></tr></table>\n",
    "created_at": "2021-11-07T02:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529832",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7"><code>129d0fb</code></a></td><td><code>build/pkgs/pyzmq/spkg-install.in: Fix up</code></td></tr></table>




---

archive/issue_comments_529833.json:
```json
{
    "body": "Changed commit from **[`89e1dea`](https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057)** to **[`129d0fb`](https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7)**",
    "created_at": "2021-11-07T02:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529833",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`89e1dea`](https://github.com/sagemath/sagetrac-mirror/commit/89e1dea356a04ee0f68def9823f9bee117a09057)** to **[`129d0fb`](https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7)**



---

archive/issue_comments_529834.json:
```json
{
    "body": "Changed commit from **[`129d0fb`](https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7)** to **[`fc11612`](https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49)**",
    "created_at": "2021-11-07T02:19:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529834",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`129d0fb`](https://github.com/sagemath/sagetrac-mirror/commit/129d0fbd15736ebf8d547620f4a27e93ca431eb7)** to **[`fc11612`](https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49)**



---

archive/issue_comments_529835.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2240cc157d1b17a087d42ea9010a920a80288de2\"><code>2240cc1</code></a></td><td><code>build/pkgs/pyzmq: Update to 22.3.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49\"><code>fc11612</code></a></td><td><code>build/pkgs/zeromq: Update to 4.3.4, add upstream_url</code></td></tr></table>\n",
    "created_at": "2021-11-07T02:19:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529835",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2240cc157d1b17a087d42ea9010a920a80288de2"><code>2240cc1</code></a></td><td><code>build/pkgs/pyzmq: Update to 22.3.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49"><code>fc11612</code></a></td><td><code>build/pkgs/zeromq: Update to 4.3.4, add upstream_url</code></td></tr></table>




---

archive/issue_events_448702.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-07T02:20:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "title_is": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 58.5.3, add patch",
    "title_was": "pyzmq: Fix build errors, upgrade and patch setuptools",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448702"
}
```



---

archive/issue_comments_529836.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf\"><code>a8fe9da</code></a></td><td><code>build/pkgs/zeromq/patches/getrandom.patch: Remove</code></td></tr></table>\n",
    "created_at": "2021-11-07T02:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf"><code>a8fe9da</code></a></td><td><code>build/pkgs/zeromq/patches/getrandom.patch: Remove</code></td></tr></table>




---

archive/issue_comments_529837.json:
```json
{
    "body": "Changed commit from **[`fc11612`](https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49)** to **[`a8fe9da`](https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf)**",
    "created_at": "2021-11-07T02:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529837",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fc11612`](https://github.com/sagemath/sagetrac-mirror/commit/fc116124dfa4790bdd829f2b8518cf076adb4e49)** to **[`a8fe9da`](https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf)**



---

archive/issue_comments_529838.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIn my case it worked with one more change; in `spkg-install.in` for `pyzmq`, replace `$SAGE_LOCAL` by `$SAGE_VENV` (I use python3.10).",
    "created_at": "2021-11-07T09:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529838",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:24" align="right">comment:24</div>

In my case it worked with one more change; in `spkg-install.in` for `pyzmq`, replace `$SAGE_LOCAL` by `$SAGE_VENV` (I use python3.10).



---

archive/issue_comments_529839.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@enriqueartal](#comment%3A24):\n> In my case it worked with one more change; in `spkg-install.in` for `pyzmq`, replace `$SAGE_LOCAL` by `$SAGE_VENV` (I use python3.10).\n\nThis change doesn't make sense -- `zeromq` is not installed in `SAGE_VENV`.\nCan you show me the log of a failure without that change?",
    "created_at": "2021-11-07T16:54:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529839",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@enriqueartal](#comment%3A24):
> In my case it worked with one more change; in `spkg-install.in` for `pyzmq`, replace `$SAGE_LOCAL` by `$SAGE_VENV` (I use python3.10).

This change doesn't make sense -- `zeromq` is not installed in `SAGE_VENV`.
Can you show me the log of a failure without that change?



---

archive/issue_comments_529840.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nDo you mean `zeromq` or `pyzmq`. FOR `zeromq` it used the system package. If it helps as I said in [comment:11](#comment%3A11) jupyter is located also in `$SAGE_VENV/share`.\n\nFind below the log\n\n```\nUsing cached file /usr/local/sage-310/upstream/pyzmq-22.3.0.tar.gz\npyzmq-22.3.0\n====================================================\nSetting up build directory for pyzmq-22.3.0\nFinished extraction\nNo patch files found in ../patches\n****************************************************\nHost system:\nLinux singular 5.14.16-301.fc35.x86_64 #1 SMP Wed Nov 3 13:55:42 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/11/lto-wrapper\nOFFLOAD_TARGET_NAMES=nvptx-none\nOFFLOAD_TARGET_DEFAULT=1\nTarget: x86_64-redhat-linux\nConfigured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,objc,obj-c++,ada,go,d,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-11.2.1-20210728/obj-x86_64-redhat-linux/isl-install --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux --with-build-config=bootstrap-lto --enable-link-serialization=1\nThread model: posix\nSupported LTO compression algorithms: zlib zstd\ngcc version 11.2.1 20210728 (Red Hat 11.2.1-1) (GCC) \n****************************************************\nPackage 'pyzmq' is currently not installed\nNo legacy uninstaller found for 'pyzmq'; nothing to do\nInstalling pyzmq-22.3.0\nProcessing /usr/local/sage-310/local/var/lib/sage/venv-python3.10/var/tmp/sage/build/pyzmq-22.3.0/src\n    Preparing wheel metadata: started\n    Running command /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50\n    running dist_info\n    creating /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info\n    writing /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/PKG-INFO\n    writing dependency_links to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/dependency_links.txt\n    writing requirements to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/requires.txt\n    writing top-level names to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/top_level.txt\n    writing manifest file '/tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/SOURCES.txt'\n    running configure\n    {'libraries': ['zmq'], 'include_dirs': ['/usr/local/sage-310/local/include'], 'library_dirs': ['/usr/local/sage-310/local/lib'], 'runtime_library_dirs': ['/usr/local/sage-310/local/lib'], 'extra_link_args': []}\n    gcc -Wno-unused-result -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -g -O2 -fPIC -I/usr/local/sage-310/local/include -c build/temp.linux-x86_64-3.10/scratch/check_sys_un.c -o build/temp.linux-x86_64-3.10/scratch/check_sys_un.o\n    gcc build/temp.linux-x86_64-3.10/scratch/check_sys_un.o -L/usr/local/sage-310/local/lib -Wl,--enable-new-dtags,-R/usr/local/sage-310/local/lib -o build/temp.linux-x86_64-3.10/scratch/check_sys_un\n    Configure: Autodetecting ZMQ settings...\n        Custom ZMQ dir:       /usr/local/sage-310/local\n    Checking for timer_create\n    ** Errors about missing timer_create are a normal part of this process **\n    ************************************************\n    creating build/temp.linux-x86_64-3.10/scratch/tmp\n    gcc -Wno-unused-result -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -g -O2 -fPIC -c /tmp/timer_createhby4x8bf.c -o build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o\n    /tmp/timer_createhby4x8bf.c: In function 'main':\n    /tmp/timer_createhby4x8bf.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]\n        2 |     timer_create();\n          |     ^~~~~~~~~~~~\n    gcc build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o -o build/temp.linux-x86_64-3.10/scratch/a.out\n\n    error: [Errno 2] No such file or directory: 'a.out'\n\n    Fatal: Falling back on bundled libzmq, but config has explicitly prohibited building the libzmq extension.\n    Preparing wheel metadata: finished with status 'error'\nWARNING: Discarding file:///usr/local/sage-310/local/var/lib/sage/venv-python3.10/var/tmp/sage/build/pyzmq-22.3.0/src. Command errored out with exit status 1: /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50 Check the logs for full command output.\nERROR: Command errored out with exit status 1: /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50 Check the logs for full command output.\n********************************************************************************************************************************************************************************************************************************************\nError building a wheel for pyzmq-22.3.0\n********************************************************************************************************************************************************************************************************************************************\n\nreal\t0m0.831s\nuser\t0m0.755s\nsys\t0m0.085s\n************************************************************************\nError installing package pyzmq-22.3.0\n```",
    "created_at": "2021-11-07T20:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529840",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:26" align="right">comment:26</div>

Do you mean `zeromq` or `pyzmq`. FOR `zeromq` it used the system package. If it helps as I said in [comment:11](#comment%3A11) jupyter is located also in `$SAGE_VENV/share`.

Find below the log

```
Using cached file /usr/local/sage-310/upstream/pyzmq-22.3.0.tar.gz
pyzmq-22.3.0
====================================================
Setting up build directory for pyzmq-22.3.0
Finished extraction
No patch files found in ../patches
****************************************************
Host system:
Linux singular 5.14.16-301.fc35.x86_64 #1 SMP Wed Nov 3 13:55:42 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/11/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,objc,obj-c++,ada,go,d,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-11.2.1-20210728/obj-x86_64-redhat-linux/isl-install --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux --with-build-config=bootstrap-lto --enable-link-serialization=1
Thread model: posix
Supported LTO compression algorithms: zlib zstd
gcc version 11.2.1 20210728 (Red Hat 11.2.1-1) (GCC) 
****************************************************
Package 'pyzmq' is currently not installed
No legacy uninstaller found for 'pyzmq'; nothing to do
Installing pyzmq-22.3.0
Processing /usr/local/sage-310/local/var/lib/sage/venv-python3.10/var/tmp/sage/build/pyzmq-22.3.0/src
    Preparing wheel metadata: started
    Running command /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50
    running dist_info
    creating /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info
    writing /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/PKG-INFO
    writing dependency_links to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/dependency_links.txt
    writing requirements to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/requires.txt
    writing top-level names to /tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/top_level.txt
    writing manifest file '/tmp/pip-modern-metadata-2ffuf65k/pyzmq.egg-info/SOURCES.txt'
    running configure
    {'libraries': ['zmq'], 'include_dirs': ['/usr/local/sage-310/local/include'], 'library_dirs': ['/usr/local/sage-310/local/lib'], 'runtime_library_dirs': ['/usr/local/sage-310/local/lib'], 'extra_link_args': []}
    gcc -Wno-unused-result -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -g -O2 -fPIC -I/usr/local/sage-310/local/include -c build/temp.linux-x86_64-3.10/scratch/check_sys_un.c -o build/temp.linux-x86_64-3.10/scratch/check_sys_un.o
    gcc build/temp.linux-x86_64-3.10/scratch/check_sys_un.o -L/usr/local/sage-310/local/lib -Wl,--enable-new-dtags,-R/usr/local/sage-310/local/lib -o build/temp.linux-x86_64-3.10/scratch/check_sys_un
    Configure: Autodetecting ZMQ settings...
        Custom ZMQ dir:       /usr/local/sage-310/local
    Checking for timer_create
    ** Errors about missing timer_create are a normal part of this process **
    ************************************************
    creating build/temp.linux-x86_64-3.10/scratch/tmp
    gcc -Wno-unused-result -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -g -O2 -fPIC -c /tmp/timer_createhby4x8bf.c -o build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o
    /tmp/timer_createhby4x8bf.c: In function 'main':
    /tmp/timer_createhby4x8bf.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]
        2 |     timer_create();
          |     ^~~~~~~~~~~~
    gcc build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o -o build/temp.linux-x86_64-3.10/scratch/a.out

    error: [Errno 2] No such file or directory: 'a.out'

    Fatal: Falling back on bundled libzmq, but config has explicitly prohibited building the libzmq extension.
    Preparing wheel metadata: finished with status 'error'
WARNING: Discarding file:///usr/local/sage-310/local/var/lib/sage/venv-python3.10/var/tmp/sage/build/pyzmq-22.3.0/src. Command errored out with exit status 1: /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50 Check the logs for full command output.
ERROR: Command errored out with exit status 1: /usr/local/sage-310/local/var/lib/sage/venv-python3.10/bin/python3 /usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpy23ywl50 Check the logs for full command output.
********************************************************************************************************************************************************************************************************************************************
Error building a wheel for pyzmq-22.3.0
********************************************************************************************************************************************************************************************************************************************

real	0m0.831s
user	0m0.755s
sys	0m0.085s
************************************************************************
Error installing package pyzmq-22.3.0
```



---

archive/issue_comments_529841.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@enriqueartal](#comment%3A26):\n> Do you mean `zeromq` or `pyzmq`. FOR `zeromq` it used the system package.\n\nThe configuration of `pyzmq` arranges for the `zeromq` installation to be found.\nWhen `zeromq` is not available as a system package, it is installed in `SAGE_LOCAL`, hence this line of the configuration.",
    "created_at": "2021-11-07T20:39:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529841",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@enriqueartal](#comment%3A26):
> Do you mean `zeromq` or `pyzmq`. FOR `zeromq` it used the system package.

The configuration of `pyzmq` arranges for the `zeromq` installation to be found.
When `zeromq` is not available as a system package, it is installed in `SAGE_LOCAL`, hence this line of the configuration.



---

archive/issue_comments_529842.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@enriqueartal](#comment%3A26):\n> Find below the log\n> \n> ```\n> ...\n>     /tmp/timer_createhby4x8bf.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]\n>         2 |     timer_create();\n>           |     ^~~~~~~~~~~~\n>     gcc build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o -o build/temp.linux-x86_64-3.10/scratch/a.out\n> \n>     error: [Errno 2] No such file or directory: 'a.out'\n> \n> ```\n\nThis is the bug that I fixed in `setuptools` here on the ticket -- are you sure this got installed?",
    "created_at": "2021-11-07T20:41:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529842",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@enriqueartal](#comment%3A26):
> Find below the log
> 
> ```
> ...
>     /tmp/timer_createhby4x8bf.c:2:5: warning: implicit declaration of function 'timer_create' [-Wimplicit-function-declaration]
>         2 |     timer_create();
>           |     ^~~~~~~~~~~~
>     gcc build/temp.linux-x86_64-3.10/scratch/tmp/timer_createhby4x8bf.o -o build/temp.linux-x86_64-3.10/scratch/a.out
> 
>     error: [Errno 2] No such file or directory: 'a.out'
> 
> ```

This is the bug that I fixed in `setuptools` here on the ticket -- are you sure this got installed?



---

archive/issue_comments_529843.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI made a clean install (including cffi) and modifying cysignals, and it works the compilation, I am testing now. Sorry for the noise.",
    "created_at": "2021-11-08T12:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529843",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:29" align="right">comment:29</div>

I made a clean install (including cffi) and modifying cysignals, and it works the compilation, I am testing now. Sorry for the noise.



---

archive/issue_comments_529844.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThese are the non successful tests:\n\n```\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/cpython/atexit.pyx  # 6 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/lfunctions/lcalc.py  # 2 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/libs/giac/__init__.py  # 7 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/misc/sageinspect.py  # 1 doctest failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/plot/colors.py  # 5 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/rings/padics/padic_extension_leaves.py  # Timed out\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/elliptic_curves/BSD.py  # 3 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/elliptic_curves/lseries_ell.py  # 2 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/structure/unique_representation.py  # 1 doctest failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/symbolic/callable.py  # 5 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage/tests/cmdline.py  # 7 doctests failed\nsage -t --random-seed=271923535750116010797008611844103265449 src/sage_docbuild/utils.py  # 2 doctests failed\n```\nThis is the result with Python3-3.10 package (with system package there were plenty of segmentation faults, also with the package and testpy installed). I hope it helps.",
    "created_at": "2021-11-08T19:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529844",
    "user": "https://github.com/enriqueartal"
}
```

<div id="comment:30" align="right">comment:30</div>

These are the non successful tests:

```
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/cpython/atexit.pyx  # 6 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/lfunctions/lcalc.py  # 2 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/libs/giac/__init__.py  # 7 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/plot/colors.py  # 5 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/rings/padics/padic_extension_leaves.py  # Timed out
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/elliptic_curves/BSD.py  # 3 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/elliptic_curves/lseries_ell.py  # 2 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/structure/unique_representation.py  # 1 doctest failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/symbolic/callable.py  # 5 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage/tests/cmdline.py  # 7 doctests failed
sage -t --random-seed=271923535750116010797008611844103265449 src/sage_docbuild/utils.py  # 2 doctests failed
```
This is the result with Python3-3.10 package (with system package there were plenty of segmentation faults, also with the package and testpy installed). I hope it helps.



---

archive/issue_comments_529845.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThanks for testing. So for this ticket - installation was successful. The test failures are surely unrelated to setuptools and pyzmq.\n\nLet's get this fix in then.",
    "created_at": "2021-11-08T20:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529845",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Thanks for testing. So for this ticket - installation was successful. The test failures are surely unrelated to setuptools and pyzmq.

Let's get this fix in then.



---

archive/issue_comments_529846.json:
```json
{
    "body": "Upstream: **Fixed upstream, but not in a stable release.**",
    "created_at": "2021-11-09T23:57:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529846",
    "user": "https://github.com/mkoeppe"
}
```

Upstream: **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_529847.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nhttps://github.com/pypa/distutils/pull/65 has been merged",
    "created_at": "2021-11-09T23:57:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529847",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

https://github.com/pypa/distutils/pull/65 has been merged



---

archive/issue_comments_529848.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n... and is included in https://setuptools.pypa.io/en/latest/history.html#v59-0-0 (not yet on PyPI)",
    "created_at": "2021-11-13T18:11:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529848",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

... and is included in https://setuptools.pypa.io/en/latest/history.html#v59-0-0 (not yet on PyPI)



---

archive/issue_comments_529849.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nsetuptools 59.0.1 is out, but it looks like we should wait for 59.1.0 so that we can avoid the `setup_requires` deprecation done in 58.3.0 and reverted in 59.1.0",
    "created_at": "2021-11-15T00:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529849",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

setuptools 59.0.1 is out, but it looks like we should wait for 59.1.0 so that we can avoid the `setup_requires` deprecation done in 58.3.0 and reverted in 59.1.0



---

archive/issue_comments_529850.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8\"><code>078e37b</code></a></td><td><code>build/pkgs/setuptools: Update to 59.1.0, remove patch</code></td></tr></table>\n",
    "created_at": "2021-11-15T02:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8"><code>078e37b</code></a></td><td><code>build/pkgs/setuptools: Update to 59.1.0, remove patch</code></td></tr></table>




---

archive/issue_comments_529851.json:
```json
{
    "body": "Changed commit from **[`a8fe9da`](https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf)** to **[`078e37b`](https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8)**",
    "created_at": "2021-11-15T02:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a8fe9da`](https://github.com/sagemath/sagetrac-mirror/commit/a8fe9da95f28efc4b3bf975a997ce6da05c928bf)** to **[`078e37b`](https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8)**



---

archive/issue_events_448703.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T02:20:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "title_is": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 59.1.0",
    "title_was": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 58.5.3, add patch",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448703"
}
```



---

archive/issue_comments_529852.json:
```json
{
    "body": "Changed upstream from **Fixed upstream, but not in a stable release.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2021-11-15T02:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529852",
    "user": "https://github.com/mkoeppe"
}
```

Changed upstream from **Fixed upstream, but not in a stable release.** to **Fixed upstream, in a later stable release.**



---

archive/issue_comments_529853.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+`pyzmq` fails to build on some platforms. We fix it by \n+- upgrading `setuptools` to a version that includes https://github.com/pypa/distutils/pull/65 \n+- correcting the `pyzmq` build configuration\n+\n+We also upgrade `pyzmq` and `zeromq` to the latest versions.\n+\n+\n For example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)\n \n ```\n``````\n",
    "created_at": "2021-11-15T02:22:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529853",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
+`pyzmq` fails to build on some platforms. We fix it by 
+- upgrading `setuptools` to a version that includes https://github.com/pypa/distutils/pull/65 
+- correcting the `pyzmq` build configuration
+
+We also upgrade `pyzmq` and `zeromq` to the latest versions.
+
+
 For example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)
 
 ```
``````




---

archive/issue_comments_529854.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nLet's get this in please",
    "created_at": "2021-11-16T20:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529854",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Let's get this in please



---

archive/issue_comments_529855.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,6 @@\n - correcting the `pyzmq` build configuration\n \n We also upgrade `pyzmq` and `zeromq` to the latest versions.\n-\n \n For example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)\n \n``````\n",
    "created_at": "2021-11-18T19:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529855",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,6 @@
 - correcting the `pyzmq` build configuration
 
 We also upgrade `pyzmq` and `zeromq` to the latest versions.
-
 
 For example on `opensuse-tumbleweed-minimal` (https://github.com/mkoeppe/sage/runs/4085305194?check_suite_focus=true)
 
``````




---

archive/issue_comments_529856.json:
```json
{
    "body": "Changed commit from **[`078e37b`](https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8)** to **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**",
    "created_at": "2021-11-19T05:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529856",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`078e37b`](https://github.com/sagemath/sagetrac-mirror/commit/078e37bbcc8825841a80c9118a1d0598c01d78c8)** to **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**



---

archive/issue_comments_529857.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee4f6b4a5af0122465882f5f42b5b561852756e2\"><code>ee4f6b4</code></a></td><td><code>Merge tag '9.5.beta7' into t/32828/pyzmq__build_errors</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119\"><code>b430bcf</code></a></td><td><code>build/pkgs/setuptools: Update to 59.2.0</code></td></tr></table>\n",
    "created_at": "2021-11-19T05:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529857",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee4f6b4a5af0122465882f5f42b5b561852756e2"><code>ee4f6b4</code></a></td><td><code>Merge tag '9.5.beta7' into t/32828/pyzmq__build_errors</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119"><code>b430bcf</code></a></td><td><code>build/pkgs/setuptools: Update to 59.2.0</code></td></tr></table>




---

archive/issue_events_448704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-19T05:25:35Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "title_is": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 59.2.0",
    "title_was": "pyzmq: Fix build errors; zeromq, pyzmq: Update; setuptools: upgrade to 59.1.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448704"
}
```



---

archive/issue_events_448705.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-19T11:00:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448705"
}
```



---

archive/issue_events_448706.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-19T11:00:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448706"
}
```



---

archive/issue_comments_529858.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-11-19T11:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529858",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_529859.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nlgtm",
    "created_at": "2021-11-19T11:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529859",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

lgtm



---

archive/issue_comments_529860.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThanks!",
    "created_at": "2021-11-19T17:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529860",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

Thanks!



---

archive/issue_comments_529861.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nWorks for me on void linux using musl libc which used to fail (I was carrying a different patch before; I've replaced that patch by the changes in this ticket and it works).",
    "created_at": "2021-11-22T18:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529861",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:44" align="right">comment:44</div>

Works for me on void linux using musl libc which used to fail (I was carrying a different patch before; I've replaced that patch by the changes in this ticket and it works).



---

archive/issue_comments_529862.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThanks for testing!",
    "created_at": "2021-11-22T18:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529862",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Thanks for testing!



---

archive/issue_events_448707.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-05T11:15:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448707"
}
```



---

archive/issue_events_448708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e12c3ecc709192dfa92b5054def22507c3509f07",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-12-05T11:15:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32828#event-448708"
}
```



---

archive/issue_comments_529863.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/pyzmq__build_errors](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pyzmq__build_errors)** to **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**",
    "created_at": "2021-12-05T11:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529863",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/pyzmq__build_errors](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pyzmq__build_errors)** to **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)**



---

archive/issue_comments_529864.json:
```json
{
    "body": "Changed commit from **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)** to none",
    "created_at": "2021-12-21T19:09:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529864",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`b430bcf`](https://github.com/sagemath/sagetrac-mirror/commit/b430bcf4c46c4822a0b248db307565dd2c814119)** to none



---

archive/issue_comments_529865.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nFollow-ups in #32944, #33059",
    "created_at": "2021-12-21T19:09:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32828#issuecomment-529865",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

Follow-ups in #32944, #33059
