# Issue 32798: Clean the use of weights in generic_graph.py - part 1

archive/issues_032561.json:
```json
{
    "body": "part of #13112 and follow-up of #32723.\n\nHere we clean methods:\n- `min_spanning_tree`\n- `minimum_cycle_basis`\n- `pagerank`\n\n\nReviewer: Vincent Delecroix\n\nAuthor: David Coudert\n\nBranch: b1212d999e418919231ea175075dd0c277b9d14a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32798\n\n",
    "closed_at": "2022-01-31T23:31:17Z",
    "created_at": "2021-10-30T10:27:25Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Clean the use of weights in generic_graph.py - part 1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32798",
    "user": "https://github.com/dcoudert"
}
```
part of #13112 and follow-up of #32723.

Here we clean methods:
- `min_spanning_tree`
- `minimum_cycle_basis`
- `pagerank`


Reviewer: Vincent Delecroix

Author: David Coudert

Branch: b1212d999e418919231ea175075dd0c277b9d14a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32798





---

archive/issue_comments_463984.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-10-30T10:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463984",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_463985.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-30T10:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463985",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463986.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-30T10:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463986",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463987.json:
```json
{
    "body": "<a id='comment:4'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463987",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_086765.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32798#event-86765"
}
```



---

archive/issue_comments_463988.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-30T11:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463988",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463989.json:
```json
{
    "body": "<a id='comment:5'></a>Beyond the scope of this ticket, but why the doctest\n\n```\ng.min_spanning_tree(algorith=\"XXX\")\nTraceback (most recent call last):\n...\nValueError: the weight function cannot find the weight of (1, 2, 'a')\n```\nis repeated that many times. The check for the weight is among the first operations done in the function. It is neither helpful for the user nor to actually test the code.",
    "created_at": "2021-12-30T11:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463989",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Beyond the scope of this ticket, but why the doctest

```
g.min_spanning_tree(algorith="XXX")
Traceback (most recent call last):
...
ValueError: the weight function cannot find the weight of (1, 2, 'a')
```
is repeated that many times. The check for the weight is among the first operations done in the function. It is neither helpful for the user nor to actually test the code.



---

archive/issue_comments_463990.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2021-12-30T11:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463990",
    "user": "https://github.com/videlec"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_463991.json:
```json
{
    "body": "<a id='comment:6'></a>Not sure it is beyond the scope : there was no check in that function before, right ?",
    "created_at": "2021-12-30T11:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463991",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Not sure it is beyond the scope : there was no check in that function before, right ?



---

archive/issue_comments_463992.json:
```json
{
    "body": "<a id='comment:7'></a>Namely the checked before should have happened inside `sage.graphs.spanning_tree.kruskal`, `sage.graphs.spanning_tree.filter_kruskal`, `sage.graphs.spanning_tree.baruvka`, etc. Maybe these functions could assume the weight function is clean?",
    "created_at": "2021-12-30T11:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463992",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Namely the checked before should have happened inside `sage.graphs.spanning_tree.kruskal`, `sage.graphs.spanning_tree.filter_kruskal`, `sage.graphs.spanning_tree.baruvka`, etc. Maybe these functions could assume the weight function is clean?



---

archive/issue_comments_463993.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2021-12-30T11:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463993",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_463994.json:
```json
{
    "body": "<a id='comment:8'></a>Actually, once we get the weight function in `min_spanning_tree`, we don't need to check weights anymore, so we can set the parameter to `False` (which is default) in the calls to `sage.graphs.spanning_tree.kruskal`...",
    "created_at": "2021-12-30T11:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463994",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>Actually, once we get the weight function in `min_spanning_tree`, we don't need to check weights anymore, so we can set the parameter to `False` (which is default) in the calls to `sage.graphs.spanning_tree.kruskal`...



---

archive/issue_comments_463995.json:
```json
{
    "body": "<a id='comment:9'></a>and it's already the case, so we check the weights only once, in `min_spanning_tree`.\n\nSo we can simplify the tests to let only\n\n```\n            sage: g = Graph([(0, 1, 1), (1, 2, 'a')], weighted=True)\n            sage: g.min_spanning_tree()\n            Traceback (most recent call last):\n            ...\n            ValueError: the weight function cannot find the weight of (1, 2, 'a')\n```\nand\n\n```\n            sage: g = Graph([(0, 1, 1), (1, 2, [1, 2, 3])], weighted=True)\n\n            sage: g.min_spanning_tree()\n            Traceback (most recent call last):\n            ...\n            ValueError: the weight function cannot find the weight of (1, 2, [1, 2, 3])\n```\nI'll do it in this ticket if you agree.",
    "created_at": "2021-12-30T11:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463995",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:9'></a>and it's already the case, so we check the weights only once, in `min_spanning_tree`.

So we can simplify the tests to let only

```
            sage: g = Graph([(0, 1, 1), (1, 2, 'a')], weighted=True)
            sage: g.min_spanning_tree()
            Traceback (most recent call last):
            ...
            ValueError: the weight function cannot find the weight of (1, 2, 'a')
```
and

```
            sage: g = Graph([(0, 1, 1), (1, 2, [1, 2, 3])], weighted=True)

            sage: g.min_spanning_tree()
            Traceback (most recent call last):
            ...
            ValueError: the weight function cannot find the weight of (1, 2, [1, 2, 3])
```
I'll do it in this ticket if you agree.



---

archive/issue_comments_463996.json:
```json
{
    "body": "<a id='comment:10'></a>Sounds good to me.",
    "created_at": "2021-12-30T11:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463996",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Sounds good to me.



---

archive/issue_comments_463997.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-30T11:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463998.json:
```json
{
    "body": "<a id='comment:12'></a>It's good to remove useless doctests.",
    "created_at": "2021-12-30T11:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463998",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>It's good to remove useless doctests.



---

archive/issue_comments_463999.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-30T11:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-463999",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464000.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-30T11:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-464000",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464001.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-31T23:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-464001",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086766.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-31T23:31:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32798#event-86766"
}
```



---

archive/issue_comments_464002.json:
```json
{
    "body": "<a id='comment:15'></a>By reordering the keyword arguments of `min_spanning_tree()`, these changes break calls like `g.min_spanning_tree(my_weight_function)` that might be present in user code. Is there a strong reason for doing so (without a deprecation period)? If there is, how about making the arguments keyword-only?",
    "created_at": "2022-02-18T08:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-464002",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:15'></a>By reordering the keyword arguments of `min_spanning_tree()`, these changes break calls like `g.min_spanning_tree(my_weight_function)` that might be present in user code. Is there a strong reason for doing so (without a deprecation period)? If there is, how about making the arguments keyword-only?



---

archive/issue_comments_464003.json:
```json
{
    "body": "<a id='comment:16'></a>I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.",
    "created_at": "2022-02-18T08:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-464003",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:16'></a>I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.



---

archive/issue_comments_464004.json:
```json
{
    "body": "<a id='comment:17'></a>(Sorry for the delay, I missed your reply.)\n\nReplying to [comment:16 dcoudert]:\n> I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.\n\n\nWell, if the change was accidental, yes, I think it would be better to go back to the old ordering in order to avoid breaking user code!",
    "created_at": "2022-03-01T09:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32798#issuecomment-464004",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:17'></a>(Sorry for the delay, I missed your reply.)

Replying to [comment:16 dcoudert]:
> I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.


Well, if the change was accidental, yes, I think it would be better to go back to the old ordering in order to avoid breaking user code!
