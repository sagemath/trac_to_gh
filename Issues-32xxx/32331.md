# Issue 32331: refresh sage-fixdoctests using argparse

archive/issues_032094.json:
```json
{
    "assignees": [],
    "body": "see also #31366 and #32332\n\nalso full flake8 cleanup of the modified file\n\nCC:  @tscrim @slel @kliem\n\nBranch/Commit: **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **scripts**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32331_\n\n",
    "closed_at": "2021-09-05T21:38:30Z",
    "created_at": "2021-08-03T19:14:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "refresh sage-fixdoctests using argparse",
    "type": "issue",
    "updated_at": "2021-09-05T21:38:30Z",
    "url": "https://github.com/sagemath/sage/issues/32331",
    "user": "https://github.com/fchapoton"
}
```
see also #31366 and #32332

also full flake8 cleanup of the modified file

CC:  @tscrim @slel @kliem

Branch/Commit: **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**

Reviewer: **Travis Scrimshaw**

Author: **Frédéric Chapoton**

Component: **scripts**

_Issue created by migration from https://trac.sagemath.org/ticket/32331_





---

archive/issue_events_445984.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-08-03T19:14:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445984"
}
```



---

archive/issue_events_445985.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-08-03T19:14:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "000080",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445985"
}
```



---

archive/issue_events_445986.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-08-03T19:14:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445986"
}
```



---

archive/issue_events_445987.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-08-03T19:14:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445987"
}
```



---

archive/issue_comments_520986.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21\">7f4b0c0</a></td><td><code>refresh sage-fixdoctests using argparse</code></td></tr></table>\n",
    "created_at": "2021-08-03T19:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520986",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21">7f4b0c0</a></td><td><code>refresh sage-fixdoctests using argparse</code></td></tr></table>




---

archive/issue_events_445988.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-08-03T19:15:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445988"
}
```



---

archive/issue_comments_520987.json:
```json
{
    "body": "Branch: **[u/chapoton/32331](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/32331)**",
    "created_at": "2021-08-03T19:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520987",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/32331](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/32331)**



---

archive/issue_comments_520988.json:
```json
{
    "body": "Commit: **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**",
    "created_at": "2021-08-03T19:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520988",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**



---

archive/issue_comments_520989.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-part of #31366\n+see also #31366 and #32332\n \n also full flake8 cleanup of the modified file\n``````\n",
    "created_at": "2021-08-04T07:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520989",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-part of #31366
+see also #31366 and #32332
 
 also full flake8 cleanup of the modified file
``````




---

archive/issue_comments_520990.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-08-05T05:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520990",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_520991.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOne thing that could be considered a regression is that if I do something like\n\n```\n./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py\n```\nthen I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.",
    "created_at": "2021-08-05T05:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520991",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

One thing that could be considered a regression is that if I do something like

```
./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py
```
then I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.



---

archive/issue_comments_520992.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nok, I see.\n\nWe could introduce an option `-o, --output` and try to handle multiple input files.\n\nOr stay with the principle that this is to fix just one single file ?",
    "created_at": "2021-08-05T06:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520992",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

ok, I see.

We could introduce an option `-o, --output` and try to handle multiple input files.

Or stay with the principle that this is to fix just one single file ?



---

archive/issue_comments_520993.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.",
    "created_at": "2021-08-05T13:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520993",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

I think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.



---

archive/issue_comments_520994.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI do not see how to distinguish between the incorrect use\n\n```\nsage --fixdoctests a.py b.py\n```\nwhere the intention is to fix both a.py and b.py inplace ; and the correct use\n\n```\nsage --fixdoctests a.py b.py\n```\nwhere the intention is to write a corrected copy of a.py in b.py.\n\nIn the second case, it could very well be that b.py is existing already, as in the first case.\n\nI think one can reasonably keep the current behaviour, which is indeed documented.",
    "created_at": "2021-08-05T14:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520994",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

I do not see how to distinguish between the incorrect use

```
sage --fixdoctests a.py b.py
```
where the intention is to fix both a.py and b.py inplace ; and the correct use

```
sage --fixdoctests a.py b.py
```
where the intention is to write a corrected copy of a.py in b.py.

In the second case, it could very well be that b.py is existing already, as in the first case.

I think one can reasonably keep the current behaviour, which is indeed documented.



---

archive/issue_comments_520995.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like\n\n```\nsage --fixdoctests a.py b.py c.py\n```\nthat `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.",
    "created_at": "2021-08-05T22:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520995",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

I agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like

```
sage --fixdoctests a.py b.py c.py
```
that `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.



---

archive/issue_events_445989.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-08-05T22:28:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445989"
}
```



---

archive/issue_events_445990.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-08-05T22:28:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445990"
}
```



---

archive/issue_events_445991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445991"
}
```



---

archive/issue_events_445992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445992"
}
```



---

archive/issue_comments_520996.json:
```json
{
    "body": "Changed branch from **[u/chapoton/32331](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/32331)** to **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**",
    "created_at": "2021-09-05T21:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32331#issuecomment-520996",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/32331](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/32331)** to **[`7f4b0c0`](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)**



---

archive/issue_events_445993.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-05T21:38:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445993"
}
```



---

archive/issue_events_445994.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fbde9cd1dccdf6b579a67ae013b20aae29b8289a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-09-05T21:38:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32331",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32331#event-445994"
}
```
