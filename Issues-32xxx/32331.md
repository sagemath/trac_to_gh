# Issue 32331: refresh sage-fixdoctests using argparse

archive/issues_032094.json:
```json
{
    "body": "see also #31366 and #32332\n\nalso full flake8 cleanup of the modified file\n\nCC:  @tscrim @slel @kliem\n\nBranch/Commit: 7f4b0c0d4d422358559ee65fcc3fb46789b24a21\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32331\n\n",
    "closed_at": "2021-09-05T21:38:30Z",
    "created_at": "2021-08-03T19:14:00Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "refresh sage-fixdoctests using argparse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32331",
    "user": "https://github.com/fchapoton"
}
```
see also #31366 and #32332

also full flake8 cleanup of the modified file

CC:  @tscrim @slel @kliem

Branch/Commit: 7f4b0c0d4d422358559ee65fcc3fb46789b24a21

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32331





---

archive/issue_comments_635739.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[7f4b0c0](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)|`refresh sage-fixdoctests using argparse`|",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635739",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[7f4b0c0](https://github.com/sagemath/sagetrac-mirror/commit/7f4b0c0d4d422358559ee65fcc3fb46789b24a21)|`refresh sage-fixdoctests using argparse`|



---

archive/issue_comments_635740.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635740",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_635741.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/32331\"",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635741",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/32331"



---

archive/issue_comments_635742.json:
```json
{
    "body": "Changing commit from \"\" to \"7f4b0c0d4d422358559ee65fcc3fb46789b24a21\"",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635742",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "7f4b0c0d4d422358559ee65fcc3fb46789b24a21"



---

archive/issue_comments_635743.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-part of #31366\n+see also #31366 and #32332\n \n also full flake8 cleanup of the modified file\n``````\n",
    "created_at": "2021-08-04T07:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635743",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-part of #31366
+see also #31366 and #32332
 
 also full flake8 cleanup of the modified file
``````




---

archive/issue_comments_635744.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-08-05T05:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635744",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_635745.json:
```json
{
    "body": "<a id='comment:4'></a>\nOne thing that could be considered a regression is that if I do something like\n\n```\n./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py\n```\nthen I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.",
    "created_at": "2021-08-05T05:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635745",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
One thing that could be considered a regression is that if I do something like

```
./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py
```
then I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.



---

archive/issue_comments_635746.json:
```json
{
    "body": "<a id='comment:5'></a>\nok, I see.\n\nWe could introduce an option `-o, --output` and try to handle multiple input files.\n\nOr stay with the principle that this is to fix just one single file ?",
    "created_at": "2021-08-05T06:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635746",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
ok, I see.

We could introduce an option `-o, --output` and try to handle multiple input files.

Or stay with the principle that this is to fix just one single file ?



---

archive/issue_comments_635747.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.",
    "created_at": "2021-08-05T13:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635747",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
I think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.



---

archive/issue_comments_635748.json:
```json
{
    "body": "<a id='comment:7'></a>\nI do not see how to distinguish between the incorrect use\n\n```\nsage --fixdoctests a.py b.py\n```\nwhere the intention is to fix both a.py and b.py inplace ; and the correct use\n\n```\nsage --fixdoctests a.py b.py\n```\nwhere the intention is to write a corrected copy of a.py in b.py.\n\nIn the second case, it could very well be that b.py is existing already, as in the first case.\n\nI think one can reasonably keep the current behaviour, which is indeed documented.",
    "created_at": "2021-08-05T14:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635748",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
I do not see how to distinguish between the incorrect use

```
sage --fixdoctests a.py b.py
```
where the intention is to fix both a.py and b.py inplace ; and the correct use

```
sage --fixdoctests a.py b.py
```
where the intention is to write a corrected copy of a.py in b.py.

In the second case, it could very well be that b.py is existing already, as in the first case.

I think one can reasonably keep the current behaviour, which is indeed documented.



---

archive/issue_comments_635749.json:
```json
{
    "body": "<a id='comment:8'></a>\nI agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like\n\n```\nsage --fixdoctests a.py b.py c.py\n```\nthat `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.",
    "created_at": "2021-08-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635749",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
I agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like

```
sage --fixdoctests a.py b.py c.py
```
that `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.



---

archive/issue_comments_635750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635750",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_104357.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32331#event-104357"
}
```



---

archive/issue_comments_635751.json:
```json
{
    "body": "Changing branch from \"u/chapoton/32331\" to \"7f4b0c0d4d422358559ee65fcc3fb46789b24a21\"",
    "created_at": "2021-09-05T21:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635751",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/32331" to "7f4b0c0d4d422358559ee65fcc3fb46789b24a21"



---

archive/issue_comments_635752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-05T21:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32331#issuecomment-635752",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_104358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-05T21:38:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32331",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32331#event-104358"
}
```
