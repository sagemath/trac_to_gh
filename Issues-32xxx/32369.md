# Issue 32369: Rewrite Clifford and exterior algebras to have a basis indexed by integers

archive/issues_032132.json:
```json
{
    "body": "Integers are a more compact way of representing subsets with their bits. This should both decrease the memory usage to store elements and the speed due to using bit operations and nearly trivial hashing.\n\nAssignee: @trevorkarn\n\nCC:  @tscrim @trevorkarn\n\nKeywords: gsoc2022 exterior algebra index integer\n\nBranch/Commit: 263775068531d6d9083d7f81bdbda560e28d72d7\n\nReviewer: Travis Scrimshaw\n\nAuthor: Trevor K. Karn\n\nDependencies: #34035 #34084\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32369\n\n",
    "closed_at": "2022-08-29T11:24:09Z",
    "created_at": "2021-08-12T10:02:02Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Rewrite Clifford and exterior algebras to have a basis indexed by integers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32369",
    "user": "https://github.com/tscrim"
}
```
Integers are a more compact way of representing subsets with their bits. This should both decrease the memory usage to store elements and the speed due to using bit operations and nearly trivial hashing.

Assignee: @trevorkarn

CC:  @tscrim @trevorkarn

Keywords: gsoc2022 exterior algebra index integer

Branch/Commit: 263775068531d6d9083d7f81bdbda560e28d72d7

Reviewer: Travis Scrimshaw

Author: Trevor K. Karn

Dependencies: #34035 #34084

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32369





---

archive/issue_events_085904.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32369#event-85904"
}
```



---

archive/issue_events_085905.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32369#event-85905"
}
```



---

archive/issue_events_085906.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32369#event-85906"
}
```



---

archive/issue_comments_489944.json:
```json
{
    "body": "Set assignee to @trevorkarn.",
    "created_at": "2022-06-13T11:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489944",
    "user": "https://github.com/trevorkarn"
}
```

Set assignee to @trevorkarn.



---

archive/issue_comments_489945.json:
```json
{
    "body": "Changing keywords from \"\" to \"gsoc2022 exterior algebra index integer\".",
    "created_at": "2022-06-13T19:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489945",
    "user": "https://github.com/trevorkarn"
}
```

Changing keywords from "" to "gsoc2022 exterior algebra index integer".



---

archive/issue_comments_489946.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-14T23:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489947.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2022-06-21T12:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489947",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_489948.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T17:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489949.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T18:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489950.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-22T20:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489951.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-23T20:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489952.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-24T14:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489953.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-06-26T03:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_489954.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-28T14:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489955.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-03T18:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489955",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489956.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-05T14:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489957.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-05T22:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489958.json:
```json
{
    "body": "<a id='comment:22'></a>Associativity is broken...\n\n```\nsage: E.<a,b,c> = ExteriorAlgebra(QQ)\nsage: b.__mul__(c*a)\na*b*c\nsage: (b*c).__mul__(a)\n-a*b*c\n```",
    "created_at": "2022-07-05T23:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489958",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:22'></a>Associativity is broken...

```
sage: E.<a,b,c> = ExteriorAlgebra(QQ)
sage: b.__mul__(c*a)
a*b*c
sage: (b*c).__mul__(a)
-a*b*c
```



---

archive/issue_comments_489959.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-08T14:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489960.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-08T14:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489961.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T01:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-23T01:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489962",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_489963.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-25T14:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489963",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_489964.json:
```json
{
    "body": "<a id='comment:27'></a>There was a merge issue.",
    "created_at": "2022-07-25T14:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489964",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:27'></a>There was a merge issue.



---

archive/issue_comments_489965.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-25T15:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_489966.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-25T15:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_489967.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T15:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489968.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T15:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489969.json:
```json
{
    "body": "<a id='comment:32'></a>It looks like part of the merge problem was that I was on 9.7.beta2, and there was a change in 9.7.beta5 or beta6 that touched `clifford_algebra.py`. I rebased off of 9.7.beta6 with `-X theirs` and going to test.",
    "created_at": "2022-07-25T17:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489969",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:32'></a>It looks like part of the merge problem was that I was on 9.7.beta2, and there was a change in 9.7.beta5 or beta6 that touched `clifford_algebra.py`. I rebased off of 9.7.beta6 with `-X theirs` and going to test.



---

archive/issue_comments_489970.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-25T19:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489970",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_489971.json:
```json
{
    "body": "<a id='comment:34'></a>Merge issue seems to be fixed -- all tests pass.",
    "created_at": "2022-07-25T19:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489971",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:34'></a>Merge issue seems to be fixed -- all tests pass.



---

archive/issue_comments_489972.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-25T19:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489972",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_489973.json:
```json
{
    "body": "<a id='comment:36'></a>This is faster for hashing and equality testing, which are two of the big things I wanted to speed up since the element implementation is using `dict`s:\n\n```\nsage: t = (1,3,6,7,9,13)\nsage: X = FrozenBitset(t)\nsage: X\n01010011010001\nsage: %timeit hash(t)\n61.4 ns \u00b1 1.09 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000,000 loops each)\nsage: %timeit hash(X)\n33.6 ns \u00b1 0.354 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000,000 loops each)\n\nsage: s = tuple(list(t))\nsage: Y = FrozenBitset(s)\nsage: s is t\nFalse\nsage: Y is X\nFalse\nsage: %timeit s == t\n28.3 ns \u00b1 0.381 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000,000 loops each)\nsage: %timeit X == Y\n20.2 ns \u00b1 0.215 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000,000 loops each)\n```\n\nI made a number of small reviewer changes. If they are good with you, then this is a positive review.\n\n---\nNew commits:",
    "created_at": "2022-08-02T05:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489973",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>This is faster for hashing and equality testing, which are two of the big things I wanted to speed up since the element implementation is using `dict`s:

```
sage: t = (1,3,6,7,9,13)
sage: X = FrozenBitset(t)
sage: X
01010011010001
sage: %timeit hash(t)
61.4 ns ± 1.09 ns per loop (mean ± std. dev. of 7 runs, 10,000,000 loops each)
sage: %timeit hash(X)
33.6 ns ± 0.354 ns per loop (mean ± std. dev. of 7 runs, 10,000,000 loops each)

sage: s = tuple(list(t))
sage: Y = FrozenBitset(s)
sage: s is t
False
sage: Y is X
False
sage: %timeit s == t
28.3 ns ± 0.381 ns per loop (mean ± std. dev. of 7 runs, 10,000,000 loops each)
sage: %timeit X == Y
20.2 ns ± 0.215 ns per loop (mean ± std. dev. of 7 runs, 100,000,000 loops each)
```

I made a number of small reviewer changes. If they are good with you, then this is a positive review.

---
New commits:



---

archive/issue_comments_489974.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-08T00:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489974",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489975.json:
```json
{
    "body": "<a id='comment:38'></a>This should now pass all the doctests. The indexing set should be a `UniqueRepresentation`, which fixes an issue with comparisons. I had to make a few tweaks to how elements were being constructed. I also made the `E.basis().keys().an_element()` behave as before.\n\nSome simple timings for multiplication:\n\n```\nsage: E.<a,b,c,d> = ExteriorAlgebra(QQ)\nsage: r = E.an_element(); r\nb*c + 2*a + 3*b + 1\nsage: %timeit r * r\n10.9 \u00b5s \u00b1 46.7 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops each)\nsage: r = sum(E.basis())\nsage: %timeit r * r\n99 \u00b5s \u00b1 438 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n\nsage: E = ExteriorAlgebra(QQ, 'x', 10)\nsage: r = sum(E.basis())\nsage: %timeit r * r\n179 ms \u00b1 939 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\nversus before\n\n```\n11.1 \u00b5s \u00b1 42.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops \n139 \u00b5s \u00b1 271 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n\n931 ms \u00b1 5.76 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\nSo we are seeing substantial gains when multiplying larger elements. With the Cythonization of #34138, this then becomes\n\n```\n8.05 \u00b5s \u00b1 91.9 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops each)\n73.4 \u00b5s \u00b1 631 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n\n129 ms \u00b1 1.04 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\nIs it easy to run timings for these computations in M2?",
    "created_at": "2022-08-08T01:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489975",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>This should now pass all the doctests. The indexing set should be a `UniqueRepresentation`, which fixes an issue with comparisons. I had to make a few tweaks to how elements were being constructed. I also made the `E.basis().keys().an_element()` behave as before.

Some simple timings for multiplication:

```
sage: E.<a,b,c,d> = ExteriorAlgebra(QQ)
sage: r = E.an_element(); r
b*c + 2*a + 3*b + 1
sage: %timeit r * r
10.9 µs ± 46.7 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)
sage: r = sum(E.basis())
sage: %timeit r * r
99 µs ± 438 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)

sage: E = ExteriorAlgebra(QQ, 'x', 10)
sage: r = sum(E.basis())
sage: %timeit r * r
179 ms ± 939 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```
versus before

```
11.1 µs ± 42.2 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops 
139 µs ± 271 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)

931 ms ± 5.76 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```
So we are seeing substantial gains when multiplying larger elements. With the Cythonization of #34138, this then becomes

```
8.05 µs ± 91.9 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)
73.4 µs ± 631 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)

129 ms ± 1.04 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
```
Is it easy to run timings for these computations in M2?



---

archive/issue_comments_489976.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-08T05:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489977.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:38 tscrim]:\n> Is it easy to run timings for these computations in M2?\n\n\nHere you go:\n\n```\ni1 : E = QQ[a..d, SkewCommutative=>true]\n\no1 = E\n\no1 : PolynomialRing, 4 skew commutative variables\n\ni2 : r = b*c + 2*a + 3*b + 1;\n\ni3 : time r*r;\n     -- used 0.000222222 seconds\n\ni4 : r = sum(flatten(entries(basis E)));\n\ni5 : r\n\no5 = a*b*c*d + a*b*c + a*b*d + a*c*d + b*c*d + a*b + a*c + b*c + a*d + b*d + c*d + a + b + c + d + 1\n\no5 : E\n\ni6 : time r*r;\n     -- used 0.00095186 seconds\n\ni7 : E = QQ[x_1..x_10, SkewCommutative=>true]\n\no7 = E\n\no7 : PolynomialRing, 10 skew commutative variables\n\ni8 : r = sum(flatten(entries(basis E)));\n\ni9 : time r*r;\n     -- used 0.315753 seconds\n```",
    "created_at": "2022-08-08T15:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489977",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:40'></a>Replying to [comment:38 tscrim]:
> Is it easy to run timings for these computations in M2?


Here you go:

```
i1 : E = QQ[a..d, SkewCommutative=>true]

o1 = E

o1 : PolynomialRing, 4 skew commutative variables

i2 : r = b*c + 2*a + 3*b + 1;

i3 : time r*r;
     -- used 0.000222222 seconds

i4 : r = sum(flatten(entries(basis E)));

i5 : r

o5 = a*b*c*d + a*b*c + a*b*d + a*c*d + b*c*d + a*b + a*c + b*c + a*d + b*d + c*d + a + b + c + d + 1

o5 : E

i6 : time r*r;
     -- used 0.00095186 seconds

i7 : E = QQ[x_1..x_10, SkewCommutative=>true]

o7 = E

o7 : PolynomialRing, 10 skew commutative variables

i8 : r = sum(flatten(entries(basis E)));

i9 : time r*r;
     -- used 0.315753 seconds
```



---

archive/issue_comments_489978.json:
```json
{
    "body": "<a id='comment:41'></a>Your machine is better than mine, so I'm including the same timings on my machine so the comparison to M2 is more apples-to-apples.\n\n```\nsage: E.<a,b,c,d> = ExteriorAlgebra(QQ)\nsage: r = E.an_element(); r\nb*c + 2*a + 3*b + 1\nsage: %timeit r * r\n32.2 \u00b5s \u00b1 2.49 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: r = sum(E.basis())\nsage: %timeit r * r\n274 \u00b5s \u00b1 9.02 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n\nsage: E = ExteriorAlgebra(QQ, 'x', 10)\nsage: r = sum(E.basis())\nsage: %timeit r * r\n514 ms \u00b1 8.92 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```",
    "created_at": "2022-08-08T20:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489978",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:41'></a>Your machine is better than mine, so I'm including the same timings on my machine so the comparison to M2 is more apples-to-apples.

```
sage: E.<a,b,c,d> = ExteriorAlgebra(QQ)
sage: r = E.an_element(); r
b*c + 2*a + 3*b + 1
sage: %timeit r * r
32.2 µs ± 2.49 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: r = sum(E.basis())
sage: %timeit r * r
274 µs ± 9.02 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

sage: E = ExteriorAlgebra(QQ, 'x', 10)
sage: r = sum(E.basis())
sage: %timeit r * r
514 ms ± 8.92 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```



---

archive/issue_comments_489979.json:
```json
{
    "body": "<a id='comment:42'></a>Interesting...Sage is faster on small examples but slower (almost 2x) on larger examples. I would have expected something far more uniform.",
    "created_at": "2022-08-08T23:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489979",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Interesting...Sage is faster on small examples but slower (almost 2x) on larger examples. I would have expected something far more uniform.



---

archive/issue_comments_489980.json:
```json
{
    "body": "<a id='comment:43'></a>Patchbot is (morally) green. So if my review changes are good, then I think we are at a positive review.",
    "created_at": "2022-08-09T03:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489980",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>Patchbot is (morally) green. So if my review changes are good, then I think we are at a positive review.



---

archive/issue_comments_489981.json:
```json
{
    "body": "<a id='comment:44'></a>Changes look good to me!\n\nReplying to [comment:43 tscrim]:\n> Patchbot is (morally) green. So if my review changes are good, then I think we are at a positive review.",
    "created_at": "2022-08-10T00:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489981",
    "user": "https://github.com/trevorkarn"
}
```

<a id='comment:44'></a>Changes look good to me!

Replying to [comment:43 tscrim]:
> Patchbot is (morally) green. So if my review changes are good, then I think we are at a positive review.



---

archive/issue_comments_489982.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-10T00:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489982",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_489983.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-29T11:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32369#issuecomment-489983",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_085907.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-29T11:24:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32369",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32369#event-85907"
}
```
