# Issue 32986: sage.misc.temporary_file: Move SAGE_TMP implementation here

archive/issues_032749.json:
```json
{
    "assignees": [],
    "body": "We move the code for creating the temporary directory to  `sage.misc.temporary_file`, removing the dependency on `sage.misc.misc` and `sage.misc.lazy_string`.\n\nThis is preparation for #29941, allowing us to keep `sage.misc.misc` out of **sagemath-objects** and **sagemath-repl**;  `sage.misc.temporary_file` goes into **sagemath-environment**.\n\n\nCC:  @orlitzky @kiwifb\n\nBranch/Commit: **[u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here) @ [8c4d015](https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32986_\n\n",
    "closed_at": "2022-07-08T14:13:41Z",
    "created_at": "2021-12-06T20:26:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/duplicate",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/refactoring"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.misc.temporary_file: Move SAGE_TMP implementation here",
    "type": "issue",
    "updated_at": "2022-07-08T14:13:41Z",
    "url": "https://github.com/sagemath/sage/issues/32986",
    "user": "https://github.com/mkoeppe"
}
```
We move the code for creating the temporary directory to  `sage.misc.temporary_file`, removing the dependency on `sage.misc.misc` and `sage.misc.lazy_string`.

This is preparation for #29941, allowing us to keep `sage.misc.misc` out of **sagemath-objects** and **sagemath-repl**;  `sage.misc.temporary_file` goes into **sagemath-environment**.


CC:  @orlitzky @kiwifb

Branch/Commit: **[u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here) @ [8c4d015](https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb)**

_Issue created by migration from https://trac.sagemath.org/ticket/32986_





---

archive/issue_events_435640.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T20:26:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435640"
}
```



---

archive/issue_events_435641.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T20:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/refactoring",
    "label_color": "696969",
    "label_name": "refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435641"
}
```



---

archive/issue_events_435642.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T20:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435642"
}
```



---

archive/issue_events_435643.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T20:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435643"
}
```



---

archive/issue_comments_535772.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here)**",
    "created_at": "2021-12-06T21:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535772",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_misc_temporary_file__move_sage_tmp_implementation_here)**



---

archive/issue_comments_535773.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6\">81d0fff</a></td><td><code>sage.misc.temporary_file: Move SAGE_TMP implementation here</code></td></tr></table>\n",
    "created_at": "2021-12-07T00:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535773",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6">81d0fff</a></td><td><code>sage.misc.temporary_file: Move SAGE_TMP implementation here</code></td></tr></table>




---

archive/issue_comments_535774.json:
```json
{
    "body": "Commit: **[81d0fff](https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6)**",
    "created_at": "2021-12-07T00:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535774",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[81d0fff](https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6)**



---

archive/issue_comments_535775.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-12-07T00:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535775",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_435644.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-07T00:18:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435644"
}
```



---

archive/issue_comments_535776.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,4 @@\n We move the code for creating the temporary directory to  `sage.misc.temporary_file`, removing the dependency on `sage.misc.misc` and `sage.misc.lazy_string`.\n \n+This is preparation for #29941, allowing us to keep `sage.misc.misc` out of **sagemath-objects** and **sagemath-repl**;  `sage.misc.temporary_file` goes into **sagemath-environment**.\n+\n``````\n",
    "created_at": "2021-12-07T00:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535776",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,4 @@
 We move the code for creating the temporary directory to  `sage.misc.temporary_file`, removing the dependency on `sage.misc.misc` and `sage.misc.lazy_string`.
 
+This is preparation for #29941, allowing us to keep `sage.misc.misc` out of **sagemath-objects** and **sagemath-repl**;  `sage.misc.temporary_file` goes into **sagemath-environment**.
+
``````




---

archive/issue_comments_535777.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI'll need to revise this - `@functools.cache` is py>=3.9",
    "created_at": "2021-12-07T23:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535777",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
I'll need to revise this - `@functools.cache` is py>=3.9



---

archive/issue_events_435645.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-07T23:40:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435645"
}
```



---

archive/issue_events_435646.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-07T23:40:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435646"
}
```



---

archive/issue_comments_535778.json:
```json
{
    "body": "Changed commit from **[81d0fff](https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6)** to **[7e78f59](https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21)**",
    "created_at": "2021-12-07T23:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535778",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[81d0fff](https://github.com/sagemath/sagetrac-mirror/commit/81d0fff79ade95acbbe856dc294df69ef85a3cb6)** to **[7e78f59](https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21)**



---

archive/issue_comments_535779.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21\">7e78f59</a></td><td><code>src/sage/misc/temporary_file.py: Remove use of functools.cache</code></td></tr></table>\n",
    "created_at": "2021-12-07T23:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535779",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21">7e78f59</a></td><td><code>src/sage/misc/temporary_file.py: Remove use of functools.cache</code></td></tr></table>




---

archive/issue_events_435647.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-07T23:54:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435647"
}
```



---

archive/issue_events_435648.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-07T23:54:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435648"
}
```



---

archive/issue_events_435649.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-12-10T13:39:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435649"
}
```



---

archive/issue_events_435650.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-12-10T13:39:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435650"
}
```



---

archive/issue_comments_535780.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nLGTM. Tested through #32987.",
    "created_at": "2021-12-10T13:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535780",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'>Comment 7:</a>
LGTM. Tested through #32987.



---

archive/issue_comments_535781.json:
```json
{
    "body": "Reviewer: **Kwankyu Lee**",
    "created_at": "2021-12-10T13:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535781",
    "user": "https://github.com/kwankyu"
}
```

Reviewer: **Kwankyu Lee**



---

archive/issue_comments_535782.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks!",
    "created_at": "2021-12-10T16:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535782",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks!



---

archive/issue_events_435651.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-12T17:35:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435651"
}
```



---

archive/issue_events_435652.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-12T17:35:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435652"
}
```



---

archive/issue_events_435653.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T23:48:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435653"
}
```



---

archive/issue_events_435654.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-30T23:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435654"
}
```



---

archive/issue_comments_535783.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nWith this ticket I'm seeing a lot of flakiness with maxima-related tests, e.g. \n\n```\nsage -t --long --warn-long 50.7 --random-seed=36889336955867588730901666695941730921 src/sage/interfaces/maxima_abstract.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 314, in sage.interfaces.maxima_abstract.MaximaAbstract._commands\nFailed example:\n    sorted(maxima._commands(verbose=False))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.maxima_abstract.MaximaAbstract._commands[0]>\", line 1, in <module>\n        sorted(maxima._commands(verbose=False))\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 327, in _commands\n        [self.completions(chr(65+n), verbose=verbose)+\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 327, in <listcomp>\n        [self.completions(chr(65+n), verbose=verbose)+\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py\", line 296, in completions\n        cmd_list = self._eval_line('apropos(\"%s\")'%s, error_check=False)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py\", line 814, in _eval_line\n        self._expect_expr(self._display_prompt)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py\", line 731, in _expect_expr\n        i = self._expect.expect(expr)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py\", line 343, in expect\n        return self.expect_list(compiled_pattern_list,\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py\", line 372, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py\", line 179, in expect_loop\n        return self.eof(e)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py\", line 122, in eof\n        raise exc\n    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.\n    Maxima with PID 1795009 running /home/release/Sage/local/bin/maxima -p /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp\n    command: /home/release/Sage/local/bin/maxima\n    args: ['/home/release/Sage/local/bin/maxima', '-p', '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp']\n    buffer (last 100 chars): b''\n    before (last 100 chars): ''\n    after: <class 'pexpect.exceptions.EOF'>\n    match: None\n    match_index: None\n    exitstatus: None\n    flag_eof: True\n    pid: 1795009\n    child_fd: 20\n    closed: False\n    timeout: None\n    delimiter: <class 'pexpect.exceptions.EOF'>\n    logfile: None\n    logfile_read: None\n    logfile_send: None\n    maxread: 4194304\n    ignorecase: False\n    searchwindowsize: None\n    delaybeforesend: None\n    delayafterclose: 0.1\n    delayafterterminate: 0.1\n    searcher: searcher_re:\n        0: re.compile(b'<sage-display>')\n**********************************************************************\n```\nAlways disappears when testing individually, but running multiple maxima-using tests in parallel triggers them quite reliably. E.g.\n\n```\n./sage -t -p 8 --long src/sage/interfaces/maxima_abstract.py src/sage/dynamics/complex_dynamics/mandel_julia.py src/sage/interfaces/maxima.py src/sage/tests/books/computational-mathematics-with-sagemath/sol/mpoly_doctest.py src/sage/coding/kasami_codes.pyx\n\n```",
    "created_at": "2022-01-30T23:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535783",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>Comment 10:</a>
With this ticket I'm seeing a lot of flakiness with maxima-related tests, e.g. 

```
sage -t --long --warn-long 50.7 --random-seed=36889336955867588730901666695941730921 src/sage/interfaces/maxima_abstract.py
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 314, in sage.interfaces.maxima_abstract.MaximaAbstract._commands
Failed example:
    sorted(maxima._commands(verbose=False))
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.maxima_abstract.MaximaAbstract._commands[0]>", line 1, in <module>
        sorted(maxima._commands(verbose=False))
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 327, in _commands
        [self.completions(chr(65+n), verbose=verbose)+
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 327, in <listcomp>
        [self.completions(chr(65+n), verbose=verbose)+
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima_abstract.py", line 296, in completions
        cmd_list = self._eval_line('apropos("%s")'%s, error_check=False)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py", line 814, in _eval_line
        self._expect_expr(self._display_prompt)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/maxima.py", line 731, in _expect_expr
        i = self._expect.expect(expr)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py", line 343, in expect
        return self.expect_list(compiled_pattern_list,
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/spawnbase.py", line 372, in expect_list
        return exp.expect_loop(timeout)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py", line 179, in expect_loop
        return self.eof(e)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pexpect/expect.py", line 122, in eof
        raise exc
    pexpect.exceptions.EOF: End Of File (EOF). Exception style platform.
    Maxima with PID 1795009 running /home/release/Sage/local/bin/maxima -p /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp
    command: /home/release/Sage/local/bin/maxima
    args: ['/home/release/Sage/local/bin/maxima', '-p', '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/interfaces/sage-maxima.lisp']
    buffer (last 100 chars): b''
    before (last 100 chars): ''
    after: <class 'pexpect.exceptions.EOF'>
    match: None
    match_index: None
    exitstatus: None
    flag_eof: True
    pid: 1795009
    child_fd: 20
    closed: False
    timeout: None
    delimiter: <class 'pexpect.exceptions.EOF'>
    logfile: None
    logfile_read: None
    logfile_send: None
    maxread: 4194304
    ignorecase: False
    searchwindowsize: None
    delaybeforesend: None
    delayafterclose: 0.1
    delayafterterminate: 0.1
    searcher: searcher_re:
        0: re.compile(b'<sage-display>')
**********************************************************************
```
Always disappears when testing individually, but running multiple maxima-using tests in parallel triggers them quite reliably. E.g.

```
./sage -t -p 8 --long src/sage/interfaces/maxima_abstract.py src/sage/dynamics/complex_dynamics/mandel_julia.py src/sage/interfaces/maxima.py src/sage/tests/books/computational-mathematics-with-sagemath/sol/mpoly_doctest.py src/sage/coding/kasami_codes.pyx

```



---

archive/issue_comments_535784.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078\">fc509ec</a></td><td><code>Merge tag '9.6.beta0' into t/32986/sage_misc_temporary_file__move_sage_tmp_implementation_here</code></td></tr></table>\n",
    "created_at": "2022-02-06T22:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535784",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078">fc509ec</a></td><td><code>Merge tag '9.6.beta0' into t/32986/sage_misc_temporary_file__move_sage_tmp_implementation_here</code></td></tr></table>




---

archive/issue_comments_535785.json:
```json
{
    "body": "Changed commit from **[7e78f59](https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21)** to **[fc509ec](https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078)**",
    "created_at": "2022-02-06T22:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535785",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7e78f59](https://github.com/sagemath/sagetrac-mirror/commit/7e78f591a9a584e8c5a4b098619fe6865ab0cf21)** to **[fc509ec](https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078)**



---

archive/issue_comments_535786.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nConfirmed the test failures when running in parallel. Not sure what's happening there, help welcome",
    "created_at": "2022-02-13T22:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535786",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
Confirmed the test failures when running in parallel. Not sure what's happening there, help welcome



---

archive/issue_comments_535787.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThe only thing I think could happen, should have been happening before this ticket. You mostly moved code around. May be there was always a potential race condition on the closing of `sage_tmp` and it just got enhanced.",
    "created_at": "2022-02-13T23:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535787",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'>Comment 13:</a>
The only thing I think could happen, should have been happening before this ticket. You mostly moved code around. May be there was always a potential race condition on the closing of `sage_tmp` and it just got enhanced.



---

archive/issue_comments_535788.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nThe diff looks OK to me too, but over the past week or so I've realized that you can't trust anything that goes on in the expect interfaces. Using `lazy_string` adds a layer of unnecessary complexity too; there's no need to encode the PID into the tempfile path.\n\nI'm in the process of removing direct uses of `SAGE_TMP` anyway if you just want to wait. Afterwards it will be trivial to switch `tmp_filename()` and `tmp_dir()`, and `SAGE_TMP` can be removed from the misc module.",
    "created_at": "2022-02-14T00:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535788",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'>Comment 14:</a>
The diff looks OK to me too, but over the past week or so I've realized that you can't trust anything that goes on in the expect interfaces. Using `lazy_string` adds a layer of unnecessary complexity too; there's no need to encode the PID into the tempfile path.

I'm in the process of removing direct uses of `SAGE_TMP` anyway if you just want to wait. Afterwards it will be trivial to switch `tmp_filename()` and `tmp_dir()`, and `SAGE_TMP` can be removed from the misc module.



---

archive/issue_comments_535789.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nColor me unsurprised that I'm seeing random (both non-reproducible, and can't-possibly-be-related-to-anything-I-changed) pexpect failures on #33213 as well.",
    "created_at": "2022-02-16T12:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535789",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'>Comment 15:</a>
Color me unsurprised that I'm seeing random (both non-reproducible, and can't-possibly-be-related-to-anything-I-changed) pexpect failures on #33213 as well.



---

archive/issue_events_435655.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435655"
}
```



---

archive/issue_events_435656.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435656"
}
```



---

archive/issue_comments_535790.json:
```json
{
    "body": "Changed commit from **[fc509ec](https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078)** to **[8c4d015](https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb)**",
    "created_at": "2022-05-01T01:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535790",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fc509ec](https://github.com/sagemath/sagetrac-mirror/commit/fc509ec81066d1bb266ca41222d6105443c45078)** to **[8c4d015](https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb)**



---

archive/issue_comments_535791.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e81b678965074fe74a83bfc5560d7d1da3487c8\">2e81b67</a></td><td><code>sage.misc.temporary_file: Move SAGE_TMP implementation here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb\">8c4d015</a></td><td><code>src/sage/misc/temporary_file.py: Remove use of functools.cache</code></td></tr></table>\n",
    "created_at": "2022-05-01T01:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535791",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e81b678965074fe74a83bfc5560d7d1da3487c8">2e81b67</a></td><td><code>sage.misc.temporary_file: Move SAGE_TMP implementation here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c4d015e002962d2d8b2bf311007855d6a53d6eb">8c4d015</a></td><td><code>src/sage/misc/temporary_file.py: Remove use of functools.cache</code></td></tr></table>




---

archive/issue_events_435657.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-04T18:43:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435657"
}
```



---

archive/issue_events_435658.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-04T18:43:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435658"
}
```



---

archive/issue_comments_535792.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nSuperseded by #33797/#33213",
    "created_at": "2022-05-04T18:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535792",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
Superseded by #33797/#33213



---

archive/issue_comments_535793.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to none",
    "created_at": "2022-05-04T18:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535793",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to none



---

archive/issue_comments_535794.json:
```json
{
    "body": "Changed reviewer from **Kwankyu Lee** to none",
    "created_at": "2022-05-04T18:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32986#issuecomment-535794",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Kwankyu Lee** to none



---

archive/issue_events_435659.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-04T18:43:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435659"
}
```



---

archive/issue_events_435660.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-04T18:43:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435660"
}
```



---

archive/issue_events_435661.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-04T18:43:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435661"
}
```



---

archive/issue_events_435662.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-07-08T14:13:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435662"
}
```



---

archive/issue_events_435663.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-07-08T14:13:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435663"
}
```



---

archive/issue_events_435664.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-07-08T14:13:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32986",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32986#event-435664"
}
```
