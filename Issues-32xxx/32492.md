# Issue 32492: sage-pip-install: Try installing without --no-deps first

archive/issues_032255.json:
```json
{
    "assignees": [],
    "body": "We currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.\n\nIn order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index` (we also throw in a `--no-cache` in this ticket), it will not actually attempt to install from PyPI but fail with an error.\nWe then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).\n\n(Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))\n\nWe also pass `--ignore-requires-python` in the wheel-building phase and in the retry. This simplifies the Python 3.10 preparation and is otherwise harmless.\n\n\nTo test: \n\n```\neval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492\nmake build \ngrep -B2 -r \"Warning.*try.*no-deps\" logs/pkgs\n```\n(this will rebuild all Python packages in a new venv)\n\n\nIn particular highly parallel builds reveal a few missing dependencies -- but there should be no new errors.\n\nFixing the dependencies will be done in follow-up ticket #32493, not here.\n\n\nDepends on #29847\nDepends on #32361\n\nCC:  @dimpase @seblabbe @jhpalmieri\n\nBranch/Commit: **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32492_\n\n",
    "closed_at": "2021-09-25T23:18:04Z",
    "created_at": "2021-09-08T17:49:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage-pip-install: Try installing without --no-deps first",
    "type": "issue",
    "updated_at": "2021-09-25T23:18:04Z",
    "url": "https://github.com/sagemath/sage/issues/32492",
    "user": "https://github.com/mkoeppe"
}
```
We currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.

In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index` (we also throw in a `--no-cache` in this ticket), it will not actually attempt to install from PyPI but fail with an error.
We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).

(Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))

We also pass `--ignore-requires-python` in the wheel-building phase and in the retry. This simplifies the Python 3.10 preparation and is otherwise harmless.


To test: 

```
eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492
make build 
grep -B2 -r "Warning.*try.*no-deps" logs/pkgs
```
(this will rebuild all Python packages in a new venv)


In particular highly parallel builds reveal a few missing dependencies -- but there should be no new errors.

Fixing the dependencies will be done in follow-up ticket #32493, not here.


Depends on #29847
Depends on #32361

CC:  @dimpase @seblabbe @jhpalmieri

Branch/Commit: **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**

Reviewer: **John Palmieri**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/32492_





---

archive/issue_events_450173.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T17:49:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450173"
}
```



---

archive/issue_events_450174.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T17:49:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450174"
}
```



---

archive/issue_events_450175.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T17:49:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450175"
}
```



---

archive/issue_events_450176.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T17:49:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450176"
}
```



---

archive/issue_comments_523956.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first)**",
    "created_at": "2021-09-08T18:38:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523956",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first)**



---

archive/issue_comments_523957.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8\"><code>0c387cb</code></a></td><td><code>build/bin/sage-pip-install: Try installing without --no-deps first</code></td></tr></table>\n",
    "created_at": "2021-09-08T18:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523957",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8"><code>0c387cb</code></a></td><td><code>build/bin/sage-pip-install: Try installing without --no-deps first</code></td></tr></table>




---

archive/issue_comments_523958.json:
```json
{
    "body": "Commit: **[`0c387cb`](https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8)**",
    "created_at": "2021-09-08T18:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523958",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`0c387cb`](https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8)**



---

archive/issue_comments_523959.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-09-08T18:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523959",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_523960.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,9 @@\n (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))\n \n \n+To test: \n+\n+```\n+eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492 && make build \n+```\n+(this will rebuild all Python packages in a new venv)\n``````\n",
    "created_at": "2021-09-08T18:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523960",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,9 @@
 (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))
 
 
+To test: 
+
+```
+eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492 && make build 
+```
+(this will rebuild all Python packages in a new venv)
``````




---

archive/issue_events_450177.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T18:40:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450177"
}
```



---

archive/issue_events_450178.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T18:57:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450178"
}
```



---

archive/issue_events_450179.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T18:57:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450179"
}
```



---

archive/issue_comments_523961.json:
```json
{
    "body": "Changed commit from **[`0c387cb`](https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8)** to **[`4a34573`](https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5)**",
    "created_at": "2021-09-08T19:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523961",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0c387cb`](https://github.com/sagemath/sagetrac-mirror/commit/0c387cbdbd647dc7e4c5e57643189da5c78f7ad8)** to **[`4a34573`](https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5)**



---

archive/issue_comments_523962.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5\"><code>4a34573</code></a></td><td><code>build/bin/sage-pip-install: Try installing without --no-deps first</code></td></tr></table>\n",
    "created_at": "2021-09-08T19:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523962",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5"><code>4a34573</code></a></td><td><code>build/bin/sage-pip-install: Try installing without --no-deps first</code></td></tr></table>




---

archive/issue_comments_523963.json:
```json
{
    "body": "Changed commit from **[`4a34573`](https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5)** to **[`6f1c68e`](https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e)**",
    "created_at": "2021-09-08T19:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523963",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a34573`](https://github.com/sagemath/sagetrac-mirror/commit/4a34573dc28fbd884e2b7c88603290c8fcc903e5)** to **[`6f1c68e`](https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e)**



---

archive/issue_comments_523964.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e\"><code>6f1c68e</code></a></td><td><code>src/doc/en/developer/packaging.rst: Update</code></td></tr></table>\n",
    "created_at": "2021-09-08T19:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523964",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e"><code>6f1c68e</code></a></td><td><code>src/doc/en/developer/packaging.rst: Update</code></td></tr></table>




---

archive/issue_events_450180.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T19:20:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450180"
}
```



---

archive/issue_events_450181.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T19:20:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450181"
}
```



---

archive/issue_comments_523965.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,9 @@\n To test: \n \n ```\n-eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492 && make build \n+eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492\n+make build \n+grep -B2 -r \"Warning.*try.*no-deps\" logs/pkgs\n ```\n (this will rebuild all Python packages in a new venv)\n+\n``````\n",
    "created_at": "2021-09-08T19:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523965",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,9 @@
 To test: 
 
 ```
-eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492 && make build 
+eval ./configure $(./config.status --config) --with-sage-venv=`pwd`/venv-32492
+make build 
+grep -B2 -r "Warning.*try.*no-deps" logs/pkgs
 ```
 (this will rebuild all Python packages in a new venv)
+
``````




---

archive/issue_comments_523966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,8 @@\n ```\n (this will rebuild all Python packages in a new venv)\n \n+\n+In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.\n+\n+Fixing the dependencies will be done in follow-up tickets, not here.\n+\n``````\n",
    "created_at": "2021-09-08T19:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523966",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,8 @@
 ```
 (this will rebuild all Python packages in a new venv)
 
+
+In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.
+
+Fixing the dependencies will be done in follow-up tickets, not here.
+
``````




---

archive/issue_comments_523967.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n We currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.\n \n-In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index`, it will not actually install from PyPI but fail with an error.\n+In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index` (we also throw in a `--no-cache` in this ticket), it will not actually attempt to install from PyPI but fail with an error.\n We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).\n \n (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))\n``````\n",
    "created_at": "2021-09-08T19:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523967",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 We currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.
 
-In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index`, it will not actually install from PyPI but fail with an error.
+In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index` (we also throw in a `--no-cache` in this ticket), it will not actually attempt to install from PyPI but fail with an error.
 We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).
 
 (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))
``````




---

archive/issue_comments_523968.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAdding #29847 as a dependency, which fixes the venv install for `memory_allocator`",
    "created_at": "2021-09-08T19:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523968",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Adding #29847 as a dependency, which fixes the venv install for `memory_allocator`



---

archive/issue_comments_523969.json:
```json
{
    "body": "Dependencies: **#29847**",
    "created_at": "2021-09-08T19:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523969",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29847**



---

archive/issue_comments_523970.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9aa1f10c1656f4d7f1cf8e15c1c0dfd2feaad1c0\"><code>9aa1f10</code></a></td><td><code>Merge #29585</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b1b222e05281413854602e2bec2e8d6ad680513\"><code>6b1b222</code></a></td><td><code>Merge #32046</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a41b507abb68a451e0d2f369749bcc5a3352ccf0\"><code>a41b507</code></a></td><td><code>Merge branch 't/32046/use_pip___use_feature_in_tree_build__replace_use_of_sdh_setup_bdist_wheel_by_sdh_pip_install' into t/29847/install_sage_setup_with_pip__move_sage_include_directories__cython_aliases_from_sage_env_to_sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/478ffcddb5a0b663f7bc1fd98d2b4ac632d79988\"><code>478ffcd</code></a></td><td><code>Merge #32046</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2368c62fc1fbc08fc0f06191d3671fb33133a8b\"><code>b2368c6</code></a></td><td><code>pkgs/sage-setup/setup.cfg: Add pkgconfig as install_requires</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db8e30dc58e6d2a8c50e74e162c06058d0417476\"><code>db8e30d</code></a></td><td><code>Merge tag '9.5.beta0' into t/29847/install_sage_setup_with_pip__move_sage_include_directories__cython_aliases_from_sage_env_to_sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37f9b0cd029197be46dba136cc913ad1402ee53f\"><code>37f9b0c</code></a></td><td><code>build/make/Makefile.in: For script packages, make sure that 'sage -f' uninstalls first</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/456d8a99054b1cb6b31a7575878be62dfc83f87b\"><code>456d8a9</code></a></td><td><code>build/make/Makefile.in (sage_setup-clean): Clean the build tree</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f84730e30ff7ac94f5f5990eb5a28744ac2932b3\"><code>f84730e</code></a></td><td><code>sage_setup.clean: Do not clean the sage_setup installation in site-packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f\"><code>9a6ace2</code></a></td><td><code>Merge #29847</code></td></tr></table>\n",
    "created_at": "2021-09-08T19:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523970",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9aa1f10c1656f4d7f1cf8e15c1c0dfd2feaad1c0"><code>9aa1f10</code></a></td><td><code>Merge #29585</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b1b222e05281413854602e2bec2e8d6ad680513"><code>6b1b222</code></a></td><td><code>Merge #32046</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a41b507abb68a451e0d2f369749bcc5a3352ccf0"><code>a41b507</code></a></td><td><code>Merge branch 't/32046/use_pip___use_feature_in_tree_build__replace_use_of_sdh_setup_bdist_wheel_by_sdh_pip_install' into t/29847/install_sage_setup_with_pip__move_sage_include_directories__cython_aliases_from_sage_env_to_sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/478ffcddb5a0b663f7bc1fd98d2b4ac632d79988"><code>478ffcd</code></a></td><td><code>Merge #32046</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2368c62fc1fbc08fc0f06191d3671fb33133a8b"><code>b2368c6</code></a></td><td><code>pkgs/sage-setup/setup.cfg: Add pkgconfig as install_requires</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db8e30dc58e6d2a8c50e74e162c06058d0417476"><code>db8e30d</code></a></td><td><code>Merge tag '9.5.beta0' into t/29847/install_sage_setup_with_pip__move_sage_include_directories__cython_aliases_from_sage_env_to_sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37f9b0cd029197be46dba136cc913ad1402ee53f"><code>37f9b0c</code></a></td><td><code>build/make/Makefile.in: For script packages, make sure that 'sage -f' uninstalls first</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/456d8a99054b1cb6b31a7575878be62dfc83f87b"><code>456d8a9</code></a></td><td><code>build/make/Makefile.in (sage_setup-clean): Clean the build tree</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f84730e30ff7ac94f5f5990eb5a28744ac2932b3"><code>f84730e</code></a></td><td><code>sage_setup.clean: Do not clean the sage_setup installation in site-packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f"><code>9a6ace2</code></a></td><td><code>Merge #29847</code></td></tr></table>




---

archive/issue_comments_523971.json:
```json
{
    "body": "Changed commit from **[`6f1c68e`](https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e)** to **[`9a6ace2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f)**",
    "created_at": "2021-09-08T19:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523971",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6f1c68e`](https://github.com/sagemath/sagetrac-mirror/commit/6f1c68e2acde1943a62eb3253dee167504aac11e)** to **[`9a6ace2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f)**



---

archive/issue_comments_523972.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,5 +18,5 @@\n \n In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.\n \n-Fixing the dependencies will be done in follow-up tickets, not here.\n+Fixing the dependencies will be done in follow-up ticket #32493, not here.\n \n``````\n",
    "created_at": "2021-09-08T19:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523972",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,5 +18,5 @@
 
 In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.
 
-Fixing the dependencies will be done in follow-up tickets, not here.
+Fixing the dependencies will be done in follow-up ticket #32493, not here.
 
``````




---

archive/issue_events_450182.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T23:37:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450182"
}
```



---

archive/issue_events_450183.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T23:37:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450183"
}
```



---

archive/issue_comments_523973.json:
```json
{
    "body": "Changed dependencies from **#29847** to **#29847, #32361**",
    "created_at": "2021-09-08T23:38:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523973",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29847** to **#29847, #32361**



---

archive/issue_comments_523974.json:
```json
{
    "body": "Changed commit from **[`9a6ace2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f)** to **[`fb069d4`](https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95)**",
    "created_at": "2021-09-08T23:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523974",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9a6ace2`](https://github.com/sagemath/sagetrac-mirror/commit/9a6ace2a352d147e50c8227d6140fcb1d2b2e02f)** to **[`fb069d4`](https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95)**



---

archive/issue_comments_523975.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fccf3e023864bde327fdf6ccf383535aff47e2b\"><code>8fccf3e</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): No more DESTDIR staging for Python packages (unless SAGE_SUDO is set)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7a117119111a7645a459b04ba39f93b389af01d\"><code>c7a1171</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Do not use SAGE_SUDO for pip install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a05d57e8032354c091d6a3ed6cdd2a4aff13484a\"><code>a05d57e</code></a></td><td><code>Merge tag '9.5.beta0' into t/32361/actually_remove_destdir_staging_for_python_packages_to_eliminate_race_conditions_during_python_package_installations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/378a034ab454ce5a93007b8698519e1979e4eff2\"><code>378a034</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Fix for script packages with SAGE_SUDO set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95\"><code>fb069d4</code></a></td><td><code>Merge #32361</code></td></tr></table>\n",
    "created_at": "2021-09-08T23:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523975",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fccf3e023864bde327fdf6ccf383535aff47e2b"><code>8fccf3e</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): No more DESTDIR staging for Python packages (unless SAGE_SUDO is set)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7a117119111a7645a459b04ba39f93b389af01d"><code>c7a1171</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Do not use SAGE_SUDO for pip install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a05d57e8032354c091d6a3ed6cdd2a4aff13484a"><code>a05d57e</code></a></td><td><code>Merge tag '9.5.beta0' into t/32361/actually_remove_destdir_staging_for_python_packages_to_eliminate_race_conditions_during_python_package_installations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/378a034ab454ce5a93007b8698519e1979e4eff2"><code>378a034</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Fix for script packages with SAGE_SUDO set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95"><code>fb069d4</code></a></td><td><code>Merge #32361</code></td></tr></table>




---

archive/issue_comments_523976.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThis doesn't quite work as intended. Weirdly, `pip` is ignoring the installed packages if it does not also have access to a package index (we use `--no-index` and also poison proxy variables, so it does not use PyPI).",
    "created_at": "2021-09-09T00:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523976",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

This doesn't quite work as intended. Weirdly, `pip` is ignoring the installed packages if it does not also have access to a package index (we use `--no-index` and also poison proxy variables, so it does not use PyPI).



---

archive/issue_comments_523977.json:
```json
{
    "body": "Changed commit from **[`fb069d4`](https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95)** to **[`80f0a9e`](https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61)**",
    "created_at": "2021-09-09T01:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523977",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fb069d4`](https://github.com/sagemath/sagetrac-mirror/commit/fb069d4cd30a51a979e8e066d63c4bf7dde49c95)** to **[`80f0a9e`](https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61)**



---

archive/issue_comments_523978.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61\"><code>80f0a9e</code></a></td><td><code>build/bin/sage-pip-install: Use --find-links=$SAGE_SPKG_WHEELS; on first pass, drop --ignore-installed</code></td></tr></table>\n",
    "created_at": "2021-09-09T01:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523978",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61"><code>80f0a9e</code></a></td><td><code>build/bin/sage-pip-install: Use --find-links=$SAGE_SPKG_WHEELS; on first pass, drop --ignore-installed</code></td></tr></table>




---

archive/issue_comments_523979.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac183437e13015b71788bd63b1e39303a6832afa\"><code>ac18343</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Pass options (starting with dashes) on to sage-pip-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42\"><code>ad18520</code></a></td><td><code>build/pkgs/pip/spkg-install.in: Use --ignore-installed when installing the wheel</code></td></tr></table>\n",
    "created_at": "2021-09-09T01:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac183437e13015b71788bd63b1e39303a6832afa"><code>ac18343</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): Pass options (starting with dashes) on to sage-pip-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42"><code>ad18520</code></a></td><td><code>build/pkgs/pip/spkg-install.in: Use --ignore-installed when installing the wheel</code></td></tr></table>




---

archive/issue_comments_523980.json:
```json
{
    "body": "Changed commit from **[`80f0a9e`](https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61)** to **[`ad18520`](https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42)**",
    "created_at": "2021-09-09T01:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523980",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`80f0a9e`](https://github.com/sagemath/sagetrac-mirror/commit/80f0a9ec3be7946510ca3c72f4f289b0f7977a61)** to **[`ad18520`](https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42)**



---

archive/issue_comments_523981.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis version works for me. It makes use of the previously built wheels that are kept in `$SAGE_VENV/var/lib/sage/wheels/`",
    "created_at": "2021-09-09T01:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523981",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

This version works for me. It makes use of the previously built wheels that are kept in `$SAGE_VENV/var/lib/sage/wheels/`



---

archive/issue_events_450184.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-09T01:55:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450184"
}
```



---

archive/issue_events_450185.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-09T01:55:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450185"
}
```



---

archive/issue_comments_523982.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,7 +16,7 @@\n (this will rebuild all Python packages in a new venv)\n \n \n-In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.\n+In particular highly parallel builds reveal a few missing dependencies -- but there should be no new errors.\n \n Fixing the dependencies will be done in follow-up ticket #32493, not here.\n \n``````\n",
    "created_at": "2021-09-09T01:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523982",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,7 +16,7 @@
 (this will rebuild all Python packages in a new venv)
 
 
-In particular highly parallel builds reveal lots of missing dependencies -- but there should be no new errors.
+In particular highly parallel builds reveal a few missing dependencies -- but there should be no new errors.
 
 Fixing the dependencies will be done in follow-up ticket #32493, not here.
 
``````




---

archive/issue_comments_523983.json:
```json
{
    "body": "Changed commit from **[`ad18520`](https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42)** to **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**",
    "created_at": "2021-09-16T01:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523983",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ad18520`](https://github.com/sagemath/sagetrac-mirror/commit/ad1852050730a3fbe6c367f9c83a7dd8bc7eec42)** to **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**



---

archive/issue_comments_523984.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb70f8ac5544b4efab205c7b8f17d803a9759661\"><code>fb70f8a</code></a></td><td><code>build/bin/sage-pip-install: When retrying with --no-deps, also use --ignore-requires-python</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd\"><code>92c855c</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Build the wheel with --ignore-requires-python</code></td></tr></table>\n",
    "created_at": "2021-09-16T01:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523984",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb70f8ac5544b4efab205c7b8f17d803a9759661"><code>fb70f8a</code></a></td><td><code>build/bin/sage-pip-install: When retrying with --no-deps, also use --ignore-requires-python</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd"><code>92c855c</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Build the wheel with --ignore-requires-python</code></td></tr></table>




---

archive/issue_comments_523985.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).\n \n (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))\n+\n+We also pass `--ignore-requires-python` in the wheel-building phase and in the retry. This simplifies the Python 3.10 preparation and is otherwise harmless.\n \n \n To test: \n``````\n",
    "created_at": "2021-09-16T01:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523985",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,8 @@
 We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).
 
 (Prompted by [#31280 comment:93](https://github.com/sagemath/sage/issues/31280#comment:93), [#30974 comment:14](https://github.com/sagemath/sage/issues/30974#comment:14))
+
+We also pass `--ignore-requires-python` in the wheel-building phase and in the retry. This simplifies the Python 3.10 preparation and is otherwise harmless.
 
 
 To test: 
``````




---

archive/issue_comments_523986.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThis seems to work as advertised. Is there room at some point for a pickier build process that actually produces errors when this kind of thing comes up? (Something that could be used by buildbots or developers working new packages but not the default.)",
    "created_at": "2021-09-17T18:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523986",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

This seems to work as advertised. Is there room at some point for a pickier build process that actually produces errors when this kind of thing comes up? (Something that could be used by buildbots or developers working new packages but not the default.)



---

archive/issue_comments_523987.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nA related question: how do we convince people to actually check for these warnings?",
    "created_at": "2021-09-17T18:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523987",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

A related question: how do we convince people to actually check for these warnings?



---

archive/issue_comments_523988.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think there's room for escalation in a follow-up ticket, but I think it's safer to first bring it to wider testing by developers in the current form.",
    "created_at": "2021-09-17T18:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523988",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

I think there's room for escalation in a follow-up ticket, but I think it's safer to first bring it to wider testing by developers in the current form.



---

archive/issue_comments_523989.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI've opened #32529 for this.",
    "created_at": "2021-09-17T18:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523989",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

I've opened #32529 for this.



---

archive/issue_comments_523990.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI tested this with `ipykernel`. It does indeed print a warning about a missing dependency, and it's not too hard to see from the log file that it's `debugpy`.",
    "created_at": "2021-09-17T22:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523990",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

I tested this with `ipykernel`. It does indeed print a warning about a missing dependency, and it's not too hard to see from the log file that it's `debugpy`.



---

archive/issue_comments_523991.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2021-09-17T22:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523991",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_450186.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-09-17T22:45:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450186"
}
```



---

archive/issue_events_450187.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-09-17T22:45:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450187"
}
```



---

archive/issue_comments_523992.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThanks for reviewing!",
    "created_at": "2021-09-17T23:09:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523992",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Thanks for reviewing!



---

archive/issue_events_450188.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-25T23:18:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450188"
}
```



---

archive/issue_events_450189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c73a1191725c6199b4949f291be26b6035dc7236",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-09-25T23:18:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32492#event-450189"
}
```



---

archive/issue_comments_523993.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first)** to **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**",
    "created_at": "2021-09-25T23:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32492#issuecomment-523993",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_pip_install__try_installing_without___no_deps_first)** to **[`92c855c`](https://github.com/sagemath/sagetrac-mirror/commit/92c855cf0c454a6a850c8a2df7e1472ca22004fd)**
