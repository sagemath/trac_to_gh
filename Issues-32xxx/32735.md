# Issue 32735: Remove imports of CC and CIF from sage.rings.all

archive/issues_032498.json:
```json
{
    "body": "`git grep 'all import CC'`\n\n`CC` is actually defined in `src/sage/rings/all.py` (as well as locally in several other modules), not in `src/sage/rings/complex_mpfr.pyx` because of cyclic imports. We create a new module `sage.rings.cc` for it.\n\nLikewise for `CIF`.\n\nWe change almost all uses; follow-up in #33006.\n\n\n\nCC:  @tobiasdiez @videlec @mezzarobba\n\nReviewer: Marc Mezzarobba\n\nAuthor: Matthias Koeppe\n\nBranch: 0d6c0d190a8b0b5f54d7d7f631abc01979a8c301\n\nDependencies: #30741, #32174\n\nCommit: 0d6c0d190a8b0b5f54d7d7f631abc01979a8c301\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32735\n\n",
    "closed_at": "2021-12-23T20:26:05Z",
    "created_at": "2021-10-21T07:00:39Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Remove imports of CC and CIF from sage.rings.all",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32735",
    "user": "https://github.com/mkoeppe"
}
```
`git grep 'all import CC'`

`CC` is actually defined in `src/sage/rings/all.py` (as well as locally in several other modules), not in `src/sage/rings/complex_mpfr.pyx` because of cyclic imports. We create a new module `sage.rings.cc` for it.

Likewise for `CIF`.

We change almost all uses; follow-up in #33006.



CC:  @tobiasdiez @videlec @mezzarobba

Reviewer: Marc Mezzarobba

Author: Matthias Koeppe

Branch: 0d6c0d190a8b0b5f54d7d7f631abc01979a8c301

Dependencies: #30741, #32174

Commit: 0d6c0d190a8b0b5f54d7d7f631abc01979a8c301

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32735





---

archive/issue_comments_462978.json:
```json
{
    "body": "<a id='comment:1'></a>This change would lead to a segfault.\n\n```\ndiff --git a/src/sage/rings/complex_mpfr.pyx b/src/sage/rings/complex_mpfr.pyx\nindex b419914f23..8b120c4341 100644\n--- a/src/sage/rings/complex_mpfr.pyx\n+++ b/src/sage/rings/complex_mpfr.pyx\n@@ -3610,3 +3610,6 @@ def _format_complex_number(real, imag, format_spec):\n                              \"complex format specifier\")\n         result = format(result, align + width)\n     return result\n+\n+\n+CC = ComplexField()\n```",
    "created_at": "2021-10-21T17:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462978",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>This change would lead to a segfault.

```
diff --git a/src/sage/rings/complex_mpfr.pyx b/src/sage/rings/complex_mpfr.pyx
index b419914f23..8b120c4341 100644
--- a/src/sage/rings/complex_mpfr.pyx
+++ b/src/sage/rings/complex_mpfr.pyx
@@ -3610,3 +3610,6 @@ def _format_complex_number(real, imag, format_spec):
                              "complex format specifier")
         result = format(result, align + width)
     return result
+
+
+CC = ComplexField()
```



---

archive/issue_comments_462979.json:
```json
{
    "body": "<a id='comment:3'></a>Maybe we should just create a small module `sage.rings.cc` for the definition of `CC`.",
    "created_at": "2021-12-09T20:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462979",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Maybe we should just create a small module `sage.rings.cc` for the definition of `CC`.



---

archive/issue_comments_462980.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T21:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462981.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-09T21:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462981",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_462982.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T23:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462982",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462983.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-09T23:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462983",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462984.json:
```json
{
    "body": "<a id='comment:11'></a>What about creating one central module (say `rings.abbrv`) that defines and exposes the abbreviations for all fields, i.e. also RR, ZZ etc? Feels more consistent. I think this would help preventing cyclic imports as one then could import the corresponding ring modules without them being directly executed.",
    "created_at": "2021-12-10T20:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462984",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>What about creating one central module (say `rings.abbrv`) that defines and exposes the abbreviations for all fields, i.e. also RR, ZZ etc? Feels more consistent. I think this would help preventing cyclic imports as one then could import the corresponding ring modules without them being directly executed.



---

archive/issue_comments_462985.json:
```json
{
    "body": "<a id='comment:12'></a>That would run counter to modularization",
    "created_at": "2021-12-10T20:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462985",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>That would run counter to modularization



---

archive/issue_comments_462986.json:
```json
{
    "body": "<a id='comment:13'></a>Did you tried to change\nhttps://github.com/sagemath/sagetrac-mirror/compare/develop...u/mkoeppe/remove_import_of_cc_from_sage_rings_all#diff-5b40c947b3304ad98f2f7bb93dea2bf496a967563cf297c2aa3cd049d6abcd83R446-R447\nto an import of the new `CC`?",
    "created_at": "2021-12-10T20:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462986",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>Did you tried to change
https://github.com/sagemath/sagetrac-mirror/compare/develop...u/mkoeppe/remove_import_of_cc_from_sage_rings_all#diff-5b40c947b3304ad98f2f7bb93dea2bf496a967563cf297c2aa3cd049d6abcd83R446-R447
to an import of the new `CC`?



---

archive/issue_comments_462987.json:
```json
{
    "body": "<a id='comment:14'></a>What do you suggest to change?",
    "created_at": "2021-12-10T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462987",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>What do you suggest to change?



---

archive/issue_comments_462988.json:
```json
{
    "body": "<a id='comment:15'></a>These two lines linked above\n\n```\n        from .complex_mpfr import ComplexField\n        CC = ComplexField()\n```\nto `from sage.rings.cc import CC`",
    "created_at": "2021-12-10T21:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462988",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>These two lines linked above

```
        from .complex_mpfr import ComplexField
        CC = ComplexField()
```
to `from sage.rings.cc import CC`



---

archive/issue_comments_462989.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-10T21:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462990.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-15T07:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462990",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462991.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-15T07:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462991",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_462992.json:
```json
{
    "body": "<a id='comment:18'></a>Some doctests need updating.",
    "created_at": "2021-12-15T07:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462992",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:18'></a>Some doctests need updating.



---

archive/issue_comments_462993.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-15T20:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462994.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-15T20:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462994",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_462995.json:
```json
{
    "body": "<a id='comment:21'></a>Some doctests that reference line numbers in `*_homset.py` still need to be fixed.",
    "created_at": "2021-12-16T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462995",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:21'></a>Some doctests that reference line numbers in `*_homset.py` still need to be fixed.



---

archive/issue_comments_462996.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-16T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462996",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_462997.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T20:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462998.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T20:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462998",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_462999.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks - I had mistaken this failure for a numerical issue.",
    "created_at": "2021-12-16T20:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-462999",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Thanks - I had mistaken this failure for a numerical issue.



---

archive/issue_comments_463000.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T20:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463000",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463001.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-16T20:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463001",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_463002.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-12-16T20:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463002",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_463003.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463003",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463004.json:
```json
{
    "body": "<a id='comment:27'></a>Merged #32714 for the fix to doctest markup in `src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py`.",
    "created_at": "2021-12-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463004",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Merged #32714 for the fix to doctest markup in `src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py`.



---

archive/issue_comments_463005.json:
```json
{
    "body": "<a id='comment:28'></a>Oh, good, I didn't realize this had been fixed elsewhere.",
    "created_at": "2021-12-17T08:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463005",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:28'></a>Oh, good, I didn't realize this had been fixed elsewhere.



---

archive/issue_comments_463006.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-17T08:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463006",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_086648.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-23T20:26:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32735#event-86648"
}
```



---

archive/issue_comments_463007.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-23T20:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32735#issuecomment-463007",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
