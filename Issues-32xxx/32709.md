# Issue 32709: sage.structure.element: Add ABCs CommutativePolynomial, Polynomial, MPolynomial, InfinitePolynomial for isinstance testing

archive/issues_032472.json:
```json
{
    "assignees": [],
    "body": "The new classes `Polynomial` and `MPolynomial` are ABCs with a unique direct subclass (see Meta-ticket #32414 and https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies for this design pattern). Their purpose is that `isinstance(x, sage.structure.element.[M]Polynomial)` replaces the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).\n\nThe new class `InfinitePolynomial` is also an ABC with a unique direct subclass. We introduce it here although there is currently no use of `isinstance(x, InfinitePolynomial...)` in the library.\n\nThe new class `CommutativePolynomial` is an ABC that is a common base of `Polynomial`, `MPolynomial`, and `InfinitePolynomial`. We introduce it here although there is currently no use for `isinstance(x, CommutativePolynomial)` in the library.\n\nWe also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.\n\n\nCC:  @dimpase @mezzarobba @videlec @tscrim\n\nBranch/Commit: **[u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing) @ [`c72dcc8`](https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4)**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **refactoring**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32709_\n\n",
    "created_at": "2021-10-17T21:40:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/refactoring",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.structure.element: Add ABCs CommutativePolynomial, Polynomial, MPolynomial, InfinitePolynomial for isinstance testing",
    "type": "issue",
    "updated_at": "2023-01-10T08:39:21Z",
    "url": "https://github.com/sagemath/sage/issues/32709",
    "user": "https://github.com/mkoeppe"
}
```
The new classes `Polynomial` and `MPolynomial` are ABCs with a unique direct subclass (see Meta-ticket #32414 and https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies for this design pattern). Their purpose is that `isinstance(x, sage.structure.element.[M]Polynomial)` replaces the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).

The new class `InfinitePolynomial` is also an ABC with a unique direct subclass. We introduce it here although there is currently no use of `isinstance(x, InfinitePolynomial...)` in the library.

The new class `CommutativePolynomial` is an ABC that is a common base of `Polynomial`, `MPolynomial`, and `InfinitePolynomial`. We introduce it here although there is currently no use for `isinstance(x, CommutativePolynomial)` in the library.

We also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.


CC:  @dimpase @mezzarobba @videlec @tscrim

Branch/Commit: **[u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing) @ [`c72dcc8`](https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4)**

Author: **Matthias Koeppe**

Component: **refactoring**

_Issue created by migration from https://trac.sagemath.org/ticket/32709_





---

archive/issue_events_450543.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T21:40:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450543"
}
```



---

archive/issue_events_450544.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T21:40:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/refactoring",
    "label_color": "696969",
    "label_name": "refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450544"
}
```



---

archive/issue_events_450545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T21:40:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450545"
}
```



---

archive/issue_events_450546.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T21:40:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450546"
}
```



---

archive/issue_events_450547.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450547"
}
```



---

archive/issue_events_450548.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450548"
}
```



---

archive/issue_events_450549.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450549"
}
```



---

archive/issue_events_450550.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450550"
}
```



---

archive/issue_events_450551.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450551"
}
```



---

archive/issue_events_450552.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450552"
}
```



---

archive/issue_comments_527797.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2022-12-06T06:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527797",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_527798.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing)**",
    "created_at": "2022-12-06T07:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527798",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing)**



---

archive/issue_comments_527799.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d\">4185472</a></td><td><code>Fixups</code></td></tr></table>\n",
    "created_at": "2022-12-06T08:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527799",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d">4185472</a></td><td><code>Fixups</code></td></tr></table>




---

archive/issue_comments_527800.json:
```json
{
    "body": "Commit: **[`4185472`](https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d)**",
    "created_at": "2022-12-06T08:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527800",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`4185472`](https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d)**



---

archive/issue_comments_527801.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-... replacing the use of `is_Polynomial`, `is_MPolynomial`.\n+... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).\n \n Part of Meta-ticket #32414\n \n``````\n",
    "created_at": "2022-12-06T08:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527801",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-... replacing the use of `is_Polynomial`, `is_MPolynomial`.
+... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).
 
 Part of Meta-ticket #32414
 
``````




---

archive/issue_comments_527802.json:
```json
{
    "body": "Changed commit from **[`4185472`](https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d)** to **[`46d8351`](https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86)**",
    "created_at": "2022-12-06T08:37:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527802",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4185472`](https://github.com/sagemath/sagetrac-mirror/commit/4185472e0fd2cd3b8693f4248b37ca6506d7ac9d)** to **[`46d8351`](https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86)**



---

archive/issue_comments_527803.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86\">46d8351</a></td><td><code>sage.rings.polynomial: Make it a namespace package</code></td></tr></table>\n",
    "created_at": "2022-12-06T08:37:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527803",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86">46d8351</a></td><td><code>sage.rings.polynomial: Make it a namespace package</code></td></tr></table>




---

archive/issue_events_450553.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-06T08:40:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450553"
}
```



---

archive/issue_comments_527804.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n ... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).\n+\n+We also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.\n \n Part of Meta-ticket #32414\n \n``````\n",
    "created_at": "2022-12-06T08:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527804",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 ... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).
+
+We also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.
 
 Part of Meta-ticket #32414
 
``````




---

archive/issue_comments_527805.json:
```json
{
    "body": "Changed commit from **[`46d8351`](https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86)** to **[`e21267f`](https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f)**",
    "created_at": "2022-12-18T21:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527805",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`46d8351`](https://github.com/sagemath/sagetrac-mirror/commit/46d835104a92ca5c11401a1850531f932fdaac86)** to **[`e21267f`](https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f)**



---

archive/issue_comments_527806.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29d91ad0559ef57045d74543510784fb17544159\">29d91ad</a></td><td><code>sage.structure.element: Add ABCs Polynomial, MPolynomial, use for isinstance testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed9e0e4084ebd6c54aea4f79279ac6bfbfdb9041\">ed9e0e4</a></td><td><code>Use ABC MPolynomial for isinstance testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4b0aa77e50a4ca49e9be7b38146b9bf90a56aee\">f4b0aa7</a></td><td><code>Fixups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f\">e21267f</a></td><td><code>sage.rings.polynomial: Make it a namespace package</code></td></tr></table>\n",
    "created_at": "2022-12-18T21:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527806",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29d91ad0559ef57045d74543510784fb17544159">29d91ad</a></td><td><code>sage.structure.element: Add ABCs Polynomial, MPolynomial, use for isinstance testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed9e0e4084ebd6c54aea4f79279ac6bfbfdb9041">ed9e0e4</a></td><td><code>Use ABC MPolynomial for isinstance testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4b0aa77e50a4ca49e9be7b38146b9bf90a56aee">f4b0aa7</a></td><td><code>Fixups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f">e21267f</a></td><td><code>sage.rings.polynomial: Make it a namespace package</code></td></tr></table>




---

archive/issue_events_450554.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-12-23T06:53:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450554"
}
```



---

archive/issue_events_450555.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-12-23T06:53:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450555"
}
```



---

archive/issue_comments_527807.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nMerge failure.",
    "created_at": "2022-12-23T06:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527807",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Merge failure.



---

archive/issue_comments_527808.json:
```json
{
    "body": "Changed commit from **[`e21267f`](https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f)** to **[`e156cad`](https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc)**",
    "created_at": "2022-12-23T08:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527808",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e21267f`](https://github.com/sagemath/sagetrac-mirror/commit/e21267f26110aae41f8f48d899f81c6b0b476e3f)** to **[`e156cad`](https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc)**



---

archive/issue_comments_527809.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc\">e156cad</a></td><td><code>Merge tag '9.8.beta6' into t/32709/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing</code></td></tr></table>\n",
    "created_at": "2022-12-23T08:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527809",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc">e156cad</a></td><td><code>Merge tag '9.8.beta6' into t/32709/sage_structure_element__add_abcs_polynomial__mpolynomial_for_isinstance_testing</code></td></tr></table>




---

archive/issue_events_450556.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-23T09:00:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450556"
}
```



---

archive/issue_events_450557.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-23T09:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450557"
}
```



---

archive/issue_comments_527810.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThank you for doing this. This is something that I have been thinking about having for a while. The only other thing I would like would be a common ABC for both univariate and multivariate polynomials.",
    "created_at": "2023-01-06T23:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527810",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Thank you for doing this. This is something that I have been thinking about having for a while. The only other thing I would like would be a common ABC for both univariate and multivariate polynomials.



---

archive/issue_comments_527811.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCurrently we have:\n\n```\ncdef class Polynomial(CommutativeAlgebraElement):\n```\nbut\n\n```\ncdef class MPolynomial(CommutativeRingElement):\n```",
    "created_at": "2023-01-06T23:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527811",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Currently we have:

```
cdef class Polynomial(CommutativeAlgebraElement):
```
but

```
cdef class MPolynomial(CommutativeRingElement):
```



---

archive/issue_comments_527812.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe branch here is changing it (I think this is harmless). So we could just introduce a common base class -- but what would that be called?",
    "created_at": "2023-01-06T23:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527812",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

The branch here is changing it (I think this is harmless). So we could just introduce a common base class -- but what would that be called?



---

archive/issue_comments_527813.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThat is a bit strange to me. They both are algebras. From the class hierarchy, inheriting the subclass should make it a bit better.\n\nI might call it `Polynomial_base`.",
    "created_at": "2023-01-06T23:58:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527813",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

That is a bit strange to me. They both are algebras. From the class hierarchy, inheriting the subclass should make it a bit better.

I might call it `Polynomial_base`.



---

archive/issue_comments_527814.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHow about `AnyPolynomial`?",
    "created_at": "2023-01-07T00:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527814",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

How about `AnyPolynomial`?



---

archive/issue_comments_527815.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n(In this ticket, I'm already using `Polynomial_base` and `MPolynomial_base`)",
    "created_at": "2023-01-07T00:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527815",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

(In this ticket, I'm already using `Polynomial_base` and `MPolynomial_base`)



---

archive/issue_comments_527816.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOr maybe `CommutativePolynomial`?",
    "created_at": "2023-01-07T00:04:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527816",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Or maybe `CommutativePolynomial`?



---

archive/issue_comments_527817.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n`CommutativePolynomial` is good. `AnyPolynomial` feels somewhat awkward for an ABC and a bit too generic.",
    "created_at": "2023-01-07T00:11:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527817",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

`CommutativePolynomial` is good. `AnyPolynomial` feels somewhat awkward for an ABC and a bit too generic.



---

archive/issue_comments_527818.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIdeally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...",
    "created_at": "2023-01-07T00:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527818",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

Ideally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...



---

archive/issue_comments_527819.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nWould `InfinitePolynomial_sparse` and `InfinitePolynomial_dense` also become subclasses of `CommutativePolynomial`? (Currently they directly subclass `RingElement`)",
    "created_at": "2023-01-07T00:13:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527819",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Would `InfinitePolynomial_sparse` and `InfinitePolynomial_dense` also become subclasses of `CommutativePolynomial`? (Currently they directly subclass `RingElement`)



---

archive/issue_comments_527820.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [Travis Scrimshaw](#comment:25):\n> Ideally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...\n\nI think that's too intrusive a change; at least for this ticket",
    "created_at": "2023-01-07T00:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527820",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [Travis Scrimshaw](#comment:25):
> Ideally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...

I think that's too intrusive a change; at least for this ticket



---

archive/issue_comments_527821.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:26):\n> Would `InfinitePolynomial_sparse` and `InfinitePolynomial_dense` also become subclasses of `CommutativePolynomial`? (Currently they directly subclass `RingElement`)\n\nThat's a good point. Yes, I think they should. They should act in the same way as other polynomials.",
    "created_at": "2023-01-07T00:25:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527821",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [Matthias Köppe](#comment:26):
> Would `InfinitePolynomial_sparse` and `InfinitePolynomial_dense` also become subclasses of `CommutativePolynomial`? (Currently they directly subclass `RingElement`)

That's a good point. Yes, I think they should. They should act in the same way as other polynomials.



---

archive/issue_comments_527822.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:27):\n> Replying to [Travis Scrimshaw](#comment:25):\n> > Ideally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...\n\n> \n> I think that's too intrusive a change; at least for this ticket\n\nIndeed.",
    "created_at": "2023-01-07T00:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527822",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [Matthias Köppe](#comment:27):
> Replying to [Travis Scrimshaw](#comment:25):
> > Ideally I would like to rename `Polynomial` to `UPolynomial` or something saying it is univariate. Just for the base class. Although that upends a fair amount of the naming conventions currently in Sage...

> 
> I think that's too intrusive a change; at least for this ticket

Indeed.



---

archive/issue_comments_527823.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nOK. I'll push these changes to the ticket in a bit.",
    "created_at": "2023-01-07T00:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527823",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

OK. I'll push these changes to the ticket in a bit.



---

archive/issue_comments_527824.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThank you!",
    "created_at": "2023-01-07T00:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527824",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:31" align="right">comment:31</div>

Thank you!



---

archive/issue_comments_527825.json:
```json
{
    "body": "Changed commit from **[`e156cad`](https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc)** to **[`a30f024`](https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d)**",
    "created_at": "2023-01-07T01:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527825",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e156cad`](https://github.com/sagemath/sagetrac-mirror/commit/e156cad227d4f241e2392fd85dab35707af139bc)** to **[`a30f024`](https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d)**



---

archive/issue_comments_527826.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39e3968463f0400b0fb5f9e0c3c223f6c461539f\">39e3968</a></td><td><code>sage.structure.element: Introduce common base class CommutativePolynomial for ABCs Polynomial, MPolynomial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d\">a30f024</a></td><td><code>sage.structure.element: Introduce ABC InfinitePolynomial</code></td></tr></table>\n",
    "created_at": "2023-01-07T01:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527826",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39e3968463f0400b0fb5f9e0c3c223f6c461539f">39e3968</a></td><td><code>sage.structure.element: Introduce common base class CommutativePolynomial for ABCs Polynomial, MPolynomial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d">a30f024</a></td><td><code>sage.structure.element: Introduce ABC InfinitePolynomial</code></td></tr></table>




---

archive/issue_events_450558.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T01:04:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "title_is": "sage.structure.element: Add ABCs CommutativePolynomial, Polynomial, MPolynomial, InfinitePolynomial for isinstance testing",
    "title_was": "sage.structure.element: Add ABCs Polynomial, MPolynomial for isinstance testing",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32709#event-450558"
}
```



---

archive/issue_comments_527827.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI don't think we want a special ABC for the \"infinite\" polynomial as the name suggests they are formal power series, and the ring is not different at an abstract level (just in implementation) from a usual multivariate polynomial.\n\nWe probably should also update the hierarchy documentation at the top of `element.pyx`.",
    "created_at": "2023-01-07T01:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527827",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

I don't think we want a special ABC for the "infinite" polynomial as the name suggests they are formal power series, and the ring is not different at an abstract level (just in implementation) from a usual multivariate polynomial.

We probably should also update the hierarchy documentation at the top of `element.pyx`.



---

archive/issue_comments_527828.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe ABCs in `sage.structure.element` are introduced for `isinstance` testing (#32414). Though currently there is no reference to the `InfinitePolynomial_*` classes outside of `sage.rings.polynomial.infinite_polynomial*`, the new ABC makes such tests possible",
    "created_at": "2023-01-07T02:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527828",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

The ABCs in `sage.structure.element` are introduced for `isinstance` testing (#32414). Though currently there is no reference to the `InfinitePolynomial_*` classes outside of `sage.rings.polynomial.infinite_polynomial*`, the new ABC makes such tests possible



---

archive/issue_comments_527829.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI do agree that the naming `InfinitePolynomial` can be misleading.",
    "created_at": "2023-01-07T02:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527829",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

I do agree that the naming `InfinitePolynomial` can be misleading.



---

archive/issue_comments_527830.json:
```json
{
    "body": "Changed commit from **[`a30f024`](https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d)** to **[`4050551`](https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e)**",
    "created_at": "2023-01-07T02:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527830",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a30f024`](https://github.com/sagemath/sagetrac-mirror/commit/a30f024248821227c1f17fe82563d3321ce7f75d)** to **[`4050551`](https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e)**



---

archive/issue_comments_527831.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e\">4050551</a></td><td><code>src/sage/structure/element.pyx: Update hierarchy in documentation</code></td></tr></table>\n",
    "created_at": "2023-01-07T02:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527831",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e">4050551</a></td><td><code>src/sage/structure/element.pyx: Update hierarchy in documentation</code></td></tr></table>




---

archive/issue_comments_527832.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:35):\n> The ABCs in `sage.structure.element` are introduced for `isinstance` testing (#32414). Though currently there is no reference to the `InfinitePolynomial_*` classes outside of `sage.rings.polynomial.infinite_polynomial*`, the new ABC makes such tests possible\n\nBut you can just do the `isinstance` testing against the `InfinitePolynomial_sparse` from that file. They are just a specific implementation of a multivariate polynomial ring in my mind.",
    "created_at": "2023-01-07T02:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527832",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [Matthias Köppe](#comment:35):
> The ABCs in `sage.structure.element` are introduced for `isinstance` testing (#32414). Though currently there is no reference to the `InfinitePolynomial_*` classes outside of `sage.rings.polynomial.infinite_polynomial*`, the new ABC makes such tests possible

But you can just do the `isinstance` testing against the `InfinitePolynomial_sparse` from that file. They are just a specific implementation of a multivariate polynomial ring in my mind.



---

archive/issue_comments_527833.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThis is for modularization purposes: avoiding to have to import an implementation module just to test whether an object may be coming from that module. (see https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies)",
    "created_at": "2023-01-07T02:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527833",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

This is for modularization purposes: avoiding to have to import an implementation module just to test whether an object may be coming from that module. (see https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies)



---

archive/issue_comments_527834.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nBy that logic, we should have every class with a corresponding abstract class in `element.pyx`. Is that what you're advocating for here?",
    "created_at": "2023-01-07T02:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527834",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:40" align="right">comment:40</div>

By that logic, we should have every class with a corresponding abstract class in `element.pyx`. Is that what you're advocating for here?



---

archive/issue_comments_527835.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nEvery class would be too much and is not needed. But some implementation classes, in particular polynomials, vectors, matrices benefit from this as they are used in lots of places",
    "created_at": "2023-01-07T02:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527835",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Every class would be too much and is not needed. But some implementation classes, in particular polynomials, vectors, matrices benefit from this as they are used in lots of places



---

archive/issue_comments_527836.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nTo me, if someone wants to specifically test against the `InfinitePolynomialRing` elements, they are almost certainly going to be doing something involving that class and need to import it. This isn't a generic class. Would you do the same for a polynomial ring with generators indexed by different uncountable sets?",
    "created_at": "2023-01-07T02:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527836",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

To me, if someone wants to specifically test against the `InfinitePolynomialRing` elements, they are almost certainly going to be doing something involving that class and need to import it. This isn't a generic class. Would you do the same for a polynomial ring with generators indexed by different uncountable sets?



---

archive/issue_comments_527837.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThe importing can often be done when `isinstance` has returned True",
    "created_at": "2023-01-07T02:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527837",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

The importing can often be done when `isinstance` has returned True



---

archive/issue_comments_527838.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nTypical for example in element constructors where you want to handle conversions from a long list of element classes defined elsewhere. Instead of having to import all of these modules providing the implementation classes (which may be pulling in dependencies), you can do the `isinstance` testing against the ABC.",
    "created_at": "2023-01-07T02:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527838",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Typical for example in element constructors where you want to handle conversions from a long list of element classes defined elsewhere. Instead of having to import all of these modules providing the implementation classes (which may be pulling in dependencies), you can do the `isinstance` testing against the ABC.



---

archive/issue_comments_527839.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nPer meta-ticket #32414, \"each of the new abstract base classes is intended to have a unique direct implementation subclass. [...] Attempting to define new hierarchies of abstract base classes is beyond the scope\". The new ABCs `Polynomial`, `MPolynomial`, `InfinitePolynomial` fit this pattern (the new ABC `CommutativePolynomial` obviously does not)",
    "created_at": "2023-01-07T02:38:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527839",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Per meta-ticket #32414, "each of the new abstract base classes is intended to have a unique direct implementation subclass. [...] Attempting to define new hierarchies of abstract base classes is beyond the scope". The new ABCs `Polynomial`, `MPolynomial`, `InfinitePolynomial` fit this pattern (the new ABC `CommutativePolynomial` obviously does not)



---

archive/issue_comments_527840.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nIt seems like you're back to saying everything should have an ABC. What's the cutoff that you are using to distinguish between things that should have one and those that don't? Should all of the specific polynomial implementations have corresponding ABCs? This seems like a huge maintenance burden to duplicate these classes that can easily get out of sync.",
    "created_at": "2023-01-07T02:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527840",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

It seems like you're back to saying everything should have an ABC. What's the cutoff that you are using to distinguish between things that should have one and those that don't? Should all of the specific polynomial implementations have corresponding ABCs? This seems like a huge maintenance burden to duplicate these classes that can easily get out of sync.



---

archive/issue_comments_527841.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI'm introducing them as needed for the modularization.",
    "created_at": "2023-01-07T02:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527841",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

I'm introducing them as needed for the modularization.



---

archive/issue_comments_527842.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n`git grep 'isinstance.*Polynomial_.*_'` shows only a small number of isinstance tests with specific implementation classes. Some of them will indeed need similar work, but that is independent of the deprecation of `is_...` functions.",
    "created_at": "2023-01-07T02:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527842",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

`git grep 'isinstance.*Polynomial_.*_'` shows only a small number of isinstance tests with specific implementation classes. Some of them will indeed need similar work, but that is independent of the deprecation of `is_...` functions.



---

archive/issue_comments_527843.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI don't see how this extra class for infinitely generated polynomial rings helps that. It seems to be for a future problem that might not ever occur. As you said, for this class, it is never called outside of the files containing the parent and element definitions. (The key polynomials ticket will be explicitly be using them.) As such, adding this extra ABC is independent of the deprecation.\n\nIf you really are planning to have many classes with specific intermediate ABCs that need to be in 1-1 correspondence with concrete implementations, then they should have specific names and documentation to indicate that they should not be inherited from other classes.\n\nFor (multivariate) polynomials, it is natural to have these ABCs, where the implementor does not want to use what Sage's current ABCs already provide (as they provide partial implementations). I have this in some personal code that I haven't get prepped for inclusion into Sage.\n\nIf you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?",
    "created_at": "2023-01-07T03:02:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527843",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

I don't see how this extra class for infinitely generated polynomial rings helps that. It seems to be for a future problem that might not ever occur. As you said, for this class, it is never called outside of the files containing the parent and element definitions. (The key polynomials ticket will be explicitly be using them.) As such, adding this extra ABC is independent of the deprecation.

If you really are planning to have many classes with specific intermediate ABCs that need to be in 1-1 correspondence with concrete implementations, then they should have specific names and documentation to indicate that they should not be inherited from other classes.

For (multivariate) polynomials, it is natural to have these ABCs, where the implementor does not want to use what Sage's current ABCs already provide (as they provide partial implementations). I have this in some personal code that I haven't get prepped for inclusion into Sage.

If you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?



---

archive/issue_comments_527844.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [Travis Scrimshaw](#comment:49):\n> I don't see how this extra class for infinitely generated polynomial rings helps that. It seems to be for a future problem that might not ever occur.\n\nThat's right. I only introduced it because having it right next to the other classes in `sage.structure.element` helps clarify the nature of the `CommutativePolynomial` ABC",
    "created_at": "2023-01-07T03:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527844",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [Travis Scrimshaw](#comment:49):
> I don't see how this extra class for infinitely generated polynomial rings helps that. It seems to be for a future problem that might not ever occur.

That's right. I only introduced it because having it right next to the other classes in `sage.structure.element` helps clarify the nature of the `CommutativePolynomial` ABC



---

archive/issue_comments_527845.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [Travis Scrimshaw](#comment:49):\n> If you really are planning to have many classes with specific intermediate ABCs that need to be in 1-1 correspondence with concrete implementations, then they should have specific names and documentation to indicate that they should not be inherited from other classes.\n\nI have such doctests for the ABCs in `sage.rings.abc`. I'll add such doctests here too.",
    "created_at": "2023-01-07T03:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527845",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [Travis Scrimshaw](#comment:49):
> If you really are planning to have many classes with specific intermediate ABCs that need to be in 1-1 correspondence with concrete implementations, then they should have specific names and documentation to indicate that they should not be inherited from other classes.

I have such doctests for the ABCs in `sage.rings.abc`. I'll add such doctests here too.



---

archive/issue_comments_527846.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [Travis Scrimshaw](#comment:49):\n> If you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?\n\nI don't know what ABC the `InfinitePolynomial_*` classes implement. There's nothing that makes the promise that it is compatible with `MPolynomial`.",
    "created_at": "2023-01-07T03:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527846",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [Travis Scrimshaw](#comment:49):
> If you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?

I don't know what ABC the `InfinitePolynomial_*` classes implement. There's nothing that makes the promise that it is compatible with `MPolynomial`.



---

archive/issue_comments_527847.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:52):\n> Replying to [Travis Scrimshaw](#comment:49):\n> > If you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?\n\n> \n> I don't know what ABC the `InfinitePolynomial_*` classes implement. There's nothing that makes the promise that it is compatible with `MPolynomial`.\n\nThey aren't ABCs, they are actual concrete implementations.\n\n```\nsage: R.<x> = InfinitePolynomialRing(QQ)\nsage: type(x[1])\n<class 'sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_dense'>\nsage: R.<x> = InfinitePolynomialRing(QQ, implementation='sparse')\nsage: type(x[1])\n<class 'sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_sparse'>\n```\nThey are just wrappers around normal multivariate polynomials that grow the number of variables as needed. They are supposed to behave the same as other multivariate polynomials because of this. Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.",
    "created_at": "2023-01-07T03:18:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527847",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [Matthias Köppe](#comment:52):
> Replying to [Travis Scrimshaw](#comment:49):
> > If you want to consider the infinitely-generated polynomial ring elements as not being a specific implementation of the `MPolynomial` ABC, but instead deserve their own ABC, then can you give some justification for this?

> 
> I don't know what ABC the `InfinitePolynomial_*` classes implement. There's nothing that makes the promise that it is compatible with `MPolynomial`.

They aren't ABCs, they are actual concrete implementations.

```
sage: R.<x> = InfinitePolynomialRing(QQ)
sage: type(x[1])
<class 'sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_dense'>
sage: R.<x> = InfinitePolynomialRing(QQ, implementation='sparse')
sage: type(x[1])
<class 'sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_sparse'>
```
They are just wrappers around normal multivariate polynomials that grow the number of variables as needed. They are supposed to behave the same as other multivariate polynomials because of this. Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.



---

archive/issue_comments_527848.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7\">52da2d1</a></td><td><code>src/sage/structure/element.pyx: Add unique-direct-subclass tests</code></td></tr></table>\n",
    "created_at": "2023-01-07T03:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527848",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7">52da2d1</a></td><td><code>src/sage/structure/element.pyx: Add unique-direct-subclass tests</code></td></tr></table>




---

archive/issue_comments_527849.json:
```json
{
    "body": "Changed commit from **[`4050551`](https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e)** to **[`52da2d1`](https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7)**",
    "created_at": "2023-01-07T03:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527849",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4050551`](https://github.com/sagemath/sagetrac-mirror/commit/4050551b8361d4af459ac20aa400dc8f5d829b9e)** to **[`52da2d1`](https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7)**



---

archive/issue_comments_527850.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [Travis Scrimshaw](#comment:53):\n> They are just wrappers around normal multivariate polynomials that grow the number of variables as needed. \n\nYes, but I don't think they support all methods that multivariate polynomials support.",
    "created_at": "2023-01-07T03:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527850",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [Travis Scrimshaw](#comment:53):
> They are just wrappers around normal multivariate polynomials that grow the number of variables as needed. 

Yes, but I don't think they support all methods that multivariate polynomials support.



---

archive/issue_comments_527851.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [Travis Scrimshaw](#comment:53):\n> Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.\n\nNo, that is not what the `MPolynomial` ABC is doing. It's documented now that it has a unique direct subclass",
    "created_at": "2023-01-07T03:21:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527851",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [Travis Scrimshaw](#comment:53):
> Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.

No, that is not what the `MPolynomial` ABC is doing. It's documented now that it has a unique direct subclass



---

archive/issue_comments_527852.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:55):\n> Replying to [Travis Scrimshaw](#comment:53):\n> > They are just wrappers around normal multivariate polynomials that grow the number of variables as needed. \n\n> \n> Yes, but I don't think they support all methods that multivariate polynomials support.\n\nThey should unless it is something that depends on being finitely generated. I am not sure how much depends on that offhand.",
    "created_at": "2023-01-07T03:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527852",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [Matthias Köppe](#comment:55):
> Replying to [Travis Scrimshaw](#comment:53):
> > They are just wrappers around normal multivariate polynomials that grow the number of variables as needed. 

> 
> Yes, but I don't think they support all methods that multivariate polynomials support.

They should unless it is something that depends on being finitely generated. I am not sure how much depends on that offhand.



---

archive/issue_comments_527853.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nOh, I see, it's forwarding method calls using custom `__getattr__`.",
    "created_at": "2023-01-07T03:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527853",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

Oh, I see, it's forwarding method calls using custom `__getattr__`.



---

archive/issue_comments_527854.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAnd indeed the wrapped polynomial always belongs to an MPolynomialRing (even if there's only 1 variable.)",
    "created_at": "2023-01-07T03:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527854",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

And indeed the wrapped polynomial always belongs to an MPolynomialRing (even if there's only 1 variable.)



---

archive/issue_comments_527855.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:56):\n> Replying to [Travis Scrimshaw](#comment:53):\n> > Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.\n\n> \n> No, that is not what the `MPolynomial` ABC is doing. It's documented now that it has a unique direct subclass\n\nThat was not clear before. I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.\n\nThat also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.\n\nWe need another term other than ABC for such classes. Maybe adding an adjective.\n\nWe also need to have criteria/rules for when we need to add such a class and when not.\n\nHow do you plan to deal with multiple inheritance with Cython:\n\n```\nA < B\n|   |\na < b\n```\nwhere `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.",
    "created_at": "2023-01-07T03:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527855",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [Matthias Köppe](#comment:56):
> Replying to [Travis Scrimshaw](#comment:53):
> > Plus we have flexibility with the added `MPolynomial` ABC, which we do not have to impose that it is finitely generated.

> 
> No, that is not what the `MPolynomial` ABC is doing. It's documented now that it has a unique direct subclass

That was not clear before. I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.

That also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.

We need another term other than ABC for such classes. Maybe adding an adjective.

We also need to have criteria/rules for when we need to add such a class and when not.

How do you plan to deal with multiple inheritance with Cython:

```
A < B
|   |
a < b
```
where `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.



---

archive/issue_comments_527856.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [Travis Scrimshaw](#comment:60):\n> We need another term other than ABC for such classes. Maybe adding an adjective.\n\nI agree, that would be an improvement. Perhaps an ABCDEFIT, \"ABC defined exclusively for isinstance test\"",
    "created_at": "2023-01-07T03:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527856",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [Travis Scrimshaw](#comment:60):
> We need another term other than ABC for such classes. Maybe adding an adjective.

I agree, that would be an improvement. Perhaps an ABCDEFIT, "ABC defined exclusively for isinstance test"



---

archive/issue_comments_527857.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [Travis Scrimshaw](#comment:60):\n> How do you plan to deal with multiple inheritance with Cython:\n> \n> ```\n> A < B\n> |   |\n> a < b\n> ```\n> where `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.\n\nNo problem there; the ABCDEFITs can also just be Python mixin classes.",
    "created_at": "2023-01-07T03:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527857",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [Travis Scrimshaw](#comment:60):
> How do you plan to deal with multiple inheritance with Cython:
> 
> ```
> A < B
> |   |
> a < b
> ```
> where `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.

No problem there; the ABCDEFITs can also just be Python mixin classes.



---

archive/issue_comments_527858.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [Travis Scrimshaw](#comment:60):\n> I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.\n\nIn fact we should probably have a proper ABC that unifies univariate and multivariate polynomials. Definitely not this ticket.",
    "created_at": "2023-01-07T03:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527858",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [Travis Scrimshaw](#comment:60):
> I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.

In fact we should probably have a proper ABC that unifies univariate and multivariate polynomials. Definitely not this ticket.



---

archive/issue_comments_527859.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [Travis Scrimshaw](#comment:60):\n> That also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.\n\nHow about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?",
    "created_at": "2023-01-07T03:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527859",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [Travis Scrimshaw](#comment:60):
> That also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.

How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?



---

archive/issue_comments_527860.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:62):\n> Replying to [Travis Scrimshaw](#comment:60):\n> > How do you plan to deal with multiple inheritance with Cython:\n> > \n> > ```\n> > A < B\n> > |   |\n> > a < b\n> > ```\n> > where `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.\n\n> \n> No problem there; the ABCDEFITs can also just be Python mixin classes. \n\nThere is a bit of a performance one. You have to add another Python class corresponding to the actual classes you instantiate. So that Cython code has to go through those Python objects, not Cython, which adds a performance penalty as I understand it. (Plus there is yet another essentially empty class.)",
    "created_at": "2023-01-07T03:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527860",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [Matthias Köppe](#comment:62):
> Replying to [Travis Scrimshaw](#comment:60):
> > How do you plan to deal with multiple inheritance with Cython:
> > 
> > ```
> > A < B
> > |   |
> > a < b
> > ```
> > where `A,B` are the 1-1ABCs and `a` and `b` are the (more) concrete classes.

> 
> No problem there; the ABCDEFITs can also just be Python mixin classes. 

There is a bit of a performance one. You have to add another Python class corresponding to the actual classes you instantiate. So that Cython code has to go through those Python objects, not Cython, which adds a performance penalty as I understand it. (Plus there is yet another essentially empty class.)



---

archive/issue_comments_527861.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:63):\n> Replying to [Travis Scrimshaw](#comment:60):\n> > I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.\n\n> \n> In fact we should probably have a proper ABC that unifies univariate and multivariate polynomials. Definitely not this ticket.\n\nThat was what the `CommutativePolynomial` is going towards.",
    "created_at": "2023-01-07T03:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527861",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [Matthias Köppe](#comment:63):
> Replying to [Travis Scrimshaw](#comment:60):
> > I think we should have a proper ABC, in the actual sense of the term, for (multivariate) polynomials.

> 
> In fact we should probably have a proper ABC that unifies univariate and multivariate polynomials. Definitely not this ticket.

That was what the `CommutativePolynomial` is going towards.



---

archive/issue_comments_527862.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:64):\n> Replying to [Travis Scrimshaw](#comment:60):\n> > That also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.\n\n> \n> How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?\n\nI would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.",
    "created_at": "2023-01-07T03:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527862",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [Matthias Köppe](#comment:64):
> Replying to [Travis Scrimshaw](#comment:60):
> > That also brings about another maintenance burden: we are manually having to update the class hierarchy documentation. Although because they are 1-1 with more concrete implementations, they shouldn't appear there.

> 
> How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?

I would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.



---

archive/issue_comments_527863.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4\">c72dcc8</a></td><td><code>src/sage/structure/element.pyx: Add unique-direct-subclass test for Expression</code></td></tr></table>\n",
    "created_at": "2023-01-07T03:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527863",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4">c72dcc8</a></td><td><code>src/sage/structure/element.pyx: Add unique-direct-subclass test for Expression</code></td></tr></table>




---

archive/issue_comments_527864.json:
```json
{
    "body": "Changed commit from **[`52da2d1`](https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7)** to **[`c72dcc8`](https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4)**",
    "created_at": "2023-01-07T03:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527864",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52da2d1`](https://github.com/sagemath/sagetrac-mirror/commit/52da2d164f3cd3b23bbe5e6efd838f2a7680aea7)** to **[`c72dcc8`](https://github.com/sagemath/sagetrac-mirror/commit/c72dcc87e22385fa1d32047c1ea551dbb9d1c1b4)**



---

archive/issue_comments_527865.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [Travis Scrimshaw](#comment:65):\n> There is a bit of a performance one. You have to add another Python class corresponding to the actual classes you instantiate. So that Cython code has to go through those Python objects, not Cython, which adds a performance penalty as I understand it.\n\nI'm not concerned about this",
    "created_at": "2023-01-07T03:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527865",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [Travis Scrimshaw](#comment:65):
> There is a bit of a performance one. You have to add another Python class corresponding to the actual classes you instantiate. So that Cython code has to go through those Python objects, not Cython, which adds a performance penalty as I understand it.

I'm not concerned about this



---

archive/issue_comments_527866.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nSimilar changes in #32664 may be easier to review, as it is just using an existing ABC to get rid of the `is_...` functions",
    "created_at": "2023-01-07T03:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527866",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:70" align="right">comment:70</div>

Similar changes in #32664 may be easier to review, as it is just using an existing ABC to get rid of the `is_...` functions



---

archive/issue_comments_527867.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [Travis Scrimshaw](#comment:67):\n> Replying to [Matthias K\u00f6ppe](#comment:64):\n> > How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?\n\n> \n> I would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.\n\nWhat's the new quality of change compared to the previous #32638, #32606, etc.?",
    "created_at": "2023-01-07T03:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527867",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [Travis Scrimshaw](#comment:67):
> Replying to [Matthias Köppe](#comment:64):
> > How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?

> 
> I would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.

What's the new quality of change compared to the previous #32638, #32606, etc.?



---

archive/issue_comments_527868.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:71):\n> Replying to [Travis Scrimshaw](#comment:67):\n> > Replying to [Matthias K\u00f6ppe](#comment:64):\n> > > How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?\n\n> > \n> > I would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.\n\n> \n> What's the new quality of change compared to the previous #32638, #32606, etc.?\n\nI missed it for expression as I thought it was meant for more general implementations rather than a specific one. For the integer mod ring, we have different implementations, so I was thinking it was again a common ABC, not an ABEDEFIT. Mainly, I thought I was allowed to extend them and could see a reason for doing it. Here, we are doing it for something that IMO is for one specific implementation that at this point will likely not be used in a more abstract/generic way.",
    "created_at": "2023-01-07T04:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527868",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [Matthias Köppe](#comment:71):
> Replying to [Travis Scrimshaw](#comment:67):
> > Replying to [Matthias Köppe](#comment:64):
> > > How about I mark the ABCDEFITs in the documentation of this module (the new `*Polynomial` and the existing `Expression`) with some symbol and link to the developer's guide for the explanation of this design?

> > 
> > I would find that acceptable provided that we have a discussion on sage-devel about this since this implies a major structural change.

> 
> What's the new quality of change compared to the previous #32638, #32606, etc.?

I missed it for expression as I thought it was meant for more general implementations rather than a specific one. For the integer mod ring, we have different implementations, so I was thinking it was again a common ABC, not an ABEDEFIT. Mainly, I thought I was allowed to extend them and could see a reason for doing it. Here, we are doing it for something that IMO is for one specific implementation that at this point will likely not be used in a more abstract/generic way.



---

archive/issue_comments_527869.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nThat I am creating ABCDEFITs here and in the tickets of #32414 is basically to limit the scope of the tickets. There is nothing that would stop us from upgrading an ABCDEFIT to a \"proper\" ABC at some point in the future when there is a need for that. In this case we would remove the uniqueness doctest.",
    "created_at": "2023-01-07T04:48:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527869",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

That I am creating ABCDEFITs here and in the tickets of #32414 is basically to limit the scope of the tickets. There is nothing that would stop us from upgrading an ABCDEFIT to a "proper" ABC at some point in the future when there is a need for that. In this case we would remove the uniqueness doctest.



---

archive/issue_comments_527870.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n-... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).\n+The new classes `Polynomial` and `MPolynomial` are ABCs with a unique direct subclass (see Meta-ticket #32414 and https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies for this design pattern). Their purpose is that `isinstance(x, sage.structure.element.[M]Polynomial)` replaces the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).\n+\n+The new class `InfinitePolynomial` is also an ABC with a unique direct subclass. We introduce it here although there is currently no use of `isinstance(x, InfinitePolynomial...)` in the library.\n+\n+The new class `CommutativePolynomial` is an ABC that is a common base of `Polynomial`, `MPolynomial`, and `InfinitePolynomial`. We introduce it here although there is currently no use for `isinstance(x, CommutativePolynomial)` in the library.\n \n We also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.\n \n-Part of Meta-ticket #32414\n-\n``````\n",
    "created_at": "2023-01-07T18:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527870",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
-... replacing the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).
+The new classes `Polynomial` and `MPolynomial` are ABCs with a unique direct subclass (see Meta-ticket #32414 and https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies for this design pattern). Their purpose is that `isinstance(x, sage.structure.element.[M]Polynomial)` replaces the use of `is_Polynomial`, `is_MPolynomial` (deprecated here).
+
+The new class `InfinitePolynomial` is also an ABC with a unique direct subclass. We introduce it here although there is currently no use of `isinstance(x, InfinitePolynomial...)` in the library.
+
+The new class `CommutativePolynomial` is an ABC that is a common base of `Polynomial`, `MPolynomial`, and `InfinitePolynomial`. We introduce it here although there is currently no use for `isinstance(x, CommutativePolynomial)` in the library.
 
 We also make `sage.rings.polynomial` a namespace package; this is needed because element implementations depend on various libraries.
 
-Part of Meta-ticket #32414
-
``````




---

archive/issue_comments_527871.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nBut to do that, don't we need to add an additional proper ABC on top of the ABCDEFIT?\n\nI still do not see why the `InfinitePolynomialRing` deserves special treatment. Also why does it not inherit from a proper `MPolynomial` ABC?",
    "created_at": "2023-01-10T04:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527871",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:75" align="right">comment:75</div>

But to do that, don't we need to add an additional proper ABC on top of the ABCDEFIT?

I still do not see why the `InfinitePolynomialRing` deserves special treatment. Also why does it not inherit from a proper `MPolynomial` ABC?



---

archive/issue_comments_527872.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [Travis Scrimshaw](#comment:75):\n> I still do not see why the `InfinitePolynomialRing` deserves special treatment. \n\nI don't think it's treated more specially than the other two subclasses in this branch?\n\n> Also why does it not inherit from a proper `MPolynomial` ABC?\n\nI don't know why the implementation class `InfinitePolynomial_sparse` is not a subclass of the implementation class `MPolynomial`, but it isn't.",
    "created_at": "2023-01-10T05:27:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527872",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [Travis Scrimshaw](#comment:75):
> I still do not see why the `InfinitePolynomialRing` deserves special treatment. 

I don't think it's treated more specially than the other two subclasses in this branch?

> Also why does it not inherit from a proper `MPolynomial` ABC?

I don't know why the implementation class `InfinitePolynomial_sparse` is not a subclass of the implementation class `MPolynomial`, but it isn't.



---

archive/issue_comments_527873.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:76):\n> Replying to [Travis Scrimshaw](#comment:75):\n> > I still do not see why the `InfinitePolynomialRing` deserves special treatment. \n\n> \n> I don't think it's treated more specially than the other two subclasses in this branch?\n\nI guess that is the point I am a bit confused about. Why can't the `MPolynomial` in `element.pyx` be also used as a base class for `InfinitePolynomial_sparse`.\n\nBut let's assume that `MPolynomial` is an ABCDEFIT. The big difference is that the actual concrete implementations of `Polynomial` and `MPolynomial` are still ABCs, whereas `InfinitePolynomial_sparse` is a specific concrete implementation. Why not do the same thing for, say, the libsingular polynomials (in this case, this is explicitly tested against in the `algebras/fusion_ring` code)?\n\n> > Also why does it not inherit from a proper `MPolynomial` ABC?\n\n> \n> I don't know why the implementation class `InfinitePolynomial_sparse` is not a subclass of the implementation class `MPolynomial`, but it isn't.\n\nMy guess is that there are a few methods that assume that the ring is finitely generated (e.g., `gradient()`) and nobody thought to bring these together beforehand. Some slight refactoring would be needed, but it shouldn't be too hard.",
    "created_at": "2023-01-10T07:47:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527873",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [Matthias Köppe](#comment:76):
> Replying to [Travis Scrimshaw](#comment:75):
> > I still do not see why the `InfinitePolynomialRing` deserves special treatment. 

> 
> I don't think it's treated more specially than the other two subclasses in this branch?

I guess that is the point I am a bit confused about. Why can't the `MPolynomial` in `element.pyx` be also used as a base class for `InfinitePolynomial_sparse`.

But let's assume that `MPolynomial` is an ABCDEFIT. The big difference is that the actual concrete implementations of `Polynomial` and `MPolynomial` are still ABCs, whereas `InfinitePolynomial_sparse` is a specific concrete implementation. Why not do the same thing for, say, the libsingular polynomials (in this case, this is explicitly tested against in the `algebras/fusion_ring` code)?

> > Also why does it not inherit from a proper `MPolynomial` ABC?

> 
> I don't know why the implementation class `InfinitePolynomial_sparse` is not a subclass of the implementation class `MPolynomial`, but it isn't.

My guess is that there are a few methods that assume that the ring is finitely generated (e.g., `gradient()`) and nobody thought to bring these together beforehand. Some slight refactoring would be needed, but it shouldn't be too hard.



---

archive/issue_comments_527874.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [Travis Scrimshaw](#comment:77):\n> But let's assume that `MPolynomial` is an ABCDEFIT. The big difference is that the actual concrete implementations of `Polynomial` and `MPolynomial` are still ABCs, whereas `InfinitePolynomial_sparse` is a specific concrete implementation. \n\nNote that `InfinitePolynomial_dense` is a subclass of `InfinitePolynomial_sparse`. It would perhaps be cleaner if both were subclasses of an ABC `InfinitePolynomial_base`.\n\n> Why not do the same thing for, say, the libsingular polynomials (in this case, this is explicitly tested against in the `algebras/fusion_ring` code)?\n\nRight, I do see the `isinstance(fvar, MPolynomial_libsingular)` in `src/sage/algebras/fusion_rings/shm_managers.pyx`, and this isinstance test also shows up in a bunch of random modules elsewhere.\nFrom a quick look it is likely that indeed it would also be good to introduce an ABCDEFIT for it to get rid of this obstacle to modularization.",
    "created_at": "2023-01-10T08:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527874",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [Travis Scrimshaw](#comment:77):
> But let's assume that `MPolynomial` is an ABCDEFIT. The big difference is that the actual concrete implementations of `Polynomial` and `MPolynomial` are still ABCs, whereas `InfinitePolynomial_sparse` is a specific concrete implementation. 

Note that `InfinitePolynomial_dense` is a subclass of `InfinitePolynomial_sparse`. It would perhaps be cleaner if both were subclasses of an ABC `InfinitePolynomial_base`.

> Why not do the same thing for, say, the libsingular polynomials (in this case, this is explicitly tested against in the `algebras/fusion_ring` code)?

Right, I do see the `isinstance(fvar, MPolynomial_libsingular)` in `src/sage/algebras/fusion_rings/shm_managers.pyx`, and this isinstance test also shows up in a bunch of random modules elsewhere.
From a quick look it is likely that indeed it would also be good to introduce an ABCDEFIT for it to get rid of this obstacle to modularization.



---

archive/issue_comments_527875.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nI'll be happy to take care of this here on the ticket, although it widens the original scope of the ticket even more (as there is no corresponding `is_...` function).",
    "created_at": "2023-01-10T08:10:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527875",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:79" align="right">comment:79</div>

I'll be happy to take care of this here on the ticket, although it widens the original scope of the ticket even more (as there is no corresponding `is_...` function).



---

archive/issue_comments_527876.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nIf you don't mind doing it, then please go ahead. It would definitely be nice to factor out the `InfinitePolynomial_*` into a common ABC. I think it helps make clear about when to include ABCDEFITs.\n\nI am happy to do some extra reviewing. It might be more of a hassle to split off the new parts into a separate ticket.",
    "created_at": "2023-01-10T08:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32709#issuecomment-527876",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:80" align="right">comment:80</div>

If you don't mind doing it, then please go ahead. It would definitely be nice to factor out the `InfinitePolynomial_*` into a common ABC. I think it helps make clear about when to include ABCDEFITs.

I am happy to do some extra reviewing. It might be more of a hassle to split off the new parts into a separate ticket.
