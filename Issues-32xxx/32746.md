# Issue 32746: fedora-{26,27,...,34}-minimal: scipy build fails - openblas not found

archive/issues_032509.json:
```json
{
    "body": "for example, `fedora-34-minimal` https://github.com/mkoeppe/sage/runs/3968544625?check_suite_focus=true\n\n```\nNote: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,\n      so their current settings are ignored.\nInstalling scipy-1.6.3\nProcessing /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/scipy-1.6.3/src\n    Preparing wheel metadata: started\n    Running command /sage/local/var/lib/sage/venv-python3.9.7/bin/python3 /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpatw3swb6\n    setup.py:462: UserWarning: Unrecognized setuptools command ('dist_info --egg-base /tmp/pip-modern-metadata-assu7gnc'), proceeding with generating Cython sources and expanding templates\n      warnings.warn(\"Unrecognized setuptools command ('{}'), proceeding with \"\n    Running from SciPy source directory.\n    lapack_opt_info:\n[...]\n    lapack_info:\n      libraries openblas not found in ['/sage/local/var/lib/sage/venv-python3.9.7/lib', '/usr/local/lib64', '/usr/local/lib', '/usr/lib64', '/usr/lib', '/usr/lib/']\n      NOT AVAILABLE\n\n    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:\n        Lapack (http://www.netlib.org/lapack/) libraries not found.\n        Directories to search for the libraries can be specified in the\n        numpy/distutils/site.cfg file (section [lapack]) or by setting\n        the LAPACK environment variable.\n      return getattr(self, '_calc_info_{}'.format(name))()\n    lapack_src_info:\n      NOT AVAILABLE\n\n    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:\n        Lapack (http://www.netlib.org/lapack/) sources not found.\n        Directories to search for the sources can be specified in the\n        numpy/distutils/site.cfg file (section [lapack_src]) or by setting\n        the LAPACK_SRC environment variable.\n      return getattr(self, '_calc_info_{}'.format(name))()\n      NOT AVAILABLE\n\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 349, in <module>\n        main()\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 331, in main\n        json_out['return_val'] = hook(**hook_input['kwargs'])\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 151, in prepare_metadata_for_build_wheel\n        return hook(metadata_directory, config_settings)\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py\", line 166, in prepare_metadata_for_build_wheel\n        self.run_setup()\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py\", line 258, in run_setup\n        super(_BuildMetaLegacyBackend,\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py\", line 150, in run_setup\n        exec(compile(code, __file__, 'exec'), locals())\n      File \"setup.py\", line 598, in <module>\n        setup_package()\n      File \"setup.py\", line 594, in setup_package\n        setup(**metadata)\n      File \"/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/core.py\", line 135, in setup\n        config = configuration()\n      File \"setup.py\", line 500, in configuration\n        raise NotFoundError(msg)\n    numpy.distutils.system_info.NotFoundError: No BLAS/LAPACK libraries found.\n    To build Scipy from sources, BLAS & LAPACK libraries need to be installed.\n    See site.cfg.example in the Scipy source directory and\n    https://docs.scipy.org/doc/scipy/reference/building/index.html for details.\n    Preparing wheel metadata: finished with status 'error'\n```\n\nThis is another regression caused by #32442 (`./configure`: Make `--with-sage-venv=auto` the default).\n\n\n\n\n\nCC:  @dimpase @jhpalmieri\n\nBranch/Commit: 59d7245435b006946504f7c6a84aef42cbe66648\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32746\n\n",
    "closed_at": "2021-10-31T22:21:21Z",
    "created_at": "2021-10-23T15:47:13Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "fedora-{26,27,...,34}-minimal: scipy build fails - openblas not found",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32746",
    "user": "https://github.com/mkoeppe"
}
```
for example, `fedora-34-minimal` https://github.com/mkoeppe/sage/runs/3968544625?check_suite_focus=true

```
Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,
      so their current settings are ignored.
Installing scipy-1.6.3
Processing /sage/local/var/lib/sage/venv-python3.9.7/var/tmp/sage/build/scipy-1.6.3/src
    Preparing wheel metadata: started
    Running command /sage/local/var/lib/sage/venv-python3.9.7/bin/python3 /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmpatw3swb6
    setup.py:462: UserWarning: Unrecognized setuptools command ('dist_info --egg-base /tmp/pip-modern-metadata-assu7gnc'), proceeding with generating Cython sources and expanding templates
      warnings.warn("Unrecognized setuptools command ('{}'), proceeding with "
    Running from SciPy source directory.
    lapack_opt_info:
[...]
    lapack_info:
      libraries openblas not found in ['/sage/local/var/lib/sage/venv-python3.9.7/lib', '/usr/local/lib64', '/usr/local/lib', '/usr/lib64', '/usr/lib', '/usr/lib/']
      NOT AVAILABLE

    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:
        Lapack (http://www.netlib.org/lapack/) libraries not found.
        Directories to search for the libraries can be specified in the
        numpy/distutils/site.cfg file (section [lapack]) or by setting
        the LAPACK environment variable.
      return getattr(self, '_calc_info_{}'.format(name))()
    lapack_src_info:
      NOT AVAILABLE

    /sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/system_info.py:1858: UserWarning:
        Lapack (http://www.netlib.org/lapack/) sources not found.
        Directories to search for the sources can be specified in the
        numpy/distutils/site.cfg file (section [lapack_src]) or by setting
        the LAPACK_SRC environment variable.
      return getattr(self, '_calc_info_{}'.format(name))()
      NOT AVAILABLE

    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 349, in <module>
        main()
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 331, in main
        json_out['return_val'] = hook(**hook_input['kwargs'])
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 151, in prepare_metadata_for_build_wheel
        return hook(metadata_directory, config_settings)
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 166, in prepare_metadata_for_build_wheel
        self.run_setup()
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 258, in run_setup
        super(_BuildMetaLegacyBackend,
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/setuptools/build_meta.py", line 150, in run_setup
        exec(compile(code, __file__, 'exec'), locals())
      File "setup.py", line 598, in <module>
        setup_package()
      File "setup.py", line 594, in setup_package
        setup(**metadata)
      File "/sage/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/numpy/distutils/core.py", line 135, in setup
        config = configuration()
      File "setup.py", line 500, in configuration
        raise NotFoundError(msg)
    numpy.distutils.system_info.NotFoundError: No BLAS/LAPACK libraries found.
    To build Scipy from sources, BLAS & LAPACK libraries need to be installed.
    See site.cfg.example in the Scipy source directory and
    https://docs.scipy.org/doc/scipy/reference/building/index.html for details.
    Preparing wheel metadata: finished with status 'error'
```

This is another regression caused by #32442 (`./configure`: Make `--with-sage-venv=auto` the default).





CC:  @dimpase @jhpalmieri

Branch/Commit: 59d7245435b006946504f7c6a84aef42cbe66648

Reviewer: John Palmieri

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32746





---

archive/issue_comments_463089.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-10-23T15:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463089",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_463090.json:
```json
{
    "body": "<a id='comment:3'></a>To test the fix: `tox -e docker-fedora-34-minimal -- scipy`",
    "created_at": "2021-10-23T20:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463090",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>To test the fix: `tox -e docker-fedora-34-minimal -- scipy`



---

archive/issue_comments_463091.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2021-10-23T20:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463091",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_463092.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-23T20:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463092",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463093.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 mkoeppe]:\n> To test the fix: `tox -e docker-fedora-34-minimal -- scipy`\n... tested successfully.",
    "created_at": "2021-10-23T20:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463093",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Replying to [comment:3 mkoeppe]:
> To test the fix: `tox -e docker-fedora-34-minimal -- scipy`
... tested successfully.



---

archive/issue_comments_463094.json:
```json
{
    "body": "<a id='comment:7'></a>Let's get this in please",
    "created_at": "2021-10-26T20:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463094",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Let's get this in please



---

archive/issue_comments_463095.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-26T23:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463095",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463096.json:
```json
{
    "body": "<a id='comment:8'></a>It works for me. Looks good.",
    "created_at": "2021-10-26T23:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463096",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>It works for me. Looks good.



---

archive/issue_comments_463097.json:
```json
{
    "body": "<a id='comment:9'></a>Thank you!",
    "created_at": "2021-10-26T23:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Thank you!



---

archive/issue_comments_463098.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-31T22:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32746#issuecomment-463098",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-31T22:21:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32746#event-86668"
}
```
