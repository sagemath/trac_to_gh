# Issue 32701: sage.rings.{real,complex}_double: Remove compile time dependency on cypari2

archive/issues_032464.json:
```json
{
    "body": "... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.\n\nThis is to support modularization (#29705):\n- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce`) fully functional without having to pull in PARI (at compile time or run time)\n- likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).\n\n\nCC:  @kliem @videlec @tscrim @yyyyx4\n\nBranch/Commit: [629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)\n\nReviewer: Matthias Koeppe, Travis Scrimshaw\n\nAuthor: Matthias Koeppe, Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32701\n\n",
    "closed_at": "2021-10-31T22:21:08Z",
    "created_at": "2021-10-16T03:20:55Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "sage.rings.{real,complex}_double: Remove compile time dependency on cypari2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32701",
    "user": "https://github.com/mkoeppe"
}
```
... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.

This is to support modularization (#29705):
- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce`) fully functional without having to pull in PARI (at compile time or run time)
- likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).


CC:  @kliem @videlec @tscrim @yyyyx4

Branch/Commit: [629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)

Reviewer: Matthias Koeppe, Travis Scrimshaw

Author: Matthias Koeppe, Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32701





---

archive/issue_comments_651704.json:
```json
{
    "body": "Branch: [u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)",
    "created_at": "2021-10-22T01:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651704",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)



---

archive/issue_comments_651705.json:
```json
{
    "body": "Author: Matthias Koeppe, ...",
    "created_at": "2021-10-22T01:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651705",
    "user": "https://github.com/mkoeppe"
}
```

Author: Matthias Koeppe, ...



---

archive/issue_comments_651706.json:
```json
{
    "body": "<a id='comment:3'></a>\nHere's an attempt but I'm getting doctest errors:\n\n```\nsage -t --random-seed=0 src/sage/rings/polynomial/polynomial_element.pyx\n      File \"sage/rings/complex_double.pyx\", line 387, in sage.rings.complex_double.ComplexDoubleField_class._element_constructor_ (build/cythonized/sage/rings/complex_double.c:6109)\n        return ComplexDoubleElement(x, 0)\n      File \"sage/rings/complex_double.pyx\", line 755, in sage.rings.complex_double.ComplexDoubleElement.__init__ (build/cythonized/sage/rings/complex_double.c:9194)\n        self._complex = gsl_complex_rect(real, imag)\n      File \"cypari2/gen.pyx\", line 2002, in cypari2.gen.Gen.__float__\n      File \"cypari2/handle_error.pyx\", line 213, in cypari2.handle_error._pari_err_handle\n    cypari2.handle_error.PariError: incorrect type in gtodouble [t_REAL expected] (t_COMPLEX)\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|\n|[2cc2fa7](https://github.com/sagemath/sagetrac-mirror/commit/2cc2fa71426e061bd030e85177766cd7c5dd05c4)|`src/sage/rings/real_double.pyx: Replace cimport from cypari.convert by method-local import`|\n|[d641dc6](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)|`src/sage/rings/complex_double.pyx: Move PARI conversion functions to src/sage/libs/pari/`|",
    "created_at": "2021-10-22T01:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651706",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Here's an attempt but I'm getting doctest errors:

```
sage -t --random-seed=0 src/sage/rings/polynomial/polynomial_element.pyx
      File "sage/rings/complex_double.pyx", line 387, in sage.rings.complex_double.ComplexDoubleField_class._element_constructor_ (build/cythonized/sage/rings/complex_double.c:6109)
        return ComplexDoubleElement(x, 0)
      File "sage/rings/complex_double.pyx", line 755, in sage.rings.complex_double.ComplexDoubleElement.__init__ (build/cythonized/sage/rings/complex_double.c:9194)
        self._complex = gsl_complex_rect(real, imag)
      File "cypari2/gen.pyx", line 2002, in cypari2.gen.Gen.__float__
      File "cypari2/handle_error.pyx", line 213, in cypari2.handle_error._pari_err_handle
    cypari2.handle_error.PariError: incorrect type in gtodouble [t_REAL expected] (t_COMPLEX)
```

---
New commits:
|                                                                                                                                          |                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
|[2cc2fa7](https://github.com/sagemath/sagetrac-mirror/commit/2cc2fa71426e061bd030e85177766cd7c5dd05c4)|`src/sage/rings/real_double.pyx: Replace cimport from cypari.convert by method-local import`|
|[d641dc6](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)|`src/sage/rings/complex_double.pyx: Move PARI conversion functions to src/sage/libs/pari/`|



---

archive/issue_comments_651707.json:
```json
{
    "body": "Commit: [d641dc6a081eb018a694a78795e8a23097604757](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)",
    "created_at": "2021-10-22T01:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651707",
    "user": "https://github.com/mkoeppe"
}
```

Commit: [d641dc6a081eb018a694a78795e8a23097604757](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)



---

archive/issue_comments_651708.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\"",
    "created_at": "2021-10-25T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651708",
    "user": "https://github.com/kliem"
}
```

Changing branch from "[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)"



---

archive/issue_comments_651709.json:
```json
{
    "body": "Changing commit from \"[d641dc6a081eb018a694a78795e8a23097604757](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)\" to \"[bc1710c61fa8b9abb3f53bec78c121e16ac68ae8](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)\"",
    "created_at": "2021-10-25T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651709",
    "user": "https://github.com/kliem"
}
```

Changing commit from "[d641dc6a081eb018a694a78795e8a23097604757](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)" to "[bc1710c61fa8b9abb3f53bec78c121e16ac68ae8](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)"



---

archive/issue_comments_651710.json:
```json
{
    "body": "<a id='comment:4'></a>\nChecking the most obvious thing helped:\n\n```\nsage: from sage.rings.complex_double import pari_gen\nsage: pari_gen\n()\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                                                                                                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[e43dfad](https://github.com/sagemath/sagetrac-mirror/commit/e43dfad561d3cc0f7b659b89eb4b2041e970fc20)|`Merge branch 'u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2' of git://trac.sagemath.org/sage into u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|\n|[bc1710c](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)|`fix incorrect import`|",
    "created_at": "2021-10-25T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651710",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>
Checking the most obvious thing helped:

```
sage: from sage.rings.complex_double import pari_gen
sage: pari_gen
()
```

---
New commits:
|                                                                                                                                          |                                                                                                                                                                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[e43dfad](https://github.com/sagemath/sagetrac-mirror/commit/e43dfad561d3cc0f7b659b89eb4b2041e970fc20)|`Merge branch 'u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2' of git://trac.sagemath.org/sage into u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|
|[bc1710c](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)|`fix incorrect import`|



---

archive/issue_comments_651711.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Jonathan Kliem\"",
    "created_at": "2021-10-25T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651711",
    "user": "https://github.com/kliem"
}
```

Changing author from "Matthias Koeppe, ..." to "Matthias Koeppe, Jonathan Kliem"



---

archive/issue_comments_651712.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[71b62be](https://github.com/sagemath/sagetrac-mirror/commit/71b62be886046fe6c1fe0eb6b8ba543d90ec0293)|`new_gen_from_double not available as python function`|\n|[64984be](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)|`coverage`|",
    "created_at": "2021-10-25T13:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[71b62be](https://github.com/sagemath/sagetrac-mirror/commit/71b62be886046fe6c1fe0eb6b8ba543d90ec0293)|`new_gen_from_double not available as python function`|
|[64984be](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)|`coverage`|



---

archive/issue_comments_651713.json:
```json
{
    "body": "Changing commit from \"[bc1710c61fa8b9abb3f53bec78c121e16ac68ae8](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)\" to \"[64984beb812c93dfc7572eb32b0f4f7c822f9f82](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)\"",
    "created_at": "2021-10-25T13:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[bc1710c61fa8b9abb3f53bec78c121e16ac68ae8](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)" to "[64984beb812c93dfc7572eb32b0f4f7c822f9f82](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)"



---

archive/issue_comments_651714.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-25T13:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651714",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_651715.json:
```json
{
    "body": "<a id='comment:7'></a>\nThank you! Let's wait for the patchbot",
    "created_at": "2021-10-25T15:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651715",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Thank you! Let's wait for the patchbot



---

archive/issue_comments_651716.json:
```json
{
    "body": "<a id='comment:8'></a>\nTesting locally, I am seeing:\n\n```\n[sagelib-9.5.beta4] warning: sage/libs/pari/convert_sage_complex_double.pxd:4:44: Declarations should not be declared inline.\n[sagelib-9.5.beta4] warning: sage/libs/pari/convert_sage_complex_double.pyx:9:6: Function 'pari_to_cdf' previously declared as 'cpdef'\n```",
    "created_at": "2021-10-25T21:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651716",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Testing locally, I am seeing:

```
[sagelib-9.5.beta4] warning: sage/libs/pari/convert_sage_complex_double.pxd:4:44: Declarations should not be declared inline.
[sagelib-9.5.beta4] warning: sage/libs/pari/convert_sage_complex_double.pyx:9:6: Function 'pari_to_cdf' previously declared as 'cpdef'
```



---

archive/issue_comments_651717.json:
```json
{
    "body": "Changing branch from \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\"",
    "created_at": "2021-10-25T22:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651717",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)"



---

archive/issue_comments_651718.json:
```json
{
    "body": "Reviewer: ..., Matthias Koeppe",
    "created_at": "2021-10-25T22:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651718",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: ..., Matthias Koeppe



---

archive/issue_comments_651719.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|\n|[16d2850](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)|`src/sage/libs/pari/convert_sage_complex_double.pxd (pari_to_cdf): cdef inline -> cpdef`|",
    "created_at": "2021-10-25T22:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|
|[16d2850](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)|`src/sage/libs/pari/convert_sage_complex_double.pxd (pari_to_cdf): cdef inline -> cpdef`|



---

archive/issue_comments_651720.json:
```json
{
    "body": "Changing commit from \"[64984beb812c93dfc7572eb32b0f4f7c822f9f82](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)\" to \"[16d28509023cd429a4fd82a9ba3aec6037868244](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)\"",
    "created_at": "2021-10-25T22:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[64984beb812c93dfc7572eb32b0f4f7c822f9f82](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)" to "[16d28509023cd429a4fd82a9ba3aec6037868244](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)"



---

archive/issue_comments_651721.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think this requires some checking for speed regressions because the function is both no longer `inline` nor `cimport`-ed, and I could see this being used in a tight loop.",
    "created_at": "2021-10-26T05:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651721",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
I think this requires some checking for speed regressions because the function is both no longer `inline` nor `cimport`-ed, and I could see this being used in a tight loop.



---

archive/issue_comments_651722.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A13):\n> I think this requires some checking for speed regressions because the function is both no longer `inline` nor `cimport`-ed, and I could see this being used in a tight loop.\n\n\nThings get about 1\u00b5s slower:\n\nBefore:\n\n```\nsage: a = CDF(1,2)\nsage: %timeit a.__pari__()\n199 ns \u00b1 0.214 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit CDF(p)\n310 ns \u00b1 0.827 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: b = RDF(1.3)\nsage: %timeit b.__pari__()\n160 ns \u00b1 0.128 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = b.__pari__()\nsage: %timeit RDF(p)\n174 ns \u00b1 2.06 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.eta()\n7.99 \u00b5s \u00b1 12.5 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each) \nsage: %timeit a.dilog()\n46.2 \u00b5s \u00b1 64.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit a.gamma()\n33.5 \u00b5s \u00b1 59.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit a.zeta()\n74.4 \u00b5s \u00b1 726 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nAfter:\n\n```\nsage: a = CDF(1,2)\nsage: %timeit a.__pari__()\n736 ns \u00b1 0.283 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit CDF(p)\n327 ns \u00b1 0.544 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: b = RDF(1.3)\nsage: %timeit b.__pari__()\n707 ns \u00b1 0.792 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = b.__pari__()\nsage: %timeit RDF(p)\n157 ns \u00b1 0.072 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.eta()\n9.31 \u00b5s \u00b1 32.7 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit a.dilog()\n48.1 \u00b5s \u00b1 389 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit a.gamma()\n36.8 \u00b5s \u00b1 549 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit a.zeta()\n76.2 \u00b5s \u00b1 1.62 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nI doubt that calling `__pari__` or `_element_constructor_` is the crucial task of some algorithm.\n\nIf the regression is a problem, we could find a faster way to deal with the whole `pari_to_cdf(self.__pari__()...)` calls, e.g.\n\n```diff\ndiff --git a/src/sage/libs/pari/convert_sage_complex_double.pyx b/src/sage/libs/pari/convert_sage_complex_double.pyx\nindex 5a04aff7f6..f8859a7dea 100644\n--- a/src/sage/libs/pari/convert_sage_complex_double.pyx\n+++ b/src/sage/libs/pari/convert_sage_complex_double.pyx\n@@ -58,3 +58,6 @@ cpdef Gen new_gen_from_complex_double_element(ComplexDoubleElement self):\n         return new_gen_from_double(self._complex.real)\n     else:\n         return new_t_COMPLEX_from_double(self._complex.real, self._complex.imag)\n+\n+cpdef ComplexDoubleElement complex_double_eta(ComplexDoubleElement self, int flag):\n+    return pari_to_cdf(new_gen_from_complex_double_element(self).eta(flag))\ndiff --git a/src/sage/rings/complex_double.pyx b/src/sage/rings/complex_double.pyx\nindex ecc326b439..0aef6a3aad 100644\n--- a/src/sage/rings/complex_double.pyx\n+++ b/src/sage/rings/complex_double.pyx\n@@ -92,9 +92,11 @@ from sage.structure.coerce cimport is_numpy_type\n try:\n     from cypari2.gen import Gen as pari_gen\n     from sage.libs.pari.convert_sage_complex_double import pari_to_cdf\n+    from sage.libs.pari.convert_sage_complex_double import complex_double_eta\n \n except ImportError:\n     pari_gen = ()\n+    complex_double_eta = None\n \n from . import complex_mpfr\n \n@@ -2241,8 +2243,11 @@ cdef class ComplexDoubleElement(FieldElement):\n             # this, PARI can easily underflow.\n             return ComplexDoubleElement(0,0)\n \n+        if complex_double_eta is None:\n+            raise ImportError(\"pari not found\")\n+\n         cdef int flag = 0 if omit_frac else 1\n-        return pari_to_cdf(self.__pari__().eta(flag))\n+        return complex_double_eta(self, flag)\n```\n\nThis is even faster than the original approach with new timing being:\n\n```\nsage: a = CDF(1,2)\nsage: %timeit a.eta()\n7.89 \u00b5s \u00b1 9.65 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nThis approach could be used anywhere but to speed up `__pari__` and `_element_constructor_`.",
    "created_at": "2021-10-26T08:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651722",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A13):
> I think this requires some checking for speed regressions because the function is both no longer `inline` nor `cimport`-ed, and I could see this being used in a tight loop.


Things get about 1µs slower:

Before:

```
sage: a = CDF(1,2)
sage: %timeit a.__pari__()
199 ns ± 0.214 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit CDF(p)
310 ns ± 0.827 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: b = RDF(1.3)
sage: %timeit b.__pari__()
160 ns ± 0.128 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = b.__pari__()
sage: %timeit RDF(p)
174 ns ± 2.06 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.eta()
7.99 µs ± 12.5 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each) 
sage: %timeit a.dilog()
46.2 µs ± 64.8 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit a.gamma()
33.5 µs ± 59.2 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit a.zeta()
74.4 µs ± 726 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

After:

```
sage: a = CDF(1,2)
sage: %timeit a.__pari__()
736 ns ± 0.283 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit CDF(p)
327 ns ± 0.544 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: b = RDF(1.3)
sage: %timeit b.__pari__()
707 ns ± 0.792 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = b.__pari__()
sage: %timeit RDF(p)
157 ns ± 0.072 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.eta()
9.31 µs ± 32.7 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit a.dilog()
48.1 µs ± 389 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit a.gamma()
36.8 µs ± 549 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit a.zeta()
76.2 µs ± 1.62 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

I doubt that calling `__pari__` or `_element_constructor_` is the crucial task of some algorithm.

If the regression is a problem, we could find a faster way to deal with the whole `pari_to_cdf(self.__pari__()...)` calls, e.g.

```diff
diff --git a/src/sage/libs/pari/convert_sage_complex_double.pyx b/src/sage/libs/pari/convert_sage_complex_double.pyx
index 5a04aff7f6..f8859a7dea 100644
--- a/src/sage/libs/pari/convert_sage_complex_double.pyx
+++ b/src/sage/libs/pari/convert_sage_complex_double.pyx
@@ -58,3 +58,6 @@ cpdef Gen new_gen_from_complex_double_element(ComplexDoubleElement self):
         return new_gen_from_double(self._complex.real)
     else:
         return new_t_COMPLEX_from_double(self._complex.real, self._complex.imag)
+
+cpdef ComplexDoubleElement complex_double_eta(ComplexDoubleElement self, int flag):
+    return pari_to_cdf(new_gen_from_complex_double_element(self).eta(flag))
diff --git a/src/sage/rings/complex_double.pyx b/src/sage/rings/complex_double.pyx
index ecc326b439..0aef6a3aad 100644
--- a/src/sage/rings/complex_double.pyx
+++ b/src/sage/rings/complex_double.pyx
@@ -92,9 +92,11 @@ from sage.structure.coerce cimport is_numpy_type
 try:
     from cypari2.gen import Gen as pari_gen
     from sage.libs.pari.convert_sage_complex_double import pari_to_cdf
+    from sage.libs.pari.convert_sage_complex_double import complex_double_eta
 
 except ImportError:
     pari_gen = ()
+    complex_double_eta = None
 
 from . import complex_mpfr
 
@@ -2241,8 +2243,11 @@ cdef class ComplexDoubleElement(FieldElement):
             # this, PARI can easily underflow.
             return ComplexDoubleElement(0,0)
 
+        if complex_double_eta is None:
+            raise ImportError("pari not found")
+
         cdef int flag = 0 if omit_frac else 1
-        return pari_to_cdf(self.__pari__().eta(flag))
+        return complex_double_eta(self, flag)
```

This is even faster than the original approach with new timing being:

```
sage: a = CDF(1,2)
sage: %timeit a.eta()
7.89 µs ± 9.65 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

This approach could be used anywhere but to speed up `__pari__` and `_element_constructor_`.



---

archive/issue_comments_651723.json:
```json
{
    "body": "<a id='comment:15'></a>\nThank you for doing the timings. If someone is using polynomials or matrices over RDF/CDF and then running a PARI algorithm on them and has to convert back and forth, then this could have some noticeable effects on speed. With this, that main thing it would be going through is `__pari__` and `_element_constructor_`. Although my suspicion is that this would not have a major impact, if someone is doing that.\n\nPerhaps this is just the cost of doing business, but I would have expected this to be okay to do. To be precise about \"this\", I mean implementing a Cython conversion to/from a library. How useful is this to modularization?\n\nI am actually more worried about #30022 having an actual impact on calculations because `ZZ` and `QQ` are much more common for base ring computations.",
    "created_at": "2021-10-26T11:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651723",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
Thank you for doing the timings. If someone is using polynomials or matrices over RDF/CDF and then running a PARI algorithm on them and has to convert back and forth, then this could have some noticeable effects on speed. With this, that main thing it would be going through is `__pari__` and `_element_constructor_`. Although my suspicion is that this would not have a major impact, if someone is doing that.

Perhaps this is just the cost of doing business, but I would have expected this to be okay to do. To be precise about "this", I mean implementing a Cython conversion to/from a library. How useful is this to modularization?

I am actually more worried about #30022 having an actual impact on calculations because `ZZ` and `QQ` are much more common for base ring computations.



---

archive/issue_comments_651724.json:
```json
{
    "body": "<a id='comment:16'></a>\nIf you really want to be fast, you should with `__pari__` and `_element_constructor_` you can use `pari_to_cdf` or `new_gen_from_complex_double_element` directly:\n\n```\nsage: from sage.libs.pari.convert_sage_complex_double import pari_to_cdf, new_gen_from_complex_double_element\nsage: a = CDF(1,2)\nsage: %timeit new_gen_from_complex_double_element(a)\n182 ns \u00b1 0.109 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit pari_to_cdf(p)\n106 ns \u00b1 0.0893 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\n```\n\nIn that way, this ticket is an improvement. I'm fixing the other use cases and I will also see, whether #30022 can be improved.",
    "created_at": "2021-10-26T11:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651724",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>
If you really want to be fast, you should with `__pari__` and `_element_constructor_` you can use `pari_to_cdf` or `new_gen_from_complex_double_element` directly:

```
sage: from sage.libs.pari.convert_sage_complex_double import pari_to_cdf, new_gen_from_complex_double_element
sage: a = CDF(1,2)
sage: %timeit new_gen_from_complex_double_element(a)
182 ns ± 0.109 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = a.__pari__()
sage: %timeit pari_to_cdf(p)
106 ns ± 0.0893 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
```

In that way, this ticket is an improvement. I'm fixing the other use cases and I will also see, whether #30022 can be improved.



---

archive/issue_comments_651725.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\"",
    "created_at": "2021-10-26T11:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651725",
    "user": "https://github.com/kliem"
}
```

Changing branch from "[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)"



---

archive/issue_comments_651726.json:
```json
{
    "body": "<a id='comment:17'></a>\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[388b05f](https://github.com/sagemath/sagetrac-mirror/commit/388b05f54be5419a1c0f68c765a6e6064301e1ac)|`speed up conversion for complex double`|\n|[a64d72b](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)|`speed up conversion from real double`|",
    "created_at": "2021-10-26T11:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651726",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[388b05f](https://github.com/sagemath/sagetrac-mirror/commit/388b05f54be5419a1c0f68c765a6e6064301e1ac)|`speed up conversion for complex double`|
|[a64d72b](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)|`speed up conversion from real double`|



---

archive/issue_comments_651727.json:
```json
{
    "body": "Changing commit from \"[16d28509023cd429a4fd82a9ba3aec6037868244](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)\" to \"[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)\"",
    "created_at": "2021-10-26T11:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651727",
    "user": "https://github.com/kliem"
}
```

Changing commit from "[16d28509023cd429a4fd82a9ba3aec6037868244](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)" to "[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)"



---

archive/issue_comments_651728.json:
```json
{
    "body": "<a id='comment:18'></a>\nBefore this ticket:\n\n```\nsage: a = RDF(2.3)\nsage: %timeit a.__pari__()\n174 ns \u00b1 0.0989 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit RDF(p)\n161 ns \u00b1 0.0978 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: a = CDF(1,1)\nsage: %timeit a.__pari__()\n205 ns \u00b1 0.299 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit CDF(p)\n323 ns \u00b1 0.852 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.eta()\n7.38 \u00b5s \u00b1 18.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit a.gamma()\n33.2 \u00b5s \u00b1 74.6 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nWith this ticket:\n\n```\nsage: a = RDF(2.3)\nsage: %timeit a.__pari__()\n173 ns \u00b1 0.137 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit RDF(p)\n170 ns \u00b1 0.109 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: a = CDF(1,1)\nsage: %timeit a.__pari__()\n214 ns \u00b1 0.392 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit CDF(p)\n376 ns \u00b1 0.567 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.eta()\n7.41 \u00b5s \u00b1 18.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit a.gamma()\n33.2 \u00b5s \u00b1 42.6 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```",
    "created_at": "2021-10-26T12:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651728",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'></a>
Before this ticket:

```
sage: a = RDF(2.3)
sage: %timeit a.__pari__()
174 ns ± 0.0989 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = a.__pari__()
sage: %timeit RDF(p)
161 ns ± 0.0978 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: a = CDF(1,1)
sage: %timeit a.__pari__()
205 ns ± 0.299 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit CDF(p)
323 ns ± 0.852 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.eta()
7.38 µs ± 18.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit a.gamma()
33.2 µs ± 74.6 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

With this ticket:

```
sage: a = RDF(2.3)
sage: %timeit a.__pari__()
173 ns ± 0.137 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = a.__pari__()
sage: %timeit RDF(p)
170 ns ± 0.109 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: a = CDF(1,1)
sage: %timeit a.__pari__()
214 ns ± 0.392 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit CDF(p)
376 ns ± 0.567 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.eta()
7.41 µs ± 18.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit a.gamma()
33.2 µs ± 42.6 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```



---

archive/issue_comments_651729.json:
```json
{
    "body": "<a id='comment:19'></a>\nThat requires more understanding of the internal workings of Sage, is not local to the parent object, and is not flexible when the parent changes. So I am not sure it is the best path.\n\nHowever, at least with these changes, the effect on the function calls are minimized.",
    "created_at": "2021-10-26T12:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651729",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
That requires more understanding of the internal workings of Sage, is not local to the parent object, and is not flexible when the parent changes. So I am not sure it is the best path.

However, at least with these changes, the effect on the function calls are minimized.



---

archive/issue_comments_651730.json:
```json
{
    "body": "<a id='comment:20'></a>\nYes, having things fast out of the box without extra tricks is important.",
    "created_at": "2021-10-26T12:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651730",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
Yes, having things fast out of the box without extra tricks is important.



---

archive/issue_comments_651731.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n-... like done in #30022\n+... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.\n+\n+This is to support modularization (#29705):\n+- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce) fully functional without having to pull in PARI (at compile time or run time)\n+- likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).\n+\n``````\n",
    "created_at": "2021-10-26T17:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651731",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
-... like done in #30022
+... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.
+
+This is to support modularization (#29705):
+- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce) fully functional without having to pull in PARI (at compile time or run time)
+- likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).
+
``````




---

archive/issue_comments_651732.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [tscrim](#comment%3A15):\n>  How useful is this to modularization?\n\n\nNot sure if I'm answering this in the right context of your question, but I have expanded the ticket description to explain the motivation for this ticket.",
    "created_at": "2021-10-26T17:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651732",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Replying to [tscrim](#comment%3A15):
>  How useful is this to modularization?


Not sure if I'm answering this in the right context of your question, but I have expanded the ticket description to explain the motivation for this ticket.



---

archive/issue_comments_651733.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n ... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.\n \n This is to support modularization (#29705):\n-- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce) fully functional without having to pull in PARI (at compile time or run time)\n+- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce`) fully functional without having to pull in PARI (at compile time or run time)\n - likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).\n \n``````\n",
    "created_at": "2021-10-27T00:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651733",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 ... as previously done in #30022 for `sage.rings.integer` and `sage.rings.rational`.
 
 This is to support modularization (#29705):
-- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce) fully functional without having to pull in PARI (at compile time or run time)
+- in particular, for **sagemath-categories** (#29865), to make the functions `py_scalar_parent` and `py_scalar_to_element` (from  `sage.structure.coerce`) fully functional without having to pull in PARI (at compile time or run time)
 - likewise, for **sagemath-polyhedra** (#32432) to support floating-point polyhedra and linear programming without having to pull in PARI (at compile time or run time).
 
``````




---

archive/issue_comments_651734.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-27T00:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651734",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_651735.json:
```json
{
    "body": "Changing reviewer from \"..., Matthias Koeppe\" to \"Matthias Koeppe, Travis Scrimshaw\"",
    "created_at": "2021-10-27T00:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651735",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "..., Matthias Koeppe" to "Matthias Koeppe, Travis Scrimshaw"



---

archive/issue_comments_651736.json:
```json
{
    "body": "<a id='comment:23'></a>\nThat was what I was after. Thank you.\n\nThe current version LGTM.",
    "created_at": "2021-10-27T00:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651736",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
That was what I was after. Thank you.

The current version LGTM.



---

archive/issue_comments_651737.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks for reviewing!",
    "created_at": "2021-10-27T00:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651737",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Thanks for reviewing!



---

archive/issue_comments_651738.json:
```json
{
    "body": "Changing branch from \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\"",
    "created_at": "2021-10-29T00:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651738",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)"



---

archive/issue_comments_651739.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-10-29T00:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651739",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_651740.json:
```json
{
    "body": "Changing commit from \"[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)\" to \"[addbbe7f3936e8643e05992cc7710e6f482f8554](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)\"",
    "created_at": "2021-10-29T00:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651740",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)" to "[addbbe7f3936e8643e05992cc7710e6f482f8554](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)"



---

archive/issue_comments_651741.json:
```json
{
    "body": "<a id='comment:26'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|\n|[addbbe7](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)|`Merge tag '9.5.beta5' into t/32701/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|",
    "created_at": "2021-10-29T00:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651741",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
New commits:
|                                                                                                                                          |                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
|[addbbe7](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)|`Merge tag '9.5.beta5' into t/32701/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|



---

archive/issue_comments_651742.json:
```json
{
    "body": "<a id='comment:27'></a>\nI used an old version of the branch, to be redone",
    "created_at": "2021-10-29T00:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651742",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
I used an old version of the branch, to be redone



---

archive/issue_comments_651743.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\"",
    "created_at": "2021-10-29T00:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651743",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "[u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)"



---

archive/issue_comments_651744.json:
```json
{
    "body": "Changing commit from \"[addbbe7f3936e8643e05992cc7710e6f482f8554](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)\" to \"[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)\"",
    "created_at": "2021-10-29T00:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651744",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "[addbbe7f3936e8643e05992cc7710e6f482f8554](https://github.com/sagemath/sagetrac-mirror/commit/addbbe7f3936e8643e05992cc7710e6f482f8554)" to "[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)"



---

archive/issue_comments_651745.json:
```json
{
    "body": "<a id='comment:28'></a>\nNew commits:\n|                                                                                                                                          |                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|\n|[2cc2fa7](https://github.com/sagemath/sagetrac-mirror/commit/2cc2fa71426e061bd030e85177766cd7c5dd05c4)|`src/sage/rings/real_double.pyx: Replace cimport from cypari.convert by method-local import`|\n|[d641dc6](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)|`src/sage/rings/complex_double.pyx: Move PARI conversion functions to src/sage/libs/pari/`|\n|[e43dfad](https://github.com/sagemath/sagetrac-mirror/commit/e43dfad561d3cc0f7b659b89eb4b2041e970fc20)|`Merge branch 'u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2' of git://trac.sagemath.org/sage into u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|\n|[bc1710c](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)|`fix incorrect import`|\n|[71b62be](https://github.com/sagemath/sagetrac-mirror/commit/71b62be886046fe6c1fe0eb6b8ba543d90ec0293)|`new_gen_from_double not available as python function`|\n|[64984be](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)|`coverage`|\n|[16d2850](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)|`src/sage/libs/pari/convert_sage_complex_double.pxd (pari_to_cdf): cdef inline -> cpdef`|\n|[388b05f](https://github.com/sagemath/sagetrac-mirror/commit/388b05f54be5419a1c0f68c765a6e6064301e1ac)|`speed up conversion for complex double`|\n|[a64d72b](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)|`speed up conversion from real double`|",
    "created_at": "2021-10-29T00:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651745",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
New commits:
|                                                                                                                                          |                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
|[2cc2fa7](https://github.com/sagemath/sagetrac-mirror/commit/2cc2fa71426e061bd030e85177766cd7c5dd05c4)|`src/sage/rings/real_double.pyx: Replace cimport from cypari.convert by method-local import`|
|[d641dc6](https://github.com/sagemath/sagetrac-mirror/commit/d641dc6a081eb018a694a78795e8a23097604757)|`src/sage/rings/complex_double.pyx: Move PARI conversion functions to src/sage/libs/pari/`|
|[e43dfad](https://github.com/sagemath/sagetrac-mirror/commit/e43dfad561d3cc0f7b659b89eb4b2041e970fc20)|`Merge branch 'u/mkoeppe/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2' of git://trac.sagemath.org/sage into u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2`|
|[bc1710c](https://github.com/sagemath/sagetrac-mirror/commit/bc1710c61fa8b9abb3f53bec78c121e16ac68ae8)|`fix incorrect import`|
|[71b62be](https://github.com/sagemath/sagetrac-mirror/commit/71b62be886046fe6c1fe0eb6b8ba543d90ec0293)|`new_gen_from_double not available as python function`|
|[64984be](https://github.com/sagemath/sagetrac-mirror/commit/64984beb812c93dfc7572eb32b0f4f7c822f9f82)|`coverage`|
|[16d2850](https://github.com/sagemath/sagetrac-mirror/commit/16d28509023cd429a4fd82a9ba3aec6037868244)|`src/sage/libs/pari/convert_sage_complex_double.pxd (pari_to_cdf): cdef inline -> cpdef`|
|[388b05f](https://github.com/sagemath/sagetrac-mirror/commit/388b05f54be5419a1c0f68c765a6e6064301e1ac)|`speed up conversion for complex double`|
|[a64d72b](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)|`speed up conversion from real double`|



---

archive/issue_comments_651746.json:
```json
{
    "body": "<a id='comment:29'></a>\nMerging 9.5.beta5 pulls in #32607, so corresponding changes need to be made in `src/sage/libs/pari/convert_sage_complex_double.pyx`",
    "created_at": "2021-10-29T00:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651746",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Merging 9.5.beta5 pulls in #32607, so corresponding changes need to be made in `src/sage/libs/pari/convert_sage_complex_double.pyx`



---

archive/issue_comments_651747.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[629c319](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)|`merge in 9.5.beta5`|",
    "created_at": "2021-10-29T06:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[629c319](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)|`merge in 9.5.beta5`|



---

archive/issue_comments_651748.json:
```json
{
    "body": "Changing commit from \"[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)\" to \"[629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)\"",
    "created_at": "2021-10-29T06:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[a64d72b83610b2de1efaed05deaf18d879a78001](https://github.com/sagemath/sagetrac-mirror/commit/a64d72b83610b2de1efaed05deaf18d879a78001)" to "[629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)"



---

archive/issue_comments_651749.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-29T06:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651749",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_651750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-29T17:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651750",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_651751.json:
```json
{
    "body": "<a id='comment:32'></a>\nThanks.",
    "created_at": "2021-10-29T17:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651751",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Thanks.



---

archive/issue_events_097375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-31T22:21:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32701#event-97375"
}
```



---

archive/issue_comments_651752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-31T22:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651752",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_651753.json:
```json
{
    "body": "Changing branch from \"[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)\" to \"[629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)\"",
    "created_at": "2021-10-31T22:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32701#issuecomment-651753",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/sage_rings__real_complex__double__remove_compile_time_dependency_on_cypari2)" to "[629c31924161d00c5a1e3941eb3945e45ca8a0b3](https://github.com/sagemath/sagetrac-mirror/commit/629c31924161d00c5a1e3941eb3945e45ca8a0b3)"
