# Issue 32095: DiFUB algorithm fails on some random graph

archive/issues_031858.json:
```json
{
    "body": "\n```\nsage -t --long --random-seed=4 src/sage/graphs/digraph.py\n**********************************************************************\nFile \"src/sage/graphs/digraph.py\", line 2475, in sage.graphs.digraph.DiGraph.?\nFailed example:\n    d1 == d2\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of 166 in sage.graphs.digraph.DiGraph.?\n    [530 tests, 1 failure, 1.70 s]\n```\n\n```\nsage: set_random_seed(4)                                                                                                                                                                                                                                                       \nsage: G = graphs.RandomGNP(40, 0.4).to_directed()                                                                                                                                                                                                                              \nsage: G.diameter()                                                                                                                                                                                                                                                             \n3\nsage: d1 = G.diameter(algorithm='DiFUB', by_weight=True)                                                                                                                                                                                                                       \nsage: d1                                                                                                                                                                                                                                                                       \n2.0\n```\n\nYet, `DiFUB` claims to be exact.\n\nKeywords: graphs, diameter\n\nBranch/Commit: [1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)\n\nReviewer: Jonathan Kliem\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32095\n\n",
    "closed_at": "2021-07-23T20:10:58Z",
    "created_at": "2021-07-01T18:54:00Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "DiFUB algorithm fails on some random graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32095",
    "user": "https://github.com/kliem"
}
```

```
sage -t --long --random-seed=4 src/sage/graphs/digraph.py
**********************************************************************
File "src/sage/graphs/digraph.py", line 2475, in sage.graphs.digraph.DiGraph.?
Failed example:
    d1 == d2
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of 166 in sage.graphs.digraph.DiGraph.?
    [530 tests, 1 failure, 1.70 s]
```

```
sage: set_random_seed(4)                                                                                                                                                                                                                                                       
sage: G = graphs.RandomGNP(40, 0.4).to_directed()                                                                                                                                                                                                                              
sage: G.diameter()                                                                                                                                                                                                                                                             
3
sage: d1 = G.diameter(algorithm='DiFUB', by_weight=True)                                                                                                                                                                                                                       
sage: d1                                                                                                                                                                                                                                                                       
2.0
```

Yet, `DiFUB` claims to be exact.

Keywords: graphs, diameter

Branch/Commit: [1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)

Reviewer: Jonathan Kliem

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32095





---

archive/issue_comments_639128.json:
```json
{
    "body": "<a id='comment:1'></a>\n`DiFUB` is an exact algorithm, and actually the default algorithm for unweighted digraphs is `DiFUB` as implemented in `distances_all_pairs.pyx`.\n\nApparently there is a bug in the implementation of `DiFUB` with boost (`base/boost_graph.pyx`). I will have a look.",
    "created_at": "2021-07-01T21:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639128",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>
`DiFUB` is an exact algorithm, and actually the default algorithm for unweighted digraphs is `DiFUB` as implemented in `distances_all_pairs.pyx`.

Apparently there is a bug in the implementation of `DiFUB` with boost (`base/boost_graph.pyx`). I will have a look.



---

archive/issue_comments_639129.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-03T09:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639129",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_639130.json:
```json
{
    "body": "Branch: [public/graphs/32095_fix_DiFUB_with_boost](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/32095_fix_DiFUB_with_boost)",
    "created_at": "2021-07-03T09:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639130",
    "user": "https://github.com/dcoudert"
}
```

Branch: [public/graphs/32095_fix_DiFUB_with_boost](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/32095_fix_DiFUB_with_boost)



---

archive/issue_comments_639131.json:
```json
{
    "body": "<a id='comment:2'></a>\nit was an incorrect use of method `sorted`.\n\n---\nNew commits:\n|                                                                                                                                          |                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[89c210e](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)|`trac #32095: sorted is not inplace`|",
    "created_at": "2021-07-03T09:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639131",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>
it was an incorrect use of method `sorted`.

---
New commits:
|                                                                                                                                          |                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[89c210e](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)|`trac #32095: sorted is not inplace`|



---

archive/issue_comments_639132.json:
```json
{
    "body": "Author: David Coudert",
    "created_at": "2021-07-03T09:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639132",
    "user": "https://github.com/dcoudert"
}
```

Author: David Coudert



---

archive/issue_comments_639133.json:
```json
{
    "body": "Commit: [89c210e1d8fc7bb83c4c2ae501774531e67df463](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)",
    "created_at": "2021-07-03T09:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639133",
    "user": "https://github.com/dcoudert"
}
```

Commit: [89c210e1d8fc7bb83c4c2ae501774531e67df463](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)



---

archive/issue_comments_639134.json:
```json
{
    "body": "<a id='comment:3'></a>\nOk, this is good to go. Thanks for the quick fix. One needs to be carefull with setting `set_random_seed(4)`, but this is ok at the end of a test block. The next block will get the initial seed again.",
    "created_at": "2021-07-03T09:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639134",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Ok, this is good to go. Thanks for the quick fix. One needs to be carefull with setting `set_random_seed(4)`, but this is ok at the end of a test block. The next block will get the initial seed again.



---

archive/issue_comments_639135.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-03T09:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639135",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_639136.json:
```json
{
    "body": "Reviewer: Jonathan Kliem",
    "created_at": "2021-07-03T09:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639136",
    "user": "https://github.com/kliem"
}
```

Reviewer: Jonathan Kliem



---

archive/issue_comments_639137.json:
```json
{
    "body": "<a id='comment:5'></a>\nIf you prefer, we can use the graph6 string.",
    "created_at": "2021-07-03T09:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639137",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>
If you prefer, we can use the graph6 string.



---

archive/issue_comments_639138.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt would be nice. At the moment things are stable and the next doctest is run with the correct seed. However, this doctest needs to be always the last (involving randomness) in this block.",
    "created_at": "2021-07-03T10:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639138",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
It would be nice. At the moment things are stable and the next doctest is run with the correct seed. However, this doctest needs to be always the last (involving randomness) in this block.



---

archive/issue_comments_639139.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[1d25896](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)|`trac #32095: avoid using set_random_seed`|",
    "created_at": "2021-07-03T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[1d25896](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)|`trac #32095: avoid using set_random_seed`|



---

archive/issue_comments_639140.json:
```json
{
    "body": "Changing commit from \"[89c210e1d8fc7bb83c4c2ae501774531e67df463](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)\" to \"[1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)\"",
    "created_at": "2021-07-03T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[89c210e1d8fc7bb83c4c2ae501774531e67df463](https://github.com/sagemath/sagetrac-mirror/commit/89c210e1d8fc7bb83c4c2ae501774531e67df463)" to "[1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)"



---

archive/issue_comments_639141.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-07-03T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_639142.json:
```json
{
    "body": "<a id='comment:8'></a>\nShould be better this way.",
    "created_at": "2021-07-03T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639142",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
Should be better this way.



---

archive/issue_comments_639143.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-03T11:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639143",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_639144.json:
```json
{
    "body": "<a id='comment:9'></a>\nYes, that is better. It also fixes the graph in case that random graphs change at some point.",
    "created_at": "2021-07-03T11:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639144",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>
Yes, that is better. It also fixes the graph in case that random graphs change at some point.



---

archive/issue_events_095587.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-23T20:10:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32095#event-95587"
}
```



---

archive/issue_comments_639145.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639145",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_639146.json:
```json
{
    "body": "Changing branch from \"[public/graphs/32095_fix_DiFUB_with_boost](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/32095_fix_DiFUB_with_boost)\" to \"[1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)\"",
    "created_at": "2021-07-23T20:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32095#issuecomment-639146",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/graphs/32095_fix_DiFUB_with_boost](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/32095_fix_DiFUB_with_boost)" to "[1d258966e84e3339245e31c0eb286f9cee6a6f35](https://github.com/sagemath/sagetrac-mirror/commit/1d258966e84e3339245e31c0eb286f9cee6a6f35)"
