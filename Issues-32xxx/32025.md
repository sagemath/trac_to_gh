# Issue 32025: PolyhedronFace: Fix pickling test

archive/issues_031788.json:
```json
{
    "body": "CC:  @kliem @tscrim\n\nneeded for #32013\n\nWe fix rich comparison of faces and pickled faces, so that as expected we have:\n\n```\nsage: P = polytopes.cube()\nsage: f = P.faces(1)[2]\nsage: f == loads(f.dumps())\nTrue\n```\n\nAlong the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).\n\nIssue created by migration from https://trac.sagemath.org/ticket/32025\n\n",
    "closed_at": "2021-07-25T13:25:32Z",
    "created_at": "2021-06-21T19:09:52Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "PolyhedronFace: Fix pickling test",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32025",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kliem @tscrim

needed for #32013

We fix rich comparison of faces and pickled faces, so that as expected we have:

```
sage: P = polytopes.cube()
sage: f = P.faces(1)[2]
sage: f == loads(f.dumps())
True
```

Along the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).

Issue created by migration from https://trac.sagemath.org/ticket/32025





---

archive/issue_comments_453669.json:
```json
{
    "body": "Can you please provide an example on where it fails? If you are going to fix it yourself then I guess you'll provide an example along with the fix.",
    "created_at": "2021-06-21T19:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453669",
    "user": "https://github.com/kliem"
}
```

Can you please provide an example on where it fails? If you are going to fix it yourself then I guess you'll provide an example along with the fix.



---

archive/issue_comments_453670.json:
```json
{
    "body": "The `TestSuite` fails -- currently all calls to `TestSuite` use `skip='_test_pickling'`.\n\nI'm working on something else right now - so help with this ticket would be welcome!",
    "created_at": "2021-06-21T19:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453670",
    "user": "https://github.com/mkoeppe"
}
```

The `TestSuite` fails -- currently all calls to `TestSuite` use `skip='_test_pickling'`.

I'm working on something else right now - so help with this ticket would be welcome!



---

archive/issue_comments_453671.json:
```json
{
    "body": "Well, the only problem is that we currently require `face._polyhedron` to be identical for two faces to be tested equal. Otherwise, everything is working, isn't it?",
    "created_at": "2021-06-21T20:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453671",
    "user": "https://github.com/kliem"
}
```

Well, the only problem is that we currently require `face._polyhedron` to be identical for two faces to be tested equal. Otherwise, everything is working, isn't it?



---

archive/issue_comments_453672.json:
```json
{
    "body": "OK, perhaps it's too tricky to implement __richcmp__ for faces of polyhedra that are merely equal, not identical. \n\nAlthough I suppose if the polyhedra are not the same, one could just delegate the comparison to `as_polyhedron(...)`. \n\nBut I guess I can just skip the pickling test in #32013 to work around it.",
    "created_at": "2021-06-21T20:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453672",
    "user": "https://github.com/mkoeppe"
}
```

OK, perhaps it's too tricky to implement __richcmp__ for faces of polyhedra that are merely equal, not identical. 

Although I suppose if the polyhedra are not the same, one could just delegate the comparison to `as_polyhedron(...)`. 

But I guess I can just skip the pickling test in #32013 to work around it.



---

archive/issue_events_084723.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T20:54:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84723"
}
```



---

archive/issue_comments_453673.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-06-21T20:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453673",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to minor.



---

archive/issue_comments_453674.json:
```json
{
    "body": "I didn't mean to imply that this does not need to be fixed. I just wanted to comment that the fixing needs to be done in richcmp and not pickling. Pickling works fine.\n\nI guess instead of requiring the two polyhedra two be identical, we can just require the `Vrepresentation` and `Hrepresentation` to be the same:\n\n```diff\n    if self._polyhedron is not other._polyhedron:\n-       raise NotImplementedError\n+       if (self._polyhedron.Vrepresentation() != other._polyhedron.Vrepresentation() \n+               or self._polyhedron.Hrepresentation() != other._polyhedron.Hrepresentation()):\n+           raise NotImplementedError\n```\n\nActually we can be less strict and allow the Hrepresentation to differ. We could even allow the Vrepresentation to be a permutation of the other Vrepresentation, but this is definitely not needed to fix the pickling test for faces.",
    "created_at": "2021-06-22T10:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453674",
    "user": "https://github.com/kliem"
}
```

I didn't mean to imply that this does not need to be fixed. I just wanted to comment that the fixing needs to be done in richcmp and not pickling. Pickling works fine.

I guess instead of requiring the two polyhedra two be identical, we can just require the `Vrepresentation` and `Hrepresentation` to be the same:

```diff
    if self._polyhedron is not other._polyhedron:
-       raise NotImplementedError
+       if (self._polyhedron.Vrepresentation() != other._polyhedron.Vrepresentation() 
+               or self._polyhedron.Hrepresentation() != other._polyhedron.Hrepresentation()):
+           raise NotImplementedError
```

Actually we can be less strict and allow the Hrepresentation to differ. We could even allow the Vrepresentation to be a permutation of the other Vrepresentation, but this is definitely not needed to fix the pickling test for faces.



---

archive/issue_comments_453675.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453675",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_453676.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453676",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_events_084724.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-22T10:58:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84724"
}
```



---

archive/issue_events_084725.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-22T10:58:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84725"
}
```



---

archive/issue_comments_453677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-22T14:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_453678.json:
```json
{
    "body": "Merged to resolve merge conflict",
    "created_at": "2021-06-22T14:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453678",
    "user": "https://github.com/mkoeppe"
}
```

Merged to resolve merge conflict



---

archive/issue_comments_453679.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-23T01:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453679",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453680.json:
```json
{
    "body": "Thanks for working on this! LGTM",
    "created_at": "2021-06-23T01:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453680",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for working on this! LGTM



---

archive/issue_comments_453681.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-453681",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_084726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T13:25:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84726"
}
```
