# Issue 32025: PolyhedronFace: Fix pickling test

archive/issues_031788.json:
```json
{
    "body": "needed for #32013\n\nWe fix rich comparison of faces and pickled faces, so that as expected we have:\n\n```\nsage: P = polytopes.cube()\nsage: f = P.faces(1)[2]\nsage: f == loads(f.dumps())\nTrue\n```\n\nAlong the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).\n\nCC:  @kliem @tscrim\n\nBranch/Commit: 2b9316b61b375deff2e02b49c4341596353b9ebc\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nDependencies: #31959\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32025\n\n",
    "closed_at": "2021-07-25T13:25:32Z",
    "created_at": "2021-06-21T19:09:52Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "PolyhedronFace: Fix pickling test",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32025",
    "user": "https://github.com/mkoeppe"
}
```
needed for #32013

We fix rich comparison of faces and pickled faces, so that as expected we have:

```
sage: P = polytopes.cube()
sage: f = P.faces(1)[2]
sage: f == loads(f.dumps())
True
```

Along the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).

CC:  @kliem @tscrim

Branch/Commit: 2b9316b61b375deff2e02b49c4341596353b9ebc

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Dependencies: #31959

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32025





---

archive/issue_comments_637262.json:
```json
{
    "body": "<a id='comment:1'></a>Can you please provide an example on where it fails? If you are going to fix it yourself then I guess you'll provide an example along with the fix.",
    "created_at": "2021-06-21T19:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637262",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>Can you please provide an example on where it fails? If you are going to fix it yourself then I guess you'll provide an example along with the fix.



---

archive/issue_comments_637263.json:
```json
{
    "body": "<a id='comment:2'></a>The `TestSuite` fails -- currently all calls to `TestSuite` use `skip='_test_pickling'`.\n\nI'm working on something else right now - so help with this ticket would be welcome!",
    "created_at": "2021-06-21T19:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637263",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>The `TestSuite` fails -- currently all calls to `TestSuite` use `skip='_test_pickling'`.

I'm working on something else right now - so help with this ticket would be welcome!



---

archive/issue_comments_637264.json:
```json
{
    "body": "<a id='comment:3'></a>Well, the only problem is that we currently require `face._polyhedron` to be identical for two faces to be tested equal. Otherwise, everything is working, isn't it?",
    "created_at": "2021-06-21T20:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637264",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>Well, the only problem is that we currently require `face._polyhedron` to be identical for two faces to be tested equal. Otherwise, everything is working, isn't it?



---

archive/issue_comments_637265.json:
```json
{
    "body": "<a id='comment:4'></a>OK, perhaps it's too tricky to implement __richcmp__ for faces of polyhedra that are merely equal, not identical. \n\nAlthough I suppose if the polyhedra are not the same, one could just delegate the comparison to `as_polyhedron(...)`. \n\nBut I guess I can just skip the pickling test in #32013 to work around it.",
    "created_at": "2021-06-21T20:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637265",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>OK, perhaps it's too tricky to implement __richcmp__ for faces of polyhedra that are merely equal, not identical. 

Although I suppose if the polyhedra are not the same, one could just delegate the comparison to `as_polyhedron(...)`. 

But I guess I can just skip the pickling test in #32013 to work around it.



---

archive/issue_events_084723.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T20:54:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84723"
}
```



---

archive/issue_comments_637266.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-06-21T20:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637266",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to minor.



---

archive/issue_comments_637267.json:
```json
{
    "body": "<a id='comment:6'></a>I didn't mean to imply that this does not need to be fixed. I just wanted to comment that the fixing needs to be done in richcmp and not pickling. Pickling works fine.\n\nI guess instead of requiring the two polyhedra two be identical, we can just require the `Vrepresentation` and `Hrepresentation` to be the same:\n\n```diff\n    if self._polyhedron is not other._polyhedron:\n-       raise NotImplementedError\n+       if (self._polyhedron.Vrepresentation() != other._polyhedron.Vrepresentation() \n+               or self._polyhedron.Hrepresentation() != other._polyhedron.Hrepresentation()):\n+           raise NotImplementedError\n```\n\nActually we can be less strict and allow the Hrepresentation to differ. We could even allow the Vrepresentation to be a permutation of the other Vrepresentation, but this is definitely not needed to fix the pickling test for faces.",
    "created_at": "2021-06-22T10:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637267",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>I didn't mean to imply that this does not need to be fixed. I just wanted to comment that the fixing needs to be done in richcmp and not pickling. Pickling works fine.

I guess instead of requiring the two polyhedra two be identical, we can just require the `Vrepresentation` and `Hrepresentation` to be the same:

```diff
    if self._polyhedron is not other._polyhedron:
-       raise NotImplementedError
+       if (self._polyhedron.Vrepresentation() != other._polyhedron.Vrepresentation() 
+               or self._polyhedron.Hrepresentation() != other._polyhedron.Hrepresentation()):
+           raise NotImplementedError
```

Actually we can be less strict and allow the Hrepresentation to differ. We could even allow the Vrepresentation to be a permutation of the other Vrepresentation, but this is definitely not needed to fix the pickling test for faces.



---

archive/issue_comments_637268.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637268",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_comments_637269.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637269",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_637270.json:
```json
{
    "body": "Changing branch from \"\" to \"public/32025\"",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637270",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/32025"



---

archive/issue_comments_637271.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n needed for #32013\n+\n+We fix rich comparison of faces and pickled faces, so that as expected we have:\n+\n+```\n+sage: P = polytopes.cube()\n+sage: f = P.faces(1)[2]\n+sage: f == loads(f.dumps())\n+True\n+```\n+\n+Along the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637271",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,15 @@
 needed for #32013
+
+We fix rich comparison of faces and pickled faces, so that as expected we have:
+
+```
+sage: P = polytopes.cube()
+sage: f = P.faces(1)[2]
+sage: f == loads(f.dumps())
+True
+```
+
+Along the way we remove `_test_pickling` skips that are no longer necessary (because ppl polyhedra can be pickled).
 
 Comment: 1
 
``````




---

archive/issue_comments_637272.json:
```json
{
    "body": "Changing commit from \"\" to \"52a6f40d204d88fff4c0ac3bf56c9bec9ed232d1\"",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637272",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "52a6f40d204d88fff4c0ac3bf56c9bec9ed232d1"



---

archive/issue_comments_637273.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-22T10:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637273",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_events_084724.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-22T10:58:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84724"
}
```



---

archive/issue_events_084725.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-22T10:58:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84725"
}
```



---

archive/issue_comments_637274.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-22T14:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_637275.json:
```json
{
    "body": "Changing commit from \"52a6f40d204d88fff4c0ac3bf56c9bec9ed232d1\" to \"2b9316b61b375deff2e02b49c4341596353b9ebc\"",
    "created_at": "2021-06-22T14:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "52a6f40d204d88fff4c0ac3bf56c9bec9ed232d1" to "2b9316b61b375deff2e02b49c4341596353b9ebc"



---

archive/issue_comments_637276.json:
```json
{
    "body": "<a id='comment:9'></a>Merged to resolve merge conflict",
    "created_at": "2021-06-22T14:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Merged to resolve merge conflict



---

archive/issue_comments_637277.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31959\"",
    "created_at": "2021-06-22T14:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637277",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#31959"



---

archive/issue_comments_637278.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-23T01:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637278",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_637279.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-06-23T01:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637279",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_637280.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks for working on this! LGTM",
    "created_at": "2021-06-23T01:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637280",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Thanks for working on this! LGTM



---

archive/issue_comments_637281.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637281",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_637282.json:
```json
{
    "body": "Changing branch from \"public/32025\" to \"2b9316b61b375deff2e02b49c4341596353b9ebc\"",
    "created_at": "2021-07-25T13:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32025#issuecomment-637282",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/32025" to "2b9316b61b375deff2e02b49c4341596353b9ebc"



---

archive/issue_events_084726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T13:25:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32025",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32025#event-84726"
}
```
