# Issue 32851: Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb

archive/issues_032614.json:
```json
{
    "assignees": [],
    "body": "Part of #24641.\n\nFollowing a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):\n\n- Currently `RBF(gamma(3/2, 1))` errors out, as\n  `arb_hypgeom_gamma_upper` is not known to the arb interface\n- Same for other special functions `erfi`, `Ei`,...\n\nHere, by wrapping the corresponding functions from arb,\nwe add real ball special functions:\n\n- `erfi` -- imaginary error function\n- `Ei` -- exponential integral\n- `Si` -- sine integral\n- `Ci` -- cosine integral\n- `Shi` -- hyperbolic sine integral\n- `Chi` -- hyperbolic cosine integral\n- `li` -- logarithmic integral\n- `Li` -- offset logarithmic integral\n- `beta` -- complete Beta function\n- `gamma_inc` -- upper incomplete Gamma function\n- `gamma_inc_lower` -- lower incomplete Gamma function\n\nand we clarify that `zeta` with an extra argument\ngives the Hurwitz zeta function.\n\n\nCC:  @williamstein @slel\n\nKeywords: **arb, RBF, RealBallField, special functions**\n\nBranch/Commit: **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**\n\nReviewer: **Marc Mezzarobba, Dima Pasechnik, Samuel Leli\u00e8vre**\n\nAuthor: **Dima Pasechnik, Marc Mezzarobba**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32851_\n\n",
    "closed_at": "2021-11-15T23:16:20Z",
    "created_at": "2021-11-10T09:53:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb",
    "type": "issue",
    "updated_at": "2021-11-15T23:16:20Z",
    "url": "https://github.com/sagemath/sage/issues/32851",
    "user": "https://github.com/dimpase"
}
```
Part of #24641.

Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):

- Currently `RBF(gamma(3/2, 1))` errors out, as
  `arb_hypgeom_gamma_upper` is not known to the arb interface
- Same for other special functions `erfi`, `Ei`,...

Here, by wrapping the corresponding functions from arb,
we add real ball special functions:

- `erfi` -- imaginary error function
- `Ei` -- exponential integral
- `Si` -- sine integral
- `Ci` -- cosine integral
- `Shi` -- hyperbolic sine integral
- `Chi` -- hyperbolic cosine integral
- `li` -- logarithmic integral
- `Li` -- offset logarithmic integral
- `beta` -- complete Beta function
- `gamma_inc` -- upper incomplete Gamma function
- `gamma_inc_lower` -- lower incomplete Gamma function

and we clarify that `zeta` with an extra argument
gives the Hurwitz zeta function.


CC:  @williamstein @slel

Keywords: **arb, RBF, RealBallField, special functions**

Branch/Commit: **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**

Reviewer: **Marc Mezzarobba, Dima Pasechnik, Samuel Lelièvre**

Author: **Dima Pasechnik, Marc Mezzarobba**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/32851_





---

archive/issue_events_454426.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-10T09:53:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454426"
}
```



---

archive/issue_events_454427.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-10T09:53:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454427"
}
```



---

archive/issue_events_454428.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-10T09:53:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454428"
}
```



---

archive/issue_events_454429.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-10T09:53:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454429"
}
```



---

archive/issue_comments_530157.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMany other special functions implemented in arb are still to be wrapped even at the level of `CBF`, including all of `acb_dirichlet`. And then we should add appropriate wrappers for real balls and, when necessary (because of multiple arguments etc.), for symbolic expressions.",
    "created_at": "2021-11-10T10:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530157",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:2" align="right">comment:2</div>

Many other special functions implemented in arb are still to be wrapped even at the level of `CBF`, including all of `acb_dirichlet`. And then we should add appropriate wrappers for real balls and, when necessary (because of multiple arguments etc.), for symbolic expressions.



---

archive/issue_comments_530158.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nBy the way, for `erfi` to work, so that \n\n```\nsage: RBF(erfi(1/sqrt(2)))\n```\ndoes not crash, one needs\n\n```diff\n--- a/src/sage/rings/real_arb.pyx\n+++ b/src/sage/rings/real_arb.pyx\n@@ -3468,6 +3468,21 @@ cdef class RealBall(RingElement):\n         if _do_sig(prec(self)): sig_off()\n         return res\n \n+    def erfi(self):\n+        \"\"\"\n+        Imaginary error function.\n+\n+        EXAMPLES::\n+\n+            sage: RBF(1/2).erfi()\n+            [0.614952094696511 +/- 2.22e-16]\n+        \"\"\"\n+        cdef RealBall res = self._new()\n+        if _do_sig(prec(self)): sig_on()\n+        arb_hypgeom_erfi(res.value, self.value, prec(self))\n+        if _do_sig(prec(self)): sig_off()\n+        return res\n+\n     def gamma(self):\n         \"\"\"\n         Return the image of this ball by the Euler Gamma function.\n```\n\nWithout this, one ends up with infinite recursion.",
    "created_at": "2021-11-10T14:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530158",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

By the way, for `erfi` to work, so that 

```
sage: RBF(erfi(1/sqrt(2)))
```
does not crash, one needs

```diff
--- a/src/sage/rings/real_arb.pyx
+++ b/src/sage/rings/real_arb.pyx
@@ -3468,6 +3468,21 @@ cdef class RealBall(RingElement):
         if _do_sig(prec(self)): sig_off()
         return res
 
+    def erfi(self):
+        """
+        Imaginary error function.
+
+        EXAMPLES::
+
+            sage: RBF(1/2).erfi()
+            [0.614952094696511 +/- 2.22e-16]
+        """
+        cdef RealBall res = self._new()
+        if _do_sig(prec(self)): sig_on()
+        arb_hypgeom_erfi(res.value, self.value, prec(self))
+        if _do_sig(prec(self)): sig_off()
+        return res
+
     def gamma(self):
         """
         Return the image of this ball by the Euler Gamma function.
```

Without this, one ends up with infinite recursion.



---

archive/issue_comments_530159.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,4 @@\n currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n `arb_hypgeom_gamma_upper` is not wrapped.\n+\n+Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.\n``````\n",
    "created_at": "2021-11-10T14:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530159",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,4 @@
 currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
 `arb_hypgeom_gamma_upper` is not wrapped.
+
+Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.
``````




---

archive/issue_comments_530160.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhat do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?",
    "created_at": "2021-11-10T17:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530160",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:5" align="right">comment:5</div>

What do you mean by “wrapped, but still not known to the ARB interface” in the new description?



---

archive/issue_comments_530161.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mezzarobba](#comment:5):\n> What do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?\n\nthat one needs the patch in [comment:3](#comment:3) to be able to do `RBF(erfi())`.",
    "created_at": "2021-11-10T17:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530161",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mezzarobba](#comment:5):
> What do you mean by “wrapped, but still not known to the ARB interface” in the new description?

that one needs the patch in [comment:3](#comment:3) to be able to do `RBF(erfi())`.



---

archive/issue_comments_530162.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2021-11-10T17:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530162",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_530163.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n-`arb_hypgeom_gamma_upper` is not wrapped.\n+`arb_hypgeom_gamma_upper` is not known to the ARB interface.\n \n-Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.\n+Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n``````\n",
    "created_at": "2021-11-10T17:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530163",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
-`arb_hypgeom_gamma_upper` is not wrapped.
+`arb_hypgeom_gamma_upper` is not known to the ARB interface.
 
-Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.
+Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
``````




---

archive/issue_comments_530164.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mezzarobba](#comment:5):\n> What do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?\n\nI don't quite get what you did with `gamma()` in `real_arb.pyx`.\nThere is `def gamma(self)`, which is `RBF(self).gamma()`, and `def gamma(self, x)`, which is \n`RBF.gamma(x)` - and the latter leads to things like `RBF(gamma(3/2,1))` erroring out.\nIt also squats the incomplete gamma function place.",
    "created_at": "2021-11-10T18:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530164",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mezzarobba](#comment:5):
> What do you mean by “wrapped, but still not known to the ARB interface” in the new description?

I don't quite get what you did with `gamma()` in `real_arb.pyx`.
There is `def gamma(self)`, which is `RBF(self).gamma()`, and `def gamma(self, x)`, which is 
`RBF.gamma(x)` - and the latter leads to things like `RBF(gamma(3/2,1))` erroring out.
It also squats the incomplete gamma function place.



---

archive/issue_comments_530165.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n `arb_hypgeom_gamma_upper` is not known to the ARB interface.\n \n Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n+\n+Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.\n``````\n",
    "created_at": "2021-11-10T18:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530165",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 `arb_hypgeom_gamma_upper` is not known to the ARB interface.
 
 Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
+
+Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.
``````




---

archive/issue_comments_530166.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCan we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.",
    "created_at": "2021-11-10T19:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530166",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.



---

archive/issue_comments_530167.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThat `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.",
    "created_at": "2021-11-10T19:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530167",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.



---

archive/issue_events_454430.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-10T19:41:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454430"
}
```



---

archive/issue_comments_530168.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)**",
    "created_at": "2021-11-10T19:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530168",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)**



---

archive/issue_comments_530169.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSorry for confision. I guess the branch almost does the job:\n\n```\nsage: RBF(gamma(3/2,RBF(sqrt(2))))\n[0.37118875695353 +/- 3.29e-15]\n```\nworks, but\n\n```\nsage: RBF(gamma(3/2,sqrt(2)))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-93db2d9138f4> in <module>\n----> 1 RBF(gamma(Integer(3)/Integer(2),sqrt(Integer(2))))\n...\nhome/scratch2/dimpase/sage/sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/rings/real_arb.pyx in sage.rings.real_arb.RealBall.gamma (build/cythonized/sage/rings/real_arb.c:25156)()\n   3506             if _do_sig(prec(self)): sig_off()\n   3507         else:\n-> 3508             a_ball = res._parent.coerce(a)\n   3509             if _do_sig(prec(self)): sig_on()\n   3510             arb_hypgeom_gamma_upper(res.value, self.value, a_ball.value, 0, prec(self))\n...\nTypeError: no canonical coercion from Symbolic Ring to Real ball field with 53 bits of precision\n```\n\nHow can this be fixed?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466\"><code>c280505</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>\n",
    "created_at": "2021-11-10T19:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530169",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Sorry for confision. I guess the branch almost does the job:

```
sage: RBF(gamma(3/2,RBF(sqrt(2))))
[0.37118875695353 +/- 3.29e-15]
```
works, but

```
sage: RBF(gamma(3/2,sqrt(2)))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-93db2d9138f4> in <module>
----> 1 RBF(gamma(Integer(3)/Integer(2),sqrt(Integer(2))))
...
home/scratch2/dimpase/sage/sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/rings/real_arb.pyx in sage.rings.real_arb.RealBall.gamma (build/cythonized/sage/rings/real_arb.c:25156)()
   3506             if _do_sig(prec(self)): sig_off()
   3507         else:
-> 3508             a_ball = res._parent.coerce(a)
   3509             if _do_sig(prec(self)): sig_on()
   3510             arb_hypgeom_gamma_upper(res.value, self.value, a_ball.value, 0, prec(self))
...
TypeError: no canonical coercion from Symbolic Ring to Real ball field with 53 bits of precision
```

How can this be fixed?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466"><code>c280505</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>




---

archive/issue_comments_530170.json:
```json
{
    "body": "Commit: **[`c280505`](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)**",
    "created_at": "2021-11-10T19:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530170",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`c280505`](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)**



---

archive/issue_comments_530171.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66\"><code>6700d58</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>\n",
    "created_at": "2021-11-10T21:19:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530171",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66"><code>6700d58</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>




---

archive/issue_comments_530172.json:
```json
{
    "body": "Changed commit from **[`c280505`](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)** to **[`6700d58`](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)**",
    "created_at": "2021-11-10T21:19:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530172",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c280505`](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)** to **[`6700d58`](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)**



---

archive/issue_comments_530173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,3 @@\n \n Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n \n-Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.\n``````\n",
    "created_at": "2021-11-10T21:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530173",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,3 @@
 
 Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
 
-Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.
``````




---

archive/issue_comments_530174.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOK, this seems to be a complete branch. Please review.",
    "created_at": "2021-11-10T21:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530174",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

OK, this seems to be a complete branch. Please review.



---

archive/issue_events_454431.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-11T10:30:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "title_is": "Wrap arb's imaginary error function erfi and upper incomplete gamma function",
    "title_was": "wrap more arb functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454431"
}
```



---

archive/issue_comments_530175.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,11 @@\n-currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n-`arb_hypgeom_gamma_upper` is not known to the ARB interface.\n+Part of #24641.\n \n-Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n+Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):\n \n+- Currently `RBF(gamma(3/2, 1))` errors out, as\n+  `arb_hypgeom_gamma_upper` is not known to the arb interface\n+\n+- Same for `erfi`.\n+\n+We add them there.\n+\n``````\n",
    "created_at": "2021-11-11T10:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530175",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,11 @@
-currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
-`arb_hypgeom_gamma_upper` is not known to the ARB interface.
+Part of #24641.
 
-Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
+Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):
 
+- Currently `RBF(gamma(3/2, 1))` errors out, as
+  `arb_hypgeom_gamma_upper` is not known to the arb interface
+
+- Same for `erfi`.
+
+We add them there.
+
``````




---

archive/issue_comments_530176.json:
```json
{
    "body": "Changed keywords from none to **arb, RBF, RealBallField**",
    "created_at": "2021-11-11T10:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530176",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **arb, RBF, RealBallField**



---

archive/issue_comments_530177.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nGood, let me add easy things listed on #24641 here. This ticket needs review in particular at the place I convert the 2nd argument of the incomplete Gamma function to RBF, just by calling `RBF()`.\nPerhaps there is a better way to do this in cython.",
    "created_at": "2021-11-11T11:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530177",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Good, let me add easy things listed on #24641 here. This ticket needs review in particular at the place I convert the 2nd argument of the incomplete Gamma function to RBF, just by calling `RBF()`.
Perhaps there is a better way to do this in cython.



---

archive/issue_comments_530178.json:
```json
{
    "body": "Changed commit from **[`6700d58`](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)** to **[`957a767`](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)**",
    "created_at": "2021-11-11T11:38:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530178",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6700d58`](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)** to **[`957a767`](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)**



---

archive/issue_comments_530179.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b\"><code>957a767</code></a></td><td><code>wrap arb's Ei</code></td></tr></table>\n",
    "created_at": "2021-11-11T11:38:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530179",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b"><code>957a767</code></a></td><td><code>wrap arb's Ei</code></td></tr></table>




---

archive/issue_comments_530180.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - Currently `RBF(gamma(3/2, 1))` errors out, as\n   `arb_hypgeom_gamma_upper` is not known to the arb interface\n \n-- Same for `erfi`.\n+- Same for `erfi`, `Ei`,...\n \n We add them there.\n \n``````\n",
    "created_at": "2021-11-11T11:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530180",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - Currently `RBF(gamma(3/2, 1))` errors out, as
   `arb_hypgeom_gamma_upper` is not known to the arb interface
 
-- Same for `erfi`.
+- Same for `erfi`, `Ei`,...
 
 We add them there.
 
``````




---

archive/issue_comments_530181.json:
```json
{
    "body": "Changed commit from **[`957a767`](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)** to **[`f7aa5dd`](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)**",
    "created_at": "2021-11-11T12:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`957a767`](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)** to **[`f7aa5dd`](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)**



---

archive/issue_comments_530182.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060\"><code>f7aa5dd</code></a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr></table>\n",
    "created_at": "2021-11-11T12:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530182",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060"><code>f7aa5dd</code></a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr></table>




---

archive/issue_events_454432.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-11T12:27:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "title_is": "Wrap arb's imaginary error function erfi,  incomplete gamma functions, etc.",
    "title_was": "Wrap arb's imaginary error function erfi and upper incomplete gamma function",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454432"
}
```



---

archive/issue_comments_530183.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nthe precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.\n\nI am not sure what exactly this implies w.r.t. to the precision of the answer.\n\nI'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.\nincomplete gamma.",
    "created_at": "2021-11-11T13:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530183",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.

I am not sure what exactly this implies w.r.t. to the precision of the answer.

I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.
incomplete gamma.



---

archive/issue_comments_530184.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887\"><code>76aec26</code></a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr></table>\n",
    "created_at": "2021-11-11T16:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530184",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887"><code>76aec26</code></a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr></table>




---

archive/issue_comments_530185.json:
```json
{
    "body": "Changed commit from **[`f7aa5dd`](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)** to **[`76aec26`](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)**",
    "created_at": "2021-11-11T16:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530185",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f7aa5dd`](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)** to **[`76aec26`](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)**



---

archive/issue_comments_530186.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee\"><code>5974956</code></a></td><td><code>wrapped arb's complete beta function</code></td></tr></table>\n",
    "created_at": "2021-11-11T17:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530186",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee"><code>5974956</code></a></td><td><code>wrapped arb's complete beta function</code></td></tr></table>




---

archive/issue_comments_530187.json:
```json
{
    "body": "Changed commit from **[`76aec26`](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)** to **[`5974956`](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)**",
    "created_at": "2021-11-11T17:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530187",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`76aec26`](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)** to **[`5974956`](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)**



---

archive/issue_comments_530188.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@dimpase](#comment:22):\n> the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.\n> \n> I am not sure what exactly this implies w.r.t. to the precision of the answer.\n> \n> I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.\n> incomplete gamma.\n\nThe precision passed to arb is basically a working precision that does not guarantee anything on the precision of the result (except that it tends to infinity when both the precision of the arguments and the working precision do). When there are arguments of different precisions, it usually does not make sense to ask for more than the minimum of their precisions, but arb will typically do the right thing even if you do and there will be little performance penalty.",
    "created_at": "2021-11-11T18:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530188",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@dimpase](#comment:22):
> the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.
> 
> I am not sure what exactly this implies w.r.t. to the precision of the answer.
> 
> I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.
> incomplete gamma.

The precision passed to arb is basically a working precision that does not guarantee anything on the precision of the result (except that it tends to infinity when both the precision of the arguments and the working precision do). When there are arguments of different precisions, it usually does not make sense to ask for more than the minimum of their precisions, but arb will typically do the right thing even if you do and there will be little performance penalty.



---

archive/issue_comments_530189.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@dimpase](#comment:12):\n> That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.\n\nYes. The point of `RBF.gamma(foo)` is that one can compute gamma much more efficiently when the argument is a small rational, but of course one then needs to pass the rational exactly. To my eyes, having this type of things as a method of `RBF` is not really different from things like `RR.pi()` or even `Foo.gen()`.",
    "created_at": "2021-11-11T18:34:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530189",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@dimpase](#comment:12):
> That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.

Yes. The point of `RBF.gamma(foo)` is that one can compute gamma much more efficiently when the argument is a small rational, but of course one then needs to pass the rational exactly. To my eyes, having this type of things as a method of `RBF` is not really different from things like `RR.pi()` or even `Foo.gen()`.



---

archive/issue_comments_530190.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@dimpase](#comment:11):\n> Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.\n\nProbably all there is to it is that these functions were added before the incomplete gamma function was available in arb (for real balls at least).",
    "created_at": "2021-11-11T18:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530190",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@dimpase](#comment:11):
> Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.

Probably all there is to it is that these functions were added before the incomplete gamma function was available in arb (for real balls at least).



---

archive/issue_comments_530191.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThere is an article missing in\n\n```\n+        Otherwise, it computes Hurwitz zeta function.\n```\nand I would suggest adding\n\n```\ngamma_inc = gamma\n```\nin `RealBall` since both names are used in Sage.",
    "created_at": "2021-11-11T18:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530191",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:28" align="right">comment:28</div>

There is an article missing in

```
+        Otherwise, it computes Hurwitz zeta function.
```
and I would suggest adding

```
gamma_inc = gamma
```
in `RealBall` since both names are used in Sage.



---

archive/issue_comments_530192.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a\"><code>f9bd200</code></a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr></table>\n",
    "created_at": "2021-11-11T20:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530192",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a"><code>f9bd200</code></a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr></table>




---

archive/issue_comments_530193.json:
```json
{
    "body": "Changed commit from **[`5974956`](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)** to **[`f9bd200`](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)**",
    "created_at": "2021-11-11T20:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530193",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5974956`](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)** to **[`f9bd200`](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)**



---

archive/issue_comments_530194.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n`gamma_inc` added to the place where it's really making sense, i.e. where `gamma` may mean `gamma_inc`.",
    "created_at": "2021-11-11T20:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530194",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

`gamma_inc` added to the place where it's really making sense, i.e. where `gamma` may mean `gamma_inc`.



---

archive/issue_comments_530195.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFor functions with an additional parameter, you convert the parameter into `RBF`. Existing wrappers for arb special functions use coercions, not conversions. Coercion looks like a better choice to me, though this is debatable. In any case what we do with different functions should be consistent.\n\nSwitching from conversions to coercions breaks examples like `RBF(sin(3)).beta(sqrt(2/3))`, but `RBF(beta(sin(3),sqrt(2/3)))` (once implemented) will work, because the converter from symbolic expressions to real balls will traverse the expression and convert `sqrt(2/3)` recursively before it calls `beta`.\n\nAlso, all(?) occurrences of `RBF` in these conversions/coercions should be `self._parent`.\n\nI've implemented these changes, please feel free to revert to your branch if you disagree.",
    "created_at": "2021-11-12T09:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530195",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:31" align="right">comment:31</div>

For functions with an additional parameter, you convert the parameter into `RBF`. Existing wrappers for arb special functions use coercions, not conversions. Coercion looks like a better choice to me, though this is debatable. In any case what we do with different functions should be consistent.

Switching from conversions to coercions breaks examples like `RBF(sin(3)).beta(sqrt(2/3))`, but `RBF(beta(sin(3),sqrt(2/3)))` (once implemented) will work, because the converter from symbolic expressions to real balls will traverse the expression and convert `sqrt(2/3)` recursively before it calls `beta`.

Also, all(?) occurrences of `RBF` in these conversions/coercions should be `self._parent`.

I've implemented these changes, please feel free to revert to your branch if you disagree.



---

archive/issue_comments_530196.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)** to **[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)**",
    "created_at": "2021-11-12T09:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530196",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)** to **[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)**



---

archive/issue_comments_530197.json:
```json
{
    "body": "Changed commit from **[`f9bd200`](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)** to **[`0f88a4b`](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)**",
    "created_at": "2021-11-12T09:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530197",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`f9bd200`](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)** to **[`0f88a4b`](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)**



---

archive/issue_comments_530198.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1dca9e3c71c667ab6b427e1fc6d3c5d1a803dfe\"><code>c1dca9e</code></a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73\"><code>0f88a4b</code></a></td><td><code>#32851 update a doctest</code></td></tr></table>\n",
    "created_at": "2021-11-12T09:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530198",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:32"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1dca9e3c71c667ab6b427e1fc6d3c5d1a803dfe"><code>c1dca9e</code></a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73"><code>0f88a4b</code></a></td><td><code>#32851 update a doctest</code></td></tr></table>




---

archive/issue_comments_530199.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nhow about trying coercion, and if it fails switching to conversion, i.e. calling RBF() ?",
    "created_at": "2021-11-12T09:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530199",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

how about trying coercion, and if it fails switching to conversion, i.e. calling RBF() ?



---

archive/issue_comments_530200.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nthe commit message for `beta` says:\n\n```\nwrapped arb's complete beta function\n\nthere are issues with Sage's beta being also\nimplemented via pynac, so RBF(beta(a,b)) does not\nwork, one needs RBF(a).beta(b) instead.\n```\n\nunless I miss something, your  change breaks `beta` on symbolic args.",
    "created_at": "2021-11-12T09:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530200",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

the commit message for `beta` says:

```
wrapped arb's complete beta function

there are issues with Sage's beta being also
implemented via pynac, so RBF(beta(a,b)) does not
work, one needs RBF(a).beta(b) instead.
```

unless I miss something, your  change breaks `beta` on symbolic args.



---

archive/issue_comments_530201.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@dimpase](#comment:34):\n> unless I miss something, your  change breaks `beta` on symbolic args.\n\nRegarding `a.beta(b)`, yes it does, and that's intentional.\n\nAs for `RBF(beta(a,b))`, the main reason it does not work is that `Function_beta` does not define the magic method `_method_arguments()` needed to specify how to map the arguments of the symbolic functions to those of the method.\n\nNevertheless, it seems that you are right and implementing `_method_arguments()` is not enough, because, contrary to what I said above, `Expression._arb_()` does not convert the arguments before calling the method. And indeed it shouldn't, since for some functions, the additional argument is not a ball.\n\nI don't like the idea of `ball.special_function(param)` triggering a conversion, but I don't know how to solve the issue...",
    "created_at": "2021-11-12T10:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530201",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@dimpase](#comment:34):
> unless I miss something, your  change breaks `beta` on symbolic args.

Regarding `a.beta(b)`, yes it does, and that's intentional.

As for `RBF(beta(a,b))`, the main reason it does not work is that `Function_beta` does not define the magic method `_method_arguments()` needed to specify how to map the arguments of the symbolic functions to those of the method.

Nevertheless, it seems that you are right and implementing `_method_arguments()` is not enough, because, contrary to what I said above, `Expression._arb_()` does not convert the arguments before calling the method. And indeed it shouldn't, since for some functions, the additional argument is not a ball.

I don't like the idea of `ball.special_function(param)` triggering a conversion, but I don't know how to solve the issue...



---

archive/issue_comments_530202.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI don't know how the generic conversion is implemented, but for efficiency reasons it ought to try something cheap, i.e. coersion, first, so if this is true then the extra try/except I proposed in the previous comment is not even needed.",
    "created_at": "2021-11-12T13:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530202",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

I don't know how the generic conversion is implemented, but for efficiency reasons it ought to try something cheap, i.e. coersion, first, so if this is true then the extra try/except I proposed in the previous comment is not even needed.



---

archive/issue_comments_530203.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nTo be clear, I am not concerned about performance issues. I don't like the idea of special functions converting their argument because conversions are unsafe and should be as explicit as possible (that's the whole point of the conversion/coercion distinction).",
    "created_at": "2021-11-13T09:05:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530203",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:37" align="right">comment:37</div>

To be clear, I am not concerned about performance issues. I don't like the idea of special functions converting their argument because conversions are unsafe and should be as explicit as possible (that's the whole point of the conversion/coercion distinction).



---

archive/issue_comments_530204.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOK, fine. I thought I was just making it consistent with, say, `RR`, but it's in fact not so.\nAdd yourself as author/reviewer then :-)",
    "created_at": "2021-11-13T10:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530204",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

OK, fine. I thought I was just making it consistent with, say, `RR`, but it's in fact not so.
Add yourself as author/reviewer then :-)



---

archive/issue_events_454433.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-13T10:17:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454433"
}
```



---

archive/issue_events_454434.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-13T10:17:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454434"
}
```



---

archive/issue_comments_530205.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOk, thank you!",
    "created_at": "2021-11-13T10:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530205",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:39" align="right">comment:39</div>

Ok, thank you!



---

archive/issue_comments_530206.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba, Dima Pasechnik**",
    "created_at": "2021-11-13T10:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530206",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba, Dima Pasechnik**



---

archive/issue_comments_530207.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dima Pasechnik, Marc Mezzarobba**",
    "created_at": "2021-11-13T10:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530207",
    "user": "https://github.com/mezzarobba"
}
```

Changed author from **Dima Pasechnik** to **Dima Pasechnik, Marc Mezzarobba**



---

archive/issue_events_454435.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-13T14:21:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "title_is": "Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb",
    "title_was": "Wrap arb's imaginary error function erfi,  incomplete gamma functions, etc.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454435"
}
```



---

archive/issue_comments_530208.json:
```json
{
    "body": "Changed keywords from **arb, RBF, RealBallField** to **arb, RBF, RealBallField, special functions**",
    "created_at": "2021-11-13T14:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530208",
    "user": "https://github.com/slel"
}
```

Changed keywords from **arb, RBF, RealBallField** to **arb, RBF, RealBallField, special functions**



---

archive/issue_comments_530209.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,8 +4,23 @@\n \n - Currently `RBF(gamma(3/2, 1))` errors out, as\n   `arb_hypgeom_gamma_upper` is not known to the arb interface\n+- Same for other special functions `erfi`, `Ei`,...\n \n-- Same for `erfi`, `Ei`,...\n+Here, by wrapping the corresponding functions from arb,\n+we add real ball special functions:\n \n-We add them there.\n+- `erfi` -- imaginary error function\n+- `Ei` -- exponential integral\n+- `Si` -- sine integral\n+- `Ci` -- cosine integral\n+- `Shi` -- hyperbolic sine integral\n+- `Chi` -- hyperbolic cosine integral\n+- `li` -- logarithmic integral\n+- `Li` -- offset logarithmic integral\n+- `beta` -- complete Beta function\n+- `gamma_inc` -- upper incomplete Gamma function\n+- `gamma_inc_lower` -- lower incomplete Gamma function\n \n+and we clarify that `zeta` with an extra argument\n+gives the Hurwitz zeta function.\n+\n``````\n",
    "created_at": "2021-11-13T14:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530209",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,8 +4,23 @@
 
 - Currently `RBF(gamma(3/2, 1))` errors out, as
   `arb_hypgeom_gamma_upper` is not known to the arb interface
+- Same for other special functions `erfi`, `Ei`,...
 
-- Same for `erfi`, `Ei`,...
+Here, by wrapping the corresponding functions from arb,
+we add real ball special functions:
 
-We add them there.
+- `erfi` -- imaginary error function
+- `Ei` -- exponential integral
+- `Si` -- sine integral
+- `Ci` -- cosine integral
+- `Shi` -- hyperbolic sine integral
+- `Chi` -- hyperbolic cosine integral
+- `li` -- logarithmic integral
+- `Li` -- offset logarithmic integral
+- `beta` -- complete Beta function
+- `gamma_inc` -- upper incomplete Gamma function
+- `gamma_inc_lower` -- lower incomplete Gamma function
 
+and we clarify that `zeta` with an extra argument
+gives the Hurwitz zeta function.
+
``````




---

archive/issue_comments_530210.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThe docstring for beta mentions Gamma,\nis that a copy-pasto?",
    "created_at": "2021-11-13T14:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530210",
    "user": "https://github.com/slel"
}
```

<div id="comment:40" align="right">comment:40</div>

The docstring for beta mentions Gamma,
is that a copy-pasto?



---

archive/issue_comments_530211.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nIn `src/sage/rings/complex_arb.pyx` we have\n\n- uncapitalized `ei`, `si`, `ci`, `shi`, `chi`\n- `li(self, bint offset=False)`\n  rather than `li` and `Li`\n\nI would use the same here for consistency.\nWhat do you think?",
    "created_at": "2021-11-13T14:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530211",
    "user": "https://github.com/slel"
}
```

<div id="comment:41" align="right">comment:41</div>

In `src/sage/rings/complex_arb.pyx` we have

- uncapitalized `ei`, `si`, `ci`, `shi`, `chi`
- `li(self, bint offset=False)`
  rather than `li` and `Li`

I would use the same here for consistency.
What do you think?



---

archive/issue_comments_530212.json:
```json
{
    "body": "Changed reviewer from **Marc Mezzarobba, Dima Pasechnik** to **Marc Mezzarobba, Dima Pasechnik, Samuel Leli\u00e8vre**",
    "created_at": "2021-11-13T14:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530212",
    "user": "https://github.com/slel"
}
```

Changed reviewer from **Marc Mezzarobba, Dima Pasechnik** to **Marc Mezzarobba, Dima Pasechnik, Samuel Lelièvre**



---

archive/issue_events_454436.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-13T14:36:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454436"
}
```



---

archive/issue_events_454437.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-13T14:36:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454437"
}
```



---

archive/issue_comments_530213.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThanks Samuel, I indeed went too fast with the review!",
    "created_at": "2021-11-13T16:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530213",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:42" align="right">comment:42</div>

Thanks Samuel, I indeed went too fast with the review!



---

archive/issue_comments_530214.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nhuh? Li and li are different Sage symbolic functions. Both need to be dealt with by RBF",
    "created_at": "2021-11-13T20:58:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530214",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">comment:43</div>

huh? Li and li are different Sage symbolic functions. Both need to be dealt with by RBF



---

archive/issue_comments_530215.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nthe inconsistency is in CBF, and ought to be addressed on another ticket, not here.\nSage does not have ei, it has Ei, using ei in place of Ei is just creating confusion.",
    "created_at": "2021-11-13T21:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530215",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">comment:44</div>

the inconsistency is in CBF, and ought to be addressed on another ticket, not here.
Sage does not have ei, it has Ei, using ei in place of Ei is just creating confusion.



---

archive/issue_comments_530216.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nIt's `CBF` that can't properly handle symbolic arguments, e.g. `CBF(Ei(I))` leads to an infinite recursion, just as `RBF(Ei(1))` did before the fixes introduced in this ticket. And `CBF(Ei(I))` doesn't work because there `CBF` does not know anything about Sage function `Ei`, it only knows about how to compute `Ei(t)` for t converted to CBF, by calling an improperly named `CBF(t).ei()`.\n\nA fix is trivial:\n\n```diff\n--- a/src/sage/rings/complex_arb.pyx\n+++ b/src/sage/rings/complex_arb.pyx\n@@ -4192,6 +4192,8 @@ cdef class ComplexBall(RingElement):\n         if _do_sig(prec(self)): sig_off()\n         return result\n \n+    Ei = ei\n+\n     def si(self):\n         \"\"\"\n         Return the sine integral with argument ``self``.\n```\n\nNow we can do\n\n```\nsage: CBF(Ei(I))\n[0.337403922900968 +/- 4.31e-16] + [2.51687939716208 +/- 2.01e-15]*I\n```\n\nI'm setting this back to positive review, and invite everyone to deal with the `CBF` issue in #32869.",
    "created_at": "2021-11-13T23:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530216",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:45" align="right">comment:45</div>

It's `CBF` that can't properly handle symbolic arguments, e.g. `CBF(Ei(I))` leads to an infinite recursion, just as `RBF(Ei(1))` did before the fixes introduced in this ticket. And `CBF(Ei(I))` doesn't work because there `CBF` does not know anything about Sage function `Ei`, it only knows about how to compute `Ei(t)` for t converted to CBF, by calling an improperly named `CBF(t).ei()`.

A fix is trivial:

```diff
--- a/src/sage/rings/complex_arb.pyx
+++ b/src/sage/rings/complex_arb.pyx
@@ -4192,6 +4192,8 @@ cdef class ComplexBall(RingElement):
         if _do_sig(prec(self)): sig_off()
         return result
 
+    Ei = ei
+
     def si(self):
         """
         Return the sine integral with argument ``self``.
```

Now we can do

```
sage: CBF(Ei(I))
[0.337403922900968 +/- 4.31e-16] + [2.51687939716208 +/- 2.01e-15]*I
```

I'm setting this back to positive review, and invite everyone to deal with the `CBF` issue in #32869.



---

archive/issue_events_454438.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-13T23:43:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454438"
}
```



---

archive/issue_events_454439.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-13T23:43:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454439"
}
```



---

archive/issue_events_454440.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-11-14T09:43:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454440"
}
```



---

archive/issue_events_454441.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-11-14T09:43:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454441"
}
```



---

archive/issue_comments_530217.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/feff55e50727d51b270320518ebeed932fcd1823\"><code>feff55e</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a4bf9647b36f78ad93e6220a93cad72528dcb15\"><code>2a4bf96</code></a></td><td><code>wrap arb's Ei</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5892c9e57d87bd825b69a8e8bd8e0f8ae2034f5\"><code>b5892c9</code></a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/335ccc78b3ecdf1722a309bcd2f99fdc79a801f0\"><code>335ccc7</code></a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a532ebf510ad650addd0375daf7801f3a914a90\"><code>8a532eb</code></a></td><td><code>wrapped arb's complete beta function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03e7d80d40cd04ebf431073e50cef92393c71032\"><code>03e7d80</code></a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d82f61a1533b70b25baa9c840ecc2d96b295b87\"><code>2d82f61</code></a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8092951b7bd52619405cf90c00f4a4fd1312e331\"><code>8092951</code></a></td><td><code>#32851 update a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac\"><code>3a5d60c</code></a></td><td><code>#32851 incomplete beta function + minor fixes</code></td></tr></table>\n",
    "created_at": "2021-11-14T09:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/feff55e50727d51b270320518ebeed932fcd1823"><code>feff55e</code></a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a4bf9647b36f78ad93e6220a93cad72528dcb15"><code>2a4bf96</code></a></td><td><code>wrap arb's Ei</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5892c9e57d87bd825b69a8e8bd8e0f8ae2034f5"><code>b5892c9</code></a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/335ccc78b3ecdf1722a309bcd2f99fdc79a801f0"><code>335ccc7</code></a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a532ebf510ad650addd0375daf7801f3a914a90"><code>8a532eb</code></a></td><td><code>wrapped arb's complete beta function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03e7d80d40cd04ebf431073e50cef92393c71032"><code>03e7d80</code></a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d82f61a1533b70b25baa9c840ecc2d96b295b87"><code>2d82f61</code></a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8092951b7bd52619405cf90c00f4a4fd1312e331"><code>8092951</code></a></td><td><code>#32851 update a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac"><code>3a5d60c</code></a></td><td><code>#32851 incomplete beta function + minor fixes</code></td></tr></table>




---

archive/issue_comments_530218.json:
```json
{
    "body": "Changed commit from **[`0f88a4b`](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)** to **[`3a5d60c`](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)**",
    "created_at": "2021-11-14T09:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0f88a4b`](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)** to **[`3a5d60c`](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)**



---

archive/issue_comments_530219.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nBut Samuel is right that the docstring of beta was incorrect. I fixed this, made a couple of other minor improvements, and rebased the branch on top of the last beta.\n\nI agree that some of the methods of `CBF` have badly chosen names/interfaces in view of what is available in `sage.functions`. Part of the reason, I guess, is that these methods were added (in #19082) before the mechanism for calling them when converting symbolic expressions.\n\nFrom my point of view (and I thinks this may explain some of the misunderstandings on this ticket), the main goal of the methods of the form `ComplexBall.special_function()` is to provide a clean interface to the special functions available in Arb. `CBF(constant_expression)` sort of works now, but it is a fragile hack, and I do not recommend relying on it.\n\nAs a side note, it is not necessary for `CBF(f(x))` to work that `f` and the method it defers to have the same: the symbolic function can also provide the mapping. But I agree that it makes more sense in the present situation to rename the methods of `ComplexBall`.",
    "created_at": "2021-11-14T09:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530219",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:47" align="right">comment:47</div>

But Samuel is right that the docstring of beta was incorrect. I fixed this, made a couple of other minor improvements, and rebased the branch on top of the last beta.

I agree that some of the methods of `CBF` have badly chosen names/interfaces in view of what is available in `sage.functions`. Part of the reason, I guess, is that these methods were added (in #19082) before the mechanism for calling them when converting symbolic expressions.

From my point of view (and I thinks this may explain some of the misunderstandings on this ticket), the main goal of the methods of the form `ComplexBall.special_function()` is to provide a clean interface to the special functions available in Arb. `CBF(constant_expression)` sort of works now, but it is a fragile hack, and I do not recommend relying on it.

As a side note, it is not necessary for `CBF(f(x))` to work that `f` and the method it defers to have the same: the symbolic function can also provide the mapping. But I agree that it makes more sense in the present situation to rename the methods of `ComplexBall`.



---

archive/issue_comments_530220.json:
```json
{
    "body": "Changed commit from **[`3a5d60c`](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)** to **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**",
    "created_at": "2021-11-14T11:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530220",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3a5d60c`](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)** to **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**



---

archive/issue_comments_530221.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/535719018598e165bee841f6e7c8911870b5f4de\"><code>5357190</code></a></td><td><code>#32851 more aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7\"><code>aa35a2b</code></a></td><td><code>#32851 partial support for symbolic beta</code></td></tr></table>\n",
    "created_at": "2021-11-14T11:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530221",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/535719018598e165bee841f6e7c8911870b5f4de"><code>5357190</code></a></td><td><code>#32851 more aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7"><code>aa35a2b</code></a></td><td><code>#32851 partial support for symbolic beta</code></td></tr></table>




---

archive/issue_events_454442.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-14T12:54:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454442"
}
```



---

archive/issue_events_454443.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-14T12:54:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454443"
}
```



---

archive/issue_comments_530222.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nOK, thanks!",
    "created_at": "2021-11-14T12:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530222",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">comment:49</div>

OK, thanks!



---

archive/issue_events_454444.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-15T23:16:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454444"
}
```



---

archive/issue_events_454445.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1114cde25562f314b3e6f53c6d4e05c1ce2c5244",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-11-15T23:16:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32851#event-454445"
}
```



---

archive/issue_comments_530223.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)** to **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**",
    "created_at": "2021-11-15T23:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32851#issuecomment-530223",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)** to **[`aa35a2b`](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)**
