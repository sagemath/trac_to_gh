# Issue 32851: Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb

archive/issues_032614.json:
```json
{
    "body": "Part of #24641.\n\nFollowing a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):\n\n- Currently `RBF(gamma(3/2, 1))` errors out, as\n  `arb_hypgeom_gamma_upper` is not known to the arb interface\n- Same for other special functions `erfi`, `Ei`,...\n\nHere, by wrapping the corresponding functions from arb,\nwe add real ball special functions:\n\n- `erfi` -- imaginary error function\n- `Ei` -- exponential integral\n- `Si` -- sine integral\n- `Ci` -- cosine integral\n- `Shi` -- hyperbolic sine integral\n- `Chi` -- hyperbolic cosine integral\n- `li` -- logarithmic integral\n- `Li` -- offset logarithmic integral\n- `beta` -- complete Beta function\n- `gamma_inc` -- upper incomplete Gamma function\n- `gamma_inc_lower` -- lower incomplete Gamma function\n\nand we clarify that `zeta` with an extra argument\ngives the Hurwitz zeta function.\n\n\n**CC:**  @williamstein @slel\n\n**Keywords:** arb, RBF, RealBallField, special functions\n\n**Branch/Commit:** [aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)\n\n**Reviewer:** Marc Mezzarobba, Dima Pasechnik, Samuel Leli\u00e8vre\n\n**Author:** Dima Pasechnik, Marc Mezzarobba\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32851\n\n",
    "closed_at": "2021-11-15T23:16:20Z",
    "created_at": "2021-11-10T09:53:21Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32851",
    "user": "https://github.com/dimpase"
}
```
Part of #24641.

Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):

- Currently `RBF(gamma(3/2, 1))` errors out, as
  `arb_hypgeom_gamma_upper` is not known to the arb interface
- Same for other special functions `erfi`, `Ei`,...

Here, by wrapping the corresponding functions from arb,
we add real ball special functions:

- `erfi` -- imaginary error function
- `Ei` -- exponential integral
- `Si` -- sine integral
- `Ci` -- cosine integral
- `Shi` -- hyperbolic sine integral
- `Chi` -- hyperbolic cosine integral
- `li` -- logarithmic integral
- `Li` -- offset logarithmic integral
- `beta` -- complete Beta function
- `gamma_inc` -- upper incomplete Gamma function
- `gamma_inc_lower` -- lower incomplete Gamma function

and we clarify that `zeta` with an extra argument
gives the Hurwitz zeta function.


**CC:**  @williamstein @slel

**Keywords:** arb, RBF, RealBallField, special functions

**Branch/Commit:** [aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)

**Reviewer:** Marc Mezzarobba, Dima Pasechnik, Samuel Lelièvre

**Author:** Dima Pasechnik, Marc Mezzarobba

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/32851





---

archive/issue_comments_654814.json:
```json
{
    "body": "<a id='comment:2'></a>\nMany other special functions implemented in arb are still to be wrapped even at the level of `CBF`, including all of `acb_dirichlet`. And then we should add appropriate wrappers for real balls and, when necessary (because of multiple arguments etc.), for symbolic expressions.",
    "created_at": "2021-11-10T10:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654814",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:2'></a>
Many other special functions implemented in arb are still to be wrapped even at the level of `CBF`, including all of `acb_dirichlet`. And then we should add appropriate wrappers for real balls and, when necessary (because of multiple arguments etc.), for symbolic expressions.



---

archive/issue_comments_654815.json:
```json
{
    "body": "<a id='comment:3'></a>\nBy the way, for `erfi` to work, so that \n\n```\nsage: RBF(erfi(1/sqrt(2)))\n```\ndoes not crash, one needs\n\n```diff\n--- a/src/sage/rings/real_arb.pyx\n+++ b/src/sage/rings/real_arb.pyx\n@@ -3468,6 +3468,21 @@ cdef class RealBall(RingElement):\n         if _do_sig(prec(self)): sig_off()\n         return res\n \n+    def erfi(self):\n+        \"\"\"\n+        Imaginary error function.\n+\n+        EXAMPLES::\n+\n+            sage: RBF(1/2).erfi()\n+            [0.614952094696511 +/- 2.22e-16]\n+        \"\"\"\n+        cdef RealBall res = self._new()\n+        if _do_sig(prec(self)): sig_on()\n+        arb_hypgeom_erfi(res.value, self.value, prec(self))\n+        if _do_sig(prec(self)): sig_off()\n+        return res\n+\n     def gamma(self):\n         \"\"\"\n         Return the image of this ball by the Euler Gamma function.\n```\n\nWithout this, one ends up with infinite recursion.",
    "created_at": "2021-11-10T14:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654815",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
By the way, for `erfi` to work, so that 

```
sage: RBF(erfi(1/sqrt(2)))
```
does not crash, one needs

```diff
--- a/src/sage/rings/real_arb.pyx
+++ b/src/sage/rings/real_arb.pyx
@@ -3468,6 +3468,21 @@ cdef class RealBall(RingElement):
         if _do_sig(prec(self)): sig_off()
         return res
 
+    def erfi(self):
+        """
+        Imaginary error function.
+
+        EXAMPLES::
+
+            sage: RBF(1/2).erfi()
+            [0.614952094696511 +/- 2.22e-16]
+        """
+        cdef RealBall res = self._new()
+        if _do_sig(prec(self)): sig_on()
+        arb_hypgeom_erfi(res.value, self.value, prec(self))
+        if _do_sig(prec(self)): sig_off()
+        return res
+
     def gamma(self):
         """
         Return the image of this ball by the Euler Gamma function.
```

Without this, one ends up with infinite recursion.



---

archive/issue_comments_654816.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,4 @@\n currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n `arb_hypgeom_gamma_upper` is not wrapped.\n+\n+Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.\n``````\n",
    "created_at": "2021-11-10T14:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654816",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,4 @@
 currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
 `arb_hypgeom_gamma_upper` is not wrapped.
+
+Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.
``````




---

archive/issue_comments_654817.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhat do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?",
    "created_at": "2021-11-10T17:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654817",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>
What do you mean by “wrapped, but still not known to the ARB interface” in the new description?



---

archive/issue_comments_654818.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mmezzarobba](#comment%3A5):\n> What do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?\n\nthat one needs the patch in [comment:3](#comment%3A3) to be able to do `RBF(erfi())`.",
    "created_at": "2021-11-10T17:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654818",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
Replying to [mmezzarobba](#comment%3A5):
> What do you mean by “wrapped, but still not known to the ARB interface” in the new description?

that one needs the patch in [comment:3](#comment%3A3) to be able to do `RBF(erfi())`.



---

archive/issue_comments_654819.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2021-11-10T17:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654819",
    "user": "https://github.com/dimpase"
}
```

**Author:** Dima Pasechnik



---

archive/issue_comments_654820.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n-`arb_hypgeom_gamma_upper` is not wrapped.\n+`arb_hypgeom_gamma_upper` is not known to the ARB interface.\n \n-Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.\n+Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n``````\n",
    "created_at": "2021-11-10T17:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654820",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
-`arb_hypgeom_gamma_upper` is not wrapped.
+`arb_hypgeom_gamma_upper` is not known to the ARB interface.
 
-Some functions, e.g. `erfi`, i.e. `arb_hypgeom_erfi` are wrapped, but are still not known to the ARB interface. So one needs to add them there.
+Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
``````




---

archive/issue_comments_654821.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mmezzarobba](#comment%3A5):\n> What do you mean by \u201cwrapped, but still not known to the ARB interface\u201d in the new description?\n\n\nI don't quite get what you did with `gamma()` in `real_arb.pyx`.\nThere is `def gamma(self)`, which is `RBF(self).gamma()`, and `def gamma(self, x)`, which is \n`RBF.gamma(x)` - and the latter leads to things like `RBF(gamma(3/2,1))` erroring out.\nIt also squats the incomplete gamma function place.",
    "created_at": "2021-11-10T18:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654821",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
Replying to [mmezzarobba](#comment%3A5):
> What do you mean by “wrapped, but still not known to the ARB interface” in the new description?


I don't quite get what you did with `gamma()` in `real_arb.pyx`.
There is `def gamma(self)`, which is `RBF(self).gamma()`, and `def gamma(self, x)`, which is 
`RBF.gamma(x)` - and the latter leads to things like `RBF(gamma(3/2,1))` erroring out.
It also squats the incomplete gamma function place.



---

archive/issue_comments_654822.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n `arb_hypgeom_gamma_upper` is not known to the ARB interface.\n \n Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n+\n+Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.\n``````\n",
    "created_at": "2021-11-10T18:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654822",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 `arb_hypgeom_gamma_upper` is not known to the ARB interface.
 
 Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
+
+Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.
``````




---

archive/issue_comments_654823.json:
```json
{
    "body": "<a id='comment:11'></a>\nCan we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.",
    "created_at": "2021-11-10T19:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654823",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.



---

archive/issue_comments_654824.json:
```json
{
    "body": "<a id='comment:12'></a>\nThat `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.",
    "created_at": "2021-11-10T19:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654824",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.



---

archive/issue_comments_654825.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-11-10T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654825",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_654826.json:
```json
{
    "body": "**Branch:** [u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)",
    "created_at": "2021-11-10T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654826",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)



---

archive/issue_comments_654827.json:
```json
{
    "body": "<a id='comment:13'></a>\nSorry for confision. I guess the branch almost does the job:\n\n```\nsage: RBF(gamma(3/2,RBF(sqrt(2))))\n[0.37118875695353 +/- 3.29e-15]\n```\nworks, but\n\n```\nsage: RBF(gamma(3/2,sqrt(2)))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-93db2d9138f4> in <module>\n----> 1 RBF(gamma(Integer(3)/Integer(2),sqrt(Integer(2))))\n...\nhome/scratch2/dimpase/sage/sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/rings/real_arb.pyx in sage.rings.real_arb.RealBall.gamma (build/cythonized/sage/rings/real_arb.c:25156)()\n   3506             if _do_sig(prec(self)): sig_off()\n   3507         else:\n-> 3508             a_ball = res._parent.coerce(a)\n   3509             if _do_sig(prec(self)): sig_on()\n   3510             arb_hypgeom_gamma_upper(res.value, self.value, a_ball.value, 0, prec(self))\n...\nTypeError: no canonical coercion from Symbolic Ring to Real ball field with 53 bits of precision\n```\n\nHow can this be fixed?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466\">c280505</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>\n",
    "created_at": "2021-11-10T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654827",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Sorry for confision. I guess the branch almost does the job:

```
sage: RBF(gamma(3/2,RBF(sqrt(2))))
[0.37118875695353 +/- 3.29e-15]
```
works, but

```
sage: RBF(gamma(3/2,sqrt(2)))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-93db2d9138f4> in <module>
----> 1 RBF(gamma(Integer(3)/Integer(2),sqrt(Integer(2))))
...
home/scratch2/dimpase/sage/sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/rings/real_arb.pyx in sage.rings.real_arb.RealBall.gamma (build/cythonized/sage/rings/real_arb.c:25156)()
   3506             if _do_sig(prec(self)): sig_off()
   3507         else:
-> 3508             a_ball = res._parent.coerce(a)
   3509             if _do_sig(prec(self)): sig_on()
   3510             arb_hypgeom_gamma_upper(res.value, self.value, a_ball.value, 0, prec(self))
...
TypeError: no canonical coercion from Symbolic Ring to Real ball field with 53 bits of precision
```

How can this be fixed?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466">c280505</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>




---

archive/issue_comments_654828.json:
```json
{
    "body": "**Commit:** [c28050590d3a81eadf314dca2bc7aa7606a80466](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)",
    "created_at": "2021-11-10T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654828",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [c28050590d3a81eadf314dca2bc7aa7606a80466](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)



---

archive/issue_comments_654829.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66\">6700d58</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>\n",
    "created_at": "2021-11-10T21:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66">6700d58</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr></table>




---

archive/issue_comments_654830.json:
```json
{
    "body": "**Changing commit** from \"[c28050590d3a81eadf314dca2bc7aa7606a80466](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)\" to \"[6700d5829569b975cfaac57261cba2d5d1fd4b66](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)\".",
    "created_at": "2021-11-10T21:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c28050590d3a81eadf314dca2bc7aa7606a80466](https://github.com/sagemath/sagetrac-mirror/commit/c28050590d3a81eadf314dca2bc7aa7606a80466)" to "[6700d5829569b975cfaac57261cba2d5d1fd4b66](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)".



---

archive/issue_comments_654831.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,3 @@\n \n Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n \n-Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.\n``````\n",
    "created_at": "2021-11-10T21:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654831",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,3 @@
 
 Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
 
-Also, `gamma(self,x)` in `real_arb.pyx` is squatting the place of the incomplete upper gamma-function - I don't know how to resolve this.
``````




---

archive/issue_comments_654832.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, this seems to be a complete branch. Please review.",
    "created_at": "2021-11-10T21:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654832",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
OK, this seems to be a complete branch. Please review.



---

archive/issue_events_097712.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "rename": {
        "from": "wrap more arb functions",
        "to": "Wrap arb's imaginary error function erfi and upper incomplete gamma function"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32851#event-97712"
}
```



---

archive/issue_comments_654833.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,11 @@\n-currently e.g. `RBF(gamma(3/2,1))` is erroring out, as \n-`arb_hypgeom_gamma_upper` is not known to the ARB interface.\n+Part of #24641.\n \n-Same for e.g. functions, e.g. `erfi`. So one needs to add them there.\n+Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):\n \n+- Currently `RBF(gamma(3/2, 1))` errors out, as\n+  `arb_hypgeom_gamma_upper` is not known to the arb interface\n+\n+- Same for `erfi`.\n+\n+We add them there.\n+\n``````\n",
    "created_at": "2021-11-11T10:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654833",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,11 @@
-currently e.g. `RBF(gamma(3/2,1))` is erroring out, as 
-`arb_hypgeom_gamma_upper` is not known to the ARB interface.
+Part of #24641.
 
-Same for e.g. functions, e.g. `erfi`. So one needs to add them there.
+Following a [report by Harald Helfgott on sage-devel](https://groups.google.com/g/sage-devel/c/rOputadfR54):
 
+- Currently `RBF(gamma(3/2, 1))` errors out, as
+  `arb_hypgeom_gamma_upper` is not known to the arb interface
+
+- Same for `erfi`.
+
+We add them there.
+
``````




---

archive/issue_comments_654834.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"arb, RBF, RealBallField\".",
    "created_at": "2021-11-11T10:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654834",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "arb, RBF, RealBallField".



---

archive/issue_comments_654835.json:
```json
{
    "body": "<a id='comment:17'></a>\nGood, let me add easy things listed on #24641 here. This ticket needs review in particular at the place I convert the 2nd argument of the incomplete Gamma function to RBF, just by calling `RBF()`.\nPerhaps there is a better way to do this in cython.",
    "created_at": "2021-11-11T11:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654835",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Good, let me add easy things listed on #24641 here. This ticket needs review in particular at the place I convert the 2nd argument of the incomplete Gamma function to RBF, just by calling `RBF()`.
Perhaps there is a better way to do this in cython.



---

archive/issue_comments_654836.json:
```json
{
    "body": "**Changing commit** from \"[6700d5829569b975cfaac57261cba2d5d1fd4b66](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)\" to \"[957a7676fd541d96e118d7f835caea9b98407e9b](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)\".",
    "created_at": "2021-11-11T11:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6700d5829569b975cfaac57261cba2d5d1fd4b66](https://github.com/sagemath/sagetrac-mirror/commit/6700d5829569b975cfaac57261cba2d5d1fd4b66)" to "[957a7676fd541d96e118d7f835caea9b98407e9b](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)".



---

archive/issue_comments_654837.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b\">957a767</a></td><td><code>wrap arb's Ei</code></td></tr></table>\n",
    "created_at": "2021-11-11T11:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b">957a767</a></td><td><code>wrap arb's Ei</code></td></tr></table>




---

archive/issue_comments_654838.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - Currently `RBF(gamma(3/2, 1))` errors out, as\n   `arb_hypgeom_gamma_upper` is not known to the arb interface\n \n-- Same for `erfi`.\n+- Same for `erfi`, `Ei`,...\n \n We add them there.\n \n``````\n",
    "created_at": "2021-11-11T11:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654838",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - Currently `RBF(gamma(3/2, 1))` errors out, as
   `arb_hypgeom_gamma_upper` is not known to the arb interface
 
-- Same for `erfi`.
+- Same for `erfi`, `Ei`,...
 
 We add them there.
 
``````




---

archive/issue_comments_654839.json:
```json
{
    "body": "**Changing commit** from \"[957a7676fd541d96e118d7f835caea9b98407e9b](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)\" to \"[f7aa5dd7f5d83864fd949c73aac39916b3492060](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)\".",
    "created_at": "2021-11-11T12:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[957a7676fd541d96e118d7f835caea9b98407e9b](https://github.com/sagemath/sagetrac-mirror/commit/957a7676fd541d96e118d7f835caea9b98407e9b)" to "[f7aa5dd7f5d83864fd949c73aac39916b3492060](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)".



---

archive/issue_comments_654840.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060\">f7aa5dd</a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr></table>\n",
    "created_at": "2021-11-11T12:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060">f7aa5dd</a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr></table>




---

archive/issue_events_097713.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "rename": {
        "from": "Wrap arb's imaginary error function erfi and upper incomplete gamma function",
        "to": "Wrap arb's imaginary error function erfi,  incomplete gamma functions, etc."
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32851#event-97713"
}
```



---

archive/issue_comments_654841.json:
```json
{
    "body": "<a id='comment:22'></a>\nthe precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.\n\nI am not sure what exactly this implies w.r.t. to the precision of the answer.\n\nI'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.\nincomplete gamma.",
    "created_at": "2021-11-11T13:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654841",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.

I am not sure what exactly this implies w.r.t. to the precision of the answer.

I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.
incomplete gamma.



---

archive/issue_comments_654842.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887\">76aec26</a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr></table>\n",
    "created_at": "2021-11-11T16:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887">76aec26</a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr></table>




---

archive/issue_comments_654843.json:
```json
{
    "body": "**Changing commit** from \"[f7aa5dd7f5d83864fd949c73aac39916b3492060](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)\" to \"[76aec26fdd7a6d1677e379e7a400d49d07d51887](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)\".",
    "created_at": "2021-11-11T16:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f7aa5dd7f5d83864fd949c73aac39916b3492060](https://github.com/sagemath/sagetrac-mirror/commit/f7aa5dd7f5d83864fd949c73aac39916b3492060)" to "[76aec26fdd7a6d1677e379e7a400d49d07d51887](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)".



---

archive/issue_comments_654844.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee\">5974956</a></td><td><code>wrapped arb's complete beta function</code></td></tr></table>\n",
    "created_at": "2021-11-11T17:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee">5974956</a></td><td><code>wrapped arb's complete beta function</code></td></tr></table>




---

archive/issue_comments_654845.json:
```json
{
    "body": "**Changing commit** from \"[76aec26fdd7a6d1677e379e7a400d49d07d51887](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)\" to \"[5974956cbb96da432047a88c39afa5c9c18b99ee](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)\".",
    "created_at": "2021-11-11T17:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[76aec26fdd7a6d1677e379e7a400d49d07d51887](https://github.com/sagemath/sagetrac-mirror/commit/76aec26fdd7a6d1677e379e7a400d49d07d51887)" to "[5974956cbb96da432047a88c39afa5c9c18b99ee](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)".



---

archive/issue_comments_654846.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [dimpase](#comment%3A22):\n> the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.\n> \n> I am not sure what exactly this implies w.r.t. to the precision of the answer.\n> \n> I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.\n> incomplete gamma.\n\n\nThe precision passed to arb is basically a working precision that does not guarantee anything on the precision of the result (except that it tends to infinity when both the precision of the arguments and the working precision do). When there are arguments of different precisions, it usually does not make sense to ask for more than the minimum of their precisions, but arb will typically do the right thing even if you do and there will be little performance penalty.",
    "created_at": "2021-11-11T18:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654846",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:25'></a>
Replying to [dimpase](#comment%3A22):
> the precision  (the last argument) in the calls to arb is always taken to be the precision of the 1st argument.
> 
> I am not sure what exactly this implies w.r.t. to the precision of the answer.
> 
> I'm also not sure whether this is always correct in the cases with more than 1 argument, e.g.
> incomplete gamma.


The precision passed to arb is basically a working precision that does not guarantee anything on the precision of the result (except that it tends to infinity when both the precision of the arguments and the working precision do). When there are arguments of different precisions, it usually does not make sense to ask for more than the minimum of their precisions, but arb will typically do the right thing even if you do and there will be little performance penalty.



---

archive/issue_comments_654847.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [dimpase](#comment%3A12):\n> That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.\n\n\nYes. The point of `RBF.gamma(foo)` is that one can compute gamma much more efficiently when the argument is a small rational, but of course one then needs to pass the rational exactly. To my eyes, having this type of things as a method of `RBF` is not really different from things like `RR.pi()` or even `Foo.gen()`.",
    "created_at": "2021-11-11T18:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654847",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:26'></a>
Replying to [dimpase](#comment%3A12):
> That `RBF.gamma(foo)` is actually quite misleading, as it gives you an impression that it magically computes `gamma(foo)` and converts the result into `RBF`, while in fact it uses a special arb implementation for `gamma(foo)` with `foo` being integer or rational, nothing magical at all.


Yes. The point of `RBF.gamma(foo)` is that one can compute gamma much more efficiently when the argument is a small rational, but of course one then needs to pass the rational exactly. To my eyes, having this type of things as a method of `RBF` is not really different from things like `RR.pi()` or even `Foo.gen()`.



---

archive/issue_comments_654848.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [dimpase](#comment%3A11):\n> Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.\n\n\nProbably all there is to it is that these functions were added before the incomplete gamma function was available in arb (for real balls at least).",
    "created_at": "2021-11-11T18:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654848",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:27'></a>
Replying to [dimpase](#comment%3A11):
> Can we put the code from `gamma(self, x)` into `gamma(self)` and do the dispatch on the type of the argument there? This will free the slot of `gamma(self, x)` - but perhaps break some grand design which I don't get.


Probably all there is to it is that these functions were added before the incomplete gamma function was available in arb (for real balls at least).



---

archive/issue_comments_654849.json:
```json
{
    "body": "<a id='comment:28'></a>\nThere is an article missing in\n\n```\n+        Otherwise, it computes Hurwitz zeta function.\n```\nand I would suggest adding\n\n```\ngamma_inc = gamma\n```\nin `RealBall` since both names are used in Sage.",
    "created_at": "2021-11-11T18:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654849",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:28'></a>
There is an article missing in

```
+        Otherwise, it computes Hurwitz zeta function.
```
and I would suggest adding

```
gamma_inc = gamma
```
in `RealBall` since both names are used in Sage.



---

archive/issue_comments_654850.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a\">f9bd200</a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr></table>\n",
    "created_at": "2021-11-11T20:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a">f9bd200</a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr></table>




---

archive/issue_comments_654851.json:
```json
{
    "body": "**Changing commit** from \"[5974956cbb96da432047a88c39afa5c9c18b99ee](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)\" to \"[f9bd200f64fa92d250934c5f3c4390784e23546a](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)\".",
    "created_at": "2021-11-11T20:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5974956cbb96da432047a88c39afa5c9c18b99ee](https://github.com/sagemath/sagetrac-mirror/commit/5974956cbb96da432047a88c39afa5c9c18b99ee)" to "[f9bd200f64fa92d250934c5f3c4390784e23546a](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)".



---

archive/issue_comments_654852.json:
```json
{
    "body": "<a id='comment:30'></a>\n`gamma_inc` added to the place where it's really making sense, i.e. where `gamma` may mean `gamma_inc`.",
    "created_at": "2021-11-11T20:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654852",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
`gamma_inc` added to the place where it's really making sense, i.e. where `gamma` may mean `gamma_inc`.



---

archive/issue_comments_654853.json:
```json
{
    "body": "<a id='comment:31'></a>\nFor functions with an additional parameter, you convert the parameter into `RBF`. Existing wrappers for arb special functions use coercions, not conversions. Coercion looks like a better choice to me, though this is debatable. In any case what we do with different functions should be consistent.\n\nSwitching from conversions to coercions breaks examples like `RBF(sin(3)).beta(sqrt(2/3))`, but `RBF(beta(sin(3),sqrt(2/3)))` (once implemented) will work, because the converter from symbolic expressions to real balls will traverse the expression and convert `sqrt(2/3)` recursively before it calls `beta`.\n\nAlso, all(?) occurrences of `RBF` in these conversions/coercions should be `self._parent`.\n\nI've implemented these changes, please feel free to revert to your branch if you disagree.",
    "created_at": "2021-11-12T09:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654853",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:31'></a>
For functions with an additional parameter, you convert the parameter into `RBF`. Existing wrappers for arb special functions use coercions, not conversions. Coercion looks like a better choice to me, though this is debatable. In any case what we do with different functions should be consistent.

Switching from conversions to coercions breaks examples like `RBF(sin(3)).beta(sqrt(2/3))`, but `RBF(beta(sin(3),sqrt(2/3)))` (once implemented) will work, because the converter from symbolic expressions to real balls will traverse the expression and convert `sqrt(2/3)` recursively before it calls `beta`.

Also, all(?) occurrences of `RBF` in these conversions/coercions should be `self._parent`.

I've implemented these changes, please feel free to revert to your branch if you disagree.



---

archive/issue_comments_654854.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)\" to \"[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)\".",
    "created_at": "2021-11-12T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654854",
    "user": "https://github.com/mezzarobba"
}
```

**Changing branch** from "[u/dimpase/packages/arb/morewrap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/arb/morewrap)" to "[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)".



---

archive/issue_comments_654855.json:
```json
{
    "body": "**Changing commit** from \"[f9bd200f64fa92d250934c5f3c4390784e23546a](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)\" to \"[0f88a4b273e9262b296fa2ae5fe75c447cb7db73](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)\".",
    "created_at": "2021-11-12T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654855",
    "user": "https://github.com/mezzarobba"
}
```

**Changing commit** from "[f9bd200f64fa92d250934c5f3c4390784e23546a](https://github.com/sagemath/sagetrac-mirror/commit/f9bd200f64fa92d250934c5f3c4390784e23546a)" to "[0f88a4b273e9262b296fa2ae5fe75c447cb7db73](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)".



---

archive/issue_comments_654856.json:
```json
{
    "body": "<a id='comment:32'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1dca9e3c71c667ab6b427e1fc6d3c5d1a803dfe\">c1dca9e</a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73\">0f88a4b</a></td><td><code>#32851 update a doctest</code></td></tr></table>\n",
    "created_at": "2021-11-12T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654856",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:32'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1dca9e3c71c667ab6b427e1fc6d3c5d1a803dfe">c1dca9e</a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73">0f88a4b</a></td><td><code>#32851 update a doctest</code></td></tr></table>




---

archive/issue_comments_654857.json:
```json
{
    "body": "<a id='comment:33'></a>\nhow about trying coercion, and if it fails switching to conversion, i.e. calling RBF() ?",
    "created_at": "2021-11-12T09:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654857",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
how about trying coercion, and if it fails switching to conversion, i.e. calling RBF() ?



---

archive/issue_comments_654858.json:
```json
{
    "body": "<a id='comment:34'></a>\nthe commit message for `beta` says:\n\n```\nwrapped arb's complete beta function\n\nthere are issues with Sage's beta being also\nimplemented via pynac, so RBF(beta(a,b)) does not\nwork, one needs RBF(a).beta(b) instead.\n```\n\nunless I miss something, your  change breaks `beta` on symbolic args.",
    "created_at": "2021-11-12T09:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654858",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
the commit message for `beta` says:

```
wrapped arb's complete beta function

there are issues with Sage's beta being also
implemented via pynac, so RBF(beta(a,b)) does not
work, one needs RBF(a).beta(b) instead.
```

unless I miss something, your  change breaks `beta` on symbolic args.



---

archive/issue_comments_654859.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [dimpase](#comment%3A34):\n> unless I miss something, your  change breaks `beta` on symbolic args.\n\n\nRegarding `a.beta(b)`, yes it does, and that's intentional.\n\nAs for `RBF(beta(a,b))`, the main reason it does not work is that `Function_beta` does not define the magic method `_method_arguments()` needed to specify how to map the arguments of the symbolic functions to those of the method.\n\nNevertheless, it seems that you are right and implementing `_method_arguments()` is not enough, because, contrary to what I said above, `Expression._arb_()` does not convert the arguments before calling the method. And indeed it shouldn't, since for some functions, the additional argument is not a ball.\n\nI don't like the idea of `ball.special_function(param)` triggering a conversion, but I don't know how to solve the issue...",
    "created_at": "2021-11-12T10:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654859",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:35'></a>
Replying to [dimpase](#comment%3A34):
> unless I miss something, your  change breaks `beta` on symbolic args.


Regarding `a.beta(b)`, yes it does, and that's intentional.

As for `RBF(beta(a,b))`, the main reason it does not work is that `Function_beta` does not define the magic method `_method_arguments()` needed to specify how to map the arguments of the symbolic functions to those of the method.

Nevertheless, it seems that you are right and implementing `_method_arguments()` is not enough, because, contrary to what I said above, `Expression._arb_()` does not convert the arguments before calling the method. And indeed it shouldn't, since for some functions, the additional argument is not a ball.

I don't like the idea of `ball.special_function(param)` triggering a conversion, but I don't know how to solve the issue...



---

archive/issue_comments_654860.json:
```json
{
    "body": "<a id='comment:36'></a>\nI don't know how the generic conversion is implemented, but for efficiency reasons it ought to try something cheap, i.e. coersion, first, so if this is true then the extra try/except I proposed in the previous comment is not even needed.",
    "created_at": "2021-11-12T13:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654860",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>
I don't know how the generic conversion is implemented, but for efficiency reasons it ought to try something cheap, i.e. coersion, first, so if this is true then the extra try/except I proposed in the previous comment is not even needed.



---

archive/issue_comments_654861.json:
```json
{
    "body": "<a id='comment:37'></a>\nTo be clear, I am not concerned about performance issues. I don't like the idea of special functions converting their argument because conversions are unsafe and should be as explicit as possible (that's the whole point of the conversion/coercion distinction).",
    "created_at": "2021-11-13T09:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654861",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:37'></a>
To be clear, I am not concerned about performance issues. I don't like the idea of special functions converting their argument because conversions are unsafe and should be as explicit as possible (that's the whole point of the conversion/coercion distinction).



---

archive/issue_comments_654862.json:
```json
{
    "body": "<a id='comment:38'></a>\nOK, fine. I thought I was just making it consistent with, say, `RR`, but it's in fact not so.\nAdd yourself as author/reviewer then :-)",
    "created_at": "2021-11-13T10:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654862",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>
OK, fine. I thought I was just making it consistent with, say, `RR`, but it's in fact not so.
Add yourself as author/reviewer then :-)



---

archive/issue_comments_654863.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-11-13T10:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654863",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_654864.json:
```json
{
    "body": "<a id='comment:39'></a>\nOk, thank you!",
    "created_at": "2021-11-13T10:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654864",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:39'></a>
Ok, thank you!



---

archive/issue_comments_654865.json:
```json
{
    "body": "**Reviewer:** Marc Mezzarobba, Dima Pasechnik",
    "created_at": "2021-11-13T10:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654865",
    "user": "https://github.com/mezzarobba"
}
```

**Reviewer:** Marc Mezzarobba, Dima Pasechnik



---

archive/issue_comments_654866.json:
```json
{
    "body": "**Changing author** from \"Dima Pasechnik\" to \"Dima Pasechnik, Marc Mezzarobba\".",
    "created_at": "2021-11-13T10:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654866",
    "user": "https://github.com/mezzarobba"
}
```

**Changing author** from "Dima Pasechnik" to "Dima Pasechnik, Marc Mezzarobba".



---

archive/issue_events_097714.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "rename": {
        "from": "Wrap arb's imaginary error function erfi,  incomplete gamma functions, etc.",
        "to": "Provide real ball erfi, Ei, Si, Ci, Shi, Chi, li, Li, beta, gamma_inc, gamma_inc_lower via arb"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32851#event-97714"
}
```



---

archive/issue_comments_654867.json:
```json
{
    "body": "**Changing keywords** from \"arb, RBF, RealBallField\" to \"arb, RBF, RealBallField, special functions\".",
    "created_at": "2021-11-13T14:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654867",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "arb, RBF, RealBallField" to "arb, RBF, RealBallField, special functions".



---

archive/issue_comments_654868.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,8 +4,23 @@\n \n - Currently `RBF(gamma(3/2, 1))` errors out, as\n   `arb_hypgeom_gamma_upper` is not known to the arb interface\n+- Same for other special functions `erfi`, `Ei`,...\n \n-- Same for `erfi`, `Ei`,...\n+Here, by wrapping the corresponding functions from arb,\n+we add real ball special functions:\n \n-We add them there.\n+- `erfi` -- imaginary error function\n+- `Ei` -- exponential integral\n+- `Si` -- sine integral\n+- `Ci` -- cosine integral\n+- `Shi` -- hyperbolic sine integral\n+- `Chi` -- hyperbolic cosine integral\n+- `li` -- logarithmic integral\n+- `Li` -- offset logarithmic integral\n+- `beta` -- complete Beta function\n+- `gamma_inc` -- upper incomplete Gamma function\n+- `gamma_inc_lower` -- lower incomplete Gamma function\n \n+and we clarify that `zeta` with an extra argument\n+gives the Hurwitz zeta function.\n+\n``````\n",
    "created_at": "2021-11-13T14:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654868",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,8 +4,23 @@
 
 - Currently `RBF(gamma(3/2, 1))` errors out, as
   `arb_hypgeom_gamma_upper` is not known to the arb interface
+- Same for other special functions `erfi`, `Ei`,...
 
-- Same for `erfi`, `Ei`,...
+Here, by wrapping the corresponding functions from arb,
+we add real ball special functions:
 
-We add them there.
+- `erfi` -- imaginary error function
+- `Ei` -- exponential integral
+- `Si` -- sine integral
+- `Ci` -- cosine integral
+- `Shi` -- hyperbolic sine integral
+- `Chi` -- hyperbolic cosine integral
+- `li` -- logarithmic integral
+- `Li` -- offset logarithmic integral
+- `beta` -- complete Beta function
+- `gamma_inc` -- upper incomplete Gamma function
+- `gamma_inc_lower` -- lower incomplete Gamma function
 
+and we clarify that `zeta` with an extra argument
+gives the Hurwitz zeta function.
+
``````




---

archive/issue_comments_654869.json:
```json
{
    "body": "<a id='comment:40'></a>\nThe docstring for beta mentions Gamma,\nis that a copy-pasto?",
    "created_at": "2021-11-13T14:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654869",
    "user": "https://github.com/slel"
}
```

<a id='comment:40'></a>
The docstring for beta mentions Gamma,
is that a copy-pasto?



---

archive/issue_comments_654870.json:
```json
{
    "body": "<a id='comment:41'></a>\nIn `src/sage/rings/complex_arb.pyx` we have\n\n- uncapitalized `ei`, `si`, `ci`, `shi`, `chi`\n- `li(self, bint offset=False)`\n  rather than `li` and `Li`\n\nI would use the same here for consistency.\nWhat do you think?",
    "created_at": "2021-11-13T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654870",
    "user": "https://github.com/slel"
}
```

<a id='comment:41'></a>
In `src/sage/rings/complex_arb.pyx` we have

- uncapitalized `ei`, `si`, `ci`, `shi`, `chi`
- `li(self, bint offset=False)`
  rather than `li` and `Li`

I would use the same here for consistency.
What do you think?



---

archive/issue_comments_654871.json:
```json
{
    "body": "**Changing reviewer** from \"Marc Mezzarobba, Dima Pasechnik\" to \"Marc Mezzarobba, Dima Pasechnik, Samuel Leli\u00e8vre\".",
    "created_at": "2021-11-13T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654871",
    "user": "https://github.com/slel"
}
```

**Changing reviewer** from "Marc Mezzarobba, Dima Pasechnik" to "Marc Mezzarobba, Dima Pasechnik, Samuel Lelièvre".



---

archive/issue_comments_654872.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-11-13T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654872",
    "user": "https://github.com/slel"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_654873.json:
```json
{
    "body": "<a id='comment:42'></a>\nThanks Samuel, I indeed went too fast with the review!",
    "created_at": "2021-11-13T16:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654873",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:42'></a>
Thanks Samuel, I indeed went too fast with the review!



---

archive/issue_comments_654874.json:
```json
{
    "body": "<a id='comment:43'></a>\nhuh? Li and li are different Sage symbolic functions. Both need to be dealt with by RBF",
    "created_at": "2021-11-13T20:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654874",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>
huh? Li and li are different Sage symbolic functions. Both need to be dealt with by RBF



---

archive/issue_comments_654875.json:
```json
{
    "body": "<a id='comment:44'></a>\nthe inconsistency is in CBF, and ought to be addressed on another ticket, not here.\nSage does not have ei, it has Ei, using ei in place of Ei is just creating confusion.",
    "created_at": "2021-11-13T21:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654875",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
the inconsistency is in CBF, and ought to be addressed on another ticket, not here.
Sage does not have ei, it has Ei, using ei in place of Ei is just creating confusion.



---

archive/issue_comments_654876.json:
```json
{
    "body": "<a id='comment:45'></a>\nIt's `CBF` that can't properly handle symbolic arguments, e.g. `CBF(Ei(I))` leads to an infinite recursion, just as `RBF(Ei(1))` did before the fixes introduced in this ticket. And `CBF(Ei(I))` doesn't work because there `CBF` does not know anything about Sage function `Ei`, it only knows about how to compute `Ei(t)` for t converted to CBF, by calling an improperly named `CBF(t).ei()`.\n\nA fix is trivial:\n\n```diff\n--- a/src/sage/rings/complex_arb.pyx\n+++ b/src/sage/rings/complex_arb.pyx\n@@ -4192,6 +4192,8 @@ cdef class ComplexBall(RingElement):\n         if _do_sig(prec(self)): sig_off()\n         return result\n \n+    Ei = ei\n+\n     def si(self):\n         \"\"\"\n         Return the sine integral with argument ``self``.\n```\n\nNow we can do\n\n```\nsage: CBF(Ei(I))\n[0.337403922900968 +/- 4.31e-16] + [2.51687939716208 +/- 2.01e-15]*I\n```\n\nI'm setting this back to positive review, and invite everyone to deal with the `CBF` issue in #32869.",
    "created_at": "2021-11-13T23:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654876",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>
It's `CBF` that can't properly handle symbolic arguments, e.g. `CBF(Ei(I))` leads to an infinite recursion, just as `RBF(Ei(1))` did before the fixes introduced in this ticket. And `CBF(Ei(I))` doesn't work because there `CBF` does not know anything about Sage function `Ei`, it only knows about how to compute `Ei(t)` for t converted to CBF, by calling an improperly named `CBF(t).ei()`.

A fix is trivial:

```diff
--- a/src/sage/rings/complex_arb.pyx
+++ b/src/sage/rings/complex_arb.pyx
@@ -4192,6 +4192,8 @@ cdef class ComplexBall(RingElement):
         if _do_sig(prec(self)): sig_off()
         return result
 
+    Ei = ei
+
     def si(self):
         """
         Return the sine integral with argument ``self``.
```

Now we can do

```
sage: CBF(Ei(I))
[0.337403922900968 +/- 4.31e-16] + [2.51687939716208 +/- 2.01e-15]*I
```

I'm setting this back to positive review, and invite everyone to deal with the `CBF` issue in #32869.



---

archive/issue_comments_654877.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2021-11-13T23:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654877",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_654878.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2021-11-14T09:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654878",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_654879.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/feff55e50727d51b270320518ebeed932fcd1823\">feff55e</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a4bf9647b36f78ad93e6220a93cad72528dcb15\">2a4bf96</a></td><td><code>wrap arb's Ei</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5892c9e57d87bd825b69a8e8bd8e0f8ae2034f5\">b5892c9</a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/335ccc78b3ecdf1722a309bcd2f99fdc79a801f0\">335ccc7</a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a532ebf510ad650addd0375daf7801f3a914a90\">8a532eb</a></td><td><code>wrapped arb's complete beta function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03e7d80d40cd04ebf431073e50cef92393c71032\">03e7d80</a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d82f61a1533b70b25baa9c840ecc2d96b295b87\">2d82f61</a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8092951b7bd52619405cf90c00f4a4fd1312e331\">8092951</a></td><td><code>#32851 update a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac\">3a5d60c</a></td><td><code>#32851 incomplete beta function + minor fixes</code></td></tr></table>\n",
    "created_at": "2021-11-14T09:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/feff55e50727d51b270320518ebeed932fcd1823">feff55e</a></td><td><code>fixes for arb's incomplete gamma and erfi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a4bf9647b36f78ad93e6220a93cad72528dcb15">2a4bf96</a></td><td><code>wrap arb's Ei</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5892c9e57d87bd825b69a8e8bd8e0f8ae2034f5">b5892c9</a></td><td><code>wrap arb's gamma_inc_lower</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/335ccc78b3ecdf1722a309bcd2f99fdc79a801f0">335ccc7</a></td><td><code>wrapped arb chi, shi, li, Li</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a532ebf510ad650addd0375daf7801f3a914a90">8a532eb</a></td><td><code>wrapped arb's complete beta function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03e7d80d40cd04ebf431073e50cef92393c71032">03e7d80</a></td><td><code>add missing article and gamma_inc defn and test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d82f61a1533b70b25baa9c840ecc2d96b295b87">2d82f61</a></td><td><code>#32851 fix conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8092951b7bd52619405cf90c00f4a4fd1312e331">8092951</a></td><td><code>#32851 update a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac">3a5d60c</a></td><td><code>#32851 incomplete beta function + minor fixes</code></td></tr></table>




---

archive/issue_comments_654880.json:
```json
{
    "body": "**Changing commit** from \"[0f88a4b273e9262b296fa2ae5fe75c447cb7db73](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)\" to \"[3a5d60cb59816538050236ebb3f9c760617601ac](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)\".",
    "created_at": "2021-11-14T09:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0f88a4b273e9262b296fa2ae5fe75c447cb7db73](https://github.com/sagemath/sagetrac-mirror/commit/0f88a4b273e9262b296fa2ae5fe75c447cb7db73)" to "[3a5d60cb59816538050236ebb3f9c760617601ac](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)".



---

archive/issue_comments_654881.json:
```json
{
    "body": "<a id='comment:47'></a>\nBut Samuel is right that the docstring of beta was incorrect. I fixed this, made a couple of other minor improvements, and rebased the branch on top of the last beta.\n\nI agree that some of the methods of `CBF` have badly chosen names/interfaces in view of what is available in `sage.functions`. Part of the reason, I guess, is that these methods were added (in #19082) before the mechanism for calling them when converting symbolic expressions.\n\nFrom my point of view (and I thinks this may explain some of the misunderstandings on this ticket), the main goal of the methods of the form `ComplexBall.special_function()` is to provide a clean interface to the special functions available in Arb. `CBF(constant_expression)` sort of works now, but it is a fragile hack, and I do not recommend relying on it.\n\nAs a side note, it is not necessary for `CBF(f(x))` to work that `f` and the method it defers to have the same: the symbolic function can also provide the mapping. But I agree that it makes more sense in the present situation to rename the methods of `ComplexBall`.",
    "created_at": "2021-11-14T09:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654881",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:47'></a>
But Samuel is right that the docstring of beta was incorrect. I fixed this, made a couple of other minor improvements, and rebased the branch on top of the last beta.

I agree that some of the methods of `CBF` have badly chosen names/interfaces in view of what is available in `sage.functions`. Part of the reason, I guess, is that these methods were added (in #19082) before the mechanism for calling them when converting symbolic expressions.

From my point of view (and I thinks this may explain some of the misunderstandings on this ticket), the main goal of the methods of the form `ComplexBall.special_function()` is to provide a clean interface to the special functions available in Arb. `CBF(constant_expression)` sort of works now, but it is a fragile hack, and I do not recommend relying on it.

As a side note, it is not necessary for `CBF(f(x))` to work that `f` and the method it defers to have the same: the symbolic function can also provide the mapping. But I agree that it makes more sense in the present situation to rename the methods of `ComplexBall`.



---

archive/issue_comments_654882.json:
```json
{
    "body": "**Changing commit** from \"[3a5d60cb59816538050236ebb3f9c760617601ac](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)\" to \"[aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)\".",
    "created_at": "2021-11-14T11:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3a5d60cb59816538050236ebb3f9c760617601ac](https://github.com/sagemath/sagetrac-mirror/commit/3a5d60cb59816538050236ebb3f9c760617601ac)" to "[aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)".



---

archive/issue_comments_654883.json:
```json
{
    "body": "<a id='comment:48'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/535719018598e165bee841f6e7c8911870b5f4de\">5357190</a></td><td><code>#32851 more aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7\">aa35a2b</a></td><td><code>#32851 partial support for symbolic beta</code></td></tr></table>\n",
    "created_at": "2021-11-14T11:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/535719018598e165bee841f6e7c8911870b5f4de">5357190</a></td><td><code>#32851 more aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7">aa35a2b</a></td><td><code>#32851 partial support for symbolic beta</code></td></tr></table>




---

archive/issue_comments_654884.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-11-14T12:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654884",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_654885.json:
```json
{
    "body": "<a id='comment:49'></a>\nOK, thanks!",
    "created_at": "2021-11-14T12:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654885",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>
OK, thanks!



---

archive/issue_comments_654886.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-11-15T23:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654886",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_097715.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-15T23:16:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32851#event-97715"
}
```



---

archive/issue_comments_654887.json:
```json
{
    "body": "**Changing branch** from \"[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)\" to \"[aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)\".",
    "created_at": "2021-11-15T23:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32851#issuecomment-654887",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mmezzarobba/32851-RBF_specfun](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/32851-RBF_specfun)" to "[aa35a2b92adefed50bebf4b02029df7867d250f7](https://github.com/sagemath/sagetrac-mirror/commit/aa35a2b92adefed50bebf4b02029df7867d250f7)".
