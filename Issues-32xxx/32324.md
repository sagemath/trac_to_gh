# Issue 32324: Lazy Taylor Series

archive/issues_032087.json:
```json
{
    "body": "We implement (multivariate) Taylor series.\n\nNote that there is no easy well-defined notion of multivariate Laurent series, which is why we create a new class.\n\nCC:  @tscrim @tejasvicsr1 @slel\n\nKeywords: LazyPowerSeries, FormalSeries\n\nBranch/Commit: e78047258774176c6e8271e29c9b5825cc12aa11\n\nReviewer: Travis Scrimshaw\n\nAuthor: Martin Rubey\n\nDependencies: #32309, #34330\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32324\n\n",
    "closed_at": "2022-08-30T19:05:29Z",
    "created_at": "2021-08-02T07:14:26Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Lazy Taylor Series",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32324",
    "user": "https://github.com/mantepse"
}
```
We implement (multivariate) Taylor series.

Note that there is no easy well-defined notion of multivariate Laurent series, which is why we create a new class.

CC:  @tscrim @tejasvicsr1 @slel

Keywords: LazyPowerSeries, FormalSeries

Branch/Commit: e78047258774176c6e8271e29c9b5825cc12aa11

Reviewer: Travis Scrimshaw

Author: Martin Rubey

Dependencies: #32309, #34330

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32324





---

archive/issue_comments_489177.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2021-08-02T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489177",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_489178.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2021-08-02T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489178",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_489179.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2021-08-02T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489179",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_489180.json:
```json
{
    "body": "Changing keywords from \"\" to \"LazyPowerSeries, FormalSeries\".",
    "created_at": "2021-08-02T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489180",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "" to "LazyPowerSeries, FormalSeries".



---

archive/issue_comments_489181.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+We implement (multivariate) Taylor series.\n \n+Note that there is no easy well-defined notion of multivariate Laurent series, which is why we create a new class.\n \n Comment: 1\n \n```\n",
    "created_at": "2021-08-02T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489181",
    "user": "https://github.com/mantepse"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+We implement (multivariate) Taylor series.
 
+Note that there is no easy well-defined notion of multivariate Laurent series, which is why we create a new class.
 
 Comment: 1
 
```




---

archive/issue_comments_489182.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-02T15:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489183.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-03T12:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489184.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-08-04T09:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_489185.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T11:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489186.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T11:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489187.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T15:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489188.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-05T10:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489189.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-05T11:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489190.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-05T15:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489191.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-05T17:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489192.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-07T17:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489193.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-08T13:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489194.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-08T20:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489195.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T11:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489195",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489196.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T11:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489197.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T12:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489198.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T14:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489199.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T20:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_085732.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85732"
}
```



---

archive/issue_comments_489200.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-10T14:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489201.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-11T08:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489202.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-11T14:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489203.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-11T18:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489204.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T08:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489205.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T08:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489206.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T09:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489206",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489207.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T15:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489208.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T16:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489209.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T09:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489210.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T09:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489211.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T11:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489212.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T13:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489213.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T16:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489213",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489214.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-17T06:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489215.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-17T06:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489216.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-17T09:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489217.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-17T10:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489218.json:
```json
{
    "body": "<a id='comment:40'></a>Here is an initial rebase over the recent changes. I had the manually add stuff in because the backporting was removing stuff from this branch, so it didn't actually add the code under a `git merge`. However, I believe I got everything.\n\nThere are a number of doctests that are failing, as well as additional work to bring it fully in line with the other tickets. Likely nearly all of the failures are related to a single issue as they all have error messages of the form:\n\n```\nTypeError: Could not find a mapping of the passed element to this ring.\n```\nHowever, I have yet to investigate.",
    "created_at": "2021-10-02T01:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489218",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Here is an initial rebase over the recent changes. I had the manually add stuff in because the backporting was removing stuff from this branch, so it didn't actually add the code under a `git merge`. However, I believe I got everything.

There are a number of doctests that are failing, as well as additional work to bring it fully in line with the other tickets. Likely nearly all of the failures are related to a single issue as they all have error messages of the form:

```
TypeError: Could not find a mapping of the passed element to this ring.
```
However, I have yet to investigate.



---

archive/issue_comments_489219.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-10-02T01:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_489220.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-03T05:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_085733.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85733"
}
```



---

archive/issue_events_085734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85734"
}
```



---

archive/issue_comments_489221.json:
```json
{
    "body": "<a id='comment:44'></a>Trying to get back to this ticket :-)\n\n* there are some failing doctests (essentially, the `polynomial` method is missing for `LazyTaylorSeries`, but used, in various doctests and in `LazyTaylorSeries.__call__`)\n* if I recall correctly, we need to rethink `__call__` for some classes, because I was introducing a memory leak - part of the method probably has to be moved to `sage.data_structures.stream`.\n* we define `self._laurent_poly_ring` and `self._internal_poly_ring` for various parents, but\n  - they are undocumented\n  - we use them in the element classes\n\n* it might be good to have an overview somewhere, describing which gems we have created!\n\n* we should have a doctest for implicitly defined lazy symmetric functions",
    "created_at": "2022-01-30T09:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489221",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:44'></a>Trying to get back to this ticket :-)

* there are some failing doctests (essentially, the `polynomial` method is missing for `LazyTaylorSeries`, but used, in various doctests and in `LazyTaylorSeries.__call__`)
* if I recall correctly, we need to rethink `__call__` for some classes, because I was introducing a memory leak - part of the method probably has to be moved to `sage.data_structures.stream`.
* we define `self._laurent_poly_ring` and `self._internal_poly_ring` for various parents, but
  - they are undocumented
  - we use them in the element classes

* it might be good to have an overview somewhere, describing which gems we have created!

* we should have a doctest for implicitly defined lazy symmetric functions



---

archive/issue_comments_489222.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-03T09:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489223.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:44 mantepse]:\n> Trying to get back to this ticket :-)\n\n\nSame here. `:)`\n\n> * there are some failing doctests (essentially, the `polynomial` method is missing for `LazyTaylorSeries`, but used, in various doctests and in `LazyTaylorSeries.__call__`)\n\n\nI have added this and fixed up other failing doctests.\n\n> * if I recall correctly, we need to rethink `__call__` for some classes, because I was introducing a memory leak - part of the method probably has to be moved to `sage.data_structures.stream`.\n\n\nI recall it was very specific with the `series()` implementation when it was passed in a `coefficient` function. I don't remember anything about `__call__` having a (potential) memleak, but I might be forgetting something. (I think we can use `R.zero()` instead of `R(0)` though.) Perhaps I wanted to use the underlying stream to build the new stream instead of the element class?\n\n> * we define `self._laurent_poly_ring` and `self._internal_poly_ring` for various parents, but\n>   - they are undocumented\n>   - we use them in the element classes\n\n\nThey are attributes that are fairly self-documented and an implementation detail. So I don't feel the need to put much more in, especially in the public documentation. If you want to add a (code) comment, feel free to do so.\n\n> * it might be good to have an overview somewhere, describing which gems we have created!\n\n\nI agree that having a nice (thematic?) tutorial will be good. Although we can do it on a separate ticket.\n\n> * we should have a doctest for implicitly defined lazy symmetric functions\n\n\nCan you add this in?",
    "created_at": "2022-02-03T09:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489223",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Replying to [comment:44 mantepse]:
> Trying to get back to this ticket :-)


Same here. `:)`

> * there are some failing doctests (essentially, the `polynomial` method is missing for `LazyTaylorSeries`, but used, in various doctests and in `LazyTaylorSeries.__call__`)


I have added this and fixed up other failing doctests.

> * if I recall correctly, we need to rethink `__call__` for some classes, because I was introducing a memory leak - part of the method probably has to be moved to `sage.data_structures.stream`.


I recall it was very specific with the `series()` implementation when it was passed in a `coefficient` function. I don't remember anything about `__call__` having a (potential) memleak, but I might be forgetting something. (I think we can use `R.zero()` instead of `R(0)` though.) Perhaps I wanted to use the underlying stream to build the new stream instead of the element class?

> * we define `self._laurent_poly_ring` and `self._internal_poly_ring` for various parents, but
>   - they are undocumented
>   - we use them in the element classes


They are attributes that are fairly self-documented and an implementation detail. So I don't feel the need to put much more in, especially in the public documentation. If you want to add a (code) comment, feel free to do so.

> * it might be good to have an overview somewhere, describing which gems we have created!


I agree that having a nice (thematic?) tutorial will be good. Although we can do it on a separate ticket.

> * we should have a doctest for implicitly defined lazy symmetric functions


Can you add this in?



---

archive/issue_events_085735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:45:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85735"
}
```



---

archive/issue_events_085736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:45:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85736"
}
```



---

archive/issue_comments_489224.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T07:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489225.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-27T13:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489226.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-27T13:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489226",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_489227.json:
```json
{
    "body": "<a id='comment:51'></a>Greetings from Singapore. I hope you are having a good trip back as well.\n\nTwo things from the patchbot that should be quick to fix:\n\n1. Two of the new methods are lacking doctests (or being marked as `# indirect doctest`). Run `sage \u2014coverage rings/lazy_series_ring.py` to see which ones.\n2. Pyflakes fixes (see, e.g., patchbot).\n\nI can do these next week once I get back to my office. Although if you do them before me, feel free to set this to a positive review once pushed.",
    "created_at": "2022-07-28T00:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489227",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:51'></a>Greetings from Singapore. I hope you are having a good trip back as well.

Two things from the patchbot that should be quick to fix:

1. Two of the new methods are lacking doctests (or being marked as `# indirect doctest`). Run `sage —coverage rings/lazy_series_ring.py` to see which ones.
2. Pyflakes fixes (see, e.g., patchbot).

I can do these next week once I get back to my office. Although if you do them before me, feel free to set this to a positive review once pushed.



---

archive/issue_comments_489228.json:
```json
{
    "body": "<a id='comment:52'></a>Hi Travis!  I am at the gate, another 14 hours and I am at home :-)\n\nThese missing doctests were in fact hiding bugs and small shortcomings.  I fixed most of them (did not push yet), but I still have to fix `__call__` with second argument being a symmetric function (not lazy) and the analogous thing for multivariate Taylor.\n\nThe easy fix would be to convert the inner function(s) to their lazy versions first, and profile and optimize later, but I'm not sure whether that's the right approach.",
    "created_at": "2022-07-28T13:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489228",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:52'></a>Hi Travis!  I am at the gate, another 14 hours and I am at home :-)

These missing doctests were in fact hiding bugs and small shortcomings.  I fixed most of them (did not push yet), but I still have to fix `__call__` with second argument being a symmetric function (not lazy) and the analogous thing for multivariate Taylor.

The easy fix would be to convert the inner function(s) to their lazy versions first, and profile and optimize later, but I'm not sure whether that's the right approach.



---

archive/issue_comments_489229.json:
```json
{
    "body": "<a id='comment:53'></a>Hopefully it wasn't any trouble getting back to Bangalore and to the airport from there. I am responding on the train on my phone, so I can't really check the code right now. Sorry about going off my memory here.\n\nI am a bit split about this. In one sense, I like just doing the simple fix because that makes it work and behaves like the correct object, and it makes the code shorter. However, it is not correct because it returns an element in the wrong parent when we have a finite (exact) series. (E.g., evaluating a polynomial at an element of the base ring gives you a base ring element, not a polynomial.) It probably isn't too bad to separate these cases here (if we don't do it already). For the case when we have an infinite series, it is safe to convert it since we can't do better. Although perhaps we should raise an error in that case? What did we do for Laurent series?\n\nOh, I also thought of another minor point about the exactness. This depends on the exactness of the underlying field. I don't remember if we checked this or not. If we didn't get this right for Laurent series, then it should be a followup ticket. I can check this.",
    "created_at": "2022-07-28T13:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489229",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'></a>Hopefully it wasn't any trouble getting back to Bangalore and to the airport from there. I am responding on the train on my phone, so I can't really check the code right now. Sorry about going off my memory here.

I am a bit split about this. In one sense, I like just doing the simple fix because that makes it work and behaves like the correct object, and it makes the code shorter. However, it is not correct because it returns an element in the wrong parent when we have a finite (exact) series. (E.g., evaluating a polynomial at an element of the base ring gives you a base ring element, not a polynomial.) It probably isn't too bad to separate these cases here (if we don't do it already). For the case when we have an infinite series, it is safe to convert it since we can't do better. Although perhaps we should raise an error in that case? What did we do for Laurent series?

Oh, I also thought of another minor point about the exactness. This depends on the exactness of the underlying field. I don't remember if we checked this or not. If we didn't get this right for Laurent series, then it should be a followup ticket. I can check this.



---

archive/issue_comments_489230.json:
```json
{
    "body": "<a id='comment:54'></a>Now that I have looked at the code for Laurent series, we should convert the symmetric function over to a lazy one when doing `f(g)` when `f` is a not-known-to-be-finite lazy symmetric function and `g` is a symmetric function. This is what we do with lazy Laurent series, where composition implemented as a `Stream_function`. Lazy Taylor series will also follow the same model.\n\nFor exactness, we are just using the default from `Parent`, which returns `True`. However, it should also check the base ring (a la polynomials).",
    "created_at": "2022-08-03T03:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489230",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:54'></a>Now that I have looked at the code for Laurent series, we should convert the symmetric function over to a lazy one when doing `f(g)` when `f` is a not-known-to-be-finite lazy symmetric function and `g` is a symmetric function. This is what we do with lazy Laurent series, where composition implemented as a `Stream_function`. Lazy Taylor series will also follow the same model.

For exactness, we are just using the default from `Parent`, which returns `True`. However, it should also check the base ring (a la polynomials).



---

archive/issue_comments_489231.json:
```json
{
    "body": "<a id='comment:55'></a>Also, if you could push where you are currently at, that way I can look at those changes. I can also work on the composition code if you are a bit busy right now too.",
    "created_at": "2022-08-03T03:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489231",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:55'></a>Also, if you could push where you are currently at, that way I can look at those changes. I can also work on the composition code if you are a bit busy right now too.



---

archive/issue_comments_489232.json:
```json
{
    "body": "<a id='comment:56'></a>I don't have proper internet until Saturday. But I have no changes to the composition code which are worth keeping yet.\n\nA tiny thing: maybe sparseness should d\u00e9pend on the outer argument, not the inner.",
    "created_at": "2022-08-03T06:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489232",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:56'></a>I don't have proper internet until Saturday. But I have no changes to the composition code which are worth keeping yet.

A tiny thing: maybe sparseness should dépend on the outer argument, not the inner.



---

archive/issue_comments_489233.json:
```json
{
    "body": "<a id='comment:57'></a>No problem. I will just look at it next week.\n\nI think sparseness (for compositions) should depend on the inner argument since the result should belong to the parent of the inner argument (to the extent it is possible). So having it depend on the outer argument breaks that principle.",
    "created_at": "2022-08-04T02:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489233",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:57'></a>No problem. I will just look at it next week.

I think sparseness (for compositions) should depend on the inner argument since the result should belong to the parent of the inner argument (to the extent it is possible). So having it depend on the outer argument breaks that principle.



---

archive/issue_comments_489234.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T09:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489235.json:
```json
{
    "body": "<a id='comment:59'></a>There is now one failing doctest in `LazySymmetricFunction.__call__`.",
    "created_at": "2022-08-07T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489235",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:59'></a>There is now one failing doctest in `LazySymmetricFunction.__call__`.



---

archive/issue_comments_489236.json:
```json
{
    "body": "<a id='comment:60'></a>We currently distinguish between fully lazy and \"exact\" objects (where the underlying stream is eventually constant).\n\nThe advantage of keeping track of \"exact\" objects is, that we can test for zero in some cases, and possibly speed.\n\nHowever, some operations on \"exact\" objects which in principle would produce \"exact\" objects again, such as multiplication in the Dirichlet ring, may produce objects of very large degree.  In such a case the full computation would be very time-consuming, so we switched it off, see `LazyDirichletSeries._mul_`.\n\nWould it be feasible, and make sense, to introduce another class in the hierarchy of streams, which only asserts that the stream is eventually constant (possibly keeping track of the degree from which this must be the case), but does not perform the computations?\n\nI am not sure how much performance we gain in the \"exact\" case in practice.  It is a fair bit of code.  (in `lazy_series.py`, we check 35 times `isinstance(*, Stream_exact)`.  If the performance gain is not important, maybe it would be even better to only keep track of the degree.",
    "created_at": "2022-08-07T09:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489236",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:60'></a>We currently distinguish between fully lazy and "exact" objects (where the underlying stream is eventually constant).

The advantage of keeping track of "exact" objects is, that we can test for zero in some cases, and possibly speed.

However, some operations on "exact" objects which in principle would produce "exact" objects again, such as multiplication in the Dirichlet ring, may produce objects of very large degree.  In such a case the full computation would be very time-consuming, so we switched it off, see `LazyDirichletSeries._mul_`.

Would it be feasible, and make sense, to introduce another class in the hierarchy of streams, which only asserts that the stream is eventually constant (possibly keeping track of the degree from which this must be the case), but does not perform the computations?

I am not sure how much performance we gain in the "exact" case in practice.  It is a fair bit of code.  (in `lazy_series.py`, we check 35 times `isinstance(*, Stream_exact)`.  If the performance gain is not important, maybe it would be even better to only keep track of the degree.



---

archive/issue_comments_489237.json:
```json
{
    "body": "<a id='comment:61'></a>There is a difference between an element of a different ring and an element of the lazy ring, which is *independent* of the internal implementation details of the lazy ring elements. The issue at hand is about how to handle elements in a different ring converting to coercing in. I just want to make sure you are not accidentally mixing the two issues.\n\nI strongly believe we should keep the special cases for when it is exact. I agree that Dirichlet series is a special case because of the product structure. Even if (and that is a huge if) we agree to not support true exact arithmetic when possible, I don't think you are proposing will reduce much of the code because you still want to check the cases when we know it is exact (e.g., checking if an element is `0` or not). We could add support for this in `Stream_dirichlet_convolve`, but that should be a followup ticket.\n\nHere is also a small demo of the speed improvements:\n\n```\nsage: R.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = R(lambda n: 1 if n < 3 else 0, valuation=0)\nsage: f  # this caches the values\n1 + z + z^2 + O(z^7)\nsage: g = 1 + z + z^2\nsage: %timeit (f * f)[0:5]\n16.7 \u00b5s \u00b1 66.6 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops each)\nsage: %timeit (g * g)[0:5]\n14.1 \u00b5s \u00b1 88.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops each)\n\nsage: f = R(lambda n: 1 if n < 6 else 0, valuation=0)\nsage: f\n1 + z + z^2 + z^3 + z^4 + z^5 + O(z^7)\nsage: g = 1 + z + z^2 + z^3 + z^4 + z^5\nsage: %timeit (f * f)[0:11]\n52.5 \u00b5s \u00b1 244 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit (g * g)[0:11]\n32.1 \u00b5s \u00b1 411 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n```\nOf course, the non-exact computation could likely be made faster, but I doubt in a way that could compare to the exact one.",
    "created_at": "2022-08-08T06:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489237",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:61'></a>There is a difference between an element of a different ring and an element of the lazy ring, which is *independent* of the internal implementation details of the lazy ring elements. The issue at hand is about how to handle elements in a different ring converting to coercing in. I just want to make sure you are not accidentally mixing the two issues.

I strongly believe we should keep the special cases for when it is exact. I agree that Dirichlet series is a special case because of the product structure. Even if (and that is a huge if) we agree to not support true exact arithmetic when possible, I don't think you are proposing will reduce much of the code because you still want to check the cases when we know it is exact (e.g., checking if an element is `0` or not). We could add support for this in `Stream_dirichlet_convolve`, but that should be a followup ticket.

Here is also a small demo of the speed improvements:

```
sage: R.<z> = LazyLaurentSeriesRing(QQ)
sage: f = R(lambda n: 1 if n < 3 else 0, valuation=0)
sage: f  # this caches the values
1 + z + z^2 + O(z^7)
sage: g = 1 + z + z^2
sage: %timeit (f * f)[0:5]
16.7 µs ± 66.6 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)
sage: %timeit (g * g)[0:5]
14.1 µs ± 88.2 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)

sage: f = R(lambda n: 1 if n < 6 else 0, valuation=0)
sage: f
1 + z + z^2 + z^3 + z^4 + z^5 + O(z^7)
sage: g = 1 + z + z^2 + z^3 + z^4 + z^5
sage: %timeit (f * f)[0:11]
52.5 µs ± 244 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit (g * g)[0:11]
32.1 µs ± 411 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
```
Of course, the non-exact computation could likely be made faster, but I doubt in a way that could compare to the exact one.



---

archive/issue_comments_489238.json:
```json
{
    "body": "<a id='comment:62'></a>That's perfect!  Thank you for illustrating the performance difference.  I will try to add it somewhere as a comment.",
    "created_at": "2022-08-08T09:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489238",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:62'></a>That's perfect!  Thank you for illustrating the performance difference.  I will try to add it somewhere as a comment.



---

archive/issue_comments_489239.json:
```json
{
    "body": "<a id='comment:63'></a>I just noticed:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(ZZ)\nsage: f = 1-z\nsage: isinstance((f^-1)._coeff_stream, sage.data_structures.stream.Stream_exact)\nTrue\nsage: isinstance((1/f)._coeff_stream, sage.data_structures.stream.Stream_exact)\nFalse\n```",
    "created_at": "2022-08-08T09:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489239",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:63'></a>I just noticed:

```
sage: L.<z> = LazyLaurentSeriesRing(ZZ)
sage: f = 1-z
sage: isinstance((f^-1)._coeff_stream, sage.data_structures.stream.Stream_exact)
True
sage: isinstance((1/f)._coeff_stream, sage.data_structures.stream.Stream_exact)
False
```



---

archive/issue_comments_489240.json:
```json
{
    "body": "<a id='comment:64'></a>Dividing by an exact series is not always eventually constant, so it cannot be exact:\n\n```\nsage: 1 / (1 + z)\n1 - z + z^2 - z^3 + z^4 - z^5 + z^6 + O(z^7)\n```\nWe would have to work somewhat hard to check this.",
    "created_at": "2022-08-08T09:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489240",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:64'></a>Dividing by an exact series is not always eventually constant, so it cannot be exact:

```
sage: 1 / (1 + z)
1 - z + z^2 - z^3 + z^4 - z^5 + z^6 + O(z^7)
```
We would have to work somewhat hard to check this.



---

archive/issue_comments_489241.json:
```json
{
    "body": "<a id='comment:65'></a>Actually, we already do the work in `__invert__`. We just do not seem to have carried it over to division.",
    "created_at": "2022-08-08T09:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489241",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:65'></a>Actually, we already do the work in `__invert__`. We just do not seem to have carried it over to division.



---

archive/issue_comments_489242.json:
```json
{
    "body": "<a id='comment:66'></a>Replying to [comment:65 tscrim]:\n> Actually, we already do the work in `__invert__`. We just do not seem to have carried it over to division.\n\n\nThat's what I should have written :-)",
    "created_at": "2022-08-08T09:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489242",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:66'></a>Replying to [comment:65 tscrim]:
> Actually, we already do the work in `__invert__`. We just do not seem to have carried it over to division.


That's what I should have written :-)



---

archive/issue_comments_489243.json:
```json
{
    "body": "<a id='comment:67'></a>I'll work on `_div_`, so you can concentrate on `_call_`, OK?",
    "created_at": "2022-08-08T09:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489243",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:67'></a>I'll work on `_div_`, so you can concentrate on `_call_`, OK?



---

archive/issue_comments_489244.json:
```json
{
    "body": "<a id='comment:68'></a>Sounds good. Although I won't be able to get back to it until tomorrow (it is 7 PM here now and I am hungry `:)`).",
    "created_at": "2022-08-08T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489244",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:68'></a>Sounds good. Although I won't be able to get back to it until tomorrow (it is 7 PM here now and I am hungry `:)`).



---

archive/issue_comments_489245.json:
```json
{
    "body": "<a id='comment:69'></a>I think I have an elegant way to preserve exactness in `_div_`, but it fails for series with symmetric functions as coefficients, because symmetric functions in sage do not inherit from ring :-(",
    "created_at": "2022-08-09T21:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489245",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:69'></a>I think I have an elegant way to preserve exactness in `_div_`, but it fails for series with symmetric functions as coefficients, because symmetric functions in sage do not inherit from ring :-(



---

archive/issue_comments_489246.json:
```json
{
    "body": "<a id='comment:70'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-10T15:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:70'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489247.json:
```json
{
    "body": "<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-10T22:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489248.json:
```json
{
    "body": "<a id='comment:72'></a>`_div_` should be working now, so the only missing thing is plethysm.",
    "created_at": "2022-08-10T22:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489248",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:72'></a>`_div_` should be working now, so the only missing thing is plethysm.



---

archive/issue_comments_489249.json:
```json
{
    "body": "<a id='comment:73'></a>Good catch and fix for the Laurent polynomial `quo_rem()` bug.\n\nI do not agree that\n\n```\nsage: L.<x, y> = LazyTaylorSeriesRing(QQ)\nsage: 1 / (1 - y) # should be exact, but isn't\n```\nshould be exact. What does it mean for an infinite multivariate series to be exact? It means each homogeneous component has the same value. However, that is not the case here. Exactness is hard for multivariate series. As another thing to consider, is `\\sum_{i=0}^n (x*y)^n` exact?",
    "created_at": "2022-08-11T03:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489249",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:73'></a>Good catch and fix for the Laurent polynomial `quo_rem()` bug.

I do not agree that

```
sage: L.<x, y> = LazyTaylorSeriesRing(QQ)
sage: 1 / (1 - y) # should be exact, but isn't
```
should be exact. What does it mean for an infinite multivariate series to be exact? It means each homogeneous component has the same value. However, that is not the case here. Exactness is hard for multivariate series. As another thing to consider, is `\sum_{i=0}^n (x*y)^n` exact?



---

archive/issue_comments_489250.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T03:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489251.json:
```json
{
    "body": "<a id='comment:75'></a>I fixed some other doctest failures because more things are exact (this is a good thing!). You did a great job with the division.\n\nI also made it so that `valuation()` cannot return an `int` (it sometimes could do this). A general principle in Sage is to not return Python objects on user-facing methods. This could be problematic if someone tried to do `self.valuation().is_prime()`.\n\nNow I will finish the plethysm. Sorry for being slow on this.",
    "created_at": "2022-08-11T03:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489251",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:75'></a>I fixed some other doctest failures because more things are exact (this is a good thing!). You did a great job with the division.

I also made it so that `valuation()` cannot return an `int` (it sometimes could do this). A general principle in Sage is to not return Python objects on user-facing methods. This could be problematic if someone tried to do `self.valuation().is_prime()`.

Now I will finish the plethysm. Sorry for being slow on this.



---

archive/issue_comments_489252.json:
```json
{
    "body": "<a id='comment:76'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T03:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489253.json:
```json
{
    "body": "<a id='comment:78'></a>Excellent!  I will add an alias `set` for `define` and a method `unknown` for the rings, for compatibility with padics.  I also fix the pyflakes notes.  These are very local changes.",
    "created_at": "2022-08-11T08:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489253",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:78'></a>Excellent!  I will add an alias `set` for `define` and a method `unknown` for the rings, for compatibility with padics.  I also fix the pyflakes notes.  These are very local changes.



---

archive/issue_comments_489254.json:
```json
{
    "body": "<a id='comment:79'></a>Do you know whether it is correct that `1/(1-z)` calls `_div_`, and `(1-z)^-1` calls `_pow_` rather than `_invert_`?  Would it make sense to redirect these two?",
    "created_at": "2022-08-11T09:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489254",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:79'></a>Do you know whether it is correct that `1/(1-z)` calls `_div_`, and `(1-z)^-1` calls `_pow_` rather than `_invert_`?  Would it make sense to redirect these two?



---

archive/issue_comments_489255.json:
```json
{
    "body": "<a id='comment:80'></a>We currently set `options = LazyLaurentSeriesRing.options` in the individual lazy ring classes.  Can I move this to the abstract base class `LazySeriesRing`?  I will try.",
    "created_at": "2022-08-11T09:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489255",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:80'></a>We currently set `options = LazyLaurentSeriesRing.options` in the individual lazy ring classes.  Can I move this to the abstract base class `LazySeriesRing`?  I will try.



---

archive/issue_comments_489256.json:
```json
{
    "body": "<a id='comment:81'></a>Can you remember why `LazyTaylorSeries` and `LazySymmetricFunctions` do not inherit from `LazySeries`?",
    "created_at": "2022-08-11T10:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489256",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:81'></a>Can you remember why `LazyTaylorSeries` and `LazySymmetricFunctions` do not inherit from `LazySeries`?



---

archive/issue_comments_489257.json:
```json
{
    "body": "<a id='comment:82'></a>Well, I made them inherit from `LazySeries` and moved `options` there, and all doctests pass, so it was probably by historical accident.",
    "created_at": "2022-08-11T10:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489257",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:82'></a>Well, I made them inherit from `LazySeries` and moved `options` there, and all doctests pass, so it was probably by historical accident.



---

archive/issue_comments_489258.json:
```json
{
    "body": "<a id='comment:83'></a>Sorry for being noisy: we have several identical implementations for the various rings:\n\n* `zero`\n* `one` (with minimal differences, I cannot tell yet, whether they are important)\n* `characteristic` (missing in some classes)\n* `_coerce_map_from_` (with one difference in the Dirichlet case)\n* `_coerce_map_from_base_ring`\n\nI will try to move these in a separate commit.",
    "created_at": "2022-08-11T10:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489258",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:83'></a>Sorry for being noisy: we have several identical implementations for the various rings:

* `zero`
* `one` (with minimal differences, I cannot tell yet, whether they are important)
* `characteristic` (missing in some classes)
* `_coerce_map_from_` (with one difference in the Dirichlet case)
* `_coerce_map_from_base_ring`

I will try to move these in a separate commit.



---

archive/issue_comments_489259.json:
```json
{
    "body": "<a id='comment:84'></a>Replying to [comment:79 mantepse]:\n> Do you know whether it is correct that `1/(1-z)` calls `_div_`, and `(1-z)^-1` calls `_pow_` rather than `_invert_`?  Would it make sense to redirect these two?\n\n\nIt is correct. Note also that `__pow__()` calls `generic_power()` calls `__invert__()`, which we can see by\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: S = LazySymmetricFunctions(s)\nsage: elt = 1 + S(s[2])\nsage: f = elt^-1\nsage: type(f._coeff_stream)\n<class 'sage.data_structures.stream.Stream_cauchy_invert'>\nsage: f._coeff_stream._series\n<sage.data_structures.stream.Stream_exact object at 0x7fdffdc1cca0>\n\nsage: f = 1 / elt\nsage: type(f._coeff_stream)\n<class 'sage.data_structures.stream.Stream_cauchy_mul'>\n```\nIf we wanted `1 / (1-z)` to be an inverse, we would also need to check in `_div_` that the numerator is `1` or not (this might be a worthwhile optimization).",
    "created_at": "2022-08-11T10:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489259",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:84'></a>Replying to [comment:79 mantepse]:
> Do you know whether it is correct that `1/(1-z)` calls `_div_`, and `(1-z)^-1` calls `_pow_` rather than `_invert_`?  Would it make sense to redirect these two?


It is correct. Note also that `__pow__()` calls `generic_power()` calls `__invert__()`, which we can see by

```
sage: s = SymmetricFunctions(QQ).s()
sage: S = LazySymmetricFunctions(s)
sage: elt = 1 + S(s[2])
sage: f = elt^-1
sage: type(f._coeff_stream)
<class 'sage.data_structures.stream.Stream_cauchy_invert'>
sage: f._coeff_stream._series
<sage.data_structures.stream.Stream_exact object at 0x7fdffdc1cca0>

sage: f = 1 / elt
sage: type(f._coeff_stream)
<class 'sage.data_structures.stream.Stream_cauchy_mul'>
```
If we wanted `1 / (1-z)` to be an inverse, we would also need to check in `_div_` that the numerator is `1` or not (this might be a worthwhile optimization).



---

archive/issue_comments_489260.json:
```json
{
    "body": "<a id='comment:85'></a>Meanwhile I discovered yet another (probable) bug:\n\n```\nsage: L.<z> = LazyTaylorSeriesRing(ZZ)\nsage: s = L(None, valuation=1)\nsage: s.define(z + (s^2+s(z^2))/2)\nsage: s[0]\n0\nsage: s[1]\nKeyError                                  Traceback (most recent call last)\nFile ~/sage-develop/src/sage/data_structures/stream.py:316, in Stream_inexact.__getitem__(self, n)\n    315 try:\n--> 316     c = self._cache[n]\n    317 except KeyError:\n...\nRecursionError: maximum recursion depth exceeded\n```\nNote that this works with `LazyLaurentSeriesRing`.\n\nI added the (failing) doctest.",
    "created_at": "2022-08-11T10:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489260",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:85'></a>Meanwhile I discovered yet another (probable) bug:

```
sage: L.<z> = LazyTaylorSeriesRing(ZZ)
sage: s = L(None, valuation=1)
sage: s.define(z + (s^2+s(z^2))/2)
sage: s[0]
0
sage: s[1]
KeyError                                  Traceback (most recent call last)
File ~/sage-develop/src/sage/data_structures/stream.py:316, in Stream_inexact.__getitem__(self, n)
    315 try:
--> 316     c = self._cache[n]
    317 except KeyError:
...
RecursionError: maximum recursion depth exceeded
```
Note that this works with `LazyLaurentSeriesRing`.

I added the (failing) doctest.



---

archive/issue_comments_489261.json:
```json
{
    "body": "<a id='comment:86'></a>comment:81, comment:82: Yes, I think this is all because we didn't have the ABC of `LazySeries` when we first did things and never migrated things over. This likely also applies to comment:83 too.",
    "created_at": "2022-08-11T10:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489261",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:86'></a>comment:81, comment:82: Yes, I think this is all because we didn't have the ABC of `LazySeries` when we first did things and never migrated things over. This likely also applies to comment:83 too.



---

archive/issue_comments_489262.json:
```json
{
    "body": "<a id='comment:87'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T10:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:87'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489263.json:
```json
{
    "body": "<a id='comment:88'></a>In the Frobenius character of unlabeled trees test, I need to explicitly declare the `valuation = 1` when I add in a test for composing that the valuation is positive.",
    "created_at": "2022-08-11T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489263",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:88'></a>In the Frobenius character of unlabeled trees test, I need to explicitly declare the `valuation = 1` when I add in a test for composing that the valuation is positive.



---

archive/issue_comments_489264.json:
```json
{
    "body": "<a id='comment:89'></a>Can you also explain the logic behind the plethysm implementation? I have trouble understanding what is happening there.",
    "created_at": "2022-08-11T11:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489264",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:89'></a>Can you also explain the logic behind the plethysm implementation? I have trouble understanding what is happening there.



---

archive/issue_comments_489265.json:
```json
{
    "body": "<a id='comment:90'></a>The bug is in `LazyTaylorSeries.__call__`:\n\n```\n    def __call__(self, *g):\n    ...\n        coeff_stream = Stream_function(coefficient, R, P._sparse, 0)\n        return P.element_class(P, coeff_stream)\n```\nIt is not good enough to set the valuation to 0 here.",
    "created_at": "2022-08-11T11:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489265",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:90'></a>The bug is in `LazyTaylorSeries.__call__`:

```
    def __call__(self, *g):
    ...
        coeff_stream = Stream_function(coefficient, R, P._sparse, 0)
        return P.element_class(P, coeff_stream)
```
It is not good enough to set the valuation to 0 here.



---

archive/issue_comments_489266.json:
```json
{
    "body": "<a id='comment:91'></a>I also have trouble understanding plethysm :-)\n\nCan you propose a time for a zoom meeting?  (I need a break for about half an hour now, though, and I currently do not have a whiteboard, but I have a tablet.)",
    "created_at": "2022-08-11T11:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489266",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:91'></a>I also have trouble understanding plethysm :-)

Can you propose a time for a zoom meeting?  (I need a break for about half an hour now, though, and I currently do not have a whiteboard, but I have a tablet.)



---

archive/issue_comments_489267.json:
```json
{
    "body": "<a id='comment:92'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T11:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:92'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489268.json:
```json
{
    "body": "<a id='comment:93'></a>Sounds good. I sent you an email for scheduling a meeting.\n\nI just pushed my changes for tonight. Dinner time for me. `:)`",
    "created_at": "2022-08-11T11:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489268",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:93'></a>Sounds good. I sent you an email for scheduling a meeting.

I just pushed my changes for tonight. Dinner time for me. `:)`



---

archive/issue_comments_489269.json:
```json
{
    "body": "<a id='comment:94'></a>Replying to [comment:88 tscrim]:\n> In the Frobenius character of unlabeled trees test, I need to explicitly declare the `valuation = 1` when I add in a test for composing that the valuation is positive.\n\n\nThat should not really be necessary, because the valuation of `X*E(A)` (in fact, of `X*anything`)  is positive.",
    "created_at": "2022-08-11T11:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489269",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:94'></a>Replying to [comment:88 tscrim]:
> In the Frobenius character of unlabeled trees test, I need to explicitly declare the `valuation = 1` when I add in a test for composing that the valuation is positive.


That should not really be necessary, because the valuation of `X*E(A)` (in fact, of `X*anything`)  is positive.



---

archive/issue_comments_489270.json:
```json
{
    "body": "<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T14:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:95'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489271.json:
```json
{
    "body": "<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-12T04:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489272.json:
```json
{
    "body": "<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-12T04:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489273.json:
```json
{
    "body": "<a id='comment:98'></a>There were actually a lot of issues with `LazyTaylorSeries.__call__` with handling different inputs to make it (mostly?) compatible with the lazy Laurent series. So most of the code added there is to handle when `f` is an infinite series but `g` is finite. I added more examples for compositions.\n\nA principle of Sage is that the result of `__call__` should not depend on the elements, only the parents. Of course, we deliberately break this (infinite versus finite series), but it is mostly consistent now I believe.\n\nI implemented an `is_exact` because it is not an exact ring when the base ring is not exact.\n\nAdded alias `plethysm = __call__`.\n\nI moved the plethysm code into `Stream_plethysm`. I also made it smarter with only computing the terms in the necessary degrees. I couldn't do anything smarter than going through the power sums either.",
    "created_at": "2022-08-12T04:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489273",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:98'></a>There were actually a lot of issues with `LazyTaylorSeries.__call__` with handling different inputs to make it (mostly?) compatible with the lazy Laurent series. So most of the code added there is to handle when `f` is an infinite series but `g` is finite. I added more examples for compositions.

A principle of Sage is that the result of `__call__` should not depend on the elements, only the parents. Of course, we deliberately break this (infinite versus finite series), but it is mostly consistent now I believe.

I implemented an `is_exact` because it is not an exact ring when the base ring is not exact.

Added alias `plethysm = __call__`.

I moved the plethysm code into `Stream_plethysm`. I also made it smarter with only computing the terms in the necessary degrees. I couldn't do anything smarter than going through the power sums either.



---

archive/issue_comments_489274.json:
```json
{
    "body": "<a id='comment:99'></a>I am very much impressed! \n\nThank you so much!\n\nI had a brief look at the html documentation, seems fine.\n(there is one weird thing: the signatures of `compose` sometimes have `check` first, sometimes last, and never show the default value `True`, which is quite confusing)\n\nI guess that the tutorial section should be rewritten, but I think it is good enough for now.  In fact, that might be a good project for a summer intern: unify the documentation of the power series classes.\n\nCould you give it a positive review once you are happy?",
    "created_at": "2022-08-12T07:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489274",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:99'></a>I am very much impressed! 

Thank you so much!

I had a brief look at the html documentation, seems fine.
(there is one weird thing: the signatures of `compose` sometimes have `check` first, sometimes last, and never show the default value `True`, which is quite confusing)

I guess that the tutorial section should be rewritten, but I think it is good enough for now.  In fact, that might be a good project for a summer intern: unify the documentation of the power series classes.

Could you give it a positive review once you are happy?



---

archive/issue_comments_489275.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-12T08:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489276.json:
```json
{
    "body": "<a id='comment:1'></a>Thank you. I made a few other small fixes, in part because the doc wasn't building for me. Unfortunately Sphinx doesn't seem to be so good with keyword-only arguments; we just have to accept it. `:/`\n\nIf my changes are good, then you can set the positive review.\n\nThank you for all of your hard work on this.",
    "created_at": "2022-08-12T08:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489276",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>Thank you. I made a few other small fixes, in part because the doc wasn't building for me. Unfortunately Sphinx doesn't seem to be so good with keyword-only arguments; we just have to accept it. `:/`

If my changes are good, then you can set the positive review.

Thank you for all of your hard work on this.



---

archive/issue_comments_489277.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-12T09:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489277",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_489278.json:
```json
{
    "body": "<a id='comment:3'></a>It might be interesting to compare with fricas speed wise.",
    "created_at": "2022-08-12T09:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489278",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:3'></a>It might be interesting to compare with fricas speed wise.



---

archive/issue_comments_489279.json:
```json
{
    "body": "<a id='comment:104'></a>Replying to [comment:103 mantepse]:\n> It might be interesting to compare with fricas speed wise.\n\n\nIndeed, that would be good. I am curious to see how it compares.",
    "created_at": "2022-08-12T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489279",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:104'></a>Replying to [comment:103 mantepse]:
> It might be interesting to compare with fricas speed wise.


Indeed, that would be good. I am curious to see how it compares.



---

archive/issue_comments_489280.json:
```json
{
    "body": "<a id='comment:105'></a>I guess there is room for improvements:\n\n```\nsage: T.<X, Y> = LazyTaylorSeriesRing(QQ)\nsage: S = 2*~(1+2*X+sqrt(1-4*X)-2*X*Y)\nsage: %time _ = S[10]\nCPU times: user 6.32 ms, sys: 0 ns, total: 6.32 ms\nWall time: 6.31 ms\nsage: %time _ = S[100]\nCPU times: user 1.45 s, sys: 0 ns, total: 1.45 s\nWall time: 1.45 s\nsage: %time _ = S[200]\nCPU times: user 13 s, sys: 8.03 ms, total: 13 s\nWall time: 13 s\n\nsage: x = fricas(\"x::TaylorSeries Fraction Integer\")\nsage: y = fricas(\"y::TaylorSeries Fraction Integer\")\nsage: s = 2*(1+2*x+sqrt(1-4*x)-2*x*y).recip()\nsage: %time _ = s.coefficient(10)\nCPU times: user 1.98 ms, sys: 0 ns, total: 1.98 ms\nWall time: 3.86 ms\nsage: %time _ = s.coefficient(100)\nCPU times: user 2.36 ms, sys: 0 ns, total: 2.36 ms\nWall time: 301 ms\nsage: %time _ = s.coefficient(200)\nCPU times: user 0 ns, sys: 2.26 ms, total: 2.26 ms\nWall time: 2.28 s\n\nsage: X, Y = S[10].variables(); S[200].coefficient({X:199, Y:1})\n38258081747085632190083666133480795008333871737968781386233193048331692888394736170337405196826277395315492416836472\nsage: s.coefficient(200).coefficient([fricas(\"'x\"), fricas(\"'y\")], [199, 1]).sage()\n38258081747085632190083666133480795008333871737968781386233193048331692888394736170337405196826277395315492416836472\n```",
    "created_at": "2022-08-12T10:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489280",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:105'></a>I guess there is room for improvements:

```
sage: T.<X, Y> = LazyTaylorSeriesRing(QQ)
sage: S = 2*~(1+2*X+sqrt(1-4*X)-2*X*Y)
sage: %time _ = S[10]
CPU times: user 6.32 ms, sys: 0 ns, total: 6.32 ms
Wall time: 6.31 ms
sage: %time _ = S[100]
CPU times: user 1.45 s, sys: 0 ns, total: 1.45 s
Wall time: 1.45 s
sage: %time _ = S[200]
CPU times: user 13 s, sys: 8.03 ms, total: 13 s
Wall time: 13 s

sage: x = fricas("x::TaylorSeries Fraction Integer")
sage: y = fricas("y::TaylorSeries Fraction Integer")
sage: s = 2*(1+2*x+sqrt(1-4*x)-2*x*y).recip()
sage: %time _ = s.coefficient(10)
CPU times: user 1.98 ms, sys: 0 ns, total: 1.98 ms
Wall time: 3.86 ms
sage: %time _ = s.coefficient(100)
CPU times: user 2.36 ms, sys: 0 ns, total: 2.36 ms
Wall time: 301 ms
sage: %time _ = s.coefficient(200)
CPU times: user 0 ns, sys: 2.26 ms, total: 2.26 ms
Wall time: 2.28 s

sage: X, Y = S[10].variables(); S[200].coefficient({X:199, Y:1})
38258081747085632190083666133480795008333871737968781386233193048331692888394736170337405196826277395315492416836472
sage: s.coefficient(200).coefficient([fricas("'x"), fricas("'y")], [199, 1]).sage()
38258081747085632190083666133480795008333871737968781386233193048331692888394736170337405196826277395315492416836472
```



---

archive/issue_comments_489281.json:
```json
{
    "body": "<a id='comment:6'></a>\n```\nsage: %prun _ = S[200]\n         4266270 function calls (105763 primitive calls) in 15.196 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n39710/398   12.348    0.000   14.627    0.037 stream.py:1373(get_coefficient)\n4100012/1    2.200    0.000   15.195   15.195 stream.py:281(__getitem__)\n    190/1    0.248    0.001   15.195   15.195 stream.py:2044(get_coefficient)\n40470/20235    0.191    0.000   14.786    0.001 stream.py:1645(<genexpr>)\n  760/380    0.169    0.000   14.918    0.039 {built-in method builtins.sum}\n    40280    0.013    0.000    0.013    0.000 stream.py:553(__getitem__)\n    39710    0.007    0.000    0.007    0.000 {method 'zero' of 'sage.rings.ring.Ring' objects}\n  380/190    0.005    0.000   14.927    0.079 stream.py:1618(get_coefficient)\n      190    0.004    0.000    0.004    0.000 lazy_series.py:2015(<lambda>)\n      380    0.004    0.000    0.004    0.000 stream.py:170(__init__)\n      380    0.001    0.000    0.007    0.000 stream.py:1356(__init__)\n      380    0.001    0.000    0.005    0.000 stream.py:985(__init__)\n      190    0.001    0.000   14.928    0.079 stream.py:1248(get_coefficient)\n      190    0.001    0.000    0.001    0.000 lazy_series.py:1411(<lambda>)\n      190    0.001    0.000   14.929    0.079 stream.py:1309(get_coefficient)\n    191/1    0.001    0.000   15.195   15.195 stream.py:1922(get_coefficient)\n      380    0.001    0.000    0.005    0.000 stream.py:773(get_coefficient)\n     1140    0.000    0.000    0.000    0.000 {built-in method builtins.len}\n      380    0.000    0.000    0.000    0.000 stream.py:111(__init__)\n      380    0.000    0.000    0.000    0.000 {method 'append' of 'list' objects}\n        1    0.000    0.000   15.196   15.196 {built-in method builtins.exec}\n      380    0.000    0.000    0.000    0.000 stream.py:1642(<genexpr>)\n        1    0.000    0.000   15.195   15.195 lazy_series.py:199(__getitem__)\n        1    0.000    0.000   15.195   15.195 <string>:1(<module>)\n        1    0.000    0.000    0.000    0.000 {method 'parent' of 'sage.structure.element.Element' objects}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n        1    0.000    0.000    0.000    0.000 {built-in method builtins.isinstance}\n        1    0.000    0.000    0.000    0.000 {method 'base_ring' of 'sage.structure.category_object.CategoryObject' objects}\n```",
    "created_at": "2022-08-12T10:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489281",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>
```
sage: %prun _ = S[200]
         4266270 function calls (105763 primitive calls) in 15.196 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
39710/398   12.348    0.000   14.627    0.037 stream.py:1373(get_coefficient)
4100012/1    2.200    0.000   15.195   15.195 stream.py:281(__getitem__)
    190/1    0.248    0.001   15.195   15.195 stream.py:2044(get_coefficient)
40470/20235    0.191    0.000   14.786    0.001 stream.py:1645(<genexpr>)
  760/380    0.169    0.000   14.918    0.039 {built-in method builtins.sum}
    40280    0.013    0.000    0.013    0.000 stream.py:553(__getitem__)
    39710    0.007    0.000    0.007    0.000 {method 'zero' of 'sage.rings.ring.Ring' objects}
  380/190    0.005    0.000   14.927    0.079 stream.py:1618(get_coefficient)
      190    0.004    0.000    0.004    0.000 lazy_series.py:2015(<lambda>)
      380    0.004    0.000    0.004    0.000 stream.py:170(__init__)
      380    0.001    0.000    0.007    0.000 stream.py:1356(__init__)
      380    0.001    0.000    0.005    0.000 stream.py:985(__init__)
      190    0.001    0.000   14.928    0.079 stream.py:1248(get_coefficient)
      190    0.001    0.000    0.001    0.000 lazy_series.py:1411(<lambda>)
      190    0.001    0.000   14.929    0.079 stream.py:1309(get_coefficient)
    191/1    0.001    0.000   15.195   15.195 stream.py:1922(get_coefficient)
      380    0.001    0.000    0.005    0.000 stream.py:773(get_coefficient)
     1140    0.000    0.000    0.000    0.000 {built-in method builtins.len}
      380    0.000    0.000    0.000    0.000 stream.py:111(__init__)
      380    0.000    0.000    0.000    0.000 {method 'append' of 'list' objects}
        1    0.000    0.000   15.196   15.196 {built-in method builtins.exec}
      380    0.000    0.000    0.000    0.000 stream.py:1642(<genexpr>)
        1    0.000    0.000   15.195   15.195 lazy_series.py:199(__getitem__)
        1    0.000    0.000   15.195   15.195 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {method 'parent' of 'sage.structure.element.Element' objects}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
        1    0.000    0.000    0.000    0.000 {built-in method builtins.isinstance}
        1    0.000    0.000    0.000    0.000 {method 'base_ring' of 'sage.structure.category_object.CategoryObject' objects}
```



---

archive/issue_comments_489282.json:
```json
{
    "body": "<a id='comment:7'></a>Indeed, there is work that can likely be done. I wonder how much of it is because it is done in Python versus some of the other safety checks we do on objects versus actual implementation/algorithm. Seems that we are roughly 5x slower in this example.\n\nMy 2 cents of a wild guess where we can improve is in the composition. Perhaps we would be better squaring things to reduce the number of multiplications.",
    "created_at": "2022-08-12T11:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489282",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Indeed, there is work that can likely be done. I wonder how much of it is because it is done in Python versus some of the other safety checks we do on objects versus actual implementation/algorithm. Seems that we are roughly 5x slower in this example.

My 2 cents of a wild guess where we can improve is in the composition. Perhaps we would be better squaring things to reduce the number of multiplications.



---

archive/issue_comments_489283.json:
```json
{
    "body": "<a id='comment:8'></a>Renaming `stream.py` to `stream.pyx` reduces the time from 13s to 8.6s.\n\nI don't think that FriCAS does anything extraordinarily intelligent.  It's just that the FriCAS language is much more efficient than python.",
    "created_at": "2022-08-12T11:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489283",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:8'></a>Renaming `stream.py` to `stream.pyx` reduces the time from 13s to 8.6s.

I don't think that FriCAS does anything extraordinarily intelligent.  It's just that the FriCAS language is much more efficient than python.



---

archive/issue_comments_489284.json:
```json
{
    "body": "<a id='comment:9'></a>I just checked, I don't think FriCAS does anything special.  In case you are curious, the implementation for multivariate Taylor series is in `fricas/src/algebra/mts.spad`, `taylor.spad` and `sttaylor.spad`.  Here is the code for (Cauchy) multiplication.  Unfortunately, the original axiom team was fond of abbreviations: `ST` is for `Stream`, `A` is the ring, in our case multivariate polynomials, and `delay` is a special function that delays the computation.\n\n```\n    stmult(n0 : Integer, x0 : ST A, y0 : ST A, _\n           ll0 : List A) : ST A == delay\n        x := x0\n        y := y0\n        n := n0\n        ll := ll0\n        if empty? y then\n             n < 0 => return empty()\n             empty? x => return empty()\n             x := rst x\n        else\n             c := frst y\n             y := rst y\n             if n < 0 and c = 0 then\n                 return concat(0, stmult(n, x, y, ll))\n             else\n                 ll := cons(c, ll)\n                 n := n + 1\n        res : A := 0\n        xp := x\n        llp := ll\n        for i in 0..n repeat\n            empty? xp =>\n                i = 0 => return empty()\n                break\n            res := res + frst xp * first(llp)\n            llp := rest(llp)\n            xp := rst xp\n        -- make sure that when we multiply finite streams\n        -- tail is explicitly empty\n        explicitlyEmpty? rst x and\n          explicitlyEmpty? y => concat(res, empty())\n        concat(res, stmult(n, x, y, ll))\n\n    (x : ST A) * (y : ST A) == delay\n        empty? y => zro()\n        empty? x => zro()\n        stmult(-1, x, y, [])\n```",
    "created_at": "2022-08-12T11:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489284",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'></a>I just checked, I don't think FriCAS does anything special.  In case you are curious, the implementation for multivariate Taylor series is in `fricas/src/algebra/mts.spad`, `taylor.spad` and `sttaylor.spad`.  Here is the code for (Cauchy) multiplication.  Unfortunately, the original axiom team was fond of abbreviations: `ST` is for `Stream`, `A` is the ring, in our case multivariate polynomials, and `delay` is a special function that delays the computation.

```
    stmult(n0 : Integer, x0 : ST A, y0 : ST A, _
           ll0 : List A) : ST A == delay
        x := x0
        y := y0
        n := n0
        ll := ll0
        if empty? y then
             n < 0 => return empty()
             empty? x => return empty()
             x := rst x
        else
             c := frst y
             y := rst y
             if n < 0 and c = 0 then
                 return concat(0, stmult(n, x, y, ll))
             else
                 ll := cons(c, ll)
                 n := n + 1
        res : A := 0
        xp := x
        llp := ll
        for i in 0..n repeat
            empty? xp =>
                i = 0 => return empty()
                break
            res := res + frst xp * first(llp)
            llp := rest(llp)
            xp := rst xp
        -- make sure that when we multiply finite streams
        -- tail is explicitly empty
        explicitlyEmpty? rst x and
          explicitlyEmpty? y => concat(res, empty())
        concat(res, stmult(n, x, y, ll))

    (x : ST A) * (y : ST A) == delay
        empty? y => zro()
        empty? x => zro()
        stmult(-1, x, y, [])
```



---

archive/issue_comments_489285.json:
```json
{
    "body": "<a id='comment:0'></a>Actually, I can only reproduce such a big difference with `sqrt`, but the FriCAS implementation seems to do exactly the same thing as we do.",
    "created_at": "2022-08-12T12:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489285",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:0'></a>Actually, I can only reproduce such a big difference with `sqrt`, but the FriCAS implementation seems to do exactly the same thing as we do.



---

archive/issue_comments_489286.json:
```json
{
    "body": "<a id='comment:1'></a>I think I've got it: we use\n\n```\n        from .lazy_series_ring import LazyLaurentSeriesRing\n        P = LazyLaurentSeriesRing(self.base_ring(), \"z\", sparse=self.parent()._sparse)\n        exp = P(lambda k: 1/factorial(ZZ(k)), valuation=0)\n        return exp(self.log() * n)\n```\n\nwhereas FriCAS has a special implementation for rational powers.",
    "created_at": "2022-08-12T12:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489286",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:1'></a>I think I've got it: we use

```
        from .lazy_series_ring import LazyLaurentSeriesRing
        P = LazyLaurentSeriesRing(self.base_ring(), "z", sparse=self.parent()._sparse)
        exp = P(lambda k: 1/factorial(ZZ(k)), valuation=0)
        return exp(self.log() * n)
```

whereas FriCAS has a special implementation for rational powers.



---

archive/issue_comments_489287.json:
```json
{
    "body": "<a id='comment:2'></a>We probably want to use\n\n- for all rational powers: https://en.wikipedia.org/wiki/Nth_root#Infinite_series\n- when the exponent is in the base ring: https://en.wikipedia.org/wiki/Binomial_approximation#Using_Taylor_Series\n\nThese will likely speed things up. Good for a followup ticket.",
    "created_at": "2022-08-12T13:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489287",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>We probably want to use

- for all rational powers: https://en.wikipedia.org/wiki/Nth_root#Infinite_series
- when the exponent is in the base ring: https://en.wikipedia.org/wiki/Binomial_approximation#Using_Taylor_Series

These will likely speed things up. Good for a followup ticket.



---

archive/issue_comments_489288.json:
```json
{
    "body": "<a id='comment:3'></a>Here is the FriCAS implementation for rational powers.  (`RN` is `Fraction Integer`, `ST` is `Stream`,   `YS` is `Y$ParadoxicalCombinatorsForStreams(A)` and the top level function is `powern`)\n\n```\n      RATPOWERS : Boolean := A has \"^\": (A,RN) -> A\n\n      smult : (RN, ST A) -> ST A\n      smult(rn, x) == map(y +-> rn*y, x)\n\n      powerrn : (RN, ST A, ST A) -> ST A\n      powerrn(rn, x, c) == delay\n        concat(1, integ(smult(rn + 1, c * deriv x)) - rst x * c)\n\n      powern(rn, x) ==\n        order : I := 0\n        for n in 0.. repeat\n          empty? x => return zro()\n          not zero? frst x => (order := n; break)\n          x := rst x\n          n = 1000 =>\n            error \"^: series with many leading zero coefficients\"\n        (ord := (order exquo denom(rn))) case \"failed\" =>\n          error \"^: rational power does not exist\"\n        co := frst x\n        if ord > 0 and rn < 0 then\n           error \"^: negative power does not exist\"\n        (invCo := recip co) case \"failed\" =>\n           error \"^ rational power of coefficient undefined\"\n-- This error message is misleading, isn't it? see sups.spad/cRationalPower\n        power :=\n          (co = 1) => YS(y +-> powerrn(rn, x, y))\n          (denom rn) = 1 =>\n            not negative?(num := numer rn) =>\n-- It seems that this cannot happen, but I don't know why\n              (co^num::NNI) * YS(y +-> powerrn(rn, (invCo::A)*x, y))\n            (invCo::A)^((-num)::NNI) * YS(y +-> powerrn(rn, (invCo::A)*x, y))\n\n          RATPOWERS => co^rn * YS(y +-> powerrn(rn, (invCo::A)*x, y))\n          error \"^ rational power of coefficient undefined\"\n        monom(1, (ord :: I) * numer(rn)) * power\n```",
    "created_at": "2022-08-12T13:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489288",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:3'></a>Here is the FriCAS implementation for rational powers.  (`RN` is `Fraction Integer`, `ST` is `Stream`,   `YS` is `Y$ParadoxicalCombinatorsForStreams(A)` and the top level function is `powern`)

```
      RATPOWERS : Boolean := A has "^": (A,RN) -> A

      smult : (RN, ST A) -> ST A
      smult(rn, x) == map(y +-> rn*y, x)

      powerrn : (RN, ST A, ST A) -> ST A
      powerrn(rn, x, c) == delay
        concat(1, integ(smult(rn + 1, c * deriv x)) - rst x * c)

      powern(rn, x) ==
        order : I := 0
        for n in 0.. repeat
          empty? x => return zro()
          not zero? frst x => (order := n; break)
          x := rst x
          n = 1000 =>
            error "^: series with many leading zero coefficients"
        (ord := (order exquo denom(rn))) case "failed" =>
          error "^: rational power does not exist"
        co := frst x
        if ord > 0 and rn < 0 then
           error "^: negative power does not exist"
        (invCo := recip co) case "failed" =>
           error "^ rational power of coefficient undefined"
-- This error message is misleading, isn't it? see sups.spad/cRationalPower
        power :=
          (co = 1) => YS(y +-> powerrn(rn, x, y))
          (denom rn) = 1 =>
            not negative?(num := numer rn) =>
-- It seems that this cannot happen, but I don't know why
              (co^num::NNI) * YS(y +-> powerrn(rn, (invCo::A)*x, y))
            (invCo::A)^((-num)::NNI) * YS(y +-> powerrn(rn, (invCo::A)*x, y))

          RATPOWERS => co^rn * YS(y +-> powerrn(rn, (invCo::A)*x, y))
          error "^ rational power of coefficient undefined"
        monom(1, (ord :: I) * numer(rn)) * power
```



---

archive/issue_comments_489289.json:
```json
{
    "body": "<a id='comment:4'></a>See #34350",
    "created_at": "2022-08-12T13:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489289",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:4'></a>See #34350



---

archive/issue_comments_489290.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-08-12T14:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_489291.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-08-12T14:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_489292.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-12T14:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489292",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_489293.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-08-13T10:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489293",
    "user": "https://github.com/fchapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_489294.json:
```json
{
    "body": "<a id='comment:7'></a>hey, guys, the linter is not GREEN !\n\n```\nsage/rings/lazy_series.py:3472:9: E306 expected 1 blank line before a nested definition, found 0\n1       E306 expected 1 blank line before a nested definition, found 0\n```",
    "created_at": "2022-08-13T10:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489294",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>hey, guys, the linter is not GREEN !

```
sage/rings/lazy_series.py:3472:9: E306 expected 1 blank line before a nested definition, found 0
1       E306 expected 1 blank line before a nested definition, found 0
```



---

archive/issue_comments_489295.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-13T10:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489296.json:
```json
{
    "body": "<a id='comment:9'></a>Fr\u00e9d\u00e9ric, while I appreciate what you have done standardizing the code within Sage and trying to keep it consistent, I don't think this should warrant reverting a positive review for adding one blankline that, IMO, makes the code less readable because it disassociates the internal function definition from the use. Nevertheless, I have made the change requested.",
    "created_at": "2022-08-13T10:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489296",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Frédéric, while I appreciate what you have done standardizing the code within Sage and trying to keep it consistent, I don't think this should warrant reverting a positive review for adding one blankline that, IMO, makes the code less readable because it disassociates the internal function definition from the use. Nevertheless, I have made the change requested.



---

archive/issue_comments_489297.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-08-13T10:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489297",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_489298.json:
```json
{
    "body": "<a id='comment:0'></a>oops, sorry for the inconvenience, apologies\n\nI understand your point of view ; maybe we are going too far with the linter and should be more careful in choosing what to check.\n\nMy point is that the linter is going to be useful if and only if every single ticket makes sure not to break it again and again.",
    "created_at": "2022-08-13T11:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489298",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:0'></a>oops, sorry for the inconvenience, apologies

I understand your point of view ; maybe we are going too far with the linter and should be more careful in choosing what to check.

My point is that the linter is going to be useful if and only if every single ticket makes sure not to break it again and again.



---

archive/issue_comments_489299.json:
```json
{
    "body": "<a id='comment:1'></a>I broadly agree, but we should allow a certain amount of discretion to the ticket authors/reviewers. I really do not like that blankline required by the linter as it strongly affects the logical grouping of the code blocks.",
    "created_at": "2022-08-15T00:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489299",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>I broadly agree, but we should allow a certain amount of discretion to the ticket authors/reviewers. I really do not like that blankline required by the linter as it strongly affects the logical grouping of the code blocks.



---

archive/issue_comments_489300.json:
```json
{
    "body": "<a id='comment:2'></a>On sage-devel several people were in favour of replacing Taylor with Power. While I a do not have a preference concerning the name, I would prefer a replacement to happen before the ticket is merged.",
    "created_at": "2022-08-15T10:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489300",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>On sage-devel several people were in favour of replacing Taylor with Power. While I a do not have a preference concerning the name, I would prefer a replacement to happen before the ticket is merged.



---

archive/issue_comments_489301.json:
```json
{
    "body": "<a id='comment:3'></a>IMO that is best done as two separate tickets as the replacement might introduce bugs that are separate from this ticket. That ticket will also issue a formal deprecation of the LFPS.",
    "created_at": "2022-08-15T12:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489301",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>IMO that is best done as two separate tickets as the replacement might introduce bugs that are separate from this ticket. That ticket will also issue a formal deprecation of the LFPS.



---

archive/issue_comments_489302.json:
```json
{
    "body": "<a id='comment:4'></a>Ok, But I d rather not go through a deprecation of lazy Taylor series",
    "created_at": "2022-08-15T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489302",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:4'></a>Ok, But I d rather not go through a deprecation of lazy Taylor series



---

archive/issue_comments_489303.json:
```json
{
    "body": "<a id='comment:5'></a>We can keep the alias since you want it )well, in the global namespace we would actually have LazyPowerSeriesRing be an alias for LazyTaylorSeriesRing). I have no objections to that (I am definitely not going to propose changing the class name in the file).",
    "created_at": "2022-08-15T12:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489303",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>We can keep the alias since you want it )well, in the global namespace we would actually have LazyPowerSeriesRing be an alias for LazyTaylorSeriesRing). I have no objections to that (I am definitely not going to propose changing the class name in the file).



---

archive/issue_comments_489304.json:
```json
{
    "body": "<a id='comment:6'></a>No, i do not want to keep an alias. I just do not want deprecations",
    "created_at": "2022-08-15T13:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489304",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>No, i do not want to keep an alias. I just do not want deprecations



---

archive/issue_events_085737.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-30T19:05:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32324#event-85737"
}
```



---

archive/issue_comments_489305.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-30T19:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32324#issuecomment-489305",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
