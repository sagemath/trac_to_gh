# Issue 32372: requests: Upgrade to 2.26.0, add new (unvendored) deps

archive/issues_032135.json:
```json
{
    "body": "(split out from #31280)\n\nAs noted in ticket:31280#comment:65, this helps\nfor #30768 and hence for Python 3.10 compatibility.\n\nThree packages are added, each becoming\na standard spkg.\n\n## [charset-normalizer](https://pypi.org/project/charset-normalizer)\n\nAdded under the name `charset_normalizer`.\n\n> \"Charset Detection, for Everyone\"\n\n>\n> A library that helps you read text from an unknown\n> charset encoding.\n\n>\n> [...] All IANA character set names for which the\n> Python core library provides codecs are supported.\n\n\n## [idna](https://pypi.org/project/idna)\n\n> Support for the Internationalised Domain Names\n> in Applications (IDNA) protocol as specified\n> in RFC 5891. This is the latest version of the\n> protocol and is sometimes referred to as \u201cIDNA 2008\u201d.\n\n>\n> This library also provides support\n> for Unicode Technical Standard 46, \n> Unicode IDNA Compatibility Processing.\n\n>\n> This acts as a suitable replacement for the\n> \u201cencodings.idna\u201d module that comes with the\n> Python standard library, but which only supports\n> the old, deprecated IDNA specification (RFC 3490).\n\n\n## [urllib3](https://pypi.org/project/urllib3/)\n\n> a powerful, user-friendly HTTP client for Python.\n> [...]\n> urllib3 brings many critical features that are\n> missing from the Python standard libraries:\n\n>\n> - Thread safety.\n> - Connection pooling.\n> - Client-side SSL/TLS verification.\n> - File uploads with multipart encoding.\n> - Helpers for retrying requests and dealing with HTTP redirects.\n> - Support for gzip, deflate, and brotli encoding.\n> - Proxy support for HTTP and SOCKS.\n> - 100% test coverage.\n\n\n\nCC:  @fchapoton @slel @dimpase\n\nBranch/Commit: 8cc62de53d45d251dc7121cbffec7a1154ad8bf0\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32372\n\n",
    "closed_at": "2021-09-07T20:52:08Z",
    "created_at": "2021-08-12T17:56:45Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "requests: Upgrade to 2.26.0, add new (unvendored) deps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32372",
    "user": "https://github.com/mkoeppe"
}
```
(split out from #31280)

As noted in ticket:31280#comment:65, this helps
for #30768 and hence for Python 3.10 compatibility.

Three packages are added, each becoming
a standard spkg.

## [charset-normalizer](https://pypi.org/project/charset-normalizer)

Added under the name `charset_normalizer`.

> "Charset Detection, for Everyone"

>
> A library that helps you read text from an unknown
> charset encoding.

>
> [...] All IANA character set names for which the
> Python core library provides codecs are supported.


## [idna](https://pypi.org/project/idna)

> Support for the Internationalised Domain Names
> in Applications (IDNA) protocol as specified
> in RFC 5891. This is the latest version of the
> protocol and is sometimes referred to as “IDNA 2008”.

>
> This library also provides support
> for Unicode Technical Standard 46, 
> Unicode IDNA Compatibility Processing.

>
> This acts as a suitable replacement for the
> “encodings.idna” module that comes with the
> Python standard library, but which only supports
> the old, deprecated IDNA specification (RFC 3490).


## [urllib3](https://pypi.org/project/urllib3/)

> a powerful, user-friendly HTTP client for Python.
> [...]
> urllib3 brings many critical features that are
> missing from the Python standard libraries:

>
> - Thread safety.
> - Connection pooling.
> - Client-side SSL/TLS verification.
> - File uploads with multipart encoding.
> - Helpers for retrying requests and dealing with HTTP redirects.
> - Support for gzip, deflate, and brotli encoding.
> - Proxy support for HTTP and SOCKS.
> - 100% test coverage.



CC:  @fchapoton @slel @dimpase

Branch/Commit: 8cc62de53d45d251dc7121cbffec7a1154ad8bf0

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32372





---

archive/issue_comments_644643.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/requests__upgrade_to_2_26_0__add_new__unvendored__deps\"",
    "created_at": "2021-08-12T17:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644643",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/requests__upgrade_to_2_26_0__add_new__unvendored__deps"



---

archive/issue_comments_644644.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-08-12T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644644",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_644645.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-12T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644645",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_644646.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-08-12T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644646",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_644647.json:
```json
{
    "body": "Changing commit from \"\" to \"9a057767ffa01b57822f2852e732ed7ab247b5f9\"",
    "created_at": "2021-08-12T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644647",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "9a057767ffa01b57822f2852e732ed7ab247b5f9"



---

archive/issue_comments_644648.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T18:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_644649.json:
```json
{
    "body": "Changing commit from \"9a057767ffa01b57822f2852e732ed7ab247b5f9\" to \"81af3bffde5f6de81c16749c269a85c396d138e8\"",
    "created_at": "2021-08-12T18:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9a057767ffa01b57822f2852e732ed7ab247b5f9" to "81af3bffde5f6de81c16749c269a85c396d138e8"



---

archive/issue_comments_644650.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-13T01:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644650",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_644651.json:
```json
{
    "body": "<a id='comment:4'></a>requests 2.26.0 has switched from `chardet` to `charset_normalizer`\nhttps://docs.python-requests.org/en/master/community/updates/#id1",
    "created_at": "2021-08-13T01:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644651",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>requests 2.26.0 has switched from `chardet` to `charset_normalizer`
https://docs.python-requests.org/en/master/community/updates/#id1



---

archive/issue_comments_644652.json:
```json
{
    "body": "Changing commit from \"81af3bffde5f6de81c16749c269a85c396d138e8\" to \"8cc62de53d45d251dc7121cbffec7a1154ad8bf0\"",
    "created_at": "2021-08-13T04:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81af3bffde5f6de81c16749c269a85c396d138e8" to "8cc62de53d45d251dc7121cbffec7a1154ad8bf0"



---

archive/issue_comments_644653.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-13T04:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644653",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_644654.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-13T04:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644654",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_644655.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,63 @@\n (split out from #31280)\n \n-As noted in #31280#comment:65, this will help for #30768 and hence for Python 3.10 compatibility\n+As noted in ticket:31280#comment:65, this helps\n+for #30768 and hence for Python 3.10 compatibility.\n+\n+Three packages are added, each becoming\n+a standard spkg.\n+\n+## [charset-normalizer](https://pypi.org/project/charset-normalizer)\n+\n+Added under the name `charset_normalizer`.\n+\n+> \"Charset Detection, for Everyone\"\n+\n+>\n+> A library that helps you read text from an unknown\n+> charset encoding.\n+\n+>\n+> [...] All IANA character set names for which the\n+> Python core library provides codecs are supported.\n+\n+\n+## [idna](https://pypi.org/project/idna)\n+\n+> Support for the Internationalised Domain Names\n+> in Applications (IDNA) protocol as specified\n+> in RFC 5891. This is the latest version of the\n+> protocol and is sometimes referred to as \u201cIDNA 2008\u201d.\n+\n+>\n+> This library also provides support\n+> for Unicode Technical Standard 46, \n+> Unicode IDNA Compatibility Processing.\n+\n+>\n+> This acts as a suitable replacement for the\n+> \u201cencodings.idna\u201d module that comes with the\n+> Python standard library, but which only supports\n+> the old, deprecated IDNA specification (RFC 3490).\n+\n+\n+## [urllib3](https://pypi.org/project/urllib3/)\n+\n+> a powerful, user-friendly HTTP client for Python.\n+> [...]\n+> urllib3 brings many critical features that are\n+> missing from the Python standard libraries:\n+\n+>\n+> - Thread safety.\n+> - Connection pooling.\n+> - Client-side SSL/TLS verification.\n+> - File uploads with multipart encoding.\n+> - Helpers for retrying requests and dealing with HTTP redirects.\n+> - Support for gzip, deflate, and brotli encoding.\n+> - Proxy support for HTTP and SOCKS.\n+> - 100% test coverage.\n+\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-08-21T12:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644655",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,63 @@
 (split out from #31280)
 
-As noted in #31280#comment:65, this will help for #30768 and hence for Python 3.10 compatibility
+As noted in ticket:31280#comment:65, this helps
+for #30768 and hence for Python 3.10 compatibility.
+
+Three packages are added, each becoming
+a standard spkg.
+
+## [charset-normalizer](https://pypi.org/project/charset-normalizer)
+
+Added under the name `charset_normalizer`.
+
+> "Charset Detection, for Everyone"
+
+>
+> A library that helps you read text from an unknown
+> charset encoding.
+
+>
+> [...] All IANA character set names for which the
+> Python core library provides codecs are supported.
+
+
+## [idna](https://pypi.org/project/idna)
+
+> Support for the Internationalised Domain Names
+> in Applications (IDNA) protocol as specified
+> in RFC 5891. This is the latest version of the
+> protocol and is sometimes referred to as “IDNA 2008”.
+
+>
+> This library also provides support
+> for Unicode Technical Standard 46, 
+> Unicode IDNA Compatibility Processing.
+
+>
+> This acts as a suitable replacement for the
+> “encodings.idna” module that comes with the
+> Python standard library, but which only supports
+> the old, deprecated IDNA specification (RFC 3490).
+
+
+## [urllib3](https://pypi.org/project/urllib3/)
+
+> a powerful, user-friendly HTTP client for Python.
+> [...]
+> urllib3 brings many critical features that are
+> missing from the Python standard libraries:
+
+>
+> - Thread safety.
+> - Connection pooling.
+> - Client-side SSL/TLS verification.
+> - File uploads with multipart encoding.
+> - Helpers for retrying requests and dealing with HTTP redirects.
+> - Support for gzip, deflate, and brotli encoding.
+> - Proxy support for HTTP and SOCKS.
+> - 100% test coverage.
+
+
 
 Comment: 1
 
``````




---

archive/issue_comments_644656.json:
```json
{
    "body": "<a id='comment:7'></a>Would a round of github-actions be a good way\nto start a review of this?",
    "created_at": "2021-08-21T12:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644656",
    "user": "https://github.com/slel"
}
```

<a id='comment:7'></a>Would a round of github-actions be a good way
to start a review of this?



---

archive/issue_comments_644657.json:
```json
{
    "body": "<a id='comment:8'></a>I have launched one some hours ago. It should take 1 day or more.\n\nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/1153312296",
    "created_at": "2021-08-21T15:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644657",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>I have launched one some hours ago. It should take 1 day or more.

https://github.com/sagemath/sagetrac-mirror/actions/runs/1153312296



---

archive/issue_comments_644658.json:
```json
{
    "body": "<a id='comment:9'></a>apparently, the github CI is not able to use the \"upstream_url\" for \"charset_normalizer\"",
    "created_at": "2021-08-21T18:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644658",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>apparently, the github CI is not able to use the "upstream_url" for "charset_normalizer"



---

archive/issue_comments_644659.json:
```json
{
    "body": "<a id='comment:10'></a>The download failure on `ubuntu-trusty-standard` [https://github.com/sagemath/sagetrac-mirror/runs/3388617349?check_suite_focus=true](https://github.com/sagemath/sagetrac-mirror/runs/3388617349?check_suite_focus=true)\n\n```\n  [urllib3-1.26.6]   [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n  [urllib3-1.26.6]   ERROR [transfer|run:135]: [Errno 403] SNI is required: '//pypi.io/packages/source/u/urllib3/urllib3-1.26.6.tar.gz'\n  [urllib3-1.26.6]   ************************************************************************\n  [urllib3-1.26.6]   Traceback (most recent call last):\n  [urllib3-1.26.6]     File \"/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 126, in run_safe\n  [urllib3-1.26.6]       run()\n```\nis new (and unrelated to #32403)",
    "created_at": "2021-08-21T20:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644659",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>The download failure on `ubuntu-trusty-standard` [https://github.com/sagemath/sagetrac-mirror/runs/3388617349?check_suite_focus=true](https://github.com/sagemath/sagetrac-mirror/runs/3388617349?check_suite_focus=true)

```
  [urllib3-1.26.6]   [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
  [urllib3-1.26.6]   ERROR [transfer|run:135]: [Errno 403] SNI is required: '//pypi.io/packages/source/u/urllib3/urllib3-1.26.6.tar.gz'
  [urllib3-1.26.6]   ************************************************************************
  [urllib3-1.26.6]   Traceback (most recent call last):
  [urllib3-1.26.6]     File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 126, in run_safe
  [urllib3-1.26.6]       run()
```
is new (and unrelated to #32403)



---

archive/issue_comments_644660.json:
```json
{
    "body": "<a id='comment:11'></a>This appears to be from https://github.com/pypa/pypi-support/issues/978 (\"Deprecation of non-SNI compatible clients\")",
    "created_at": "2021-08-21T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644660",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>This appears to be from https://github.com/pypa/pypi-support/issues/978 ("Deprecation of non-SNI compatible clients")



---

archive/issue_comments_644661.json:
```json
{
    "body": "<a id='comment:12'></a>I've opened #32405 for this failure; it has no technical relation to the present ticket.",
    "created_at": "2021-08-21T22:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644661",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>I've opened #32405 for this failure; it has no technical relation to the present ticket.



---

archive/issue_comments_644662.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-30T20:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644662",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_644663.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-08-30T20:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644663",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_644664.json:
```json
{
    "body": "<a id='comment:14'></a>lgtm",
    "created_at": "2021-08-30T20:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644664",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>lgtm



---

archive/issue_comments_644665.json:
```json
{
    "body": "<a id='comment:15'></a>Thanks!",
    "created_at": "2021-08-30T20:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644665",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Thanks!



---

archive/issue_events_085912.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-07T20:52:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32372#event-85912"
}
```



---

archive/issue_comments_644666.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-07T20:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644666",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_644667.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/requests__upgrade_to_2_26_0__add_new__unvendored__deps\" to \"8cc62de53d45d251dc7121cbffec7a1154ad8bf0\"",
    "created_at": "2021-09-07T20:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32372#issuecomment-644667",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/requests__upgrade_to_2_26_0__add_new__unvendored__deps" to "8cc62de53d45d251dc7121cbffec7a1154ad8bf0"
