# Issue 32707: flit_core: Update to 3.4.0; setuptools_scm: Update to 6.3.2

archive/issues_032470.json:
```json
{
    "body": "https://flit.readthedocs.io/en/latest/history.html#version-3-4\n\nThis simplifies the dependencies and removes a \"circular dependency\" warning from the output during build.\n\nCC:  @vbraun @dimpase @jhpalmieri\n\nReviewer: Volker Braun\n\nAuthor: Matthias Koeppe\n\nBranch: 9eea50ccf4bf2db2f824c89b21a387334b1e01b4\n\nDependencies: #32698\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32707\n\n",
    "closed_at": "2021-10-19T20:30:37Z",
    "created_at": "2021-10-17T17:38:01Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "flit_core: Update to 3.4.0; setuptools_scm: Update to 6.3.2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32707",
    "user": "https://github.com/mkoeppe"
}
```
https://flit.readthedocs.io/en/latest/history.html#version-3-4

This simplifies the dependencies and removes a "circular dependency" warning from the output during build.

CC:  @vbraun @dimpase @jhpalmieri

Reviewer: Volker Braun

Author: Matthias Koeppe

Branch: 9eea50ccf4bf2db2f824c89b21a387334b1e01b4

Dependencies: #32698

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32707





---

archive/issue_comments_651866.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-10-17T17:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651866",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_651867.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32698\"",
    "created_at": "2021-10-17T17:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651867",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32698"



---

archive/issue_comments_651868.json:
```json
{
    "body": "Changing dependencies from \"#32698\" to \"#32698, #32492\"",
    "created_at": "2021-10-17T17:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651868",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32698" to "#32698, #32492"



---

archive/issue_comments_651869.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/flit_core__update_to_3_4_0\"",
    "created_at": "2021-10-17T17:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651869",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/flit_core__update_to_3_4_0"



---

archive/issue_comments_651870.json:
```json
{
    "body": "Changing commit from \"\" to \"ed0b42b704f26e17059fdc1ef407e8be2778cdde\"",
    "created_at": "2021-10-17T17:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651870",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "ed0b42b704f26e17059fdc1ef407e8be2778cdde"



---

archive/issue_comments_651871.json:
```json
{
    "body": "<a id='comment:5'></a>\nLast 10 new commits:\n|                                                                                                                                          |                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[8bcbf1d](https://github.com/sagemath/sagetrac-mirror/commit/8bcbf1d919d7d90cefe1442a23aaa66df4ecd2d3)|`Makefile (distclean): Remove convenience symlinks prefix, venv`|\n|[dcb4a08](https://github.com/sagemath/sagetrac-mirror/commit/dcb4a08a1d5e5e2363c4b6e2f2f3d852efd3aae0)|`configure.ac: Indicate default in help string for --with-sage-venv`|\n|[e33bc89](https://github.com/sagemath/sagetrac-mirror/commit/e33bc89dd280dec5aa9241b2722d57102ac126b4)|`Merge tag '9.5.beta3' into t/32442/__configure__make___with_sage_venv_the_default`|\n|[2101b8c](https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498)|`build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build`|\n|[3bbc5d8](https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e)|`build/pkgs/python3/spkg-build.in: Set rpath`|\n|[99f0a5f](https://github.com/sagemath/sagetrac-mirror/commit/99f0a5fa6cec3f0d411fc58c2edde2aa6d5b0d5a)|`Merge #32698`|\n|[7100660](https://github.com/sagemath/sagetrac-mirror/commit/7100660478031cc355963056bda40ede2d538543)|`build/pkgs/backcall/dependencies: flit_core now uses tomli`|\n|[0f5158f](https://github.com/sagemath/sagetrac-mirror/commit/0f5158f08e1129758d92d2936daf5504f2895138)|`build/pkgs/setuptools_scm: Update to 6.3.2`|\n|[e053097](https://github.com/sagemath/sagetrac-mirror/commit/e053097a07f635dae83dd69379a13a6335c0b45e)|`build/pkgs/importlib_metadata/dependencies: setuptools_scm[toml] uses tomli now`|\n|[ed0b42b](https://github.com/sagemath/sagetrac-mirror/commit/ed0b42b704f26e17059fdc1ef407e8be2778cdde)|`build/pkgs/toml: Remove`|",
    "created_at": "2021-10-17T17:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651871",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Last 10 new commits:
|                                                                                                                                          |                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[8bcbf1d](https://github.com/sagemath/sagetrac-mirror/commit/8bcbf1d919d7d90cefe1442a23aaa66df4ecd2d3)|`Makefile (distclean): Remove convenience symlinks prefix, venv`|
|[dcb4a08](https://github.com/sagemath/sagetrac-mirror/commit/dcb4a08a1d5e5e2363c4b6e2f2f3d852efd3aae0)|`configure.ac: Indicate default in help string for --with-sage-venv`|
|[e33bc89](https://github.com/sagemath/sagetrac-mirror/commit/e33bc89dd280dec5aa9241b2722d57102ac126b4)|`Merge tag '9.5.beta3' into t/32442/__configure__make___with_sage_venv_the_default`|
|[2101b8c](https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498)|`build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build`|
|[3bbc5d8](https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e)|`build/pkgs/python3/spkg-build.in: Set rpath`|
|[99f0a5f](https://github.com/sagemath/sagetrac-mirror/commit/99f0a5fa6cec3f0d411fc58c2edde2aa6d5b0d5a)|`Merge #32698`|
|[7100660](https://github.com/sagemath/sagetrac-mirror/commit/7100660478031cc355963056bda40ede2d538543)|`build/pkgs/backcall/dependencies: flit_core now uses tomli`|
|[0f5158f](https://github.com/sagemath/sagetrac-mirror/commit/0f5158f08e1129758d92d2936daf5504f2895138)|`build/pkgs/setuptools_scm: Update to 6.3.2`|
|[e053097](https://github.com/sagemath/sagetrac-mirror/commit/e053097a07f635dae83dd69379a13a6335c0b45e)|`build/pkgs/importlib_metadata/dependencies: setuptools_scm[toml] uses tomli now`|
|[ed0b42b](https://github.com/sagemath/sagetrac-mirror/commit/ed0b42b704f26e17059fdc1ef407e8be2778cdde)|`build/pkgs/toml: Remove`|



---

archive/issue_comments_651872.json:
```json
{
    "body": "Changing dependencies from \"#32698, #32492\" to \"#32698\"",
    "created_at": "2021-10-17T17:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651872",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32698, #32492" to "#32698"



---

archive/issue_events_097393.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "rename": {
        "from": "flit_core: Update to 3.4.0",
        "to": "flit_core: Update to 3.4.0; setuptools_scm: Update to 6.3.2; remove package toml"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32707#event-97393"
}
```



---

archive/issue_comments_651873.json:
```json
{
    "body": "Changing commit from \"ed0b42b704f26e17059fdc1ef407e8be2778cdde\" to \"4720666f8525cfc6923c1a290e51a49016c6127f\"",
    "created_at": "2021-10-17T18:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ed0b42b704f26e17059fdc1ef407e8be2778cdde" to "4720666f8525cfc6923c1a290e51a49016c6127f"



---

archive/issue_comments_651874.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[4720666](https://github.com/sagemath/sagetrac-mirror/commit/4720666f8525cfc6923c1a290e51a49016c6127f)|`build/pkgs/tomli/spkg-install.in: Set up PYTHONPATH`|",
    "created_at": "2021-10-17T18:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[4720666](https://github.com/sagemath/sagetrac-mirror/commit/4720666f8525cfc6923c1a290e51a49016c6127f)|`build/pkgs/tomli/spkg-install.in: Set up PYTHONPATH`|



---

archive/issue_comments_651875.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-17T18:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651875",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_651876.json:
```json
{
    "body": "<a id='comment:8'></a>\nIs this the expected output?\n\n```\nERROR: Could not find a version that satisfies the requirement tomli (from flit-core) (from versions: none)\nERROR: No matching distribution found for tomli\nWarning: installing with \"python3 -m pip install --verbose --no-index --find-links=/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels --disable-pip-version-check --isolated --no-cache-dir\" failed. Retrying, adding \"--no-deps --ignore-installed --ignore-requires-python\"\nUsing pip 21.2.4 from /home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pip (python 3.9)\nLooking in links: /home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels\nProcessing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/flit_core-3.4.0/inst/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/flit_core-3.4.0-py3-none-any.whl\nInstalling collected packages: flit-core\nSuccessfully installed flit-core-3.4.0\nWarning: The installation needed to use \"--no-deps --ignore-installed --ignore-requires-python\" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.\n```",
    "created_at": "2021-10-17T22:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651876",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Is this the expected output?

```
ERROR: Could not find a version that satisfies the requirement tomli (from flit-core) (from versions: none)
ERROR: No matching distribution found for tomli
Warning: installing with "python3 -m pip install --verbose --no-index --find-links=/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels --disable-pip-version-check --isolated --no-cache-dir" failed. Retrying, adding "--no-deps --ignore-installed --ignore-requires-python"
Using pip 21.2.4 from /home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pip (python 3.9)
Looking in links: /home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
Processing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/flit_core-3.4.0/inst/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/flit_core-3.4.0-py3-none-any.whl
Installing collected packages: flit-core
Successfully installed flit-core-3.4.0
Warning: The installation needed to use "--no-deps --ignore-installed --ignore-requires-python" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.
```



---

archive/issue_comments_651877.json:
```json
{
    "body": "<a id='comment:9'></a>\ntox still depends on toml:\n\n```\nbuild/pkgs/tox/dependencies:$(PYTHON) packaging six filelock pluggy py toml virtualenv importlib_metadata | $(PYTHON_TOOLCHAIN)\n```",
    "created_at": "2021-10-17T22:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651877",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
tox still depends on toml:

```
build/pkgs/tox/dependencies:$(PYTHON) packaging six filelock pluggy py toml virtualenv importlib_metadata | $(PYTHON_TOOLCHAIN)
```



---

archive/issue_comments_651878.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [vbraun](#comment%3A8):\n> Is this the expected output?\n> \n> ```\n> Warning: The installation needed to use \"--no-deps --ignore-installed --ignore-requires-python\" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.\n> ```\n\nYes",
    "created_at": "2021-10-17T23:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651878",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [vbraun](#comment%3A8):
> Is this the expected output?
> 
> ```
> Warning: The installation needed to use "--no-deps --ignore-installed --ignore-requires-python" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.
> ```

Yes



---

archive/issue_comments_651879.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[fa561b2](https://github.com/sagemath/sagetrac-mirror/commit/fa561b2ecfa1899e14d55a44cf6925185e2e5d83)|`build/pkgs/tomli/spkg-install.in: Set up PYTHONPATH`|\n|[9eea50c](https://github.com/sagemath/sagetrac-mirror/commit/9eea50ccf4bf2db2f824c89b21a387334b1e01b4)|`build/pkgs/toml/spkg-configure.m4: If system tox is used, mark as not required`|",
    "created_at": "2021-10-17T23:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[fa561b2](https://github.com/sagemath/sagetrac-mirror/commit/fa561b2ecfa1899e14d55a44cf6925185e2e5d83)|`build/pkgs/tomli/spkg-install.in: Set up PYTHONPATH`|
|[9eea50c](https://github.com/sagemath/sagetrac-mirror/commit/9eea50ccf4bf2db2f824c89b21a387334b1e01b4)|`build/pkgs/toml/spkg-configure.m4: If system tox is used, mark as not required`|



---

archive/issue_comments_651880.json:
```json
{
    "body": "Changing commit from \"4720666f8525cfc6923c1a290e51a49016c6127f\" to \"9eea50ccf4bf2db2f824c89b21a387334b1e01b4\"",
    "created_at": "2021-10-17T23:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4720666f8525cfc6923c1a290e51a49016c6127f" to "9eea50ccf4bf2db2f824c89b21a387334b1e01b4"



---

archive/issue_comments_651881.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vbraun](#comment%3A9):\n> tox still depends on toml:\n> \n> ```\n> build/pkgs/tox/dependencies:$(PYTHON) packaging six filelock pluggy py toml virtualenv importlib_metadata | $(PYTHON_TOOLCHAIN)\n> ```\n\nThanks for catching this",
    "created_at": "2021-10-17T23:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651881",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [vbraun](#comment%3A9):
> tox still depends on toml:
> 
> ```
> build/pkgs/tox/dependencies:$(PYTHON) packaging six filelock pluggy py toml virtualenv importlib_metadata | $(PYTHON_TOOLCHAIN)
> ```

Thanks for catching this



---

archive/issue_events_097394.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "rename": {
        "from": "flit_core: Update to 3.4.0; setuptools_scm: Update to 6.3.2; remove package toml",
        "to": "flit_core: Update to 3.4.0; setuptools_scm: Update to 6.3.2"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32707#event-97394"
}
```



---

archive/issue_comments_651882.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n https://flit.readthedocs.io/en/latest/history.html#version-3-4\n \n+This simplifies the dependencies and removes a \"circular dependency\" warning from the output during build.\n``````\n",
    "created_at": "2021-10-18T19:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651882",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 https://flit.readthedocs.io/en/latest/history.html#version-3-4
 
+This simplifies the dependencies and removes a "circular dependency" warning from the output during build.
``````




---

archive/issue_comments_651883.json:
```json
{
    "body": "<a id='comment:15'></a>\nOk its a bit sub-optimal to tell people to complain on sage-devel upon successful installation, but hopefully nobody looks into the log.\n\nHowever, building the source tarball fails because tox still depends on toml:\n\n```\nsage -sdist\n[...]\n[threejs-r122.p0] Using cached file /home/release/Sage/upstream/threejs-sage-r122.tar.gz\nmake[1]: Nothing to be done for 'tomli'.\nmake[1]: Nothing to be done for 'tornado'.\nmake[1]: *** No rule to make target 'toml', needed by '/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/tox-3.24.3'.  Stop.\nmake: *** [Makefile:2336: download-for-sdist] Error 2\n```",
    "created_at": "2021-10-18T20:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651883",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Ok its a bit sub-optimal to tell people to complain on sage-devel upon successful installation, but hopefully nobody looks into the log.

However, building the source tarball fails because tox still depends on toml:

```
sage -sdist
[...]
[threejs-r122.p0] Using cached file /home/release/Sage/upstream/threejs-sage-r122.tar.gz
make[1]: Nothing to be done for 'tomli'.
make[1]: Nothing to be done for 'tornado'.
make[1]: *** No rule to make target 'toml', needed by '/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/tox-3.24.3'.  Stop.
make: *** [Makefile:2336: download-for-sdist] Error 2
```



---

archive/issue_comments_651884.json:
```json
{
    "body": "<a id='comment:16'></a>\nDid you run `bootstrap`?",
    "created_at": "2021-10-18T20:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651884",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Did you run `bootstrap`?



---

archive/issue_comments_651885.json:
```json
{
    "body": "<a id='comment:17'></a>\nYes, did run bootstrap. The content of the source tarball hopefully doesn't depend on which system libraries are available.\n\nAlso just got this while trying the latest version\n\n```\n****************************************************\nUninstalling existing 'pyparsing'\nWarning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl' not found\nWarning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found\nRunning pip-uninstall script for 'pyparsing'\nFound existing installation: pyparsing 2.4.7\nUninstalling pyparsing-2.4.7:\n  Successfully uninstalled pyparsing-2.4.7\nRemoving stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/pyparsing-2.4.7'\nInstalling pyparsing-2.4.7\nProcessing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src\n    Running command python setup.py egg_info\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py\", line 18, in <module>\n        setup(# Distribution meta-data\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/__init__.py\", line 153, in setup\n        return distutils.core.setup(**attrs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/core.py\", line 108, in setup\n        _setup_distribution = dist = klass(attrs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py\", line 450, in __init__\n        _Distribution.__init__(\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/dist.py\", line 293, in __init__\n        self.finalize_options()\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py\", line 827, in finalize_options\n        for ep in sorted(loaded, key=by_order):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py\", line 826, in <lambda>\n        loaded = map(lambda e: e.load(), filtered)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py\", line 2449, in load\n        self.require(*args, **kwargs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py\", line 2472, in require\n        items = working_set.resolve(reqs, env, installer, extras=self.extras)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py\", line 772, in resolve\n        raise DistributionNotFound(req, requirers)\n    pkg_resources.DistributionNotFound: The 'tomli>=1.0.0' distribution was not found and is required by the application\nWARNING: Discarding file:///home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src. Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.\nERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.\n**************************************************************************************************************************************************************\nError building a wheel for pyparsing-2.4.7\n**************************************************************************************************************************************************************\n```",
    "created_at": "2021-10-18T20:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651885",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
Yes, did run bootstrap. The content of the source tarball hopefully doesn't depend on which system libraries are available.

Also just got this while trying the latest version

```
****************************************************
Uninstalling existing 'pyparsing'
Warning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl' not found
Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
Running pip-uninstall script for 'pyparsing'
Found existing installation: pyparsing 2.4.7
Uninstalling pyparsing-2.4.7:
  Successfully uninstalled pyparsing-2.4.7
Removing stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/pyparsing-2.4.7'
Installing pyparsing-2.4.7
Processing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src
    Running command python setup.py egg_info
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py", line 18, in <module>
        setup(# Distribution meta-data
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
        return distutils.core.setup(**attrs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/core.py", line 108, in setup
        _setup_distribution = dist = klass(attrs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 450, in __init__
        _Distribution.__init__(
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/dist.py", line 293, in __init__
        self.finalize_options()
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 827, in finalize_options
        for ep in sorted(loaded, key=by_order):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 826, in <lambda>
        loaded = map(lambda e: e.load(), filtered)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2449, in load
        self.require(*args, **kwargs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2472, in require
        items = working_set.resolve(reqs, env, installer, extras=self.extras)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 772, in resolve
        raise DistributionNotFound(req, requirers)
    pkg_resources.DistributionNotFound: The 'tomli>=1.0.0' distribution was not found and is required by the application
WARNING: Discarding file:///home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src. Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
**************************************************************************************************************************************************************
Error building a wheel for pyparsing-2.4.7
**************************************************************************************************************************************************************
```



---

archive/issue_comments_651886.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [vbraun](#comment%3A15):\n> Ok its a bit sub-optimal to tell people to complain on sage-devel upon successful installation, but hopefully nobody looks into the log.\n\n\nYes, we can address this in #32715.",
    "created_at": "2021-10-18T21:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651886",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [vbraun](#comment%3A15):
> Ok its a bit sub-optimal to tell people to complain on sage-devel upon successful installation, but hopefully nobody looks into the log.


Yes, we can address this in #32715.



---

archive/issue_comments_651887.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [vbraun](#comment%3A17):\n> Yes, did run bootstrap. The content of the source tarball hopefully doesn't depend on which system libraries are available.\n\n\nAsking because it looks like what a make run would look like after the `toml` package has been removed.",
    "created_at": "2021-10-18T21:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651887",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Replying to [vbraun](#comment%3A17):
> Yes, did run bootstrap. The content of the source tarball hopefully doesn't depend on which system libraries are available.


Asking because it looks like what a make run would look like after the `toml` package has been removed.



---

archive/issue_comments_651888.json:
```json
{
    "body": "<a id='comment:20'></a>\nI recommend to use `make dist` instead of directly using `./sage --sdist`, which takes care of regenerating the Makefile.",
    "created_at": "2021-10-18T21:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651888",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
I recommend to use `make dist` instead of directly using `./sage --sdist`, which takes care of regenerating the Makefile.



---

archive/issue_comments_651889.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [vbraun](#comment%3A17):\n> Also just got this while trying the latest version\n> \n> ```\n> ****************************************************\n> Uninstalling existing 'pyparsing'\n> Warning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl' not found\n> Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found\n> Running pip-uninstall script for 'pyparsing'\n> Found existing installation: pyparsing 2.4.7\n> ```\n\nBest to get rid of this messed up worktree",
    "created_at": "2021-10-18T21:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651889",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [vbraun](#comment%3A17):
> Also just got this while trying the latest version
> 
> ```
> ****************************************************
> Uninstalling existing 'pyparsing'
> Warning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl' not found
> Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
> Running pip-uninstall script for 'pyparsing'
> Found existing installation: pyparsing 2.4.7
> ```

Best to get rid of this messed up worktree



---

archive/issue_comments_651890.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe pyparsing error says that tomli is required, but its not listed as a dependency\n\n```\n[release@zen Sage]$ cat build/pkgs/pyparsing/dependencies \n$(PYTHON) | setuptools pip wheel\n```\nI think thats a real dependency error",
    "created_at": "2021-10-18T22:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651890",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
The pyparsing error says that tomli is required, but its not listed as a dependency

```
[release@zen Sage]$ cat build/pkgs/pyparsing/dependencies 
$(PYTHON) | setuptools pip wheel
```
I think thats a real dependency error



---

archive/issue_comments_651891.json:
```json
{
    "body": "<a id='comment:23'></a>\nThere's nothing in pyparsing that refers to tomli.\n\nI think in your worktree, you have for some reason a broken installation record of pip packages.\n\nCan you reproduce this in a from scratch build?",
    "created_at": "2021-10-18T22:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651891",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
There's nothing in pyparsing that refers to tomli.

I think in your worktree, you have for some reason a broken installation record of pip packages.

Can you reproduce this in a from scratch build?



---

archive/issue_comments_651892.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2021-10-19T20:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651892",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_651893.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-19T20:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651893",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_651894.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651894",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_651895.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/flit_core__update_to_3_4_0\" to \"9eea50ccf4bf2db2f824c89b21a387334b1e01b4\"",
    "created_at": "2021-10-19T20:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651895",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/flit_core__update_to_3_4_0" to "9eea50ccf4bf2db2f824c89b21a387334b1e01b4"



---

archive/issue_events_097395.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-19T20:30:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32707#event-97395"
}
```



---

archive/issue_comments_651896.json:
```json
{
    "body": "<a id='comment:26'></a>\nI'm still getting very frequent `pkg_resources.DistributionNotFound: The 'xxx>=20.0' distribution was not found and is required by the application` errors with incremental builds with some packaging-related pip packages. Basically have to do a `make distclean` every day now. Something is messed up there...",
    "created_at": "2021-10-24T08:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651896",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
I'm still getting very frequent `pkg_resources.DistributionNotFound: The 'xxx>=20.0' distribution was not found and is required by the application` errors with incremental builds with some packaging-related pip packages. Basically have to do a `make distclean` every day now. Something is messed up there...



---

archive/issue_comments_651897.json:
```json
{
    "body": "Changing commit from \"9eea50ccf4bf2db2f824c89b21a387334b1e01b4\" to \"\"",
    "created_at": "2021-10-24T08:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651897",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "9eea50ccf4bf2db2f824c89b21a387334b1e01b4" to ""



---

archive/issue_comments_651898.json:
```json
{
    "body": "<a id='comment:27'></a>\nI've created #32751 for this issue",
    "created_at": "2021-10-24T09:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651898",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
I've created #32751 for this issue



---

archive/issue_comments_651899.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe issue is not fixed, I still see very frequent `pkg_resources.DistributionNotFound: The 'xxx>=20.0' distribution was not found and is required by the application` errors during incremental builds",
    "created_at": "2021-11-07T10:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32707#issuecomment-651899",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
The issue is not fixed, I still see very frequent `pkg_resources.DistributionNotFound: The 'xxx>=20.0' distribution was not found and is required by the application` errors during incremental builds
