# Issue 32002: Fix wrong selection of integrator in some cases

archive/issues_031765.json:
```json
{
    "body": "Our integration strategy is to first try Maxima and,\nif that fails, try other engines.\n\nWhen the integrand has a constant factor, Maxima first turns\n`integral(c*f(x), x, a, b)` into `c*integral(f(x), x, a, b)`.\nIf it cannot evaluate it further, we fail to detect that,\nas we only check whether the outer operator of the obtained\nsymbolic expression is an integral.\n\nFor instance, in Sage 9.3, this integral is computed\ncorrectly (Maxima fails, but Giac computes it):\n\n```\nsage: min = min_symbolic\nsage: integral(min(x, 2*x), x, -1, 1)\n-1/2\n```\nbut this rescaled-by-two version tricks us:\n\n```\nsage: integral(2*min(x, 2*x), x, -1, 1)\n2*integrate(min(2*x, x), x, -1, 1)\n```\neven though Giac can compute it:\n\n```\nsage: integral(2*min(x, 2*x), x, -1, 1, algorithm='giac')\n-1\n```\n(Since `2*integrate(min(2*x, x), x, -1, 1)` is a product,\nnot an integral, we failed to try Giac.)\n\nThis ticket refines the logic for whether to try\nanother integrator so as to deal with such cases.\n\nMotivated by questions on sage-support:\n\n- https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo\n- https://groups.google.com/g/sage-support/c/kN5KSdyaaiY\n\nCC:  @tscrim @slel\n\nKeywords: integral\n\nReviewer: Travis Scrimshaw, Samuel Leli\u00e8vre\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: 3431c9b9c65fc805fa0265632bc236f8c6a2c82f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32002\n\n",
    "closed_at": "2021-07-06T21:29:29Z",
    "created_at": "2021-06-18T07:08:46Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Fix wrong selection of integrator in some cases",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32002",
    "user": "https://github.com/fchapoton"
}
```
Our integration strategy is to first try Maxima and,
if that fails, try other engines.

When the integrand has a constant factor, Maxima first turns
`integral(c*f(x), x, a, b)` into `c*integral(f(x), x, a, b)`.
If it cannot evaluate it further, we fail to detect that,
as we only check whether the outer operator of the obtained
symbolic expression is an integral.

For instance, in Sage 9.3, this integral is computed
correctly (Maxima fails, but Giac computes it):

```
sage: min = min_symbolic
sage: integral(min(x, 2*x), x, -1, 1)
-1/2
```
but this rescaled-by-two version tricks us:

```
sage: integral(2*min(x, 2*x), x, -1, 1)
2*integrate(min(2*x, x), x, -1, 1)
```
even though Giac can compute it:

```
sage: integral(2*min(x, 2*x), x, -1, 1, algorithm='giac')
-1
```
(Since `2*integrate(min(2*x, x), x, -1, 1)` is a product,
not an integral, we failed to try Giac.)

This ticket refines the logic for whether to try
another integrator so as to deal with such cases.

Motivated by questions on sage-support:

- https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo
- https://groups.google.com/g/sage-support/c/kN5KSdyaaiY

CC:  @tscrim @slel

Keywords: integral

Reviewer: Travis Scrimshaw, Samuel Lelièvre

Author: Frédéric Chapoton

Branch: 3431c9b9c65fc805fa0265632bc236f8c6a2c82f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32002





---

archive/issue_comments_636805.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n namely, when there is a common factor, maxima factors this out of the result. This prevents the automatic choice of integrator to work correctly, as it only looks wether the outer operator of the symbolic expression is an integral or not.\n \n ```\n+sage: min = min_symbolic\n sage: integral(min(x,2*x),x,-1,1)                                               \n -1/2\n sage: integral(2*min(x,2*x),x,-1,1)                                             \n@@ -9,6 +10,7 @@\n -1\n ```\n \n+\n Comment: 1\n \n Summary: wrong selection of integrator in some cases\n``````\n",
    "created_at": "2021-06-18T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636805",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
 namely, when there is a common factor, maxima factors this out of the result. This prevents the automatic choice of integrator to work correctly, as it only looks wether the outer operator of the symbolic expression is an integral or not.
 
 ```
+sage: min = min_symbolic
 sage: integral(min(x,2*x),x,-1,1)                                               
 -1/2
 sage: integral(2*min(x,2*x),x,-1,1)                                             
@@ -9,6 +10,7 @@
 -1
 ```
 
+
 Comment: 1
 
 Summary: wrong selection of integrator in some cases
``````




---

archive/issue_comments_636806.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-06-18T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636806",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_636807.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/32002\"",
    "created_at": "2021-06-18T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636807",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/32002"



---

archive/issue_comments_636808.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-18T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636808",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_636809.json:
```json
{
    "body": "Changing commit from \"\" to \"bd7886996829e8edcf3d0054ed579f8115f487aa\"",
    "created_at": "2021-06-18T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636809",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "bd7886996829e8edcf3d0054ed579f8115f487aa"



---

archive/issue_comments_636810.json:
```json
{
    "body": "Changing commit from \"bd7886996829e8edcf3d0054ed579f8115f487aa\" to \"0e1763de971cf38947ea1892b2cab72c3eec88f4\"",
    "created_at": "2021-06-18T07:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bd7886996829e8edcf3d0054ed579f8115f487aa" to "0e1763de971cf38947ea1892b2cab72c3eec88f4"



---

archive/issue_comments_636811.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-18T07:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_636812.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-18T07:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_636813.json:
```json
{
    "body": "Changing commit from \"0e1763de971cf38947ea1892b2cab72c3eec88f4\" to \"3a89697fc08a957cb11a0291e0278000c350cddf\"",
    "created_at": "2021-06-18T07:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0e1763de971cf38947ea1892b2cab72c3eec88f4" to "3a89697fc08a957cb11a0291e0278000c350cddf"



---

archive/issue_comments_636814.json:
```json
{
    "body": "<a id='comment:5'></a>bot is morally green, please review\n\nthis may be just so slightly controversial, as it may replace \"partial answers still containing an unknown integral\" by just the initial unevaluated integral. One can still use the algorithm keyword to see the partial answers.",
    "created_at": "2021-06-18T13:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636814",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>bot is morally green, please review

this may be just so slightly controversial, as it may replace "partial answers still containing an unknown integral" by just the initial unevaluated integral. One can still use the algorithm keyword to see the partial answers.



---

archive/issue_comments_636815.json:
```json
{
    "body": "<a id='comment:6'></a>Do you have an example where this behavior changed? It's not so important, but perhaps you had something offhand about this to add an explanation about what to do for potentially getting partial answers.\n\nAlso, can you break the one really long line integral output?",
    "created_at": "2021-06-18T22:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636815",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Do you have an example where this behavior changed? It's not so important, but perhaps you had something offhand about this to add an explanation about what to do for potentially getting partial answers.

Also, can you break the one really long line integral output?



---

archive/issue_comments_636816.json:
```json
{
    "body": "Changing commit from \"3a89697fc08a957cb11a0291e0278000c350cddf\" to \"a260b35a70ef20bbf7199539ec0e7aa839f567c4\"",
    "created_at": "2021-06-19T06:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3a89697fc08a957cb11a0291e0278000c350cddf" to "a260b35a70ef20bbf7199539ec0e7aa839f567c4"



---

archive/issue_comments_636817.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-19T06:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_636818.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+namely, when there is a common factor, maxima factors this out of the result. This prevents the automatic choice of integrator to work correctly, as it only looks wether the outer operator of the symbolic expression is an integral or not.\n \n+```\n+sage: min = min_symbolic\n+sage: integral(min(x,2*x),x,-1,1)                                               \n+-1/2\n+sage: integral(2*min(x,2*x),x,-1,1)                                             \n+2*integrate(min(2*x, x), x, -1, 1)\n+sage: integral(2*min(x,2*x),x,-1,1, algorithm='giac')                           \n+-1\n+```\n+\n+\n+Motivated by questions on sage-support :\n+\n+https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo\n+\n+https://groups.google.com/g/sage-support/c/kN5KSdyaaiY\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-19T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636818",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,21 @@
+namely, when there is a common factor, maxima factors this out of the result. This prevents the automatic choice of integrator to work correctly, as it only looks wether the outer operator of the symbolic expression is an integral or not.
 
+```
+sage: min = min_symbolic
+sage: integral(min(x,2*x),x,-1,1)                                               
+-1/2
+sage: integral(2*min(x,2*x),x,-1,1)                                             
+2*integrate(min(2*x, x), x, -1, 1)
+sage: integral(2*min(x,2*x),x,-1,1, algorithm='giac')                           
+-1
+```
+
+
+Motivated by questions on sage-support :
+
+https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo
+
+https://groups.google.com/g/sage-support/c/kN5KSdyaaiY
 
 Comment: 1
 
``````




---

archive/issue_comments_636819.json:
```json
{
    "body": "<a id='comment:8'></a>I have cut off the long doctest.\n\nI have also added an example of partially-integrated answer returned by maxima. In this example, giac will give a full answer.",
    "created_at": "2021-06-19T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636819",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>I have cut off the long doctest.

I have also added an example of partially-integrated answer returned by maxima. In this example, giac will give a full answer.



---

archive/issue_comments_636820.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-06-19T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636820",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "Frédéric Chapoton"



---

archive/issue_comments_636821.json:
```json
{
    "body": "<a id='comment:9'></a>PEP8 recommends breaking lines before binary operators:\n\n- [PEP8: Should a line break before or after a binary operator?](https://www.python.org/dev/peps/pep-0008/#should-a-line-break-before-or-after-a-binary-operator)\n\nThat's just a recommendation of course.",
    "created_at": "2021-06-19T09:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636821",
    "user": "https://github.com/slel"
}
```

<a id='comment:9'></a>PEP8 recommends breaking lines before binary operators:

- [PEP8: Should a line break before or after a binary operator?](https://www.python.org/dev/peps/pep-0008/#should-a-line-break-before-or-after-a-binary-operator)

That's just a recommendation of course.



---

archive/issue_comments_636822.json:
```json
{
    "body": "<a id='comment:10'></a>Thank you. I am good with this. If you want to incorporate Samuel's change, then go ahead. Either way you decide, you can set a positive review.",
    "created_at": "2021-06-20T03:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636822",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Thank you. I am good with this. If you want to incorporate Samuel's change, then go ahead. Either way you decide, you can set a positive review.



---

archive/issue_comments_636823.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-06-20T03:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636823",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_636824.json:
```json
{
    "body": "Changing commit from \"a260b35a70ef20bbf7199539ec0e7aa839f567c4\" to \"3431c9b9c65fc805fa0265632bc236f8c6a2c82f\"",
    "created_at": "2021-06-20T06:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a260b35a70ef20bbf7199539ec0e7aa839f567c4" to "3431c9b9c65fc805fa0265632bc236f8c6a2c82f"



---

archive/issue_comments_636825.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-20T06:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_636826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-20T06:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636826",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_636827.json:
```json
{
    "body": "<a id='comment:13'></a>ok, thanks. Done and now setting to positive",
    "created_at": "2021-06-20T06:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636827",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>ok, thanks. Done and now setting to positive



---

archive/issue_comments_636828.json:
```json
{
    "body": "<a id='comment:14'></a>Slightly expanding the ticket description.\nI agree with the positive review.",
    "created_at": "2021-06-20T08:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636828",
    "user": "https://github.com/slel"
}
```

<a id='comment:14'></a>Slightly expanding the ticket description.
I agree with the positive review.



---

archive/issue_comments_636829.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Samuel Leli\u00e8vre\"",
    "created_at": "2021-06-20T08:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636829",
    "user": "https://github.com/slel"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Samuel Lelièvre"



---

archive/issue_comments_636830.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,42 @@\n+Our integration strategy is to first try Maxima and,\n+if that fails, try other engines.\n \n+When the integrand has a constant factor, Maxima first turns\n+`integral(c*f(x), x, a, b)` into `c*integral(f(x), x, a, b)`.\n+If it cannot evaluate it further, we fail to detect that,\n+as we only check whether the outer operator of the obtained\n+symbolic expression is an integral.\n+\n+For instance, in Sage 9.3, this integral is computed\n+correctly (Maxima fails, but Giac computes it):\n+\n+```\n+sage: min = min_symbolic\n+sage: integral(min(x, 2*x), x, -1, 1)\n+-1/2\n+```\n+but this rescaled-by-two version tricks us:\n+\n+```\n+sage: integral(2*min(x, 2*x), x, -1, 1)\n+2*integrate(min(2*x, x), x, -1, 1)\n+```\n+even though Giac can compute it:\n+\n+```\n+sage: integral(2*min(x, 2*x), x, -1, 1, algorithm='giac')\n+-1\n+```\n+(Since `2*integrate(min(2*x, x), x, -1, 1)` is a product,\n+not an integral, we failed to try Giac.)\n+\n+This ticket refines the logic for whether to try\n+another integrator so as to deal with such cases.\n+\n+Motivated by questions on sage-support:\n+\n+- https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo\n+- https://groups.google.com/g/sage-support/c/kN5KSdyaaiY\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-20T08:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636830",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,42 @@
+Our integration strategy is to first try Maxima and,
+if that fails, try other engines.
 
+When the integrand has a constant factor, Maxima first turns
+`integral(c*f(x), x, a, b)` into `c*integral(f(x), x, a, b)`.
+If it cannot evaluate it further, we fail to detect that,
+as we only check whether the outer operator of the obtained
+symbolic expression is an integral.
+
+For instance, in Sage 9.3, this integral is computed
+correctly (Maxima fails, but Giac computes it):
+
+```
+sage: min = min_symbolic
+sage: integral(min(x, 2*x), x, -1, 1)
+-1/2
+```
+but this rescaled-by-two version tricks us:
+
+```
+sage: integral(2*min(x, 2*x), x, -1, 1)
+2*integrate(min(2*x, x), x, -1, 1)
+```
+even though Giac can compute it:
+
+```
+sage: integral(2*min(x, 2*x), x, -1, 1, algorithm='giac')
+-1
+```
+(Since `2*integrate(min(2*x, x), x, -1, 1)` is a product,
+not an integral, we failed to try Giac.)
+
+This ticket refines the logic for whether to try
+another integrator so as to deal with such cases.
+
+Motivated by questions on sage-support:
+
+- https://groups.google.com/g/sage-support/c/SSd9JAM7Ugo
+- https://groups.google.com/g/sage-support/c/kN5KSdyaaiY
 
 Comment: 1
 
``````




---

archive/issue_events_084658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-06T21:29:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32002#event-84658"
}
```



---

archive/issue_comments_636831.json:
```json
{
    "body": "Changing branch from \"u/chapoton/32002\" to \"3431c9b9c65fc805fa0265632bc236f8c6a2c82f\"",
    "created_at": "2021-07-06T21:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636831",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/32002" to "3431c9b9c65fc805fa0265632bc236f8c6a2c82f"



---

archive/issue_comments_636832.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-06T21:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636832",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_636833.json:
```json
{
    "body": "<a id='comment:16'></a>This is causing one test failure here, with system giac 1.7.0-21 (but reproducible with any giac version >=1.7)\n\n```\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/symbolic/integration/integral.py\", line 620, in sage.symbolic.integration.integral.integrate\nFailed example:\n    A = integral(1/ ((x-4) * (x^3+2*x+1)), x); A\nExpected:\n    integrate(1/((x^3 + 2*x + 1)*(x - 4)), x)\nGot:\n    -1/73*integrate((x^2 + 4*x + 18)/(x^3 + 2*x + 1), x) + 1/73*log(x - 4)\n**********************************************************************\n```",
    "created_at": "2021-07-19T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636833",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:16'></a>This is causing one test failure here, with system giac 1.7.0-21 (but reproducible with any giac version >=1.7)

```
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/symbolic/integration/integral.py
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/symbolic/integration/integral.py", line 620, in sage.symbolic.integration.integral.integrate
Failed example:
    A = integral(1/ ((x-4) * (x^3+2*x+1)), x); A
Expected:
    integrate(1/((x^3 + 2*x + 1)*(x - 4)), x)
Got:
    -1/73*integrate((x^2 + 4*x + 18)/(x^3 + 2*x + 1), x) + 1/73*log(x - 4)
**********************************************************************
```



---

archive/issue_comments_636834.json:
```json
{
    "body": "Changing commit from \"3431c9b9c65fc805fa0265632bc236f8c6a2c82f\" to \"\"",
    "created_at": "2021-07-19T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636834",
    "user": "https://github.com/antonio-rojas"
}
```

Changing commit from "3431c9b9c65fc805fa0265632bc236f8c6a2c82f" to ""



---

archive/issue_comments_636835.json:
```json
{
    "body": "<a id='comment:17'></a>The problem is that giac 1.7 can do the integral, but Sage doesn't understand the answer\n\n```\nsage: giac_integrator(1/((x^3 + 2*x + 1)*(x - 4)), x)\n[...]\nNotImplementedError: Unable to parse Giac output: 1/73*ln(abs(sageVARx-4))+((-292/9*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]])-3796)/(3*(1/27*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/27*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]]))+(-146/9*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]])-3796)/(3*(1/54*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/54*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]]))+(-146/9*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]])-3796)/(3*(1/54*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/54*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]])))/15987-1/219*ln(abs(sageVARx^3+2*sageVARx+1))\n```",
    "created_at": "2021-07-19T19:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636835",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:17'></a>The problem is that giac 1.7 can do the integral, but Sage doesn't understand the answer

```
sage: giac_integrator(1/((x^3 + 2*x + 1)*(x - 4)), x)
[...]
NotImplementedError: Unable to parse Giac output: 1/73*ln(abs(sageVARx-4))+((-292/9*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]])-3796)/(3*(1/27*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/27*rootof([[-3,0,-30,0,-48],[1,0,12,0,36,0,59]]))+(-146/9*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]])-3796)/(3*(1/54*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/54*rootof([[3,0,30,27,48],[1,0,12,0,36,0,59]]))+(-146/9*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]])-3796)/(3*(1/54*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]]))^2+2)*ln(sageVARx-1/54*rootof([[3,0,30,-27,48],[1,0,12,0,36,0,59]])))/15987-1/219*ln(abs(sageVARx^3+2*sageVARx+1))
```



---

archive/issue_comments_636836.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 arojas]:\n> This is causing one test failure here, with system giac 1.7.0-21 (but reproducible with any giac version >=1.7)\n\n\nFixed in #32275",
    "created_at": "2021-07-25T11:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636836",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:18'></a>Replying to [comment:16 arojas]:
> This is causing one test failure here, with system giac 1.7.0-21 (but reproducible with any giac version >=1.7)


Fixed in #32275



---

archive/issue_comments_636837.json:
```json
{
    "body": "<a id='comment:19'></a>Follow-up at #32184.",
    "created_at": "2021-08-09T22:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32002#issuecomment-636837",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'></a>Follow-up at #32184.
