# Issue 32406: Make "./configure --enable-editable" the default

archive/issues_032169.json:
```json
{
    "body": "This has been available since 9.3, has been improved in 9.4 and in the 9.7 series (#33855), and is ready for general consumption\n\nIntroduction:\n- https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library\n\nDiscussion:\n- https://groups.google.com/g/sage-devel/c/0GV8_O1VwbI\n\n\nCC:  @kliem @dimpase @orlitzky @tobiasdiez @saraedum @kiwifb @jhpalmieri @williamstein @nbruin\n\nBranch/Commit: a911e0fbe1f8117cd63e3f67753fdf421592f30b\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #32672, #33855, #31049, #33627\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32406\n\n",
    "closed_at": "2022-08-01T20:23:09Z",
    "created_at": "2021-08-22T00:31:43Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Make \"./configure --enable-editable\" the default",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32406",
    "user": "https://github.com/mkoeppe"
}
```
This has been available since 9.3, has been improved in 9.4 and in the 9.7 series (#33855), and is ready for general consumption

Introduction:
- https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library

Discussion:
- https://groups.google.com/g/sage-devel/c/0GV8_O1VwbI


CC:  @kliem @dimpase @orlitzky @tobiasdiez @saraedum @kiwifb @jhpalmieri @williamstein @nbruin

Branch/Commit: a911e0fbe1f8117cd63e3f67753fdf421592f30b

Reviewer: John Palmieri

Author: Matthias Koeppe

Dependencies: #32672, #33855, #31049, #33627

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32406





---

archive/issue_comments_458895.json:
```json
{
    "body": "<a id='comment:1'></a>This would avoid the occasional WTF when one forgets to \"make\" after editing a file, but I've always thought the separation of source and build trees was one of the things that sage got right. Even with modern python projects, you usually want to byte-compile and/or pip-install after changing anything, so the build step is not unexpected. It is tediously slow, though, for sure.",
    "created_at": "2021-09-10T15:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458895",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>This would avoid the occasional WTF when one forgets to "make" after editing a file, but I've always thought the separation of source and build trees was one of the things that sage got right. Even with modern python projects, you usually want to byte-compile and/or pip-install after changing anything, so the build step is not unexpected. It is tediously slow, though, for sure.



---

archive/issue_comments_458896.json:
```json
{
    "body": "<a id='comment:2'></a>Thanks for the discussion. I'm actually pretty sure that using `pip install -e` is widely used by Python developers though; but that is probably also connected to the widespread use of virtual environments for specific tasks. \n\nIt is true that if one just has one \"global\" environment (and the monolithic nature of the Sage install with hours of compile time tend to lead to that), the isolation of that environment from the source tree is indeed useful.\n\nSo perhaps we need to wait until venv use becomes more popular in Sage developer circles. #32442 is intended to increase venv awareness.",
    "created_at": "2021-09-10T18:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Thanks for the discussion. I'm actually pretty sure that using `pip install -e` is widely used by Python developers though; but that is probably also connected to the widespread use of virtual environments for specific tasks. 

It is true that if one just has one "global" environment (and the monolithic nature of the Sage install with hours of compile time tend to lead to that), the isolation of that environment from the source tree is indeed useful.

So perhaps we need to wait until venv use becomes more popular in Sage developer circles. #32442 is intended to increase venv awareness.



---

archive/issue_events_085981.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32406#event-85981"
}
```



---

archive/issue_comments_458897.json:
```json
{
    "body": "<a id='comment:5'></a>Remove dependency on #32442, see ticket:29039#comment:163.",
    "created_at": "2021-12-29T06:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458897",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>Remove dependency on #32442, see ticket:29039#comment:163.



---

archive/issue_events_085982.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T01:55:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32406#event-85982"
}
```



---

archive/issue_events_085983.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T01:55:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32406#event-85983"
}
```



---

archive/issue_comments_458898.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2022-05-12T00:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_458899.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-12T01:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458900.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-12T18:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458900",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458901.json:
```json
{
    "body": "<a id='comment:11'></a>Shouldn't the editable mode be disabled on some ci workflows so that the `so` and `o` files are not included in the docker containers or dist? Or are they excluded by other means?",
    "created_at": "2022-05-12T21:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458901",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>Shouldn't the editable mode be disabled on some ci workflows so that the `so` and `o` files are not included in the docker containers or dist? Or are they excluded by other means?



---

archive/issue_comments_458902.json:
```json
{
    "body": "<a id='comment:12'></a>The so files are needed at runtime",
    "created_at": "2022-05-12T22:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>The so files are needed at runtime



---

archive/issue_comments_458903.json:
```json
{
    "body": "<a id='comment:13'></a>cc:ing maintainer of the user-facing Docker image",
    "created_at": "2022-05-12T23:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>cc:ing maintainer of the user-facing Docker image



---

archive/issue_comments_458904.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-21T22:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_458905.json:
```json
{
    "body": "<a id='comment:16'></a>\u200bhttps://groups.google.com/g/sage-devel/c/0GV8_O1VwbI (May 2022) only received positive responses, so let's get this in please",
    "created_at": "2022-07-21T22:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458905",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>â€‹https://groups.google.com/g/sage-devel/c/0GV8_O1VwbI (May 2022) only received positive responses, so let's get this in please



---

archive/issue_comments_458906.json:
```json
{
    "body": "<a id='comment:18'></a>Would it be possible to handle Cython files the same way Python files are handled?\n\nSome timings on my creaky old laptop:\n\n- with this branch, if I change `quaternion_algebra_cython.pyx` and run `make build`: it takes about 70 seconds.\n- with this branch, if I change nothing and run `make build`, it takes about 60 seconds.\n- with the `develop` branch, if I change `quaternion_algebra_cython.pyx`, `make build` takes about 35 seconds.\n- with the `develop` branch, if I change nothing, `make build` takes about 30 seconds.\n\nSo this change does have a cost. Presumably it's not as large a difference on a faster computer.",
    "created_at": "2022-07-22T00:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458906",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>Would it be possible to handle Cython files the same way Python files are handled?

Some timings on my creaky old laptop:

- with this branch, if I change `quaternion_algebra_cython.pyx` and run `make build`: it takes about 70 seconds.
- with this branch, if I change nothing and run `make build`, it takes about 60 seconds.
- with the `develop` branch, if I change `quaternion_algebra_cython.pyx`, `make build` takes about 35 seconds.
- with the `develop` branch, if I change nothing, `make build` takes about 30 seconds.

So this change does have a cost. Presumably it's not as large a difference on a faster computer.



---

archive/issue_comments_458907.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 jhpalmieri]:\n> Would it be possible to handle Cython files the same way Python files are handled?\n\n\nNo, they need to be compiled",
    "created_at": "2022-07-22T00:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Replying to [comment:18 jhpalmieri]:
> Would it be possible to handle Cython files the same way Python files are handled?


No, they need to be compiled



---

archive/issue_comments_458908.json:
```json
{
    "body": "<a id='comment:20'></a>I'll check where the speed difference is coming from",
    "created_at": "2022-07-22T00:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>I'll check where the speed difference is coming from



---

archive/issue_comments_458909.json:
```json
{
    "body": "<a id='comment:21'></a>I can confirm that it is slower with `--enable-editable`, but the difference is much smaller on my machine. Typical timings of `make sagelib-no-deps`:\n\nWith `./configure --enable-editable` (= new default):\n- no change: `make sagelib-no-deps  25.19s user 9.92s system 98% cpu 35.817 total`\n- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  21.77s user 8.55s system 97% cpu 31.039 total`\nWith `./configure --disable-editable` (= same as default on the `develop` branch):\n- no change: `make sagelib-no-deps  16.72s user 7.43s system 91% cpu 26.297 total`\n- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  18.00s user 7.74s system 91% cpu 28.023 total`",
    "created_at": "2022-07-22T01:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>I can confirm that it is slower with `--enable-editable`, but the difference is much smaller on my machine. Typical timings of `make sagelib-no-deps`:

With `./configure --enable-editable` (= new default):
- no change: `make sagelib-no-deps  25.19s user 9.92s system 98% cpu 35.817 total`
- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  21.77s user 8.55s system 97% cpu 31.039 total`
With `./configure --disable-editable` (= same as default on the `develop` branch):
- no change: `make sagelib-no-deps  16.72s user 7.43s system 91% cpu 26.297 total`
- after `touch src/sage/algebras/quaternion_algebra_cython.pyx`: `make sagelib-no-deps  18.00s user 7.74s system 91% cpu 28.023 total`



---

archive/issue_comments_458910.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-22T01:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458911.json:
```json
{
    "body": "<a id='comment:23'></a>It's faster now",
    "created_at": "2022-07-22T01:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>It's faster now



---

archive/issue_comments_458912.json:
```json
{
    "body": "<a id='comment:24'></a>Yes, it is indeed faster, and the timing is not very different whether I change a single file or don't change anything.\n\nI feel like, in a perfect world, Sage upon startup would automatically detect if it had to recompile because of a change to a Cython file, and conversely, 'sage -b' would be a no-op if no files had been changed. But if that's possible, it's for another ticket.",
    "created_at": "2022-07-22T17:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458912",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>Yes, it is indeed faster, and the timing is not very different whether I change a single file or don't change anything.

I feel like, in a perfect world, Sage upon startup would automatically detect if it had to recompile because of a change to a Cython file, and conversely, 'sage -b' would be a no-op if no files had been changed. But if that's possible, it's for another ticket.



---

archive/issue_comments_458913.json:
```json
{
    "body": "<a id='comment:25'></a>We can probably add a check for that to display a hint (in a follow-up ticket), but it would be very nonstandard to recompile automatically. I've added this idea to #31406",
    "created_at": "2022-07-22T17:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458913",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>We can probably add a check for that to display a hint (in a follow-up ticket), but it would be very nonstandard to recompile automatically. I've added this idea to #31406



---

archive/issue_comments_458914.json:
```json
{
    "body": "<a id='comment:27'></a>I think a recompile hint would be great!\n\nHow many more eyes do we need on this before a positive review? It feels like a major change, but it also feels like it's a simplification.",
    "created_at": "2022-07-22T18:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458914",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>I think a recompile hint would be great!

How many more eyes do we need on this before a positive review? It feels like a major change, but it also feels like it's a simplification.



---

archive/issue_comments_458915.json:
```json
{
    "body": "<a id='comment:28'></a>It's well tested already, and if anything goes wrong there's the easy recourse of using `configure --disable-editable`",
    "created_at": "2022-07-22T18:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458915",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>It's well tested already, and if anything goes wrong there's the easy recourse of using `configure --disable-editable`



---

archive/issue_comments_458916.json:
```json
{
    "body": "<a id='comment:29'></a>I'll give it a bit more time in case others want to chime in. If no one responds, I'll set it to positive review later.",
    "created_at": "2022-07-22T18:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458916",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>I'll give it a bit more time in case others want to chime in. If no one responds, I'll set it to positive review later.



---

archive/issue_comments_458917.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-23T18:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458917",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458918.json:
```json
{
    "body": "<a id='comment:33'></a>Thanks!",
    "created_at": "2022-07-23T18:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Thanks!



---

archive/issue_comments_458919.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32406#issuecomment-458919",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_085984.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-01T20:23:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32406",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32406#event-85984"
}
```
