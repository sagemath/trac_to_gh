# Issue 32174: doctests: Detect "safe" external features even if "--optional=external" is not used

archive/issues_031937.json:
```json
{
    "body": "(from #30887#comment:28)\n\nFor some \"safe\" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. \n\nLikewise for the `PythonModule` features for Sage modules introduced in #32614. By delaying the test for these features, using the `sage.doctest.external` machinery, we fix the broken detection of some of these features. (This is why the ticket is marked \"critical\".)\n\nThis is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)\n\nWith this ticket, more doctests will be run by default. This may lead to new failures (discovered by patchbot for instance). But that does not mean it is introduced in this ticket, just that they were existing before this ticket, but simply not executed.\n\nFor example, let's compare the behavior of the following command:\n\n```\nsage -tp --show-skipped src/sage/tests/cmdline.py \n```\n\nreturns:\n\nBEFORE (9.5.beta7):\n\n```\nGit branch: develop\nUsing --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg\nDoctesting 1 file using 8 threads.\nsage -t --random-seed=265206128165572261397002909756599539048 src/sage/tests/cmdline.py\n    3 gdb tests not run\n    12 internet tests not run\n    2 pandoc tests not run\n    4 r tests not run\n    0 tests not run because we ran out of time\n    [235 tests, 30.65 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n\nAFTER (9.5.beta7 + #32174):\n\n```\n$ sage -tp --show-skipped src/sage/tests/cmdline.py \nGit branch: 32174\nUsing --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib\nDoctesting 1 file using 8 threads.\nsage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 732, in sage.tests.cmdline.test_executable\nFailed example:\n    print(open(output, 'r').read() == t)          # optional - pandoc\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of 238 in sage.tests.cmdline.test_executable\n    3 gdb tests not run\n    12 internet tests not run\n    4 r tests not run\n    0 tests not run because we ran out of time\n    [237 tests, 1 failure, 32.76 s]\n----------------------------------------------------------------------\nsage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py  # 1 doctest failed\n----------------------------------------------------------------------\nFeatures detected for doctesting: pandoc\n```\n\nWe observe that the number of tests run went from 235 to 237, because the feature pandoc was detected. Note that the doctest failure is already tracked at #32697.\n\nCC:  @dimpase @slel @antonio-rojas @kiwifb @kwankyu @seblabbe @videlec\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Matthias Koeppe, S\u00e9bastien Labb\u00e9\n\nBranch: 41c4cd4917a1f513f995054da47b30edf19ddad1\n\nDependencies: #32866, #27744\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32174\n\n",
    "closed_at": "2021-12-19T11:46:49Z",
    "created_at": "2021-07-10T18:34:16Z",
    "labels": [
        "component: doctest framework",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "doctests: Detect \"safe\" external features even if \"--optional=external\" is not used",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32174",
    "user": "https://github.com/mkoeppe"
}
```
(from #30887#comment:28)

For some "safe" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. 

Likewise for the `PythonModule` features for Sage modules introduced in #32614. By delaying the test for these features, using the `sage.doctest.external` machinery, we fix the broken detection of some of these features. (This is why the ticket is marked "critical".)

This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)

With this ticket, more doctests will be run by default. This may lead to new failures (discovered by patchbot for instance). But that does not mean it is introduced in this ticket, just that they were existing before this ticket, but simply not executed.

For example, let's compare the behavior of the following command:

```
sage -tp --show-skipped src/sage/tests/cmdline.py 
```

returns:

BEFORE (9.5.beta7):

```
Git branch: develop
Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg
Doctesting 1 file using 8 threads.
sage -t --random-seed=265206128165572261397002909756599539048 src/sage/tests/cmdline.py
    3 gdb tests not run
    12 internet tests not run
    2 pandoc tests not run
    4 r tests not run
    0 tests not run because we ran out of time
    [235 tests, 30.65 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

AFTER (9.5.beta7 + #32174):

```
$ sage -tp --show-skipped src/sage/tests/cmdline.py 
Git branch: 32174
Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib
Doctesting 1 file using 8 threads.
sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 732, in sage.tests.cmdline.test_executable
Failed example:
    print(open(output, 'r').read() == t)          # optional - pandoc
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of 238 in sage.tests.cmdline.test_executable
    3 gdb tests not run
    12 internet tests not run
    4 r tests not run
    0 tests not run because we ran out of time
    [237 tests, 1 failure, 32.76 s]
----------------------------------------------------------------------
sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py  # 1 doctest failed
----------------------------------------------------------------------
Features detected for doctesting: pandoc
```

We observe that the number of tests run went from 235 to 237, because the feature pandoc was detected. Note that the doctest failure is already tracked at #32697.

CC:  @dimpase @slel @antonio-rojas @kiwifb @kwankyu @seblabbe @videlec

Reviewer: Sébastien Labbé

Author: Matthias Koeppe, Sébastien Labbé

Branch: 41c4cd4917a1f513f995054da47b30edf19ddad1

Dependencies: #32866, #27744

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32174





---

archive/issue_events_103767.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32174#event-103767"
}
```



---

archive/issue_comments_632500.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,7 @@\n \n For some \"safe\" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. \n \n+Likewise for the `PythonModule` features for Sage modules introduced in #32614.\n+\n This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)\n \n``````\n",
    "created_at": "2021-10-02T23:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632500",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,7 @@
 
 For some "safe" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. 
 
+Likewise for the `PythonModule` features for Sage modules introduced in #32614.
+
 This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)
 
``````




---

archive/issue_comments_632501.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32649\"",
    "created_at": "2021-10-07T18:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632501",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32649"



---

archive/issue_comments_632502.json:
```json
{
    "body": "Changing dependencies from \"#32649\" to \"#32649, #32614\"",
    "created_at": "2021-10-07T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632502",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32649" to "#32649, #32614"



---

archive/issue_comments_632503.json:
```json
{
    "body": "<a id='comment:5'></a>\nLet's use this ticket to address the problem discovered in #32732#comment:10: Detection of Sage modules fails because the check runs before `sage.all` has been imported, and is therefore affected by import failures from cyclic imports",
    "created_at": "2021-10-22T20:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632503",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Let's use this ticket to address the problem discovered in #32732#comment:10: Detection of Sage modules fails because the check runs before `sage.all` has been imported, and is therefore affected by import failures from cyclic imports



---

archive/issue_comments_632504.json:
```json
{
    "body": "Changing dependencies from \"#32649, #32614\" to \"#32732\"",
    "created_at": "2021-10-22T20:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632504",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32649, #32614" to "#32732"



---

archive/issue_comments_632505.json:
```json
{
    "body": "Changing dependencies from \"#32732\" to \"#32732, #32650\"",
    "created_at": "2021-11-08T05:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632505",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32732" to "#32732, #32650"



---

archive/issue_comments_632506.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/doctests__detect__safe__external_features_even_if____optional_external__is_not_used\"",
    "created_at": "2021-11-11T02:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632506",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/doctests__detect__safe__external_features_even_if____optional_external__is_not_used"



---

archive/issue_comments_632507.json:
```json
{
    "body": "<a id='comment:9'></a>\nHere's an approach to do feature enumeration\n\n---\nLast 10 new commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[5d9414d](https://github.com/sagemath/sagetrac-mirror/commit/5d9414ddc4ec72d6b32ac88e9aa94a0fe2433dab)|`32650: .. note -> .. NOTE`|\n|[345c760](https://github.com/sagemath/sagetrac-mirror/commit/345c760b9e2e31829b995ddbb7b58bb7ce531624)|`32650: using features in has_latex method of doctest/external.py`|\n|[6c6b332](https://github.com/sagemath/sagetrac-mirror/commit/6c6b3325a0927ae00b773b34c63cd7db9c7589f4)|`32650: independent and improved method latex().is_functional()`|\n|[63555d2](https://github.com/sagemath/sagetrac-mirror/commit/63555d2ee5280e83f14cd207a5d20d4fff3abc5a)|`32650: adding spkg pdf2svg in build/pkgs`|\n|[c8330fe](https://github.com/sagemath/sagetrac-mirror/commit/c8330fe39151df1bed83de2bfdb3376e419efc30)|`32650: linking pdf2svg feature to spkg pdf2svg`|\n|[2ea4d9e](https://github.com/sagemath/sagetrac-mirror/commit/2ea4d9eaa99477cc248fd10bb049925d32806c1a)|`32650: fixing two doctests now that we latex().require() it when we use it`|\n|[98b7db6](https://github.com/sagemath/sagetrac-mirror/commit/98b7db64579b3f7168130dee8bc11639e7ffda4d)|`Merge #32650`|\n|[0968f95](https://github.com/sagemath/sagetrac-mirror/commit/0968f950eee4e5b1de196e8ccb22c194983f33ad)|`sage.features.sagemath.all_features: New`|\n|[cdc0cb6](https://github.com/sagemath/sagetrac-mirror/commit/cdc0cb6fc1c94d048eab6beab243199f6114f46e)|`sage.features.all: New`|\n|[c8e6c0e](https://github.com/sagemath/sagetrac-mirror/commit/c8e6c0eb147a21974c9926fe5ad99b31a850c8a9)|`sage.features.bliss.all_features: New`|",
    "created_at": "2021-11-11T02:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632507",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Here's an approach to do feature enumeration

---
Last 10 new commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[5d9414d](https://github.com/sagemath/sagetrac-mirror/commit/5d9414ddc4ec72d6b32ac88e9aa94a0fe2433dab)|`32650: .. note -> .. NOTE`|
|[345c760](https://github.com/sagemath/sagetrac-mirror/commit/345c760b9e2e31829b995ddbb7b58bb7ce531624)|`32650: using features in has_latex method of doctest/external.py`|
|[6c6b332](https://github.com/sagemath/sagetrac-mirror/commit/6c6b3325a0927ae00b773b34c63cd7db9c7589f4)|`32650: independent and improved method latex().is_functional()`|
|[63555d2](https://github.com/sagemath/sagetrac-mirror/commit/63555d2ee5280e83f14cd207a5d20d4fff3abc5a)|`32650: adding spkg pdf2svg in build/pkgs`|
|[c8330fe](https://github.com/sagemath/sagetrac-mirror/commit/c8330fe39151df1bed83de2bfdb3376e419efc30)|`32650: linking pdf2svg feature to spkg pdf2svg`|
|[2ea4d9e](https://github.com/sagemath/sagetrac-mirror/commit/2ea4d9eaa99477cc248fd10bb049925d32806c1a)|`32650: fixing two doctests now that we latex().require() it when we use it`|
|[98b7db6](https://github.com/sagemath/sagetrac-mirror/commit/98b7db64579b3f7168130dee8bc11639e7ffda4d)|`Merge #32650`|
|[0968f95](https://github.com/sagemath/sagetrac-mirror/commit/0968f950eee4e5b1de196e8ccb22c194983f33ad)|`sage.features.sagemath.all_features: New`|
|[cdc0cb6](https://github.com/sagemath/sagetrac-mirror/commit/cdc0cb6fc1c94d048eab6beab243199f6114f46e)|`sage.features.all: New`|
|[c8e6c0e](https://github.com/sagemath/sagetrac-mirror/commit/c8e6c0eb147a21974c9926fe5ad99b31a850c8a9)|`sage.features.bliss.all_features: New`|



---

archive/issue_comments_632508.json:
```json
{
    "body": "Changing commit from \"\" to \"c8e6c0eb147a21974c9926fe5ad99b31a850c8a9\"",
    "created_at": "2021-11-11T02:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632508",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "c8e6c0eb147a21974c9926fe5ad99b31a850c8a9"



---

archive/issue_comments_632509.json:
```json
{
    "body": "Changing commit from \"c8e6c0eb147a21974c9926fe5ad99b31a850c8a9\" to \"69d2cfbd7914f8e64c9648492f19847034ee5e60\"",
    "created_at": "2021-11-11T03:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c8e6c0eb147a21974c9926fe5ad99b31a850c8a9" to "69d2cfbd7914f8e64c9648492f19847034ee5e60"



---

archive/issue_comments_632510.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[69d2cfb](https://github.com/sagemath/sagetrac-mirror/commit/69d2cfbd7914f8e64c9648492f19847034ee5e60)|`src/sage/features/kenzo.py: Move import from sage.libs.ecl into method`|",
    "created_at": "2021-11-11T03:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[69d2cfb](https://github.com/sagemath/sagetrac-mirror/commit/69d2cfbd7914f8e64c9648492f19847034ee5e60)|`src/sage/features/kenzo.py: Move import from sage.libs.ecl into method`|



---

archive/issue_comments_632511.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe, ...\"",
    "created_at": "2021-11-11T04:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632511",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe, ..."



---

archive/issue_comments_632512.json:
```json
{
    "body": "<a id='comment:12'></a>\nIndent `.. NOTE::` blocks 4 spaces, not 3\n(can be a follow-up ticket).",
    "created_at": "2021-11-13T13:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632512",
    "user": "https://github.com/slel"
}
```

<a id='comment:12'></a>
Indent `.. NOTE::` blocks 4 spaces, not 3
(can be a follow-up ticket).



---

archive/issue_comments_632513.json:
```json
{
    "body": "Changing commit from \"69d2cfbd7914f8e64c9648492f19847034ee5e60\" to \"893ec23c44ae4c85c4297f2b06ccb102673e8582\"",
    "created_at": "2021-11-13T18:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69d2cfbd7914f8e64c9648492f19847034ee5e60" to "893ec23c44ae4c85c4297f2b06ccb102673e8582"



---

archive/issue_comments_632514.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[fa45c36](https://github.com/sagemath/sagetrac-mirror/commit/fa45c36e6009c1bafaed18efb75eaac975ab6aa3)|`sage.features.sagemath.all_features: New`|\n|[17e30e2](https://github.com/sagemath/sagetrac-mirror/commit/17e30e2660400b7825e0a14c10b09da5458bb59d)|`sage.features.all: New`|\n|[8bfebc9](https://github.com/sagemath/sagetrac-mirror/commit/8bfebc9c04fc997d2595babb9cc2f78df4184b2c)|`sage.features.bliss.all_features: New`|\n|[893ec23](https://github.com/sagemath/sagetrac-mirror/commit/893ec23c44ae4c85c4297f2b06ccb102673e8582)|`src/sage/features/kenzo.py: Move import from sage.libs.ecl into method`|",
    "created_at": "2021-11-13T18:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[fa45c36](https://github.com/sagemath/sagetrac-mirror/commit/fa45c36e6009c1bafaed18efb75eaac975ab6aa3)|`sage.features.sagemath.all_features: New`|
|[17e30e2](https://github.com/sagemath/sagetrac-mirror/commit/17e30e2660400b7825e0a14c10b09da5458bb59d)|`sage.features.all: New`|
|[8bfebc9](https://github.com/sagemath/sagetrac-mirror/commit/8bfebc9c04fc997d2595babb9cc2f78df4184b2c)|`sage.features.bliss.all_features: New`|
|[893ec23](https://github.com/sagemath/sagetrac-mirror/commit/893ec23c44ae4c85c4297f2b06ccb102673e8582)|`src/sage/features/kenzo.py: Move import from sage.libs.ecl into method`|



---

archive/issue_comments_632515.json:
```json
{
    "body": "Changing dependencies from \"#32732, #32650\" to \"#32866\"",
    "created_at": "2021-11-13T19:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632515",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32732, #32650" to "#32866"



---

archive/issue_comments_632516.json:
```json
{
    "body": "<a id='comment:14'></a>\nRebased on 9.5.beta6",
    "created_at": "2021-11-13T19:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632516",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Rebased on 9.5.beta6



---

archive/issue_comments_632517.json:
```json
{
    "body": "Changing commit from \"893ec23c44ae4c85c4297f2b06ccb102673e8582\" to \"fa25155f55cadf4424dd561586b111e4183e2d50\"",
    "created_at": "2021-11-14T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "893ec23c44ae4c85c4297f2b06ccb102673e8582" to "fa25155f55cadf4424dd561586b111e4183e2d50"



---

archive/issue_comments_632518.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[eaec400](https://github.com/sagemath/sagetrac-mirror/commit/eaec4000ec31e884e8e152efbd88e1b15ff3c5a3)|`src/sage/features/interfaces.py: New`|\n|[827ca03](https://github.com/sagemath/sagetrac-mirror/commit/827ca0339457bc5596fce9cb46aefc7fe8d6e002)|`src/sage/features/interfaces.py: Fix and doctest exception handling`|\n|[52ac51e](https://github.com/sagemath/sagetrac-mirror/commit/52ac51efe425371ab7aab08d3eb964bf4c90cd4c)|`src/sage/features/interfaces.py (all_features): New`|\n|[7754fae](https://github.com/sagemath/sagetrac-mirror/commit/7754fae5f46ef3ad9fc2c9c3bfd2a2dac3f76f11)|`src/sage/features/interfaces.py: Fix and doctest exception handling (fixup)`|\n|[8081f29](https://github.com/sagemath/sagetrac-mirror/commit/8081f29f97a947e39b8ef17e861433847e623dcd)|`src/sage/doctest/external.py: Use sage.features.interfaces`|\n|[09c4238](https://github.com/sagemath/sagetrac-mirror/commit/09c42384b842dc6fdb468846c61164b727f95f62)|`Merge #32866`|\n|[c41808b](https://github.com/sagemath/sagetrac-mirror/commit/c41808ba23b81ac2c930fb77ea9ded20a7b7d770)|`src/sage/features/latex.py (all_features): New`|\n|[44c19e3](https://github.com/sagemath/sagetrac-mirror/commit/44c19e3145fb47c7d977a326020ecf2be3298776)|`src/sage/features/mip_backends.py (all_features): New`|\n|[fa25155](https://github.com/sagemath/sagetrac-mirror/commit/fa25155f55cadf4424dd561586b111e4183e2d50)|`src/sage/doctest/external.py (external_software): Go through external_features`|",
    "created_at": "2021-11-14T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[eaec400](https://github.com/sagemath/sagetrac-mirror/commit/eaec4000ec31e884e8e152efbd88e1b15ff3c5a3)|`src/sage/features/interfaces.py: New`|
|[827ca03](https://github.com/sagemath/sagetrac-mirror/commit/827ca0339457bc5596fce9cb46aefc7fe8d6e002)|`src/sage/features/interfaces.py: Fix and doctest exception handling`|
|[52ac51e](https://github.com/sagemath/sagetrac-mirror/commit/52ac51efe425371ab7aab08d3eb964bf4c90cd4c)|`src/sage/features/interfaces.py (all_features): New`|
|[7754fae](https://github.com/sagemath/sagetrac-mirror/commit/7754fae5f46ef3ad9fc2c9c3bfd2a2dac3f76f11)|`src/sage/features/interfaces.py: Fix and doctest exception handling (fixup)`|
|[8081f29](https://github.com/sagemath/sagetrac-mirror/commit/8081f29f97a947e39b8ef17e861433847e623dcd)|`src/sage/doctest/external.py: Use sage.features.interfaces`|
|[09c4238](https://github.com/sagemath/sagetrac-mirror/commit/09c42384b842dc6fdb468846c61164b727f95f62)|`Merge #32866`|
|[c41808b](https://github.com/sagemath/sagetrac-mirror/commit/c41808ba23b81ac2c930fb77ea9ded20a7b7d770)|`src/sage/features/latex.py (all_features): New`|
|[44c19e3](https://github.com/sagemath/sagetrac-mirror/commit/44c19e3145fb47c7d977a326020ecf2be3298776)|`src/sage/features/mip_backends.py (all_features): New`|
|[fa25155](https://github.com/sagemath/sagetrac-mirror/commit/fa25155f55cadf4424dd561586b111e4183e2d50)|`src/sage/doctest/external.py (external_software): Go through external_features`|



---

archive/issue_comments_632519.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[945132b](https://github.com/sagemath/sagetrac-mirror/commit/945132b9524a6734957e70a00830b6db07f74b65)|`src/sage/features/interfaces.py: Fix up`|\n|[f63acfd](https://github.com/sagemath/sagetrac-mirror/commit/f63acfd4bf36719d749f7f3edfd351282f89a0ca)|`Merge #32866`|\n|[7fa5b3b](https://github.com/sagemath/sagetrac-mirror/commit/7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300)|`src/sage/doctest/external.py (external_features): Add CPLEX, Gurobi`|",
    "created_at": "2021-11-14T22:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[945132b](https://github.com/sagemath/sagetrac-mirror/commit/945132b9524a6734957e70a00830b6db07f74b65)|`src/sage/features/interfaces.py: Fix up`|
|[f63acfd](https://github.com/sagemath/sagetrac-mirror/commit/f63acfd4bf36719d749f7f3edfd351282f89a0ca)|`Merge #32866`|
|[7fa5b3b](https://github.com/sagemath/sagetrac-mirror/commit/7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300)|`src/sage/doctest/external.py (external_features): Add CPLEX, Gurobi`|



---

archive/issue_comments_632520.json:
```json
{
    "body": "Changing commit from \"fa25155f55cadf4424dd561586b111e4183e2d50\" to \"7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300\"",
    "created_at": "2021-11-14T22:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fa25155f55cadf4424dd561586b111e4183e2d50" to "7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300"



---

archive/issue_comments_632521.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe `has_...` functions are now no longer needed.\n\nDeprecate them? Or just remove them?",
    "created_at": "2021-11-14T22:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632521",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
The `has_...` functions are now no longer needed.

Deprecate them? Or just remove them?



---

archive/issue_comments_632522.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\n|[132f00d](https://github.com/sagemath/sagetrac-mirror/commit/132f00dfbe947bb3898debb5ccf659b728624fb9)|`sage.doctest.{control,external}: Detect optional tags via AvailableSoftware`|",
    "created_at": "2021-11-14T23:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632522",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|[132f00d](https://github.com/sagemath/sagetrac-mirror/commit/132f00dfbe947bb3898debb5ccf659b728624fb9)|`sage.doctest.{control,external}: Detect optional tags via AvailableSoftware`|



---

archive/issue_comments_632523.json:
```json
{
    "body": "Changing commit from \"7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300\" to \"132f00dfbe947bb3898debb5ccf659b728624fb9\"",
    "created_at": "2021-11-14T23:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7fa5b3bf93c320f0d0d388b7c7c240dfe51d8300" to "132f00dfbe947bb3898debb5ccf659b728624fb9"



---

archive/issue_comments_632524.json:
```json
{
    "body": "<a id='comment:19'></a>\nHere's a version that seems to work.",
    "created_at": "2021-11-14T23:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632524",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Here's a version that seems to work.



---

archive/issue_comments_632525.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|\n|[68b3d41](https://github.com/sagemath/sagetrac-mirror/commit/68b3d4186903d2d215b709bb17c55979ac4353b1)|`src/sage/doctest/external.py (external_features): Rewrite as generator, add doctest`|",
    "created_at": "2021-11-15T00:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|[68b3d41](https://github.com/sagemath/sagetrac-mirror/commit/68b3d4186903d2d215b709bb17c55979ac4353b1)|`src/sage/doctest/external.py (external_features): Rewrite as generator, add doctest`|



---

archive/issue_comments_632526.json:
```json
{
    "body": "Changing commit from \"132f00dfbe947bb3898debb5ccf659b728624fb9\" to \"68b3d4186903d2d215b709bb17c55979ac4353b1\"",
    "created_at": "2021-11-15T00:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "132f00dfbe947bb3898debb5ccf659b728624fb9" to "68b3d4186903d2d215b709bb17c55979ac4353b1"



---

archive/issue_comments_632527.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe, ...\" to \"Matthias Koeppe\"",
    "created_at": "2021-11-15T04:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632527",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe, ..." to "Matthias Koeppe"



---

archive/issue_comments_632528.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-15T04:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632528",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_632529.json:
```json
{
    "body": "<a id='comment:22'></a>\nIs the ticket description still valid? This doesn't do anything for me unless I explicitly pass `--optional=external`",
    "created_at": "2021-11-15T07:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632529",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:22'></a>
Is the ticket description still valid? This doesn't do anything for me unless I explicitly pass `--optional=external`



---

archive/issue_comments_632530.json:
```json
{
    "body": "<a id='comment:23'></a>\nAt the end of the tests it should print a line \"Features detected for doctesting\"",
    "created_at": "2021-11-15T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632530",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
At the end of the tests it should print a line "Features detected for doctesting"



---

archive/issue_comments_632531.json:
```json
{
    "body": "<a id='comment:24'></a>\nYes, but it doesn't detect anything if I don't use `--optional=external`:\n\n```\n> sage -t --optional=sage /usr/lib/python3.9/site-packages/sage/features/imagemagick.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-11-15-18-40-01-8b3be5fc.\nUsing --optional=sage\nExternal software to be detected: 4ti2,cplex,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,lualatex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,pdf2svg,pdflatex,rubiks,scilab,xelatex\nDoctesting 1 file.\nsage -t --random-seed=283871835415461728632029979826455200075 /usr/lib/python3.9/site-packages/sage/features/imagemagick.py\n    [3 tests, 0.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nFeatures detected for doctesting: \nPytest is not installed, skip checking tests that rely on it.\n```\ndoesn't detect imagemagick, but\n\n```\n> sage -t --optional=sage,external /usr/lib/python3.9/site-packages/sage/features/imagemagick.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-11-15-18-39-46-a52ab438.\nUsing --optional=external,sage\nExternal software to be detected: 4ti2,cplex,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,lualatex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,pdf2svg,pdflatex,rubiks,scilab,xelatex\nDoctesting 1 file.\nsage -t --random-seed=59814167025539044529043021967633197695 /usr/lib/python3.9/site-packages/sage/features/imagemagick.py\n    [4 tests, 0.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nFeatures detected for doctesting: imagemagick\nPytest is not installed, skip checking tests that rely on it.\n```\ndoes",
    "created_at": "2021-11-15T17:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632531",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:24'></a>
Yes, but it doesn't detect anything if I don't use `--optional=external`:

```
> sage -t --optional=sage /usr/lib/python3.9/site-packages/sage/features/imagemagick.py
too many failed tests, not using stored timings
Running doctests with ID 2021-11-15-18-40-01-8b3be5fc.
Using --optional=sage
External software to be detected: 4ti2,cplex,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,lualatex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,pdf2svg,pdflatex,rubiks,scilab,xelatex
Doctesting 1 file.
sage -t --random-seed=283871835415461728632029979826455200075 /usr/lib/python3.9/site-packages/sage/features/imagemagick.py
    [3 tests, 0.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
Features detected for doctesting: 
Pytest is not installed, skip checking tests that rely on it.
```
doesn't detect imagemagick, but

```
> sage -t --optional=sage,external /usr/lib/python3.9/site-packages/sage/features/imagemagick.py
too many failed tests, not using stored timings
Running doctests with ID 2021-11-15-18-39-46-a52ab438.
Using --optional=external,sage
External software to be detected: 4ti2,cplex,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,lualatex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,pdf2svg,pdflatex,rubiks,scilab,xelatex
Doctesting 1 file.
sage -t --random-seed=59814167025539044529043021967633197695 /usr/lib/python3.9/site-packages/sage/features/imagemagick.py
    [4 tests, 0.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
Features detected for doctesting: imagemagick
Pytest is not installed, skip checking tests that rely on it.
```
does



---

archive/issue_comments_632532.json:
```json
{
    "body": "Changing commit from \"68b3d4186903d2d215b709bb17c55979ac4353b1\" to \"6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f\"",
    "created_at": "2021-11-15T17:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "68b3d4186903d2d215b709bb17c55979ac4353b1" to "6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f"



---

archive/issue_comments_632533.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[6f2d22b](https://github.com/sagemath/sagetrac-mirror/commit/6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f)|`src/sage/doctest/external.py: Declare pandoc, graphviz, ffmpeg, imagemagick, dvipng, pdf2svg, rubiks, 4ti2 feature tests safe (do not require 'external' to test them)`|",
    "created_at": "2021-11-15T17:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[6f2d22b](https://github.com/sagemath/sagetrac-mirror/commit/6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f)|`src/sage/doctest/external.py: Declare pandoc, graphviz, ffmpeg, imagemagick, dvipng, pdf2svg, rubiks, 4ti2 feature tests safe (do not require 'external' to test them)`|



---

archive/issue_comments_632534.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks. Should work now",
    "created_at": "2021-11-15T17:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632534",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Thanks. Should work now



---

archive/issue_comments_632535.json:
```json
{
    "body": "Changing commit from \"6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f\" to \"2f50385550e03e6f02d1432864be5dba559b081e\"",
    "created_at": "2021-11-15T18:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6f2d22bebad1f9c043499bdc0a5fea6406ac6c7f" to "2f50385550e03e6f02d1432864be5dba559b081e"



---

archive/issue_comments_632536.json:
```json
{
    "body": "<a id='comment:27'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[2f50385](https://github.com/sagemath/sagetrac-mirror/commit/2f50385550e03e6f02d1432864be5dba559b081e)|`src/sage/features/: Add more all_features functions`|",
    "created_at": "2021-11-15T18:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[2f50385](https://github.com/sagemath/sagetrac-mirror/commit/2f50385550e03e6f02d1432864be5dba559b081e)|`src/sage/features/: Add more all_features functions`|



---

archive/issue_comments_632537.json:
```json
{
    "body": "Changing commit from \"2f50385550e03e6f02d1432864be5dba559b081e\" to \"e2cda415abc4c5af6fea8e4739016d877414091e\"",
    "created_at": "2021-11-15T18:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2f50385550e03e6f02d1432864be5dba559b081e" to "e2cda415abc4c5af6fea8e4739016d877414091e"



---

archive/issue_comments_632538.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|\n|[e2cda41](https://github.com/sagemath/sagetrac-mirror/commit/e2cda415abc4c5af6fea8e4739016d877414091e)|`src/sage/features/: Add remaining missing all_features functions`|",
    "created_at": "2021-11-15T18:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
|[e2cda41](https://github.com/sagemath/sagetrac-mirror/commit/e2cda415abc4c5af6fea8e4739016d877414091e)|`src/sage/features/: Add remaining missing all_features functions`|



---

archive/issue_comments_632539.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [mkoeppe](#comment%3A26):\n> Thanks. Should work now\n\n\nConfirmed. But now, running, `sage -t` without `--optional=external` displays \n\n```\nExternal software to be detected: cplex,gurobi,internet,macaulay2,magma,maple,mathematica,matlab,octave,scilab\n```\nwhich is kind of misleading, as these are precisely the packages that are *not* autodetected in that case.",
    "created_at": "2021-11-15T18:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632539",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:29'></a>
Replying to [mkoeppe](#comment%3A26):
> Thanks. Should work now


Confirmed. But now, running, `sage -t` without `--optional=external` displays 

```
External software to be detected: cplex,gurobi,internet,macaulay2,magma,maple,mathematica,matlab,octave,scilab
```
which is kind of misleading, as these are precisely the packages that are *not* autodetected in that case.



---

archive/issue_comments_632540.json:
```json
{
    "body": "<a id='comment:30'></a>\nThanks for testing. Good point, I'll make that clearer",
    "created_at": "2021-11-15T18:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632540",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Thanks for testing. Good point, I'll make that clearer



---

archive/issue_comments_632541.json:
```json
{
    "body": "<a id='comment:31'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|\n|[c4deceb](https://github.com/sagemath/sagetrac-mirror/commit/c4deceb2babdadafc3044bb5918c1f8a4467c82e)|`src/sage/doctest/control.py: Replace use of 'external_software' by new method 'available_software.detectable()'`|",
    "created_at": "2021-11-15T18:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|[c4deceb](https://github.com/sagemath/sagetrac-mirror/commit/c4deceb2babdadafc3044bb5918c1f8a4467c82e)|`src/sage/doctest/control.py: Replace use of 'external_software' by new method 'available_software.detectable()'`|



---

archive/issue_comments_632542.json:
```json
{
    "body": "Changing commit from \"e2cda415abc4c5af6fea8e4739016d877414091e\" to \"c4deceb2babdadafc3044bb5918c1f8a4467c82e\"",
    "created_at": "2021-11-15T18:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e2cda415abc4c5af6fea8e4739016d877414091e" to "c4deceb2babdadafc3044bb5918c1f8a4467c82e"



---

archive/issue_comments_632543.json:
```json
{
    "body": "Changing dependencies from \"#32866\" to \"#32866, #27744\"",
    "created_at": "2021-11-15T22:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632543",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32866" to "#32866, #27744"



---

archive/issue_comments_632544.json:
```json
{
    "body": "Changing commit from \"c4deceb2babdadafc3044bb5918c1f8a4467c82e\" to \"b8f0a107bd1bc621ecf5d7cacddae0e2110b8427\"",
    "created_at": "2021-11-15T22:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c4deceb2babdadafc3044bb5918c1f8a4467c82e" to "b8f0a107bd1bc621ecf5d7cacddae0e2110b8427"



---

archive/issue_comments_632545.json:
```json
{
    "body": "<a id='comment:33'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[23f5009](https://github.com/sagemath/sagetrac-mirror/commit/23f50092bf4af21742e834ef7b908102c85af4d8)|`sage.features.normaliz: New`|\n|[0b65b79](https://github.com/sagemath/sagetrac-mirror/commit/0b65b799ed5bc66fed7e1e39c1a07980a3a08616)|`src/sage/features/normaliz.py: Fix up`|\n|[00cb9c7](https://github.com/sagemath/sagetrac-mirror/commit/00cb9c7fe2e9dacb1270d556e51b2a8e08bf92f4)|`src/sage/features/normaliz.py: Rename class to PyNormaliz, fix uses`|\n|[7632e53](https://github.com/sagemath/sagetrac-mirror/commit/7632e539cf7c7bfa15e8be3ed2cb7d6804d4ce27)|`src/sage/geometry/polyhedron/base.py: Remove unused import`|\n|[24aaf73](https://github.com/sagemath/sagetrac-mirror/commit/24aaf73b9e1370abdeb9c6b68ac7474f5fef9a10)|`Merge #27744`|\n|[b8f0a10](https://github.com/sagemath/sagetrac-mirror/commit/b8f0a107bd1bc621ecf5d7cacddae0e2110b8427)|`src/sage/features/normaliz.py: Add all_features`|",
    "created_at": "2021-11-15T22:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[23f5009](https://github.com/sagemath/sagetrac-mirror/commit/23f50092bf4af21742e834ef7b908102c85af4d8)|`sage.features.normaliz: New`|
|[0b65b79](https://github.com/sagemath/sagetrac-mirror/commit/0b65b799ed5bc66fed7e1e39c1a07980a3a08616)|`src/sage/features/normaliz.py: Fix up`|
|[00cb9c7](https://github.com/sagemath/sagetrac-mirror/commit/00cb9c7fe2e9dacb1270d556e51b2a8e08bf92f4)|`src/sage/features/normaliz.py: Rename class to PyNormaliz, fix uses`|
|[7632e53](https://github.com/sagemath/sagetrac-mirror/commit/7632e539cf7c7bfa15e8be3ed2cb7d6804d4ce27)|`src/sage/geometry/polyhedron/base.py: Remove unused import`|
|[24aaf73](https://github.com/sagemath/sagetrac-mirror/commit/24aaf73b9e1370abdeb9c6b68ac7474f5fef9a10)|`Merge #27744`|
|[b8f0a10](https://github.com/sagemath/sagetrac-mirror/commit/b8f0a107bd1bc621ecf5d7cacddae0e2110b8427)|`src/sage/features/normaliz.py: Add all_features`|



---

archive/issue_comments_632546.json:
```json
{
    "body": "Changing commit from \"b8f0a107bd1bc621ecf5d7cacddae0e2110b8427\" to \"91f0bcc173d40c15abfba67d7c01a453726a1a02\"",
    "created_at": "2021-11-16T00:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632546",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b8f0a107bd1bc621ecf5d7cacddae0e2110b8427" to "91f0bcc173d40c15abfba67d7c01a453726a1a02"



---

archive/issue_comments_632547.json:
```json
{
    "body": "<a id='comment:34'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[944bb74](https://github.com/sagemath/sagetrac-mirror/commit/944bb74f0bf0260fbc262152005745edfcdd3ad9)|`src/sage/features/interfaces.py: Add doctests`|\n|[2463e1e](https://github.com/sagemath/sagetrac-mirror/commit/2463e1e229ca9a620dbb9f529001be772e6aa7cd)|`Merge #32866`|\n|[91f0bcc](https://github.com/sagemath/sagetrac-mirror/commit/91f0bcc173d40c15abfba67d7c01a453726a1a02)|`src/sage/doctest: Update doctest outputs`|",
    "created_at": "2021-11-16T00:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[944bb74](https://github.com/sagemath/sagetrac-mirror/commit/944bb74f0bf0260fbc262152005745edfcdd3ad9)|`src/sage/features/interfaces.py: Add doctests`|
|[2463e1e](https://github.com/sagemath/sagetrac-mirror/commit/2463e1e229ca9a620dbb9f529001be772e6aa7cd)|`Merge #32866`|
|[91f0bcc](https://github.com/sagemath/sagetrac-mirror/commit/91f0bcc173d40c15abfba67d7c01a453726a1a02)|`src/sage/doctest: Update doctest outputs`|



---

archive/issue_comments_632548.json:
```json
{
    "body": "Changing commit from \"91f0bcc173d40c15abfba67d7c01a453726a1a02\" to \"c9312dbe74009795f2ea1a20cb5f4c2b087415c7\"",
    "created_at": "2021-11-16T01:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "91f0bcc173d40c15abfba67d7c01a453726a1a02" to "c9312dbe74009795f2ea1a20cb5f4c2b087415c7"



---

archive/issue_comments_632549.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[12f7c98](https://github.com/sagemath/sagetrac-mirror/commit/12f7c98f790982e4ed6ab4126d2b0c80efef8bf7)|`src/sage/features/polymake.py: Add all_features`|\n|[c9312db](https://github.com/sagemath/sagetrac-mirror/commit/c9312dbe74009795f2ea1a20cb5f4c2b087415c7)|`src/sage/features: Add more all_features functions`|",
    "created_at": "2021-11-16T01:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[12f7c98](https://github.com/sagemath/sagetrac-mirror/commit/12f7c98f790982e4ed6ab4126d2b0c80efef8bf7)|`src/sage/features/polymake.py: Add all_features`|
|[c9312db](https://github.com/sagemath/sagetrac-mirror/commit/c9312dbe74009795f2ea1a20cb5f4c2b087415c7)|`src/sage/features: Add more all_features functions`|



---

archive/issue_comments_632550.json:
```json
{
    "body": "<a id='comment:36'></a>\nThis unveils a test failure coming from #32732 (wasn't detected there because the test was skipped)\n\n```\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py\", line 2038, in sage.geometry.hyperbolic_space.hyperbolic_geodesic.HyperbolicGeodesicPD.plot\nFailed example:\n    H = h.plot(thickness=6, color=\"orange\"); H           # optional - sage.plot\nExpected:\n    Graphics object consisting of 2 graphics primitives        # optional - sage.plot\nGot:\n    Graphics object consisting of 2 graphics primitives\n**********************************************************************\n```",
    "created_at": "2021-11-16T16:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632550",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:36'></a>
This unveils a test failure coming from #32732 (wasn't detected there because the test was skipped)

```
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py", line 2038, in sage.geometry.hyperbolic_space.hyperbolic_geodesic.HyperbolicGeodesicPD.plot
Failed example:
    H = h.plot(thickness=6, color="orange"); H           # optional - sage.plot
Expected:
    Graphics object consisting of 2 graphics primitives        # optional - sage.plot
Got:
    Graphics object consisting of 2 graphics primitives
**********************************************************************
```



---

archive/issue_comments_632551.json:
```json
{
    "body": "Changing commit from \"c9312dbe74009795f2ea1a20cb5f4c2b087415c7\" to \"230d135a72f002fcf16980b34825e20e41f776f8\"",
    "created_at": "2021-11-16T17:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c9312dbe74009795f2ea1a20cb5f4c2b087415c7" to "230d135a72f002fcf16980b34825e20e41f776f8"



---

archive/issue_comments_632552.json:
```json
{
    "body": "<a id='comment:37'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[230d135](https://github.com/sagemath/sagetrac-mirror/commit/230d135a72f002fcf16980b34825e20e41f776f8)|`src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py: Fix doctest markup`|",
    "created_at": "2021-11-16T17:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[230d135](https://github.com/sagemath/sagetrac-mirror/commit/230d135a72f002fcf16980b34825e20e41f776f8)|`src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py: Fix doctest markup`|



---

archive/issue_comments_632553.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n For some \"safe\" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. \n \n-Likewise for the `PythonModule` features for Sage modules introduced in #32614.\n+Likewise for the `PythonModule` features for Sage modules introduced in #32614. By delaying the test for these features, using the `sage.doctest.external` machinery, we fix the broken detection of some of these features. (This is why the ticket is marked \"critical\".)\n \n This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)\n \n``````\n",
    "created_at": "2021-11-16T17:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632553",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 For some "safe" features such as `imagemagick`, `rubiks`, `4ti2` (#30887), `pandoc`, it really shouldn't require the use of `external` to check for these. 
 
-Likewise for the `PythonModule` features for Sage modules introduced in #32614.
+Likewise for the `PythonModule` features for Sage modules introduced in #32614. By delaying the test for these features, using the `sage.doctest.external` machinery, we fix the broken detection of some of these features. (This is why the ticket is marked "critical".)
 
 This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)
 
``````




---

archive/issue_comments_632554.json:
```json
{
    "body": "<a id='comment:39'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[7a8f48c](https://github.com/sagemath/sagetrac-mirror/commit/7a8f48c64947e41300407bdd7092a1b019d74d60)|`src/sage/features/sagemath.py (sage_features): Unused now, removed`|",
    "created_at": "2021-11-16T19:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[7a8f48c](https://github.com/sagemath/sagetrac-mirror/commit/7a8f48c64947e41300407bdd7092a1b019d74d60)|`src/sage/features/sagemath.py (sage_features): Unused now, removed`|



---

archive/issue_comments_632555.json:
```json
{
    "body": "Changing commit from \"230d135a72f002fcf16980b34825e20e41f776f8\" to \"7a8f48c64947e41300407bdd7092a1b019d74d60\"",
    "created_at": "2021-11-16T19:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "230d135a72f002fcf16980b34825e20e41f776f8" to "7a8f48c64947e41300407bdd7092a1b019d74d60"



---

archive/issue_comments_632556.json:
```json
{
    "body": "<a id='comment:40'></a>\nI'm getting a bliss related failure:\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/features/bliss.py\", line 33, in sage.features.bliss.BlissLibrary\nFailed example:\n    BlissLibrary().require()  # optional: bliss\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features.bliss.BlissLibrary[1]>\", line 1, in <module>\n        BlissLibrary().require()  # optional: bliss\n      File \"/usr/lib/python3.9/site-packages/sage/features/__init__.py\", line 205, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: Bliss is not available.\n    Failed to run test code.\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://www.tcs.hut.fi/Software/bliss/.\n```\nThis is happening because Sage is compiled with bliss, but the bliss library is not present at runtime (it doesn't need to, since it's statically linked).\n\nSo apparently there is a mismatch between whatever is tested to decide whether to enable the `optional: bliss` tests (which seems to be just the presence of the python module) and what the tests themselves require (not just the module, but also the library itself)",
    "created_at": "2021-11-17T19:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632556",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:40'></a>
I'm getting a bliss related failure:

```
File "/usr/lib/python3.9/site-packages/sage/features/bliss.py", line 33, in sage.features.bliss.BlissLibrary
Failed example:
    BlissLibrary().require()  # optional: bliss
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.bliss.BlissLibrary[1]>", line 1, in <module>
        BlissLibrary().require()  # optional: bliss
      File "/usr/lib/python3.9/site-packages/sage/features/__init__.py", line 205, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: Bliss is not available.
    Failed to run test code.
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://www.tcs.hut.fi/Software/bliss/.
```
This is happening because Sage is compiled with bliss, but the bliss library is not present at runtime (it doesn't need to, since it's statically linked).

So apparently there is a mismatch between whatever is tested to decide whether to enable the `optional: bliss` tests (which seems to be just the presence of the python module) and what the tests themselves require (not just the module, but also the library itself)



---

archive/issue_comments_632557.json:
```json
{
    "body": "<a id='comment:41'></a>\nAlso, pyflakes patchbot says:\n\n```\nsrc/sage/doctest/forker.py:218:9 'readline' imported but unused\nsrc/sage/doctest/forker.py:224:9 'sympy' imported but unused\nsrc/sage/geometry/polyhedron/base.py:2701:17 'sage.graphs.graph' imported but unused\nsrc/sage/geometry/polyhedron/base.py:5852:17 'sage.graphs.graph' imported but unused\nsrc/sage/geometry/polyhedron/base.py:6438:17 'sage.graphs.graph' imported but unused\nsrc/sage/geometry/polyhedron/base.py:8913:13 'sage.graphs.graph' imported but unused\n```",
    "created_at": "2021-11-17T19:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632557",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:41'></a>
Also, pyflakes patchbot says:

```
src/sage/doctest/forker.py:218:9 'readline' imported but unused
src/sage/doctest/forker.py:224:9 'sympy' imported but unused
src/sage/geometry/polyhedron/base.py:2701:17 'sage.graphs.graph' imported but unused
src/sage/geometry/polyhedron/base.py:5852:17 'sage.graphs.graph' imported but unused
src/sage/geometry/polyhedron/base.py:6438:17 'sage.graphs.graph' imported but unused
src/sage/geometry/polyhedron/base.py:8913:13 'sage.graphs.graph' imported but unused
```



---

archive/issue_comments_632558.json:
```json
{
    "body": "<a id='comment:42'></a>\nAlso another plugin patchbot warning says:\n\n```\nwrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 9 non-empty lines\n```\n\npossibly in\n\n```\ninside file:  b/src/sage/features/interfaces.py\ninside file:  b/src/sage/features/normaliz.py\n```",
    "created_at": "2021-11-17T19:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632558",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:42'></a>
Also another plugin patchbot warning says:

```
wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 9 non-empty lines
```

possibly in

```
inside file:  b/src/sage/features/interfaces.py
inside file:  b/src/sage/features/normaliz.py
```



---

archive/issue_comments_632559.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [slabbe](#comment%3A41):\n> Also, pyflakes patchbot says:\n> \n> \n> ```\n> src/sage/doctest/forker.py:218:9 'readline' imported but unused\n> src/sage/doctest/forker.py:224:9 'sympy' imported but unused\n> src/sage/geometry/polyhedron/base.py:2701:17 'sage.graphs.graph' imported but unused\n> src/sage/geometry/polyhedron/base.py:5852:17 'sage.graphs.graph' imported but unused\n> src/sage/geometry/polyhedron/base.py:6438:17 'sage.graphs.graph' imported but unused\n> src/sage/geometry/polyhedron/base.py:8913:13 'sage.graphs.graph' imported but unused\n> ```\n\n\nNot from this ticket, and all of these imports are done for their side effect, not the binding",
    "created_at": "2021-11-17T21:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632559",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Replying to [slabbe](#comment%3A41):
> Also, pyflakes patchbot says:
> 
> 
> ```
> src/sage/doctest/forker.py:218:9 'readline' imported but unused
> src/sage/doctest/forker.py:224:9 'sympy' imported but unused
> src/sage/geometry/polyhedron/base.py:2701:17 'sage.graphs.graph' imported but unused
> src/sage/geometry/polyhedron/base.py:5852:17 'sage.graphs.graph' imported but unused
> src/sage/geometry/polyhedron/base.py:6438:17 'sage.graphs.graph' imported but unused
> src/sage/geometry/polyhedron/base.py:8913:13 'sage.graphs.graph' imported but unused
> ```


Not from this ticket, and all of these imports are done for their side effect, not the binding



---

archive/issue_comments_632560.json:
```json
{
    "body": "Changing commit from \"7a8f48c64947e41300407bdd7092a1b019d74d60\" to \"12a25079415abfa9d23c73668e294b2f1ad1d0e9\"",
    "created_at": "2021-11-17T21:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7a8f48c64947e41300407bdd7092a1b019d74d60" to "12a25079415abfa9d23c73668e294b2f1ad1d0e9"



---

archive/issue_comments_632561.json:
```json
{
    "body": "<a id='comment:44'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[e7f538d](https://github.com/sagemath/sagetrac-mirror/commit/e7f538d22836555cecd2a09aa0531af6d2200ff2)|`sage.features.bliss: Change name of BlissLibrary feature to libbliss, remove it from all_features`|\n|[12a2507](https://github.com/sagemath/sagetrac-mirror/commit/12a25079415abfa9d23c73668e294b2f1ad1d0e9)|`src/sage/features/interfaces.py: Fix indentation in docstring`|",
    "created_at": "2021-11-17T21:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632561",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[e7f538d](https://github.com/sagemath/sagetrac-mirror/commit/e7f538d22836555cecd2a09aa0531af6d2200ff2)|`sage.features.bliss: Change name of BlissLibrary feature to libbliss, remove it from all_features`|
|[12a2507](https://github.com/sagemath/sagetrac-mirror/commit/12a25079415abfa9d23c73668e294b2f1ad1d0e9)|`src/sage/features/interfaces.py: Fix indentation in docstring`|



---

archive/issue_comments_632562.json:
```json
{
    "body": "<a id='comment:45'></a>\nFor reviewing, this ticket, I did:\n\n```\n$ sage -t -p --all --long --logfile=logs/32174-second.log\n```\n\nwhich returned\n\n```\nGit branch: 32174\nUsing --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex\nDoctesting entire Sage library.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 4397 files using 8 threads.\n...\n----------------------------------------------------------------------\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/tests/cmdline.py  # 1 doctest failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/graphs/generic_graph.py  # 2 doctests failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/interfaces/fricas.py  # 1 doctest failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/graphs/graph.py  # 2 doctests failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/schemes/toric/sheaf/klyachko.py  # 1 doctest failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/sat/solvers/dimacs.py  # 2 doctests failed\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed\n----------------------------------------------------------------------\nFeatures detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,latex,lualatex,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex\n```\n\nThe issue with `src/sage/schemes/toric/sheaf/klyachko.py` does not reproduce:\n\n```\nsage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/schemes/toric/sheaf/klyachko.py\n**********************************************************************\nFile \"src/sage/schemes/toric/sheaf/klyachko.py\", line 950, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_clas\ns.random_deformation\nFailed example:\n    Vtilde.cohomology(dim=True, weight=(0,))\nExpected:\n    (1, 0)\nGot:\n    (0, 0)\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation\n    [151 tests, 1 failure, 16.00 s]\n```\nThe other failures are known.\n\nThen I did:\n\n```\nsage -t -p --all --long --optional=sage,optional,external,build --show-skipped --logfile=logs/32174.log\n```\nwhich returned:\n\n```\nGit branch: 32174\nUsing --optional=4ti2,build,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex\nDoctesting entire Sage library.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 4397 files using 8 threads.\n...\n----------------------------------------------------------------------\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/generic_graph.py  # 2 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/databases/findstat.py  # 9 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/tests/cmdline.py  # 10 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/graph.py  # 3 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/interfaces/fricas.py  # 1 doctest failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/sat/solvers/dimacs.py  # 2 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/finance/stock.py  # 1 doctest failed\n----------------------------------------------------------------------\nFeatures detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,internet,latex,lualatex,octave,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex\n```\n\nTherefore, there are no new failing test compared to what is currently the case with respect to known external failing doctests, see #25536. The difference is that now there is a list of features to be detected (pandoc, pdf2svg, etc.) which are now considered as optional instead of external which is a good thing.\n\nI confirm that the new list of external packages is shorter and made only of the following:\n\n```\n>>> s = \"4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex\"\n>>> t = \"4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex\"\n>>> set(t.split(',')) - set(s.split(','))\nset(['macaulay2', 'mathematica', 'cplex', 'magma', 'gurobi', 'matlab', 'octave', 'internet', 'scilab', 'maple'])\n```",
    "created_at": "2021-11-18T14:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632562",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:45'></a>
For reviewing, this ticket, I did:

```
$ sage -t -p --all --long --logfile=logs/32174-second.log
```

which returned

```
Git branch: 32174
Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex
Doctesting entire Sage library.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 4397 files using 8 threads.
...
----------------------------------------------------------------------
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/tests/cmdline.py  # 1 doctest failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/graphs/generic_graph.py  # 2 doctests failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/interfaces/fricas.py  # 1 doctest failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/graphs/graph.py  # 2 doctests failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/schemes/toric/sheaf/klyachko.py  # 1 doctest failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/sat/solvers/dimacs.py  # 2 doctests failed
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed
----------------------------------------------------------------------
Features detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,latex,lualatex,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex
```

The issue with `src/sage/schemes/toric/sheaf/klyachko.py` does not reproduce:

```
sage -t --long --random-seed=129857008849586417489695899017012168188 src/sage/schemes/toric/sheaf/klyachko.py
**********************************************************************
File "src/sage/schemes/toric/sheaf/klyachko.py", line 950, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_clas
s.random_deformation
Failed example:
    Vtilde.cohomology(dim=True, weight=(0,))
Expected:
    (1, 0)
Got:
    (0, 0)
**********************************************************************
1 item had failures:
   1 of   7 in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation
    [151 tests, 1 failure, 16.00 s]
```
The other failures are known.

Then I did:

```
sage -t -p --all --long --optional=sage,optional,external,build --show-skipped --logfile=logs/32174.log
```
which returned:

```
Git branch: 32174
Using --optional=4ti2,build,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex
Doctesting entire Sage library.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 4397 files using 8 threads.
...
----------------------------------------------------------------------
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/generic_graph.py  # 2 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/databases/findstat.py  # 9 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/tests/cmdline.py  # 10 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/graph.py  # 3 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/interfaces/fricas.py  # 1 doctest failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/sat/solvers/dimacs.py  # 2 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/finance/stock.py  # 1 doctest failed
----------------------------------------------------------------------
Features detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,internet,latex,lualatex,octave,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex
```

Therefore, there are no new failing test compared to what is currently the case with respect to known external failing doctests, see #25536. The difference is that now there is a list of features to be detected (pandoc, pdf2svg, etc.) which are now considered as optional instead of external which is a good thing.

I confirm that the new list of external packages is shorter and made only of the following:

```
>>> s = "4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex"
>>> t = "4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex"
>>> set(t.split(',')) - set(s.split(','))
set(['macaulay2', 'mathematica', 'cplex', 'magma', 'gurobi', 'matlab', 'octave', 'internet', 'scilab', 'maple'])
```



---

archive/issue_comments_632563.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-18T14:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632563",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_632564.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2021-11-18T14:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632564",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_632565.json:
```json
{
    "body": "<a id='comment:46'></a>\nObjectives of the ticket are achieved.",
    "created_at": "2021-11-18T14:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632565",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:46'></a>
Objectives of the ticket are achieved.



---

archive/issue_comments_632566.json:
```json
{
    "body": "<a id='comment:47'></a>\nThank you for reviewing!",
    "created_at": "2021-11-18T18:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632566",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Thank you for reviewing!



---

archive/issue_comments_632567.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-23T23:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632567",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_632568.json:
```json
{
    "body": "<a id='comment:48'></a>\n\n```\nsage -t --long --warn-long 45.7 --random-seed=86523171498431921424879269621082549712 src/sage/misc/latex.py\n**********************************************************************\nFile \"src/sage/misc/latex.py\", line 1549, in sage.misc.latex.Latex.add_package_to_preamble_if_available\nFailed example:\n    latex.extra_preamble()       # optional - latex\nExpected:\n    '\\\\usepackage{xypic}\\n'\nGot:\n    ''\n**********************************************************************\nFile \"src/sage/misc/latex.py\", line 1859, in sage.misc.latex.?\nFailed example:\n    _run_latex_(file, engine=\"pdflatex\") # optional - latex\nExpected:\n    'pdf'\nGot:\n    An error occurred.\n    This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex 2020.11.22)  24 NOV 2021 00:24\n    entering extended mode\n     restricted \\write18 enabled.\n     %&-line parsing enabled.\n    **\\nonstopmode \\input{temp.tex}\n    (./temp.tex (/usr/share/texlive/texmf-dist/tex/latex/base/article.cls\n    Document Class: article 2019/12/20 v1.4l Standard LaTeX document class\n    (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo\n    File: size10.clo 2019/12/20 v1.4l Standard LaTeX file (size option)\n    )\n    \\c@part=\\count167\n    \\c@section=\\count168\n    \\c@subsection=\\count169\n    \\c@subsubsection=\\count170\n    \\c@paragraph=\\count171\n    \\c@subparagraph=\\count172\n    \\c@figure=\\count173\n    \\c@table=\\count174\n    \\abovecaptionskip=\\skip47\n    \\belowcaptionskip=\\skip48\n    \\bibindent=\\dimen134\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsmath.sty\n    Package: amsmath 2020/01/20 v2.17e AMS math features\n    \\@mathmargin=\\skip49\n    <BLANKLINE>\n    For additional information on amsmath, use the `?' option.\n    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amstext.sty\n    Package: amstext 2000/06/29 v2.01 AMS text\n    <BLANKLINE>\n    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsgen.sty\n    File: amsgen.sty 1999/11/30 v2.0 generic functions\n    \\@emptytoks=\\toks15\n    \\ex@=\\dimen135\n    ))\n    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsbsy.sty\n    Package: amsbsy 1999/11/29 v1.2d Bold Symbols\n    \\pmbraise@=\\dimen136\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsopn.sty\n    Package: amsopn 2016/03/08 v2.02 operator names\n    )\n    \\inf@bad=\\count175\n    LaTeX Info: Redefining \\frac on input line 227.\n    \\uproot@=\\count176\n    \\leftroot@=\\count177\n    LaTeX Info: Redefining \\overline on input line 389.\n    \\classnum@=\\count178\n    \\DOTSCASE@=\\count179\n    LaTeX Info: Redefining \\ldots on input line 486.\n    LaTeX Info: Redefining \\dots on input line 489.\n    LaTeX Info: Redefining \\cdots on input line 610.\n    \\Mathstrutbox@=\\box45\n    \\strutbox@=\\box46\n    \\big@size=\\dimen137\n    LaTeX Font Info:    Redeclaring font encoding OML on input line 733.\n    LaTeX Font Info:    Redeclaring font encoding OMS on input line 734.\n    \\macc@depth=\\count180\n    \\c@MaxMatrixCols=\\count181\n    \\dotsspace@=\\muskip16\n    \\c@parentequation=\\count182\n    \\dspbrk@lvl=\\count183\n    \\tag@help=\\toks16\n    \\row@=\\count184\n    \\column@=\\count185\n    \\maxfields@=\\count186\n    \\andhelp@=\\toks17\n    \\eqnshift@=\\dimen138\n    \\alignsep@=\\dimen139\n    \\tagshift@=\\dimen140\n    \\tagwidth@=\\dimen141\n    \\totwidth@=\\dimen142\n    \\lineht@=\\dimen143\n    \\@envbody=\\toks18\n    \\multlinegap=\\skip50\n    \\multlinetaggap=\\skip51\n    \\mathdisplay@stack=\\toks19\n    LaTeX Info: Redefining \\[ on input line 2859.\n    LaTeX Info: Redefining \\] on input line 2860.\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amssymb.sty\n    Package: amssymb 2013/01/14 v3.01 AMS font symbols\n    <BLANKLINE>\n    (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amsfonts.sty\n    Package: amsfonts 2013/01/14 v3.01 Basic AMSFonts support\n    \\symAMSa=\\mathgroup4\n    \\symAMSb=\\mathgroup5\n    LaTeX Font Info:    Redeclaring math symbol \\hbar on input line 98.\n    LaTeX Font Info:    Overwriting math alphabet `\\mathfrak' in version `bold'\n    (Font)                  U/euf/m/n --> U/euf/b/n on input line 106.\n    ))\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics/graphicx.sty\n    Package: graphicx 2019/11/30 v1.2a Enhanced LaTeX Graphics (DPC,SPQR)\n    <BLANKLINE>\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics/keyval.sty\n    Package: keyval 2014/10/28 v1.15 key=value parser (DPC)\n    \\KV@toks@=\\toks20\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics/graphics.sty\n    Package: graphics 2019/11/30 v1.4a Standard LaTeX Graphics (DPC,SPQR)\n    <BLANKLINE>\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics/trig.sty\n    Package: trig 2016/01/03 v1.10 sin cos tan (DPC)\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics-cfg/graphics.cfg\n    File: graphics.cfg 2016/06/04 v1.11 sample graphics configuration\n    )\n    Package graphics Info: Driver file: pdftex.def on input line 105.\n    <BLANKLINE>\n    (/usr/share/texlive/texmf-dist/tex/latex/graphics-def/pdftex.def\n    File: pdftex.def 2018/01/08 v1.0l Graphics/color driver for pdftex\n    ))\n    \\Gin@req@height=\\dimen144\n    \\Gin@req@width=\\dimen145\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/mathrsfs.sty\n    Package: mathrsfs 1996/01/01 Math RSFS package v1.0 (jk)\n    \\symrsfs=\\mathgroup6\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty\n    Package: inputenc 2018/08/11 v1.3c Input encoding file\n    \\inpenc@prehook=\\toks21\n    \\inpenc@posthook=\\toks22\n    )\n    (/usr/share/texlive/texmf-dist/tex/latex/base/fontenc.sty\n    Package: fontenc 2020/02/11 v2.0o Standard LaTeX package\n    )\n    <BLANKLINE>\n    ! LaTeX Error: File `tkz-graph.sty' not found.\n    <BLANKLINE>\n    Type X to quit or <RETURN> to proceed,\n    or enter new name. (Default extension: sty)\n    <BLANKLINE>\n    Enter file name: \n    ! Emergency stop.\n    <read *> \n    <BLANKLINE>\n    l.19 \\newcommand\n                    {\\ZZ}{\\Bold{Z}}^^M\n    *** (cannot \\read from terminal in nonstop modes)\n    <BLANKLINE>\n    <BLANKLINE>\n    Here is how much of TeX's memory you used:\n     1949 strings out of 482029\n     21727 string characters out of 5943690\n     251133 words of memory out of 5000000\n     17640 multiletter control sequences out of 15000+600000\n     533101 words of font info for 25 fonts, out of 8000000 for 9000\n     430 hyphenation exceptions out of 8191\n     32i,0n,33p,241b,38s stack positions out of 5000i,500n,10000p,200000b,80000s\n    !  ==> Fatal error occurred, no output PDF file produced!\n    <BLANKLINE>\n    'Error latexing slide.'\n**********************************************************************\n2 items had failures:\n   1 of  19 in sage.misc.latex.?\n   1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available\n    [258 tests, 2 failures, 0.85 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 45.7 --random-seed=86523171498431921424879269621082549712 src/sage/misc/latex.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1.0 seconds\n    cpu time: 0.2 seconds\n    cumulative wall time: 0.9 seconds\nFeatures detected for doctesting: imagemagick,latex\n```",
    "created_at": "2021-11-23T23:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632568",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'></a>

```
sage -t --long --warn-long 45.7 --random-seed=86523171498431921424879269621082549712 src/sage/misc/latex.py
**********************************************************************
File "src/sage/misc/latex.py", line 1549, in sage.misc.latex.Latex.add_package_to_preamble_if_available
Failed example:
    latex.extra_preamble()       # optional - latex
Expected:
    '\\usepackage{xypic}\n'
Got:
    ''
**********************************************************************
File "src/sage/misc/latex.py", line 1859, in sage.misc.latex.?
Failed example:
    _run_latex_(file, engine="pdflatex") # optional - latex
Expected:
    'pdf'
Got:
    An error occurred.
    This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex 2020.11.22)  24 NOV 2021 00:24
    entering extended mode
     restricted \write18 enabled.
     %&-line parsing enabled.
    **\nonstopmode \input{temp.tex}
    (./temp.tex (/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
    Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
    (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo
    File: size10.clo 2019/12/20 v1.4l Standard LaTeX file (size option)
    )
    \c@part=\count167
    \c@section=\count168
    \c@subsection=\count169
    \c@subsubsection=\count170
    \c@paragraph=\count171
    \c@subparagraph=\count172
    \c@figure=\count173
    \c@table=\count174
    \abovecaptionskip=\skip47
    \belowcaptionskip=\skip48
    \bibindent=\dimen134
    )
    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsmath.sty
    Package: amsmath 2020/01/20 v2.17e AMS math features
    \@mathmargin=\skip49
    <BLANKLINE>
    For additional information on amsmath, use the `?' option.
    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amstext.sty
    Package: amstext 2000/06/29 v2.01 AMS text
    <BLANKLINE>
    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsgen.sty
    File: amsgen.sty 1999/11/30 v2.0 generic functions
    \@emptytoks=\toks15
    \ex@=\dimen135
    ))
    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsbsy.sty
    Package: amsbsy 1999/11/29 v1.2d Bold Symbols
    \pmbraise@=\dimen136
    )
    (/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsopn.sty
    Package: amsopn 2016/03/08 v2.02 operator names
    )
    \inf@bad=\count175
    LaTeX Info: Redefining \frac on input line 227.
    \uproot@=\count176
    \leftroot@=\count177
    LaTeX Info: Redefining \overline on input line 389.
    \classnum@=\count178
    \DOTSCASE@=\count179
    LaTeX Info: Redefining \ldots on input line 486.
    LaTeX Info: Redefining \dots on input line 489.
    LaTeX Info: Redefining \cdots on input line 610.
    \Mathstrutbox@=\box45
    \strutbox@=\box46
    \big@size=\dimen137
    LaTeX Font Info:    Redeclaring font encoding OML on input line 733.
    LaTeX Font Info:    Redeclaring font encoding OMS on input line 734.
    \macc@depth=\count180
    \c@MaxMatrixCols=\count181
    \dotsspace@=\muskip16
    \c@parentequation=\count182
    \dspbrk@lvl=\count183
    \tag@help=\toks16
    \row@=\count184
    \column@=\count185
    \maxfields@=\count186
    \andhelp@=\toks17
    \eqnshift@=\dimen138
    \alignsep@=\dimen139
    \tagshift@=\dimen140
    \tagwidth@=\dimen141
    \totwidth@=\dimen142
    \lineht@=\dimen143
    \@envbody=\toks18
    \multlinegap=\skip50
    \multlinetaggap=\skip51
    \mathdisplay@stack=\toks19
    LaTeX Info: Redefining \[ on input line 2859.
    LaTeX Info: Redefining \] on input line 2860.
    )
    (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amssymb.sty
    Package: amssymb 2013/01/14 v3.01 AMS font symbols
    <BLANKLINE>
    (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amsfonts.sty
    Package: amsfonts 2013/01/14 v3.01 Basic AMSFonts support
    \symAMSa=\mathgroup4
    \symAMSb=\mathgroup5
    LaTeX Font Info:    Redeclaring math symbol \hbar on input line 98.
    LaTeX Font Info:    Overwriting math alphabet `\mathfrak' in version `bold'
    (Font)                  U/euf/m/n --> U/euf/b/n on input line 106.
    ))
    (/usr/share/texlive/texmf-dist/tex/latex/graphics/graphicx.sty
    Package: graphicx 2019/11/30 v1.2a Enhanced LaTeX Graphics (DPC,SPQR)
    <BLANKLINE>
    (/usr/share/texlive/texmf-dist/tex/latex/graphics/keyval.sty
    Package: keyval 2014/10/28 v1.15 key=value parser (DPC)
    \KV@toks@=\toks20
    )
    (/usr/share/texlive/texmf-dist/tex/latex/graphics/graphics.sty
    Package: graphics 2019/11/30 v1.4a Standard LaTeX Graphics (DPC,SPQR)
    <BLANKLINE>
    (/usr/share/texlive/texmf-dist/tex/latex/graphics/trig.sty
    Package: trig 2016/01/03 v1.10 sin cos tan (DPC)
    )
    (/usr/share/texlive/texmf-dist/tex/latex/graphics-cfg/graphics.cfg
    File: graphics.cfg 2016/06/04 v1.11 sample graphics configuration
    )
    Package graphics Info: Driver file: pdftex.def on input line 105.
    <BLANKLINE>
    (/usr/share/texlive/texmf-dist/tex/latex/graphics-def/pdftex.def
    File: pdftex.def 2018/01/08 v1.0l Graphics/color driver for pdftex
    ))
    \Gin@req@height=\dimen144
    \Gin@req@width=\dimen145
    )
    (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/mathrsfs.sty
    Package: mathrsfs 1996/01/01 Math RSFS package v1.0 (jk)
    \symrsfs=\mathgroup6
    )
    (/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty
    Package: inputenc 2018/08/11 v1.3c Input encoding file
    \inpenc@prehook=\toks21
    \inpenc@posthook=\toks22
    )
    (/usr/share/texlive/texmf-dist/tex/latex/base/fontenc.sty
    Package: fontenc 2020/02/11 v2.0o Standard LaTeX package
    )
    <BLANKLINE>
    ! LaTeX Error: File `tkz-graph.sty' not found.
    <BLANKLINE>
    Type X to quit or <RETURN> to proceed,
    or enter new name. (Default extension: sty)
    <BLANKLINE>
    Enter file name: 
    ! Emergency stop.
    <read *> 
    <BLANKLINE>
    l.19 \newcommand
                    {\ZZ}{\Bold{Z}}^^M
    *** (cannot \read from terminal in nonstop modes)
    <BLANKLINE>
    <BLANKLINE>
    Here is how much of TeX's memory you used:
     1949 strings out of 482029
     21727 string characters out of 5943690
     251133 words of memory out of 5000000
     17640 multiletter control sequences out of 15000+600000
     533101 words of font info for 25 fonts, out of 8000000 for 9000
     430 hyphenation exceptions out of 8191
     32i,0n,33p,241b,38s stack positions out of 5000i,500n,10000p,200000b,80000s
    !  ==> Fatal error occurred, no output PDF file produced!
    <BLANKLINE>
    'Error latexing slide.'
**********************************************************************
2 items had failures:
   1 of  19 in sage.misc.latex.?
   1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available
    [258 tests, 2 failures, 0.85 s]
----------------------------------------------------------------------
sage -t --long --warn-long 45.7 --random-seed=86523171498431921424879269621082549712 src/sage/misc/latex.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1.0 seconds
    cpu time: 0.2 seconds
    cumulative wall time: 0.9 seconds
Features detected for doctesting: imagemagick,latex
```



---

archive/issue_comments_632569.json:
```json
{
    "body": "Changing commit from \"12a25079415abfa9d23c73668e294b2f1ad1d0e9\" to \"07b2512e77df2923d85bda52d42537392ca6b338\"",
    "created_at": "2021-11-24T01:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "12a25079415abfa9d23c73668e294b2f1ad1d0e9" to "07b2512e77df2923d85bda52d42537392ca6b338"



---

archive/issue_comments_632570.json:
```json
{
    "body": "<a id='comment:49'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[0dd76b6](https://github.com/sagemath/sagetrac-mirror/commit/0dd76b608c0a47ac9731cf099885a536d90a8ab3)|`Merge tag '9.5.beta7' into t/32174/doctests__detect__safe__external_features_even_if____optional_external__is_not_used`|\n|[07b2512](https://github.com/sagemath/sagetrac-mirror/commit/07b2512e77df2923d85bda52d42537392ca6b338)|`src/sage/misc/latex.py: Conditionalize some doctests on latex_package_tkz_graph`|",
    "created_at": "2021-11-24T01:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[0dd76b6](https://github.com/sagemath/sagetrac-mirror/commit/0dd76b608c0a47ac9731cf099885a536d90a8ab3)|`Merge tag '9.5.beta7' into t/32174/doctests__detect__safe__external_features_even_if____optional_external__is_not_used`|
|[07b2512](https://github.com/sagemath/sagetrac-mirror/commit/07b2512e77df2923d85bda52d42537392ca6b338)|`src/sage/misc/latex.py: Conditionalize some doctests on latex_package_tkz_graph`|



---

archive/issue_comments_632571.json:
```json
{
    "body": "<a id='comment:50'></a>\nHere's a quick fix by marking some doctests `# optional - latex_package_tkz_graph`. \nFor now, this annotation just disables that line. This feature is introduced in #32926.",
    "created_at": "2021-11-24T02:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632571",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
Here's a quick fix by marking some doctests `# optional - latex_package_tkz_graph`. 
For now, this annotation just disables that line. This feature is introduced in #32926.



---

archive/issue_comments_632572.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-24T02:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632572",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_632573.json:
```json
{
    "body": "<a id='comment:52'></a>\nI do not have access to a computer with no installation of latex. But, I confirm that this\n\n```\nsage -tp --optional=sage,optional,external src/sage/misc/latex.py\n```\n\nworks on my machine:\n\n```\nGit branch: 32174\nUsing --optional=4ti2,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex\nDoctesting 1 file using 8 threads.\nsage -t --random-seed=278462588081941083872300580472279407754 src/sage/misc/latex.py\n    [255 tests, 1.15 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nFeatures detected for doctesting: imagemagick,latex\n```",
    "created_at": "2021-11-25T10:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632573",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:52'></a>
I do not have access to a computer with no installation of latex. But, I confirm that this

```
sage -tp --optional=sage,optional,external src/sage/misc/latex.py
```

works on my machine:

```
Git branch: 32174
Using --optional=4ti2,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,octave,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,scilab,tdlib,xelatex
Doctesting 1 file using 8 threads.
sage -t --random-seed=278462588081941083872300580472279407754 src/sage/misc/latex.py
    [255 tests, 1.15 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Features detected for doctesting: imagemagick,latex
```



---

archive/issue_comments_632574.json:
```json
{
    "body": "<a id='comment:53'></a>\nAll tests are passing on the patchbots. For me it is a positive review.\n\nCan someone having a machine similar to the one used by Volker confirm it is okay?\n\nVolker, are you okay to test it again on your machine?",
    "created_at": "2021-11-25T10:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632574",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:53'></a>
All tests are passing on the patchbots. For me it is a positive review.

Can someone having a machine similar to the one used by Volker confirm it is okay?

Volker, are you okay to test it again on your machine?



---

archive/issue_comments_632575.json:
```json
{
    "body": "<a id='comment:54'></a>\nLet's just put it back in the queue",
    "created_at": "2021-11-26T03:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632575",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
Let's just put it back in the queue



---

archive/issue_comments_632576.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-26T03:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632576",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_632577.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2021-12-01T10:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632577",
    "user": "https://github.com/seblabbe"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_632578.json:
```json
{
    "body": "<a id='comment:55'></a>\nThe 89 + 63 doctest failures (seen on patchbot `labri-vindelecroix-1`) that are discussed in #32926 are also seen here on the same patchbot testing this ticket #32174. Moreover those numerous failures are not seen by the same patchbot while testing #32866 on which #32174 is based on. So I switch the status of the current ticket to needs info.",
    "created_at": "2021-12-01T10:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632578",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:55'></a>
The 89 + 63 doctest failures (seen on patchbot `labri-vindelecroix-1`) that are discussed in #32926 are also seen here on the same patchbot testing this ticket #32174. Moreover those numerous failures are not seen by the same patchbot while testing #32866 on which #32174 is based on. So I switch the status of the current ticket to needs info.



---

archive/issue_comments_632579.json:
```json
{
    "body": "<a id='comment:56'></a>\n(*I copy paste here a comment originally written at #32926#comment:20*)\n\nAll of the 89 + 63 errors are the same. It is always a warning which is printed (the output is always ok) saying `! LaTeX Error: File `type1ec.sty' not found.`\n\nAlso the machine on which the failures is happening has the following detected features:\n\n```\nFeatures detected for doctesting: 4ti2,dvipng,ffmpeg,graphviz,latex,latex_package_tkz_graph,lrslib,lualatex,pdflatex,\nsage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,\nsage.rings.real_double,sage.symbolic,xelatex\n```\n\nHere is one of the failure:\n\n```\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 1919, in sage.plot.plot.plot\nFailed example:\n    parametric_plot((sqrt(x^2-1),sqrt(x^2-1/2)), (x,0,5), exclude=[1,2,3])\nExpected:\n    Graphics object consisting of 3 graphics primitives\nGot:\n    doctest:warning\n      File \"/home/debian/sage/src/bin/sage-runtests\", line 155, in <module>\n        err = DC.run()\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 1253, in run\n        self.run_doctests()\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 954, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1996, in dispatch\n        self.parallel_dispatch()\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1891, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2165, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.9/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.9/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.9/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.9/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.9/multiprocessing/popen_fork.py\", line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib/python3.9/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2137, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2467, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2519, in _run\n        result = runner.run(test)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 861, in run\n        return self._run(test, compileflags, out)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot.plot[144]>\", line 1, in <module>\n        parametric_plot((sqrt(x**Integer(2)-Integer(1)),sqrt(x**Integer(2)-Integer(1)/Integer(2))), (x,Integer(0),Integer(5)), exclude=[Integer(1),Integer(2),Integer(3)])\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py\", line 825, in displayhook\n        plain_text, rich_output = self._rich_output_formatter(obj, dict())\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py\", line 643, in _rich_output_formatter\n        rich_output = self._call_rich_repr(obj, rich_repr_kwds)\n      File \"/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py\", line 608, in _call_rich_repr\n        warnings.warn(\n      File \"/usr/lib/python3.9/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: latex was not able to process the following string:\n    b'lp'\n    <BLANKLINE>\n    Here is the full report generated by latex:\n    This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020/Debian) (preloaded format=latex)\n     restricted \\write18 enabled.\n    entering extended mode\n    <BLANKLINE>\n    (/home/debian/.sage/matplotlib-1.5.1/tex.cache/1acea6f6c115d0ec7a634ed0529287b9\n    .tex\n    LaTeX2e <2020-10-01> patch level 4\n    L3 programming layer <2021-01-09> xparse <2020-03-03>\n    (/usr/share/texlive/texmf-dist/tex/latex/base/article.cls\n    Document Class: article 2020/04/10 v1.4m Standard LaTeX document class\n    (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo))\n    (/usr/share/texlive/texmf-dist/tex/latex/type1cm/type1cm.sty)\n    <BLANKLINE>\n    ! LaTeX Error: File `type1ec.sty' not found.\n    <BLANKLINE>\n    Type X to quit or <RETURN> to proceed,\n    or enter new name. (Default extension: sty)\n    <BLANKLINE>\n    Enter file name: \n    ! Emergency stop.\n    <read *> \n    <BLANKLINE>\n    l.6 \\usepackage\n                   {type1ec}^^M\n    No pages of output.\n    Transcript written on 1acea6f6c115d0ec7a634ed0529287b9.log.\n    <BLANKLINE>\n    <BLANKLINE>\n    <BLANKLINE>\n    Graphics object consisting of 3 graphics primitives\n```\n\nI am not able to reproduce these failures on my machine. I will try to see if these failures appear with the same machine running doctest on different tickets or on no ticket at all (if I remember well, there is a way to check this no?)",
    "created_at": "2021-12-01T11:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632579",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:56'></a>
(*I copy paste here a comment originally written at #32926#comment:20*)

All of the 89 + 63 errors are the same. It is always a warning which is printed (the output is always ok) saying `! LaTeX Error: File `type1ec.sty' not found.`

Also the machine on which the failures is happening has the following detected features:

```
Features detected for doctesting: 4ti2,dvipng,ffmpeg,graphviz,latex,latex_package_tkz_graph,lrslib,lualatex,pdflatex,
sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,
sage.rings.real_double,sage.symbolic,xelatex
```

Here is one of the failure:

```
**********************************************************************
File "src/sage/plot/plot.py", line 1919, in sage.plot.plot.plot
Failed example:
    parametric_plot((sqrt(x^2-1),sqrt(x^2-1/2)), (x,0,5), exclude=[1,2,3])
Expected:
    Graphics object consisting of 3 graphics primitives
Got:
    doctest:warning
      File "/home/debian/sage/src/bin/sage-runtests", line 155, in <module>
        err = DC.run()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1253, in run
        self.run_doctests()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/control.py", line 954, in run_doctests
        self.dispatcher.dispatch()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1996, in dispatch
        self.parallel_dispatch()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1891, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2165, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.9/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.9/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.9/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib/python3.9/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2137, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2467, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2519, in _run
        result = runner.run(test)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 861, in run
        return self._run(test, compileflags, out)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot.plot[144]>", line 1, in <module>
        parametric_plot((sqrt(x**Integer(2)-Integer(1)),sqrt(x**Integer(2)-Integer(1)/Integer(2))), (x,Integer(0),Integer(5)), exclude=[Integer(1),Integer(2),Integer(3)])
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py", line 825, in displayhook
        plain_text, rich_output = self._rich_output_formatter(obj, dict())
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py", line 643, in _rich_output_formatter
        rich_output = self._call_rich_repr(obj, rich_repr_kwds)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/repl/rich_output/display_manager.py", line 608, in _call_rich_repr
        warnings.warn(
      File "/usr/lib/python3.9/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: latex was not able to process the following string:
    b'lp'
    <BLANKLINE>
    Here is the full report generated by latex:
    This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020/Debian) (preloaded format=latex)
     restricted \write18 enabled.
    entering extended mode
    <BLANKLINE>
    (/home/debian/.sage/matplotlib-1.5.1/tex.cache/1acea6f6c115d0ec7a634ed0529287b9
    .tex
    LaTeX2e <2020-10-01> patch level 4
    L3 programming layer <2021-01-09> xparse <2020-03-03>
    (/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
    Document Class: article 2020/04/10 v1.4m Standard LaTeX document class
    (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo))
    (/usr/share/texlive/texmf-dist/tex/latex/type1cm/type1cm.sty)
    <BLANKLINE>
    ! LaTeX Error: File `type1ec.sty' not found.
    <BLANKLINE>
    Type X to quit or <RETURN> to proceed,
    or enter new name. (Default extension: sty)
    <BLANKLINE>
    Enter file name: 
    ! Emergency stop.
    <read *> 
    <BLANKLINE>
    l.6 \usepackage
                   {type1ec}^^M
    No pages of output.
    Transcript written on 1acea6f6c115d0ec7a634ed0529287b9.log.
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
    Graphics object consisting of 3 graphics primitives
```

I am not able to reproduce these failures on my machine. I will try to see if these failures appear with the same machine running doctest on different tickets or on no ticket at all (if I remember well, there is a way to check this no?)



---

archive/issue_comments_632580.json:
```json
{
    "body": "<a id='comment:57'></a>\nSee similar discussion in a matplotlib issue:\n\n- https://github.com/matplotlib/matplotlib/issues/16911\n\nThe fix suggested there is:\n\n```\n$ apt install cm-super\n```",
    "created_at": "2021-12-01T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632580",
    "user": "https://github.com/slel"
}
```

<a id='comment:57'></a>
See similar discussion in a matplotlib issue:

- https://github.com/matplotlib/matplotlib/issues/16911

The fix suggested there is:

```
$ apt install cm-super
```



---

archive/issue_comments_632581.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,56 @@\n \n This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)\n \n+With this ticket, more doctests will be run by default. This may lead to new failures (discovered by patchbot for instance). But that does not mean it is introduced in this ticket, just that they were existing before this ticket, but simply not executed.\n+\n+For example, let's compare the behavior of the following command:\n+\n+```\n+$ sage -tp --long --show-skipped src/sage/plot/plot.py src/sage/plot/graphics.py\n+```\n+\n+returns:\n+\n+BEFORE (9.5.beta7):\n+\n+```\n+Git branch: develop\n+Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg\n+Doctesting 2 files using 8 threads.\n+sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/graphics.py\n+    2 latex tests not run\n+    3 not tested tests not run\n+    0 tests not run because we ran out of time\n+    [405 tests, 33.39 s]\n+sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/plot.py\n+    1 latex test not run\n+    0 tests not run because we ran out of time\n+    [461 tests, 57.38 s]\n+----------------------------------------------------------------------\n+All tests passed!\n+----------------------------------------------------------------------\n+```\n+\n+AFTER (9.5.beta7 + #32174):\n+\n+```\n+Git branch: 32174\n+Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\n+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex\n+Doctesting 2 files using 8 threads.\n+sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py\n+    2 latex tests not run\n+    3 not tested tests not run\n+    0 tests not run because we ran out of time\n+    [407 tests, 34.35 s]\n+sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py\n+    1 latex test not run\n+    0 tests not run because we ran out of time\n+    [462 tests, 57.75 s]\n+----------------------------------------------------------------------\n+All tests passed!\n+----------------------------------------------------------------------\n+Features detected for doctesting: latex\n+```\n+\n+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.\n``````\n",
    "created_at": "2021-12-01T11:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632581",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,56 @@
 
 This is a step toward #30746 (`sage.doctest.control`: Replace use of `sage.misc.package.list_packages`)
 
+With this ticket, more doctests will be run by default. This may lead to new failures (discovered by patchbot for instance). But that does not mean it is introduced in this ticket, just that they were existing before this ticket, but simply not executed.
+
+For example, let's compare the behavior of the following command:
+
+```
+$ sage -tp --long --show-skipped src/sage/plot/plot.py src/sage/plot/graphics.py
+```
+
+returns:
+
+BEFORE (9.5.beta7):
+
+```
+Git branch: develop
+Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg
+Doctesting 2 files using 8 threads.
+sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/graphics.py
+    2 latex tests not run
+    3 not tested tests not run
+    0 tests not run because we ran out of time
+    [405 tests, 33.39 s]
+sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/plot.py
+    1 latex test not run
+    0 tests not run because we ran out of time
+    [461 tests, 57.38 s]
+----------------------------------------------------------------------
+All tests passed!
+----------------------------------------------------------------------
+```
+
+AFTER (9.5.beta7 + #32174):
+
+```
+Git branch: 32174
+Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex
+Doctesting 2 files using 8 threads.
+sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py
+    2 latex tests not run
+    3 not tested tests not run
+    0 tests not run because we ran out of time
+    [407 tests, 34.35 s]
+sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py
+    1 latex test not run
+    0 tests not run because we ran out of time
+    [462 tests, 57.75 s]
+----------------------------------------------------------------------
+All tests passed!
+----------------------------------------------------------------------
+Features detected for doctesting: latex
+```
+
+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.
``````




---

archive/issue_comments_632582.json:
```json
{
    "body": "<a id='comment:58'></a>\nI updated the description of the ticket to mention that more doctests will be run by default after #32174 which may lead to \"new\" bugs that were there before. That being said, I still don't know if the 89 + 63 fall in this category, because only 2 + 1 doctests are marked as `optional - latex` in those two files.\n\nAlso, it made me realize that there is a bug with `--show-skipped` which does not work correctly:\nThe fact that `2 latex tests not run`, `1 latex test not run` still appear is a bug, since those tests **are** run.",
    "created_at": "2021-12-01T11:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632582",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:58'></a>
I updated the description of the ticket to mention that more doctests will be run by default after #32174 which may lead to "new" bugs that were there before. That being said, I still don't know if the 89 + 63 fall in this category, because only 2 + 1 doctests are marked as `optional - latex` in those two files.

Also, it made me realize that there is a bug with `--show-skipped` which does not work correctly:
The fact that `2 latex tests not run`, `1 latex test not run` still appear is a bug, since those tests **are** run.



---

archive/issue_comments_632583.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -58,4 +58,4 @@\n Features detected for doctesting: latex\n ```\n \n-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.\n+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected. The fact that `1 latex test not run` still appear is a bug.\n``````\n",
    "created_at": "2021-12-01T11:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632583",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -58,4 +58,4 @@
 Features detected for doctesting: latex
 ```
 
-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.
+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected. The fact that `1 latex test not run` still appear is a bug.
``````




---

archive/issue_comments_632584.json:
```json
{
    "body": "<a id='comment:60'></a>\nThe 89 + 63 failures seems to be created by the current branch when looking at the patchbot report made by `vindelecroix-labri1` machine. But, when looking at the code of this ticket, I can't see anything which can explain those failures to appear. I am adding machine's owner in cc in case Vincent has an idea.\n\nMost of the machines are fine, so I am fine with putting the status back to positive review.\n\nOr do we want to mark those doctests as dependent on the external latex feature `cm-super`? That would rather be done in #32926.",
    "created_at": "2021-12-01T11:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632584",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:60'></a>
The 89 + 63 failures seems to be created by the current branch when looking at the patchbot report made by `vindelecroix-labri1` machine. But, when looking at the code of this ticket, I can't see anything which can explain those failures to appear. I am adding machine's owner in cc in case Vincent has an idea.

Most of the machines are fine, so I am fine with putting the status back to positive review.

Or do we want to mark those doctests as dependent on the external latex feature `cm-super`? That would rather be done in #32926.



---

archive/issue_comments_632585.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [slabbe](#comment%3A58):\n> Also, it made me realize that there is a bug with `--show-skipped` which does not work correctly:\n> The fact that `2 latex tests not run`, `1 latex test not run` still appear is a bug, since those tests **are** run.\n\n\nI am adding a commit to fix the issue with the `--show-skipped` report.\n\n---\nNew commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[cb13437](https://github.com/sagemath/sagetrac-mirror/commit/cb13437b602e3217c3df2290ad40a9f89741b783)|`32174: fix the --show-skipped doctest report`|",
    "created_at": "2021-12-01T13:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632585",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:61'></a>
Replying to [slabbe](#comment%3A58):
> Also, it made me realize that there is a bug with `--show-skipped` which does not work correctly:
> The fact that `2 latex tests not run`, `1 latex test not run` still appear is a bug, since those tests **are** run.


I am adding a commit to fix the issue with the `--show-skipped` report.

---
New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[cb13437](https://github.com/sagemath/sagetrac-mirror/commit/cb13437b602e3217c3df2290ad40a9f89741b783)|`32174: fix the --show-skipped doctest report`|



---

archive/issue_comments_632586.json:
```json
{
    "body": "Changing commit from \"07b2512e77df2923d85bda52d42537392ca6b338\" to \"cb13437b602e3217c3df2290ad40a9f89741b783\"",
    "created_at": "2021-12-01T13:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632586",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "07b2512e77df2923d85bda52d42537392ca6b338" to "cb13437b602e3217c3df2290ad40a9f89741b783"



---

archive/issue_comments_632587.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/doctests__detect__safe__external_features_even_if____optional_external__is_not_used\" to \"public/32174\"",
    "created_at": "2021-12-01T13:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632587",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "u/mkoeppe/doctests__detect__safe__external_features_even_if____optional_external__is_not_used" to "public/32174"



---

archive/issue_comments_632588.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,12 +44,10 @@\n Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex\n Doctesting 2 files using 8 threads.\n sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py\n-    2 latex tests not run\n     3 not tested tests not run\n     0 tests not run because we ran out of time\n     [407 tests, 34.35 s]\n sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py\n-    1 latex test not run\n     0 tests not run because we ran out of time\n     [462 tests, 57.75 s]\n ----------------------------------------------------------------------\n@@ -58,4 +56,4 @@\n Features detected for doctesting: latex\n ```\n \n-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected. The fact that `1 latex test not run` still appear is a bug.\n+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.\n``````\n",
    "created_at": "2021-12-01T13:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632588",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,12 +44,10 @@
 Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex
 Doctesting 2 files using 8 threads.
 sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py
-    2 latex tests not run
     3 not tested tests not run
     0 tests not run because we ran out of time
     [407 tests, 34.35 s]
 sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py
-    1 latex test not run
     0 tests not run because we ran out of time
     [462 tests, 57.75 s]
 ----------------------------------------------------------------------
@@ -58,4 +56,4 @@
 Features detected for doctesting: latex
 ```
 
-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected. The fact that `1 latex test not run` still appear is a bug.
+We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.
``````




---

archive/issue_comments_632589.json:
```json
{
    "body": "<a id='comment:63'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[391dca1](https://github.com/sagemath/sagetrac-mirror/commit/391dca19bf3cd61c148f99027fb7983bbdaef3bd)|`sage.misc.latex.png: Mark doctest # optional - imagemagick`|",
    "created_at": "2021-12-01T17:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[391dca1](https://github.com/sagemath/sagetrac-mirror/commit/391dca19bf3cd61c148f99027fb7983bbdaef3bd)|`sage.misc.latex.png: Mark doctest # optional - imagemagick`|



---

archive/issue_comments_632590.json:
```json
{
    "body": "Changing commit from \"cb13437b602e3217c3df2290ad40a9f89741b783\" to \"391dca19bf3cd61c148f99027fb7983bbdaef3bd\"",
    "created_at": "2021-12-01T17:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb13437b602e3217c3df2290ad40a9f89741b783" to "391dca19bf3cd61c148f99027fb7983bbdaef3bd"



---

archive/issue_comments_632591.json:
```json
{
    "body": "<a id='comment:64'></a>\nCherry-picked from #32926.",
    "created_at": "2021-12-01T17:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632591",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>
Cherry-picked from #32926.



---

archive/issue_comments_632592.json:
```json
{
    "body": "Changing commit from \"391dca19bf3cd61c148f99027fb7983bbdaef3bd\" to \"6f311b311e44def63f21ed4524d5e76f753f3be7\"",
    "created_at": "2021-12-01T17:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "391dca19bf3cd61c148f99027fb7983bbdaef3bd" to "6f311b311e44def63f21ed4524d5e76f753f3be7"



---

archive/issue_comments_632593.json:
```json
{
    "body": "<a id='comment:65'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[6f311b3](https://github.com/sagemath/sagetrac-mirror/commit/6f311b311e44def63f21ed4524d5e76f753f3be7)|`src/sage/doctest/external.py: Revert latex features to 'external'`|",
    "created_at": "2021-12-01T17:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[6f311b3](https://github.com/sagemath/sagetrac-mirror/commit/6f311b311e44def63f21ed4524d5e76f753f3be7)|`src/sage/doctest/external.py: Revert latex features to 'external'`|



---

archive/issue_comments_632594.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-12-01T17:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632594",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_632595.json:
```json
{
    "body": "<a id='comment:66'></a>\nIn order to get this ticket in, I have now reduced the scope, keeping the latex features as `external`. In a follow-up ticket, we can work on improving the `# optional` tags.",
    "created_at": "2021-12-01T17:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632595",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
In order to get this ticket in, I have now reduced the scope, keeping the latex features as `external`. In a follow-up ticket, we can work on improving the `# optional` tags.



---

archive/issue_comments_632596.json:
```json
{
    "body": "<a id='comment:67'></a>\nupdated the example in the description of the ticket to be based on pandoc instead of latex",
    "created_at": "2021-12-01T17:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632596",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:67'></a>
updated the example in the description of the ticket to be based on pandoc instead of latex



---

archive/issue_comments_632597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n For example, let's compare the behavior of the following command:\n \n ```\n-$ sage -tp --long --show-skipped src/sage/plot/plot.py src/sage/plot/graphics.py\n+sage -tp --show-skipped src/sage/tests/cmdline.py \n ```\n \n returns:\n@@ -21,16 +21,14 @@\n ```\n Git branch: develop\n Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg\n-Doctesting 2 files using 8 threads.\n-sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/graphics.py\n-    2 latex tests not run\n-    3 not tested tests not run\n+Doctesting 1 file using 8 threads.\n+sage -t --random-seed=265206128165572261397002909756599539048 src/sage/tests/cmdline.py\n+    3 gdb tests not run\n+    12 internet tests not run\n+    2 pandoc tests not run\n+    4 r tests not run\n     0 tests not run because we ran out of time\n-    [405 tests, 33.39 s]\n-sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/plot.py\n-    1 latex test not run\n-    0 tests not run because we ran out of time\n-    [461 tests, 57.38 s]\n+    [235 tests, 30.65 s]\n ----------------------------------------------------------------------\n All tests passed!\n ----------------------------------------------------------------------\n@@ -39,21 +37,32 @@\n AFTER (9.5.beta7 + #32174):\n \n ```\n+$ sage -tp --show-skipped src/sage/tests/cmdline.py \n Git branch: 32174\n Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\n-Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex\n-Doctesting 2 files using 8 threads.\n-sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py\n-    3 not tested tests not run\n+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib\n+Doctesting 1 file using 8 threads.\n+sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py\n+**********************************************************************\n+File \"src/sage/tests/cmdline.py\", line 732, in sage.tests.cmdline.test_executable\n+Failed example:\n+    print(open(output, 'r').read() == t)          # optional - pandoc\n+Expected:\n+    True\n+Got:\n+    False\n+**********************************************************************\n+1 item had failures:\n+   1 of 238 in sage.tests.cmdline.test_executable\n+    3 gdb tests not run\n+    12 internet tests not run\n+    4 r tests not run\n     0 tests not run because we ran out of time\n-    [407 tests, 34.35 s]\n-sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py\n-    0 tests not run because we ran out of time\n-    [462 tests, 57.75 s]\n+    [237 tests, 1 failure, 32.76 s]\n ----------------------------------------------------------------------\n-All tests passed!\n+sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py  # 1 doctest failed\n ----------------------------------------------------------------------\n-Features detected for doctesting: latex\n+Features detected for doctesting: pandoc\n ```\n \n-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.\n+We observe that the number of tests run went from 235 to 237, because the feature pandoc was detected. Note that the doctest failure is already tracked at #32697.\n``````\n",
    "created_at": "2021-12-01T17:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632597",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 For example, let's compare the behavior of the following command:
 
 ```
-$ sage -tp --long --show-skipped src/sage/plot/plot.py src/sage/plot/graphics.py
+sage -tp --show-skipped src/sage/tests/cmdline.py 
 ```
 
 returns:
@@ -21,16 +21,14 @@
 ```
 Git branch: develop
 Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_numerical_backends_coin,sage_spkg
-Doctesting 2 files using 8 threads.
-sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/graphics.py
-    2 latex tests not run
-    3 not tested tests not run
+Doctesting 1 file using 8 threads.
+sage -t --random-seed=265206128165572261397002909756599539048 src/sage/tests/cmdline.py
+    3 gdb tests not run
+    12 internet tests not run
+    2 pandoc tests not run
+    4 r tests not run
     0 tests not run because we ran out of time
-    [405 tests, 33.39 s]
-sage -t --long --random-seed=120175723758312766297483571135112496058 src/sage/plot/plot.py
-    1 latex test not run
-    0 tests not run because we ran out of time
-    [461 tests, 57.38 s]
+    [235 tests, 30.65 s]
 ----------------------------------------------------------------------
 All tests passed!
 ----------------------------------------------------------------------
@@ -39,21 +37,32 @@
 AFTER (9.5.beta7 + #32174):
 
 ```
+$ sage -tp --show-skipped src/sage/tests/cmdline.py 
 Git branch: 32174
 Using --optional=4ti2,build,ccache,cryptominisat,debian,dochtml,dot2tex,e_antic,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
-Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex
-Doctesting 2 files using 8 threads.
-sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/graphics.py
-    3 not tested tests not run
+Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib
+Doctesting 1 file using 8 threads.
+sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py
+**********************************************************************
+File "src/sage/tests/cmdline.py", line 732, in sage.tests.cmdline.test_executable
+Failed example:
+    print(open(output, 'r').read() == t)          # optional - pandoc
+Expected:
+    True
+Got:
+    False
+**********************************************************************
+1 item had failures:
+   1 of 238 in sage.tests.cmdline.test_executable
+    3 gdb tests not run
+    12 internet tests not run
+    4 r tests not run
     0 tests not run because we ran out of time
-    [407 tests, 34.35 s]
-sage -t --long --random-seed=67779290317494917173046340853116306275 src/sage/plot/plot.py
-    0 tests not run because we ran out of time
-    [462 tests, 57.75 s]
+    [237 tests, 1 failure, 32.76 s]
 ----------------------------------------------------------------------
-All tests passed!
+sage -t --random-seed=100100306103974678574881156032164018710 src/sage/tests/cmdline.py  # 1 doctest failed
 ----------------------------------------------------------------------
-Features detected for doctesting: latex
+Features detected for doctesting: pandoc
 ```
 
-We observe that the number of tests run went from 405 to 407 and from 461 to 462, because the feature latex was detected.
+We observe that the number of tests run went from 235 to 237, because the feature pandoc was detected. Note that the doctest failure is already tracked at #32697.
``````




---

archive/issue_comments_632598.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [mkoeppe](#comment%3A66):\n> In a follow-up ticket, we can work on improving the `# optional` tags.\n\n\nThis is now #32955.",
    "created_at": "2021-12-01T17:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632598",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Replying to [mkoeppe](#comment%3A66):
> In a follow-up ticket, we can work on improving the `# optional` tags.


This is now #32955.



---

archive/issue_comments_632599.json:
```json
{
    "body": "<a id='comment:69'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[3bfe1a1](https://github.com/sagemath/sagetrac-mirror/commit/3bfe1a14fbce31550866a1d4b393ec076e344592)|`32174: adapting the doctest listing external softwares`|",
    "created_at": "2021-12-01T18:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[3bfe1a1](https://github.com/sagemath/sagetrac-mirror/commit/3bfe1a14fbce31550866a1d4b393ec076e344592)|`32174: adapting the doctest listing external softwares`|



---

archive/issue_comments_632600.json:
```json
{
    "body": "Changing commit from \"6f311b311e44def63f21ed4524d5e76f753f3be7\" to \"3bfe1a14fbce31550866a1d4b393ec076e344592\"",
    "created_at": "2021-12-01T18:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6f311b311e44def63f21ed4524d5e76f753f3be7" to "3bfe1a14fbce31550866a1d4b393ec076e344592"



---

archive/issue_comments_632601.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"Matthias Koeppe, S\u00e9bastien Labb\u00e9\"",
    "created_at": "2021-12-01T18:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632601",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe" to "Matthias Koeppe, Sébastien Labbé"



---

archive/issue_comments_632602.json:
```json
{
    "body": "<a id='comment:71'></a>\nI started a re-run of all tests on my machine. Will report later.\n\n`@`Matthias: Sorry for having re-open this ticket earlier today. It was having a positive review for 7 days. I should have open another ticket instead I think. I hope it will not delay the entry of this ticket into sage since many other tickets depend on it. I will stay close to it to not add anymore delay.",
    "created_at": "2021-12-01T18:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632602",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:71'></a>
I started a re-run of all tests on my machine. Will report later.

`@`Matthias: Sorry for having re-open this ticket earlier today. It was having a positive review for 7 days. I should have open another ticket instead I think. I hope it will not delay the entry of this ticket into sage since many other tickets depend on it. I will stay close to it to not add anymore delay.



---

archive/issue_comments_632603.json:
```json
{
    "body": "<a id='comment:72'></a>\nNo worries, and thanks for all your work!",
    "created_at": "2021-12-01T18:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632603",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>
No worries, and thanks for all your work!



---

archive/issue_comments_632604.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [slabbe](#comment%3A71):\n> I started a re-run of all tests on my machine. Will report later.\n\n\nOn my machine running optional and external doctests on top of 9.5.beta7 returns:\n\n```\n----------------------------------------------------------------------\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/generic_graph.py  # 2 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/databases/findstat.py  # 9 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/tests/cmdline.py  # 10 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/graph.py  # 3 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/interfaces/fricas.py  # 1 doctest failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/sat/solvers/dimacs.py  # 2 doctests failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed\nsage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/finance/stock.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 2664.6 seconds\n    cpu time: 16553.0 seconds\n    cumulative wall time: 20701.4 seconds\nFeatures detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,internet,latex,lualatex,octave,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex\n```\n\nwhich has no more failures than what I reported for [9.5.beta7 on sage-release](https://groups.google.com/g/sage-release/c/FXpakLURP_0).\n\nI am waiting for the patchbot to finish.",
    "created_at": "2021-12-01T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632604",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:73'></a>
Replying to [slabbe](#comment%3A71):
> I started a re-run of all tests on my machine. Will report later.


On my machine running optional and external doctests on top of 9.5.beta7 returns:

```
----------------------------------------------------------------------
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/generic_graph.py  # 2 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/databases/findstat.py  # 9 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/tests/cmdline.py  # 10 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/graphs/graph.py  # 3 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/interfaces/fricas.py  # 1 doctest failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/sat/solvers/dimacs.py  # 2 doctests failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/combinat/designs/incidence_structures.py  # 1 doctest failed
sage -t --long --random-seed=199830843512308713498063069261640048262 src/sage/finance/stock.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 2664.6 seconds
    cpu time: 16553.0 seconds
    cumulative wall time: 20701.4 seconds
Features detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,internet,latex,lualatex,octave,pandoc,pdf2svg,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex
```

which has no more failures than what I reported for [9.5.beta7 on sage-release](https://groups.google.com/g/sage-release/c/FXpakLURP_0).

I am waiting for the patchbot to finish.



---

archive/issue_comments_632605.json:
```json
{
    "body": "<a id='comment:74'></a>\nThe patchbot `panke` finished its tests. It has only one failure which is exactly the one given in the description of this ticket which I repeat is already tracked at #32697:\n\n```\nsage -t --long --random-seed=318717441882109214278396779393985383988 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 732, in sage.tests.cmdline.test_executable\nFailed example:\n    print(open(output, 'r').read() == t)          # optional - pandoc\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of 223 in sage.tests.cmdline.test_executable\n    [222 tests, 1 failure, 57.81 s]\n```\n\nFrom me it is a positive review. Next stuff to be checked are\n- whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? personnaly, I am not even sure). That being said Vincent is gone for vacation for 4 weeks, so we might not want to wait for an answer.\n- whether it works on Volker's machine (normally this was fixed by 07b2512)",
    "created_at": "2021-12-02T09:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632605",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:74'></a>
The patchbot `panke` finished its tests. It has only one failure which is exactly the one given in the description of this ticket which I repeat is already tracked at #32697:

```
sage -t --long --random-seed=318717441882109214278396779393985383988 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 732, in sage.tests.cmdline.test_executable
Failed example:
    print(open(output, 'r').read() == t)          # optional - pandoc
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of 223 in sage.tests.cmdline.test_executable
    [222 tests, 1 failure, 57.81 s]
```

From me it is a positive review. Next stuff to be checked are
- whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? personnaly, I am not even sure). That being said Vincent is gone for vacation for 4 weeks, so we might not want to wait for an answer.
- whether it works on Volker's machine (normally this was fixed by 07b2512)



---

archive/issue_comments_632606.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [slabbe](#comment%3A74):\n> - whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? \n\n\nWell, these tests are `# optional - latex`, and `latex` is now no longer automatically added unless `external` is in use.",
    "created_at": "2021-12-02T18:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632606",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
Replying to [slabbe](#comment%3A74):
> - whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? 


Well, these tests are `# optional - latex`, and `latex` is now no longer automatically added unless `external` is in use.



---

archive/issue_comments_632607.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [mkoeppe](#comment%3A75):\n> Replying to [slabbe](#comment%3A74):\n> > - whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? \n \n> \n> Well, these tests are `# optional - latex`, and `latex` is now no longer automatically added unless `external` is in use.\n\n\nNo, only very few of them are marked as `# optional - latex`, maybe two of them if I well remember.",
    "created_at": "2021-12-02T20:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632607",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:76'></a>
Replying to [mkoeppe](#comment%3A75):
> Replying to [slabbe](#comment%3A74):
> > - whether it works on `vindelecroix-labri1` machine (are the 63 + 89 failures gone with the last changes by Matthias? 
 
> 
> Well, these tests are `# optional - latex`, and `latex` is now no longer automatically added unless `external` is in use.


No, only very few of them are marked as `# optional - latex`, maybe two of them if I well remember.



---

archive/issue_comments_632608.json:
```json
{
    "body": "<a id='comment:77'></a>\nThanks for the correction.",
    "created_at": "2021-12-03T00:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632608",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>
Thanks for the correction.



---

archive/issue_comments_632609.json:
```json
{
    "body": "<a id='comment:78'></a>\nI think we will not have answers from Vincent as he is on vacation. A solution to this weird problem seen on `vdelecroix-labri1` patchbot is suggested in comment #32174#comment:57 (install cm-super).\n\nI change the status to positive review.",
    "created_at": "2021-12-03T08:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632609",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:78'></a>
I think we will not have answers from Vincent as he is on vacation. A solution to this weird problem seen on `vdelecroix-labri1` patchbot is suggested in comment #32174#comment:57 (install cm-super).

I change the status to positive review.



---

archive/issue_comments_632610.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T08:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632610",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_632611.json:
```json
{
    "body": "<a id='comment:79'></a>\nThanks!",
    "created_at": "2021-12-04T00:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632611",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>
Thanks!



---

archive/issue_comments_632612.json:
```json
{
    "body": "<a id='comment:80'></a>\nStill fails:\n\n```\nsage -t --long --warn-long 42.3 --random-seed=269228488280518602699863791762785215883 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 732, in sage.tests.cmdline.test_executable\nFailed example:\n    print(open(output, 'r').read() == t)          # optional - pandoc\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of 223 in sage.tests.cmdline.test_executable\n    [222 tests, 1 failure, 39.52 s]\n```",
    "created_at": "2021-12-05T15:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632612",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:80'></a>
Still fails:

```
sage -t --long --warn-long 42.3 --random-seed=269228488280518602699863791762785215883 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 732, in sage.tests.cmdline.test_executable
Failed example:
    print(open(output, 'r').read() == t)          # optional - pandoc
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of 223 in sage.tests.cmdline.test_executable
    [222 tests, 1 failure, 39.52 s]
```



---

archive/issue_comments_632613.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-05T15:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632613",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_632614.json:
```json
{
    "body": "<a id='comment:81'></a>\nthat's #32697 \"`sage --ipynb2rst` is broken due to changes in `nbconvert`",
    "created_at": "2021-12-05T17:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632614",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>
that's #32697 "`sage --ipynb2rst` is broken due to changes in `nbconvert`



---

archive/issue_comments_632615.json:
```json
{
    "body": "Changing commit from \"3bfe1a14fbce31550866a1d4b393ec076e344592\" to \"fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3\"",
    "created_at": "2021-12-05T18:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3bfe1a14fbce31550866a1d4b393ec076e344592" to "fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3"



---

archive/issue_comments_632616.json:
```json
{
    "body": "<a id='comment:82'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[fdfe1a7](https://github.com/sagemath/sagetrac-mirror/commit/fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3)|`src/sage/tests/cmdline.py: Mark a doctest # known bug #32697`|",
    "created_at": "2021-12-05T18:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[fdfe1a7](https://github.com/sagemath/sagetrac-mirror/commit/fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3)|`src/sage/tests/cmdline.py: Mark a doctest # known bug #32697`|



---

archive/issue_comments_632617.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-05T18:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632617",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_632618.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-05T19:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632618",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_632619.json:
```json
{
    "body": "<a id='comment:85'></a>\nThanks!",
    "created_at": "2021-12-05T20:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632619",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'></a>
Thanks!



---

archive/issue_comments_632620.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-16T23:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632620",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_632621.json:
```json
{
    "body": "<a id='comment:86'></a>\n\n```\n**********************************************************************\nFile \"src/sage/misc/latex.py\", line 1087, in sage.misc.latex.Latex.?\nFailed example:\n    latex.eval(r\"\\ThisIsAnInvalidCommand\", {}) # optional -- ImageMagick\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.latex.Latex.?[1]>\", line 1, in <module>\n        latex.eval(r\"\\ThisIsAnInvalidCommand\", {}) # optional -- ImageMagick\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/misc/latex.py\", line 1128, in eval\n        e = _run_latex_(os.path.join(base, filename + \".tex\"), debug=debug,\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/misc/latex.py\", line 725, in _run_latex_\n        pdflatex().require()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/features/__init__.py\", line 206, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: pdflatex is not available.\n    Executable 'pdflatex' not found on PATH.\n    Further installation instructions might be available at https://www.latex-project.org/.\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.misc.latex.Latex.?\n    [250 tests, 1 failure, 0.35 s]\n    Timed out\n**********************************************************************\n```",
    "created_at": "2021-12-16T23:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632621",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:86'></a>

```
**********************************************************************
File "src/sage/misc/latex.py", line 1087, in sage.misc.latex.Latex.?
Failed example:
    latex.eval(r"\ThisIsAnInvalidCommand", {}) # optional -- ImageMagick
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.latex.Latex.?[1]>", line 1, in <module>
        latex.eval(r"\ThisIsAnInvalidCommand", {}) # optional -- ImageMagick
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/misc/latex.py", line 1128, in eval
        e = _run_latex_(os.path.join(base, filename + ".tex"), debug=debug,
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/misc/latex.py", line 725, in _run_latex_
        pdflatex().require()
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/features/__init__.py", line 206, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: pdflatex is not available.
    Executable 'pdflatex' not found on PATH.
    Further installation instructions might be available at https://www.latex-project.org/.
**********************************************************************
1 item had failures:
   1 of   3 in sage.misc.latex.Latex.?
    [250 tests, 1 failure, 0.35 s]
    Timed out
**********************************************************************
```



---

archive/issue_comments_632622.json:
```json
{
    "body": "<a id='comment:87'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[8f5c962](https://github.com/sagemath/sagetrac-mirror/commit/8f5c9624f7e5b38b36f646dfbd5b653d571c154a)|`Merge tag '9.5.beta8' into t/32174/public/32174`|\n|[41c4cd4](https://github.com/sagemath/sagetrac-mirror/commit/41c4cd4917a1f513f995054da47b30edf19ddad1)|`src/sage/misc/latex.py: Add another # optional - latex`|",
    "created_at": "2021-12-17T00:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632622",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:87'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[8f5c962](https://github.com/sagemath/sagetrac-mirror/commit/8f5c9624f7e5b38b36f646dfbd5b653d571c154a)|`Merge tag '9.5.beta8' into t/32174/public/32174`|
|[41c4cd4](https://github.com/sagemath/sagetrac-mirror/commit/41c4cd4917a1f513f995054da47b30edf19ddad1)|`src/sage/misc/latex.py: Add another # optional - latex`|



---

archive/issue_comments_632623.json:
```json
{
    "body": "Changing commit from \"fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3\" to \"41c4cd4917a1f513f995054da47b30edf19ddad1\"",
    "created_at": "2021-12-17T00:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fdfe1a7e03d3bd32e9433cdb164ce013a6d0dfd3" to "41c4cd4917a1f513f995054da47b30edf19ddad1"



---

archive/issue_comments_632624.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-12-17T00:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632624",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_632625.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-19T11:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632625",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_103768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-19T11:46:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32174#event-103768"
}
```



---

archive/issue_comments_632626.json:
```json
{
    "body": "Changing branch from \"public/32174\" to \"41c4cd4917a1f513f995054da47b30edf19ddad1\"",
    "created_at": "2021-12-19T11:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632626",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/32174" to "41c4cd4917a1f513f995054da47b30edf19ddad1"



---

archive/issue_comments_632627.json:
```json
{
    "body": "Changing commit from \"41c4cd4917a1f513f995054da47b30edf19ddad1\" to \"\"",
    "created_at": "2021-12-19T11:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632627",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "41c4cd4917a1f513f995054da47b30edf19ddad1" to ""



---

archive/issue_comments_632628.json:
```json
{
    "body": "<a id='comment:90'></a>\nFollowup at #33045 for ffmpeg",
    "created_at": "2021-12-19T11:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632628",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:90'></a>
Followup at #33045 for ffmpeg



---

archive/issue_comments_632629.json:
```json
{
    "body": "<a id='comment:91'></a>\nFollowup at #33101 for lrslib.",
    "created_at": "2022-01-01T19:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632629",
    "user": "https://github.com/slel"
}
```

<a id='comment:91'></a>
Followup at #33101 for lrslib.



---

archive/issue_comments_632630.json:
```json
{
    "body": "<a id='comment:92'></a>\nSee also #33092 for ffmpeg and imagemagick.",
    "created_at": "2022-01-01T19:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32174#issuecomment-632630",
    "user": "https://github.com/slel"
}
```

<a id='comment:92'></a>
See also #33092 for ffmpeg and imagemagick.
