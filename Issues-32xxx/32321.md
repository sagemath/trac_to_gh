# Issue 32321: Make is_prime() return true for rational numbers that are prime as integers

archive/issues_032084.json:
```json
{
    "assignees": [],
    "body": "**Note:** The patch has changed since this description was written. Instead of redefining `Rational.is_prime()`, it now changes only the global `is_prime()` *function*. See the discussion below.\n\n---\n\nUsing `is_prime()` on rational numbers currently always returns `False`. This patch implements an `is_prime()` method for rationals that returns `True` iff the rational is a prime integer.\n\nI know it's debatable what the correct behaviour *should* be in this case, but here are three arguments in favour of this change:\n\n* It's what number fields already do:\n\n  ```\n  sage: K.<t> = NumberField(x**2+1)\n  sage: K(7).is_prime()\n  True\n  ```\n  In other words, Sage's definition of prime elements in a number field is already different from the definition of prime elements in a general ring. There doesn't seem to be a good reason why we can't also change it for rationals.\n\n* The current behaviour can cause significant headache: Just having one `/` anywhere in a long sequence of operations turns everything into `QQ`s, which makes primality testing fail unconditionally later on. I've personally programmed quite a few infinite loops due to this kind of heisenbug, and I know others who've fallen prey to the same issue.\n  \n  On the flipside, there appears to be no reason anyone would *want* to intentionally invoke the current implementation of the function, as it's just a convoluted way of writing `False`. Indeed, in support of this theory, none of the existing doctests relied on the current behaviour.\n\n* The documentation of the global `is_prime()` function, which calls into the argument's `.is_prime()` method, currently states: \"Return `True` if `n` is a prime number\". This is again a matter of interpretation, but I suspect many people would think that `QQ(5)` is as much a \"prime number\" as `ZZ(5)` is.\n\nDiscussion:\n\n- [sage-devel, 2021-08-01, is 7/1 a prime?](https://groups.google.com/g/sage-devel/c/uq03mQ-rt3g)\n\nCC:  @slel\n\nKeywords: **rationals, integers, primality**\n\nBranch/Commit: **[public/make_is_prime_work_for_integral_rationals](https://github.com/sagemath/sagetrac-mirror/tree/public/make_is_prime_work_for_integral_rationals) @ [42795ff](https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b)**\n\nReviewer: **Kwankyu Lee**\n\nAuthor: **Lorenz Panny**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32321_\n\n",
    "closed_at": "2022-11-14T19:36:43Z",
    "created_at": "2021-08-01T07:19:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make is_prime() return true for rational numbers that are prime as integers",
    "type": "issue",
    "updated_at": "2022-11-14T19:36:43Z",
    "url": "https://github.com/sagemath/sage/issues/32321",
    "user": "https://github.com/yyyyx4"
}
```
**Note:** The patch has changed since this description was written. Instead of redefining `Rational.is_prime()`, it now changes only the global `is_prime()` *function*. See the discussion below.

---

Using `is_prime()` on rational numbers currently always returns `False`. This patch implements an `is_prime()` method for rationals that returns `True` iff the rational is a prime integer.

I know it's debatable what the correct behaviour *should* be in this case, but here are three arguments in favour of this change:

* It's what number fields already do:

  ```
  sage: K.<t> = NumberField(x**2+1)
  sage: K(7).is_prime()
  True
  ```
  In other words, Sage's definition of prime elements in a number field is already different from the definition of prime elements in a general ring. There doesn't seem to be a good reason why we can't also change it for rationals.

* The current behaviour can cause significant headache: Just having one `/` anywhere in a long sequence of operations turns everything into `QQ`s, which makes primality testing fail unconditionally later on. I've personally programmed quite a few infinite loops due to this kind of heisenbug, and I know others who've fallen prey to the same issue.
  
  On the flipside, there appears to be no reason anyone would *want* to intentionally invoke the current implementation of the function, as it's just a convoluted way of writing `False`. Indeed, in support of this theory, none of the existing doctests relied on the current behaviour.

* The documentation of the global `is_prime()` function, which calls into the argument's `.is_prime()` method, currently states: "Return `True` if `n` is a prime number". This is again a matter of interpretation, but I suspect many people would think that `QQ(5)` is as much a "prime number" as `ZZ(5)` is.

Discussion:

- [sage-devel, 2021-08-01, is 7/1 a prime?](https://groups.google.com/g/sage-devel/c/uq03mQ-rt3g)

CC:  @slel

Keywords: **rationals, integers, primality**

Branch/Commit: **[public/make_is_prime_work_for_integral_rationals](https://github.com/sagemath/sagetrac-mirror/tree/public/make_is_prime_work_for_integral_rationals) @ [42795ff](https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b)**

Reviewer: **Kwankyu Lee**

Author: **Lorenz Panny**

_Issue created by migration from https://trac.sagemath.org/ticket/32321_





---

archive/issue_events_413301.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-08-01T07:19:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413301"
}
```



---

archive/issue_events_413302.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-08-01T07:19:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413302"
}
```



---

archive/issue_events_413303.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-08-01T07:19:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413303"
}
```



---

archive/issue_events_413304.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-08-01T07:19:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413304"
}
```



---

archive/issue_comments_523561.json:
```json
{
    "body": "Reviewer: **Samuel Leli\u00e8vre**",
    "created_at": "2021-08-01T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523561",
    "user": "https://github.com/slel"
}
```

Reviewer: **Samuel Leli√®vre**



---

archive/issue_comments_523562.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI agree making `is_prime` return `True` for prime integers,\neven if represented as rationals, has merit.\n\nI disagree with calling `-3` or `-7` non-prime.",
    "created_at": "2021-08-01T13:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523562",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'>Comment 2:</a>
I agree making `is_prime` return `True` for prime integers,
even if represented as rationals, has merit.

I disagree with calling `-3` or `-7` non-prime.



---

archive/issue_events_413305.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-08-01T13:39:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413305"
}
```



---

archive/issue_events_413306.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-08-01T13:39:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413306"
}
```



---

archive/issue_comments_523563.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThis deserves starting a discussion on sage-devel\nand advertising it on sage-nt.",
    "created_at": "2021-08-01T13:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523563",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'>Comment 3:</a>
This deserves starting a discussion on sage-devel
and advertising it on sage-nt.



---

archive/issue_events_413307.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-08-01T13:39:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "title_is": "Make is_prime() return true for rational numbers that are prime as integers",
    "title_was": "is_prime() always returns False for rational numbers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413307"
}
```



---

archive/issue_comments_523564.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI agree that `-7` is prime, but I'm not sure about `-3`. (Just kidding.)\n\nThis patch simply reduces `is_prime` for `QQ` to `is_prime` on `ZZ`. Changing the behaviour of `is_prime` on negative integers feels somewhat orthogonal, and I expect this to be more controversial and more likely to break existing software (it contradicts currently documented behaviour). Practically speaking, my guess would be that anyone who really needs negative integers to be prime is already computing with ideals anyway.\n\nI'd suggest keeping this patch as is and discussing the primality of negative integers in a new ticket.",
    "created_at": "2021-08-01T16:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523564",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:4'>Comment 4:</a>
I agree that `-7` is prime, but I'm not sure about `-3`. (Just kidding.)

This patch simply reduces `is_prime` for `QQ` to `is_prime` on `ZZ`. Changing the behaviour of `is_prime` on negative integers feels somewhat orthogonal, and I expect this to be more controversial and more likely to break existing software (it contradicts currently documented behaviour). Practically speaking, my guess would be that anyone who really needs negative integers to be prime is already computing with ideals anyway.

I'd suggest keeping this patch as is and discussing the primality of negative integers in a new ticket.



---

archive/issue_comments_523565.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nNonzero elements in QQ are not primes because they are units: if you take QQ/3QQ, you get the zero ring, which is not an integral domain. On the other hand, ZZ/(-3ZZ) is an integral domain, so negative integers can be primes.\n\nThe definition on number fields is indeed a bit problematic.\n\nFor the second argument mentioned in the ticket description: Python and Sage do have multiple division operations. The operator `//` will perform an integer division (and `%` produces the corresponding remainder, so if you need both you should call a routine that returns both at once.\n\nIf the behaviour of the global `is_prime` is confusing, it would need to be fixed and documented (i.e., \"if `is_prime` is passed a rational number that can be converted to an integer, it will be converted to an integer before its primeness is determined. An error is raised if a rational number is passed in that does not lie in the integers\")",
    "created_at": "2021-08-01T17:06:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523565",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'>Comment 5:</a>
Nonzero elements in QQ are not primes because they are units: if you take QQ/3QQ, you get the zero ring, which is not an integral domain. On the other hand, ZZ/(-3ZZ) is an integral domain, so negative integers can be primes.

The definition on number fields is indeed a bit problematic.

For the second argument mentioned in the ticket description: Python and Sage do have multiple division operations. The operator `//` will perform an integer division (and `%` produces the corresponding remainder, so if you need both you should call a routine that returns both at once.

If the behaviour of the global `is_prime` is confusing, it would need to be fixed and documented (i.e., "if `is_prime` is passed a rational number that can be converted to an integer, it will be converted to an integer before its primeness is determined. An error is raised if a rational number is passed in that does not lie in the integers")



---

archive/issue_comments_523566.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,3 +16,7 @@\n   On the flipside, there appears to be no reason anyone would *want* to intentionally invoke the current implementation of the function, as it's just a convoluted way of writing `False`. Indeed, in support of this theory, none of the existing doctests relied on the current behaviour.\n \n * The documentation of the global `is_prime()` function, which calls into the argument's `.is_prime()` method, currently states: \"Return `True` if `n` is a prime number\". This is again a matter of interpretation, but I suspect many people would think that `QQ(5)` is as much a \"prime number\" as `ZZ(5)` is.\n+\n+Discussion:\n+\n+- [sage-devel, 2021-08-01, is 7/1 a prime?](https://groups.google.com/g/sage-devel/c/uq03mQ-rt3g)\n``````\n",
    "created_at": "2021-08-01T18:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523566",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,3 +16,7 @@
   On the flipside, there appears to be no reason anyone would *want* to intentionally invoke the current implementation of the function, as it's just a convoluted way of writing `False`. Indeed, in support of this theory, none of the existing doctests relied on the current behaviour.
 
 * The documentation of the global `is_prime()` function, which calls into the argument's `.is_prime()` method, currently states: "Return `True` if `n` is a prime number". This is again a matter of interpretation, but I suspect many people would think that `QQ(5)` is as much a "prime number" as `ZZ(5)` is.
+
+Discussion:
+
+- [sage-devel, 2021-08-01, is 7/1 a prime?](https://groups.google.com/g/sage-devel/c/uq03mQ-rt3g)
``````




---

archive/issue_comments_523567.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThanks for emailing sage-devel.\n\nLeaving out the case of negative numbers here seems right.",
    "created_at": "2021-08-01T18:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523567",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'>Comment 6:</a>
Thanks for emailing sage-devel.

Leaving out the case of negative numbers here seems right.



---

archive/issue_comments_523568.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThis has been discussed 3 years ago: [see this sage-devel thread](https://groups.google.com/g/sage-devel/c/NN0VP-OVZLw/m/xgbA73PsBAAJ). The conclusion was that the behavior should be kept but should produce a warning!",
    "created_at": "2021-08-01T21:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523568",
    "user": "https://github.com/soehms"
}
```

<a id='comment:7'>Comment 7:</a>
This has been discussed 3 years ago: [see this sage-devel thread](https://groups.google.com/g/sage-devel/c/NN0VP-OVZLw/m/xgbA73PsBAAJ). The conclusion was that the behavior should be kept but should produce a warning!



---

archive/issue_comments_523569.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks for your responses. The linked email thread makes it obvious that there won't be universal consensus about this.\n\nThe behavior of `.is_prime()` in number fields follows from the fact that `NumberField`s override most of the ideal machinery with fractional ideals, which is mathematically \"wrong\" in a very similar way as `QQ(5).is_prime()` is. Fixing *that* is guaranteed to break lots of existing code, though; see for example comment 14 of #7596. So number fields are allowed to violate the general `Ring` interface for convenience, but `QQ` \u2014 despite *being* a number field \u2014 isn't?\n\nTo reiterate:\n* **Any code that relies on the current behavior is already broken** (namely, for number fields).\n* I expect the proportion of users for whom this change will make things worse to be zero.\n\nThat said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.",
    "created_at": "2021-08-02T10:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523569",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks for your responses. The linked email thread makes it obvious that there won't be universal consensus about this.

The behavior of `.is_prime()` in number fields follows from the fact that `NumberField`s override most of the ideal machinery with fractional ideals, which is mathematically "wrong" in a very similar way as `QQ(5).is_prime()` is. Fixing *that* is guaranteed to break lots of existing code, though; see for example comment 14 of #7596. So number fields are allowed to violate the general `Ring` interface for convenience, but `QQ` ‚Äî despite *being* a number field ‚Äî isn't?

To reiterate:
* **Any code that relies on the current behavior is already broken** (namely, for number fields).
* I expect the proportion of users for whom this change will make things worse to be zero.

That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.



---

archive/issue_comments_523570.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@yyyyx4](#comment%3A8):\n\n> That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.\n\nIf the name of the function would be `is_prime_number` I would agree. But as long as it could be interpreted in the sense of `is_prime_element`, too, I don't think that it would make things better. It would only change the asumption about the context in which the adjective `prime` is used. My suggestion in the thread linked above was:\n\n> Deprecation of \"is_prime\" as function (not as method!!! since there is no ambiguity here) and replace it by two new functions \"is_prime_number\" and \"is_prime_element\" (according to the corresponding Wikipedia articles). The first function should try to coerce the input into ZZ and raise an error if this it not possible or not positive. The second one should raise an error if the input is not an element of a unital commutative ring and a warning in the case the ring is a field (according to #25046).",
    "created_at": "2021-08-02T15:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523570",
    "user": "https://github.com/soehms"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@yyyyx4](#comment%3A8):

> That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.

If the name of the function would be `is_prime_number` I would agree. But as long as it could be interpreted in the sense of `is_prime_element`, too, I don't think that it would make things better. It would only change the asumption about the context in which the adjective `prime` is used. My suggestion in the thread linked above was:

> Deprecation of "is_prime" as function (not as method!!! since there is no ambiguity here) and replace it by two new functions "is_prime_number" and "is_prime_element" (according to the corresponding Wikipedia articles). The first function should try to coerce the input into ZZ and raise an error if this it not possible or not positive. The second one should raise an error if the input is not an element of a unital commutative ring and a warning in the case the ring is a field (according to #25046).



---

archive/issue_comments_523571.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@yyyyx4](#comment%3A8):\n> The behavior of `.is_prime()` in number fields follows from the fact that `NumberField`s override most of the ideal machinery with fractional ideals, which is mathematically \"wrong\" in a very similar way as `QQ(5).is_prime()` is. Fixing *that* is guaranteed to break lots of existing code, though; see for example comment 14 of #7596. So number fields are allowed to violate the general `Ring` interface for convenience, but `QQ` \u2014 despite *being* a number field \u2014 isn't?\n\nI don't think all that much high-quality code will be asking of *elements* of number fields whether they are prime: I'd expect that question will mainly be asked of fractional ideals (which, in the case of number fields are indeed often conflated with integral ideals). But expectations about what users do (and how they perceive changes!) is often wrong.\n\nRegardless of what the behaviour of `is_prime` on number field elements should be, it presently definitely has confusing documentation because it presently doesn't clarify whether it uses \"ideal\" in the sense of fractional ideal or as ideal of the ring of integers. In fact, the documentation *literally* says:\n\n```\nIn fields, an element is never prime::\n```\nThe documentation of `NumberField.ideal` clarifies that ideals in NumberFields are fractional ideals relative to the ring of integers, but that is not referred to in `is_prime`. This is a problem if you inherit from a superclass (Rings in this case), but then don't compatibly implement all the related protocols (here, replacing ideals with fractional ideals). It means there are all kind of routines that may *seem* like they are inherited properly, but are not. In this case, it's the documentation that breaks :-).\n\nIn principle, `QQ(a).is_prime` could be documented analogously to say it returns 'True\" if `a` generates a fractional ideal that is a prime ideal in ZZ. I still think that would be wrong because the `(5/3).is_prime()` would almost certainly result from an error of the user, where `5/3` is the result of an expression that was meant to result in an integer.\n\n> That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.\n\n+1 for that. That is in step with its documentation already.",
    "created_at": "2021-08-02T16:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523571",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@yyyyx4](#comment%3A8):
> The behavior of `.is_prime()` in number fields follows from the fact that `NumberField`s override most of the ideal machinery with fractional ideals, which is mathematically "wrong" in a very similar way as `QQ(5).is_prime()` is. Fixing *that* is guaranteed to break lots of existing code, though; see for example comment 14 of #7596. So number fields are allowed to violate the general `Ring` interface for convenience, but `QQ` ‚Äî despite *being* a number field ‚Äî isn't?

I don't think all that much high-quality code will be asking of *elements* of number fields whether they are prime: I'd expect that question will mainly be asked of fractional ideals (which, in the case of number fields are indeed often conflated with integral ideals). But expectations about what users do (and how they perceive changes!) is often wrong.

Regardless of what the behaviour of `is_prime` on number field elements should be, it presently definitely has confusing documentation because it presently doesn't clarify whether it uses "ideal" in the sense of fractional ideal or as ideal of the ring of integers. In fact, the documentation *literally* says:

```
In fields, an element is never prime::
```
The documentation of `NumberField.ideal` clarifies that ideals in NumberFields are fractional ideals relative to the ring of integers, but that is not referred to in `is_prime`. This is a problem if you inherit from a superclass (Rings in this case), but then don't compatibly implement all the related protocols (here, replacing ideals with fractional ideals). It means there are all kind of routines that may *seem* like they are inherited properly, but are not. In this case, it's the documentation that breaks :-).

In principle, `QQ(a).is_prime` could be documented analogously to say it returns 'True" if `a` generates a fractional ideal that is a prime ideal in ZZ. I still think that would be wrong because the `(5/3).is_prime()` would almost certainly result from an error of the user, where `5/3` is the result of an expression that was meant to result in an integer.

> That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.

+1 for that. That is in step with its documentation already.



---

archive/issue_comments_523572.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0e1a62dfbe70d692bb78cf80fece8dd5ea1e18d\">e0e1a62</a></td><td><code>Revert \"make is_prime() work for integral rationals\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b\">42795ff</a></td><td><code>restrict the global is_prime() function to integers</code></td></tr></table>\n",
    "created_at": "2021-08-05T10:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523572",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0e1a62dfbe70d692bb78cf80fece8dd5ea1e18d">e0e1a62</a></td><td><code>Revert "make is_prime() work for integral rationals"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b">42795ff</a></td><td><code>restrict the global is_prime() function to integers</code></td></tr></table>




---

archive/issue_comments_523573.json:
```json
{
    "body": "Changed commit from **[b007b30](https://github.com/sagemath/sagetrac-mirror/commit/b007b30f771cbd068b615ec76212044c4126b7ed)** to **[42795ff](https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b)**",
    "created_at": "2021-08-05T10:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523573",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b007b30](https://github.com/sagemath/sagetrac-mirror/commit/b007b30f771cbd068b615ec76212044c4126b7ed)** to **[42795ff](https://github.com/sagemath/sagetrac-mirror/commit/42795ff9f23efdf4ded68e2074e00caaba0c3d0b)**



---

archive/issue_comments_523574.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@soehms](#comment%3A9):\n> > Deprecation of \"is_prime\" as function (not as method!!! since there is no ambiguity here) and replace it by two new functions \"is_prime_number\" and \"is_prime_element\" (according to the corresponding Wikipedia articles).\n\nI think this would make things worse for everyone:\n* Non-algebraists will type `is_prime()` without even realizing this is ambiguous, then be confused about why the function doesn't exist, then be confused about which of the two similarly-named functions they want (especially given that they behave identically in many cases they might try out!).\n\n* Some algebraists may disagree with `is_prime()` being a function that's restricted to integers, but they'll easily remember this and that's the end of the story. I imagine the extra keystrokes of having to type `_number` every time they really just want to test an integer for primality would be much more annoying to everyone than the cognitive dissonance resulting from the name being *wrong*.\n\n\nReplying to [@nbruin](#comment%3A10):\n> Replying to [@yyyyx4](#comment%3A8):\n> > That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.\n\n> \n> +1 for that. That is in step with its documentation already.\n\nThanks. I've updated the patch to leave `Rational.is_prime()` alone and change only the global `is_prime()` function instead.",
    "created_at": "2021-08-05T10:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523574",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@soehms](#comment%3A9):
> > Deprecation of "is_prime" as function (not as method!!! since there is no ambiguity here) and replace it by two new functions "is_prime_number" and "is_prime_element" (according to the corresponding Wikipedia articles).

I think this would make things worse for everyone:
* Non-algebraists will type `is_prime()` without even realizing this is ambiguous, then be confused about why the function doesn't exist, then be confused about which of the two similarly-named functions they want (especially given that they behave identically in many cases they might try out!).

* Some algebraists may disagree with `is_prime()` being a function that's restricted to integers, but they'll easily remember this and that's the end of the story. I imagine the extra keystrokes of having to type `_number` every time they really just want to test an integer for primality would be much more annoying to everyone than the cognitive dissonance resulting from the name being *wrong*.


Replying to [@nbruin](#comment%3A10):
> Replying to [@yyyyx4](#comment%3A8):
> > That said, I would personally be fine with making the global `is_prime()` coerce everything into `ZZ` and throw errors if this is impossible. Presumably though, effects like `is_prime(4/2) != (4/2).is_prime()` would be controversial.

> 
> +1 for that. That is in step with its documentation already.

Thanks. I've updated the patch to leave `Rational.is_prime()` alone and change only the global `is_prime()` function instead.



---

archive/issue_comments_523575.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@yyyyx4](#comment%3A12):\n> Replying to [@soehms](#comment%3A9):\n> * Some algebraists may disagree with `is_prime()` being a function that's restricted to integers, but they'll easily remember this and that's the end of the story.\n\nBut probably some more may disagree if answers like this are going to change:\n\n```sage\nsage: is_prime(5 + O(7^20))                                                                                                                                                                          \nFalse\nsage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      \nTrue\n```",
    "created_at": "2021-08-06T21:29:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523575",
    "user": "https://github.com/soehms"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@yyyyx4](#comment%3A12):
> Replying to [@soehms](#comment%3A9):
> * Some algebraists may disagree with `is_prime()` being a function that's restricted to integers, but they'll easily remember this and that's the end of the story.

But probably some more may disagree if answers like this are going to change:

```sage
sage: is_prime(5 + O(7^20))                                                                                                                                                                          
False
sage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      
True
```



---

archive/issue_comments_523576.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@soehms](#comment%3A13):\n> But probably some more may disagree if answers like this are going to change:\n> \n> ```sage\n> sage: is_prime(5 + O(7^20))                                                                                                                                                                          \n> False\n> sage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      \n> True\n> ```\n\nWould you be happier with the proposed change if we first issued a deprecation warning in `is_prime()` when non\u2011`Integer`s are passed, then made the change after a few releases?",
    "created_at": "2021-08-19T14:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523576",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@soehms](#comment%3A13):
> But probably some more may disagree if answers like this are going to change:
> 
> ```sage
> sage: is_prime(5 + O(7^20))                                                                                                                                                                          
> False
> sage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      
> True
> ```

Would you be happier with the proposed change if we first issued a deprecation warning in `is_prime()` when non‚Äë`Integer`s are passed, then made the change after a few releases?



---

archive/issue_comments_523577.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@yyyyx4](#comment%3A14):\n> Replying to [@soehms](#comment%3A13):\n> > But probably some more may disagree if answers like this are going to change:\n> > \n> > ```sage\n> > sage: is_prime(5 + O(7^20))                                                                                                                                                                          \n> > False\n> > sage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      \n> > True\n> > ```\n\n> \n> Would you be happier with the proposed change if we first issued a deprecation warning in `is_prime()` when non\u2011`Integer`s are passed, then made the change after a few releases?\n\n\nIn a former post you mentioned users that are not aware of the ambiguity. IMHO, whatever solution you may find here, one aim must be that these people have learned about this ambiguity after applying the function in such a situation. Otherwise, Sage did a bad job on its educational mission. \n\nI can agree to any solution, that still makes the user become aware of that, but more comfortably as it is currently. Did you already think about a once per session warning, as suggested in the 2018 sage-devel thread (see for example #25046)?\n\nAnyway, I think the participants of the 2018 discussion should have a chance to be involved in the decisions that will be done here.",
    "created_at": "2021-08-30T17:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523577",
    "user": "https://github.com/soehms"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@yyyyx4](#comment%3A14):
> Replying to [@soehms](#comment%3A13):
> > But probably some more may disagree if answers like this are going to change:
> > 
> > ```sage
> > sage: is_prime(5 + O(7^20))                                                                                                                                                                          
> > False
> > sage: is_prime(ZZ(5 + O(7^20)))                                                                                                                                                                      
> > True
> > ```

> 
> Would you be happier with the proposed change if we first issued a deprecation warning in `is_prime()` when non‚Äë`Integer`s are passed, then made the change after a few releases?


In a former post you mentioned users that are not aware of the ambiguity. IMHO, whatever solution you may find here, one aim must be that these people have learned about this ambiguity after applying the function in such a situation. Otherwise, Sage did a bad job on its educational mission. 

I can agree to any solution, that still makes the user become aware of that, but more comfortably as it is currently. Did you already think about a once per session warning, as suggested in the 2018 sage-devel thread (see for example #25046)?

Anyway, I think the participants of the 2018 discussion should have a chance to be involved in the decisions that will be done here.



---

archive/issue_comments_523578.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+**Note:** The patch has changed since this description was written. Instead of redefining `Rational.is_prime()`, it now changes only the global `is_prime()` *function*. See the discussion below.\n+\n+---\n+\n Using `is_prime()` on rational numbers currently always returns `False`. This patch implements an `is_prime()` method for rationals that returns `True` iff the rational is a prime integer.\n \n I know it's debatable what the correct behaviour *should* be in this case, but here are three arguments in favour of this change:\n``````\n",
    "created_at": "2021-08-31T06:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523578",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+**Note:** The patch has changed since this description was written. Instead of redefining `Rational.is_prime()`, it now changes only the global `is_prime()` *function*. See the discussion below.
+
+---
+
 Using `is_prime()` on rational numbers currently always returns `False`. This patch implements an `is_prime()` method for rationals that returns `True` iff the rational is a prime integer.
 
 I know it's debatable what the correct behaviour *should* be in this case, but here are three arguments in favour of this change:
``````




---

archive/issue_comments_523579.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nFor what it is worth: I am in favour of is_prime_number to return True in ZZ or QQ if it is a positive prime and is_prime_element in any ring to test for that property. For number fields is_prime_ideal.",
    "created_at": "2021-08-31T09:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523579",
    "user": "https://github.com/categorie"
}
```

<a id='comment:17'>Comment 17:</a>
For what it is worth: I am in favour of is_prime_number to return True in ZZ or QQ if it is a positive prime and is_prime_element in any ring to test for that property. For number fields is_prime_ideal.



---

archive/issue_comments_523580.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nThe old behavior has been there a long time.  I only see soehms mentioning the warning proposal of #25046, but that probably should be discussed more here.",
    "created_at": "2021-08-31T10:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523580",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'>Comment 18:</a>
The old behavior has been there a long time.  I only see soehms mentioning the warning proposal of #25046, but that probably should be discussed more here.



---

archive/issue_events_413308.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-10-14T05:37:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413308"
}
```



---

archive/issue_comments_523581.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI had a shot at #25046.\n\nGiven that there clearly won't be any consensus on changing the behaviour of `is_prime()`, I think this can be closed.",
    "created_at": "2021-10-14T05:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523581",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:19'>Comment 19:</a>
I had a shot at #25046.

Given that there clearly won't be any consensus on changing the behaviour of `is_prime()`, I think this can be closed.



---

archive/issue_events_413309.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-09-23T02:32:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413309"
}
```



---

archive/issue_events_413310.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-09-23T02:32:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413310"
}
```



---

archive/issue_comments_523582.json:
```json
{
    "body": "Changed reviewer from **Samuel Leli\u00e8vre** to **Kwankyu Lee**",
    "created_at": "2022-09-23T02:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523582",
    "user": "https://github.com/kwankyu"
}
```

Changed reviewer from **Samuel Leli√®vre** to **Kwankyu Lee**



---

archive/issue_comments_523583.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\n#25046 is the final solution for this long standing discussion.\n\nI agree to closing this ticket.",
    "created_at": "2022-09-23T02:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32321#issuecomment-523583",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:20'>Comment 20:</a>
#25046 is the final solution for this long standing discussion.

I agree to closing this ticket.



---

archive/issue_events_413311.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413311"
}
```



---

archive/issue_events_413312.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32321",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32321#event-413312"
}
```
