# Issue 32774: Bug in continued fraction doctest

archive/issues_032537.json:
```json
{
    "body": "Part of #32544:\n\n```\nsage -t --long --random-seed=77478494819088915365500074763386376542 src/sage/rings/continued_fraction.py\n**********************************************************************\nFile \"src/sage/rings/continued_fraction.py\", line 265, in sage.rings.continued_fraction.rat_interval_cf_list\nFailed example:\n    for prec in range(10,54):\n        R = RealIntervalField(20)\n        for _ in range(100):\n            x = R.random_element() * R.random_element() + R.random_element() / 100\n            l = x.lower().exact_rational()\n            u = x.upper().exact_rational()\n            cf = rat_interval_cf_list(l,u)\n            a = continued_fraction(cf).value()\n            b = continued_fraction(cf+[1]).value()\n            if a > b:\n                a,b = b,a\n            assert a <= l\n            assert b >= u\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.continued_fraction.rat_interval_cf_list[2]>\", line 8, in <module>\n        a = continued_fraction(cf).value()\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py\", line 2625, in continued_fraction\n        x1, x2 = check_and_reduce_pair(x)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py\", line 2254, in check_and_reduce_pair\n        raise ValueError(\"continued fraction can not represent infinity\")\n    ValueError: continued fraction can not represent infinity\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.rings.continued_fraction.rat_interval_cf_list\n    [437 tests, 1 failure, 5.09 s]\n-------------------------------------------------------------\n```\n\nBranch/Commit: e1664fff95fb671e91bc41737518f7442dd4690f\n\nReviewer: Kwankyu Lee\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32774\n\n",
    "closed_at": "2021-10-31T22:20:36Z",
    "created_at": "2021-10-26T09:46:38Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Bug in continued fraction doctest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32774",
    "user": "https://github.com/kliem"
}
```
Part of #32544:

```
sage -t --long --random-seed=77478494819088915365500074763386376542 src/sage/rings/continued_fraction.py
**********************************************************************
File "src/sage/rings/continued_fraction.py", line 265, in sage.rings.continued_fraction.rat_interval_cf_list
Failed example:
    for prec in range(10,54):
        R = RealIntervalField(20)
        for _ in range(100):
            x = R.random_element() * R.random_element() + R.random_element() / 100
            l = x.lower().exact_rational()
            u = x.upper().exact_rational()
            cf = rat_interval_cf_list(l,u)
            a = continued_fraction(cf).value()
            b = continued_fraction(cf+[1]).value()
            if a > b:
                a,b = b,a
            assert a <= l
            assert b >= u
Exception raised:
    Traceback (most recent call last):
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.continued_fraction.rat_interval_cf_list[2]>", line 8, in <module>
        a = continued_fraction(cf).value()
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py", line 2625, in continued_fraction
        x1, x2 = check_and_reduce_pair(x)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py", line 2254, in check_and_reduce_pair
        raise ValueError("continued fraction can not represent infinity")
    ValueError: continued fraction can not represent infinity
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.continued_fraction.rat_interval_cf_list
    [437 tests, 1 failure, 5.09 s]
-------------------------------------------------------------
```

Branch/Commit: e1664fff95fb671e91bc41737518f7442dd4690f

Reviewer: Kwankyu Lee

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32774





---

archive/issue_comments_645217.json:
```json
{
    "body": "Changing branch from \"\" to \"public/32544\"",
    "created_at": "2021-10-26T10:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645217",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/32544"



---

archive/issue_comments_645218.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-26T10:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645218",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_645219.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2021-10-26T10:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645219",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_645220.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe doctest assumes that two rational numbers that are close enough have the same `floor`, which needs not to hold.",
    "created_at": "2021-10-26T10:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645220",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
The doctest assumes that two rational numbers that are close enough have the same `floor`, which needs not to hold.



---

archive/issue_comments_645221.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[fcf0f14](https://github.com/sagemath/sagetrac-mirror/commit/fcf0f142e3e43f113ee359ef0d7821176f09cb98)|`fix doctest of rat_interval_cf_list`|",
    "created_at": "2021-10-26T10:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645221",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[fcf0f14](https://github.com/sagemath/sagetrac-mirror/commit/fcf0f142e3e43f113ee359ef0d7821176f09cb98)|`fix doctest of rat_interval_cf_list`|



---

archive/issue_comments_645222.json:
```json
{
    "body": "Changing commit from \"\" to \"fcf0f142e3e43f113ee359ef0d7821176f09cb98\"",
    "created_at": "2021-10-26T10:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645222",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "fcf0f142e3e43f113ee359ef0d7821176f09cb98"



---

archive/issue_comments_645223.json:
```json
{
    "body": "Changing branch from \"public/32544\" to \"public/32774\"",
    "created_at": "2021-10-26T10:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645223",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/32544" to "public/32774"



---

archive/issue_comments_645224.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe doctest is still strange in that `prec` is not used.",
    "created_at": "2021-10-28T03:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645224",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>
The doctest is still strange in that `prec` is not used.



---

archive/issue_events_105451.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "rename": {
        "from": "Bug in continue fraction doctest",
        "to": "Bug in continued fraction doctest"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32774#event-105451"
}
```



---

archive/issue_comments_645225.json:
```json
{
    "body": "Changing commit from \"fcf0f142e3e43f113ee359ef0d7821176f09cb98\" to \"e1664fff95fb671e91bc41737518f7442dd4690f\"",
    "created_at": "2021-10-28T06:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fcf0f142e3e43f113ee359ef0d7821176f09cb98" to "e1664fff95fb671e91bc41737518f7442dd4690f"



---

archive/issue_comments_645226.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[e1664ff](https://github.com/sagemath/sagetrac-mirror/commit/e1664fff95fb671e91bc41737518f7442dd4690f)|`use different precisions in doctest`|",
    "created_at": "2021-10-28T06:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[e1664ff](https://github.com/sagemath/sagetrac-mirror/commit/e1664fff95fb671e91bc41737518f7442dd4690f)|`use different precisions in doctest`|



---

archive/issue_comments_645227.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kwankyu Lee\"",
    "created_at": "2021-10-29T05:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645227",
    "user": "https://github.com/kwankyu"
}
```

Changing reviewer from "" to "Kwankyu Lee"



---

archive/issue_comments_645228.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good.",
    "created_at": "2021-10-29T05:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645228",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>
Looks good.



---

archive/issue_comments_645229.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-29T05:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645229",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_645230.json:
```json
{
    "body": "<a id='comment:8'></a>\nThank you.",
    "created_at": "2021-10-29T06:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645230",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
Thank you.



---

archive/issue_comments_645231.json:
```json
{
    "body": "Changing branch from \"public/32774\" to \"e1664fff95fb671e91bc41737518f7442dd4690f\"",
    "created_at": "2021-10-31T22:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645231",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/32774" to "e1664fff95fb671e91bc41737518f7442dd4690f"



---

archive/issue_comments_645232.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-31T22:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32774#issuecomment-645232",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_105452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-31T22:20:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32774",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32774#event-105452"
}
```
