# Issue 32703: GH Actions (macOS): Run a job for "make build-local" first, cache image for job "make build"

archive/issues_032466.json:
```json
{
    "assignees": [],
    "body": "We revise the GH Actions workflows to use a 2-stage build:\nIn the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.\n\n(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n- Sage distribution, classic\n- Sage distribution with `configure --enable-editable`\n- Sage distribution with `configure --enable-system-site-packages` (#29665)\n- the configurations from pkgs/**sagemath-standard**/tox.ini\n- build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)\n\n(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.\n\n(+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit\n\n(-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n\nIn this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n\nAs of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n\nWe also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.\n\n\n\nDepends on #32113\nDepends on #32947\n\nCC:  @tobiasdiez @kliem @orlitzky @isuruf\n\nBranch/Commit: **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **porting**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32703_\n\n",
    "closed_at": "2022-01-01T00:23:33Z",
    "created_at": "2021-10-16T19:03:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GH Actions (macOS): Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "type": "issue",
    "updated_at": "2022-01-01T00:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/32703",
    "user": "https://github.com/mkoeppe"
}
```
We revise the GH Actions workflows to use a 2-stage build:
In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.

(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts
- Sage distribution, classic
- Sage distribution with `configure --enable-editable`
- Sage distribution with `configure --enable-system-site-packages` (#29665)
- the configurations from pkgs/**sagemath-standard**/tox.ini
- build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)

(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.

(+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit

(-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed

In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.

As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.

We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.



Depends on #32113
Depends on #32947

CC:  @tobiasdiez @kliem @orlitzky @isuruf

Branch/Commit: **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **porting**

_Issue created by migration from https://trac.sagemath.org/ticket/32703_





---

archive/issue_events_447201.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447201"
}
```



---

archive/issue_events_447202.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting",
    "label_color": "0000b0",
    "label_name": "c: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447202"
}
```



---

archive/issue_events_447203.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447203"
}
```



---

archive/issue_events_447204.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447204"
}
```



---

archive/issue_comments_527497.json:
```json
{
    "body": "Dependencies: **#31535**",
    "created_at": "2021-10-16T20:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527497",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31535**



---

archive/issue_events_447205.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T00:01:35Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "title_is": "GH Actions: Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "title_was": "GH Actions: In tox-docker, run a job for \"make build-local\" first, cache image for job \"make build\"",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447205"
}
```



---

archive/issue_comments_527498.json:
```json
{
    "body": "Branch: **[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)**",
    "created_at": "2021-10-17T01:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527498",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)**



---

archive/issue_comments_527499.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/1350377940**",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527499",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/1350377940**



---

archive/issue_comments_527500.json:
```json
{
    "body": "Commit: **[`d08452c`](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)**",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527500",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`d08452c`](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)**



---

archive/issue_comments_527501.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498\"><code>2101b8c</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e\"><code>3bbc5d8</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Set rpath</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/124b6059e4c942e785797c32116b027694634432\"><code>124b605</code></a></td><td><code>Merge #32698</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bca214134dc225603801470f7bb2999e9e6bdbca\"><code>bca2141</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdbab3aca65138c1a80009c546df53af04d740f6\"><code>bdbab3a</code></a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63e47ffb14a31944760dc2e0a54c6eae64202746\"><code>63e47ff</code></a></td><td><code>Merge #31535</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c40d1cab6e03c48e86fdf33ec7a534e906c3d6b\"><code>1c40d1c</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dee3f41fd0c7e84030e0f7bfd000a363279b41f1\"><code>dee3f41</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd9fad10a76581453b54da8085aaa9f879334a8c\"><code>bd9fad1</code></a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278\"><code>d08452c</code></a></td><td><code>Update systems</code></td></tr></table>\n",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527501",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498"><code>2101b8c</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e"><code>3bbc5d8</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Set rpath</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/124b6059e4c942e785797c32116b027694634432"><code>124b605</code></a></td><td><code>Merge #32698</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bca214134dc225603801470f7bb2999e9e6bdbca"><code>bca2141</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdbab3aca65138c1a80009c546df53af04d740f6"><code>bdbab3a</code></a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63e47ffb14a31944760dc2e0a54c6eae64202746"><code>63e47ff</code></a></td><td><code>Merge #31535</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c40d1cab6e03c48e86fdf33ec7a534e906c3d6b"><code>1c40d1c</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dee3f41fd0c7e84030e0f7bfd000a363279b41f1"><code>dee3f41</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd9fad10a76581453b54da8085aaa9f879334a8c"><code>bd9fad1</code></a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278"><code>d08452c</code></a></td><td><code>Update systems</code></td></tr></table>




---

archive/issue_comments_527502.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1350377940** to **https://github.com/mkoeppe/sage/actions/runs/1350710395**",
    "created_at": "2021-10-17T05:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527502",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1350377940** to **https://github.com/mkoeppe/sage/actions/runs/1350710395**



---

archive/issue_comments_527503.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454\"><code>0799c5f</code></a></td><td><code>.github/workflows/tox.yml: Fixup for macOS tar</code></td></tr></table>\n",
    "created_at": "2021-10-17T05:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527503",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454"><code>0799c5f</code></a></td><td><code>.github/workflows/tox.yml: Fixup for macOS tar</code></td></tr></table>




---

archive/issue_comments_527504.json:
```json
{
    "body": "Changed commit from **[`d08452c`](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)** to **[`0799c5f`](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)**",
    "created_at": "2021-10-17T05:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527504",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d08452c`](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)** to **[`0799c5f`](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)**



---

archive/issue_comments_527505.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7\"><code>e031622</code></a></td><td><code>.github/workflows/tox.yml: Fix up upload path</code></td></tr></table>\n",
    "created_at": "2021-10-17T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527505",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7"><code>e031622</code></a></td><td><code>.github/workflows/tox.yml: Fix up upload path</code></td></tr></table>




---

archive/issue_comments_527506.json:
```json
{
    "body": "Changed commit from **[`0799c5f`](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)** to **[`e031622`](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)**",
    "created_at": "2021-10-17T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527506",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0799c5f`](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)** to **[`e031622`](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)**



---

archive/issue_comments_527507.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346\"><code>a40d706</code></a></td><td><code>.github/workflows/tox.yml: Do not use /tmp for artifacts to avoid https://github.com/actions/upload-artifact/issues/92</code></td></tr></table>\n",
    "created_at": "2021-10-17T23:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527507",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346"><code>a40d706</code></a></td><td><code>.github/workflows/tox.yml: Do not use /tmp for artifacts to avoid https://github.com/actions/upload-artifact/issues/92</code></td></tr></table>




---

archive/issue_comments_527508.json:
```json
{
    "body": "Changed commit from **[`e031622`](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)** to **[`a40d706`](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)**",
    "created_at": "2021-10-17T23:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527508",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e031622`](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)** to **[`a40d706`](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)**



---

archive/issue_comments_527509.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2bc150816cad560130cd511df122c81ad19c44\"><code>dd2bc15</code></a></td><td><code>.github/workflows/tox.yml: Use env.GITHUB_WORKSPACE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff\"><code>2b46f02</code></a></td><td><code>.github/workflows/tox.yml: Use sage-local-artifact/ as path</code></td></tr></table>\n",
    "created_at": "2021-10-18T19:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527509",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2bc150816cad560130cd511df122c81ad19c44"><code>dd2bc15</code></a></td><td><code>.github/workflows/tox.yml: Use env.GITHUB_WORKSPACE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff"><code>2b46f02</code></a></td><td><code>.github/workflows/tox.yml: Use sage-local-artifact/ as path</code></td></tr></table>




---

archive/issue_comments_527510.json:
```json
{
    "body": "Changed commit from **[`a40d706`](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)** to **[`2b46f02`](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)**",
    "created_at": "2021-10-18T19:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527510",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a40d706`](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)** to **[`2b46f02`](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)**



---

archive/issue_comments_527511.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1350710395** to **https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true**",
    "created_at": "2021-10-19T16:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527511",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1350710395** to **https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true**



---

archive/issue_comments_527512.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nworking well now",
    "created_at": "2021-10-19T16:01:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527512",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

working well now



---

archive/issue_comments_527513.json:
```json
{
    "body": "Changed commit from **[`2b46f02`](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)** to **[`4dcd768`](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)**",
    "created_at": "2021-10-19T17:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527513",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2b46f02`](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)** to **[`4dcd768`](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)**



---

archive/issue_comments_527514.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c\"><code>4dcd768</code></a></td><td><code>.github/workflows/tox.yml: mkdir</code></td></tr></table>\n",
    "created_at": "2021-10-19T17:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527514",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c"><code>4dcd768</code></a></td><td><code>.github/workflows/tox.yml: mkdir</code></td></tr></table>




---

archive/issue_comments_527515.json:
```json
{
    "body": "Changed commit from **[`4dcd768`](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)** to **[`828463d`](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)**",
    "created_at": "2021-10-19T17:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527515",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4dcd768`](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)** to **[`828463d`](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)**



---

archive/issue_comments_527516.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3\"><code>828463d</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr></table>\n",
    "created_at": "2021-10-19T17:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527516",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3"><code>828463d</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr></table>




---

archive/issue_comments_527517.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIf I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel. For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact. Maybe something like https://github.com/marketplace/actions/wait-for-check helps.",
    "created_at": "2021-10-19T17:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527517",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:14" align="right">comment:14</div>

If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel. For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact. Maybe something like https://github.com/marketplace/actions/wait-for-check helps.



---

archive/issue_comments_527518.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@tobiasdiez](#comment%3A14):\n> If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.\n\nYes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...\n\n> For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact.\n\nWell, they failed because the previous stage failed.",
    "created_at": "2021-10-19T17:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527518",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@tobiasdiez](#comment%3A14):
> If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.

Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...

> For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact.

Well, they failed because the previous stage failed.



---

archive/issue_comments_527519.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tobiasdiez](#comment%3A14):\n> Maybe something like https://github.com/marketplace/actions/wait-for-check helps.\n\nThanks for the pointer, we can look into using something like this",
    "created_at": "2021-10-19T17:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527519",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tobiasdiez](#comment%3A14):
> Maybe something like https://github.com/marketplace/actions/wait-for-check helps.

Thanks for the pointer, we can look into using something like this



---

archive/issue_comments_527520.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nTesting with integrated builds for the optional packages now at https://github.com/mkoeppe/sage/actions/runs/1360303527",
    "created_at": "2021-10-19T17:43:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527520",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Testing with integrated builds for the optional packages now at https://github.com/mkoeppe/sage/actions/runs/1360303527



---

archive/issue_comments_527521.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mkoeppe](#comment%3A15):\n> Replying to [@tobiasdiez](#comment%3A14):\n> > If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.\n\n> \n> Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...\n\nOkay, but isn't this a very fragile design? Imagine that you have exactly 5 matrix cases. So all of the stage 1 tasks start at the same time. Now if the last case exists slightly before the other 4, then the stage 2 for the other 4 may be invoked and now fail as their stage 1 is not yet finished. Also this would limit everything to mac, as on linux you have way more runners.",
    "created_at": "2021-10-19T21:06:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527521",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mkoeppe](#comment%3A15):
> Replying to [@tobiasdiez](#comment%3A14):
> > If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.

> 
> Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...

Okay, but isn't this a very fragile design? Imagine that you have exactly 5 matrix cases. So all of the stage 1 tasks start at the same time. Now if the last case exists slightly before the other 4, then the stage 2 for the other 4 may be invoked and now fail as their stage 1 is not yet finished. Also this would limit everything to mac, as on linux you have way more runners.



---

archive/issue_comments_527522.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@tobiasdiez](#comment%3A18):\n> Okay, but isn't this a very fragile design? \n\nYes",
    "created_at": "2021-10-19T21:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527522",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@tobiasdiez](#comment%3A18):
> Okay, but isn't this a very fragile design? 

Yes



---

archive/issue_comments_527523.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@tobiasdiez](#comment%3A18):\n> on linux you have way more runners.\n\nwe also have way more jobs...",
    "created_at": "2021-10-19T21:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527523",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@tobiasdiez](#comment%3A18):
> on linux you have way more runners.

we also have way more jobs...



---

archive/issue_comments_527524.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThen I would suggest using two jobs that wait using \"needs\" and accept the disadvantages that go with it. \n\n> Unfortunately, because \u200bbecause \"needs\" cannot depend on \"matrix\", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed \n\nI think this is also a more flexible design as the stage two matrix will probably have more options in the future (e.g. editable install, with/without prebuild wheels from pypi, pipenv).\nIn fact, for maximal flexibility do you think it makes sense too split it further into 3 stages:\n- Built all non-python packages (min/standard/max)\n- Built all python packages (standard, editable, prebuild wheels, pipenv)\n- Run doctests",
    "created_at": "2021-10-20T07:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527524",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:21" align="right">comment:21</div>

Then I would suggest using two jobs that wait using "needs" and accept the disadvantages that go with it. 

> Unfortunately, because ​because "needs" cannot depend on "matrix", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed 

I think this is also a more flexible design as the stage two matrix will probably have more options in the future (e.g. editable install, with/without prebuild wheels from pypi, pipenv).
In fact, for maximal flexibility do you think it makes sense too split it further into 3 stages:
- Built all non-python packages (min/standard/max)
- Built all python packages (standard, editable, prebuild wheels, pipenv)
- Run doctests



---

archive/issue_comments_527525.json:
```json
{
    "body": "Changed commit from **[`828463d`](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)** to **[`9404238`](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)**",
    "created_at": "2021-10-20T16:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527525",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`828463d`](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)** to **[`9404238`](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)**



---

archive/issue_comments_527526.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313dc82954af96b008a6795f3485e92a58f5545d\"><code>313dc82</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65f3155836a8b35400890e2d62172d24e6ceec27\"><code>65f3155</code></a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3aeedb2be37fb1a682d6468f419aee9b65133300\"><code>3aeedb2</code></a></td><td><code>Update systems</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63d0752ddf6049cc6d2f71ebddb9d6573c8ec221\"><code>63d0752</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82\"><code>9404238</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>\n",
    "created_at": "2021-10-20T16:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527526",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313dc82954af96b008a6795f3485e92a58f5545d"><code>313dc82</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65f3155836a8b35400890e2d62172d24e6ceec27"><code>65f3155</code></a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3aeedb2be37fb1a682d6468f419aee9b65133300"><code>3aeedb2</code></a></td><td><code>Update systems</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63d0752ddf6049cc6d2f71ebddb9d6573c8ec221"><code>63d0752</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82"><code>9404238</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>




---

archive/issue_comments_527527.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115\"><code>d09e275</code></a></td><td><code>Fixup</code></td></tr></table>\n",
    "created_at": "2021-10-20T16:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527527",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115"><code>d09e275</code></a></td><td><code>Fixup</code></td></tr></table>




---

archive/issue_comments_527528.json:
```json
{
    "body": "Changed commit from **[`9404238`](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)** to **[`d09e275`](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)**",
    "created_at": "2021-10-20T16:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527528",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9404238`](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)** to **[`d09e275`](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)**



---

archive/issue_comments_527529.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nYes, in stage 2 we can have all of these variants, next to the runs for the optional packages added in 313dc82\n\nWhether the doctest needs a separate stage remains to be seen; I think having it as part of the stage 2 builds will easily fit into the 6 hour limit in all variants.",
    "created_at": "2021-10-20T16:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527529",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Yes, in stage 2 we can have all of these variants, next to the runs for the optional packages added in 313dc82

Whether the doctest needs a separate stage remains to be seen; I think having it as part of the stage 2 builds will easily fit into the 6 hour limit in all variants.



---

archive/issue_comments_527530.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOptional packages working well now - https://github.com/mkoeppe/sage/actions/runs/1364372711",
    "created_at": "2021-10-21T02:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527530",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Optional packages working well now - https://github.com/mkoeppe/sage/actions/runs/1364372711



---

archive/issue_comments_527531.json:
```json
{
    "body": "Changed commit from **[`d09e275`](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)** to **[`9940993`](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)**",
    "created_at": "2021-10-21T19:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527531",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d09e275`](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)** to **[`9940993`](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)**



---

archive/issue_comments_527532.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ef2baa323bf78dc193eb63b493deb0cee39c35e\"><code>4ef2baa</code></a></td><td><code>build/make/Makefile.in: Add targets SPKG-sdist, SPKG-tox, SPKG-tox-% for script packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f621e319c9aad5acc334cce53b56e7c42203f56f\"><code>f621e31</code></a></td><td><code>tox.ini: Add local-conda-environment-src</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f27557da0b1fdfffe1843d9352d4482e3034e7\"><code>32f2755</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea69f60b89bdc343112d4a10c952e19a87c39f97\"><code>ea69f60</code></a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a9ab2ab0e202b16da2d0aad26719bd3ff0e9cb9\"><code>2a9ab2a</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1410dec68e76977d14fd730042d063a5b3bc2d3\"><code>e1410de</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1180c80827b50e6bcc64afbad6b995b94fe2218d\"><code>1180c80</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b28e85d2a45447e1b002c46fb20e2a1cb7f1aa59\"><code>b28e85d</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8\"><code>9940993</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527532",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ef2baa323bf78dc193eb63b493deb0cee39c35e"><code>4ef2baa</code></a></td><td><code>build/make/Makefile.in: Add targets SPKG-sdist, SPKG-tox, SPKG-tox-% for script packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f621e319c9aad5acc334cce53b56e7c42203f56f"><code>f621e31</code></a></td><td><code>tox.ini: Add local-conda-environment-src</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f27557da0b1fdfffe1843d9352d4482e3034e7"><code>32f2755</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea69f60b89bdc343112d4a10c952e19a87c39f97"><code>ea69f60</code></a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a9ab2ab0e202b16da2d0aad26719bd3ff0e9cb9"><code>2a9ab2a</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1410dec68e76977d14fd730042d063a5b3bc2d3"><code>e1410de</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1180c80827b50e6bcc64afbad6b995b94fe2218d"><code>1180c80</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b28e85d2a45447e1b002c46fb20e2a1cb7f1aa59"><code>b28e85d</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8"><code>9940993</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>




---

archive/issue_comments_527533.json:
```json
{
    "body": "Changed commit from **[`9940993`](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)** to **[`553dea4`](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)**",
    "created_at": "2021-10-21T19:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527533",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9940993`](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)** to **[`553dea4`](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)**



---

archive/issue_comments_527534.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64\"><code>553dea4</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527534",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64"><code>553dea4</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr></table>




---

archive/issue_comments_527535.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5\"><code>924d4e6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527535",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5"><code>924d4e6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_527536.json:
```json
{
    "body": "Changed commit from **[`553dea4`](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)** to **[`924d4e6`](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)**",
    "created_at": "2021-10-21T19:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527536",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`553dea4`](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)** to **[`924d4e6`](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)**



---

archive/issue_comments_527537.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true** to **https://github.com/mkoeppe/sage/actions/runs/1364372711**",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527537",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true** to **https://github.com/mkoeppe/sage/actions/runs/1364372711**



---

archive/issue_comments_527538.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,10 @@\n \n (-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n \n+In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n+\n+As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n+\n References\n - https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching\n \n``````\n",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527538",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,10 @@
 
 (-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed
 
+In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
+
+As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
+
 References
 - https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching
 
``````




---

archive/issue_events_447206.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-21T19:57:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447206"
}
```



---

archive/issue_comments_527539.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527539",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_527540.json:
```json
{
    "body": "Changed dependencies from **#31535** to none",
    "created_at": "2021-10-21T19:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527540",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31535** to none



---

archive/issue_comments_527541.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef7e478cd9de7c1be49e81f17f3404bd484556a6\"><code>ef7e478</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d943c03ccd5790685a6c160cafd6bc3001b6c901\"><code>d943c03</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e8994331692ad484b68e062b244a45948937ade\"><code>5e89943</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9d982305b8efa7e13070a7e164b302eb98d52aa\"><code>d9d9823</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/659d2a89c16a8fef461be8efe771dd0c995f36da\"><code>659d2a8</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4bd5016a952558fe56b1c1a5b6e73ee84850cc1\"><code>f4bd501</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585\"><code>7b15b44</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-10-21T20:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527541",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef7e478cd9de7c1be49e81f17f3404bd484556a6"><code>ef7e478</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d943c03ccd5790685a6c160cafd6bc3001b6c901"><code>d943c03</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e8994331692ad484b68e062b244a45948937ade"><code>5e89943</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9d982305b8efa7e13070a7e164b302eb98d52aa"><code>d9d9823</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/659d2a89c16a8fef461be8efe771dd0c995f36da"><code>659d2a8</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4bd5016a952558fe56b1c1a5b6e73ee84850cc1"><code>f4bd501</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585"><code>7b15b44</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_527542.json:
```json
{
    "body": "Changed commit from **[`924d4e6`](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)** to **[`7b15b44`](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)**",
    "created_at": "2021-10-21T20:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527542",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`924d4e6`](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)** to **[`7b15b44`](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)**



---

archive/issue_comments_527543.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nRebased away from #31535.",
    "created_at": "2021-10-21T20:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527543",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Rebased away from #31535.



---

archive/issue_comments_527544.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,20 @@\n-(+) On top of the built image containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n+We revise the GH Actions workflows to use a 2-stage build:\n+In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.\n+\n+(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n - Sage distribution, classic\n - Sage distribution with `configure --enable-editable`\n - Sage distribution with `configure --enable-system-site-packages` (#29665)\n - the configurations from pkgs/**sagemath-standard**/tox.ini\n - build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)\n \n+(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.\n+\n (+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit\n \n (-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n \n-In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n+In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n \n As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n \n``````\n",
    "created_at": "2021-10-21T20:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527544",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,20 @@
-(+) On top of the built image containing the full SAGE_LOCAL, we can test several ways to build the Python parts
+We revise the GH Actions workflows to use a 2-stage build:
+In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.
+
+(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts
 - Sage distribution, classic
 - Sage distribution with `configure --enable-editable`
 - Sage distribution with `configure --enable-system-site-packages` (#29665)
 - the configurations from pkgs/**sagemath-standard**/tox.ini
 - build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)
 
+(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.
+
 (+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit
 
 (-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed
 
-In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
+In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
 
 As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
 
``````




---

archive/issue_comments_527545.json:
```json
{
    "body": "Changed commit from **[`7b15b44`](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)** to **[`10de67a`](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)**",
    "created_at": "2021-12-19T01:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7b15b44`](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)** to **[`10de67a`](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)**



---

archive/issue_comments_527546.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/497682f918cb99d297a765adc3c370adaaadaaa2\"><code>497682f</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d\"><code>afbd4fa</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465\"><code>57884a6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b\"><code>49276f2</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b\"><code>c3e2467</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd\"><code>55c83f5</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481\"><code>10de67a</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-12-19T01:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527546",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/497682f918cb99d297a765adc3c370adaaadaaa2"><code>497682f</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d"><code>afbd4fa</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465"><code>57884a6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b"><code>49276f2</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b"><code>c3e2467</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd"><code>55c83f5</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481"><code>10de67a</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_527547.json:
```json
{
    "body": "Changed commit from **[`10de67a`](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)** to **[`8617b6f`](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)**",
    "created_at": "2021-12-19T02:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527547",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`10de67a`](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)** to **[`8617b6f`](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)**



---

archive/issue_comments_527548.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12\"><code>8617b6f</code></a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr></table>\n",
    "created_at": "2021-12-19T02:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527548",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12"><code>8617b6f</code></a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr></table>




---

archive/issue_comments_527549.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1364372711** to **https://github.com/mkoeppe/sage/actions/runs/1597453181**",
    "created_at": "2021-12-19T02:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527549",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1364372711** to **https://github.com/mkoeppe/sage/actions/runs/1597453181**



---

archive/issue_comments_527550.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e\"><code>2dee3f0</code></a></td><td><code>.github/workflows/tox.yml (macos): Remove max-parallel</code></td></tr></table>\n",
    "created_at": "2021-12-19T03:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527550",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e"><code>2dee3f0</code></a></td><td><code>.github/workflows/tox.yml (macos): Remove max-parallel</code></td></tr></table>




---

archive/issue_comments_527551.json:
```json
{
    "body": "Changed commit from **[`8617b6f`](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)** to **[`2dee3f0`](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)**",
    "created_at": "2021-12-19T03:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527551",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8617b6f`](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)** to **[`2dee3f0`](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)**



---

archive/issue_comments_527552.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nLooks like homebrew's `gcc` package no longer installs an unversioned `gfortran` binary\n\nhttps://github.com/mkoeppe/sage/runs/4572338375?check_suite_focus=true",
    "created_at": "2021-12-20T00:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527552",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Looks like homebrew's `gcc` package no longer installs an unversioned `gfortran` binary

https://github.com/mkoeppe/sage/runs/4572338375?check_suite_focus=true



---

archive/issue_comments_527553.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nAlso conda install fails early\n\nhttps://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true",
    "created_at": "2021-12-20T00:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527553",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Also conda install fails early

https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true



---

archive/issue_comments_527554.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@mkoeppe](#comment%3A39):\n> Also conda install fails early\n> \n> https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true\n\n(same as [#32113 comment:17](https://github.com/sagemath/sage/issues/32113#comment:17))",
    "created_at": "2021-12-20T06:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527554",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@mkoeppe](#comment%3A39):
> Also conda install fails early
> 
> https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true

(same as [#32113 comment:17](https://github.com/sagemath/sage/issues/32113#comment:17))



---

archive/issue_comments_527555.json:
```json
{
    "body": "Dependencies: **#32113**",
    "created_at": "2021-12-21T00:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527555",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#32113**



---

archive/issue_comments_527556.json:
```json
{
    "body": "Changed commit from **[`2dee3f0`](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)** to **[`6418579`](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)**",
    "created_at": "2021-12-21T03:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527556",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2dee3f0`](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)** to **[`6418579`](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)**



---

archive/issue_comments_527557.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43d481b01ee129eb5ffcf52b848012e648663a91\"><code>43d481b</code></a></td><td><code>bump to 0.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66821b0fd8b060d49fc2177f56ad79584f8ec0b\"><code>f66821b</code></a></td><td><code>cysignals are needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae37b4e39479f6592296e3502eabdc585af662a8\"><code>ae37b4e</code></a></td><td><code>deprecate sage.interfaces.primecount, not just remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ae5f4225be135ef739851c033319ec731dcb73\"><code>d3ae5f4</code></a></td><td><code>primecount is on conda, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a8c7fee219003c5ee076d4917b677013642b1bb\"><code>3a8c7fe</code></a></td><td><code>primesieve is on conda, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74b38459edb9c9ae7417883adf15eba1e981631d\"><code>74b3845</code></a></td><td><code>allow float inputs for prime_pi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/591be341aedee6fd533924a9a228f68ab7a245bd\"><code>591be34</code></a></td><td><code>Merge #32894</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/049a5f600cc138aa816d983d9adb7e47ae75ecd2\"><code>049a5f6</code></a></td><td><code>tox.ini: Do not set environment variable CONDARC</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3116a125a3283b84240c783d3d19900ca740614\"><code>f3116a1</code></a></td><td><code>tox.ini (conda): Force use of conda's python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35\"><code>6418579</code></a></td><td><code>Merge #32113</code></td></tr></table>\n",
    "created_at": "2021-12-21T03:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527557",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43d481b01ee129eb5ffcf52b848012e648663a91"><code>43d481b</code></a></td><td><code>bump to 0.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66821b0fd8b060d49fc2177f56ad79584f8ec0b"><code>f66821b</code></a></td><td><code>cysignals are needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae37b4e39479f6592296e3502eabdc585af662a8"><code>ae37b4e</code></a></td><td><code>deprecate sage.interfaces.primecount, not just remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ae5f4225be135ef739851c033319ec731dcb73"><code>d3ae5f4</code></a></td><td><code>primecount is on conda, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a8c7fee219003c5ee076d4917b677013642b1bb"><code>3a8c7fe</code></a></td><td><code>primesieve is on conda, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74b38459edb9c9ae7417883adf15eba1e981631d"><code>74b3845</code></a></td><td><code>allow float inputs for prime_pi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/591be341aedee6fd533924a9a228f68ab7a245bd"><code>591be34</code></a></td><td><code>Merge #32894</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/049a5f600cc138aa816d983d9adb7e47ae75ecd2"><code>049a5f6</code></a></td><td><code>tox.ini: Do not set environment variable CONDARC</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3116a125a3283b84240c783d3d19900ca740614"><code>f3116a1</code></a></td><td><code>tox.ini (conda): Force use of conda's python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35"><code>6418579</code></a></td><td><code>Merge #32113</code></td></tr></table>




---

archive/issue_comments_527558.json:
```json
{
    "body": "Changed commit from **[`6418579`](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)** to **[`933134c`](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)**",
    "created_at": "2021-12-21T03:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527558",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6418579`](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)** to **[`933134c`](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)**



---

archive/issue_comments_527559.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96\"><code>933134c</code></a></td><td><code>build/pkgs/gfortran/distros/homebrew.txt: Use gfortran</code></td></tr></table>\n",
    "created_at": "2021-12-21T03:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527559",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96"><code>933134c</code></a></td><td><code>build/pkgs/gfortran/distros/homebrew.txt: Use gfortran</code></td></tr></table>




---

archive/issue_comments_527560.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1597453181** to **https://github.com/mkoeppe/sage/actions/runs/1605145773**",
    "created_at": "2021-12-21T04:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527560",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1597453181** to **https://github.com/mkoeppe/sage/actions/runs/1605145773**



---

archive/issue_events_447207.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T04:52:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447207"
}
```



---

archive/issue_events_447208.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T04:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447208"
}
```



---

archive/issue_comments_527561.json:
```json
{
    "body": "Changed dependencies from **#32113** to **#32113, #32947**",
    "created_at": "2021-12-21T07:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527561",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#32113** to **#32113, #32947**



---

archive/issue_comments_527562.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab4fb992263715bf0ef2f86c0eedbb3f14f82d2d\"><code>ab4fb99</code></a></td><td><code>tox.ini: Add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e51225a6a2f759fe06f316f79ccdec23ec100608\"><code>e51225a</code></a></td><td><code>.github/workflows/tox*.yml: Remove debian-jessie, add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac47e7da19a9e960f1a1b7d8de5141a2ca423ed4\"><code>ac47e7d</code></a></td><td><code>.github/workflows/tox-gcc_spkg.yml: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1aa9328f098181ab6b9a1c143a52875a797048e6\"><code>1aa9328</code></a></td><td><code>Merge #32947</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065\"><code>e99a09e</code></a></td><td><code>sed -i.bak 's/ubunty/ubuntu/g' .github/workflows/*.yml</code></td></tr></table>\n",
    "created_at": "2021-12-21T07:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab4fb992263715bf0ef2f86c0eedbb3f14f82d2d"><code>ab4fb99</code></a></td><td><code>tox.ini: Add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e51225a6a2f759fe06f316f79ccdec23ec100608"><code>e51225a</code></a></td><td><code>.github/workflows/tox*.yml: Remove debian-jessie, add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac47e7da19a9e960f1a1b7d8de5141a2ca423ed4"><code>ac47e7d</code></a></td><td><code>.github/workflows/tox-gcc_spkg.yml: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1aa9328f098181ab6b9a1c143a52875a797048e6"><code>1aa9328</code></a></td><td><code>Merge #32947</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065"><code>e99a09e</code></a></td><td><code>sed -i.bak 's/ubunty/ubuntu/g' .github/workflows/*.yml</code></td></tr></table>




---

archive/issue_comments_527563.json:
```json
{
    "body": "Changed commit from **[`933134c`](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)** to **[`e99a09e`](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)**",
    "created_at": "2021-12-21T07:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527563",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`933134c`](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)** to **[`e99a09e`](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)**



---

archive/issue_comments_527564.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI know we already touch upon this point, but can you please expand on\n> Unfortunately, because \u200bbecause \"needs\" cannot depend on \"matrix\", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed \n\nThat is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix. In particular, I don't understand the \"all platforms\" part, as ubuntu and macos are in different jobs, right? It appears to me that with the current design also stage 1 builds are executed before any stage 2 is executed, so the only difference is that you can already have 4 or so stage 2 builds running while the last stage 1 build finishes. I guess for the overall build time this shouldn't make much of a difference anyway, as these 4 runners would be busy with other workflows then (or are free to execute builds of other stuff in the sagemath org).",
    "created_at": "2021-12-21T16:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527564",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:48" align="right">comment:48</div>

I know we already touch upon this point, but can you please expand on
> Unfortunately, because ​because "needs" cannot depend on "matrix", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed 

That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix. In particular, I don't understand the "all platforms" part, as ubuntu and macos are in different jobs, right? It appears to me that with the current design also stage 1 builds are executed before any stage 2 is executed, so the only difference is that you can already have 4 or so stage 2 builds running while the last stage 1 build finishes. I guess for the overall build time this shouldn't make much of a difference anyway, as these 4 runners would be busy with other workflows then (or are free to execute builds of other stuff in the sagemath org).



---

archive/issue_comments_527565.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@tobiasdiez](#comment%3A48):\n> That is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix.\n\nTo avoid copy-paste",
    "created_at": "2021-12-21T16:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527565",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@tobiasdiez](#comment%3A48):
> That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix.

To avoid copy-paste



---

archive/issue_comments_527566.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@tobiasdiez](#comment%3A48):\n>  I don't understand the \"all platforms\" part, as ubuntu and macos are in different jobs, right?\n\nYes, that's right, within each job; and in this ticket, only for macos.",
    "created_at": "2021-12-21T16:30:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527566",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@tobiasdiez](#comment%3A48):
>  I don't understand the "all platforms" part, as ubuntu and macos are in different jobs, right?

Yes, that's right, within each job; and in this ticket, only for macos.



---

archive/issue_comments_527567.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@mkoeppe](#comment%3A49):\n> Replying to [@tobiasdiez](#comment%3A48):\n> > That is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix.\n\n> \n> To avoid copy-paste\n\nGithub recently made it possible to reuse workflows: https://docs.github.com/en/actions/learn-github-actions/reusing-workflows\nThus you could extract the current local-macos job into a new workflow and pass the right \"tox\" command as an argument (determined by the matrix + step).",
    "created_at": "2021-12-21T16:40:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527567",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@mkoeppe](#comment%3A49):
> Replying to [@tobiasdiez](#comment%3A48):
> > That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix.

> 
> To avoid copy-paste

Github recently made it possible to reuse workflows: https://docs.github.com/en/actions/learn-github-actions/reusing-workflows
Thus you could extract the current local-macos job into a new workflow and pass the right "tox" command as an argument (determined by the matrix + step).



---

archive/issue_comments_527568.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nThanks for the pointer!! I've added this to #29060 for welcome future refactoring - but this won't make it into Sage 9.5",
    "created_at": "2021-12-21T16:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527568",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">comment:52</div>

Thanks for the pointer!! I've added this to #29060 for welcome future refactoring - but this won't make it into Sage 9.5



---

archive/issue_comments_527569.json:
```json
{
    "body": "Changed commit from **[`e99a09e`](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)** to **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**",
    "created_at": "2021-12-21T17:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527569",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e99a09e`](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)** to **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**



---

archive/issue_comments_527570.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b\"><code>edb4364</code></a></td><td><code>.github/workflows/tox.yml: Replace homebrew-macos-python3_xcode-standard by homebrew-macos-usrlocal-python3_xcode-standard</code></td></tr></table>\n",
    "created_at": "2021-12-21T17:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527570",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b"><code>edb4364</code></a></td><td><code>.github/workflows/tox.yml: Replace homebrew-macos-python3_xcode-standard by homebrew-macos-usrlocal-python3_xcode-standard</code></td></tr></table>




---

archive/issue_comments_527571.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,8 +18,6 @@\n \n As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n \n-References\n-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching\n+We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.\n \n \n-\n``````\n",
    "created_at": "2021-12-21T17:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527571",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,8 +18,6 @@
 
 As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
 
-References
-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching
+We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.
 
 
-
``````




---

archive/issue_events_447209.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:29:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "title_is": "GH Actions (macOS): Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "title_was": "GH Actions: Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447209"
}
```



---

archive/issue_events_447210.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-23T14:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447210"
}
```



---

archive/issue_events_447211.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-23T14:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447211"
}
```



---

archive/issue_comments_527572.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1605145773** to **Dima Pasechnik**",
    "created_at": "2021-12-23T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527572",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1605145773** to **Dima Pasechnik**



---

archive/issue_comments_527573.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nOK,macOS runs on GH look good.",
    "created_at": "2021-12-23T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527573",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

OK,macOS runs on GH look good.



---

archive/issue_comments_527574.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThanks!",
    "created_at": "2021-12-23T16:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527574",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

Thanks!



---

archive/issue_events_447212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447212"
}
```



---

archive/issue_events_447213.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c4f76c053f147913562780906ce372fca2943693",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-01-01T00:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-447213"
}
```



---

archive/issue_comments_527575.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)** to **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**",
    "created_at": "2022-01-01T00:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-527575",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)** to **[`edb4364`](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)**
