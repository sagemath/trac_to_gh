# Issue 32703: GH Actions (macOS): Run a job for "make build-local" first, cache image for job "make build"

archive/issues_032466.json:
```json
{
    "assignees": [],
    "body": "We revise the GH Actions workflows to use a 2-stage build:\nIn the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.\n\n(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n- Sage distribution, classic\n- Sage distribution with `configure --enable-editable`\n- Sage distribution with `configure --enable-system-site-packages` (#29665)\n- the configurations from pkgs/**sagemath-standard**/tox.ini\n- build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)\n\n(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.\n\n(+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit\n\n(-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n\nIn this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n\nAs of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n\nWe also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.\n\n\n\nDepends on #32113\n\nDepends on #32947\n\n**CC:**  @tobiasdiez @kliem @orlitzky @isuruf\n\n**Branch/Commit:** [edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/32703\n\n",
    "closed_at": "2022-01-01T00:23:33Z",
    "created_at": "2021-10-16T19:03:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GH Actions (macOS): Run a job for \"make build-local\" first, cache image for job \"make build\"",
    "type": "issue",
    "updated_at": "2022-01-01T00:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/32703",
    "user": "https://github.com/mkoeppe"
}
```
We revise the GH Actions workflows to use a 2-stage build:
In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.

(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts
- Sage distribution, classic
- Sage distribution with `configure --enable-editable`
- Sage distribution with `configure --enable-system-site-packages` (#29665)
- the configurations from pkgs/**sagemath-standard**/tox.ini
- build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)

(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.

(+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit

(-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed

In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.

As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.

We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.



Depends on #32113

Depends on #32947

**CC:**  @tobiasdiez @kliem @orlitzky @isuruf

**Branch/Commit:** [edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)

**Reviewer:** Dima Pasechnik

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/32703





---

archive/issue_events_396745.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396745"
}
```



---

archive/issue_events_396746.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting",
    "label_color": "08517b",
    "label_name": "component: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396746"
}
```



---

archive/issue_events_396747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T19:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396747"
}
```



---

archive/issue_comments_530347.json:
```json
{
    "body": "**Dependencies:** #31535",
    "created_at": "2021-10-16T20:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530347",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31535



---

archive/issue_events_396748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-17T00:01:35Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "rename": {
        "from": "GH Actions: In tox-docker, run a job for \"make build-local\" first, cache image for job \"make build\"",
        "to": "GH Actions: Run a job for \"make build-local\" first, cache image for job \"make build\""
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396748"
}
```



---

archive/issue_comments_530348.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)",
    "created_at": "2021-10-17T01:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530348",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)



---

archive/issue_comments_530349.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/1350377940",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530349",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/1350377940



---

archive/issue_comments_530350.json:
```json
{
    "body": "**Commit:** [d08452ce3b7dfa719ab038e6068b5cfe33e2c278](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530350",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [d08452ce3b7dfa719ab038e6068b5cfe33e2c278](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)



---

archive/issue_comments_530351.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498\">2101b8c</a></td><td><code>build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e\">3bbc5d8</a></td><td><code>build/pkgs/python3/spkg-build.in: Set rpath</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/124b6059e4c942e785797c32116b027694634432\">124b605</a></td><td><code>Merge #32698</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bca214134dc225603801470f7bb2999e9e6bdbca\">bca2141</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdbab3aca65138c1a80009c546df53af04d740f6\">bdbab3a</a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63e47ffb14a31944760dc2e0a54c6eae64202746\">63e47ff</a></td><td><code>Merge #31535</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c40d1cab6e03c48e86fdf33ec7a534e906c3d6b\">1c40d1c</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dee3f41fd0c7e84030e0f7bfd000a363279b41f1\">dee3f41</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd9fad10a76581453b54da8085aaa9f879334a8c\">bd9fad1</a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278\">d08452c</a></td><td><code>Update systems</code></td></tr></table>\n",
    "created_at": "2021-10-17T01:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530351",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2101b8cccc8b0b2fc782dbeb8c476e6a52243498">2101b8c</a></td><td><code>build/pkgs/python3/spkg-build.in: Make sure that python finds sqlite3 when determining which extension modules to build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bbc5d8fb9aa3abc81fe2a46da52312b843c796e">3bbc5d8</a></td><td><code>build/pkgs/python3/spkg-build.in: Set rpath</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/124b6059e4c942e785797c32116b027694634432">124b605</a></td><td><code>Merge #32698</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bca214134dc225603801470f7bb2999e9e6bdbca">bca2141</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdbab3aca65138c1a80009c546df53af04d740f6">bdbab3a</a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63e47ffb14a31944760dc2e0a54c6eae64202746">63e47ff</a></td><td><code>Merge #31535</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c40d1cab6e03c48e86fdf33ec7a534e906c3d6b">1c40d1c</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dee3f41fd0c7e84030e0f7bfd000a363279b41f1">dee3f41</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd9fad10a76581453b54da8085aaa9f879334a8c">bd9fad1</a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278">d08452c</a></td><td><code>Update systems</code></td></tr></table>




---

archive/issue_comments_530352.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1350377940\" to \"https://github.com/mkoeppe/sage/actions/runs/1350710395\".",
    "created_at": "2021-10-17T05:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530352",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1350377940" to "https://github.com/mkoeppe/sage/actions/runs/1350710395".



---

archive/issue_comments_530353.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454\">0799c5f</a></td><td><code>.github/workflows/tox.yml: Fixup for macOS tar</code></td></tr></table>\n",
    "created_at": "2021-10-17T05:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530353",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454">0799c5f</a></td><td><code>.github/workflows/tox.yml: Fixup for macOS tar</code></td></tr></table>




---

archive/issue_comments_530354.json:
```json
{
    "body": "**Changing commit** from \"[d08452ce3b7dfa719ab038e6068b5cfe33e2c278](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)\" to \"[0799c5f277b3a3bbece1ee900dcc4372230bd454](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)\".",
    "created_at": "2021-10-17T05:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530354",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d08452ce3b7dfa719ab038e6068b5cfe33e2c278](https://github.com/sagemath/sagetrac-mirror/commit/d08452ce3b7dfa719ab038e6068b5cfe33e2c278)" to "[0799c5f277b3a3bbece1ee900dcc4372230bd454](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)".



---

archive/issue_comments_530355.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7\">e031622</a></td><td><code>.github/workflows/tox.yml: Fix up upload path</code></td></tr></table>\n",
    "created_at": "2021-10-17T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530355",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7">e031622</a></td><td><code>.github/workflows/tox.yml: Fix up upload path</code></td></tr></table>




---

archive/issue_comments_530356.json:
```json
{
    "body": "**Changing commit** from \"[0799c5f277b3a3bbece1ee900dcc4372230bd454](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)\" to \"[e0316227804a62a314565a065a63497524d97be7](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)\".",
    "created_at": "2021-10-17T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530356",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0799c5f277b3a3bbece1ee900dcc4372230bd454](https://github.com/sagemath/sagetrac-mirror/commit/0799c5f277b3a3bbece1ee900dcc4372230bd454)" to "[e0316227804a62a314565a065a63497524d97be7](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)".



---

archive/issue_comments_530357.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346\">a40d706</a></td><td><code>.github/workflows/tox.yml: Do not use /tmp for artifacts to avoid https://github.com/actions/upload-artifact/issues/92</code></td></tr></table>\n",
    "created_at": "2021-10-17T23:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530357",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346">a40d706</a></td><td><code>.github/workflows/tox.yml: Do not use /tmp for artifacts to avoid https://github.com/actions/upload-artifact/issues/92</code></td></tr></table>




---

archive/issue_comments_530358.json:
```json
{
    "body": "**Changing commit** from \"[e0316227804a62a314565a065a63497524d97be7](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)\" to \"[a40d706b69949f82d96f645f92506041b2819346](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)\".",
    "created_at": "2021-10-17T23:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530358",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e0316227804a62a314565a065a63497524d97be7](https://github.com/sagemath/sagetrac-mirror/commit/e0316227804a62a314565a065a63497524d97be7)" to "[a40d706b69949f82d96f645f92506041b2819346](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)".



---

archive/issue_comments_530359.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2bc150816cad560130cd511df122c81ad19c44\">dd2bc15</a></td><td><code>.github/workflows/tox.yml: Use env.GITHUB_WORKSPACE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff\">2b46f02</a></td><td><code>.github/workflows/tox.yml: Use sage-local-artifact/ as path</code></td></tr></table>\n",
    "created_at": "2021-10-18T19:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530359",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>**Comment 9:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2bc150816cad560130cd511df122c81ad19c44">dd2bc15</a></td><td><code>.github/workflows/tox.yml: Use env.GITHUB_WORKSPACE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff">2b46f02</a></td><td><code>.github/workflows/tox.yml: Use sage-local-artifact/ as path</code></td></tr></table>




---

archive/issue_comments_530360.json:
```json
{
    "body": "**Changing commit** from \"[a40d706b69949f82d96f645f92506041b2819346](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)\" to \"[2b46f0286d91913a1e15f828f10b54db1b4019ff](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)\".",
    "created_at": "2021-10-18T19:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530360",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a40d706b69949f82d96f645f92506041b2819346](https://github.com/sagemath/sagetrac-mirror/commit/a40d706b69949f82d96f645f92506041b2819346)" to "[2b46f0286d91913a1e15f828f10b54db1b4019ff](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)".



---

archive/issue_comments_530361.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1350710395\" to \"https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true\".",
    "created_at": "2021-10-19T16:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530361",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1350710395" to "https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true".



---

archive/issue_comments_530362.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nworking well now",
    "created_at": "2021-10-19T16:01:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530362",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'>**Comment 11:**</a>
working well now



---

archive/issue_comments_530363.json:
```json
{
    "body": "**Changing commit** from \"[2b46f0286d91913a1e15f828f10b54db1b4019ff](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)\" to \"[4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)\".",
    "created_at": "2021-10-19T17:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530363",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2b46f0286d91913a1e15f828f10b54db1b4019ff](https://github.com/sagemath/sagetrac-mirror/commit/2b46f0286d91913a1e15f828f10b54db1b4019ff)" to "[4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)".



---

archive/issue_comments_530364.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c\">4dcd768</a></td><td><code>.github/workflows/tox.yml: mkdir</code></td></tr></table>\n",
    "created_at": "2021-10-19T17:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530364",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>**Comment 12:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c">4dcd768</a></td><td><code>.github/workflows/tox.yml: mkdir</code></td></tr></table>




---

archive/issue_comments_530365.json:
```json
{
    "body": "**Changing commit** from \"[4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)\" to \"[828463d927640ae9f427a97065c4464cac4a73d3](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)\".",
    "created_at": "2021-10-19T17:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530365",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c](https://github.com/sagemath/sagetrac-mirror/commit/4dcd76823b2d362e081f16e7a98e8bb0d4ddfd3c)" to "[828463d927640ae9f427a97065c4464cac4a73d3](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)".



---

archive/issue_comments_530366.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3\">828463d</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr></table>\n",
    "created_at": "2021-10-19T17:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530366",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>**Comment 13:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3">828463d</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr></table>




---

archive/issue_comments_530367.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nIf I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel. For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact. Maybe something like https://github.com/marketplace/actions/wait-for-check helps.",
    "created_at": "2021-10-19T17:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530367",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:14'>**Comment 14:**</a>
If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel. For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact. Maybe something like https://github.com/marketplace/actions/wait-for-check helps.



---

archive/issue_comments_530368.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@tobiasdiez](#comment%3A14):\n> If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.\n\nYes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...\n\n> For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact.\n\nWell, they failed because the previous stage failed.",
    "created_at": "2021-10-19T17:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530368",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@tobiasdiez](#comment%3A14):
> If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.

Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...

> For example, some stage 2 runs (e.g https://github.com/mkoeppe/sage/runs/3935018795?check_suite_focus=true) fail since they try to download a non-existing artifact.

Well, they failed because the previous stage failed.



---

archive/issue_comments_530369.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nReplying to [@tobiasdiez](#comment%3A14):\n> Maybe something like https://github.com/marketplace/actions/wait-for-check helps.\n\nThanks for the pointer, we can look into using something like this",
    "created_at": "2021-10-19T17:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530369",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>**Comment 16:**</a>
Replying to [@tobiasdiez](#comment%3A14):
> Maybe something like https://github.com/marketplace/actions/wait-for-check helps.

Thanks for the pointer, we can look into using something like this



---

archive/issue_comments_530370.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nTesting with integrated builds for the optional packages now at https://github.com/mkoeppe/sage/actions/runs/1360303527",
    "created_at": "2021-10-19T17:43:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530370",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'>**Comment 17:**</a>
Testing with integrated builds for the optional packages now at https://github.com/mkoeppe/sage/actions/runs/1360303527



---

archive/issue_comments_530371.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nReplying to [@mkoeppe](#comment%3A15):\n> Replying to [@tobiasdiez](#comment%3A14):\n> > If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.\n\n> \n> Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...\n\nOkay, but isn't this a very fragile design? Imagine that you have exactly 5 matrix cases. So all of the stage 1 tasks start at the same time. Now if the last case exists slightly before the other 4, then the stage 2 for the other 4 may be invoked and now fail as their stage 1 is not yet finished. Also this would limit everything to mac, as on linux you have way more runners.",
    "created_at": "2021-10-19T21:06:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530371",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'>**Comment 18:**</a>
Replying to [@mkoeppe](#comment%3A15):
> Replying to [@tobiasdiez](#comment%3A14):
> > If I understand the changes (and the output) correctly, then currently stage 1 and 2 run parallel.

> 
> Yes, in theory. But in practice we only get 5 parallel jobs on macOS and we launch many more jobs...

Okay, but isn't this a very fragile design? Imagine that you have exactly 5 matrix cases. So all of the stage 1 tasks start at the same time. Now if the last case exists slightly before the other 4, then the stage 2 for the other 4 may be invoked and now fail as their stage 1 is not yet finished. Also this would limit everything to mac, as on linux you have way more runners.



---

archive/issue_comments_530372.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@tobiasdiez](#comment%3A18):\n> Okay, but isn't this a very fragile design? \n\nYes",
    "created_at": "2021-10-19T21:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530372",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@tobiasdiez](#comment%3A18):
> Okay, but isn't this a very fragile design? 

Yes



---

archive/issue_comments_530373.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nReplying to [@tobiasdiez](#comment%3A18):\n> on linux you have way more runners.\n\nwe also have way more jobs...",
    "created_at": "2021-10-19T21:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530373",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>**Comment 20:**</a>
Replying to [@tobiasdiez](#comment%3A18):
> on linux you have way more runners.

we also have way more jobs...



---

archive/issue_comments_530374.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nThen I would suggest using two jobs that wait using \"needs\" and accept the disadvantages that go with it. \n\n> Unfortunately, because \u200bbecause \"needs\" cannot depend on \"matrix\", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed \n\nI think this is also a more flexible design as the stage two matrix will probably have more options in the future (e.g. editable install, with/without prebuild wheels from pypi, pipenv).\nIn fact, for maximal flexibility do you think it makes sense too split it further into 3 stages:\n- Built all non-python packages (min/standard/max)\n- Built all python packages (standard, editable, prebuild wheels, pipenv)\n- Run doctests",
    "created_at": "2021-10-20T07:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530374",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:21'>**Comment 21:**</a>
Then I would suggest using two jobs that wait using "needs" and accept the disadvantages that go with it. 

> Unfortunately, because ​because "needs" cannot depend on "matrix", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed 

I think this is also a more flexible design as the stage two matrix will probably have more options in the future (e.g. editable install, with/without prebuild wheels from pypi, pipenv).
In fact, for maximal flexibility do you think it makes sense too split it further into 3 stages:
- Built all non-python packages (min/standard/max)
- Built all python packages (standard, editable, prebuild wheels, pipenv)
- Run doctests



---

archive/issue_comments_530375.json:
```json
{
    "body": "**Changing commit** from \"[828463d927640ae9f427a97065c4464cac4a73d3](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)\" to \"[9404238042ce3c2ff19535c51a14981e68fb7a82](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)\".",
    "created_at": "2021-10-20T16:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530375",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[828463d927640ae9f427a97065c4464cac4a73d3](https://github.com/sagemath/sagetrac-mirror/commit/828463d927640ae9f427a97065c4464cac4a73d3)" to "[9404238042ce3c2ff19535c51a14981e68fb7a82](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)".



---

archive/issue_comments_530376.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313dc82954af96b008a6795f3485e92a58f5545d\">313dc82</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65f3155836a8b35400890e2d62172d24e6ceec27\">65f3155</a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3aeedb2be37fb1a682d6468f419aee9b65133300\">3aeedb2</a></td><td><code>Update systems</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63d0752ddf6049cc6d2f71ebddb9d6573c8ec221\">63d0752</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82\">9404238</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>\n",
    "created_at": "2021-10-20T16:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530376",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>**Comment 22:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313dc82954af96b008a6795f3485e92a58f5545d">313dc82</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65f3155836a8b35400890e2d62172d24e6ceec27">65f3155</a></td><td><code>.github/workflows/: Remove workflows for testing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3aeedb2be37fb1a682d6468f419aee9b65133300">3aeedb2</a></td><td><code>Update systems</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63d0752ddf6049cc6d2f71ebddb9d6573c8ec221">63d0752</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82">9404238</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>




---

archive/issue_comments_530377.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115\">d09e275</a></td><td><code>Fixup</code></td></tr></table>\n",
    "created_at": "2021-10-20T16:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530377",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>**Comment 23:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115">d09e275</a></td><td><code>Fixup</code></td></tr></table>




---

archive/issue_comments_530378.json:
```json
{
    "body": "**Changing commit** from \"[9404238042ce3c2ff19535c51a14981e68fb7a82](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)\" to \"[d09e27501bf07c8a1577030e3140d3d3a4997115](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)\".",
    "created_at": "2021-10-20T16:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530378",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9404238042ce3c2ff19535c51a14981e68fb7a82](https://github.com/sagemath/sagetrac-mirror/commit/9404238042ce3c2ff19535c51a14981e68fb7a82)" to "[d09e27501bf07c8a1577030e3140d3d3a4997115](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)".



---

archive/issue_comments_530379.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nYes, in stage 2 we can have all of these variants, next to the runs for the optional packages added in 313dc82\n\nWhether the doctest needs a separate stage remains to be seen; I think having it as part of the stage 2 builds will easily fit into the 6 hour limit in all variants.",
    "created_at": "2021-10-20T16:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>**Comment 24:**</a>
Yes, in stage 2 we can have all of these variants, next to the runs for the optional packages added in 313dc82

Whether the doctest needs a separate stage remains to be seen; I think having it as part of the stage 2 builds will easily fit into the 6 hour limit in all variants.



---

archive/issue_comments_530380.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nOptional packages working well now - https://github.com/mkoeppe/sage/actions/runs/1364372711",
    "created_at": "2021-10-21T02:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530380",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>**Comment 25:**</a>
Optional packages working well now - https://github.com/mkoeppe/sage/actions/runs/1364372711



---

archive/issue_comments_530381.json:
```json
{
    "body": "**Changing commit** from \"[d09e27501bf07c8a1577030e3140d3d3a4997115](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)\" to \"[9940993e1b15e0a0ebfada73f5064c8d3a2451d8](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)\".",
    "created_at": "2021-10-21T19:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530381",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d09e27501bf07c8a1577030e3140d3d3a4997115](https://github.com/sagemath/sagetrac-mirror/commit/d09e27501bf07c8a1577030e3140d3d3a4997115)" to "[9940993e1b15e0a0ebfada73f5064c8d3a2451d8](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)".



---

archive/issue_comments_530382.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ef2baa323bf78dc193eb63b493deb0cee39c35e\">4ef2baa</a></td><td><code>build/make/Makefile.in: Add targets SPKG-sdist, SPKG-tox, SPKG-tox-% for script packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f621e319c9aad5acc334cce53b56e7c42203f56f\">f621e31</a></td><td><code>tox.ini: Add local-conda-environment-src</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f27557da0b1fdfffe1843d9352d4482e3034e7\">32f2755</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea69f60b89bdc343112d4a10c952e19a87c39f97\">ea69f60</a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a9ab2ab0e202b16da2d0aad26719bd3ff0e9cb9\">2a9ab2a</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1410dec68e76977d14fd730042d063a5b3bc2d3\">e1410de</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1180c80827b50e6bcc64afbad6b995b94fe2218d\">1180c80</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b28e85d2a45447e1b002c46fb20e2a1cb7f1aa59\">b28e85d</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8\">9940993</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530382",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>**Comment 26:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ef2baa323bf78dc193eb63b493deb0cee39c35e">4ef2baa</a></td><td><code>build/make/Makefile.in: Add targets SPKG-sdist, SPKG-tox, SPKG-tox-% for script packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f621e319c9aad5acc334cce53b56e7c42203f56f">f621e31</a></td><td><code>tox.ini: Add local-conda-environment-src</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f27557da0b1fdfffe1843d9352d4482e3034e7">32f2755</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea69f60b89bdc343112d4a10c952e19a87c39f97">ea69f60</a></td><td><code>build/make/Makefile.in: Remove SPKG-tox, SPKG-sdist targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a9ab2ab0e202b16da2d0aad26719bd3ff0e9cb9">2a9ab2a</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1410dec68e76977d14fd730042d063a5b3bc2d3">e1410de</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1180c80827b50e6bcc64afbad6b995b94fe2218d">1180c80</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b28e85d2a45447e1b002c46fb20e2a1cb7f1aa59">b28e85d</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8">9940993</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr></table>




---

archive/issue_comments_530383.json:
```json
{
    "body": "**Changing commit** from \"[9940993e1b15e0a0ebfada73f5064c8d3a2451d8](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)\" to \"[553dea4fc40f55ef42e10bfef0aad82495a8ce64](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)\".",
    "created_at": "2021-10-21T19:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530383",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9940993e1b15e0a0ebfada73f5064c8d3a2451d8](https://github.com/sagemath/sagetrac-mirror/commit/9940993e1b15e0a0ebfada73f5064c8d3a2451d8)" to "[553dea4fc40f55ef42e10bfef0aad82495a8ce64](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)".



---

archive/issue_comments_530384.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64\">553dea4</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530384",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>**Comment 27:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64">553dea4</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr></table>




---

archive/issue_comments_530385.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5\">924d4e6</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-10-21T19:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530385",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5">924d4e6</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_530386.json:
```json
{
    "body": "**Changing commit** from \"[553dea4fc40f55ef42e10bfef0aad82495a8ce64](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)\" to \"[924d4e69c1fe9795d675d933ca3de8aaa0fc78a5](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)\".",
    "created_at": "2021-10-21T19:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530386",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[553dea4fc40f55ef42e10bfef0aad82495a8ce64](https://github.com/sagemath/sagetrac-mirror/commit/553dea4fc40f55ef42e10bfef0aad82495a8ce64)" to "[924d4e69c1fe9795d675d933ca3de8aaa0fc78a5](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)".



---

archive/issue_comments_530387.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true\" to \"https://github.com/mkoeppe/sage/actions/runs/1364372711\".",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530387",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/runs/3935018641?check_suite_focus=true" to "https://github.com/mkoeppe/sage/actions/runs/1364372711".



---

archive/issue_comments_530388.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,10 @@\n \n (-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n \n+In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n+\n+As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n+\n References\n - https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching\n \n``````\n",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530388",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,10 @@
 
 (-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed
 
+In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
+
+As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
+
 References
 - https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching
 
``````




---

archive/issue_events_396749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-21T19:57:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396749"
}
```



---

archive/issue_comments_530389.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-10-21T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530389",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_530390.json:
```json
{
    "body": "**Changing dependencies** from \"#31535\" to \"\".",
    "created_at": "2021-10-21T19:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530390",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31535" to "".



---

archive/issue_comments_530391.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef7e478cd9de7c1be49e81f17f3404bd484556a6\">ef7e478</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d943c03ccd5790685a6c160cafd6bc3001b6c901\">d943c03</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e8994331692ad484b68e062b244a45948937ade\">5e89943</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9d982305b8efa7e13070a7e164b302eb98d52aa\">d9d9823</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/659d2a89c16a8fef461be8efe771dd0c995f36da\">659d2a8</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4bd5016a952558fe56b1c1a5b6e73ee84850cc1\">f4bd501</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585\">7b15b44</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-10-21T20:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530391",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>**Comment 31:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef7e478cd9de7c1be49e81f17f3404bd484556a6">ef7e478</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d943c03ccd5790685a6c160cafd6bc3001b6c901">d943c03</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e8994331692ad484b68e062b244a45948937ade">5e89943</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9d982305b8efa7e13070a7e164b302eb98d52aa">d9d9823</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/659d2a89c16a8fef461be8efe771dd0c995f36da">659d2a8</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4bd5016a952558fe56b1c1a5b6e73ee84850cc1">f4bd501</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585">7b15b44</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_530392.json:
```json
{
    "body": "**Changing commit** from \"[924d4e69c1fe9795d675d933ca3de8aaa0fc78a5](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)\" to \"[7b15b4455bb7f6c3bd525f8c06ad639a6385f585](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)\".",
    "created_at": "2021-10-21T20:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530392",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[924d4e69c1fe9795d675d933ca3de8aaa0fc78a5](https://github.com/sagemath/sagetrac-mirror/commit/924d4e69c1fe9795d675d933ca3de8aaa0fc78a5)" to "[7b15b4455bb7f6c3bd525f8c06ad639a6385f585](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)".



---

archive/issue_comments_530393.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nRebased away from #31535.",
    "created_at": "2021-10-21T20:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530393",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'>**Comment 32:**</a>
Rebased away from #31535.



---

archive/issue_comments_530394.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,20 @@\n-(+) On top of the built image containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n+We revise the GH Actions workflows to use a 2-stage build:\n+In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.\n+\n+(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts\n - Sage distribution, classic\n - Sage distribution with `configure --enable-editable`\n - Sage distribution with `configure --enable-system-site-packages` (#29665)\n - the configurations from pkgs/**sagemath-standard**/tox.ini\n - build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)\n \n+(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.\n+\n (+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit\n \n (-) Unfortunately, because [because \"needs\" cannot depend on \"matrix\"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed\n \n-In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n+In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.\n \n As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n \n``````\n",
    "created_at": "2021-10-21T20:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530394",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,20 @@
-(+) On top of the built image containing the full SAGE_LOCAL, we can test several ways to build the Python parts
+We revise the GH Actions workflows to use a 2-stage build:
+In the first stage, run `make build-local`, and store `SAGE_LOCAL` as a build artifact. In the second stage, download the build artifact and run more building and testing.
+
+(+) On top of the artifact containing the full SAGE_LOCAL, we can test several ways to build the Python parts
 - Sage distribution, classic
 - Sage distribution with `configure --enable-editable`
 - Sage distribution with `configure --enable-system-site-packages` (#29665)
 - the configurations from pkgs/**sagemath-standard**/tox.ini
 - build/install of modularized distributions such as pkgs/**sage-categories** (#29865), pkgs/**sagemath-standard-no-symbolics** (#32601)
 
+(+) Tests of optional and experimental packages can be streamlined, as we avoid rebuilding their dependencies that are standard packages.
+
 (+) Splitting the job into two would also help with the configurations for which we scrape at the 6 hour time limit
 
 (-) Unfortunately, because [because "needs" cannot depend on "matrix"](https://github.community/t/needs-based-on-matrix/132400), the jobs for building/testing Python packages would not start before all jobs building `SAGE_LOCAL` for all platforms are completed
 
-In this ticket, we change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
+In this ticket, we only change all existing `macos` workflows to a 2-stage workflow, integrating the separate workflows for optional and experimental packages.
 
 As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
 
``````




---

archive/issue_comments_530395.json:
```json
{
    "body": "**Changing commit** from \"[7b15b4455bb7f6c3bd525f8c06ad639a6385f585](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)\" to \"[10de67a6f92ffe6bb7a19c61a5180b86a9cbd481](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)\".",
    "created_at": "2021-12-19T01:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530395",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[7b15b4455bb7f6c3bd525f8c06ad639a6385f585](https://github.com/sagemath/sagetrac-mirror/commit/7b15b4455bb7f6c3bd525f8c06ad639a6385f585)" to "[10de67a6f92ffe6bb7a19c61a5180b86a9cbd481](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)".



---

archive/issue_comments_530396.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/497682f918cb99d297a765adc3c370adaaadaaa2\">497682f</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d\">afbd4fa</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465\">57884a6</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b\">49276f2</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b\">c3e2467</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd\">55c83f5</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481\">10de67a</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>\n",
    "created_at": "2021-12-19T01:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530396",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>**Comment 34:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/497682f918cb99d297a765adc3c370adaaadaaa2">497682f</a></td><td><code>.github/workflows/extract-sage-local.sh: Make script usable on non-cygwin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d">afbd4fa</a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465">57884a6</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b">49276f2</a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b">c3e2467</a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd">55c83f5</a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481">10de67a</a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr></table>




---

archive/issue_comments_530397.json:
```json
{
    "body": "**Changing commit** from \"[10de67a6f92ffe6bb7a19c61a5180b86a9cbd481](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)\" to \"[8617b6f7ab260bf528bc486dffcc4dab51222d12](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)\".",
    "created_at": "2021-12-19T02:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530397",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[10de67a6f92ffe6bb7a19c61a5180b86a9cbd481](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)" to "[8617b6f7ab260bf528bc486dffcc4dab51222d12](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)".



---

archive/issue_comments_530398.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12\">8617b6f</a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr></table>\n",
    "created_at": "2021-12-19T02:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530398",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:35'>**Comment 35:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12">8617b6f</a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr></table>




---

archive/issue_comments_530399.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1364372711\" to \"https://github.com/mkoeppe/sage/actions/runs/1597453181\".",
    "created_at": "2021-12-19T02:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530399",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1364372711" to "https://github.com/mkoeppe/sage/actions/runs/1597453181".



---

archive/issue_comments_530400.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e\">2dee3f0</a></td><td><code>.github/workflows/tox.yml (macos): Remove max-parallel</code></td></tr></table>\n",
    "created_at": "2021-12-19T03:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530400",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>**Comment 37:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e">2dee3f0</a></td><td><code>.github/workflows/tox.yml (macos): Remove max-parallel</code></td></tr></table>




---

archive/issue_comments_530401.json:
```json
{
    "body": "**Changing commit** from \"[8617b6f7ab260bf528bc486dffcc4dab51222d12](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)\" to \"[2dee3f04b47c83ff1e14f827b52b0d381bb2155e](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)\".",
    "created_at": "2021-12-19T03:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530401",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8617b6f7ab260bf528bc486dffcc4dab51222d12](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)" to "[2dee3f04b47c83ff1e14f827b52b0d381bb2155e](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)".



---

archive/issue_comments_530402.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nLooks like homebrew's `gcc` package no longer installs an unversioned `gfortran` binary\n\nhttps://github.com/mkoeppe/sage/runs/4572338375?check_suite_focus=true",
    "created_at": "2021-12-20T00:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530402",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'>**Comment 38:**</a>
Looks like homebrew's `gcc` package no longer installs an unversioned `gfortran` binary

https://github.com/mkoeppe/sage/runs/4572338375?check_suite_focus=true



---

archive/issue_comments_530403.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nAlso conda install fails early\n\nhttps://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true",
    "created_at": "2021-12-20T00:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530403",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>**Comment 39:**</a>
Also conda install fails early

https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true



---

archive/issue_comments_530404.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nReplying to [@mkoeppe](#comment%3A39):\n> Also conda install fails early\n> \n> https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true\n\n(same as [#32113 comment:17](https://github.com/sagemath/sage/issues/32113#comment:17))",
    "created_at": "2021-12-20T06:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530404",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>**Comment 40:**</a>
Replying to [@mkoeppe](#comment%3A39):
> Also conda install fails early
> 
> https://github.com/mkoeppe/sage/runs/4572338435?check_suite_focus=true

(same as [#32113 comment:17](https://github.com/sagemath/sage/issues/32113#comment:17))



---

archive/issue_comments_530405.json:
```json
{
    "body": "**Dependencies:** #32113",
    "created_at": "2021-12-21T00:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530405",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #32113



---

archive/issue_comments_530406.json:
```json
{
    "body": "**Changing commit** from \"[2dee3f04b47c83ff1e14f827b52b0d381bb2155e](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)\" to \"[64185798705c4416db04fff577b0abb392445d35](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)\".",
    "created_at": "2021-12-21T03:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530406",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2dee3f04b47c83ff1e14f827b52b0d381bb2155e](https://github.com/sagemath/sagetrac-mirror/commit/2dee3f04b47c83ff1e14f827b52b0d381bb2155e)" to "[64185798705c4416db04fff577b0abb392445d35](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)".



---

archive/issue_comments_530407.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43d481b01ee129eb5ffcf52b848012e648663a91\">43d481b</a></td><td><code>bump to 0.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66821b0fd8b060d49fc2177f56ad79584f8ec0b\">f66821b</a></td><td><code>cysignals are needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae37b4e39479f6592296e3502eabdc585af662a8\">ae37b4e</a></td><td><code>deprecate sage.interfaces.primecount, not just remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ae5f4225be135ef739851c033319ec731dcb73\">d3ae5f4</a></td><td><code>primecount is on conda, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a8c7fee219003c5ee076d4917b677013642b1bb\">3a8c7fe</a></td><td><code>primesieve is on conda, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74b38459edb9c9ae7417883adf15eba1e981631d\">74b3845</a></td><td><code>allow float inputs for prime_pi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/591be341aedee6fd533924a9a228f68ab7a245bd\">591be34</a></td><td><code>Merge #32894</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/049a5f600cc138aa816d983d9adb7e47ae75ecd2\">049a5f6</a></td><td><code>tox.ini: Do not set environment variable CONDARC</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3116a125a3283b84240c783d3d19900ca740614\">f3116a1</a></td><td><code>tox.ini (conda): Force use of conda's python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35\">6418579</a></td><td><code>Merge #32113</code></td></tr></table>\n",
    "created_at": "2021-12-21T03:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530407",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>**Comment 42:**</a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43d481b01ee129eb5ffcf52b848012e648663a91">43d481b</a></td><td><code>bump to 0.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66821b0fd8b060d49fc2177f56ad79584f8ec0b">f66821b</a></td><td><code>cysignals are needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae37b4e39479f6592296e3502eabdc585af662a8">ae37b4e</a></td><td><code>deprecate sage.interfaces.primecount, not just remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ae5f4225be135ef739851c033319ec731dcb73">d3ae5f4</a></td><td><code>primecount is on conda, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a8c7fee219003c5ee076d4917b677013642b1bb">3a8c7fe</a></td><td><code>primesieve is on conda, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74b38459edb9c9ae7417883adf15eba1e981631d">74b3845</a></td><td><code>allow float inputs for prime_pi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/591be341aedee6fd533924a9a228f68ab7a245bd">591be34</a></td><td><code>Merge #32894</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/049a5f600cc138aa816d983d9adb7e47ae75ecd2">049a5f6</a></td><td><code>tox.ini: Do not set environment variable CONDARC</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3116a125a3283b84240c783d3d19900ca740614">f3116a1</a></td><td><code>tox.ini (conda): Force use of conda's python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35">6418579</a></td><td><code>Merge #32113</code></td></tr></table>




---

archive/issue_comments_530408.json:
```json
{
    "body": "**Changing commit** from \"[64185798705c4416db04fff577b0abb392445d35](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)\" to \"[933134c1d91239b0f633795a5e55b656362fec96](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)\".",
    "created_at": "2021-12-21T03:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530408",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[64185798705c4416db04fff577b0abb392445d35](https://github.com/sagemath/sagetrac-mirror/commit/64185798705c4416db04fff577b0abb392445d35)" to "[933134c1d91239b0f633795a5e55b656362fec96](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)".



---

archive/issue_comments_530409.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96\">933134c</a></td><td><code>build/pkgs/gfortran/distros/homebrew.txt: Use gfortran</code></td></tr></table>\n",
    "created_at": "2021-12-21T03:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530409",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:43'>**Comment 43:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96">933134c</a></td><td><code>build/pkgs/gfortran/distros/homebrew.txt: Use gfortran</code></td></tr></table>




---

archive/issue_comments_530410.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1597453181\" to \"https://github.com/mkoeppe/sage/actions/runs/1605145773\".",
    "created_at": "2021-12-21T04:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530410",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1597453181" to "https://github.com/mkoeppe/sage/actions/runs/1605145773".



---

archive/issue_events_396750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T04:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396750"
}
```



---

archive/issue_comments_530411.json:
```json
{
    "body": "**Changing dependencies** from \"#32113\" to \"#32113, #32947\".",
    "created_at": "2021-12-21T07:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530411",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32113" to "#32113, #32947".



---

archive/issue_comments_530412.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab4fb992263715bf0ef2f86c0eedbb3f14f82d2d\">ab4fb99</a></td><td><code>tox.ini: Add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e51225a6a2f759fe06f316f79ccdec23ec100608\">e51225a</a></td><td><code>.github/workflows/tox*.yml: Remove debian-jessie, add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac47e7da19a9e960f1a1b7d8de5141a2ca423ed4\">ac47e7d</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1aa9328f098181ab6b9a1c143a52875a797048e6\">1aa9328</a></td><td><code>Merge #32947</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065\">e99a09e</a></td><td><code>sed -i.bak 's/ubunty/ubuntu/g' .github/workflows/*.yml</code></td></tr></table>\n",
    "created_at": "2021-12-21T07:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530412",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'>**Comment 47:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab4fb992263715bf0ef2f86c0eedbb3f14f82d2d">ab4fb99</a></td><td><code>tox.ini: Add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e51225a6a2f759fe06f316f79ccdec23ec100608">e51225a</a></td><td><code>.github/workflows/tox*.yml: Remove debian-jessie, add ubuntu-jammy, debian-bookworm, linuxmint-20.3, fedora-36</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac47e7da19a9e960f1a1b7d8de5141a2ca423ed4">ac47e7d</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1aa9328f098181ab6b9a1c143a52875a797048e6">1aa9328</a></td><td><code>Merge #32947</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065">e99a09e</a></td><td><code>sed -i.bak 's/ubunty/ubuntu/g' .github/workflows/*.yml</code></td></tr></table>




---

archive/issue_comments_530413.json:
```json
{
    "body": "**Changing commit** from \"[933134c1d91239b0f633795a5e55b656362fec96](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)\" to \"[e99a09e55439e4276e87d248ab80d816f9735065](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)\".",
    "created_at": "2021-12-21T07:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530413",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[933134c1d91239b0f633795a5e55b656362fec96](https://github.com/sagemath/sagetrac-mirror/commit/933134c1d91239b0f633795a5e55b656362fec96)" to "[e99a09e55439e4276e87d248ab80d816f9735065](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)".



---

archive/issue_comments_530414.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nI know we already touch upon this point, but can you please expand on\n> Unfortunately, because \u200bbecause \"needs\" cannot depend on \"matrix\", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed \n\nThat is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix. In particular, I don't understand the \"all platforms\" part, as ubuntu and macos are in different jobs, right? It appears to me that with the current design also stage 1 builds are executed before any stage 2 is executed, so the only difference is that you can already have 4 or so stage 2 builds running while the last stage 1 build finishes. I guess for the overall build time this shouldn't make much of a difference anyway, as these 4 runners would be busy with other workflows then (or are free to execute builds of other stuff in the sagemath org).",
    "created_at": "2021-12-21T16:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530414",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:48'>**Comment 48:**</a>
I know we already touch upon this point, but can you please expand on
> Unfortunately, because ​because "needs" cannot depend on "matrix", the jobs for building/testing Python packages would not start before all jobs building SAGE_LOCAL for all platforms are completed 

That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix. In particular, I don't understand the "all platforms" part, as ubuntu and macos are in different jobs, right? It appears to me that with the current design also stage 1 builds are executed before any stage 2 is executed, so the only difference is that you can already have 4 or so stage 2 builds running while the last stage 1 build finishes. I guess for the overall build time this shouldn't make much of a difference anyway, as these 4 runners would be busy with other workflows then (or are free to execute builds of other stuff in the sagemath org).



---

archive/issue_comments_530415.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\nReplying to [@tobiasdiez](#comment%3A48):\n> That is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix.\n\nTo avoid copy-paste",
    "created_at": "2021-12-21T16:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530415",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'>**Comment 49:**</a>
Replying to [@tobiasdiez](#comment%3A48):
> That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix.

To avoid copy-paste



---

archive/issue_comments_530416.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nReplying to [@tobiasdiez](#comment%3A48):\n>  I don't understand the \"all platforms\" part, as ubuntu and macos are in different jobs, right?\n\nYes, that's right, within each job; and in this ticket, only for macos.",
    "created_at": "2021-12-21T16:30:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530416",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'>**Comment 50:**</a>
Replying to [@tobiasdiez](#comment%3A48):
>  I don't understand the "all platforms" part, as ubuntu and macos are in different jobs, right?

Yes, that's right, within each job; and in this ticket, only for macos.



---

archive/issue_comments_530417.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nReplying to [@mkoeppe](#comment%3A49):\n> Replying to [@tobiasdiez](#comment%3A48):\n> > That is, why do you prefer the \"custom stage build\" over having a \"local-macos-stage2\" job that depends via \"needs\" on \"local-macos-stage1\", where each of these jobs defines an appropriate matrix.\n\n> \n> To avoid copy-paste\n\nGithub recently made it possible to reuse workflows: https://docs.github.com/en/actions/learn-github-actions/reusing-workflows\nThus you could extract the current local-macos job into a new workflow and pass the right \"tox\" command as an argument (determined by the matrix + step).",
    "created_at": "2021-12-21T16:40:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530417",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:51'>**Comment 51:**</a>
Replying to [@mkoeppe](#comment%3A49):
> Replying to [@tobiasdiez](#comment%3A48):
> > That is, why do you prefer the "custom stage build" over having a "local-macos-stage2" job that depends via "needs" on "local-macos-stage1", where each of these jobs defines an appropriate matrix.

> 
> To avoid copy-paste

Github recently made it possible to reuse workflows: https://docs.github.com/en/actions/learn-github-actions/reusing-workflows
Thus you could extract the current local-macos job into a new workflow and pass the right "tox" command as an argument (determined by the matrix + step).



---

archive/issue_comments_530418.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\nThanks for the pointer!! I've added this to #29060 for welcome future refactoring - but this won't make it into Sage 9.5",
    "created_at": "2021-12-21T16:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:52'>**Comment 52:**</a>
Thanks for the pointer!! I've added this to #29060 for welcome future refactoring - but this won't make it into Sage 9.5



---

archive/issue_comments_530419.json:
```json
{
    "body": "**Changing commit** from \"[e99a09e55439e4276e87d248ab80d816f9735065](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)\" to \"[edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)\".",
    "created_at": "2021-12-21T17:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530419",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e99a09e55439e4276e87d248ab80d816f9735065](https://github.com/sagemath/sagetrac-mirror/commit/e99a09e55439e4276e87d248ab80d816f9735065)" to "[edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)".



---

archive/issue_comments_530420.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b\">edb4364</a></td><td><code>.github/workflows/tox.yml: Replace homebrew-macos-python3_xcode-standard by homebrew-macos-usrlocal-python3_xcode-standard</code></td></tr></table>\n",
    "created_at": "2021-12-21T17:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530420",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:53'>**Comment 53:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b">edb4364</a></td><td><code>.github/workflows/tox.yml: Replace homebrew-macos-python3_xcode-standard by homebrew-macos-usrlocal-python3_xcode-standard</code></td></tr></table>




---

archive/issue_comments_530421.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -18,8 +18,6 @@\n \n As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.\n \n-References\n-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching\n+We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.\n \n \n-\n``````\n",
    "created_at": "2021-12-21T17:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530421",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -18,8 +18,6 @@
 
 As of this ticket, we rely on the bottleneck of the available parallel jobs on GH Actions to ensure that the 2nd stages of a configuration are run after the 1st stage of that configuration. Experience with this workflow will show whether this suffices.
 
-References
-- https://evilmartians.com/chronicles/build-images-on-github-actions-with-docker-layer-caching
+We also update the macOS/Xcode versions according to what's available on GH Actions and switch the `homebrew` builds to faster `homebrew-usrlocal` variants, which can use bottles for all available packages.
 
 
-
``````




---

archive/issue_events_396751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:29:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "rename": {
        "from": "GH Actions: Run a job for \"make build-local\" first, cache image for job \"make build\"",
        "to": "GH Actions (macOS): Run a job for \"make build-local\" first, cache image for job \"make build\""
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396751"
}
```



---

archive/issue_events_396752.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-23T14:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396752"
}
```



---

archive/issue_events_396753.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-23T14:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396753"
}
```



---

archive/issue_comments_530422.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1605145773\" to \"Dima Pasechnik\".",
    "created_at": "2021-12-23T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530422",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1605145773" to "Dima Pasechnik".



---

archive/issue_comments_530423.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nOK,macOS runs on GH look good.",
    "created_at": "2021-12-23T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530423",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'>**Comment 55:**</a>
OK,macOS runs on GH look good.



---

archive/issue_comments_530424.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nThanks!",
    "created_at": "2021-12-23T16:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530424",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'>**Comment 56:**</a>
Thanks!



---

archive/issue_events_396754.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396754"
}
```



---

archive/issue_events_396755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c4f76c053f147913562780906ce372fca2943693",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-01-01T00:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32703#event-396755"
}
```



---

archive/issue_comments_530425.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)\" to \"[edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)\".",
    "created_at": "2022-01-01T00:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32703#issuecomment-530425",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__run_a_job_for__make_build_local__first__cache_image_for_job__make_build_)" to "[edb4364000d32c72f057bad0faa81d9ba2a79b9b](https://github.com/sagemath/sagetrac-mirror/commit/edb4364000d32c72f057bad0faa81d9ba2a79b9b)".
