# Issue 32902: Use cached _row_ambient_module and _column_ambient_module for matrices

archive/issues_032665.json:
```json
{
    "body": "Before:\n\n```\nsage: set_random_seed(0)\nsage: M = random_matrix(Qp(5, 5), 5)\nsage: v = random_vector(Qp(5, 5), 5)\nsage: %timeit v*M\n14.2 \u00b5s \u00b1 57.7 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M*v\n13.4 \u00b5s \u00b1 46.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M.row(3)\n4.03 \u00b5s \u00b1 15.9 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M.column(3)\n4.23 \u00b5s \u00b1 23.3 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: M = random_matrix(QQ, 10)\nsage: %timeit M.row(3)\n3.1 \u00b5s \u00b1 11.4 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M.column(3)\n3.14 \u00b5s \u00b1 5.96 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: M = random_matrix(QQ, 10, sparse=True)\nsage: v = random_vector(QQ, 10)\nsage: %timeit v*M\n85.2 \u00b5s \u00b1 53.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit M*v\n86.5 \u00b5s \u00b1 96.6 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: v = random_vector(QQ, 10, sparse=True)\nsage: %timeit v*M\n80.1 \u00b5s \u00b1 113 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit M*v\n80.6 \u00b5s \u00b1 224 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nAfter:\n\n```\nsage: set_random_seed(0)\nsage: M = random_matrix(Qp(5, 5), 5)\nsage: v = random_vector(Qp(5, 5), 5)\nsage: %timeit v*M\n11.5 \u00b5s \u00b1 28 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M*v\n10.9 \u00b5s \u00b1 18.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M.row(3)\n2.36 \u00b5s \u00b1 12.5 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit M.column(3)\n2.46 \u00b5s \u00b1 12.3 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: M = random_matrix(QQ, 10)\nsage: %timeit M.row(3)\n1.1 \u00b5s \u00b1 0.251 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit M.column(3)\n1.12 \u00b5s \u00b1 0.771 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: M = random_matrix(QQ, 10, sparse=True)\nsage: v = random_vector(QQ, 10)\nsage: %timeit v*M\n81 \u00b5s \u00b1 83.4 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit M*v\n83.5 \u00b5s \u00b1 75.5 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: v = random_vector(QQ, 10, sparse=True)\nsage: %timeit v*M\n75.5 \u00b5s \u00b1 79.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit M*v\n76.6 \u00b5s \u00b1 86.9 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nCC:  @orlitzky\n\nBranch/Commit: 77907fcf31efd2be79b731790279723385ae4531\n\nReviewer: Michael Orlitzky\n\nAuthor: Jonathan Kliem\n\nDependencies: #32901\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32902\n\n",
    "closed_at": "2021-12-19T11:47:14Z",
    "created_at": "2021-11-19T08:48:52Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Use cached _row_ambient_module and _column_ambient_module for matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32902",
    "user": "https://github.com/kliem"
}
```
Before:

```
sage: set_random_seed(0)
sage: M = random_matrix(Qp(5, 5), 5)
sage: v = random_vector(Qp(5, 5), 5)
sage: %timeit v*M
14.2 µs ± 57.7 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M*v
13.4 µs ± 46.2 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M.row(3)
4.03 µs ± 15.9 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M.column(3)
4.23 µs ± 23.3 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: M = random_matrix(QQ, 10)
sage: %timeit M.row(3)
3.1 µs ± 11.4 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M.column(3)
3.14 µs ± 5.96 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: M = random_matrix(QQ, 10, sparse=True)
sage: v = random_vector(QQ, 10)
sage: %timeit v*M
85.2 µs ± 53.8 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit M*v
86.5 µs ± 96.6 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: v = random_vector(QQ, 10, sparse=True)
sage: %timeit v*M
80.1 µs ± 113 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit M*v
80.6 µs ± 224 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

After:

```
sage: set_random_seed(0)
sage: M = random_matrix(Qp(5, 5), 5)
sage: v = random_vector(Qp(5, 5), 5)
sage: %timeit v*M
11.5 µs ± 28 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M*v
10.9 µs ± 18.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M.row(3)
2.36 µs ± 12.5 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit M.column(3)
2.46 µs ± 12.3 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: M = random_matrix(QQ, 10)
sage: %timeit M.row(3)
1.1 µs ± 0.251 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit M.column(3)
1.12 µs ± 0.771 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: M = random_matrix(QQ, 10, sparse=True)
sage: v = random_vector(QQ, 10)
sage: %timeit v*M
81 µs ± 83.4 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit M*v
83.5 µs ± 75.5 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: v = random_vector(QQ, 10, sparse=True)
sage: %timeit v*M
75.5 µs ± 79.2 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit M*v
76.6 µs ± 86.9 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

CC:  @orlitzky

Branch/Commit: 77907fcf31efd2be79b731790279723385ae4531

Reviewer: Michael Orlitzky

Author: Jonathan Kliem

Dependencies: #32901

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32902





---

archive/issue_comments_465494.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-11-19T08:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465494",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_465495.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-19T09:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465495",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465496.json:
```json
{
    "body": "<a id='comment:4'></a>I think you could make the same `base_ring()`, `ncols()/nrows()`, and `is_sparse()` optimizations from the other ticket here.",
    "created_at": "2021-11-30T00:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465496",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>I think you could make the same `base_ring()`, `ncols()/nrows()`, and `is_sparse()` optimizations from the other ticket here.



---

archive/issue_comments_465497.json:
```json
{
    "body": "<a id='comment:5'></a>I've done some small optimizations as requested.",
    "created_at": "2021-11-30T08:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465497",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>I've done some small optimizations as requested.



---

archive/issue_comments_465498.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2021-11-30T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465498",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_465499.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-30T15:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465499",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_086972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-19T11:47:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32902#event-86972"
}
```



---

archive/issue_comments_465500.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-19T11:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32902",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32902#issuecomment-465500",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
