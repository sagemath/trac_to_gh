# Issue 32981: Use CPU time for --warn-long and a low default limit for non-long tests

archive/issues_032744.json:
```json
{
    "body": "As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag, and is only enabled when timing information from previous test runs is available. Our developers' guide suggests that even a \"long time\" test should complete in under five seconds:\n\nhttps://doc.sagemath.org/html/en/developer/doctesting.html#optional-arguments\n\nThis ticket addresses two problems:\n\n1. The timing information is often unavailable. We should still warn about long tests in that case.\n2. The default of 60 CPU-equivalent seconds is much too high when `--long` is not in use.\n\nBoth of these issues stem from using the \"wall time\" to measure how long a test has run. Wall time is inherently unstable; if you're watching a movie, the tests will take longer. On a slower computer, the tests will take longer. Et cetera. The use of timing information from previous runs and the obscenely high `--warn-long` limit partially address that.\n\nSo in targeting our two issues, we first aim to switch the timing reports and `--warn-long` flag to use CPU time instead of wall time. CPU time is more reliable, since it only reports time actually spent working on the problem. (It's still sensitive to things like physical CPU time and `CFLAGS`; those will be addressed in #33022). With CPU time being used, the timings will be much more consistent, allowing us to lower the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.\n\nThe main difficulty is in accounting for CPU time spent in pexpect subprocesses. We don't `wait()` for those and they may not terminate, so the OS's usual methods of retrieving child process statistics don't work for them. At present we have a PID-based solution that works quickly on Linux/BSD, but something similar for macOS would be nice.\n\n**CC:**  @vbraun @tornaria\n\n**Branch:** [u/mjo/ticket/32981](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/32981)\n\n**Commit:** [d7d2cffd9913bb0dc511a24534316f7d458d2e45](https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45)\n\n**Work Issues:** cputime by PID on macOS\n\n**Reviewer:** https://github.com/sagemath/sage/actions/runs/1992568379\n\n**Author:** Michael Orlitzky\n\n**Status:** needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/32981\n\n",
    "created_at": "2021-12-06T12:58:24Z",
    "labels": [
        "component: doctest framework",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Use CPU time for --warn-long and a low default limit for non-long tests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32981",
    "user": "https://github.com/orlitzky"
}
```
As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag, and is only enabled when timing information from previous test runs is available. Our developers' guide suggests that even a "long time" test should complete in under five seconds:

https://doc.sagemath.org/html/en/developer/doctesting.html#optional-arguments

This ticket addresses two problems:

1. The timing information is often unavailable. We should still warn about long tests in that case.
2. The default of 60 CPU-equivalent seconds is much too high when `--long` is not in use.

Both of these issues stem from using the "wall time" to measure how long a test has run. Wall time is inherently unstable; if you're watching a movie, the tests will take longer. On a slower computer, the tests will take longer. Et cetera. The use of timing information from previous runs and the obscenely high `--warn-long` limit partially address that.

So in targeting our two issues, we first aim to switch the timing reports and `--warn-long` flag to use CPU time instead of wall time. CPU time is more reliable, since it only reports time actually spent working on the problem. (It's still sensitive to things like physical CPU time and `CFLAGS`; those will be addressed in #33022). With CPU time being used, the timings will be much more consistent, allowing us to lower the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.

The main difficulty is in accounting for CPU time spent in pexpect subprocesses. We don't `wait()` for those and they may not terminate, so the OS's usual methods of retrieving child process statistics don't work for them. At present we have a PID-based solution that works quickly on Linux/BSD, but something similar for macOS would be nice.

**CC:**  @vbraun @tornaria

**Branch:** [u/mjo/ticket/32981](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/32981)

**Commit:** [d7d2cffd9913bb0dc511a24534316f7d458d2e45](https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45)

**Work Issues:** cputime by PID on macOS

**Reviewer:** https://github.com/sagemath/sage/actions/runs/1992568379

**Author:** Michael Orlitzky

**Status:** needs_work

Issue created by migration from https://trac.sagemath.org/ticket/32981





---

archive/issue_comments_657658.json:
```json
{
    "body": "**Author:** Michael Orlitzky",
    "created_at": "2021-12-06T13:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657658",
    "user": "https://github.com/orlitzky"
}
```

**Author:** Michael Orlitzky



---

archive/issue_comments_657659.json:
```json
{
    "body": "**Branch:** [u/mjo/ticket/32981](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/32981)",
    "created_at": "2021-12-06T13:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657659",
    "user": "https://github.com/orlitzky"
}
```

**Branch:** [u/mjo/ticket/32981](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/32981)



---

archive/issue_comments_657660.json:
```json
{
    "body": "<a id='comment:1'></a>\nVolker, any idea why we used wall time for the limit rather than CPU time? It's making it a bit awkward to pick a multiplier when no timing information is available (which is usually the case for me).",
    "created_at": "2021-12-06T13:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657660",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
Volker, any idea why we used wall time for the limit rather than CPU time? It's making it a bit awkward to pick a multiplier when no timing information is available (which is usually the case for me).



---

archive/issue_comments_657661.json:
```json
{
    "body": "**Commit:** [6c681874bffcd040782ee3bb695fed10322a55ed](https://github.com/sagemath/sagetrac-mirror/commit/6c681874bffcd040782ee3bb695fed10322a55ed)",
    "created_at": "2021-12-06T13:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657661",
    "user": "https://github.com/orlitzky"
}
```

**Commit:** [6c681874bffcd040782ee3bb695fed10322a55ed](https://github.com/sagemath/sagetrac-mirror/commit/6c681874bffcd040782ee3bb695fed10322a55ed)



---

archive/issue_comments_657662.json:
```json
{
    "body": "**Changing commit** from \"[6c681874bffcd040782ee3bb695fed10322a55ed](https://github.com/sagemath/sagetrac-mirror/commit/6c681874bffcd040782ee3bb695fed10322a55ed)\" to \"[2959d099eab69dcda741eb43524c3ea24ff6b99e](https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e)\".",
    "created_at": "2021-12-08T14:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6c681874bffcd040782ee3bb695fed10322a55ed](https://github.com/sagemath/sagetrac-mirror/commit/6c681874bffcd040782ee3bb695fed10322a55ed)" to "[2959d099eab69dcda741eb43524c3ea24ff6b99e](https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e)".



---

archive/issue_comments_657663.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e\">2959d09</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr></table>\n",
    "created_at": "2021-12-08T14:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e">2959d09</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr></table>




---

archive/issue_comments_657664.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is a bit too lenient IMO... allowing 15s for a non-long test when no timing information is available. Still, it's an improvement.",
    "created_at": "2021-12-08T14:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657664",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>
This is a bit too lenient IMO... allowing 15s for a non-long test when no timing information is available. Still, it's an improvement.



---

archive/issue_comments_657665.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-12-08T14:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657665",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_657666.json:
```json
{
    "body": "<a id='comment:4'></a>\nI'm just going to put in the effort to switch this to CPU time, which makes a lot more sense for a time measurement that needs to be consistent across machines.",
    "created_at": "2021-12-08T17:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657666",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>
I'm just going to put in the effort to switch this to CPU time, which makes a lot more sense for a time measurement that needs to be consistent across machines.



---

archive/issue_comments_657667.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-12-08T17:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657667",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_657668.json:
```json
{
    "body": "**Changing commit** from \"[2959d099eab69dcda741eb43524c3ea24ff6b99e](https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e)\" to \"[66c4cc86d5d2ec3c098dff6a51be35df13e90851](https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851)\".",
    "created_at": "2021-12-08T21:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657668",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2959d099eab69dcda741eb43524c3ea24ff6b99e](https://github.com/sagemath/sagetrac-mirror/commit/2959d099eab69dcda741eb43524c3ea24ff6b99e)" to "[66c4cc86d5d2ec3c098dff6a51be35df13e90851](https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851)".



---

archive/issue_comments_657669.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0de97ac361238a3bf1310dd7a7812c48c737ec82\">0de97ac</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b9b07b01e3b9b03dc3631cee8c0373ba128dbaa\">4b9b07b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851\">66c4cc8</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr></table>\n",
    "created_at": "2021-12-08T21:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0de97ac361238a3bf1310dd7a7812c48c737ec82">0de97ac</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b9b07b01e3b9b03dc3631cee8c0373ba128dbaa">4b9b07b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851">66c4cc8</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr></table>




---

archive/issue_comments_657670.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-12-08T21:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657670",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_098016.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "rename": {
        "from": "Reduce --warn-long limit for normal (not long-time) test runs",
        "to": "Use CPU time for --warn-long and a low default limit for non-long tests"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98016"
}
```



---

archive/issue_comments_657671.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n-As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag. Our developers' guide suggests that even a \"long time\" test should complete in under five seconds,\n+As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag, and is only enabled when timing information from previous test runs is available. Our developers' guide suggests that even a \"long time\" test should complete in under five seconds:\n \n https://doc.sagemath.org/html/en/developer/doctesting.html#optional-arguments\n \n-so I think it's fair to warn about non-long-time tests that take longer than (say) ten seconds.\n+This ticket addresses two problems:\n \n+1. The timing information is often unavailable. We should still warn about long tests in that case.\n+2. The default of 60 wall-time seconds is much to high when `--long` is not in use.\n+\n+Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.\n+\n``````\n",
    "created_at": "2021-12-08T21:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657671",
    "user": "https://github.com/orlitzky"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,11 @@
-As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag. Our developers' guide suggests that even a "long time" test should complete in under five seconds,
+As discussed in #32973, the default value of `--warn-long` is roughly a minute, independent of the `--long` flag, and is only enabled when timing information from previous test runs is available. Our developers' guide suggests that even a "long time" test should complete in under five seconds:
 
 https://doc.sagemath.org/html/en/developer/doctesting.html#optional-arguments
 
-so I think it's fair to warn about non-long-time tests that take longer than (say) ten seconds.
+This ticket addresses two problems:
 
+1. The timing information is often unavailable. We should still warn about long tests in that case.
+2. The default of 60 wall-time seconds is much to high when `--long` is not in use.
+
+Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.
+
``````




---

archive/issue_comments_657672.json:
```json
{
    "body": "<a id='comment:6'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0de97ac361238a3bf1310dd7a7812c48c737ec82\">0de97ac</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b9b07b01e3b9b03dc3631cee8c0373ba128dbaa\">4b9b07b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851\">66c4cc8</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr></table>\n",
    "created_at": "2021-12-08T21:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657672",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0de97ac361238a3bf1310dd7a7812c48c737ec82">0de97ac</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b9b07b01e3b9b03dc3631cee8c0373ba128dbaa">4b9b07b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851">66c4cc8</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr></table>




---

archive/issue_comments_657673.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n This ticket addresses two problems:\n \n 1. The timing information is often unavailable. We should still warn about long tests in that case.\n-2. The default of 60 wall-time seconds is much to high when `--long` is not in use.\n+2. The default of 60 CPU-equivalent seconds is much to high when `--long` is not in use.\n \n Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.\n \n``````\n",
    "created_at": "2021-12-08T21:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657673",
    "user": "https://github.com/orlitzky"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 This ticket addresses two problems:
 
 1. The timing information is often unavailable. We should still warn about long tests in that case.
-2. The default of 60 wall-time seconds is much to high when `--long` is not in use.
+2. The default of 60 CPU-equivalent seconds is much to high when `--long` is not in use.
 
 Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.
 
``````




---

archive/issue_events_098017.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98017"
}
```



---

archive/issue_comments_657674.json:
```json
{
    "body": "<a id='comment:9'></a>\nOne reason for using wall time instead of CPU time might be that it works better for computations that use external processes like Pexpect:\n\n```\nsage: R = PolynomialRing(GF(101), 'x', 8)\n....: J = sage.rings.ideal.Cyclic(R)\n....: %time gb = J.groebner_basis(algorithm='singular')\nCPU times: user 917 ms, sys: 52.6 ms, total: 969 ms\nWall time: 33.2 s\n```",
    "created_at": "2022-02-08T21:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657674",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:9'></a>
One reason for using wall time instead of CPU time might be that it works better for computations that use external processes like Pexpect:

```
sage: R = PolynomialRing(GF(101), 'x', 8)
....: J = sage.rings.ideal.Cyclic(R)
....: %time gb = J.groebner_basis(algorithm='singular')
CPU times: user 917 ms, sys: 52.6 ms, total: 969 ms
Wall time: 33.2 s
```



---

archive/issue_comments_657675.json:
```json
{
    "body": "<a id='comment:10'></a>\nMaybe measure both and pay attention to wall time only if it is much longer than CPU time. I don't know if \"much longer\" should be a raw time (5 seconds longer) or a multiple (10 times as long). We want informative messages, so this doesn't have to be flawless.",
    "created_at": "2022-02-08T22:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657675",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Maybe measure both and pay attention to wall time only if it is much longer than CPU time. I don't know if "much longer" should be a raw time (5 seconds longer) or a multiple (10 times as long). We want informative messages, so this doesn't have to be flawless.



---

archive/issue_comments_657676.json:
```json
{
    "body": "<a id='comment:11'></a>\nWell.. that's embarrassing. I'll have to think about it.",
    "created_at": "2022-02-08T22:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657676",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
Well.. that's embarrassing. I'll have to think about it.



---

archive/issue_comments_657677.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-02-08T22:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657677",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_657678.json:
```json
{
    "body": "<a id='comment:12'></a>\nOh, we just have to pass `subprocesses=True` inside the doctest timer. I guess nobody noticed until now because the cputime wasn't reported anyway. I'll update the branch once I'm sure it works correctly.",
    "created_at": "2022-02-08T22:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657678",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>
Oh, we just have to pass `subprocesses=True` inside the doctest timer. I guess nobody noticed until now because the cputime wasn't reported anyway. I'll update the branch once I'm sure it works correctly.



---

archive/issue_comments_657679.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5a65c0cc553dd256f5f89d2be7480acd5ae42fb\">a5a65c0</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e45130b26e95ffd860ef55819ba1ff1685f71c42\">e45130b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d204ab4cd81041e5db423fd3eabd05007e50f6a7\">d204ab4</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/970763994ebcdd8bc8d446ba5bb2b82ea90e46a9\">9707639</a></td><td><code>Trac #32981: collect cputime for subprocesses while doctesting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c29f5949720444676ee74bb2f494c6eee5c535c\">5c29f59</a></td><td><code>Trac #32981: report doctest success in CPU time.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/376419753364edf1aa8c9ba9dcd845e2eea3fcf0\">3764197</a></td><td><code>Trac #32981: account for subprocesses in sage0 interface's cputime().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8\">d869a09</a></td><td><code>Trac #32981: don't pass \"None\" to cputime() in sage0 interface.</code></td></tr></table>\n",
    "created_at": "2022-02-09T15:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657679",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5a65c0cc553dd256f5f89d2be7480acd5ae42fb">a5a65c0</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e45130b26e95ffd860ef55819ba1ff1685f71c42">e45130b</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d204ab4cd81041e5db423fd3eabd05007e50f6a7">d204ab4</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/970763994ebcdd8bc8d446ba5bb2b82ea90e46a9">9707639</a></td><td><code>Trac #32981: collect cputime for subprocesses while doctesting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c29f5949720444676ee74bb2f494c6eee5c535c">5c29f59</a></td><td><code>Trac #32981: report doctest success in CPU time.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/376419753364edf1aa8c9ba9dcd845e2eea3fcf0">3764197</a></td><td><code>Trac #32981: account for subprocesses in sage0 interface's cputime().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8">d869a09</a></td><td><code>Trac #32981: don't pass "None" to cputime() in sage0 interface.</code></td></tr></table>




---

archive/issue_comments_657680.json:
```json
{
    "body": "**Changing commit** from \"[66c4cc86d5d2ec3c098dff6a51be35df13e90851](https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851)\" to \"[d869a095e99f0023c41e63b6827ad699d061f5e8](https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8)\".",
    "created_at": "2022-02-09T15:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657680",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[66c4cc86d5d2ec3c098dff6a51be35df13e90851](https://github.com/sagemath/sagetrac-mirror/commit/66c4cc86d5d2ec3c098dff6a51be35df13e90851)" to "[d869a095e99f0023c41e63b6827ad699d061f5e8](https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8)".



---

archive/issue_comments_657681.json:
```json
{
    "body": "<a id='comment:14'></a>\nThat fixed the immediate problem, but caused several more. Doctesting the doctest framework using the sage pexpect interface to itself is pretty fragile, who would've thought...",
    "created_at": "2022-02-09T16:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657681",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'></a>
That fixed the immediate problem, but caused several more. Doctesting the doctest framework using the sage pexpect interface to itself is pretty fragile, who would've thought...



---

archive/issue_comments_657682.json:
```json
{
    "body": "**Changing commit** from \"[d869a095e99f0023c41e63b6827ad699d061f5e8](https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8)\" to \"[61d7fe55dc22638f0ba056bed243893dfe87fde2](https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2)\".",
    "created_at": "2022-02-09T21:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d869a095e99f0023c41e63b6827ad699d061f5e8](https://github.com/sagemath/sagetrac-mirror/commit/d869a095e99f0023c41e63b6827ad699d061f5e8)" to "[61d7fe55dc22638f0ba056bed243893dfe87fde2](https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2)".



---

archive/issue_comments_657683.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eca0225c233438c68ee62fa26683a4bc5b5e5ba\">4eca022</a></td><td><code>Trac #32981: handle \"None\" object in sage display formatter.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e815b16c0201af16b8b2765d53c3c31a4f111c23\">e815b16</a></td><td><code>Trac #32981: disable sage0's cputime() in a few doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2\">61d7fe5</a></td><td><code>Trac #32981: add a sage0 doctest workaround to our display formatter.</code></td></tr></table>\n",
    "created_at": "2022-02-09T21:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eca0225c233438c68ee62fa26683a4bc5b5e5ba">4eca022</a></td><td><code>Trac #32981: handle "None" object in sage display formatter.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e815b16c0201af16b8b2765d53c3c31a4f111c23">e815b16</a></td><td><code>Trac #32981: disable sage0's cputime() in a few doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2">61d7fe5</a></td><td><code>Trac #32981: add a sage0 doctest workaround to our display formatter.</code></td></tr></table>




---

archive/issue_comments_657684.json:
```json
{
    "body": "**Changing commit** from \"[61d7fe55dc22638f0ba056bed243893dfe87fde2](https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2)\" to \"[3ae9735dac74e62ddfd58660bf456715763700be](https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be)\".",
    "created_at": "2022-02-10T00:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[61d7fe55dc22638f0ba056bed243893dfe87fde2](https://github.com/sagemath/sagetrac-mirror/commit/61d7fe55dc22638f0ba056bed243893dfe87fde2)" to "[3ae9735dac74e62ddfd58660bf456715763700be](https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be)".



---

archive/issue_comments_657685.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/801c29d46ce8b156869dcb3cb3596d87256b95e5\">801c29d</a></td><td><code>Trac #32981: disable sage0's cputime() in a few doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0d5dc8e550951afcda5b18cebf2d23c5f10dcfb\">a0d5dc8</a></td><td><code>Trac #32981: add a sage0 doctest workaround to our display formatter.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6ad665c9d219192a8a9e5eb927145d55104b0ed\">d6ad665</a></td><td><code>Trac #32981: disable cputime in some GAP interface tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d532cfed0a52f1017a4aef8a54af055e490add4\">9d532cf</a></td><td><code>Trac #32981: hide the user-facing \"Gap crashed!\" message.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be\">3ae9735</a></td><td><code>Trac #32981: add dummy `_strip_`prompt methods to gap/gp interfaces.</code></td></tr></table>\n",
    "created_at": "2022-02-10T00:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/801c29d46ce8b156869dcb3cb3596d87256b95e5">801c29d</a></td><td><code>Trac #32981: disable sage0's cputime() in a few doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0d5dc8e550951afcda5b18cebf2d23c5f10dcfb">a0d5dc8</a></td><td><code>Trac #32981: add a sage0 doctest workaround to our display formatter.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6ad665c9d219192a8a9e5eb927145d55104b0ed">d6ad665</a></td><td><code>Trac #32981: disable cputime in some GAP interface tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d532cfed0a52f1017a4aef8a54af055e490add4">9d532cf</a></td><td><code>Trac #32981: hide the user-facing "Gap crashed!" message.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be">3ae9735</a></td><td><code>Trac #32981: add dummy `_strip_`prompt methods to gap/gp interfaces.</code></td></tr></table>




---

archive/issue_comments_657686.json:
```json
{
    "body": "**Changing commit** from \"[3ae9735dac74e62ddfd58660bf456715763700be](https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be)\" to \"[58fc03a5037dc7d4c1eb1ab6713b38df586450f4](https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4)\".",
    "created_at": "2022-02-10T14:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3ae9735dac74e62ddfd58660bf456715763700be](https://github.com/sagemath/sagetrac-mirror/commit/3ae9735dac74e62ddfd58660bf456715763700be)" to "[58fc03a5037dc7d4c1eb1ab6713b38df586450f4](https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4)".



---

archive/issue_comments_657687.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e816a4d1932608f1eb31aa3d6d36ffc4fde0000b\">e816a4d</a></td><td><code>Trac #32981: report doctest success in CPU time.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4\">58fc03a</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr></table>\n",
    "created_at": "2022-02-10T14:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e816a4d1932608f1eb31aa3d6d36ffc4fde0000b">e816a4d</a></td><td><code>Trac #32981: report doctest success in CPU time.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4">58fc03a</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr></table>




---

archive/issue_comments_657688.json:
```json
{
    "body": "<a id='comment:18'></a>\nWell, at least I know why Volker chose to use walltime now. Several times yesterday I almost quit and wandered into the woods.\n\nUsing the existing `cputime(subprocesses=True)` isn't going to work. Our pexpect interfaces are flaky, and we have a lot of doctests that check for low-level \"incidental\" details that appear when using them. Moreover most don't actually implement `cputime()`. And that's just for standard packages -- the optional ones should be much worse.\n\nI was able to get the tests passing, but only by introducing twice as many WTFs as I discovered. I wouldn't commit such an atrocity, nor do I have the time to properly investigate and fix all of the underlying issues. Instead, I've reverted back to where the branch was two days ago, and added a commit that reliably computes the cputime for all subprocesses.... but only on Linux/BSD. The same information is probably available on macOS, but I don't have it in front of me to poke around.\n\nWhile platform-specific code is lame, I think this may be a reasonable trade-off, especially if we can get it working on macOS. We only need **someone** to notice & fix long tests, not **everyone**. And the missing information can only hurt for (a) pexpect tests, that (b) happen to run long. So it's not like the entire test suite will have incorrect timing information on e.g. Cygwin.",
    "created_at": "2022-02-10T15:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657688",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>
Well, at least I know why Volker chose to use walltime now. Several times yesterday I almost quit and wandered into the woods.

Using the existing `cputime(subprocesses=True)` isn't going to work. Our pexpect interfaces are flaky, and we have a lot of doctests that check for low-level "incidental" details that appear when using them. Moreover most don't actually implement `cputime()`. And that's just for standard packages -- the optional ones should be much worse.

I was able to get the tests passing, but only by introducing twice as many WTFs as I discovered. I wouldn't commit such an atrocity, nor do I have the time to properly investigate and fix all of the underlying issues. Instead, I've reverted back to where the branch was two days ago, and added a commit that reliably computes the cputime for all subprocesses.... but only on Linux/BSD. The same information is probably available on macOS, but I don't have it in front of me to poke around.

While platform-specific code is lame, I think this may be a reasonable trade-off, especially if we can get it working on macOS. We only need **someone** to notice & fix long tests, not **everyone**. And the missing information can only hurt for (a) pexpect tests, that (b) happen to run long. So it's not like the entire test suite will have incorrect timing information on e.g. Cygwin.



---

archive/issue_comments_657689.json:
```json
{
    "body": "<a id='comment:19'></a>\nIf only there were a Python package for that...",
    "created_at": "2022-02-10T18:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657689",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
If only there were a Python package for that...



---

archive/issue_comments_657690.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A19):\n> If only there were a Python package for that...\n\n\nIf you're referring to psutil, it's mainly a C package and consists of nothing BUT platform-specific code. The version we had was almost five years out of date and required a huge unmaintained patch that was rejected entirely by upstream. I'll take the ten lines we have now instead.\n\nWorst case, we can get the information from the OSX kernel with a another five lines of code.",
    "created_at": "2022-02-10T19:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657690",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A19):
> If only there were a Python package for that...


If you're referring to psutil, it's mainly a C package and consists of nothing BUT platform-specific code. The version we had was almost five years out of date and required a huge unmaintained patch that was rejected entirely by upstream. I'll take the ten lines we have now instead.

Worst case, we can get the information from the OSX kernel with a another five lines of code.



---

archive/issue_comments_657691.json:
```json
{
    "body": "**Work_Issues:** cputime by PID on macOS",
    "created_at": "2022-02-10T19:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657691",
    "user": "https://github.com/orlitzky"
}
```

**Work_Issues:** cputime by PID on macOS



---

archive/issue_comments_657692.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,10 @@\n This ticket addresses two problems:\n \n 1. The timing information is often unavailable. We should still warn about long tests in that case.\n-2. The default of 60 CPU-equivalent seconds is much to high when `--long` is not in use.\n+2. The default of 60 CPU-equivalent seconds is much too high when `--long` is not in use.\n \n-Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.\n+Both of these issues stem from using the \"wall time\" to measure how long a test has run. Wall time is inherently unstable; if you're watching a movie, the tests will take longer. On a slower computer, the tests will take longer. Et cetera. The use of timing information from previous runs and the obscenely high `--warn-long` limit partially address that.\n \n+So in targeting our two issues, we first aim to switch the timing reports and `--warn-long` flag to use CPU time instead of wall time. CPU time is more reliable, since it only reports time actually spent working on the problem. (It's still sensitive to things like physical CPU time and `CFLAGS`; those will be addressed in #33022). With CPU time being used, the timings will be much more consistent, allowing us to lower the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.\n+\n+The main difficulty is in accounting for CPU time spent in pexpect subprocesses. We don't `wait()` for those and they may not terminate, so the OS's usual methods of retrieving child process statistics don't work for them. At present we have a PID-based solution that works quickly on Linux/BSD, but something similar for macOS would be nice.\n``````\n",
    "created_at": "2022-02-10T19:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657692",
    "user": "https://github.com/orlitzky"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,10 @@
 This ticket addresses two problems:
 
 1. The timing information is often unavailable. We should still warn about long tests in that case.
-2. The default of 60 CPU-equivalent seconds is much to high when `--long` is not in use.
+2. The default of 60 CPU-equivalent seconds is much too high when `--long` is not in use.
 
-Towards those ends, the first thing we do is switch the `--warn-long` flag to accept CPU time (as opposed to wall time) as an argument. This makes it independent of the CPU, and allows us to eschew the timing information heuristic. It should also make the warnings much more consistent. Afterwards, we set the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.
+Both of these issues stem from using the "wall time" to measure how long a test has run. Wall time is inherently unstable; if you're watching a movie, the tests will take longer. On a slower computer, the tests will take longer. Et cetera. The use of timing information from previous runs and the obscenely high `--warn-long` limit partially address that.
 
+So in targeting our two issues, we first aim to switch the timing reports and `--warn-long` flag to use CPU time instead of wall time. CPU time is more reliable, since it only reports time actually spent working on the problem. (It's still sensitive to things like physical CPU time and `CFLAGS`; those will be addressed in #33022). With CPU time being used, the timings will be much more consistent, allowing us to lower the default value of `--warn-long` to 10 CPU-seconds when `--long` was not given.
+
+The main difficulty is in accounting for CPU time spent in pexpect subprocesses. We don't `wait()` for those and they may not terminate, so the OS's usual methods of retrieving child process statistics don't work for them. At present we have a PID-based solution that works quickly on Linux/BSD, but something similar for macOS would be nice.
``````




---

archive/issue_comments_657693.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe information we need can be obtained from `proc_pidinfo(pid, PROC_PIDTASKINFO,...)` in libproc on macOS. I found a gist that might serve as inspiration:\n\n  https://gist.github.com/nguyen-phillip/de66b0ea2144e20ddd844c41c9d93eb9\n\nIn theory all we need to do is get a `proc_taskinfo` struct from that call, and read its `pti_total_user` and `pti_total_system` fields. But I don't have a mac to test on so someone else will have to take this step.",
    "created_at": "2022-02-10T19:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657693",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:22'></a>
The information we need can be obtained from `proc_pidinfo(pid, PROC_PIDTASKINFO,...)` in libproc on macOS. I found a gist that might serve as inspiration:

  https://gist.github.com/nguyen-phillip/de66b0ea2144e20ddd844c41c9d93eb9

In theory all we need to do is get a `proc_taskinfo` struct from that call, and read its `pti_total_user` and `pti_total_system` fields. But I don't have a mac to test on so someone else will have to take this step.



---

archive/issue_comments_657694.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mjo](#comment%3A20):\n> The version we had was almost five years out of date and required a huge unmaintained patch \n\n\nWe needed the patch for Cygwin only. We could just use an upgraded psutil and do whatever is needed for Cygwin in the Sage library.",
    "created_at": "2022-02-10T20:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657694",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Replying to [mjo](#comment%3A20):
> The version we had was almost five years out of date and required a huge unmaintained patch 


We needed the patch for Cygwin only. We could just use an upgraded psutil and do whatever is needed for Cygwin in the Sage library.



---

archive/issue_comments_657695.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mkoeppe](#comment%3A23):\n> Replying to [mjo](#comment%3A20):\n> > The version we had was almost five years out of date and required a huge unmaintained patch \n\n> \n> We needed the patch for Cygwin only. We could just use an upgraded psutil and do whatever is needed for Cygwin in the Sage library.\n\n\nYes but if mkoeppe ever gets hit by a bus, the rest of us will be crushed under 25 hours/day of package upgrades and maintenance. I appreciate all you do, but there's a huge cost to every additional dependency measured over the years.",
    "created_at": "2022-02-10T21:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657695",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>
Replying to [mkoeppe](#comment%3A23):
> Replying to [mjo](#comment%3A20):
> > The version we had was almost five years out of date and required a huge unmaintained patch 

> 
> We needed the patch for Cygwin only. We could just use an upgraded psutil and do whatever is needed for Cygwin in the Sage library.


Yes but if mkoeppe ever gets hit by a bus, the rest of us will be crushed under 25 hours/day of package upgrades and maintenance. I appreciate all you do, but there's a huge cost to every additional dependency measured over the years.



---

archive/issue_comments_657696.json:
```json
{
    "body": "<a id='comment:25'></a>\nIt's a well-maintained package and using it beats maintaining Sage-specific system code ... which is not even written yet ...",
    "created_at": "2022-02-10T21:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657696",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
It's a well-maintained package and using it beats maintaining Sage-specific system code ... which is not even written yet ...



---

archive/issue_comments_657697.json:
```json
{
    "body": "<a id='comment:26'></a>\nThere's a point after which I agree, but assuming that the package itself causes zero problems: every distro needs to package it and keep it upgraded, and every user needs to install it every time they build sage (wasting time, space, and bandwidth), and every upstream release usually gets a ticket->branch->test->review cycle within sage itself.\n\nThe total amount of code we're talking about is less than the text files in `build/pkgs/psutil` contained. It's in a non-critical location in a pseudo-private, non-user-facing function. We'll go years without ever thinking about it.",
    "created_at": "2022-02-10T21:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657697",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:26'></a>
There's a point after which I agree, but assuming that the package itself causes zero problems: every distro needs to package it and keep it upgraded, and every user needs to install it every time they build sage (wasting time, space, and bandwidth), and every upstream release usually gets a ticket->branch->test->review cycle within sage itself.

The total amount of code we're talking about is less than the text files in `build/pkgs/psutil` contained. It's in a non-critical location in a pseudo-private, non-user-facing function. We'll go years without ever thinking about it.



---

archive/issue_comments_657698.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [mjo](#comment%3A26):\n> every distro needs to package\n\n\nhttps://repology.org/project/python:psutil/versions",
    "created_at": "2022-02-10T21:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657698",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Replying to [mjo](#comment%3A26):
> every distro needs to package


https://repology.org/project/python:psutil/versions



---

archive/issue_comments_657699.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [mkoeppe](#comment%3A27):\n> \n> https://repology.org/project/python:psutil/versions\n\n\nThat's not the hard part. The Gentoo package is available on amd64, arm, arm64, hppa, ppc, ppc64, sparc, x86, alpha, ia64, riscv, m68k, mips, and s390. Every new version has to be tested, and stabilized, and most introduce new bugs that have to be triaged, upstreamed, patched, etc. If psutil is not used by sage, I don't have to care about any of that. If it is, I often have to step in to ensure that the distro package is compatible with that sage expects. Repeat two-hundred-some times on however-many distros and you have a never-ending stream of work.",
    "created_at": "2022-02-10T21:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657699",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:28'></a>
Replying to [mkoeppe](#comment%3A27):
> 
> https://repology.org/project/python:psutil/versions


That's not the hard part. The Gentoo package is available on amd64, arm, arm64, hppa, ppc, ppc64, sparc, x86, alpha, ia64, riscv, m68k, mips, and s390. Every new version has to be tested, and stabilized, and most introduce new bugs that have to be triaged, upstreamed, patched, etc. If psutil is not used by sage, I don't have to care about any of that. If it is, I often have to step in to ensure that the distro package is compatible with that sage expects. Repeat two-hundred-some times on however-many distros and you have a never-ending stream of work.



---

archive/issue_comments_657700.json:
```json
{
    "body": "<a id='comment:29'></a>\nhttps://gitweb.gentoo.org/repo/gentoo.git/log/dev-python/psutil doesn't look particularly dramatic",
    "created_at": "2022-02-10T22:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657700",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
https://gitweb.gentoo.org/repo/gentoo.git/log/dev-python/psutil doesn't look particularly dramatic



---

archive/issue_comments_657701.json:
```json
{
    "body": "<a id='comment:30'></a>\nYou'd get a better idea from the bug tracker, but I don't know what point we're arguing. Sage was stuck on the same version of psutil for five years. That naturally did not require much maintenance either within sage or without.",
    "created_at": "2022-02-10T22:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657701",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:30'></a>
You'd get a better idea from the bug tracker, but I don't know what point we're arguing. Sage was stuck on the same version of psutil for five years. That naturally did not require much maintenance either within sage or without.



---

archive/issue_comments_657702.json:
```json
{
    "body": "<a id='comment:31'></a>\nYou were trying to argue that somehow creating new homegrown platform-dependent code is a better strategy than just using an existing upstream project (for which we have no particular version requirements and never had).",
    "created_at": "2022-02-11T00:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657702",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
You were trying to argue that somehow creating new homegrown platform-dependent code is a better strategy than just using an existing upstream project (for which we have no particular version requirements and never had).



---

archive/issue_comments_657703.json:
```json
{
    "body": "<a id='comment:32'></a>\nheadline: man who doesn't do dishes thinks it's more elegant to use a different spoon for each ravioli",
    "created_at": "2022-02-11T01:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657703",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:32'></a>
headline: man who doesn't do dishes thinks it's more elegant to use a different spoon for each ravioli



---

archive/issue_comments_657704.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea1d5e5291b8c13299b67de613143755514d7905\">ea1d5e5</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbe352f2442a9267459743079d934812cc602430\">bbe352f</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2\">06209f0</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>\n",
    "created_at": "2022-03-12T18:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea1d5e5291b8c13299b67de613143755514d7905">ea1d5e5</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbe352f2442a9267459743079d934812cc602430">bbe352f</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2">06209f0</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>




---

archive/issue_comments_657705.json:
```json
{
    "body": "**Changing commit** from \"[58fc03a5037dc7d4c1eb1ab6713b38df586450f4](https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4)\" to \"[06209f05b550edc927893fda51118ebbca74d0d2](https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2)\".",
    "created_at": "2022-03-12T18:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[58fc03a5037dc7d4c1eb1ab6713b38df586450f4](https://github.com/sagemath/sagetrac-mirror/commit/58fc03a5037dc7d4c1eb1ab6713b38df586450f4)" to "[06209f05b550edc927893fda51118ebbca74d0d2](https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2)".



---

archive/issue_comments_657706.json:
```json
{
    "body": "**Changing commit** from \"[06209f05b550edc927893fda51118ebbca74d0d2](https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2)\" to \"[ba458eef5213a3ed05f33b87b9c98657c7de6e9a](https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a)\".",
    "created_at": "2022-03-12T18:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[06209f05b550edc927893fda51118ebbca74d0d2](https://github.com/sagemath/sagetrac-mirror/commit/06209f05b550edc927893fda51118ebbca74d0d2)" to "[ba458eef5213a3ed05f33b87b9c98657c7de6e9a](https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a)".



---

archive/issue_comments_657707.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac22a95c0c43c8371dc7739de7176f2fdb24f441\">ac22a95</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98ac50ca137364bf4794be5c641884fe812103f0\">98ac50c</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/071de5611aaf73ee0ee097c60bc44c5d62823683\">071de56</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66cf8bd767aed982c0fdffcce22f39be0f78bda8\">66cf8bd</a></td><td><code>Trac #32981: report verbose doctest success in CPU time.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec3aa59118f58c2b1bcb0fac7a9ceffd57e9857e\">ec3aa59</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1f8ae16465cf704d5dda191c84b70ae6beff103\">a1f8ae1</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60fb0ef9df110d7a4ad6725ba4e1dfba8e512346\">60fb0ef</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a\">ba458ee</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>\n",
    "created_at": "2022-03-12T18:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac22a95c0c43c8371dc7739de7176f2fdb24f441">ac22a95</a></td><td><code>Trac #32981: use CPU time for --warn-long.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98ac50ca137364bf4794be5c641884fe812103f0">98ac50c</a></td><td><code>Trac #32981: decrease --warn-long limit for non-long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/071de5611aaf73ee0ee097c60bc44c5d62823683">071de56</a></td><td><code>Trac #32981: use a faster file to test the doctest framework.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66cf8bd767aed982c0fdffcce22f39be0f78bda8">66cf8bd</a></td><td><code>Trac #32981: report verbose doctest success in CPU time.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec3aa59118f58c2b1bcb0fac7a9ceffd57e9857e">ec3aa59</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1f8ae16465cf704d5dda191c84b70ae6beff103">a1f8ae1</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60fb0ef9df110d7a4ad6725ba4e1dfba8e512346">60fb0ef</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a">ba458ee</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>




---

archive/issue_comments_657708.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c13edec9ca112ff0ca9a269eed45a66f84331c4\">6c13ede</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70803a2e37a32b1baa3b529bc6424670765b48c1\">70803a2</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8203890ffa32760deff1c8d452c685b2b1c01dfa\">8203890</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45\">d7d2cff</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>\n",
    "created_at": "2022-03-14T14:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c13edec9ca112ff0ca9a269eed45a66f84331c4">6c13ede</a></td><td><code>Trac #32981: cputime for pexpect interfaces on Linux/BSD.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70803a2e37a32b1baa3b529bc6424670765b48c1">70803a2</a></td><td><code>Trac #32981: report both cpu and wall times for long tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8203890ffa32760deff1c8d452c685b2b1c01dfa">8203890</a></td><td><code>Trac #32981: specify wall seconds in per-file doctest report.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45">d7d2cff</a></td><td><code>Trac #32981: specify wall seconds in sage -t --verbose output.</code></td></tr></table>




---

archive/issue_comments_657709.json:
```json
{
    "body": "**Changing commit** from \"[ba458eef5213a3ed05f33b87b9c98657c7de6e9a](https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a)\" to \"[d7d2cffd9913bb0dc511a24534316f7d458d2e45](https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45)\".",
    "created_at": "2022-03-14T14:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ba458eef5213a3ed05f33b87b9c98657c7de6e9a](https://github.com/sagemath/sagetrac-mirror/commit/ba458eef5213a3ed05f33b87b9c98657c7de6e9a)" to "[d7d2cffd9913bb0dc511a24534316f7d458d2e45](https://github.com/sagemath/sagetrac-mirror/commit/d7d2cffd9913bb0dc511a24534316f7d458d2e45)".



---

archive/issue_comments_657710.json:
```json
{
    "body": "**Reviewer:** https://github.com/sagemath/sage/actions/runs/1992568379",
    "created_at": "2022-03-26T01:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657710",
    "user": "https://github.com/orlitzky"
}
```

**Reviewer:** https://github.com/sagemath/sage/actions/runs/1992568379



---

archive/issue_comments_657711.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2022-03-26T01:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657711",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_657712.json:
```json
{
    "body": "<a id='comment:36'></a>\nI ran this on GH but the actions page has been failing to load for a week. I've reported it to GH and a fix is \"being worked on.\" Aside from that, I think it's ready for review.\n\nIn the spirit of \"do no harm,\" I have avoided outputting CPU time statistics wherever possible to avoid outputting confusing numbers on macOS. Nevertheless, in context, the lack of fast CPU time for subprocesses on macOS is not a deal-breaker: the only situation where it will be missed is if a subprocess takes a lot of CPU and would normally violate the `--warn-long` limit, and instead appears to run fast on macOS. But the status quo is that using wall time already makes `--warn-long` useless; and false negatives are not harmful. If the purpose of `--warn-long` is to prevent slow tests from being added to sage, then we only need `--warn-long` to trigger *somewhere* (e.g. the patchbots), and not *everywhere*. Overlooking the occasional warning for certain tests on one platform isn't contrary to that goal, and in any case is not worse than what we already have -- no usable warnings at all.\n\nOf course I'll open a follow-up ticket for adding the macOS accounting should anyone care to do it.",
    "created_at": "2022-03-26T01:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657712",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:36'></a>
I ran this on GH but the actions page has been failing to load for a week. I've reported it to GH and a fix is "being worked on." Aside from that, I think it's ready for review.

In the spirit of "do no harm," I have avoided outputting CPU time statistics wherever possible to avoid outputting confusing numbers on macOS. Nevertheless, in context, the lack of fast CPU time for subprocesses on macOS is not a deal-breaker: the only situation where it will be missed is if a subprocess takes a lot of CPU and would normally violate the `--warn-long` limit, and instead appears to run fast on macOS. But the status quo is that using wall time already makes `--warn-long` useless; and false negatives are not harmful. If the purpose of `--warn-long` is to prevent slow tests from being added to sage, then we only need `--warn-long` to trigger *somewhere* (e.g. the patchbots), and not *everywhere*. Overlooking the occasional warning for certain tests on one platform isn't contrary to that goal, and in any case is not worse than what we already have -- no usable warnings at all.

Of course I'll open a follow-up ticket for adding the macOS accounting should anyone care to do it.



---

archive/issue_comments_657713.json:
```json
{
    "body": "<a id='comment:37'></a>\nIn theory, it would be good to understand how pytest deals with such issues, as we are aiming to switch to pytest, right?",
    "created_at": "2022-03-26T11:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657713",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
In theory, it would be good to understand how pytest deals with such issues, as we are aiming to switch to pytest, right?



---

archive/issue_comments_657714.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [dimpase](#comment%3A37):\n> In theory, it would be good to understand how pytest deals with such issues, as we are aiming to switch to pytest, right?\n\n\nIt uses wall time for its timeouts and slow test warnings.",
    "created_at": "2022-03-26T11:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657714",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:38'></a>
Replying to [dimpase](#comment%3A37):
> In theory, it would be good to understand how pytest deals with such issues, as we are aiming to switch to pytest, right?


It uses wall time for its timeouts and slow test warnings.



---

archive/issue_comments_657715.json:
```json
{
    "body": "<a id='comment:39'></a>\nFWIW the GH action results are now visible and look OK.",
    "created_at": "2022-03-30T01:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657715",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:39'></a>
FWIW the GH action results are now visible and look OK.



---

archive/issue_events_098018.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98018"
}
```



---

archive/issue_events_098019.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98019"
}
```



---

archive/issue_comments_657716.json:
```json
{
    "body": "<a id='comment:41'></a>\na rebase is due",
    "created_at": "2022-06-09T08:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657716",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>
a rebase is due



---

archive/issue_comments_657717.json:
```json
{
    "body": "<a id='comment:42'></a>\nI've lost interest.",
    "created_at": "2022-06-09T12:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657717",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:42'></a>
I've lost interest.



---

archive/issue_comments_657718.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-06-09T12:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32981#issuecomment-657718",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_events_098020.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98020"
}
```



---

archive/issue_events_098021.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32981",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32981#event-98021"
}
```
