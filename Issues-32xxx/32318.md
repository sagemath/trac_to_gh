# Issue 32318: Generate non-redundant indices of tensors with symmetries efficiently

archive/issues_032081.json:
```json
{
    "assignees": [],
    "body": "In `sage.tensor.modules.comp.CompWithSym`, the method generating non-redundant indices is implemented very inefficiently by going through all indices and throwing away the redundant ones. In the worst case scenario of a rank n tensor in n dimensions, we have to iterate through n<sup>n</sup> indices only to find the single non-redundant one.\n\nThis ticket fixes this by changing the implementation to directly generate only non-redundant indices. This gives for example the following improvement for 7 dimensions:\n\n```\nsage: import timeit\nsage: from sage.tensor.modules.comp import Components, CompWithSym, CompFullySym, CompFullyAntiSym\nsage: V = VectorSpace(QQ, 7)\nsage: c = CompFullyAntiSym(QQ, V.basis(), 7)\nsage: timeit.timeit(lambda:list(c.non_redundant_index_generator()),number=1)\n\nnew implementation:\n4.3510999603313394e-05\n\nold implementation:\n2.4149506480007403\n```\n\nI also simplified the method generating redundant indices a bit.\n\nCC:  @slel @mjungmath @egourgoulhon @tscrim\n\nBranch/Commit: **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**\n\nReviewer: **Eric Gourgoulhon, Michael Jung**\n\nAuthor: **Marius Gerbershagen**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32318_\n\n",
    "closed_at": "2021-09-05T21:38:36Z",
    "created_at": "2021-07-31T14:38:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Generate non-redundant indices of tensors with symmetries efficiently",
    "type": "issue",
    "updated_at": "2021-09-05T21:38:36Z",
    "url": "https://github.com/sagemath/sage/issues/32318",
    "user": "https://github.com/spaghettisalat"
}
```
In `sage.tensor.modules.comp.CompWithSym`, the method generating non-redundant indices is implemented very inefficiently by going through all indices and throwing away the redundant ones. In the worst case scenario of a rank n tensor in n dimensions, we have to iterate through n<sup>n</sup> indices only to find the single non-redundant one.

This ticket fixes this by changing the implementation to directly generate only non-redundant indices. This gives for example the following improvement for 7 dimensions:

```
sage: import timeit
sage: from sage.tensor.modules.comp import Components, CompWithSym, CompFullySym, CompFullyAntiSym
sage: V = VectorSpace(QQ, 7)
sage: c = CompFullyAntiSym(QQ, V.basis(), 7)
sage: timeit.timeit(lambda:list(c.non_redundant_index_generator()),number=1)

new implementation:
4.3510999603313394e-05

old implementation:
2.4149506480007403
```

I also simplified the method generating redundant indices a bit.

CC:  @slel @mjungmath @egourgoulhon @tscrim

Branch/Commit: **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**

Reviewer: **Eric Gourgoulhon, Michael Jung**

Author: **Marius Gerbershagen**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/32318_





---

archive/issue_events_445765.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:38:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445765"
}
```



---

archive/issue_events_445766.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445766"
}
```



---

archive/issue_events_445767.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445767"
}
```



---

archive/issue_events_445768.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445768"
}
```



---

archive/issue_events_445769.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:38:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445769"
}
```



---

archive/issue_events_445770.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-07-31T14:49:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "title_is": "Performace improvements in generating non-redundant indices of tensors with symmetries",
    "title_was": "Performace improvements in generating non-redundant indices of tensors with indices",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445770"
}
```



---

archive/issue_events_445771.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-31T17:16:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "title_is": "Generate non-redundant indices of tensors with symmetries efficiently",
    "title_was": "Performace improvements in generating non-redundant indices of tensors with symmetries",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445771"
}
```



---

archive/issue_comments_520591.json:
```json
{
    "body": "Changed commit from **[`a60d93c`](https://github.com/sagemath/sagetrac-mirror/commit/a60d93c37102245cb7f9e319576d9f92e7d15c1e)** to **[`1c108d8`](https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93)**",
    "created_at": "2021-08-01T12:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520591",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a60d93c`](https://github.com/sagemath/sagetrac-mirror/commit/a60d93c37102245cb7f9e319576d9f92e7d15c1e)** to **[`1c108d8`](https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93)**



---

archive/issue_comments_520592.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93\">1c108d8</a></td><td><code>tensor module components: non-redundant index generator: performance improvements</code></td></tr></table>\n",
    "created_at": "2021-08-01T12:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520592",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93">1c108d8</a></td><td><code>tensor module components: non-redundant index generator: performance improvements</code></td></tr></table>




---

archive/issue_comments_520593.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHaven't checked the algorithm yet, but here are already some minor comments:\n\n- Why is `self._sym` copied but `self._antisym` not? From the first glimpse, a copy doesn't seem to be necessary anyway.\n- Very minor (PEP norm):\n\n```diff\n- for k in range(1,len(isym)):\n+ for k in range(1, len(isym)):\n```",
    "created_at": "2021-08-05T12:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520593",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:6" align="right">comment:6</div>

Haven't checked the algorithm yet, but here are already some minor comments:

- Why is `self._sym` copied but `self._antisym` not? From the first glimpse, a copy doesn't seem to be necessary anyway.
- Very minor (PEP norm):

```diff
- for k in range(1,len(isym)):
+ for k in range(1, len(isym)):
```



---

archive/issue_comments_520594.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nVery nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks!",
    "created_at": "2021-08-05T12:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520594",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:7" align="right">comment:7</div>

Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks!



---

archive/issue_comments_520595.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks for improving significantly the generator of non-redundant indices! \nThere is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.",
    "created_at": "2021-08-05T12:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520595",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks for improving significantly the generator of non-redundant indices! 
There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.



---

archive/issue_events_445772.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-05T12:42:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445772"
}
```



---

archive/issue_events_445773.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-05T12:42:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445773"
}
```



---

archive/issue_comments_520596.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@egourgoulhon](#comment:8):\n> Thanks for improving significantly the generator of non-redundant indices! \n> There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n\nIs that really important? The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.",
    "created_at": "2021-08-05T13:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520596",
    "user": "https://github.com/spaghettisalat"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@egourgoulhon](#comment:8):
> Thanks for improving significantly the generator of non-redundant indices! 
> There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.

Is that really important? The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.



---

archive/issue_comments_520597.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@spaghettisalat](#comment:9):\n> Replying to [@egourgoulhon](#comment:8):\n> > Thanks for improving significantly the generator of non-redundant indices! \n> > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n\n> \n> Is that really important? \n\nYes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). \n\n>The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.\n\nCan one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?",
    "created_at": "2021-08-05T14:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520597",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@spaghettisalat](#comment:9):
> Replying to [@egourgoulhon](#comment:8):
> > Thanks for improving significantly the generator of non-redundant indices! 
> > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.

> 
> Is that really important? 

Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). 

>The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.

Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?



---

archive/issue_comments_520598.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@egourgoulhon](#comment:10):\n> Replying to [@spaghettisalat](#comment:9):\n> > Replying to [@egourgoulhon](#comment:8):\n> > > Thanks for improving significantly the generator of non-redundant indices! \n> > > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n\n> > \n> > Is that really important? \n\n> \n> Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). \n> \n\nThe order is not random, it is just slightly different than before. For the christoffel symbols, previously the indices would increase from right to left, now the first index increases before the last two ones. In general, the new algorithm first increases unsymmetrized indices, then symmetrized and finally antisymmetrized ones. One could also do this in a different order (for instance first increase the antisymmetrized indices), which would restore the old order at least for christoffel symbols. But I don't really see the point of that, since there is no universally agreed standard for in which order one should display the indices.\n\n> >The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.\n\n> \n> Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?\n\nYou could of course just convert all of the indices into a list and sort that one via `list(tensor.non_redundant_index_generator()).sort()`. This is a bit inefficient but for display purposes, this should be fine.",
    "created_at": "2021-08-05T15:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520598",
    "user": "https://github.com/spaghettisalat"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@egourgoulhon](#comment:10):
> Replying to [@spaghettisalat](#comment:9):
> > Replying to [@egourgoulhon](#comment:8):
> > > Thanks for improving significantly the generator of non-redundant indices! 
> > > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.

> > 
> > Is that really important? 

> 
> Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). 
> 

The order is not random, it is just slightly different than before. For the christoffel symbols, previously the indices would increase from right to left, now the first index increases before the last two ones. In general, the new algorithm first increases unsymmetrized indices, then symmetrized and finally antisymmetrized ones. One could also do this in a different order (for instance first increase the antisymmetrized indices), which would restore the old order at least for christoffel symbols. But I don't really see the point of that, since there is no universally agreed standard for in which order one should display the indices.

> >The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.

> 
> Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?

You could of course just convert all of the indices into a list and sort that one via `list(tensor.non_redundant_index_generator()).sort()`. This is a bit inefficient but for display purposes, this should be fine.



---

archive/issue_comments_520599.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI agree with Eric. Ordering the indices by coordinates is extremely convenient, at least for the output.\n\nSince this seems only affect the Christoffel symbols, I can live with sorting them afterwards, even for the price of a small slow down in that case (which, I suspect, is still faster than the current implementation).\n\nOn the other hand, please keep in mind that there is a refactoring of the components's module going on in #30307. To that end, we will cache results related to symmetry such as this iterator.",
    "created_at": "2021-08-05T15:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520599",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:12" align="right">comment:12</div>

I agree with Eric. Ordering the indices by coordinates is extremely convenient, at least for the output.

Since this seems only affect the Christoffel symbols, I can live with sorting them afterwards, even for the price of a small slow down in that case (which, I suspect, is still faster than the current implementation).

On the other hand, please keep in mind that there is a refactoring of the components's module going on in #30307. To that end, we will cache results related to symmetry such as this iterator.



---

archive/issue_comments_520600.json:
```json
{
    "body": "Changed commit from **[`1c108d8`](https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93)** to **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**",
    "created_at": "2021-08-05T18:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520600",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1c108d8`](https://github.com/sagemath/sagetrac-mirror/commit/1c108d85c05ccd171548f14f21b1c5a7db896d93)** to **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**



---

archive/issue_comments_520601.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de\">08ccd3b</a></td><td><code>tensor module components: non-redundant index generator: performance improvements</code></td></tr></table>\n",
    "created_at": "2021-08-05T18:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520601",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de">08ccd3b</a></td><td><code>tensor module components: non-redundant index generator: performance improvements</code></td></tr></table>




---

archive/issue_comments_520602.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI have implemented sorting of the indices for display. All outputs should now appear the same way as before.\n\n> Changed 6 hours ago by gh-mjungmath:\n\n> Haven't checked the algorithm yet, but here are already some minor comments:\n\n> * Why is self._sym copied but self._antisym not? From the first glimpse, a copy doesn't seem to be necessary anyway.\n\nBecause this is modified later on. The new algorithm treats non-symmetrized indices as a symmetrization of a single index and adds those to the `sym` list.\n\n> * Very minor (PEP norm):\n\n>\n>```\n>    - for k in range(1,len(isym)):\n>    + for k in range(1, len(isym)):\n>  ```\n\nThis has been fixed.\n\n> Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks! \n\nAs long as these examples are in dimensions below 6, I doubt that this will make a significant impact.",
    "created_at": "2021-08-05T18:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520602",
    "user": "https://github.com/spaghettisalat"
}
```

<div id="comment:14" align="right">comment:14</div>

I have implemented sorting of the indices for display. All outputs should now appear the same way as before.

> Changed 6 hours ago by gh-mjungmath:

> Haven't checked the algorithm yet, but here are already some minor comments:

> * Why is self._sym copied but self._antisym not? From the first glimpse, a copy doesn't seem to be necessary anyway.

Because this is modified later on. The new algorithm treats non-symmetrized indices as a symmetrization of a single index and adds those to the `sym` list.

> * Very minor (PEP norm):

>
>```
>    - for k in range(1,len(isym)):
>    + for k in range(1, len(isym)):
>  ```

This has been fixed.

> Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks! 

As long as these examples are in dimensions below 6, I doubt that this will make a significant impact.



---

archive/issue_events_445774.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-08-05T18:44:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445774"
}
```



---

archive/issue_events_445775.json:
```json
{
    "actor": "https://github.com/spaghettisalat",
    "created_at": "2021-08-05T18:44:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445775"
}
```



---

archive/issue_comments_520603.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks for the changes! \nMichael, do you agree with the positive review?",
    "created_at": "2021-08-07T09:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520603",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks for the changes! 
Michael, do you agree with the positive review?



---

archive/issue_comments_520604.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon, Michael Jung**",
    "created_at": "2021-08-07T09:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520604",
    "user": "https://github.com/egourgoulhon"
}
```

Reviewer: **Eric Gourgoulhon, Michael Jung**



---

archive/issue_events_445776.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-07T09:30:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445776"
}
```



---

archive/issue_events_445777.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-07T09:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445777"
}
```



---

archive/issue_comments_520605.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n\nBut this is personal taste, and for now this should be fine.",
    "created_at": "2021-08-07T15:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520605",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:17" align="right">comment:17</div>

I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.

But this is personal taste, and for now this should be fine.



---

archive/issue_comments_520606.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is a huge improvement though. Thank you Marius!",
    "created_at": "2021-08-07T16:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520606",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:18" align="right">comment:18</div>

This is a huge improvement though. Thank you Marius!



---

archive/issue_comments_520607.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mjungmath](#comment:17):\n> I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n\nIf only python had a goto statement...",
    "created_at": "2021-08-07T17:10:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520607",
    "user": "https://github.com/spaghettisalat"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mjungmath](#comment:17):
> I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.

If only python had a goto statement...



---

archive/issue_comments_520608.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nMinor comments, feel free to ignore any or all of them.\n\nPossible simplification for getting a sorted list:\n\n```diff\n-            generator = list(self.non_redundant_index_generator())\n-            generator.sort()\n+            generator = sorted(self.non_redundant_index_generator())\n```\n\nPEP8 recommends 2 spaces before inline comments\n(and some suggested rephrasings):\n\n```diff\n-                    return # end point reached\n+                    return  # end point reached\n```\n\n```diff\n-        sym = self._sym.copy() # we may modify this in the following\n+        sym = self._sym.copy()  # make a copy we can modify\n```\n\n```diff\n-            step_finished = False # each step generates a new index\n+            step_finished = False  # each step generates a new index\n```\n\n```diff\n+                    return # end point reach\n+                    return  # end point reached\n```\n\nLonger comments can go on their own line(s)\n(and sometimes be made a bit shorter):\n\n```diff\n-                sym.append([pos]) # treat non-symmetrized indices as being symmetrized with themselves\n+                # treat non-symmetrized indices as symmetrized with themselves\n+                sym.append([pos])\n```\n\n```diff\n-                    return # we went through all indices and didn't\n-                           # find one which we can increase, thus we\n-                           # have generated all indices\n+                    # we went through all indices and none could be\n+                    # increased, so we have generated all indices\n+                    return\n```\n\nThe following give the same boolean:\n\n- `not any([a in b for b in c]) and not any([a in b for b in d])`\n- `all(a not in b for e in (c, d) for b in e)`\n\nso one could rewrite:\n\n```diff\n-            if not any([pos in isym for isym in sym]) and not any([pos in isym for isym in antisym]):\n+            if all(pos not in isym for xsym in (sym, antisym) for isym in xsym):\n```\n\nCalling the flag `done` rather than `step_finished`,\none would read: `if not done: ...`.\n\nPossible rewriting given how Python\nturns numbers and lists to booleans:\n\n```diff\n-                if not step_finished and i == 0 and len(antisym) == 0:\n+                if not step_finished and not i and not antisym:\n```\n\nMaybe shorten this comment:\n\n```diff\n-                            # this index is at the maximum and we have\n-                            # to reset it\n+                            # this index is at the maximum; reset it\n```\n\nMaybe add spaces around + and -, and after commas,\nin several instances of:\n\n```diff\n- range(len(sym)-1,-1,-1)\n+ range(len(sym) - 1, -1, -1)\n```",
    "created_at": "2021-08-07T18:10:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520608",
    "user": "https://github.com/slel"
}
```

<div id="comment:20" align="right">comment:20</div>

Minor comments, feel free to ignore any or all of them.

Possible simplification for getting a sorted list:

```diff
-            generator = list(self.non_redundant_index_generator())
-            generator.sort()
+            generator = sorted(self.non_redundant_index_generator())
```

PEP8 recommends 2 spaces before inline comments
(and some suggested rephrasings):

```diff
-                    return # end point reached
+                    return  # end point reached
```

```diff
-        sym = self._sym.copy() # we may modify this in the following
+        sym = self._sym.copy()  # make a copy we can modify
```

```diff
-            step_finished = False # each step generates a new index
+            step_finished = False  # each step generates a new index
```

```diff
+                    return # end point reach
+                    return  # end point reached
```

Longer comments can go on their own line(s)
(and sometimes be made a bit shorter):

```diff
-                sym.append([pos]) # treat non-symmetrized indices as being symmetrized with themselves
+                # treat non-symmetrized indices as symmetrized with themselves
+                sym.append([pos])
```

```diff
-                    return # we went through all indices and didn't
-                           # find one which we can increase, thus we
-                           # have generated all indices
+                    # we went through all indices and none could be
+                    # increased, so we have generated all indices
+                    return
```

The following give the same boolean:

- `not any([a in b for b in c]) and not any([a in b for b in d])`
- `all(a not in b for e in (c, d) for b in e)`

so one could rewrite:

```diff
-            if not any([pos in isym for isym in sym]) and not any([pos in isym for isym in antisym]):
+            if all(pos not in isym for xsym in (sym, antisym) for isym in xsym):
```

Calling the flag `done` rather than `step_finished`,
one would read: `if not done: ...`.

Possible rewriting given how Python
turns numbers and lists to booleans:

```diff
-                if not step_finished and i == 0 and len(antisym) == 0:
+                if not step_finished and not i and not antisym:
```

Maybe shorten this comment:

```diff
-                            # this index is at the maximum and we have
-                            # to reset it
+                            # this index is at the maximum; reset it
```

Maybe add spaces around + and -, and after commas,
in several instances of:

```diff
- range(len(sym)-1,-1,-1)
+ range(len(sym) - 1, -1, -1)
```



---

archive/issue_comments_520609.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI ponder, is the outer while-loop even necessary? Couldn't you just split this whole thing into two separated loops and `yield` within those? Then the code gets much simpler and the flag becomes obsolete.",
    "created_at": "2021-08-07T18:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520609",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:21" align="right">comment:21</div>

I ponder, is the outer while-loop even necessary? Couldn't you just split this whole thing into two separated loops and `yield` within those? Then the code gets much simpler and the flag becomes obsolete.



---

archive/issue_comments_520610.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@spaghettisalat](#comment:19):\n> Replying to [@mjungmath](#comment:17):\n> > I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n\n> \n> If only python had a goto statement...\n\nhttp://entrian.com/goto/ :P",
    "created_at": "2021-08-07T19:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520610",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@spaghettisalat](#comment:19):
> Replying to [@mjungmath](#comment:17):
> > I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.

> 
> If only python had a goto statement...

http://entrian.com/goto/ :P



---

archive/issue_comments_520611.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@slel](#comment:20):\n> \n> Possible rewriting given how Python\n> turns numbers and lists to booleans:\n> \n> ```diff\n> -                if not step_finished and i == 0 and len(antisym) == 0:\n> +                if not step_finished and not i and not antisym:\n> ```\n> \n\nPersonally, I don't agree with that one. Of course, `not i` is more pythonic, but I find it less readable than `i == 0`, especially in the current context, where `i` is an integer.",
    "created_at": "2021-08-09T07:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520611",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@slel](#comment:20):
> 
> Possible rewriting given how Python
> turns numbers and lists to booleans:
> 
> ```diff
> -                if not step_finished and i == 0 and len(antisym) == 0:
> +                if not step_finished and not i and not antisym:
> ```
> 

Personally, I don't agree with that one. Of course, `not i` is more pythonic, but I find it less readable than `i == 0`, especially in the current context, where `i` is an integer.



---

archive/issue_events_445778.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445778"
}
```



---

archive/issue_events_445779.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445779"
}
```



---

archive/issue_comments_520612.json:
```json
{
    "body": "Changed branch from **[public/tensor-indices](https://github.com/sagemath/sagetrac-mirror/tree/public/tensor-indices)** to **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**",
    "created_at": "2021-09-05T21:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32318#issuecomment-520612",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/tensor-indices](https://github.com/sagemath/sagetrac-mirror/tree/public/tensor-indices)** to **[`08ccd3b`](https://github.com/sagemath/sagetrac-mirror/commit/08ccd3b89d25893230bbef55b0ed448b23c9d3de)**



---

archive/issue_events_445780.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-05T21:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445780"
}
```



---

archive/issue_events_445781.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fa4858b8cda24222f5a45d42d73e32965c73f712",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-09-05T21:38:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32318",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32318#event-445781"
}
```
