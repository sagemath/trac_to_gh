# Issue 32020: Multivariate Generating Functions: critical cone cannot be described for non-rational critical point

archive/issues_031783.json:
```json
{
    "assignees": [],
    "body": "`FractionWithFactoredDenominator.critical_cone` returns `None` when the corresponding critical point has non-rational coordinates. Consider the following example:\n\n```\nsage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing\nsage: R.<x, y> = QQ[]\nsage: FFPD = FractionWithFactoredDenominatorRing(R)\nsage: G = 1; H = 1 - x - y - x*y\nsage: Hfac = H.factor()\nsage: G = G / Hfac.unit()\nsage: F = FFPD(G, Hfac)\n```\n\nFor a point with rational coordinates, everything works as expected:\n\n```\nsage: I = F.smooth_critical_ideal(alpha=(1, 1))\nsage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)\nsage: F.critical_cone(points[1])\n([(1, 1)], 1-d cone in 2-d lattice N)\n```\n\nFor non-rational coordinates, the critical cone returns `None`:\n\n```\nsage: I = F.smooth_critical_ideal(alpha=(2, 1))\nsage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)\nsage: F.critical_cone(points[1])\n([(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),\n   1)],\n None)\n```\n\nCC:  @MarkCWilson @kliem\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32020_\n\n",
    "created_at": "2021-06-21T11:36:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20asymptotic%20expansions",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Multivariate Generating Functions: critical cone cannot be described for non-rational critical point",
    "type": "issue",
    "updated_at": "2022-08-31T16:33:45Z",
    "url": "https://github.com/sagemath/sage/issues/32020",
    "user": "https://github.com/behackl"
}
```
`FractionWithFactoredDenominator.critical_cone` returns `None` when the corresponding critical point has non-rational coordinates. Consider the following example:

```
sage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing
sage: R.<x, y> = QQ[]
sage: FFPD = FractionWithFactoredDenominatorRing(R)
sage: G = 1; H = 1 - x - y - x*y
sage: Hfac = H.factor()
sage: G = G / Hfac.unit()
sage: F = FFPD(G, Hfac)
```

For a point with rational coordinates, everything works as expected:

```
sage: I = F.smooth_critical_ideal(alpha=(1, 1))
sage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)
sage: F.critical_cone(points[1])
([(1, 1)], 1-d cone in 2-d lattice N)
```

For non-rational coordinates, the critical cone returns `None`:

```
sage: I = F.smooth_critical_ideal(alpha=(2, 1))
sage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)
sage: F.critical_cone(points[1])
([(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),
   1)],
 None)
```

CC:  @MarkCWilson @kliem

_Issue created by migration from https://trac.sagemath.org/ticket/32020_





---

archive/issue_events_409187.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2021-06-21T11:36:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409187"
}
```



---

archive/issue_events_409188.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2021-06-21T11:36:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20asymptotic%20expansions",
    "label_color": "0000ff",
    "label_name": "component: asymptotic expansions",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409188"
}
```



---

archive/issue_events_409189.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2021-06-21T11:36:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409189"
}
```



---

archive/issue_events_409190.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2021-06-21T11:36:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409190"
}
```



---

archive/issue_comments_518495.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nUsing `Polyhedron` instead of `Cone` in this case would be an option.",
    "created_at": "2021-06-21T15:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518495",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>Comment 1:</a>
Using `Polyhedron` instead of `Cone` in this case would be an option.



---

archive/issue_comments_518496.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nSee also #30172, where an ABC for convex cones (not necessarily rational polyhedral) is in the works",
    "created_at": "2021-06-21T15:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518496",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
See also #30172, where an ABC for convex cones (not necessarily rational polyhedral) is in the works



---

archive/issue_comments_518497.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@mkoeppe](#comment%3A1):\n> Using `Polyhedron` instead of `Cone` in this case would be an option. \n\nIn this particular example, simplifying the ray directions would actually suffice. The ray list passed to `Cone` is\n\n```\n[(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),\n  1)]\n```\nwhich actually is just\n\n```\n[(2, 1)]\n```\n\nBut that doesn't change the fact that if the rays actually have non-rational components, `Cone` isn't suitable.\n\nWhen I try to use `Polyhedron` with non-rational ray directions, I also get an error, e.g.,\n\n```\nsage: Polyhedron(rays=[(sqrt(2), 1)])\nTraceback (most recent call last):\n...\nValueError: no default backend for computations with Symbolic Ring\n```\n\nDid you mean that `Polyhedron` could be used after moving the rays to some more appropriate base ring? Or am I missing something else?\n\nAlso, thanks for the reference to #30172!",
    "created_at": "2021-06-21T17:32:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518497",
    "user": "https://github.com/behackl"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@mkoeppe](#comment%3A1):
> Using `Polyhedron` instead of `Cone` in this case would be an option. 

In this particular example, simplifying the ray directions would actually suffice. The ray list passed to `Cone` is

```
[(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),
  1)]
```
which actually is just

```
[(2, 1)]
```

But that doesn't change the fact that if the rays actually have non-rational components, `Cone` isn't suitable.

When I try to use `Polyhedron` with non-rational ray directions, I also get an error, e.g.,

```
sage: Polyhedron(rays=[(sqrt(2), 1)])
Traceback (most recent call last):
...
ValueError: no default backend for computations with Symbolic Ring
```

Did you mean that `Polyhedron` could be used after moving the rays to some more appropriate base ring? Or am I missing something else?

Also, thanks for the reference to #30172!



---

archive/issue_comments_518498.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nYou would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.",
    "created_at": "2021-06-21T17:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518498",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.



---

archive/issue_comments_518499.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@mkoeppe](#comment%3A5):\n> You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.\n\nMakes sense, thanks.",
    "created_at": "2021-06-21T17:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518499",
    "user": "https://github.com/behackl"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@mkoeppe](#comment%3A5):
> You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.

Makes sense, thanks.



---

archive/issue_comments_518500.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nIf you need cones with transcendental data, #30234 would be an approach.",
    "created_at": "2021-06-21T17:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32020#issuecomment-518500",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
If you need cones with transcendental data, #30234 would be an approach.



---

archive/issue_events_409191.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409191"
}
```



---

archive/issue_events_409192.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409192"
}
```



---

archive/issue_events_409193.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409193"
}
```



---

archive/issue_events_409194.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409194"
}
```



---

archive/issue_events_409195.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409195"
}
```



---

archive/issue_events_409196.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409196"
}
```



---

archive/issue_events_409197.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409197"
}
```



---

archive/issue_events_409198.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32020",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32020#event-409198"
}
```
