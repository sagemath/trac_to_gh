# Issue 32008: CallableSymbolicExpressionRing over subrings of SR

archive/issues_031771.json:
```json
{
    "body": "1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.\n\n```\nsage: f(t) = t\nsage: f\nt |--> t\nsage: f * t\nt |--> t^2\n```\n   This should be changed so it gives:\n\n```\n_dummy |--> _dummy * t\n```\n   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).\n\n2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as \"7. Addition confusion\":\n\n```\nsage: f(x) = x^2\nsage: g(x) = x^2\nsage: var('t')\nsage: h(t) = t^2\nsage: f+g\nx |--> 2*x^2\nsage: f+h\n(t, x) |--> t^2 + x^2\n```\n\nIn this ticket:\n- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.\n- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`\n- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.\n\nRelated:\n- #18259 (comparison of symbolic functions)\n- #19949 (composition of symbolic subring functors)\n\n\nCC:  @rburing @slel @egourgoulhon @tscrim @dkrenn\n\nBranch: u/mkoeppe/callablesymbolicexpressionring_over_subrings_of_sr\n\nStatus: new\n\nCommit: f71de5b9a42aecde807e42aaecc9a2329a2bbef3\n\nIssue created by migration from https://trac.sagemath.org/ticket/32008\n\n",
    "created_at": "2021-06-19T00:05:35Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "CallableSymbolicExpressionRing over subrings of SR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32008",
    "user": "https://github.com/mkoeppe"
}
```
1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.

```
sage: f(t) = t
sage: f
t |--> t
sage: f * t
t |--> t^2
```
   This should be changed so it gives:

```
_dummy |--> _dummy * t
```
   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).

2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as "7. Addition confusion":

```
sage: f(x) = x^2
sage: g(x) = x^2
sage: var('t')
sage: h(t) = t^2
sage: f+g
x |--> 2*x^2
sage: f+h
(t, x) |--> t^2 + x^2
```

In this ticket:
- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.
- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`
- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.

Related:
- #18259 (comparison of symbolic functions)
- #19949 (composition of symbolic subring functors)


CC:  @rburing @slel @egourgoulhon @tscrim @dkrenn

Branch: u/mkoeppe/callablesymbolicexpressionring_over_subrings_of_sr

Status: new

Commit: f71de5b9a42aecde807e42aaecc9a2329a2bbef3

Issue created by migration from https://trac.sagemath.org/ticket/32008





---

archive/issue_comments_637183.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,21 @@\n-Currently, `CallableSymbolicExpressionRing` can only be created as a ring over the base `SR`.\n+Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.\n \n-We extend it to subrings of `SR`.\n+```\n+sage: f(t) = t\n+sage: f\n+t |--> t\n+sage: f * t\n+t |--> t^2\n+```\n+This should be changed so it gives:\n+\n+```\n+_dummy |--> _dummy * t\n+```\n+\n+`f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).\n+\n+We extend this class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n+A pushout takes care of the renaming of the argument variables when there is a clash.\n \n \n``````\n",
    "created_at": "2021-06-19T02:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637183",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,21 @@
-Currently, `CallableSymbolicExpressionRing` can only be created as a ring over the base `SR`.
+Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.
 
-We extend it to subrings of `SR`.
+```
+sage: f(t) = t
+sage: f
+t |--> t
+sage: f * t
+t |--> t^2
+```
+This should be changed so it gives:
+
+```
+_dummy |--> _dummy * t
+```
+
+`f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).
+
+We extend this class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
+A pushout takes care of the renaming of the argument variables when there is a clash.
 
 
``````




---

archive/issue_comments_637184.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/callablesymbolicexpressionring_over_subrings_of_sr\"",
    "created_at": "2021-06-19T02:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637184",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/callablesymbolicexpressionring_over_subrings_of_sr"



---

archive/issue_comments_637185.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[b5a0bbe](https://github.com/sagemath/sagetrac-mirror/commit/b5a0bbec07d9e4fe782f80b0e8a454ea6aaaf721)|`Expression.function: Pass parent to CallableSymbolicExpressionRing as base ring`|\n|[f71de5b](https://github.com/sagemath/sagetrac-mirror/commit/f71de5b9a42aecde807e42aaecc9a2329a2bbef3)|`WIP coercion`|",
    "created_at": "2021-06-19T04:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[b5a0bbe](https://github.com/sagemath/sagetrac-mirror/commit/b5a0bbec07d9e4fe782f80b0e8a454ea6aaaf721)|`Expression.function: Pass parent to CallableSymbolicExpressionRing as base ring`|
|[f71de5b](https://github.com/sagemath/sagetrac-mirror/commit/f71de5b9a42aecde807e42aaecc9a2329a2bbef3)|`WIP coercion`|



---

archive/issue_comments_637186.json:
```json
{
    "body": "Changing commit from \"\" to \"f71de5b9a42aecde807e42aaecc9a2329a2bbef3\"",
    "created_at": "2021-06-19T04:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "f71de5b9a42aecde807e42aaecc9a2329a2bbef3"



---

archive/issue_comments_637187.json:
```json
{
    "body": "<a id='comment:4'></a>\nWith this version, we get:\n\n```\nsage: var('a b c')\n(a, b, c)\nsage: (a*b*c).function(a, b)\n(a, b) |--> a*b*c\nsage: _.parent()\nCallable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b\nsage: (a*b*c).function(a, b) * b\nTypeError: unsupported operand parent(s) for *: 'Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b' and 'Symbolic Ring'\nsage: (a*b*c).function(a, b) * SR.subring([x])(x)\n(a, b) |--> a*b*c*x\n```",
    "created_at": "2021-06-19T05:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637187",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
With this version, we get:

```
sage: var('a b c')
(a, b, c)
sage: (a*b*c).function(a, b)
(a, b) |--> a*b*c
sage: _.parent()
Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b
sage: (a*b*c).function(a, b) * b
TypeError: unsupported operand parent(s) for *: 'Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b' and 'Symbolic Ring'
sage: (a*b*c).function(a, b) * SR.subring([x])(x)
(a, b) |--> a*b*c*x
```



---

archive/issue_comments_637188.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.\n+1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.\n \n ```\n sage: f(t) = t\n@@ -7,15 +7,29 @@\n sage: f * t\n t |--> t^2\n ```\n-This should be changed so it gives:\n+   This should be changed so it gives:\n \n ```\n _dummy |--> _dummy * t\n ```\n+   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).\n \n-`f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).\n+2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as \"7. Addition confusion\":\n \n-We extend this class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n-A pushout takes care of the renaming of the argument variables when there is a clash.\n+```\n+sage: f(x) = x^2\n+sage: g(x) = x^2\n+sage: var('t')\n+sage: h(t) = t^2\n+sage: f+g\n+x |--> 2*x^2\n+sage: f+h\n+(t, x) |--> t^2 + x^2\n+```\n+\n+In this ticket\n+- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.\n+- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n+- A pushout takes care of the renaming of the argument variables when there is a clash.\n \n \n``````\n",
    "created_at": "2021-07-06T00:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637188",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.
+1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.
 
 ```
 sage: f(t) = t
@@ -7,15 +7,29 @@
 sage: f * t
 t |--> t^2
 ```
-This should be changed so it gives:
+   This should be changed so it gives:
 
 ```
 _dummy |--> _dummy * t
 ```
+   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).
 
-`f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).
+2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as "7. Addition confusion":
 
-We extend this class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
-A pushout takes care of the renaming of the argument variables when there is a clash.
+```
+sage: f(x) = x^2
+sage: g(x) = x^2
+sage: var('t')
+sage: h(t) = t^2
+sage: f+g
+x |--> 2*x^2
+sage: f+h
+(t, x) |--> t^2 + x^2
+```
+
+In this ticket
+- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.
+- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
+- A pushout takes care of the renaming of the argument variables when there is a clash.
 
 
``````




---

archive/issue_comments_637189.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,4 +32,5 @@\n - We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n - A pushout takes care of the renaming of the argument variables when there is a clash.\n \n-\n+Related:\n+- #18259 (comparison of symbolic functions)\n``````\n",
    "created_at": "2021-07-06T05:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637189",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,4 +32,5 @@
 - We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
 - A pushout takes care of the renaming of the argument variables when there is a clash.
 
-
+Related:
+- #18259 (comparison of symbolic functions)
``````




---

archive/issue_comments_637190.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,6 +29,7 @@\n \n In this ticket\n - We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.\n+- The element constructor substitutes the arguments in the expression by unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_`.\n - We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n - A pushout takes care of the renaming of the argument variables when there is a clash.\n \n``````\n",
    "created_at": "2021-07-06T06:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637190",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,6 +29,7 @@
 
 In this ticket
 - We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.
+- The element constructor substitutes the arguments in the expression by unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_`.
 - We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
 - A pushout takes care of the renaming of the argument variables when there is a clash.
 
``````




---

archive/issue_comments_637191.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,3 +35,5 @@\n \n Related:\n - #18259 (comparison of symbolic functions)\n+- #19949 (composition of symbolic subring functors)\n+\n``````\n",
    "created_at": "2021-07-06T16:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637191",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,3 +35,5 @@
 
 Related:
 - #18259 (comparison of symbolic functions)
+- #19949 (composition of symbolic subring functors)
+
``````




---

archive/issue_comments_637192.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,11 +27,10 @@\n (t, x) |--> t^2 + x^2\n ```\n \n-In this ticket\n+In this ticket:\n - We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.\n-- The element constructor substitutes the arguments in the expression by unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_`.\n-- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.\n-- A pushout takes care of the renaming of the argument variables when there is a clash.\n+- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`\n+- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.\n \n Related:\n - #18259 (comparison of symbolic functions)\n``````\n",
    "created_at": "2021-07-06T16:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-637192",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,11 +27,10 @@
 (t, x) |--> t^2 + x^2
 ```
 
-In this ticket
+In this ticket:
 - We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.
-- The element constructor substitutes the arguments in the expression by unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_`.
-- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects the argument variables.
-- A pushout takes care of the renaming of the argument variables when there is a clash.
+- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`
+- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.
 
 Related:
 - #18259 (comparison of symbolic functions)
``````




---

archive/issue_events_095256.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95256"
}
```



---

archive/issue_events_095257.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95257"
}
```



---

archive/issue_events_095258.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95258"
}
```



---

archive/issue_events_095259.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95259"
}
```



---

archive/issue_events_095260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95260"
}
```



---

archive/issue_events_095261.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95261"
}
```



---

archive/issue_events_095262.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-95262"
}
```
