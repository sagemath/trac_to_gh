# Issue 32008: CallableSymbolicExpressionRing over subrings of SR

archive/issues_031771.json:
```json
{
    "body": "CC:  @rburing @slel @egourgoulhon @tscrim @dkrenn\n\n1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.\n\n```\nsage: f(t) = t\nsage: f\nt |--> t\nsage: f * t\nt |--> t^2\n```\n   This should be changed so it gives:\n\n```\n_dummy |--> _dummy * t\n```\n   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).\n\n2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as \"7. Addition confusion\":\n\n```\nsage: f(x) = x^2\nsage: g(x) = x^2\nsage: var('t')\nsage: h(t) = t^2\nsage: f+g\nx |--> 2*x^2\nsage: f+h\n(t, x) |--> t^2 + x^2\n```\n\nIn this ticket:\n- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.\n- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`\n- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.\n\nRelated:\n- #18259 (comparison of symbolic functions)\n- #19949 (composition of symbolic subring functors)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32008\n\n",
    "created_at": "2021-06-19T00:05:35Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "CallableSymbolicExpressionRing over subrings of SR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32008",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @rburing @slel @egourgoulhon @tscrim @dkrenn

1. Currently, `CallableSymbolicExpressionRing` allows meaningless operations such as the following.

```
sage: f(t) = t
sage: f
t |--> t
sage: f * t
t |--> t^2
```
   This should be changed so it gives:

```
_dummy |--> _dummy * t
```
   `f` currently is an element of a `CallableSymbolicExpressionRing`,  a ring over the base `SR` (the only allowed base for this class).

2. The design of `CallableSymbolicExpressionRing` has another critical flaw pointed out in #28434 (Syntax for callable symbolic expressions causes too much confusion) as "7. Addition confusion":

```
sage: f(x) = x^2
sage: g(x) = x^2
sage: var('t')
sage: h(t) = t^2
sage: f+g
x |--> 2*x^2
sage: f+h
(t, x) |--> t^2 + x^2
```

In this ticket:
- We remove the distinction between the `CallableSymbolicExpressionRing` instances based on the names of the argument variable names. Instead, they will be unique by number of arguments, and the set of non-argument symbols that appear in the definition.
- The element constructor substitutes the arguments in the expression by dummy variables, i.e., unique internal symbols that are only used for this purpose. The argument names are substituted back only in `_repr_` and when converted into `SR` by `SymbolicRing._element_constructor_`
- We extend the class to support base rings that are subrings of `SR`.  Then we change the default base ring of a callable expression to be the subring of `SR` that rejects all dummy variables.

Related:
- #18259 (comparison of symbolic functions)
- #19949 (composition of symbolic subring functors)


Issue created by migration from https://trac.sagemath.org/ticket/32008





---

archive/issue_comments_453449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-19T04:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-453449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453450.json:
```json
{
    "body": "With this version, we get:\n\n```\nsage: var('a b c')\n(a, b, c)\nsage: (a*b*c).function(a, b)\n(a, b) |--> a*b*c\nsage: _.parent()\nCallable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b\nsage: (a*b*c).function(a, b) * b\nTypeError: unsupported operand parent(s) for *: 'Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b' and 'Symbolic Ring'\nsage: (a*b*c).function(a, b) * SR.subring([x])(x)\n(a, b) |--> a*b*c*x\n```",
    "created_at": "2021-06-19T05:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32008#issuecomment-453450",
    "user": "https://github.com/mkoeppe"
}
```

With this version, we get:

```
sage: var('a b c')
(a, b, c)
sage: (a*b*c).function(a, b)
(a, b) |--> a*b*c
sage: _.parent()
Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b
sage: (a*b*c).function(a, b) * b
TypeError: unsupported operand parent(s) for *: 'Callable function ring with arguments (a, b) over Symbolic Subring rejecting the variables a, b' and 'Symbolic Ring'
sage: (a*b*c).function(a, b) * SR.subring([x])(x)
(a, b) |--> a*b*c*x
```



---

archive/issue_events_084665.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84665"
}
```



---

archive/issue_events_084666.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84666"
}
```



---

archive/issue_events_084667.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84667"
}
```



---

archive/issue_events_084668.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84668"
}
```



---

archive/issue_events_084669.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84669"
}
```



---

archive/issue_events_084670.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84670"
}
```



---

archive/issue_events_084671.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32008",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32008#event-84671"
}
```
