# Issue 32242: Use GNU Info to parse singular's Info file

archive/issues_032005.json:
```json
{
    "body": "Our Singular interface currently contains a hand-written parser for Singular's \"info\" file. In this ticket, we add an optional GNU Info package to parse this file instead.\n\nRelative to running \"info\", the hand-written parser has several drawbacks:\n\n* The extra code is a maintenance burden. We should not be wasting\n  our time (poorly) reimplementing standard tools.\n\n* The custom parser is buggy. For example, it is supposed to raise a\n  `KeyError` when documentation for a non-existent function is\n  requested. However, the parser does not keep track of what section\n  it's in, so, for example, `get_docstring(\"Preface\")` will happily\n  return the contents of the preface even though \"Preface\" is not a\n  Singular function.\n\n* The first time documentation is requested, the entire info file\n  (see above) is loaded into a dictionary. With the Singular info\n  file currently weighing in at around 11MiB, this is wasting a\n  good chunk of memory.\n\n* The `singular_console()` itself tries to launch GNU Info to display\n  its interactive help, and cannot use our hand-written parser.\n\nThe one downside to requiring \"info\" is that it would add a new runtime dependency to sagelib. To avoid that, we make GNU Info optional, and suggest to the user that he install it when he tries to read Singular's documentation.\n\nGNU Info (or its superset, Texinfo) are widespread, portable, and easy to install on all of the systems we support, so in most cases this should be a \"free\" improvement.\n\nAuthor: Michael Orlitzky\n\nBranch: u/mjo/ticket/32242\n\nStatus: needs_review\n\nDependencies: #32302\n\nCommit: 137a9182a02d4aa329a78c2e936b48431c1e9017\n\nIssue created by migration from https://trac.sagemath.org/ticket/32242\n\n",
    "created_at": "2021-07-19T17:39:59Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Use GNU Info to parse singular's Info file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32242",
    "user": "https://github.com/orlitzky"
}
```
Our Singular interface currently contains a hand-written parser for Singular's "info" file. In this ticket, we add an optional GNU Info package to parse this file instead.

Relative to running "info", the hand-written parser has several drawbacks:

* The extra code is a maintenance burden. We should not be wasting
  our time (poorly) reimplementing standard tools.

* The custom parser is buggy. For example, it is supposed to raise a
  `KeyError` when documentation for a non-existent function is
  requested. However, the parser does not keep track of what section
  it's in, so, for example, `get_docstring("Preface")` will happily
  return the contents of the preface even though "Preface" is not a
  Singular function.

* The first time documentation is requested, the entire info file
  (see above) is loaded into a dictionary. With the Singular info
  file currently weighing in at around 11MiB, this is wasting a
  good chunk of memory.

* The `singular_console()` itself tries to launch GNU Info to display
  its interactive help, and cannot use our hand-written parser.

The one downside to requiring "info" is that it would add a new runtime dependency to sagelib. To avoid that, we make GNU Info optional, and suggest to the user that he install it when he tries to read Singular's documentation.

GNU Info (or its superset, Texinfo) are widespread, portable, and easy to install on all of the systems we support, so in most cases this should be a "free" improvement.

Author: Michael Orlitzky

Branch: u/mjo/ticket/32242

Status: needs_review

Dependencies: #32302

Commit: 137a9182a02d4aa329a78c2e936b48431c1e9017

Issue created by migration from https://trac.sagemath.org/ticket/32242





---

archive/issue_comments_641924.json:
```json
{
    "body": "Changing commit from \"\" to \"fc7fd02b833b2f76755f1e50a28dd7dd566962e5\"",
    "created_at": "2021-07-19T17:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641924",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "" to "fc7fd02b833b2f76755f1e50a28dd7dd566962e5"



---

archive/issue_comments_641925.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-07-19T17:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641925",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_641926.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2021-07-19T17:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641926",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_641927.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mjo/ticket/32242\"",
    "created_at": "2021-07-19T17:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641927",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "" to "u/mjo/ticket/32242"



---

archive/issue_comments_641928.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-19T17:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641928",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_641929.json:
```json
{
    "body": "Changing commit from \"fc7fd02b833b2f76755f1e50a28dd7dd566962e5\" to \"c4f693803fdc7deb904bb85c7352f6327f338a66\"",
    "created_at": "2021-07-19T17:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fc7fd02b833b2f76755f1e50a28dd7dd566962e5" to "c4f693803fdc7deb904bb85c7352f6327f338a66"



---

archive/issue_comments_641930.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-19T17:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_641931.json:
```json
{
    "body": "<a id='comment:3'></a>I don't know... shouldn't there be a feature request / PR to Singular to make the docstrings available via API?",
    "created_at": "2021-07-19T18:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641931",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>I don't know... shouldn't there be a feature request / PR to Singular to make the docstrings available via API?



---

archive/issue_comments_641932.json:
```json
{
    "body": "<a id='comment:4'></a>Singular renders its own interactive help using \"info\" or one of its alternatives: https://www.singular.uni-kl.de/Manual/latest/sing_16.htm\n\nI don't think they can give us an API without making \"info\" a dependency of Singular itself.",
    "created_at": "2021-07-19T18:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641932",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>Singular renders its own interactive help using "info" or one of its alternatives: https://www.singular.uni-kl.de/Manual/latest/sing_16.htm

I don't think they can give us an API without making "info" a dependency of Singular itself.



---

archive/issue_comments_641933.json:
```json
{
    "body": "<a id='comment:5'></a>OK I see.\n\nI still don't get why it's necessary or helpful to replace our parser with calling the `info` program. \n\nWouldn't it be much easier to just obtain the help file location from Singular itself?",
    "created_at": "2021-07-19T19:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641933",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>OK I see.

I still don't get why it's necessary or helpful to replace our parser with calling the `info` program. 

Wouldn't it be much easier to just obtain the help file location from Singular itself?



---

archive/issue_comments_641934.json:
```json
{
    "body": "<a id='comment:6'></a>I would also think it's pretty problematic from the viewpoint of modularization. We may soon have a pip-installable package for the Sage functionality that uses Singular. The wheel could then vendor `libsingular`. But vendoring the `info` program? That would be rather strange.",
    "created_at": "2021-07-19T19:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641934",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>I would also think it's pretty problematic from the viewpoint of modularization. We may soon have a pip-installable package for the Sage functionality that uses Singular. The wheel could then vendor `libsingular`. But vendoring the `info` program? That would be rather strange.



---

archive/issue_comments_641935.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [mkoeppe](#comment%3A5):\n> OK I see.\n> \n> I still don't get why it's necessary or helpful to replace our parser with calling the `info` program. \n\n\nThe interface gets a lot smaller and simpler.\n\n\n> Wouldn't it be much easier to just obtain the help file location from Singular itself?\n\n\nSingular does know where it lives, but how do you propose we get it? Ask them to add a special command-line option to support our outlandish use case?",
    "created_at": "2021-07-19T19:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641935",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>Replying to [mkoeppe](#comment%3A5):
> OK I see.
> 
> I still don't get why it's necessary or helpful to replace our parser with calling the `info` program. 


The interface gets a lot smaller and simpler.


> Wouldn't it be much easier to just obtain the help file location from Singular itself?


Singular does know where it lives, but how do you propose we get it? Ask them to add a special command-line option to support our outlandish use case?



---

archive/issue_comments_641936.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A6):\n> I would also think it's pretty problematic from the viewpoint of modularization. We may soon have a pip-installable package for the Sage functionality that uses Singular. The wheel could then vendor `libsingular`. But vendoring the `info` program? That would be rather strange.\n\n\nLeave it as part of the main Sage package, assumed to be there by the Singular wheel? In almost all cases, the system Info will be used anyway. But I don't really know enough about what you're trying to do to make a good suggestion.",
    "created_at": "2021-07-19T19:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641936",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A6):
> I would also think it's pretty problematic from the viewpoint of modularization. We may soon have a pip-installable package for the Sage functionality that uses Singular. The wheel could then vendor `libsingular`. But vendoring the `info` program? That would be rather strange.


Leave it as part of the main Sage package, assumed to be there by the Singular wheel? In almost all cases, the system Info will be used anyway. But I don't really know enough about what you're trying to do to make a good suggestion.



---

archive/issue_comments_641937.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [mjo](#comment%3A7):\n> Singular does know where it lives, but how do you propose we get it?\n\n\nUse `feGetResource` in libsingular_resources?",
    "created_at": "2021-07-19T20:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641937",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Replying to [mjo](#comment%3A7):
> Singular does know where it lives, but how do you propose we get it?


Use `feGetResource` in libsingular_resources?



---

archive/issue_comments_641938.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [mkoeppe](#comment%3A9):\n> Replying to [mjo](#comment%3A7):\n> > Singular does know where it lives, but how do you propose we get it?\n\n> \n> Use `feGetResource` in libsingular_resources?\n\n\nLooks like it will work, thanks. I still think it's kinda dumb to poorly reimplement a ubiquitous 300k tool in math software, but it's good to know that we can find the help file if we really need to.",
    "created_at": "2021-07-19T20:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641938",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>Replying to [mkoeppe](#comment%3A9):
> Replying to [mjo](#comment%3A7):
> > Singular does know where it lives, but how do you propose we get it?

> 
> Use `feGetResource` in libsingular_resources?


Looks like it will work, thanks. I still think it's kinda dumb to poorly reimplement a ubiquitous 300k tool in math software, but it's good to know that we can find the help file if we really need to.



---

archive/issue_comments_641939.json:
```json
{
    "body": "<a id='comment:11'></a>info is a well-documented, stable, extremely simple file format, I don't think there's anything wrong with doing basic parsing on it in Python.",
    "created_at": "2021-07-19T20:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641939",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>info is a well-documented, stable, extremely simple file format, I don't think there's anything wrong with doing basic parsing on it in Python.



---

archive/issue_comments_641940.json:
```json
{
    "body": "<a id='comment:12'></a>Well, we don't really parse it. It's more like a grep:\n\n```\nsage: from sage.interfaces.singular import get_docstring                        \nsage: get_docstring(\"Preface\")\n```\n\nwill dutifully pull up the \"Preface\" node without regard for where in the manual it lives (it's not a function that we wrap and should throw a `KeyError` instead). The current branch oversimplifies a bit here too, checking only that the parent node is \"Functions\", but you can pass a series of (sub)nodes to `info` to ensure that you're navigating to where you think you are.\n\nIt looks like we also install info files for maxima and giac. So not only would having \"info\" installed allow you to run the interactive help in a `singular_console()`, but it may help somebody read the maxima and giac docs, too.",
    "created_at": "2021-07-19T20:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641940",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>Well, we don't really parse it. It's more like a grep:

```
sage: from sage.interfaces.singular import get_docstring                        
sage: get_docstring("Preface")
```

will dutifully pull up the "Preface" node without regard for where in the manual it lives (it's not a function that we wrap and should throw a `KeyError` instead). The current branch oversimplifies a bit here too, checking only that the parent node is "Functions", but you can pass a series of (sub)nodes to `info` to ensure that you're navigating to where you think you are.

It looks like we also install info files for maxima and giac. So not only would having "info" installed allow you to run the interactive help in a `singular_console()`, but it may help somebody read the maxima and giac docs, too.



---

archive/issue_comments_641941.json:
```json
{
    "body": "<a id='comment:13'></a>I don't really have an objection to adding `info` as a package. Accessing the interactive help in the standalone giac, maxima, singular shipped with Sage is a nice-to-have feature; but I don't think this is a strong argument to making it a \"standard\" package.\n\nHowever, I don't support replacing the in-Python code (no issues have been reported with it -- no matter how primitive the code may be) by calling out to the `info` program. This adds a complication that I would really hope to avoid.",
    "created_at": "2021-07-19T21:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641941",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>I don't really have an objection to adding `info` as a package. Accessing the interactive help in the standalone giac, maxima, singular shipped with Sage is a nice-to-have feature; but I don't think this is a strong argument to making it a "standard" package.

However, I don't support replacing the in-Python code (no issues have been reported with it -- no matter how primitive the code may be) by calling out to the `info` program. This adds a complication that I would really hope to avoid.



---

archive/issue_comments_641942.json:
```json
{
    "body": "<a id='comment:14'></a>Conversely, I'm only willing to tolerate the new dependency if it eliminates these hacks. It may be true that no issues have been reported with the info parser, but how long have we been waiting for someone to write an spkg-configure.m4 for singular? The only reason no one has done it (singular has a pc file, and is a huge, slow-to-build package) is because everyone is afraid to step into a pile of shit when they open singular.py{,x} =)\n\nReplacing the cruft is its own reward if it makes maintaining the singular interface easier. I'm  unhappy about the dependency myself, but who does it really hurt? Doing *something* about `SINGULARPATH` is necessary before we can use Singular from the system. Using GNU Info to read the info file is an easy and principled way to get us to a point where everyone on Fedora, Debian, Gentoo, Homebrew, Conda, Nix, etc. can just use Singular (and Info) from their package manager. That's a big gain for what constitutes almost the entirety of our users. And who is penalized by having Info be a standard package? Maybe some BSD installs that aren't currently supported platforms? This should be something like bzip2 that no one ever builds.",
    "created_at": "2021-07-19T23:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641942",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'></a>Conversely, I'm only willing to tolerate the new dependency if it eliminates these hacks. It may be true that no issues have been reported with the info parser, but how long have we been waiting for someone to write an spkg-configure.m4 for singular? The only reason no one has done it (singular has a pc file, and is a huge, slow-to-build package) is because everyone is afraid to step into a pile of shit when they open singular.py{,x} =)

Replacing the cruft is its own reward if it makes maintaining the singular interface easier. I'm  unhappy about the dependency myself, but who does it really hurt? Doing *something* about `SINGULARPATH` is necessary before we can use Singular from the system. Using GNU Info to read the info file is an easy and principled way to get us to a point where everyone on Fedora, Debian, Gentoo, Homebrew, Conda, Nix, etc. can just use Singular (and Info) from their package manager. That's a big gain for what constitutes almost the entirety of our users. And who is penalized by having Info be a standard package? Maybe some BSD installs that aren't currently supported platforms? This should be something like bzip2 that no one ever builds.



---

archive/issue_comments_641943.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [mjo](#comment%3A14):\n> who is penalized by having Info be a standard package? \n\n\nThere is no problem with making `info` a standard package.\n\nBut there is a problem in adding an additional non-Python runtime dependency to the Sage library. `info` cannot be installed by `pip`.",
    "created_at": "2021-07-19T23:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641943",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Replying to [mjo](#comment%3A14):
> who is penalized by having Info be a standard package? 


There is no problem with making `info` a standard package.

But there is a problem in adding an additional non-Python runtime dependency to the Sage library. `info` cannot be installed by `pip`.



---

archive/issue_comments_641944.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [mjo](#comment%3A14):\n> how long have we been waiting for someone to write an spkg-configure.m4 for singular? \n\nThis task was waiting for the stalled Singular upgrade ticket #25993.",
    "created_at": "2021-07-19T23:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641944",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [mjo](#comment%3A14):
> how long have we been waiting for someone to write an spkg-configure.m4 for singular? 

This task was waiting for the stalled Singular upgrade ticket #25993.



---

archive/issue_comments_641945.json:
```json
{
    "body": "<a id='comment:17'></a>One final point for GNU Info:\n\nThe Singular manual is now 11MB in singular-4.2.1. The existing implementation loads the entire thing (not just the function documentation, as I've shown) into a global variable that lives forever. This permanently wastes roughly the same amount of memory:\n\n```\nsage: from sage.interfaces.singular import generate_docstring_dictionary        \nsage: get_memory_usage()                                                        \n6467.30859375\nsage: generate_docstring_dictionary()                                           \nsage: get_memory_usage()                                                        \n6479.34765625\n```\n\nAnd that will get worse as the Singular manual grows.",
    "created_at": "2021-07-20T11:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641945",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'></a>One final point for GNU Info:

The Singular manual is now 11MB in singular-4.2.1. The existing implementation loads the entire thing (not just the function documentation, as I've shown) into a global variable that lives forever. This permanently wastes roughly the same amount of memory:

```
sage: from sage.interfaces.singular import generate_docstring_dictionary        
sage: get_memory_usage()                                                        
6467.30859375
sage: generate_docstring_dictionary()                                           
sage: get_memory_usage()                                                        
6479.34765625
```

And that will get worse as the Singular manual grows.



---

archive/issue_comments_641946.json:
```json
{
    "body": "<a id='comment:18'></a>By the way, this ticket does not solve the original problem at all. If we want to use system Singular on a system that does not have `info`, then the installed `info` from the proposed SPKG does not have information regarding the info file location. So you are only shifting the problem of locating the info file from runtime to build time; *and* you are introducing a new non-Python dependency for the sagelib runtime.",
    "created_at": "2021-07-20T16:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641946",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>By the way, this ticket does not solve the original problem at all. If we want to use system Singular on a system that does not have `info`, then the installed `info` from the proposed SPKG does not have information regarding the info file location. So you are only shifting the problem of locating the info file from runtime to build time; *and* you are introducing a new non-Python dependency for the sagelib runtime.



---

archive/issue_comments_641947.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [mkoeppe](#comment%3A18):\n> By the way, this ticket does not solve the original problem at all. If we want to use system Singular on a system that does not have `info`, then the installed `info` from the proposed SPKG does not have information regarding the info file location. So you are only shifting the problem of locating the info file from runtime to build time; *and* you are introducing a new non-Python dependency for the sagelib runtime.\n\n\nWhile it's possible to put the info files *anywhere*, we can stick a colon on the end of `$INFOPATH` to have the SPKG try the default list as fallbacks: https://git.savannah.gnu.org/cgit/texinfo.git/tree/info/filesys.h#n70\n\nIf we manage to find a system that both doesn't have GNU Info and yet still goes out of its way to install info files in a crazy location... then I guess at that point we could use DEPCHECK to ensure that the Singular SPKG gets built on that system.",
    "created_at": "2021-07-20T16:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641947",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'></a>Replying to [mkoeppe](#comment%3A18):
> By the way, this ticket does not solve the original problem at all. If we want to use system Singular on a system that does not have `info`, then the installed `info` from the proposed SPKG does not have information regarding the info file location. So you are only shifting the problem of locating the info file from runtime to build time; *and* you are introducing a new non-Python dependency for the sagelib runtime.


While it's possible to put the info files *anywhere*, we can stick a colon on the end of `$INFOPATH` to have the SPKG try the default list as fallbacks: https://git.savannah.gnu.org/cgit/texinfo.git/tree/info/filesys.h#n70

If we manage to find a system that both doesn't have GNU Info and yet still goes out of its way to install info files in a crazy location... then I guess at that point we could use DEPCHECK to ensure that the Singular SPKG gets built on that system.



---

archive/issue_comments_641948.json:
```json
{
    "body": "<a id='comment:20'></a>Sorry, overall this ticket looks like a solution in search of a problem, and one that will create new problems as a side effect.\n\nThe actual problem has a simple solution,[comment:9](#comment%3A9).",
    "created_at": "2021-07-20T16:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641948",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Sorry, overall this ticket looks like a solution in search of a problem, and one that will create new problems as a side effect.

The actual problem has a simple solution,[comment:9](#comment%3A9).



---

archive/issue_comments_641949.json:
```json
{
    "body": "<a id='comment:21'></a>We could always make GNU Info an optional package, and take the same approach to\n\n```\nsage: singular.<function>?\n```\n\nthat we take to\n\n```\nsage: singular_console()\n> help <function>;\n```\n\nThat is, it doesn't work unless you have Info installed. The docstring for the sage object would suggest the optional package if it's not available.",
    "created_at": "2021-07-20T16:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641949",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>We could always make GNU Info an optional package, and take the same approach to

```
sage: singular.<function>?
```

that we take to

```
sage: singular_console()
> help <function>;
```

That is, it doesn't work unless you have Info installed. The docstring for the sage object would suggest the optional package if it's not available.



---

archive/issue_comments_641950.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [mkoeppe](#comment%3A20):\n> Sorry, overall this ticket looks like a solution in search of a problem, and one that will create new problems as a side effect.\n> \n> The actual problem has a simple solution,[comment:9](#comment%3A9).\n> \n\n\nThis is only a solution if you insist on keeping our lame python implementation and all of the problems it comes with. It'll get the job done, but I won't be the one to do it.",
    "created_at": "2021-07-20T16:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641950",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:22'></a>Replying to [mkoeppe](#comment%3A20):
> Sorry, overall this ticket looks like a solution in search of a problem, and one that will create new problems as a side effect.
> 
> The actual problem has a simple solution,[comment:9](#comment%3A9).
> 


This is only a solution if you insist on keeping our lame python implementation and all of the problems it comes with. It'll get the job done, but I won't be the one to do it.



---

archive/issue_comments_641951.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-20T17:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_641952.json:
```json
{
    "body": "Changing commit from \"c4f693803fdc7deb904bb85c7352f6327f338a66\" to \"a82847c7617969350dbc409c6821d10abc74817f\"",
    "created_at": "2021-07-20T17:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c4f693803fdc7deb904bb85c7352f6327f338a66" to "a82847c7617969350dbc409c6821d10abc74817f"



---

archive/issue_comments_641953.json:
```json
{
    "body": "Changing work_issues from \"\" to \"reduce ticket to adding info as optional package\"",
    "created_at": "2021-07-24T18:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641953",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "reduce ticket to adding info as optional package"



---

archive/issue_comments_641954.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-24T18:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641954",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_085417.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-29T22:04:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85417"
}
```



---

archive/issue_comments_641955.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32302\"",
    "created_at": "2021-07-29T22:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641955",
    "user": "https://github.com/orlitzky"
}
```

Changing dependencies from "" to "#32302"



---

archive/issue_comments_641956.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-29T22:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_641957.json:
```json
{
    "body": "Changing commit from \"a82847c7617969350dbc409c6821d10abc74817f\" to \"624a0e8d064ba70d40af701ec65b0cd47d9cbad6\"",
    "created_at": "2021-07-29T22:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a82847c7617969350dbc409c6821d10abc74817f" to "624a0e8d064ba70d40af701ec65b0cd47d9cbad6"



---

archive/issue_comments_641958.json:
```json
{
    "body": "Changing work_issues from \"reduce ticket to adding info as optional package\" to \"\"",
    "created_at": "2021-07-29T22:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641958",
    "user": "https://github.com/orlitzky"
}
```

Changing work_issues from "reduce ticket to adding info as optional package" to ""



---

archive/issue_comments_641959.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-29T22:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641959",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_641960.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,25 @@\n-In the description of #29024, a few problems are listed as prerequisites for accepting a system installation of Singular. Basically, they ask that we either use singular in a less crazy manner, or find a way to make our existing hacks work with a system copy of singular.\n+Our Singular interface currently contains a hand-written parser for Singular's \"info\" file. In this ticket, we add an optional GNU Info package to parse this file instead.\n \n-One of those issues is that the `sage/interfaces/singular.py` is using an environment variable `SINGULARPATH` to guess at the location where Singular's Info file is installed, so that it can be manually parsed.\n+Relative to running \"info\", the hand-written parser has several drawbacks:\n \n-In the interest of using Singular in a less crazy manner, I propose we add the standalone GNU \"info\" as a new package, and use it to read Singular's documentation from wherever it is configured to do so. This eliminates two of the problems in #29024.\n+* The extra code is a maintenance burden. We should not be wasting\n+  our time (poorly) reimplementing standard tools.\n \n+* The custom parser is buggy. For example, it is supposed to raise a\n+  `KeyError` when documentation for a non-existent function is\n+  requested. However, the parser does not keep track of what section\n+  it's in, so, for example, `get_docstring(\"Preface\")` will happily\n+  return the contents of the preface even though \"Preface\" is not a\n+  Singular function.\n+\n+* The first time documentation is requested, the entire info file\n+  (see above) is loaded into a dictionary. With the Singular info\n+  file currently weighing in at around 11MiB, this is wasting a\n+  good chunk of memory.\n+\n+* The `singular_console()` itself tries to launch GNU Info to display\n+  its interactive help, and cannot use our hand-written parser.\n+\n+The one downside to requiring \"info\" is that it would add a new runtime dependency to sagelib. To avoid that, we make GNU Info optional, and suggest to the user that he install it when he tries to read Singular's documentation.\n+\n+GNU Info (or its superset, Texinfo) are widespread, portable, and easy to install on all of the systems we support, so in most cases this should be a \"free\" improvement.\n``````\n",
    "created_at": "2021-07-29T22:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641960",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,25 @@
-In the description of #29024, a few problems are listed as prerequisites for accepting a system installation of Singular. Basically, they ask that we either use singular in a less crazy manner, or find a way to make our existing hacks work with a system copy of singular.
+Our Singular interface currently contains a hand-written parser for Singular's "info" file. In this ticket, we add an optional GNU Info package to parse this file instead.
 
-One of those issues is that the `sage/interfaces/singular.py` is using an environment variable `SINGULARPATH` to guess at the location where Singular's Info file is installed, so that it can be manually parsed.
+Relative to running "info", the hand-written parser has several drawbacks:
 
-In the interest of using Singular in a less crazy manner, I propose we add the standalone GNU "info" as a new package, and use it to read Singular's documentation from wherever it is configured to do so. This eliminates two of the problems in #29024.
+* The extra code is a maintenance burden. We should not be wasting
+  our time (poorly) reimplementing standard tools.
 
+* The custom parser is buggy. For example, it is supposed to raise a
+  `KeyError` when documentation for a non-existent function is
+  requested. However, the parser does not keep track of what section
+  it's in, so, for example, `get_docstring("Preface")` will happily
+  return the contents of the preface even though "Preface" is not a
+  Singular function.
+
+* The first time documentation is requested, the entire info file
+  (see above) is loaded into a dictionary. With the Singular info
+  file currently weighing in at around 11MiB, this is wasting a
+  good chunk of memory.
+
+* The `singular_console()` itself tries to launch GNU Info to display
+  its interactive help, and cannot use our hand-written parser.
+
+The one downside to requiring "info" is that it would add a new runtime dependency to sagelib. To avoid that, we make GNU Info optional, and suggest to the user that he install it when he tries to read Singular's documentation.
+
+GNU Info (or its superset, Texinfo) are widespread, portable, and easy to install on all of the systems we support, so in most cases this should be a "free" improvement.
``````




---

archive/issue_comments_641961.json:
```json
{
    "body": "<a id='comment:27'></a>New commits:",
    "created_at": "2021-07-29T22:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641961",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:27'></a>New commits:



---

archive/issue_comments_641962.json:
```json
{
    "body": "<a id='comment:28'></a>It's now completely optional. When \"info\" is not installed, you'll be prodded to install it:\n\n```\nsage: singular.align?                                                           \nSignature:   singular.align(*args, **kwds)\nType:        SingularFunction\nString form: align\nFile:        ~/src/sage.git/local/lib/python3.9/site-packages/sage/interfaces/singular.py\nDocstring:  \nThis function is an automatically generated pexpect wrapper around the\nSingular function 'align'.\n\nEXAMPLES:\n\n   sage: groebner = singular.groebner\n   sage: P.<x, y> = PolynomialRing(QQ)\n   sage: I = P.ideal(x^2-y, y+x)\n   sage: groebner(singular(I))\n   x+y,\n   y^2-y\n\nThe relevant Singular documentation will be shown here if you install\nGNU Texinfo, the stand-alone GNU Info program, or the SageMath \"info\"\nSPKG.\n```",
    "created_at": "2021-07-29T22:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641962",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:28'></a>It's now completely optional. When "info" is not installed, you'll be prodded to install it:

```
sage: singular.align?                                                           
Signature:   singular.align(*args, **kwds)
Type:        SingularFunction
String form: align
File:        ~/src/sage.git/local/lib/python3.9/site-packages/sage/interfaces/singular.py
Docstring:  
This function is an automatically generated pexpect wrapper around the
Singular function 'align'.

EXAMPLES:

   sage: groebner = singular.groebner
   sage: P.<x, y> = PolynomialRing(QQ)
   sage: I = P.ideal(x^2-y, y+x)
   sage: groebner(singular(I))
   x+y,
   y^2-y

The relevant Singular documentation will be shown here if you install
GNU Texinfo, the stand-alone GNU Info program, or the SageMath "info"
SPKG.
```



---

archive/issue_comments_641963.json:
```json
{
    "body": "<a id='comment:29'></a>I have opened #32323 for the uncontroversial part \"Add GNU info as an optional package\".",
    "created_at": "2021-08-01T21:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641963",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>I have opened #32323 for the uncontroversial part "Add GNU info as an optional package".



---

archive/issue_comments_641964.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-02T00:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_641965.json:
```json
{
    "body": "Changing commit from \"624a0e8d064ba70d40af701ec65b0cd47d9cbad6\" to \"137a9182a02d4aa329a78c2e936b48431c1e9017\"",
    "created_at": "2021-12-02T00:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32242#issuecomment-641965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "624a0e8d064ba70d40af701ec65b0cd47d9cbad6" to "137a9182a02d4aa329a78c2e936b48431c1e9017"



---

archive/issue_events_085418.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-27T01:03:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85418"
}
```



---

archive/issue_events_085419.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-27T01:03:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85419"
}
```



---

archive/issue_events_085420.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85420"
}
```



---

archive/issue_events_085421.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85421"
}
```



---

archive/issue_events_085422.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85422"
}
```



---

archive/issue_events_085423.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32242",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32242#event-85423"
}
```
