# Issue 32489: Move load_ipython_extension from sage.__init__ to sage.repl.__init__

archive/issues_032252.json:
```json
{
    "body": "As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to `sage.repl.__init__`\n\nThis function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).\n\n```\n$ ./sage -ipython\nPython 3.9.6 (default, Jun 29 2021, 05:25:02) \nType 'copyright', 'credits' or 'license' for more information\nIPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.\n```\nWith this ticket:\n\n```\n./sage -ipython\n...\nIn [1]: %load_ext sage                                                                                                                                 \nThe sage module is not an IPython extension.\nIn [2]: import sage.repl                                                                                                                               \nIn [3]: %load_ext sage              # succeeds                                                                                                                   \n```\nand:\n\n```\n./sage -ipython\n...\nIn [1]: %load_ext sage.repl         # succeeds                                                                                                                          \n```\n\n\nIn a follow up ticket we may also want to define the corresponding function that will make `%unload_ext sage` work\n\n\n\nCC:  @tscrim @seblabbe @fchapoton @jhpalmieri @kcrisman\n\nBranch/Commit: 53bde1bc8e8012e6a77066f0a4a7d717fc97075a\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #32479\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32489\n\n",
    "closed_at": "2021-10-10T10:16:54Z",
    "created_at": "2021-09-07T23:21:18Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Move load_ipython_extension from sage.__init__ to sage.repl.__init__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32489",
    "user": "https://github.com/mkoeppe"
}
```
As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to `sage.repl.__init__`

This function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).

```
$ ./sage -ipython
Python 3.9.6 (default, Jun 29 2021, 05:25:02) 
Type 'copyright', 'credits' or 'license' for more information
IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.
```
With this ticket:

```
./sage -ipython
...
In [1]: %load_ext sage                                                                                                                                 
The sage module is not an IPython extension.
In [2]: import sage.repl                                                                                                                               
In [3]: %load_ext sage              # succeeds                                                                                                                   
```
and:

```
./sage -ipython
...
In [1]: %load_ext sage.repl         # succeeds                                                                                                                          
```


In a follow up ticket we may also want to define the corresponding function that will make `%unload_ext sage` work



CC:  @tscrim @seblabbe @fchapoton @jhpalmieri @kcrisman

Branch/Commit: 53bde1bc8e8012e6a77066f0a4a7d717fc97075a

Reviewer: John Palmieri

Author: Matthias Koeppe

Dependencies: #32479

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32489





---

archive/issue_comments_647307.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/move_load_ipython_extension_from_sage___init___to_sage_repl___init__\"",
    "created_at": "2021-09-13T19:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647307",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/move_load_ipython_extension_from_sage___init___to_sage_repl___init__"



---

archive/issue_comments_647308.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,30 @@\n \n This function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).\n \n-We also define the corresponding function that will make `%unload_ext sage` work\n+$ ./sage -ipython\n+Python 3.9.6 (default, Jun 29 2021, 05:25:02) \n+Type 'copyright', 'credits' or 'license' for more information\n+IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.\n+\n+With this ticket:\n+\n+```\n+./sage -ipython\n+...\n+In [1]: %load_ext sage                                                                                                                                 \n+The sage module is not an IPython extension.\n+In [2]: import sage.repl                                                                                                                               \n+In [3]: %load_ext sage              # succeeds                                                                                                                   \n+```\n+and:\n+\n+```\n+./sage -ipython\n+...\n+In [1]: %load_ext sage.repl         # succeeds                                                                                                                          \n+```\n \n \n+In a follow up ticket we may also want to define the corresponding function that will make `%unload_ext sage` work\n+\n+\n``````\n",
    "created_at": "2021-09-13T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647308",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,30 @@
 
 This function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).
 
-We also define the corresponding function that will make `%unload_ext sage` work
+$ ./sage -ipython
+Python 3.9.6 (default, Jun 29 2021, 05:25:02) 
+Type 'copyright', 'credits' or 'license' for more information
+IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.
+
+With this ticket:
+
+```
+./sage -ipython
+...
+In [1]: %load_ext sage                                                                                                                                 
+The sage module is not an IPython extension.
+In [2]: import sage.repl                                                                                                                               
+In [3]: %load_ext sage              # succeeds                                                                                                                   
+```
+and:
+
+```
+./sage -ipython
+...
+In [1]: %load_ext sage.repl         # succeeds                                                                                                                          
+```
 
 
+In a follow up ticket we may also want to define the corresponding function that will make `%unload_ext sage` work
+
+
``````




---

archive/issue_comments_647309.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-09-13T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647309",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_647310.json:
```json
{
    "body": "Changing commit from \"\" to \"5957ee4b14577c8c8f7294e58ee6d1e2f4dd557d\"",
    "created_at": "2021-09-13T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647310",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "5957ee4b14577c8c8f7294e58ee6d1e2f4dd557d"



---

archive/issue_comments_647311.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-13T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647311",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_647312.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-09-13T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647312",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_647313.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,13 @@\n-As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to sage.repl.__init__\n+As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to `sage.repl.__init__`\n \n This function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).\n \n+```\n $ ./sage -ipython\n Python 3.9.6 (default, Jun 29 2021, 05:25:02) \n Type 'copyright', 'credits' or 'license' for more information\n IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.\n-\n+```\n With this ticket:\n \n ```\n``````\n",
    "created_at": "2021-09-25T22:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647313",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,13 @@
-As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to sage.repl.__init__
+As part of #31420 (Meta-ticket: Review/remove monkey patching in `src/sage/__init__.py`), we move the definition of `load_ipython_extension` (introduced in #18726) to `sage.repl.__init__`
 
 This function was defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/). After the move, this would have to be `%load_ext sage.repl`; but we patch it into the module `sage` upon import of `sage.repl` to keep `%load_ext sage` as well (at least after `import sage.all` or `import sage.repl`).
 
+```
 $ ./sage -ipython
 Python 3.9.6 (default, Jun 29 2021, 05:25:02) 
 Type 'copyright', 'credits' or 'license' for more information
 IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.
-
+```
 With this ticket:
 
 ```
``````




---

archive/issue_comments_647314.json:
```json
{
    "body": "<a id='comment:5'></a>I think this should be rebased on top of #32479.",
    "created_at": "2021-09-25T23:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647314",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>I think this should be rebased on top of #32479.



---

archive/issue_comments_647315.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-09-26T00:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_647316.json:
```json
{
    "body": "Changing commit from \"5957ee4b14577c8c8f7294e58ee6d1e2f4dd557d\" to \"c7ec7428931e30c20d09f885a35e5ca1266dab94\"",
    "created_at": "2021-09-26T00:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5957ee4b14577c8c8f7294e58ee6d1e2f4dd557d" to "c7ec7428931e30c20d09f885a35e5ca1266dab94"



---

archive/issue_comments_647317.json:
```json
{
    "body": "<a id='comment:7'></a>Good idea, done",
    "created_at": "2021-09-26T00:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647317",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Good idea, done



---

archive/issue_comments_647318.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32479\"",
    "created_at": "2021-09-26T00:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647318",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32479"



---

archive/issue_comments_647319.json:
```json
{
    "body": "<a id='comment:9'></a>It's not backward compatible, but I hope this won't affect very many people.",
    "created_at": "2021-09-29T03:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647319",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>It's not backward compatible, but I hope this won't affect very many people.



---

archive/issue_comments_647320.json:
```json
{
    "body": "<a id='comment:10'></a>I might change the comment \"we removed the `__init__.py` file\" to \"we are removing the ...\". This isn't the last step in the removal, right?",
    "created_at": "2021-09-29T03:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647320",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>I might change the comment "we removed the `__init__.py` file" to "we are removing the ...". This isn't the last step in the removal, right?



---

archive/issue_comments_647321.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-29T04:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_647322.json:
```json
{
    "body": "Changing commit from \"c7ec7428931e30c20d09f885a35e5ca1266dab94\" to \"53bde1bc8e8012e6a77066f0a4a7d717fc97075a\"",
    "created_at": "2021-09-29T04:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c7ec7428931e30c20d09f885a35e5ca1266dab94" to "53bde1bc8e8012e6a77066f0a4a7d717fc97075a"



---

archive/issue_comments_647323.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2021-09-29T16:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647323",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_647324.json:
```json
{
    "body": "<a id='comment:12'></a>Thank you, let's merge it!",
    "created_at": "2021-09-29T16:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647324",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Thank you, let's merge it!



---

archive/issue_comments_647325.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-29T16:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647325",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_647326.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks!",
    "created_at": "2021-09-29T16:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647326",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Thanks!



---

archive/issue_events_086186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-10T10:16:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32489#event-86186"
}
```



---

archive/issue_comments_647327.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/move_load_ipython_extension_from_sage___init___to_sage_repl___init__\" to \"53bde1bc8e8012e6a77066f0a4a7d717fc97075a\"",
    "created_at": "2021-10-10T10:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647327",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/move_load_ipython_extension_from_sage___init___to_sage_repl___init__" to "53bde1bc8e8012e6a77066f0a4a7d717fc97075a"



---

archive/issue_comments_647328.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-10T10:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-647328",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
