# Issue 32190: Add hashing to class functions

archive/issues_031953.json:
```json
{
    "assignees": [
        "https://github.com/trevorkarn"
    ],
    "body": "It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.\n\nCC:  @tscrim @trevorkarn\n\nKeywords: **gsoc2021 class-function hash**\n\nBranch/Commit: **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Trevor K. Karn**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32190_\n\n",
    "closed_at": "2021-07-24T15:27:47Z",
    "created_at": "2021-07-12T19:02:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add hashing to class functions",
    "type": "issue",
    "updated_at": "2021-07-24T15:27:47Z",
    "url": "https://github.com/sagemath/sage/issues/32190",
    "user": "https://github.com/trevorkarn"
}
```
It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.

CC:  @tscrim @trevorkarn

Keywords: **gsoc2021 class-function hash**

Branch/Commit: **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**

Reviewer: **Travis Scrimshaw**

Author: **Trevor K. Karn**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/32190_





---

archive/issue_events_444027.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:02:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444027"
}
```



---

archive/issue_events_444028.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:02:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444028"
}
```



---

archive/issue_events_444029.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:02:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444029"
}
```



---

archive/issue_events_444030.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:02:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444030"
}
```



---

archive/issue_comments_518613.json:
```json
{
    "body": "Branch: **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)**",
    "created_at": "2021-07-12T19:02:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518613",
    "user": "https://github.com/trevorkarn"
}
```

Branch: **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)**



---

archive/issue_comments_518614.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-12T19:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518614",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_comments_518615.json:
```json
{
    "body": "Commit: **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)**",
    "created_at": "2021-07-12T19:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518615",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)**



---

archive/issue_events_444031.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:19:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "title_is": "Add `CachedRepresentation` to class functions",
    "title_was": "Add hash to class functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444031"
}
```



---

archive/issue_comments_518616.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-12T19:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518616",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_events_444032.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T19:19:58Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "subject": "https://github.com/trevorkarn",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444032"
}
```



---

archive/issue_comments_518617.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put ``ClassFunction``s into the category framework. In the mean time we implement a hash function to ``ClassFunction_gap`` and ``ClassFunction_libgap``\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-12T19:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518617",
    "user": "https://github.com/trevorkarn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put ``ClassFunction``s into the category framework. In the mean time we implement a hash function to ``ClassFunction_gap`` and ``ClassFunction_libgap``
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
``````




---

archive/issue_comments_518618.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498\">a602e4e</a></td><td><code>Add CachedRepresentation to ClassFunction_gap</code></td></tr></table>\n",
    "created_at": "2021-07-12T21:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518618",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:4"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498">a602e4e</a></td><td><code>Add CachedRepresentation to ClassFunction_gap</code></td></tr></table>




---

archive/issue_events_444033.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-12T21:39:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444033"
}
```



---

archive/issue_comments_518619.json:
```json
{
    "body": "Changed commit from **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)** to **[`a602e4e`](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)**",
    "created_at": "2021-07-12T21:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518619",
    "user": "https://github.com/trevorkarn"
}
```

Changed commit from **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)** to **[`a602e4e`](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)**



---

archive/issue_comments_518620.json:
```json
{
    "body": "Changed branch from **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)** to **[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)**",
    "created_at": "2021-07-12T21:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518620",
    "user": "https://github.com/trevorkarn"
}
```

Changed branch from **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)** to **[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)**



---

archive/issue_comments_518621.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't see why making this a `CachedRepresentation` is needed to do that. All you would need is the equality comparison and a `__hash__`. Can you explain the reasoning in a bit more detail?",
    "created_at": "2021-07-12T22:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518621",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't see why making this a `CachedRepresentation` is needed to do that. All you would need is the equality comparison and a `__hash__`. Can you explain the reasoning in a bit more detail?



---

archive/issue_comments_518622.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nMy main reasoning was that I wanted to pass an instance of `ClassFunction` as an argument of `FiniteDimensionalTwistedInvariantModule.__init__` of #32145 and when doing doctesting I was getting errors which seemed to be because of cacheing (`FiniteDimensionalTwistedInvariantModule` inherits from `UniqueRepresentation` via `SubmoduleWithBasis`). It did work to fix it with a hash (c.f. commit \u200b0cdd853 on branch u/tkarn/class_function_hash-32190) but I didn't see anywhere else in source code that directly implemented a `__hash__` and so I thought `CachedRepresentation` seemed like the right way to do it following the general Sage conventions.",
    "created_at": "2021-07-13T16:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518622",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:6" align="right">comment:6</div>

My main reasoning was that I wanted to pass an instance of `ClassFunction` as an argument of `FiniteDimensionalTwistedInvariantModule.__init__` of #32145 and when doing doctesting I was getting errors which seemed to be because of cacheing (`FiniteDimensionalTwistedInvariantModule` inherits from `UniqueRepresentation` via `SubmoduleWithBasis`). It did work to fix it with a hash (c.f. commit ​0cdd853 on branch u/tkarn/class_function_hash-32190) but I didn't see anywhere else in source code that directly implemented a `__hash__` and so I thought `CachedRepresentation` seemed like the right way to do it following the general Sage conventions.



---

archive/issue_comments_518623.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks for your frank reply. See [documentation](https://doc.sagemath.org/html/en/reference/structure/sage/structure/unique_representation.html#sage.structure.unique_representation.CachedRepresentation). The classes `CachedRepresentation` and `UniqueRepresentation` are to establish nonlocal objects. They introduce extra overhead, with possible savings when objects get created with equivalent construction parameters repeatedly, but they do that at the cost of modified semantics (you should really not change anything on these objects, because your changes may affect unrelated code). Oddly enough, `CachedRepresentation` does *not* define equality or hashing behaviour, so it shouldn't even do what you're using it for.",
    "created_at": "2021-07-13T16:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518623",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks for your frank reply. See [documentation](https://doc.sagemath.org/html/en/reference/structure/sage/structure/unique_representation.html#sage.structure.unique_representation.CachedRepresentation). The classes `CachedRepresentation` and `UniqueRepresentation` are to establish nonlocal objects. They introduce extra overhead, with possible savings when objects get created with equivalent construction parameters repeatedly, but they do that at the cost of modified semantics (you should really not change anything on these objects, because your changes may affect unrelated code). Oddly enough, `CachedRepresentation` does *not* define equality or hashing behaviour, so it shouldn't even do what you're using it for.



---

archive/issue_comments_518624.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?",
    "created_at": "2021-07-13T18:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518624",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:8" align="right">comment:8</div>

Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?



---

archive/issue_comments_518625.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-13T19:07:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518625",
    "user": "https://github.com/trevorkarn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `CachedRepresentation` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
``````




---

archive/issue_events_444034.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "title_is": "Add hashing to class functions",
    "title_was": "Add `CachedRepresentation` to class functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444034"
}
```



---

archive/issue_comments_518626.json:
```json
{
    "body": "Changed branch from **[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)** to **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)**",
    "created_at": "2021-07-13T19:07:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518626",
    "user": "https://github.com/trevorkarn"
}
```

Changed branch from **[u/tkarn/class_function_cache-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_cache-32190)** to **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)**



---

archive/issue_comments_518627.json:
```json
{
    "body": "Changed commit from **[`a602e4e`](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)** to **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)**",
    "created_at": "2021-07-13T19:07:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518627",
    "user": "https://github.com/trevorkarn"
}
```

Changed commit from **[`a602e4e`](https://github.com/sagemath/sagetrac-mirror/commit/a602e4e05d00a4877b0759d942cda0fe3f597498)** to **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)**



---

archive/issue_events_444035.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444035"
}
```



---

archive/issue_events_444036.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T19:07:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444036"
}
```



---

archive/issue_comments_518628.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35\">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-13T19:07:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518628",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:9"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35">0cdd853</a></td><td><code>Add __hash__</code></td></tr></table>




---

archive/issue_comments_518629.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@trevorkarn](#comment:8):\n> Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?\n\nThat's just a python thing: hashable objects must be comparable for equality, and items that compare equal should have identical hashes. Without that, dictionary lookup and sets don't work properly (and hashable objects must play nice with sets and dictionaries -- that's what hashing is for). Because hash and equality need to be coordinated, it's normally not even possible in python to inherit one but not the other.\n\n(sage actually violates the python hash contract, because `1 == GF(5)(1) == 6`. This causes trouble, but it is required to have `==` work properly with coercion, which was felt important for a CAS)",
    "created_at": "2021-07-13T20:48:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518629",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@trevorkarn](#comment:8):
> Thank you for the explanation. That makes sense. I understand why hashing behavior is needed for my desired use-case, but could you explain why equality behavior would be needed?

That's just a python thing: hashable objects must be comparable for equality, and items that compare equal should have identical hashes. Without that, dictionary lookup and sets don't work properly (and hashable objects must play nice with sets and dictionaries -- that's what hashing is for). Because hash and equality need to be coordinated, it's normally not even possible in python to inherit one but not the other.

(sage actually violates the python hash contract, because `1 == GF(5)(1) == 6`. This causes trouble, but it is required to have `==` work properly with coercion, which was felt important for a CAS)



---

archive/issue_comments_518630.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThat makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error \n\n```div\n  {{{\nTypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be \ncombined with @richcmp_method\n  }}}\n```\n\nDoes that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?",
    "created_at": "2021-07-13T22:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518630",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:11" align="right">comment:11</div>

That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error 

```div
  {{{
TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be 
combined with @richcmp_method
  }}}
```

Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?



---

archive/issue_comments_518631.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22\">d2f7011</a></td><td><code>Add test for __hash__</code></td></tr></table>\n",
    "created_at": "2021-07-13T22:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518631",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22">d2f7011</a></td><td><code>Add test for __hash__</code></td></tr></table>




---

archive/issue_comments_518632.json:
```json
{
    "body": "Changed commit from **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)** to **[`d2f7011`](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)**",
    "created_at": "2021-07-13T22:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518632",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0cdd853`](https://github.com/sagemath/sagetrac-mirror/commit/0cdd853d451b14249211b1e3586be4ddcf7bdb35)** to **[`d2f7011`](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)**



---

archive/issue_events_444037.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T22:25:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444037"
}
```



---

archive/issue_events_444038.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-13T22:25:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444038"
}
```



---

archive/issue_comments_518633.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@trevorkarn](#comment:11):\n> That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error \n> \n> ```div\n>   {{{\n> TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be \n> combined with @richcmp_method\n>   }}}\n> ```\n> \n> Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?\n\nYes, that's correct. The `_richcmp_` covers all comparison operators, in particular `==`.\n\nI would propose a slightly different hash function:\n\n```python\ndef __hash__(self):\n    return hash((self._group, self.values())\n```\nThese are the two things that are checked for equality, but you get distinct hashes for all of the class functions. Right now, all class functions have the same repr, so they all have the same hash (which is less than ideal).\n\nIt might also be good to put the `__hash__` method below the `__richcmp__` as typically the `__init__` is the first method.",
    "created_at": "2021-07-14T02:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518633",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@trevorkarn](#comment:11):
> That makes sense thanks. `ClassFunction_gap` already has `@richcmp_method` so when I try to implement `__eq__`, I get the error 
> 
> ```div
>   {{{
> TypeError: class <class 'sage.groups.class_function.ClassFunction_gap'> defines __eq__ which cannot be 
> combined with @richcmp_method
>   }}}
> ```
> 
> Does that mean that I don't need to implement an `__eq__` and it suffices to implement just a hash?

Yes, that's correct. The `_richcmp_` covers all comparison operators, in particular `==`.

I would propose a slightly different hash function:

```python
def __hash__(self):
    return hash((self._group, self.values())
```
These are the two things that are checked for equality, but you get distinct hashes for all of the class functions. Right now, all class functions have the same repr, so they all have the same hash (which is less than ideal).

It might also be good to put the `__hash__` method below the `__richcmp__` as typically the `__init__` is the first method.



---

archive/issue_events_444039.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T12:02:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444039"
}
```



---

archive/issue_events_444040.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T12:02:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444040"
}
```



---

archive/issue_comments_518634.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4\">6834c91</a></td><td><code>Base `__hash__` off of self._group, self.values()</code></td></tr></table>\n",
    "created_at": "2021-07-14T15:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518634",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4">6834c91</a></td><td><code>Base `__hash__` off of self._group, self.values()</code></td></tr></table>




---

archive/issue_comments_518635.json:
```json
{
    "body": "Changed commit from **[`d2f7011`](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)** to **[`6834c91`](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)**",
    "created_at": "2021-07-14T15:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518635",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2f7011`](https://github.com/sagemath/sagetrac-mirror/commit/d2f701149d765e18eb37fc5956dd3058b610be22)** to **[`6834c91`](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)**



---

archive/issue_events_444041.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T15:45:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444041"
}
```



---

archive/issue_events_444042.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2021-07-14T15:45:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444042"
}
```



---

archive/issue_comments_518636.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.\n+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.\n``````\n",
    "created_at": "2021-07-14T15:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518636",
    "user": "https://github.com/trevorkarn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` and `ClassFunction_libgap` so it can be used as an input to a function.
+It is still a to-do item to put `ClassFunction`s into the category framework. In the meantime add `__hash__` to `ClassFunction_gap` so it can be used as an input to a function.
``````




---

archive/issue_comments_518637.json:
```json
{
    "body": "Changed commit from **[`6834c91`](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)** to **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**",
    "created_at": "2021-07-14T23:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518637",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6834c91`](https://github.com/sagemath/sagetrac-mirror/commit/6834c91fbe9d19b8ec3a13e377a64a85d94db7d4)** to **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**



---

archive/issue_comments_518638.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a\">cdd59ab</a></td><td><code>Remove .values()</code></td></tr></table>\n",
    "created_at": "2021-07-14T23:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518638",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a">cdd59ab</a></td><td><code>Remove .values()</code></td></tr></table>




---

archive/issue_comments_518639.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nLGTM. Thank you.",
    "created_at": "2021-07-14T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518639",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

LGTM. Thank you.



---

archive/issue_comments_518640.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-07-14T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518640",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_444043.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-14T23:16:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444043"
}
```



---

archive/issue_events_444044.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-14T23:16:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444044"
}
```



---

archive/issue_events_444045.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-24T15:27:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444045"
}
```



---

archive/issue_events_444046.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "064f0c6c6b2e2457ef911810311b4e090d297b26",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-07-24T15:27:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32190#event-444046"
}
```



---

archive/issue_comments_518641.json:
```json
{
    "body": "Changed branch from **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)** to **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**",
    "created_at": "2021-07-24T15:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32190#issuecomment-518641",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tkarn/class_function_hash-32190](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/class_function_hash-32190)** to **[`cdd59ab`](https://github.com/sagemath/sagetrac-mirror/commit/cdd59ab74c88fe95d8e19aab6d0495ab74a9050a)**
