# Issue 32913: Revert #32713 (Apply "configure --enable-editable" to other packages) for sage-conf, sage-setup

archive/issues_032676.json:
```json
{
    "body": "(from #32713#comment:11)\n\nUsers need the wheel of **sage-conf** when creating venvs. And we need the wheels of packages **sage-conf** and **sage-setup** when testing distributions using `./sage -sh -c '(cd pkgs/sagemath-standard && tox -v -v -v -e python-sagewheels-nopypi)'` and similar - as documented in the developer's guide as of #32899.\n\nUntil editable wheels (PEP 660) are implemented in **setuptools** (or we switch the distributions to another build system that implements PEP 660 such as **flit**), we revert the change made in #32713 for these packages.\n\nBut we keep **sage-docbuild** editable.\n\n\n\nCC:  @tobiasdiez @kwankyu\n\nBranch: public/build/trac_editable\n\nStatus: needs_review\n\nCommit: 2a302097ca6764d8305667f93f074609b76a32f1\n\nIssue created by migration from https://trac.sagemath.org/ticket/32913\n\n",
    "created_at": "2021-11-20T19:15:42Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Revert #32713 (Apply \"configure --enable-editable\" to other packages) for sage-conf, sage-setup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32913",
    "user": "https://github.com/mkoeppe"
}
```
(from #32713#comment:11)

Users need the wheel of **sage-conf** when creating venvs. And we need the wheels of packages **sage-conf** and **sage-setup** when testing distributions using `./sage -sh -c '(cd pkgs/sagemath-standard && tox -v -v -v -e python-sagewheels-nopypi)'` and similar - as documented in the developer's guide as of #32899.

Until editable wheels (PEP 660) are implemented in **setuptools** (or we switch the distributions to another build system that implements PEP 660 such as **flit**), we revert the change made in #32713 for these packages.

But we keep **sage-docbuild** editable.



CC:  @tobiasdiez @kwankyu

Branch: public/build/trac_editable

Status: needs_review

Commit: 2a302097ca6764d8305667f93f074609b76a32f1

Issue created by migration from https://trac.sagemath.org/ticket/32913





---

archive/issue_comments_465653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-20T19:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465653",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465654.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2021-11-20T19:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465654",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_465655.json:
```json
{
    "body": "<a id='comment:4'></a>Can you please expand on why this leads to problems? For example, end-users should normally not use  an editable install anyway, neither should the build process for the wheels on ci. For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.\n\nI would fine it confusing if `make --enable-editable-install` installs some packages in editable mode and others not.",
    "created_at": "2021-11-21T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465655",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'></a>Can you please expand on why this leads to problems? For example, end-users should normally not use  an editable install anyway, neither should the build process for the wheels on ci. For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.

I would fine it confusing if `make --enable-editable-install` installs some packages in editable mode and others not.



---

archive/issue_comments_465656.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 gh-tobiasdiez]:\n> For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.\n\n\nPlease take a look at `pkgs/sagemath-standard/tox.ini`, then you'll see what it does...",
    "created_at": "2021-11-21T18:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465656",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Replying to [comment:4 gh-tobiasdiez]:
> For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.


Please take a look at `pkgs/sagemath-standard/tox.ini`, then you'll see what it does...



---

archive/issue_comments_465657.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 gh-tobiasdiez]:\n> I would fine it confusing if `configure --enable-editable` installs some packages in editable mode and others not. \n\n\nHasn't confused anyone so far...",
    "created_at": "2021-11-21T18:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465657",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Replying to [comment:4 gh-tobiasdiez]:
> I would fine it confusing if `configure --enable-editable` installs some packages in editable mode and others not. 


Hasn't confused anyone so far...



---

archive/issue_comments_465658.json:
```json
{
    "body": "<a id='comment:7'></a>Also note that `configure --help` explains:\n\n```\n  --enable-editable       use an editable install of the Sage library\n```",
    "created_at": "2021-11-21T19:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465658",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Also note that `configure --help` explains:

```
  --enable-editable       use an editable install of the Sage library
```



---

archive/issue_comments_465659.json:
```json
{
    "body": "<a id='comment:9'></a>Sorry, but I still don't understand why you need to build and use wheels for sage packages if all of them use editable installs. Why can one not install them (as editable) in the tox environments?\n\nFor example, something along the following lines (in src/tox):\n\n```\n[testenv]\nusedevelop=True # Instruct tox to use editable install of main sagemath package\ndeps=\n  --editable=file:///{toxinidir}/../path/to/sage_conf # Install sage-conf as editable install\n```\n\nPotentially combined with a custom `install_command` that invokes pip with `find-links` to discover the wheels of other dependencies that are build during `make`.",
    "created_at": "2021-12-06T17:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465659",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Sorry, but I still don't understand why you need to build and use wheels for sage packages if all of them use editable installs. Why can one not install them (as editable) in the tox environments?

For example, something along the following lines (in src/tox):

```
[testenv]
usedevelop=True # Instruct tox to use editable install of main sagemath package
deps=
  --editable=file:///{toxinidir}/../path/to/sage_conf # Install sage-conf as editable install
```

Potentially combined with a custom `install_command` that invokes pip with `find-links` to discover the wheels of other dependencies that are build during `make`.



---

archive/issue_comments_465660.json:
```json
{
    "body": "<a id='comment:10'></a>That could be implemented but it is not implemented.",
    "created_at": "2021-12-06T17:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465660",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>That could be implemented but it is not implemented.



---

archive/issue_comments_465661.json:
```json
{
    "body": "<a id='comment:11'></a>And the installation procedure would also be more difficult to document than just to say \"install all wheels from ...\".",
    "created_at": "2021-12-06T17:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465661",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>And the installation procedure would also be more difficult to document than just to say "install all wheels from ...".



---

archive/issue_comments_465662.json:
```json
{
    "body": "<a id='comment:12'></a>#32616 may be a way to resolve this",
    "created_at": "2021-12-06T18:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465662",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>#32616 may be a way to resolve this



---

archive/issue_comments_465663.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:10 mkoeppe]:\n> That could be implemented but it is not implemented.\n\n\nI would strongly prefer that over reverting something that works in principle. I'll have a look the coming days and create a prototype.",
    "created_at": "2021-12-06T20:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465663",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>Replying to [comment:10 mkoeppe]:
> That could be implemented but it is not implemented.


I would strongly prefer that over reverting something that works in principle. I'll have a look the coming days and create a prototype.



---

archive/issue_comments_465664.json:
```json
{
    "body": "<a id='comment:14'></a>Any progress on this?",
    "created_at": "2021-12-12T18:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465664",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Any progress on this?



---

archive/issue_comments_465665.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-19T16:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465665",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_465666.json:
```json
{
    "body": "<a id='comment:15'></a>With the new branch `public/build/trac_editable` you can run `tox -e py38` (or 39) from the `src` folder and get a tox environment with editable installs of sagemath-standard and sage-conf. Some of the tests are failing (because gap and blas are not using sage-conf but determine stuff at runtime during env variables) and there might be a more elegant way to set the env variables but as a prototype this should suffice.\n\n---\nNew commits:",
    "created_at": "2021-12-19T16:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465666",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>With the new branch `public/build/trac_editable` you can run `tox -e py38` (or 39) from the `src` folder and get a tox environment with editable installs of sagemath-standard and sage-conf. Some of the tests are failing (because gap and blas are not using sage-conf but determine stuff at runtime during env variables) and there might be a more elegant way to set the env variables but as a prototype this should suffice.

---
New commits:



---

archive/issue_comments_465667.json:
```json
{
    "body": "<a id='comment:16'></a>This branch doesn't fix what is described in the ticket description",
    "created_at": "2021-12-19T19:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465667",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>This branch doesn't fix what is described in the ticket description



---

archive/issue_comments_465668.json:
```json
{
    "body": "<a id='comment:17'></a>Maybe not (as I said above in comment 4 I don't quite get what your problem is). But it shows how to use editable installs with tox and thus provides a way around the problem \"we need the wheels of packages sage-conf and sage-setup when testing distributions [with tox]\". Also it was meant as a prototype not as a complete solution.",
    "created_at": "2021-12-19T19:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465668",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>Maybe not (as I said above in comment 4 I don't quite get what your problem is). But it shows how to use editable installs with tox and thus provides a way around the problem "we need the wheels of packages sage-conf and sage-setup when testing distributions [with tox]". Also it was meant as a prototype not as a complete solution.



---

archive/issue_comments_465669.json:
```json
{
    "body": "<a id='comment:18'></a>Well we are in the release phase for Sage 9.5 and can't merge \"prototypes\"",
    "created_at": "2021-12-19T22:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465669",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Well we are in the release phase for Sage 9.5 and can't merge "prototypes"



---

archive/issue_events_086984.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:44:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32913#event-86984"
}
```



---

archive/issue_comments_465670.json:
```json
{
    "body": "<a id='comment:19'></a>Set milestone to sage-9.6 after Sage 9.5 release.",
    "created_at": "2022-01-30T15:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465670",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'></a>Set milestone to sage-9.6 after Sage 9.5 release.



---

archive/issue_events_086985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32913#event-86985"
}
```



---

archive/issue_events_086986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32913#event-86986"
}
```



---

archive/issue_events_086987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-06T22:12:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32913#event-86987"
}
```



---

archive/issue_events_086988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-06T22:12:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32913#event-86988"
}
```



---

archive/issue_comments_465671.json:
```json
{
    "body": "<a id='comment:21'></a>I have a different solution in #33817",
    "created_at": "2022-05-06T22:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465671",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>I have a different solution in #33817



---

archive/issue_comments_465672.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-06T22:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32913#issuecomment-465672",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.
