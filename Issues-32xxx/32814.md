# Issue 32814: Add method extend_basis to CombinatorialFreeModule

archive/issues_032577.json:
```json
{
    "assignees": [],
    "body": "Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted finite-dimension module and the module with additional user-submitted basis elements added.\n\nhttps://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis\n\nCC:  @tscrim @nthiery\n\nKeywords: **CombinatorialFreeModule**\n\nBranch/Commit: **[public/32814](https://github.com/sagemath/sagetrac-mirror/tree/public/32814) @ [`3dd8543`](https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189)**\n\nAuthor: **Louis Ng**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32814_\n\n",
    "created_at": "2021-11-02T16:19:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add method extend_basis to CombinatorialFreeModule",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/32814",
    "user": "https://github.com/louisng114"
}
```
Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted finite-dimension module and the module with additional user-submitted basis elements added.

https://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis

CC:  @tscrim @nthiery

Keywords: **CombinatorialFreeModule**

Branch/Commit: **[public/32814](https://github.com/sagemath/sagetrac-mirror/tree/public/32814) @ [`3dd8543`](https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189)**

Author: **Louis Ng**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/32814_





---

archive/issue_events_448543.json:
```json
{
    "actor": "https://github.com/louisng114",
    "created_at": "2021-11-02T16:19:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448543"
}
```



---

archive/issue_events_448544.json:
```json
{
    "actor": "https://github.com/louisng114",
    "created_at": "2021-11-02T16:19:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448544"
}
```



---

archive/issue_events_448545.json:
```json
{
    "actor": "https://github.com/louisng114",
    "created_at": "2021-11-02T16:19:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448545"
}
```



---

archive/issue_events_448546.json:
```json
{
    "actor": "https://github.com/louisng114",
    "created_at": "2021-11-02T16:19:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448546"
}
```



---

archive/issue_comments_529586.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Add method extend_basis to CombinatorialFreeModule which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.\n+Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.\n \n https://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis\n``````\n",
    "created_at": "2021-11-08T21:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529586",
    "user": "https://github.com/louisng114"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Add method extend_basis to CombinatorialFreeModule which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.
+Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.
 
 https://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis
``````




---

archive/issue_comments_529587.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189\"><code>3dd8543</code></a></td><td><code>added extend_basis to free_module.py</code></td></tr></table>\n",
    "created_at": "2021-11-08T21:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529587",
    "user": "https://github.com/louisng114"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189"><code>3dd8543</code></a></td><td><code>added extend_basis to free_module.py</code></td></tr></table>




---

archive/issue_comments_529588.json:
```json
{
    "body": "Branch: **[public/32814](https://github.com/sagemath/sagetrac-mirror/tree/public/32814)**",
    "created_at": "2021-11-08T21:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529588",
    "user": "https://github.com/louisng114"
}
```

Branch: **[public/32814](https://github.com/sagemath/sagetrac-mirror/tree/public/32814)**



---

archive/issue_comments_529589.json:
```json
{
    "body": "Commit: **[`3dd8543`](https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189)**",
    "created_at": "2021-11-08T21:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529589",
    "user": "https://github.com/louisng114"
}
```

Commit: **[`3dd8543`](https://github.com/sagemath/sagetrac-mirror/commit/3dd8543434b5325305cd2edfe6f9d4e3dfd46189)**



---

archive/issue_comments_529590.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThank you for this contribution. This could be a very useful addition. I know it is not yet set to needs review, but have some quick comments from a quick reading.\n\nI am generally -1 to renaming the variables as it violates the principle of least surprise and is usually very brittle. You need to explicitly describe what happens if we decide to continue in this way. However, I am not convinced this is the correct behavior. Can you justify why you are renaming things rather than dropping them. In particular, submodule behavior differs from the top-level. I also feel it should be consistent.\n\nThis also will not work with infinite dimensional modules. Not that it needs to, but this needs to be documented at least.",
    "created_at": "2021-11-09T06:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529590",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

Thank you for this contribution. This could be a very useful addition. I know it is not yet set to needs review, but have some quick comments from a quick reading.

I am generally -1 to renaming the variables as it violates the principle of least surprise and is usually very brittle. You need to explicitly describe what happens if we decide to continue in this way. However, I am not convinced this is the correct behavior. Can you justify why you are renaming things rather than dropping them. In particular, submodule behavior differs from the top-level. I also feel it should be consistent.

This also will not work with infinite dimensional modules. Not that it needs to, but this needs to be documented at least.



---

archive/issue_comments_529591.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@tscrim](#comment:3):\n> Thank you for this contribution. This could be a very useful addition. I know it is not yet set to needs review, but have some quick comments from a quick reading.\n> \n> I am generally -1 to renaming the variables as it violates the principle of least surprise and is usually very brittle. You need to explicitly describe what happens if we decide to continue in this way. However, I am not convinced this is the correct behavior. Can you justify why you are renaming things rather than dropping them. In particular, submodule behavior differs from the top-level. I also feel it should be consistent.\n> \n> This also will not work with infinite dimensional modules. Not that it needs to, but this needs to be documented at least.\n\nThank you for your response.\n\nSagemath automatically renames the basis when submodules are taken, so there is no way to get around that if the user submits a submodule. However, if the variable is lifted, it does have the intended names. For example, When making a 2-dimensional submodule of a module with basis x, y, z, Sage renames the indices to 0 and 1. If the user submits this submodule and wants to extend this by a, b, c, then the returned submodule would have basis indices 0, 1, 2, 3, 4, where 2, 3, 4 are lifted to a, b, c respectively.\n\nAs for the specifying that it does not work with infinitely dimensional module, I agree.",
    "created_at": "2021-11-09T18:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529591",
    "user": "https://github.com/louisng114"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@tscrim](#comment:3):
> Thank you for this contribution. This could be a very useful addition. I know it is not yet set to needs review, but have some quick comments from a quick reading.
> 
> I am generally -1 to renaming the variables as it violates the principle of least surprise and is usually very brittle. You need to explicitly describe what happens if we decide to continue in this way. However, I am not convinced this is the correct behavior. Can you justify why you are renaming things rather than dropping them. In particular, submodule behavior differs from the top-level. I also feel it should be consistent.
> 
> This also will not work with infinite dimensional modules. Not that it needs to, but this needs to be documented at least.

Thank you for your response.

Sagemath automatically renames the basis when submodules are taken, so there is no way to get around that if the user submits a submodule. However, if the variable is lifted, it does have the intended names. For example, When making a 2-dimensional submodule of a module with basis x, y, z, Sage renames the indices to 0 and 1. If the user submits this submodule and wants to extend this by a, b, c, then the returned submodule would have basis indices 0, 1, 2, 3, 4, where 2, 3, 4 are lifted to a, b, c respectively.

As for the specifying that it does not work with infinitely dimensional module, I agree.



---

archive/issue_comments_529592.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.\n+Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted finite-dimension module and the module with additional user-submitted basis elements added.\n \n https://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis\n``````\n",
    "created_at": "2021-11-09T18:28:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529592",
    "user": "https://github.com/louisng114"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted module and the module with additional user-submitted basis elements added.
+Add method extend_basis to `CombinatorialFreeModule` which constructs the canonical morphism between the user-submitted finite-dimension module and the module with additional user-submitted basis elements added.
 
 https://github.com/louisng114/SageMath_CombinatorialFreeModule_extend_basis
``````




---

archive/issue_comments_529593.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think the submodules is a non sequitur because you are constructing a new basis that you have (in principle) no control over the size or the relation to the original basis, so you cannot do better as you said. Also, if you pass something you know is a basis, then you do set the indices.\n\nThis case is different. You are introducing an inconsistency here: ambient modules are treated differently than something that knows it is a submodule. What is the mathematical operation you want to implement here? Is it a direct sum, which is what the case for the ambient module is, or is it the sum of two subspaces, which is what I think the submodule case does. Furthermore, for the submodule case, it seems like you want to add something to a basis you already have and explicitly set a basis, so you should just discard the basis elements already in the span of what you have (processed inductively to make the operation canonical). However, things will be clarified if you define precisely what you want to model.",
    "created_at": "2021-11-10T09:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529593",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

I think the submodules is a non sequitur because you are constructing a new basis that you have (in principle) no control over the size or the relation to the original basis, so you cannot do better as you said. Also, if you pass something you know is a basis, then you do set the indices.

This case is different. You are introducing an inconsistency here: ambient modules are treated differently than something that knows it is a submodule. What is the mathematical operation you want to implement here? Is it a direct sum, which is what the case for the ambient module is, or is it the sum of two subspaces, which is what I think the submodule case does. Furthermore, for the submodule case, it seems like you want to add something to a basis you already have and explicitly set a basis, so you should just discard the basis elements already in the span of what you have (processed inductively to make the operation canonical). However, things will be clarified if you define precisely what you want to model.



---

archive/issue_comments_529594.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHello!\n\nI did not look in details, so am not sure of the exact use case. \nSo just asking: could the desired functionality be achieved with\nthe current cartesian product construction (or improving it if needed)?\n\n```\nsage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\nsage: G = CombinatorialFreeModule(QQ, ['i','j','k'])\nsage: FG = cartesian_product([F, G])\nsage: FG.basis().keys()\nDisjoint union of Family ({'a', 'b', 'c'}, {'i', 'j', 'k'})\nsage: phi = FG.cartesian_embedding(0)\nsage: phi(F.an_element())\n2*B[(0, 'a')] + 2*B[(0, 'b')] + 3*B[(0, 'c')]\n```\n\nCheers,",
    "created_at": "2021-11-10T10:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529594",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:7" align="right">comment:7</div>

Hello!

I did not look in details, so am not sure of the exact use case. 
So just asking: could the desired functionality be achieved with
the current cartesian product construction (or improving it if needed)?

```
sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
sage: G = CombinatorialFreeModule(QQ, ['i','j','k'])
sage: FG = cartesian_product([F, G])
sage: FG.basis().keys()
Disjoint union of Family ({'a', 'b', 'c'}, {'i', 'j', 'k'})
sage: phi = FG.cartesian_embedding(0)
sage: phi(F.an_element())
2*B[(0, 'a')] + 2*B[(0, 'b')] + 3*B[(0, 'c')]
```

Cheers,



---

archive/issue_comments_529595.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nShould there be a coercion map from `CombinatorialFreeModule(QQ, ['a'])` to `CombinatorialFreeModule(QQ, ['a', 'b'])`?",
    "created_at": "2021-11-10T16:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529595",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Should there be a coercion map from `CombinatorialFreeModule(QQ, ['a'])` to `CombinatorialFreeModule(QQ, ['a', 'b'])`?



---

archive/issue_comments_529596.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks Matthias for the suggestion.\n\nFreeModule is meant to be subclassed to produce parents\nwhich may have additional structure which may not be\npreserved by the trivial linear map. For example,\nwe have a dozen of different realizations of the algebra\nof symmetric functions which all share the same basis and\nwhich are isomorphic (available as coercions); but these\nisomorphisms are non trivial.\n\nIf we would add such a coercion, we would need to make\nsure that it is not inherited which gets tricky.\n\nIn general: it's easy to add a coercion; hard to remove\nan existing one. So my preferred approach is to be\nvery conservative in defining coercions by default,\nand instead make it as trivial as possible for the user \nto add these that he cares about.",
    "created_at": "2021-11-11T07:33:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529596",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks Matthias for the suggestion.

FreeModule is meant to be subclassed to produce parents
which may have additional structure which may not be
preserved by the trivial linear map. For example,
we have a dozen of different realizations of the algebra
of symmetric functions which all share the same basis and
which are isomorphic (available as coercions); but these
isomorphisms are non trivial.

If we would add such a coercion, we would need to make
sure that it is not inherited which gets tricky.

In general: it's easy to add a coercion; hard to remove
an existing one. So my preferred approach is to be
very conservative in defining coercions by default,
and instead make it as trivial as possible for the user 
to add these that he cares about.



---

archive/issue_comments_529597.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@tscrim](#comment:6):\n> I think the submodules is a non sequitur because you are constructing a new basis that you have (in principle) no control over the size or the relation to the original basis, so you cannot do better as you said. Also, if you pass something you know is a basis, then you do set the indices.\n> \n> This case is different. You are introducing an inconsistency here: ambient modules are treated differently than something that knows it is a submodule. What is the mathematical operation you want to implement here? Is it a direct sum, which is what the case for the ambient module is, or is it the sum of two subspaces, which is what I think the submodule case does. Furthermore, for the submodule case, it seems like you want to add something to a basis you already have and explicitly set a basis, so you should just discard the basis elements already in the span of what you have (processed inductively to make the operation canonical). However, things will be clarified if you define precisely what you want to model.\n\nI am not sure I understand the inconsistency. The method goes to the top level, add new basis elements, and drops back down using the information gathered while climbing up.",
    "created_at": "2021-11-13T20:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529597",
    "user": "https://github.com/louisng114"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@tscrim](#comment:6):
> I think the submodules is a non sequitur because you are constructing a new basis that you have (in principle) no control over the size or the relation to the original basis, so you cannot do better as you said. Also, if you pass something you know is a basis, then you do set the indices.
> 
> This case is different. You are introducing an inconsistency here: ambient modules are treated differently than something that knows it is a submodule. What is the mathematical operation you want to implement here? Is it a direct sum, which is what the case for the ambient module is, or is it the sum of two subspaces, which is what I think the submodule case does. Furthermore, for the submodule case, it seems like you want to add something to a basis you already have and explicitly set a basis, so you should just discard the basis elements already in the span of what you have (processed inductively to make the operation canonical). However, things will be clarified if you define precisely what you want to model.

I am not sure I understand the inconsistency. The method goes to the top level, add new basis elements, and drops back down using the information gathered while climbing up.



---

archive/issue_comments_529598.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@nthiery](#comment:7):\n> Hello!\n> \n> I did not look in details, so am not sure of the exact use case. \n> So just asking: could the desired functionality be achieved with\n> the current cartesian product construction (or improving it if needed)?\n> \n> ```\n> sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n> sage: G = CombinatorialFreeModule(QQ, ['i','j','k'])\n> sage: FG = cartesian_product([F, G])\n> sage: FG.basis().keys()\n> Disjoint union of Family ({'a', 'b', 'c'}, {'i', 'j', 'k'})\n> sage: phi = FG.cartesian_embedding(0)\n> sage: phi(F.an_element())\n> 2*B[(0, 'a')] + 2*B[(0, 'b')] + 3*B[(0, 'c')]\n> ```\n> \n> Cheers,\n\nThe module from extend_basis would have a cleaner basis. For example, as I am working on #29806, I want to add the needed basis elements (if necessary) and reference specific basis elements without needing to check whether or not it is a product.",
    "created_at": "2021-11-13T21:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529598",
    "user": "https://github.com/louisng114"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@nthiery](#comment:7):
> Hello!
> 
> I did not look in details, so am not sure of the exact use case. 
> So just asking: could the desired functionality be achieved with
> the current cartesian product construction (or improving it if needed)?
> 
> ```
> sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
> sage: G = CombinatorialFreeModule(QQ, ['i','j','k'])
> sage: FG = cartesian_product([F, G])
> sage: FG.basis().keys()
> Disjoint union of Family ({'a', 'b', 'c'}, {'i', 'j', 'k'})
> sage: phi = FG.cartesian_embedding(0)
> sage: phi(F.an_element())
> 2*B[(0, 'a')] + 2*B[(0, 'b')] + 3*B[(0, 'c')]
> ```
> 
> Cheers,

The module from extend_basis would have a cleaner basis. For example, as I am working on #29806, I want to add the needed basis elements (if necessary) and reference specific basis elements without needing to check whether or not it is a product.



---

archive/issue_comments_529599.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@louisng114](#comment:10):\n>\n> I am not sure I understand the inconsistency. The method goes to the top level, add new basis elements, and drops back down using the information gathered while climbing up.\n\nIf that's the case, then it sounds like a direct sum. When forming `A (+) B`, it does not care about how the module `A` was constructed. Contrast this with taking the union. Is the union more of the behavior you want, so repeated indices are discarded? How the basis elements are indexed should not matter on if it is an ambient module or a submodule, no matter if you mean direct sum or union. The only thing is matters is what does an element indexed by `X` mean? Is it meant to always be something in the ambient module?\n\nAs an example, consider `A = span{X,Y}`, where this means the basis elements of `A` are `b_X` and `b_Y`. Then take a 1 dimensional submodule `B = span{Z} < A`, where `b_Z` is some vector in `A`. What happens when I extend the basis of `A` and `B` by `{W}`, by `{X}`, and by `{Z}`? The first case is easy, it just adds the basis element. In the `{X}` case, I would think it would be a no-op in both cases if you mean union (the direct sum case would be a disjoint union). The `{Z}` case is the interesting one.\n\nThis does bring up another question when starting with a submodule: Should we also create the other ambient module and the returned module as a submodule or just a brand-new module? If the former, then should there also be a coercion between the ambient modules? My thought is actually we should just create a brand new module as a module without an ambient one (at least by default). My reasoning is this: you are simply building a new module and if you wanted a submodule, you could extend the ambient one and then build a submodule from that.",
    "created_at": "2021-11-15T08:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32814#issuecomment-529599",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@louisng114](#comment:10):
>
> I am not sure I understand the inconsistency. The method goes to the top level, add new basis elements, and drops back down using the information gathered while climbing up.

If that's the case, then it sounds like a direct sum. When forming `A (+) B`, it does not care about how the module `A` was constructed. Contrast this with taking the union. Is the union more of the behavior you want, so repeated indices are discarded? How the basis elements are indexed should not matter on if it is an ambient module or a submodule, no matter if you mean direct sum or union. The only thing is matters is what does an element indexed by `X` mean? Is it meant to always be something in the ambient module?

As an example, consider `A = span{X,Y}`, where this means the basis elements of `A` are `b_X` and `b_Y`. Then take a 1 dimensional submodule `B = span{Z} < A`, where `b_Z` is some vector in `A`. What happens when I extend the basis of `A` and `B` by `{W}`, by `{X}`, and by `{Z}`? The first case is easy, it just adds the basis element. In the `{X}` case, I would think it would be a no-op in both cases if you mean union (the direct sum case would be a disjoint union). The `{Z}` case is the interesting one.

This does bring up another question when starting with a submodule: Should we also create the other ambient module and the returned module as a submodule or just a brand-new module? If the former, then should there also be a coercion between the ambient modules? My thought is actually we should just create a brand new module as a module without an ambient one (at least by default). My reasoning is this: you are simply building a new module and if you wanted a submodule, you could extend the ambient one and then build a submodule from that.



---

archive/issue_events_448547.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448547"
}
```



---

archive/issue_events_448548.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448548"
}
```



---

archive/issue_events_448549.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448549"
}
```



---

archive/issue_events_448550.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448550"
}
```



---

archive/issue_events_448551.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448551"
}
```



---

archive/issue_events_448552.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448552"
}
```



---

archive/issue_events_448553.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448553"
}
```



---

archive/issue_events_448554.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32814",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32814#event-448554"
}
```
