# Issue 32099: Update database_knotinfo to 2021.9.1, fix file-cache location

archive/issues_031862.json:
```json
{
    "body": "In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.\n\nFurthermore, an upgrade to the official release 2021.9.1 of the PyPI-package will be done.\n\nThe original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release was [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).\n\nThis upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).\n\n\n\nCC:  @kiwifb\n\nKeywords: database knotinfo\n\nBranch/Commit: ce89457d6fb8400d94e1f200ef5bdc59eb787b5f\n\nReviewer: Matthias Koeppe\n\nAuthor: Sebastian Oehms\n\nDependencies: #32344\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32099\n\n",
    "closed_at": "2021-09-15T22:06:11Z",
    "created_at": "2021-07-02T16:26:37Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Update database_knotinfo to 2021.9.1, fix file-cache location",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32099",
    "user": "https://github.com/soehms"
}
```
In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.

Furthermore, an upgrade to the official release 2021.9.1 of the PyPI-package will be done.

The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release was [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).

This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).



CC:  @kiwifb

Keywords: database knotinfo

Branch/Commit: ce89457d6fb8400d94e1f200ef5bdc59eb787b5f

Reviewer: Matthias Koeppe

Author: Sebastian Oehms

Dependencies: #32344

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32099





---

archive/issue_comments_638964.json:
```json
{
    "body": "Changing branch from \"\" to \"u/soehms/knotinfo_update_32099\"",
    "created_at": "2021-07-02T16:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638964",
    "user": "https://github.com/soehms"
}
```

Changing branch from "" to "u/soehms/knotinfo_update_32099"



---

archive/issue_comments_638965.json:
```json
{
    "body": "Changing commit from \"\" to \"514c714bcc8a703691dbe50acaadb40cc75ba633\"",
    "created_at": "2021-07-02T16:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638965",
    "user": "https://github.com/soehms"
}
```

Changing commit from "" to "514c714bcc8a703691dbe50acaadb40cc75ba633"



---

archive/issue_comments_638966.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-02T16:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638966",
    "user": "https://github.com/soehms"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_638967.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-07-02T16:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638967",
    "user": "https://github.com/soehms"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_638968.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-07-02T16:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638968",
    "user": "https://github.com/soehms"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_638969.json:
```json
{
    "body": "<a id='comment:4'></a>I don't think the spkg-install should be in charge of clearing things in the user's .sage directory. This won't work in multi-user installations. This needs a better solution",
    "created_at": "2021-07-02T16:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638969",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>I don't think the spkg-install should be in charge of clearing things in the user's .sage directory. This won't work in multi-user installations. This needs a better solution



---

archive/issue_comments_638970.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:\n> I don't think the spkg-install should be in charge of clearing things in the user's .sage directory. This won't work in multi-user installations. This needs a better solution\n\n\nIndeed not. This was possibly overlooked as of non consequence on a multi-user install because it would only apply to the installing user's `DOT_SAGE`. But if cleaning is needed, it has to be done at runtime when the user starts sage or the specific functionality.",
    "created_at": "2021-07-02T20:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638970",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:
> I don't think the spkg-install should be in charge of clearing things in the user's .sage directory. This won't work in multi-user installations. This needs a better solution


Indeed not. This was possibly overlooked as of non consequence on a multi-user install because it would only apply to the installing user's `DOT_SAGE`. But if cleaning is needed, it has to be done at runtime when the user starts sage or the specific functionality.



---

archive/issue_comments_638971.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 fbissey]:\n>> Replying to [comment:4 mkoeppe]:\n\n\n> But if cleaning is needed, it has to be done at runtime when the user starts sage or the specific functionality.\n\n\nSure! I will do it next week.",
    "created_at": "2021-07-03T10:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638971",
    "user": "https://github.com/soehms"
}
```

<a id='comment:6'></a>Replying to [comment:5 fbissey]:
>> Replying to [comment:4 mkoeppe]:


> But if cleaning is needed, it has to be done at runtime when the user starts sage or the specific functionality.


Sure! I will do it next week.



---

archive/issue_comments_638972.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T10:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638972",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638973.json:
```json
{
    "body": "Changing commit from \"514c714bcc8a703691dbe50acaadb40cc75ba633\" to \"cdff7f68da62c0f50f78c9abe5d85833add8d369\"",
    "created_at": "2021-07-06T10:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638973",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "514c714bcc8a703691dbe50acaadb40cc75ba633" to "cdff7f68da62c0f50f78c9abe5d85833add8d369"



---

archive/issue_comments_638974.json:
```json
{
    "body": "<a id='comment:8'></a>An automatic refresh of the file-cache at runtime is already implemented. It is performed whenever the file `num_knots.sobj` in the file-cache directory is missing. Thus, the only thing to do is to add the version number to this file-name.",
    "created_at": "2021-07-06T10:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638974",
    "user": "https://github.com/soehms"
}
```

<a id='comment:8'></a>An automatic refresh of the file-cache at runtime is already implemented. It is performed whenever the file `num_knots.sobj` in the file-cache directory is missing. Thus, the only thing to do is to add the version number to this file-name.



---

archive/issue_comments_638975.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T10:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638976.json:
```json
{
    "body": "Changing commit from \"cdff7f68da62c0f50f78c9abe5d85833add8d369\" to \"e9965ee4f4ad5e9e0cf84354ab09d80df19f25d2\"",
    "created_at": "2021-07-06T10:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cdff7f68da62c0f50f78c9abe5d85833add8d369" to "e9965ee4f4ad5e9e0cf84354ab09d80df19f25d2"



---

archive/issue_comments_638977.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-08T22:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638977",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_638978.json:
```json
{
    "body": "<a id='comment:10'></a>This is not a good solution - let's please not re-introduce uses of `sage.misc.package` - this is specific to sage-the-distribution.\n\nI would suggest to instead query the version of the installed Python package using standard Python means: \n- either using a variable that your Python package `database_knotinfo` provides for this purpose\n- or using `importlib.metadata` https://docs.python.org/3/library/importlib.metadata.html",
    "created_at": "2021-07-08T22:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638978",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>This is not a good solution - let's please not re-introduce uses of `sage.misc.package` - this is specific to sage-the-distribution.

I would suggest to instead query the version of the installed Python package using standard Python means: 
- either using a variable that your Python package `database_knotinfo` provides for this purpose
- or using `importlib.metadata` https://docs.python.org/3/library/importlib.metadata.html



---

archive/issue_comments_638979.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-09T11:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638980.json:
```json
{
    "body": "Changing commit from \"e9965ee4f4ad5e9e0cf84354ab09d80df19f25d2\" to \"4f12b1b3f81eedf9aabc044fc0547f665c763c97\"",
    "created_at": "2021-07-09T11:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e9965ee4f4ad5e9e0cf84354ab09d80df19f25d2" to "4f12b1b3f81eedf9aabc044fc0547f665c763c97"



---

archive/issue_comments_638981.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:\n> This is not a good solution - let's please not re-introduce uses of `sage.misc.package` - this is specific to sage-the-distribution.\n> \n> I would suggest to instead query the version of the installed Python package using standard Python means: \n> - either using a variable that your Python package `database_knotinfo` provides for this purpose\n> - or using `importlib.metadata` https://docs.python.org/3/library/importlib.metadata.html\n\n\n\nThanks for the hint!",
    "created_at": "2021-07-09T11:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638981",
    "user": "https://github.com/soehms"
}
```

<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:
> This is not a good solution - let's please not re-introduce uses of `sage.misc.package` - this is specific to sage-the-distribution.
> 
> I would suggest to instead query the version of the installed Python package using standard Python means: 
> - either using a variable that your Python package `database_knotinfo` provides for this purpose
> - or using `importlib.metadata` https://docs.python.org/3/library/importlib.metadata.html



Thanks for the hint!



---

archive/issue_comments_638982.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-09T11:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638982",
    "user": "https://github.com/soehms"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_638983.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks for making this change. \n\nBecause we still support Python 3.7, I think this will need a `try...except` with fallback to using the backport package `importlib_metadata` (see https://importlib-metadata.readthedocs.io/en/latest/using.html)",
    "created_at": "2021-07-09T15:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638983",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Thanks for making this change. 

Because we still support Python 3.7, I think this will need a `try...except` with fallback to using the backport package `importlib_metadata` (see https://importlib-metadata.readthedocs.io/en/latest/using.html)



---

archive/issue_comments_638984.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T08:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638985.json:
```json
{
    "body": "Changing commit from \"4f12b1b3f81eedf9aabc044fc0547f665c763c97\" to \"b1e4f1311da5b8fd931ac823abe13eb040612c8b\"",
    "created_at": "2021-07-12T08:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638985",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4f12b1b3f81eedf9aabc044fc0547f665c763c97" to "b1e4f1311da5b8fd931ac823abe13eb040612c8b"



---

archive/issue_comments_638986.json:
```json
{
    "body": "<a id='comment:15'></a>Since I couldn't test with python 3.7 I started the [GitHub workflow tox-optional](https://github.com/soehms/sage/actions/runs/1020446425) instead.",
    "created_at": "2021-07-12T08:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638986",
    "user": "https://github.com/soehms"
}
```

<a id='comment:15'></a>Since I couldn't test with python 3.7 I started the [GitHub workflow tox-optional](https://github.com/soehms/sage/actions/runs/1020446425) instead.



---

archive/issue_comments_638987.json:
```json
{
    "body": "<a id='comment:16'></a>The `debian-buster-standard` run (which has system python 3.7) looks fine.",
    "created_at": "2021-07-12T17:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638987",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>The `debian-buster-standard` run (which has system python 3.7) looks fine.



---

archive/issue_comments_638988.json:
```json
{
    "body": "<a id='comment:17'></a>Testing locally, I am getting numerous doctest failures though:\n\n```\nFile \"src/sage/knots/link.py\", line 3931, in sage.knots.link.Link.is_isotopic\nFailed example:\n    from sage.knots.knotinfo import KnotInfo\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.knots.link.Link.is_isotopic[5]>\", line 1, in <module>\n        from sage.knots.knotinfo import KnotInfo\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/knotinfo.py\", line 2416, in <module>\n        KnotInfo = KnotInfoBase('KnotInfo', db.row_names())\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__\n        self.cache = f(self._instance)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py\", line 707, in row_names\n        row_dict = self.read_row_dict()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__\n        self.cache = f(self._instance)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py\", line 685, in read_row_dict\n        return load('%s/%s' %(sobj_path, filename))\n      File \"sage/misc/persist.pyx\", line 187, in sage.misc.persist.load\n        with open(filename, 'rb') as fobj:\n    FileNotFoundError: [Errno 2] No such file or directory: '/Users/mkoeppe/.sage/knotinfo/row_dict.sobj'\n```",
    "created_at": "2021-07-12T17:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638988",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Testing locally, I am getting numerous doctest failures though:

```
File "src/sage/knots/link.py", line 3931, in sage.knots.link.Link.is_isotopic
Failed example:
    from sage.knots.knotinfo import KnotInfo
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.knots.link.Link.is_isotopic[5]>", line 1, in <module>
        from sage.knots.knotinfo import KnotInfo
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/knotinfo.py", line 2416, in <module>
        KnotInfo = KnotInfoBase('KnotInfo', db.row_names())
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__
        self.cache = f(self._instance)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py", line 707, in row_names
        row_dict = self.read_row_dict()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__
        self.cache = f(self._instance)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py", line 685, in read_row_dict
        return load('%s/%s' %(sobj_path, filename))
      File "sage/misc/persist.pyx", line 187, in sage.misc.persist.load
        with open(filename, 'rb') as fobj:
    FileNotFoundError: [Errno 2] No such file or directory: '/Users/mkoeppe/.sage/knotinfo/row_dict.sobj'
```



---

archive/issue_comments_638989.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 mkoeppe]:\n> Testing locally, I am getting numerous doctest failures though: ....\n\n\nI've no idea where this could come from. Can you please say more about the test-case. Have there been error messages from the new method `version`? If so, can you please post them?",
    "created_at": "2021-07-14T06:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638989",
    "user": "https://github.com/soehms"
}
```

<a id='comment:18'></a>Replying to [comment:17 mkoeppe]:
> Testing locally, I am getting numerous doctest failures though: ....


I've no idea where this could come from. Can you please say more about the test-case. Have there been error messages from the new method `version`? If so, can you please post them?



---

archive/issue_comments_638990.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-16T06:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638991.json:
```json
{
    "body": "Changing commit from \"b1e4f1311da5b8fd931ac823abe13eb040612c8b\" to \"9b2000bc0a5406827aa4afaf4fbe590abb025e2b\"",
    "created_at": "2021-07-16T06:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b1e4f1311da5b8fd931ac823abe13eb040612c8b" to "9b2000bc0a5406827aa4afaf4fbe590abb025e2b"



---

archive/issue_comments_638992.json:
```json
{
    "body": "<a id='comment:20'></a>I think the first option of your suggestion in comment 10 is the better choice, since it can be implemented independent on the Python version. Thus, I'm switching to this solution, now.",
    "created_at": "2021-07-16T06:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638992",
    "user": "https://github.com/soehms"
}
```

<a id='comment:20'></a>I think the first option of your suggestion in comment 10 is the better choice, since it can be implemented independent on the Python version. Thus, I'm switching to this solution, now.



---

archive/issue_comments_638993.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-19T12:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638994.json:
```json
{
    "body": "Changing commit from \"9b2000bc0a5406827aa4afaf4fbe590abb025e2b\" to \"d935c8f93519e9e804bb5f42f5be2aba9c28e246\"",
    "created_at": "2021-07-19T12:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9b2000bc0a5406827aa4afaf4fbe590abb025e2b" to "d935c8f93519e9e804bb5f42f5be2aba9c28e246"



---

archive/issue_comments_638995.json:
```json
{
    "body": "<a id='comment:22'></a>After an inspection of the log-files being attached to the `tox-optional` workflow run mentioned in [comment 15](https://trac.sagemath.org/ticket/32099#comment:15) (for example the [one for ubunto focal](https://github.com/soehms/sage/runs/3040930473?check_suite_focus=true)) I realized that a couple of dependencies to standard `spkg` being necassary to have the doctests of `spkg-check.in` pass successfully during a clean build, were missing.\n\nI've added these and started the [workflow](https://github.com/soehms/sage/actions/runs/1044132433) again.\n\n\nI suspect that the problem which has been reported in [comment 17](https://trac.sagemath.org/ticket/32099#comment:17) is related to that and should be fixed, now.\n\nBTW: Is it intended that the jobs of `tox-optional` are marked green even though `spkg-check.in` failed?",
    "created_at": "2021-07-19T12:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638995",
    "user": "https://github.com/soehms"
}
```

<a id='comment:22'></a>After an inspection of the log-files being attached to the `tox-optional` workflow run mentioned in [comment 15](https://trac.sagemath.org/ticket/32099#comment:15) (for example the [one for ubunto focal](https://github.com/soehms/sage/runs/3040930473?check_suite_focus=true)) I realized that a couple of dependencies to standard `spkg` being necassary to have the doctests of `spkg-check.in` pass successfully during a clean build, were missing.

I've added these and started the [workflow](https://github.com/soehms/sage/actions/runs/1044132433) again.


I suspect that the problem which has been reported in [comment 17](https://trac.sagemath.org/ticket/32099#comment:17) is related to that and should be fixed, now.

BTW: Is it intended that the jobs of `tox-optional` are marked green even though `spkg-check.in` failed?



---

archive/issue_comments_638996.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-23T08:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638996",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_638997.json:
```json
{
    "body": "Changing commit from \"d935c8f93519e9e804bb5f42f5be2aba9c28e246\" to \"b57673aa02345a259d3021b74f99d6d489ad9674\"",
    "created_at": "2021-07-23T08:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d935c8f93519e9e804bb5f42f5be2aba9c28e246" to "b57673aa02345a259d3021b74f99d6d489ad9674"



---

archive/issue_comments_638998.json:
```json
{
    "body": "<a id='comment:24'></a>Now, the doctests did pass for the current workflow run on all jobs that I've inspected (by random choice of those that did not fail by some other reason). For example on Debian buster:\n\n```bash\nSuccessfully installed database-knotinfo-21.7.15\nRemoved build tracker: '/tmp/pip-req-tracker-1y0wwg_k'\n\nreal    0m2.628s\nuser    0m2.231s\nsys     0m0.401s\nCopying package files from temporary location /sage/local/var/tmp/sage/build/database_knotinfo-21.7.15/inst to /sage/local\nRunning the test suite for database_knotinfo-21.7.15...\nTesting databases/knotinfo_db.py\nno stored timings available\nRunning doctests with ID 2021-07-20-03-48-43-957b59f6.\nUsing --optional=database_knotinfo,sage\nDoctesting 1 file.\nsage -t --long --random-seed=0 databases/knotinfo_db.py\n    [101 tests, 25.38 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 25.5 seconds\n    cpu time: 24.8 seconds\n    cumulative wall time: 25.4 seconds\nPytest is not installed, skip checking tests that rely on it.\nTesting knots/knotinfo.py\ntoo few successful tests, not using stored timings\nRunning doctests with ID 2021-07-20-03-49-12-54c67d38.\nUsing --optional=database_knotinfo,sage\nDoctesting 1 file.\nsage -t --random-seed=0 knots/knotinfo.py\n    [352 tests, 5.04 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 5.2 seconds\n    cpu time: 5.0 seconds\n    cumulative wall time: 5.0 seconds\nPytest is not installed, skip checking tests that rely on it.\nTesting knots/link.py\ntoo few successful tests, not using stored timings\nRunning doctests with ID 2021-07-20-03-49-20-81ce905a.\nUsing --optional=database_knotinfo,sage\nDoctesting 1 file.\nsage -t --random-seed=0 knots/link.py\n    [539 tests, 13.25 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 13.4 seconds\n    cpu time: 13.2 seconds\n    cumulative wall time: 13.3 seconds\nPytest is not installed, skip checking tests that rely on it.\n\nreal    0m52.506s\nuser    0m48.852s\nsys     0m2.132s\nPassed the test suite for database_knotinfo-21.7.15.\nSuccessfully installed database_knotinfo-21.7.15\nDeleting temporary build directory\n```\n\n\n\nThe current commit is independent on that. Again, it just switches to a new version number format (see [issue 2 on GitHub](https://github.com/soehms/database_knotinfo/issues/2)).",
    "created_at": "2021-07-23T08:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638998",
    "user": "https://github.com/soehms"
}
```

<a id='comment:24'></a>Now, the doctests did pass for the current workflow run on all jobs that I've inspected (by random choice of those that did not fail by some other reason). For example on Debian buster:

```bash
Successfully installed database-knotinfo-21.7.15
Removed build tracker: '/tmp/pip-req-tracker-1y0wwg_k'

real    0m2.628s
user    0m2.231s
sys     0m0.401s
Copying package files from temporary location /sage/local/var/tmp/sage/build/database_knotinfo-21.7.15/inst to /sage/local
Running the test suite for database_knotinfo-21.7.15...
Testing databases/knotinfo_db.py
no stored timings available
Running doctests with ID 2021-07-20-03-48-43-957b59f6.
Using --optional=database_knotinfo,sage
Doctesting 1 file.
sage -t --long --random-seed=0 databases/knotinfo_db.py
    [101 tests, 25.38 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 25.5 seconds
    cpu time: 24.8 seconds
    cumulative wall time: 25.4 seconds
Pytest is not installed, skip checking tests that rely on it.
Testing knots/knotinfo.py
too few successful tests, not using stored timings
Running doctests with ID 2021-07-20-03-49-12-54c67d38.
Using --optional=database_knotinfo,sage
Doctesting 1 file.
sage -t --random-seed=0 knots/knotinfo.py
    [352 tests, 5.04 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5.2 seconds
    cpu time: 5.0 seconds
    cumulative wall time: 5.0 seconds
Pytest is not installed, skip checking tests that rely on it.
Testing knots/link.py
too few successful tests, not using stored timings
Running doctests with ID 2021-07-20-03-49-20-81ce905a.
Using --optional=database_knotinfo,sage
Doctesting 1 file.
sage -t --random-seed=0 knots/link.py
    [539 tests, 13.25 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 13.4 seconds
    cpu time: 13.2 seconds
    cumulative wall time: 13.3 seconds
Pytest is not installed, skip checking tests that rely on it.

real    0m52.506s
user    0m48.852s
sys     0m2.132s
Passed the test suite for database_knotinfo-21.7.15.
Successfully installed database_knotinfo-21.7.15
Deleting temporary build directory
```



The current commit is independent on that. Again, it just switches to a new version number format (see [issue 2 on GitHub](https://github.com/soehms/database_knotinfo/issues/2)).



---

archive/issue_comments_638999.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:22 soehms]:\n> After an inspection of the log-files being attached to the `tox-optional` workflow run mentioned in [comment 15](https://trac.sagemath.org/ticket/32099#comment:15) (for example the [one for ubunto focal](https://github.com/soehms/sage/runs/3040930473?check_suite_focus=true)) I realized that a couple of dependencies to standard `spkg` being necassary to have the doctests of `spkg-check.in` pass successfully during a clean build, were missing.\n\n\nTo declare check-specific dependencies, you can use the format/trick that is used in  `build/pkgs/networkx/dependencies`",
    "created_at": "2021-07-25T22:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-638999",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [comment:22 soehms]:
> After an inspection of the log-files being attached to the `tox-optional` workflow run mentioned in [comment 15](https://trac.sagemath.org/ticket/32099#comment:15) (for example the [one for ubunto focal](https://github.com/soehms/sage/runs/3040930473?check_suite_focus=true)) I realized that a couple of dependencies to standard `spkg` being necassary to have the doctests of `spkg-check.in` pass successfully during a clean build, were missing.


To declare check-specific dependencies, you can use the format/trick that is used in  `build/pkgs/networkx/dependencies`



---

archive/issue_comments_639000.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:22 soehms]:\n> BTW: Is it intended that the jobs of `tox-optional` are marked green even though `spkg-check.in` failed?\n\n\nYes, it's intentional.  Just too many optional packages fail at the moment. Seeing everything or almost everything fail is neither informative nor encouraging...",
    "created_at": "2021-07-25T22:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639000",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Replying to [comment:22 soehms]:
> BTW: Is it intended that the jobs of `tox-optional` are marked green even though `spkg-check.in` failed?


Yes, it's intentional.  Just too many optional packages fail at the moment. Seeing everything or almost everything fail is neither informative nor encouraging...



---

archive/issue_comments_639001.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639001",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639002.json:
```json
{
    "body": "Changing commit from \"b57673aa02345a259d3021b74f99d6d489ad9674\" to \"426ae4ad8c816c9076244920f5e35ba075a4a732\"",
    "created_at": "2021-07-27T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639002",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b57673aa02345a259d3021b74f99d6d489ad9674" to "426ae4ad8c816c9076244920f5e35ba075a4a732"



---

archive/issue_comments_639003.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 mkoeppe]:\n\n> To declare check-specific dependencies, you can use the format/trick that is used in  `build/pkgs/networkx/dependencies`\n\n\nThe package I used as example was `p_group_cohomology` which performes Sage doctests in `spkg-ceck.in`, as well. Anyway, I followed your suggestion and tested that at least the goal of the former commit has not been damaged. On the other hand I didn't test whether there are less restrictions if no check option is given. But, I think that should work here, too, if it is working for `networkx`.",
    "created_at": "2021-07-27T08:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639003",
    "user": "https://github.com/soehms"
}
```

<a id='comment:28'></a>Replying to [comment:25 mkoeppe]:

> To declare check-specific dependencies, you can use the format/trick that is used in  `build/pkgs/networkx/dependencies`


The package I used as example was `p_group_cohomology` which performes Sage doctests in `spkg-ceck.in`, as well. Anyway, I followed your suggestion and tested that at least the goal of the former commit has not been damaged. On the other hand I didn't test whether there are less restrictions if no check option is given. But, I think that should work here, too, if it is working for `networkx`.



---

archive/issue_comments_639004.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:26 mkoeppe]:\n\n> Yes, it's intentional.  Just too many optional packages fail at the moment. Seeing everything or almost everything fail is neither informative nor encouraging...\n\n\nYes, that's right.",
    "created_at": "2021-07-27T08:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639004",
    "user": "https://github.com/soehms"
}
```

<a id='comment:29'></a>Replying to [comment:26 mkoeppe]:

> Yes, it's intentional.  Just too many optional packages fail at the moment. Seeing everything or almost everything fail is neither informative nor encouraging...


Yes, that's right.



---

archive/issue_comments_639005.json:
```json
{
    "body": "<a id='comment:30'></a>Right after installation of the new version of the package I get the following errors upon `./sage -tp src/sage/databases/ src/sage/features/ src/sage/knots/`.\n\n```\nsage -t --random-seed=0 src/sage/features/databases.py\n**********************************************************************\nFile \"src/sage/features/databases.py\", line 113, in sage.features.databases.DatabaseKnotInfo\nFailed example:\n    DatabaseKnotInfo().is_present()  # optional: database_knotinfo\nExpected:\n    FeatureTestResult('sage.knots.knotinfo', True)\nGot:\n    FeatureTestResult('database_knotinfo', True)\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.features.databases.DatabaseKnotInfo\n    [15 tests, 1 failure, 0.02 s]\nsage -t --random-seed=0 src/sage/knots/link.py\n**********************************************************************\nFile \"src/sage/knots/link.py\", line 2667, in sage.knots.link.Link.homfly_polynomial\nFailed example:\n    KI, m = K.get_knotinfo(); KI, m\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.knots.link.Link.homfly_polynomial[14]>\", line 1, in <module>\n        KI, m = K.get_knotinfo(); KI, m\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/link.py\", line 3861, in get_knotinfo\n        ls, proved_s = self._knotinfo_matching_list()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__\n        self.cache = f(self._instance)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/link.py\", line 3489, in _knotinfo_matching_list\n        from sage.knots.knotinfo import KnotInfoSeries\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/knotinfo.py\", line 2416, in <module>\n        KnotInfo = KnotInfoBase('KnotInfo', db.row_names())\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__\n        self.cache = f(self._instance)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py\", line 705, in row_names\n        row_dict = self.read_row_dict()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__\n        self.cache = f(self._instance)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py\", line 683, in read_row_dict\n        return load('%s/%s' %(sobj_path, filename))\n      File \"sage/misc/persist.pyx\", line 187, in sage.misc.persist.load\n        with open(filename, 'rb') as fobj:\n    FileNotFoundError: [Errno 2] No such file or directory: '/Users/mkoeppe/.sage/knotinfo/row_dict.sobj'\n**********************************************************************\nFile \"src/sage/knots/link.py\", line 2669, in sage.knots.link.Link.homfly_polynomial\nFailed example:\n    K.homfly_polynomial(normalization='vz') == KI.homfly_polynomial()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.knots.link.Link.homfly_polynomial[15]>\", line 1, in <module>\n        K.homfly_polynomial(normalization='vz') == KI.homfly_polynomial()\n    NameError: name 'KI' is not defined\n**********************************************************************\n1 item had failures:\n   2 of  31 in sage.knots.link.Link.homfly_polynomial\n    [540 tests, 2 failures, 11.52 s]\n```\n\n\nThis is not stable: I reran the same command and got different errors:\n\n```\nsage -t --random-seed=0 src/sage/knots/knotinfo.py  # 232 doctests failed\nsage -t --random-seed=0 src/sage/features/databases.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/knots/link.py  # 2 doctests failed\n```\n\nMy guess is that what is happening here is that creating the cache is not safe for parallel doctesting. You may want to make this step atomic.",
    "created_at": "2021-08-03T01:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639005",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>Right after installation of the new version of the package I get the following errors upon `./sage -tp src/sage/databases/ src/sage/features/ src/sage/knots/`.

```
sage -t --random-seed=0 src/sage/features/databases.py
**********************************************************************
File "src/sage/features/databases.py", line 113, in sage.features.databases.DatabaseKnotInfo
Failed example:
    DatabaseKnotInfo().is_present()  # optional: database_knotinfo
Expected:
    FeatureTestResult('sage.knots.knotinfo', True)
Got:
    FeatureTestResult('database_knotinfo', True)
**********************************************************************
1 item had failures:
   1 of   3 in sage.features.databases.DatabaseKnotInfo
    [15 tests, 1 failure, 0.02 s]
sage -t --random-seed=0 src/sage/knots/link.py
**********************************************************************
File "src/sage/knots/link.py", line 2667, in sage.knots.link.Link.homfly_polynomial
Failed example:
    KI, m = K.get_knotinfo(); KI, m
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.knots.link.Link.homfly_polynomial[14]>", line 1, in <module>
        KI, m = K.get_knotinfo(); KI, m
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/link.py", line 3861, in get_knotinfo
        ls, proved_s = self._knotinfo_matching_list()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__
        self.cache = f(self._instance)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/link.py", line 3489, in _knotinfo_matching_list
        from sage.knots.knotinfo import KnotInfoSeries
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/knots/knotinfo.py", line 2416, in <module>
        KnotInfo = KnotInfoBase('KnotInfo', db.row_names())
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__
        self.cache = f(self._instance)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py", line 705, in row_names
        row_dict = self.read_row_dict()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__
        self.cache = f(self._instance)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/databases/knotinfo_db.py", line 683, in read_row_dict
        return load('%s/%s' %(sobj_path, filename))
      File "sage/misc/persist.pyx", line 187, in sage.misc.persist.load
        with open(filename, 'rb') as fobj:
    FileNotFoundError: [Errno 2] No such file or directory: '/Users/mkoeppe/.sage/knotinfo/row_dict.sobj'
**********************************************************************
File "src/sage/knots/link.py", line 2669, in sage.knots.link.Link.homfly_polynomial
Failed example:
    K.homfly_polynomial(normalization='vz') == KI.homfly_polynomial()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.knots.link.Link.homfly_polynomial[15]>", line 1, in <module>
        K.homfly_polynomial(normalization='vz') == KI.homfly_polynomial()
    NameError: name 'KI' is not defined
**********************************************************************
1 item had failures:
   2 of  31 in sage.knots.link.Link.homfly_polynomial
    [540 tests, 2 failures, 11.52 s]
```


This is not stable: I reran the same command and got different errors:

```
sage -t --random-seed=0 src/sage/knots/knotinfo.py  # 232 doctests failed
sage -t --random-seed=0 src/sage/features/databases.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/knots/link.py  # 2 doctests failed
```

My guess is that what is happening here is that creating the cache is not safe for parallel doctesting. You may want to make this step atomic.



---

archive/issue_comments_639006.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-03T01:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639006",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_639007.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-07T16:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639008.json:
```json
{
    "body": "Changing commit from \"426ae4ad8c816c9076244920f5e35ba075a4a732\" to \"436fadf34f0c096549bc93af1581365fba4c8635\"",
    "created_at": "2021-08-07T16:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "426ae4ad8c816c9076244920f5e35ba075a4a732" to "436fadf34f0c096549bc93af1581365fba4c8635"



---

archive/issue_comments_639009.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-07T17:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639009",
    "user": "https://github.com/soehms"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_639010.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:30 mkoeppe]:\n> My guess is that what is happening here is that creating the cache is not safe for parallel doctesting. You may want to make this step atomic.\n\n\nExactly! Shame on me: I only tested serial! Since I didn't find an appropriate Sage class to use for this purpose I created a variation of `atomic_write` in #32344",
    "created_at": "2021-08-07T17:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639010",
    "user": "https://github.com/soehms"
}
```

<a id='comment:33'></a>Replying to [comment:30 mkoeppe]:
> My guess is that what is happening here is that creating the cache is not safe for parallel doctesting. You may want to make this step atomic.


Exactly! Shame on me: I only tested serial! Since I didn't find an appropriate Sage class to use for this purpose I created a variation of `atomic_write` in #32344



---

archive/issue_comments_639011.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,12 @@\n In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.\n \n-Furthermore, an upgrade to  the first official release 21.7 of the PyPI-package will be done.\n+Furthermore, an upgrade to  the first official release 21.7.21 of the PyPI-package will be done.\n \n-The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the month giving the next differences. The first such release is [21.7](https://pypi.org/project/database-knotinfo/21.7/).\n+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release is [21.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).\n \n This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).\n+\n+\n \n Author: Sebastian Oehms\n \n``````\n",
    "created_at": "2021-08-07T18:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639011",
    "user": "https://github.com/soehms"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,12 @@
 In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.
 
-Furthermore, an upgrade to  the first official release 21.7 of the PyPI-package will be done.
+Furthermore, an upgrade to  the first official release 21.7.21 of the PyPI-package will be done.
 
-The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the month giving the next differences. The first such release is [21.7](https://pypi.org/project/database-knotinfo/21.7/).
+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release is [21.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).
 
 This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).
+
+
 
 Author: Sebastian Oehms
 
``````




---

archive/issue_comments_639012.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32344\"",
    "created_at": "2021-08-07T18:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639012",
    "user": "https://github.com/soehms"
}
```

Changing dependencies from "" to "#32344"



---

archive/issue_comments_639013.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.\n+\n+Furthermore, an upgrade to  the first official release 2021.7.21 of the PyPI-package will be done.\n+\n+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release is [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).\n+\n+This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).\n+\n \n \n Author: Sebastian Oehms\n``````\n",
    "created_at": "2021-08-07T18:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639013",
    "user": "https://github.com/soehms"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.
+
+Furthermore, an upgrade to  the first official release 2021.7.21 of the PyPI-package will be done.
+
+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release is [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).
+
+This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).
+
 
 
 Author: Sebastian Oehms
``````




---

archive/issue_comments_639014.json:
```json
{
    "body": "Changing commit from \"436fadf34f0c096549bc93af1581365fba4c8635\" to \"7993ccff6f23ed0e32b2ef64aae914673b9111e1\"",
    "created_at": "2021-08-11T09:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "436fadf34f0c096549bc93af1581365fba4c8635" to "7993ccff6f23ed0e32b2ef64aae914673b9111e1"



---

archive/issue_comments_639015.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-11T09:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639016.json:
```json
{
    "body": "<a id='comment:37'></a>I rename `reset_filcache` to `create_filecache`. Cleaning is resticted to a change of the version or user input, now!",
    "created_at": "2021-08-11T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639016",
    "user": "https://github.com/soehms"
}
```

<a id='comment:37'></a>I rename `reset_filcache` to `create_filecache`. Cleaning is resticted to a change of the version or user input, now!



---

archive/issue_events_084973.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32099#event-84973"
}
```



---

archive/issue_comments_639017.json:
```json
{
    "body": "Changing commit from \"7993ccff6f23ed0e32b2ef64aae914673b9111e1\" to \"ce89457d6fb8400d94e1f200ef5bdc59eb787b5f\"",
    "created_at": "2021-09-07T16:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7993ccff6f23ed0e32b2ef64aae914673b9111e1" to "ce89457d6fb8400d94e1f200ef5bdc59eb787b5f"



---

archive/issue_comments_639018.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-07T16:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639019.json:
```json
{
    "body": "<a id='comment:40'></a>Let's take the current version of the PyPI package with us. It's the first release completely created by the cron-job.",
    "created_at": "2021-09-07T16:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639019",
    "user": "https://github.com/soehms"
}
```

<a id='comment:40'></a>Let's take the current version of the PyPI package with us. It's the first release completely created by the cron-job.



---

archive/issue_comments_639020.json:
```json
{
    "body": "<a id='comment:41'></a>This seems to work well now!",
    "created_at": "2021-09-07T18:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639020",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>This seems to work well now!



---

archive/issue_comments_639021.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-09-07T18:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639021",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_639022.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.\n+\n+Furthermore, an upgrade to the official release 2021.9.1 of the PyPI-package will be done.\n+\n+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release was [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).\n+\n+This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).\n+\n \n \n Author: Sebastian Oehms\n``````\n",
    "created_at": "2021-09-07T18:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639022",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+In #31921 the location for the file-cache of the KnotInfo databases has been changed from `$SAGE_LOCAL` to `$DOT_SAGE`. Unfortunately this change has not been performed with respect to cleaning on version updates. This will be fixed here.
+
+Furthermore, an upgrade to the official release 2021.9.1 of the PyPI-package will be done.
+
+The original databases on the [KnotInfo](https://knotinfo.math.indiana.edu/) web-page are developed under continuous flow. In order to keep track with that I've installed a [cronjob](https://github.com/soehms/database_knotinfo/blob/main/.github/workflows/check_version_changed.yml) that looks for differences and creates new releases if necessary. This is done once a month. The version numbers correspond to the date giving the next differences. The first such release was [2021.7.21](https://pypi.org/project/database-knotinfo/2021.7.21/).
+
+This upgrade just puts Sage on that release. It does not effect any functionality. As far as I've seen, the major difference to the former release is the addition of 2 new columns for proper links (`'arf_invariant': 'Arf Invariant'`, `'topological_four_genus': 'Genus-4D (Top.)'`).
+
 
 
 Author: Sebastian Oehms
``````




---

archive/issue_comments_639023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-07T18:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639023",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_639024.json:
```json
{
    "body": "<a id='comment:42'></a>Many Thanks!",
    "created_at": "2021-09-08T07:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639024",
    "user": "https://github.com/soehms"
}
```

<a id='comment:42'></a>Many Thanks!



---

archive/issue_events_084974.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-15T22:06:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32099#event-84974"
}
```



---

archive/issue_comments_639025.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-15T22:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639025",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_639026.json:
```json
{
    "body": "Changing branch from \"u/soehms/knotinfo_update_32099\" to \"ce89457d6fb8400d94e1f200ef5bdc59eb787b5f\"",
    "created_at": "2021-09-15T22:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32099#issuecomment-639026",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/soehms/knotinfo_update_32099" to "ce89457d6fb8400d94e1f200ef5bdc59eb787b5f"
