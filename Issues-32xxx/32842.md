# Issue 32842: use PARI's fflog() for binary finite fields

archive/issues_032605.json:
```json
{
    "body": "Currently, `FiniteField_ntl_gf2eElement` calls generic-group `discrete_log()` to compute logarithms.\n\nThe patch instead calls PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.\n\nSage 9.4:\n\n```\nsage: F.<a> = GF(2^67)\nsage: %timeit F.random_element().log(a)\n2.78 s \u00b1 270 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nThis patch:\n\n```\nsage: F.<a> = GF(2^67)\nsage: %timeit F.random_element().log(a)\n359 ms \u00b1 71.8 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nExamples with highly non-smooth `2^k-1`, such as `k=61`, showcase even larger differences. Examples with very smooth `2^k-1` are occasionally a little bit faster using the na\u00efve code, but after playing around with this for a while I concluded that figuring out which algorithm to use ahead of time is no less costly than just letting PARI deal with it.\n\nThe patch does make sure to pass the (at this point, already cached) factorization of `2^k-1` to PARI so we don't factor again.\n\nCC:  @tscrim @edgarcosta\n\nBranch/Commit: 9ba60e755b63fce72d58ec18e6b85be152b10217\n\nReviewer: Edgar Costa, Travis Scrimshaw\n\nAuthor: Lorenz Panny\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32842\n\n",
    "closed_at": "2021-11-14T17:05:10Z",
    "created_at": "2021-11-09T14:56:13Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "use PARI's fflog() for binary finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32842",
    "user": "https://github.com/yyyyx4"
}
```
Currently, `FiniteField_ntl_gf2eElement` calls generic-group `discrete_log()` to compute logarithms.

The patch instead calls PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.

Sage 9.4:

```
sage: F.<a> = GF(2^67)
sage: %timeit F.random_element().log(a)
2.78 s ± 270 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

This patch:

```
sage: F.<a> = GF(2^67)
sage: %timeit F.random_element().log(a)
359 ms ± 71.8 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

Examples with highly non-smooth `2^k-1`, such as `k=61`, showcase even larger differences. Examples with very smooth `2^k-1` are occasionally a little bit faster using the naïve code, but after playing around with this for a while I concluded that figuring out which algorithm to use ahead of time is no less costly than just letting PARI deal with it.

The patch does make sure to pass the (at this point, already cached) factorization of `2^k-1` to PARI so we don't factor again.

CC:  @tscrim @edgarcosta

Branch/Commit: 9ba60e755b63fce72d58ec18e6b85be152b10217

Reviewer: Edgar Costa, Travis Scrimshaw

Author: Lorenz Panny

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32842





---

archive/issue_comments_496550.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,26 @@\n Currently, `FiniteField_ntl_gf2eElement` calls generic-group `discrete_log()` to compute logarithms.\n \n-We should instead call PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.\n+The patch instead calls PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.\n+\n+Sage 9.4:\n+\n+```\n+sage: F.<a> = GF(2^67)\n+sage: %timeit F.random_element().log(a)\n+2.78 s \u00b1 270 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n+```\n+\n+This patch:\n+\n+```\n+sage: F.<a> = GF(2^67)\n+sage: %timeit F.random_element().log(a)\n+359 ms \u00b1 71.8 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n+```\n+\n+Examples with highly non-smooth `2^k-1`, such as `k=61`, showcase even larger differences. Examples with very smooth `2^k-1` are occasionally a little bit faster using the na\u00efve code, but after playing around with this for a while I concluded that figuring out which algorithm to use ahead of time is no less costly than just letting PARI deal with it.\n+\n+The patch does make sure to pass the (at this point, already cached) factorization of `2^k-1` to PARI so we don't factor again.\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-11-10T02:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496550",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,26 @@
 Currently, `FiniteField_ntl_gf2eElement` calls generic-group `discrete_log()` to compute logarithms.
 
-We should instead call PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.
+The patch instead calls PARI's `fflog()`, which uses an index-calculus algorithm and is dramatically faster in some cases.
+
+Sage 9.4:
+
+```
+sage: F.<a> = GF(2^67)
+sage: %timeit F.random_element().log(a)
+2.78 s ± 270 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
+```
+
+This patch:
+
+```
+sage: F.<a> = GF(2^67)
+sage: %timeit F.random_element().log(a)
+359 ms ± 71.8 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
+```
+
+Examples with highly non-smooth `2^k-1`, such as `k=61`, showcase even larger differences. Examples with very smooth `2^k-1` are occasionally a little bit faster using the naïve code, but after playing around with this for a while I concluded that figuring out which algorithm to use ahead of time is no less costly than just letting PARI deal with it.
+
+The patch does make sure to pass the (at this point, already cached) factorization of `2^k-1` to PARI so we don't factor again.
 
 Comment: 1
 
``````




---

archive/issue_comments_496551.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-11-10T02:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496551",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_496552.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-10T02:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496552",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_496553.json:
```json
{
    "body": "<a id='comment:3'></a>The code looks good to me.\nHowever, I find it odd the comment\n\n```\nBig instances used to take very long before :trac:`32842`::\n```\nin the examples block quite odd.\n\nTravis, what do you think?",
    "created_at": "2021-11-10T09:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496553",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:3'></a>The code looks good to me.
However, I find it odd the comment

```
Big instances used to take very long before :trac:`32842`::
```
in the examples block quite odd.

Travis, what do you think?



---

archive/issue_comments_496554.json:
```json
{
    "body": "<a id='comment:4'></a>Are you referring to the English or the example itself? The English is a bit strange to me, and I would phrase it as\n\n```\nBig instances used to take a very long time before :trac:`32842`::\n```",
    "created_at": "2021-11-10T09:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496554",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>Are you referring to the English or the example itself? The English is a bit strange to me, and I would phrase it as

```
Big instances used to take a very long time before :trac:`32842`::
```



---

archive/issue_comments_496555.json:
```json
{
    "body": "<a id='comment:5'></a>The example, as I usually only see trac tickets mentioned under tests referring to a bug that has been fixed.\nThis is only a minor thing, and if you think it's alright, we can give it a positive review.",
    "created_at": "2021-11-10T09:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496555",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:5'></a>The example, as I usually only see trac tickets mentioned under tests referring to a bug that has been fixed.
This is only a minor thing, and if you think it's alright, we can give it a positive review.



---

archive/issue_comments_496556.json:
```json
{
    "body": "<a id='comment:6'></a>I think the example is fine, although it could be made better by having something that takes a really long time (>10s, even better >30s) prior but finishes within 1 second now.",
    "created_at": "2021-11-10T10:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496556",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I think the example is fine, although it could be made better by having something that takes a really long time (>10s, even better >30s) prior but finishes within 1 second now.



---

archive/issue_comments_496557.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-10T10:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_496558.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 tscrim]:\n> I think the example is fine, although it could be made better by having something that takes a really long time (>10s, even better >30s) prior but finishes within 1 second now.\n\n\nIt does: The `2^61` example is a worst-case input for the generic algorithm (because the unit group order `2^61-1` is prime). On my laptop, it eats all my RAM and dies after a couple of minutes. With the patch, it finishes successfully within a few hundred milliseconds.",
    "created_at": "2021-11-10T10:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496558",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'></a>Replying to [comment:6 tscrim]:
> I think the example is fine, although it could be made better by having something that takes a really long time (>10s, even better >30s) prior but finishes within 1 second now.


It does: The `2^61` example is a worst-case input for the generic algorithm (because the unit group order `2^61-1` is prime). On my laptop, it eats all my RAM and dies after a couple of minutes. With the patch, it finishes successfully within a few hundred milliseconds.



---

archive/issue_comments_496559.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-10T11:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496559",
    "user": "https://github.com/edgarcosta"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_496560.json:
```json
{
    "body": "<a id='comment:9'></a>The patch bot was green before :)",
    "created_at": "2021-11-10T11:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496560",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:9'></a>The patch bot was green before :)



---

archive/issue_comments_496561.json:
```json
{
    "body": "<a id='comment:10'></a>Thank you!",
    "created_at": "2021-11-10T13:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496561",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:10'></a>Thank you!



---

archive/issue_events_086858.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-14T17:05:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32842#event-86858"
}
```



---

archive/issue_comments_496562.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-14T17:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32842#issuecomment-496562",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
