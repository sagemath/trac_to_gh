# Issue 32160: Fix integral involving (x - floor(x))

archive/issues_031923.json:
```json
{
    "assignees": [
        "https://github.com/daju1"
    ],
    "body": "The following function involves (x - floor(x))\n\n```\nsage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n```\n\nIntegrating it gives a wrong answer:\n\n```\nsage: ans_sage = integrate(f, x, 1, +Infinity)\nsage: ans_sage\n3/128*pi - 5/128\nsage: ans_sage.n()\n0.0345685778185108\n```\n\nCompare with the answer given by SciPy:\n\n```\nsage: from scipy import integrate\nsage: ans_scipy = integrate.quad(f, 1, +Infinity)\nsage: ans_scipy[0]\n0.0009945480575073787\n```\n\nThat answer seems correct.\n\n\nCC:  @EmmanuelCharpentier @slel @frederichan-IMJPRG @mwageringel @sagetrac-parisse\n\nKeywords: **integral, giac, libgiac**\n\nBranch/Commit: **[public/ticket/32160](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/32160) @ [`382d37a`](https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb)**\n\nReviewer: **Samuel Leli\u00e8vre**\n\nAuthor: **Alexey Drozdov**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32160_\n\n",
    "created_at": "2021-07-08T03:12:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix integral involving (x - floor(x))",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/32160",
    "user": "https://github.com/daju1"
}
```
The following function involves (x - floor(x))

```
sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
```

Integrating it gives a wrong answer:

```
sage: ans_sage = integrate(f, x, 1, +Infinity)
sage: ans_sage
3/128*pi - 5/128
sage: ans_sage.n()
0.0345685778185108
```

Compare with the answer given by SciPy:

```
sage: from scipy import integrate
sage: ans_scipy = integrate.quad(f, 1, +Infinity)
sage: ans_scipy[0]
0.0009945480575073787
```

That answer seems correct.


CC:  @EmmanuelCharpentier @slel @frederichan-IMJPRG @mwageringel @sagetrac-parisse

Keywords: **integral, giac, libgiac**

Branch/Commit: **[public/ticket/32160](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/32160) @ [`382d37a`](https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb)**

Reviewer: **Samuel Leli√®vre**

Author: **Alexey Drozdov**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/32160_





---

archive/issue_events_440347.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-08T03:12:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440347"
}
```



---

archive/issue_events_440348.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-08T03:12:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440348"
}
```



---

archive/issue_events_440349.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-08T03:12:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440349"
}
```



---

archive/issue_events_440350.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-08T03:12:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440350"
}
```



---

archive/issue_comments_517822.json:
```json
{
    "body": "Attachment: **[bug integrate of function with floor.ipynb.gz](https://github.com/sagemath/sage/files/ticket32160/35a4636c8cac98407e299fc68e9272f9.gz)**",
    "created_at": "2021-07-08T03:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517822",
    "user": "https://github.com/daju1"
}
```

Attachment: **[bug integrate of function with floor.ipynb.gz](https://github.com/sagemath/sage/files/ticket32160/35a4636c8cac98407e299fc68e9272f9.gz)**



---

archive/issue_comments_517823.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,41 +2,53 @@\n \n \n ```\n-f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n+sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n ```\n \n \n \n ```\n-ans_sage = integrate(f, x, 1, +Infinity)\n-ans_sage\n+sage: ans_sage = integrate(f, x, 1, +Infinity)\n+sage: ans_sage\n ```\n \n \n+\n+```\n 3/128*pi - 5/128\n+```\n+\n \n \n ```\n-ans_sage.n()\n+sage: ans_sage.n()\n ```\n \n \n+\n+```\n 0.0345685778185108\n+```\n+\n \n seems like ans_sage is wrong\n \n \n ```\n-from scipy import integrate\n-ans_scipy = integrate.quad(f, 1, +Infinity)\n+sage: from scipy import integrate\n+sage: ans_scipy = integrate.quad(f, 1, +Infinity)\n ```\n \n \n ```\n-ans_scipy[0]\n+sage: ans_scipy[0]\n ```\n \n+\n+```\n 0.0009945480575073787\n+```\n+\n \n seems like ans_scipy is true\n \n``````\n",
    "created_at": "2021-07-08T03:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517823",
    "user": "https://github.com/daju1"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,41 +2,53 @@
 
 
 ```
-f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
+sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
 ```
 
 
 
 ```
-ans_sage = integrate(f, x, 1, +Infinity)
-ans_sage
+sage: ans_sage = integrate(f, x, 1, +Infinity)
+sage: ans_sage
 ```
 
 
+
+```
 3/128*pi - 5/128
+```
+
 
 
 ```
-ans_sage.n()
+sage: ans_sage.n()
 ```
 
 
+
+```
 0.0345685778185108
+```
+
 
 seems like ans_sage is wrong
 
 
 ```
-from scipy import integrate
-ans_scipy = integrate.quad(f, 1, +Infinity)
+sage: from scipy import integrate
+sage: ans_scipy = integrate.quad(f, 1, +Infinity)
 ```
 
 
 ```
-ans_scipy[0]
+sage: ans_scipy[0]
 ```
 
+
+```
 0.0009945480575073787
+```
+
 
 seems like ans_scipy is true
 
``````




---

archive/issue_comments_517824.json:
```json
{
    "body": "Branch: **[u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)**",
    "created_at": "2021-07-11T21:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517824",
    "user": "https://github.com/daju1"
}
```

Branch: **[u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)**



---

archive/issue_comments_517825.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[bug integrate of function with floor.2.ipynb.gz](https://github.com/sagemath/sage/files/ticket32160/3b90cdd97a22750c28bab07b6b0ce969.gz)**\n\n[https://github.com/sagemath/sagetrac-mirror/commits/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/commits/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee\"><code>c76967d</code></a></td><td><code>Giac interpreter: 'unable to handle infinite boundaries' added</code></td></tr></table>\n",
    "created_at": "2021-07-11T21:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517825",
    "user": "https://github.com/daju1"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[bug integrate of function with floor.2.ipynb.gz](https://github.com/sagemath/sage/files/ticket32160/3b90cdd97a22750c28bab07b6b0ce969.gz)**

[https://github.com/sagemath/sagetrac-mirror/commits/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/commits/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee"><code>c76967d</code></a></td><td><code>Giac interpreter: 'unable to handle infinite boundaries' added</code></td></tr></table>




---

archive/issue_comments_517826.json:
```json
{
    "body": "Commit: **[`c76967d`](https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee)**",
    "created_at": "2021-07-11T21:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517826",
    "user": "https://github.com/daju1"
}
```

Commit: **[`c76967d`](https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee)**



---

archive/issue_events_440351.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-11T21:18:29Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "subject": "https://github.com/daju1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440351"
}
```



---

archive/issue_events_440352.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-11T21:18:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440352"
}
```



---

archive/issue_comments_517827.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nUsing my commit I have \n\n\n```\nsage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n```\n\n\n\n```\nsage: ans_sage = integrate(f, x, 1, +Infinity)\nsage: ans_sage\n```\n\n\n\n```\nintegrate((7*x^2 - 3)*(2*x - 2*floor(x) - 1)*(x - floor(x))*(x - floor(x) - 1)*x/(x^2 + 1)^6, x, 1, +Infinity)\n```\n\n\n\n```\nsage: ans_sage.n()\n```\n\n\n\n```\n0.0009945490551909021\n```\n\nwhich is close to ans_scipy\n\n```\n0.0009945480575073787\n```",
    "created_at": "2021-07-12T06:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517827",
    "user": "https://github.com/daju1"
}
```

<div id="comment:6" align="right">comment:6</div>

Using my commit I have 


```
sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
```



```
sage: ans_sage = integrate(f, x, 1, +Infinity)
sage: ans_sage
```



```
integrate((7*x^2 - 3)*(2*x - 2*floor(x) - 1)*(x - floor(x))*(x - floor(x) - 1)*x/(x^2 + 1)^6, x, 1, +Infinity)
```



```
sage: ans_sage.n()
```



```
0.0009945490551909021
```

which is close to ans_scipy

```
0.0009945480575073787
```



---

archive/issue_comments_517828.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nNeeds doctests - \u200bhttps://www.sagemath.org/git-developer-guide/coding_basics.html#writing-testable-examples",
    "created_at": "2021-07-12T18:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517828",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Needs doctests - ‚Äãhttps://www.sagemath.org/git-developer-guide/coding_basics.html#writing-testable-examples



---

archive/issue_events_440353.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-12T18:36:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440353"
}
```



---

archive/issue_events_440354.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-12T18:36:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440354"
}
```



---

archive/issue_comments_517829.json:
```json
{
    "body": "Author: **Alexey Drozdov**",
    "created_at": "2021-07-12T18:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517829",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Alexey Drozdov**



---

archive/issue_comments_517830.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927\"><code>ef75061</code></a></td><td><code>Trac: #32160 testable example added</code></td></tr></table>\n",
    "created_at": "2021-07-15T21:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517830",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927"><code>ef75061</code></a></td><td><code>Trac: #32160 testable example added</code></td></tr></table>




---

archive/issue_comments_517831.json:
```json
{
    "body": "Changed commit from **[`c76967d`](https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee)** to **[`ef75061`](https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927)**",
    "created_at": "2021-07-15T21:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517831",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c76967d`](https://github.com/sagemath/sagetrac-mirror/commit/c76967d57f120cc25952274a62c81ed0d556d3ee)** to **[`ef75061`](https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927)**



---

archive/issue_events_440355.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-15T21:04:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440355"
}
```



---

archive/issue_events_440356.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-15T21:04:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440356"
}
```



---

archive/issue_comments_517832.json:
```json
{
    "body": "Reviewer: **Samuel Leli\u00e8vre**",
    "created_at": "2021-07-24T16:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517832",
    "user": "https://github.com/slel"
}
```

Reviewer: **Samuel Leli√®vre**



---

archive/issue_events_440357.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-24T16:52:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "title_is": "Fix integral involving (x - floor(x))",
    "title_was": "Integrate of function which contains (x - floor(x))",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440357"
}
```



---

archive/issue_comments_517833.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNeeds rebase on Sage 9.4.beta5.\n\nThis change would make the example clearer:\n\n```diff\n     Check that :trac:`32160` is fixed::\n \n-        sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n+        sage: g = x - floor(x)\n+        sage: h = x^2 + 1\n+        sage: f = (2*g^3 - 3*g^2 + g)*(10*x^3/h^6 - 3*x/h^5)\n         sage: ans_sage = integrate(f, x, 1, +Infinity)\n         sage: ans_sage\n```",
    "created_at": "2021-07-24T16:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517833",
    "user": "https://github.com/slel"
}
```

<div id="comment:11" align="right">comment:11</div>

Needs rebase on Sage 9.4.beta5.

This change would make the example clearer:

```diff
     Check that :trac:`32160` is fixed::
 
-        sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
+        sage: g = x - floor(x)
+        sage: h = x^2 + 1
+        sage: f = (2*g^3 - 3*g^2 + g)*(10*x^3/h^6 - 3*x/h^5)
         sage: ans_sage = integrate(f, x, 1, +Infinity)
         sage: ans_sage
```



---

archive/issue_comments_517834.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,55 +1,27 @@\n-Lets try to integrate the following function which contains (x - floor(x))\n-\n+The following function involves (x - floor(x))\n \n ```\n sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)\n ```\n \n-\n+Integrating it gives a wrong answer:\n \n ```\n sage: ans_sage = integrate(f, x, 1, +Infinity)\n sage: ans_sage\n-```\n-\n-\n-\n-```\n 3/128*pi - 5/128\n-```\n-\n-\n-\n-```\n sage: ans_sage.n()\n-```\n-\n-\n-\n-```\n 0.0345685778185108\n ```\n \n-\n-seems like ans_sage is wrong\n-\n+Compare with the answer given by SciPy:\n \n ```\n sage: from scipy import integrate\n sage: ans_scipy = integrate.quad(f, 1, +Infinity)\n-```\n-\n-\n-```\n sage: ans_scipy[0]\n-```\n-\n-\n-```\n 0.0009945480575073787\n ```\n \n+That answer seems correct.\n \n-seems like ans_scipy is true\n-\n-\n``````\n",
    "created_at": "2021-07-24T16:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517834",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,55 +1,27 @@
-Lets try to integrate the following function which contains (x - floor(x))
-
+The following function involves (x - floor(x))
 
 ```
 sage: f = (2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3/(x^2 + 1)^6 - 3*x/(x^2 + 1)^5)
 ```
 
-
+Integrating it gives a wrong answer:
 
 ```
 sage: ans_sage = integrate(f, x, 1, +Infinity)
 sage: ans_sage
-```
-
-
-
-```
 3/128*pi - 5/128
-```
-
-
-
-```
 sage: ans_sage.n()
-```
-
-
-
-```
 0.0345685778185108
 ```
 
-
-seems like ans_sage is wrong
-
+Compare with the answer given by SciPy:
 
 ```
 sage: from scipy import integrate
 sage: ans_scipy = integrate.quad(f, 1, +Infinity)
-```
-
-
-```
 sage: ans_scipy[0]
-```
-
-
-```
 0.0009945480575073787
 ```
 
+That answer seems correct.
 
-seems like ans_scipy is true
-
-
``````




---

archive/issue_comments_517835.json:
```json
{
    "body": "Changed keywords from none to **integral**",
    "created_at": "2021-07-24T16:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517835",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **integral**



---

archive/issue_events_440358.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-24T17:15:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440358"
}
```



---

archive/issue_events_440359.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-24T17:15:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440359"
}
```



---

archive/issue_comments_517836.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTesting `src/sage/symbolic/integration/integral.py`\nwith the proposed changes (rebased on Sage 9.4.beta5)\nfails for me:\n\n```\n$ sage -t --long src/sage/symbolic/integration/integral.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-07-24-18-43-49-44924a2f.\nGit branch: 32160\nUsing --optional=build,dochtml,gap_packages,homebrew,libsemigroups,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --random-seed=0 src/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"src/sage/symbolic/integration/integral.py\", line 1017, in sage.symbolic.integration.integral.integrate\nFailed example:\n    ans_scipy = integrate.quad(f, 1, +Infinity)\nExpected nothing\nGot:\n    doctest:warning\n      File \"/opt/s/sage9a/src/bin/sage-runtests\", line 144, in <module>\n        err = DC.run()\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 1207, in run\n        self.run_doctests()\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 909, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2044, in dispatch\n        self.parallel_dispatch()\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1939, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2211, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/popen_fork.py\", line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2183, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2512, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 2559, in _run\n        result = runner.run(test)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 910, in run\n        return self._run(test, compileflags, out)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.integration.integral.integrate[166]>\", line 1, in <module>\n        ans_scipy = integrate.quad(f, Integer(1), +Infinity)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/scipy/integrate/quadpack.py\", line 351, in quad\n        retval = _quad(func, a, b, args, full_output, epsabs, epsrel, limit,\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/scipy/integrate/quadpack.py\", line 465, in _quad\n        return _quadpack._qagie(func,bound,infbounds,args,full_output,epsabs,epsrel,limit)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/misc/superseded.py\", line 99, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/opt/s/sage9a/local/lib/python3.9/site-packages/sage/misc/superseded.py\", line 145, in warning\n        warn(message, warning_class, stacklevel)\n      File \"/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)\n    See http://trac.sagemath.org/5930 for details.\n**********************************************************************\nFile \"src/sage/symbolic/integration/integral.py\", line 1018, in sage.symbolic.integration.integral.integrate\nFailed example:\n    ans_scipy[0]\nExpected:\n    0.0009945480575073787\nGot:\n    0.0009945480575073791\n**********************************************************************\n1 item had failures:\n   2 of 169 in sage.symbolic.integration.integral.integrate\n    [229 tests, 2 failures, 826.72 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 826.9 seconds\n    cpu time: 804.2 seconds\n    cumulative wall time: 826.7 seconds\nPytest is not installed, skip checking tests that rely on it.\n```\n\nNot sure how to deal with the deprecation warning.\n\nFor the other failure, either use an ellipsis for\nthe last few digits:\n\n```diff\n     sage: ans_scipy[0]\n-    0.0009945480575073787\n+    0.00099454805750737...\n```\nor add a tolerance indication, either absolute:\n\n```diff\n-    sage: ans_scipy[0]\n+    sage: ans_scipy[0]  # abs tol 1e-15\n     0.0009945480575073787\n```\nor relative:\n\n```diff\n-    sage: ans_scipy[0]\n+    sage: ans_scipy[0]  # rel tol 1e-11\n     0.0009945480575073787\n```",
    "created_at": "2021-07-24T17:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517836",
    "user": "https://github.com/slel"
}
```

<div id="comment:12" align="right">comment:12</div>

Testing `src/sage/symbolic/integration/integral.py`
with the proposed changes (rebased on Sage 9.4.beta5)
fails for me:

```
$ sage -t --long src/sage/symbolic/integration/integral.py
too many failed tests, not using stored timings
Running doctests with ID 2021-07-24-18-43-49-44924a2f.
Git branch: 32160
Using --optional=build,dochtml,gap_packages,homebrew,libsemigroups,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --random-seed=0 src/sage/symbolic/integration/integral.py
**********************************************************************
File "src/sage/symbolic/integration/integral.py", line 1017, in sage.symbolic.integration.integral.integrate
Failed example:
    ans_scipy = integrate.quad(f, 1, +Infinity)
Expected nothing
Got:
    doctest:warning
      File "/opt/s/sage9a/src/bin/sage-runtests", line 144, in <module>
        err = DC.run()
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1207, in run
        self.run_doctests()
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/control.py", line 909, in run_doctests
        self.dispatcher.dispatch()
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2044, in dispatch
        self.parallel_dispatch()
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1939, in parallel_dispatch
        w.start()  # This might take some time
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2211, in start
        super(DocTestWorker, self).start()
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2183, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2512, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 2559, in _run
        result = runner.run(test)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 910, in run
        return self._run(test, compileflags, out)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.integration.integral.integrate[166]>", line 1, in <module>
        ans_scipy = integrate.quad(f, Integer(1), +Infinity)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/scipy/integrate/quadpack.py", line 351, in quad
        retval = _quad(func, a, b, args, full_output, epsabs, epsrel, limit,
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/scipy/integrate/quadpack.py", line 465, in _quad
        return _quadpack._qagie(func,bound,infbounds,args,full_output,epsabs,epsrel,limit)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/misc/superseded.py", line 99, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/opt/s/sage9a/local/lib/python3.9/site-packages/sage/misc/superseded.py", line 145, in warning
        warn(message, warning_class, stacklevel)
      File "/usr/local/Cellar/python@3.9/3.9.6/Frameworks/Python.framework/Versions/3.9/lib/python3.9/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)
    See http://trac.sagemath.org/5930 for details.
**********************************************************************
File "src/sage/symbolic/integration/integral.py", line 1018, in sage.symbolic.integration.integral.integrate
Failed example:
    ans_scipy[0]
Expected:
    0.0009945480575073787
Got:
    0.0009945480575073791
**********************************************************************
1 item had failures:
   2 of 169 in sage.symbolic.integration.integral.integrate
    [229 tests, 2 failures, 826.72 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 826.9 seconds
    cpu time: 804.2 seconds
    cumulative wall time: 826.7 seconds
Pytest is not installed, skip checking tests that rely on it.
```

Not sure how to deal with the deprecation warning.

For the other failure, either use an ellipsis for
the last few digits:

```diff
     sage: ans_scipy[0]
-    0.0009945480575073787
+    0.00099454805750737...
```
or add a tolerance indication, either absolute:

```diff
-    sage: ans_scipy[0]
+    sage: ans_scipy[0]  # abs tol 1e-15
     0.0009945480575073787
```
or relative:

```diff
-    sage: ans_scipy[0]
+    sage: ans_scipy[0]  # rel tol 1e-11
     0.0009945480575073787
```



---

archive/issue_comments_517837.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHi, slelievre\n\nIf you want to make the example more clearer, I can provide the part of my work related with two dimensional Euler-Maclarin formula\n\n```\n\nsage: x,y = var(\"x,y\")                                                                                                                                                           \nsage: f = (x^2 + y^2)^(-2)                                                                                                                                                       \nsage: p = 3                                                                                                                                                                      \nsage: f_diff_x_p = f.diff(x, p)                                                                                                                                                  \nsage: f_diff_x_p                                                                                                                                                                 \n-192*x^3/(x^2 + y^2)^5 + 72*x/(x^2 + y^2)^4\nsage: P = lambda x, p : bernoulli_polynomial(x - floor(x), p)                                                                                                                    \nsage: poly = P(x=x,p=p)/factorial(p)                                                                                                                                             \nsage: poly                                                                                                                                                                       \n1/6*(x - floor(x))^3 - 1/4*(x - floor(x))^2 + 1/12*x - 1/12*floor(x)\nsage: assume(y>0)                                                                                                                                                                \nsage: Rpx = (-1)^(p+1)*integrate(f_diff_x_p*poly, x, 1, Infinity)                                                                                                                \nsage: Rpx                                                                                                                                                                        \n-2*integrate((2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(8*x^3/(x^2 + y^2)^5 - 3*x/(x^2 + y^2)^4), x, 1, +Infinity)\nsage: k = 2                                                                                                                                                                      \nsage: g = bernoulli(k)/factorial(k) * Rpx.diff(y, k-1)                                                                                                                           \nsage: g                                                                                                                                                                          \n4/3*integrate((2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3*y/(x^2 + y^2)^6 - 3*x*y/(x^2 + y^2)^5), x, 1, +Infinity)\nsage: g.subs(y == 1)                                                                                                                                                             \n1/32*pi - 5/96\nsage: g.subs(y == 1).n()                                                                                                                                                         \n0.0460914370913477\n```\n\nthe obtained value is wrong, because\n\n\n```\nsage: from scipy import integrate as scipy_integrate                                                                                                                             \nsage: ans_scipy = (-1)^(p+1) * bernoulli(k)/factorial(k) * scipy_integrate.quad((f_diff_x_p*poly).diff(y,k-1).subs(y == 1), 1, Infinity)[0]                                      \nsage: ans_scipy                                                                                                                                                                  \n0.001326061994802289\n```",
    "created_at": "2021-07-26T09:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517837",
    "user": "https://github.com/daju1"
}
```

<div id="comment:13" align="right">comment:13</div>

Hi, slelievre

If you want to make the example more clearer, I can provide the part of my work related with two dimensional Euler-Maclarin formula

```

sage: x,y = var("x,y")                                                                                                                                                           
sage: f = (x^2 + y^2)^(-2)                                                                                                                                                       
sage: p = 3                                                                                                                                                                      
sage: f_diff_x_p = f.diff(x, p)                                                                                                                                                  
sage: f_diff_x_p                                                                                                                                                                 
-192*x^3/(x^2 + y^2)^5 + 72*x/(x^2 + y^2)^4
sage: P = lambda x, p : bernoulli_polynomial(x - floor(x), p)                                                                                                                    
sage: poly = P(x=x,p=p)/factorial(p)                                                                                                                                             
sage: poly                                                                                                                                                                       
1/6*(x - floor(x))^3 - 1/4*(x - floor(x))^2 + 1/12*x - 1/12*floor(x)
sage: assume(y>0)                                                                                                                                                                
sage: Rpx = (-1)^(p+1)*integrate(f_diff_x_p*poly, x, 1, Infinity)                                                                                                                
sage: Rpx                                                                                                                                                                        
-2*integrate((2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(8*x^3/(x^2 + y^2)^5 - 3*x/(x^2 + y^2)^4), x, 1, +Infinity)
sage: k = 2                                                                                                                                                                      
sage: g = bernoulli(k)/factorial(k) * Rpx.diff(y, k-1)                                                                                                                           
sage: g                                                                                                                                                                          
4/3*integrate((2*(x - floor(x))^3 - 3*(x - floor(x))^2 + x - floor(x))*(10*x^3*y/(x^2 + y^2)^6 - 3*x*y/(x^2 + y^2)^5), x, 1, +Infinity)
sage: g.subs(y == 1)                                                                                                                                                             
1/32*pi - 5/96
sage: g.subs(y == 1).n()                                                                                                                                                         
0.0460914370913477
```

the obtained value is wrong, because


```
sage: from scipy import integrate as scipy_integrate                                                                                                                             
sage: ans_scipy = (-1)^(p+1) * bernoulli(k)/factorial(k) * scipy_integrate.quad((f_diff_x_p*poly).diff(y,k-1).subs(y == 1), 1, Infinity)[0]                                      
sage: ans_scipy                                                                                                                                                                  
0.001326061994802289
```



---

archive/issue_comments_517838.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNote that `frac(x)` is a nicer way to write `x - floor(x)`.",
    "created_at": "2021-07-26T10:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517838",
    "user": "https://github.com/slel"
}
```

<div id="comment:14" align="right">comment:14</div>

Note that `frac(x)` is a nicer way to write `x - floor(x)`.



---

archive/issue_comments_517839.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d\"><code>7d7c888</code></a></td><td><code>Trac: #32160 testable example fixed</code></td></tr></table>\n",
    "created_at": "2021-07-28T14:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517839",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d"><code>7d7c888</code></a></td><td><code>Trac: #32160 testable example fixed</code></td></tr></table>




---

archive/issue_comments_517840.json:
```json
{
    "body": "Changed commit from **[`ef75061`](https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927)** to **[`7d7c888`](https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d)**",
    "created_at": "2021-07-28T14:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517840",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ef75061`](https://github.com/sagemath/sagetrac-mirror/commit/ef7506157f7bdac4a784b3a69e663cfd144bd927)** to **[`7d7c888`](https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d)**



---

archive/issue_events_440360.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-28T14:33:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440360"
}
```



---

archive/issue_events_440361.json:
```json
{
    "actor": "https://github.com/daju1",
    "created_at": "2021-07-28T14:33:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440361"
}
```



---

archive/issue_comments_517841.json:
```json
{
    "body": "Changed commit from **[`7d7c888`](https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d)** to **[`26539f0`](https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a)**",
    "created_at": "2021-08-17T10:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517841",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7d7c888`](https://github.com/sagemath/sagetrac-mirror/commit/7d7c888f1cbf1c09bae9cde44ff98e6628cc1c2d)** to **[`26539f0`](https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a)**



---

archive/issue_comments_517842.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a\"><code>26539f0</code></a></td><td><code>Merge tag '9.4.rc2' into t/32160/integrate_of_function_which_contains__x___floor_x__</code></td></tr></table>\n",
    "created_at": "2021-08-17T10:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517842",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a"><code>26539f0</code></a></td><td><code>Merge tag '9.4.rc2' into t/32160/integrate_of_function_which_contains__x___floor_x__</code></td></tr></table>




---

archive/issue_comments_517843.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee\"><code>c1e475a</code></a></td><td><code>Trac: #32160 testable example fixed according with enhanced switching between integrators</code></td></tr></table>\n",
    "created_at": "2021-08-17T21:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517843",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee"><code>c1e475a</code></a></td><td><code>Trac: #32160 testable example fixed according with enhanced switching between integrators</code></td></tr></table>




---

archive/issue_comments_517844.json:
```json
{
    "body": "Changed commit from **[`26539f0`](https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a)** to **[`c1e475a`](https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee)**",
    "created_at": "2021-08-17T21:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517844",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`26539f0`](https://github.com/sagemath/sagetrac-mirror/commit/26539f09d9f151c026e249757bbe59e5fe230e3a)** to **[`c1e475a`](https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee)**



---

archive/issue_comments_517845.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nCould we break the long output line into multiple lines (say at `+`)?",
    "created_at": "2021-08-18T06:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517845",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Could we break the long output line into multiple lines (say at `+`)?



---

archive/issue_events_440362.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440362"
}
```



---

archive/issue_events_440363.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440363"
}
```



---

archive/issue_comments_517846.json:
```json
{
    "body": "Changed branch from **[u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)** to **[public/ticket/32160](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/32160)**",
    "created_at": "2021-11-02T17:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517846",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/gh-daju1/integrate_of_function_which_contains__x___floor_x__](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-daju1/integrate_of_function_which_contains__x___floor_x__)** to **[public/ticket/32160](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/32160)**



---

archive/issue_comments_517847.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI have truncated the doctest.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3951cea695a7f05bbb5f546b4ff07abcd3a123b\"><code>e3951ce</code></a></td><td><code>Merge branch 'u/gh-daju1/integrate_of_function_which_contains__x___floor_x__' in 9.5.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902\"><code>339ef17</code></a></td><td><code>shorten doctest</code></td></tr></table>\n",
    "created_at": "2021-11-02T17:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517847",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

I have truncated the doctest.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3951cea695a7f05bbb5f546b4ff07abcd3a123b"><code>e3951ce</code></a></td><td><code>Merge branch 'u/gh-daju1/integrate_of_function_which_contains__x___floor_x__' in 9.5.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902"><code>339ef17</code></a></td><td><code>shorten doctest</code></td></tr></table>




---

archive/issue_comments_517848.json:
```json
{
    "body": "Changed commit from **[`c1e475a`](https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee)** to **[`339ef17`](https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902)**",
    "created_at": "2021-11-02T17:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517848",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`c1e475a`](https://github.com/sagemath/sagetrac-mirror/commit/c1e475a22f4553a39d9eddd56ab18080ca725eee)** to **[`339ef17`](https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902)**



---

archive/issue_events_440364.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-11-12T10:35:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440364"
}
```



---

archive/issue_events_440365.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-11-12T10:35:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440365"
}
```



---

archive/issue_comments_517849.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nnow integration is using libgiac rather than giac, so the proposed fix no longer works",
    "created_at": "2021-11-12T10:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517849",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

now integration is using libgiac rather than giac, so the proposed fix no longer works



---

archive/issue_events_440366.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440366"
}
```



---

archive/issue_events_440367.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440367"
}
```



---

archive/issue_events_440368.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440368"
}
```



---

archive/issue_events_440369.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440369"
}
```



---

archive/issue_comments_517850.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb\"><code>382d37a</code></a></td><td><code>Merge tag '9.6.beta7' into t/32160/public/ticket/32160</code></td></tr></table>\n",
    "created_at": "2022-07-23T20:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb"><code>382d37a</code></a></td><td><code>Merge tag '9.6.beta7' into t/32160/public/ticket/32160</code></td></tr></table>




---

archive/issue_comments_517851.json:
```json
{
    "body": "Changed commit from **[`339ef17`](https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902)** to **[`382d37a`](https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb)**",
    "created_at": "2022-07-23T20:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`339ef17`](https://github.com/sagemath/sagetrac-mirror/commit/339ef17fa76b75d5717e1a81cfd2ae6f0ac65902)** to **[`382d37a`](https://github.com/sagemath/sagetrac-mirror/commit/382d37aa83c64e2f9cb944797e6aaacf176dc3fb)**



---

archive/issue_comments_517852.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThis seems to be an error in Giac itself as the antiderivative is not correct. It would be best to report it to Giac upstream, so that it can be fixed there.\n\nIn particular, this is not caused by one of the integration bounds being infinity, and not caused by the switch of integration algorithms from giac to libgiac.\n\nFor a smaller example, consider just the left factor of the original example.\n\n```sage\nsage: g = 2*(frac(x))^3 - 3*(frac(x))^2 + frac(x)     # g is continuous\nsage: G = g.integral(x, algorithm='libgiac'); G       # Tested with Giac 1.9.0\n// Giac share root-directory:/usr/share/giac/\n// Giac share root-directory:/usr/share/giac/\nAdded 0 synonyms\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [sign(sageVARx)]\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [sign(sageVARx)]\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [sign(sageVARx)]\n1/2*x^4 - x^3 - x*floor(x*sgn(x))*sgn(x) + 1/2*x^2\n```\nThis antiderivative is only correct for `0 < x < 1`. For the whole real line, the antiderivative should instead be (I think):\n\n```\nfrac(x)^4/2 - frac(x)^3 + frac(x)^2/2\n```\nGiac did issue some warnings which are a hint that the result might be wrong, but our argument *is* real, so I am not sure what to make of it.",
    "created_at": "2022-07-24T11:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517852",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:27" align="right">comment:27</div>

This seems to be an error in Giac itself as the antiderivative is not correct. It would be best to report it to Giac upstream, so that it can be fixed there.

In particular, this is not caused by one of the integration bounds being infinity, and not caused by the switch of integration algorithms from giac to libgiac.

For a smaller example, consider just the left factor of the original example.

```sage
sage: g = 2*(frac(x))^3 - 3*(frac(x))^2 + frac(x)     # g is continuous
sage: G = g.integral(x, algorithm='libgiac'); G       # Tested with Giac 1.9.0
// Giac share root-directory:/usr/share/giac/
// Giac share root-directory:/usr/share/giac/
Added 0 synonyms
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [sign(sageVARx)]
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [sign(sageVARx)]
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [sign(sageVARx)]
1/2*x^4 - x^3 - x*floor(x*sgn(x))*sgn(x) + 1/2*x^2
```
This antiderivative is only correct for `0 < x < 1`. For the whole real line, the antiderivative should instead be (I think):

```
frac(x)^4/2 - frac(x)^3 + frac(x)^2/2
```
Giac did issue some warnings which are a hint that the result might be wrong, but our argument *is* real, so I am not sure what to make of it.



---

archive/issue_comments_517853.json:
```json
{
    "body": "Changed keywords from **integral** to **integral, giac, libgiac**",
    "created_at": "2022-07-24T11:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517853",
    "user": "https://github.com/mwageringel"
}
```

Changed keywords from **integral** to **integral, giac, libgiac**



---

archive/issue_comments_517854.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nFirst of all I see that in giac online\n\n[https://www.xcasenligne.fr/giac_online/demoGiacPhp.php](https://www.xcasenligne.fr/giac_online/demoGiacPhp.php)\n\n```\nfrac(x)\n```\n\nmeans\n\n```\nx-sign(x)floor(xsign(x))\n```",
    "created_at": "2022-07-31T06:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517854",
    "user": "https://github.com/daju1"
}
```

<div id="comment:28" align="right">comment:28</div>

First of all I see that in giac online

[https://www.xcasenligne.fr/giac_online/demoGiacPhp.php](https://www.xcasenligne.fr/giac_online/demoGiacPhp.php)

```
frac(x)
```

means

```
x-sign(x)floor(xsign(x))
```



---

archive/issue_comments_517855.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOh dear, both Giac and Sage return `-0.25` for `frac(-1.25)`.",
    "created_at": "2022-08-01T09:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517855",
    "user": "https://github.com/slel"
}
```

<div id="comment:29" align="right">comment:29</div>

Oh dear, both Giac and Sage return `-0.25` for `frac(-1.25)`.



---

archive/issue_comments_517856.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThe definition is a little different. In Sage for `RR` elements, it uses mpfr and satisfies `x == x.trunc() + x.frac()`:\n\n```\nsage: x = -1.25\nsage: x.trunc()\n-1\nsage: x.frac()\n-0.250000000000000\n```\nThis is at odds with the `frac()` function definition.",
    "created_at": "2022-08-03T08:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517856",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

The definition is a little different. In Sage for `RR` elements, it uses mpfr and satisfies `x == x.trunc() + x.frac()`:

```
sage: x = -1.25
sage: x.trunc()
-1
sage: x.frac()
-0.250000000000000
```
This is at odds with the `frac()` function definition.



---

archive/issue_comments_517857.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nSo currently (Sage 9.6) the following mismatches are puzzling:\n\n```\nsage: frac(-1.25)\n-0.250000000000000\nsage: frac(x).subs({x: -1.25})\n0.750000000000000\n```\n\n```\nsage: frac(-1.25r)\n-0.25\nsage: frac(x).subs({x: -1.25r})\n0.75\n```\n\n```\nsage: frac(RDF(-1.25))\n-0.25\nsage: frac(x).subs({x: RDF(-1.25)})\n0.75\n```\n\n```\nsage: plot(frac, (-5, 5), aspect_ratio=1)\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\nRationals behave well:\n\n```\n{{{\nsage: frac(-5/4)\n3/4\nsage: frac(x).subs({x: -5/4})\n3/4\n}}}",
    "created_at": "2022-08-30T14:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32160#issuecomment-517857",
    "user": "https://github.com/slel"
}
```

<div id="comment:31" align="right">comment:31</div>

So currently (Sage 9.6) the following mismatches are puzzling:

```
sage: frac(-1.25)
-0.250000000000000
sage: frac(x).subs({x: -1.25})
0.750000000000000
```

```
sage: frac(-1.25r)
-0.25
sage: frac(x).subs({x: -1.25r})
0.75
```

```
sage: frac(RDF(-1.25))
-0.25
sage: frac(x).subs({x: RDF(-1.25)})
0.75
```

```
sage: plot(frac, (-5, 5), aspect_ratio=1)
Launched png viewer for Graphics object consisting of 1 graphics primitive
```
Rationals behave well:

```
{{{
sage: frac(-5/4)
3/4
sage: frac(x).subs({x: -5/4})
3/4
}}}



---

archive/issue_events_440370.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440370"
}
```



---

archive/issue_events_440371.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32160",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32160#event-440371"
}
```
