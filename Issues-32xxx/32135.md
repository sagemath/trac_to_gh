# Issue 32135: Implement to_polynomial and from_polynomial methods for ModularFormsRing

archive/issues_031898.json:
```json
{
    "body": "The goal of this ticket is to implement two methods: one for the class `GradedModularFormElement` and one for the class `ModularFormsRing`. \n\n* The first method is `to_polynomial` that will convert a graded form //F// into a polynomial //P(X_1, X_2,... X_n)// where the //X_i// correspond to the generators of the graded ring of modular forms in which //F// lives. Note that the result of this method is not unique in general. \n\n```\nsage: M = ModularFormsRing(1)\nsage: f = (M.0)^3 + (M.1)^2;\n2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)\nsage: f.to_polynomial(f)\nX^3 + Y^2\n```\n\n* The second method is `from_polynomial` that will convert a polynomial into a graded form:\n\n```\nsage: M = ModularFormsRing(1)\nsage: M.from_polynomial(X^3 + Y^2, [M.0, M.1])\n2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)\n```\n\nThis ticket is part of #31560\n\n\n\nAssignee: @DavidAyotte\n\nCC:  @videlec\n\nKeywords: graded modular forms polynomials gsoc 2021\n\nBranch/Commit: 2cdb21a48ab1b92273f43acc235b07f71e585a73\n\nReviewer: Vincent Delecroix\n\nAuthor: David Ayotte\n\nDependencies: #31559\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32135\n\n",
    "closed_at": "2021-08-31T22:00:32Z",
    "created_at": "2021-07-05T14:08:26Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Implement to_polynomial and from_polynomial methods for ModularFormsRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32135",
    "user": "https://github.com/DavidAyotte"
}
```
The goal of this ticket is to implement two methods: one for the class `GradedModularFormElement` and one for the class `ModularFormsRing`. 

* The first method is `to_polynomial` that will convert a graded form //F// into a polynomial //P(X_1, X_2,... X_n)// where the //X_i// correspond to the generators of the graded ring of modular forms in which //F// lives. Note that the result of this method is not unique in general. 

```
sage: M = ModularFormsRing(1)
sage: f = (M.0)^3 + (M.1)^2;
2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)
sage: f.to_polynomial(f)
X^3 + Y^2
```

* The second method is `from_polynomial` that will convert a polynomial into a graded form:

```
sage: M = ModularFormsRing(1)
sage: M.from_polynomial(X^3 + Y^2, [M.0, M.1])
2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)
```

This ticket is part of #31560



Assignee: @DavidAyotte

CC:  @videlec

Keywords: graded modular forms polynomials gsoc 2021

Branch/Commit: 2cdb21a48ab1b92273f43acc235b07f71e585a73

Reviewer: Vincent Delecroix

Author: David Ayotte

Dependencies: #31559

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32135





---

archive/issue_comments_639667.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-DavidAyotte/modform_to_polynomials_generators\"",
    "created_at": "2021-07-06T17:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639667",
    "user": "https://github.com/DavidAyotte"
}
```

Changing branch from "" to "u/gh-DavidAyotte/modform_to_polynomials_generators"



---

archive/issue_comments_639668.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T19:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639668",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639669.json:
```json
{
    "body": "Changing commit from \"\" to \"5bbc4f41998518144fd005b60bf85515abb98c8d\"",
    "created_at": "2021-07-06T19:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "5bbc4f41998518144fd005b60bf85515abb98c8d"



---

archive/issue_comments_639670.json:
```json
{
    "body": "Changing commit from \"5bbc4f41998518144fd005b60bf85515abb98c8d\" to \"b2517ecb6cbea6390e8c70cbcf18b315e82b03b8\"",
    "created_at": "2021-07-07T01:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5bbc4f41998518144fd005b60bf85515abb98c8d" to "b2517ecb6cbea6390e8c70cbcf18b315e82b03b8"



---

archive/issue_comments_639671.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T01:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639672.json:
```json
{
    "body": "Changing commit from \"b2517ecb6cbea6390e8c70cbcf18b315e82b03b8\" to \"461d5f623afd914c1ce9573db806f9235aef8100\"",
    "created_at": "2021-07-07T17:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b2517ecb6cbea6390e8c70cbcf18b315e82b03b8" to "461d5f623afd914c1ce9573db806f9235aef8100"



---

archive/issue_comments_639673.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T17:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639674.json:
```json
{
    "body": "Set assignee to @DavidAyotte.",
    "created_at": "2021-07-07T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639674",
    "user": "https://github.com/DavidAyotte"
}
```

Set assignee to @DavidAyotte.



---

archive/issue_comments_639675.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-07T17:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639675",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_639676.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n sage: M = ModularFormsRing(1)\n sage: f = (M.0)^3 + (M.1)^2;\n 2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)\n-sage: f.to_polynomial([M.0, M.1])\n+sage: f.to_polynomial(f)\n X^3 + Y^2\n ```\n \n``````\n",
    "created_at": "2021-07-07T17:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639676",
    "user": "https://github.com/DavidAyotte"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 sage: M = ModularFormsRing(1)
 sage: f = (M.0)^3 + (M.1)^2;
 2 - 288*q + 400032*q^2 + 33473664*q^3 + 796491936*q^4 + 9257371200*q^5 + O(q^6)
-sage: f.to_polynomial([M.0, M.1])
+sage: f.to_polynomial(f)
 X^3 + Y^2
 ```
 
``````




---

archive/issue_comments_639677.json:
```json
{
    "body": "Changing commit from \"461d5f623afd914c1ce9573db806f9235aef8100\" to \"1e6a262bcd6a89b4d6b72dec2005f861440f83c1\"",
    "created_at": "2021-07-12T13:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "461d5f623afd914c1ce9573db806f9235aef8100" to "1e6a262bcd6a89b4d6b72dec2005f861440f83c1"



---

archive/issue_comments_639678.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T13:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639679.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T20:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639679",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639680.json:
```json
{
    "body": "Changing commit from \"1e6a262bcd6a89b4d6b72dec2005f861440f83c1\" to \"7d8b20ae2b308dd7aecb3f34fc4a2e78c8f7b641\"",
    "created_at": "2021-07-12T20:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639680",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1e6a262bcd6a89b4d6b72dec2005f861440f83c1" to "7d8b20ae2b308dd7aecb3f34fc4a2e78c8f7b641"



---

archive/issue_comments_639681.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-27T08:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639681",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_639682.json:
```json
{
    "body": "<a id='comment:10'></a>The method `_monomials_of_weight` is hidden and it does not make much sense to have an `EXAMPLES` block for this. Furthermore, the code is not properly indented here.\n\nThe method `_weights_of_generators` is used only once in the code. It does not make much sense to have it given that its code is a single line.\n\nIn the documentation of `polynomial_ring` the generators are not unique. You would better change `Return the polynomial ring of which ``self`` is a quotient.` by `Return a polynomial ring of which ``self`` is a quotient.`.\n\nThe method `_monomials_of_weight` is used nowhere. After `:meth:` in the documentation you need to add backticks like `:meth:`my_method``. This was missing in `from_polynomial`.\n\nInstead of\n\n```\niter = 0\npoly = 0\nfor p in monomials.keys():\n    poly += soln[iter, 0]*p\n    iter += 1\n```\nyou would better write\n\n```\npoly = 0 # TODO : this should be the zero polynomial, not the integer 0\nfor iter, p in enumerate(monomials):\n    poly += soln[iter, 0]*p\n```",
    "created_at": "2021-07-27T08:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639682",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>The method `_monomials_of_weight` is hidden and it does not make much sense to have an `EXAMPLES` block for this. Furthermore, the code is not properly indented here.

The method `_weights_of_generators` is used only once in the code. It does not make much sense to have it given that its code is a single line.

In the documentation of `polynomial_ring` the generators are not unique. You would better change `Return the polynomial ring of which ``self`` is a quotient.` by `Return a polynomial ring of which ``self`` is a quotient.`.

The method `_monomials_of_weight` is used nowhere. After `:meth:` in the documentation you need to add backticks like `:meth:`my_method``. This was missing in `from_polynomial`.

Instead of

```
iter = 0
poly = 0
for p in monomials.keys():
    poly += soln[iter, 0]*p
    iter += 1
```
you would better write

```
poly = 0 # TODO : this should be the zero polynomial, not the integer 0
for iter, p in enumerate(monomials):
    poly += soln[iter, 0]*p
```



---

archive/issue_comments_639683.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T19:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639684.json:
```json
{
    "body": "Changing commit from \"7d8b20ae2b308dd7aecb3f34fc4a2e78c8f7b641\" to \"e4a974f3f233fd9568ef613cbd28b5f4bd83c877\"",
    "created_at": "2021-07-27T19:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7d8b20ae2b308dd7aecb3f34fc4a2e78c8f7b641" to "e4a974f3f233fd9568ef613cbd28b5f4bd83c877"



---

archive/issue_comments_639685.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-27T19:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639685",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_639686.json:
```json
{
    "body": "<a id='comment:12'></a>Thank you very much for the comments! Considering the method `_monomials_of_weight`, it is used in `sage/modular/modform/element.py`, line 3563 (for the method `_homogeneous_to_polynomial`). However, it is the only place that it is used. Should I make it not private, or simply erase the method and move the code inside the method `_homogeneous_to_polynomial`?",
    "created_at": "2021-07-27T19:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639686",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:12'></a>Thank you very much for the comments! Considering the method `_monomials_of_weight`, it is used in `sage/modular/modform/element.py`, line 3563 (for the method `_homogeneous_to_polynomial`). However, it is the only place that it is used. Should I make it not private, or simply erase the method and move the code inside the method `_homogeneous_to_polynomial`?



---

archive/issue_comments_639687.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-08-04T15:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_639688.json:
```json
{
    "body": "Changing commit from \"e4a974f3f233fd9568ef613cbd28b5f4bd83c877\" to \"d991d193a6eb6c9c021e991dbf31149f6da8ccff\"",
    "created_at": "2021-08-04T15:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e4a974f3f233fd9568ef613cbd28b5f4bd83c877" to "d991d193a6eb6c9c021e991dbf31149f6da8ccff"



---

archive/issue_comments_639689.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T18:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639690.json:
```json
{
    "body": "Changing commit from \"d991d193a6eb6c9c021e991dbf31149f6da8ccff\" to \"b23e726e64814a1b339e72c63e5a6fb3c9eb0a79\"",
    "created_at": "2021-08-04T18:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d991d193a6eb6c9c021e991dbf31149f6da8ccff" to "b23e726e64814a1b339e72c63e5a6fb3c9eb0a79"



---

archive/issue_comments_639691.json:
```json
{
    "body": "Changing author from \"\" to \"David Ayotte\"",
    "created_at": "2021-08-06T17:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639691",
    "user": "https://github.com/DavidAyotte"
}
```

Changing author from "" to "David Ayotte"



---

archive/issue_comments_639692.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-07T10:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639692",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_639693.json:
```json
{
    "body": "<a id='comment:16'></a>In `_homogeneous_to_polynomial` you call Sturm bound in two places (first one is inside a loop)\n\n```\nf[k].parent().sturm_bound()\nself[k].parent().sturm_bound()\n```\nThis is always the same value, right? I believe the code would be simpler to read if you initialized a variable\n\n```\nsturm_bound = M.modular_forms_of_weight(k).sturm_bound()\n```\nand use that instead.\n\n\nThere is a `TODO` left in the code\n\n```\npoly = 0 # TODO : this should be the zero polynomial, not the integer 0\n```\nSimilarly, in the sum\n\n```\n        dict_of_monomials = {}\n        for exponents in W:\n            monomial_forms = 1; monomial_poly = 1\n            iter = 0\n            for e, g in zip(exponents, gens):\n                monomial_forms *= self(g)**e\n                monomial_poly *= poly_parent.gen(iter)**e\n                iter += 1\n            dict_of_monomials[monomial_poly] = monomial_forms\n```\nThe `monomial_poly` should be the one from the polynomial ring. Not the Python integer one.\n\n\nIn the same piece of code, don't use `;`. Having two statements on the same line is more complicated to read.\n\n\nI don't understand why the ouptut of `_monomials_of_weight` is a dictionary. The latter is an expensive data structure (involving hasing of the keys). You don't seem to use the dictionary structure anywhere.",
    "created_at": "2021-08-07T10:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639693",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>In `_homogeneous_to_polynomial` you call Sturm bound in two places (first one is inside a loop)

```
f[k].parent().sturm_bound()
self[k].parent().sturm_bound()
```
This is always the same value, right? I believe the code would be simpler to read if you initialized a variable

```
sturm_bound = M.modular_forms_of_weight(k).sturm_bound()
```
and use that instead.


There is a `TODO` left in the code

```
poly = 0 # TODO : this should be the zero polynomial, not the integer 0
```
Similarly, in the sum

```
        dict_of_monomials = {}
        for exponents in W:
            monomial_forms = 1; monomial_poly = 1
            iter = 0
            for e, g in zip(exponents, gens):
                monomial_forms *= self(g)**e
                monomial_poly *= poly_parent.gen(iter)**e
                iter += 1
            dict_of_monomials[monomial_poly] = monomial_forms
```
The `monomial_poly` should be the one from the polynomial ring. Not the Python integer one.


In the same piece of code, don't use `;`. Having two statements on the same line is more complicated to read.


I don't understand why the ouptut of `_monomials_of_weight` is a dictionary. The latter is an expensive data structure (involving hasing of the keys). You don't seem to use the dictionary structure anywhere.



---

archive/issue_comments_639694.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-09T14:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639695.json:
```json
{
    "body": "Changing commit from \"b23e726e64814a1b339e72c63e5a6fb3c9eb0a79\" to \"3539dbb57c5c193a05c2a59b0eac900133368c00\"",
    "created_at": "2021-08-09T14:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b23e726e64814a1b339e72c63e5a6fb3c9eb0a79" to "3539dbb57c5c193a05c2a59b0eac900133368c00"



---

archive/issue_comments_639696.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-09T14:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639696",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_639697.json:
```json
{
    "body": "<a id='comment:18'></a>Thanks a lot for the review. I decided to remove `_monomials_of_weight` (and move the code inside `_homogeneous_to_polynomial`) because, as you pointed out, it is not used very often in the code. I believe that this eliminates a loop in the code. I also changed the dictionary structure to a list.",
    "created_at": "2021-08-09T14:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639697",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:18'></a>Thanks a lot for the review. I decided to remove `_monomials_of_weight` (and move the code inside `_homogeneous_to_polynomial`) because, as you pointed out, it is not used very often in the code. I believe that this eliminates a loop in the code. I also changed the dictionary structure to a list.



---

archive/issue_events_085067.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-10T17:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32135#event-85067"
}
```



---

archive/issue_comments_639698.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2021-08-10T17:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639698",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_639699.json:
```json
{
    "body": "<a id='comment:21'></a>I think there ought to be a test with a base ring different from `ZZ`.",
    "created_at": "2021-08-12T06:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639699",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>I think there ought to be a test with a base ring different from `ZZ`.



---

archive/issue_comments_639700.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T12:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639701.json:
```json
{
    "body": "Changing commit from \"3539dbb57c5c193a05c2a59b0eac900133368c00\" to \"182b16e6cf3a07d01b90de9073fb3f0be9acb0a2\"",
    "created_at": "2021-08-12T12:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3539dbb57c5c193a05c2a59b0eac900133368c00" to "182b16e6cf3a07d01b90de9073fb3f0be9acb0a2"



---

archive/issue_comments_639702.json:
```json
{
    "body": "<a id='comment:23'></a>Currently polynomial conversion does not work over base ring other than Q mostly because of the method `gens_form` (which only returns forms over Q no matter what the base ring is). There is also the method `generators` which only returns q-expansion, so I think that there might be more than just one change to do here. Hence, I think that this should be a topic of a new ticket (I was planning to open one soon) and I simply decided to add an `if` statement in order to check the base ring. What do you think?",
    "created_at": "2021-08-12T13:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639702",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:23'></a>Currently polynomial conversion does not work over base ring other than Q mostly because of the method `gens_form` (which only returns forms over Q no matter what the base ring is). There is also the method `generators` which only returns q-expansion, so I think that there might be more than just one change to do here. Hence, I think that this should be a topic of a new ticket (I was planning to open one soon) and I simply decided to add an `if` statement in order to check the base ring. What do you think?



---

archive/issue_comments_639703.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-16T15:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639703",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_639704.json:
```json
{
    "body": "<a id='comment:24'></a>It is fine for now.",
    "created_at": "2021-08-16T15:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639704",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>It is fine for now.



---

archive/issue_comments_639705.json:
```json
{
    "body": "<a id='comment:25'></a>I'm changing this to *needs work* because I will add input parsing for the element constructor (in order to check if the polynomial is a q-expansion).",
    "created_at": "2021-08-17T13:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639705",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:25'></a>I'm changing this to *needs work* because I will add input parsing for the element constructor (in order to check if the polynomial is a q-expansion).



---

archive/issue_comments_639706.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-08-17T13:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639706",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_639707.json:
```json
{
    "body": "Changing commit from \"182b16e6cf3a07d01b90de9073fb3f0be9acb0a2\" to \"b77460b5eb7e2b16d9f2a3c5295467e4077339be\"",
    "created_at": "2021-08-25T13:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "182b16e6cf3a07d01b90de9073fb3f0be9acb0a2" to "b77460b5eb7e2b16d9f2a3c5295467e4077339be"



---

archive/issue_comments_639708.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-25T13:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639709.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-25T13:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639709",
    "user": "https://github.com/DavidAyotte"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_639710.json:
```json
{
    "body": "<a id='comment:28'></a>Is this the expected behavior\n\n```\nsage: M = ModularFormsRing(1)\nsage: q,t = polygens(QQ, 'q,t')\nsage: M(q^2+t^3)\nTraceback (most recent call last):\n...\nNotImplementedError: conversion from q-expansion not yet implemented\n```",
    "created_at": "2021-08-26T07:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639710",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Is this the expected behavior

```
sage: M = ModularFormsRing(1)
sage: q,t = polygens(QQ, 'q,t')
sage: M(q^2+t^3)
Traceback (most recent call last):
...
NotImplementedError: conversion from q-expansion not yet implemented
```



---

archive/issue_comments_639711.json:
```json
{
    "body": "Changing commit from \"b77460b5eb7e2b16d9f2a3c5295467e4077339be\" to \"7d10c2d3da0360c95b1eafb1a17f9bfe2d60eb3a\"",
    "created_at": "2021-08-26T14:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b77460b5eb7e2b16d9f2a3c5295467e4077339be" to "7d10c2d3da0360c95b1eafb1a17f9bfe2d60eb3a"



---

archive/issue_comments_639712.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-26T14:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639713.json:
```json
{
    "body": "<a id='comment:30'></a>Hello Vincent,\n\nThank you for your comment, I changed a little bit the behavior of the code. What do you think? I'm all ears to any other ideas also.",
    "created_at": "2021-08-26T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639713",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:30'></a>Hello Vincent,

Thank you for your comment, I changed a little bit the behavior of the code. What do you think? I'm all ears to any other ideas also.



---

archive/issue_comments_639714.json:
```json
{
    "body": "<a id='comment:31'></a>Hi David,\n\nI don't like the fact that we rely on variable names to parse user input. What about using univariate (for q-expansion) versus multivariate (for generators)?\n\nAlso, you sometimes use `defaults.DEFAULT_VARIABLE` and sometimes the string `'q'`. The usage could be cleaner.",
    "created_at": "2021-08-27T15:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639714",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>Hi David,

I don't like the fact that we rely on variable names to parse user input. What about using univariate (for q-expansion) versus multivariate (for generators)?

Also, you sometimes use `defaults.DEFAULT_VARIABLE` and sometimes the string `'q'`. The usage could be cleaner.



---

archive/issue_comments_639715.json:
```json
{
    "body": "<a id='comment:32'></a>(cleaner and tested)",
    "created_at": "2021-08-27T15:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639715",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>(cleaner and tested)



---

archive/issue_comments_639716.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-27T19:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_639717.json:
```json
{
    "body": "Changing commit from \"7d10c2d3da0360c95b1eafb1a17f9bfe2d60eb3a\" to \"2cdb21a48ab1b92273f43acc235b07f71e585a73\"",
    "created_at": "2021-08-27T19:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7d10c2d3da0360c95b1eafb1a17f9bfe2d60eb3a" to "2cdb21a48ab1b92273f43acc235b07f71e585a73"



---

archive/issue_comments_639718.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:31 vdelecroix]:\n> Hi David,\n> \n> I don't like the fact that we rely on variable names to parse user input. What about using univariate (for q-expansion) versus multivariate (for generators)?\n> \n> Also, you sometimes use `defaults.DEFAULT_VARIABLE` and sometimes the string `'q'`. The usage could be cleaner.\n\n\nThank you for your feedback! I decided to drop completely the case for a univariate polynomial. At first, I wanted the code to work even if the number of variables was less or equal to the number of generators, but it turned out to be confusing with q-expansion, so as you said it is better to stick with multivariate polynomials. I also added some details in the documentation in order to make it clearer for the user (is it?). \n\nFor q-expansion, I think it will be better to stick with power series (and not univariate polynomial) instead in order to be consistent with the spaces of weighted modular forms:\n\n```\nsage: M = ModularForms(1, 4)\nsage: q = polygen(QQ, 'q')\nsage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 # Univariate polynomial\nsage: M(E4)\nTraceback (most recent call last):\n...\nTypeError: can't initialize vector from nonzero non-list\nsage: P.<q> = PowerSeriesRing(QQ)\nsage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 + O(q^6) # Power series\nsage: M(E4)\n1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 + O(q^6)\n```\n\nMoreover, observe that we have the following behavior:\n\n```\nsage: P.<q> = PowerSeriesRing(QQ)\nsage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 # Exact power series\nsage: M(E4)\nTraceback (most recent call last):\n...\nTypeError: unable to create modular form from exact non-zero polynomial\n```\n\nHowever, I do find the error message \"can't initialize vector from nonzero non-list\" not very explicit for the user (but that's an issue for an other ticket).",
    "created_at": "2021-08-27T19:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639718",
    "user": "https://github.com/DavidAyotte"
}
```

<a id='comment:34'></a>Replying to [comment:31 vdelecroix]:
> Hi David,
> 
> I don't like the fact that we rely on variable names to parse user input. What about using univariate (for q-expansion) versus multivariate (for generators)?
> 
> Also, you sometimes use `defaults.DEFAULT_VARIABLE` and sometimes the string `'q'`. The usage could be cleaner.


Thank you for your feedback! I decided to drop completely the case for a univariate polynomial. At first, I wanted the code to work even if the number of variables was less or equal to the number of generators, but it turned out to be confusing with q-expansion, so as you said it is better to stick with multivariate polynomials. I also added some details in the documentation in order to make it clearer for the user (is it?). 

For q-expansion, I think it will be better to stick with power series (and not univariate polynomial) instead in order to be consistent with the spaces of weighted modular forms:

```
sage: M = ModularForms(1, 4)
sage: q = polygen(QQ, 'q')
sage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 # Univariate polynomial
sage: M(E4)
Traceback (most recent call last):
...
TypeError: can't initialize vector from nonzero non-list
sage: P.<q> = PowerSeriesRing(QQ)
sage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 + O(q^6) # Power series
sage: M(E4)
1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 + O(q^6)
```

Moreover, observe that we have the following behavior:

```
sage: P.<q> = PowerSeriesRing(QQ)
sage: E4 = 1 + 240*q + 2160*q^2 + 6720*q^3 + 17520*q^4 + 30240*q^5 # Exact power series
sage: M(E4)
Traceback (most recent call last):
...
TypeError: unable to create modular form from exact non-zero polynomial
```

However, I do find the error message "can't initialize vector from nonzero non-list" not very explicit for the user (but that's an issue for an other ticket).



---

archive/issue_comments_639719.json:
```json
{
    "body": "<a id='comment:35'></a>Good point. I agree that compatibility with modular forms come first. The interface there is reasonable, to specify zero leading coefficients you need the O(q^n).",
    "created_at": "2021-08-28T06:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639719",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>Good point. I agree that compatibility with modular forms come first. The interface there is reasonable, to specify zero leading coefficients you need the O(q^n).



---

archive/issue_comments_639720.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-30T09:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639720",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_639721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-31T22:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639721",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_085068.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-31T22:00:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32135#event-85068"
}
```



---

archive/issue_comments_639722.json:
```json
{
    "body": "Changing branch from \"u/gh-DavidAyotte/modform_to_polynomials_generators\" to \"2cdb21a48ab1b92273f43acc235b07f71e585a73\"",
    "created_at": "2021-08-31T22:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32135#issuecomment-639722",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-DavidAyotte/modform_to_polynomials_generators" to "2cdb21a48ab1b92273f43acc235b07f71e585a73"
