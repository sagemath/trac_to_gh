# Issue 32843: Fix scipy-1.7.2 build failure on Cygwin

archive/issues_032843.json:
```json
{
    "body": "CC:  @dimpase @mkoeppe @slel\n\nKeywords: build, cygwin, scipy\n\nSage 9.5.beta9 + #33043 fails to build scipy-1.7.2\non Cygwin.\n\nInitial report:\n- [sage-release, 2021-12](https://groups.google.com/g/sage-release/c/V9KflJYxHrk/m/gJIZHkegDQAJ)\n\nIssues/PRs:\n- https://github.com/boostorg/math/pull/727 - add Cygwin CI (superseded by 729)\n- https://github.com/boostorg/math/pull/728 - boost_math_tools_config.patch (superseded by 729)\n- https://github.com/boostorg/math/pull/729 - combined PR (merged)\n- https://github.com/scipy/scipy/issues/15296 - SciPy 1.7.x build failure on Cygwin\n- https://github.com/scipy/boost-headers-only/pull/5\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33080\n\n",
    "closed_at": "2022-01-01T00:23:00Z",
    "created_at": "2021-12-25T04:52:44Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Fix scipy-1.7.2 build failure on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32843",
    "user": "https://github.com/slel"
}
```
CC:  @dimpase @mkoeppe @slel

Keywords: build, cygwin, scipy

Sage 9.5.beta9 + #33043 fails to build scipy-1.7.2
on Cygwin.

Initial report:
- [sage-release, 2021-12](https://groups.google.com/g/sage-release/c/V9KflJYxHrk/m/gJIZHkegDQAJ)

Issues/PRs:
- https://github.com/boostorg/math/pull/727 - add Cygwin CI (superseded by 729)
- https://github.com/boostorg/math/pull/728 - boost_math_tools_config.patch (superseded by 729)
- https://github.com/boostorg/math/pull/729 - combined PR (merged)
- https://github.com/scipy/scipy/issues/15296 - SciPy 1.7.x build failure on Cygwin
- https://github.com/scipy/boost-headers-only/pull/5



Issue created by migration from https://trac.sagemath.org/ticket/33080





---

archive/issue_comments_467657.json:
```json
{
    "body": "logs please",
    "created_at": "2021-12-25T08:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467657",
    "user": "https://github.com/dimpase"
}
```

logs please



---

archive/issue_comments_467658.json:
```json
{
    "body": "I see this build failure now also in https://github.com/mkoeppe/sage/runs/4635610425?check_suite_focus=true (tested with the update to 1.7.3 in #33049)",
    "created_at": "2021-12-26T19:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467658",
    "user": "https://github.com/mkoeppe"
}
```

I see this build failure now also in https://github.com/mkoeppe/sage/runs/4635610425?check_suite_focus=true (tested with the update to 1.7.3 in #33049)



---

archive/issue_comments_467659.json:
```json
{
    "body": "```\n  scipy/stats/_boost/src/beta_ufunc.cxx:3903:46:   required from here\n  /opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost/boost/math/tools/promotion.hpp:148:37: error: static assertion failed: Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.\n    148 |          BOOST_STATIC_ASSERT_MSG((0 == ::boost::is_same<type, long double>::value), \"Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.\");\nerror: Command \"g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -D_GNU_SOURCE -DBOOST_MATH_DOMAIN_ERROR_POLICY=ignore_error -DBOOST_MATH_EVALUATION_ERROR_POLICY=user_error -DBOOST_MATH_PROMOTE_DOUBLE_POLICY=false -Iscipy/stats/_boost/include/ -Iscipy/stats/_boost/src/ -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -Ibuild/src.cygwin-3.3.3-x86_64-3.8/numpy/distutils/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/include -I/usr/include/python3.8 -c scipy/stats/_boost/src/beta_ufunc.cxx -o build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o -MMD -MF build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o.d -std=c++14 -msse -msse2 -msse3\" failed with exit status 1\n```",
    "created_at": "2021-12-26T19:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467659",
    "user": "https://github.com/mkoeppe"
}
```

```
  scipy/stats/_boost/src/beta_ufunc.cxx:3903:46:   required from here
  /opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost/boost/math/tools/promotion.hpp:148:37: error: static assertion failed: Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.
    148 |          BOOST_STATIC_ASSERT_MSG((0 == ::boost::is_same<type, long double>::value), "Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.");
error: Command "g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -D_GNU_SOURCE -DBOOST_MATH_DOMAIN_ERROR_POLICY=ignore_error -DBOOST_MATH_EVALUATION_ERROR_POLICY=user_error -DBOOST_MATH_PROMOTE_DOUBLE_POLICY=false -Iscipy/stats/_boost/include/ -Iscipy/stats/_boost/src/ -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -Ibuild/src.cygwin-3.3.3-x86_64-3.8/numpy/distutils/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/include -I/usr/include/python3.8 -c scipy/stats/_boost/src/beta_ufunc.cxx -o build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o -MMD -MF build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o.d -std=c++14 -msse -msse2 -msse3" failed with exit status 1
```



---

archive/issue_comments_467660.json:
```json
{
    "body": "Use of (vendored) `boost` was introduced in scipy 1.7.0",
    "created_at": "2021-12-26T19:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467660",
    "user": "https://github.com/mkoeppe"
}
```

Use of (vendored) `boost` was introduced in scipy 1.7.0



---

archive/issue_comments_467661.json:
```json
{
    "body": "This is with gcc-g++ 11.2.0-1",
    "created_at": "2021-12-26T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467661",
    "user": "https://github.com/mkoeppe"
}
```

This is with gcc-g++ 11.2.0-1



---

archive/issue_comments_467662.json:
```json
{
    "body": "This is coming in through https://github.com/scipy/boost-headers-only/blob/ca02b3b71579fe4913e3e4d1153c34868ec95769/boost/math/tools/config.hpp#L31",
    "created_at": "2021-12-26T19:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467662",
    "user": "https://github.com/mkoeppe"
}
```

This is coming in through https://github.com/scipy/boost-headers-only/blob/ca02b3b71579fe4913e3e4d1153c34868ec95769/boost/math/tools/config.hpp#L31



---

archive/issue_comments_467663.json:
```json
{
    "body": "Also affects FreeBSD apparently, and the porters just patch it out: https://cgit.freebsd.org/ports/tree/science/py-scipy/files/patch-scipy___lib_boost_boost_math_tools_config.hpp",
    "created_at": "2021-12-26T19:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467663",
    "user": "https://github.com/mkoeppe"
}
```

Also affects FreeBSD apparently, and the porters just patch it out: https://cgit.freebsd.org/ports/tree/science/py-scipy/files/patch-scipy___lib_boost_boost_math_tools_config.hpp



---

archive/issue_comments_467664.json:
```json
{
    "body": "Upstream boost: https://github.com/boostorg/math/blob/develop/include/boost/math/tools/config.hpp",
    "created_at": "2021-12-26T19:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467664",
    "user": "https://github.com/mkoeppe"
}
```

Upstream boost: https://github.com/boostorg/math/blob/develop/include/boost/math/tools/config.hpp



---

archive/issue_comments_467665.json:
```json
{
    "body": "Neither of these projects has a Cygwin CI (and obviously no FreeBSD CI):\n- https://github.com/boostorg/math/blob/develop/.github/workflows/ci.yml\n- https://github.com/scipy/scipy/tree/master/.github/workflows",
    "created_at": "2021-12-26T20:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467665",
    "user": "https://github.com/mkoeppe"
}
```

Neither of these projects has a Cygwin CI (and obviously no FreeBSD CI):
- https://github.com/boostorg/math/blob/develop/.github/workflows/ci.yml
- https://github.com/scipy/scipy/tree/master/.github/workflows



---

archive/issue_comments_467666.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-12-26T20:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467666",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_467667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-26T20:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467667",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467668.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-26T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467668",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_467669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-26T21:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467670.json:
```json
{
    "body": "I don't seem to be getting Windows runners on GH Actions at the moment, so manual testing of this branch on Cygwin would be helpful",
    "created_at": "2021-12-27T00:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467670",
    "user": "https://github.com/mkoeppe"
}
```

I don't seem to be getting Windows runners on GH Actions at the moment, so manual testing of this branch on Cygwin would be helpful



---

archive/issue_comments_467671.json:
```json
{
    "body": "This branch fixes the issue, as can be seen in the successful run https://github.com/mkoeppe/sage/runs/4646463107?check_suite_focus=true",
    "created_at": "2021-12-28T04:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467671",
    "user": "https://github.com/mkoeppe"
}
```

This branch fixes the issue, as can be seen in the successful run https://github.com/mkoeppe/sage/runs/4646463107?check_suite_focus=true



---

archive/issue_comments_467672.json:
```json
{
    "body": "This lets the scipy-1.7.2 spkg build for me.\n\nThanks for the fix and for sending pull requests\nto Boost and opening an issue for SciPy.\n\nShould the the patch or the commit messages\nmention the inspiration is from FreeBSD?\n\nOr is the discussion here enough?\n\nOne way or the other, you can set to\npositive review on my behalf.",
    "created_at": "2021-12-28T07:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467672",
    "user": "https://github.com/slel"
}
```

This lets the scipy-1.7.2 spkg build for me.

Thanks for the fix and for sending pull requests
to Boost and opening an issue for SciPy.

Should the the patch or the commit messages
mention the inspiration is from FreeBSD?

Or is the discussion here enough?

One way or the other, you can set to
positive review on my behalf.



---

archive/issue_comments_467673.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-28T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467673",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467674.json:
```json
{
    "body": "Thanks for testing!",
    "created_at": "2021-12-28T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467674",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for testing!



---

archive/issue_comments_467675.json:
```json
{
    "body": "Replying to [comment:23 slelievre]:\n> Should the the patch or the commit messages\n> mention the inspiration is from FreeBSD?\n> \n> Or is the discussion here enough?\n\n\nI think it's fine as is.",
    "created_at": "2021-12-28T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467675",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:23 slelievre]:
> Should the the patch or the commit messages
> mention the inspiration is from FreeBSD?
> 
> Or is the discussion here enough?


I think it's fine as is.



---

archive/issue_comments_467676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-01T00:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32843#issuecomment-467676",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087408.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32843",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32843#event-87408"
}
```
