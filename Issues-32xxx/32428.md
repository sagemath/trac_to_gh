# Issue 32428: Another fix in the usage of MixedIntegerLinearProgram in sage.graphs.connectivity

archive/issues_032191.json:
```json
{
    "body": "Part of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in sage.combinat, sage.graphs).\n\nHere we avoid the use of `Integer(round(p.solve(...)))` whenever possible.\n\nCC:  @mkoeppe @tscrim @dimpase\n\nBranch/Commit: a00051928e22ad7cd407b7c6fc8ff462021ba2c2\n\nReviewer: Matthias Koeppe\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32428\n\n",
    "closed_at": "2021-09-19T09:58:57Z",
    "created_at": "2021-08-27T10:41:23Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Another fix in the usage of MixedIntegerLinearProgram in sage.graphs.connectivity",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32428",
    "user": "https://github.com/dcoudert"
}
```
Part of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in sage.combinat, sage.graphs).

Here we avoid the use of `Integer(round(p.solve(...)))` whenever possible.

CC:  @mkoeppe @tscrim @dimpase

Branch/Commit: a00051928e22ad7cd407b7c6fc8ff462021ba2c2

Reviewer: Matthias Koeppe

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32428





---

archive/issue_comments_646041.json:
```json
{
    "body": "Changing branch from \"\" to \"public/graphs/32428_connectivity\"",
    "created_at": "2021-08-27T10:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646041",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/graphs/32428_connectivity"



---

archive/issue_comments_646042.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is a proposal for avoiding some calls to `Integer(round(...))` on the objective value. To do so, we use our new functionalities. It is cleaner this way.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|\n|[1fb57d4](https://git.sagemath.org/sage.git/commit?id=1fb57d4cf44a383b1c9946886206a300208652b8)|`trac #32428: avoid some rounding in sage.graphs.connectivity.pyx`|",
    "created_at": "2021-08-27T10:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646042",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>
This is a proposal for avoiding some calls to `Integer(round(...))` on the objective value. To do so, we use our new functionalities. It is cleaner this way.

---
New commits:
|                                                                                                                                          |                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
|[1fb57d4](https://git.sagemath.org/sage.git/commit?id=1fb57d4cf44a383b1c9946886206a300208652b8)|`trac #32428: avoid some rounding in sage.graphs.connectivity.pyx`|



---

archive/issue_comments_646043.json:
```json
{
    "body": "Changing commit from \"\" to \"1fb57d4cf44a383b1c9946886206a300208652b8\"",
    "created_at": "2021-08-27T10:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646043",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "1fb57d4cf44a383b1c9946886206a300208652b8"



---

archive/issue_comments_646044.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think a better solution would be to just recompute the objective function on the retrieved solution instead of getting it from the solver.",
    "created_at": "2021-08-27T19:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646044",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
I think a better solution would be to just recompute the objective function on the retrieved solution instead of getting it from the solver.



---

archive/issue_comments_646045.json:
```json
{
    "body": "Changing commit from \"1fb57d4cf44a383b1c9946886206a300208652b8\" to \"1a99e52973022e362278bae400cbb4d082dcd8d7\"",
    "created_at": "2021-08-27T20:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1fb57d4cf44a383b1c9946886206a300208652b8" to "1a99e52973022e362278bae400cbb4d082dcd8d7"



---

archive/issue_comments_646046.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[1a99e52](https://git.sagemath.org/sage.git/commit/?id=1a99e52973022e362278bae400cbb4d082dcd8d7)|`trac #32428: recompute the objective value instead of rounding`|",
    "created_at": "2021-08-27T20:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[1a99e52](https://git.sagemath.org/sage.git/commit/?id=1a99e52973022e362278bae400cbb4d082dcd8d7)|`trac #32428: recompute the objective value instead of rounding`|



---

archive/issue_comments_646047.json:
```json
{
    "body": "<a id='comment:4'></a>\nI only have a small doubt about parameter `objective_only` of method `solve`. It seems that it is not used so it's ok. Otherwise, we may (really?) be in a situation in which we have the objective value but not the values of the variables.",
    "created_at": "2021-08-27T20:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646047",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>
I only have a small doubt about parameter `objective_only` of method `solve`. It seems that it is not used so it's ok. Otherwise, we may (really?) be in a situation in which we have the objective value but not the values of the variables.



---

archive/issue_comments_646048.json:
```json
{
    "body": "<a id='comment:5'></a>\nProbably better not to pass it to `solve`.",
    "created_at": "2021-09-02T03:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646048",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Probably better not to pass it to `solve`.



---

archive/issue_comments_646049.json:
```json
{
    "body": "Changing commit from \"1a99e52973022e362278bae400cbb4d082dcd8d7\" to \"f941c59f972866e54d368992125f9f4ae0cdbe5d\"",
    "created_at": "2021-09-02T16:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1a99e52973022e362278bae400cbb4d082dcd8d7" to "f941c59f972866e54d368992125f9f4ae0cdbe5d"



---

archive/issue_comments_646050.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[5b1b7bb](https://git.sagemath.org/sage.git/commit/?id=5b1b7bbc8912e332bb4d349b6b42fd3b52e8ca39)|`trac #32428: merged with 9.5.beta0`|\n|[f941c59](https://git.sagemath.org/sage.git/commit/?id=f941c59f972866e54d368992125f9f4ae0cdbe5d)|`trac #32428: avoid using parameter objective_only of solve`|",
    "created_at": "2021-09-02T16:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[5b1b7bb](https://git.sagemath.org/sage.git/commit/?id=5b1b7bbc8912e332bb4d349b6b42fd3b52e8ca39)|`trac #32428: merged with 9.5.beta0`|
|[f941c59](https://git.sagemath.org/sage.git/commit/?id=f941c59f972866e54d368992125f9f4ae0cdbe5d)|`trac #32428: avoid using parameter objective_only of solve`|



---

archive/issue_comments_646051.json:
```json
{
    "body": "<a id='comment:7'></a>\nI agree. I have removed the parameter from calls to solve.",
    "created_at": "2021-09-02T16:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646051",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>
I agree. I have removed the parameter from calls to solve.



---

archive/issue_comments_646052.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-02T16:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646052",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_646053.json:
```json
{
    "body": "<a id='comment:8'></a>\n\n```\n+            obj = sum(in_cut[u, v] for u, v in g.edge_iterator(labels=False) if in_cut[u, v])\n```\nThis can be simplified to `sum(1 for ...)`",
    "created_at": "2021-09-02T18:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646053",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>

```
+            obj = sum(in_cut[u, v] for u, v in g.edge_iterator(labels=False) if in_cut[u, v])
```
This can be simplified to `sum(1 for ...)`



---

archive/issue_comments_646054.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[f881d09](https://git.sagemath.org/sage.git/commit/?id=f881d094aa6df96cb2afccfba3b1c535d12ee150)|`trac #32428: better sums`|",
    "created_at": "2021-09-02T19:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[f881d09](https://git.sagemath.org/sage.git/commit/?id=f881d094aa6df96cb2afccfba3b1c535d12ee150)|`trac #32428: better sums`|



---

archive/issue_comments_646055.json:
```json
{
    "body": "Changing commit from \"f941c59f972866e54d368992125f9f4ae0cdbe5d\" to \"f881d094aa6df96cb2afccfba3b1c535d12ee150\"",
    "created_at": "2021-09-02T19:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f941c59f972866e54d368992125f9f4ae0cdbe5d" to "f881d094aa6df96cb2afccfba3b1c535d12ee150"



---

archive/issue_comments_646056.json:
```json
{
    "body": "<a id='comment:10'></a>\nRight. done.",
    "created_at": "2021-09-02T19:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646056",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
Right. done.



---

archive/issue_comments_646057.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis one too:\n\n```\n+            obj = sum(in_cut[frozenset((u, v))]\n+                          for u, v in g.edge_iterator(labels=False) if in_cut[frozenset((u, v))])\n```",
    "created_at": "2021-09-02T19:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646057",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
This one too:

```
+            obj = sum(in_cut[frozenset((u, v))]
+                          for u, v in g.edge_iterator(labels=False) if in_cut[frozenset((u, v))])
```



---

archive/issue_comments_646058.json:
```json
{
    "body": "Changing commit from \"f881d094aa6df96cb2afccfba3b1c535d12ee150\" to \"a00051928e22ad7cd407b7c6fc8ff462021ba2c2\"",
    "created_at": "2021-09-02T20:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f881d094aa6df96cb2afccfba3b1c535d12ee150" to "a00051928e22ad7cd407b7c6fc8ff462021ba2c2"



---

archive/issue_comments_646059.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[a000519](https://git.sagemath.org/sage.git/commit/?id=a00051928e22ad7cd407b7c6fc8ff462021ba2c2)|`trac #32428: more corrections`|",
    "created_at": "2021-09-02T20:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[a000519](https://git.sagemath.org/sage.git/commit/?id=a00051928e22ad7cd407b7c6fc8ff462021ba2c2)|`trac #32428: more corrections`|



---

archive/issue_comments_646060.json:
```json
{
    "body": "<a id='comment:13'></a>\noups, right.",
    "created_at": "2021-09-02T20:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646060",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:13'></a>
oups, right.



---

archive/issue_comments_646061.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-09-02T20:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646061",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_646062.json:
```json
{
    "body": "<a id='comment:14'></a>\nLGTM; green bot => positive review",
    "created_at": "2021-09-02T20:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646062",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
LGTM; green bot => positive review



---

archive/issue_comments_646063.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-03T06:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646063",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_646064.json:
```json
{
    "body": "<a id='comment:15'></a>\nso then. Thank you for the review.",
    "created_at": "2021-09-03T06:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646064",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
so then. Thank you for the review.



---

archive/issue_comments_646065.json:
```json
{
    "body": "<a id='comment:16'></a>\nTo go further (maybe in a follow-up ticket\ngiven the two-weeks-old positive review):\n\n```diff\n-            obj = sum(1 for u, v in g.edge_iterator(labels=False) if in_cut[frozenset((u, v))])\n+            obj = sum(1 for uv in g.edge_iterator(labels=False) if in_cut[frozenset(uv)])\n```\n\n```diff\n-    p.set_objective(p.sum(in_set[1, v] for v in g))\n+    p.set_objective(p.sum(1 for v in g if in_set[1, v]))\n```",
    "created_at": "2021-09-16T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646065",
    "user": "https://github.com/slel"
}
```

<a id='comment:16'></a>
To go further (maybe in a follow-up ticket
given the two-weeks-old positive review):

```diff
-            obj = sum(1 for u, v in g.edge_iterator(labels=False) if in_cut[frozenset((u, v))])
+            obj = sum(1 for uv in g.edge_iterator(labels=False) if in_cut[frozenset(uv)])
```

```diff
-    p.set_objective(p.sum(in_set[1, v] for v in g))
+    p.set_objective(p.sum(1 for v in g if in_set[1, v]))
```



---

archive/issue_comments_646066.json:
```json
{
    "body": "<a id='comment:17'></a>\nI agree for the first remark, but not for the second. The objective function needs variables ;)",
    "created_at": "2021-09-16T08:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646066",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'></a>
I agree for the first remark, but not for the second. The objective function needs variables ;)



---

archive/issue_comments_646067.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-19T09:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646067",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_646068.json:
```json
{
    "body": "Changing branch from \"public/graphs/32428_connectivity\" to \"a00051928e22ad7cd407b7c6fc8ff462021ba2c2\"",
    "created_at": "2021-09-19T09:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32428#issuecomment-646068",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/graphs/32428_connectivity" to "a00051928e22ad7cd407b7c6fc8ff462021ba2c2"



---

archive/issue_events_086027.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-19T09:58:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32428",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32428#event-86027"
}
```
