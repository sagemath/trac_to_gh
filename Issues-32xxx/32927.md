# Issue 32927: build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py

archive/issues_032690.json:
```json
{
    "body": "Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes \"stale\" installed files.\n\nThe installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib** (#29864). \n- `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed\n- but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.\n\nIn this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.\n\n\n(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower. Also, the idea of just making `./configure --enable-editable` the default, #32406, has met skepticism.)\n\n\n**CC:**  @kiwifb @jhpalmieri\n\n**Branch:** [u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional)\n\n**Commit:** [edd0ea1df972480984837a1aa4d54bb3ede6ab62](https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62)\n\n**Work Issues:** Do not build_ext\n\n**Reviewer:** Kwankyu Lee\n\n**Dependencies:** #32874\n\nIssue created by migration from https://trac.sagemath.org/ticket/32927\n\n",
    "closed_at": "2022-11-14T19:36:43Z",
    "created_at": "2021-11-24T07:09:16Z",
    "labels": [
        "component: build",
        "enhancement",
        "invalid"
    ],
    "title": "build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/32927",
    "user": "https://github.com/mkoeppe"
}
```
Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes "stale" installed files.

The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib** (#29864). 
- `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed
- but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.

In this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.


(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower. Also, the idea of just making `./configure --enable-editable` the default, #32406, has met skepticism.)


**CC:**  @kiwifb @jhpalmieri

**Branch:** [u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional)

**Commit:** [edd0ea1df972480984837a1aa4d54bb3ede6ab62](https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62)

**Work Issues:** Do not build_ext

**Reviewer:** Kwankyu Lee

**Dependencies:** #32874

Issue created by migration from https://trac.sagemath.org/ticket/32927





---

archive/issue_comments_534478.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n ... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).\n \n-\n+As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`\n``````\n",
    "created_at": "2021-11-26T01:00:53Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534478",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 ... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).
 
-
+As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`
``````




---

archive/issue_comments_534479.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n ... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).\n \n-As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`\n+(As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`.)\n+\n+We also move the installation cleaner from `pkgs/sagemath-standard/setup.py` to this package.\n+\n+\n``````\n",
    "created_at": "2021-11-26T22:53:16Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534479",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 ... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).
 
-As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`
+(As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`.)
+
+We also move the installation cleaner from `pkgs/sagemath-standard/setup.py` to this package.
+
+
``````




---

archive/issue_comments_534480.json:
```json
{
    "body": "**Dependencies:** #31386, #32899",
    "created_at": "2021-11-26T22:53:16Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534480",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31386, #32899



---

archive/issue_events_295342.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-27T21:04:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "rename": {
        "from": "pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional",
        "to": "build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295342"
}
```



---

archive/issue_comments_534481.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,2 @@\n-... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).\n+We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.\n \n-(As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`.)\n-\n-We also move the installation cleaner from `pkgs/sagemath-standard/setup.py` to this package.\n-\n-\n``````\n",
    "created_at": "2021-11-27T21:04:38Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534481",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,2 @@
-... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).
+We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.
 
-(As an alternative, we could also have `configure` generate a `requirements.txt` with @ links into `SAGE_ROOT/pkgs/`.)
-
-We also move the installation cleaner from `pkgs/sagemath-standard/setup.py` to this package.
-
-
``````




---

archive/issue_comments_534482.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,5 @@\n We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.\n \n+This is also a preparation for namespace packages. \n+The installation cleaner should only be run once, when all namespace packages filling the namespace `sage.*` are installed.\n+\n``````\n",
    "created_at": "2021-11-27T21:15:57Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534482",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,5 @@
 We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.
 
+This is also a preparation for namespace packages. 
+The installation cleaner should only be run once, when all namespace packages filling the namespace `sage.*` are installed.
+
``````




---

archive/issue_comments_534483.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,11 @@\n-We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.\n+Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes \"stale\" installed files.\n \n-This is also a preparation for namespace packages. \n-The installation cleaner should only be run once, when all namespace packages filling the namespace `sage.*` are installed.\n+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. \n+- `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed\n+- but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.\n \n+In this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.\n+\n+\n+(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower.)\n+\n``````\n",
    "created_at": "2021-11-27T21:39:16Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534483",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,11 @@
-We move the installation cleaner from `pkgs/sagemath-standard/setup.py` to a new location. It is only to be used by sage-the-distribution.
+Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes "stale" installed files.
 
-This is also a preparation for namespace packages. 
-The installation cleaner should only be run once, when all namespace packages filling the namespace `sage.*` are installed.
+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. 
+- `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed
+- but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.
 
+In this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.
+
+
+(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower.)
+
``````




---

archive/issue_comments_534484.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-11-27T21:39:16Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534484",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_295343.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-27T21:39:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295343"
}
```



---

archive/issue_events_295344.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-27T21:39:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295344"
}
```



---

archive/issue_comments_534485.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n In this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.\n \n \n-(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower.)\n+(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower. Also, the idea of just making `./configure --enable-editable` the default, #32406, has met skepticism.)\n \n``````\n",
    "created_at": "2021-11-27T21:40:39Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534485",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 In this ticket we solve this problem by removing the use of the installation cleaner from `pkgs/sagemath-standard/setup.py`. Instead we invoke it separately at the end of the installation script `build/pkgs/sagelib/spkg-install`.
 
 
-(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower.)
+(An alternative solution, replacing this installation procedure by a standard installation procedure using wheels, as proposed in #32874, would make `sage -b` much slower. Also, the idea of just making `./configure --enable-editable` the default, #32406, has met skepticism.)
 
``````




---

archive/issue_comments_534486.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional)",
    "created_at": "2021-11-27T21:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534486",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional)



---

archive/issue_events_295345.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-27T21:41:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295345"
}
```



---

archive/issue_comments_534487.json:
```json
{
    "body": "**Commit:** [00d5f59a1ec73a6c30152a8005fab338d1ef723b](https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b)",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534487",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [00d5f59a1ec73a6c30152a8005fab338d1ef723b](https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b)



---

archive/issue_comments_534488.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d\">77c957f</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651\">9375ef8</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9\">c6fc111</a></td><td><code>Prettier diagram</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb\">7d6a44c</a></td><td><code>Use :mod: as markup for packages/modules</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc\">f83d424</a></td><td><code>Improve ABC example</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f\">817a8d0</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f\">b555735</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81e9c9a2f3ecad50854d98fe541869b64b4ea2f4\">81e9c9a</a></td><td><code>Merge #32899</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecc0886d2a3080c97ec0fbf70ac68210f325c712\">ecc0886</a></td><td><code>Merge #31386</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b\">00d5f59</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr></table>\n",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534488",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d">77c957f</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651">9375ef8</a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9">c6fc111</a></td><td><code>Prettier diagram</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb">7d6a44c</a></td><td><code>Use :mod: as markup for packages/modules</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc">f83d424</a></td><td><code>Improve ABC example</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f">817a8d0</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f">b555735</a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81e9c9a2f3ecad50854d98fe541869b64b4ea2f4">81e9c9a</a></td><td><code>Merge #32899</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecc0886d2a3080c97ec0fbf70ac68210f325c712">ecc0886</a></td><td><code>Merge #31386</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b">00d5f59</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr></table>




---

archive/issue_events_295346.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295346"
}
```



---

archive/issue_events_295347.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295347"
}
```



---

archive/issue_comments_534489.json:
```json
{
    "body": "<a id='comment:9'></a>\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534489",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_comments_534490.json:
```json
{
    "body": "**Changing commit** from \"[00d5f59a1ec73a6c30152a8005fab338d1ef723b](https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b)\" to \"[2d08b696221eaaac9e03cea778dfa66d968e599a](https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a)\".",
    "created_at": "2022-01-23T06:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[00d5f59a1ec73a6c30152a8005fab338d1ef723b](https://github.com/sagemath/sagetrac-mirror/commit/00d5f59a1ec73a6c30152a8005fab338d1ef723b)" to "[2d08b696221eaaac9e03cea778dfa66d968e599a](https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a)".



---

archive/issue_comments_534491.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a\">2d08b69</a></td><td><code>Merge tag '9.5.rc3' into t/32927/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional</code></td></tr></table>\n",
    "created_at": "2022-01-23T06:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a">2d08b69</a></td><td><code>Merge tag '9.5.rc3' into t/32927/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional</code></td></tr></table>




---

archive/issue_comments_534492.json:
```json
{
    "body": "**Changing dependencies** from \"#31386, #32899\" to \"\".",
    "created_at": "2022-01-23T06:11:43Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534492",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31386, #32899" to "".



---

archive/issue_comments_534493.json:
```json
{
    "body": "**Changing commit** from \"[2d08b696221eaaac9e03cea778dfa66d968e599a](https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a)\" to \"[fad8104f2223b19ed03e490514f599d756e048ec](https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec)\".",
    "created_at": "2022-01-23T06:14:45Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2d08b696221eaaac9e03cea778dfa66d968e599a](https://github.com/sagemath/sagetrac-mirror/commit/2d08b696221eaaac9e03cea778dfa66d968e599a)" to "[fad8104f2223b19ed03e490514f599d756e048ec](https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec)".



---

archive/issue_comments_534494.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec\">fad8104</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr></table>\n",
    "created_at": "2022-01-23T06:14:45Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec">fad8104</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr></table>




---

archive/issue_comments_534495.json:
```json
{
    "body": "<a id='comment:14'></a>\nIs this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.",
    "created_at": "2022-02-06T23:45:27Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534495",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.



---

archive/issue_comments_534496.json:
```json
{
    "body": "<a id='comment:15'></a>\nNo, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`",
    "created_at": "2022-02-07T00:04:29Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534496",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`



---

archive/issue_comments_534497.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think that may be best. But I must say so far I am a bit confused. I do not see where that \"install-cleaner\" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?",
    "created_at": "2022-02-07T00:11:33Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534497",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
I think that may be best. But I must say so far I am a bit confused. I do not see where that "install-cleaner" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?



---

archive/issue_comments_534498.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes \"stale\" installed files.\n \n-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. \n+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-stdlib**. \n - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed\n - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.\n \n``````\n",
    "created_at": "2022-02-07T00:11:33Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534498",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes "stale" installed files.
 
-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. 
+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-stdlib**. 
 - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed
 - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.
 
``````




---

archive/issue_comments_534499.json:
```json
{
    "body": "<a id='comment:17'></a>\nIt's invoked by `build/pkgs/sagelib/spkg-install`",
    "created_at": "2022-02-07T00:13:09Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534499",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
It's invoked by `build/pkgs/sagelib/spkg-install`



---

archive/issue_comments_534500.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09\">87a7370</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr></table>\n",
    "created_at": "2022-02-07T02:58:26Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534500",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09">87a7370</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr></table>




---

archive/issue_comments_534501.json:
```json
{
    "body": "**Changing commit** from \"[fad8104f2223b19ed03e490514f599d756e048ec](https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec)\" to \"[87a7370b14bcb0b4a80641268c68b8cc2222fd09](https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09)\".",
    "created_at": "2022-02-07T02:58:26Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fad8104f2223b19ed03e490514f599d756e048ec](https://github.com/sagemath/sagetrac-mirror/commit/fad8104f2223b19ed03e490514f599d756e048ec)" to "[87a7370b14bcb0b4a80641268c68b8cc2222fd09](https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09)".



---

archive/issue_events_295348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-07T03:05:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295348"
}
```



---

archive/issue_events_295349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-07T03:05:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295349"
}
```



---

archive/issue_comments_534502.json:
```json
{
    "body": "**Work_Issues:** FIXME in build/pkgs/sagelib/spkg-install",
    "created_at": "2022-02-07T03:05:29Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534502",
    "user": "https://github.com/mkoeppe"
}
```

**Work_Issues:** FIXME in build/pkgs/sagelib/spkg-install



---

archive/issue_comments_534503.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes \"stale\" installed files.\n \n-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-stdlib**. \n+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. \n - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed\n - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.\n \n``````\n",
    "created_at": "2022-02-07T03:06:00Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534503",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes "stale" installed files.
 
-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-stdlib**. 
+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. 
 - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed
 - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.
 
``````




---

archive/issue_comments_534504.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes \"stale\" installed files.\n \n-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. \n+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib** (#29864). \n - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed\n - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.\n \n``````\n",
    "created_at": "2022-02-07T03:06:38Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534504",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Unless `./configure --enable-editable` is used, the Sage library is installed directly into `site-packages` using `setup.py install`, and at the end of `sage_setup`'s custom `sage_install_and_clean` invokes the installation cleaner, which removes "stale" installed files.
 
-The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib**. 
+The installation cleaner is problematic when we start to install optional modules in the `sage.*` namespace via separate distributions such as **sagemath-tdlib** (#29864). 
 - `pkgs/sagemath-standard/setup.py` will no longer enable optional Cython modules based on which optional packages are installed
 - but the installation cleaner needs to know about these optional Cython modules so it does not remove them right after their installation.
 
``````




---

archive/issue_comments_534505.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f\">1db674d</a></td><td><code>Merge tag '9.6.beta0' into t/32927/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional</code></td></tr></table>\n",
    "created_at": "2022-02-07T03:25:29Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f">1db674d</a></td><td><code>Merge tag '9.6.beta0' into t/32927/pkgs_sagemath_standard_setup_py__move_distributions_logic_to_a_new_package_sagemath_optional</code></td></tr></table>




---

archive/issue_comments_534506.json:
```json
{
    "body": "**Changing commit** from \"[87a7370b14bcb0b4a80641268c68b8cc2222fd09](https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09)\" to \"[1db674ddb45ab1b168afb0b93a32cccaa474238f](https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f)\".",
    "created_at": "2022-02-07T03:25:29Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[87a7370b14bcb0b4a80641268c68b8cc2222fd09](https://github.com/sagemath/sagetrac-mirror/commit/87a7370b14bcb0b4a80641268c68b8cc2222fd09)" to "[1db674ddb45ab1b168afb0b93a32cccaa474238f](https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f)".



---

archive/issue_comments_534507.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mkoeppe](#comment%3A17):\n> It's invoked by `build/pkgs/sagelib/spkg-install`\n\n\nOh yes I see. Like it says, that's not a bit I am usually concerned with downstream.",
    "created_at": "2022-02-07T04:36:10Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534507",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Replying to [mkoeppe](#comment%3A17):
> It's invoked by `build/pkgs/sagelib/spkg-install`


Oh yes I see. Like it says, that's not a bit I am usually concerned with downstream.



---

archive/issue_comments_534508.json:
```json
{
    "body": "<a id='comment:24'></a>\nYes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.",
    "created_at": "2022-02-07T04:38:04Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.



---

archive/issue_comments_534509.json:
```json
{
    "body": "<a id='comment:25'></a>\nIf I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.",
    "created_at": "2022-02-07T04:41:33Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534509",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.



---

archive/issue_events_295350.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295350"
}
```



---

archive/issue_events_295351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295351"
}
```



---

archive/issue_comments_534510.json:
```json
{
    "body": "**Dependencies:** #33855",
    "created_at": "2022-05-15T22:17:29Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534510",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #33855



---

archive/issue_comments_534511.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/351cccde90e55dcb0b728d3281c6b9fd684a6d53\">351cccd</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/731e8133985b889a6285aad852d329f6466e79d2\">731e813</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1\">7667836</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr></table>\n",
    "created_at": "2022-06-09T21:28:30Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/351cccde90e55dcb0b728d3281c6b9fd684a6d53">351cccd</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/731e8133985b889a6285aad852d329f6466e79d2">731e813</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1">7667836</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr></table>




---

archive/issue_comments_534512.json:
```json
{
    "body": "**Changing commit** from \"[1db674ddb45ab1b168afb0b93a32cccaa474238f](https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f)\" to \"[76678369c0af93ae4f2e3fc4063bf6de88c299f1](https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1)\".",
    "created_at": "2022-06-09T21:28:30Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1db674ddb45ab1b168afb0b93a32cccaa474238f](https://github.com/sagemath/sagetrac-mirror/commit/1db674ddb45ab1b168afb0b93a32cccaa474238f)" to "[76678369c0af93ae4f2e3fc4063bf6de88c299f1](https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1)".



---

archive/issue_comments_534513.json:
```json
{
    "body": "**Changing dependencies** from \"#33855\" to \"\".",
    "created_at": "2022-06-12T01:37:05Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534513",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#33855" to "".



---

archive/issue_comments_534514.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58\">e26da73</a></td><td><code>build/pkgs/sagelib/spkg-install: Use --build-base for cleaning</code></td></tr></table>\n",
    "created_at": "2022-06-12T02:07:47Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58">e26da73</a></td><td><code>build/pkgs/sagelib/spkg-install: Use --build-base for cleaning</code></td></tr></table>




---

archive/issue_comments_534515.json:
```json
{
    "body": "**Changing commit** from \"[76678369c0af93ae4f2e3fc4063bf6de88c299f1](https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1)\" to \"[e26da73dcf6076535f92458c283d85650007fd58](https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58)\".",
    "created_at": "2022-06-12T02:07:47Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[76678369c0af93ae4f2e3fc4063bf6de88c299f1](https://github.com/sagemath/sagetrac-mirror/commit/76678369c0af93ae4f2e3fc4063bf6de88c299f1)" to "[e26da73dcf6076535f92458c283d85650007fd58](https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58)".



---

archive/issue_comments_534516.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed680c525e9552bf30ce2028cee0a4dc25c1ada3\">ed680c5</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57044b65c52ef5bbeb6cbb4163dc3e43820b32f5\">57044b6</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc34e2acaca4f704a49f95ecb14ddc5fb099b38d\">fc34e2a</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67d39402d51cefe06e45b0b0963ccb7ebfb16b53\">67d3940</a></td><td><code>build/pkgs/sagelib/spkg-install: Use --build-base for cleaning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fcce865da4147e8011e747c7a72bc7c52aab24a\">3fcce86</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Remove use of sage_build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e802edd023b1d0cf918088d15cb704a26a1c5600\">e802edd</a></td><td><code>build/pkgs/sagelib/spkg-install: Fix up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bfdaee5743858a73c9f9d27ec985c5e1951b805\">8bfdaee</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Restore multiprocessing fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62\">edd0ea1</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Update import</code></td></tr></table>\n",
    "created_at": "2022-06-12T20:01:02Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed680c525e9552bf30ce2028cee0a4dc25c1ada3">ed680c5</a></td><td><code>build/pkgs/sagelib: Invoke install cleaner explicitly, remove it from pkgs/sagemath-standard/setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57044b65c52ef5bbeb6cbb4163dc3e43820b32f5">57044b6</a></td><td><code>build/pkgs/sagelib/install-cleaner/setup.py: Remove primecount</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc34e2acaca4f704a49f95ecb14ddc5fb099b38d">fc34e2a</a></td><td><code>pkgs/sage-legacy-install-cleaner: Move install cleaner here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67d39402d51cefe06e45b0b0963ccb7ebfb16b53">67d3940</a></td><td><code>build/pkgs/sagelib/spkg-install: Use --build-base for cleaning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fcce865da4147e8011e747c7a72bc7c52aab24a">3fcce86</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Remove use of sage_build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e802edd023b1d0cf918088d15cb704a26a1c5600">e802edd</a></td><td><code>build/pkgs/sagelib/spkg-install: Fix up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bfdaee5743858a73c9f9d27ec985c5e1951b805">8bfdaee</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Restore multiprocessing fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62">edd0ea1</a></td><td><code>pkgs/sage-legacy-install-cleaner/setup.py: Update import</code></td></tr></table>




---

archive/issue_comments_534517.json:
```json
{
    "body": "**Changing commit** from \"[e26da73dcf6076535f92458c283d85650007fd58](https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58)\" to \"[edd0ea1df972480984837a1aa4d54bb3ede6ab62](https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62)\".",
    "created_at": "2022-06-12T20:01:02Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e26da73dcf6076535f92458c283d85650007fd58](https://github.com/sagemath/sagetrac-mirror/commit/e26da73dcf6076535f92458c283d85650007fd58)" to "[edd0ea1df972480984837a1aa4d54bb3ede6ab62](https://github.com/sagemath/sagetrac-mirror/commit/edd0ea1df972480984837a1aa4d54bb3ede6ab62)".



---

archive/issue_comments_534518.json:
```json
{
    "body": "**Changing work_issues** from \"FIXME in build/pkgs/sagelib/spkg-install\" to \"Do not build_ext\".",
    "created_at": "2022-06-12T20:02:27Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534518",
    "user": "https://github.com/mkoeppe"
}
```

**Changing work_issues** from "FIXME in build/pkgs/sagelib/spkg-install" to "Do not build_ext".



---

archive/issue_events_295352.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295352"
}
```



---

archive/issue_events_295353.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295353"
}
```



---

archive/issue_comments_534519.json:
```json
{
    "body": "<a id='comment:34'></a>\nNot needed with #32874",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534519",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Not needed with #32874



---

archive/issue_comments_534520.json:
```json
{
    "body": "**Dependencies:** #32874",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534520",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #32874



---

archive/issue_comments_534521.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"\".",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534521",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "".



---

archive/issue_events_295354.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-26T05:54:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295354"
}
```



---

archive/issue_events_295355.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-26T05:54:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295355"
}
```



---

archive/issue_events_295356.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-26T05:54:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295356"
}
```



---

archive/issue_comments_534522.json:
```json
{
    "body": "<a id='comment:35'></a>\nBefore we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:\n\nWould `setup install` work when optional distributions that contain namespace packages were installed?\n\nWould `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?\n\nIf answers to both are yes, then the branch of this ticket could be an alternative to #32874?",
    "created_at": "2022-10-14T04:17:00Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534522",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:35'></a>
Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:

Would `setup install` work when optional distributions that contain namespace packages were installed?

Would `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?

If answers to both are yes, then the branch of this ticket could be an alternative to #32874?



---

archive/issue_comments_534523.json:
```json
{
    "body": "<a id='comment:36'></a>\nWell, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.",
    "created_at": "2022-10-14T23:26:39Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534523",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.



---

archive/issue_events_295357.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-10-15T02:45:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295357"
}
```



---

archive/issue_events_295358.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-10-15T02:45:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295358"
}
```



---

archive/issue_comments_534524.json:
```json
{
    "body": "<a id='comment:37'></a>\nOkay. Thanks.",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534524",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:37'></a>
Okay. Thanks.



---

archive/issue_comments_534525.json:
```json
{
    "body": "**Reviewer:** Kwankyu Lee",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32927#issuecomment-534525",
    "user": "https://github.com/kwankyu"
}
```

**Reviewer:** Kwankyu Lee



---

archive/issue_events_295359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295359"
}
```



---

archive/issue_events_295360.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-14T19:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32927",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32927#event-295360"
}
```
