# Issue 32956: create dummy script packages for ffmpeg and imagemagick

archive/issues_032719.json:
```json
{
    "body": "One advantage is that when the feature `ffmpeg` or `imagemagick` is needed, an error message will now suggest how to install `ffmpeg` or `imagemagick` according to the system (debian, cygwin, macports, homebrew, etc.).\n\nFrom #32650#comment:33\n\nSee also #32926#comment:24\n\nPart of #30930\n\nReviewer: Matthias Koeppe\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nBranch: 6dd8bca1173e1ed5d30469c59928c1a927ac1b3d\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32956\n\n",
    "closed_at": "2021-12-23T20:25:31Z",
    "created_at": "2021-12-01T21:05:19Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "create dummy script packages for ffmpeg and imagemagick",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32956",
    "user": "https://github.com/seblabbe"
}
```
One advantage is that when the feature `ffmpeg` or `imagemagick` is needed, an error message will now suggest how to install `ffmpeg` or `imagemagick` according to the system (debian, cygwin, macports, homebrew, etc.).

From #32650#comment:33

See also #32926#comment:24

Part of #30930

Reviewer: Matthias Koeppe

Author: Sébastien Labbé

Branch: 6dd8bca1173e1ed5d30469c59928c1a927ac1b3d

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32956





---

archive/issue_comments_466121.json:
```json
{
    "body": "<a id='comment:2'></a>... and maybe also pdftocairo",
    "created_at": "2021-12-01T21:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466121",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>... and maybe also pdftocairo



---

archive/issue_comments_466122.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2021-12-02T15:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466122",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_466123.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-02T15:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466123",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_466124.json:
```json
{
    "body": "<a id='comment:5'></a>A question I have is whether `ffmpeg` should be removed from the following list (like it is the case for `pandoc`?):\n\n```\n$ cat build/pkgs/_recommended/distros/debian.txt \n# From https://wiki.sagemath.org/prerequisitesUbuntu\n\n# to generate pdf documentation\ntexlive-latex-extra\n# to convert Jupyter notebooks to pdf\ntexlive-xetex\n# to generate pdf documentation\nlatexmk\n# to convert Jupyter notebooks to pdf\n# pandoc -- this is a separate script package\n# to render text with LaTeX in Matplotlib\ndvipng\n# to run the Jmol 3D viewer from the console and generate images for 3D plots in the documentation\ndefault-jdk\n# to produce animations\nffmpeg\nlibavdevice-dev\n```",
    "created_at": "2021-12-02T15:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466124",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:5'></a>A question I have is whether `ffmpeg` should be removed from the following list (like it is the case for `pandoc`?):

```
$ cat build/pkgs/_recommended/distros/debian.txt 
# From https://wiki.sagemath.org/prerequisitesUbuntu

# to generate pdf documentation
texlive-latex-extra
# to convert Jupyter notebooks to pdf
texlive-xetex
# to generate pdf documentation
latexmk
# to convert Jupyter notebooks to pdf
# pandoc -- this is a separate script package
# to render text with LaTeX in Matplotlib
dvipng
# to run the Jmol 3D viewer from the console and generate images for 3D plots in the documentation
default-jdk
# to produce animations
ffmpeg
libavdevice-dev
```



---

archive/issue_comments_466125.json:
```json
{
    "body": "<a id='comment:6'></a>Yes.\n\nIn return, add the new packages to `src/doc/bootstrap` in the same way that `pandoc` appears there",
    "created_at": "2021-12-02T18:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Yes.

In return, add the new packages to `src/doc/bootstrap` in the same way that `pandoc` appears there



---

archive/issue_comments_466126.json:
```json
{
    "body": "<a id='comment:7'></a>Ok replacing the line `_recommended:*|pandoc:*)` by `_recommended:*|pandoc:*|ffmpeg:*)` ?\n\n```\n$ grep pandoc src/doc/bootstrap -C4\n                       case \"$PKG_BASE:$PKG_TYPE\" in\n                           *:standard)\n                               SYSTEM_PACKAGES+=\" $PKG_SYSTEM_PACKAGES\"\n                               ;;\n                           _recommended:*|pandoc:*)\n                               RECOMMENDED_SYSTEM_PACKAGES+=\" $PKG_SYSTEM_PACKAGES\"\n                               ;;\n                           *)\n                               OPTIONAL_SYSTEM_PACKAGES+=\" $PKG_SYSTEM_PACKAGES\"\n```\n\nI find it weird that those `pandoc`, `ffmpeg` and `imagemagick` need to be hardcoded in the `src/doc/bootstrap` file. Isn't there a better way to do this?",
    "created_at": "2021-12-03T07:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466126",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>Ok replacing the line `_recommended:*|pandoc:*)` by `_recommended:*|pandoc:*|ffmpeg:*)` ?

```
$ grep pandoc src/doc/bootstrap -C4
                       case "$PKG_BASE:$PKG_TYPE" in
                           *:standard)
                               SYSTEM_PACKAGES+=" $PKG_SYSTEM_PACKAGES"
                               ;;
                           _recommended:*|pandoc:*)
                               RECOMMENDED_SYSTEM_PACKAGES+=" $PKG_SYSTEM_PACKAGES"
                               ;;
                           *)
                               OPTIONAL_SYSTEM_PACKAGES+=" $PKG_SYSTEM_PACKAGES"
```

I find it weird that those `pandoc`, `ffmpeg` and `imagemagick` need to be hardcoded in the `src/doc/bootstrap` file. Isn't there a better way to do this?



---

archive/issue_comments_466127.json:
```json
{
    "body": "<a id='comment:8'></a>It's code for generating some lines in one page of the documentation. I don't think we need a more general mechanism for that",
    "created_at": "2021-12-04T01:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>It's code for generating some lines in one page of the documentation. I don't think we need a more general mechanism for that



---

archive/issue_comments_466128.json:
```json
{
    "body": "<a id='comment:9'></a>The first line of `SPKG.rst` should be edited to follow the same format as the items in https://doc.sagemath.org/html/en/reference/spkg/",
    "created_at": "2021-12-04T03:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466128",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>The first line of `SPKG.rst` should be edited to follow the same format as the items in https://doc.sagemath.org/html/en/reference/spkg/



---

archive/issue_comments_466129.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T08:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466130.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T08:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466131.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466132.json:
```json
{
    "body": "<a id='comment:13'></a>So, I understand that by removing ffmpeg and imagemagick from `_recommended/distros/*.txt` files, they will not be suggested to be installed when they are already installed anymore.\n\nBut, in the case that ffmpeg and imagemagick are not installed, let's say, will the configure script say that these are recommended packages somehow? I don't see how this will happen with the commits I have done in the ticket so far.\n\n(also, let's do `pdftocairo` in another ticket, maybe in #20343 if I use it instead of `pdf2svg`)\n\nAnyway, needs review!",
    "created_at": "2021-12-09T08:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466132",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:13'></a>So, I understand that by removing ffmpeg and imagemagick from `_recommended/distros/*.txt` files, they will not be suggested to be installed when they are already installed anymore.

But, in the case that ffmpeg and imagemagick are not installed, let's say, will the configure script say that these are recommended packages somehow? I don't see how this will happen with the commits I have done in the ticket so far.

(also, let's do `pdftocairo` in another ticket, maybe in #20343 if I use it instead of `pdf2svg`)

Anyway, needs review!



---

archive/issue_comments_466133.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 slabbe]:\n> in the case that ffmpeg and imagemagick are not installed, let's say, will the configure script say that these are recommended packages somehow? I don't see how this will happen with the commits I have done in the ticket so far.\n\n\nYes, this behavior is triggered by the `spkg-configure.m4` files added in the ticket.",
    "created_at": "2021-12-09T17:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466133",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Replying to [comment:13 slabbe]:
> in the case that ffmpeg and imagemagick are not installed, let's say, will the configure script say that these are recommended packages somehow? I don't see how this will happen with the commits I have done in the ticket so far.


Yes, this behavior is triggered by the `spkg-configure.m4` files added in the ticket.



---

archive/issue_comments_466134.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-10T04:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466134",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_087075.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-23T20:25:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32956#event-87075"
}
```



---

archive/issue_comments_466135.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-23T20:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466135",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_466136.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:8 mkoeppe]:\n> It's code for generating some lines in one page of the documentation. I don't think we need a more general mechanism for that\n\n\nA second use case for this list of packages has surfaced, so I have now opened #33277",
    "created_at": "2022-02-02T18:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32956#issuecomment-466136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:8 mkoeppe]:
> It's code for generating some lines in one page of the documentation. I don't think we need a more general mechanism for that


A second use case for this list of packages has surfaced, so I have now opened #33277
