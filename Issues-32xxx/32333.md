# Issue 32333: change_default_prec as a replacement for the deprecated set_default_prec

archive/issues_032096.json:
```json
{
    "body": "In http://trac.sagemath.org/18416, the method `set_default_prec` of power series rings was marked deprecated, and the warning states that the default precision should be set at construction. This was done before in #16201 for Laurent series.\n\nThe point of those changes was to ensure that power series and Laurent series rings are immutable.\n\nI suggest to replace `set_default_prec` with a method `change_default_prec`, which would return a copy of `self` with the wanted precision. It would be similar to how `change_ring` works, for example.\n\nFor an application, see the following example:\n\n```\nsage: Pow.<x> = PowerSeriesRing(QQ, default_prec=5)\nsage: Laur = Pow.fraction_field()\nsage: f = Pow(1).add_bigoh(100); f\n1 + O(x^100)\nsage: f.parent()(1/(1+x))*f # forgetting about the ring Laur\n1 - x + x^2 - x^3 + x^4 + O(x^5)\n```\n\nTo get the correct precision, one would need something like\n\n```\nsage: R = f.parent() \nsage: S = PowerSeriesRing(R.base_ring(),R.gen(),default_prec=100)\nsage: S = S.fraction_field() \nsage: S(1/(1+x))*f  \n1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)\n```\n\nThe idea would be to replace that with:\n\n```\nsage: S = f.parent().change_default_prec(100)\nsage: S(1/(1+x))*f  \n1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)\n```\n\nCC:  @slel\n\nKeywords: series precision\n\nReviewer: Travis Scrimshaw\n\nAuthor: Thibaut Verron\n\nBranch: u/gh-ThibautVerron/change_default_prec\n\nStatus: needs_work\n\nCommit: 94fd7c57d8570ce2acd09df5bea8487275408a08\n\nIssue created by migration from https://trac.sagemath.org/ticket/32333\n\n",
    "created_at": "2021-08-04T15:48:28Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "change_default_prec as a replacement for the deprecated set_default_prec",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32333",
    "user": "https://github.com/ThibautVerron"
}
```
In http://trac.sagemath.org/18416, the method `set_default_prec` of power series rings was marked deprecated, and the warning states that the default precision should be set at construction. This was done before in #16201 for Laurent series.

The point of those changes was to ensure that power series and Laurent series rings are immutable.

I suggest to replace `set_default_prec` with a method `change_default_prec`, which would return a copy of `self` with the wanted precision. It would be similar to how `change_ring` works, for example.

For an application, see the following example:

```
sage: Pow.<x> = PowerSeriesRing(QQ, default_prec=5)
sage: Laur = Pow.fraction_field()
sage: f = Pow(1).add_bigoh(100); f
1 + O(x^100)
sage: f.parent()(1/(1+x))*f # forgetting about the ring Laur
1 - x + x^2 - x^3 + x^4 + O(x^5)
```

To get the correct precision, one would need something like

```
sage: R = f.parent() 
sage: S = PowerSeriesRing(R.base_ring(),R.gen(),default_prec=100)
sage: S = S.fraction_field() 
sage: S(1/(1+x))*f  
1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)
```

The idea would be to replace that with:

```
sage: S = f.parent().change_default_prec(100)
sage: S(1/(1+x))*f  
1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)
```

CC:  @slel

Keywords: series precision

Reviewer: Travis Scrimshaw

Author: Thibaut Verron

Branch: u/gh-ThibautVerron/change_default_prec

Status: needs_work

Commit: 94fd7c57d8570ce2acd09df5bea8487275408a08

Issue created by migration from https://trac.sagemath.org/ticket/32333





---

archive/issue_comments_643780.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-ThibautVerron/change_default_prec\"",
    "created_at": "2021-08-04T15:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643780",
    "user": "https://github.com/ThibautVerron"
}
```

Changing branch from "" to "u/gh-ThibautVerron/change_default_prec"



---

archive/issue_events_085769.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85769"
}
```



---

archive/issue_comments_643781.json:
```json
{
    "body": "Changing commit from \"\" to \"38718007fffbd3f2733cfaae8662468b2a976caf\"",
    "created_at": "2021-08-18T13:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643781",
    "user": "https://github.com/ThibautVerron"
}
```

Changing commit from "" to "38718007fffbd3f2733cfaae8662468b2a976caf"



---

archive/issue_comments_643782.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-18T13:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643782",
    "user": "https://github.com/ThibautVerron"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_643783.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[3871800](https://git.sagemath.org/sage.git/commit?id=38718007fffbd3f2733cfaae8662468b2a976caf)|`Implementation of change_default_prec`|",
    "created_at": "2021-08-18T13:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643783",
    "user": "https://github.com/ThibautVerron"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[3871800](https://git.sagemath.org/sage.git/commit?id=38718007fffbd3f2733cfaae8662468b2a976caf)|`Implementation of change_default_prec`|



---

archive/issue_comments_643784.json:
```json
{
    "body": "Changing author from \"\" to \"Thibaut Verron\"",
    "created_at": "2021-08-19T21:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643784",
    "user": "https://github.com/slel"
}
```

Changing author from "" to "Thibaut Verron"



---

archive/issue_comments_643785.json:
```json
{
    "body": "<a id='comment:5'></a>\nI agree that we should have this feature, but I don't think we should call `__copy__`. Instead, we should pass the relevant information onto the constructor so that it properly creates an object normally (in particular, if it uses a cache such as `UniqueRepresentation`). This means that classes implementing this will likely need to implement it themselves (with a generic implementation perhaps raising a `NotImplementedError`).\n\nAlso, I don't think you should rely on the fraction field of a power series ring being the Laurent polynomial ring. It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.",
    "created_at": "2021-08-23T00:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643785",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I agree that we should have this feature, but I don't think we should call `__copy__`. Instead, we should pass the relevant information onto the constructor so that it properly creates an object normally (in particular, if it uses a cache such as `UniqueRepresentation`). This means that classes implementing this will likely need to implement it themselves (with a generic implementation perhaps raising a `NotImplementedError`).

Also, I don't think you should rely on the fraction field of a power series ring being the Laurent polynomial ring. It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.



---

archive/issue_comments_643786.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-23T00:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643786",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_643787.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks for the comments!\n\n\n> I agree that we should have this feature, but I don't think we should call __copy__\n\n\nOh, right, that didn't work. \n\n\n> This means that classes implementing this will likely need to implement it themselves\n\n\nOkay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?\n\n\n> It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.\n\n\nOops.",
    "created_at": "2021-08-23T11:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643787",
    "user": "https://github.com/ThibautVerron"
}
```

<a id='comment:6'></a>
Thanks for the comments!


> I agree that we should have this feature, but I don't think we should call __copy__


Oh, right, that didn't work. 


> This means that classes implementing this will likely need to implement it themselves


Okay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?


> It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.


Oops.



---

archive/issue_comments_643788.json:
```json
{
    "body": "Changing commit from \"38718007fffbd3f2733cfaae8662468b2a976caf\" to \"94fd7c57d8570ce2acd09df5bea8487275408a08\"",
    "created_at": "2021-08-23T11:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "38718007fffbd3f2733cfaae8662468b2a976caf" to "94fd7c57d8570ce2acd09df5bea8487275408a08"



---

archive/issue_comments_643789.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[c15952f](https://git.sagemath.org/sage.git/commit/?id=c15952fa6c0a0908693357640f718c435ccab930)|`Laurent series rings are not always (fraction) fields`|\n|[a3863d2](https://git.sagemath.org/sage.git/commit/?id=a3863d2045e4b56fc48c2f8fb79fe5eae9edc337)|`Added examples`|\n|[09ccf55](https://git.sagemath.org/sage.git/commit/?id=09ccf55b476ac06c9ccafa65b0e15db53948b759)|`Generic method, implementation for univariate power series`|\n|[eec8def](https://git.sagemath.org/sage.git/commit/?id=eec8def11c4664e22fe0f097ff344751ab9fd0e3)|`Implementation for multivariate power series`|\n|[94fd7c5](https://git.sagemath.org/sage.git/commit/?id=94fd7c57d8570ce2acd09df5bea8487275408a08)|`Minor`|",
    "created_at": "2021-08-23T11:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[c15952f](https://git.sagemath.org/sage.git/commit/?id=c15952fa6c0a0908693357640f718c435ccab930)|`Laurent series rings are not always (fraction) fields`|
|[a3863d2](https://git.sagemath.org/sage.git/commit/?id=a3863d2045e4b56fc48c2f8fb79fe5eae9edc337)|`Added examples`|
|[09ccf55](https://git.sagemath.org/sage.git/commit/?id=09ccf55b476ac06c9ccafa65b0e15db53948b759)|`Generic method, implementation for univariate power series`|
|[eec8def](https://git.sagemath.org/sage.git/commit/?id=eec8def11c4664e22fe0f097ff344751ab9fd0e3)|`Implementation for multivariate power series`|
|[94fd7c5](https://git.sagemath.org/sage.git/commit/?id=94fd7c57d8570ce2acd09df5bea8487275408a08)|`Minor`|



---

archive/issue_comments_643790.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-ThibautVerron](#comment%3A6):\n> Thanks for the comments!\n\n\nThank you for the changes.\n\n> Okay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?\n\n\nYes, I agree that it should be left for another ticket. Likely some additional information is needed to be stored and passed along.",
    "created_at": "2021-08-25T04:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643790",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Replying to [gh-ThibautVerron](#comment%3A6):
> Thanks for the comments!


Thank you for the changes.

> Okay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?


Yes, I agree that it should be left for another ticket. Likely some additional information is needed to be stored and passed along.



---

archive/issue_comments_643791.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-08-25T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32333#issuecomment-643791",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_events_085770.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85770"
}
```



---

archive/issue_events_085771.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85771"
}
```



---

archive/issue_events_085772.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85772"
}
```



---

archive/issue_events_085773.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85773"
}
```



---

archive/issue_events_085774.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85774"
}
```



---

archive/issue_events_085775.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32333",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32333#event-85775"
}
```
