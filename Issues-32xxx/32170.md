# Issue 32170: Containers for families of geometric objects

archive/issues_031933.json:
```json
{
    "assignees": [],
    "body": "We define APIs for static and dynamic containers storing finite families of geometric objects, extending `Container`, `Set`, `MutableSet`, `Mapping`, `MutableMapping` https://docs.python.org/3/library/collections.abc.html\n\nThe family must define a collection of \"measurement maps\" `B_i`, each sending an object to an `InternalRealInterval`. \n\nThe product of these intervals can be thought of as a \"generalized bounding box\".\n\nIdeally the maps would be inclusion-preserving.\n\nThe implementation is provided by `rtree`/`libspatialindex` (#32000).\n\nThe Sage-specific class will take care of:\n- replacing an `InternalRealInterval` by a rescaling or inclusion-preserving overestimation, making the coordinates suitable for the underlying library.\n- providing accelerated set operations such as: \n  - a fast path for computing empty `intersection` when the result will be empty,\n  - a fast path for `__contains__` when the result will be `False`.\n\nGeometric lookup operations to be supported:\n- ...\n\nApplications:\n- `RationalPolyhedralFan`\n- `PolyhedralComplex` (#31748)\n- Families/posets of (open) subsets of manifolds (#31740): A natural choice of the maps `B_i` comes from the coordinates of covering charts, using `(-oo, oo)` for coordinates for which no coordinate definition for the subset is known\n\n\nDepends on #34277\n\nCC:  @DRKWang\n\nBranch/Commit: **[public/32170](https://github.com/sagemath/sagetrac-mirror/tree/public/32170) @ [`05ea99d`](https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636)**\n\nWork Issues: **Rebase on #34277**\n\nAuthor: **Binshuai Wang**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32170_\n\n",
    "created_at": "2021-07-09T19:18:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Containers for families of geometric objects",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/32170",
    "user": "https://github.com/mkoeppe"
}
```
We define APIs for static and dynamic containers storing finite families of geometric objects, extending `Container`, `Set`, `MutableSet`, `Mapping`, `MutableMapping` https://docs.python.org/3/library/collections.abc.html

The family must define a collection of "measurement maps" `B_i`, each sending an object to an `InternalRealInterval`. 

The product of these intervals can be thought of as a "generalized bounding box".

Ideally the maps would be inclusion-preserving.

The implementation is provided by `rtree`/`libspatialindex` (#32000).

The Sage-specific class will take care of:
- replacing an `InternalRealInterval` by a rescaling or inclusion-preserving overestimation, making the coordinates suitable for the underlying library.
- providing accelerated set operations such as: 
  - a fast path for computing empty `intersection` when the result will be empty,
  - a fast path for `__contains__` when the result will be `False`.

Geometric lookup operations to be supported:
- ...

Applications:
- `RationalPolyhedralFan`
- `PolyhedralComplex` (#31748)
- Families/posets of (open) subsets of manifolds (#31740): A natural choice of the maps `B_i` comes from the coordinates of covering charts, using `(-oo, oo)` for coordinates for which no coordinate definition for the subset is known


Depends on #34277

CC:  @DRKWang

Branch/Commit: **[public/32170](https://github.com/sagemath/sagetrac-mirror/tree/public/32170) @ [`05ea99d`](https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636)**

Work Issues: **Rebase on #34277**

Author: **Binshuai Wang**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/32170_





---

archive/issue_events_443736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-09T19:18:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443736"
}
```



---

archive/issue_events_443737.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-09T19:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443737"
}
```



---

archive/issue_events_443738.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-09T19:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443738"
}
```



---

archive/issue_events_443739.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-09T19:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443739"
}
```



---

archive/issue_comments_518183.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe precision of interval values in Package `libspatialindex` is `double`.\n\nThey did not claim it explicitly, but I found it from\n- `https://rtree.readthedocs.io/en/latest/class.html#rtree.index.Index`\n- `https://github.com/libspatialindex/libspatialindex/blob/master/include/spatialindex/capi/DataStream.h`.",
    "created_at": "2021-07-10T02:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518183",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:1" align="right">comment:1</div>

The precision of interval values in Package `libspatialindex` is `double`.

They did not claim it explicitly, but I found it from
- `https://rtree.readthedocs.io/en/latest/class.html#rtree.index.Index`
- `https://github.com/libspatialindex/libspatialindex/blob/master/include/spatialindex/capi/DataStream.h`.



---

archive/issue_comments_518184.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nOK, the next step would be to find out whether the library does any arithmetic with these `double` values (in this case we would have to check whether they apply directed rounding correctly), or whether they only use comparisons on these `double` values.",
    "created_at": "2021-07-10T02:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518184",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

OK, the next step would be to find out whether the library does any arithmetic with these `double` values (in this case we would have to check whether they apply directed rounding correctly), or whether they only use comparisons on these `double` values.



---

archive/issue_comments_518185.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We define APIs for static and dynamic containers storing finite families of geometric objects.\n+We define APIs for static and dynamic containers storing finite families of geometric objects, extending `Container`, `Set`, `MutableSet`, `Mapping`, `MutableMapping` https://docs.python.org/3/library/collections.abc.html\n \n The family must define a collection of \"measurement maps\" `B_i`, each sending an object to an `InternalRealInterval`. \n \n``````\n",
    "created_at": "2021-07-11T00:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518185",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We define APIs for static and dynamic containers storing finite families of geometric objects.
+We define APIs for static and dynamic containers storing finite families of geometric objects, extending `Container`, `Set`, `MutableSet`, `Mapping`, `MutableMapping` https://docs.python.org/3/library/collections.abc.html
 
 The family must define a collection of "measurement maps" `B_i`, each sending an object to an `InternalRealInterval`. 
 
``````




---

archive/issue_comments_518186.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe library `libspatialindex` uses arithmetic operations, including `+`, `-` and `*`, with those `double` values in order to support some functions, such as\n- `LineSegment::Collinear`( https://libspatialindex.org/en/latest/doxygen/LineSegment_8cc_source.html#l00439), \n\n- \n  `LineSegment::getArea`(https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Region.cc) \n\nand etc. \n\nBesides, the library `libspatialindex` also uses `std::numeric_limits<double>::epsilon()` to deal with machine precision issue, such as `Region::touchesPoint(const Point& p)` (https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Region.cc)\n\n`std::numeric_limits<double>::max();`(https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Point.cc).",
    "created_at": "2021-07-12T22:55:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518186",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:4" align="right">comment:4</div>

The library `libspatialindex` uses arithmetic operations, including `+`, `-` and `*`, with those `double` values in order to support some functions, such as
- `LineSegment::Collinear`( https://libspatialindex.org/en/latest/doxygen/LineSegment_8cc_source.html#l00439), 

- 
  `LineSegment::getArea`(https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Region.cc) 

and etc. 

Besides, the library `libspatialindex` also uses `std::numeric_limits<double>::epsilon()` to deal with machine precision issue, such as `Region::touchesPoint(const Point& p)` (https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Region.cc)

`std::numeric_limits<double>::max();`(https://github.com/libspatialindex/libspatialindex/blob/master/src/spatialindex/Point.cc).



---

archive/issue_events_443740.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443740"
}
```



---

archive/issue_events_443741.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443741"
}
```



---

archive/issue_comments_518187.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nA few test codes have been made for testing arithmetic precision. The conclusions are as follows, more details and codes can be found from this(https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/log35.ipynb).\n\n- The dimension of the index database should always be greater than 1. (0 or 1 dimension will fail).\n\n- The arithmetic precision is 16 decimal digits, which comes from the double type's precision. \n\n- The minimal capturing of arithmetic precision is 324 decimal digits, which means the minimal difference to distinguish two numbers is 1*10^{-324}. otherwise, they will be viewed as the same number.\n\n- The intersection for retrieving is a closed intersection. (-0.000) is also considered as the same number as 0, but both representations will be displayed at the same time.\n\n- Rounding. The round processing is a little complex and untraceable, it is neither rounding up or rounding down.",
    "created_at": "2021-08-05T18:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518187",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:6" align="right">comment:6</div>

A few test codes have been made for testing arithmetic precision. The conclusions are as follows, more details and codes can be found from this(https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/log35.ipynb).

- The dimension of the index database should always be greater than 1. (0 or 1 dimension will fail).

- The arithmetic precision is 16 decimal digits, which comes from the double type's precision. 

- The minimal capturing of arithmetic precision is 324 decimal digits, which means the minimal difference to distinguish two numbers is 1*10^{-324}. otherwise, they will be viewed as the same number.

- The intersection for retrieving is a closed intersection. (-0.000) is also considered as the same number as 0, but both representations will be displayed at the same time.

- Rounding. The round processing is a little complex and untraceable, it is neither rounding up or rounding down.



---

archive/issue_comments_518188.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI have made some debugs for this library. I would like to list the key points below. The entire log file can be found here https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/log36.ipynb.\n\n1. The python wrapper part for rtree was only used for passing the values and data to 2 basic functions, ```core.rt.Index_InsertData()``` and ```core.rt.Index_Intersects_obj()```. Those two functions are stored here https://github.com/Toblerity/rtree/blob/master/rtree/core.py. Thus, there is no arithmetic error in this part.\n\n2. The corresponding part in libspatialindex for ```core.rt.Index_InsertData()``` and ```core.rt.Index_Intersects_obj()``` are placed in line 499 and line 678 in https://github.com/libspatialindex/libspatialindex/blob/master/src/capi/sidx_api.cc .\n\n3. In the ```Index_InsertData()``` in C++, the author uses the concepts \"points\" and \"boxes\" to refine the input information, and then call the function ```index().insertData(**)``` to compute. As we discussed last time, the author mistakenly uses the ```std::numeric_limits<double>::epsilon()``` as the range of approximation, that is, if the bound difference is within this range, then they will be seen as a single point instead of a box. According to this note, https://stackoverflow.com/questions/48133572/what-can-stdnumeric-limitsdoubleepsilon-be-used-for, we may correct it by multiplying the magnitudes of the comparison. However, because it is for scientific computation, we should get rid of approximation as much as possible.\n\n4. Except for the above place, the author also mistakenly has used ```std::numeric_limits<double>::epsilon()``` in many other places. I think we could inform the author to check them deeply.",
    "created_at": "2021-08-13T17:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518188",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:7" align="right">comment:7</div>

I have made some debugs for this library. I would like to list the key points below. The entire log file can be found here https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/log36.ipynb.

1. The python wrapper part for rtree was only used for passing the values and data to 2 basic functions, ```core.rt.Index_InsertData()``` and ```core.rt.Index_Intersects_obj()```. Those two functions are stored here https://github.com/Toblerity/rtree/blob/master/rtree/core.py. Thus, there is no arithmetic error in this part.

2. The corresponding part in libspatialindex for ```core.rt.Index_InsertData()``` and ```core.rt.Index_Intersects_obj()``` are placed in line 499 and line 678 in https://github.com/libspatialindex/libspatialindex/blob/master/src/capi/sidx_api.cc .

3. In the ```Index_InsertData()``` in C++, the author uses the concepts "points" and "boxes" to refine the input information, and then call the function ```index().insertData(**)``` to compute. As we discussed last time, the author mistakenly uses the ```std::numeric_limits<double>::epsilon()``` as the range of approximation, that is, if the bound difference is within this range, then they will be seen as a single point instead of a box. According to this note, https://stackoverflow.com/questions/48133572/what-can-stdnumeric-limitsdoubleepsilon-be-used-for, we may correct it by multiplying the magnitudes of the comparison. However, because it is for scientific computation, we should get rid of approximation as much as possible.

4. Except for the above place, the author also mistakenly has used ```std::numeric_limits<double>::epsilon()``` in many other places. I think we could inform the author to check them deeply.



---

archive/issue_comments_518189.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n- The extensions, `.idx` and `.dat`, are two files used to serialize the rtree to disk, according to https://rtree.readthedocs.io/en/latest/tutorial.html.\n\n- Those two files are created by `#include <fstream>` internally, based on this source code, https://github.com/libspatialindex/libspatialindex/blob/master/src/storagemanager/DiskStorageManager.cc.\n\n- The `.idx` is used to store vital information like the page size, the next available page, a list of empty pages, and the sequence of pages associated with every entity ID.There is no note for the detail or purpose of `.dat` file. Thus, I made a test where putting 50 boxes into this library. The shows that the `.dat` is way larger than `.idx`, which indicates the `.dat` is used to store the real data, whereas `.idx` is used for storage the rest of it.\n\n- The correct way to close and reopen those serialized files can be found here, https://gis.stackexchange.com/questions/254781/saving-python-rtree-spatial-index-to-file\n\n- Except for `DiskStorageManager`, it also has a `MemoryStorageManager`. The detail of it is that \"Everything is stored in main memory using a simple vector. No properties are needed to initialize a `MemoryStorageManager` object. When a `MemoryStorageManager` instance goes out of scope, all data that it contains are lost.\"\n\n- The `.dat_extension = xxx` and `.idx_extension = xxx` can be used to change the names of those extensions.",
    "created_at": "2021-08-17T19:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518189",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:8" align="right">comment:8</div>

- The extensions, `.idx` and `.dat`, are two files used to serialize the rtree to disk, according to https://rtree.readthedocs.io/en/latest/tutorial.html.

- Those two files are created by `#include <fstream>` internally, based on this source code, https://github.com/libspatialindex/libspatialindex/blob/master/src/storagemanager/DiskStorageManager.cc.

- The `.idx` is used to store vital information like the page size, the next available page, a list of empty pages, and the sequence of pages associated with every entity ID.There is no note for the detail or purpose of `.dat` file. Thus, I made a test where putting 50 boxes into this library. The shows that the `.dat` is way larger than `.idx`, which indicates the `.dat` is used to store the real data, whereas `.idx` is used for storage the rest of it.

- The correct way to close and reopen those serialized files can be found here, https://gis.stackexchange.com/questions/254781/saving-python-rtree-spatial-index-to-file

- Except for `DiskStorageManager`, it also has a `MemoryStorageManager`. The detail of it is that "Everything is stored in main memory using a simple vector. No properties are needed to initialize a `MemoryStorageManager` object. When a `MemoryStorageManager` instance goes out of scope, all data that it contains are lost."

- The `.dat_extension = xxx` and `.idx_extension = xxx` can be used to change the names of those extensions.



---

archive/issue_comments_518190.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI am trying to build a subclass called `rtree_based_realset()`, which is inherited from the class `RealSet()`. But got stuck on the purpose of this subclass. I would like to list my chain of thoughts below and hope to get a verification.\n\nThe intention of building this subclass is to keep the interface of this class, (I feel basically the interface can be considered as functions), the same and use `rtree` data structure to be a preliminary filter for overestimating in order to reduce the computation time. But since rtree only serves as an overestimate from one side, in order to be accurate, this subclass, which we want to define, still needs the `finite unit intervals` structure inside. In that case, seemingly, the subclass does not have a big difference from the `RealSet()` class. And the difference between those two classes only comes from whether we use `rtree` as an auxiliary tools or not.",
    "created_at": "2021-08-28T00:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518190",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:9" align="right">comment:9</div>

I am trying to build a subclass called `rtree_based_realset()`, which is inherited from the class `RealSet()`. But got stuck on the purpose of this subclass. I would like to list my chain of thoughts below and hope to get a verification.

The intention of building this subclass is to keep the interface of this class, (I feel basically the interface can be considered as functions), the same and use `rtree` data structure to be a preliminary filter for overestimating in order to reduce the computation time. But since rtree only serves as an overestimate from one side, in order to be accurate, this subclass, which we want to define, still needs the `finite unit intervals` structure inside. In that case, seemingly, the subclass does not have a big difference from the `RealSet()` class. And the difference between those two classes only comes from whether we use `rtree` as an auxiliary tools or not.



---

archive/issue_comments_518191.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@DRKWang](#comment:9):\n> since rtree only serves as an overestimate from one side, in order to be accurate, this subclass, which we want to define, still needs the `finite unit intervals` structure inside. \n\nThat's right, we are not replacing the internal representation of `RealSet` instances.\n\nWe are only adding an index data structure to it.",
    "created_at": "2021-08-28T00:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518191",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@DRKWang](#comment:9):
> since rtree only serves as an overestimate from one side, in order to be accurate, this subclass, which we want to define, still needs the `finite unit intervals` structure inside. 

That's right, we are not replacing the internal representation of `RealSet` instances.

We are only adding an index data structure to it.



---

archive/issue_comments_518192.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSince the `rtree.count()`, which will return the number of objects whose boxes have intersections with the target point, is not exactly suitable for our expected function, I try to figure out some other functions to replace it. In my opinion, the best function would be `rtree.getfirst()`, if we should have, which ideally can assist with both `RealSet.contains()` and `RealSet.interesction()`. However, I did not get such a function, instead, I found `rtree.nearest()`, which will return the item whose box has minimal distance to the target point. However, after comparing `rtree.nearest()` with `rtree.count()`, the test results shows the `rtree.nearest()` is slower than `rtree.count()`.",
    "created_at": "2021-09-03T23:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518192",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:11" align="right">comment:11</div>

Since the `rtree.count()`, which will return the number of objects whose boxes have intersections with the target point, is not exactly suitable for our expected function, I try to figure out some other functions to replace it. In my opinion, the best function would be `rtree.getfirst()`, if we should have, which ideally can assist with both `RealSet.contains()` and `RealSet.interesction()`. However, I did not get such a function, instead, I found `rtree.nearest()`, which will return the item whose box has minimal distance to the target point. However, after comparing `rtree.nearest()` with `rtree.count()`, the test results shows the `rtree.nearest()` is slower than `rtree.count()`.



---

archive/issue_comments_518193.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAs the boxes overestimate the true objects, a `count` result of 0 is useful.",
    "created_at": "2021-09-04T00:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518193",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

As the boxes overestimate the true objects, a `count` result of 0 is useful.



---

archive/issue_comments_518194.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFor `intersection`, can you propose a function for `rtree` that would help?",
    "created_at": "2021-09-04T17:19:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518194",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

For `intersection`, can you propose a function for `rtree` that would help?



---

archive/issue_comments_518195.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@mkoeppe](#comment:13):\n> For `intersection`, can you propose a function for `rtree` that would help?\n\nYes, I think `rtree.count()` also can help with that when there is a non-intersection between RealSet A and RealSet B, And I have implemented the code.",
    "created_at": "2021-09-04T19:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518195",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@mkoeppe](#comment:13):
> For `intersection`, can you propose a function for `rtree` that would help?

Yes, I think `rtree.count()` also can help with that when there is a non-intersection between RealSet A and RealSet B, And I have implemented the code.



---

archive/issue_comments_518196.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI am thinking about changing the internal code of function `RealSet.union()`. Instead of ordinary function `union(A,B)`, which has two equally operands, the function `RealSet.union()` has already `self`, and this format kind of indicates the `self` set is dominating and the other set will be added to `self`. In this case, I feel when we are trying to extend this function onto the `rtree_bssed_Realset` class, it is better to return a `rtree_based_RealSet` subclass instead of a `RealSet` class, since the programmer kind of wants to maintain the internal `rtree` data structure. And since this function only covers the `+` operation, which correspondingly is also easy to implement with `rtree`, thus, I feel I can try to achieve that.",
    "created_at": "2021-09-04T20:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518196",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:15" align="right">comment:15</div>

I am thinking about changing the internal code of function `RealSet.union()`. Instead of ordinary function `union(A,B)`, which has two equally operands, the function `RealSet.union()` has already `self`, and this format kind of indicates the `self` set is dominating and the other set will be added to `self`. In this case, I feel when we are trying to extend this function onto the `rtree_bssed_Realset` class, it is better to return a `rtree_based_RealSet` subclass instead of a `RealSet` class, since the programmer kind of wants to maintain the internal `rtree` data structure. And since this function only covers the `+` operation, which correspondingly is also easy to implement with `rtree`, thus, I feel I can try to achieve that.



---

archive/issue_comments_518197.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@DRKWang](#comment:15):\n> I feel when we are trying to extend this function onto the `rtree_bssed_Realset` class, it is better to return a `rtree_based_RealSet` subclass instead of a `RealSet` class, \n\nYes, I agree. This is a general change that should be made throughout the `RealSet` class. For example, in `RealSet.complement`, it should probably use `self.__class__` instead of `RealSet` when it constructs the result.",
    "created_at": "2021-09-04T21:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518197",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@DRKWang](#comment:15):
> I feel when we are trying to extend this function onto the `rtree_bssed_Realset` class, it is better to return a `rtree_based_RealSet` subclass instead of a `RealSet` class, 

Yes, I agree. This is a general change that should be made throughout the `RealSet` class. For example, in `RealSet.complement`, it should probably use `self.__class__` instead of `RealSet` when it constructs the result.



---

archive/issue_comments_518198.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n> Yes, I agree. This is a general change that should be made throughout the `RealSet` class. For example, in `RealSet.complement`, it should probably use `self.__class__` instead of `RealSet` when it constructs the result.\n> \n\nI see. I have made the changes inside the `RealSet` class by replacing `RealSet` with `self.__class__`. And I feel those replacements only need to happen under 2 following conditions,\n- It was after the `return`. Therefore, the function will finally `return` the corresponding class, and apart from `return`, it is necessary to make a replacement.\n- We can not make those replacements under the function that has a `@staticmethod` decorator. Since function with `@staticmethod` does not have `self` parameter, which means we can not use `self.__class__` to help.\n\nSpecifically, the functions I made the change are `union()`, `intersection()`, `complement()`, `__mul__()`.",
    "created_at": "2021-09-07T00:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518198",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:17" align="right">comment:17</div>

> Yes, I agree. This is a general change that should be made throughout the `RealSet` class. For example, in `RealSet.complement`, it should probably use `self.__class__` instead of `RealSet` when it constructs the result.
> 

I see. I have made the changes inside the `RealSet` class by replacing `RealSet` with `self.__class__`. And I feel those replacements only need to happen under 2 following conditions,
- It was after the `return`. Therefore, the function will finally `return` the corresponding class, and apart from `return`, it is necessary to make a replacement.
- We can not make those replacements under the function that has a `@staticmethod` decorator. Since function with `@staticmethod` does not have `self` parameter, which means we can not use `self.__class__` to help.

Specifically, the functions I made the change are `union()`, `intersection()`, `complement()`, `__mul__()`.



---

archive/issue_comments_518199.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@DRKWang](#comment:17):\n> - We can not make those replacements under the function that has a `@staticmethod` decorator. Since function with `@staticmethod` does not have `self` parameter, which means we can not use `self.__class__` to help.\n\nTry changing these methods to `@`classmethod - https://docs.python.org/3/library/functions.html#classmethod\n\nAnd push the branch please to the ticket",
    "created_at": "2021-09-07T00:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518199",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@DRKWang](#comment:17):
> - We can not make those replacements under the function that has a `@staticmethod` decorator. Since function with `@staticmethod` does not have `self` parameter, which means we can not use `self.__class__` to help.

Try changing these methods to `@`classmethod - https://docs.python.org/3/library/functions.html#classmethod

And push the branch please to the ticket



---

archive/issue_comments_518200.json:
```json
{
    "body": "Commit: **[`89595a6`](https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a)**",
    "created_at": "2021-09-08T16:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518200",
    "user": "https://github.com/DRKWang"
}
```

Commit: **[`89595a6`](https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a)**



---

archive/issue_comments_518201.json:
```json
{
    "body": "Branch: **[public/32170](https://github.com/sagemath/sagetrac-mirror/tree/public/32170)**",
    "created_at": "2021-09-08T16:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518201",
    "user": "https://github.com/DRKWang"
}
```

Branch: **[public/32170](https://github.com/sagemath/sagetrac-mirror/tree/public/32170)**



---

archive/issue_comments_518202.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa4e4ab81e043fb2b57b503fbf95bcdc4f22cf86\"><code>fa4e4ab</code></a></td><td><code>build/pkgs/cgal: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30b487f42559e52141202d260641b735037dee21\"><code>30b487f</code></a></td><td><code>build/pkgs/swig:New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9069a9a0cf8e9d7c18e2fca19c5303913e663f\"><code>df9069a</code></a></td><td><code>build/pkgs/cgal_swig_bindings: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82bf167c5a71d6945a14918d94214ea2549b861a\"><code>82bf167</code></a></td><td><code>add the upstream_url to checksums</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40b8a43d38bb820f90ea7264ab12b41d0b3ef917\"><code>40b8a43</code></a></td><td><code>Merge tag '9.3.beta6' into t/31098/cgal_swig_bindings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6be25f78a9581449f0feea9b7a81f0ce8bc7b8c5\"><code>6be25f7</code></a></td><td><code>build/pkgs/cgal_swig_bindings/checksums.ini: Fix upstream_url</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/569510555d89aa182bed4aadc24683292319ff2b\"><code>5695105</code></a></td><td><code>build/pkgs/cgal_swig_bindings: Use unpatched cgal-swig-bindings, set Python_EXECUTABLE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e380217ae2c631bec2a7a4b4eb33096ebfc28148\"><code>e380217</code></a></td><td><code>merge th current version to public/32000</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a\"><code>89595a6</code></a></td><td><code>make a whole change for replacing RealSet() objectas a return with 'self.__class__()' or 'cls()' as a return for 'RealSet' class; add 'Rtree_based_RealSet' class for rtree extension.</code></td></tr></table>\n",
    "created_at": "2021-09-08T16:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518202",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:19"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa4e4ab81e043fb2b57b503fbf95bcdc4f22cf86"><code>fa4e4ab</code></a></td><td><code>build/pkgs/cgal: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30b487f42559e52141202d260641b735037dee21"><code>30b487f</code></a></td><td><code>build/pkgs/swig:New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9069a9a0cf8e9d7c18e2fca19c5303913e663f"><code>df9069a</code></a></td><td><code>build/pkgs/cgal_swig_bindings: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82bf167c5a71d6945a14918d94214ea2549b861a"><code>82bf167</code></a></td><td><code>add the upstream_url to checksums</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40b8a43d38bb820f90ea7264ab12b41d0b3ef917"><code>40b8a43</code></a></td><td><code>Merge tag '9.3.beta6' into t/31098/cgal_swig_bindings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6be25f78a9581449f0feea9b7a81f0ce8bc7b8c5"><code>6be25f7</code></a></td><td><code>build/pkgs/cgal_swig_bindings/checksums.ini: Fix upstream_url</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/569510555d89aa182bed4aadc24683292319ff2b"><code>5695105</code></a></td><td><code>build/pkgs/cgal_swig_bindings: Use unpatched cgal-swig-bindings, set Python_EXECUTABLE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e380217ae2c631bec2a7a4b4eb33096ebfc28148"><code>e380217</code></a></td><td><code>merge th current version to public/32000</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a"><code>89595a6</code></a></td><td><code>make a whole change for replacing RealSet() objectas a return with 'self.__class__()' or 'cls()' as a return for 'RealSet' class; add 'Rtree_based_RealSet' class for rtree extension.</code></td></tr></table>




---

archive/issue_comments_518203.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n> Try changing these methods to `@`classmethod - https://docs.python.org/3/library/functions.html#classmethod\n\nGot it. I have made the change inside the `RealSet` object for placing the `@staticmethod` with `@classmethod` and use `cls()` as a wrapper for returning.\n\n> And push the branch please to the ticket\n\nThe above changes, including whole changes for `RealSet`, `Rtree_based_RealSet` class, have been made inside the `sage/src/sage/sets/real_set.py` file. And the code have been submitted to the branch to the ticket.",
    "created_at": "2021-09-08T16:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518203",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:20" align="right">comment:20</div>

> Try changing these methods to `@`classmethod - https://docs.python.org/3/library/functions.html#classmethod

Got it. I have made the change inside the `RealSet` object for placing the `@staticmethod` with `@classmethod` and use `cls()` as a wrapper for returning.

> And push the branch please to the ticket

The above changes, including whole changes for `RealSet`, `Rtree_based_RealSet` class, have been made inside the `sage/src/sage/sets/real_set.py` file. And the code have been submitted to the branch to the ticket.



---

archive/issue_comments_518204.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSince I also want to take a test to check whether it performs correctly and since it has been changed under the `src` folder, for which I thought we can use it explicitly without importing any more. However, `sage` IDE shows that `name 'Rtree_based_RealSet' is not defined`.",
    "created_at": "2021-09-08T16:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518204",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:21" align="right">comment:21</div>

Since I also want to take a test to check whether it performs correctly and since it has been changed under the `src` folder, for which I thought we can use it explicitly without importing any more. However, `sage` IDE shows that `name 'Rtree_based_RealSet' is not defined`.



---

archive/issue_comments_518205.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAlso, I always have a question on how to pushing the latest changes correctly for the sagemath. Assuming there are no previous branches was uploaded for a ticket, If I want to upload a new initial branch for it, either should I merge to the latest version, for example, currently it is sage-9.5, before uploading, or is it ok to keep an old version only if we can run the code without errors?",
    "created_at": "2021-09-08T17:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518205",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:22" align="right">comment:22</div>

Also, I always have a question on how to pushing the latest changes correctly for the sagemath. Assuming there are no previous branches was uploaded for a ticket, If I want to upload a new initial branch for it, either should I merge to the latest version, for example, currently it is sage-9.5, before uploading, or is it ok to keep an old version only if we can run the code without errors?



---

archive/issue_comments_518206.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nYes, your current branch has a merge conflict with the current `develop`, 9.5.beta0, so it is best to merge it in, resolving the conflicts",
    "created_at": "2021-09-08T17:24:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518206",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Yes, your current branch has a merge conflict with the current `develop`, 9.5.beta0, so it is best to merge it in, resolving the conflicts



---

archive/issue_comments_518207.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nActually I see the branch is on top of the cgal swig bindings stuff.\n\nBest to do is the following:\n\n- Start a new branch from 9.5.beta0\n- Merge the branch of #32000\n- cherry-pick the commit 89595a6 with your realset changes",
    "created_at": "2021-09-08T17:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518207",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Actually I see the branch is on top of the cgal swig bindings stuff.

Best to do is the following:

- Start a new branch from 9.5.beta0
- Merge the branch of #32000
- cherry-pick the commit 89595a6 with your realset changes



---

archive/issue_comments_518208.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nA comment on naming the class: For an implementation variant of a class, we would use an underscore-separated suffix: Instead of `Rtree_based_RealSet`, use `RealSet_rtree`",
    "created_at": "2021-09-08T17:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518208",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

A comment on naming the class: For an implementation variant of a class, we would use an underscore-separated suffix: Instead of `Rtree_based_RealSet`, use `RealSet_rtree`



---

archive/issue_comments_518209.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@DRKWang](#comment:21):\n> Since I also want to take a test to check whether it performs correctly and since it has been changed under the `src` folder, for which I thought we can use it explicitly without importing any more. \n\nIf you built Sage without `--enable-editable` (https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library), you will have to use `./sage -b` to install the changes to the Python sources that you made.",
    "created_at": "2021-09-08T17:31:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518209",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@DRKWang](#comment:21):
> Since I also want to take a test to check whether it performs correctly and since it has been changed under the `src` folder, for which I thought we can use it explicitly without importing any more. 

If you built Sage without `--enable-editable` (https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library), you will have to use `./sage -b` to install the changes to the Python sources that you made.



---

archive/issue_comments_518210.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/594bb2605cdabecdbb8f2b7e56deea6a6caafab1\"><code>594bb26</code></a></td><td><code>make a whole change for RealSet class with using 'self.__class__' and '@classmethod', as well as adding a new subclass RealSet_rtree.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2330ca9da9c325d5e4f38550d6a6aea7df7c48fa\"><code>2330ca9</code></a></td><td><code>add new package rtree and libspatialindex</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5902e3ce1ccbaa35177ec905e0b2a120aea2878e\"><code>5902e3c</code></a></td><td><code>build/pkgs/libspatialindex: Make it a normal package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/791aafd58051fc8a6fd11c573c140ae8c6a23fff\"><code>791aafd</code></a></td><td><code>update SPKG.rst, correct distros, add url in checksums.ini, revise spkg-configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68735cbd407e6fd6d2855aff60636a2f2425b48d\"><code>68735cb</code></a></td><td><code>temporarily rename the distributions files under package rtree and libspatialindex with adding prefix_ for later renaming those files with all lowercase, this is caused by git did not make case-sensitive.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/720ff793409a73427bbc16106ab55837a05cd0a5\"><code>720ff79</code></a></td><td><code>Rename the distribution files under package rtree and libspatialindex with lowercases.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4\"><code>dfc5410</code></a></td><td><code>Merge branch 'public/32000' of trac.sagemath.org:sage into realset_rtree</code></td></tr></table>\n",
    "created_at": "2021-09-08T23:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518210",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/594bb2605cdabecdbb8f2b7e56deea6a6caafab1"><code>594bb26</code></a></td><td><code>make a whole change for RealSet class with using 'self.__class__' and '@classmethod', as well as adding a new subclass RealSet_rtree.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2330ca9da9c325d5e4f38550d6a6aea7df7c48fa"><code>2330ca9</code></a></td><td><code>add new package rtree and libspatialindex</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5902e3ce1ccbaa35177ec905e0b2a120aea2878e"><code>5902e3c</code></a></td><td><code>build/pkgs/libspatialindex: Make it a normal package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/791aafd58051fc8a6fd11c573c140ae8c6a23fff"><code>791aafd</code></a></td><td><code>update SPKG.rst, correct distros, add url in checksums.ini, revise spkg-configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68735cbd407e6fd6d2855aff60636a2f2425b48d"><code>68735cb</code></a></td><td><code>temporarily rename the distributions files under package rtree and libspatialindex with adding prefix_ for later renaming those files with all lowercase, this is caused by git did not make case-sensitive.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/720ff793409a73427bbc16106ab55837a05cd0a5"><code>720ff79</code></a></td><td><code>Rename the distribution files under package rtree and libspatialindex with lowercases.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4"><code>dfc5410</code></a></td><td><code>Merge branch 'public/32000' of trac.sagemath.org:sage into realset_rtree</code></td></tr></table>




---

archive/issue_comments_518211.json:
```json
{
    "body": "Changed commit from **[`89595a6`](https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a)** to **[`dfc5410`](https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4)**",
    "created_at": "2021-09-08T23:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518211",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`89595a6`](https://github.com/sagemath/sagetrac-mirror/commit/89595a6a1cb9ac62abdc1b3b5235ee81833bbb4a)** to **[`dfc5410`](https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4)**



---

archive/issue_comments_518212.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@mkoeppe](#comment:26):\n> If you built Sage without `--enable-editable` (https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library), you will have to use `./sage -b` to install the changes to the Python sources that you made.\n\nSince software is not built with `--enable-editable`, I choose to use `./sage -b`. However, still, it is not able to import the `RealSet_rtree` class explicitly.",
    "created_at": "2021-09-11T18:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518212",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@mkoeppe](#comment:26):
> If you built Sage without `--enable-editable` (https://wiki.sagemath.org/ReleaseTours/sage-9.3#Editable_.28.22in-place.22.2C_.22develop.22.29_installs_of_the_Sage_library), you will have to use `./sage -b` to install the changes to the Python sources that you made.

Since software is not built with `--enable-editable`, I choose to use `./sage -b`. However, still, it is not able to import the `RealSet_rtree` class explicitly.



---

archive/issue_comments_518213.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367\"><code>674d982</code></a></td><td><code>\"Fixed 2 bugs:</code></td></tr></table>\n",
    "created_at": "2021-09-11T18:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367"><code>674d982</code></a></td><td><code>"Fixed 2 bugs:</code></td></tr></table>




---

archive/issue_comments_518214.json:
```json
{
    "body": "Changed commit from **[`dfc5410`](https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4)** to **[`674d982`](https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367)**",
    "created_at": "2021-09-11T18:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518214",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dfc5410`](https://github.com/sagemath/sagetrac-mirror/commit/dfc5410a11c9e32eabf13648f4bce7dd20552cb4)** to **[`674d982`](https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367)**



---

archive/issue_comments_518215.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nA few test programs have been made for this class `RealSet_rtree()`, including `case with +-infinity`, `type returned class test`. Those test codes can be found at the end here. https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/test%20for%20real_set_with_rtree.ipynb\n\nAs a result, I found 2 bugs, \n- one is for misplacing the `return self.__class__(*intervals)`;\n- the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately.",
    "created_at": "2021-09-11T18:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518215",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:30" align="right">comment:30</div>

A few test programs have been made for this class `RealSet_rtree()`, including `case with +-infinity`, `type returned class test`. Those test codes can be found at the end here. https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/test%20for%20real_set_with_rtree.ipynb

As a result, I found 2 bugs, 
- one is for misplacing the `return self.__class__(*intervals)`;
- the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately.



---

archive/issue_comments_518216.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@DRKWang](#comment:30):\n> As a result, I found 2 bugs, \n> - one is for misplacing the `return self.__class__(*intervals)`;\n> - the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately. \n\nBest practice is to add a test to the doctests that demonstrate that it now works correctly.",
    "created_at": "2021-09-11T19:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518216",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@DRKWang](#comment:30):
> As a result, I found 2 bugs, 
> - one is for misplacing the `return self.__class__(*intervals)`;
> - the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately. 

Best practice is to add a test to the doctests that demonstrate that it now works correctly.



---

archive/issue_comments_518217.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@mkoeppe](#comment:31):\n> Replying to [@DRKWang](#comment:30):\n> > As a result, I found 2 bugs, \n> > - one is for misplacing the `return self.__class__(*intervals)`;\n> > - the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately. \n\n> \n> Best practice is to add a test to the doctests that demonstrate that it now works correctly.\n\nFollowing this instruction https://doc.sagemath.org/html/en/developer/doctesting.html#beyond-the-sage-library, I tried to use `./sage -t src/sage/sets/real_set.py `for docstring. However, All the testing results are failures. There are 2 types of arisen errors, one failure comes from `SyntaxError: multiple statements found while compiling a single statement`, the other comes from `NameError: name'RealSet_rtree' is not defined`. For the first, I guess it is caused by format error, something like an invisible return, but I have no idea about the second one. The log file is here. https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/failure%20info.txt",
    "created_at": "2021-09-12T01:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518217",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@mkoeppe](#comment:31):
> Replying to [@DRKWang](#comment:30):
> > As a result, I found 2 bugs, 
> > - one is for misplacing the `return self.__class__(*intervals)`;
> > - the other is that since `floor()` and `ceil()` can not deal with `+-infinity` properly, we have to make it separately. 

> 
> Best practice is to add a test to the doctests that demonstrate that it now works correctly.

Following this instruction https://doc.sagemath.org/html/en/developer/doctesting.html#beyond-the-sage-library, I tried to use `./sage -t src/sage/sets/real_set.py `for docstring. However, All the testing results are failures. There are 2 types of arisen errors, one failure comes from `SyntaxError: multiple statements found while compiling a single statement`, the other comes from `NameError: name'RealSet_rtree' is not defined`. For the first, I guess it is caused by format error, something like an invisible return, but I have no idea about the second one. The log file is here. https://github.com/DRKWang/Data-structure-for-piecewise-linear-function/blob/main/logsfile/failure%20info.txt



---

archive/issue_comments_518218.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe current branch defines `class RealSet_rtree` 3 times -- that's probably the first thing that should be cleaned up",
    "created_at": "2021-09-12T02:03:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518218",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

The current branch defines `class RealSet_rtree` 3 times -- that's probably the first thing that should be cleaned up



---

archive/issue_comments_518219.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI tried the first example from your worksheet, after importing the class:\n\n```\nsage: from sage.sets.real_set import RealSet_rtree                                                                                                                           \n```\n\n```\nsage: A = RealSet_rtree(0,1) \n....: B = RealSet_rtree(0.5,3) \n....: C = A.intersection(B) \n....: type(C)                                                                                                                                                                \n```\n\nI get this error:\n\n```\n~/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/sets/real_set.py in __init__(self, *intervals)\n   2707             if (x_max < lower) and (lower != +Infinity):\n   2708                 x_max = lower\n-> 2709             if (x_max < upper) and (upper != +Infinity):\n   2710                 x_max = upper\n   2711         if x_max == 0: #rtree is not needed, since they are only +-infinity and zero!\n\nNameError: name 'Infinity' is not defined\n```\n\nThis means that you need to add some import statements to the file.\nYou can type `import_statements('Infinity')` to help with this.\n\nThe doctests of the new class `RealSet_rtree` are copy-paste from `RealSet` and do not test the new class. Best to replace them by the tests that you have in your worksheet.",
    "created_at": "2021-09-12T02:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518219",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

I tried the first example from your worksheet, after importing the class:

```
sage: from sage.sets.real_set import RealSet_rtree                                                                                                                           
```

```
sage: A = RealSet_rtree(0,1) 
....: B = RealSet_rtree(0.5,3) 
....: C = A.intersection(B) 
....: type(C)                                                                                                                                                                
```

I get this error:

```
~/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/sets/real_set.py in __init__(self, *intervals)
   2707             if (x_max < lower) and (lower != +Infinity):
   2708                 x_max = lower
-> 2709             if (x_max < upper) and (upper != +Infinity):
   2710                 x_max = upper
   2711         if x_max == 0: #rtree is not needed, since they are only +-infinity and zero!

NameError: name 'Infinity' is not defined
```

This means that you need to add some import statements to the file.
You can type `import_statements('Infinity')` to help with this.

The doctests of the new class `RealSet_rtree` are copy-paste from `RealSet` and do not test the new class. Best to replace them by the tests that you have in your worksheet.



---

archive/issue_comments_518220.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mkoeppe](#comment:33):\n> The current branch defines `class RealSet_rtree` 3 times -- that's probably the first thing that should be cleaned up\n\nSo desperate! It is really a fatal and long-history mistake, even existing for 3 commits. I guess it is caused by using Jupiter notebook a lot. I will be cautious next time.",
    "created_at": "2021-09-12T23:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518220",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mkoeppe](#comment:33):
> The current branch defines `class RealSet_rtree` 3 times -- that's probably the first thing that should be cleaned up

So desperate! It is really a fatal and long-history mistake, even existing for 3 commits. I guess it is caused by using Jupiter notebook a lot. I will be cautious next time.



---

archive/issue_comments_518221.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nDon't worry about it. It's easy to clean up the commit history later",
    "created_at": "2021-09-13T01:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518221",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Don't worry about it. It's easy to clean up the commit history later



---

archive/issue_comments_518222.json:
```json
{
    "body": "Changed commit from **[`674d982`](https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367)** to **[`8c1f0c1`](https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858)**",
    "created_at": "2021-09-13T17:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518222",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`674d982`](https://github.com/sagemath/sagetrac-mirror/commit/674d9827224beb4f481451e70b332f989635d367)** to **[`8c1f0c1`](https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858)**



---

archive/issue_comments_518223.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5384eca9d24ebec43b066e25ddb4e815790b86d\"><code>b5384ec</code></a></td><td><code>Deleted redundant RealSet_rtree classes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858\"><code>8c1f0c1</code></a></td><td><code>Add doctests for class RealSet_rtree()</code></td></tr></table>\n",
    "created_at": "2021-09-13T17:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518223",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5384eca9d24ebec43b066e25ddb4e815790b86d"><code>b5384ec</code></a></td><td><code>Deleted redundant RealSet_rtree classes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858"><code>8c1f0c1</code></a></td><td><code>Add doctests for class RealSet_rtree()</code></td></tr></table>




---

archive/issue_comments_518224.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@mkoeppe](#comment:26):\n> you will have to use `./sage -b` to install the changes to the Python sources that you made.\n\nI tried to use `./sage -b` again after the meeting this morning, the `real_set.py` file under the directory of `SAGE_LOCAL/lib/python3.7/site-packages/sage/sets` did be rebuilt. But, Sage still shows `NameError: name 'RealSet_rtree' is not defined`. Did I miss any other commands?",
    "created_at": "2021-09-13T19:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518224",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@mkoeppe](#comment:26):
> you will have to use `./sage -b` to install the changes to the Python sources that you made.

I tried to use `./sage -b` again after the meeting this morning, the `real_set.py` file under the directory of `SAGE_LOCAL/lib/python3.7/site-packages/sage/sets` did be rebuilt. But, Sage still shows `NameError: name 'RealSet_rtree' is not defined`. Did I miss any other commands?



---

archive/issue_comments_518225.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nYou need to import it before using, see [comment:34](#comment:34)",
    "created_at": "2021-09-13T19:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518225",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

You need to import it before using, see [comment:34](#comment:34)



---

archive/issue_comments_518226.json:
```json
{
    "body": "Changed commit from **[`8c1f0c1`](https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858)** to **[`d160842`](https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027)**",
    "created_at": "2021-09-14T01:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518226",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8c1f0c1`](https://github.com/sagemath/sagetrac-mirror/commit/8c1f0c1602b5163a61a08474623f084f319b9858)** to **[`d160842`](https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027)**



---

archive/issue_comments_518227.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027\"><code>d160842</code></a></td><td><code>Doctests for class RealSet_rtree() have been adjusted and passed the test.</code></td></tr></table>\n",
    "created_at": "2021-09-14T01:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518227",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027"><code>d160842</code></a></td><td><code>Doctests for class RealSet_rtree() have been adjusted and passed the test.</code></td></tr></table>




---

archive/issue_comments_518228.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@mkoeppe](#comment:34):\n\n> The doctests of the new class `RealSet_rtree` are copy-paste from `RealSet` and do not test the new class. Best to replace them by the tests that you have in your worksheet.\n\nI have updated the doctests of the new class `RealSet_rtree`. And those doctests have been passed successfully. However, according to this documentation, https://doc.sagemath.org/pdf/en/reference/doctest/doctest.pdf, \"Sage currently accepts backslashes as indicating that the end of the current line should be joined to the\nnext line. This feature allows for breaking large integers over multiple lines but is not standard for Python doctesting.\", which infers the sage doctest can only deal with single line, except the cases with `for`, `while` and ending with `:`. Therefore, I have to use `;` to make it into one line, which is not beautiful and clear.",
    "created_at": "2021-09-14T01:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518228",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@mkoeppe](#comment:34):

> The doctests of the new class `RealSet_rtree` are copy-paste from `RealSet` and do not test the new class. Best to replace them by the tests that you have in your worksheet.

I have updated the doctests of the new class `RealSet_rtree`. And those doctests have been passed successfully. However, according to this documentation, https://doc.sagemath.org/pdf/en/reference/doctest/doctest.pdf, "Sage currently accepts backslashes as indicating that the end of the current line should be joined to the
next line. This feature allows for breaking large integers over multiple lines but is not standard for Python doctesting.", which infers the sage doctest can only deal with single line, except the cases with `for`, `while` and ending with `:`. Therefore, I have to use `;` to make it into one line, which is not beautiful and clear.



---

archive/issue_comments_518229.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nIn order to make the projecting directions more separable with respect to cones of a given fan, we could generate certain directions based on the inclination of cones of a given fan instead of randomly.\n\nSuppose the dimension of universal space is $n$. Concretely, \n\n1. We will compute the inclination first. We measure this inclination of the fan with \"average point\" $q$. The average point is defined by $q = \\sum p_i$, $\\{p_i\\}$ are the points along with the generating rays of the fan and whose 1-norm is exactly 1.\n\n2. Then, choose a set of orthogonal basis $\\{v_j\\}$ coming from the complementary space of the space generated by $q$, i.e. $\\forall i$, $v_j  \\perp q$. Note that, since the average point $q$ could be zero vector, in that case, we will choose $N(1,0,...0)$, $N(0,1,..., 0)$,..., $N(0,0,...,1)$ as the basis. The chosen set of orthogonal basis  $\\{v_j\\}$ could be good candidates for seperating the cones of fan. One way of generating the orthogonal basis $\\{v_j\\}$ will be using [Gram\u2013Schmidt process](https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process).\n\n3. After generating an orthogonal basis $\\{v_j\\}$, the basis will be stored in the class `RationalPolyhedralFan` as attributes of the class. and those attributes will be invoked for generating new boxes for function `_contains()`.",
    "created_at": "2021-10-01T00:21:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518229",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:43" align="right">comment:43</div>

In order to make the projecting directions more separable with respect to cones of a given fan, we could generate certain directions based on the inclination of cones of a given fan instead of randomly.

Suppose the dimension of universal space is $n$. Concretely, 

1. We will compute the inclination first. We measure this inclination of the fan with "average point" $q$. The average point is defined by $q = \sum p_i$, $\{p_i\}$ are the points along with the generating rays of the fan and whose 1-norm is exactly 1.

2. Then, choose a set of orthogonal basis $\{v_j\}$ coming from the complementary space of the space generated by $q$, i.e. $\forall i$, $v_j  \perp q$. Note that, since the average point $q$ could be zero vector, in that case, we will choose $N(1,0,...0)$, $N(0,1,..., 0)$,..., $N(0,0,...,1)$ as the basis. The chosen set of orthogonal basis  $\{v_j\}$ could be good candidates for seperating the cones of fan. One way of generating the orthogonal basis $\{v_j\}$ will be using [Gram–Schmidt process](https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process).

3. After generating an orthogonal basis $\{v_j\}$, the basis will be stored in the class `RationalPolyhedralFan` as attributes of the class. and those attributes will be invoked for generating new boxes for function `_contains()`.



---

archive/issue_comments_518230.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@DRKWang](#comment:43):\n> In order to make the projecting directions more separable with respect to cones of a given fan, we could generate certain directions based on the inclination of cones of a given fan instead of randomly.\n> \n> Suppose the dimension of universal space is $n$. Concretely, \n> \n> 1. We will compute the inclination first. We measure this inclination of the fan with \"average point\" $q$. The average point is defined by $q = \\sum p_i$, $\\{p_i\\}$ are the points along with the generating rays of the fan and whose 1-norm is exactly 1.\n> \n> 2. Then, choose a set of orthogonal basis $\\{v_j\\}$ coming from the complementary space of the space generated by $q$, i.e. $\\forall i$, $v_j  \\perp q$. Note that, since the average point $q$ could be zero vector, in that case, we will choose $N(1,0,...0)$, $N(0,1,..., 0)$,..., $N(0,0,...,1)$ as the basis. The chosen set of orthogonal basis  $\\{v_j\\}$ could be good candidates for seperating the cones of fan. One way of generating the orthogonal basis $\\{v_j\\}$ will be using [Gram\u2013Schmidt process](https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process).\n> \n> 3. After generating an orthogonal basis $\\{v_j\\}$, the basis will be stored in the class `RationalPolyhedralFan` as attributes of the class. and those attributes will be invoked for generating new boxes for function `_contains()`.\n\nI have no idea that it does not support the Latex display here. For convenience, you may check the Latex display from the section \"Generating projecting directions based on the inclination of cones of a given fan\" \nhttps://github.com/DRKWang/cutgeneratingfunctions_new/blob/develop/log44.ipynb.",
    "created_at": "2021-10-01T00:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518230",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@DRKWang](#comment:43):
> In order to make the projecting directions more separable with respect to cones of a given fan, we could generate certain directions based on the inclination of cones of a given fan instead of randomly.
> 
> Suppose the dimension of universal space is $n$. Concretely, 
> 
> 1. We will compute the inclination first. We measure this inclination of the fan with "average point" $q$. The average point is defined by $q = \sum p_i$, $\{p_i\}$ are the points along with the generating rays of the fan and whose 1-norm is exactly 1.
> 
> 2. Then, choose a set of orthogonal basis $\{v_j\}$ coming from the complementary space of the space generated by $q$, i.e. $\forall i$, $v_j  \perp q$. Note that, since the average point $q$ could be zero vector, in that case, we will choose $N(1,0,...0)$, $N(0,1,..., 0)$,..., $N(0,0,...,1)$ as the basis. The chosen set of orthogonal basis  $\{v_j\}$ could be good candidates for seperating the cones of fan. One way of generating the orthogonal basis $\{v_j\}$ will be using [Gram–Schmidt process](https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process).
> 
> 3. After generating an orthogonal basis $\{v_j\}$, the basis will be stored in the class `RationalPolyhedralFan` as attributes of the class. and those attributes will be invoked for generating new boxes for function `_contains()`.

I have no idea that it does not support the Latex display here. For convenience, you may check the Latex display from the section "Generating projecting directions based on the inclination of cones of a given fan" 
https://github.com/DRKWang/cutgeneratingfunctions_new/blob/develop/log44.ipynb.



---

archive/issue_comments_518231.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nAnother way to select a set of projection directions:\n- A subset of the set of normal vectors of all facets of all cones.\n- Perhaps there is a way to measure how \"separating\" one of these candidate normal vectors is?",
    "created_at": "2021-10-01T23:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518231",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Another way to select a set of projection directions:
- A subset of the set of normal vectors of all facets of all cones.
- Perhaps there is a way to measure how "separating" one of these candidate normal vectors is?



---

archive/issue_comments_518232.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@mkoeppe](#comment:45):\n> Another way to select a set of projection directions:\n> - A subset of the set of normal vectors of all facets of all cones.\n> - Perhaps there is a way to measure how \"separating\" one of these candidate normal vectors is?\n> \n\nI agree that \"the normal vectors of all facets of all cones could also be good candidates for separating these cones\". In some sense, those facets can be basically categorized into 2 types, either a facet including an intersection of two maximal cones, or just a pure facet without any intersection. Comparing those two types with each other, the first one seems to be more important and \"separating\", since the first one focuses on neighbor separating, whereas the second one does not show any information. Thus, we could generate some projecting directions based on the normal vectors of some facets of cones.\n\nGenerally, the facets including an intersection can still be categorized into more subtypes based on what is the dimension of the intersection. And heuristically, the higher dimension of the intersection is, the more efficient this normal vector is. But, due to the complexity problem, I feel it is not necessary to categorize those facets at that level.\n\nEven though the above method seems to be efficient, it could be weak when it comes to the case where all cones of a given do not have any intersection except the original points. In that case, there is no \"first type of facets\" at all. Thus, if that happens, we may need other ways to generate those directions. A good way is to use the direction coming from 2 center points of the tokens of two neighboring cones as supplied directions.",
    "created_at": "2021-10-05T00:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518232",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@mkoeppe](#comment:45):
> Another way to select a set of projection directions:
> - A subset of the set of normal vectors of all facets of all cones.
> - Perhaps there is a way to measure how "separating" one of these candidate normal vectors is?
> 

I agree that "the normal vectors of all facets of all cones could also be good candidates for separating these cones". In some sense, those facets can be basically categorized into 2 types, either a facet including an intersection of two maximal cones, or just a pure facet without any intersection. Comparing those two types with each other, the first one seems to be more important and "separating", since the first one focuses on neighbor separating, whereas the second one does not show any information. Thus, we could generate some projecting directions based on the normal vectors of some facets of cones.

Generally, the facets including an intersection can still be categorized into more subtypes based on what is the dimension of the intersection. And heuristically, the higher dimension of the intersection is, the more efficient this normal vector is. But, due to the complexity problem, I feel it is not necessary to categorize those facets at that level.

Even though the above method seems to be efficient, it could be weak when it comes to the case where all cones of a given do not have any intersection except the original points. In that case, there is no "first type of facets" at all. Thus, if that happens, we may need other ways to generate those directions. A good way is to use the direction coming from 2 center points of the tokens of two neighboring cones as supplied directions.



---

archive/issue_comments_518233.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nFor the `rtree.intersection()` function, we can make the return objects of it either a list of boxes with an `rtree` data structure or a set of boxes without any structure. we can build a flag, like `rtree_rebuilt = true/false` to indicate the intention of it. Concretely, the boxes with an `rtree` data structure will be rebuilt by the class of `rtree` that we defined.",
    "created_at": "2021-10-11T17:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518233",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:48" align="right">comment:48</div>

For the `rtree.intersection()` function, we can make the return objects of it either a list of boxes with an `rtree` data structure or a set of boxes without any structure. we can build a flag, like `rtree_rebuilt = true/false` to indicate the intention of it. Concretely, the boxes with an `rtree` data structure will be rebuilt by the class of `rtree` that we defined.



---

archive/issue_comments_518234.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nFor the static construction, we may build the rtree by 3 ways, top-down, bottom-up or hybrid. Supposedly, there are $n$ boxes in $k$ dimension for construction. \n\nThe idea of top-down should be made by recursive operation, which means the parent tree will be built after their children's trees were built. My expectation will be something like an H tree (https://en.wikipedia.org/wiki/H_tree), which has a property of self-similar fractal, or like a $k-D tree$. Anyway, the similarity of the subsets of boxes can be displayed on the rtree. Concretely, one way to do this is as follows:\n\n1. Separate the whole boxes into 2 subsets, equivalently in terms of numbers, based on their X-coordinate. And take those 2 subsets as the materials for building the left sub-rtree and right sub-rtree.\n2. Cyclically switch the criteria from x-coordinate to y-coordinate, to z-coordinate with separating the subsets smaller and smaller until the number of subsets equal 1. For this case, the complexity of it will be $nlog(n)+2* n/2 log(n/2) + 4* n/2 log(n/4) + ... + n*1 log(1) <= n log(n) * log(n) $\n\n\nFor the bottom-up, we may use the greedy strategy to do the local optimization on each step. We can always merge two boxes based on some criteria, like merging the two boxes that have minimal 1-norm distance. And replace the 2 boxes with merged box, so that the size of the input will be decreased by 1, (now the number of boxes will be $n-1$). Thus, after $n-1$ steps, the rtree will be built completely.\n\nThe complexity will be at least `n^2`, since we will compute the distance at least.\n\nFor the hybrid one, we can build the rtree partially by top-down and partially by bottom-up in certain steps. But, how to combining them adaptively is still a hard problem for me. I would like to implement the first two before thinking about the third one.",
    "created_at": "2021-10-12T01:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518234",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:49" align="right">comment:49</div>

For the static construction, we may build the rtree by 3 ways, top-down, bottom-up or hybrid. Supposedly, there are $n$ boxes in $k$ dimension for construction. 

The idea of top-down should be made by recursive operation, which means the parent tree will be built after their children's trees were built. My expectation will be something like an H tree (https://en.wikipedia.org/wiki/H_tree), which has a property of self-similar fractal, or like a $k-D tree$. Anyway, the similarity of the subsets of boxes can be displayed on the rtree. Concretely, one way to do this is as follows:

1. Separate the whole boxes into 2 subsets, equivalently in terms of numbers, based on their X-coordinate. And take those 2 subsets as the materials for building the left sub-rtree and right sub-rtree.
2. Cyclically switch the criteria from x-coordinate to y-coordinate, to z-coordinate with separating the subsets smaller and smaller until the number of subsets equal 1. For this case, the complexity of it will be $nlog(n)+2* n/2 log(n/2) + 4* n/2 log(n/4) + ... + n*1 log(1) <= n log(n) * log(n) $


For the bottom-up, we may use the greedy strategy to do the local optimization on each step. We can always merge two boxes based on some criteria, like merging the two boxes that have minimal 1-norm distance. And replace the 2 boxes with merged box, so that the size of the input will be decreased by 1, (now the number of boxes will be $n-1$). Thus, after $n-1$ steps, the rtree will be built completely.

The complexity will be at least `n^2`, since we will compute the distance at least.

For the hybrid one, we can build the rtree partially by top-down and partially by bottom-up in certain steps. But, how to combining them adaptively is still a hard problem for me. I would like to implement the first two before thinking about the third one.



---

archive/issue_comments_518235.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nThe following content in latex form can be checked in this link.(https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/logsfile/log48.ipynb)\n\nTo determine whether a given fan is a pointed fan or not, we may encode it into an linear optimization.\n\n##### Observation:\n\nIf a fan is pointed, then there exists a containing-the-original-point hyperplane that could divide the space into 2 half-spaces, one containing the fan and the other not.\n\n##### Analysis:\nWe may think about finding the normal vector of this hyperplane via optimzation.\nLet us encode it.\n\nSupposing that the normal vector of this hyperplane is $x$ and 1-norm vectors of the generating rays of all cones in the fan are $r_i, i\\in A $,\n\nthen we may have let the constraints be:\n\n$x \\cdot r_i \\ge 0$\n\nSince we do not hope to get $x = 0$, we may add an extra constraint, $x_1 = 1$, for getting one representing element.\n\nIf we can not find any solution for this system, then the fan is not pointed.\nIf we can find one solution, then the fan is pointed.\n\nIn practice, in order to give a initial solution for simplex method, we may change the system into the following form:\n\nmax. : $x_1$\n\ns.t. \n\n$x \\cdot r_i \\ge 0$\n\n$1\\ge x_1 \\ge 0$\n\nAs is desired, $x = 0$ always be the solution for this system.\n\n##### A better hyperplane for generating better projection\n\nSeemingly, we may have optional hyperplanes for the same system. The ideal hyperplane would be constraints are all $>$, instead of $\\ge$. We may get rid of $x_1 = 1$ and add a little \"balance\" for each constraints to get it. i.e.\n\n$x \\cdot r_i - b_i\\ge 0$\n\n$b_i$ are all some given small positive numbers.\n\nSimilarly, in order to have a initial solution, we may change the system into the following form:\n\nmax. :$ b_0$\n\n$x \\cdot r_i - b_i\\ge 0$\n\n$b_i \\ge b_0$\n\n$1\\ge b_0 \\ge 0$ \n\nAs is desired, $x = 0$ always be the solution for this system.",
    "created_at": "2021-11-04T04:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518235",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:50" align="right">comment:50</div>

The following content in latex form can be checked in this link.(https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/logsfile/log48.ipynb)

To determine whether a given fan is a pointed fan or not, we may encode it into an linear optimization.

##### Observation:

If a fan is pointed, then there exists a containing-the-original-point hyperplane that could divide the space into 2 half-spaces, one containing the fan and the other not.

##### Analysis:
We may think about finding the normal vector of this hyperplane via optimzation.
Let us encode it.

Supposing that the normal vector of this hyperplane is $x$ and 1-norm vectors of the generating rays of all cones in the fan are $r_i, i\in A $,

then we may have let the constraints be:

$x \cdot r_i \ge 0$

Since we do not hope to get $x = 0$, we may add an extra constraint, $x_1 = 1$, for getting one representing element.

If we can not find any solution for this system, then the fan is not pointed.
If we can find one solution, then the fan is pointed.

In practice, in order to give a initial solution for simplex method, we may change the system into the following form:

max. : $x_1$

s.t. 

$x \cdot r_i \ge 0$

$1\ge x_1 \ge 0$

As is desired, $x = 0$ always be the solution for this system.

##### A better hyperplane for generating better projection

Seemingly, we may have optional hyperplanes for the same system. The ideal hyperplane would be constraints are all $>$, instead of $\ge$. We may get rid of $x_1 = 1$ and add a little "balance" for each constraints to get it. i.e.

$x \cdot r_i - b_i\ge 0$

$b_i$ are all some given small positive numbers.

Similarly, in order to have a initial solution, we may change the system into the following form:

max. :$ b_0$

$x \cdot r_i - b_i\ge 0$

$b_i \ge b_0$

$1\ge b_0 \ge 0$ 

As is desired, $x = 0$ always be the solution for this system.



---

archive/issue_comments_518236.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nExcept for the above view, we may think differently from the view of the convex hull of the fan, but it will be much harder than the above one, in terms of implementation and theory.\n\nBased on the following observation, we can have:\n\nIf the convex hull of the fan is the universal space, then it is not pointed; otherwise, it is pointed.\n\nThus, we can figure out the convex hull to determine whether it is pointed or not.\n\nIn the beginning, my imagination to compute the convex hull will be the \"Graham scan method\", a popular method for computing the convex hull in 2 dimensions. But when it comes to high dimensions, this algorithm will fail and be replaced by an algorithm called \"Quickhull\", (https://en.wikipedia.org/wiki/Quickhull), for computing the convex hull. This algorithm is a little randomized for initial selection and a little bit complicated understanding. And in terms of performance, although this algorithm may recursively get the convex hull, we still need to compute the normal vector for the hyperplane, onto which the fan will be projected, based on the above optimization.",
    "created_at": "2021-11-04T05:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518236",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:51" align="right">comment:51</div>

Except for the above view, we may think differently from the view of the convex hull of the fan, but it will be much harder than the above one, in terms of implementation and theory.

Based on the following observation, we can have:

If the convex hull of the fan is the universal space, then it is not pointed; otherwise, it is pointed.

Thus, we can figure out the convex hull to determine whether it is pointed or not.

In the beginning, my imagination to compute the convex hull will be the "Graham scan method", a popular method for computing the convex hull in 2 dimensions. But when it comes to high dimensions, this algorithm will fail and be replaced by an algorithm called "Quickhull", (https://en.wikipedia.org/wiki/Quickhull), for computing the convex hull. This algorithm is a little randomized for initial selection and a little bit complicated understanding. And in terms of performance, although this algorithm may recursively get the convex hull, we still need to compute the normal vector for the hyperplane, onto which the fan will be projected, based on the above optimization.



---

archive/issue_comments_518237.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAs is enlightened by your idea for considering the double descriptions of cones, facets, and generating rays, we may have a facets-based method to find the proper normal vector of the separating hyperplane for a pointed fan.\n\n*Observation:*\n\nFor a cone, a ray is in the (interior or boundary) of its polar cone, if and only if, the ray can induce (an interior or a boundary) separating hyperplane, whose normal vector is the ray, for this cone.\n\nNote that the polar cone of cone $C$ is defined by the negative dual cone of cone $C$, i.e.\n\nthe polar cone of cone $C$ = $\\{y | y\\cdot x \\le 0, \\forall x \\in C\\}$\n\nThus, to figure out the separating hyperplane for a fan, the polar cones of cones in this fan can provide help.\n\n*Observation:*\n\nFor a fan, a ray is in the interior points of the common intersection of all polar cones of the fan, if and only if, the ray can induce an interior separating hyperplane for the fan.\n\n*Proof*\n\nA ray is in the interior points of the common intersection of all polar cones,\n\n$\\iff$ it must be in the interior points of each polar cone,\n\n$\\iff$ it must induce the same interior separating hyperplane for each cone in the fan,\n\n$\\iff$ it must induce an interior separating hyperplane for the fan.\n\nThus, we can have a better understanding of the location of the normal vector of separating hyperplane for a fan. Meanwhile, we can also use it to determine whether a fan is a pointed fan or not.",
    "created_at": "2021-11-10T18:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518237",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:52" align="right">comment:52</div>

As is enlightened by your idea for considering the double descriptions of cones, facets, and generating rays, we may have a facets-based method to find the proper normal vector of the separating hyperplane for a pointed fan.

*Observation:*

For a cone, a ray is in the (interior or boundary) of its polar cone, if and only if, the ray can induce (an interior or a boundary) separating hyperplane, whose normal vector is the ray, for this cone.

Note that the polar cone of cone $C$ is defined by the negative dual cone of cone $C$, i.e.

the polar cone of cone $C$ = $\{y | y\cdot x \le 0, \forall x \in C\}$

Thus, to figure out the separating hyperplane for a fan, the polar cones of cones in this fan can provide help.

*Observation:*

For a fan, a ray is in the interior points of the common intersection of all polar cones of the fan, if and only if, the ray can induce an interior separating hyperplane for the fan.

*Proof*

A ray is in the interior points of the common intersection of all polar cones,

$\iff$ it must be in the interior points of each polar cone,

$\iff$ it must induce the same interior separating hyperplane for each cone in the fan,

$\iff$ it must induce an interior separating hyperplane for the fan.

Thus, we can have a better understanding of the location of the normal vector of separating hyperplane for a fan. Meanwhile, we can also use it to determine whether a fan is a pointed fan or not.



---

archive/issue_comments_518238.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nBased on these testing records https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/test_for_facets_and_generating_rays_based_methods.ipynb, in terms of time, the generating-rays-based method has significantly outperformed the facets-based method. \nHowever, according to test 4 in the above records, the LP-solver may have some numerical issues and it may lead to some inaccurate determination.\n\nIn my two cents, since LP-solver only takes a little time and the solution for the linear programming can be easily verified, we may use the LP-solver first to try to get a solution, if it fails or it only gives zero solution, then we use the facets-based method instead; otherwise, if the solution is non-zero, we may verify its correctness, and if the solution is correct, then we are home and we do not need the facets-based method. This mixed-method is better than the pure facets-based method especially in the case that the fan is pointed because in that case, it is really difficult to compute common intersection for all cones with keeping in analytical status according to the testing records.",
    "created_at": "2021-11-15T18:01:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518238",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:53" align="right">comment:53</div>

Based on these testing records https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/test_for_facets_and_generating_rays_based_methods.ipynb, in terms of time, the generating-rays-based method has significantly outperformed the facets-based method. 
However, according to test 4 in the above records, the LP-solver may have some numerical issues and it may lead to some inaccurate determination.

In my two cents, since LP-solver only takes a little time and the solution for the linear programming can be easily verified, we may use the LP-solver first to try to get a solution, if it fails or it only gives zero solution, then we use the facets-based method instead; otherwise, if the solution is non-zero, we may verify its correctness, and if the solution is correct, then we are home and we do not need the facets-based method. This mixed-method is better than the pure facets-based method especially in the case that the fan is pointed because in that case, it is really difficult to compute common intersection for all cones with keeping in analytical status according to the testing records.



---

archive/issue_comments_518239.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nApart from the function `contains()`, I just realized that the class `RationalPolyhedralFan` also has another function `support_contains(self,*args)`, which is used for checking if a point is contained in the support of the fan, and the support of a fan is the union of all cones of the fan. This function is pretty good for the usage of rtree, and based on the following test results, https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/fan_rtree_test.ipynb, it shows that the support of rtree gives better performance than the original one. The only disadvantage is that the construction of rtree in the initial part may take a little longer time. But based on the test results, it only takes extra at most 1/3 time compared with the original one, which is much smaller than saving time for using `support_contains(self,*args)`.",
    "created_at": "2021-11-20T06:13:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518239",
    "user": "https://github.com/DRKWang"
}
```

<div id="comment:54" align="right">comment:54</div>

Apart from the function `contains()`, I just realized that the class `RationalPolyhedralFan` also has another function `support_contains(self,*args)`, which is used for checking if a point is contained in the support of the fan, and the support of a fan is the union of all cones of the fan. This function is pretty good for the usage of rtree, and based on the following test results, https://github.com/DRKWang/cutgeneratingfunctions_new/blob/main/fan_rtree_test.ipynb, it shows that the support of rtree gives better performance than the original one. The only disadvantage is that the construction of rtree in the initial part may take a little longer time. But based on the test results, it only takes extra at most 1/3 time compared with the original one, which is much smaller than saving time for using `support_contains(self,*args)`.



---

archive/issue_comments_518240.json:
```json
{
    "body": "Changed commit from **[`d160842`](https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027)** to **[`ebe6d92`](https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880)**",
    "created_at": "2021-11-20T23:38:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518240",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d160842`](https://github.com/sagemath/sagetrac-mirror/commit/d160842d5b2c1f129ef843377e443636393b8027)** to **[`ebe6d92`](https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880)**



---

archive/issue_comments_518241.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9b20a05f9ddc979bca565d0a53828ba398e129e\"><code>c9b20a0</code></a></td><td><code>fixed the rtree's checksum</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/078f8231b843961cd9eb1636625de269383511fe\"><code>078f823</code></a></td><td><code>adding self.polar() for class ConvexRationalPolyhedralCone()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880\"><code>ebe6d92</code></a></td><td><code>add subclass: RationalPolyhedralFan_rtree for function support_contains().</code></td></tr></table>\n",
    "created_at": "2021-11-20T23:38:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518241",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9b20a05f9ddc979bca565d0a53828ba398e129e"><code>c9b20a0</code></a></td><td><code>fixed the rtree's checksum</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/078f8231b843961cd9eb1636625de269383511fe"><code>078f823</code></a></td><td><code>adding self.polar() for class ConvexRationalPolyhedralCone()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880"><code>ebe6d92</code></a></td><td><code>add subclass: RationalPolyhedralFan_rtree for function support_contains().</code></td></tr></table>




---

archive/issue_comments_518242.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1\"><code>a2fa0ba</code></a></td><td><code>Fixed bugs in docstring.</code></td></tr></table>\n",
    "created_at": "2021-11-21T00:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518242",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1"><code>a2fa0ba</code></a></td><td><code>Fixed bugs in docstring.</code></td></tr></table>




---

archive/issue_comments_518243.json:
```json
{
    "body": "Changed commit from **[`ebe6d92`](https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880)** to **[`a2fa0ba`](https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1)**",
    "created_at": "2021-11-21T00:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518243",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ebe6d92`](https://github.com/sagemath/sagetrac-mirror/commit/ebe6d929ee4bf48834dc1ea51d7fe51b65469880)** to **[`a2fa0ba`](https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1)**



---

archive/issue_events_443742.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-03T18:14:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443742"
}
```



---

archive/issue_comments_518244.json:
```json
{
    "body": "Author: **Binshuai Wang**",
    "created_at": "2021-12-03T18:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518244",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Binshuai Wang**



---

archive/issue_comments_518245.json:
```json
{
    "body": "Changed commit from **[`a2fa0ba`](https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1)** to **[`05ea99d`](https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636)**",
    "created_at": "2021-12-08T01:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518245",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a2fa0ba`](https://github.com/sagemath/sagetrac-mirror/commit/a2fa0baaf7168d67a75f290640ad86cda2d75ad1)** to **[`05ea99d`](https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636)**



---

archive/issue_comments_518246.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636\"><code>05ea99d</code></a></td><td><code>Fixed the failed examples in  Class.</code></td></tr></table>\n",
    "created_at": "2021-12-08T01:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518246",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05ea99da812dd754edd97a717ae1c18eeeec1636"><code>05ea99d</code></a></td><td><code>Fixed the failed examples in  Class.</code></td></tr></table>




---

archive/issue_events_443743.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:21:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443743"
}
```



---

archive/issue_events_443744.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:21:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443744"
}
```



---

archive/issue_comments_518247.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nDocbuild fails\n\n```\nOSError: /sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/geometry/cone.py:docstring of sage.geometry.cone.ConvexRationalPolyhedralCone.polar:6: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```",
    "created_at": "2022-02-01T16:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518247",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

Docbuild fails

```
OSError: /sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/geometry/cone.py:docstring of sage.geometry.cone.ConvexRationalPolyhedralCone.polar:6: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

archive/issue_events_443745.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-01T16:06:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443745"
}
```



---

archive/issue_events_443746.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-01T16:06:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443746"
}
```



---

archive/issue_events_443747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443747"
}
```



---

archive/issue_events_443748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443748"
}
```



---

archive/issue_comments_518248.json:
```json
{
    "body": "Dependencies: **#34277**",
    "created_at": "2022-08-05T05:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518248",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#34277**



---

archive/issue_comments_518249.json:
```json
{
    "body": "Work Issues: **Rebase on #34277**",
    "created_at": "2022-08-05T05:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32170#issuecomment-518249",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **Rebase on #34277**



---

archive/issue_events_443749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443749"
}
```



---

archive/issue_events_443750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443750"
}
```



---

archive/issue_events_443751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443751"
}
```



---

archive/issue_events_443752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32170",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32170#event-443752"
}
```
