# Issue 32134: Fix order of characters in modular/local_comp/local_comp.py doctests

archive/issues_031897.json:
```json
{
    "assignees": [],
    "body": "This doctest in `src/sage/modular/local_comp/local_comp.py`\nfails on several patchbots:\n\n```\nsage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py\n**********************************************************************\nFile \"src/sage/modular/local_comp/local_comp.py\", line 653, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    set(Pi.characters())\nExpected:\n    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,\n     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}\nGot:\n    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,\n     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}\n**********************************************************************\n```\n\nTicket #29977 provides a hotfix.\nHere we aim for a better fix.\n\nThe test used to display `Pi.characters()`,\nof type `Sequence`, directly.\n\nThe display order for the two characters in this\nexample changed, possibly due to a change in PARI.\n\nThe example was changed in #30801 to use Python sets\nin an attempt to fix the display order, but that\nfailed and patchbots kept failing on that.\n\n\nCC:  @dimpase @kliem @slel\n\nBranch: **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Thierry Monteil, Samuel Leli\u00e8vre, Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32134_\n\n",
    "closed_at": "2021-08-29T09:38:17Z",
    "created_at": "2021-07-05T14:05:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix order of characters in modular/local_comp/local_comp.py doctests",
    "type": "issue",
    "updated_at": "2022-01-30T18:25:12Z",
    "url": "https://github.com/sagemath/sage/issues/32134",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
This doctest in `src/sage/modular/local_comp/local_comp.py`
fails on several patchbots:

```
sage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py
**********************************************************************
File "src/sage/modular/local_comp/local_comp.py", line 653, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    set(Pi.characters())
Expected:
    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,
     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}
Got:
    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,
     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}
**********************************************************************
```

Ticket #29977 provides a hotfix.
Here we aim for a better fix.

The test used to display `Pi.characters()`,
of type `Sequence`, directly.

The display order for the two characters in this
example changed, possibly due to a change in PARI.

The example was changed in #30801 to use Python sets
in an attempt to fix the display order, but that
failed and patchbots kept failing on that.


CC:  @dimpase @kliem @slel

Branch: **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**

Reviewer: **Dima Pasechnik**

Author: **Thierry Monteil, Samuel Lelièvre, Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/32134_





---

archive/issue_events_410741.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-05T14:05:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410741"
}
```



---

archive/issue_events_410742.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-05T14:05:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "component: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410742"
}
```



---

archive/issue_events_410743.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-05T14:05:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410743"
}
```



---

archive/issue_events_410744.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-05T14:05:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410744"
}
```



---

archive/issue_comments_520536.json:
```json
{
    "body": "Branch: **[u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail)**",
    "created_at": "2021-07-05T14:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520536",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Branch: **[u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail)**



---

archive/issue_comments_520537.json:
```json
{
    "body": "Commit: **[ce78416](https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745)**",
    "created_at": "2021-07-05T14:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520537",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Commit: **[ce78416](https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745)**



---

archive/issue_comments_520538.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745\">ce78416</a></td><td><code>#32134 : use lists instead of sets in doctesting local_comp.py</code></td></tr></table>\n",
    "created_at": "2021-07-05T14:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520538",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745">ce78416</a></td><td><code>#32134 : use lists instead of sets in doctesting local_comp.py</code></td></tr></table>




---

archive/issue_events_410745.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-05T14:10:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410745"
}
```



---

archive/issue_comments_520539.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nsee #29977",
    "created_at": "2021-07-05T15:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520539",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'>Comment 3:</a>
see #29977



---

archive/issue_comments_520540.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@fchapoton](#comment%3A3):\n> see #29977\n\nI created this ticket because that particular issue has no link with random seeds, which is the purpose of #29977, see the comment [#29977 comment:28](https://github.com/sagemath/sage/issues/29977#comment:28)",
    "created_at": "2021-07-05T16:04:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520540",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@fchapoton](#comment%3A3):
> see #29977

I created this ticket because that particular issue has no link with random seeds, which is the purpose of #29977, see the comment [#29977 comment:28](https://github.com/sagemath/sage/issues/29977#comment:28)



---

archive/issue_comments_520541.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThe \"set\" were added very recently in #30801",
    "created_at": "2021-07-05T16:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520541",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
The "set" were added very recently in #30801



---

archive/issue_comments_520542.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBtw, you don't use lists:\n\n```\nsage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            \nsage: Pi = LocalComponent(f, 5)                                                 \nsage: type(Pi.characters())                                                     \n<class 'sage.structure.sequence.Sequence_generic'>\n```",
    "created_at": "2021-07-05T16:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520542",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'>Comment 6:</a>
Btw, you don't use lists:

```
sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            
sage: Pi = LocalComponent(f, 5)                                                 
sage: type(Pi.characters())                                                     
<class 'sage.structure.sequence.Sequence_generic'>
```



---

archive/issue_comments_520543.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nWhy is replacing one apparently unstable order with another apparently unstable order a good fix?\nI didn't add `set()` just for fun in #30801.",
    "created_at": "2021-07-06T09:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520543",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
Why is replacing one apparently unstable order with another apparently unstable order a good fix?
I didn't add `set()` just for fun in #30801.



---

archive/issue_comments_520544.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThat is exactly why I didn't want to put it on positive review. I would really prefer `sorted` with `key=str`. That appears to be stable and if we think it's not pretty, we can figure out something nicer later.",
    "created_at": "2021-07-06T10:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520544",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'>Comment 8:</a>
That is exactly why I didn't want to put it on positive review. I would really prefer `sorted` with `key=str`. That appears to be stable and if we think it's not pretty, we can figure out something nicer later.



---

archive/issue_events_410746.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T10:14:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410746"
}
```



---

archive/issue_events_410747.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T10:14:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410747"
}
```



---

archive/issue_comments_520545.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@kliem](#comment%3A8):\n> I would really prefer `sorted` with `key=str`.\n\n+1",
    "created_at": "2021-07-06T13:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520545",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@kliem](#comment%3A8):
> I would really prefer `sorted` with `key=str`.

+1



---

archive/issue_comments_520546.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-#30801 adapted some doctests by using Python sets. However, those are displayd in arbitrary order, which breaks parchbots:\n+This doctest in `src/sage/modular/local_comp/local_comp.py`\n+fails on several patchbots:\n \n ```\n sage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py\n@@ -15,4 +16,16 @@\n **********************************************************************\n ```\n \n-This tickets tries to fix that, by using lists.\n+This tickets is to fix that.\n+\n+The test used to display `Pi.characters()`,\n+of type `Sequence`, directly.\n+\n+The display order for the two characters in this\n+example changed, possibly due to a change in PARI.\n+\n+The example was changed in #30801 to use Python sets\n+in order to fix the display order, but we still get\n+patchbot failures because of the display order.\n+\n+\n``````\n",
    "created_at": "2021-07-06T13:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520546",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
-#30801 adapted some doctests by using Python sets. However, those are displayd in arbitrary order, which breaks parchbots:
+This doctest in `src/sage/modular/local_comp/local_comp.py`
+fails on several patchbots:
 
 ```
 sage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py
@@ -15,4 +16,16 @@
 **********************************************************************
 ```
 
-This tickets tries to fix that, by using lists.
+This tickets is to fix that.
+
+The test used to display `Pi.characters()`,
+of type `Sequence`, directly.
+
+The display order for the two characters in this
+example changed, possibly due to a change in PARI.
+
+The example was changed in #30801 to use Python sets
+in order to fix the display order, but we still get
+patchbot failures because of the display order.
+
+
``````




---

archive/issue_comments_520547.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI would also vote for a hotfix using the order given\nby string representations.\n\nThen we can calmly investigate what causes the different\ndisplay order, and find a nicer fix.",
    "created_at": "2021-07-06T13:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520547",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'>Comment 11:</a>
I would also vote for a hotfix using the order given
by string representations.

Then we can calmly investigate what causes the different
display order, and find a nicer fix.



---

archive/issue_events_410748.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T13:22:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410748"
}
```



---

archive/issue_events_410749.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T13:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410749"
}
```



---

archive/issue_comments_520548.json:
```json
{
    "body": "Changed author from **Thierry Monteil** to **Thierry Monteil, \u200bSamuel Leli\u00e8vre, Jonathan Kliem**",
    "created_at": "2021-07-06T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520548",
    "user": "https://github.com/kliem"
}
```

Changed author from **Thierry Monteil** to **Thierry Monteil, ​Samuel Lelièvre, Jonathan Kliem**



---

archive/issue_comments_520549.json:
```json
{
    "body": "Changed branch from **[u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail)** to **[public/32134](https://github.com/sagemath/sagetrac-mirror/tree/public/32134)**",
    "created_at": "2021-07-06T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520549",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail)** to **[public/32134](https://github.com/sagemath/sagetrac-mirror/tree/public/32134)**



---

archive/issue_comments_520550.json:
```json
{
    "body": "Changed commit from **[ce78416](https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745)** to **[85ec7e2](https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2)**",
    "created_at": "2021-07-06T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520550",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[ce78416](https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745)** to **[85ec7e2](https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2)**



---

archive/issue_events_410750.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T13:22:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410750"
}
```



---

archive/issue_events_410751.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-07-06T13:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410751"
}
```



---

archive/issue_comments_520551.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nMoving this up to critical, as the issue reduces patchbot capacity by 50 percent and slows down review process of all tickets.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2\">85ec7e2</a></td><td><code>sort groups of smooth characters by string for stable doctesting</code></td></tr></table>\n",
    "created_at": "2021-07-06T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520551",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'>Comment 12:</a>
Moving this up to critical, as the issue reduces patchbot capacity by 50 percent and slows down review process of all tickets.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2">85ec7e2</a></td><td><code>sort groups of smooth characters by string for stable doctesting</code></td></tr></table>




---

archive/issue_comments_520552.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nthis is in part collides with #29977",
    "created_at": "2021-07-06T14:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520552",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
this is in part collides with #29977



---

archive/issue_comments_520553.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@kliem](#comment%3A6):\n> Btw, you don't use lists:\n> \n> ```\n> sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            \n> sage: Pi = LocalComponent(f, 5)                                                 \n> sage: type(Pi.characters())                                                     \n> <class 'sage.structure.sequence.Sequence_generic'>\n> ```\n\nIndeed.\n\nReplying to [@dimpase](#comment%3A7):\n> Why is replacing one apparently unstable order with another apparently unstable order a good fix?\n> I didn't add `set()` just for fun in #30801.\n\nI was asking the same question, but I did not see any evidence (i might have missed something though). If the raw use of `Pi.characters()` is only *apparently* unstable, then i am not in favor to work around it, which is why i asked, otherwise we might end up sorting every Sage doctest. If there is a configuration that does not provide that order, which one it is ? If this is about the 32 vs 64 bit architecture, then why not specify it with two dedicated doctests ?\n\nReplying to [@slel](#comment%3A11):\n> I would also vote for a hotfix using the order given\n> by string representations.\n> \n> Then we can calmly investigate what causes the different\n> display order, and find a nicer fix.\n\nOK, then could you please all try the [straightforward branch](https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail) and tell if is passes on your various computers, so that we could see whether it can break and understand the cause (for example, it seems not related to the choice of the random seed).",
    "created_at": "2021-07-06T14:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520553",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@kliem](#comment%3A6):
> Btw, you don't use lists:
> 
> ```
> sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            
> sage: Pi = LocalComponent(f, 5)                                                 
> sage: type(Pi.characters())                                                     
> <class 'sage.structure.sequence.Sequence_generic'>
> ```

Indeed.

Replying to [@dimpase](#comment%3A7):
> Why is replacing one apparently unstable order with another apparently unstable order a good fix?
> I didn't add `set()` just for fun in #30801.

I was asking the same question, but I did not see any evidence (i might have missed something though). If the raw use of `Pi.characters()` is only *apparently* unstable, then i am not in favor to work around it, which is why i asked, otherwise we might end up sorting every Sage doctest. If there is a configuration that does not provide that order, which one it is ? If this is about the 32 vs 64 bit architecture, then why not specify it with two dedicated doctests ?

Replying to [@slel](#comment%3A11):
> I would also vote for a hotfix using the order given
> by string representations.
> 
> Then we can calmly investigate what causes the different
> display order, and find a nicer fix.

OK, then could you please all try the [straightforward branch](https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail) and tell if is passes on your various computers, so that we could see whether it can break and understand the cause (for example, it seems not related to the choice of the random seed).



---

archive/issue_comments_520554.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [tmonteil](#comment%3A14):\n> Replying to [@kliem](#comment%3A6):\n> > Btw, you don't use lists:\n> > \n> > ```\n> > sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            \n> > sage: Pi = LocalComponent(f, 5)                                                 \n> > sage: type(Pi.characters())                                                     \n> > <class 'sage.structure.sequence.Sequence_generic'>\n> > ```\n\n> \n> Indeed.\n> \n> Replying to [@dimpase](#comment%3A7):\n> > Why is replacing one apparently unstable order with another apparently unstable order a good fix?\n> > I didn't add `set()` just for fun in #30801.\n\n> \n> I was asking the same question, but I did not see any evidence (i might have missed something though). If the raw use of `Pi.characters()` is only *apparently* unstable, then i am not in favor to work around it, which is why i asked, otherwise we might end up sorting every Sage doctest. If there is a configuration that does not provide that order, which one it is ? If this is about the 32 vs 64 bit architecture, then why not specify it with two dedicated doctests ?\n> \n> Replying to [@slel](#comment%3A11):\n> > I would also vote for a hotfix using the order given\n> > by string representations.\n> > \n> > Then we can calmly investigate what causes the different\n> > display order, and find a nicer fix.\n\n> \n> OK, then could you please all try the [straightforward branch](https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail) and tell if is passes on your various computers, so that we could see whether it can break and understand the cause (for example, it seems not related to the choice of the random seed).\n\nhttps://github.com/kliem/sage/pull/47/checks\n\nAs #29977 is now positively review, we can now also go back to your branch and see whether this works.",
    "created_at": "2021-07-06T14:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520554",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [tmonteil](#comment%3A14):
> Replying to [@kliem](#comment%3A6):
> > Btw, you don't use lists:
> > 
> > ```
> > sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]                            
> > sage: Pi = LocalComponent(f, 5)                                                 
> > sage: type(Pi.characters())                                                     
> > <class 'sage.structure.sequence.Sequence_generic'>
> > ```

> 
> Indeed.
> 
> Replying to [@dimpase](#comment%3A7):
> > Why is replacing one apparently unstable order with another apparently unstable order a good fix?
> > I didn't add `set()` just for fun in #30801.

> 
> I was asking the same question, but I did not see any evidence (i might have missed something though). If the raw use of `Pi.characters()` is only *apparently* unstable, then i am not in favor to work around it, which is why i asked, otherwise we might end up sorting every Sage doctest. If there is a configuration that does not provide that order, which one it is ? If this is about the 32 vs 64 bit architecture, then why not specify it with two dedicated doctests ?
> 
> Replying to [@slel](#comment%3A11):
> > I would also vote for a hotfix using the order given
> > by string representations.
> > 
> > Then we can calmly investigate what causes the different
> > display order, and find a nicer fix.

> 
> OK, then could you please all try the [straightforward branch](https://github.com/sagemath/sagetrac-mirror/commits/u/tmonteil/doctests_in_src_sage_modular_local_comp_local_comp_py_make_patchbots_fail) and tell if is passes on your various computers, so that we could see whether it can break and understand the cause (for example, it seems not related to the choice of the random seed).

https://github.com/kliem/sage/pull/47/checks

As #29977 is now positively review, we can now also go back to your branch and see whether this works.



---

archive/issue_comments_520555.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,7 +16,8 @@\n **********************************************************************\n ```\n \n-This tickets is to fix that.\n+Ticket #29977 provides a hotfix.\n+Here we aim for a better fix.\n \n The test used to display `Pi.characters()`,\n of type `Sequence`, directly.\n@@ -25,7 +26,6 @@\n example changed, possibly due to a change in PARI.\n \n The example was changed in #30801 to use Python sets\n-in order to fix the display order, but we still get\n-patchbot failures because of the display order.\n+in an attempt to fix the display order, but that\n+failed and patchbots kept failing on that.\n \n-\n``````\n",
    "created_at": "2021-07-24T16:12:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520555",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,7 +16,8 @@
 **********************************************************************
 ```
 
-This tickets is to fix that.
+Ticket #29977 provides a hotfix.
+Here we aim for a better fix.
 
 The test used to display `Pi.characters()`,
 of type `Sequence`, directly.
@@ -25,7 +26,6 @@
 example changed, possibly due to a change in PARI.
 
 The example was changed in #30801 to use Python sets
-in order to fix the display order, but we still get
-patchbot failures because of the display order.
+in an attempt to fix the display order, but that
+failed and patchbots kept failing on that.
 
-
``````




---

archive/issue_events_410752.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-24T16:12:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "title_is": "Fix order of characters in modular/local_comp/local_comp.py doctests",
    "title_was": "Doctests in src/sage/modular/local_comp/local_comp.py make patchbots fail",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410752"
}
```



---

archive/issue_comments_520556.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745\">ce78416</a></td><td><code>#32134 : use lists instead of sets in doctesting local_comp.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5\">2a175e5</a></td><td><code>merge</code></td></tr></table>\n",
    "created_at": "2021-07-29T11:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520556",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce78416bf78d147992eb6a03c8038ebdb9454745">ce78416</a></td><td><code>#32134 : use lists instead of sets in doctesting local_comp.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5">2a175e5</a></td><td><code>merge</code></td></tr></table>




---

archive/issue_comments_520557.json:
```json
{
    "body": "Changed commit from **[85ec7e2](https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2)** to **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**",
    "created_at": "2021-07-29T11:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520557",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[85ec7e2](https://github.com/sagemath/sagetrac-mirror/commit/85ec7e2193f551225fb6659acd69d60bae649eb2)** to **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**



---

archive/issue_comments_520558.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-07-29T15:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520558",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_520559.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nDoes this make bots happy?",
    "created_at": "2021-07-29T15:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520559",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'>Comment 18:</a>
Does this make bots happy?



---

archive/issue_events_410753.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-29T15:38:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410753"
}
```



---

archive/issue_events_410754.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-29T15:38:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410754"
}
```



---

archive/issue_events_410755.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-29T15:48:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410755"
}
```



---

archive/issue_events_410756.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2021-07-29T15:48:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410756"
}
```



---

archive/issue_comments_520560.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@dimpase](#comment%3A18):\n> Does this make bots happy?\n\nI think we have to let 32bit bots to work on it. I will work on setting one up later in the summer. Let us keep this ticket to \"needs review\" so that bots can work on it.\n\nI encourage everybody to try this branch to see if something wrong appears.",
    "created_at": "2021-07-29T15:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520560",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@dimpase](#comment%3A18):
> Does this make bots happy?

I think we have to let 32bit bots to work on it. I will work on setting one up later in the summer. Let us keep this ticket to "needs review" so that bots can work on it.

I encourage everybody to try this branch to see if something wrong appears.



---

archive/issue_comments_520561.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nit works on 32-bit too.",
    "created_at": "2021-08-14T20:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520561",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'>Comment 20:</a>
it works on 32-bit too.



---

archive/issue_events_410757.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-08-14T20:04:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410757"
}
```



---

archive/issue_events_410758.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-08-14T20:04:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410758"
}
```



---

archive/issue_events_410759.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410759"
}
```



---

archive/issue_events_410760.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410760"
}
```



---

archive/issue_comments_520562.json:
```json
{
    "body": "Changed branch from **[public/32134](https://github.com/sagemath/sagetrac-mirror/tree/public/32134)** to **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**",
    "created_at": "2021-08-29T09:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520562",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/32134](https://github.com/sagemath/sagetrac-mirror/tree/public/32134)** to **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)**



---

archive/issue_events_410761.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-29T09:38:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410761"
}
```



---

archive/issue_events_410762.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "67ecd3c59da76a717a77c304f12f7abd8f716b33",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-08-29T09:38:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32134#event-410762"
}
```



---

archive/issue_comments_520563.json:
```json
{
    "body": "Changed commit from **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)** to none",
    "created_at": "2022-01-30T18:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520563",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[2a175e5](https://github.com/sagemath/sagetrac-mirror/commit/2a175e53085684771b1d3d203f2d6f7e89d9e9a5)** to none



---

archive/issue_comments_520564.json:
```json
{
    "body": "Changed author from **Thierry Monteil, \u200bSamuel Leli\u00e8vre, Jonathan Kliem** to **Thierry Monteil, Samuel Leli\u00e8vre, Jonathan Kliem**",
    "created_at": "2022-01-30T18:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32134#issuecomment-520564",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Thierry Monteil, ​Samuel Lelièvre, Jonathan Kliem** to **Thierry Monteil, Samuel Lelièvre, Jonathan Kliem**
