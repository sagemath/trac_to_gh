# Issue 15430: Enable cython caching

archive/issues_015193.json:
```json
{
    "body": "The entire Sage library fits into about 25MB (compressed) cache. \n\n**Branch:** [u/vbraun/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/ticket/15430)\n\n**Commit:** [064791bac10bcb82d5bb663cd7f35b4f7945a0fd](https://github.com/sagemath/sagetrac-mirror/commit/064791bac10bcb82d5bb663cd7f35b4f7945a0fd)\n\n**Reviewer:** Volker Braun\n\n**Author:** Robert Bradshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/15430\n\n",
    "closed_at": "2013-12-16T14:08:13Z",
    "created_at": "2013-11-17T06:30:56Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.0",
    "title": "Enable cython caching",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/15430",
    "user": "https://github.com/robertwb"
}
```
The entire Sage library fits into about 25MB (compressed) cache. 

**Branch:** [u/vbraun/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/ticket/15430)

**Commit:** [064791bac10bcb82d5bb663cd7f35b4f7945a0fd](https://github.com/sagemath/sagetrac-mirror/commit/064791bac10bcb82d5bb663cd7f35b4f7945a0fd)

**Reviewer:** Volker Braun

**Author:** Robert Bradshaw

Issue created by migration from https://trac.sagemath.org/ticket/15430





---

archive/issue_comments_194390.json:
```json
{
    "body": "**Branch:** [u/robertwb/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/15430)",
    "created_at": "2013-11-17T06:44:04Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194390",
    "user": "https://github.com/robertwb"
}
```

**Branch:** [u/robertwb/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/15430)



---

archive/issue_comments_194391.json:
```json
{
    "body": "**Author:** Robert Bradshaw",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194391",
    "user": "https://github.com/robertwb"
}
```

**Author:** Robert Bradshaw



---

archive/issue_comments_194392.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td>[c93d084](https://github.com/sagemath/sagetrac-mirror/commit/c93d084)</td><td><code>Enable cython cache.</code></td></tr></table>\n",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194392",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td>[c93d084](https://github.com/sagemath/sagetrac-mirror/commit/c93d084)</td><td><code>Enable cython cache.</code></td></tr></table>




---

archive/issue_comments_194393.json:
```json
{
    "body": "**Commit:** [c93d08403a56097ff06b7894d28013d50d813950](https://github.com/sagemath/sagetrac-mirror/commit/c93d08403a56097ff06b7894d28013d50d813950)",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194393",
    "user": "https://github.com/robertwb"
}
```

**Commit:** [c93d08403a56097ff06b7894d28013d50d813950](https://github.com/sagemath/sagetrac-mirror/commit/c93d08403a56097ff06b7894d28013d50d813950)



---

archive/issue_events_136250.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-11-17T06:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136250"
}
```



---

archive/issue_comments_194394.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+The entire Sage library fits into about 25MB (compressed) cache. \n``````\n",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194394",
    "user": "https://github.com/robertwb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+The entire Sage library fits into about 25MB (compressed) cache. 
``````




---

archive/issue_comments_194395.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2013-11-18T16:39:59Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194395",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_194396.json:
```json
{
    "body": "<a id='comment:3'></a>\nDependency checking seems to work for me. If there is any problem left then I'm pretty sure we'll only be able to find it if we use this seriously. So I'm in favor of pushing this into the sage-git release....",
    "created_at": "2013-11-18T16:39:59Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194396",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
Dependency checking seems to work for me. If there is any problem left then I'm pretty sure we'll only be able to find it if we use this seriously. So I'm in favor of pushing this into the sage-git release....



---

archive/issue_events_136251.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-18T16:39:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136251"
}
```



---

archive/issue_events_136252.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-18T16:39:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136252"
}
```



---

archive/issue_comments_194397.json:
```json
{
    "body": "<a id='comment:4'></a>\nBuilding Sage with a non-existing `DOT_SAGE` breaks because of this ticket. From the buildbot:\n\n```\nCompiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_rr.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_py.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_el.pyx because it changed.\nTraceback (most recent call last):\n  File \"setup.py\", line 531, in <module>\n    force=force)\n  File \"/home/buildbot/build/sage/plantain/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 740, in cythonize\n    os.mkdir(options.cache)\nOSError: [Errno 2] No such file or directory: '/home/buildbot/build/sage/plantain/sage_git/dot_sage/cycache'\n```",
    "created_at": "2013-11-27T01:56:56Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194397",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Building Sage with a non-existing `DOT_SAGE` breaks because of this ticket. From the buildbot:

```
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
Traceback (most recent call last):
  File "setup.py", line 531, in <module>
    force=force)
  File "/home/buildbot/build/sage/plantain/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 740, in cythonize
    os.mkdir(options.cache)
OSError: [Errno 2] No such file or directory: '/home/buildbot/build/sage/plantain/sage_git/dot_sage/cycache'
```



---

archive/issue_comments_194398.json:
```json
{
    "body": "**Changing branch** from \"[u/robertwb/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/15430)\" to \"[u/vbraun/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/ticket/15430)\".",
    "created_at": "2013-11-27T02:20:00Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194398",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/robertwb/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/15430)" to "[u/vbraun/ticket/15430](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/ticket/15430)".



---

archive/issue_comments_194399.json:
```json
{
    "body": "**Changing commit** from \"[c93d08403a56097ff06b7894d28013d50d813950](https://github.com/sagemath/sagetrac-mirror/commit/c93d08403a56097ff06b7894d28013d50d813950)\" to \"[064791bac10bcb82d5bb663cd7f35b4f7945a0fd](https://github.com/sagemath/sagetrac-mirror/commit/064791bac10bcb82d5bb663cd7f35b4f7945a0fd)\".",
    "created_at": "2013-11-27T02:21:14Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194399",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[c93d08403a56097ff06b7894d28013d50d813950](https://github.com/sagemath/sagetrac-mirror/commit/c93d08403a56097ff06b7894d28013d50d813950)" to "[064791bac10bcb82d5bb663cd7f35b4f7945a0fd](https://github.com/sagemath/sagetrac-mirror/commit/064791bac10bcb82d5bb663cd7f35b4f7945a0fd)".



---

archive/issue_comments_194400.json:
```json
{
    "body": "<a id='comment:6'></a>\nHmm the commit field was not automatically updated?\n\n---\n**New commits:**\n<table><tr><td>[064791b](https://github.com/sagemath/sagetrac-mirror/commit/064791b)</td><td><code>only enable cycache if DOT_SAGE exists</code></td></tr></table>\n",
    "created_at": "2013-11-27T02:21:14Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194400",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Hmm the commit field was not automatically updated?

---
**New commits:**
<table><tr><td>[064791b](https://github.com/sagemath/sagetrac-mirror/commit/064791b)</td><td><code>only enable cycache if DOT_SAGE exists</code></td></tr></table>




---

archive/issue_events_136253.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-27T02:21:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136253"
}
```



---

archive/issue_events_136254.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-27T02:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136254"
}
```



---

archive/issue_comments_194401.json:
```json
{
    "body": "<a id='comment:7'></a>\nplease review my change...",
    "created_at": "2013-11-27T02:21:54Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194401",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
please review my change...



---

archive/issue_comments_194402.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhy use a sage specific cycache directory? Why not something like `~/.cycache`? (IMHO, Cython should use a default directory if `Cython.Compiler.Main.default_options['cache'] is True`).\n\nAlso, I think it should be togglable by an environment variable, say `DISABLE_CYCACHE`, in case someone doesn't want to use (e.g. for testing purposes/cython development purposes).",
    "created_at": "2013-11-27T03:04:31Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194402",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:8'></a>
Why use a sage specific cycache directory? Why not something like `~/.cycache`? (IMHO, Cython should use a default directory if `Cython.Compiler.Main.default_options['cache'] is True`).

Also, I think it should be togglable by an environment variable, say `DISABLE_CYCACHE`, in case someone doesn't want to use (e.g. for testing purposes/cython development purposes).



---

archive/issue_comments_194403.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe ccache spkg also uses `$DOT_SAGE/ccache`. \n\nWith this patch you can disable caching by passing an invalid directory. Ugly but yet another undocumented environment variable isn't that great either.\n\nSupporting boolean `Cython.Compiler.Main.default_options['cache']` and/or using `os.makedirs()` instead of `mkdir` are just Cython enhancement requests, maybe you want to post that to the Cython trac?",
    "created_at": "2013-11-27T03:10:38Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194403",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
The ccache spkg also uses `$DOT_SAGE/ccache`. 

With this patch you can disable caching by passing an invalid directory. Ugly but yet another undocumented environment variable isn't that great either.

Supporting boolean `Cython.Compiler.Main.default_options['cache']` and/or using `os.makedirs()` instead of `mkdir` are just Cython enhancement requests, maybe you want to post that to the Cython trac?



---

archive/issue_comments_194404.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released.",
    "created_at": "2013-12-12T05:40:28Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194404",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>
This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released.



---

archive/issue_events_136255.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-12-12T05:40:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136255"
}
```



---

archive/issue_events_136256.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-12-12T05:40:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136256"
}
```



---

archive/issue_events_136257.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T14:08:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136257"
}
```



---

archive/issue_events_136258.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "efc62c784043832b346296f27843ecc9b168cdc1",
    "created_at": "2013-12-16T14:08:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15430#event-136258"
}
```



---

archive/issue_comments_194405.json:
```json
{
    "body": "<a id='comment:12'></a>\nI assume the intent of this patch was to *always* enable cycache by default? Because that's not what this patch does. It only works if the cycache directory already exists. Testing for the existence of `X/..` is (almost) equivalent to testing for the existence of `X`.",
    "created_at": "2014-04-11T18:31:30Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194405",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
I assume the intent of this patch was to *always* enable cycache by default? Because that's not what this patch does. It only works if the cycache directory already exists. Testing for the existence of `X/..` is (almost) equivalent to testing for the existence of `X`.



---

archive/issue_comments_194406.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vbraun](#comment%3A9):\n> The ccache spkg also uses `$DOT_SAGE/ccache`.\n\nThat's not actually true. Sage doesn't set the `ccache` directory.",
    "created_at": "2014-04-11T18:34:52Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194406",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [vbraun](#comment%3A9):
> The ccache spkg also uses `$DOT_SAGE/ccache`.

That's not actually true. Sage doesn't set the `ccache` directory.



---

archive/issue_comments_194407.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [robertwb](#comment%3A10):\n> This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released. \n\nI guess this is in Sage now, right?",
    "created_at": "2014-04-11T18:35:09Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194407",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [robertwb](#comment%3A10):
> This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released. 

I guess this is in Sage now, right?



---

archive/issue_comments_194408.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, feel free to open a new ticket.",
    "created_at": "2014-04-11T19:32:26Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194408",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Yes, feel free to open a new ticket.



---

archive/issue_comments_194409.json:
```json
{
    "body": "<a id='comment:16'></a>\nSee #16148.",
    "created_at": "2014-04-12T11:19:38Z",
    "issue": "https://github.com/sagemath/sage/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15430#issuecomment-194409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
See #16148.
