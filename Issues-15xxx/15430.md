# Issue 15430: Enable cython caching

archive/issues_015193.json:
```json
{
    "body": "The entire Sage library fits into about 25MB (compressed) cache. \n\nReviewer: Volker Braun\n\nAuthor: Robert Bradshaw\n\nBranch: u/vbraun/ticket/15430\n\nCommit: 064791bac10bcb82d5bb663cd7f35b4f7945a0fd\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15430\n\n",
    "closed_at": "2013-12-16T14:08:13Z",
    "created_at": "2013-11-17T06:30:56Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.0",
    "title": "Enable cython caching",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15430",
    "user": "https://github.com/robertwb"
}
```
The entire Sage library fits into about 25MB (compressed) cache. 

Reviewer: Volker Braun

Author: Robert Bradshaw

Branch: u/vbraun/ticket/15430

Commit: 064791bac10bcb82d5bb663cd7f35b4f7945a0fd

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15430





---

archive/issue_comments_208019.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208019",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_208020.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208020",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_208021.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+The entire Sage library fits into about 25MB (compressed) cache. \n \n Comment: 1\n \n```\n",
    "created_at": "2013-11-17T06:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208021",
    "user": "https://github.com/robertwb"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+The entire Sage library fits into about 25MB (compressed) cache. 
 
 Comment: 1
 
```




---

archive/issue_comments_208022.json:
```json
{
    "body": "<a id='comment:3'></a>Dependency checking seems to work for me. If there is any problem left then I'm pretty sure we'll only be able to find it if we use this seriously. So I'm in favor of pushing this into the sage-git release....",
    "created_at": "2013-11-18T16:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208022",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>Dependency checking seems to work for me. If there is any problem left then I'm pretty sure we'll only be able to find it if we use this seriously. So I'm in favor of pushing this into the sage-git release....



---

archive/issue_comments_208023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-18T16:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208023",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208024.json:
```json
{
    "body": "<a id='comment:4'></a>Building Sage with a non-existing `DOT_SAGE` breaks because of this ticket. From the buildbot:\n\n```\nCompiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_rr.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_py.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_el.pyx because it changed.\nTraceback (most recent call last):\n  File \"setup.py\", line 531, in <module>\n    force=force)\n  File \"/home/buildbot/build/sage/plantain/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 740, in cythonize\n    os.mkdir(options.cache)\nOSError: [Errno 2] No such file or directory: '/home/buildbot/build/sage/plantain/sage_git/dot_sage/cycache'\n```",
    "created_at": "2013-11-27T01:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208024",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>Building Sage with a non-existing `DOT_SAGE` breaks because of this ticket. From the buildbot:

```
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
Traceback (most recent call last):
  File "setup.py", line 531, in <module>
    force=force)
  File "/home/buildbot/build/sage/plantain/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 740, in cythonize
    os.mkdir(options.cache)
OSError: [Errno 2] No such file or directory: '/home/buildbot/build/sage/plantain/sage_git/dot_sage/cycache'
```



---

archive/issue_comments_208025.json:
```json
{
    "body": "<a id='comment:6'></a>Hmm the commit field was not automatically updated?\n\n---\nNew commits:",
    "created_at": "2013-11-27T02:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208025",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Hmm the commit field was not automatically updated?

---
New commits:



---

archive/issue_comments_208026.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2013-11-27T02:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208026",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_208027.json:
```json
{
    "body": "<a id='comment:7'></a>please review my change...",
    "created_at": "2013-11-27T02:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208027",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>please review my change...



---

archive/issue_comments_208028.json:
```json
{
    "body": "<a id='comment:8'></a>Why use a sage specific cycache directory? Why not something like `~/.cycache`? (IMHO, Cython should use a default directory if `Cython.Compiler.Main.default_options['cache'] is True`).\n\nAlso, I think it should be togglable by an environment variable, say `DISABLE_CYCACHE`, in case someone doesn't want to use (e.g. for testing purposes/cython development purposes).",
    "created_at": "2013-11-27T03:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208028",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:8'></a>Why use a sage specific cycache directory? Why not something like `~/.cycache`? (IMHO, Cython should use a default directory if `Cython.Compiler.Main.default_options['cache'] is True`).

Also, I think it should be togglable by an environment variable, say `DISABLE_CYCACHE`, in case someone doesn't want to use (e.g. for testing purposes/cython development purposes).



---

archive/issue_comments_208029.json:
```json
{
    "body": "<a id='comment:9'></a>The ccache spkg also uses `$DOT_SAGE/ccache`. \n\nWith this patch you can disable caching by passing an invalid directory. Ugly but yet another undocumented environment variable isn't that great either.\n\nSupporting boolean `Cython.Compiler.Main.default_options['cache']` and/or using `os.makedirs()` instead of `mkdir` are just Cython enhancement requests, maybe you want to post that to the Cython trac?",
    "created_at": "2013-11-27T03:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208029",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>The ccache spkg also uses `$DOT_SAGE/ccache`. 

With this patch you can disable caching by passing an invalid directory. Ugly but yet another undocumented environment variable isn't that great either.

Supporting boolean `Cython.Compiler.Main.default_options['cache']` and/or using `os.makedirs()` instead of `mkdir` are just Cython enhancement requests, maybe you want to post that to the Cython trac?



---

archive/issue_comments_208030.json:
```json
{
    "body": "<a id='comment:10'></a>This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released.",
    "created_at": "2013-12-12T05:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208030",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released.



---

archive/issue_comments_208031.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-12T05:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208031",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208032.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-16T14:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208032",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_044962.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T14:08:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15430#event-44962"
}
```



---

archive/issue_comments_208033.json:
```json
{
    "body": "<a id='comment:12'></a>I assume the intent of this patch was to *always* enable cycache by default? Because that's not what this patch does. It only works if the cycache directory already exists. Testing for the existence of `X/..` is (almost) equivalent to testing for the existence of `X`.",
    "created_at": "2014-04-11T18:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208033",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>I assume the intent of this patch was to *always* enable cycache by default? Because that's not what this patch does. It only works if the cycache directory already exists. Testing for the existence of `X/..` is (almost) equivalent to testing for the existence of `X`.



---

archive/issue_comments_208034.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:9 vbraun]:\n> The ccache spkg also uses `$DOT_SAGE/ccache`.\n\nThat's not actually true. Sage doesn't set the `ccache` directory.",
    "created_at": "2014-04-11T18:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208034",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:9 vbraun]:
> The ccache spkg also uses `$DOT_SAGE/ccache`.

That's not actually true. Sage doesn't set the `ccache` directory.



---

archive/issue_comments_208035.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:10 robertwb]:\n> This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released. \n\nI guess this is in Sage now, right?",
    "created_at": "2014-04-11T18:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208035",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:10 robertwb]:
> This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released. 

I guess this is in Sage now, right?



---

archive/issue_comments_208036.json:
```json
{
    "body": "<a id='comment:15'></a>Yes, feel free to open a new ticket.",
    "created_at": "2014-04-11T19:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208036",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Yes, feel free to open a new ticket.



---

archive/issue_comments_208037.json:
```json
{
    "body": "<a id='comment:16'></a>See #16148.",
    "created_at": "2014-04-12T11:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15430#issuecomment-208037",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>See #16148.
