# Issue 15948: marked Dynkin diagrams

archive/issues_015711.json:
```json
{
    "body": "This patch adds marked Dynkin diagrams and marked Cartan types. See\u00a0http://trac.sagemath.org/ticket/15948#comment:18\u00a0for details.\n\nThis convenient notation is used quite often in a certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307, and in Lie superalgebras, where markings denote the parity \u00a0of indices.\n\nMoreover, there are two small bugfixes:\n\n1. Documentation is misleading about our convention for arrows in Dynkin diagrams. We do follow Bourbaki convention for graphics (which is apparently the same as in Kac), but not the convention for the underlying Cartan matrix.\n2. Dynkin diagrams for D and E series contain a special character in the node name of tikzpicture which TeX doesn't like.\n\nCC:  @nthiery @dwbump\n\nBranch/Commit: bf5e867266ab8ddb17e0be8c6e1cf619b266b10e\n\nReviewer: Travis Scrimshaw, V\u00edt Tu\u010dek\n\nAuthor: V\u00edt Tu\u010dek, Travis Scrimshaw\n\nDependencies: #16380\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15948\n\n",
    "closed_at": "2014-11-14T21:01:33Z",
    "created_at": "2014-03-15T22:17:49Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "marked Dynkin diagrams",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15948",
    "user": "https://github.com/vit-tucek"
}
```
This patch adds marked Dynkin diagrams and marked Cartan types. See http://trac.sagemath.org/ticket/15948#comment:18 for details.

This convenient notation is used quite often in a certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307, and in Lie superalgebras, where markings denote the parity  of indices.

Moreover, there are two small bugfixes:

1. Documentation is misleading about our convention for arrows in Dynkin diagrams. We do follow Bourbaki convention for graphics (which is apparently the same as in Kac), but not the convention for the underlying Cartan matrix.
2. Dynkin diagrams for D and E series contain a special character in the node name of tikzpicture which TeX doesn't like.

CC:  @nthiery @dwbump

Branch/Commit: bf5e867266ab8ddb17e0be8c6e1cf619b266b10e

Reviewer: Travis Scrimshaw, Vít Tuček

Author: Vít Tuček, Travis Scrimshaw

Dependencies: #16380

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15948





---

archive/issue_comments_258159.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vittucek/ticket/15948\"",
    "created_at": "2014-03-15T22:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258159",
    "user": "https://github.com/vit-tucek"
}
```

Changing branch from "" to "u/vittucek/ticket/15948"



---

archive/issue_comments_258160.json:
```json
{
    "body": "Changing commit from \"\" to \"bf72707a19157a9728badae4932a8a1f010c6897\"",
    "created_at": "2014-03-16T00:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "bf72707a19157a9728badae4932a8a1f010c6897"



---

archive/issue_comments_258161.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-16T00:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.\n+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.\n \n This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307\n \n``````\n",
    "created_at": "2014-03-16T00:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258162",
    "user": "https://github.com/vit-tucek"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.
+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.
 
 This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307
 
``````




---

archive/issue_comments_258163.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.\n+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.\n \n This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307\n \n``````\n",
    "created_at": "2014-03-16T01:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258163",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.
+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.
 
 This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307
 
``````




---

archive/issue_comments_258164.json:
```json
{
    "body": "<a id='comment:4'></a>I believe it is useful to have the ability to cross out particular nodes for Dynkin diagrams (I believe the same/similar convention is used for Lie superalgebras to denote even/odd indices).\n\nHowever I think the `node_label` is redundant to the `label` and you are assuming your indexing set is `1, 2, ..., n`, often which it is not. Similarly, I'm planning to make Dynkin diagrams more immutable (#15739), so I'd rather have it return a new `DynkinDiagram` when changing the crossed out nodes. One last point from a quick look-through, for comparisons with `None` you should do:\n\n```\nif x is None:\n    pass\n\nif x is not None:\n    pass\n```\n\nI'll check against Kac tonight. Dan and Nicolas might have some more comments as well.\n\nBest,\n\nTravis\n\n---\nLast 10 new commits:",
    "created_at": "2014-03-16T01:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258164",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I believe it is useful to have the ability to cross out particular nodes for Dynkin diagrams (I believe the same/similar convention is used for Lie superalgebras to denote even/odd indices).

However I think the `node_label` is redundant to the `label` and you are assuming your indexing set is `1, 2, ..., n`, often which it is not. Similarly, I'm planning to make Dynkin diagrams more immutable (#15739), so I'd rather have it return a new `DynkinDiagram` when changing the crossed out nodes. One last point from a quick look-through, for comparisons with `None` you should do:

```
if x is None:
    pass

if x is not None:
    pass
```

I'll check against Kac tonight. Dan and Nicolas might have some more comments as well.

Best,

Travis

---
Last 10 new commits:



---

archive/issue_comments_258165.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.\n+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.\n \n This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307\n \n``````\n",
    "created_at": "2014-03-16T01:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258165",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently only in type A) so the data are actually used by latex.
+This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.
 
 This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307
 
``````




---

archive/issue_comments_258166.json:
```json
{
    "body": "<a id='comment:6'></a>Hi V\u00edt!\n\nThanks for your work on this. I agree with Travis. Furthermore the current implementation introduces quite some duplication, inside the type-specific latex methods and inbetween them. I guess this duplication could be avoided by factoring out a method, say `_latex_node(node, x,y)` that would handle the writing of the latex string for the node (label, crossing out, ...), and then make the type-specific latex methods use it. What do you think?\n\nCheers,\n                                      Nicolas",
    "created_at": "2014-03-16T06:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258166",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>Hi Vít!

Thanks for your work on this. I agree with Travis. Furthermore the current implementation introduces quite some duplication, inside the type-specific latex methods and inbetween them. I guess this duplication could be avoided by factoring out a method, say `_latex_node(node, x,y)` that would handle the writing of the latex string for the node (label, crossing out, ...), and then make the type-specific latex methods use it. What do you think?

Cheers,
                                      Nicolas



---

archive/issue_comments_258167.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [tscrim](#comment%3A4):\n> I believe it is useful to have the ability to cross out particular nodes for Dynkin diagrams (I believe the same/similar convention is used for Lie superalgebras to denote even/odd indices).\n> \n\n\nI'm glad to hear that.\n\n>\n> However I think the `node_label` is redundant to the `label` and you are assuming your indexing set is `1, 2, ..., n`, often which it is not. Similarly, I'm planning to make Dynkin diagrams more immutable (#15739), so I'd rather have it return a new `DynkinDiagram` when changing the crossed out nodes. One last point from a quick look-through, for comparisons with `None` you should do:\n> {{{\n> if x is None:\n>     pass\n> \n> if x is not None:\n>     pass\n> }}}\n> \n\n\nThe labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?\n\nAs for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?\n\n>\n> I'll check against Kac tonight. Dan and Nicolas might have some more comments as well.\n> \n> Best,\n\n\n> Travis",
    "created_at": "2014-03-16T10:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258167",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:7'></a>Replying to [tscrim](#comment%3A4):
> I believe it is useful to have the ability to cross out particular nodes for Dynkin diagrams (I believe the same/similar convention is used for Lie superalgebras to denote even/odd indices).
> 


I'm glad to hear that.

>
> However I think the `node_label` is redundant to the `label` and you are assuming your indexing set is `1, 2, ..., n`, often which it is not. Similarly, I'm planning to make Dynkin diagrams more immutable (#15739), so I'd rather have it return a new `DynkinDiagram` when changing the crossed out nodes. One last point from a quick look-through, for comparisons with `None` you should do:
> {{{
> if x is None:
>     pass
> 
> if x is not None:
>     pass
> }}}
> 


The labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?

As for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?

>
> I'll check against Kac tonight. Dan and Nicolas might have some more comments as well.
> 
> Best,


> Travis



---

archive/issue_comments_258168.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [nthiery](#comment%3A6):\n>     Hi V\u00edt!\n\n> \n> Thanks for your work on this. I agree with Travis. Furthermore the current implementation introduces quite some duplication, inside the type-specific latex methods and inbetween them. I guess this duplication could be avoided by factoring out a method, say `_latex_node(node, x,y)` that would handle the writing of the latex string for the node (label, crossing out, ...), and then make the type-specific latex methods use it. What do you think?\n> \n> Cheers,\n>                                       Nicolas\n\n\nThe duplication was always there. I just made it more apparent. ;) I myself thought about creating such a method when I was coding type E. I'll make that change now.",
    "created_at": "2014-03-16T10:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258168",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:8'></a>Replying to [nthiery](#comment%3A6):
>     Hi Vít!

> 
> Thanks for your work on this. I agree with Travis. Furthermore the current implementation introduces quite some duplication, inside the type-specific latex methods and inbetween them. I guess this duplication could be avoided by factoring out a method, say `_latex_node(node, x,y)` that would handle the writing of the latex string for the node (label, crossing out, ...), and then make the type-specific latex methods use it. What do you think?
> 
> Cheers,
>                                       Nicolas


The duplication was always there. I just made it more apparent. ;) I myself thought about creating such a method when I was coding type E. I'll make that change now.



---

archive/issue_comments_258169.json:
```json
{
    "body": "Changing commit from \"bf72707a19157a9728badae4932a8a1f010c6897\" to \"454c0ac306ca5ab92951fb72099fd8ce94985785\"",
    "created_at": "2014-03-16T13:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bf72707a19157a9728badae4932a8a1f010c6897" to "454c0ac306ca5ab92951fb72099fd8ce94985785"



---

archive/issue_comments_258170.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-16T13:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258171.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [vittucek](#comment%3A7):\n> The labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?\n> \n> As for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?\n\n\nIf you feel the `label` is not well documented, then you should document it better. However the best thing to do would be to override the Dynkin diagram's relabel as\n\n```python\ndef relabel(self, relabeling):\n    return DynkinDiagram(self._cartan_type.relabel(relabeling))\n```\nThis would result in:\n\n```\nsage: D = DynkinDiagram(['A',4,1])\nsage: DL = DynkinDiagram(D._cartan_type.relabel([2,-1,-2,-3,4])) # This would be D.relabel([2,-1,-2,-3,4])\nsage: DL\n2\nO-----------+\nO---O---O---O\n-1   -2   -3   4\nA4~ relabelled by {0: 2, 1: -1, 2: -2, 3: -3, 4: 4}\nsage: latex(_)\n\\begin{tikzpicture}[scale=0.5]\n\\draw (-1,0) node[anchor=east] {$A_{4}^{(1)} \\text{ relabelled by } \\left\\{0 : 2, 1 : -1, 2 : -2, 3 : -3, 4 : 4\\right\\}$};\n\\draw (0 cm,0) -- (6 cm,0);\n\\draw (0 cm,0) -- (3.0 cm, 1.2 cm);\n\\draw (3.0 cm, 1.2 cm) -- (6 cm, 0);\n\\draw[fill=white] (0 cm, 0) circle (.25cm) node[below=4pt]{$-1$};\n\\draw[fill=white] (2 cm, 0) circle (.25cm) node[below=4pt]{$-2$};\n\\draw[fill=white] (4 cm, 0) circle (.25cm) node[below=4pt]{$-3$};\n\\draw[fill=white] (6 cm, 0) circle (.25cm) node[below=4pt]{$4$};\n\\draw[fill=white] (3.0 cm, 1.2 cm) circle (.25cm) node[anchor=south east]{$2$};\n\\end{tikzpicture}\n```\nI agree that we should add the following semantic to `CartanType`:\n|           |\n|           |\n```\nsage: CartanType(['A',2], labels=[-1,-2])\n```\n(or perhaps `label` or `labeling` or...) and for `crossed_nodes`. Yet we should also have an additional method which allows us to set the crossed nodes.\n\nI feel like we should add `type_crossed.py` which keeps/prints this data and uses the same mechanic that the relabeled Cartan types use. Nicolas, do you agree?\n\nFurthermore, I don't like the current state of your printing method. Your iteration of the string is wrong because your assuming your labeling is nice (i.e. `[0, 1, ..., k]`). However that is somewhat moot because I think you should only have one method for printing the individual nodes, as per Nicolas' suggestion, because it is overkill (it's basically just a for loop).\n\nThanks for your work on this,\n\nTravis",
    "created_at": "2014-03-16T16:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258171",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Replying to [vittucek](#comment%3A7):
> The labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?
> 
> As for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?


If you feel the `label` is not well documented, then you should document it better. However the best thing to do would be to override the Dynkin diagram's relabel as

```python
def relabel(self, relabeling):
    return DynkinDiagram(self._cartan_type.relabel(relabeling))
```
This would result in:

```
sage: D = DynkinDiagram(['A',4,1])
sage: DL = DynkinDiagram(D._cartan_type.relabel([2,-1,-2,-3,4])) # This would be D.relabel([2,-1,-2,-3,4])
sage: DL
2
O-----------+
O---O---O---O
-1   -2   -3   4
A4~ relabelled by {0: 2, 1: -1, 2: -2, 3: -3, 4: 4}
sage: latex(_)
\begin{tikzpicture}[scale=0.5]
\draw (-1,0) node[anchor=east] {$A_{4}^{(1)} \text{ relabelled by } \left\{0 : 2, 1 : -1, 2 : -2, 3 : -3, 4 : 4\right\}$};
\draw (0 cm,0) -- (6 cm,0);
\draw (0 cm,0) -- (3.0 cm, 1.2 cm);
\draw (3.0 cm, 1.2 cm) -- (6 cm, 0);
\draw[fill=white] (0 cm, 0) circle (.25cm) node[below=4pt]{$-1$};
\draw[fill=white] (2 cm, 0) circle (.25cm) node[below=4pt]{$-2$};
\draw[fill=white] (4 cm, 0) circle (.25cm) node[below=4pt]{$-3$};
\draw[fill=white] (6 cm, 0) circle (.25cm) node[below=4pt]{$4$};
\draw[fill=white] (3.0 cm, 1.2 cm) circle (.25cm) node[anchor=south east]{$2$};
\end{tikzpicture}
```
I agree that we should add the following semantic to `CartanType`:
|           |
|           |
```
sage: CartanType(['A',2], labels=[-1,-2])
```
(or perhaps `label` or `labeling` or...) and for `crossed_nodes`. Yet we should also have an additional method which allows us to set the crossed nodes.

I feel like we should add `type_crossed.py` which keeps/prints this data and uses the same mechanic that the relabeled Cartan types use. Nicolas, do you agree?

Furthermore, I don't like the current state of your printing method. Your iteration of the string is wrong because your assuming your labeling is nice (i.e. `[0, 1, ..., k]`). However that is somewhat moot because I think you should only have one method for printing the individual nodes, as per Nicolas' suggestion, because it is overkill (it's basically just a for loop).

Thanks for your work on this,

Travis



---

archive/issue_comments_258172.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [tscrim](#comment%3A10):\n> Replying to [vittucek](#comment%3A7):\n> > The labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?\n> > \n> > As for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?\n\n> \n> If you feel the `label` is not well documented, then you should document it better. However the best thing to do would be to override the Dynkin diagram's relabel as\n> \n> ```python\n> def relabel(self, relabeling):\n>     return DynkinDiagram(self._cartan_type.relabel(relabeling))\n> ```\n> This would result in:\n> \n> ```\n> sage: D = DynkinDiagram(['A',4,1])\n> sage: DL = DynkinDiagram(D._cartan_type.relabel([2,-1,-2,-3,4])) # This would be D.relabel([2,-1,-2,-3,4])\n> sage: DL\n> 2\n> O-----------+\n> |           |\n> |           |\n> O---O---O---O\n> -1   -2   -3   4\n> A4~ relabelled by {0: 2, 1: -1, 2: -2, 3: -3, 4: 4}\n> sage: latex(_)\n> \\begin{tikzpicture}[scale=0.5]\n> \\draw (-1,0) node[anchor=east] {$A_{4}^{(1)} \\text{ relabelled by } \\left\\{0 : 2, 1 : -1, 2 : -2, 3 : -3, 4 : 4\\right\\}$};\n> \\draw (0 cm,0) -- (6 cm,0);\n> \\draw (0 cm,0) -- (3.0 cm, 1.2 cm);\n> \\draw (3.0 cm, 1.2 cm) -- (6 cm, 0);\n> \\draw[fill=white] (0 cm, 0) circle (.25cm) node[below=4pt]{$-1$};\n> \\draw[fill=white] (2 cm, 0) circle (.25cm) node[below=4pt]{$-2$};\n> \\draw[fill=white] (4 cm, 0) circle (.25cm) node[below=4pt]{$-3$};\n> \\draw[fill=white] (6 cm, 0) circle (.25cm) node[below=4pt]{$4$};\n> \\draw[fill=white] (3.0 cm, 1.2 cm) circle (.25cm) node[anchor=south east]{$2$};\n> \\end{tikzpicture}\n> ```\n> I agree that we should add the following semantic to `CartanType`:\n> \n> ```\n> sage: CartanType(['A',2], labels=[-1,-2])\n> ```\n> (or perhaps `label` or `labeling` or...) and for `crossed_nodes`. Yet we should also have an additional method which allows us to set the crossed nodes.\n\n\nThere are two problems. First that I do not understand current labeling mechanism properly (code nor use cases -- does anybode use `label` at all?) and second that the semantics here are really different. My `node_labels` represent some other object that has a priori nothing to do with how we label the basis of our Cartan algebra. In reality these `node_labels` denote a highest weight of the Levi part of a standard parabolic subalgebra and thus it should really be a mapping that assigns natural numbers to labels. So perhaps `node_labels` should really be a dictionary with keys `label(i) for i in self.index_set()`  What about this?\n\n```python\ndef set_node_labels(self, node_labels):\n    if isinstance(node_labels, list):\n        self.node_labels = {i : node_labels[label(i)-1] for i in self.index_set()}\n    else:\n         self.node_labels = node_labels\n```\n\n> \n> I feel like we should add `type_crossed.py` which keeps/prints this data and uses the same mechanic that the relabeled Cartan types use. Nicolas, do you agree?\n\n\nAs with `label` I am not sure what is the use case here. What is wrong with CartanType having labels, node_labels and crossed out nodes as instance variables?\n\n> \n> Furthermore, I don't like the current state of your printing method. Your iteration of the string is wrong because your assuming your labeling is nice (i.e. `[0, 1, ..., k]`). However that is somewhat moot because I think you should only have one method for printing the individual nodes, as per Nicolas' suggestion, because it is overkill (it's basically just a for loop).\n\n\nDid you look at my last commit? (http://git.sagemath.org/sage.git/commit/?id=454c0ac306ca5ab92951fb72099fd8ce94985785)\n\n> \n> Thanks for your work on this,\n\n\n> Travis\n\n\nThanks for feedback. ;)",
    "created_at": "2014-03-16T18:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258172",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:11'></a>Replying to [tscrim](#comment%3A10):
> Replying to [vittucek](#comment%3A7):
> > The labels which are implemented so far are intended for people who doesn't want to use Bourbaki convention. I think, this feature is not very well documented. My labels are purely a decoration of nodes, which can be used i.e. to denote a homogeneous vector bundle over $G/P$. So I guess the correct thing to do here is to change `node_labels[i]` to `node_labels[label(i)]`, right?
> > 
> > As for immutability issue, will it be OK, if I just add crossed_nodes and node_labels to the constructor and get rid of the setters?

> 
> If you feel the `label` is not well documented, then you should document it better. However the best thing to do would be to override the Dynkin diagram's relabel as
> 
> ```python
> def relabel(self, relabeling):
>     return DynkinDiagram(self._cartan_type.relabel(relabeling))
> ```
> This would result in:
> 
> ```
> sage: D = DynkinDiagram(['A',4,1])
> sage: DL = DynkinDiagram(D._cartan_type.relabel([2,-1,-2,-3,4])) # This would be D.relabel([2,-1,-2,-3,4])
> sage: DL
> 2
> O-----------+
> |           |
> |           |
> O---O---O---O
> -1   -2   -3   4
> A4~ relabelled by {0: 2, 1: -1, 2: -2, 3: -3, 4: 4}
> sage: latex(_)
> \begin{tikzpicture}[scale=0.5]
> \draw (-1,0) node[anchor=east] {$A_{4}^{(1)} \text{ relabelled by } \left\{0 : 2, 1 : -1, 2 : -2, 3 : -3, 4 : 4\right\}$};
> \draw (0 cm,0) -- (6 cm,0);
> \draw (0 cm,0) -- (3.0 cm, 1.2 cm);
> \draw (3.0 cm, 1.2 cm) -- (6 cm, 0);
> \draw[fill=white] (0 cm, 0) circle (.25cm) node[below=4pt]{$-1$};
> \draw[fill=white] (2 cm, 0) circle (.25cm) node[below=4pt]{$-2$};
> \draw[fill=white] (4 cm, 0) circle (.25cm) node[below=4pt]{$-3$};
> \draw[fill=white] (6 cm, 0) circle (.25cm) node[below=4pt]{$4$};
> \draw[fill=white] (3.0 cm, 1.2 cm) circle (.25cm) node[anchor=south east]{$2$};
> \end{tikzpicture}
> ```
> I agree that we should add the following semantic to `CartanType`:
> 
> ```
> sage: CartanType(['A',2], labels=[-1,-2])
> ```
> (or perhaps `label` or `labeling` or...) and for `crossed_nodes`. Yet we should also have an additional method which allows us to set the crossed nodes.


There are two problems. First that I do not understand current labeling mechanism properly (code nor use cases -- does anybode use `label` at all?) and second that the semantics here are really different. My `node_labels` represent some other object that has a priori nothing to do with how we label the basis of our Cartan algebra. In reality these `node_labels` denote a highest weight of the Levi part of a standard parabolic subalgebra and thus it should really be a mapping that assigns natural numbers to labels. So perhaps `node_labels` should really be a dictionary with keys `label(i) for i in self.index_set()`  What about this?

```python
def set_node_labels(self, node_labels):
    if isinstance(node_labels, list):
        self.node_labels = {i : node_labels[label(i)-1] for i in self.index_set()}
    else:
         self.node_labels = node_labels
```

> 
> I feel like we should add `type_crossed.py` which keeps/prints this data and uses the same mechanic that the relabeled Cartan types use. Nicolas, do you agree?


As with `label` I am not sure what is the use case here. What is wrong with CartanType having labels, node_labels and crossed out nodes as instance variables?

> 
> Furthermore, I don't like the current state of your printing method. Your iteration of the string is wrong because your assuming your labeling is nice (i.e. `[0, 1, ..., k]`). However that is somewhat moot because I think you should only have one method for printing the individual nodes, as per Nicolas' suggestion, because it is overkill (it's basically just a for loop).


Did you look at my last commit? (http://git.sagemath.org/sage.git/commit/?id=454c0ac306ca5ab92951fb72099fd8ce94985785)

> 
> Thanks for your work on this,


> Travis


Thanks for feedback. ;)



---

archive/issue_comments_258173.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-19T12:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258174.json:
```json
{
    "body": "Changing commit from \"454c0ac306ca5ab92951fb72099fd8ce94985785\" to \"2233007f07555e90b2976ab840061bf74f8b2e4a\"",
    "created_at": "2014-03-19T12:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "454c0ac306ca5ab92951fb72099fd8ce94985785" to "2233007f07555e90b2976ab840061bf74f8b2e4a"



---

archive/issue_comments_258175.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [git](#comment%3A12):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                          |                                            |\n> |------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n> |[2233007](http://git.sagemath.org/sage.git/commit/?id=2233007f07555e90b2976ab840061bf74f8b2e4a)|`BUGFIX: latex() of affine types work again`|\n\n\nI don't understand why that waning gets printed twice.",
    "created_at": "2014-03-19T12:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258175",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:13'></a>Replying to [git](#comment%3A12):
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                          |                                            |
> |------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
> |[2233007](http://git.sagemath.org/sage.git/commit/?id=2233007f07555e90b2976ab840061bf74f8b2e4a)|`BUGFIX: latex() of affine types work again`|


I don't understand why that waning gets printed twice.



---

archive/issue_comments_258176.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-25T21:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258177.json:
```json
{
    "body": "Changing commit from \"2233007f07555e90b2976ab840061bf74f8b2e4a\" to \"91981c1e5a5834ade692466334e7fdf89093a058\"",
    "created_at": "2014-03-25T21:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2233007f07555e90b2976ab840061bf74f8b2e4a" to "91981c1e5a5834ade692466334e7fdf89093a058"



---

archive/issue_comments_258178.json:
```json
{
    "body": "<a id='comment:15'></a>OK. I've fixed some bugs and now the patch doesn't cause any breakage and works in fulfilling my needs. \n\nThere is still some work to be done. Namely:\n\n1. Modify `repr` so that it prints also node_labels and crossed nodes. (I don't see a point in doing ascii graphics; two simple prints after the current output should do just fine.)\n2. Add doctests illustrating the new funcionality.\n3. Get rid of setters and move thiese features  to `__init__` in order to help`DynkinDiagram` become immutable.\n\nIs there an interest in getting this patch into sage? Are there some remaining issues that I missed?",
    "created_at": "2014-03-25T22:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258178",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:15'></a>OK. I've fixed some bugs and now the patch doesn't cause any breakage and works in fulfilling my needs. 

There is still some work to be done. Namely:

1. Modify `repr` so that it prints also node_labels and crossed nodes. (I don't see a point in doing ascii graphics; two simple prints after the current output should do just fine.)
2. Add doctests illustrating the new funcionality.
3. Get rid of setters and move thiese features  to `__init__` in order to help`DynkinDiagram` become immutable.

Is there an interest in getting this patch into sage? Are there some remaining issues that I missed?



---

archive/issue_comments_258179.json:
```json
{
    "body": "<a id='comment:16'></a>Yes there is, but finals week trumps Sage work. However from looking at the code, I think there is significant issues when dealing with non-standard indexing sets (which we should support).\n\nI'm going to cannibalize your branch into a new one where I'm going to create a new class in `type_marked.py` for types with marked nodes and add a proper relabel to `DynkinDiagram`. I should have it done in an hour or so.\n\nEDIT - So basically we want relabellings and markings to act as decorator classes (as per the design pattern). This will take some (moderate) refactoring, but it will simplify the resulting code and make it easier for similar future additions.",
    "created_at": "2014-03-26T02:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258179",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>Yes there is, but finals week trumps Sage work. However from looking at the code, I think there is significant issues when dealing with non-standard indexing sets (which we should support).

I'm going to cannibalize your branch into a new one where I'm going to create a new class in `type_marked.py` for types with marked nodes and add a proper relabel to `DynkinDiagram`. I should have it done in an hour or so.

EDIT - So basically we want relabellings and markings to act as decorator classes (as per the design pattern). This will take some (moderate) refactoring, but it will simplify the resulting code and make it easier for similar future additions.



---

archive/issue_comments_258180.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [tscrim](#comment%3A16):\n> Yes there is, but finals week trumps Sage work. However from looking at the code, I think there is significant issues when dealing with non-standard indexing sets (which we should support).\n> \n\n\nWould it help to refactor node_labels` and `crossed_nodes` into dictionaries as I suggested in comment 11?\n\n> I'm going to cannibalize your branch into a new one where I'm going to create a new class in `type_marked.py` for types with marked nodes and add a proper relabel to `DynkinDiagram`. I should have it done in an hour or so.\n> \n> EDIT - So basically we want relabellings and markings to act as decorator classes (as per the design pattern). This will take some (moderate) refactoring, but it will simplify the resulting code and make it easier for similar future additions.\n\n\nGreat. Thank you. I am just not sure how do we accomplish crossed nodes and weight labels at the same time. Multiple inheritance? \n\nBy the way, last week I've stumbled upon some articles about nilpotent orbits where they use Dynkin diagrams with labels and call them Weighted Dynking diagrams. So maybe use `WeightedCartanType` and `WeightedDynkinDiagram` for the guys with labels and `MarkedCartanType` & `MarkedDynkinDiagram` for crossed nodes? I can imagine that someone would want to use different markings than crosses which would amount to another round of digging into the TikZ documentation and parameter tweaking in all those `_latex_...` methods.",
    "created_at": "2014-03-26T12:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258180",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:17'></a>Replying to [tscrim](#comment%3A16):
> Yes there is, but finals week trumps Sage work. However from looking at the code, I think there is significant issues when dealing with non-standard indexing sets (which we should support).
> 


Would it help to refactor node_labels` and `crossed_nodes` into dictionaries as I suggested in comment 11?

> I'm going to cannibalize your branch into a new one where I'm going to create a new class in `type_marked.py` for types with marked nodes and add a proper relabel to `DynkinDiagram`. I should have it done in an hour or so.
> 
> EDIT - So basically we want relabellings and markings to act as decorator classes (as per the design pattern). This will take some (moderate) refactoring, but it will simplify the resulting code and make it easier for similar future additions.


Great. Thank you. I am just not sure how do we accomplish crossed nodes and weight labels at the same time. Multiple inheritance? 

By the way, last week I've stumbled upon some articles about nilpotent orbits where they use Dynkin diagrams with labels and call them Weighted Dynking diagrams. So maybe use `WeightedCartanType` and `WeightedDynkinDiagram` for the guys with labels and `MarkedCartanType` & `MarkedDynkinDiagram` for crossed nodes? I can imagine that someone would want to use different markings than crosses which would amount to another round of digging into the TikZ documentation and parameter tweaking in all those `_latex_...` methods.



---

archive/issue_comments_258181.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-26T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258181",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_258182.json:
```json
{
    "body": "<a id='comment:18'></a>Okay, done with the refactor and creating the `type_marked`. I couldn't get your latex to work, so I just implemented a custom help for the marks (cross outs). It's now setup so it's easy enough to add additional functionality if anyone wants it.\n\nI've also done some fixing up of the way we print the Dynkin diagram ascii art, so with labels up to length 3 (almost 4 really), it looks nice. I refactored `type_dual` and `type_relabeled` to inherit from a common class `CartanType_decorator` which acts as a decorator class and redirects most methods to the base Cartan type. I've set the (implicit) order of the decorators as\n\n```\ndual <- relabelled <- marked\n```\nwhere the first one was what was there previously. I also gave a `relabel` method to Dynkin diagrams and Cartan matrices. I think that's all, but I might be forgetting something. If we're happy with my changes, then it's a positive review.\n\n---\nNew commits:",
    "created_at": "2014-03-26T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258182",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Okay, done with the refactor and creating the `type_marked`. I couldn't get your latex to work, so I just implemented a custom help for the marks (cross outs). It's now setup so it's easy enough to add additional functionality if anyone wants it.

I've also done some fixing up of the way we print the Dynkin diagram ascii art, so with labels up to length 3 (almost 4 really), it looks nice. I refactored `type_dual` and `type_relabeled` to inherit from a common class `CartanType_decorator` which acts as a decorator class and redirects most methods to the base Cartan type. I've set the (implicit) order of the decorators as

```
dual <- relabelled <- marked
```
where the first one was what was there previously. I also gave a `relabel` method to Dynkin diagrams and Cartan matrices. I think that's all, but I might be forgetting something. If we're happy with my changes, then it's a positive review.

---
New commits:



---

archive/issue_comments_258183.json:
```json
{
    "body": "Changing author from \"V\u00edt Tu\u010dek\" to \"V\u00edt Tu\u010dek, Travis Scrimshaw\"",
    "created_at": "2014-03-26T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258183",
    "user": "https://github.com/tscrim"
}
```

Changing author from "Vít Tuček" to "Vít Tuček, Travis Scrimshaw"



---

archive/issue_comments_258184.json:
```json
{
    "body": "Changing branch from \"u/vittucek/ticket/15948\" to \"public/combinat/root_systems/marked_types-15948\"",
    "created_at": "2014-03-26T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258184",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/vittucek/ticket/15948" to "public/combinat/root_systems/marked_types-15948"



---

archive/issue_comments_258185.json:
```json
{
    "body": "Changing commit from \"91981c1e5a5834ade692466334e7fdf89093a058\" to \"612db215e7e89687f2dc5af38ce0915af16cc49a\"",
    "created_at": "2014-03-26T23:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258185",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "91981c1e5a5834ade692466334e7fdf89093a058" to "612db215e7e89687f2dc5af38ce0915af16cc49a"



---

archive/issue_comments_258186.json:
```json
{
    "body": "<a id='comment:19'></a>Great!\n\nReplying to [tscrim](#comment%3A18):\n> Okay, done with the refactor and creating the `type_marked`. I couldn't get your latex to work, so I just implemented a custom help for the marks (cross outs). It's now setup so it's easy enough to add additional functionality if anyone wants it.\n> \n\n\nIs this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? \n\nYou've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).\n\n> I've also done some fixing up of the way we print the Dynkin diagram ascii art, so with labels up to length 3 (almost 4 really), it looks nice. I refactored `type_dual` and `type_relabeled` to inherit from a common class `CartanType_decorator` which acts as a decorator class and redirects most methods to the base Cartan type. I've set the (implicit) order of the decorators as\n> \n> ```\n> dual <- relabelled <- marked\n> ```\n> where the first one was what was there previously. I also gave a `relabel` method to Dynkin diagrams and Cartan matrices. I think that's all, but I might be forgetting something. If we're happy with my changes, then it's a positive review.\n\n\nWould it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)\n\nI'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?",
    "created_at": "2014-03-31T20:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258186",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:19'></a>Great!

Replying to [tscrim](#comment%3A18):
> Okay, done with the refactor and creating the `type_marked`. I couldn't get your latex to work, so I just implemented a custom help for the marks (cross outs). It's now setup so it's easy enough to add additional functionality if anyone wants it.
> 


Is this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? 

You've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).

> I've also done some fixing up of the way we print the Dynkin diagram ascii art, so with labels up to length 3 (almost 4 really), it looks nice. I refactored `type_dual` and `type_relabeled` to inherit from a common class `CartanType_decorator` which acts as a decorator class and redirects most methods to the base Cartan type. I've set the (implicit) order of the decorators as
> 
> ```
> dual <- relabelled <- marked
> ```
> where the first one was what was there previously. I also gave a `relabel` method to Dynkin diagrams and Cartan matrices. I think that's all, but I might be forgetting something. If we're happy with my changes, then it's a positive review.


Would it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)

I'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?



---

archive/issue_comments_258187.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [vittucek](#comment%3A19):\n> Is this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? \n\n\nYes via `marked_nodes`. However we should add something to the doc of `CartanType` (I thought I did, but I guess not).\n\n> You've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).\n\n\nI'm not convinced yet that it is incorrect, much less that your proposal makes anything better. I will look at it more closely and think about it today/tomorrow (unless Dan or Nicolas, you have an opinion on this?).\n\n> Would it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)\n\n>\n> I'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?\n\n\nIMO we should do this in a follow-up ticket as this one has a lot going on to begin with. However it should be easy enough to do by adding a class/file similar to `type_marked.py` and another method to the base `CartanType_abstract` class.",
    "created_at": "2014-04-04T15:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258187",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>Replying to [vittucek](#comment%3A19):
> Is this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? 


Yes via `marked_nodes`. However we should add something to the doc of `CartanType` (I thought I did, but I guess not).

> You've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).


I'm not convinced yet that it is incorrect, much less that your proposal makes anything better. I will look at it more closely and think about it today/tomorrow (unless Dan or Nicolas, you have an opinion on this?).

> Would it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)

>
> I'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?


IMO we should do this in a follow-up ticket as this one has a lot going on to begin with. However it should be easy enough to do by adding a class/file similar to `type_marked.py` and another method to the base `CartanType_abstract` class.



---

archive/issue_comments_258188.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [tscrim](#comment%3A20):\n> Replying to [vittucek](#comment%3A19):\n> > Is this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? \n\n> \n> Yes via `marked_nodes`. However we should add something to the doc of `CartanType` (I thought I did, but I guess not).\n\n\nWhile you are at it, there is a small typo in `type_marked.py`: substitute `latex_relabel` by `latex_marked` in in the docstring.\n\n> \n> > You've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).\n\n> \n> I'm not convinced yet that it is incorrect, much less that your proposal makes anything better. I will look at it more closely and think about it today/tomorrow (unless Dan or Nicolas, you have an opinion on this?).\n\n\nMost texts on Lie algebras I've encountered define the arrows by saying that they point from the shorter vector to the longer one (or vice versa). Dynkin diagrams are first and foremost convenient graphical representation (don't you agree?) and as such the \"direction of the arrow\" should naturally mean the direction in the graphical representation and not the way how we define it using Cartan matrix. I for one was quite confused by the current docs and had to dig up Bourbaki to check it.\n\n> \n> > Would it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)\n\n> >\n> > I'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?\n\n> \n> IMO we should do this in a follow-up ticket as this one has a lot going on to begin with. However it should be easy enough to do by adding a class/file similar to `type_marked.py` and another method to the base `CartanType_abstract` class.\n\n\nOK. I would have already tried that if it weren't for build failures that the rebasing on beta5 brought me. ;) As soon as I will get sage to build again I'm gonna give it a shot.",
    "created_at": "2014-04-04T16:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258188",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:21'></a>Replying to [tscrim](#comment%3A20):
> Replying to [vittucek](#comment%3A19):
> > Is this feature discoverable by a user? Shouldn't we add some examples to `CartanType`'s docstring? 

> 
> Yes via `marked_nodes`. However we should add something to the doc of `CartanType` (I thought I did, but I guess not).


While you are at it, there is a small typo in `type_marked.py`: substitute `latex_relabel` by `latex_marked` in in the docstring.

> 
> > You've missed the bugfix for docstring regarding our convention for Dynkin diagrams (see commit 74c6d23eb28fd192b70e2219030d6ad60fcb9f0f).

> 
> I'm not convinced yet that it is incorrect, much less that your proposal makes anything better. I will look at it more closely and think about it today/tomorrow (unless Dan or Nicolas, you have an opinion on this?).


Most texts on Lie algebras I've encountered define the arrows by saying that they point from the shorter vector to the longer one (or vice versa). Dynkin diagrams are first and foremost convenient graphical representation (don't you agree?) and as such the "direction of the arrow" should naturally mean the direction in the graphical representation and not the way how we define it using Cartan matrix. I for one was quite confused by the current docs and had to dig up Bourbaki to check it.

> 
> > Would it be possible to add one more layer for weighted Cartan types? I mean my original motivation for this patch was to be able to produce diagrams for representation of homogeneous vector bundles which I can't really do now. :)

> >
> > I'd add this feature myself, but I am still struggling with understanding the current code. Is there some documentation for programmers or  design documents that would help me?

> 
> IMO we should do this in a follow-up ticket as this one has a lot going on to begin with. However it should be easy enough to do by adding a class/file similar to `type_marked.py` and another method to the base `CartanType_abstract` class.


OK. I would have already tried that if it weren't for build failures that the rebasing on beta5 brought me. ;) As soon as I will get sage to build again I'm gonna give it a shot.



---

archive/issue_comments_258189.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-09T01:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258190.json:
```json
{
    "body": "Changing commit from \"612db215e7e89687f2dc5af38ce0915af16cc49a\" to \"69d92ad128755a6d091fea7681f82fa738b68057\"",
    "created_at": "2014-04-09T01:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "612db215e7e89687f2dc5af38ce0915af16cc49a" to "69d92ad128755a6d091fea7681f82fa738b68057"



---

archive/issue_events_046906.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15948#event-46906"
}
```



---

archive/issue_comments_258191.json:
```json
{
    "body": "<a id='comment:24'></a>Merge conflict.",
    "created_at": "2014-05-16T06:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258191",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'></a>Merge conflict.



---

archive/issue_comments_258192.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-16T06:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258192",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_258193.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-16T17:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258194.json:
```json
{
    "body": "Changing commit from \"69d92ad128755a6d091fea7681f82fa738b68057\" to \"da0fc02f12f34ffd77a9de71df136e2855229e10\"",
    "created_at": "2014-06-16T17:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69d92ad128755a6d091fea7681f82fa738b68057" to "da0fc02f12f34ffd77a9de71df136e2855229e10"



---

archive/issue_comments_258195.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-16T17:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258195",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_258196.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw, V\u00edt Tu\u010dek\"",
    "created_at": "2014-06-16T17:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258196",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw, Vít Tuček"



---

archive/issue_comments_258197.json:
```json
{
    "body": "<a id='comment:26'></a>Hey Vit,\n\nSorry for falling behind on this.\n\nFor the Dynkin diagram documentation, I reread it and agree that the word *convention* could be misleading. I've tweaked that sentence, so how do you feel about it now?\n\nI've also fixed the merge conflicts and the typo. If everything is okay, then we can set this to positive review (as a cross review) and get onto the followups.\n\nBest,\n\nTravis",
    "created_at": "2014-06-16T17:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258197",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>Hey Vit,

Sorry for falling behind on this.

For the Dynkin diagram documentation, I reread it and agree that the word *convention* could be misleading. I've tweaked that sentence, so how do you feel about it now?

I've also fixed the merge conflicts and the typo. If everything is okay, then we can set this to positive review (as a cross review) and get onto the followups.

Best,

Travis



---

archive/issue_comments_258198.json:
```json
{
    "body": "<a id='comment:27'></a>**Ping**",
    "created_at": "2014-07-07T23:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258198",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>**Ping**



---

archive/issue_comments_258199.json:
```json
{
    "body": "<a id='comment:28'></a>Since there's no response from Vit -- Dan or Nicolas (or someone else), could you do a final look over of my last commit da0fc02? It's the only thing we need in order to set this to positive review.",
    "created_at": "2014-07-27T04:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258199",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>Since there's no response from Vit -- Dan or Nicolas (or someone else), could you do a final look over of my last commit da0fc02? It's the only thing we need in order to set this to positive review.



---

archive/issue_comments_258200.json:
```json
{
    "body": "<a id='comment:29'></a>Hi,\n sorry, I was on vacation. \n\nThe sentence is much better now, but I think it would not harm to add another one ensuring the user that the (graphical representation of the) Dynkin diagram itself is the same as in Bourbaki. But maybe it's superfluous... Does Kac have the same diagrams as Bourbaki? If so, then adding more explanations to the docstring might actually lead to more confusion. :)",
    "created_at": "2014-07-27T09:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258200",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:29'></a>Hi,
 sorry, I was on vacation. 

The sentence is much better now, but I think it would not harm to add another one ensuring the user that the (graphical representation of the) Dynkin diagram itself is the same as in Bourbaki. But maybe it's superfluous... Does Kac have the same diagrams as Bourbaki? If so, then adding more explanations to the docstring might actually lead to more confusion. :)



---

archive/issue_comments_258201.json:
```json
{
    "body": "<a id='comment:30'></a>AFAIK, the diagrams are all the same (the long roots point towards the short and `0---0---0=<=0` is type C<sub>4</sub>), it's just translating that into the Cartan matrix that the convention can differ, which is what that paragraph is about. So I don't think we need to add anything more.",
    "created_at": "2014-07-27T22:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258201",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>AFAIK, the diagrams are all the same (the long roots point towards the short and `0---0---0=<=0` is type C<sub>4</sub>), it's just translating that into the Cartan matrix that the convention can differ, which is what that paragraph is about. So I don't think we need to add anything more.



---

archive/issue_comments_258202.json:
```json
{
    "body": "<a id='comment:31'></a>Great. Then I think that we can give this patch a positive review. I'm not sure what's the proper protocol here, so I'll leave that up to you. I've took the liberty and changed the name of the patch and its description.",
    "created_at": "2014-07-28T15:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258202",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:31'></a>Great. Then I think that we can give this patch a positive review. I'm not sure what's the proper protocol here, so I'll leave that up to you. I've took the liberty and changed the name of the patch and its description.



---

archive/issue_comments_258203.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.\n+This patch adds marked Dynkin diagrams and marked Cartan types. See\u00a0http://trac.sagemath.org/ticket/15948#comment:18\u00a0for details.\n \n-This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307\n+This convenient notation is used quite often in a certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307, and in Lie superalgebras, where markings denote the parity \u00a0of indices.\n \n Moreover, there are two small bugfixes:\n \n-1. Documentation is wrong about our convention for arrows in Dynkin diagrams.\n+1. Documentation is misleading about our convention for arrows in Dynkin diagrams. We do follow Bourbaki convention for graphics (which is apparently the same as in Kac), but not the convention for the underlying Cartan matrix.\n 2. Dynkin diagrams for D and E series contain a special character in the node name of tikzpicture which TeX doesn't like.\n``````\n",
    "created_at": "2014-07-28T15:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258203",
    "user": "https://github.com/vit-tucek"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
-This patch adds set_crossed_nodes and set_node_labels methods to (non-affine) Dynkin Diagrams and modifies the _latex_dynkin_diagram (currently without docstrings) so the data are actually used by latex.
+This patch adds marked Dynkin diagrams and marked Cartan types. See http://trac.sagemath.org/ticket/15948#comment:18 for details.
 
-This convenient notation is used quite often in certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307
+This convenient notation is used quite often in a certain subbranch of differential geometry, see e.g. http://arxiv.org/abs/1303.1307, and in Lie superalgebras, where markings denote the parity  of indices.
 
 Moreover, there are two small bugfixes:
 
-1. Documentation is wrong about our convention for arrows in Dynkin diagrams.
+1. Documentation is misleading about our convention for arrows in Dynkin diagrams. We do follow Bourbaki convention for graphics (which is apparently the same as in Kac), but not the convention for the underlying Cartan matrix.
 2. Dynkin diagrams for D and E series contain a special character in the node name of tikzpicture which TeX doesn't like.
``````




---

archive/issue_comments_258204.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-28T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258204",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_258205.json:
```json
{
    "body": "<a id='comment:32'></a>All you'd need to do is set the ticket to positive review.",
    "created_at": "2014-07-28T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258205",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>All you'd need to do is set the ticket to positive review.



---

archive/issue_comments_258206.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-07-28T21:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258206",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_258207.json:
```json
{
    "body": "<a id='comment:33'></a>Various doctests fail...",
    "created_at": "2014-07-28T21:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>Various doctests fail...



---

archive/issue_comments_258208.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T17:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258209.json:
```json
{
    "body": "Changing commit from \"da0fc02f12f34ffd77a9de71df136e2855229e10\" to \"05aa053dfbd7d785d6666ffb40177c89bae1d05b\"",
    "created_at": "2014-07-29T17:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da0fc02f12f34ffd77a9de71df136e2855229e10" to "05aa053dfbd7d785d6666ffb40177c89bae1d05b"



---

archive/issue_comments_258210.json:
```json
{
    "body": "<a id='comment:35'></a>I'm taking care of this - the non-symmetric Macdonalds are strangely sensitive to the class heirarchy.",
    "created_at": "2014-07-29T17:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258210",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>I'm taking care of this - the non-symmetric Macdonalds are strangely sensitive to the class heirarchy.



---

archive/issue_comments_258211.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T17:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258212.json:
```json
{
    "body": "Changing commit from \"05aa053dfbd7d785d6666ffb40177c89bae1d05b\" to \"1cfe9b8c4e0b494c661e7c761043d3cd859429da\"",
    "created_at": "2014-07-29T17:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "05aa053dfbd7d785d6666ffb40177c89bae1d05b" to "1cfe9b8c4e0b494c661e7c761043d3cd859429da"



---

archive/issue_comments_258213.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#16380\"",
    "created_at": "2014-07-29T17:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258213",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#16380"



---

archive/issue_comments_258214.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-07-29T17:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258214",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_258215.json:
```json
{
    "body": "<a id='comment:37'></a>Fixed - I had accidentally changed the behavior of `.type()` for dual types. I also merged in #16380 in order to speed up testing. I also fixed an issue with the ambient space for marked Cartan types and implemented the `basic_untwisted`. It needs another look-over.",
    "created_at": "2014-07-29T17:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258215",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>Fixed - I had accidentally changed the behavior of `.type()` for dual types. I also merged in #16380 in order to speed up testing. I also fixed an issue with the ambient space for marked Cartan types and implemented the `basic_untwisted`. It needs another look-over.



---

archive/issue_events_046907.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15948#event-46907"
}
```



---

archive/issue_events_046908.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15948#event-46908"
}
```



---

archive/issue_comments_258216.json:
```json
{
    "body": "<a id='comment:39'></a>I know you didn't introduce this bug, but could you by chance fix this to raise a proper exception?\n\n```\nsage: CartanType(['H',3]).dual()\n...\nAssertionError: \n```\n(note: I don't really care about this ticket, I just hate it when people abuse `assert`)",
    "created_at": "2014-10-01T08:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258216",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>I know you didn't introduce this bug, but could you by chance fix this to raise a proper exception?

```
sage: CartanType(['H',3]).dual()
...
AssertionError: 
```
(note: I don't really care about this ticket, I just hate it when people abuse `assert`)



---

archive/issue_comments_258217.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [jdemeyer](#comment%3A39):\n> I know you didn't introduce this bug, but could you by chance fix this to raise a proper exception?\n> \n> ```\n> sage: CartanType(['H',3]).dual()\n> ...\n> AssertionError: \n> ```\n> (note: I don't really care about this ticket, I just hate it when people abuse `assert`)\n\n\nI've created #17084 for this and will upload a branch there later today.",
    "created_at": "2014-10-01T18:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258217",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Replying to [jdemeyer](#comment%3A39):
> I know you didn't introduce this bug, but could you by chance fix this to raise a proper exception?
> 
> ```
> sage: CartanType(['H',3]).dual()
> ...
> AssertionError: 
> ```
> (note: I don't really care about this ticket, I just hate it when people abuse `assert`)


I've created #17084 for this and will upload a branch there later today.



---

archive/issue_comments_258218.json:
```json
{
    "body": "Changing commit from \"1cfe9b8c4e0b494c661e7c761043d3cd859429da\" to \"bf5e867266ab8ddb17e0be8c6e1cf619b266b10e\"",
    "created_at": "2014-11-06T02:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1cfe9b8c4e0b494c661e7c761043d3cd859429da" to "bf5e867266ab8ddb17e0be8c6e1cf619b266b10e"



---

archive/issue_comments_258219.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-06T02:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258220.json:
```json
{
    "body": "<a id='comment:42'></a>Rebased. Could someone do the last little bit of review of commits 7ce8285 and 66ad2bb?",
    "created_at": "2014-11-06T03:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258220",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Rebased. Could someone do the last little bit of review of commits 7ce8285 and 66ad2bb?



---

archive/issue_comments_258221.json:
```json
{
    "body": "<a id='comment:43'></a>Thanks for keeping this branch alive!\n\nI've tried to doctest this on cloud.sagemath.org and it behaves rather strangely. The parallel doctests (e.g. ./sage -tp 12 src/sage/combinat/root_system/) run just fine but when I try to doctest a single file such as ./sage -t src/sage/combinat/root_system/cartan_type.py it spews\n\n```\n7 items had failures:\n   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract._ascii_art_node\n   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract._latex_draw_node\n   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract.marked_nodes\n   1 of   5 in sage.combinat.root_system.cartan_type.CartanType_affine._ascii_art_node\n   1 of   4 in sage.combinat.root_system.cartan_type.CartanType_affine._latex_draw_node\n   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_crystallographic.i\n   2 of   3 in sage.combinat.root_system.cartan_type.CartanType_crystallographic.index_set_bipartition\n    [432 tests, 8 failures, 1.89 s]\n```\nwith errors such as\n\n```\n\u00a0 \u00a0 AttributeError:\u00a0'CartanType_with_superclass'\u00a0object\u00a0has\u00a0no\u00a0attribute\u00a0'_ascii_art_node'\n```\nI guess I must be doing something wrong.",
    "created_at": "2014-11-08T01:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258221",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:43'></a>Thanks for keeping this branch alive!

I've tried to doctest this on cloud.sagemath.org and it behaves rather strangely. The parallel doctests (e.g. ./sage -tp 12 src/sage/combinat/root_system/) run just fine but when I try to doctest a single file such as ./sage -t src/sage/combinat/root_system/cartan_type.py it spews

```
7 items had failures:
   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract._ascii_art_node
   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract._latex_draw_node
   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_abstract.marked_nodes
   1 of   5 in sage.combinat.root_system.cartan_type.CartanType_affine._ascii_art_node
   1 of   4 in sage.combinat.root_system.cartan_type.CartanType_affine._latex_draw_node
   1 of   2 in sage.combinat.root_system.cartan_type.CartanType_crystallographic.i
   2 of   3 in sage.combinat.root_system.cartan_type.CartanType_crystallographic.index_set_bipartition
    [432 tests, 8 failures, 1.89 s]
```
with errors such as

```
    AttributeError: 'CartanType_with_superclass' object has no attribute '_ascii_art_node'
```
I guess I must be doing something wrong.



---

archive/issue_comments_258222.json:
```json
{
    "body": "<a id='comment:44'></a>Hmmm...that's very strange. I tested the single files on my machine and it works okay. Unfortunately I don't know enough about how SMC does things to be able to help (which might be based on your specific config). Even stranger is that I don't think I changed anything that would cause such a failure. Since it passes in parallel, I'm tempted to say it's based on your current setup, but let me see the full output from the test.",
    "created_at": "2014-11-08T01:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258222",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>Hmmm...that's very strange. I tested the single files on my machine and it works okay. Unfortunately I don't know enough about how SMC does things to be able to help (which might be based on your specific config). Even stranger is that I don't think I changed anything that would cause such a failure. Since it passes in parallel, I'm tempted to say it's based on your current setup, but let me see the full output from the test.



---

archive/issue_comments_258223.json:
```json
{
    "body": "<a id='comment:45'></a>Actually, it seems I've just forgotten `./` in front of `sage`.  Sorry!",
    "created_at": "2014-11-10T17:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258223",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:45'></a>Actually, it seems I've just forgotten `./` in front of `sage`.  Sorry!



---

archive/issue_comments_258224.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-10T17:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258224",
    "user": "https://github.com/vit-tucek"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_258225.json:
```json
{
    "body": "<a id='comment:46'></a>Thank you for your work on this!",
    "created_at": "2014-11-10T22:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258225",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Thank you for your work on this!



---

archive/issue_comments_258226.json:
```json
{
    "body": "Changing branch from \"public/combinat/root_systems/marked_types-15948\" to \"bf5e867266ab8ddb17e0be8c6e1cf619b266b10e\"",
    "created_at": "2014-11-14T21:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258226",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/combinat/root_systems/marked_types-15948" to "bf5e867266ab8ddb17e0be8c6e1cf619b266b10e"



---

archive/issue_comments_258227.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-14T21:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15948#issuecomment-258227",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_046909.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-14T21:01:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15948",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15948#event-46909"
}
```
