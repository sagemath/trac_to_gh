# Issue 15851: fix unhandled segfault in Coin backend

archive/issues_015614.json:
```json
{
    "body": "Coin does not properly initialise variables before solving,\nleading to get_variables() segfaulting if it is called before\nsolving. The fix is to check that the pointer returned is not\nNULL.\n\nBranch/Commit: [2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)\n\nReviewer: Punarbasu Purkayastha\n\nAuthor: Dmitrii Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15851\n\n",
    "closed_at": "2014-02-27T21:28:48Z",
    "created_at": "2014-02-23T15:47:33Z",
    "labels": [
        "component: linear programming",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "fix unhandled segfault in Coin backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15851",
    "user": "https://github.com/dimpase"
}
```
Coin does not properly initialise variables before solving,
leading to get_variables() segfaulting if it is called before
solving. The fix is to check that the pointer returned is not
NULL.

Branch/Commit: [2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)

Reviewer: Punarbasu Purkayastha

Author: Dmitrii Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15851





---

archive/issue_comments_260936.json:
```json
{
    "body": "<a id='comment:1'></a>\nFollowing code should fix it\n\n```diff\ndiff --git a/src/sage/numerical/backends/coin_backend.pyx b/src/sage/numerical/backends/coin_backend.pyx\nindex 4083c79..96e47d3 100644\n--- a/src/sage/numerical/backends/coin_backend.pyx\n+++ b/src/sage/numerical/backends/coin_backend.pyx\n@@ -826,7 +826,10 @@ cdef class CoinBackend(GenericBackend):\n \n         cdef double * solution\n         solution = <double*> self.model.solver().getColSolution()\n-        return solution[variable]\n+        if solution:\n+            return solution[variable]\n+        else:\n+            return []\n \n     cpdef int ncols(self):\n         r\"\"\"\n```",
    "created_at": "2014-02-23T16:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260936",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:1'></a>
Following code should fix it

```diff
diff --git a/src/sage/numerical/backends/coin_backend.pyx b/src/sage/numerical/backends/coin_backend.pyx
index 4083c79..96e47d3 100644
--- a/src/sage/numerical/backends/coin_backend.pyx
+++ b/src/sage/numerical/backends/coin_backend.pyx
@@ -826,7 +826,10 @@ cdef class CoinBackend(GenericBackend):
 
         cdef double * solution
         solution = <double*> self.model.solver().getColSolution()
-        return solution[variable]
+        if solution:
+            return solution[variable]
+        else:
+            return []
 
     cpdef int ncols(self):
         r"""
```



---

archive/issue_comments_260937.json:
```json
{
    "body": "Branch: [u/dimpase/ticket/15851](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/15851)",
    "created_at": "2014-02-23T16:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260937",
    "user": "https://github.com/dimpase"
}
```

Branch: [u/dimpase/ticket/15851](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/15851)



---

archive/issue_comments_260938.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-23T16:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260938",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_260939.json:
```json
{
    "body": "Commit: [2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)",
    "created_at": "2014-02-23T16:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260939",
    "user": "https://github.com/dimpase"
}
```

Commit: [2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)



---

archive/issue_comments_260940.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[2ed965d](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)|`added a check for NULL and a doctest.`|",
    "created_at": "2014-02-23T16:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260940",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[2ed965d](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)|`added a check for NULL and a doctest.`|



---

archive/issue_comments_260941.json:
```json
{
    "body": "<a id='comment:4'></a>\nPerhaps we should return `None` instead of 0.0?",
    "created_at": "2014-02-23T16:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260941",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:4'></a>
Perhaps we should return `None` instead of 0.0?



---

archive/issue_comments_260942.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [ppurka](#comment%3A4):\n> Perhaps we should return `None` instead of 0.0?\n\n\nother backends return 0, and IMHO it's nice to have this consistent...",
    "created_at": "2014-02-23T16:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260942",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Replying to [ppurka](#comment%3A4):
> Perhaps we should return `None` instead of 0.0?


other backends return 0, and IMHO it's nice to have this consistent...



---

archive/issue_comments_260943.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhy don't you directly do a `return 0.0`?",
    "created_at": "2014-02-24T06:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260943",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:6'></a>
Why don't you directly do a `return 0.0`?



---

archive/issue_comments_260944.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [ppurka](#comment%3A6):\n> Why don't you directly do a `return 0.0`?\n\n\nI would like to control the type of returned value in Cython. I guess 0.0 might be float\nrather than double. I suppose making it return the same type always is a good idea, allowing\nfor faster compiled code.",
    "created_at": "2014-02-24T08:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260944",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
Replying to [ppurka](#comment%3A6):
> Why don't you directly do a `return 0.0`?


I would like to control the type of returned value in Cython. I guess 0.0 might be float
rather than double. I suppose making it return the same type always is a good idea, allowing
for faster compiled code.



---

archive/issue_comments_260945.json:
```json
{
    "body": "<a id='comment:8'></a>\nOh, I see. It could be float by default.\n\nThen it looks good to me.",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260945",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:8'></a>
Oh, I see. It could be float by default.

Then it looks good to me.



---

archive/issue_comments_260946.json:
```json
{
    "body": "Author: Dmitrii Pasechnik",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260946",
    "user": "https://github.com/ppurka"
}
```

Author: Dmitrii Pasechnik



---

archive/issue_comments_260947.json:
```json
{
    "body": "Reviewer: Punarbasu Purkayastha",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260947",
    "user": "https://github.com/ppurka"
}
```

Reviewer: Punarbasu Purkayastha



---

archive/issue_comments_260948.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260948",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_260949.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-27T21:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260949",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_260950.json:
```json
{
    "body": "Changing branch from \"[u/dimpase/ticket/15851](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/15851)\" to \"[2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)\"",
    "created_at": "2014-02-27T21:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15851#issuecomment-260950",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/dimpase/ticket/15851](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/15851)" to "[2ed965da5a0259b408bc5857b0ffad11c6e6165c](https://github.com/sagemath/sagetrac-mirror/commit/2ed965da5a0259b408bc5857b0ffad11c6e6165c)"



---

archive/issue_events_053175.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-27T21:28:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15851",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15851#event-53175"
}
```
