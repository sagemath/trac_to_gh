# Issue 15711: DiscreteHiddenMarkovModel instances do not unpickle correctly

archive/issues_015474.json:
```json
{
    "body": "From the [google notebook bug reports](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA)\n\n*As you can see in the following script, even though an unpickled instance claims to be equal to the original, it behaves differently. Worse, several of the functions (e.g., M2.transition_matrix()) throw exceptions, and an exception is thrown if you just try to print the object's value. *\n\n```\nsage: from sage.stats.hmm.hmm import DiscreteHiddenMarkovModel\nsage: M = DiscreteHiddenMarkovModel([[1.0]], [[0.1, 0.9]], [1.0])\nsage: import pickle\nsage: M2 = pickle.loads(pickle.dumps(M))\nsage: M2 == M\nTrue\nsage: M.log_likelihood([1]*4)\n-0.4214420626313051\nsage: M2.log_likelihood([1]*4)\n-inf\nsage: M2.emission_matrix()\n---------------------------------------------------------------------------\nValueError Traceback (most recent call last)\n<ipython-input-24-2ee08778d25e> in <module>()\n----> 1 M2.emission_matrix()\n\n/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/stats/hmm/hmm.so in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.emission_matrix (sage/stats/hmm/hmm.c:2760)()\n\n/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/matrix/constructor.pyc in _matrix_constructor(*args, **kwds)\n641 raise ValueError, \"entries has the wrong length\"\n642 elif len(args[0]) > 0:\n--> 643 raise ValueError, \"entries has the wrong length\"\n644 \n645 entries = args[0]\n\nValueError: entries has the wrong length\n\nsage: M2\n---------------------------------------------------------------------------\nValueError Traceback (most recent call last)\n<ipython-input-20-13669956a766> in <module>()\n... (long trace deleted)\n```\n\nBranch/Commit: ddbc327568db291cd50c539bd74fece2599474a5\n\nReviewer: Julian R\u00fcth\n\nAuthor: Mark Saaltink\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15711\n\n",
    "closed_at": "2016-11-19T22:10:03Z",
    "created_at": "2014-01-22T16:55:47Z",
    "labels": [
        "component: statistics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "DiscreteHiddenMarkovModel instances do not unpickle correctly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15711",
    "user": "https://github.com/ppurka"
}
```
From the [google notebook bug reports](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA)

*As you can see in the following script, even though an unpickled instance claims to be equal to the original, it behaves differently. Worse, several of the functions (e.g., M2.transition_matrix()) throw exceptions, and an exception is thrown if you just try to print the object's value. *

```
sage: from sage.stats.hmm.hmm import DiscreteHiddenMarkovModel
sage: M = DiscreteHiddenMarkovModel([[1.0]], [[0.1, 0.9]], [1.0])
sage: import pickle
sage: M2 = pickle.loads(pickle.dumps(M))
sage: M2 == M
True
sage: M.log_likelihood([1]*4)
-0.4214420626313051
sage: M2.log_likelihood([1]*4)
-inf
sage: M2.emission_matrix()
---------------------------------------------------------------------------
ValueError Traceback (most recent call last)
<ipython-input-24-2ee08778d25e> in <module>()
----> 1 M2.emission_matrix()

/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/stats/hmm/hmm.so in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.emission_matrix (sage/stats/hmm/hmm.c:2760)()

/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/matrix/constructor.pyc in _matrix_constructor(*args, **kwds)
641 raise ValueError, "entries has the wrong length"
642 elif len(args[0]) > 0:
--> 643 raise ValueError, "entries has the wrong length"
644 
645 entries = args[0]

ValueError: entries has the wrong length

sage: M2
---------------------------------------------------------------------------
ValueError Traceback (most recent call last)
<ipython-input-20-13669956a766> in <module>()
... (long trace deleted)
```

Branch/Commit: ddbc327568db291cd50c539bd74fece2599474a5

Reviewer: Julian RÃ¼th

Author: Mark Saaltink

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15711





---

archive/issue_events_046119.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46119"
}
```



---

archive/issue_events_046120.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46120"
}
```



---

archive/issue_events_046121.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46121"
}
```



---

archive/issue_events_046122.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46122"
}
```



---

archive/issue_events_046123.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46123"
}
```



---

archive/issue_comments_213110.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-14T00:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213110",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_213111.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2016-11-14T00:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213111",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_213112.json:
```json
{
    "body": "<a id='comment:7'></a>Btw. I could not find your name on https://trac.sagemath.org/wiki, you might want to add it there.",
    "created_at": "2016-11-17T06:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213112",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>Btw. I could not find your name on https://trac.sagemath.org/wiki, you might want to add it there.



---

archive/issue_comments_213113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n *As you can see in the following script, even though an unpickled instance claims to be equal to the original, it behaves differently. Worse, several of the functions (e.g., M2.transition_matrix()) throw exceptions, and an exception is thrown if you just try to print the object's value. *\n \n ```\n-sage: from sage.stats.hmm.hmm import DIscreteHiddenMarkovModel\n+sage: from sage.stats.hmm.hmm import DiscreteHiddenMarkovModel\n sage: M = DiscreteHiddenMarkovModel([[1.0]], [[0.1, 0.9]], [1.0])\n sage: import pickle\n sage: M2 = pickle.loads(pickle.dumps(M))\n``````\n",
    "created_at": "2016-11-17T06:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213113",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 *As you can see in the following script, even though an unpickled instance claims to be equal to the original, it behaves differently. Worse, several of the functions (e.g., M2.transition_matrix()) throw exceptions, and an exception is thrown if you just try to print the object's value. *
 
 ```
-sage: from sage.stats.hmm.hmm import DIscreteHiddenMarkovModel
+sage: from sage.stats.hmm.hmm import DiscreteHiddenMarkovModel
 sage: M = DiscreteHiddenMarkovModel([[1.0]], [[0.1, 0.9]], [1.0])
 sage: import pickle
 sage: M2 = pickle.loads(pickle.dumps(M))
``````




---

archive/issue_comments_213114.json:
```json
{
    "body": "<a id='comment:10'></a>I tweaked the docstring a bit. If you are fine with this, feel free to set it to positive review yourself.\n\n---\nNew commits:",
    "created_at": "2016-11-17T07:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213114",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>I tweaked the docstring a bit. If you are fine with this, feel free to set it to positive review yourself.

---
New commits:



---

archive/issue_comments_213115.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-17T21:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213115",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_046124.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T22:10:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15711#event-46124"
}
```



---

archive/issue_comments_213116.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-19T22:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15711#issuecomment-213116",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
