# Issue 15664: Bug in IncidenceStructure.is_block_design

archive/issues_015427.json:
```json
{
    "body": "This bug has been noticed by Frederic in #15285 :\n\n```\nsage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()\n(True, [1, 3, 2, 15])\nsage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     \n(2, 3, 2, 15)\n```\n\nTurns out that the code of `is_block_design` was rather unclear, and rather... Costly. Here is a simpler, faster and more correct version in which the bug in solved.\n\nBefore: \n\n```\nsage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\nsage: time D.is_block_design()                                              \nCPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s\nWall time: 99.40 s\n(True, [3, 44, 4, 1])\n```\n\nAfter:\n\n```\nsage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\nsage: time D.is_block_design()                                              \nCPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s\nWall time: 0.06 s\n(True, [3, 44, 4, 1])\n```\n\nSecondly, `IncidenceStructure.parameter` has a very tricky behaviour :\n\n```\nsage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\nsage: D.is_block_design()                                                   \n(True, [3, 44, 4, 1])\nsage: D.parameters()                                                        \n(2, 44, 4, 21)\n```\n\nThis is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`\n\nThis patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.\n\nHere it is !\n\nNathann\n\n(this ticket took roughly 3hours of solid work)\n\nCC:  @fchapoton stefan @wdjoyner\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Nathann Cohen\n\nBranch: u/ncohen/15664\n\nDependencies: #15285\n\nCommit: 2aa7e1887472afaba33175bde385d45a0dd11cd8\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15664\n\n",
    "closed_at": "2014-02-03T16:07:46Z",
    "created_at": "2014-01-11T14:06:37Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Bug in IncidenceStructure.is_block_design",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15664",
    "user": "https://github.com/nathanncohen"
}
```
This bug has been noticed by Frederic in #15285 :

```
sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()
(True, [1, 3, 2, 15])
sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     
(2, 3, 2, 15)
```

Turns out that the code of `is_block_design` was rather unclear, and rather... Costly. Here is a simpler, faster and more correct version in which the bug in solved.

Before: 

```
sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
sage: time D.is_block_design()                                              
CPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s
Wall time: 99.40 s
(True, [3, 44, 4, 1])
```

After:

```
sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
sage: time D.is_block_design()                                              
CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s
Wall time: 0.06 s
(True, [3, 44, 4, 1])
```

Secondly, `IncidenceStructure.parameter` has a very tricky behaviour :

```
sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
sage: D.is_block_design()                                                   
(True, [3, 44, 4, 1])
sage: D.parameters()                                                        
(2, 44, 4, 21)
```

This is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`

This patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.

Here it is !

Nathann

(this ticket took roughly 3hours of solid work)

CC:  @fchapoton stefan @wdjoyner

Reviewer: Frédéric Chapoton

Author: Nathann Cohen

Branch: u/ncohen/15664

Dependencies: #15285

Commit: 2aa7e1887472afaba33175bde385d45a0dd11cd8

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15664





---

archive/issue_comments_212281.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-11T14:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212281",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_212282.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-11T14:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212282",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_212283.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,22 +12,40 @@\n Before: \n \n ```\n-sage: D = IncidenceStructure(range(32),designs.steiner_quadruple_system(32))\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n sage: time D.is_block_design()                                              \n-CPU times: user 14.31 s, sys: 0.00 s, total: 14.32 s\n-Wall time: 14.33 s\n-(True, [3, 32, 4, 1])\n+CPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s\n+Wall time: 99.40 s\n+(True, [3, 44, 4, 1])\n ```\n \n After:\n \n ```\n-sage: D = IncidenceStructure(range(32),designs.steiner_quadruple_system(32))\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n sage: time D.is_block_design()                                              \n-CPU times: user 0.18 s, sys: 0.01 s, total: 0.19 s\n-Wall time: 0.17 s\n-(True, [2, 32, 4, 15])\n+CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s\n+Wall time: 0.06 s\n+(True, [3, 44, 4, 1])\n ```\n+\n+Secondly, `IncidenceStructure.parameter` has a very tricky behaviour :\n+\n+```\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n+sage: D.is_block_design()                                                   \n+(True, [3, 44, 4, 1])\n+sage: D.parameters()                                                        \n+(2, 44, 4, 21)\n+```\n+\n+This is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`\n+\n+This patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.\n+\n+Here it is !\n+\n+Nathann\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2014-01-11T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212283",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,22 +12,40 @@
 Before: 
 
 ```
-sage: D = IncidenceStructure(range(32),designs.steiner_quadruple_system(32))
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
 sage: time D.is_block_design()                                              
-CPU times: user 14.31 s, sys: 0.00 s, total: 14.32 s
-Wall time: 14.33 s
-(True, [3, 32, 4, 1])
+CPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s
+Wall time: 99.40 s
+(True, [3, 44, 4, 1])
 ```
 
 After:
 
 ```
-sage: D = IncidenceStructure(range(32),designs.steiner_quadruple_system(32))
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
 sage: time D.is_block_design()                                              
-CPU times: user 0.18 s, sys: 0.01 s, total: 0.19 s
-Wall time: 0.17 s
-(True, [2, 32, 4, 15])
+CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s
+Wall time: 0.06 s
+(True, [3, 44, 4, 1])
 ```
+
+Secondly, `IncidenceStructure.parameter` has a very tricky behaviour :
+
+```
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
+sage: D.is_block_design()                                                   
+(True, [3, 44, 4, 1])
+sage: D.parameters()                                                        
+(2, 44, 4, 21)
+```
+
+This is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`
+
+This patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.
+
+Here it is !
+
+Nathann
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_212284.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-11T17:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212284",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_212285.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+This bug has been noticed by Frederic in #15285 :\n \n+```\n+sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()\n+(True, [1, 3, 2, 15])\n+sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     \n+(2, 3, 2, 15)\n+```\n+\n+Turns out that the code of `is_block_design` was rather unclear, and rather... Costly. Here is a simpler, faster and more correct version in which the bug in solved.\n+\n+Before: \n+\n+```\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n+sage: time D.is_block_design()                                              \n+CPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s\n+Wall time: 99.40 s\n+(True, [3, 44, 4, 1])\n+```\n+\n+After:\n+\n+```\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n+sage: time D.is_block_design()                                              \n+CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s\n+Wall time: 0.06 s\n+(True, [3, 44, 4, 1])\n+```\n+\n+Secondly, `IncidenceStructure.parameter` has a very tricky behaviour :\n+\n+```\n+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))\n+sage: D.is_block_design()                                                   \n+(True, [3, 44, 4, 1])\n+sage: D.parameters()                                                        \n+(2, 44, 4, 21)\n+```\n+\n+This is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`\n+\n+This patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.\n+\n+Here it is !\n+\n+Nathann\n+\n+(this ticket took roughly 3hours of solid work)\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2014-01-11T17:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212285",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,53 @@
+This bug has been noticed by Frederic in #15285 :
 
+```
+sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).is_block_design()
+(True, [1, 3, 2, 15])
+sage: IncidenceStructure([0,1,2],[[0,1],[0,2],[1,2]]*15).parameters()     
+(2, 3, 2, 15)
+```
+
+Turns out that the code of `is_block_design` was rather unclear, and rather... Costly. Here is a simpler, faster and more correct version in which the bug in solved.
+
+Before: 
+
+```
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
+sage: time D.is_block_design()                                              
+CPU times: user 99.26 s, sys: 0.06 s, total: 99.32 s
+Wall time: 99.40 s
+(True, [3, 44, 4, 1])
+```
+
+After:
+
+```
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
+sage: time D.is_block_design()                                              
+CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s
+Wall time: 0.06 s
+(True, [3, 44, 4, 1])
+```
+
+Secondly, `IncidenceStructure.parameter` has a very tricky behaviour :
+
+```
+sage: D = IncidenceStructure(range(44),designs.steiner_quadruple_system(44))
+sage: D.is_block_design()                                                   
+(True, [3, 44, 4, 1])
+sage: D.parameters()                                                        
+(2, 44, 4, 21)
+```
+
+This is because `parameters()` take `t` as a parameter, and sets it to `2` by default. That's.... surprising `:-P`
+
+This patch adds a deprecation warning when this parameter is not set, and we will make it mandatory... in a while.
+
+Here it is !
+
+Nathann
+
+(this ticket took roughly 3hours of solid work)
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_212286.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-11T17:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_212287.json:
```json
{
    "body": "<a id='comment:7'></a>Hello,\n\nNice job !\n\nDo you still need to use `self.blocks()` instead of `self.blcks` ? You have replaced some of them, but there remains one.",
    "created_at": "2014-01-12T20:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212287",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Hello,

Nice job !

Do you still need to use `self.blocks()` instead of `self.blcks` ? You have replaced some of them, but there remains one.



---

archive/issue_comments_212288.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-12T20:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_212289.json:
```json
{
    "body": "<a id='comment:9'></a>Fixed !\n\nNathann",
    "created_at": "2014-01-12T20:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212289",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>Fixed !

Nathann



---

archive/issue_comments_212290.json:
```json
{
    "body": "<a id='comment:10'></a>Looks good to me.\n\nOne last detail : there lacks a space after \"2\" in \"2is used when none is provided\"\n\nThen you can set a positive review.",
    "created_at": "2014-01-13T20:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212290",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Looks good to me.

One last detail : there lacks a space after "2" in "2is used when none is provided"

Then you can set a positive review.



---

archive/issue_comments_212291.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-14T09:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_212292.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-14T09:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212292",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_212293.json:
```json
{
    "body": "<a id='comment:13'></a>Done ! Thanks for the review `;-)`\n\nNathann",
    "created_at": "2014-01-14T09:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212293",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>Done ! Thanks for the review `;-)`

Nathann



---

archive/issue_events_045939.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15664#event-45939"
}
```



---

archive/issue_comments_212294.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-03T16:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15664#issuecomment-212294",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_045940.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-03T16:07:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15664#event-45940"
}
```
