# Issue 15433: Port to OSX 10.9

archive/issues_015196.json:
```json
{
    "body": "Sage fails to build on OSX 10.9.\n\nIssues:\n\n1. scipy doesn't play nicely with the new accelerate framework headers\n2. R depends on CoreData which uses non-standard sqlite3 modules (and this affects us since we set `*_LIBRARY_PATH` and install a custom copy of sqlite3)\n3. g++ and 10.9's cdefs.h header are currently incompatible, leading to a broken libstc++\n4. accelerate framework no longer pretends to be atlas for linking purposes\n\n---\n\nTo Apply:\n\n1. Apply [attachment:trac15433.patch] to the Sage Library repository\n2. [gcc-4.7.3.p1.spkg](http://boxen.math.washington.edu/home/ohanar/spkgs/gcc-4.7.3.p1.spkg)\n3. [sqlite-3.7.17.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sqlite-3.7.17.p1.spkg)\n4. [scipy-0.12.0.p1.spkg](http://boxen.math.washington.edu/home/ohanar/spkgs/scipy-0.12.0.p1.spkg)\n\nCC:  yomcat @jhpalmieri\n\nReviewer: Volker Braun\n\nAuthor: R. Andrew Ohana\n\nBranch: u/ohanar/10.9-port\n\nMerged: sage-5.13.rc0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15433\n\n",
    "closed_at": "2013-12-11T11:02:31Z",
    "created_at": "2013-11-18T07:50:05Z",
    "labels": [
        "component: porting",
        "blocker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Port to OSX 10.9",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15433",
    "user": "https://github.com/ohanar"
}
```
Sage fails to build on OSX 10.9.

Issues:

1. scipy doesn't play nicely with the new accelerate framework headers
2. R depends on CoreData which uses non-standard sqlite3 modules (and this affects us since we set `*_LIBRARY_PATH` and install a custom copy of sqlite3)
3. g++ and 10.9's cdefs.h header are currently incompatible, leading to a broken libstc++
4. accelerate framework no longer pretends to be atlas for linking purposes

---

To Apply:

1. Apply [attachment:trac15433.patch] to the Sage Library repository
2. [gcc-4.7.3.p1.spkg](http://boxen.math.washington.edu/home/ohanar/spkgs/gcc-4.7.3.p1.spkg)
3. [sqlite-3.7.17.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sqlite-3.7.17.p1.spkg)
4. [scipy-0.12.0.p1.spkg](http://boxen.math.washington.edu/home/ohanar/spkgs/scipy-0.12.0.p1.spkg)

CC:  yomcat @jhpalmieri

Reviewer: Volker Braun

Author: R. Andrew Ohana

Branch: u/ohanar/10.9-port

Merged: sage-5.13.rc0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15433





---

archive/issue_comments_194936.json:
```json
{
    "body": "<a id='comment:1'></a>The attached branch should fix everything except for the polybori issue. This should be checked on older OSX versions, since I've made some changes that are not 10.9 specific (I've checked these changes against bsd.math, and they work fine there).\n\nAs for the polybori issue, I'm not experiencing it anymore and I don't know what fixed it for me. I was going to setup a 10.9 VM, but unfortunately Apple refuses to let me download 10.9 on the machine I'm currently using -- however, I should be able to get a copy sometime in the few days.\n\nI will update spkgs/add mercurial patches if we can fix this in time for 5.13, but for now it is much easier for me to work off of the git version.",
    "created_at": "2013-11-18T08:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194936",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:1'></a>The attached branch should fix everything except for the polybori issue. This should be checked on older OSX versions, since I've made some changes that are not 10.9 specific (I've checked these changes against bsd.math, and they work fine there).

As for the polybori issue, I'm not experiencing it anymore and I don't know what fixed it for me. I was going to setup a 10.9 VM, but unfortunately Apple refuses to let me download 10.9 on the machine I'm currently using -- however, I should be able to get a copy sometime in the few days.

I will update spkgs/add mercurial patches if we can fix this in time for 5.13, but for now it is much easier for me to work off of the git version.



---

archive/issue_comments_194937.json:
```json
{
    "body": "<a id='comment:3'></a>I'm getting the following:\n\n```\n$ make\ncd build && \\\n\"../build/pipestatus\" \\\n\t\"env SAGE_PARALLEL_SPKG_BUILD='' ./install all 2>&1\" \\\n\t\"tee -a ../logs/install.log\"\n./install: line 503: syntax error near unexpected token `then'\n./install: line 503: `if { uname -sr | grep 'Darwin' } &>/dev/null; then'\nmake: *** [build] Error 2\n\n$ uname -sr\nLinux 3.11.7-200.fc19.x86_64\n```",
    "created_at": "2013-11-18T15:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194937",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>I'm getting the following:

```
$ make
cd build && \
"../build/pipestatus" \
	"env SAGE_PARALLEL_SPKG_BUILD='' ./install all 2>&1" \
	"tee -a ../logs/install.log"
./install: line 503: syntax error near unexpected token `then'
./install: line 503: `if { uname -sr | grep 'Darwin' } &>/dev/null; then'
make: *** [build] Error 2

$ uname -sr
Linux 3.11.7-200.fc19.x86_64
```



---

archive/issue_comments_194938.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-18T18:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194939.json:
```json
{
    "body": "<a id='comment:6'></a>Here's a stupid git question: what command do I give to check out this branch? I mean, if I'm on an OS X Mavericks system and I don't have a working copy of Sage with the git devel tools, I can't just do `./sage -dev \u2026`, but there must be some git command using the branch name or something. So what is it?",
    "created_at": "2013-11-19T00:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194939",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Here's a stupid git question: what command do I give to check out this branch? I mean, if I'm on an OS X Mavericks system and I don't have a working copy of Sage with the git devel tools, I can't just do `./sage -dev â€¦`, but there must be some git command using the branch name or something. So what is it?



---

archive/issue_comments_194940.json:
```json
{
    "body": "<a id='comment:7'></a>My guess about polybori, by the way, is that it was fixed by the changes to gcc.",
    "created_at": "2013-11-19T01:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194940",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>My guess about polybori, by the way, is that it was fixed by the changes to gcc.



---

archive/issue_comments_194941.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 jhpalmieri]:\n> Here's a stupid git question: what command do I give to check out this branch?\n\n\nAssuming you have git installed and in your path, you can do\n\n```\n$ git clone git://trac.sagemath.org/sage.git -b u/ohanar/10.9-port\n```\nto make a clone of the git repository, or if you already have a clone, you can do \n\n```\n$ git fetch git://trac.sagemath.org/sage.git u/ohanar/10.9-port\n$ git checkout -b u/ohanar/10.9-port FETCH_HEAD\n```\nfrom within the repository.",
    "created_at": "2013-11-19T01:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194941",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:8'></a>Replying to [comment:6 jhpalmieri]:
> Here's a stupid git question: what command do I give to check out this branch?


Assuming you have git installed and in your path, you can do

```
$ git clone git://trac.sagemath.org/sage.git -b u/ohanar/10.9-port
```
to make a clone of the git repository, or if you already have a clone, you can do 

```
$ git fetch git://trac.sagemath.org/sage.git u/ohanar/10.9-port
$ git checkout -b u/ohanar/10.9-port FETCH_HEAD
```
from within the repository.



---

archive/issue_comments_194942.json:
```json
{
    "body": "<a id='comment:9'></a>How do I resolve this problem?\n\n```\nsh: line 1: 59700 Trace/BPT trap: 5       /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk / -find ar 2> /dev/null\nar: error: unable to find utility \"ar\", not a developer tool or in PATH\nmake[3]: *** [libsymmetrica.a] Error 72\nmake[3]: Target `all' not remade because of errors.\nError building Symmetrica.\n```\nbecause I do see\n\n```\n-bash:/Applications/sage-5.13.beta1 $ /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk / -find ar\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ar\n-bash:/Applications/sage-5.13.beta1 $ echo $PATH\n.:/usr/bin:/bin:/usr/sbin\n```",
    "created_at": "2013-11-19T13:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194942",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:9'></a>How do I resolve this problem?

```
sh: line 1: 59700 Trace/BPT trap: 5       /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk / -find ar 2> /dev/null
ar: error: unable to find utility "ar", not a developer tool or in PATH
make[3]: *** [libsymmetrica.a] Error 72
make[3]: Target `all' not remade because of errors.
Error building Symmetrica.
```
because I do see

```
-bash:/Applications/sage-5.13.beta1 $ /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk / -find ar
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ar
-bash:/Applications/sage-5.13.beta1 $ echo $PATH
.:/usr/bin:/bin:/usr/sbin
```



---

archive/issue_comments_194943.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 zabrocki]:\n> How do I resolve this problem?\n\nLooks like more or less the same problem as polybori. That said, symmetrica was updated in 5.13.beta2, so you may want to see if you still experience the issue with a more recent beta.",
    "created_at": "2013-11-19T17:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194943",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:10'></a>Replying to [comment:9 zabrocki]:
> How do I resolve this problem?

Looks like more or less the same problem as polybori. That said, symmetrica was updated in 5.13.beta2, so you may want to see if you still experience the issue with a more recent beta.



---

archive/issue_comments_194944.json:
```json
{
    "body": "<a id='comment:11'></a>I don't know how the new build system works, but if you modify a file like `build/pkgs/gcc/spkg-install`, for example, should you also modify `build/pkgs/gcc/package-version.txt` so that the new version gets built? I have a version of Sage/git from early October, and when I cloned this branch and ran `make`, gcc was not rebuilt \u2014 it didn't even try, the log file was not modified \u2014 while scipy, for example, just returned the message `Package scipy-0.12.0.p0 is already installed.`\n\nBuilding the whole thing from scratch worked well, though, and all tests passed.\n\nRegarding the patch to gcc/spkg-install, for consistency's sake among other things, would it be a good idea to check the OS X version number the same way it's done in prereqs? That is, `DARWIN_VERSION=`uname -r | cut '-d.' -f1``?",
    "created_at": "2013-11-19T18:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194944",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>I don't know how the new build system works, but if you modify a file like `build/pkgs/gcc/spkg-install`, for example, should you also modify `build/pkgs/gcc/package-version.txt` so that the new version gets built? I have a version of Sage/git from early October, and when I cloned this branch and ran `make`, gcc was not rebuilt â€” it didn't even try, the log file was not modified â€” while scipy, for example, just returned the message `Package scipy-0.12.0.p0 is already installed.`

Building the whole thing from scratch worked well, though, and all tests passed.

Regarding the patch to gcc/spkg-install, for consistency's sake among other things, would it be a good idea to check the OS X version number the same way it's done in prereqs? That is, `DARWIN_VERSION=`uname -r | cut '-d.' -f1``?



---

archive/issue_comments_194945.json:
```json
{
    "body": "<a id='comment:12'></a>The directory name is `sage-5.13.beta1` is probably misleading since it is the name of the 'git' copy of sage.  I did a checkout of the branch and it stops at the end of the compile of symmetrica with a `make -k`.  If I just run `make` I don't get as far.",
    "created_at": "2013-11-19T18:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194945",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:12'></a>The directory name is `sage-5.13.beta1` is probably misleading since it is the name of the 'git' copy of sage.  I did a checkout of the branch and it stops at the end of the compile of symmetrica with a `make -k`.  If I just run `make` I don't get as far.



---

archive/issue_comments_194946.json:
```json
{
    "body": "<a id='comment:13'></a>I agree that gcc should have a patch version bump, but I don't think that scipy should: scipy issue is purely a build-time issue, unlike gcc's.\n\nFor `gcc/spkg-install` I just tried to be consistent with what was already there.",
    "created_at": "2013-11-19T18:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194946",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:13'></a>I agree that gcc should have a patch version bump, but I don't think that scipy should: scipy issue is purely a build-time issue, unlike gcc's.

For `gcc/spkg-install` I just tried to be consistent with what was already there.



---

archive/issue_comments_194947.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-19T18:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194948.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-19T23:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194948",
    "user": "https://github.com/ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194949.json:
```json
{
    "body": "<a id='comment:15'></a>jhpalmieri:\nthe change to gcc resolved the polybori and symmetrica issues on my second machine as well\n\nzabrocki:\ntry rebuilding with the latest commit\n\n\nI'm marking this as needs review, although if someone could test on OSX 10.4, that would be great.",
    "created_at": "2013-11-19T23:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194949",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:15'></a>jhpalmieri:
the change to gcc resolved the polybori and symmetrica issues on my second machine as well

zabrocki:
try rebuilding with the latest commit


I'm marking this as needs review, although if someone could test on OSX 10.4, that would be great.



---

archive/issue_comments_194950.json:
```json
{
    "body": "<a id='comment:16'></a>No issues at all building on 10.9 for me -- all test passed.",
    "created_at": "2013-11-19T23:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194950",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

<a id='comment:16'></a>No issues at all building on 10.9 for me -- all test passed.



---

archive/issue_comments_194951.json:
```json
{
    "body": "<a id='comment:17'></a>Andrew, you saved me again!  Brilliant!  It worked for me too.  Successful build and all tests pass.  I had only to `make all` because files compiled pre-fix were messing things up (or instead, I just untar'ed another copy and compiled that version).",
    "created_at": "2013-11-20T01:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194951",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:17'></a>Andrew, you saved me again!  Brilliant!  It worked for me too.  Successful build and all tests pass.  I had only to `make all` because files compiled pre-fix were messing things up (or instead, I just untar'ed another copy and compiled that version).



---

archive/issue_comments_194952.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-21T03:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194953.json:
```json
{
    "body": "<a id='comment:19'></a>Random remark: I would have put the logic for installing or not sqlite3 in the spkg-install script of sqlite3,  just as we do for cephes for example.",
    "created_at": "2013-11-23T10:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194953",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>Random remark: I would have put the logic for installing or not sqlite3 in the spkg-install script of sqlite3,  just as we do for cephes for example.



---

archive/issue_comments_194954.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 jpflori]:\n> Random remark: I would have put the logic for installing or not sqlite3 in the spkg-install script of sqlite3,  just as we do for cephes for example.\n\n\nAtlas also. That makes sense to me.",
    "created_at": "2013-11-23T16:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194954",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>Replying to [comment:19 jpflori]:
> Random remark: I would have put the logic for installing or not sqlite3 in the spkg-install script of sqlite3,  just as we do for cephes for example.


Atlas also. That makes sense to me.



---

archive/issue_comments_194955.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-24T02:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194955",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194956.json:
```json
{
    "body": "<a id='comment:22'></a>Now you also need to change the instructions in `src/bin/sage` about running `sage -i sqlite3`: that will have no effect on OS X. Note also that sqlite3 appears twice, once in `usage` and once in `usage_advanced`. Maybe\n\n```diff\ndiff --git a/src/bin/sage b/src/bin/sage\nindex 7eca9b0..df51f76 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n@@ -25,6 +25,7 @@ usage() {\n     echo \"  -python [...]       -- run the Python interpreter\"\n     echo \"  -R [...]            -- run Sage's R with given arguments\"\n     echo \"  -singular [...]     -- run Sage's singular with given arguments\"\n+    test -x \"$SAGE_LOCAL/bin/sqlite3\" || \\\n     echo \"  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments\"\n     echo \"  -root               -- print the Sage root directory\"\n     echo \"  --nodotsage         -- run Sage without using the user's .sage directory:\"\n@@ -102,9 +103,8 @@ usage_advanced() {\n     echo \"  -scons [...]        -- run Sage's scons\"\n     echo \"  -sh [...]           -- run \\$SHELL ($SHELL) with Sage environment variables\"\n     echo \"  -singular [...]     -- run Sage's singular with given arguments\"\n-    echo \"  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments\"\n     test -x \"$SAGE_LOCAL/bin/sqlite3\" || \\\n-    echo \"                         (not installed currently, run sage -i sqlite3)\"\n+    echo \"  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments\"\n     echo \"  -twistd [...]       -- run Twisted server\"\n \n     echo\n```\nOr you could do\n\n```diff\ndiff --git a/src/bin/sage b/src/bin/sage\nindex 7eca9b0..5be445b 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n@@ -26,6 +26,8 @@ usage() {\n     echo \"  -R [...]            -- run Sage's R with given arguments\"\n     echo \"  -singular [...]     -- run Sage's singular with given arguments\"\n     echo \"  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments\"\n+    test -x \"$SAGE_LOCAL/bin/sqlite3\" || \\\n+    echo \"                         (NOTE: not installed on OS X)\"\n     echo \"  -root               -- print the Sage root directory\"\n     echo \"  --nodotsage         -- run Sage without using the user's .sage directory:\"\n     echo \"                         create and use a temporary .sage directory instead\"\n@@ -104,7 +106,7 @@ usage_advanced() {\n     echo \"  -singular [...]     -- run Sage's singular with given arguments\"\n     echo \"  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments\"\n     test -x \"$SAGE_LOCAL/bin/sqlite3\" || \\\n-    echo \"                         (not installed currently, run sage -i sqlite3)\"\n+    echo \"                         (NOTE: not installed on OS X)\"\n     echo \"  -twistd [...]       -- run Twisted server\"\n \n     echo\n```",
    "created_at": "2013-11-24T03:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194956",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>Now you also need to change the instructions in `src/bin/sage` about running `sage -i sqlite3`: that will have no effect on OS X. Note also that sqlite3 appears twice, once in `usage` and once in `usage_advanced`. Maybe

```diff
diff --git a/src/bin/sage b/src/bin/sage
index 7eca9b0..df51f76 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -25,6 +25,7 @@ usage() {
     echo "  -python [...]       -- run the Python interpreter"
     echo "  -R [...]            -- run Sage's R with given arguments"
     echo "  -singular [...]     -- run Sage's singular with given arguments"
+    test -x "$SAGE_LOCAL/bin/sqlite3" || \
     echo "  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments"
     echo "  -root               -- print the Sage root directory"
     echo "  --nodotsage         -- run Sage without using the user's .sage directory:"
@@ -102,9 +103,8 @@ usage_advanced() {
     echo "  -scons [...]        -- run Sage's scons"
     echo "  -sh [...]           -- run \$SHELL ($SHELL) with Sage environment variables"
     echo "  -singular [...]     -- run Sage's singular with given arguments"
-    echo "  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments"
     test -x "$SAGE_LOCAL/bin/sqlite3" || \
-    echo "                         (not installed currently, run sage -i sqlite3)"
+    echo "  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments"
     echo "  -twistd [...]       -- run Twisted server"
 
     echo
```
Or you could do

```diff
diff --git a/src/bin/sage b/src/bin/sage
index 7eca9b0..5be445b 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -26,6 +26,8 @@ usage() {
     echo "  -R [...]            -- run Sage's R with given arguments"
     echo "  -singular [...]     -- run Sage's singular with given arguments"
     echo "  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments"
+    test -x "$SAGE_LOCAL/bin/sqlite3" || \
+    echo "                         (NOTE: not installed on OS X)"
     echo "  -root               -- print the Sage root directory"
     echo "  --nodotsage         -- run Sage without using the user's .sage directory:"
     echo "                         create and use a temporary .sage directory instead"
@@ -104,7 +106,7 @@ usage_advanced() {
     echo "  -singular [...]     -- run Sage's singular with given arguments"
     echo "  -sqlite3 [...]      -- run Sage's sqlite3 with given arguments"
     test -x "$SAGE_LOCAL/bin/sqlite3" || \
-    echo "                         (not installed currently, run sage -i sqlite3)"
+    echo "                         (NOTE: not installed on OS X)"
     echo "  -twistd [...]       -- run Twisted server"
 
     echo
```



---

archive/issue_comments_194957.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-24T05:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194958.json:
```json
{
    "body": "<a id='comment:24'></a>Would it be a good idea on OS X to create a symlink at `local/bin/sqlite3` pointing to `/usr/bin/sqlite3` (or whatever the output of `command -v sqlite3` is)? Then `sage --sqlite3` would still work.",
    "created_at": "2013-11-26T19:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194958",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>Would it be a good idea on OS X to create a symlink at `local/bin/sqlite3` pointing to `/usr/bin/sqlite3` (or whatever the output of `command -v sqlite3` is)? Then `sage --sqlite3` would still work.



---

archive/issue_comments_194959.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 jhpalmieri]:\n> Would it be a good idea on OS X to create a symlink at `local/bin/sqlite3` pointing to `/usr/bin/sqlite3` (or whatever the output of `command -v sqlite3` is)? Then `sage --sqlite3` would still work.\n\n\nSee trac #12627 which would fix this.",
    "created_at": "2013-11-26T19:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194959",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:25'></a>Replying to [comment:24 jhpalmieri]:
> Would it be a good idea on OS X to create a symlink at `local/bin/sqlite3` pointing to `/usr/bin/sqlite3` (or whatever the output of `command -v sqlite3` is)? Then `sage --sqlite3` would still work.


See trac #12627 which would fix this.



---

archive/issue_comments_194960.json:
```json
{
    "body": "<a id='comment:26'></a>As I noted at #12627, that ticket is somewhat controversial, and I'm not sure it's a good idea to get it merged soon. Something much more targeted, like making a symlink for sqlite3 only on OS X, seems more palatable.",
    "created_at": "2013-11-26T19:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194960",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>As I noted at #12627, that ticket is somewhat controversial, and I'm not sure it's a good idea to get it merged soon. Something much more targeted, like making a symlink for sqlite3 only on OS X, seems more palatable.



---

archive/issue_comments_194961.json:
```json
{
    "body": "<a id='comment:27'></a>REMARKS:\n\n* In build/pkgs/gcc/spkg-install and build/pkgs/sqlite/spkg-install \u00b6, change \"OSX 10.9\" to \"OS X 10.9\".   Also \"posed\" --> \"posted\".\n\n* If trac #12627 gets in (which it should if rebased), then this would be deleted:\n\n```\n if test -x \"$SAGE_LOCAL/bin/sqlite3\" && [ \"$1\" = '-sqlite3' -o \"$1\" = '--sqlite3' ]; then \n```\n\nI am for having #12627 merged, since I can easily imagine users, scripts, workflows, whatever that have \"sage --sqlite3\" in them, and would be broken by the above change.\n\nModulo testing (on 10.4, 10.5, 10.6, 10.7, 10.8, 10.9), and the above comment regarding #12627, I think this patch looks excellent.",
    "created_at": "2013-11-26T19:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194961",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:27'></a>REMARKS:

* In build/pkgs/gcc/spkg-install and build/pkgs/sqlite/spkg-install Â¶, change "OSX 10.9" to "OS X 10.9".   Also "posed" --> "posted".

* If trac #12627 gets in (which it should if rebased), then this would be deleted:

```
 if test -x "$SAGE_LOCAL/bin/sqlite3" && [ "$1" = '-sqlite3' -o "$1" = '--sqlite3' ]; then 
```

I am for having #12627 merged, since I can easily imagine users, scripts, workflows, whatever that have "sage --sqlite3" in them, and would be broken by the above change.

Modulo testing (on 10.4, 10.5, 10.6, 10.7, 10.8, 10.9), and the above comment regarding #12627, I think this patch looks excellent.



---

archive/issue_comments_194962.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 jhpalmieri]:\n> As I noted at #12627, that ticket is somewhat controversial, and I'm not sure it's a good idea to get it merged soon. Something much more targeted, like making a symlink for sqlite3 only on OS X, seems more palatable.\n\n\nOK, good point -- symlinking temporarily seems reasonable, since fully supporting OS X 10.9 asap is important.",
    "created_at": "2013-11-26T19:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194962",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:28'></a>Replying to [comment:26 jhpalmieri]:
> As I noted at #12627, that ticket is somewhat controversial, and I'm not sure it's a good idea to get it merged soon. Something much more targeted, like making a symlink for sqlite3 only on OS X, seems more palatable.


OK, good point -- symlinking temporarily seems reasonable, since fully supporting OS X 10.9 asap is important.



---

archive/issue_comments_194963.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-26T19:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194964.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-26T19:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194965.json:
```json
{
    "body": "Attachment [trac15433.patch](tarball://root/attachments/some-uuid/ticket15433/trac15433.patch) by @ohanar created at 2013-11-27 06:43:43",
    "created_at": "2013-11-27T06:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194965",
    "user": "https://github.com/ohanar"
}
```

Attachment [trac15433.patch](tarball://root/attachments/some-uuid/ticket15433/trac15433.patch) by @ohanar created at 2013-11-27 06:43:43



---

archive/issue_comments_194966.json:
```json
{
    "body": "<a id='comment:31'></a>Ok, since this seems to be all but positively reviewed now, I've backported this to mercurial land.",
    "created_at": "2013-11-27T06:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194966",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:31'></a>Ok, since this seems to be all but positively reviewed now, I've backported this to mercurial land.



---

archive/issue_comments_194967.json:
```json
{
    "body": "<a id='comment:32'></a>I've had a quick look at the git branch and it seems fine.\nCould you please attach the spkg diffs to ease review?",
    "created_at": "2013-11-27T09:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194967",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:32'></a>I've had a quick look at the git branch and it seems fine.
Could you please attach the spkg diffs to ease review?



---

archive/issue_comments_194968.json:
```json
{
    "body": "Attachment [gcc-4.7.3.p1.diff](tarball://root/attachments/some-uuid/ticket15433/gcc-4.7.3.p1.diff) by @ohanar created at 2013-11-27 19:51:59\n\nfor review purposes",
    "created_at": "2013-11-27T19:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194968",
    "user": "https://github.com/ohanar"
}
```

Attachment [gcc-4.7.3.p1.diff](tarball://root/attachments/some-uuid/ticket15433/gcc-4.7.3.p1.diff) by @ohanar created at 2013-11-27 19:51:59

for review purposes



---

archive/issue_comments_194969.json:
```json
{
    "body": "for review purposes",
    "created_at": "2013-11-27T19:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194969",
    "user": "https://github.com/ohanar"
}
```

for review purposes



---

archive/issue_comments_194970.json:
```json
{
    "body": "<a id='comment:33'></a>Attachment [scipy-0.12.0.p1.diff](tarball://root/attachments/some-uuid/ticket15433/scipy-0.12.0.p1.diff) by @ohanar created at 2013-11-27 19:53:35\n\nReplying to [comment:32 jpflori]:\n> I've had a quick look at the git branch and it seems fine.\n> Could you please attach the spkg diffs to ease review?\n\nDone.",
    "created_at": "2013-11-27T19:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194970",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:33'></a>Attachment [scipy-0.12.0.p1.diff](tarball://root/attachments/some-uuid/ticket15433/scipy-0.12.0.p1.diff) by @ohanar created at 2013-11-27 19:53:35

Replying to [comment:32 jpflori]:
> I've had a quick look at the git branch and it seems fine.
> Could you please attach the spkg diffs to ease review?

Done.



---

archive/issue_comments_194971.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-28T21:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194971",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194972.json:
```json
{
    "body": "<a id='comment:34'></a>I've tested it on the buildbot and it doesn't impact other arches. Presumably it does the trick on OSX 10.9, so we should ship it asap.",
    "created_at": "2013-11-28T21:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194972",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>I've tested it on the buildbot and it doesn't impact other arches. Presumably it does the trick on OSX 10.9, so we should ship it asap.



---

archive/issue_comments_194973.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 vbraun]:\n> Presumably it does the trick on OSX 10.9, so we should ship it asap.\n\nI can confirm that it does indeed do the trick on Mavericks.",
    "created_at": "2013-11-28T21:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194973",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

<a id='comment:35'></a>Replying to [comment:34 vbraun]:
> Presumably it does the trick on OSX 10.9, so we should ship it asap.

I can confirm that it does indeed do the trick on Mavericks.



---

archive/issue_comments_194974.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-12-04T17:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194974",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_194975.json:
```json
{
    "body": "<a id='comment:36'></a>When upgrading from older versions of Sage on OS X:\n\n```\nsage -t --long devel/sage/sage/tests/cmdline.py\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 595, in sage.tests.cmdline.test_executable\nFailed example:\n    out.startswith(\"3.\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 597, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    'dyld: Library not loaded: /Users/buildbot/build/sage/bsd-1/bsd_64_upgrade/sage-4.6.2/local/lib/libreadline.6.1.dylib\\n  Referenced from: /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.13.rc0/local/bin/sqlite3\\n  Reason: image not found\\n'\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 599, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    -5\n**********************************************************************\n```",
    "created_at": "2013-12-04T17:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194975",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>When upgrading from older versions of Sage on OS X:

```
sage -t --long devel/sage/sage/tests/cmdline.py
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 595, in sage.tests.cmdline.test_executable
Failed example:
    out.startswith("3.")
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 597, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    'dyld: Library not loaded: /Users/buildbot/build/sage/bsd-1/bsd_64_upgrade/sage-4.6.2/local/lib/libreadline.6.1.dylib\n  Referenced from: /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.13.rc0/local/bin/sqlite3\n  Reason: image not found\n'
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 599, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    -5
**********************************************************************
```



---

archive/issue_comments_194976.json:
```json
{
    "body": "<a id='comment:37'></a>Does the sqlite3 issue appear also on OS X < 10.9 systems? If not, then can we keep building sqlite3 on those systems and only skip it for OS X 10.9?",
    "created_at": "2013-12-04T17:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194976",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>Does the sqlite3 issue appear also on OS X < 10.9 systems? If not, then can we keep building sqlite3 on those systems and only skip it for OS X 10.9?



---

archive/issue_comments_194977.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2013-12-05T08:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194977",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_194978.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 jdemeyer]:\n> Does the sqlite3 issue appear also on OS X < 10.9 systems? If not, then can we keep building sqlite3 on those systems and only skip it for OS X 10.9?\n\n\nI don't think so, although only doing it for >= 10.9 seems dangerous as I could easily see apple changing one of their libraries that r uses in a minor update.",
    "created_at": "2013-12-05T08:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194978",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:39'></a>Replying to [comment:37 jdemeyer]:
> Does the sqlite3 issue appear also on OS X < 10.9 systems? If not, then can we keep building sqlite3 on those systems and only skip it for OS X 10.9?


I don't think so, although only doing it for >= 10.9 seems dangerous as I could easily see apple changing one of their libraries that r uses in a minor update.



---

archive/issue_comments_194979.json:
```json
{
    "body": "<a id='comment:40'></a>Or we could check whether `sqlite` already exists and is not a symbolic link:\n\n```\nif [ -x \"$SAGE_LOCAL/bin/sqlite3\" -a ! -h \"$SAGE_LOCAL/bin/sqlite3\" ]; then\n    # Install sqlite3 anyway\nfi\n```",
    "created_at": "2013-12-05T09:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194979",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>Or we could check whether `sqlite` already exists and is not a symbolic link:

```
if [ -x "$SAGE_LOCAL/bin/sqlite3" -a ! -h "$SAGE_LOCAL/bin/sqlite3" ]; then
    # Install sqlite3 anyway
fi
```



---

archive/issue_comments_194980.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-06T04:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194980",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194981.json:
```json
{
    "body": "<a id='comment:41'></a>ok, updated the sqlite spkg, it should now gracefully handle upgrading.",
    "created_at": "2013-12-06T04:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194981",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:41'></a>ok, updated the sqlite spkg, it should now gracefully handle upgrading.



---

archive/issue_comments_194982.json:
```json
{
    "body": "<a id='comment:42'></a>Looks good on first sight, I will test it on the buildbots and set positive_review if that works.",
    "created_at": "2013-12-06T10:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194982",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>Looks good on first sight, I will test it on the buildbots and set positive_review if that works.



---

archive/issue_comments_194983.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-06T23:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194983",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194984.json:
```json
{
    "body": "<a id='comment:43'></a>On OS X 10.4, this causes essentially every doctest involving databases to fail, for example\n\n```\nsage -t --long devel/sage/doc/en/tutorial/tour_advanced.rst\n**********************************************************************\nFile \"devel/sage/doc/en/tutorial/tour_advanced.rst\", line 251, in doc.en.tutorial.tour_advanced\nFailed example:\n    db.curves(37)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest doc.en.tutorial.tour_advanced[1]>\", line 1, in <module>\n        db.curves(Integer(37))\n      File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/databases/cremona.py\", line 769, in curves\n        + 'curve=class||1 AND conductor=?',(int(N),)):\n    OperationalError: ambiguous column name: class\n**********************************************************************\n```",
    "created_at": "2013-12-06T23:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194984",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>On OS X 10.4, this causes essentially every doctest involving databases to fail, for example

```
sage -t --long devel/sage/doc/en/tutorial/tour_advanced.rst
**********************************************************************
File "devel/sage/doc/en/tutorial/tour_advanced.rst", line 251, in doc.en.tutorial.tour_advanced
Failed example:
    db.curves(37)
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest doc.en.tutorial.tour_advanced[1]>", line 1, in <module>
        db.curves(Integer(37))
      File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/databases/cremona.py", line 769, in curves
        + 'curve=class||1 AND conductor=?',(int(N),)):
    OperationalError: ambiguous column name: class
**********************************************************************
```



---

archive/issue_comments_194985.json:
```json
{
    "body": "<a id='comment:44'></a>So maybe we *should* only use the system sqlite3 on OS X 10.9 and above?",
    "created_at": "2013-12-06T23:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194985",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>So maybe we *should* only use the system sqlite3 on OS X 10.9 and above?



---

archive/issue_comments_194986.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-08T01:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194986",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194987.json:
```json
{
    "body": "<a id='comment:45'></a>Ok, I've modified the spkg so it only uses the system sqlite on 10.9 and above",
    "created_at": "2013-12-08T01:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194987",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:45'></a>Ok, I've modified the spkg so it only uses the system sqlite on 10.9 and above



---

archive/issue_comments_194988.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-08T08:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194988",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194989.json:
```json
{
    "body": "<a id='comment:46'></a>You probably didn't mean to remove\n\n```\n# Old OS X systems need -DSQLITE_WITHOUT_ZONEMALLOC\nif uname -sr |grep 'Darwin [0-8][.]' >/dev/null; then\n    export CPPFLAGS=\"$CPPFLAGS -DSQLITE_WITHOUT_ZONEMALLOC\"\nfi\n```",
    "created_at": "2013-12-08T08:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194989",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'></a>You probably didn't mean to remove

```
# Old OS X systems need -DSQLITE_WITHOUT_ZONEMALLOC
if uname -sr |grep 'Darwin [0-8][.]' >/dev/null; then
    export CPPFLAGS="$CPPFLAGS -DSQLITE_WITHOUT_ZONEMALLOC"
fi
```



---

archive/issue_comments_194990.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-09T10:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194990",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194991.json:
```json
{
    "body": "Attachment [sqlite-3.7.17.p1.diff](tarball://root/attachments/some-uuid/ticket15433/sqlite-3.7.17.p1.diff) by @jdemeyer created at 2013-12-09 10:02:56",
    "created_at": "2013-12-09T10:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194991",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [sqlite-3.7.17.p1.diff](tarball://root/attachments/some-uuid/ticket15433/sqlite-3.7.17.p1.diff) by @jdemeyer created at 2013-12-09 10:02:56



---

archive/issue_comments_194992.json:
```json
{
    "body": "<a id='comment:48'></a>Sorry, busy week. Yes, this looks fine to me.",
    "created_at": "2013-12-09T23:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194992",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:48'></a>Sorry, busy week. Yes, this looks fine to me.



---

archive/issue_comments_194993.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-09T23:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194993",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_044967.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15433#event-44967"
}
```



---

archive/issue_comments_194994.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-11T11:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194994",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_194995.json:
```json
{
    "body": "<a id='comment:50'></a>* **Status** changed from *closed* to *needs_work*\n\nFor the record, according to [http://trac.macports.org/ticket/41033#comment:24](http://trac.macports.org/ticket/41033#comment:24), the `cdefs.h` bug has been fixed in Xcode 5.1.\n\nFurthermore, there's no check whether the file exists at all, and `set -e` is used...",
    "created_at": "2014-05-13T11:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194995",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'></a>* **Status** changed from *closed* to *needs_work*

For the record, according to [http://trac.macports.org/ticket/41033#comment:24](http://trac.macports.org/ticket/41033#comment:24), the `cdefs.h` bug has been fixed in Xcode 5.1.

Furthermore, there's no check whether the file exists at all, and `set -e` is used...



---

archive/issue_comments_194996.json:
```json
{
    "body": "<a id='comment:51'></a>cdefs.h should be part of the commandline tools. The only bug is that we don't diagnose the absence of the command line tools in a better way. Also, this ticket is closed. Open a new one.",
    "created_at": "2014-05-13T12:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194996",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:51'></a>cdefs.h should be part of the commandline tools. The only bug is that we don't diagnose the absence of the command line tools in a better way. Also, this ticket is closed. Open a new one.



---

archive/issue_comments_194997.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 vbraun]:\n> cdefs.h should be part of the commandline tools. The only bug is that we don't diagnose the absence of the command line tools in a better way.\n\n\nYeah, and it probably should be checked whether the fix is still necessary.\n\n> Also, this ticket is closed.\n\n\nReally?\n\n> Open a new one. \n\n\nSelber.",
    "created_at": "2014-05-13T12:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194997",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>Replying to [comment:51 vbraun]:
> cdefs.h should be part of the commandline tools. The only bug is that we don't diagnose the absence of the command line tools in a better way.


Yeah, and it probably should be checked whether the fix is still necessary.

> Also, this ticket is closed.


Really?

> Open a new one. 


Selber.



---

archive/issue_comments_194998.json:
```json
{
    "body": "<a id='comment:53'></a>P.S.:  The top-level `configure` should check for the presence of Xcode's command line tools on Darwin, shouldn't it?",
    "created_at": "2014-05-13T12:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15433#issuecomment-194998",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'></a>P.S.:  The top-level `configure` should check for the presence of Xcode's command line tools on Darwin, shouldn't it?
