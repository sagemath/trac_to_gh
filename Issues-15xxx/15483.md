# Issue 15483: Simon 2-descent gives RuntimeError for an elliptic curve over a quadratic field

archive/issues_015246.json:
```json
{
    "body": "[See #15608 for a list of open simon_two_descent tickets]\n\nThe following tries to do 2-descent on an elliptic curve over a quadratic field:\n\n```\nK.<s>=QuadraticField(229)\nc4=2173-235*(1-s)/2\nc6=-124369+15988*(1-s)/2\nE=EllipticCurve([-c4/48,-c6/864])\nE.simon_two_descent()\n```\nIt fails with a `RuntimeError`:\n\n```\nTraceback (most recent call last):\n...\nRuntimeError: \n  ***   at top-level: ans=bnfellrank(K,[0,0,0,\n  ***                     ^--------------------\n  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=\n  ***   bnfell2descent_gen(b\n  ***   ^--------------------\n  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))\n  ***   [1];if(DEBUGLEVEL_el\n  ***   ^--------------------\n  ***   array index (1) out of allowed range [none].\nAn error occurred while running Simon's 2-descent program\n```\nThe problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see comment:7 below.\n\n\nCC:  @JohnCremona\n\nKeywords: simon_two_descent\n\nBranch/Commit: b662aba98ad4122a82fc135cf9b5dbf58de2ba0e\n\nUpstream: Workaround found; Bug reported upstream.\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nDependencies: #11005\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15483\n\n",
    "closed_at": "2014-02-27T21:28:50Z",
    "created_at": "2013-12-04T17:43:29Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Simon 2-descent gives RuntimeError for an elliptic curve over a quadratic field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15483",
    "user": "https://github.com/pjbruin"
}
```
[See #15608 for a list of open simon_two_descent tickets]

The following tries to do 2-descent on an elliptic curve over a quadratic field:

```
K.<s>=QuadraticField(229)
c4=2173-235*(1-s)/2
c6=-124369+15988*(1-s)/2
E=EllipticCurve([-c4/48,-c6/864])
E.simon_two_descent()
```
It fails with a `RuntimeError`:

```
Traceback (most recent call last):
...
RuntimeError: 
  ***   at top-level: ans=bnfellrank(K,[0,0,0,
  ***                     ^--------------------
  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=
  ***   bnfell2descent_gen(b
  ***   ^--------------------
  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))
  ***   [1];if(DEBUGLEVEL_el
  ***   ^--------------------
  ***   array index (1) out of allowed range [none].
An error occurred while running Simon's 2-descent program
```
The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see comment:7 below.


CC:  @JohnCremona

Keywords: simon_two_descent

Branch/Commit: b662aba98ad4122a82fc135cf9b5dbf58de2ba0e

Upstream: Workaround found; Bug reported upstream.

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Dependencies: #11005

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15483





---

archive/issue_comments_247060.json:
```json
{
    "body": "<a id='comment:1'></a>There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).\n\nSeveral of us spend hours or even days in 2011 sage Days (more than one) working on this sort of thing and gave up.  We were trying to do more, namely rewrite the interface so that it can use a gp2c-compiled version of the scripts.  One day I'll have another go at that.\n\nMeanwhile, this entry is to make sure that no-one wastes any time at all looking into the versions of the scripts which Sage currently includes;  you should test against the current versions.",
    "created_at": "2013-12-04T19:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247060",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).

Several of us spend hours or even days in 2011 sage Days (more than one) working on this sort of thing and gave up.  We were trying to do more, namely rewrite the interface so that it can use a gp2c-compiled version of the scripts.  One day I'll have another go at that.

Meanwhile, this entry is to make sure that no-one wastes any time at all looking into the versions of the scripts which Sage currently includes;  you should test against the current versions.



---

archive/issue_comments_247061.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,6 +28,8 @@\n \n The bug is not fixed by first changing to an integral model.\n \n+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/15483\n``````\n",
    "created_at": "2013-12-04T21:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247061",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,6 +28,8 @@
 
 The bug is not fixed by first changing to an integral model.
 
+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/15483
``````




---

archive/issue_comments_247062.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 cremona]:\n> There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).\n\n\nI searched for other tickets related to Simon's code and did not find reports of this particular problem.  We should first upgrade to the latest version of his script and then see which of the various problems listed at #11041 persist.  I added this ticket to that list for easier reference.",
    "created_at": "2013-12-04T21:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247062",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>Replying to [comment:1 cremona]:
> There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).


I searched for other tickets related to Simon's code and did not find reports of this particular problem.  We should first upgrade to the latest version of his script and then see which of the various problems listed at #11041 persist.  I added this ticket to that list for easier reference.



---

archive/issue_comments_247063.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2013-12-27T23:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247063",
    "user": "https://github.com/categorie"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_comments_247064.json:
```json
{
    "body": "<a id='comment:3'></a>Lorenzini reported me a similar bug and I had a look. I now believe that this is a bug in Simon's script as I can reproduce it outside sage. I used the version of his file dated 06/04/2011, which is the newest I found on the web, while sage has one dated the 25/03/2009. So besides that bug, the file needs to be updated anyway. I tried both in sage's gp (2.5.5) and the current alpha (2.6.1).\n\nI send an email to Denis and see if and how fast we can hope for a solution of this. Otherwise, I may at least update the script, later.\n\nLorenzini's example is a bit simpler:\n\n```\nR.<t> = QQ[]\nL.<g> = NumberField(t^3 - 9*t^2 + 13*t - 4)\nE1 = EllipticCurve(L,[1-g*(g-1),-g^2*(g-1),-g^2*(g-1),0,0])\nE1.rank()\n```",
    "created_at": "2013-12-27T23:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247064",
    "user": "https://github.com/categorie"
}
```

<a id='comment:3'></a>Lorenzini reported me a similar bug and I had a look. I now believe that this is a bug in Simon's script as I can reproduce it outside sage. I used the version of his file dated 06/04/2011, which is the newest I found on the web, while sage has one dated the 25/03/2009. So besides that bug, the file needs to be updated anyway. I tried both in sage's gp (2.5.5) and the current alpha (2.6.1).

I send an email to Denis and see if and how fast we can hope for a solution of this. Otherwise, I may at least update the script, later.

Lorenzini's example is a bit simpler:

```
R.<t> = QQ[]
L.<g> = NumberField(t^3 - 9*t^2 + 13*t - 4)
E1 = EllipticCurve(L,[1-g*(g-1),-g^2*(g-1),-g^2*(g-1),0,0])
E1.rank()
```



---

archive/issue_comments_247065.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,36 @@\n+[See #15608 for a list of open simon_two_descent tickets]\n \n+The following tries to do 2-descent on an elliptic curve over a quadratic field:\n+\n+```\n+K.<s>=QuadraticField(229)\n+c4=2173-235*(1-s)/2\n+c6=-124369+15988*(1-s)/2\n+E=EllipticCurve([-c4/48,-c6/864])\n+E.simon_two_descent()\n+```\n+It fails with a `RuntimeError`:\n+\n+```\n+Traceback (most recent call last):\n+...\n+RuntimeError: \n+  ***   at top-level: ans=bnfellrank(K,[0,0,0,\n+  ***                     ^--------------------\n+  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=\n+  ***   bnfell2descent_gen(b\n+  ***   ^--------------------\n+  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))\n+  ***   [1];if(DEBUGLEVEL_el\n+  ***   ^--------------------\n+  ***   array index (1) out of allowed range [none].\n+An error occurred while running Simon's 2-descent program\n+```\n+It appears that a certain number field element is expected to be a square, but in fact isn't.\n+\n+The bug is not fixed by first changing to an integral model.\n+\n+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-12-30T16:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247065",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,36 @@
+[See #15608 for a list of open simon_two_descent tickets]
 
+The following tries to do 2-descent on an elliptic curve over a quadratic field:
+
+```
+K.<s>=QuadraticField(229)
+c4=2173-235*(1-s)/2
+c6=-124369+15988*(1-s)/2
+E=EllipticCurve([-c4/48,-c6/864])
+E.simon_two_descent()
+```
+It fails with a `RuntimeError`:
+
+```
+Traceback (most recent call last):
+...
+RuntimeError: 
+  ***   at top-level: ans=bnfellrank(K,[0,0,0,
+  ***                     ^--------------------
+  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=
+  ***   bnfell2descent_gen(b
+  ***   ^--------------------
+  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))
+  ***   [1];if(DEBUGLEVEL_el
+  ***   ^--------------------
+  ***   array index (1) out of allowed range [none].
+An error occurred while running Simon's 2-descent program
+```
+It appears that a certain number field element is expected to be a square, but in fact isn't.
+
+The bug is not fixed by first changing to an integral model.
+
+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.
 
 Comment: 1
 
``````




---

archive/issue_events_045178.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15483#event-45178"
}
```



---

archive/issue_comments_247066.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#11005\"",
    "created_at": "2014-02-11T19:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247066",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#11005"



---

archive/issue_comments_247067.json:
```json
{
    "body": "<a id='comment:6'></a>The problem still exists after #11005, which upgrades Simon's script to the latest version.",
    "created_at": "2014-02-11T19:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247067",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'></a>The problem still exists after #11005, which upgrades Simon's script to the latest version.



---

archive/issue_comments_247068.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+[See #15608 for a list of open simon_two_descent tickets]\n+\n+The following tries to do 2-descent on an elliptic curve over a quadratic field:\n+\n+```\n+K.<s>=QuadraticField(229)\n+c4=2173-235*(1-s)/2\n+c6=-124369+15988*(1-s)/2\n+E=EllipticCurve([-c4/48,-c6/864])\n+E.simon_two_descent()\n+```\n+It fails with a `RuntimeError`:\n+\n+```\n+Traceback (most recent call last):\n+...\n+RuntimeError: \n+  ***   at top-level: ans=bnfellrank(K,[0,0,0,\n+  ***                     ^--------------------\n+  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=\n+  ***   bnfell2descent_gen(b\n+  ***   ^--------------------\n+  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))\n+  ***   [1];if(DEBUGLEVEL_el\n+  ***   ^--------------------\n+  ***   array index (1) out of allowed range [none].\n+An error occurred while running Simon's 2-descent program\n+```\n+The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see comment:7 below.\n \n \n Comment: 1\n``````\n",
    "created_at": "2014-02-12T10:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247068",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,32 @@
+[See #15608 for a list of open simon_two_descent tickets]
+
+The following tries to do 2-descent on an elliptic curve over a quadratic field:
+
+```
+K.<s>=QuadraticField(229)
+c4=2173-235*(1-s)/2
+c6=-124369+15988*(1-s)/2
+E=EllipticCurve([-c4/48,-c6/864])
+E.simon_two_descent()
+```
+It fails with a `RuntimeError`:
+
+```
+Traceback (most recent call last):
+...
+RuntimeError: 
+  ***   at top-level: ans=bnfellrank(K,[0,0,0,
+  ***                     ^--------------------
+  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=
+  ***   bnfell2descent_gen(b
+  ***   ^--------------------
+  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))
+  ***   [1];if(DEBUGLEVEL_el
+  ***   ^--------------------
+  ***   array index (1) out of allowed range [none].
+An error occurred while running Simon's 2-descent program
+```
+The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see comment:7 below.
 
 
 Comment: 1
``````




---

archive/issue_comments_247069.json:
```json
{
    "body": "<a id='comment:7'></a>It seems that the bug is caused by a precision problem in `subst`, called by `nfrealsign` in `ell.gp`.  The following GP input demonstrates this (using the latest version of `ell.gp`, see #11005):\n\n```\n\\r src/ext/pari/simon/ell.gp\nb = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320\na = Mod(b, y^2 - 229);\n\\p 38                    \\\\ default precision\nK = bnfinit(y^2 - 229);\nnfrealsign(K, a, 1)      \\\\ result: 1\nnfrealsign(K, a, 2)      \\\\ result: -1  (wrong)\nsubst(b, y, K.roots[2])  \\\\ result: -7.695704335233296721 E112, incorrect to this precision\n\\p 500                   \\\\ increase precision\nK = bnfinit(y^2 - 229);\nnfrealsign(K, a, 1)      \\\\ result: 1\nnfrealsign(K, a, 2)      \\\\ result: 1\nsubst(b, y, K.roots[2])  \\\\ result: 55550556624985845118007242443189926820306719407.796355955086894963616120700422308457186069825115395206111444495243228840597412527828358943327267422898011087182852030228685210492253493260963313348652457717717703991690402543456279919008587884729307897541432624377818611055431792706380900043638904108307170236335925883131494247446074384269328376967381902948861789570537169455258630011202296209679102466188417\n```\nThe value of `K.roots` does not seem to be the problem; the roots are calculated correctly to the requested precision.",
    "created_at": "2014-02-12T10:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247069",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>It seems that the bug is caused by a precision problem in `subst`, called by `nfrealsign` in `ell.gp`.  The following GP input demonstrates this (using the latest version of `ell.gp`, see #11005):

```
\r src/ext/pari/simon/ell.gp
b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320
a = Mod(b, y^2 - 229);
\p 38                    \\ default precision
K = bnfinit(y^2 - 229);
nfrealsign(K, a, 1)      \\ result: 1
nfrealsign(K, a, 2)      \\ result: -1  (wrong)
subst(b, y, K.roots[2])  \\ result: -7.695704335233296721 E112, incorrect to this precision
\p 500                   \\ increase precision
K = bnfinit(y^2 - 229);
nfrealsign(K, a, 1)      \\ result: 1
nfrealsign(K, a, 2)      \\ result: 1
subst(b, y, K.roots[2])  \\ result: 55550556624985845118007242443189926820306719407.796355955086894963616120700422308457186069825115395206111444495243228840597412527828358943327267422898011087182852030228685210492253493260963313348652457717717703991690402543456279919008587884729307897541432624377818611055431792706380900043638904108307170236335925883131494247446074384269328376967381902948861789570537169455258630011202296209679102466188417
```
The value of `K.roots` does not seem to be the problem; the roots are calculated correctly to the requested precision.



---

archive/issue_comments_247070.json:
```json
{
    "body": "<a id='comment:8'></a>The basic problem seems to be that PARI is too optimistic about the resulting precision when adding real numbers:\n\n```\n? b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320\n? K = bnfinit(y^2 - 229);\n? u=polcoeff(b,1)*K.roots[2]\n%167 = -2.3524523971732905757341977352314040726 E151\n? v=polcoeff(b,0)*1.\n%168 = 2.3524523971732905757341977352314040726 E151\n? u+v\n%169 = -7.695704335233296721 E112\n? precision(u)\n%170 = 38\n? precision(v)\n%171 = 38\n? precision(u+v)\n%172 = 19\n```",
    "created_at": "2014-02-12T11:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247070",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>The basic problem seems to be that PARI is too optimistic about the resulting precision when adding real numbers:

```
? b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320
? K = bnfinit(y^2 - 229);
? u=polcoeff(b,1)*K.roots[2]
%167 = -2.3524523971732905757341977352314040726 E151
? v=polcoeff(b,0)*1.
%168 = 2.3524523971732905757341977352314040726 E151
? u+v
%169 = -7.695704335233296721 E112
? precision(u)
%170 = 38
? precision(v)
%171 = 38
? precision(u+v)
%172 = 19
```



---

archive/issue_comments_247071.json:
```json
{
    "body": "<a id='comment:9'></a>E-mailed `pari-dev` and Denis Simon about the precision issue, also suggesting a quick fix for `ell.gp`.",
    "created_at": "2014-02-12T12:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247071",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>E-mailed `pari-dev` and Denis Simon about the precision issue, also suggesting a quick fix for `ell.gp`.



---

archive/issue_comments_247072.json:
```json
{
    "body": "Changing upstream from \"Not yet reported upstream; Will do shortly.\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2014-02-12T12:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247072",
    "user": "https://github.com/pjbruin"
}
```

Changing upstream from "Not yet reported upstream; Will do shortly." to "Reported upstream. No feedback yet."



---

archive/issue_comments_247073.json:
```json
{
    "body": "<a id='comment:10'></a>The quick fix is to increase the bound in the precision check in `nfrealsign` from 10 digits to 38 digits (128 bits).  This at least makes the error in my example and that reported by Lorenzini disappear.",
    "created_at": "2014-02-12T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247073",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>The quick fix is to increase the bound in the precision check in `nfrealsign` from 10 digits to 38 digits (128 bits).  This at least makes the error in my example and that reported by Lorenzini disappear.



---

archive/issue_comments_247074.json:
```json
{
    "body": "Changing commit from \"\" to \"d34a77ab7abe4072349e10e0154a598da94b7c31\"",
    "created_at": "2014-02-12T12:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247074",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "d34a77ab7abe4072349e10e0154a598da94b7c31"



---

archive/issue_comments_247075.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-12T12:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247075",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_247076.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/15483-two_descent_precision\"",
    "created_at": "2014-02-12T12:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247076",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/15483-two_descent_precision"



---

archive/issue_comments_247077.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-12T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247077",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_247078.json:
```json
{
    "body": "<a id='comment:12'></a>This needs a doctest...",
    "created_at": "2014-02-12T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247078",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:12'></a>This needs a doctest...



---

archive/issue_comments_247079.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-12T14:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_247080.json:
```json
{
    "body": "Changing commit from \"d34a77ab7abe4072349e10e0154a598da94b7c31\" to \"b662aba98ad4122a82fc135cf9b5dbf58de2ba0e\"",
    "created_at": "2014-02-12T14:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d34a77ab7abe4072349e10e0154a598da94b7c31" to "b662aba98ad4122a82fc135cf9b5dbf58de2ba0e"



---

archive/issue_comments_247081.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-12T15:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247081",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_247082.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Bruin\"",
    "created_at": "2014-02-12T15:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247082",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "" to "Peter Bruin"



---

archive/issue_comments_247083.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Workaround found; Bug reported upstream.\"",
    "created_at": "2014-02-12T15:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247083",
    "user": "https://github.com/pjbruin"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Workaround found; Bug reported upstream."



---

archive/issue_comments_247084.json:
```json
{
    "body": "<a id='comment:16'></a>I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.\n\nMaybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script \"upstream\".",
    "created_at": "2014-02-12T22:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247084",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.

Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script "upstream".



---

archive/issue_comments_247085.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 jdemeyer]:\n> I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.\n> \n> Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script \"upstream\".\n\nI completely agree with all of this and hope that we will soon hear Denis's opinion (I e-mailed him and pari-dev simultaneously).  The current patch is indeed fundamentally a hack and will hopefully be superseded by a better solution.",
    "created_at": "2014-02-12T22:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247085",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>Replying to [comment:16 jdemeyer]:
> I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.
> 
> Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script "upstream".

I completely agree with all of this and hope that we will soon hear Denis's opinion (I e-mailed him and pari-dev simultaneously).  The current patch is indeed fundamentally a hack and will hopefully be superseded by a better solution.



---

archive/issue_comments_247086.json:
```json
{
    "body": "<a id='comment:18'></a>Sorry that I have not had time to join this discussion -- I am very interested in the outcome.\n\nIt would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.",
    "created_at": "2014-02-13T09:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247086",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>Sorry that I have not had time to join this discussion -- I am very interested in the outcome.

It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.



---

archive/issue_comments_247087.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 cremona]:\n> It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.\n\nGood to know. I also needed to make some changes to his scripts for the PARI-2.7 port (#15767).",
    "created_at": "2014-02-13T09:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247087",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:18 cremona]:
> It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.

Good to know. I also needed to make some changes to his scripts for the PARI-2.7 port (#15767).



---

archive/issue_comments_247088.json:
```json
{
    "body": "<a id='comment:20'></a>Did you get any answer from Denis Simon? If not, we should try to implement the `nfsign()` solution ourselves.",
    "created_at": "2014-02-24T08:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247088",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Did you get any answer from Denis Simon? If not, we should try to implement the `nfsign()` solution ourselves.



---

archive/issue_comments_247089.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:\n> Did you get any answer from Denis Simon?\n\nUnfortunately not (yet).\n> If not, we should try to implement the `nfsign()` solution ourselves.\n\nIf you want to do it, go ahead, but to be honest, it seems a bit pointless to me at the moment.\n\nAlthough I agreed above that the increase from 10 to 38 in the precision check was just a hack, there is actually a reason for the 38.  (The following assumes a 64-bit word length.)  For any bound *n* < 38 in this test, a 1-bit error in the result already has catastrophic consequences: a number that should be negative is taken to be a positive number with 64 bits of precision, due to the precision being only 1 bit, and that bit being affected by a round-off error).  For *n* >= 38, the round-off errors have to accumulate to at least 65 bits of precision for the problem to occur (wrongly trusting the positivity of a 128-bit number).  Of course that can happen, but it is extremely unlikely and I would be surprised if you could find any example.",
    "created_at": "2014-02-24T11:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247089",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:
> Did you get any answer from Denis Simon?

Unfortunately not (yet).
> If not, we should try to implement the `nfsign()` solution ourselves.

If you want to do it, go ahead, but to be honest, it seems a bit pointless to me at the moment.

Although I agreed above that the increase from 10 to 38 in the precision check was just a hack, there is actually a reason for the 38.  (The following assumes a 64-bit word length.)  For any bound *n* < 38 in this test, a 1-bit error in the result already has catastrophic consequences: a number that should be negative is taken to be a positive number with 64 bits of precision, due to the precision being only 1 bit, and that bit being affected by a round-off error).  For *n* >= 38, the round-off errors have to accumulate to at least 65 bits of precision for the problem to occur (wrongly trusting the positivity of a 128-bit number).  Of course that can happen, but it is extremely unlikely and I would be surprised if you could find any example.



---

archive/issue_comments_247090.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-24T13:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247090",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_247091.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-02-24T13:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247091",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_247092.json:
```json
{
    "body": "Changing branch from \"u/pbruin/15483-two_descent_precision\" to \"b662aba98ad4122a82fc135cf9b5dbf58de2ba0e\"",
    "created_at": "2014-02-27T21:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247092",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/15483-two_descent_precision" to "b662aba98ad4122a82fc135cf9b5dbf58de2ba0e"



---

archive/issue_comments_247093.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-27T21:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15483#issuecomment-247093",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_045179.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-27T21:28:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15483",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15483#event-45179"
}
```
