# Issue 15483: Simon 2-descent gives RuntimeError for an elliptic curve over a quadratic field

archive/issues_015246.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n[See #15608 for a list of open simon_two_descent tickets]\n\nThe following tries to do 2-descent on an elliptic curve over a quadratic field:\n\n```\nK.<s>=QuadraticField(229)\nc4=2173-235*(1-s)/2\nc6=-124369+15988*(1-s)/2\nE=EllipticCurve([-c4/48,-c6/864])\nE.simon_two_descent()\n```\nIt fails with a `RuntimeError`:\n\n```\nTraceback (most recent call last):\n...\nRuntimeError: \n  ***   at top-level: ans=bnfellrank(K,[0,0,0,\n  ***                     ^--------------------\n  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=\n  ***   bnfell2descent_gen(b\n  ***   ^--------------------\n  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))\n  ***   [1];if(DEBUGLEVEL_el\n  ***   ^--------------------\n  ***   array index (1) out of allowed range [none].\nAn error occurred while running Simon's 2-descent program\n```\nThe problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see [comment:7](#comment%3A7) below.\n\n\nDepends on #11005\n\nUpstream: **Workaround found; Bug reported upstream.**\n\nCC:  @JohnCremona\n\nComponent: **elliptic curves**\n\nKeywords: **simon_two_descent**\n\nAuthor: **Peter Bruin**\n\nBranch/Commit: **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15483_\n\n",
    "closed_at": "2014-02-27T21:28:50Z",
    "created_at": "2013-12-04T17:43:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Simon 2-descent gives RuntimeError for an elliptic curve over a quadratic field",
    "type": "issue",
    "updated_at": "2014-02-27T21:28:50Z",
    "url": "https://github.com/sagemath/sage/issues/15483",
    "user": "https://github.com/pjbruin"
}
```
<div id="comment:0"></div>

[See #15608 for a list of open simon_two_descent tickets]

The following tries to do 2-descent on an elliptic curve over a quadratic field:

```
K.<s>=QuadraticField(229)
c4=2173-235*(1-s)/2
c6=-124369+15988*(1-s)/2
E=EllipticCurve([-c4/48,-c6/864])
E.simon_two_descent()
```
It fails with a `RuntimeError`:

```
Traceback (most recent call last):
...
RuntimeError: 
  ***   at top-level: ans=bnfellrank(K,[0,0,0,
  ***                     ^--------------------
  ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=
  ***   bnfell2descent_gen(b
  ***   ^--------------------
  ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))
  ***   [1];if(DEBUGLEVEL_el
  ***   ^--------------------
  ***   array index (1) out of allowed range [none].
An error occurred while running Simon's 2-descent program
```
The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see [comment:7](#comment%3A7) below.


Depends on #11005

Upstream: **Workaround found; Bug reported upstream.**

CC:  @JohnCremona

Component: **elliptic curves**

Keywords: **simon_two_descent**

Author: **Peter Bruin**

Branch/Commit: **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/15483_





---

archive/issue_events_218517.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-12-04T17:43:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218517"
}
```



---

archive/issue_events_218518.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-12-04T17:43:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218518"
}
```



---

archive/issue_events_218519.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-12-04T17:43:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218519"
}
```



---

archive/issue_events_218520.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-12-04T17:43:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218520"
}
```



---

archive/issue_comments_192976.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThere are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).\n\nSeveral of us spend hours or even days in 2011 sage Days (more than one) working on this sort of thing and gave up.  We were trying to do more, namely rewrite the interface so that it can use a gp2c-compiled version of the scripts.  One day I'll have another go at that.\n\nMeanwhile, this entry is to make sure that no-one wastes any time at all looking into the versions of the scripts which Sage currently includes;  you should test against the current versions.",
    "created_at": "2013-12-04T19:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192976",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:1" align="right">comment:1</div>

There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).

Several of us spend hours or even days in 2011 sage Days (more than one) working on this sort of thing and gave up.  We were trying to do more, namely rewrite the interface so that it can use a gp2c-compiled version of the scripts.  One day I'll have another go at that.

Meanwhile, this entry is to make sure that no-one wastes any time at all looking into the versions of the scripts which Sage currently includes;  you should test against the current versions.



---

archive/issue_comments_192977.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,4 @@\n \n The bug is not fixed by first changing to an integral model.\n \n+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.\n``````\n",
    "created_at": "2013-12-04T21:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192977",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,4 @@
 
 The bug is not fixed by first changing to an integral model.
 
+See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.
``````




---

archive/issue_comments_192978.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@JohnCremona](#comment%3A1):\n> There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).\n\nI searched for other tickets related to Simon's code and did not find reports of this particular problem.  We should first upgrade to the latest version of his script and then see which of the various problems listed at #11041 persist.  I added this ticket to that list for easier reference.",
    "created_at": "2013-12-04T21:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192978",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@JohnCremona](#comment%3A1):
> There are many similar bug reports with separate trac tickets.  I have no idea if this is a new bug or not.  Anyway, the version Sage has of DS's scripts are not the most recent one so there is no point in reporting this back to him unless you check that it happens with the scripts on his web page and you email him without mentioning Sage, otherwise he will just assume that the problem lies with Sage (which is possible).

I searched for other tickets related to Simon's code and did not find reports of this particular problem.  We should first upgrade to the latest version of his script and then see which of the various problems listed at #11041 persist.  I added this ticket to that list for easier reference.



---

archive/issue_comments_192979.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2013-12-27T23:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192979",
    "user": "https://github.com/categorie"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_192980.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nLorenzini reported me a similar bug and I had a look. I now believe that this is a bug in Simon's script as I can reproduce it outside sage. I used the version of his file dated 06/04/2011, which is the newest I found on the web, while sage has one dated the 25/03/2009. So besides that bug, the file needs to be updated anyway. I tried both in sage's gp (2.5.5) and the current alpha (2.6.1).\n\nI send an email to Denis and see if and how fast we can hope for a solution of this. Otherwise, I may at least update the script, later.\n\nLorenzini's example is a bit simpler:\n\n```\nR.<t> = QQ[]\nL.<g> = NumberField(t^3 - 9*t^2 + 13*t - 4)\nE1 = EllipticCurve(L,[1-g*(g-1),-g^2*(g-1),-g^2*(g-1),0,0])\nE1.rank()\n```",
    "created_at": "2013-12-27T23:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192980",
    "user": "https://github.com/categorie"
}
```

<div id="comment:3" align="right">comment:3</div>

Lorenzini reported me a similar bug and I had a look. I now believe that this is a bug in Simon's script as I can reproduce it outside sage. I used the version of his file dated 06/04/2011, which is the newest I found on the web, while sage has one dated the 25/03/2009. So besides that bug, the file needs to be updated anyway. I tried both in sage's gp (2.5.5) and the current alpha (2.6.1).

I send an email to Denis and see if and how fast we can hope for a solution of this. Otherwise, I may at least update the script, later.

Lorenzini's example is a bit simpler:

```
R.<t> = QQ[]
L.<g> = NumberField(t^3 - 9*t^2 + 13*t - 4)
E1 = EllipticCurve(L,[1-g*(g-1),-g^2*(g-1),-g^2*(g-1),0,0])
E1.rank()
```



---

archive/issue_comments_192981.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+[See #15608 for a list of open simon_two_descent tickets]\n+\n The following tries to do 2-descent on an elliptic curve over a quadratic field:\n \n ```\n``````\n",
    "created_at": "2013-12-30T16:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192981",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+[See #15608 for a list of open simon_two_descent tickets]
+
 The following tries to do 2-descent on an elliptic curve over a quadratic field:
 
 ```
``````




---

archive/issue_events_218521.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218521"
}
```



---

archive/issue_events_218522.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218522"
}
```



---

archive/issue_comments_192982.json:
```json
{
    "body": "Dependencies: **#11005**",
    "created_at": "2014-02-11T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192982",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#11005**



---

archive/issue_comments_192983.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe problem still exists after #11005, which upgrades Simon's script to the latest version.",
    "created_at": "2014-02-11T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192983",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

The problem still exists after #11005, which upgrades Simon's script to the latest version.



---

archive/issue_comments_192984.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,8 +26,5 @@\n   ***   array index (1) out of allowed range [none].\n An error occurred while running Simon's 2-descent program\n ```\n-It appears that a certain number field element is expected to be a square, but in fact isn't.\n+The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see [comment:7](#comment%3A7) below.\n \n-The bug is not fixed by first changing to an integral model.\n-\n-See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.\n``````\n",
    "created_at": "2014-02-12T10:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192984",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,8 +26,5 @@
   ***   array index (1) out of allowed range [none].
 An error occurred while running Simon's 2-descent program
 ```
-It appears that a certain number field element is expected to be a square, but in fact isn't.
+The problem is apparently that the square root of `norm(zc)` (which is indeed a square) is not computed due to a precision bug; see [comment:7](#comment%3A7) below.
 
-The bug is not fixed by first changing to an integral model.
-
-See #11041 for other bug reports related to Denis Simon's script, some of which may be caused by the fact that Sage currently uses an outdated version.
``````




---

archive/issue_comments_192985.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIt seems that the bug is caused by a precision problem in `subst`, called by `nfrealsign` in `ell.gp`.  The following GP input demonstrates this (using the latest version of `ell.gp`, see #11005):\n\n```\n\\r src/ext/pari/simon/ell.gp\nb = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320\na = Mod(b, y^2 - 229);\n\\p 38                    \\\\ default precision\nK = bnfinit(y^2 - 229);\nnfrealsign(K, a, 1)      \\\\ result: 1\nnfrealsign(K, a, 2)      \\\\ result: -1  (wrong)\nsubst(b, y, K.roots[2])  \\\\ result: -7.695704335233296721 E112, incorrect to this precision\n\\p 500                   \\\\ increase precision\nK = bnfinit(y^2 - 229);\nnfrealsign(K, a, 1)      \\\\ result: 1\nnfrealsign(K, a, 2)      \\\\ result: 1\nsubst(b, y, K.roots[2])  \\\\ result: 55550556624985845118007242443189926820306719407.796355955086894963616120700422308457186069825115395206111444495243228840597412527828358943327267422898011087182852030228685210492253493260963313348652457717717703991690402543456279919008587884729307897541432624377818611055431792706380900043638904108307170236335925883131494247446074384269328376967381902948861789570537169455258630011202296209679102466188417\n```\nThe value of `K.roots` does not seem to be the problem; the roots are calculated correctly to the requested precision.",
    "created_at": "2014-02-12T10:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192985",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

It seems that the bug is caused by a precision problem in `subst`, called by `nfrealsign` in `ell.gp`.  The following GP input demonstrates this (using the latest version of `ell.gp`, see #11005):

```
\r src/ext/pari/simon/ell.gp
b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320
a = Mod(b, y^2 - 229);
\p 38                    \\ default precision
K = bnfinit(y^2 - 229);
nfrealsign(K, a, 1)      \\ result: 1
nfrealsign(K, a, 2)      \\ result: -1  (wrong)
subst(b, y, K.roots[2])  \\ result: -7.695704335233296721 E112, incorrect to this precision
\p 500                   \\ increase precision
K = bnfinit(y^2 - 229);
nfrealsign(K, a, 1)      \\ result: 1
nfrealsign(K, a, 2)      \\ result: 1
subst(b, y, K.roots[2])  \\ result: 55550556624985845118007242443189926820306719407.796355955086894963616120700422308457186069825115395206111444495243228840597412527828358943327267422898011087182852030228685210492253493260963313348652457717717703991690402543456279919008587884729307897541432624377818611055431792706380900043638904108307170236335925883131494247446074384269328376967381902948861789570537169455258630011202296209679102466188417
```
The value of `K.roots` does not seem to be the problem; the roots are calculated correctly to the requested precision.



---

archive/issue_comments_192986.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe basic problem seems to be that PARI is too optimistic about the resulting precision when adding real numbers:\n\n```\n? b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320\n? K = bnfinit(y^2 - 229);\n? u=polcoeff(b,1)*K.roots[2]\n%167 = -2.3524523971732905757341977352314040726 E151\n? v=polcoeff(b,0)*1.\n%168 = 2.3524523971732905757341977352314040726 E151\n? u+v\n%169 = -7.695704335233296721 E112\n? precision(u)\n%170 = 38\n? precision(v)\n%171 = 38\n? precision(u+v)\n%172 = 19\n```",
    "created_at": "2014-02-12T11:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192986",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

The basic problem seems to be that PARI is too optimistic about the resulting precision when adding real numbers:

```
? b = -1554544300737274875964190134520312870631312460283689944298138572669148295776039072867720281361776956435252620954745928376624817557704277432961924925312*y + 23524523971732905757341977352314040726186200302188191824300117738073539522011689544444863977622786771332621915440577829842674416407299864303146477224320
? K = bnfinit(y^2 - 229);
? u=polcoeff(b,1)*K.roots[2]
%167 = -2.3524523971732905757341977352314040726 E151
? v=polcoeff(b,0)*1.
%168 = 2.3524523971732905757341977352314040726 E151
? u+v
%169 = -7.695704335233296721 E112
? precision(u)
%170 = 38
? precision(v)
%171 = 38
? precision(u+v)
%172 = 19
```



---

archive/issue_comments_192987.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nE-mailed `pari-dev` and Denis Simon about the precision issue, also suggesting a quick fix for `ell.gp`.",
    "created_at": "2014-02-12T12:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192987",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

E-mailed `pari-dev` and Denis Simon about the precision issue, also suggesting a quick fix for `ell.gp`.



---

archive/issue_comments_192988.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**",
    "created_at": "2014-02-12T12:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192988",
    "user": "https://github.com/pjbruin"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**



---

archive/issue_comments_192989.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe quick fix is to increase the bound in the precision check in `nfrealsign` from 10 digits to 38 digits (128 bits).  This at least makes the error in my example and that reported by Lorenzini disappear.",
    "created_at": "2014-02-12T12:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192989",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

The quick fix is to increase the bound in the precision check in `nfrealsign` from 10 digits to 38 digits (128 bits).  This at least makes the error in my example and that reported by Lorenzini disappear.



---

archive/issue_comments_192990.json:
```json
{
    "body": "Commit: **[`d34a77a`](https://github.com/sagemath/sagetrac-mirror/commit/d34a77ab7abe4072349e10e0154a598da94b7c31)**",
    "created_at": "2014-02-12T12:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192990",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`d34a77a`](https://github.com/sagemath/sagetrac-mirror/commit/d34a77ab7abe4072349e10e0154a598da94b7c31)**



---

archive/issue_events_218523.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-02-12T12:38:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218523"
}
```



---

archive/issue_comments_192991.json:
```json
{
    "body": "Branch: **[u/pbruin/15483-two_descent_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15483-two_descent_precision)**",
    "created_at": "2014-02-12T12:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192991",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/15483-two_descent_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15483-two_descent_precision)**



---

archive/issue_events_218524.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-02-12T12:42:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218524"
}
```



---

archive/issue_events_218525.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-02-12T12:42:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218525"
}
```



---

archive/issue_comments_192992.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThis needs a doctest...",
    "created_at": "2014-02-12T12:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192992",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:12" align="right">comment:12</div>

This needs a doctest...



---

archive/issue_comments_192993.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e\"><code>b662aba</code></a></td><td><code>add/fix doctests for simon_two_descent</code></td></tr></table>\n",
    "created_at": "2014-02-12T14:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192993",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e"><code>b662aba</code></a></td><td><code>add/fix doctests for simon_two_descent</code></td></tr></table>




---

archive/issue_comments_192994.json:
```json
{
    "body": "Changed commit from **[`d34a77a`](https://github.com/sagemath/sagetrac-mirror/commit/d34a77ab7abe4072349e10e0154a598da94b7c31)** to **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**",
    "created_at": "2014-02-12T14:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192994",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d34a77a`](https://github.com/sagemath/sagetrac-mirror/commit/d34a77ab7abe4072349e10e0154a598da94b7c31)** to **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**



---

archive/issue_events_218526.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-02-12T15:00:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218526"
}
```



---

archive/issue_events_218527.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-02-12T15:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218527"
}
```



---

archive/issue_comments_192995.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2014-02-12T15:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192995",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_192996.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Workaround found; Bug reported upstream.**",
    "created_at": "2014-02-12T15:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192996",
    "user": "https://github.com/pjbruin"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Workaround found; Bug reported upstream.**



---

archive/issue_comments_192997.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.\n\nMaybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script \"upstream\".",
    "created_at": "2014-02-12T22:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192997",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.

Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script "upstream".



---

archive/issue_comments_192998.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment%3A16):\n> I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.\n> \n> Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script \"upstream\".\n\nI completely agree with all of this and hope that we will soon hear Denis's opinion (I e-mailed him and pari-dev simultaneously).  The current patch is indeed fundamentally a hack and will hopefully be superseded by a better solution.",
    "created_at": "2014-02-12T22:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192998",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment%3A16):
> I quite like the suggestion by Karim Belabas to use `nfsign()` together with `nfnewprec`. I think that's a lot better than the current patch, which is really just a hack.
> 
> Maybe you should ask Denis Simon what he thinks (perhaps with a proof-of-concept patch)? Ideally, he fixes his script "upstream".

I completely agree with all of this and hope that we will soon hear Denis's opinion (I e-mailed him and pari-dev simultaneously).  The current patch is indeed fundamentally a hack and will hopefully be superseded by a better solution.



---

archive/issue_comments_192999.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSorry that I have not had time to join this discussion -- I am very interested in the outcome.\n\nIt would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.",
    "created_at": "2014-02-13T09:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-192999",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:18" align="right">comment:18</div>

Sorry that I have not had time to join this discussion -- I am very interested in the outcome.

It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.



---

archive/issue_comments_193000.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@JohnCremona](#comment%3A18):\n> It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.\n\nGood to know. I also needed to make some changes to his scripts for the PARI-2.7 port (#15767).",
    "created_at": "2014-02-13T09:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-193000",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@JohnCremona](#comment%3A18):
> It would be good to get Denis to adapt his script.  He has done this in the past several times.  I have found that it does not work for someone else to revise his script and send him the result;  he want to do it himself and remain sole author.  But a proof-of-concept patch might help him.

Good to know. I also needed to make some changes to his scripts for the PARI-2.7 port (#15767).



---

archive/issue_comments_193001.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDid you get any answer from Denis Simon? If not, we should try to implement the `nfsign()` solution ourselves.",
    "created_at": "2014-02-24T08:51:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-193001",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Did you get any answer from Denis Simon? If not, we should try to implement the `nfsign()` solution ourselves.



---

archive/issue_comments_193002.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment%3A20):\n> Did you get any answer from Denis Simon?\n\nUnfortunately not (yet).\n> If not, we should try to implement the `nfsign()` solution ourselves.\n\nIf you want to do it, go ahead, but to be honest, it seems a bit pointless to me at the moment.\n\nAlthough I agreed above that the increase from 10 to 38 in the precision check was just a hack, there is actually a reason for the 38.  (The following assumes a 64-bit word length.)  For any bound *n* < 38 in this test, a 1-bit error in the result already has catastrophic consequences: a number that should be negative is taken to be a positive number with 64 bits of precision, due to the precision being only 1 bit, and that bit being affected by a round-off error).  For *n* >= 38, the round-off errors have to accumulate to at least 65 bits of precision for the problem to occur (wrongly trusting the positivity of a 128-bit number).  Of course that can happen, but it is extremely unlikely and I would be surprised if you could find any example.",
    "created_at": "2014-02-24T11:42:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-193002",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment%3A20):
> Did you get any answer from Denis Simon?

Unfortunately not (yet).
> If not, we should try to implement the `nfsign()` solution ourselves.

If you want to do it, go ahead, but to be honest, it seems a bit pointless to me at the moment.

Although I agreed above that the increase from 10 to 38 in the precision check was just a hack, there is actually a reason for the 38.  (The following assumes a 64-bit word length.)  For any bound *n* < 38 in this test, a 1-bit error in the result already has catastrophic consequences: a number that should be negative is taken to be a positive number with 64 bits of precision, due to the precision being only 1 bit, and that bit being affected by a round-off error).  For *n* >= 38, the round-off errors have to accumulate to at least 65 bits of precision for the problem to occur (wrongly trusting the positivity of a 128-bit number).  Of course that can happen, but it is extremely unlikely and I would be surprised if you could find any example.



---

archive/issue_events_218528.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-24T13:07:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218528"
}
```



---

archive/issue_events_218529.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-24T13:07:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218529"
}
```



---

archive/issue_comments_193003.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2014-02-24T13:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-193003",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_193004.json:
```json
{
    "body": "Changed branch from **[u/pbruin/15483-two_descent_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15483-two_descent_precision)** to **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**",
    "created_at": "2014-02-27T21:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15483#issuecomment-193004",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/15483-two_descent_precision](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15483-two_descent_precision)** to **[`b662aba`](https://github.com/sagemath/sagetrac-mirror/commit/b662aba98ad4122a82fc135cf9b5dbf58de2ba0e)**



---

archive/issue_events_218530.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-27T21:28:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218530"
}
```



---

archive/issue_events_218531.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "09ecd344a2c800da8a50d6500b82fadc2cc58e16",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-02-27T21:28:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15483",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15483#event-218531"
}
```
