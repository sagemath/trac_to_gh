# Issue 15648: lazy import attributes of a class are not substituted back after the import

archive/issues_015411.json:
```json
{
    "body": "\n```\nsage: class A:\n....:     Associative = LazyImport('sage.categories.magmas', 'Magmas')\n....: \nsage: A.Associative\n<class 'sage.categories.magmas.Magmas'>\nsage: type(A.__dict__[\"Associative\"])\n<type 'sage.misc.lazy_import.LazyImport'>\n```\n\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/15648\n\n",
    "closed_at": "2017-04-06T20:15:50Z",
    "created_at": "2014-01-08T08:42:20Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "lazy import attributes of a class are not substituted back after the import",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15648",
    "user": "https://github.com/nthiery"
}
```

```
sage: class A:
....:     Associative = LazyImport('sage.categories.magmas', 'Magmas')
....: 
sage: A.Associative
<class 'sage.categories.magmas.Magmas'>
sage: type(A.__dict__["Associative"])
<type 'sage.misc.lazy_import.LazyImport'>
```


Status: new

Issue created by migration from https://trac.sagemath.org/ticket/15648





---

archive/issue_comments_251495.json:
```json
{
    "body": "<a id='comment:1'></a>See my comment at #10963. We could simply create a lazy class attribute with an import statement inside. Proof of concept:\n\n```\nsage: def imported_lazy_class_attribute(module_name, cls_name):                         \n....:     return lazy_class_attribute(lambda cls: getattr(__import__(module_name, {}, {}, [cls_name]),cls_name))\n....: \nsage: class Test(object):\n....:     Finite = imported_lazy_class_attribute('sage.categories.finite_permutation_groups', 'FinitePermutationGroups')\n....:     \nsage: Test.Finite\n<class 'sage.categories.finite_permutation_groups.FinitePermutationGroups'>\n```\n\nAlternatively, since `LazyImport` has some `__get__`: We could make the lazy import *behave* as a class attribute, if it is used as attribute of a class (`__get__` knows whether it is used as attribute of a class.",
    "created_at": "2014-01-08T11:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251495",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>See my comment at #10963. We could simply create a lazy class attribute with an import statement inside. Proof of concept:

```
sage: def imported_lazy_class_attribute(module_name, cls_name):                         
....:     return lazy_class_attribute(lambda cls: getattr(__import__(module_name, {}, {}, [cls_name]),cls_name))
....: 
sage: class Test(object):
....:     Finite = imported_lazy_class_attribute('sage.categories.finite_permutation_groups', 'FinitePermutationGroups')
....:     
sage: Test.Finite
<class 'sage.categories.finite_permutation_groups.FinitePermutationGroups'>
```

Alternatively, since `LazyImport` has some `__get__`: We could make the lazy import *behave* as a class attribute, if it is used as attribute of a class (`__get__` knows whether it is used as attribute of a class.



---

archive/issue_comments_251496.json:
```json
{
    "body": "<a id='comment:2'></a>Strange. Shouldn't `LazyImport` already act as a class attribute? After all, I see the following code:\n\n```python\n            if owner is None:\n                if self._namespace and self._namespace[alias] is self:\n                    self._namespace[alias] = self._object\n            else:\n                from inspect import getmro\n                for cls in getmro(owner):\n                    if cls.__dict__.get(alias, None) is self:\n                        setattr(cls, alias, self._object)\n                        break\n```\nThis should actually do the trick.",
    "created_at": "2014-01-08T11:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251496",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Strange. Shouldn't `LazyImport` already act as a class attribute? After all, I see the following code:

```python
            if owner is None:
                if self._namespace and self._namespace[alias] is self:
                    self._namespace[alias] = self._object
            else:
                from inspect import getmro
                for cls in getmro(owner):
                    if cls.__dict__.get(alias, None) is self:
                        setattr(cls, alias, self._object)
                        break
```
This should actually do the trick.



---

archive/issue_comments_251497.json:
```json
{
    "body": "<a id='comment:3'></a>In the example of the ticket description, I suppose you simply need to proved `as_name=\"Associative\"`, and then it should work. Can't test it right now, though.",
    "created_at": "2014-01-08T11:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251497",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>In the example of the ticket description, I suppose you simply need to proved `as_name="Associative"`, and then it should work. Can't test it right now, though.



---

archive/issue_comments_251498.json:
```json
{
    "body": "<a id='comment:4'></a>The only (mild) problems I see:\n1. Why is the `_get_object`, if it does what ostensibly is the job of `__get__`?\n2. Why is the imported object put into the dict of a class, but not into the dict of an instance? `_get_object` can't do it, since it doesn't know the instance.\n\nHence, I am all for removing `_get_object`.",
    "created_at": "2014-01-08T11:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251498",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>The only (mild) problems I see:
1. Why is the `_get_object`, if it does what ostensibly is the job of `__get__`?
2. Why is the imported object put into the dict of a class, but not into the dict of an instance? `_get_object` can't do it, since it doesn't know the instance.

Hence, I am all for removing `_get_object`.



---

archive/issue_comments_251499.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Do we need a lazy import to act as lazy instance attribute?\"",
    "created_at": "2014-01-08T12:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251499",
    "user": "https://github.com/simon-king-jena"
}
```

Changing work_issues from "" to "Do we need a lazy import to act as lazy instance attribute?"



---

archive/issue_comments_251500.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\nsage: from sage.misc.lazy_import import LazyImport\nsage: class A:\n....:     Associative = LazyImport('sage.categories.magmas', 'Magmas', 'Associative')\n....:     \nsage: A.Associative\n<class 'sage.categories.magmas.Magmas'>\nsage: A.__dict__['Associative']\n<class 'sage.categories.magmas.Magmas'>\n```\n\nHence, unless you agree that we should change the lazy import statement so that it additionally acts as a lazy instance attribute, then this ticket is invalid.",
    "created_at": "2014-01-08T12:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251500",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
```
sage: from sage.misc.lazy_import import LazyImport
sage: class A:
....:     Associative = LazyImport('sage.categories.magmas', 'Magmas', 'Associative')
....:     
sage: A.Associative
<class 'sage.categories.magmas.Magmas'>
sage: A.__dict__['Associative']
<class 'sage.categories.magmas.Magmas'>
```

Hence, unless you agree that we should change the lazy import statement so that it additionally acts as a lazy instance attribute, then this ticket is invalid.



---

archive/issue_comments_251501.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-01-08T12:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251501",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_info.



---

archive/issue_events_045880.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45880"
}
```



---

archive/issue_events_045881.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45881"
}
```



---

archive/issue_events_045882.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45882"
}
```



---

archive/issue_events_045883.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45883"
}
```



---

archive/issue_events_045884.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45884"
}
```



---

archive/issue_comments_251502.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-04-06T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251502",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_251503.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-04-06T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251503",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_events_045885.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T11:44:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45885"
}
```



---

archive/issue_events_045886.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T11:44:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45886"
}
```



---

archive/issue_comments_251504.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#22752\"",
    "created_at": "2017-04-06T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251504",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#22752"



---

archive/issue_comments_251505.json:
```json
{
    "body": "Changing work_issues from \"Do we need a lazy import to act as lazy instance attribute?\" to \"\"",
    "created_at": "2017-04-06T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251505",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Do we need a lazy import to act as lazy instance attribute?" to ""



---

archive/issue_comments_251506.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/15648\"",
    "created_at": "2017-04-06T11:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251506",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/15648"



---

archive/issue_comments_251507.json:
```json
{
    "body": "Changing commit from \"\" to \"d5f23484bd61b280dcf5b716f58fe31a6847e18d\"",
    "created_at": "2017-04-06T11:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251507",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "d5f23484bd61b280dcf5b716f58fe31a6847e18d"



---

archive/issue_comments_251508.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-04-06T11:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251508",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_251509.json:
```json
{
    "body": "<a id='comment:11'></a>New commits:",
    "created_at": "2017-04-06T11:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251509",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>New commits:



---

archive/issue_comments_251510.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-06T12:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_251511.json:
```json
{
    "body": "Changing commit from \"d5f23484bd61b280dcf5b716f58fe31a6847e18d\" to \"796a45277a23c14ea86126f5e08349f2c25c34d2\"",
    "created_at": "2017-04-06T12:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d5f23484bd61b280dcf5b716f58fe31a6847e18d" to "796a45277a23c14ea86126f5e08349f2c25c34d2"



---

archive/issue_events_045887.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T20:15:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45887"
}
```



---

archive/issue_events_045888.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T20:15:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45888"
}
```



---

archive/issue_comments_251512.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-04-06T20:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251512",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: wontfix



---

archive/issue_events_045889.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T20:15:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45889"
}
```



---

archive/issue_comments_251513.json:
```json
{
    "body": "Changing commit from \"796a45277a23c14ea86126f5e08349f2c25c34d2\" to \"\"",
    "created_at": "2017-04-06T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251513",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "796a45277a23c14ea86126f5e08349f2c25c34d2" to ""



---

archive/issue_comments_251514.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2017-04-06T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251514",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_045890.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-06T20:26:13Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15648#event-45890"
}
```



---

archive/issue_comments_251515.json:
```json
{
    "body": "Changing author from \"Jeroen Demeyer\" to \"\"",
    "created_at": "2017-04-06T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251515",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Jeroen Demeyer" to ""



---

archive/issue_comments_251516.json:
```json
{
    "body": "Resolution changed from wontfix to ",
    "created_at": "2017-04-06T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251516",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from wontfix to 



---

archive/issue_comments_251517.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/15648\" to \"\"",
    "created_at": "2017-04-06T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251517",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/jdemeyer/ticket/15648" to ""



---

archive/issue_comments_251518.json:
```json
{
    "body": "Changing dependencies from \"#22752\" to \"\"",
    "created_at": "2017-04-06T20:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15648#issuecomment-251518",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#22752" to ""
