# Issue 15317: Troubles with Python and ncurses on Cygwin

archive/issues_015080.json:
```json
{
    "body": "Python currently fails/is suboptimal on Cygwin because:\n* it does not properly detect readline which is only installed as a shared library, patch \"2.7.3-dylib.patch\" from Cygwin package fixes that;\n* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...\n* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html\n\nThis ticket fixes the Python part.\nThe ncurses part is #15617\n\n**CC:**  @dimpase @vbraun @jdemeyer\n\n**Keywords:** cygwin spkg ncurses\n\n**Branch/Commit:** [c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)\n\n**Upstream:** Workaround found; Bug reported upstream.\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jean-Pierre Flori\n\nIssue created by migration from https://trac.sagemath.org/ticket/15317\n\n",
    "closed_at": "2014-02-14T19:44:52Z",
    "created_at": "2013-10-23T06:50:01Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "title": "Troubles with Python and ncurses on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/15317",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Python currently fails/is suboptimal on Cygwin because:
* it does not properly detect readline which is only installed as a shared library, patch "2.7.3-dylib.patch" from Cygwin package fixes that;
* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...
* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html

This ticket fixes the Python part.
The ncurses part is #15617

**CC:**  @dimpase @vbraun @jdemeyer

**Keywords:** cygwin spkg ncurses

**Branch/Commit:** [c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)

**Upstream:** Workaround found; Bug reported upstream.

**Reviewer:** Travis Scrimshaw

**Author:** Jean-Pierre Flori

Issue created by migration from https://trac.sagemath.org/ticket/15317





---

archive/issue_comments_192207.json:
```json
{
    "body": "<a id='comment:1'></a>\nHad no time to investigate the diff between 5.7 and 5.8, especially around the offending lines, function calls.\nAny help/clues welcomed.",
    "created_at": "2013-10-23T06:50:46Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192207",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>
Had no time to investigate the diff between 5.7 and 5.8, especially around the offending lines, function calls.
Any help/clues welcomed.



---

archive/issue_comments_192208.json:
```json
{
    "body": "<a id='comment:2'></a>\nSimilar problem on different archs: http://lists.busybox.net/pipermail/buildroot/2011-April/042350.html\nNo solution though...",
    "created_at": "2013-10-24T07:40:25Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192208",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>
Similar problem on different archs: http://lists.busybox.net/pipermail/buildroot/2011-April/042350.html
No solution though...



---

archive/issue_comments_192209.json:
```json
{
    "body": "<a id='comment:3'></a>\nMaybe have a look at http://trac.sagemath.org/ticket/12282",
    "created_at": "2013-10-24T07:45:49Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192209",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>
Maybe have a look at http://trac.sagemath.org/ticket/12282



---

archive/issue_comments_192210.json:
```json
{
    "body": "<a id='comment:4'></a>\nPlaying a little bit around, it seems that setting TERM to something non-existing (e.g. \"\" or \"blblbblblbl\") makes the segfault disappear.",
    "created_at": "2013-10-24T11:27:43Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192210",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>
Playing a little bit around, it seems that setting TERM to something non-existing (e.g. "" or "blblbblblbl") makes the segfault disappear.



---

archive/issue_comments_192211.json:
```json
{
    "body": "**Upstream:** Workaround found; Bug reported upstream.",
    "created_at": "2013-10-25T06:58:12Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192211",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Upstream:** Workaround found; Bug reported upstream.



---

archive/issue_comments_192212.json:
```json
{
    "body": "<a id='comment:5'></a>\nUpstream bug report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html\n\nThe problem is that when the config BROKEN_LINKER is set, then a pointer CurTerm is used but never set to something else than zero.\nSetting it as in other cases seems to fix the problem.\nOr unsetting BROKEN_LINKER on Cygwin.",
    "created_at": "2013-10-25T06:58:12Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192212",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
Upstream bug report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html

The problem is that when the config BROKEN_LINKER is set, then a pointer CurTerm is used but never set to something else than zero.
Setting it as in other cases seems to fix the problem.
Or unsetting BROKEN_LINKER on Cygwin.



---

archive/issue_comments_192213.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n Python currently fails/is suboptimal on Cygwin because:\n * it does not properly detect readline which is only installed as a shared library, patch \"2.7.3-dylib.patch\" from Cygwin package fixes that;\n * the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo;\n-* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way.\n+* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html\n``````\n",
    "created_at": "2013-10-25T06:58:12Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192213",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 Python currently fails/is suboptimal on Cygwin because:
 * it does not properly detect readline which is only installed as a shared library, patch "2.7.3-dylib.patch" from Cygwin package fixes that;
 * the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo;
-* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way.
+* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html
``````




---

archive/issue_comments_192214.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n Python currently fails/is suboptimal on Cygwin because:\n * it does not properly detect readline which is only installed as a shared library, patch \"2.7.3-dylib.patch\" from Cygwin package fixes that;\n-* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo;\n-* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html\n+* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...\n+* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html\n``````\n",
    "created_at": "2013-10-28T18:02:55Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192214",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 Python currently fails/is suboptimal on Cygwin because:
 * it does not properly detect readline which is only installed as a shared library, patch "2.7.3-dylib.patch" from Cygwin package fixes that;
-* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo;
-* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html
+* the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...
+* it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html
``````




---

archive/issue_comments_192215.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe BROKEN_LINKER stuff should be fixed in ncurses:\n* http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html",
    "created_at": "2013-10-28T18:02:55Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192215",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>
The BROKEN_LINKER stuff should be fixed in ncurses:
* http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html



---

archive/issue_comments_192216.json:
```json
{
    "body": "**Changing upstream** from \"Workaround found; Bug reported upstream.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2013-10-28T18:03:11Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192216",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing upstream** from "Workaround found; Bug reported upstream." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_192217.json:
```json
{
    "body": "<a id='comment:8'></a>\nThere were further problem with the threading code in the Cygwin dll itself.\nFixed in the > 1.7.25 releases (currently only snpashots). See http://cygwin.com/ml/cygwin/2013-10/msg00371.html.",
    "created_at": "2013-11-04T10:21:05Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192217",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
There were further problem with the threading code in the Cygwin dll itself.
Fixed in the > 1.7.25 releases (currently only snpashots). See http://cygwin.com/ml/cygwin/2013-10/msg00371.html.



---

archive/issue_comments_192218.json:
```json
{
    "body": "<a id='comment:9'></a>\nAs far as not linking to tinfo is concerned, I'm putting this here for reference: http://bugs.python.org/issue7384.\n\nIn particular, python uses ldd for linking detection but applies it on import libraries on cygwin which just fails.\n(The situation is more or less the same on OS X but OS X seems less picky about providing explicitely all libraries to be linked in.)",
    "created_at": "2013-11-07T10:17:19Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192218",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>
As far as not linking to tinfo is concerned, I'm putting this here for reference: http://bugs.python.org/issue7384.

In particular, python uses ldd for linking detection but applies it on import libraries on cygwin which just fails.
(The situation is more or less the same on OS X but OS X seems less picky about providing explicitely all libraries to be linked in.)



---

archive/issue_comments_192219.json:
```json
{
    "body": "<a id='comment:10'></a>\nHere is how to find the dll corresponding to an import lib:\n* http://cygwin.com/ml/cygwin/2013-11/msg00167.html$\n(dlltool --identify [implib])",
    "created_at": "2013-12-27T13:26:19Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192219",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:10'></a>
Here is how to find the dll corresponding to an import lib:
* http://cygwin.com/ml/cygwin/2013-11/msg00167.html$
(dlltool --identify [implib])



---

archive/issue_comments_192220.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jpflori](#comment%3A10):\n> Here is how to find the dll corresponding to an import lib:\n> * http://cygwin.com/ml/cygwin/2013-11/msg00167.html\n> (dlltool --identify [implib])\n\n\nFixed typo in the url.",
    "created_at": "2013-12-28T04:57:32Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192220",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Replying to [jpflori](#comment%3A10):
> Here is how to find the dll corresponding to an import lib:
> * http://cygwin.com/ml/cygwin/2013-11/msg00167.html
> (dlltool --identify [implib])


Fixed typo in the url.



---

archive/issue_comments_192221.json:
```json
{
    "body": "<a id='comment:12'></a>\nI've opened #15617 for the ncurses update.",
    "created_at": "2014-01-01T20:32:20Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192221",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:12'></a>
I've opened #15617 for the ncurses update.



---

archive/issue_comments_192222.json:
```json
{
    "body": "<a id='comment:13'></a>\nI've put a dirty but working python spkg at:\n* http://boxen.math.washington.edu/home/jpflori/cygwin/python-2.7.5.p2.spkg\nfor those wanting to try a Cygwin(32) build.",
    "created_at": "2014-01-01T22:06:37Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192222",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:13'></a>
I've put a dirty but working python spkg at:
* http://boxen.math.washington.edu/home/jpflori/cygwin/python-2.7.5.p2.spkg
for those wanting to try a Cygwin(32) build.



---

archive/issue_comments_192223.json:
```json
{
    "body": "<a id='comment:14'></a>\nI installed the new version of ncurses and created a new branch with the python spkg at `u/tscrim/cygwin_python-15317` (with #15617 merged in). Now I get somewhere else than I did before (with cygwin32) with it failing at importing the module `_socket`...",
    "created_at": "2014-01-04T06:09:58Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192223",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
I installed the new version of ncurses and created a new branch with the python spkg at `u/tscrim/cygwin_python-15317` (with #15617 merged in). Now I get somewhere else than I did before (with cygwin32) with it failing at importing the module `_socket`...



---

archive/issue_comments_192224.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [tscrim](#comment%3A14):\n> I installed the new version of ncurses and created a new branch with the python spkg at `u/tscrim/cygwin_python-15317` (with #15617 merged in). Now I get somewhere else than I did before (with cygwin32) with it failing at importing the module `_socket`...\n\nWhat is in that branch exactly?\nFrom the git log I assume you just updated the tarball with what's within the spkg?\nNote that's only for testing purpose and a clean patch should be produced :)\nFYI, I think we temporarly could just diff what's in the tarball with the vanilla tarball and ship it as a patch in Sage, but that's definitely not for upstream inclusion.\nRight know it basically adds \"-ltinfo\" all the time which is right for Sage as we build our own ncurses which makes tinfo a separate lib.\n\nThe _socket thing reminds me of rebasing issues.\nTry to run \"find . -name \"*.dll\" > dlls && rebase -O -T dlls && make\" in Sage's root.\nAnd I did not test on Cygwin64 lately, so that might be another problem.",
    "created_at": "2014-01-04T12:59:42Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192224",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>
Replying to [tscrim](#comment%3A14):
> I installed the new version of ncurses and created a new branch with the python spkg at `u/tscrim/cygwin_python-15317` (with #15617 merged in). Now I get somewhere else than I did before (with cygwin32) with it failing at importing the module `_socket`...

What is in that branch exactly?
From the git log I assume you just updated the tarball with what's within the spkg?
Note that's only for testing purpose and a clean patch should be produced :)
FYI, I think we temporarly could just diff what's in the tarball with the vanilla tarball and ship it as a patch in Sage, but that's definitely not for upstream inclusion.
Right know it basically adds "-ltinfo" all the time which is right for Sage as we build our own ncurses which makes tinfo a separate lib.

The _socket thing reminds me of rebasing issues.
Try to run "find . -name "*.dll" > dlls && rebase -O -T dlls && make" in Sage's root.
And I did not test on Cygwin64 lately, so that might be another problem.



---

archive/issue_comments_192225.json:
```json
{
    "body": "<a id='comment:16'></a>\nTried that and it didn't work. I also pushed a patch to the branch.",
    "created_at": "2014-01-05T04:55:51Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192225",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Tried that and it didn't work. I also pushed a patch to the branch.



---

archive/issue_comments_192226.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,6 @@\n * it does not properly detect readline which is only installed as a shared library, patch \"2.7.3-dylib.patch\" from Cygwin package fixes that;\n * the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...\n * it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS=\"-O0 -g\" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is \"char *result = exit_attribute_mode;\"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html\n+\n+This ticket fixes the Python part.\n+The ncurses part is #15617\n``````\n",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192226",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,6 @@
 * it does not properly detect readline which is only installed as a shared library, patch "2.7.3-dylib.patch" from Cygwin package fixes that;
 * the curses module is not built because of undefined refs, just passing -lcurses when linking is not enough, one should add -ltinfo; in fact the real problem is that setup.py tries to run ldd on the import library (dll.a) which fails to detect what libraries are already linked and anyway would decide to discard -ltinfo as its already linked to readline, but on Cygwin you have to explicitely pass everything...
 * it segfault at startup when loading the readline module, not sure why. It looks exactly as what is reported at http://trac.macports.org/ticket/29496 . Rebuilding ncurses with debug info (including CFLAGS="-O0 -g" which cannot easily be passed right now) does not give much info. The offending line pointed by GCC is "char *result = exit_attribute_mode;"; maybe some dark magic going on as reported in http://lists.gnu.org/archive/html/bug-ncurses/2006-10/msg00002.html ; please not that on Cygwin the stack is small by default but playing a little bit with that did not really help. Further info: ncurses 5.7 is fine, ncurses 5.8 fails in the same way. Upstream bu report: http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00014.html. Should be fixed with http://lists.gnu.org/archive/html/bug-ncurses/2013-10/msg00017.html
+
+This ticket fixes the Python part.
+The ncurses part is #15617
``````




---

archive/issue_events_134869.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2014-01-05T21:53:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134869"
}
```



---

archive/issue_comments_192227.json:
```json
{
    "body": "**Author:** Jean-Pierre Flori",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192227",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Author:** Jean-Pierre Flori



---

archive/issue_comments_192228.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe branch I pushed is cleaner and should be good to go.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1\">7916640</a></td><td><code>Make sure tinfo is correctly linked in when needed on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9acea9b4e12e69f433d269e0ff18a390ce56497e\">9acea9b</a></td><td><code>Actually add the NTL patch.</code></td></tr></table>\n",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192228",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:17'></a>
The branch I pushed is cleaner and should be good to go.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1">7916640</a></td><td><code>Make sure tinfo is correctly linked in when needed on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9acea9b4e12e69f433d269e0ff18a390ce56497e">9acea9b</a></td><td><code>Actually add the NTL patch.</code></td></tr></table>




---

archive/issue_comments_192229.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, but not in a stable release.\" to \"Workaround found; Bug reported upstream.\".",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192229",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing upstream** from "Fixed upstream, but not in a stable release." to "Workaround found; Bug reported upstream.".



---

archive/issue_comments_192230.json:
```json
{
    "body": "**Commit:** [79166403ba2f72a9cda9a6641a8914293d3cd2d1](https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1)",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192230",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Commit:** [79166403ba2f72a9cda9a6641a8914293d3cd2d1](https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1)



---

archive/issue_comments_192231.json:
```json
{
    "body": "**Branch:** [u/jpflori/ticket/15317](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/15317)",
    "created_at": "2014-01-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192231",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Branch:** [u/jpflori/ticket/15317](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/15317)



---

archive/issue_comments_192232.json:
```json
{
    "body": "<a id='comment:18'></a>\nGroumpf, wrong branch, I'm pushing the right one shortly.\n\nTravis: Could you post the log of the failed build?",
    "created_at": "2014-01-05T21:54:33Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192232",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:18'></a>
Groumpf, wrong branch, I'm pushing the right one shortly.

Travis: Could you post the log of the failed build?



---

archive/issue_comments_192233.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8\">c0a09c5</a></td><td><code>Make sure tinfo is correctly linked in when needed on Cygwin.</code></td></tr></table>\n",
    "created_at": "2014-01-05T21:56:01Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8">c0a09c5</a></td><td><code>Make sure tinfo is correctly linked in when needed on Cygwin.</code></td></tr></table>




---

archive/issue_comments_192234.json:
```json
{
    "body": "**Changing commit** from \"[79166403ba2f72a9cda9a6641a8914293d3cd2d1](https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1)\" to \"[c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)\".",
    "created_at": "2014-01-05T21:56:01Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[79166403ba2f72a9cda9a6641a8914293d3cd2d1](https://github.com/sagemath/sagetrac-mirror/commit/79166403ba2f72a9cda9a6641a8914293d3cd2d1)" to "[c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)".



---

archive/issue_comments_192235.json:
```json
{
    "body": "<a id='comment:20'></a>\nI think with the new branch it worked...I'm now building atlas. Let me try on Cygwin64 and my Ubuntu machine.",
    "created_at": "2014-01-07T16:28:00Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192235",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
I think with the new branch it worked...I'm now building atlas. Let me try on Cygwin64 and my Ubuntu machine.



---

archive/issue_comments_192236.json:
```json
{
    "body": "<a id='comment:21'></a>\nI don't promise it works on Cygwin64... though I don't see any reason why it shouldn't.",
    "created_at": "2014-01-07T21:10:10Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192236",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:21'></a>
I don't promise it works on Cygwin64... though I don't see any reason why it shouldn't.



---

archive/issue_comments_192237.json:
```json
{
    "body": "<a id='comment:22'></a>\nFor ATLAS you will need #15615 as I forgot to update the autotools project within the tarball after #14410... and so the changes introduced in the patches/ATLAS-lib dir are not reflected in the build system actually used (src/ATLAS-lib).",
    "created_at": "2014-01-07T21:11:49Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192237",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>
For ATLAS you will need #15615 as I forgot to update the autotools project within the tarball after #14410... and so the changes introduced in the patches/ATLAS-lib dir are not reflected in the build system actually used (src/ATLAS-lib).



---

archive/attachments_021065.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "scrimshaw_cygwin.log",
    "asset_url": "tarball://root/attachments/ticket15317/scrimshaw_cygwin.log",
    "created_at": "2014-01-07T23:36:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cygwin.log",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_192238.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Attachment:** [scrimshaw_cygwin.log](https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cygwin.log)\n\nATLAS built fine for me, but it's failing on pillow. I've attached the log. I'm trying the Cygwin64 now.",
    "created_at": "2014-01-07T23:36:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192238",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
**Attachment:** [scrimshaw_cygwin.log](https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cygwin.log)

ATLAS built fine for me, but it's failing on pillow. I've attached the log. I'm trying the Cygwin64 now.



---

archive/attachments_021066.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "scrimshaw_cywgin64.log",
    "asset_url": "tarball://root/attachments/ticket15317/scrimshaw_cywgin64.log",
    "created_at": "2014-01-08T00:47:21Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cywgin64.log",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_192239.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Attachment:** [scrimshaw_cywgin64.log](https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cywgin64.log)\n\nFTR It doesn't work for me on Cygwin64. Here's the log.",
    "created_at": "2014-01-08T00:47:21Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192239",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
**Attachment:** [scrimshaw_cywgin64.log](https://github.com/sagemath/sage/files/ticket15317/scrimshaw_cywgin64.log)

FTR It doesn't work for me on Cygwin64. Here's the log.



---

archive/issue_comments_192240.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [tscrim](#comment%3A23):\n> ATLAS built fine for me, but it's failing on pillow. I've attached the log. I'm trying the Cygwin64 now.\n\nThe pillow failure has noting to do with the cahnges here.\nIt is quite easy to fix and is an upstream bug:\n* pillow wants to use some png functions but does not explicitely link to libpng and that's a no go on cygwin (but ok on most other systems).\n* in the log see line 314 \"building 'PIL._imagingft' extension\" and the few next ones",
    "created_at": "2014-01-08T09:50:20Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192240",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:25'></a>
Replying to [tscrim](#comment%3A23):
> ATLAS built fine for me, but it's failing on pillow. I've attached the log. I'm trying the Cygwin64 now.

The pillow failure has noting to do with the cahnges here.
It is quite easy to fix and is an upstream bug:
* pillow wants to use some png functions but does not explicitely link to libpng and that's a no go on cygwin (but ok on most other systems).
* in the log see line 314 "building 'PIL._imagingft' extension" and the few next ones



---

archive/issue_comments_192241.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [tscrim](#comment%3A24):\n> FTR It doesn't work for me on Cygwin64. Here's the log.\n\nIt seems the readline module is not built:\n\n```\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nImportError: No module named readline\n```\nand indeed readline is not found:\n\n```\nchecking how to link readline libs... none\nchecking for rl_callback_handler_install in -lreadline... no\nchecking for rl_pre_input_hook in -lreadline... no\nchecking for rl_completion_display_matches_hook in -lreadline... no\nchecking for rl_completion_matches in -lreadline... no\n```\nCould you post your readline log?\n\nPlease let's go one step at a time, at least now installing python on Cygwin32 works, I'll try to go with the pillow and installing python on Cygwin64 issues on follow up tickets quickly.",
    "created_at": "2014-01-08T09:53:41Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192241",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:26'></a>
Replying to [tscrim](#comment%3A24):
> FTR It doesn't work for me on Cygwin64. Here's the log.

It seems the readline module is not built:

```
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named readline
```
and indeed readline is not found:

```
checking how to link readline libs... none
checking for rl_callback_handler_install in -lreadline... no
checking for rl_pre_input_hook in -lreadline... no
checking for rl_completion_display_matches_hook in -lreadline... no
checking for rl_completion_matches in -lreadline... no
```
Could you post your readline log?

Please let's go one step at a time, at least now installing python on Cygwin32 works, I'll try to go with the pillow and installing python on Cygwin64 issues on follow up tickets quickly.



---

archive/issue_comments_192242.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jpflori](#comment%3A26):\n> Replying to [tscrim](#comment%3A24):\n> > FTR It doesn't work for me on Cygwin64. Here's the log.\n\n> It seems the readline module is not built:\n> \n> ```\n> Traceback (most recent call last):\n>   File \"<string>\", line 1, in <module>\n> ImportError: No module named readline\n> ```\n> and indeed readline is not found:\n> \n> ```\n> checking how to link readline libs... none\n> checking for rl_callback_handler_install in -lreadline... no\n> checking for rl_pre_input_hook in -lreadline... no\n> checking for rl_completion_display_matches_hook in -lreadline... no\n> checking for rl_completion_matches in -lreadline... no\n> ```\n> Could you post your readline log?Atickets quickly.\n\nAlso note this failure surel has nothing to do with the changes here as readline is not detected during the autotools based configuration phase, not the setup.py one which I modified.",
    "created_at": "2014-01-08T09:55:12Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192242",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:27'></a>
Replying to [jpflori](#comment%3A26):
> Replying to [tscrim](#comment%3A24):
> > FTR It doesn't work for me on Cygwin64. Here's the log.

> It seems the readline module is not built:
> 
> ```
> Traceback (most recent call last):
>   File "<string>", line 1, in <module>
> ImportError: No module named readline
> ```
> and indeed readline is not found:
> 
> ```
> checking how to link readline libs... none
> checking for rl_callback_handler_install in -lreadline... no
> checking for rl_pre_input_hook in -lreadline... no
> checking for rl_completion_display_matches_hook in -lreadline... no
> checking for rl_completion_matches in -lreadline... no
> ```
> Could you post your readline log?Atickets quickly.

Also note this failure surel has nothing to do with the changes here as readline is not detected during the autotools based configuration phase, not the setup.py one which I modified.



---

archive/issue_comments_192243.json:
```json
{
    "body": "<a id='comment:28'></a>\nStrangely on my setup, readline seems to have built fine, is detected, but the python fails because of an ICE in GCC.",
    "created_at": "2014-01-08T14:42:13Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192243",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>
Strangely on my setup, readline seems to have built fine, is detected, but the python fails because of an ICE in GCC.



---

archive/issue_comments_192244.json:
```json
{
    "body": "<a id='comment:29'></a>\n(I mean my Cygwin64 setup, with Cygwin's GCC 4.8.2.)",
    "created_at": "2014-01-08T14:43:55Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192244",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>
(I mean my Cygwin64 setup, with Cygwin's GCC 4.8.2.)



---

archive/issue_comments_192245.json:
```json
{
    "body": "<a id='comment:30'></a>\nAfter fixing my ICE on Cygwin64 (using #10572), I oculd build pytohn.",
    "created_at": "2014-01-08T16:56:58Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192245",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:30'></a>
After fixing my ICE on Cygwin64 (using #10572), I oculd build pytohn.



---

archive/issue_events_134870.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134870"
}
```



---

archive/issue_events_134871.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134871"
}
```



---

archive/issue_comments_192246.json:
```json
{
    "body": "<a id='comment:32'></a>\nSorry for the delays, let's get this in.",
    "created_at": "2014-02-02T05:51:29Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192246",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>
Sorry for the delays, let's get this in.



---

archive/issue_comments_192247.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2014-02-02T05:51:29Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192247",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_134872.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-02-02T05:51:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134872"
}
```



---

archive/issue_events_134873.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-02-02T05:51:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134873"
}
```



---

archive/issue_comments_192248.json:
```json
{
    "body": "<a id='comment:33'></a>\nBreaks python build on mod:\n\nhttp://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/25/steps/compile/logs/python",
    "created_at": "2014-02-02T23:01:03Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192248",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
Breaks python build on mod:

http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/25/steps/compile/logs/python



---

archive/issue_comments_192249.json:
```json
{
    "body": "<a id='comment:34'></a>\nAny chance to get the getbuildinfo.c file?\nDoesn't look obvously related, so needs further info.",
    "created_at": "2014-02-03T09:43:12Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192249",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:34'></a>
Any chance to get the getbuildinfo.c file?
Doesn't look obvously related, so needs further info.



---

archive/issue_comments_192250.json:
```json
{
    "body": "<a id='comment:35'></a>\nSorry, the buildbot has already moved on. You'll have to build it yourself.",
    "created_at": "2014-02-03T13:47:10Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192250",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
Sorry, the buildbot has already moved on. You'll have to build it yourself.



---

archive/issue_comments_192251.json:
```json
{
    "body": "<a id='comment:36'></a>\nI just did so ... and the build succeeded.\n\nI merged u/jpflori/ticket/15317 with develop, exported MAKE to something sensible and ran make.\nDoes the buildbot export anything strange before building?",
    "created_at": "2014-02-03T15:46:06Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192251",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:36'></a>
I just did so ... and the build succeeded.

I merged u/jpflori/ticket/15317 with develop, exported MAKE to something sensible and ran make.
Does the buildbot export anything strange before building?



---

archive/issue_comments_192252.json:
```json
{
    "body": "<a id='comment:37'></a>\nHum, here is waht the pytho log says:\n\n```\ngcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IIn\nclude -I./Include  -fPIC -DPy_BUILD_CORE -o Python/graminit.o Python/graminit.c\ngcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IIn\nclude -I./Include  -fPIC -DPy_BUILD_CORE \\\n              -DSVNVERSION=\"\\\"`LC_ALL=C svnversion .`\\\"\" \\\n              -DHGVERSION=\"\\\"`LC_ALL=C hg id -i .`\\\"\" \\\n              -DHGTAG=\"\\\"`LC_ALL=C hg id -t .`\\\"\" \\\n              -DHGBRANCH=\"\\\"`LC_ALL=C hg id -b .`\\\"\" \\\n              -o Modules/getbuildinfo.o ./Modules/getbuildinfo.c\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n```",
    "created_at": "2014-02-03T15:47:28Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192252",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:37'></a>
Hum, here is waht the pytho log says:

```
gcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IIn
clude -I./Include  -fPIC -DPy_BUILD_CORE -o Python/graminit.o Python/graminit.c
gcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IIn
clude -I./Include  -fPIC -DPy_BUILD_CORE \
              -DSVNVERSION="\"`LC_ALL=C svnversion .`\"" \
              -DHGVERSION="\"`LC_ALL=C hg id -i .`\"" \
              -DHGTAG="\"`LC_ALL=C hg id -t .`\"" \
              -DHGBRANCH="\"`LC_ALL=C hg id -b .`\"" \
              -o Modules/getbuildinfo.o ./Modules/getbuildinfo.c
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
```



---

archive/issue_comments_192253.json:
```json
{
    "body": "<a id='comment:38'></a>\nTrying to reinstall python then fails:\n\n```\ngcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IInclude -I./Include  -fPIC -DPy_BUILD_CORE \\\n              -DSVNVERSION=\"\\\"`LC_ALL=C svnversion .`\\\"\" \\\n              -DHGVERSION=\"\\\"`LC_ALL=C hg id -i .`\\\"\" \\\n              -DHGTAG=\"\\\"`LC_ALL=C hg id -t .`\\\"\" \\\n              -DHGBRANCH=\"\\\"`LC_ALL=C hg id -b .`\\\"\" \\\n              -o Modules/getbuildinfo.o ./Modules/getbuildinfo.c\n<command-line>:0:11: warning: missing terminating \" character [enabled by default]\n<command-line>:1:7: warning: missing terminating \" character [enabled by default]\n<command-line>:2:10: warning: missing terminating \" character [enabled by default]\n./Modules/getbuildinfo.c: In function 'Py_GetBuildInfo':\n./Modules/getbuildinfo.c:45:5: error: missing terminating \" character\n./Modules/getbuildinfo.c:45:48: error: expected expression before ')' token\n./Modules/getbuildinfo.c:46:27: error: missing terminating \" character\n./Modules/getbuildinfo.c:46:27: error: missing terminating \" character\n./Modules/getbuildinfo.c:47:28: error: missing terminating \" character\n./Modules/getbuildinfo.c:47:28: error: missing terminating \" character\n./Modules/getbuildinfo.c:53:19: error: 'buildinfo' undeclared (first use in this function)\n./Modules/getbuildinfo.c:53:19: note: each undeclared identifier is reported only once for each function it appears in\n./Modules/getbuildinfo.c: In function '_Py_hgversion':\n./Modules/getbuildinfo.c:72:5: error: missing terminating \" character\n./Modules/getbuildinfo.c:72:5: warning: 'return' with no value, in function returning non-void [-Wreturn-type]\n./Modules/getbuildinfo.c: In function '_Py_hgidentifier':\n./Modules/getbuildinfo.c:79:5: error: missing terminating \" character\n./Modules/getbuildinfo.c:79:18: error: expected expression before ';' token\n./Modules/getbuildinfo.c:83:9: error: missing terminating \" character\n./Modules/getbuildinfo.c:83:24: error: expected expression before ';' token\n./Modules/getbuildinfo.c: In function 'Py_GetBuildInfo':\n./Modules/getbuildinfo.c:57:1: warning: control reaches end of non-void function [-Wreturn-type]\nmake: *** [Modules/getbuildinfo.o] Error 1\n```",
    "created_at": "2014-02-03T15:50:10Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192253",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:38'></a>
Trying to reinstall python then fails:

```
gcc -pthread -c -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall   -I. -IInclude -I./Include  -fPIC -DPy_BUILD_CORE \
              -DSVNVERSION="\"`LC_ALL=C svnversion .`\"" \
              -DHGVERSION="\"`LC_ALL=C hg id -i .`\"" \
              -DHGTAG="\"`LC_ALL=C hg id -t .`\"" \
              -DHGBRANCH="\"`LC_ALL=C hg id -b .`\"" \
              -o Modules/getbuildinfo.o ./Modules/getbuildinfo.c
<command-line>:0:11: warning: missing terminating " character [enabled by default]
<command-line>:1:7: warning: missing terminating " character [enabled by default]
<command-line>:2:10: warning: missing terminating " character [enabled by default]
./Modules/getbuildinfo.c: In function 'Py_GetBuildInfo':
./Modules/getbuildinfo.c:45:5: error: missing terminating " character
./Modules/getbuildinfo.c:45:48: error: expected expression before ')' token
./Modules/getbuildinfo.c:46:27: error: missing terminating " character
./Modules/getbuildinfo.c:46:27: error: missing terminating " character
./Modules/getbuildinfo.c:47:28: error: missing terminating " character
./Modules/getbuildinfo.c:47:28: error: missing terminating " character
./Modules/getbuildinfo.c:53:19: error: 'buildinfo' undeclared (first use in this function)
./Modules/getbuildinfo.c:53:19: note: each undeclared identifier is reported only once for each function it appears in
./Modules/getbuildinfo.c: In function '_Py_hgversion':
./Modules/getbuildinfo.c:72:5: error: missing terminating " character
./Modules/getbuildinfo.c:72:5: warning: 'return' with no value, in function returning non-void [-Wreturn-type]
./Modules/getbuildinfo.c: In function '_Py_hgidentifier':
./Modules/getbuildinfo.c:79:5: error: missing terminating " character
./Modules/getbuildinfo.c:79:18: error: expected expression before ';' token
./Modules/getbuildinfo.c:83:9: error: missing terminating " character
./Modules/getbuildinfo.c:83:24: error: expected expression before ';' token
./Modules/getbuildinfo.c: In function 'Py_GetBuildInfo':
./Modules/getbuildinfo.c:57:1: warning: control reaches end of non-void function [-Wreturn-type]
make: *** [Modules/getbuildinfo.o] Error 1
```



---

archive/issue_comments_192254.json:
```json
{
    "body": "<a id='comment:39'></a>\n/usr/local/bin/hg is broken on mod:\n\n```\n#!/bin/sh\nsage -hg $*\n```\nwhence all the above.\n\nIn particular, once sage(.git) is built, one get:\n\n```\n(sage-sh) jpflori@mod:src$ which hg\n/usr/local/bin/hg\n(sage-sh) jpflori@mod:src$ LC_ALL=C hg id -i .\nsage-run received unknown option: -hg \nusage: sage [options]\nTry 'sage -h' for more information.\n```",
    "created_at": "2014-02-03T15:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192254",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:39'></a>
/usr/local/bin/hg is broken on mod:

```
#!/bin/sh
sage -hg $*
```
whence all the above.

In particular, once sage(.git) is built, one get:

```
(sage-sh) jpflori@mod:src$ which hg
/usr/local/bin/hg
(sage-sh) jpflori@mod:src$ LC_ALL=C hg id -i .
sage-run received unknown option: -hg 
usage: sage [options]
Try 'sage -h' for more information.
```



---

archive/issue_comments_192255.json:
```json
{
    "body": "<a id='comment:40'></a>\nThis ticket is not broken, the `hg` command on `mod` is broken.",
    "created_at": "2014-02-03T15:56:08Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192255",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
This ticket is not broken, the `hg` command on `mod` is broken.



---

archive/issue_comments_192256.json:
```json
{
    "body": "<a id='comment:41'></a>\nHow about\n\n```\n./configure HAS_HG=no SVNVERSION=no [...]\n```",
    "created_at": "2014-02-03T16:18:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192256",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'></a>
How about

```
./configure HAS_HG=no SVNVERSION=no [...]
```



---

archive/issue_comments_192257.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [vbraun](#comment%3A41):\n> How about\n> \n> ```\n> ./configure HAS_HG=no SVNVERSION=no [...]\n> ```\n\nWhy not, but let's do this somewhere else.\nAnd maybe only if SAGE_FAT_BINARY is set or something like that.\nWe cannot deal with every broken systems users may come up with.",
    "created_at": "2014-02-05T10:20:18Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192257",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:42'></a>
Replying to [vbraun](#comment%3A41):
> How about
> 
> ```
> ./configure HAS_HG=no SVNVERSION=no [...]
> ```

Why not, but let's do this somewhere else.
And maybe only if SAGE_FAT_BINARY is set or something like that.
We cannot deal with every broken systems users may come up with.



---

archive/issue_comments_192258.json:
```json
{
    "body": "<a id='comment:43'></a>\nFair enough, but this ticket can't be merged until either mod is un-broken or a workaround is implemented. Or both.",
    "created_at": "2014-02-05T10:50:41Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192258",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'></a>
Fair enough, but this ticket can't be merged until either mod is un-broken or a workaround is implemented. Or both.



---

archive/issue_comments_192259.json:
```json
{
    "body": "<a id='comment:44'></a>\nMaybe William can fix mod (i.e. delete the harmful /usr/local/bin/hg)?",
    "created_at": "2014-02-05T10:52:20Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192259",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:44'></a>
Maybe William can fix mod (i.e. delete the harmful /usr/local/bin/hg)?



---

archive/issue_comments_192260.json:
```json
{
    "body": "<a id='comment:45'></a>\n(And isn't the failure triggered even without this ticket? I mean: just trying to recompile python should fail.)",
    "created_at": "2014-02-05T10:53:35Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192260",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:45'></a>
(And isn't the failure triggered even without this ticket? I mean: just trying to recompile python should fail.)



---

archive/issue_comments_192261.json:
```json
{
    "body": "<a id='comment:46'></a>\nCan you post to the sage.math users mailing list, this is for admin issues.",
    "created_at": "2014-02-05T10:53:36Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192261",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:46'></a>
Can you post to the sage.math users mailing list, this is for admin issues.



---

archive/issue_comments_192262.json:
```json
{
    "body": "<a id='comment:47'></a>\nDone: https://groups.google.com/d/msg/sagemath-users/uMHB5gtlJS8/bKPtZqI-tc0J",
    "created_at": "2014-02-05T11:00:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192262",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:47'></a>
Done: https://groups.google.com/d/msg/sagemath-users/uMHB5gtlJS8/bKPtZqI-tc0J



---

archive/issue_comments_192263.json:
```json
{
    "body": "**Changing branch** from \"[u/jpflori/ticket/15317](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/15317)\" to \"[c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)\".",
    "created_at": "2014-02-14T19:44:52Z",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15317#issuecomment-192263",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jpflori/ticket/15317](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/15317)" to "[c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8](https://github.com/sagemath/sagetrac-mirror/commit/c0a09c5122ffba794a121ad3bdf8fdf5cb96f2c8)".



---

archive/issue_events_134874.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-14T19:44:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134874"
}
```



---

archive/issue_events_134875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "995ae43ce16ced8d5a8bb269c4c538e370bcdceb",
    "created_at": "2014-02-14T19:44:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15317",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15317#event-134875"
}
```
