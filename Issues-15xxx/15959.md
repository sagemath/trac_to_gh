# Issue 15959: The hash function of combinatorial free module elements should depend on the parent

archive/issues_015722.json:
```json
{
    "body": "It would be desirable to make the hash value of (combinatorial) free\nmodule elements depend on the hash value of the parent. However this\ncurrently breaks some code (see\ne.g. sage.combinat.crystals.kyoto_path_model.KyotoPathModel).\n\nThis code indeed assumes, in dictionary look-ups, that an element of\nsome free module over ZZ and its counter part over QQ (in the case at\nhand, the weight lattice and the weight space), comparing as equal\nbecause of a coercion, have the same hash value.\n\nYet another case of equality using coercion being harmful:\nhttp://wiki.sagemath.org/EqualityCoercion\n\n\nCC:  @tscrim @anneschilling\n\nAuthor: Travis Scrimshaw\n\nStatus: new\n\nDependencies: #15931 #16193\n\nIssue created by migration from https://trac.sagemath.org/ticket/15959\n\n",
    "created_at": "2014-03-17T11:17:32Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "The hash function of combinatorial free module elements should depend on the parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15959",
    "user": "https://github.com/nthiery"
}
```
It would be desirable to make the hash value of (combinatorial) free
module elements depend on the hash value of the parent. However this
currently breaks some code (see
e.g. sage.combinat.crystals.kyoto_path_model.KyotoPathModel).

This code indeed assumes, in dictionary look-ups, that an element of
some free module over ZZ and its counter part over QQ (in the case at
hand, the weight lattice and the weight space), comparing as equal
because of a coercion, have the same hash value.

Yet another case of equality using coercion being harmful:
http://wiki.sagemath.org/EqualityCoercion


CC:  @tscrim @anneschilling

Author: Travis Scrimshaw

Status: new

Dependencies: #15931 #16193

Issue created by migration from https://trac.sagemath.org/ticket/15959





---

archive/issue_comments_254940.json:
```json
{
    "body": "<a id='comment:1'></a>\nNicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?",
    "created_at": "2014-03-17T15:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254940",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?



---

archive/issue_comments_254941.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [tscrim](#comment%3A1):\n> Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?\n\n\nSorry, I should have provided steps to reproduce. Checkout branch #15931 at commit a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b, and run the tests on the Kyoto path model.",
    "created_at": "2014-03-17T16:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254941",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>
Replying to [tscrim](#comment%3A1):
> Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?


Sorry, I should have provided steps to reproduce. Checkout branch #15931 at commit a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b, and run the tests on the Kyoto path model.



---

archive/issue_comments_254942.json:
```json
{
    "body": "Changing author from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254942",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Travis Scrimshaw"



---

archive/issue_comments_254943.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tscrim/kyoto_fix-15959\"",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254943",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "u/tscrim/kyoto_fix-15959"



---

archive/issue_comments_254944.json:
```json
{
    "body": "<a id='comment:4'></a>\nI haven't merged in the latest #15931, but instead started with the a2bbe7f297 commit. The fix for the Kyoto path model is that I was passing in elements of the weight space, whereas the `Epsilon()/Phi()` methods returned an element of the weight lattice. I've added an additional check for robustness.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[e8fe5eb](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)|`Trac 15931: implement a proper hash function for (combinatorial) free module elements`|\n|[e6ef605](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)|`Trac 15931: add a `@`cached_method on the new hash function for (combinatorial) free module elements`|\n|[a2bbe7f](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)|`Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements`|\n|[13be620](https://github.com/sagemath/sagetrac-mirror/commit/13be6205f2aeaa0dd6658f96286f5eafbc99addf)|`Merge branch 'develop' into test/15959`|\n|[7bdb017](https://github.com/sagemath/sagetrac-mirror/commit/7bdb017e3e37d52a89d29e262d0b96f3fe831b48)|`Fix for Kyoto path model with hash depending on the parent.`|",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254944",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
I haven't merged in the latest #15931, but instead started with the a2bbe7f297 commit. The fix for the Kyoto path model is that I was passing in elements of the weight space, whereas the `Epsilon()/Phi()` methods returned an element of the weight lattice. I've added an additional check for robustness.

---
New commits:
|                                                                                                                                          |                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[e8fe5eb](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)|`Trac 15931: implement a proper hash function for (combinatorial) free module elements`|
|[e6ef605](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)|`Trac 15931: add a `@`cached_method on the new hash function for (combinatorial) free module elements`|
|[a2bbe7f](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)|`Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements`|
|[13be620](https://github.com/sagemath/sagetrac-mirror/commit/13be6205f2aeaa0dd6658f96286f5eafbc99addf)|`Merge branch 'develop' into test/15959`|
|[7bdb017](https://github.com/sagemath/sagetrac-mirror/commit/7bdb017e3e37d52a89d29e262d0b96f3fe831b48)|`Fix for Kyoto path model with hash depending on the parent.`|



---

archive/issue_comments_254945.json:
```json
{
    "body": "Changing commit from \"\" to \"7bdb017e3e37d52a89d29e262d0b96f3fe831b48\"",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254945",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "7bdb017e3e37d52a89d29e262d0b96f3fe831b48"



---

archive/issue_comments_254946.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#15931\"",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254946",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#15931"



---

archive/issue_comments_254947.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[2c8ba97](https://github.com/sagemath/sagetrac-mirror/commit/2c8ba97ce8903dfcd2c12e50c7ad8b4a12767177)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|\n|[bbf4917](https://github.com/sagemath/sagetrac-mirror/commit/bbf4917f5d054b0fe04d59eee78a1572e9848707)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|",
    "created_at": "2014-04-09T02:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[2c8ba97](https://github.com/sagemath/sagetrac-mirror/commit/2c8ba97ce8903dfcd2c12e50c7ad8b4a12767177)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|
|[bbf4917](https://github.com/sagemath/sagetrac-mirror/commit/bbf4917f5d054b0fe04d59eee78a1572e9848707)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|



---

archive/issue_comments_254948.json:
```json
{
    "body": "Changing commit from \"7bdb017e3e37d52a89d29e262d0b96f3fe831b48\" to \"bbf4917f5d054b0fe04d59eee78a1572e9848707\"",
    "created_at": "2014-04-09T02:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7bdb017e3e37d52a89d29e262d0b96f3fe831b48" to "bbf4917f5d054b0fe04d59eee78a1572e9848707"



---

archive/issue_comments_254949.json:
```json
{
    "body": "Changing commit from \"bbf4917f5d054b0fe04d59eee78a1572e9848707\" to \"e778baf450afa54977060cbc4fe010e4a312507b\"",
    "created_at": "2014-04-15T02:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bbf4917f5d054b0fe04d59eee78a1572e9848707" to "e778baf450afa54977060cbc4fe010e4a312507b"



---

archive/issue_comments_254950.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[e778baf](https://github.com/sagemath/sagetrac-mirror/commit/e778baf450afa54977060cbc4fe010e4a312507b)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|",
    "created_at": "2014-04-15T02:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[e778baf](https://github.com/sagemath/sagetrac-mirror/commit/e778baf450afa54977060cbc4fe010e4a312507b)|`Merge branch 'develop' into u/tscrim/kyoto_fix-15959`|



---

archive/issue_comments_254951.json:
```json
{
    "body": "Changing commit from \"e778baf450afa54977060cbc4fe010e4a312507b\" to \"\"",
    "created_at": "2014-04-20T15:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254951",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "e778baf450afa54977060cbc4fe010e4a312507b" to ""



---

archive/issue_comments_254952.json:
```json
{
    "body": "Changing dependencies from \"#15931\" to \"#15931 #16193\"",
    "created_at": "2014-04-20T15:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254952",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "#15931" to "#15931 #16193"



---

archive/issue_comments_254953.json:
```json
{
    "body": "<a id='comment:7'></a>\nI've merged the branch into #16193 and set that as a dependency.",
    "created_at": "2014-04-20T15:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254953",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
I've merged the branch into #16193 and set that as a dependency.



---

archive/issue_comments_254954.json:
```json
{
    "body": "Changing branch from \"u/tscrim/kyoto_fix-15959\" to \"\"",
    "created_at": "2014-04-20T15:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-254954",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/tscrim/kyoto_fix-15959" to ""



---

archive/issue_events_061239.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-61239"
}
```



---

archive/issue_events_061240.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-61240"
}
```



---

archive/issue_events_061241.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-61241"
}
```
