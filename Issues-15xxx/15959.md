# Issue 15959: The hash function of combinatorial free module elements should depend on the parent

archive/issues_015722.json:
```json
{
    "body": "It would be desirable to make the hash value of (combinatorial) free\nmodule elements depend on the hash value of the parent. However this\ncurrently breaks some code (see\ne.g. sage.combinat.crystals.kyoto_path_model.KyotoPathModel).\n\nThis code indeed assumes, in dictionary look-ups, that an element of\nsome free module over ZZ and its counter part over QQ (in the case at\nhand, the weight lattice and the weight space), comparing as equal\nbecause of a coercion, have the same hash value.\n\nYet another case of equality using coercion being harmful:\nhttp://wiki.sagemath.org/EqualityCoercion\n\n\nCC:  @tscrim @anneschilling\n\nAuthor: Travis Scrimshaw\n\nStatus: new\n\nDependencies: #15931 #16193\n\nIssue created by migration from https://trac.sagemath.org/ticket/15959\n\n",
    "created_at": "2014-03-17T11:17:32Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "The hash function of combinatorial free module elements should depend on the parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15959",
    "user": "https://github.com/nthiery"
}
```
It would be desirable to make the hash value of (combinatorial) free
module elements depend on the hash value of the parent. However this
currently breaks some code (see
e.g. sage.combinat.crystals.kyoto_path_model.KyotoPathModel).

This code indeed assumes, in dictionary look-ups, that an element of
some free module over ZZ and its counter part over QQ (in the case at
hand, the weight lattice and the weight space), comparing as equal
because of a coercion, have the same hash value.

Yet another case of equality using coercion being harmful:
http://wiki.sagemath.org/EqualityCoercion


CC:  @tscrim @anneschilling

Author: Travis Scrimshaw

Status: new

Dependencies: #15931 #16193

Issue created by migration from https://trac.sagemath.org/ticket/15959





---

archive/issue_comments_203272.json:
```json
{
    "body": "<a id='comment:1'></a>Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?",
    "created_at": "2014-03-17T15:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203272",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?



---

archive/issue_comments_203273.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:1 tscrim]:\n> Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?\n\n\nSorry, I should have provided steps to reproduce. Checkout branch #15931 at commit a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b, and run the tests on the Kyoto path model.",
    "created_at": "2014-03-17T16:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203273",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>Replying to [comment:1 tscrim]:
> Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?


Sorry, I should have provided steps to reproduce. Checkout branch #15931 at commit a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b, and run the tests on the Kyoto path model.



---

archive/issue_comments_203274.json:
```json
{
    "body": "<a id='comment:4'></a>I haven't merged in the latest #15931, but instead started with the a2bbe7f297 commit. The fix for the Kyoto path model is that I was passing in elements of the weight space, whereas the `Epsilon()/Phi()` methods returned an element of the weight lattice. I've added an additional check for robustness.\n\n---\nNew commits:",
    "created_at": "2014-03-28T02:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203274",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I haven't merged in the latest #15931, but instead started with the a2bbe7f297 commit. The fix for the Kyoto path model is that I was passing in elements of the weight space, whereas the `Epsilon()/Phi()` methods returned an element of the weight lattice. I've added an additional check for robustness.

---
New commits:



---

archive/issue_comments_203275.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-09T02:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_203276.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T02:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_203277.json:
```json
{
    "body": "<a id='comment:7'></a>I've merged the branch into #16193 and set that as a dependency.",
    "created_at": "2014-04-20T15:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15959#issuecomment-203277",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>I've merged the branch into #16193 and set that as a dependency.



---

archive/issue_events_046936.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-46936"
}
```



---

archive/issue_events_046937.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-46937"
}
```



---

archive/issue_events_046938.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15959",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15959#event-46938"
}
```
