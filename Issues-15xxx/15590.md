# Issue 15590: Pimp my Shell

archive/issues_015353.json:
```json
{
    "body": "This patch reorganizes the \"sage -sh\" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.\n\n```\nSage: desktop 02:53:17 {t/15590/pimp_my_shell|modified} ~/Sage/git\n$ git add .\nSage: desktop 02:53:20 {t/15590/pimp_my_shell|staged} ~/Sage/git\n$ git commit -m 'also display staged as red'\n[t/15590/pimp_my_shell 2678e8d] also display staged as red\n 1 file changed, 36 insertions(+), 30 deletions(-)\nSage: desktop 02:53:35 (t/15590/pimp_my_shell) ~/Sage/git\n$ git st\n```\nbut with colors.\n\nCC:  @novoselt @videlec @orlitzky\n\nAuthor: Volker Braun\n\nBranch: u/jhpalmieri/pimp_my_shell\n\nStatus: needs_work\n\nCommit: 58fa20d2a6f762002cb92d60fd6c564b7d2292a7\n\nIssue created by migration from https://trac.sagemath.org/ticket/15590\n\n",
    "created_at": "2013-12-25T21:07:08Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "Pimp my Shell",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15590",
    "user": "https://github.com/vbraun"
}
```
This patch reorganizes the "sage -sh" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.

```
Sage: desktop 02:53:17 {t/15590/pimp_my_shell|modified} ~/Sage/git
$ git add .
Sage: desktop 02:53:20 {t/15590/pimp_my_shell|staged} ~/Sage/git
$ git commit -m 'also display staged as red'
[t/15590/pimp_my_shell 2678e8d] also display staged as red
 1 file changed, 36 insertions(+), 30 deletions(-)
Sage: desktop 02:53:35 (t/15590/pimp_my_shell) ~/Sage/git
$ git st
```
but with colors.

CC:  @novoselt @videlec @orlitzky

Author: Volker Braun

Branch: u/jhpalmieri/pimp_my_shell

Status: needs_work

Commit: 58fa20d2a6f762002cb92d60fd6c564b7d2292a7

Issue created by migration from https://trac.sagemath.org/ticket/15590





---

archive/issue_comments_210945.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-26T02:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_210946.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2013-12-26T02:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210946",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_210947.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-26T02:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210947",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_210948.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to scripts.",
    "created_at": "2013-12-26T02:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210948",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to scripts.



---

archive/issue_comments_210949.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+This patch reorganizes the \"sage -sh\" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.\n \n Comment: 1\n \n```\n",
    "created_at": "2013-12-26T02:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210949",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+This patch reorganizes the "sage -sh" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.
 
 Comment: 1
 
```




---

archive/issue_comments_210950.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+This patch reorganizes the \"sage -sh\" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.\n \n+\\`\\`\\`\n+Sage: desktop 02:53:17 {t/15590/pimp_my_shell|modified} ~/Sage/git\n+$ git add .\n+Sage: desktop 02:53:20 {t/15590/pimp_my_shell|staged} ~/Sage/git\n+$ git commit -m 'also display staged as red'\n+[t/15590/pimp_my_shell 2678e8d] also display staged as red\n+ 1 file changed, 36 insertions(+), 30 deletions(-)\n+Sage: desktop 02:53:35 (t/15590/pimp_my_shell) ~/Sage/git\n+$ git st\n+\\`\\`\\`\n+but with colors.\n \n Comment: 1\n \n```\n",
    "created_at": "2013-12-26T02:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210950",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,16 @@
+This patch reorganizes the "sage -sh" shell. If you are using bash, it also introduces a PS1 that includes git branch status. This can be very useful for beginners to keep an eye on the repository status.
 
+\`\`\`
+Sage: desktop 02:53:17 {t/15590/pimp_my_shell|modified} ~/Sage/git
+$ git add .
+Sage: desktop 02:53:20 {t/15590/pimp_my_shell|staged} ~/Sage/git
+$ git commit -m 'also display staged as red'
+[t/15590/pimp_my_shell 2678e8d] also display staged as red
+ 1 file changed, 36 insertions(+), 30 deletions(-)
+Sage: desktop 02:53:35 (t/15590/pimp_my_shell) ~/Sage/git
+$ git st
+\`\`\`
+but with colors.
 
 Comment: 1
 
```




---

archive/issue_comments_210951.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-05T21:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_045603.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45603"
}
```



---

archive/issue_comments_210952.json:
```json
{
    "body": "<a id='comment:8'></a>This is not working for me on OS X. On one machine, `$SHELL` is set to `/bin/bash` but I don't get an interesting prompt: I just get `bash-3.2$`. As far as I can tell, this is not loading my `.bashrc` file (I put an echo command in there to see, and nothing is printed). So I don't think it's loading `src/ext/shell/bashrc`, either. On another OS X machine, it's running bash but `$SHELL` is set to `/bin/sh`. I tried making the following changes, but it didn't help: the prompt remained `sh-3.2$`.\n\n```diff\ndiff --git a/src/bin/sage b/src/bin/sage\nindex c01fea2..8770a57 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n@@ -278,6 +278,21 @@ if [ \"$1\" = '-sh' -o \"$1\" = '--sh' ]; then\n             export ZDOTDIR=\"$SAGE_EXTCODE/shell\"\n             set -- \"$SHELL\" -d \"$@\"\n             ;;\n+        sh)\n+            # see http://stackoverflow.com/a/3327022/1401572\n+            if [ -n $BASH ]; then\n+                set -- \"$SHELL\" --rcfile \"$SAGE_EXTCODE/shell/bashrc\" \"$@\"\n+            elif [ -n $ZSH_NAME ]; then\n+                export ZDOTDIR=\"$SAGE_EXTCODE/shell\"\n+                set -- \"$SHELL\" -d \"$@\"\n+            elif [ -n $KSH_VERSION ]; then\n+               export ENV=\"$SAGE_EXTCODE/shell/kshrc\"\n+                set -- \"$SHELL\" \"$@\"\n+            else\n+               source \"$_SAGE_ENV_SCRIPT\"\n+                set -- \"$SHELL\" \"$@\"\n+            fi\n+            ;;\n         *)\n            # We don't know how to specify alternate startup file, you are on your own\n            source \"$_SAGE_ENV_SCRIPT\"\n```\n(I added some echo commands here, too, and it is entering the appropriate case, the `sh` case with `$BASH` set.)",
    "created_at": "2014-01-31T22:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210952",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>This is not working for me on OS X. On one machine, `$SHELL` is set to `/bin/bash` but I don't get an interesting prompt: I just get `bash-3.2$`. As far as I can tell, this is not loading my `.bashrc` file (I put an echo command in there to see, and nothing is printed). So I don't think it's loading `src/ext/shell/bashrc`, either. On another OS X machine, it's running bash but `$SHELL` is set to `/bin/sh`. I tried making the following changes, but it didn't help: the prompt remained `sh-3.2$`.

```diff
diff --git a/src/bin/sage b/src/bin/sage
index c01fea2..8770a57 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -278,6 +278,21 @@ if [ "$1" = '-sh' -o "$1" = '--sh' ]; then
             export ZDOTDIR="$SAGE_EXTCODE/shell"
             set -- "$SHELL" -d "$@"
             ;;
+        sh)
+            # see http://stackoverflow.com/a/3327022/1401572
+            if [ -n $BASH ]; then
+                set -- "$SHELL" --rcfile "$SAGE_EXTCODE/shell/bashrc" "$@"
+            elif [ -n $ZSH_NAME ]; then
+                export ZDOTDIR="$SAGE_EXTCODE/shell"
+                set -- "$SHELL" -d "$@"
+            elif [ -n $KSH_VERSION ]; then
+               export ENV="$SAGE_EXTCODE/shell/kshrc"
+                set -- "$SHELL" "$@"
+            else
+               source "$_SAGE_ENV_SCRIPT"
+                set -- "$SHELL" "$@"
+            fi
+            ;;
         *)
            # We don't know how to specify alternate startup file, you are on your own
            source "$_SAGE_ENV_SCRIPT"
```
(I added some echo commands here, too, and it is entering the appropriate case, the `sh` case with `$BASH` set.)



---

archive/issue_comments_210953.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-01T20:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_210954.json:
```json
{
    "body": "<a id='comment:10'></a>You need to rebuild sage (run \"make\"), because the scripts are loaded from `SAGE_ROOT/local/share/sage/ext/shell` and not from `SAGE_ROOT/src/ext/shell`.\n\nI think if `$SHELL` is not set to bash then you either explicitly don't want bash features used or your OS is old/weird and its doubtful that bash works as it should. Where did you see the `SHELL=/bin/sh` environment?\n\nWhile trying this out I noticed that OSX doesn't support `echo -e` to expand `\\e`, this is now also fixed.",
    "created_at": "2014-02-01T20:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210954",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>You need to rebuild sage (run "make"), because the scripts are loaded from `SAGE_ROOT/local/share/sage/ext/shell` and not from `SAGE_ROOT/src/ext/shell`.

I think if `$SHELL` is not set to bash then you either explicitly don't want bash features used or your OS is old/weird and its doubtful that bash works as it should. Where did you see the `SHELL=/bin/sh` environment?

While trying this out I noticed that OSX doesn't support `echo -e` to expand `\e`, this is now also fixed.



---

archive/issue_comments_210955.json:
```json
{
    "body": "<a id='comment:11'></a>I saw `SHELL=/bin/sh` on one OS X 10.8 machine. It may have to do with how the sysadmins have set up that machine, but that's my shell there. I've also seen some references to this happening on other systems, for example in the [stackoverflow answer](http://stackoverflow.com/a/3327022/1401572) I cited in my patch. (See also [http://stackoverflow.com/q/5166657/1401572](http://stackoverflow.com/q/5166657/1401572), and I'm sure I saw it other places.)\n\nI'm trying again with the new version. Currently running `make`, which is taking a little while...",
    "created_at": "2014-02-02T00:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210955",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>I saw `SHELL=/bin/sh` on one OS X 10.8 machine. It may have to do with how the sysadmins have set up that machine, but that's my shell there. I've also seen some references to this happening on other systems, for example in the [stackoverflow answer](http://stackoverflow.com/a/3327022/1401572) I cited in my patch. (See also [http://stackoverflow.com/q/5166657/1401572](http://stackoverflow.com/q/5166657/1401572), and I'm sure I saw it other places.)

I'm trying again with the new version. Currently running `make`, which is taking a little while...



---

archive/issue_comments_210956.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-02T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_210957.json:
```json
{
    "body": "<a id='comment:13'></a>On a machine with `SHELL=/bin/bash`, it works well. On the machine with `SHELL=/bin/sh`, it is entering the appropriate case (\"`bash)`\"), but the bashrc file in `local/share/sage/ext/shell` is not loaded. If I replace `\"$SHELL\"` with ``command -v bash``, it is loaded \u2014 this is in the line\n\n```\nset -- \"$SHELL\" --rcfile \"$SAGE_EXTCODE/shell/bashrc\" \"$@\"\n```\nIn this case, it works, but not perfectly: the prompt comes out as\n\n```\n\\033]0;palmieri@jpalmieri: ~/Desktop/Sage_stuff/git/sage\\007\\c\nSage: jpalmieri 12:11:42 {new_shell|modified} ~/Desktop/Sage_stuff/git/sage\n$\n```\nwith the middle line appropriately colored. (On the first machine, the prompt looks better: it doesn't include the first line. It's running a slightly newer version of bash, 3.2.51 instead of 3.2.48; it's also running OS X 10.9 instead of 10.8, and as mentioned, it has `SHELL=/bin/bash`.)",
    "created_at": "2014-02-02T20:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210957",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>On a machine with `SHELL=/bin/bash`, it works well. On the machine with `SHELL=/bin/sh`, it is entering the appropriate case ("`bash)`"), but the bashrc file in `local/share/sage/ext/shell` is not loaded. If I replace `"$SHELL"` with ``command -v bash``, it is loaded — this is in the line

```
set -- "$SHELL" --rcfile "$SAGE_EXTCODE/shell/bashrc" "$@"
```
In this case, it works, but not perfectly: the prompt comes out as

```
\033]0;palmieri@jpalmieri: ~/Desktop/Sage_stuff/git/sage\007\c
Sage: jpalmieri 12:11:42 {new_shell|modified} ~/Desktop/Sage_stuff/git/sage
$
```
with the middle line appropriately colored. (On the first machine, the prompt looks better: it doesn't include the first line. It's running a slightly newer version of bash, 3.2.51 instead of 3.2.48; it's also running OS X 10.9 instead of 10.8, and as mentioned, it has `SHELL=/bin/bash`.)



---

archive/issue_comments_210958.json:
```json
{
    "body": "<a id='comment:14'></a>It may be that there is no good way to deal with `bash` if it is run as `/bin/sh`, I don't know. A different question, though: if I don't like the bash prompt defined like this, can I override it? Should we load `$DOT_SAGE/bashrc` or some similarly named file at the end of `local/share/sage/ext/shell/bashrc`?",
    "created_at": "2014-02-03T20:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210958",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>It may be that there is no good way to deal with `bash` if it is run as `/bin/sh`, I don't know. A different question, though: if I don't like the bash prompt defined like this, can I override it? Should we load `$DOT_SAGE/bashrc` or some similarly named file at the end of `local/share/sage/ext/shell/bashrc`?



---

archive/issue_comments_210959.json:
```json
{
    "body": "<a id='comment:15'></a>You don't have to use the sage shell at all. I never use it. But imho we should offer something nice for those that don't want to customize their own shell prompt. \n\nBut to be on the safe side I think we should just fall back to something safe if SHELL is not set to /bin/bash.",
    "created_at": "2014-02-03T20:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210959",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>You don't have to use the sage shell at all. I never use it. But imho we should offer something nice for those that don't want to customize their own shell prompt. 

But to be on the safe side I think we should just fall back to something safe if SHELL is not set to /bin/bash.



---

archive/issue_comments_210960.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-03T20:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_210961.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 vbraun]:\n> You don't have to use the sage shell at all. I never use it. But imho we should offer something nice for those that don't want to customize their own shell prompt. \n\n\nMy point is that in my .bashrc file, I've already customized my shell prompt for use with `sage -sh`, and these changes override my customizations. It seems bad to force a choice of prompt on users. (I'm talking about the machines where `SHELL=/bin/bash`, by the way.)\n\n---\nNew commits:",
    "created_at": "2014-02-03T20:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210961",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>Replying to [comment:15 vbraun]:
> You don't have to use the sage shell at all. I never use it. But imho we should offer something nice for those that don't want to customize their own shell prompt. 


My point is that in my .bashrc file, I've already customized my shell prompt for use with `sage -sh`, and these changes override my customizations. It seems bad to force a choice of prompt on users. (I'm talking about the machines where `SHELL=/bin/bash`, by the way.)

---
New commits:



---

archive/issue_comments_210962.json:
```json
{
    "body": "<a id='comment:18'></a>Thats what I'm talking about, if you like the way you have set up your shell then just don't use the Sage shell. This ticket doesn't change the fact that the Sage shell overrides the prompt, it just overrides it with a nicer prompt. I dont' see a reliable way to figure out if the prompt has already been changed away from the default, there are many different \"defaults\" that distros set up.",
    "created_at": "2014-02-03T21:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210962",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>Thats what I'm talking about, if you like the way you have set up your shell then just don't use the Sage shell. This ticket doesn't change the fact that the Sage shell overrides the prompt, it just overrides it with a nicer prompt. I dont' see a reliable way to figure out if the prompt has already been changed away from the default, there are many different "defaults" that distros set up.



---

archive/issue_comments_210963.json:
```json
{
    "body": "<a id='comment:19'></a>Sometimes if I'm trying to debug on spkg, I want to go to `local/var/tmp/sage/build/...` and then run `make` or `configure` or whatever, and it's convenient to be running the Sage shell before doing this. That is, `sage -sh` is a useful tool. I don't want to be dissuaded from using it because I dislike the new prompt. So why not put something like this at the bottom of the proposed Sage bashrc file:\n\n```sh\nif [ -f \"$DOT_SAGE/bashrc\" ]; then\n    . \"$DOT_SAGE/bashrc\"\nfi\n```",
    "created_at": "2014-02-03T21:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210963",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>Sometimes if I'm trying to debug on spkg, I want to go to `local/var/tmp/sage/build/...` and then run `make` or `configure` or whatever, and it's convenient to be running the Sage shell before doing this. That is, `sage -sh` is a useful tool. I don't want to be dissuaded from using it because I dislike the new prompt. So why not put something like this at the bottom of the proposed Sage bashrc file:

```sh
if [ -f "$DOT_SAGE/bashrc" ]; then
    . "$DOT_SAGE/bashrc"
fi
```



---

archive/issue_comments_210964.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-03T21:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_210965.json:
```json
{
    "body": "<a id='comment:21'></a>Sounds good to me...",
    "created_at": "2014-02-03T21:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210965",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Sounds good to me...



---

archive/issue_events_045604.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45604"
}
```



---

archive/issue_events_045605.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45605"
}
```



---

archive/issue_events_045606.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45606"
}
```



---

archive/issue_events_045607.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45607"
}
```



---

archive/issue_comments_210966.json:
```json
{
    "body": "<a id='comment:24'></a>I use a much shorter function in my zshrc to set up the git status, the\nidea being that the shell should be fast in initialization and in returning\nthe prompt. So, the only command that is run is `git status` and everything\nelse is gleaned from that using shell operations. Also, I use `RPROMPT` so\nthat the left prompt is short. The `RPROMPT` disappears automatically once\nthe user starts typing too long commands.\n\n```sh\nfunction __check_git__() {\n    local _s=\"$( git status 2>&1 )\"\n    [[ \"${_s}\" = \"fatal:\"* ]] && echo \"\" && return\n    _s=\"$( echo \"${_s}\" | sed -e '/^#.*modified:.*(untracked content)$/d' )\"\n    local _g_s=\"$( echo \"$_s\" | sed -n -e '1s@^On branch @@p;q' )\"\n\n    if [[   \"$_s\" = *modified:*                 || \\\n            \"$_s\" = *\"new file:\"*               || \\\n            \"$_s\" = *\"Your branch is behind\"*   || \\\n            \"$_s\" = *deleted:*                  || \\\n            \"$_s\" = *renamed:*                     \\\n         ]]; then\n        echo \"[%20>...>%{$fg[red]%}$_g_s%{$fg[white]%}%>>]\"\n    elif [[ -n \"$_g_s\" ]]; then\n        echo \"[%20>...>%{$fg[green]%}$_g_s%{$fg[white]%}%>>]\"\n    else\n        echo \"%{$fg[yellow]%}[?]%{$fg[white]%}\"\n    fi\n}\n\nRPROMPT=\"%{$fg[white]%}\u2022$(__check_git__)%{$fg[cyan]%}%n%{$fg[white]%}|%{$fg[green]%}%m%{$reset_color%}\"\n```",
    "created_at": "2014-12-20T21:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210966",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:24'></a>I use a much shorter function in my zshrc to set up the git status, the
idea being that the shell should be fast in initialization and in returning
the prompt. So, the only command that is run is `git status` and everything
else is gleaned from that using shell operations. Also, I use `RPROMPT` so
that the left prompt is short. The `RPROMPT` disappears automatically once
the user starts typing too long commands.

```sh
function __check_git__() {
    local _s="$( git status 2>&1 )"
    [[ "${_s}" = "fatal:"* ]] && echo "" && return
    _s="$( echo "${_s}" | sed -e '/^#.*modified:.*(untracked content)$/d' )"
    local _g_s="$( echo "$_s" | sed -n -e '1s@^On branch @@p;q' )"

    if [[   "$_s" = *modified:*                 || \
            "$_s" = *"new file:"*               || \
            "$_s" = *"Your branch is behind"*   || \
            "$_s" = *deleted:*                  || \
            "$_s" = *renamed:*                     \
         ]]; then
        echo "[%20>...>%{$fg[red]%}$_g_s%{$fg[white]%}%>>]"
    elif [[ -n "$_g_s" ]]; then
        echo "[%20>...>%{$fg[green]%}$_g_s%{$fg[white]%}%>>]"
    else
        echo "%{$fg[yellow]%}[?]%{$fg[white]%}"
    fi
}

RPROMPT="%{$fg[white]%}•$(__check_git__)%{$fg[cyan]%}%n%{$fg[white]%}|%{$fg[green]%}%m%{$reset_color%}"
```



---

archive/issue_comments_210967.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-21T16:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210967",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_210968.json:
```json
{
    "body": "<a id='comment:27'></a>Rebased.\n\n---\nNew commits:",
    "created_at": "2016-04-25T20:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210968",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>Rebased.

---
New commits:



---

archive/issue_comments_210969.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-25T20:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210969",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_210970.json:
```json
{
    "body": "<a id='comment:29'></a>Somehow, I do not get colors here but only an inverted prompt. It seems that `tput colors` does not return 0 whereas `tput rev` does. That is strange since `tput colors` does return 0 if I invoke it manually. I have not had a chance to debug this further. The changes seem fine to me and I think they could be a positive review even if it does not work for me (maybe my setup is just somehow screwed up.)",
    "created_at": "2016-06-20T17:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210970",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:29'></a>Somehow, I do not get colors here but only an inverted prompt. It seems that `tput colors` does not return 0 whereas `tput rev` does. That is strange since `tput colors` does return 0 if I invoke it manually. I have not had a chance to debug this further. The changes seem fine to me and I think they could be a positive review even if it does not work for me (maybe my setup is just somehow screwed up.)



---

archive/issue_comments_210971.json:
```json
{
    "body": "<a id='comment:30'></a>This still is set as open for review. Is it so?",
    "created_at": "2019-04-17T05:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210971",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>This still is set as open for review. Is it so?



---

archive/issue_comments_210972.json:
```json
{
    "body": "<a id='comment:31'></a>I don't think I will work on it, but feel free to take a look if it interests you. If it looks worthwhile, maybe it will revive my interest.",
    "created_at": "2019-04-17T17:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210972",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>I don't think I will work on it, but feel free to take a look if it interests you. If it looks worthwhile, maybe it will revive my interest.



---

archive/issue_events_045608.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-17T20:09:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45608"
}
```



---

archive/issue_events_045609.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-17T20:09:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15590#event-45609"
}
```



---

archive/issue_comments_210973.json:
```json
{
    "body": "<a id='comment:33'></a>It definitely looks neat.  Is there any serious problem remaining on this, or just bikeshedding about how to support every shell under the sun?",
    "created_at": "2019-06-15T18:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210973",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>It definitely looks neat.  Is there any serious problem remaining on this, or just bikeshedding about how to support every shell under the sun?



---

archive/issue_comments_210974.json:
```json
{
    "body": "<a id='comment:34'></a>No one has touched it in 3 years, but I think it was in okay shape then. It might be better to do this one shell at a time, letting people who actually use `ksh`, `zsh`, etc., implement and test. I don't care that much about it, in any case.",
    "created_at": "2019-06-17T02:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210974",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>No one has touched it in 3 years, but I think it was in okay shape then. It might be better to do this one shell at a time, letting people who actually use `ksh`, `zsh`, etc., implement and test. I don't care that much about it, in any case.



---

archive/issue_comments_210975.json:
```json
{
    "body": "<a id='comment:35'></a>The naming scheme looks inconsistent:\n\n```\nsrc/ext/shell/.zshrc\t\nsrc/ext/shell/bashrc\nsrc/ext/shell/kshrc\n```\nAny reason for it?\n\nAs to zsh, it is coming in macos 10.15, so it's getting more users soon...",
    "created_at": "2019-06-17T09:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210975",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>The naming scheme looks inconsistent:

```
src/ext/shell/.zshrc	
src/ext/shell/bashrc
src/ext/shell/kshrc
```
Any reason for it?

As to zsh, it is coming in macos 10.15, so it's getting more users soon...



---

archive/issue_comments_210976.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 dimpase]:\n> The naming scheme looks inconsistent:\n> \n> ```\n> src/ext/shell/.zshrc\t\n> src/ext/shell/bashrc\n> src/ext/shell/kshrc\n> ```\n> Any reason for it?\n\n\nIt was like 5 years ago. I have no idea.\n \n> As to zsh, it is coming in macos 10.15, so it's getting more users soon...",
    "created_at": "2019-06-17T17:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210976",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>Replying to [comment:35 dimpase]:
> The naming scheme looks inconsistent:
> 
> ```
> src/ext/shell/.zshrc	
> src/ext/shell/bashrc
> src/ext/shell/kshrc
> ```
> Any reason for it?


It was like 5 years ago. I have no idea.
 
> As to zsh, it is coming in macos 10.15, so it's getting more users soon...



---

archive/issue_comments_210977.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-20T21:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210977",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_210978.json:
```json
{
    "body": "<a id='comment:38'></a>I rather like my PS1 the way it is; this should be optional at a minimum.\n\nUltimately I don't think we should be adding more internet bling bling into the sagemath codebase at this point. Anyone who wants this can enable it himself by following e.g.\n\n  https://git-scm.com/book/uz/v2/Appendix-A%3A-Git-in-Other-Environments-Git-in-Bash\n\nwhich is \"trivial\" to do and works in zsh as well.",
    "created_at": "2021-11-20T21:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15590#issuecomment-210978",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:38'></a>I rather like my PS1 the way it is; this should be optional at a minimum.

Ultimately I don't think we should be adding more internet bling bling into the sagemath codebase at this point. Anyone who wants this can enable it himself by following e.g.

  https://git-scm.com/book/uz/v2/Appendix-A%3A-Git-in-Other-Environments-Git-in-Bash

which is "trivial" to do and works in zsh as well.
