# Issue 15619: Pickling of immutable graphs

archive/issues_015382.json:
```json
{
    "assignees": [],
    "body": "Before\n\n```\nsage: g=Graph(graphs.PetersenGraph(),immutable=True)\nsage: g == loads(dumps(g))\n...\nTypeError: __cinit__() takes exactly 1 positional argument (0 given)\n```\n\nAfter\n\n```\nsage: g=Graph(graphs.PetersenGraph(),immutable=True)\nsage: g == loads(dumps(g))\nTrue\n```\n\nDepends on #15603\n\nCC:  @simon-king-jena\n\nBranch/Commit: **[public/15619](https://github.com/sagemath/sagetrac-mirror/tree/public/15619) @ [e761346](https://github.com/sagemath/sagetrac-mirror/commit/e761346c888f8ef6f5dd5b43f52b20d23fef500c)**\n\nReviewer: **Simon King**\n\nAuthor: **Nathann Cohen**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15619_\n\n",
    "closed_at": "2014-01-05T02:56:50Z",
    "created_at": "2014-01-02T10:31:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Pickling of immutable graphs",
    "type": "issue",
    "updated_at": "2014-01-05T02:56:50Z",
    "url": "https://github.com/sagemath/sage/issues/15619",
    "user": "https://github.com/nathanncohen"
}
```
Before

```
sage: g=Graph(graphs.PetersenGraph(),immutable=True)
sage: g == loads(dumps(g))
...
TypeError: __cinit__() takes exactly 1 positional argument (0 given)
```

After

```
sage: g=Graph(graphs.PetersenGraph(),immutable=True)
sage: g == loads(dumps(g))
True
```

Depends on #15603

CC:  @simon-king-jena

Branch/Commit: **[public/15619](https://github.com/sagemath/sagetrac-mirror/tree/public/15619) @ [e761346](https://github.com/sagemath/sagetrac-mirror/commit/e761346c888f8ef6f5dd5b43f52b20d23fef500c)**

Reviewer: **Simon King**

Author: **Nathann Cohen**

_Issue created by migration from https://trac.sagemath.org/ticket/15619_





---

archive/issue_events_205315.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-02T10:31:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205315"
}
```



---

archive/issue_events_205316.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-02T10:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205316"
}
```



---

archive/issue_events_205317.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-02T10:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205317"
}
```



---

archive/issue_events_205318.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-02T10:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205318"
}
```



---

archive/issue_events_205319.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-02T10:34:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205319"
}
```



---

archive/issue_comments_198508.json:
```json
{
    "body": "Branch: **[u/ncohen/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/15619)**",
    "created_at": "2014-01-02T10:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198508",
    "user": "https://github.com/nathanncohen"
}
```

Branch: **[u/ncohen/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/15619)**



---

archive/issue_comments_198509.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0229348\">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7860f39\">7860f39</a></td><td><code>trac #15603: \"immutable=True\" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2525d22\">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30\">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94\">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51d6328\">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77\">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07bad46\">07bad46</a></td><td><code>Merge branch 'u/ncohen/15491' of git://trac.sagemath.org/sage into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/126b036\">126b036</a></td><td><code>Merge branch 'master' into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c774057\">c774057</a></td><td><code>Prepare hash and copy for immutable graphs. Let .weighted() respect mutability.</code></td></tr></table>\n",
    "created_at": "2014-01-02T10:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198509",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2" align="right">Comment 2</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0229348">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7860f39">7860f39</a></td><td><code>trac #15603: "immutable=True" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2525d22">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51d6328">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07bad46">07bad46</a></td><td><code>Merge branch 'u/ncohen/15491' of git://trac.sagemath.org/sage into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/126b036">126b036</a></td><td><code>Merge branch 'master' into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c774057">c774057</a></td><td><code>Prepare hash and copy for immutable graphs. Let .weighted() respect mutability.</code></td></tr></table>




---

archive/issue_comments_198510.json:
```json
{
    "body": "Commit: **[0229348](https://github.com/sagemath/sagetrac-mirror/commit/02293487b6268d373896d4c18b0a41a54ef36acd)**",
    "created_at": "2014-01-02T10:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198510",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[0229348](https://github.com/sagemath/sagetrac-mirror/commit/02293487b6268d373896d4c18b0a41a54ef36acd)**



---

archive/issue_comments_198511.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nI am not convinced that creating a graph in order to pickle a backend is the best possible solution. So, I'll do some further experiments with a reduce method for graphs---no need for you to worry about it at this point...",
    "created_at": "2014-01-02T10:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198511",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">Comment 3</div>

I am not convinced that creating a graph in order to pickle a backend is the best possible solution. So, I'll do some further experiments with a reduce method for graphs---no need for you to worry about it at this point...



---

archive/issue_comments_198512.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nOf course not, it is indeed ugly code, and my point is that I write ugly code because I am forced by a machine to write code for which I have no personal use `:-P`\n\nYet it passes those stupid tests, and for this I am grateful. Right now I am fighting with \"Poset.promotion\", and I have noooooooo idea on earth of where the broken doctests are coming from `O_o`\n\nNathann",
    "created_at": "2014-01-02T10:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198512",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">Comment 4</div>

Of course not, it is indeed ugly code, and my point is that I write ugly code because I am forced by a machine to write code for which I have no personal use `:-P`

Yet it passes those stupid tests, and for this I am grateful. Right now I am fighting with "Poset.promotion", and I have noooooooo idea on earth of where the broken doctests are coming from `O_o`

Nathann



---

archive/issue_comments_198513.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nIt does minimize the amount of code necessary for such a function, though. And clear code is good by itself `:-P`\n\nNathann",
    "created_at": "2014-01-02T11:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198513",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:5" align="right">Comment 5</div>

It does minimize the amount of code necessary for such a function, though. And clear code is good by itself `:-P`

Nathann



---

archive/issue_comments_198514.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@nathanncohen](#comment%3A4):\n> Of course not, it is indeed ugly code, and my point is that I write ugly code because I am forced by a machine to write code for which I have no personal use `:-P`\n\nSage is a community project after all.",
    "created_at": "2014-01-02T11:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198514",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@nathanncohen](#comment%3A4):
> Of course not, it is indeed ugly code, and my point is that I write ugly code because I am forced by a machine to write code for which I have no personal use `:-P`

Sage is a community project after all.



---

archive/issue_comments_198515.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI don't see the relationship `O_o`",
    "created_at": "2014-01-02T11:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198515",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:7" align="right">Comment 7</div>

I don't see the relationship `O_o`



---

archive/issue_comments_198516.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nWhat do you think about the following way to pickle generic graphs?\n\n```\n    def __reduce__(self):\n        # copy the dict\n        D = dict(self.__dict__.iteritems())\n        # remove something that may not be picklable\n        try:\n            del D['_backend']\n        except KeyError:\n            pass\n        return type(self), (self.edges(),), D\n```\nIs this elegant enough for you? Additional bait: We may even remove the existing `__reduce__` methods of the other backends `;-)`",
    "created_at": "2014-01-02T11:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198516",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">Comment 8</div>

What do you think about the following way to pickle generic graphs?

```
    def __reduce__(self):
        # copy the dict
        D = dict(self.__dict__.iteritems())
        # remove something that may not be picklable
        try:
            del D['_backend']
        except KeyError:
            pass
        return type(self), (self.edges(),), D
```
Is this elegant enough for you? Additional bait: We may even remove the existing `__reduce__` methods of the other backends `;-)`



---

archive/issue_comments_198517.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nPS: With the above `__reduce__` method put into sage.graphs.generic_graph.py, one has\n\n```\nsage: G = graphs.PetersenGraph()\nsage: g = G.copy(data_structure='static_sparse')\nsage: loads(dumps(g))\nGraph on 10 vertices\nsage: g == _\nTrue\n```",
    "created_at": "2014-01-02T11:35:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198517",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">Comment 9</div>

PS: With the above `__reduce__` method put into sage.graphs.generic_graph.py, one has

```
sage: G = graphs.PetersenGraph()
sage: g = G.copy(data_structure='static_sparse')
sage: loads(dumps(g))
Graph on 10 vertices
sage: g == _
True
```



---

archive/issue_comments_198518.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nSome little timing:\n\nYour way of pickling:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: g = G.copy(data_structure='static_sparse')\nsage: %timeit h = loads(dumps(g))\n1000 loops, best of 3: 1.11 ms per loop\n```\n\nMy way of pickling:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: g = G.copy(data_structure='static_sparse')\nsage: %timeit h = loads(dumps(g))\n1000 loops, best of 3: 493 us per loop\n```\n`:-P`",
    "created_at": "2014-01-02T11:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198518",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">Comment 10</div>

Some little timing:

Your way of pickling:

```
sage: G = graphs.PetersenGraph()
sage: g = G.copy(data_structure='static_sparse')
sage: %timeit h = loads(dumps(g))
1000 loops, best of 3: 1.11 ms per loop
```

My way of pickling:

```
sage: G = graphs.PetersenGraph()
sage: g = G.copy(data_structure='static_sparse')
sage: %timeit h = loads(dumps(g))
1000 loops, best of 3: 493 us per loop
```
`:-P`



---

archive/issue_comments_198519.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nOn the other hand, I think I did something severely wrong:\n\n```\nsage:  h = loads(dumps(g))\nsage: type(h._backend)\n<class 'sage.graphs.base.sparse_graph.SparseGraphBackend'>\n```\nBad. So, it doesn't work in the way I thought...",
    "created_at": "2014-01-02T11:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198519",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">Comment 11</div>

On the other hand, I think I did something severely wrong:

```
sage:  h = loads(dumps(g))
sage: type(h._backend)
<class 'sage.graphs.base.sparse_graph.SparseGraphBackend'>
```
Bad. So, it doesn't work in the way I thought...



---

archive/issue_comments_198520.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nWould it be possible to let the static graph backend `__init__` accept a list of edges rather than a graph? Then, your `__reduce__` method could be simplified (and actually it seems odd that the creation of a graph *backend* needs a graph!).",
    "created_at": "2014-01-02T12:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198520",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">Comment 12</div>

Would it be possible to let the static graph backend `__init__` accept a list of edges rather than a graph? Then, your `__reduce__` method could be simplified (and actually it seems odd that the creation of a graph *backend* needs a graph!).



---

archive/issue_comments_198521.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nHm. I tried to understand what happens when one creates a static sparse backend.\n\nI always thought that one needs a backend to implement a graph. But in fact `__init__` and `__cinit__` and `init_short_digraph` (which are all involved in the creation of a static sparse backend) rely on the input being a graph. `:-/`",
    "created_at": "2014-01-02T12:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198521",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">Comment 13</div>

Hm. I tried to understand what happens when one creates a static sparse backend.

I always thought that one needs a backend to implement a graph. But in fact `__init__` and `__cinit__` and `init_short_digraph` (which are all involved in the creation of a static sparse backend) rely on the input being a graph. `:-/`



---

archive/issue_comments_198522.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nWell, that can be changed too at some point if it is really needed (I would personally hate to change all this code just because the guy who implemented TestSuite decide for everybody that all the graphs classes HE tested should be picklable), but building a graph is not such a trivial matter. Because you have labels of not, because you have multiple edges or not, because the labels can be integers, have labels, because you can have loops, because they can be oriented or not.\n\nI mean, that's actually a lot of stuff, and it's not funny to implement it so many times in the code. It's already *VERY* messy in the `Graph`/`DiGraph` constructors.\n\nHonestly, I don't think pickling really needs any amount of efficient code. So as we are just implementing it to make the testsuite happy, and unless you want to mess with all this code just because of that, let's use it. It's short and it works. It's bad code of course, because pickling is bad work. It's a generic way to store data, that should work regardless of what the data is. It's like XML. Saving data is not something that should be done without *knowing* what the data is. If you want to write generic code for this, it will end up being bad code.\n\nAnyway. The only problem I would like to see solved is to have Posets use a static data structure. That would make them both faster and lighter. And I think something should be done about the time complexity of the `Graph`/`DiGraph` constructor too.\n\nLet's move on. Can you help me with this promotion bug ? I have no idea of how it should be solved, and it seems to be the last step before having the Posets use a static backend.\n\nNathann",
    "created_at": "2014-01-02T12:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198522",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:14" align="right">Comment 14</div>

Well, that can be changed too at some point if it is really needed (I would personally hate to change all this code just because the guy who implemented TestSuite decide for everybody that all the graphs classes HE tested should be picklable), but building a graph is not such a trivial matter. Because you have labels of not, because you have multiple edges or not, because the labels can be integers, have labels, because you can have loops, because they can be oriented or not.

I mean, that's actually a lot of stuff, and it's not funny to implement it so many times in the code. It's already *VERY* messy in the `Graph`/`DiGraph` constructors.

Honestly, I don't think pickling really needs any amount of efficient code. So as we are just implementing it to make the testsuite happy, and unless you want to mess with all this code just because of that, let's use it. It's short and it works. It's bad code of course, because pickling is bad work. It's a generic way to store data, that should work regardless of what the data is. It's like XML. Saving data is not something that should be done without *knowing* what the data is. If you want to write generic code for this, it will end up being bad code.

Anyway. The only problem I would like to see solved is to have Posets use a static data structure. That would make them both faster and lighter. And I think something should be done about the time complexity of the `Graph`/`DiGraph` constructor too.

Let's move on. Can you help me with this promotion bug ? I have no idea of how it should be solved, and it seems to be the last step before having the Posets use a static backend.

Nathann



---

archive/issue_comments_198523.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@nathanncohen](#comment%3A14):\n> but building a graph is not such a trivial matter. Because you have labels of not, because you have multiple edges or not, because the labels can be integers, have labels, because you can have loops, because they can be oriented or not.\n\nRight. This is in fact a strong argument for implementing the pickling in the way you did. All these optional arguments of `(Di)Graph.__init__` are a mess.\n\n> Honestly, I don't think pickling really needs any amount of efficient code.\n\nThat's a valid point, too. Efficient pickling mainly plays a role if *copying* is implemented by pickling, since this may happen interactively and frequently. But we have a separate and hopefully efficient implementation of `__copy__`, and thus `__reduce__` is really only involved when people want to store a poset (and hence, an immutable graph, and thus, a static sparse backend) into a file. So, spending some milli seconds seems acceptable.\n\n> So as we are just implementing it to make the testsuite happy, and unless you want to mess with all this code just because of that, let's use it. It's short and it works. It's bad code of course, because pickling is bad work. It's a generic way to store data, that should work regardless of what the data is. It's like XML. Saving data is not something that should be done without *knowing* what the data is.\n\nCareful! You are just arguing that the person who knows the data structure best (i.e., you) is responsible for making pickling work `:-)`\n\n> If you want to write generic code for this, it will end up being bad code.\n\nCorrect. Sometimes generic code just works, but in some cases `__reduce__` needs to be provided. Wonderful that Python is object oriented and lets us do such things...\n\n> Anyway. The only problem I would like to see solved is to have Posets use a static data structure. That would make them both faster and lighter. And I think something should be done about the time complexity of the `Graph`/`DiGraph` constructor too.\n\nHere or on a different ticket?\n\n> Let's move on. Can you help me with this promotion bug ?\n\nOK. So, I'll review your pickling approach, and in the meantime you point me to your branch for \"making posets use immutable graphs\", so that I can test the promotion bug.",
    "created_at": "2014-01-02T13:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198523",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@nathanncohen](#comment%3A14):
> but building a graph is not such a trivial matter. Because you have labels of not, because you have multiple edges or not, because the labels can be integers, have labels, because you can have loops, because they can be oriented or not.

Right. This is in fact a strong argument for implementing the pickling in the way you did. All these optional arguments of `(Di)Graph.__init__` are a mess.

> Honestly, I don't think pickling really needs any amount of efficient code.

That's a valid point, too. Efficient pickling mainly plays a role if *copying* is implemented by pickling, since this may happen interactively and frequently. But we have a separate and hopefully efficient implementation of `__copy__`, and thus `__reduce__` is really only involved when people want to store a poset (and hence, an immutable graph, and thus, a static sparse backend) into a file. So, spending some milli seconds seems acceptable.

> So as we are just implementing it to make the testsuite happy, and unless you want to mess with all this code just because of that, let's use it. It's short and it works. It's bad code of course, because pickling is bad work. It's a generic way to store data, that should work regardless of what the data is. It's like XML. Saving data is not something that should be done without *knowing* what the data is.

Careful! You are just arguing that the person who knows the data structure best (i.e., you) is responsible for making pickling work `:-)`

> If you want to write generic code for this, it will end up being bad code.

Correct. Sometimes generic code just works, but in some cases `__reduce__` needs to be provided. Wonderful that Python is object oriented and lets us do such things...

> Anyway. The only problem I would like to see solved is to have Posets use a static data structure. That would make them both faster and lighter. And I think something should be done about the time complexity of the `Graph`/`DiGraph` constructor too.

Here or on a different ticket?

> Let's move on. Can you help me with this promotion bug ?

OK. So, I'll review your pickling approach, and in the meantime you point me to your branch for "making posets use immutable graphs", so that I can test the promotion bug.



---

archive/issue_comments_198524.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nJust for completeness: It would also be possible to say \"graphs do not want being pickled\", which would force all structures that use graphs to implement their own pickling by storing the defining data of the graphs they use, rather than storing these graphs directly.\n\nHence, one could provide Poset with a custom `__reduce__` method that just stores the list of edges of the graph, rather than the graph itself. However, I think in the long run it would be better if graphs knew how to save themselves.",
    "created_at": "2014-01-02T13:46:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198524",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:16" align="right">Comment 16</div>

Just for completeness: It would also be possible to say "graphs do not want being pickled", which would force all structures that use graphs to implement their own pickling by storing the defining data of the graphs they use, rather than storing these graphs directly.

Hence, one could provide Poset with a custom `__reduce__` method that just stores the list of edges of the graph, rather than the graph itself. However, I think in the long run it would be better if graphs knew how to save themselves.



---

archive/issue_comments_198525.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nWell. So what do we do with this commit ? Is it good for you ? And more importantly, what do we do with this bug in `linear_extensions.py` in the u/ncohen/tmp branch ? `:-/`\n\nNathann",
    "created_at": "2014-01-02T13:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198525",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">Comment 17</div>

Well. So what do we do with this commit ? Is it good for you ? And more importantly, what do we do with this bug in `linear_extensions.py` in the u/ncohen/tmp branch ? `:-/`

Nathann



---

archive/issue_comments_198526.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThis one seems to be the underlying reason for the problems with posets:\n\n```\nsage: uc = [[2,3], [], [1], [1], [1], [3,4]]\nsage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]), data_structure=\"static_sparse\")\nsage: loads(dumps(D)) == D\nFalse\n```",
    "created_at": "2014-01-02T19:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198526",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">Comment 18</div>

This one seems to be the underlying reason for the problems with posets:

```
sage: uc = [[2,3], [], [1], [1], [1], [3,4]]
sage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]), data_structure="static_sparse")
sage: loads(dumps(D)) == D
False
```



---

archive/issue_comments_198527.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nThe pickling result is in fact seriously wrong:\n\n```\nsage: d = loads(dumps(D))\nsage: d.edges()\n[(0, 2, None), (0, 3, None)]\nsage: D.edges()\n[(0, 2, None),\n (0, 3, None),\n (2, 1, None),\n (3, 1, None),\n (4, 1, None),\n (5, 3, None),\n (5, 4, None)]\n```",
    "created_at": "2014-01-02T19:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198527",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">Comment 19</div>

The pickling result is in fact seriously wrong:

```
sage: d = loads(dumps(D))
sage: d.edges()
[(0, 2, None), (0, 3, None)]
sage: D.edges()
[(0, 2, None),
 (0, 3, None),
 (2, 1, None),
 (3, 1, None),
 (4, 1, None),
 (5, 3, None),
 (5, 4, None)]
```



---

archive/issue_comments_198528.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nIndeed the error occurs when constructing the graph used to pickle the graph backend:\n\n```\nsage: constructor = DiGraph\nsage: self = D._backend\nsage: G.add_vertices(self.iterator_verts(None))\nsage: G\nDigraph on 6 vertices\nsage: G.vertices()\n[0, 1, 2, 3, 4, 5]\nsage: D.vertices()\n[0, 1, 2, 3, 4, 5]\nsage: G.add_edges(list(self.iterator_edges(self.iterator_verts(None),1)))\nsage: G.edges()\n[(0, 2, None), (0, 3, None)]\n```\nBug in `iterator_edges`? Then you should thank the guy who invented the `TestSuite`, since it helped you uncover a bug in a method you probably care about (namely iteration over edges).",
    "created_at": "2014-01-02T19:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198528",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">Comment 20</div>

Indeed the error occurs when constructing the graph used to pickle the graph backend:

```
sage: constructor = DiGraph
sage: self = D._backend
sage: G.add_vertices(self.iterator_verts(None))
sage: G
Digraph on 6 vertices
sage: G.vertices()
[0, 1, 2, 3, 4, 5]
sage: D.vertices()
[0, 1, 2, 3, 4, 5]
sage: G.add_edges(list(self.iterator_edges(self.iterator_verts(None),1)))
sage: G.edges()
[(0, 2, None), (0, 3, None)]
```
Bug in `iterator_edges`? Then you should thank the guy who invented the `TestSuite`, since it helped you uncover a bug in a method you probably care about (namely iteration over edges).



---

archive/issue_comments_198529.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nIn pure form, the failing example is\n\n```\nsage: uc = [[2,3], [], [1], [1], [1], [3,4]]\nsage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]), data_structure=\"static_sparse\")\nsage: list(D._backend.iterator_edges(D.vertices(), True))\n[(0, 2, None), (0, 3, None)]\n```",
    "created_at": "2014-01-02T19:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198529",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">Comment 21</div>

In pure form, the failing example is

```
sage: uc = [[2,3], [], [1], [1], [1], [3,4]]
sage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]), data_structure="static_sparse")
sage: list(D._backend.iterator_edges(D.vertices(), True))
[(0, 2, None), (0, 3, None)]
```



---

archive/issue_comments_198530.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nAhahah. You are oversimplying things. It's good that we found a bug. But that does not justify all at once the principle of testsuites and its use. \n\nI'm trying to fix that. It's weird, if you use `iterator_out_edges` instead there is no problem anymore `O_o`\n\nNathann",
    "created_at": "2014-01-02T19:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198530",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">Comment 22</div>

Ahahah. You are oversimplying things. It's good that we found a bug. But that does not justify all at once the principle of testsuites and its use. 

I'm trying to fix that. It's weird, if you use `iterator_out_edges` instead there is no problem anymore `O_o`

Nathann



---

archive/issue_comments_198531.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\n(by the way, `D.show` fails `:-P`)",
    "created_at": "2014-01-02T19:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198531",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:23" align="right">Comment 23</div>

(by the way, `D.show` fails `:-P`)



---

archive/issue_comments_198532.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nOh. Well, it is not really a bug. It's just that `iterator_edges` is not meant for digraphs `O_o`\n\nNathann",
    "created_at": "2014-01-02T19:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198532",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">Comment 24</div>

Oh. Well, it is not really a bug. It's just that `iterator_edges` is not meant for digraphs `O_o`

Nathann



---

archive/issue_comments_198533.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nDid you find a place in the code that call the backend's `iterator_edges` functions ?\n\nNathann",
    "created_at": "2014-01-02T19:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198533",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:25" align="right">Comment 25</div>

Did you find a place in the code that call the backend's `iterator_edges` functions ?

Nathann



---

archive/issue_comments_198534.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nI mean... For a DiGraph. I should probably add an exception there when this function is used with a digraph, but it is clearly meant for undirected graphs only.\n\n```\n\t\tif j < i and j in vertices:\n                    continue\n```\n\nIt only outputs an edge once `:-P`\n\nNathann",
    "created_at": "2014-01-02T19:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198534",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">Comment 26</div>

I mean... For a DiGraph. I should probably add an exception there when this function is used with a digraph, but it is clearly meant for undirected graphs only.

```
		if j < i and j in vertices:
                    continue
```

It only outputs an edge once `:-P`

Nathann



---

archive/issue_comments_198535.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nI just added an exception to this method when it is used on undirected graphs, and it looks like the only code that calls this method on undirected graphs is .... the hash function `:-PPPPPPPPP`\n\nNathann",
    "created_at": "2014-01-02T20:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198535",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:27" align="right">Comment 27</div>

I just added an exception to this method when it is used on undirected graphs, and it looks like the only code that calls this method on undirected graphs is .... the hash function `:-PPPPPPPPP`

Nathann



---

archive/issue_comments_198536.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@nathanncohen](#comment%3A24):\n> Oh. Well, it is not really a bug. It's just that `iterator_edges` is not meant for digraphs `O_o`\n\nIs this documented? If it *is* documented, then it is not a bug. But then, its use in `__reduce__` should be replaced by something that works.",
    "created_at": "2014-01-02T20:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198536",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@nathanncohen](#comment%3A24):
> Oh. Well, it is not really a bug. It's just that `iterator_edges` is not meant for digraphs `O_o`

Is this documented? If it *is* documented, then it is not a bug. But then, its use in `__reduce__` should be replaced by something that works.



---

archive/issue_comments_198537.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nWhat I just said doesn't make sense... `T_T`\n\nStill, the only exceptions I see happen with hashs...\n\nNathann",
    "created_at": "2014-01-02T20:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198537",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:29" align="right">Comment 29</div>

What I just said doesn't make sense... `T_T`

Still, the only exceptions I see happen with hashs...

Nathann



---

archive/issue_comments_198538.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@nathanncohen](#comment%3A27):\n> I just added an exception to this method when it is used on undirected graphs, and it looks like the only code that calls this method on undirected graphs is .... the hash function `:-PPPPPPPPP`\n\nAhm... Does it *work* for undirected graphs or does it *not* work for undirected graphs? In your previous post, I understood that it is wrong to have it on a digraph.",
    "created_at": "2014-01-02T20:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198538",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@nathanncohen](#comment%3A27):
> I just added an exception to this method when it is used on undirected graphs, and it looks like the only code that calls this method on undirected graphs is .... the hash function `:-PPPPPPPPP`

Ahm... Does it *work* for undirected graphs or does it *not* work for undirected graphs? In your previous post, I understood that it is wrong to have it on a digraph.



---

archive/issue_comments_198539.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nIt is not meant to be used on digraphs. It works on graphs : it just returns an edge i,j if i<j. Otherwise it is skipped. If we don't do that every undirected edge is returned twice. It's clearly meant for undirected graphs `O_o`\n\nNathann",
    "created_at": "2014-01-02T20:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198539",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:31" align="right">Comment 31</div>

It is not meant to be used on digraphs. It works on graphs : it just returns an edge i,j if i<j. Otherwise it is skipped. If we don't do that every undirected edge is returned twice. It's clearly meant for undirected graphs `O_o`

Nathann



---

archive/issue_comments_198540.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@nathanncohen](#comment%3A31):\n> It is not meant to be used on digraphs. It works on graphs : it just returns an edge i,j if i<j. Otherwise it is skipped. If we don't do that every undirected edge is returned twice. It's clearly meant for undirected graphs `O_o`\n\n\nWould it be difficult to make it work on digraphs? After all, the backend knows whether it is directed, and thus one could make it so that the \"i<j\" test is only applied in the undirected case.",
    "created_at": "2014-01-02T20:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198540",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@nathanncohen](#comment%3A31):
> It is not meant to be used on digraphs. It works on graphs : it just returns an edge i,j if i<j. Otherwise it is skipped. If we don't do that every undirected edge is returned twice. It's clearly meant for undirected graphs `O_o`


Would it be difficult to make it work on digraphs? After all, the backend knows whether it is directed, and thus one could make it so that the "i<j" test is only applied in the undirected case.



---

archive/issue_comments_198541.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nOkay I'm stupid. I hadn't noticed I used this in `__reduce__`. Totally my mystake. I'm going to fix this and see how it works out. Should make a hell of a difference.\n\nNathann",
    "created_at": "2014-01-02T20:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198541",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:33" align="right">Comment 33</div>

Okay I'm stupid. I hadn't noticed I used this in `__reduce__`. Totally my mystake. I'm going to fix this and see how it works out. Should make a hell of a difference.

Nathann



---

archive/issue_comments_198542.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nWait a minute. I am about to push a fix to iterator_edges, that makes it work on digraphs and would thus also fix the pickling problem.",
    "created_at": "2014-01-02T20:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198542",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:34" align="right">Comment 34</div>

Wait a minute. I am about to push a fix to iterator_edges, that makes it work on digraphs and would thus also fix the pickling problem.



---

archive/issue_comments_198543.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nNo, please. We need to discuss what the function should return before anything. I don't find any good answer for that. Short of a thing so ugly it should not be implemented `:-P`\n\nNathann",
    "created_at": "2014-01-02T20:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198543",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:35" align="right">Comment 35</div>

No, please. We need to discuss what the function should return before anything. I don't find any good answer for that. Short of a thing so ugly it should not be implemented `:-P`

Nathann



---

archive/issue_comments_198544.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nOkay, replacing `iterator_edges` by `iterator_out_edges` in the `__reduce__` function of the static sparse backend fixes the pickling-related problems. Some other weird bugs remain in the poset/ folder though `T_T`\n\nNathann",
    "created_at": "2014-01-02T20:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198544",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:36" align="right">Comment 36</div>

Okay, replacing `iterator_edges` by `iterator_out_edges` in the `__reduce__` function of the static sparse backend fixes the pickling-related problems. Some other weird bugs remain in the poset/ folder though `T_T`

Nathann



---

archive/issue_comments_198545.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@nathanncohen](#comment%3A35):\n> No, please. We need to discuss what the function should return before anything. I don't find any good answer for that. Short of a thing so ugly it should not be implemented `:-P`\n\nI was in the process of pushing, now I have interrupted it. I don't know if this has worked or if my commit has already been posted.\n\nBut why would you hesitate to make `iterator_edges` work on digraphs?",
    "created_at": "2014-01-02T20:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198545",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@nathanncohen](#comment%3A35):
> No, please. We need to discuss what the function should return before anything. I don't find any good answer for that. Short of a thing so ugly it should not be implemented `:-P`

I was in the process of pushing, now I have interrupted it. I don't know if this has worked or if my commit has already been posted.

But why would you hesitate to make `iterator_edges` work on digraphs?



---

archive/issue_comments_198546.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nIt looks like it hasn't been posted.\n\nI hesitate because I don't think there is a good definition of what it should output. Let's try it this way : tell me what you wanted it to output and I will give you the graph which I think make it a bad definition. If I find no graph then we will implement it `:-P`\n\nNathann",
    "created_at": "2014-01-02T20:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198546",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:38" align="right">Comment 38</div>

It looks like it hasn't been posted.

I hesitate because I don't think there is a good definition of what it should output. Let's try it this way : tell me what you wanted it to output and I will give you the graph which I think make it a bad definition. If I find no graph then we will implement it `:-P`

Nathann



---

archive/issue_comments_198547.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nReplying to [@nathanncohen](#comment%3A35):\n> No, please. We need to discuss what the function should return before anything. I don't find any good answer for that.\n\nWell, of course it should return an iterator over the edges of the digraph. What else should it do?",
    "created_at": "2014-01-02T20:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198547",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:39" align="right">Comment 39</div>

Replying to [@nathanncohen](#comment%3A35):
> No, please. We need to discuss what the function should return before anything. I don't find any good answer for that.

Well, of course it should return an iterator over the edges of the digraph. What else should it do?



---

archive/issue_comments_198548.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95\">2eb2c95</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>\n",
    "created_at": "2014-01-02T20:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198548",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40" align="right">Comment 40</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95">2eb2c95</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>




---

archive/issue_comments_198549.json:
```json
{
    "body": "Changed commit from **[0229348](https://github.com/sagemath/sagetrac-mirror/commit/02293487b6268d373896d4c18b0a41a54ef36acd)** to **[2eb2c95](https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95a4512592f452a2046d98a22c9ec171e8d)**",
    "created_at": "2014-01-02T20:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198549",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0229348](https://github.com/sagemath/sagetrac-mirror/commit/02293487b6268d373896d4c18b0a41a54ef36acd)** to **[2eb2c95](https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95a4512592f452a2046d98a22c9ec171e8d)**



---

archive/issue_comments_198550.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\n> Well, of course it should return an iterator over the edges of the digraph. What else should it do?\n\n`O_o`\n\nWhat about the `vertices` argument ?\n\nNathann\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95\">2eb2c95</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>\n",
    "created_at": "2014-01-02T20:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198550",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:41" align="right">Comment 41</div>

> Well, of course it should return an iterator over the edges of the digraph. What else should it do?

`O_o`

What about the `vertices` argument ?

Nathann

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95">2eb2c95</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>




---

archive/issue_comments_198551.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nReplying to [@nathanncohen](#comment%3A38):\n> It looks like it hasn't been posted.\n> \n> I hesitate because I don't think there is a good definition of what it should output. Let's try it this way : tell me what you wanted it to output\n\nFor example (this is the doctest of my not-posted commit):\n\n```\nsage: uc = [[2,3], [], [1], [1], [1], [3,4]]\nsage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]))\nsage: G = Graph(dict([[i,uc[i]] for i in range(len(uc))]))\nsage: from sage.graphs.base.static_sparse_backend import StaticSparseBackend\nsage: d = StaticSparseBackend(D)\nsage: g = StaticSparseBackend(G)\nsage: list(d.iterator_edges(d.iterator_verts(None), False))\n[(0, 2), (0, 3), (2, 1), (3, 1), (4, 1), (5, 3), (5, 4)]\nsage: list(g.iterator_edges(g.iterator_verts(None), False))\n[(0, 2), (0, 3), (1, 2), (1, 3), (1, 4), (3, 5), (4, 5)]\n```",
    "created_at": "2014-01-02T20:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198551",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:42" align="right">Comment 42</div>

Replying to [@nathanncohen](#comment%3A38):
> It looks like it hasn't been posted.
> 
> I hesitate because I don't think there is a good definition of what it should output. Let's try it this way : tell me what you wanted it to output

For example (this is the doctest of my not-posted commit):

```
sage: uc = [[2,3], [], [1], [1], [1], [3,4]]
sage: D = DiGraph(dict([[i,uc[i]] for i in range(len(uc))]))
sage: G = Graph(dict([[i,uc[i]] for i in range(len(uc))]))
sage: from sage.graphs.base.static_sparse_backend import StaticSparseBackend
sage: d = StaticSparseBackend(D)
sage: g = StaticSparseBackend(G)
sage: list(d.iterator_edges(d.iterator_verts(None), False))
[(0, 2), (0, 3), (2, 1), (3, 1), (4, 1), (5, 3), (5, 4)]
sage: list(g.iterator_edges(g.iterator_verts(None), False))
[(0, 2), (0, 3), (1, 2), (1, 3), (1, 4), (3, 5), (4, 5)]
```



---

archive/issue_comments_198552.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nReplying to [@nathanncohen](#comment%3A41):\n> What about the `vertices` argument ?\n\nAhaha, you mean whether it is supposed to be the in or out vertices of the edges being returned?",
    "created_at": "2014-01-02T20:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198552",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:43" align="right">Comment 43</div>

Replying to [@nathanncohen](#comment%3A41):
> What about the `vertices` argument ?

Ahaha, you mean whether it is supposed to be the in or out vertices of the edges being returned?



---

archive/issue_comments_198553.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nYep. You can make it the in-edges, or the out-edges. And both definitions are bad. Or you can make it the sum of both. But then you would return twice the edges that links two vertices of your set `vertices`. Unless you look for them and remove them before returning them. And this I think is ugly. What do you think ? `:-P`\n\nBy the way the commit I just uploaded does not work. Sorry for that. I'll fix it in a second.\n\nNathann",
    "created_at": "2014-01-02T20:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198553",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:44" align="right">Comment 44</div>

Yep. You can make it the in-edges, or the out-edges. And both definitions are bad. Or you can make it the sum of both. But then you would return twice the edges that links two vertices of your set `vertices`. Unless you look for them and remove them before returning them. And this I think is ugly. What do you think ? `:-P`

By the way the commit I just uploaded does not work. Sorry for that. I'll fix it in a second.

Nathann



---

archive/issue_comments_198554.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@nathanncohen](#comment%3A44):\n> Yep. You can make it the in-edges, or the out-edges. And both definitions are bad. Or you can \n> make it the sum of both. But then you would return twice the edges that links two vertices of \n> your set `vertices`. Unless you look for them and remove them before returning them. And this I \n> think is ugly. What do you think ?\n\nAgreed.\n\n> By the way the commit I just uploaded does not work. Sorry for that. I'll fix it in a second.\n\nAgreed (it is self._directed, not self.directed).",
    "created_at": "2014-01-02T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198554",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@nathanncohen](#comment%3A44):
> Yep. You can make it the in-edges, or the out-edges. And both definitions are bad. Or you can 
> make it the sum of both. But then you would return twice the edges that links two vertices of 
> your set `vertices`. Unless you look for them and remove them before returning them. And this I 
> think is ugly. What do you think ?

Agreed.

> By the way the commit I just uploaded does not work. Sorry for that. I'll fix it in a second.

Agreed (it is self._directed, not self.directed).



---

archive/issue_comments_198555.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nOkayokay, I just fixed this `_directed`, what's left seems to work.\n\nThe funny thing is that the only code that actually tests this pickling stuff is the poset code... So this can only be tested seriously with static graph backends for posets `^^;`\n\nNathann",
    "created_at": "2014-01-02T20:35:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198555",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:46" align="right">Comment 46</div>

Okayokay, I just fixed this `_directed`, what's left seems to work.

The funny thing is that the only code that actually tests this pickling stuff is the poset code... So this can only be tested seriously with static graph backends for posets `^^;`

Nathann



---

archive/issue_comments_198556.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nOkay, I just updated it. It worked with the other flag because I added this variable while working on the poset stuff. That's part of what I will have to clean before sending this other patch `^^;`\n\nAnyway, this one looks good.\n\nNathann",
    "created_at": "2014-01-02T20:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198556",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:47" align="right">Comment 47</div>

Okay, I just updated it. It worked with the other flag because I added this variable while working on the poset stuff. That's part of what I will have to clean before sending this other patch `^^;`

Anyway, this one looks good.

Nathann



---

archive/issue_comments_198557.json:
```json
{
    "body": "Changed commit from **[2eb2c95](https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95a4512592f452a2046d98a22c9ec171e8d)** to none",
    "created_at": "2014-01-02T20:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198557",
    "user": "https://github.com/nathanncohen"
}
```

Changed commit from **[2eb2c95](https://github.com/sagemath/sagetrac-mirror/commit/2eb2c95a4512592f452a2046d98a22c9ec171e8d)** to none



---

archive/issue_comments_198558.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c441178\">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0229348\">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7860f39\">7860f39</a></td><td><code>trac #15603: \"immutable=True\" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2525d22\">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30\">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94\">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51d6328\">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77\">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07bad46\">07bad46</a></td><td><code>Merge branch 'u/ncohen/15491' of git://trac.sagemath.org/sage into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/126b036\">126b036</a></td><td><code>Merge branch 'master' into ticket/15278</code></td></tr></table>\n",
    "created_at": "2014-01-02T20:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198558",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48" align="right">Comment 48</div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c441178">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0229348">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7860f39">7860f39</a></td><td><code>trac #15603: "immutable=True" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2525d22">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51d6328">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07bad46">07bad46</a></td><td><code>Merge branch 'u/ncohen/15491' of git://trac.sagemath.org/sage into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/126b036">126b036</a></td><td><code>Merge branch 'master' into ticket/15278</code></td></tr></table>




---

archive/issue_comments_198559.json:
```json
{
    "body": "Commit: **[c441178](https://github.com/sagemath/sagetrac-mirror/commit/c4411781fa8a64d3e89568069ad85caab47b81d2)**",
    "created_at": "2014-01-02T20:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198559",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[c441178](https://github.com/sagemath/sagetrac-mirror/commit/c4411781fa8a64d3e89568069ad85caab47b81d2)**



---

archive/issue_comments_198560.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nReplying to [@nathanncohen](#comment%3A46):\n> The funny thing is that the only code that actually tests this pickling stuff is the poset code... So this can only be tested seriously with static graph backends for posets `^^;`\n\nIf I recall correctly, in the \"good old days\" (before we had posets), the doctest coverage script was checking in each file whether it contains a \"loads(dumps(bla)) == bla\" test. So, people did want to pickle stuff even before some guy came up with category testsuites.\n\nBy the way, if you want that static graphs aren't just tested via posets, then you should provide a category of graphs! Its testsuite would automatically test whether pickling works `:-p`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c441178\">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>\n",
    "created_at": "2014-01-02T20:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198560",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:49" align="right">Comment 49</div>

Replying to [@nathanncohen](#comment%3A46):
> The funny thing is that the only code that actually tests this pickling stuff is the poset code... So this can only be tested seriously with static graph backends for posets `^^;`

If I recall correctly, in the "good old days" (before we had posets), the doctest coverage script was checking in each file whether it contains a "loads(dumps(bla)) == bla" test. So, people did want to pickle stuff even before some guy came up with category testsuites.

By the way, if you want that static graphs aren't just tested via posets, then you should provide a category of graphs! Its testsuite would automatically test whether pickling works `:-p`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c441178">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr></table>




---

archive/issue_comments_198561.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nThank you for the fix! I'll review it then and add a few tests.",
    "created_at": "2014-01-02T20:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198561",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:50" align="right">Comment 50</div>

Thank you for the fix! I'll review it then and add a few tests.



---

archive/issue_comments_198562.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\n> If I recall correctly, in the \"good old days\" (before we had posets), the doctest coverage script was checking in each file whether it contains a \"loads(dumps(bla)) == bla\" test. So, people did want to pickle stuff even before some guy came up with category testsuites.\n\nI blame those who carry on as much as those who initiate it `:-P`\n>\n> By the way, if you want that static graphs aren't just tested via posets, then you should provide a category of graphs! Its testsuite would automatically test whether pickling works `:-p`.\n\nAhahahah. Over my dead body. I have been debugging code for two full evenings because people decided I should only implement picklable graphs, and this is because I try to fix combinat's hack of immutable posets. And that's not even the end of it. So let's make that clear : over my dead body `:-P`\n\nAnd there are still broken doctests in the combinat/poset/ folder now. I just updated the u/ncohen/tmp branch with this commit.\n\nNathann",
    "created_at": "2014-01-02T20:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198562",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:51" align="right">Comment 51</div>

> If I recall correctly, in the "good old days" (before we had posets), the doctest coverage script was checking in each file whether it contains a "loads(dumps(bla)) == bla" test. So, people did want to pickle stuff even before some guy came up with category testsuites.

I blame those who carry on as much as those who initiate it `:-P`
>
> By the way, if you want that static graphs aren't just tested via posets, then you should provide a category of graphs! Its testsuite would automatically test whether pickling works `:-p`.

Ahahahah. Over my dead body. I have been debugging code for two full evenings because people decided I should only implement picklable graphs, and this is because I try to fix combinat's hack of immutable posets. And that's not even the end of it. So let's make that clear : over my dead body `:-P`

And there are still broken doctests in the combinat/poset/ folder now. I just updated the u/ncohen/tmp branch with this commit.

Nathann



---

archive/issue_comments_198563.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nThis being said, thank you for your help with this. It was driving me crazy. Actually the other bugs from combinat/poset in the u/ncohen/tmp branch are still driving me crazy `T_T`",
    "created_at": "2014-01-02T20:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198563",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:53" align="right">Comment 53</div>

This being said, thank you for your help with this. It was driving me crazy. Actually the other bugs from combinat/poset in the u/ncohen/tmp branch are still driving me crazy `T_T`



---

archive/issue_comments_198564.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nHmmmm... Looks like the `StaticSparseBackend` has a working `relabel` function `:-PPPPPPPP`\n\nNathann",
    "created_at": "2014-01-02T21:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198564",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:54" align="right">Comment 54</div>

Hmmmm... Looks like the `StaticSparseBackend` has a working `relabel` function `:-PPPPPPPP`

Nathann



---

archive/issue_comments_198565.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nAnnnnnnnnnd with this all tests pass.. WUUUUUHUUUUUUUUUUUUUUUUUUUUUUUU !! `O_O_O`\n\nNathann",
    "created_at": "2014-01-02T21:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198565",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:55" align="right">Comment 55</div>

Annnnnnnnnd with this all tests pass.. WUUUUUHUUUUUUUUUUUUUUUUUUUUUUUU !! `O_O_O`

Nathann



---

archive/issue_comments_198566.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\n#15623 makes Posets use immutable graphs. Cool, isn't it ? `:-PPP`\n\nNathann",
    "created_at": "2014-01-02T21:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198566",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:56" align="right">Comment 56</div>

#15623 makes Posets use immutable graphs. Cool, isn't it ? `:-PPP`

Nathann



---

archive/issue_comments_198567.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nReplying to [@nathanncohen](#comment%3A54):\n> Hmmmm... Looks like the `StaticSparseBackend` has a working `relabel` function `:-PPPPPPPP`\n\nOuch. But you take care of this in #15622, right?\n\nApart from this: All doctests pass, and the code looks fine to me. In a review commit, I'll add some tests for issues we discussed here.",
    "created_at": "2014-01-02T22:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198567",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:57" align="right">Comment 57</div>

Replying to [@nathanncohen](#comment%3A54):
> Hmmmm... Looks like the `StaticSparseBackend` has a working `relabel` function `:-PPPPPPPP`

Ouch. But you take care of this in #15622, right?

Apart from this: All doctests pass, and the code looks fine to me. In a review commit, I'll add some tests for issues we discussed here.



---

archive/issue_comments_198568.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nIndeed, indeed !\n\nNathann",
    "created_at": "2014-01-03T08:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198568",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:58" align="right">Comment 58</div>

Indeed, indeed !

Nathann



---

archive/issue_comments_198569.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nRight now I am testing whether everything keeps working after merging my review patch from #15603.",
    "created_at": "2014-01-03T11:29:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198569",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:59" align="right">Comment 59</div>

Right now I am testing whether everything keeps working after merging my review patch from #15603.



---

archive/issue_comments_198570.json:
```json
{
    "body": "Changed branch from **[u/ncohen/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/15619)** to **[u/SimonKing/ticket/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15619)**",
    "created_at": "2014-01-03T12:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198570",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/ncohen/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/15619)** to **[u/SimonKing/ticket/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15619)**



---

archive/issue_comments_198571.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nI am not sure if pushing my changes properly worked (apparently I needed to manually set the commit I added). Anyway, if you like my review commit, then it is a positive review.",
    "created_at": "2014-01-03T12:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198571",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:61" align="right">Comment 61</div>

I am not sure if pushing my changes properly worked (apparently I needed to manually set the commit I added). Anyway, if you like my review commit, then it is a positive review.



---

archive/issue_events_205320.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-01-03T12:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205320"
}
```



---

archive/issue_events_205321.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-01-03T12:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205321"
}
```



---

archive/issue_comments_198572.json:
```json
{
    "body": "Changed commit from **[c441178](https://github.com/sagemath/sagetrac-mirror/commit/c4411781fa8a64d3e89568069ad85caab47b81d2)** to **[cabc969](https://github.com/sagemath/sagetrac-mirror/commit/cabc96968cab75cbca1e85f1e8efc7b3c50f85e7)**",
    "created_at": "2014-01-03T12:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198572",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[c441178](https://github.com/sagemath/sagetrac-mirror/commit/c4411781fa8a64d3e89568069ad85caab47b81d2)** to **[cabc969](https://github.com/sagemath/sagetrac-mirror/commit/cabc96968cab75cbca1e85f1e8efc7b3c50f85e7)**



---

archive/issue_comments_198573.json:
```json
{
    "body": "Reviewer: **Simon King**",
    "created_at": "2014-01-03T12:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198573",
    "user": "https://github.com/simon-king-jena"
}
```

Reviewer: **Simon King**



---

archive/issue_comments_198574.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nArgggggggg sorry. I just noticed that there is a problem with this code. It does not handle multiple edges and loops correctly.\n\nI HAAAAAAAAAAAAAAAAAAAAATE THESE THINGS.\n\n```\nsage: g = Graph(multiedges = True)\nsage: g.add_edges(graphs.PetersenGraph().edges())\nsage: g.add_edges(graphs.PetersenGraph().edges())\nsage: gi = g.copy(immutable=True)\nsage: loads(dumps(gi))\nMulti-graph on 10 vertices\nsage: loads(dumps(gi)) == gi\nFalse\nsage: gi.size()             \n30\nsage: loads(dumps(gi)).size()\n15\n```\n\nI will add a commit to this one within 10 minutes. Need to write it first `>_<`\n\nNathann",
    "created_at": "2014-01-03T12:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198574",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:62" align="right">Comment 62</div>

Argggggggg sorry. I just noticed that there is a problem with this code. It does not handle multiple edges and loops correctly.

I HAAAAAAAAAAAAAAAAAAAAATE THESE THINGS.

```
sage: g = Graph(multiedges = True)
sage: g.add_edges(graphs.PetersenGraph().edges())
sage: g.add_edges(graphs.PetersenGraph().edges())
sage: gi = g.copy(immutable=True)
sage: loads(dumps(gi))
Multi-graph on 10 vertices
sage: loads(dumps(gi)) == gi
False
sage: gi.size()             
30
sage: loads(dumps(gi)).size()
15
```

I will add a commit to this one within 10 minutes. Need to write it first `>_<`

Nathann



---

archive/issue_comments_198575.json:
```json
{
    "body": "Changed commit from **[cabc969](https://github.com/sagemath/sagetrac-mirror/commit/cabc96968cab75cbca1e85f1e8efc7b3c50f85e7)** to none",
    "created_at": "2014-01-03T13:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198575",
    "user": "https://github.com/nathanncohen"
}
```

Changed commit from **[cabc969](https://github.com/sagemath/sagetrac-mirror/commit/cabc96968cab75cbca1e85f1e8efc7b3c50f85e7)** to none



---

archive/issue_events_205322.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-03T13:07:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205322"
}
```



---

archive/issue_events_205323.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-03T13:07:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205323"
}
```



---

archive/issue_comments_198576.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15619)** to **[public/15619](https://github.com/sagemath/sagetrac-mirror/tree/public/15619)**",
    "created_at": "2014-01-03T13:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198576",
    "user": "https://github.com/nathanncohen"
}
```

Changed branch from **[u/SimonKing/ticket/15619](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15619)** to **[public/15619](https://github.com/sagemath/sagetrac-mirror/tree/public/15619)**



---

archive/issue_events_205324.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-03T13:07:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205324"
}
```



---

archive/issue_events_205325.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-01-03T13:07:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205325"
}
```



---

archive/issue_comments_198577.json:
```json
{
    "body": "Commit: **[e761346](https://github.com/sagemath/sagetrac-mirror/commit/e761346c888f8ef6f5dd5b43f52b20d23fef500c)**",
    "created_at": "2014-01-03T13:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198577",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[e761346](https://github.com/sagemath/sagetrac-mirror/commit/e761346c888f8ef6f5dd5b43f52b20d23fef500c)**



---

archive/issue_comments_198578.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e761346\">e761346</a></td><td><code>trac #15619: Pickling multigraphs with loops and labels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cabc969\">cabc969</a></td><td><code>Trac 15619: Review commit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c441178\">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0229348\">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7860f39\">7860f39</a></td><td><code>trac #15603: \"immutable=True\" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2525d22\">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30\">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94\">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51d6328\">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77\">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr></table>\n",
    "created_at": "2014-01-03T13:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198578",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65" align="right">Comment 65</div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e761346">e761346</a></td><td><code>trac #15619: Pickling multigraphs with loops and labels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cabc969">cabc969</a></td><td><code>Trac 15619: Review commit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c441178">c441178</a></td><td><code>trac #15619: bug in the former definition; exception to avoid it in the future</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0229348">0229348</a></td><td><code>trac #15619: Pickling of immutable graphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7860f39">7860f39</a></td><td><code>trac #15603: "immutable=True" for Graph/Digraph `__init__` and copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2525d22">2525d22</a></td><td><code>Trac 15278: Fix syntax error in doc test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcf9e30">fcf9e30</a></td><td><code>Trac 15278: Only graphs that use the static backend are identical with their copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc9c94">8fc9c94</a></td><td><code>Merge branch 'develop' into ticket/15278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51d6328">51d6328</a></td><td><code>Trac 15278: Error messages explain how to create (im)mutable graph copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fc8a77">2fc8a77</a></td><td><code>Make digraphs using the static backend immutable and hashable</code></td></tr></table>




---

archive/issue_comments_198579.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nDone. tested on the most ugly graphs I could build.\n\nI hate multigraphs. I hate loops. I hate labels.\n\nNathann",
    "created_at": "2014-01-03T13:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198579",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:66" align="right">Comment 66</div>

Done. tested on the most ugly graphs I could build.

I hate multigraphs. I hate loops. I hate labels.

Nathann



---

archive/issue_comments_198580.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nHelloooo Simon ! Is this one good for you ? It depends on a patch with `positive_review`, and a patch with `positive_review` depends on it, but it still unchecked `:-P`\n\nNathann",
    "created_at": "2014-01-04T09:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198580",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:67" align="right">Comment 67</div>

Helloooo Simon ! Is this one good for you ? It depends on a patch with `positive_review`, and a patch with `positive_review` depends on it, but it still unchecked `:-P`

Nathann



---

archive/issue_comments_198581.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nThe solution seems logical to me (to the extent that multigraphs with labels and loops can be \"logical\"...), and the example is carefully chosen to cover all cases (including isolated vertices). Hence, if the doctests pass (I'll know in about one hour) then I'll give it a positive review.",
    "created_at": "2014-01-04T19:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198581",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:68" align="right">Comment 68</div>

The solution seems logical to me (to the extent that multigraphs with labels and loops can be "logical"...), and the example is carefully chosen to cover all cases (including isolated vertices). Hence, if the doctests pass (I'll know in about one hour) then I'll give it a positive review.



---

archive/issue_events_205326.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-01-04T20:32:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205326"
}
```



---

archive/issue_events_205327.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-01-04T20:32:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205327"
}
```



---

archive/issue_comments_198582.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\n\n```\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 3981.0 seconds\n    cpu time: 6195.0 seconds\n    cumulative wall time: 7673.1 seconds\n```\nOK, a bit more than an hour.\n\nAccording to the previous comment, this is a positive review.",
    "created_at": "2014-01-04T20:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15619#issuecomment-198582",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:69" align="right">Comment 69</div>


```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 3981.0 seconds
    cpu time: 6195.0 seconds
    cumulative wall time: 7673.1 seconds
```
OK, a bit more than an hour.

According to the previous comment, this is a positive review.



---

archive/issue_events_205328.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T02:56:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205328"
}
```



---

archive/issue_events_205329.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0418a3e971872c5a0140cda02e1256905b499fa1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-01-05T02:56:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15619",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15619#event-205329"
}
```
