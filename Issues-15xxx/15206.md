# Issue 15206: Poset show should accept non-hashable or non-injective element labels

archive/issues_014969.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: P = Poset({1: [2,3]})\nsage: labs = {i: P.rank(i) for i in range(1, 4)}\nsage: labs\n{1: 0, 2: 1, 3: 1}\nsage: P.show(element_labels=labs)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-38-dfd00191eb55> in <module>()\n----> 1 P.show(element_labels=labs)\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in show(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)\n   1440         \"\"\"\n   1441         self.plot(label_elements=label_elements, element_labels=element_labels,\n-> 1442             vertex_size=vertex_size, vertex_colors=vertex_colors, layout=layout).show(**kwds)\n   1443 \n   1444     @combinatorial_map(name=\"to graph\")\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in plot(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)\n   1402             relabelling = dict((self(element), label)\n   1403                                for (element, label) in element_labels.items())\n-> 1404             graph = graph.relabel(relabelling, inplace = False)\n   1405             if rank_function: # use the rank function to set the heights\n   1406                 for i in self:\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)\n  16208                               return_map= return_map,\n  16209                               check_input = check_input,\n> 16210                               complete_partial_function = complete_partial_function)\n  16211 \n  16212             if return_map:\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)\n  16263         if check_input:\n  16264             if len(set(perm.values())) < len(perm):\n> 16265                 raise NotImplementedError(\"Non injective relabeling\")\n  16266 \n  16267             for v in perm.iterkeys():\n\nNotImplementedError: Non injective relabeling\n```\n\nI understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)\n\nI am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.\n\nFixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example\n\n```\nPoset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})\n```\n\nCC:  @jm58660 @vit-tucek\n\nKeywords: **combinat, show, plot, posets, days94, sagedays@icerm**\n\nBranch/Commit: **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**\n\nReviewer: **Jori M\u00e4ntysalo, Darij Grinberg, Travis Scrimshaw**\n\nAuthor: **V\u00edt Tu\u010dek**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15206_\n\n",
    "closed_at": "2018-08-30T22:25:02Z",
    "created_at": "2013-09-18T04:35:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Poset show should accept non-hashable or non-injective element labels",
    "type": "issue",
    "updated_at": "2018-08-30T22:25:02Z",
    "url": "https://github.com/sagemath/sage/issues/15206",
    "user": "https://github.com/darijgr"
}
```

```
sage: P = Poset({1: [2,3]})
sage: labs = {i: P.rank(i) for i in range(1, 4)}
sage: labs
{1: 0, 2: 1, 3: 1}
sage: P.show(element_labels=labs)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-38-dfd00191eb55> in <module>()
----> 1 P.show(element_labels=labs)

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in show(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)
   1440         """
   1441         self.plot(label_elements=label_elements, element_labels=element_labels,
-> 1442             vertex_size=vertex_size, vertex_colors=vertex_colors, layout=layout).show(**kwds)
   1443 
   1444     @combinatorial_map(name="to graph")

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in plot(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)
   1402             relabelling = dict((self(element), label)
   1403                                for (element, label) in element_labels.items())
-> 1404             graph = graph.relabel(relabelling, inplace = False)
   1405             if rank_function: # use the rank function to set the heights
   1406                 for i in self:

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)
  16208                               return_map= return_map,
  16209                               check_input = check_input,
> 16210                               complete_partial_function = complete_partial_function)
  16211 
  16212             if return_map:

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)
  16263         if check_input:
  16264             if len(set(perm.values())) < len(perm):
> 16265                 raise NotImplementedError("Non injective relabeling")
  16266 
  16267             for v in perm.iterkeys():

NotImplementedError: Non injective relabeling
```

I understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)

I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.

Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example

```
Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})
```

CC:  @jm58660 @vit-tucek

Keywords: **combinat, show, plot, posets, days94, sagedays@icerm**

Branch/Commit: **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**

Reviewer: **Jori Mäntysalo, Darij Grinberg, Travis Scrimshaw**

Author: **Vít Tuček**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/15206_





---

archive/issue_events_217028.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-09-18T04:35:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217028"
}
```



---

archive/issue_events_217029.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-09-18T04:35:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217029"
}
```



---

archive/issue_events_217030.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-09-18T04:35:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217030"
}
```



---

archive/issue_events_217031.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217031"
}
```



---

archive/issue_events_217032.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217032"
}
```



---

archive/issue_events_217033.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217033"
}
```



---

archive/issue_events_217034.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217034"
}
```



---

archive/issue_events_217035.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217035"
}
```



---

archive/issue_events_217036.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217036"
}
```



---

archive/issue_comments_187227.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,3 +44,9 @@\n I understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)\n \n I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.\n+\n+Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example\n+\n+```\n+Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})\n+```\n``````\n",
    "created_at": "2015-05-28T18:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187227",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,3 +44,9 @@
 I understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)
 
 I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.
+
+Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example
+
+```
+Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})
+```
``````




---

archive/issue_comments_187228.json:
```json
{
    "body": "Branch: **[u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels)**",
    "created_at": "2018-06-28T13:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187228",
    "user": "https://github.com/vit-tucek"
}
```

Branch: **[u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels)**



---

archive/issue_comments_187229.json:
```json
{
    "body": "Author: **V\u00edt Tu\u010dek**",
    "created_at": "2018-06-28T13:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187229",
    "user": "https://github.com/vit-tucek"
}
```

Author: **Vít Tuček**



---

archive/issue_comments_187230.json:
```json
{
    "body": "Changed keywords from **combinat, show, plot, posets** to **combinat, show, plot, posets, days94**",
    "created_at": "2018-06-28T13:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187230",
    "user": "https://github.com/vit-tucek"
}
```

Changed keywords from **combinat, show, plot, posets** to **combinat, show, plot, posets, days94**



---

archive/issue_events_217037.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2018-06-28T13:46:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217037"
}
```



---

archive/issue_comments_187231.json:
```json
{
    "body": "Commit: **[`9421575`](https://github.com/sagemath/sagetrac-mirror/commit/9421575232da114b3fb936c3e906b65b2dbedcf3)**",
    "created_at": "2018-06-28T13:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187231",
    "user": "https://github.com/vit-tucek"
}
```

Commit: **[`9421575`](https://github.com/sagemath/sagetrac-mirror/commit/9421575232da114b3fb936c3e906b65b2dbedcf3)**



---

archive/issue_events_217038.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217038"
}
```



---

archive/issue_events_217039.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217039"
}
```



---

archive/issue_events_217040.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217040"
}
```



---

archive/issue_events_217041.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217041"
}
```



---

archive/issue_comments_187232.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI would do this as:\n\n```sage\nclass ElementWithLabel:\n    \"\"\"\n    Auxiliary class for showing Posets with non-ijective relabeling. \n    \"\"\"\n    def __init__(self, element, label):\n        self.element = element\n        self.label = label\n        \n    def _latex_(self):\n        return latex(self.label)\n\n    def __repr__(self):\n        return repr(self.label)\n\n    def __hash__(self):\n        return hash(repr(self.label)) ^ hash(repr(self.element))\n```\nor something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.\n\nAlso, all methods need doctests.",
    "created_at": "2018-06-28T14:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187232",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

I would do this as:

```sage
class ElementWithLabel:
    """
    Auxiliary class for showing Posets with non-ijective relabeling. 
    """
    def __init__(self, element, label):
        self.element = element
        self.label = label
        
    def _latex_(self):
        return latex(self.label)

    def __repr__(self):
        return repr(self.label)

    def __hash__(self):
        return hash(repr(self.label)) ^ hash(repr(self.element))
```
or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.

Also, all methods need doctests.



---

archive/issue_comments_187233.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI propose the following as it has saner behaviour:\n\n```sage\nclass ElementWithLabel:\n    \"\"\"\n    Auxiliary class for showing Posets with non-ijective relabeling. \n    \"\"\"\n    def __init__(self, element, label):\n        self.element = element\n        self.label = label\n        \n    def _latex_(self):\n        return latex(self.label)\n    \n    def __str__(self):\n        return str(self.label)\n\n    def __repr__(self):\n        return repr(self.label)\n    \n    def __hash__(self):\n        return hash((hash(self.element), hash(self.label)))\n    \n    def __eq__(self, other):\n        return self.element == other.element and self.label == other.label\n```\n\nIt seems that this could be useful somewhere else as well. Is there some utility module where I could move this?\n\nReplying to [@tscrim](#comment:9):\n> I would do this as:\n> \n> ```sage\n> class ElementWithLabel:\n>     \"\"\"\n>     Auxiliary class for showing Posets with non-ijective relabeling. \n>     \"\"\"\n>     def __init__(self, element, label):\n>         self.element = element\n>         self.label = label\n>         \n>     def _latex_(self):\n>         return latex(self.label)\n> \n>     def __repr__(self):\n>         return repr(self.label)\n> \n>     def __hash__(self):\n>         return hash(repr(self.label)) ^ hash(repr(self.element))\n> ```\n> or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.\n> \n> Also, all methods need doctests.",
    "created_at": "2018-06-28T15:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187233",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:10" align="right">comment:10</div>

I propose the following as it has saner behaviour:

```sage
class ElementWithLabel:
    """
    Auxiliary class for showing Posets with non-ijective relabeling. 
    """
    def __init__(self, element, label):
        self.element = element
        self.label = label
        
    def _latex_(self):
        return latex(self.label)
    
    def __str__(self):
        return str(self.label)

    def __repr__(self):
        return repr(self.label)
    
    def __hash__(self):
        return hash((hash(self.element), hash(self.label)))
    
    def __eq__(self, other):
        return self.element == other.element and self.label == other.label
```

It seems that this could be useful somewhere else as well. Is there some utility module where I could move this?

Replying to [@tscrim](#comment:9):
> I would do this as:
> 
> ```sage
> class ElementWithLabel:
>     """
>     Auxiliary class for showing Posets with non-ijective relabeling. 
>     """
>     def __init__(self, element, label):
>         self.element = element
>         self.label = label
>         
>     def _latex_(self):
>         return latex(self.label)
> 
>     def __repr__(self):
>         return repr(self.label)
> 
>     def __hash__(self):
>         return hash(repr(self.label)) ^ hash(repr(self.element))
> ```
> or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.
> 
> Also, all methods need doctests.



---

archive/issue_comments_187234.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThat is a better hash, yes. Good catch about the `__eq__`, and you should also implement a `__ne__`. However, I still disagree about the `__str__` as it is overkill:\n\n```\nsage: class Foo(object):\n....:     def __repr__(self):\n....:         return \"hi\"\n....:     \nsage: str(Foo())\n'hi'\nsage: repr(Foo())\n'hi'\n```",
    "created_at": "2018-06-28T15:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187234",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

That is a better hash, yes. Good catch about the `__eq__`, and you should also implement a `__ne__`. However, I still disagree about the `__str__` as it is overkill:

```
sage: class Foo(object):
....:     def __repr__(self):
....:         return "hi"
....:     
sage: str(Foo())
'hi'
sage: repr(Foo())
'hi'
```



---

archive/issue_comments_187235.json:
```json
{
    "body": "Changed commit from **[`9421575`](https://github.com/sagemath/sagetrac-mirror/commit/9421575232da114b3fb936c3e906b65b2dbedcf3)** to **[`8253630`](https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34)**",
    "created_at": "2018-06-28T16:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9421575`](https://github.com/sagemath/sagetrac-mirror/commit/9421575232da114b3fb936c3e906b65b2dbedcf3)** to **[`8253630`](https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34)**



---

archive/issue_comments_187236.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34\"><code>8253630</code></a></td><td><code>add docstrings, equality and hashing</code></td></tr></table>\n",
    "created_at": "2018-06-28T16:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34"><code>8253630</code></a></td><td><code>add docstrings, equality and hashing</code></td></tr></table>




---

archive/issue_events_217042.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2018-06-28T16:17:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217042"
}
```



---

archive/issue_events_217043.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2018-06-28T16:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217043"
}
```



---

archive/issue_comments_187237.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553\"><code>ac4607d</code></a></td><td><code>adds forgotten tests for __ne__</code></td></tr></table>\n",
    "created_at": "2018-06-29T08:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187237",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553"><code>ac4607d</code></a></td><td><code>adds forgotten tests for __ne__</code></td></tr></table>




---

archive/issue_comments_187238.json:
```json
{
    "body": "Changed commit from **[`8253630`](https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34)** to **[`ac4607d`](https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553)**",
    "created_at": "2018-06-29T08:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187238",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8253630`](https://github.com/sagemath/sagetrac-mirror/commit/82536307866951ce7ad52705d87660d053952a34)** to **[`ac4607d`](https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553)**



---

archive/issue_comments_187239.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05\"><code>98c8fbd</code></a></td><td><code>need __str__as well</code></td></tr></table>\n",
    "created_at": "2018-06-29T17:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187239",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05"><code>98c8fbd</code></a></td><td><code>need __str__as well</code></td></tr></table>




---

archive/issue_comments_187240.json:
```json
{
    "body": "Changed commit from **[`ac4607d`](https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553)** to **[`98c8fbd`](https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05)**",
    "created_at": "2018-06-29T17:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187240",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ac4607d`](https://github.com/sagemath/sagetrac-mirror/commit/ac4607d1a548484d9d8f1860aa743fd51cc2b553)** to **[`98c8fbd`](https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05)**



---

archive/issue_comments_187241.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt is better (safer) to always do:\n\n```\nsage: from sage.combinat.posets.posets import ElementWithLabel\n```\nYour `__ne__` is missing a blankline after `TESTS::`. Also, I didn't read your proposed hash close enough when you proposed it. I think a better one would be\n\n```\nreturn hash((repr(self.element), repr(self.label)))\n```\nBecause your current version would not cover non-hashable labels. You also need to add a test for both of these two cases (non-hashable (e.g., mutable matrices) and non-injective labels).",
    "created_at": "2018-07-01T06:59:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187241",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

It is better (safer) to always do:

```
sage: from sage.combinat.posets.posets import ElementWithLabel
```
Your `__ne__` is missing a blankline after `TESTS::`. Also, I didn't read your proposed hash close enough when you proposed it. I think a better one would be

```
return hash((repr(self.element), repr(self.label)))
```
Because your current version would not cover non-hashable labels. You also need to add a test for both of these two cases (non-hashable (e.g., mutable matrices) and non-injective labels).



---

archive/issue_comments_187242.json:
```json
{
    "body": "Changed keywords from **combinat, show, plot, posets, days94** to **combinat, show, plot, posets, days94, daysICERM2018**",
    "created_at": "2018-07-23T20:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187242",
    "user": "https://github.com/darijgr"
}
```

Changed keywords from **combinat, show, plot, posets, days94** to **combinat, show, plot, posets, days94, daysICERM2018**



---

archive/issue_comments_187243.json:
```json
{
    "body": "Reviewer: **Darij Grinberg**",
    "created_at": "2018-07-23T20:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187243",
    "user": "https://github.com/darijgr"
}
```

Reviewer: **Darij Grinberg**



---

archive/issue_comments_187244.json:
```json
{
    "body": "Changed branch from **[u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels)** to **[public/ticket/15206](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15206)**",
    "created_at": "2018-07-23T20:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187244",
    "user": "https://github.com/darijgr"
}
```

Changed branch from **[u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels)** to **[public/ticket/15206](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15206)**



---

archive/issue_comments_187245.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe branch I've just pushed fixes the above, but the following needs to be done:\n\n* check that my two doctests actually look reasonably (I can't launch my png viewer currently);\n\n* similarly modify the graph code (and doctest it too).\n \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2848d9a6f11859497507c854223fdb4cdde123b9\"><code>2848d9a</code></a></td><td><code>Merge branch 'u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels' of git://trac.sagemath.org/sage into label</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ce28296dd92d9e212215810a9b233c7f72a1917\"><code>4ce2829</code></a></td><td><code>improve doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968\"><code>30b8d83</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>\n",
    "created_at": "2018-07-23T20:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187245",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:17" align="right">comment:17</div>

The branch I've just pushed fixes the above, but the following needs to be done:

* check that my two doctests actually look reasonably (I can't launch my png viewer currently);

* similarly modify the graph code (and doctest it too).
 
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2848d9a6f11859497507c854223fdb4cdde123b9"><code>2848d9a</code></a></td><td><code>Merge branch 'u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels' of git://trac.sagemath.org/sage into label</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ce28296dd92d9e212215810a9b233c7f72a1917"><code>4ce2829</code></a></td><td><code>improve doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968"><code>30b8d83</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>




---

archive/issue_comments_187246.json:
```json
{
    "body": "Changed commit from **[`98c8fbd`](https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05)** to **[`30b8d83`](https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968)**",
    "created_at": "2018-07-23T20:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187246",
    "user": "https://github.com/darijgr"
}
```

Changed commit from **[`98c8fbd`](https://github.com/sagemath/sagetrac-mirror/commit/98c8fbd43f6477a9690c25afeb51cb46f61a9d05)** to **[`30b8d83`](https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968)**



---

archive/issue_comments_187247.json:
```json
{
    "body": "Changed commit from **[`30b8d83`](https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968)** to **[`3a013a3`](https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd)**",
    "created_at": "2018-07-23T20:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187247",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`30b8d83`](https://github.com/sagemath/sagetrac-mirror/commit/30b8d837b95c8709f44a69e4cf810a09992f6968)** to **[`3a013a3`](https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd)**



---

archive/issue_comments_187248.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd\"><code>3a013a3</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>\n",
    "created_at": "2018-07-23T20:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187248",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd"><code>3a013a3</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>




---

archive/issue_comments_187249.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e\"><code>00c7ec3</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>\n",
    "created_at": "2018-07-23T20:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187249",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e"><code>00c7ec3</code></a></td><td><code>move ElementWithLabel class to sage.misc</code></td></tr></table>




---

archive/issue_comments_187250.json:
```json
{
    "body": "Changed commit from **[`3a013a3`](https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd)** to **[`00c7ec3`](https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e)**",
    "created_at": "2018-07-23T20:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187250",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3a013a3`](https://github.com/sagemath/sagetrac-mirror/commit/3a013a395193b9c8f442d702accc115b101667fd)** to **[`00c7ec3`](https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e)**



---

archive/issue_comments_187251.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOK, it seems that the graph plot functionality doesn't even allow vertex labels. So it's not urgent. Once the functionality is there, we should be easily able to use the ElementWithLabel class to make them non-injective.",
    "created_at": "2018-07-23T20:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187251",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:20" align="right">comment:20</div>

OK, it seems that the graph plot functionality doesn't even allow vertex labels. So it's not urgent. Once the functionality is there, we should be easily able to use the ElementWithLabel class to make them non-injective.



---

archive/issue_comments_187252.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9\"><code>ebac495</code></a></td><td><code>change `__hash__` and __eq__</code></td></tr></table>\n",
    "created_at": "2018-07-24T13:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187252",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9"><code>ebac495</code></a></td><td><code>change `__hash__` and __eq__</code></td></tr></table>




---

archive/issue_comments_187253.json:
```json
{
    "body": "Changed commit from **[`00c7ec3`](https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e)** to **[`ebac495`](https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9)**",
    "created_at": "2018-07-24T13:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187253",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`00c7ec3`](https://github.com/sagemath/sagetrac-mirror/commit/00c7ec320aa927bf2fd6064755d36462e642e90e)** to **[`ebac495`](https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9)**



---

archive/issue_comments_187254.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd855c5dcd93a5ffb7250cd7544c7b06f6414fe5\"><code>cd855c5</code></a></td><td><code>Revert \"change `__hash__` and __eq__\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d21e16a9f2c7a5118978e7795b4e83cefa89794\"><code>4d21e16</code></a></td><td><code>drop unnecessary import</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19\"><code>b1e7b37</code></a></td><td><code>add examples of usage</code></td></tr></table>\n",
    "created_at": "2018-07-24T22:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187254",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd855c5dcd93a5ffb7250cd7544c7b06f6414fe5"><code>cd855c5</code></a></td><td><code>Revert "change `__hash__` and __eq__"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d21e16a9f2c7a5118978e7795b4e83cefa89794"><code>4d21e16</code></a></td><td><code>drop unnecessary import</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19"><code>b1e7b37</code></a></td><td><code>add examples of usage</code></td></tr></table>




---

archive/issue_comments_187255.json:
```json
{
    "body": "Changed commit from **[`ebac495`](https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9)** to **[`b1e7b37`](https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19)**",
    "created_at": "2018-07-24T22:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187255",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ebac495`](https://github.com/sagemath/sagetrac-mirror/commit/ebac4959372f54f9909bf9fabb6fc195bad230e9)** to **[`b1e7b37`](https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19)**



---

archive/issue_comments_187256.json:
```json
{
    "body": "Changed commit from **[`b1e7b37`](https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19)** to **[`2a10cfc`](https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749)**",
    "created_at": "2018-07-25T01:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187256",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b1e7b37`](https://github.com/sagemath/sagetrac-mirror/commit/b1e7b37a8e632d46e0612f509be3f0420b31fe19)** to **[`2a10cfc`](https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749)**



---

archive/issue_comments_187257.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f12a6b5d6ad96c0c58f328be1c773c20823888ed\"><code>f12a6b5</code></a></td><td><code>Merge branch 'public/ticket/15206' of git://trac.sagemath.org/sage into 15206</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749\"><code>2a10cfc</code></a></td><td><code>trivial doc fix</code></td></tr></table>\n",
    "created_at": "2018-07-25T01:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187257",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f12a6b5d6ad96c0c58f328be1c773c20823888ed"><code>f12a6b5</code></a></td><td><code>Merge branch 'public/ticket/15206' of git://trac.sagemath.org/sage into 15206</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749"><code>2a10cfc</code></a></td><td><code>trivial doc fix</code></td></tr></table>




---

archive/issue_comments_187258.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nLGTM.\n\n![](https://pbs.twimg.com/media/DiWsOPgW4AAYTSD.jpg)\n\nLGTY?",
    "created_at": "2018-07-25T01:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187258",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:24" align="right">comment:24</div>

LGTM.

![](https://pbs.twimg.com/media/DiWsOPgW4AAYTSD.jpg)

LGTY?



---

archive/issue_comments_187259.json:
```json
{
    "body": "Changed keywords from **combinat, show, plot, posets, days94, daysICERM2018** to **combinat, show, plot, posets, days94, sagedays@ICERM**",
    "created_at": "2018-07-25T01:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187259",
    "user": "https://github.com/darijgr"
}
```

Changed keywords from **combinat, show, plot, posets, days94, daysICERM2018** to **combinat, show, plot, posets, days94, sagedays@ICERM**



---

archive/issue_comments_187260.json:
```json
{
    "body": "Changed keywords from **combinat, show, plot, posets, days94, sagedays@ICERM** to **combinat, show, plot, posets, days94, sagedays@icerm**",
    "created_at": "2018-07-25T01:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187260",
    "user": "https://github.com/darijgr"
}
```

Changed keywords from **combinat, show, plot, posets, days94, sagedays@ICERM** to **combinat, show, plot, posets, days94, sagedays@icerm**



---

archive/issue_comments_187261.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nLGTM :)\n\nBut patchbot is complaining and I don't know why.",
    "created_at": "2018-07-25T14:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187261",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:27" align="right">comment:27</div>

LGTM :)

But patchbot is complaining and I don't know why.



---

archive/issue_comments_187262.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51\"><code>b107cd1</code></a></td><td><code>Made a test that has a poset with only one linear extension</code></td></tr></table>\n",
    "created_at": "2018-07-25T15:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187262",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51"><code>b107cd1</code></a></td><td><code>Made a test that has a poset with only one linear extension</code></td></tr></table>




---

archive/issue_comments_187263.json:
```json
{
    "body": "Changed commit from **[`2a10cfc`](https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749)** to **[`b107cd1`](https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51)**",
    "created_at": "2018-07-25T15:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187263",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2a10cfc`](https://github.com/sagemath/sagetrac-mirror/commit/2a10cfcc31afc43c4e3662b97d384c8b4a513749)** to **[`b107cd1`](https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51)**



---

archive/issue_comments_187264.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nTwo more small things (sorry!). The first is you should make `ElementWithLabel` a \"new-style\" class (inherit from `object`). Second, I thought a little bit more about the `__hash__`, the `self.element` should be guaranteed to be hashable. So I'm thinking we should just have\n\n```\ndef __hash__(self):\n    return hash(self.element)\n```",
    "created_at": "2018-07-26T03:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187264",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">comment:29</div>

Two more small things (sorry!). The first is you should make `ElementWithLabel` a "new-style" class (inherit from `object`). Second, I thought a little bit more about the `__hash__`, the `self.element` should be guaranteed to be hashable. So I'm thinking we should just have

```
def __hash__(self):
    return hash(self.element)
```



---

archive/issue_events_217044.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T03:20:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217044"
}
```



---

archive/issue_events_217045.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T03:20:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217045"
}
```



---

archive/issue_comments_187265.json:
```json
{
    "body": "Changed reviewer from **Darij Grinberg** to **Darij Grinberg, Travis Scrimshaw**",
    "created_at": "2018-07-26T03:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187265",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Darij Grinberg** to **Darij Grinberg, Travis Scrimshaw**



---

archive/issue_comments_187266.json:
```json
{
    "body": "Changed commit from **[`b107cd1`](https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51)** to **[`5d97480`](https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe)**",
    "created_at": "2018-07-26T14:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187266",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b107cd1`](https://github.com/sagemath/sagetrac-mirror/commit/b107cd1877353d09a321cb3942ef8755fbb3fc51)** to **[`5d97480`](https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe)**



---

archive/issue_comments_187267.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe\"><code>5d97480</code></a></td><td><code>make ElementWithLabel new style class</code></td></tr></table>\n",
    "created_at": "2018-07-26T14:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187267",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe"><code>5d97480</code></a></td><td><code>make ElementWithLabel new style class</code></td></tr></table>




---

archive/issue_comments_187268.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI have actually run into some caching issues when it was just `hash(self.element)` so after discussion with Nicolas and Darij I reverted my patch to the current combinantion of hashes of element and label. I guess the best argument, which iirc came from Darij, is that we might want to have same posets but with different labels and so we need to take labels into account for equality testing and for hashing.",
    "created_at": "2018-07-26T14:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187268",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:31" align="right">comment:31</div>

I have actually run into some caching issues when it was just `hash(self.element)` so after discussion with Nicolas and Darij I reverted my patch to the current combinantion of hashes of element and label. I guess the best argument, which iirc came from Darij, is that we might want to have same posets but with different labels and so we need to take labels into account for equality testing and for hashing.



---

archive/issue_comments_187269.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSince elements are both distinct and hashable since they are used for the vertices, adding the labels does not affect the equality or hashing. I guess since this is meant to be used in a more general setting, we do not have same guarantees on the elements. So this is fine. Just one little more change to simplify the hashing code (which is the \"same\" as the `repr` version):\n\n```diff\n-return hash((hash(self.element), hash(self.label)))\n+return hash((self.element), self.label))\n```",
    "created_at": "2018-07-26T23:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187269",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Since elements are both distinct and hashable since they are used for the vertices, adding the labels does not affect the equality or hashing. I guess since this is meant to be used in a more general setting, we do not have same guarantees on the elements. So this is fine. Just one little more change to simplify the hashing code (which is the "same" as the `repr` version):

```diff
-return hash((hash(self.element), hash(self.label)))
+return hash((self.element), self.label))
```



---

archive/issue_comments_187270.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSay you want to create a poset with nonijective labels and plot it several times with different options (e.g. cover labels or vertex colors etc). In that case you want to do something like this `my_poset.relabel(lambda e: ElementWithLabel(e, my_label(e)))` If we hashed only `self.element` it could happen (see e.g. the test case with `WeylGroup.bruhat_poset`) that the new relabeled poset would have the same hash as the original poset and that would break things.",
    "created_at": "2018-07-27T14:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187270",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:33" align="right">comment:33</div>

Say you want to create a poset with nonijective labels and plot it several times with different options (e.g. cover labels or vertex colors etc). In that case you want to do something like this `my_poset.relabel(lambda e: ElementWithLabel(e, my_label(e)))` If we hashed only `self.element` it could happen (see e.g. the test case with `WeylGroup.bruhat_poset`) that the new relabeled poset would have the same hash as the original poset and that would break things.



---

archive/issue_comments_187271.json:
```json
{
    "body": "Changed commit from **[`5d97480`](https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe)** to **[`1100f6b`](https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f)**",
    "created_at": "2018-07-27T14:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187271",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5d97480`](https://github.com/sagemath/sagetrac-mirror/commit/5d97480084a9939f2ec07fc2665ef2635501dcbe)** to **[`1100f6b`](https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f)**



---

archive/issue_comments_187272.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f\"><code>1100f6b</code></a></td><td><code>simplify hash</code></td></tr></table>\n",
    "created_at": "2018-07-27T14:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187272",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f"><code>1100f6b</code></a></td><td><code>simplify hash</code></td></tr></table>




---

archive/issue_comments_187273.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIt doesn't matter if the poset has the same hash, it is the equality that matters. It is a problem if and only if they are being considered as equal and getting different hashes. Can you give explicit code that is breaking if two posets are *not* equal (isomorphic is okay) but have the same hash?",
    "created_at": "2018-07-27T14:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187273",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

It doesn't matter if the poset has the same hash, it is the equality that matters. It is a problem if and only if they are being considered as equal and getting different hashes. Can you give explicit code that is breaking if two posets are *not* equal (isomorphic is okay) but have the same hash?



---

archive/issue_comments_187274.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\n\n```sage\nsage: from sage.misc.element_with_label import ElementWithLabel\nsage: P1 = Poset({1:[2,3]})                                                                  \nsage: P2 = Poset({ElementWithLabel(1, \"a\"): [ElementWithLabel(2, \"b\"), ElementWithLabel(3, \"c\")]})\n```\n\nWith the current implementation (i.e. `hash((self.element, self.label))`) this works. If we did just `hash(self.element)` then we would get \n\n```sage\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-29-74e94a2baaf3> in <module>()\n----> 1 P2 = Poset({ElementWithLabel(Integer(1), \"a\"): [ElementWithLabel(Integer(2), \"b\"), ElementWithLabel(Integer(3), \"c\")]})\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in Poset(data, element_labels, cover_relations, linear_extension, category, facade, key)\n    745     else:\n    746         elements = None\n--> 747     return FinitePoset(D, elements=elements, category=category, facade=facade, key=key)\n    748 \n    749 \n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()\n    327         \"\"\"\n    328         if cls.classcall is not None:\n--> 329             return cls.classcall(cls, *args, **kwds)\n    330         else:\n    331             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in __classcall__(cls, hasse_diagram, elements, category, facade, key)\n    964                                                      elements=elements,\n    965                                                      category=category, facade=facade,\n--> 966                                                      key=key)\n    967 \n    968     def __init__(self, hasse_diagram, elements, category, facade, key):\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6174)()\n    998         try:\n    999             try:\n-> 1000                 return self.cache[k]\n   1001             except TypeError:  # k is not hashable\n   1002                 k = dict_key(k)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3538)()\n    704 \n    705         \"\"\"\n--> 706         cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    707         if wr == NULL:\n    708             raise KeyError(k)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/cpython/dict_del_by_value.pyx in sage.cpython.dict_del_by_value.PyDict_GetItemWithError (build/cythonized/sage/cpython/dict_del_by_value.c:1199)()\n     56         cdef PyDictEntry* ep\n     57         cdef PyDictObject* mp = <PyDictObject*><void *>op\n---> 58         ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))\n     59         if ep:\n     60             return ep.me_value\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __eq__(self, other)\n    588                 return False\n    589         # Vertices\n--> 590         if any(x not in other for x in self):\n    591             return False\n    592         # Finally, we are prepared to check edges:\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <genexpr>((x,))\n    588                 return False\n    589         # Vertices\n--> 590         if any(x not in other for x in self):\n    591             return False\n    592         # Finally, we are prepared to check edges:\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in has_vertex(self, vertex)\n   9263         except Exception:\n   9264             return False\n-> 9265         return self._backend.has_vertex(vertex)\n   9266 \n   9267     __contains__ = has_vertex\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/base/static_sparse_backend.pyx in sage.graphs.base.static_sparse_backend.StaticSparseBackend.has_vertex (build/cythonized/sage/graphs/base/static_sparse_backend.c:10628)()\n    464             False\n    465         \"\"\"\n--> 466         return v in self._vertex_to_int\n    467 \n    468     def relabel(self, perm, directed):\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/element_with_label.pyc in __eq__(self, other)\n    147             True\n    148         \"\"\"\n--> 149         return self.element == other.element and self.label == other.label\n    150 \n    151     def __ne__(self, other):\n\nAttributeError: 'int' object has no attribute 'element'\n\n```\n\nIf I remember correctly, what's going on is that the constructor of `FinitePoset`  looks into cache which has as keys `_hasse_diagram` and then it finds the `_hasse_diagram` of `P1` and just uses that which causes these problems (`self` is ElementWithLabel while `other` is `int` ... or the other way around).",
    "created_at": "2018-07-27T15:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187274",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:36" align="right">comment:36</div>


```sage
sage: from sage.misc.element_with_label import ElementWithLabel
sage: P1 = Poset({1:[2,3]})                                                                  
sage: P2 = Poset({ElementWithLabel(1, "a"): [ElementWithLabel(2, "b"), ElementWithLabel(3, "c")]})
```

With the current implementation (i.e. `hash((self.element, self.label))`) this works. If we did just `hash(self.element)` then we would get 

```sage
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-29-74e94a2baaf3> in <module>()
----> 1 P2 = Poset({ElementWithLabel(Integer(1), "a"): [ElementWithLabel(Integer(2), "b"), ElementWithLabel(Integer(3), "c")]})

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in Poset(data, element_labels, cover_relations, linear_extension, category, facade, key)
    745     else:
    746         elements = None
--> 747     return FinitePoset(D, elements=elements, category=category, facade=facade, key=key)
    748 
    749 

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()
    327         """
    328         if cls.classcall is not None:
--> 329             return cls.classcall(cls, *args, **kwds)
    330         else:
    331             # Fast version of type.__call__(cls, *args, **kwds)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in __classcall__(cls, hasse_diagram, elements, category, facade, key)
    964                                                      elements=elements,
    965                                                      category=category, facade=facade,
--> 966                                                      key=key)
    967 
    968     def __init__(self, hasse_diagram, elements, category, facade, key):

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6174)()
    998         try:
    999             try:
-> 1000                 return self.cache[k]
   1001             except TypeError:  # k is not hashable
   1002                 k = dict_key(k)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3538)()
    704 
    705         """
--> 706         cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    707         if wr == NULL:
    708             raise KeyError(k)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/cpython/dict_del_by_value.pyx in sage.cpython.dict_del_by_value.PyDict_GetItemWithError (build/cythonized/sage/cpython/dict_del_by_value.c:1199)()
     56         cdef PyDictEntry* ep
     57         cdef PyDictObject* mp = <PyDictObject*><void *>op
---> 58         ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))
     59         if ep:
     60             return ep.me_value

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __eq__(self, other)
    588                 return False
    589         # Vertices
--> 590         if any(x not in other for x in self):
    591             return False
    592         # Finally, we are prepared to check edges:

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <genexpr>((x,))
    588                 return False
    589         # Vertices
--> 590         if any(x not in other for x in self):
    591             return False
    592         # Finally, we are prepared to check edges:

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in has_vertex(self, vertex)
   9263         except Exception:
   9264             return False
-> 9265         return self._backend.has_vertex(vertex)
   9266 
   9267     __contains__ = has_vertex

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/base/static_sparse_backend.pyx in sage.graphs.base.static_sparse_backend.StaticSparseBackend.has_vertex (build/cythonized/sage/graphs/base/static_sparse_backend.c:10628)()
    464             False
    465         """
--> 466         return v in self._vertex_to_int
    467 
    468     def relabel(self, perm, directed):

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/element_with_label.pyc in __eq__(self, other)
    147             True
    148         """
--> 149         return self.element == other.element and self.label == other.label
    150 
    151     def __ne__(self, other):

AttributeError: 'int' object has no attribute 'element'

```

If I remember correctly, what's going on is that the constructor of `FinitePoset`  looks into cache which has as keys `_hasse_diagram` and then it finds the `_hasse_diagram` of `P1` and just uses that which causes these problems (`self` is ElementWithLabel while `other` is `int` ... or the other way around).



---

archive/issue_comments_187275.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThe hash space may be large, but I don't like the idea of relying on distinctness of hashes.",
    "created_at": "2018-07-27T15:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187275",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:37" align="right">comment:37</div>

The hash space may be large, but I don't like the idea of relying on distinctness of hashes.



---

archive/issue_comments_187276.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@darijgr](#comment:37):\n> The hash space may be large, but I don't like the idea of relying on distinctness of hashes.\n\nCnstructor of `Poset` could use some love [https://trac.sagemath.org/ticket/23825](https://trac.sagemath.org/ticket/23825)",
    "created_at": "2018-07-27T18:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187276",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@darijgr](#comment:37):
> The hash space may be large, but I don't like the idea of relying on distinctness of hashes.

Cnstructor of `Poset` could use some love [https://trac.sagemath.org/ticket/23825](https://trac.sagemath.org/ticket/23825)



---

archive/issue_comments_187277.json:
```json
{
    "body": "Changed branch from **[public/ticket/15206](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15206)** to **[public/misc/non_hashable_injective_labels-15206](https://github.com/sagemath/sagetrac-mirror/tree/public/misc/non_hashable_injective_labels-15206)**",
    "created_at": "2018-07-27T21:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187277",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[public/ticket/15206](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15206)** to **[public/misc/non_hashable_injective_labels-15206](https://github.com/sagemath/sagetrac-mirror/tree/public/misc/non_hashable_injective_labels-15206)**



---

archive/issue_comments_187278.json:
```json
{
    "body": "Changed commit from **[`1100f6b`](https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f)** to **[`9b21a67`](https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee)**",
    "created_at": "2018-07-27T21:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187278",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`1100f6b`](https://github.com/sagemath/sagetrac-mirror/commit/1100f6b1a962e26598ab759511f66b5b3934896f)** to **[`9b21a67`](https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee)**



---

archive/issue_comments_187279.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThe problem is not with posets but with the equality check:\n\n```\nsage: from sage.misc.element_with_label import ElementWithLabel\nsage: 1 == ElementWithLabel(1, 'a')\n# BOOM\n```\nHere is a fix for the `__eq__` (which I think is my fault for not caching it earlier as I thought this would only be compared internally). The example now works with the simplified hash.\n\nIf my changes are good, then I think we can set a positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee\"><code>9b21a67</code></a></td><td><code>Fixing `__eq__` method and simplifying hash.</code></td></tr></table>\n",
    "created_at": "2018-07-27T21:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187279",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

The problem is not with posets but with the equality check:

```
sage: from sage.misc.element_with_label import ElementWithLabel
sage: 1 == ElementWithLabel(1, 'a')
# BOOM
```
Here is a fix for the `__eq__` (which I think is my fault for not caching it earlier as I thought this would only be compared internally). The example now works with the simplified hash.

If my changes are good, then I think we can set a positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee"><code>9b21a67</code></a></td><td><code>Fixing `__eq__` method and simplifying hash.</code></td></tr></table>




---

archive/issue_comments_187280.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nping?",
    "created_at": "2018-08-05T21:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187280",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:40" align="right">comment:40</div>

ping?



---

archive/issue_comments_187281.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512\"><code>dc46c1b</code></a></td><td><code>fix doctest in __hash__</code></td></tr></table>\n",
    "created_at": "2018-08-10T11:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187281",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512"><code>dc46c1b</code></a></td><td><code>fix doctest in __hash__</code></td></tr></table>




---

archive/issue_comments_187282.json:
```json
{
    "body": "Changed commit from **[`9b21a67`](https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee)** to **[`dc46c1b`](https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512)**",
    "created_at": "2018-08-10T11:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187282",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9b21a67`](https://github.com/sagemath/sagetrac-mirror/commit/9b21a674710b710e46830905222b765507b25bee)** to **[`dc46c1b`](https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512)**



---

archive/issue_comments_187283.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nActually, that `hash` output is almost certainly different on 32 and 64 bit machines. We probably want to change said test to `hash(a) == hash(a.element)`. Also the hash docstring is now incorrect (my fault).",
    "created_at": "2018-08-10T23:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187283",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

Actually, that `hash` output is almost certainly different on 32 and 64 bit machines. We probably want to change said test to `hash(a) == hash(a.element)`. Also the hash docstring is now incorrect (my fault).



---

archive/issue_comments_187284.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577\"><code>9a81c6d</code></a></td><td><code>fix docstring and test</code></td></tr></table>\n",
    "created_at": "2018-08-11T09:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187284",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577"><code>9a81c6d</code></a></td><td><code>fix docstring and test</code></td></tr></table>




---

archive/issue_comments_187285.json:
```json
{
    "body": "Changed commit from **[`dc46c1b`](https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512)** to **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**",
    "created_at": "2018-08-11T09:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187285",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dc46c1b`](https://github.com/sagemath/sagetrac-mirror/commit/dc46c1bb90262abb84205364e756a00e88413512)** to **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**



---

archive/issue_comments_187286.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nAny idea why patchbot is not green?",
    "created_at": "2018-08-17T11:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187286",
    "user": "https://github.com/vit-tucek"
}
```

<div id="comment:44" align="right">comment:44</div>

Any idea why patchbot is not green?



---

archive/issue_comments_187287.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nUnrelated failures (you can consider it green).",
    "created_at": "2018-08-17T11:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187287",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Unrelated failures (you can consider it green).



---

archive/issue_comments_187288.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nPing? (Now a clearly green patchbot.)",
    "created_at": "2018-08-27T02:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187288",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

Ping? (Now a clearly green patchbot.)



---

archive/issue_comments_187289.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nSeems to be a clear code. I can check this one later today.",
    "created_at": "2018-08-27T05:42:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187289",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:47" align="right">comment:47</div>

Seems to be a clear code. I can check this one later today.



---

archive/issue_comments_187290.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nNot sure who should be author and who should be reviewed, but at least the code works.\n\n(Got a headache when comparing `vertex_labels` in graphs and `elements_labels` in posets, but that's another story.)",
    "created_at": "2018-08-27T11:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187290",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:48" align="right">comment:48</div>

Not sure who should be author and who should be reviewed, but at least the code works.

(Got a headache when comparing `vertex_labels` in graphs and `elements_labels` in posets, but that's another story.)



---

archive/issue_comments_187291.json:
```json
{
    "body": "Changed reviewer from **Darij Grinberg, Travis Scrimshaw** to **Jori M\u00e4ntysalo, Darij Grinberg, Travis Scrimshaw**",
    "created_at": "2018-08-27T11:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187291",
    "user": "https://github.com/jm58660"
}
```

Changed reviewer from **Darij Grinberg, Travis Scrimshaw** to **Jori Mäntysalo, Darij Grinberg, Travis Scrimshaw**



---

archive/issue_events_217046.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2018-08-27T11:30:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217046"
}
```



---

archive/issue_events_217047.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2018-08-27T11:30:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217047"
}
```



---

archive/issue_events_217048.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217048"
}
```



---

archive/issue_events_217049.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e3b915e3031b392483718d1d8df18d0204e9e1af",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-30T22:25:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15206#event-217049"
}
```



---

archive/issue_comments_187292.json:
```json
{
    "body": "Changed branch from **[public/misc/non_hashable_injective_labels-15206](https://github.com/sagemath/sagetrac-mirror/tree/public/misc/non_hashable_injective_labels-15206)** to **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**",
    "created_at": "2018-08-30T22:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15206#issuecomment-187292",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/misc/non_hashable_injective_labels-15206](https://github.com/sagemath/sagetrac-mirror/tree/public/misc/non_hashable_injective_labels-15206)** to **[`9a81c6d`](https://github.com/sagemath/sagetrac-mirror/commit/9a81c6df3d6ba3d950e6c566825f20eea41d6577)**
