# Issue 15206: Poset show should accept non-hashable or non-injective element labels

archive/issues_014969.json:
```json
{
    "body": "```\nsage: P = Poset({1: [2,3]})\nsage: labs = {i: P.rank(i) for i in range(1, 4)}\nsage: labs\n{1: 0, 2: 1, 3: 1}\nsage: P.show(element_labels=labs)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-38-dfd00191eb55> in <module>()\n----> 1 P.show(element_labels=labs)\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in show(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)\n   1440         \"\"\"\n   1441         self.plot(label_elements=label_elements, element_labels=element_labels,\n-> 1442             vertex_size=vertex_size, vertex_colors=vertex_colors, layout=layout).show(**kwds)\n   1443 \n   1444     @combinatorial_map(name=\"to graph\")\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in plot(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)\n   1402             relabelling = dict((self(element), label)\n   1403                                for (element, label) in element_labels.items())\n-> 1404             graph = graph.relabel(relabelling, inplace = False)\n   1405             if rank_function: # use the rank function to set the heights\n   1406                 for i in self:\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)\n  16208                               return_map= return_map,\n  16209                               check_input = check_input,\n> 16210                               complete_partial_function = complete_partial_function)\n  16211 \n  16212             if return_map:\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)\n  16263         if check_input:\n  16264             if len(set(perm.values())) < len(perm):\n> 16265                 raise NotImplementedError(\"Non injective relabeling\")\n  16266 \n  16267             for v in perm.iterkeys():\n\nNotImplementedError: Non injective relabeling\n```\n\nI understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)\n\nI am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.\n\nFixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example\n\n```\nPoset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})\n```\n\nCC:  @jm58660 @vit-tucek\n\nKeywords: combinat, show, plot, posets, days94, sagedays@icerm\n\nBranch/Commit: 9a81c6df3d6ba3d950e6c566825f20eea41d6577\n\nReviewer: Jori M\u00e4ntysalo, Darij Grinberg, Travis Scrimshaw\n\nAuthor: V\u00edt Tu\u010dek\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15206\n\n",
    "closed_at": "2018-08-30T22:25:02Z",
    "created_at": "2013-09-18T04:35:28Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Poset show should accept non-hashable or non-injective element labels",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15206",
    "user": "https://github.com/darijgr"
}
```
```
sage: P = Poset({1: [2,3]})
sage: labs = {i: P.rank(i) for i in range(1, 4)}
sage: labs
{1: 0, 2: 1, 3: 1}
sage: P.show(element_labels=labs)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-38-dfd00191eb55> in <module>()
----> 1 P.show(element_labels=labs)

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in show(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)
   1440         """
   1441         self.plot(label_elements=label_elements, element_labels=element_labels,
-> 1442             vertex_size=vertex_size, vertex_colors=vertex_colors, layout=layout).show(**kwds)
   1443 
   1444     @combinatorial_map(name="to graph")

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in plot(self, label_elements, element_labels, vertex_size, vertex_colors, layout, **kwds)
   1402             relabelling = dict((self(element), label)
   1403                                for (element, label) in element_labels.items())
-> 1404             graph = graph.relabel(relabelling, inplace = False)
   1405             if rank_function: # use the rank function to set the heights
   1406                 for i in self:

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)
  16208                               return_map= return_map,
  16209                               check_input = check_input,
> 16210                               complete_partial_function = complete_partial_function)
  16211 
  16212             if return_map:

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in relabel(self, perm, inplace, return_map, check_input, complete_partial_function)
  16263         if check_input:
  16264             if len(set(perm.values())) < len(perm):
> 16265                 raise NotImplementedError("Non injective relabeling")
  16266 
  16267             for v in perm.iterkeys():

NotImplementedError: Non injective relabeling
```

I understand that this, along with the lack of support for non-hashable labels, is owed to the implementation, but IMHO this means that the implementation (via relabelling the poset before plotting it, rather than as one would expect via doing everything as if the labels weren't there and then introducing them at the very end) is bad. (Incidentally, I'm not even sure that the shape of the image doesn't depend on the labels -- in the examples I've checked it seems to not depend on them, but I don't trust the code very much.)

I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.

Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example

```
Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})
```

CC:  @jm58660 @vit-tucek

Keywords: combinat, show, plot, posets, days94, sagedays@icerm

Branch/Commit: 9a81c6df3d6ba3d950e6c566825f20eea41d6577

Reviewer: Jori Mäntysalo, Darij Grinberg, Travis Scrimshaw

Author: Vít Tuček

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15206





---

archive/issue_events_043911.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43911"
}
```



---

archive/issue_events_043912.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43912"
}
```



---

archive/issue_events_043913.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43913"
}
```



---

archive/issue_events_043914.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43914"
}
```



---

archive/issue_events_043915.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43915"
}
```



---

archive/issue_comments_240173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,7 +44,11 @@\n \n I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.\n \n-Keywords: combinat, show, plot, posets\n+Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example\n+\n+```\n+Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-05-28T18:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240173",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,7 +44,11 @@
 
 I am not the type of mathematician who gets any enlightenment out of pictures, but even I do need to use `show()` when I'm making a presentation. Issues like this harm the presentability of Sage code.
 
-Keywords: combinat, show, plot, posets
+Fixing this would also help with problem when combining `vertex_colors` and `element_labels`. See for example
+
+```
+Poset({1:[]}).plot(vertex_colors={'red':[1]}, element_labels={1: 2})
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_240174.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels\"",
    "created_at": "2018-06-28T13:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240174",
    "user": "https://github.com/vit-tucek"
}
```

Changing branch from "" to "u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels"



---

archive/issue_comments_240175.json:
```json
{
    "body": "Changing author from \"\" to \"V\u00edt Tu\u010dek\"",
    "created_at": "2018-06-28T13:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240175",
    "user": "https://github.com/vit-tucek"
}
```

Changing author from "" to "Vít Tuček"



---

archive/issue_comments_240176.json:
```json
{
    "body": "Changing keywords from \"combinat, show, plot, posets\" to \"combinat, show, plot, posets, days94\".",
    "created_at": "2018-06-28T13:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240176",
    "user": "https://github.com/vit-tucek"
}
```

Changing keywords from "combinat, show, plot, posets" to "combinat, show, plot, posets, days94".



---

archive/issue_comments_240177.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-28T13:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240177",
    "user": "https://github.com/vit-tucek"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_240178.json:
```json
{
    "body": "Changing commit from \"\" to \"9421575232da114b3fb936c3e906b65b2dbedcf3\"",
    "created_at": "2018-06-28T13:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240178",
    "user": "https://github.com/vit-tucek"
}
```

Changing commit from "" to "9421575232da114b3fb936c3e906b65b2dbedcf3"



---

archive/issue_events_043916.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43916"
}
```



---

archive/issue_events_043917.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-28T14:23:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43917"
}
```



---

archive/issue_comments_240179.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-28T14:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240179",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240180.json:
```json
{
    "body": "<a id='comment:9'></a>I would do this as:\n\n```sage\nclass ElementWithLabel:\n    \"\"\"\n    Auxiliary class for showing Posets with non-ijective relabeling. \n    \"\"\"\n    def __init__(self, element, label):\n        self.element = element\n        self.label = label\n        \n    def _latex_(self):\n        return latex(self.label)\n\n    def __repr__(self):\n        return repr(self.label)\n\n    def __hash__(self):\n        return hash(repr(self.label)) ^ hash(repr(self.element))\n```\nor something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.\n\nAlso, all methods need doctests.",
    "created_at": "2018-06-28T14:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240180",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>I would do this as:

```sage
class ElementWithLabel:
    """
    Auxiliary class for showing Posets with non-ijective relabeling. 
    """
    def __init__(self, element, label):
        self.element = element
        self.label = label
        
    def _latex_(self):
        return latex(self.label)

    def __repr__(self):
        return repr(self.label)

    def __hash__(self):
        return hash(repr(self.label)) ^ hash(repr(self.element))
```
or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.

Also, all methods need doctests.



---

archive/issue_comments_240181.json:
```json
{
    "body": "<a id='comment:10'></a>I propose the following as it has saner behaviour:\n\n```sage\nclass ElementWithLabel:\n    \"\"\"\n    Auxiliary class for showing Posets with non-ijective relabeling. \n    \"\"\"\n    def __init__(self, element, label):\n        self.element = element\n        self.label = label\n        \n    def _latex_(self):\n        return latex(self.label)\n    \n    def __str__(self):\n        return str(self.label)\n\n    def __repr__(self):\n        return repr(self.label)\n    \n    def __hash__(self):\n        return hash((hash(self.element), hash(self.label)))\n    \n    def __eq__(self, other):\n        return self.element == other.element and self.label == other.label\n```\n\nIt seems that this could be useful somewhere else as well. Is there some utility module where I could move this?\n\nReplying to [comment:9 tscrim]:\n> I would do this as:\n> \n> ```sage\n> class ElementWithLabel:\n>     \"\"\"\n>     Auxiliary class for showing Posets with non-ijective relabeling. \n>     \"\"\"\n>     def __init__(self, element, label):\n>         self.element = element\n>         self.label = label\n>         \n>     def _latex_(self):\n>         return latex(self.label)\n> \n>     def __repr__(self):\n>         return repr(self.label)\n> \n>     def __hash__(self):\n>         return hash(repr(self.label)) ^ hash(repr(self.element))\n> ```\n> or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.\n> \n> Also, all methods need doctests.",
    "created_at": "2018-06-28T15:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240181",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:10'></a>I propose the following as it has saner behaviour:

```sage
class ElementWithLabel:
    """
    Auxiliary class for showing Posets with non-ijective relabeling. 
    """
    def __init__(self, element, label):
        self.element = element
        self.label = label
        
    def _latex_(self):
        return latex(self.label)
    
    def __str__(self):
        return str(self.label)

    def __repr__(self):
        return repr(self.label)
    
    def __hash__(self):
        return hash((hash(self.element), hash(self.label)))
    
    def __eq__(self, other):
        return self.element == other.element and self.label == other.label
```

It seems that this could be useful somewhere else as well. Is there some utility module where I could move this?

Replying to [comment:9 tscrim]:
> I would do this as:
> 
> ```sage
> class ElementWithLabel:
>     """
>     Auxiliary class for showing Posets with non-ijective relabeling. 
>     """
>     def __init__(self, element, label):
>         self.element = element
>         self.label = label
>         
>     def _latex_(self):
>         return latex(self.label)
> 
>     def __repr__(self):
>         return repr(self.label)
> 
>     def __hash__(self):
>         return hash(repr(self.label)) ^ hash(repr(self.element))
> ```
> or something like that for the hash. It should not need a `__str__` because of the `__repr__`. Typically we use `repr` in Sage, but I don't care if that becomes a `str`.
> 
> Also, all methods need doctests.



---

archive/issue_comments_240182.json:
```json
{
    "body": "<a id='comment:11'></a>That is a better hash, yes. Good catch about the `__eq__`, and you should also implement a `__ne__`. However, I still disagree about the `__str__` as it is overkill:\n\n```\nsage: class Foo(object):\n....:     def __repr__(self):\n....:         return \"hi\"\n....:     \nsage: str(Foo())\n'hi'\nsage: repr(Foo())\n'hi'\n```",
    "created_at": "2018-06-28T15:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240182",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>That is a better hash, yes. Good catch about the `__eq__`, and you should also implement a `__ne__`. However, I still disagree about the `__str__` as it is overkill:

```
sage: class Foo(object):
....:     def __repr__(self):
....:         return "hi"
....:     
sage: str(Foo())
'hi'
sage: repr(Foo())
'hi'
```



---

archive/issue_comments_240183.json:
```json
{
    "body": "Changing commit from \"9421575232da114b3fb936c3e906b65b2dbedcf3\" to \"82536307866951ce7ad52705d87660d053952a34\"",
    "created_at": "2018-06-28T16:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9421575232da114b3fb936c3e906b65b2dbedcf3" to "82536307866951ce7ad52705d87660d053952a34"



---

archive/issue_comments_240184.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-28T16:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240185.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-28T16:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240185",
    "user": "https://github.com/vit-tucek"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240186.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-29T08:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240187.json:
```json
{
    "body": "Changing commit from \"82536307866951ce7ad52705d87660d053952a34\" to \"ac4607d1a548484d9d8f1860aa743fd51cc2b553\"",
    "created_at": "2018-06-29T08:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "82536307866951ce7ad52705d87660d053952a34" to "ac4607d1a548484d9d8f1860aa743fd51cc2b553"



---

archive/issue_comments_240188.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-29T17:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240189.json:
```json
{
    "body": "Changing commit from \"ac4607d1a548484d9d8f1860aa743fd51cc2b553\" to \"98c8fbd43f6477a9690c25afeb51cb46f61a9d05\"",
    "created_at": "2018-06-29T17:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ac4607d1a548484d9d8f1860aa743fd51cc2b553" to "98c8fbd43f6477a9690c25afeb51cb46f61a9d05"



---

archive/issue_comments_240190.json:
```json
{
    "body": "<a id='comment:16'></a>It is better (safer) to always do:\n\n```\nsage: from sage.combinat.posets.posets import ElementWithLabel\n```\nYour `__ne__` is missing a blankline after `TESTS::`. Also, I didn't read your proposed hash close enough when you proposed it. I think a better one would be\n\n```\nreturn hash((repr(self.element), repr(self.label)))\n```\nBecause your current version would not cover non-hashable labels. You also need to add a test for both of these two cases (non-hashable (e.g., mutable matrices) and non-injective labels).",
    "created_at": "2018-07-01T06:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240190",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>It is better (safer) to always do:

```
sage: from sage.combinat.posets.posets import ElementWithLabel
```
Your `__ne__` is missing a blankline after `TESTS::`. Also, I didn't read your proposed hash close enough when you proposed it. I think a better one would be

```
return hash((repr(self.element), repr(self.label)))
```
Because your current version would not cover non-hashable labels. You also need to add a test for both of these two cases (non-hashable (e.g., mutable matrices) and non-injective labels).



---

archive/issue_comments_240191.json:
```json
{
    "body": "Changing keywords from \"combinat, show, plot, posets, days94\" to \"combinat, show, plot, posets, days94, daysICERM2018\".",
    "created_at": "2018-07-23T20:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240191",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "combinat, show, plot, posets, days94" to "combinat, show, plot, posets, days94, daysICERM2018".



---

archive/issue_comments_240192.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Darij Grinberg\"",
    "created_at": "2018-07-23T20:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240192",
    "user": "https://github.com/darijgr"
}
```

Changing reviewer from "" to "Darij Grinberg"



---

archive/issue_comments_240193.json:
```json
{
    "body": "Changing branch from \"u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels\" to \"public/ticket/15206\"",
    "created_at": "2018-07-23T20:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240193",
    "user": "https://github.com/darijgr"
}
```

Changing branch from "u/vittucek/poset_show_should_accept_non_hashable_or_non_injective_element_labels" to "public/ticket/15206"



---

archive/issue_comments_240194.json:
```json
{
    "body": "<a id='comment:17'></a>The branch I've just pushed fixes the above, but the following needs to be done:\n\n* check that my two doctests actually look reasonably (I can't launch my png viewer currently);\n\n* similarly modify the graph code (and doctest it too).\n \n---\nNew commits:",
    "created_at": "2018-07-23T20:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240194",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:17'></a>The branch I've just pushed fixes the above, but the following needs to be done:

* check that my two doctests actually look reasonably (I can't launch my png viewer currently);

* similarly modify the graph code (and doctest it too).
 
---
New commits:



---

archive/issue_comments_240195.json:
```json
{
    "body": "Changing commit from \"98c8fbd43f6477a9690c25afeb51cb46f61a9d05\" to \"30b8d837b95c8709f44a69e4cf810a09992f6968\"",
    "created_at": "2018-07-23T20:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240195",
    "user": "https://github.com/darijgr"
}
```

Changing commit from "98c8fbd43f6477a9690c25afeb51cb46f61a9d05" to "30b8d837b95c8709f44a69e4cf810a09992f6968"



---

archive/issue_comments_240196.json:
```json
{
    "body": "Changing commit from \"30b8d837b95c8709f44a69e4cf810a09992f6968\" to \"3a013a395193b9c8f442d702accc115b101667fd\"",
    "created_at": "2018-07-23T20:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "30b8d837b95c8709f44a69e4cf810a09992f6968" to "3a013a395193b9c8f442d702accc115b101667fd"



---

archive/issue_comments_240197.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-23T20:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240198.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-23T20:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240199.json:
```json
{
    "body": "Changing commit from \"3a013a395193b9c8f442d702accc115b101667fd\" to \"00c7ec320aa927bf2fd6064755d36462e642e90e\"",
    "created_at": "2018-07-23T20:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3a013a395193b9c8f442d702accc115b101667fd" to "00c7ec320aa927bf2fd6064755d36462e642e90e"



---

archive/issue_comments_240200.json:
```json
{
    "body": "<a id='comment:20'></a>OK, it seems that the graph plot functionality doesn't even allow vertex labels. So it's not urgent. Once the functionality is there, we should be easily able to use the ElementWithLabel class to make them non-injective.",
    "created_at": "2018-07-23T20:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240200",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:20'></a>OK, it seems that the graph plot functionality doesn't even allow vertex labels. So it's not urgent. Once the functionality is there, we should be easily able to use the ElementWithLabel class to make them non-injective.



---

archive/issue_comments_240201.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-24T13:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240202.json:
```json
{
    "body": "Changing commit from \"00c7ec320aa927bf2fd6064755d36462e642e90e\" to \"ebac4959372f54f9909bf9fabb6fc195bad230e9\"",
    "created_at": "2018-07-24T13:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "00c7ec320aa927bf2fd6064755d36462e642e90e" to "ebac4959372f54f9909bf9fabb6fc195bad230e9"



---

archive/issue_comments_240203.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-24T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240204.json:
```json
{
    "body": "Changing commit from \"ebac4959372f54f9909bf9fabb6fc195bad230e9\" to \"b1e7b37a8e632d46e0612f509be3f0420b31fe19\"",
    "created_at": "2018-07-24T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ebac4959372f54f9909bf9fabb6fc195bad230e9" to "b1e7b37a8e632d46e0612f509be3f0420b31fe19"



---

archive/issue_comments_240205.json:
```json
{
    "body": "Changing commit from \"b1e7b37a8e632d46e0612f509be3f0420b31fe19\" to \"2a10cfcc31afc43c4e3662b97d384c8b4a513749\"",
    "created_at": "2018-07-25T01:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b1e7b37a8e632d46e0612f509be3f0420b31fe19" to "2a10cfcc31afc43c4e3662b97d384c8b4a513749"



---

archive/issue_comments_240206.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T01:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240206",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240207.json:
```json
{
    "body": "<a id='comment:24'></a>LGTM.\n\n![](https://pbs.twimg.com/media/DiWsOPgW4AAYTSD.jpg)\n\nLGTY?",
    "created_at": "2018-07-25T01:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240207",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:24'></a>LGTM.

![](https://pbs.twimg.com/media/DiWsOPgW4AAYTSD.jpg)

LGTY?



---

archive/issue_comments_240208.json:
```json
{
    "body": "Changing keywords from \"combinat, show, plot, posets, days94, daysICERM2018\" to \"combinat, show, plot, posets, days94, sagedays@ICERM\".",
    "created_at": "2018-07-25T01:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240208",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "combinat, show, plot, posets, days94, daysICERM2018" to "combinat, show, plot, posets, days94, sagedays@ICERM".



---

archive/issue_comments_240209.json:
```json
{
    "body": "Changing keywords from \"combinat, show, plot, posets, days94, sagedays@ICERM\" to \"combinat, show, plot, posets, days94, sagedays@icerm\".",
    "created_at": "2018-07-25T01:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240209",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "combinat, show, plot, posets, days94, sagedays@ICERM" to "combinat, show, plot, posets, days94, sagedays@icerm".



---

archive/issue_comments_240210.json:
```json
{
    "body": "<a id='comment:27'></a>LGTM :)\n\nBut patchbot is complaining and I don't know why.",
    "created_at": "2018-07-25T14:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240210",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:27'></a>LGTM :)

But patchbot is complaining and I don't know why.



---

archive/issue_comments_240211.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240212.json:
```json
{
    "body": "Changing commit from \"2a10cfcc31afc43c4e3662b97d384c8b4a513749\" to \"b107cd1877353d09a321cb3942ef8755fbb3fc51\"",
    "created_at": "2018-07-25T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2a10cfcc31afc43c4e3662b97d384c8b4a513749" to "b107cd1877353d09a321cb3942ef8755fbb3fc51"



---

archive/issue_comments_240213.json:
```json
{
    "body": "<a id='comment:29'></a>Two more small things (sorry!). The first is you should make `ElementWithLabel` a \"new-style\" class (inherit from `object`). Second, I thought a little bit more about the `__hash__`, the `self.element` should be guaranteed to be hashable. So I'm thinking we should just have\n\n```\ndef __hash__(self):\n    return hash(self.element)\n```",
    "created_at": "2018-07-26T03:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240213",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>Two more small things (sorry!). The first is you should make `ElementWithLabel` a "new-style" class (inherit from `object`). Second, I thought a little bit more about the `__hash__`, the `self.element` should be guaranteed to be hashable. So I'm thinking we should just have

```
def __hash__(self):
    return hash(self.element)
```



---

archive/issue_events_043918.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T03:20:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43918"
}
```



---

archive/issue_events_043919.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T03:20:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43919"
}
```



---

archive/issue_comments_240214.json:
```json
{
    "body": "Changing reviewer from \"Darij Grinberg\" to \"Darij Grinberg, Travis Scrimshaw\"",
    "created_at": "2018-07-26T03:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240214",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Darij Grinberg" to "Darij Grinberg, Travis Scrimshaw"



---

archive/issue_comments_240215.json:
```json
{
    "body": "Changing commit from \"b107cd1877353d09a321cb3942ef8755fbb3fc51\" to \"5d97480084a9939f2ec07fc2665ef2635501dcbe\"",
    "created_at": "2018-07-26T14:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b107cd1877353d09a321cb3942ef8755fbb3fc51" to "5d97480084a9939f2ec07fc2665ef2635501dcbe"



---

archive/issue_comments_240216.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T14:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240217.json:
```json
{
    "body": "<a id='comment:31'></a>I have actually run into some caching issues when it was just `hash(self.element)` so after discussion with Nicolas and Darij I reverted my patch to the current combinantion of hashes of element and label. I guess the best argument, which iirc came from Darij, is that we might want to have same posets but with different labels and so we need to take labels into account for equality testing and for hashing.",
    "created_at": "2018-07-26T14:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240217",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:31'></a>I have actually run into some caching issues when it was just `hash(self.element)` so after discussion with Nicolas and Darij I reverted my patch to the current combinantion of hashes of element and label. I guess the best argument, which iirc came from Darij, is that we might want to have same posets but with different labels and so we need to take labels into account for equality testing and for hashing.



---

archive/issue_comments_240218.json:
```json
{
    "body": "<a id='comment:32'></a>Since elements are both distinct and hashable since they are used for the vertices, adding the labels does not affect the equality or hashing. I guess since this is meant to be used in a more general setting, we do not have same guarantees on the elements. So this is fine. Just one little more change to simplify the hashing code (which is the \"same\" as the `repr` version):\n\n```diff\n-return hash((hash(self.element), hash(self.label)))\n+return hash((self.element), self.label))\n```",
    "created_at": "2018-07-26T23:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240218",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>Since elements are both distinct and hashable since they are used for the vertices, adding the labels does not affect the equality or hashing. I guess since this is meant to be used in a more general setting, we do not have same guarantees on the elements. So this is fine. Just one little more change to simplify the hashing code (which is the "same" as the `repr` version):

```diff
-return hash((hash(self.element), hash(self.label)))
+return hash((self.element), self.label))
```



---

archive/issue_comments_240219.json:
```json
{
    "body": "<a id='comment:33'></a>Say you want to create a poset with nonijective labels and plot it several times with different options (e.g. cover labels or vertex colors etc). In that case you want to do something like this `my_poset.relabel(lambda e: ElementWithLabel(e, my_label(e)))` If we hashed only `self.element` it could happen (see e.g. the test case with `WeylGroup.bruhat_poset`) that the new relabeled poset would have the same hash as the original poset and that would break things.",
    "created_at": "2018-07-27T14:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240219",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:33'></a>Say you want to create a poset with nonijective labels and plot it several times with different options (e.g. cover labels or vertex colors etc). In that case you want to do something like this `my_poset.relabel(lambda e: ElementWithLabel(e, my_label(e)))` If we hashed only `self.element` it could happen (see e.g. the test case with `WeylGroup.bruhat_poset`) that the new relabeled poset would have the same hash as the original poset and that would break things.



---

archive/issue_comments_240220.json:
```json
{
    "body": "Changing commit from \"5d97480084a9939f2ec07fc2665ef2635501dcbe\" to \"1100f6b1a962e26598ab759511f66b5b3934896f\"",
    "created_at": "2018-07-27T14:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5d97480084a9939f2ec07fc2665ef2635501dcbe" to "1100f6b1a962e26598ab759511f66b5b3934896f"



---

archive/issue_comments_240221.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T14:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240222.json:
```json
{
    "body": "<a id='comment:35'></a>It doesn't matter if the poset has the same hash, it is the equality that matters. It is a problem if and only if they are being considered as equal and getting different hashes. Can you give explicit code that is breaking if two posets are *not* equal (isomorphic is okay) but have the same hash?",
    "created_at": "2018-07-27T14:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240222",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>It doesn't matter if the poset has the same hash, it is the equality that matters. It is a problem if and only if they are being considered as equal and getting different hashes. Can you give explicit code that is breaking if two posets are *not* equal (isomorphic is okay) but have the same hash?



---

archive/issue_comments_240223.json:
```json
{
    "body": "<a id='comment:36'></a>\n```sage\nsage: from sage.misc.element_with_label import ElementWithLabel\nsage: P1 = Poset({1:[2,3]})                                                                  \nsage: P2 = Poset({ElementWithLabel(1, \"a\"): [ElementWithLabel(2, \"b\"), ElementWithLabel(3, \"c\")]})\n```\n\nWith the current implementation (i.e. `hash((self.element, self.label))`) this works. If we did just `hash(self.element)` then we would get \n\n```sage\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-29-74e94a2baaf3> in <module>()\n----> 1 P2 = Poset({ElementWithLabel(Integer(1), \"a\"): [ElementWithLabel(Integer(2), \"b\"), ElementWithLabel(Integer(3), \"c\")]})\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in Poset(data, element_labels, cover_relations, linear_extension, category, facade, key)\n    745     else:\n    746         elements = None\n--> 747     return FinitePoset(D, elements=elements, category=category, facade=facade, key=key)\n    748 \n    749 \n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()\n    327         \"\"\"\n    328         if cls.classcall is not None:\n--> 329             return cls.classcall(cls, *args, **kwds)\n    330         else:\n    331             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in __classcall__(cls, hasse_diagram, elements, category, facade, key)\n    964                                                      elements=elements,\n    965                                                      category=category, facade=facade,\n--> 966                                                      key=key)\n    967 \n    968     def __init__(self, hasse_diagram, elements, category, facade, key):\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6174)()\n    998         try:\n    999             try:\n-> 1000                 return self.cache[k]\n   1001             except TypeError:  # k is not hashable\n   1002                 k = dict_key(k)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3538)()\n    704 \n    705         \"\"\"\n--> 706         cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    707         if wr == NULL:\n    708             raise KeyError(k)\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/cpython/dict_del_by_value.pyx in sage.cpython.dict_del_by_value.PyDict_GetItemWithError (build/cythonized/sage/cpython/dict_del_by_value.c:1199)()\n     56         cdef PyDictEntry* ep\n     57         cdef PyDictObject* mp = <PyDictObject*><void *>op\n---> 58         ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))\n     59         if ep:\n     60             return ep.me_value\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __eq__(self, other)\n    588                 return False\n    589         # Vertices\n--> 590         if any(x not in other for x in self):\n    591             return False\n    592         # Finally, we are prepared to check edges:\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <genexpr>((x,))\n    588                 return False\n    589         # Vertices\n--> 590         if any(x not in other for x in self):\n    591             return False\n    592         # Finally, we are prepared to check edges:\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in has_vertex(self, vertex)\n   9263         except Exception:\n   9264             return False\n-> 9265         return self._backend.has_vertex(vertex)\n   9266 \n   9267     __contains__ = has_vertex\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/base/static_sparse_backend.pyx in sage.graphs.base.static_sparse_backend.StaticSparseBackend.has_vertex (build/cythonized/sage/graphs/base/static_sparse_backend.c:10628)()\n    464             False\n    465         \"\"\"\n--> 466         return v in self._vertex_to_int\n    467 \n    468     def relabel(self, perm, directed):\n\n/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/element_with_label.pyc in __eq__(self, other)\n    147             True\n    148         \"\"\"\n--> 149         return self.element == other.element and self.label == other.label\n    150 \n    151     def __ne__(self, other):\n\nAttributeError: 'int' object has no attribute 'element'\n\n```\n\nIf I remember correctly, what's going on is that the constructor of `FinitePoset`  looks into cache which has as keys `_hasse_diagram` and then it finds the `_hasse_diagram` of `P1` and just uses that which causes these problems (`self` is ElementWithLabel while `other` is `int` ... or the other way around).",
    "created_at": "2018-07-27T15:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240223",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:36'></a>
```sage
sage: from sage.misc.element_with_label import ElementWithLabel
sage: P1 = Poset({1:[2,3]})                                                                  
sage: P2 = Poset({ElementWithLabel(1, "a"): [ElementWithLabel(2, "b"), ElementWithLabel(3, "c")]})
```

With the current implementation (i.e. `hash((self.element, self.label))`) this works. If we did just `hash(self.element)` then we would get 

```sage
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-29-74e94a2baaf3> in <module>()
----> 1 P2 = Poset({ElementWithLabel(Integer(1), "a"): [ElementWithLabel(Integer(2), "b"), ElementWithLabel(Integer(3), "c")]})

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in Poset(data, element_labels, cover_relations, linear_extension, category, facade, key)
    745     else:
    746         elements = None
--> 747     return FinitePoset(D, elements=elements, category=category, facade=facade, key=key)
    748 
    749 

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()
    327         """
    328         if cls.classcall is not None:
--> 329             return cls.classcall(cls, *args, **kwds)
    330         else:
    331             # Fast version of type.__call__(cls, *args, **kwds)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/combinat/posets/posets.pyc in __classcall__(cls, hasse_diagram, elements, category, facade, key)
    964                                                      elements=elements,
    965                                                      category=category, facade=facade,
--> 966                                                      key=key)
    967 
    968     def __init__(self, hasse_diagram, elements, category, facade, key):

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6174)()
    998         try:
    999             try:
-> 1000                 return self.cache[k]
   1001             except TypeError:  # k is not hashable
   1002                 k = dict_key(k)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3538)()
    704 
    705         """
--> 706         cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    707         if wr == NULL:
    708             raise KeyError(k)

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/cpython/dict_del_by_value.pyx in sage.cpython.dict_del_by_value.PyDict_GetItemWithError (build/cythonized/sage/cpython/dict_del_by_value.c:1199)()
     56         cdef PyDictEntry* ep
     57         cdef PyDictObject* mp = <PyDictObject*><void *>op
---> 58         ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))
     59         if ep:
     60             return ep.me_value

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __eq__(self, other)
    588                 return False
    589         # Vertices
--> 590         if any(x not in other for x in self):
    591             return False
    592         # Finally, we are prepared to check edges:

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <genexpr>((x,))
    588                 return False
    589         # Vertices
--> 590         if any(x not in other for x in self):
    591             return False
    592         # Finally, we are prepared to check edges:

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in has_vertex(self, vertex)
   9263         except Exception:
   9264             return False
-> 9265         return self._backend.has_vertex(vertex)
   9266 
   9267     __contains__ = has_vertex

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/graphs/base/static_sparse_backend.pyx in sage.graphs.base.static_sparse_backend.StaticSparseBackend.has_vertex (build/cythonized/sage/graphs/base/static_sparse_backend.c:10628)()
    464             False
    465         """
--> 466         return v in self._vertex_to_int
    467 
    468     def relabel(self, perm, directed):

/home/vit/src/sage/local/lib/python2.7/site-packages/sage/misc/element_with_label.pyc in __eq__(self, other)
    147             True
    148         """
--> 149         return self.element == other.element and self.label == other.label
    150 
    151     def __ne__(self, other):

AttributeError: 'int' object has no attribute 'element'

```

If I remember correctly, what's going on is that the constructor of `FinitePoset`  looks into cache which has as keys `_hasse_diagram` and then it finds the `_hasse_diagram` of `P1` and just uses that which causes these problems (`self` is ElementWithLabel while `other` is `int` ... or the other way around).



---

archive/issue_comments_240224.json:
```json
{
    "body": "<a id='comment:37'></a>The hash space may be large, but I don't like the idea of relying on distinctness of hashes.",
    "created_at": "2018-07-27T15:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240224",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:37'></a>The hash space may be large, but I don't like the idea of relying on distinctness of hashes.



---

archive/issue_comments_240225.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 gh-darijgr]:\n> The hash space may be large, but I don't like the idea of relying on distinctness of hashes.\n\nCnstructor of `Poset` could use some love [https://trac.sagemath.org/ticket/23825](https://trac.sagemath.org/ticket/23825)",
    "created_at": "2018-07-27T18:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240225",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:38'></a>Replying to [comment:37 gh-darijgr]:
> The hash space may be large, but I don't like the idea of relying on distinctness of hashes.

Cnstructor of `Poset` could use some love [https://trac.sagemath.org/ticket/23825](https://trac.sagemath.org/ticket/23825)



---

archive/issue_comments_240226.json:
```json
{
    "body": "Changing branch from \"public/ticket/15206\" to \"public/misc/non_hashable_injective_labels-15206\"",
    "created_at": "2018-07-27T21:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240226",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "public/ticket/15206" to "public/misc/non_hashable_injective_labels-15206"



---

archive/issue_comments_240227.json:
```json
{
    "body": "Changing commit from \"1100f6b1a962e26598ab759511f66b5b3934896f\" to \"9b21a674710b710e46830905222b765507b25bee\"",
    "created_at": "2018-07-27T21:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240227",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "1100f6b1a962e26598ab759511f66b5b3934896f" to "9b21a674710b710e46830905222b765507b25bee"



---

archive/issue_comments_240228.json:
```json
{
    "body": "<a id='comment:39'></a>The problem is not with posets but with the equality check:\n\n```\nsage: from sage.misc.element_with_label import ElementWithLabel\nsage: 1 == ElementWithLabel(1, 'a')\n# BOOM\n```\nHere is a fix for the `__eq__` (which I think is my fault for not caching it earlier as I thought this would only be compared internally). The example now works with the simplified hash.\n\nIf my changes are good, then I think we can set a positive review.\n\n---\nNew commits:",
    "created_at": "2018-07-27T21:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240228",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>The problem is not with posets but with the equality check:

```
sage: from sage.misc.element_with_label import ElementWithLabel
sage: 1 == ElementWithLabel(1, 'a')
# BOOM
```
Here is a fix for the `__eq__` (which I think is my fault for not caching it earlier as I thought this would only be compared internally). The example now works with the simplified hash.

If my changes are good, then I think we can set a positive review.

---
New commits:



---

archive/issue_comments_240229.json:
```json
{
    "body": "<a id='comment:40'></a>ping?",
    "created_at": "2018-08-05T21:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240229",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>ping?



---

archive/issue_comments_240230.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-10T11:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240231.json:
```json
{
    "body": "Changing commit from \"9b21a674710b710e46830905222b765507b25bee\" to \"dc46c1bb90262abb84205364e756a00e88413512\"",
    "created_at": "2018-08-10T11:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9b21a674710b710e46830905222b765507b25bee" to "dc46c1bb90262abb84205364e756a00e88413512"



---

archive/issue_comments_240232.json:
```json
{
    "body": "<a id='comment:42'></a>Actually, that `hash` output is almost certainly different on 32 and 64 bit machines. We probably want to change said test to `hash(a) == hash(a.element)`. Also the hash docstring is now incorrect (my fault).",
    "created_at": "2018-08-10T23:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240232",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Actually, that `hash` output is almost certainly different on 32 and 64 bit machines. We probably want to change said test to `hash(a) == hash(a.element)`. Also the hash docstring is now incorrect (my fault).



---

archive/issue_comments_240233.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-11T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240234.json:
```json
{
    "body": "Changing commit from \"dc46c1bb90262abb84205364e756a00e88413512\" to \"9a81c6df3d6ba3d950e6c566825f20eea41d6577\"",
    "created_at": "2018-08-11T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dc46c1bb90262abb84205364e756a00e88413512" to "9a81c6df3d6ba3d950e6c566825f20eea41d6577"



---

archive/issue_comments_240235.json:
```json
{
    "body": "<a id='comment:44'></a>Any idea why patchbot is not green?",
    "created_at": "2018-08-17T11:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240235",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:44'></a>Any idea why patchbot is not green?



---

archive/issue_comments_240236.json:
```json
{
    "body": "<a id='comment:45'></a>Unrelated failures (you can consider it green).",
    "created_at": "2018-08-17T11:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240236",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:45'></a>Unrelated failures (you can consider it green).



---

archive/issue_comments_240237.json:
```json
{
    "body": "<a id='comment:46'></a>Ping? (Now a clearly green patchbot.)",
    "created_at": "2018-08-27T02:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240237",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Ping? (Now a clearly green patchbot.)



---

archive/issue_comments_240238.json:
```json
{
    "body": "<a id='comment:47'></a>Seems to be a clear code. I can check this one later today.",
    "created_at": "2018-08-27T05:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240238",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:47'></a>Seems to be a clear code. I can check this one later today.



---

archive/issue_comments_240239.json:
```json
{
    "body": "<a id='comment:48'></a>Not sure who should be author and who should be reviewed, but at least the code works.\n\n(Got a headache when comparing `vertex_labels` in graphs and `elements_labels` in posets, but that's another story.)",
    "created_at": "2018-08-27T11:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240239",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:48'></a>Not sure who should be author and who should be reviewed, but at least the code works.

(Got a headache when comparing `vertex_labels` in graphs and `elements_labels` in posets, but that's another story.)



---

archive/issue_comments_240240.json:
```json
{
    "body": "Changing reviewer from \"Darij Grinberg, Travis Scrimshaw\" to \"Jori M\u00e4ntysalo, Darij Grinberg, Travis Scrimshaw\"",
    "created_at": "2018-08-27T11:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240240",
    "user": "https://github.com/jm58660"
}
```

Changing reviewer from "Darij Grinberg, Travis Scrimshaw" to "Jori Mäntysalo, Darij Grinberg, Travis Scrimshaw"



---

archive/issue_comments_240241.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-27T11:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240241",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240242.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-30T22:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240242",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_043920.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15206#event-43920"
}
```



---

archive/issue_comments_240243.json:
```json
{
    "body": "Changing branch from \"public/misc/non_hashable_injective_labels-15206\" to \"9a81c6df3d6ba3d950e6c566825f20eea41d6577\"",
    "created_at": "2018-08-30T22:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15206#issuecomment-240243",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/misc/non_hashable_injective_labels-15206" to "9a81c6df3d6ba3d950e6c566825f20eea41d6577"
