# Issue 15985: Python 3 preparation: Fix implicit relative imports (from sibling modules)

archive/issues_015748.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nPython 3 accepts only absolute imports and explicit relative imports. \nTo be Python 2 compatible all affected modules need <code>from \\`__future__\\` import absolute_import</code>.\n\n`lib2to3/fixes/fix_import.py` does not add this `__future__` import.\n\nTherefore we intend to use an enhanced fixer from `https://pypi.python.org/pypi/future/0.11.3`.\n\nThe latest development version also handles imports of pyx modules.\n\nChanges according to `libfuturize/fixes/fix_absolute_imports.py`:\n\n```\nIf spam is being imported from the local directory, this import:\n    from spam import eggs\nbecomes:\n    from .spam import eggs\n\nand this import:\n    import spam\nbecomes:\n    from . import spam\n```\n\nThis ticket is tracked as a dependency of meta-ticket ticket:15980.\n\nCC:  @tscrim @jm58660 @jdemeyer\n\nComponent: **python3**\n\nAuthor: **Wilfried Luebbe**\n\nBranch: **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15985_\n\n",
    "closed_at": "2016-07-27T20:24:57Z",
    "created_at": "2014-03-20T15:22:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20python3"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Python 3 preparation: Fix implicit relative imports (from sibling modules)",
    "type": "issue",
    "updated_at": "2017-04-14T09:38:43Z",
    "url": "https://github.com/sagemath/sage/issues/15985",
    "user": "https://github.com/wluebbe"
}
```
<div id="comment:0"></div>

Python 3 accepts only absolute imports and explicit relative imports. 
To be Python 2 compatible all affected modules need <code>from \`__future__\` import absolute_import</code>.

`lib2to3/fixes/fix_import.py` does not add this `__future__` import.

Therefore we intend to use an enhanced fixer from `https://pypi.python.org/pypi/future/0.11.3`.

The latest development version also handles imports of pyx modules.

Changes according to `libfuturize/fixes/fix_absolute_imports.py`:

```
If spam is being imported from the local directory, this import:
    from spam import eggs
becomes:
    from .spam import eggs

and this import:
    import spam
becomes:
    from . import spam
```

This ticket is tracked as a dependency of meta-ticket ticket:15980.

CC:  @tscrim @jm58660 @jdemeyer

Component: **python3**

Author: **Wilfried Luebbe**

Branch: **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/15985_





---

archive/issue_events_225998.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:22:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-225998"
}
```



---

archive/issue_events_225999.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-225999"
}
```



---

archive/issue_events_226000.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226000"
}
```



---

archive/issue_events_226001.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226001"
}
```



---

archive/issue_events_226002.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226002"
}
```



---

archive/issue_events_226003.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:47:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226003"
}
```



---

archive/issue_events_226004.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-03-20T15:47:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226004"
}
```



---

archive/issue_events_226005.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-01T09:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226005"
}
```



---

archive/issue_comments_202774.json:
```json
{
    "body": "Branch: **[u/wluebbe/ticket/15985](https://github.com/sagemath/sagetrac-mirror/tree/u/wluebbe/ticket/15985)**",
    "created_at": "2014-04-01T09:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202774",
    "user": "https://github.com/wluebbe"
}
```

Branch: **[u/wluebbe/ticket/15985](https://github.com/sagemath/sagetrac-mirror/tree/u/wluebbe/ticket/15985)**



---

archive/issue_comments_202775.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5\"><code>502ac5c</code></a></td><td><code>local run of futurize -w -f absolute_import</code></td></tr></table>\n",
    "created_at": "2014-04-01T09:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202775",
    "user": "https://github.com/wluebbe"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5"><code>502ac5c</code></a></td><td><code>local run of futurize -w -f absolute_import</code></td></tr></table>




---

archive/issue_comments_202776.json:
```json
{
    "body": "Commit: **[`502ac5c`](https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5)**",
    "created_at": "2014-04-01T09:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202776",
    "user": "https://github.com/wluebbe"
}
```

Commit: **[`502ac5c`](https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5)**



---

archive/issue_events_226006.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-01T09:39:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226006"
}
```



---

archive/issue_events_226007.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-01T09:39:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226007"
}
```



---

archive/issue_comments_202777.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTicket needs work :-(\n\nmake failed while building html-doc:\n\n```\nbyte-compiling /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/probability/random_variable.py to random_variable.pyc\nrunning install_egg_info\nRemoving /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info\nWriting /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info\n\nreal\t10m2.009s\nuser\t35m33.530s\nsys\t0m48.657s\n[ -f local/etc/sage-started.txt ] || local/bin/sage-starts\nbuild/pipestatus \"./sage --docbuild --no-pdf-links all html  2>&1\" \"tee -a logs/dochtml.log\"\nTraceback (most recent call last):\n  File \"/home/wluebbe/sage-6.2.beta4/src/doc/common/builder.py\", line 1465, in <module>\n    import sage.all\n  File \"/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/all.py\", line 87, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/misc/all.py\", line 94, in <module>\n    from .functional import (additive_order,\n  File \"/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 37, in <module>\n    from sage.rings.complex_double import CDF\n  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:17880)\n  File \"integer.pyx\", line 179, in init sage.rings.integer (sage/rings/integer.c:40148)\n  File \"/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 203, in <module>\n    import sage.rings.rational\n  File \"fast_arith.pxd\", line 5, in init sage.rings.rational (sage/rings/rational.c:29096)\n  File \"fast_arith.pyx\", line 51, in init sage.rings.fast_arith (sage/rings/fast_arith.c:8036)\n  File \"integer_ring.pyx\", line 65, in init sage.rings.integer_ring (sage/rings/integer_ring.c:12457)\n  File \"/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings/rational_field.py\", line 54, in <module>\n    from . import rational\nImportError: cannot import name rational\nmake: *** [doc-html] Error 1\n```\n\nThe problem occurs while trying to import the cython module `ration.pyx`. But `rational.so`is in the same subdir. So the explicit relative import should succeed.\n\n```\nwluebbe@Willis-Ubuntu:~/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings$ ls -l ratio*\n-rw-r--r-- 1 wluebbe wluebbe   28433 Apr  1 10:58 rational_field.py\n-rw-r--r-- 1 wluebbe wluebbe   34240 Apr  1 11:08 rational_field.pyc\n-rwxr-xr-x 1 wluebbe wluebbe 1666692 Apr  1 11:06 rational.so\n```",
    "created_at": "2014-04-01T09:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202777",
    "user": "https://github.com/wluebbe"
}
```

<div id="comment:3" align="right">comment:3</div>

Ticket needs work :-(

make failed while building html-doc:

```
byte-compiling /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/probability/random_variable.py to random_variable.pyc
running install_egg_info
Removing /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info
Writing /home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info

real	10m2.009s
user	35m33.530s
sys	0m48.657s
[ -f local/etc/sage-started.txt ] || local/bin/sage-starts
build/pipestatus "./sage --docbuild --no-pdf-links all html  2>&1" "tee -a logs/dochtml.log"
Traceback (most recent call last):
  File "/home/wluebbe/sage-6.2.beta4/src/doc/common/builder.py", line 1465, in <module>
    import sage.all
  File "/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/all.py", line 87, in <module>
    from sage.misc.all       import *         # takes a while
  File "/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/misc/all.py", line 94, in <module>
    from .functional import (additive_order,
  File "/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/misc/functional.py", line 37, in <module>
    from sage.rings.complex_double import CDF
  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:17880)
  File "integer.pyx", line 179, in init sage.rings.integer (sage/rings/integer.c:40148)
  File "/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 203, in <module>
    import sage.rings.rational
  File "fast_arith.pxd", line 5, in init sage.rings.rational (sage/rings/rational.c:29096)
  File "fast_arith.pyx", line 51, in init sage.rings.fast_arith (sage/rings/fast_arith.c:8036)
  File "integer_ring.pyx", line 65, in init sage.rings.integer_ring (sage/rings/integer_ring.c:12457)
  File "/home/wluebbe/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings/rational_field.py", line 54, in <module>
    from . import rational
ImportError: cannot import name rational
make: *** [doc-html] Error 1
```

The problem occurs while trying to import the cython module `ration.pyx`. But `rational.so`is in the same subdir. So the explicit relative import should succeed.

```
wluebbe@Willis-Ubuntu:~/sage-6.2.beta4/local/lib/python2.7/site-packages/sage/rings$ ls -l ratio*
-rw-r--r-- 1 wluebbe wluebbe   28433 Apr  1 10:58 rational_field.py
-rw-r--r-- 1 wluebbe wluebbe   34240 Apr  1 11:08 rational_field.pyc
-rwxr-xr-x 1 wluebbe wluebbe 1666692 Apr  1 11:06 rational.so
```



---

archive/issue_comments_202778.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e\"><code>cde9b0d</code></a></td><td><code>local run of futurize -w -f absolute_import</code></td></tr></table>\n",
    "created_at": "2014-04-03T08:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202778",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e"><code>cde9b0d</code></a></td><td><code>local run of futurize -w -f absolute_import</code></td></tr></table>




---

archive/issue_comments_202779.json:
```json
{
    "body": "Changed commit from **[`502ac5c`](https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5)** to **[`cde9b0d`](https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e)**",
    "created_at": "2014-04-03T08:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202779",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`502ac5c`](https://github.com/sagemath/sagetrac-mirror/commit/502ac5c98586116e74521bde30fb4c84edb507f5)** to **[`cde9b0d`](https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e)**



---

archive/issue_comments_202780.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRebased on 6.2.beta6 and resolved merge conflicts.",
    "created_at": "2014-04-03T08:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202780",
    "user": "https://github.com/wluebbe"
}
```

<div id="comment:5" align="right">comment:5</div>

Rebased on 6.2.beta6 and resolved merge conflicts.



---

archive/issue_comments_202781.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5\"><code>19692cb</code></a></td><td><code>imports: fix a few automated mistakes</code></td></tr></table>\n",
    "created_at": "2014-04-03T16:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202781",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:6"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5"><code>19692cb</code></a></td><td><code>imports: fix a few automated mistakes</code></td></tr></table>




---

archive/issue_comments_202782.json:
```json
{
    "body": "Author: **Wilfried Luebbe**",
    "created_at": "2014-04-03T16:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202782",
    "user": "https://github.com/ohanar"
}
```

Author: **Wilfried Luebbe**



---

archive/issue_comments_202783.json:
```json
{
    "body": "Changed commit from **[`cde9b0d`](https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e)** to **[`19692cb`](https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5)**",
    "created_at": "2014-04-03T16:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202783",
    "user": "https://github.com/ohanar"
}
```

Changed commit from **[`cde9b0d`](https://github.com/sagemath/sagetrac-mirror/commit/cde9b0dc8d749e32ce47ce34f3cc1131e4d3ef6e)** to **[`19692cb`](https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5)**



---

archive/issue_comments_202784.json:
```json
{
    "body": "Changed branch from **[u/wluebbe/ticket/15985](https://github.com/sagemath/sagetrac-mirror/tree/u/wluebbe/ticket/15985)** to **[u/ohanar/relative_imports](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/relative_imports)**",
    "created_at": "2014-04-03T16:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202784",
    "user": "https://github.com/ohanar"
}
```

Changed branch from **[u/wluebbe/ticket/15985](https://github.com/sagemath/sagetrac-mirror/tree/u/wluebbe/ticket/15985)** to **[u/ohanar/relative_imports](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/relative_imports)**



---

archive/issue_comments_202785.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSo it looks like the issue that you are getting into is the wonder that is affectionately referred to as Sage's import hell :).\n\nLooking at the traceback, it looks like the issue is a circular import that mysteriously works right now: `sage.rings.rational` imports something from `sage.rings.fast_arith` which imports something from `sage.rings.integer_ring` which imports something from `sage.rings.rational_field` which imports `sage.rings.rational`.\n\nThis is one of the big reasons why Sage is not truly usable as a python library, because the order in which you import Sage is incredibly delicate, and seems to magically work (and as you can see from this patch which shouldn't change anything, it truly is magical). There hasn't been much effort to fix this, but I would say that getting Python 3 working is a pretty big motivator.",
    "created_at": "2014-04-03T19:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202785",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:7" align="right">comment:7</div>

So it looks like the issue that you are getting into is the wonder that is affectionately referred to as Sage's import hell :).

Looking at the traceback, it looks like the issue is a circular import that mysteriously works right now: `sage.rings.rational` imports something from `sage.rings.fast_arith` which imports something from `sage.rings.integer_ring` which imports something from `sage.rings.rational_field` which imports `sage.rings.rational`.

This is one of the big reasons why Sage is not truly usable as a python library, because the order in which you import Sage is incredibly delicate, and seems to magically work (and as you can see from this patch which shouldn't change anything, it truly is magical). There hasn't been much effort to fix this, but I would say that getting Python 3 working is a pretty big motivator.



---

archive/issue_comments_202786.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOne thing to try (which still might break) is removing all relative imports in favor of absolute imports, rather than just converting them to explicit relative imports.",
    "created_at": "2014-04-04T00:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202786",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:8" align="right">comment:8</div>

One thing to try (which still might break) is removing all relative imports in favor of absolute imports, rather than just converting them to explicit relative imports.



---

archive/issue_comments_202787.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSome numbers:\n|                   |        |\n|-------------------|--------|\n|lines with \"import\"| 26,3231|\n|- thereof lines with \"from sage\"| 19,581|\n|- thereof lines with \"import sage\"| 1,650|\n|leaving lines with imports from Python \nstandard library and implicit relative import\n(and 1 explicit relative import :-)|| about 5,000||\n\nQuestions:\n* Is there agreement in the Sage community that absolute import is the way to go?\n* Can it help with the above `ImportError`? And similar ones?\n* Other benefits or drawbacks?",
    "created_at": "2014-04-04T08:29:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202787",
    "user": "https://github.com/wluebbe"
}
```

<div id="comment:9" align="right">comment:9</div>

Some numbers:
|                   |        |
|-------------------|--------|
|lines with "import"| 26,3231|
|- thereof lines with "from sage"| 19,581|
|- thereof lines with "import sage"| 1,650|
|leaving lines with imports from Python 
standard library and implicit relative import
(and 1 explicit relative import :-)|| about 5,000||

Questions:
* Is there agreement in the Sage community that absolute import is the way to go?
* Can it help with the above `ImportError`? And similar ones?
* Other benefits or drawbacks?



---

archive/issue_comments_202788.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAs your numbers indicate (and from my personal experience), there is definitely an unofficial convention to use absolute from..import statements in the sage library, i.e. `from sage.foo import bar`; however this is one of (if not the main) culprit behind the circular import issues of the Sage library. A lot of the circular import issues could be resolved by just importing a module, and not particular attributes of the module (i.e. using `import sage.foo` or `import sage.foo as bar` and using `sage.foo.baz`/`bar.baz` instead of `from sage.foo import baz`).",
    "created_at": "2014-04-04T13:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202788",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:10" align="right">comment:10</div>

As your numbers indicate (and from my personal experience), there is definitely an unofficial convention to use absolute from..import statements in the sage library, i.e. `from sage.foo import bar`; however this is one of (if not the main) culprit behind the circular import issues of the Sage library. A lot of the circular import issues could be resolved by just importing a module, and not particular attributes of the module (i.e. using `import sage.foo` or `import sage.foo as bar` and using `sage.foo.baz`/`bar.baz` instead of `from sage.foo import baz`).



---

archive/issue_comments_202789.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCan I read this proposal as:\n\nDo the (absolute) imports as `import sage.somewhere.amodule as am` and then use it as `am.a_function(a_parm)`.\n\nPerhaps the module could recommend its \"standard\" abbreviation (here `am`). Such a convention might help while reading code that uses the module.",
    "created_at": "2014-04-04T14:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202789",
    "user": "https://github.com/wluebbe"
}
```

<div id="comment:11" align="right">comment:11</div>

Can I read this proposal as:

Do the (absolute) imports as `import sage.somewhere.amodule as am` and then use it as `am.a_function(a_parm)`.

Perhaps the module could recommend its "standard" abbreviation (here `am`). Such a convention might help while reading code that uses the module.



---

archive/issue_events_226008.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226008"
}
```



---

archive/issue_events_226009.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226009"
}
```



---

archive/issue_events_226010.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226010"
}
```



---

archive/issue_events_226011.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226011"
}
```



---

archive/issue_events_226012.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-06T13:28:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226012"
}
```



---

archive/issue_events_226013.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-06T13:28:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226013"
}
```



---

archive/issue_comments_202790.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLet us do that chunk by chunk.\n\nSee #20958, #20960, #20955, #20945, #20947 for the first steps",
    "created_at": "2016-07-06T13:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202790",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

Let us do that chunk by chunk.

See #20958, #20960, #20955, #20945, #20947 for the first steps



---

archive/issue_events_226014.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-15T11:55:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226014"
}
```



---

archive/issue_comments_202791.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAlmost done, last step is #21036\n\nthere just remains a small problem in src/sage/misc/sagedoc.py",
    "created_at": "2016-07-17T12:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202791",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

Almost done, last step is #21036

there just remains a small problem in src/sage/misc/sagedoc.py



---

archive/issue_comments_202792.json:
```json
{
    "body": "Changed branch from **[u/ohanar/relative_imports](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/relative_imports)** to **[public/15985](https://github.com/sagemath/sagetrac-mirror/tree/public/15985)**",
    "created_at": "2016-07-19T12:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202792",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/ohanar/relative_imports](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/relative_imports)** to **[public/15985](https://github.com/sagemath/sagetrac-mirror/tree/public/15985)**



---

archive/issue_events_226015.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-19T12:14:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226015"
}
```



---

archive/issue_events_226016.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-19T12:14:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226016"
}
```



---

archive/issue_comments_202793.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHere is the very small last step. Hopefully the doctests will pass.\n\nFor the reviewer: to check, see that (after #21036 is closed)\n\n`futurize -w -f absolute_import src/sage`\n\ndoes nothing.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb\"><code>e2f59c2</code></a></td><td><code>trac 15985 last old-style import in misc</code></td></tr></table>\n",
    "created_at": "2016-07-19T12:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202793",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

Here is the very small last step. Hopefully the doctests will pass.

For the reviewer: to check, see that (after #21036 is closed)

`futurize -w -f absolute_import src/sage`

does nothing.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb"><code>e2f59c2</code></a></td><td><code>trac 15985 last old-style import in misc</code></td></tr></table>




---

archive/issue_comments_202794.json:
```json
{
    "body": "Changed commit from **[`19692cb`](https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5)** to **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**",
    "created_at": "2016-07-19T12:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202794",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`19692cb`](https://github.com/sagemath/sagetrac-mirror/commit/19692cba6ef085f5563f4302f34d6cb5c9a281e5)** to **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**



---

archive/issue_events_226017.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-25T10:05:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226017"
}
```



---

archive/issue_events_226018.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-25T10:05:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226018"
}
```



---

archive/issue_comments_202795.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-07-25T10:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202795",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_202796.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIt's not really the last step, since there are still a lot of implicit relative imports in Cython files.",
    "created_at": "2016-07-25T10:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202796",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

It's not really the last step, since there are still a lot of implicit relative imports in Cython files.



---

archive/issue_events_226019.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-27T20:24:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226019"
}
```



---

archive/issue_events_226020.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b1f509c9570b28af0a36d25eb0aec91f2f89cc8f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-07-27T20:24:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15985#event-226020"
}
```



---

archive/issue_comments_202797.json:
```json
{
    "body": "Changed branch from **[public/15985](https://github.com/sagemath/sagetrac-mirror/tree/public/15985)** to **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**",
    "created_at": "2016-07-27T20:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202797",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/15985](https://github.com/sagemath/sagetrac-mirror/tree/public/15985)** to **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)**



---

archive/issue_comments_202798.json:
```json
{
    "body": "Changed commit from **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)** to none",
    "created_at": "2017-04-14T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202798",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`e2f59c2`](https://github.com/sagemath/sagetrac-mirror/commit/e2f59c294fe0dd027b981e1945f21ae97bad6dfb)** to none



---

archive/issue_comments_202799.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment%3A18):\n> It's not really the last step, since there are still a lot of implicit relative imports in Cython files.\n\nSee #22806 and #22808.",
    "created_at": "2017-04-14T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202799",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment%3A18):
> It's not really the last step, since there are still a lot of implicit relative imports in Cython files.

See #22806 and #22808.



---

archive/issue_comments_202800.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@fchapoton](#comment%3A17):\n> Here is the very small last step.\n\nHow did you determine that this is the \"last step\"? In other words, how did you determine which modules need to be fixed?\n\nThere are still plenty of `.py` and `.pyx` files which do not have `from `__future__` import absolute_import`.",
    "created_at": "2017-04-14T09:38:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15985#issuecomment-202800",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@fchapoton](#comment%3A17):
> Here is the very small last step.

How did you determine that this is the "last step"? In other words, how did you determine which modules need to be fixed?

There are still plenty of `.py` and `.pyx` files which do not have `from `__future__` import absolute_import`.
