# Issue 15476: Involutions on NSym and QSym part I

archive/issues_015239.json:
```json
{
    "assignees": [],
    "body": "This got much longer than I expected it to be because there are three \"classical\" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.\n\nThe patch also speeds up NSym's Verschiebung on certain bases, fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?\n\nCC:  @tscrim sage-combinat @zabrocki @vbraun\n\nKeywords: **ncsf, nsym, qsym, sage-combinat, symmetric functions, compositions**\n\nBranch/Commit: **[public/combinat/ncsf_qsym/involutions-15476](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/ncsf_qsym/involutions-15476) @ [a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a47617479be3c6d4997d7e22bfe32f53762af)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Darij Grinberg**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15476_\n\n",
    "closed_at": "2014-02-02T22:07:07Z",
    "created_at": "2013-12-01T06:55:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Involutions on NSym and QSym part I",
    "type": "issue",
    "updated_at": "2014-02-02T22:07:07Z",
    "url": "https://github.com/sagemath/sage/issues/15476",
    "user": "https://github.com/darijgr"
}
```
This got much longer than I expected it to be because there are three "classical" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.

The patch also speeds up NSym's Verschiebung on certain bases, fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?

CC:  @tscrim sage-combinat @zabrocki @vbraun

Keywords: **ncsf, nsym, qsym, sage-combinat, symmetric functions, compositions**

Branch/Commit: **[public/combinat/ncsf_qsym/involutions-15476](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/ncsf_qsym/involutions-15476) @ [a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a47617479be3c6d4997d7e22bfe32f53762af)**

Reviewer: **Travis Scrimshaw**

Author: **Darij Grinberg**

_Issue created by migration from https://trac.sagemath.org/ticket/15476_





---

archive/issue_events_195796.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-12-01T06:55:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195796"
}
```



---

archive/issue_events_195797.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-12-01T06:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195797"
}
```



---

archive/issue_events_195798.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-12-01T06:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195798"
}
```



---

archive/issue_events_195799.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-12-01T06:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195799"
}
```



---

archive/issue_comments_195358.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This got much longer than I expected it to be because there are three \"classical\" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.\n \n-The patch also fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?\n+The patch also speeds up NSym's Verschiebung on certain bases, fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?\n``````\n",
    "created_at": "2013-12-01T06:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195358",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This got much longer than I expected it to be because there are three "classical" involution on each of NSym and QSym and each can be computed on various bases. I ended up implementing only two of the involutions (star=rho and psi), leaving out omega (which is just a rescaled antipode) for part II.
 
-The patch also fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?
+The patch also speeds up NSym's Verschiebung on certain bases, fixes some doc, moves a reference, and changes various invocations of `Composition(spam)` to `Compositions()(spam)` for speed reasons (when `spam` really is just a list). Could a `_Compositions` (akin to `_Partitions`) be of use?
``````




---

archive/issue_comments_195359.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nAttachment: **[trac_15476-NSym-QSym-invols-1-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15476/trac_15476-NSym-QSym-invols-1-dg.patch.gz)**",
    "created_at": "2013-12-01T06:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195359",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:1'>Comment 1:</a>
Attachment: **[trac_15476-NSym-QSym-invols-1-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15476/trac_15476-NSym-QSym-invols-1-dg.patch.gz)**



---

archive/issue_events_195800.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-12-01T06:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195800"
}
```



---

archive/issue_comments_195360.json:
```json
{
    "body": "Commit: **[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f667abd6b61ad9f38b3e1d791e840eaba3)**",
    "created_at": "2013-12-16T17:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195360",
    "user": "https://github.com/tscrim"
}
```

Commit: **[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f667abd6b61ad9f38b3e1d791e840eaba3)**



---

archive/issue_comments_195361.json:
```json
{
    "body": "Branch: **[public/combinat/ncsf_qsym/involutions-15476](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/ncsf_qsym/involutions-15476)**",
    "created_at": "2013-12-16T17:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195361",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/combinat/ncsf_qsym/involutions-15476](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/ncsf_qsym/involutions-15476)**



---

archive/issue_comments_195362.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nHey Darij,\n\nHere's the patch converted to a branch, along with some additional changes of mine which should net some (perhaps small) speedups (I didn't run any benchmarks, but attribute lookup is suppose to be faster than function calls). Specifically I changed `Compositions()(spam)` to `self._basis_keys(spam)` where appropriate. If you're happy with my changes, then you can set this to positive review.\n\nBest,\n\nTravis\n\n---\nNew commits:\n<table><tr><td>[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f)</td><td><code>Initial review changes.</code></td></tr><tr><td>[45a791f](https://github.com/sagemath/sagetrac-mirror/commit/45a791f)</td><td><code>trac #15476: involutions on NSym and QSym part I</code></td></tr></table>\n",
    "created_at": "2013-12-16T17:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195362",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>Comment 3:</a>
Hey Darij,

Here's the patch converted to a branch, along with some additional changes of mine which should net some (perhaps small) speedups (I didn't run any benchmarks, but attribute lookup is suppose to be faster than function calls). Specifically I changed `Compositions()(spam)` to `self._basis_keys(spam)` where appropriate. If you're happy with my changes, then you can set this to positive review.

Best,

Travis

---
New commits:
<table><tr><td>[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f)</td><td><code>Initial review changes.</code></td></tr><tr><td>[45a791f](https://github.com/sagemath/sagetrac-mirror/commit/45a791f)</td><td><code>trac #15476: involutions on NSym and QSym part I</code></td></tr></table>




---

archive/issue_comments_195363.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nHi Travis,\n\nthanks a lot! I don't have git-sage running on this machine and I haven't had time to check all of your changes so far, but I can confirm that `_basis_keys` is the right way to go here. BUT please don't use `Composition([])`:\n\n```\nsage: %timeit S._basis_keys([])\n100000 loops, best of 3: 6.38 us per loop\nsage: %timeit Compositions()([])\n100000 loops, best of 3: 9 us per loop\nsage: %timeit Composition([])\n100000 loops, best of 3: 11 us per loop\n```\nGenerally, `Composition(something)` does some slow and dirty ducktyping and should be avoided whenever possible in code.",
    "created_at": "2013-12-16T17:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195363",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'>Comment 4:</a>
Hi Travis,

thanks a lot! I don't have git-sage running on this machine and I haven't had time to check all of your changes so far, but I can confirm that `_basis_keys` is the right way to go here. BUT please don't use `Composition([])`:

```
sage: %timeit S._basis_keys([])
100000 loops, best of 3: 6.38 us per loop
sage: %timeit Compositions()([])
100000 loops, best of 3: 9 us per loop
sage: %timeit Composition([])
100000 loops, best of 3: 11 us per loop
```
Generally, `Composition(something)` does some slow and dirty ducktyping and should be avoided whenever possible in code.



---

archive/issue_comments_195364.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIt's only used once and then the result is cached, and it's more readable. I don't have a strong opinion and will be happy to change it back.",
    "created_at": "2013-12-16T18:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195364",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'>Comment 5:</a>
It's only used once and then the result is cached, and it's more readable. I don't have a strong opinion and will be happy to change it back.



---

archive/issue_comments_195365.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td>[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b)</td><td><code>really minor changes</code></td></tr><tr><td>[0606af3](https://github.com/sagemath/sagetrac-mirror/commit/0606af3)</td><td><code>Merge branch 'public/combinat/ncsf_qsym/involutions-15476' of trac.sagemath.org:sage into NSym1</code></td></tr></table>\n",
    "created_at": "2013-12-17T02:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195365",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td>[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b)</td><td><code>really minor changes</code></td></tr><tr><td>[0606af3](https://github.com/sagemath/sagetrac-mirror/commit/0606af3)</td><td><code>Merge branch 'public/combinat/ncsf_qsym/involutions-15476' of trac.sagemath.org:sage into NSym1</code></td></tr></table>




---

archive/issue_comments_195366.json:
```json
{
    "body": "Changed commit from **[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f667abd6b61ad9f38b3e1d791e840eaba3)** to **[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b38a598201259da2223152c523c1a1f45d)**",
    "created_at": "2013-12-17T02:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1d9bb8f](https://github.com/sagemath/sagetrac-mirror/commit/1d9bb8f667abd6b61ad9f38b3e1d791e840eaba3)** to **[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b38a598201259da2223152c523c1a1f45d)**



---

archive/issue_comments_195367.json:
```json
{
    "body": "Changed commit from **[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b38a598201259da2223152c523c1a1f45d)** to **[a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a47617479be3c6d4997d7e22bfe32f53762af)**",
    "created_at": "2013-12-17T02:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195367",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0cda84b](https://github.com/sagemath/sagetrac-mirror/commit/0cda84b38a598201259da2223152c523c1a1f45d)** to **[a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a47617479be3c6d4997d7e22bfe32f53762af)**



---

archive/issue_comments_195368.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td>[a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a476)</td><td><code>ooops</code></td></tr></table>\n",
    "created_at": "2013-12-17T02:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195368",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td>[a88a476](https://github.com/sagemath/sagetrac-mirror/commit/a88a476)</td><td><code>ooops</code></td></tr></table>




---

archive/issue_comments_195369.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIf you are fine with my added changes, feel free to set this to positive.\n\nThanks again for reviewing this undeservedly long patch...",
    "created_at": "2013-12-17T02:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195369",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'>Comment 8:</a>
If you are fine with my added changes, feel free to set this to positive.

Thanks again for reviewing this undeservedly long patch...



---

archive/issue_comments_195370.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2013-12-17T06:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195370",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_195371.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nLooks good to me.",
    "created_at": "2013-12-17T06:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15476#issuecomment-195371",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'>Comment 9:</a>
Looks good to me.



---

archive/issue_events_195801.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-17T06:09:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195801"
}
```



---

archive/issue_events_195802.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-17T06:09:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195802"
}
```



---

archive/issue_events_195803.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195803"
}
```



---

archive/issue_events_195804.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195804"
}
```



---

archive/issue_events_195805.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-02T22:07:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195805"
}
```



---

archive/issue_events_195806.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1d10db3ed65228bd682c03e0536ee76dfbb7aa7e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-02-02T22:07:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15476#event-195806"
}
```
