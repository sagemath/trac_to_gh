# Issue 15898: UniqueFactory for DirichletGroup

archive/issues_015661.json:
```json
{
    "body": "Dirichlet groups use a generic dictionary to cache objects (instead of UniqueRepresentation or UniqueFactory). This ticket replaces this generic cache with a UniqueFactory implementation.\n\n**Branch/Commit:** [ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)\n\n**Reviewer:** Peter Bruin\n\n**Author:** Julian Rueth\n\nIssue created by migration from https://trac.sagemath.org/ticket/15898\n\n",
    "closed_at": "2014-04-22T17:55:07Z",
    "created_at": "2014-03-06T14:34:07Z",
    "labels": [
        "component: modular forms",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "UniqueFactory for DirichletGroup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15898",
    "user": "https://github.com/saraedum"
}
```
Dirichlet groups use a generic dictionary to cache objects (instead of UniqueRepresentation or UniqueFactory). This ticket replaces this generic cache with a UniqueFactory implementation.

**Branch/Commit:** [ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)

**Reviewer:** Peter Bruin

**Author:** Julian Rueth

Issue created by migration from https://trac.sagemath.org/ticket/15898





---

archive/issue_comments_203788.json:
```json
{
    "body": "**Branch:** [u/saraedum/ticket/15898](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/15898)",
    "created_at": "2014-03-06T15:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203788",
    "user": "https://github.com/saraedum"
}
```

**Branch:** [u/saraedum/ticket/15898](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/15898)



---

archive/issue_events_141391.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-03-06T15:46:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15898#event-141391"
}
```



---

archive/issue_comments_203789.json:
```json
{
    "body": "**Author:** Julian Rueth",
    "created_at": "2014-03-06T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203789",
    "user": "https://github.com/saraedum"
}
```

**Author:** Julian Rueth



---

archive/issue_comments_203790.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f\">55bf7be</a></td><td><code>Use a UniqueFactory to cache instances of DirichletGroup</code></td></tr></table>\n",
    "created_at": "2014-03-06T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203790",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f">55bf7be</a></td><td><code>Use a UniqueFactory to cache instances of DirichletGroup</code></td></tr></table>




---

archive/issue_comments_203791.json:
```json
{
    "body": "**Commit:** [55bf7be591e181fc7016a0422307881a8360c57f](https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f)",
    "created_at": "2014-03-06T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203791",
    "user": "https://github.com/saraedum"
}
```

**Commit:** [55bf7be591e181fc7016a0422307881a8360c57f](https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f)



---

archive/issue_comments_203792.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks good (although I haven't tested it yet).  Two questions:\n- why include `base_ring` in `key`?  It can be recovered as the parent of `zeta`, and isn't used in `create_object()`.\n- could you add a doctest to show that it works as intended, i.e. really creates a unique instance?",
    "created_at": "2014-04-08T10:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203792",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>
Looks good (although I haven't tested it yet).  Two questions:
- why include `base_ring` in `key`?  It can be recovered as the parent of `zeta`, and isn't used in `create_object()`.
- could you add a doctest to show that it works as intended, i.e. really creates a unique instance?



---

archive/issue_comments_203793.json:
```json
{
    "body": "**Changing commit** from \"[55bf7be591e181fc7016a0422307881a8360c57f](https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f)\" to \"[3d01887fd988b6124cc3283c40f6929138e51659](https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659)\".",
    "created_at": "2014-04-09T17:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[55bf7be591e181fc7016a0422307881a8360c57f](https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f)" to "[3d01887fd988b6124cc3283c40f6929138e51659](https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659)".



---

archive/issue_comments_203794.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebe6a39deb3382f9f4b1391e542018b6471c8de0\">ebe6a39</a></td><td><code>Doctest to illustrate that caching of DirichletGroups works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7\">0521e97</a></td><td><code>Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659\">3d01887</a></td><td><code>cleaned up docstring of DirichletGroup</code></td></tr></table>\n",
    "created_at": "2014-04-09T17:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebe6a39deb3382f9f4b1391e542018b6471c8de0">ebe6a39</a></td><td><code>Doctest to illustrate that caching of DirichletGroups works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7">0521e97</a></td><td><code>Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659">3d01887</a></td><td><code>cleaned up docstring of DirichletGroup</code></td></tr></table>




---

archive/issue_comments_203795.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [git](#comment%3A4):\n|                                                                                                                                          |                                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[0521e97](https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7)|`Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory`|\n\nNice, I hadn't thought of the fact that two roots of unity can still compare as equal when they are in different fields!  Now testing.",
    "created_at": "2014-04-09T17:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203795",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'></a>
Replying to [git](#comment%3A4):
|                                                                                                                                          |                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[0521e97](https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7)|`Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory`|

Nice, I hadn't thought of the fact that two roots of unity can still compare as equal when they are in different fields!  Now testing.



---

archive/issue_comments_203796.json:
```json
{
    "body": "**Reviewer:** Peter Bruin",
    "created_at": "2014-04-09T18:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203796",
    "user": "https://github.com/pjbruin"
}
```

**Reviewer:** Peter Bruin



---

archive/issue_events_141392.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-04-09T18:13:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15898#event-141392"
}
```



---

archive/issue_events_141393.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-04-09T18:13:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15898#event-141393"
}
```



---

archive/issue_comments_203797.json:
```json
{
    "body": "<a id='comment:8'></a>\nConflicts with #15990, please fix",
    "created_at": "2014-04-10T21:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203797",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Conflicts with #15990, please fix



---

archive/issue_comments_203798.json:
```json
{
    "body": "**Changing branch** from \"[u/saraedum/ticket/15898](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/15898)\" to \"[u/pbruin/15898-DirichletGroup_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15898-DirichletGroup_unique)\".",
    "created_at": "2014-04-21T08:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203798",
    "user": "https://github.com/pjbruin"
}
```

**Changing branch** from "[u/saraedum/ticket/15898](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/15898)" to "[u/pbruin/15898-DirichletGroup_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15898-DirichletGroup_unique)".



---

archive/issue_comments_203799.json:
```json
{
    "body": "<a id='comment:9'></a>\nMerged with 6.2.beta8.",
    "created_at": "2014-04-21T08:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203799",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
Merged with 6.2.beta8.



---

archive/issue_comments_203800.json:
```json
{
    "body": "**Changing commit** from \"[3d01887fd988b6124cc3283c40f6929138e51659](https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659)\" to \"[ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)\".",
    "created_at": "2014-04-21T08:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203800",
    "user": "https://github.com/pjbruin"
}
```

**Changing commit** from "[3d01887fd988b6124cc3283c40f6929138e51659](https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659)" to "[ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)".



---

archive/issue_comments_203801.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/15898-DirichletGroup_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15898-DirichletGroup_unique)\" to \"[ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)\".",
    "created_at": "2014-04-22T17:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15898#issuecomment-203801",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/15898-DirichletGroup_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15898-DirichletGroup_unique)" to "[ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7](https://github.com/sagemath/sagetrac-mirror/commit/ce3dfc0fdc8d8a39ea0a7066c64e17e0e0b76ee7)".



---

archive/issue_events_141394.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-22T17:55:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15898#event-141394"
}
```



---

archive/issue_events_141395.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-22T17:55:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15898",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15898#event-141395"
}
```
