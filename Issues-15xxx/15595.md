# Issue 15595: Shuffle Product

archive/issues_015358.json:
```json
{
    "body": "Shuffle product can be define on any iterable object so I propose to define a new class that implement an efficient shuffle product on iterables.\n\nCurrently one has two shuffle product in Sage, one is defined on words and one is defined on permutations.\n\nThe first one is slow and don't allow to compute shuffle of two list and the second is fast but only defined for Permutations.\n\nSome benchmarks:\n\nMy Shuffle:\n\nTime if `ShuffleProduct` inherits just of `SageObject`\n\n```\nsage: from sage.combinat.shuffle import ShuffleProduct\nsage: a = Word(\"abcdefghij\")\nsage: b = Word(\"klmnopqrst\")\nsage: %time _ = list(ShuffleProduct(a, b, Word))\nCPU times: user 17 s, sys: 994 ms, total: 18 s\nWall time: 18.4 s\n```\n\nTime if `ShuffleProduct` inherits of the evil class `Parent`:\n\n```\nsage: from sage.combinat.shuffle import ShuffleProduct\nsage: a = Word(\"abcdefghij\")\nsage: b = Word(\"klmnopqrst\")\nsage: %time _ = list(ShuffleProduct(a, b, Word))\nCPU times: user 32.5 s, sys: 1.7 s, total: 34.2 s\nWall time: 34.5 s\n```\nwith\n\n```\nParent.__init__(self, category=FiniteEnumeratedSets())\n```\n\nComparaison with `ShuffleProduct_w1w2`:\n\n```\nsage: from sage.combinat.words.shuffle_product import ShuffleProduct_w1w2 as Shuffle\nsage: %time _ = list(Shuffle(a, b))\nCPU times: user 59.66 s, sys: 0.29 s, total: 59.94 s\nWall time: 59.90 s\n```\n\nCC:  @nthiery @mathzeta\n\nKeywords: days57\n\nBranch/Commit: 18e97c10949f979d39e5014fd1d927cf864e27ed\n\nReviewer: Matthieu Dien, Tomer Bauer\n\nAuthor: Jean-Baptiste Priez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15595\n\n",
    "closed_at": "2014-06-04T22:02:17Z",
    "created_at": "2013-12-27T11:55:16Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Shuffle Product",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15595",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```
Shuffle product can be define on any iterable object so I propose to define a new class that implement an efficient shuffle product on iterables.

Currently one has two shuffle product in Sage, one is defined on words and one is defined on permutations.

The first one is slow and don't allow to compute shuffle of two list and the second is fast but only defined for Permutations.

Some benchmarks:

My Shuffle:

Time if `ShuffleProduct` inherits just of `SageObject`

```
sage: from sage.combinat.shuffle import ShuffleProduct
sage: a = Word("abcdefghij")
sage: b = Word("klmnopqrst")
sage: %time _ = list(ShuffleProduct(a, b, Word))
CPU times: user 17 s, sys: 994 ms, total: 18 s
Wall time: 18.4 s
```

Time if `ShuffleProduct` inherits of the evil class `Parent`:

```
sage: from sage.combinat.shuffle import ShuffleProduct
sage: a = Word("abcdefghij")
sage: b = Word("klmnopqrst")
sage: %time _ = list(ShuffleProduct(a, b, Word))
CPU times: user 32.5 s, sys: 1.7 s, total: 34.2 s
Wall time: 34.5 s
```
with

```
Parent.__init__(self, category=FiniteEnumeratedSets())
```

Comparaison with `ShuffleProduct_w1w2`:

```
sage: from sage.combinat.words.shuffle_product import ShuffleProduct_w1w2 as Shuffle
sage: %time _ = list(Shuffle(a, b))
CPU times: user 59.66 s, sys: 0.29 s, total: 59.94 s
Wall time: 59.90 s
```

CC:  @nthiery @mathzeta

Keywords: days57

Branch/Commit: 18e97c10949f979d39e5014fd1d927cf864e27ed

Reviewer: Matthieu Dien, Tomer Bauer

Author: Jean-Baptiste Priez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15595





---

archive/issue_comments_197739.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T12:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197740.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T12:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197741.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_045627.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15595#event-45627"
}
```



---

archive/issue_comments_197742.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-27T21:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197743.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-27T21:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197743",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_197744.json:
```json
{
    "body": "Changing keywords from \"\" to \"days57\".",
    "created_at": "2014-04-08T09:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197744",
    "user": "https://github.com/MatthieuDien"
}
```

Changing keywords from "" to "days57".



---

archive/issue_comments_197745.json:
```json
{
    "body": "<a id='comment:13'></a>New commits:",
    "created_at": "2014-04-09T00:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197745",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:13'></a>New commits:



---

archive/issue_comments_197746.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-10T16:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197747.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-10T16:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197748.json:
```json
{
    "body": "<a id='comment:18'></a>I have added a \"See also\" comment to `sage.combinat.words.shuffle_product.py` that suggests to use the new implementation. We should open a ticket to replace and deprecated `ShuffleProduct_w1w2`.",
    "created_at": "2014-04-10T18:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197748",
    "user": "https://github.com/mathzeta"
}
```

<a id='comment:18'></a>I have added a "See also" comment to `sage.combinat.words.shuffle_product.py` that suggests to use the new implementation. We should open a ticket to replace and deprecated `ShuffleProduct_w1w2`.



---

archive/issue_events_045628.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15595#event-45628"
}
```



---

archive/issue_events_045629.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15595#event-45629"
}
```



---

archive/issue_comments_197749.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-13T06:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197749",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_197750.json:
```json
{
    "body": "<a id='comment:20'></a>patchbot:\n\n```\n+++ b/src/sage/combinat/shuffle.py\n\n@@ -0,0 +1,438 @@\n\n+    a_0 \\cdot \\left((a_n)_{n \\geqslant 1} \\Cup (b_m)_{m\u00c2 \\geqslant 0}\\right)\n+    + b_0 \\cdot \\left((a_n)_{n \\geqslant 0} \\Cup (b_m)_{m\u00c2 \\geqslant 1}\\right)\n--- a/src/sage/combinat/words/shuffle_product.py\n\n+++ b/src/sage/combinat/words/shuffle_product.py\n\n@@ -1,5 +1,9 @@\n\nNon-ascii characters inserted on 2 non-empty lines\nplugins.non_ascii -- 0 seconds\n========== end plugins.non_ascii ==========\n```",
    "created_at": "2014-05-13T06:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197750",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>patchbot:

```
+++ b/src/sage/combinat/shuffle.py

@@ -0,0 +1,438 @@

+    a_0 \cdot \left((a_n)_{n \geqslant 1} \Cup (b_m)_{mÂ \geqslant 0}\right)
+    + b_0 \cdot \left((a_n)_{n \geqslant 0} \Cup (b_m)_{mÂ \geqslant 1}\right)
--- a/src/sage/combinat/words/shuffle_product.py

+++ b/src/sage/combinat/words/shuffle_product.py

@@ -1,5 +1,9 @@

Non-ascii characters inserted on 2 non-empty lines
plugins.non_ascii -- 0 seconds
========== end plugins.non_ascii ==========
```



---

archive/issue_comments_197751.json:
```json
{
    "body": "<a id='comment:22'></a>I removed the non-ascii characters and pushed it\n\n---\nNew commits:",
    "created_at": "2014-06-03T10:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197751",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:22'></a>I removed the non-ascii characters and pushed it

---
New commits:



---

archive/issue_comments_197752.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-03T10:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197752",
    "user": "https://github.com/MatthieuDien"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197753.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-04T08:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197754.json:
```json
{
    "body": "<a id='comment:25'></a>Now the tests in the file pass. Positive review!\n\nThe work never ends. From comment [comment:18]:\n> We should open a ticket to replace and deprecated `ShuffleProduct_w1w2`.\n\nand have shuffle of variable number of iterables, and check if the Parent/Element system can be used efficiently and many other things...",
    "created_at": "2014-06-04T18:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197754",
    "user": "https://github.com/mathzeta"
}
```

<a id='comment:25'></a>Now the tests in the file pass. Positive review!

The work never ends. From comment [comment:18]:
> We should open a ticket to replace and deprecated `ShuffleProduct_w1w2`.

and have shuffle of variable number of iterables, and check if the Parent/Element system can be used efficiently and many other things...



---

archive/issue_comments_197755.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-04T18:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197755",
    "user": "https://github.com/mathzeta"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197756.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-04T22:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15595#issuecomment-197756",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_045630.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-04T22:02:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15595",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15595#event-45630"
}
```
