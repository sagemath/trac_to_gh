# Issue 15729: Graphics3d with fractional opacity will not save image

archive/issues_015492.json:
```json
{
    "body": "Giving opacity as a fraction breaks the save method.  No error is raised and no image is created.\n\n```\nplot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2),opacity=8/10).save('~/tmp.png')\n```\n\nThis appears to be a problem with tachyon not handling fractions.  Here is another example with an error message (shown with the keyword `verbosity=2`):\n\n```\nsage: S = sphere(opacity=8/10, aspect_ratio=[1,1,1], verbosity='2')\nsage: S.save('~/tmp.png')\n```\n\n\n```\ntachyon /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat  -format PNG  -o ~/tmp.png  -res 500 500  +V ; rm -f \"/Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat\"\nTachyon Parallel/Multiprocessor Ray Tracer   Version 0.98.9   \nCopyright 1994-2010,    John E. Stone <john.stone@gmail.com> \n------------------------------------------------------------ \nParse Error:\n   Encountered a syntax error in file /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat\n   Expected to find TEXFUNC\n   Actually found: Color\n   Error occured at or prior to file offset 656, line 29\n   Error position is only approximate, but should be close\n\nParse Error:\n   Encountered a syntax error in file /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat\n   Expected to find an object or other declaration\n   Actually found: .4\n   Error occured at or prior to file offset 660, line 29\n   Error position is only approximate, but should be close\n\nParser failed due to an input file syntax error.\nAborting render.\n```\n\nChanging opacity to .8 in this example works as expected.\n\nCC:  @slel\n\nKeywords: IMA-PolyGeom, opacity\n\nBranch/Commit: ddf16d5d9609dfe5447239a11ae65c2de3faebec\n\nReviewer: Jean-Philippe Labb\u00e9\n\nAuthor: Yuan Zhou\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15729\n\n",
    "closed_at": "2018-05-08T17:27:41Z",
    "created_at": "2014-01-24T22:05:00Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Graphics3d with fractional opacity will not save image",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15729",
    "user": "https://github.com/nilesjohnson"
}
```
Giving opacity as a fraction breaks the save method.  No error is raised and no image is created.

```
plot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2),opacity=8/10).save('~/tmp.png')
```

This appears to be a problem with tachyon not handling fractions.  Here is another example with an error message (shown with the keyword `verbosity=2`):

```
sage: S = sphere(opacity=8/10, aspect_ratio=[1,1,1], verbosity='2')
sage: S.save('~/tmp.png')
```


```
tachyon /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat  -format PNG  -o ~/tmp.png  -res 500 500  +V ; rm -f "/Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat"
Tachyon Parallel/Multiprocessor Ray Tracer   Version 0.98.9   
Copyright 1994-2010,    John E. Stone <john.stone@gmail.com> 
------------------------------------------------------------ 
Parse Error:
   Encountered a syntax error in file /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat
   Expected to find TEXFUNC
   Actually found: Color
   Error occured at or prior to file offset 656, line 29
   Error position is only approximate, but should be close

Parse Error:
   Encountered a syntax error in file /Users/njohnson/.sage/temp/galileo/2623/tmp_zkpq5K.dat
   Expected to find an object or other declaration
   Actually found: .4
   Error occured at or prior to file offset 660, line 29
   Error position is only approximate, but should be close

Parser failed due to an input file syntax error.
Aborting render.
```

Changing opacity to .8 in this example works as expected.

CC:  @slel

Keywords: IMA-PolyGeom, opacity

Branch/Commit: ddf16d5d9609dfe5447239a11ae65c2de3faebec

Reviewer: Jean-Philippe Labb√©

Author: Yuan Zhou

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15729





---

archive/issue_events_046215.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46215"
}
```



---

archive/issue_events_046216.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46216"
}
```



---

archive/issue_events_046217.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46217"
}
```



---

archive/issue_events_046218.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46218"
}
```



---

archive/issue_events_046219.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46219"
}
```



---

archive/issue_events_046220.json:
```json
{
    "actor": "https://github.com/yuan-zhou",
    "created_at": "2018-04-04T16:55:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46220"
}
```



---

archive/issue_events_046221.json:
```json
{
    "actor": "https://github.com/yuan-zhou",
    "created_at": "2018-04-04T16:55:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46221"
}
```



---

archive/issue_comments_199906.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-04-04T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199906",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_199907.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-04T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199907",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199908.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good.\n\nCould you add a test to show that the mentioned bug is fixed?",
    "created_at": "2018-04-04T22:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199908",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'></a>Looks good.

Could you add a test to show that the mentioned bug is fixed?



---

archive/issue_comments_199909.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-04T22:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199909",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199910.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-04T23:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199911.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-04T23:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199911",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199912.json:
```json
{
    "body": "Changing keywords from \"\" to \"IMA-PolyGeom, opacity\".",
    "created_at": "2018-04-04T23:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199912",
    "user": "https://github.com/yuan-zhou"
}
```

Changing keywords from "" to "IMA-PolyGeom, opacity".



---

archive/issue_comments_199913.json:
```json
{
    "body": "<a id='comment:11'></a>There are 2 failed doctests:\n\n```\nFile \"src/sage/plot/plot3d/index_face_set.pyx\", line 964, in sage.plot.plot3d.index_face_set.IndexFaceSet.json_repr\nFailed example:\n    G.json_repr(G.default_render_params())\nExpected:\n    ['{\"vertices\":[{\"x\":0,\"y\":0,\"z\":1},{\"x\":1,\"y\":1,\"z\":1},{\"x\":2,\"y\":0,\"z\":1}], \"faces\":[[0,1,2]], \"color\":\"#0000ff\", \"opacity\":1}']\nGot:\n    ['{\"vertices\":[{\"x\":0,\"y\":0,\"z\":1},{\"x\":1,\"y\":1,\"z\":1},{\"x\":2,\"y\":0,\"z\":1}], \"faces\":[[0,1,2]], \"color\":\"#0000ff\", \"opacity\":1.0}']\n**********************************************************************\nFile \"src/sage/plot/plot3d/index_face_set.pyx\", line 976, in sage.plot.plot3d.index_face_set.IndexFaceSet.json_repr\nFailed example:\n    S.json_repr(S.default_render_params())\nExpected:\n    ['{\"vertices\":[{\"x\":2,\"y\":0,\"z\":0},..., \"face_colors\":[\"#ff0000\",\"#ff9900\",\"#cbff00\",\"#33ff00\"], \"opacity\":1}']\nGot:\n    ['{\"vertices\":[{\"x\":2,\"y\":0,\"z\":0},{\"x\":0,\"y\":2,\"z\":0},{\"x\":0,\"y\":0,\"z\":2},{\"x\":0,\"y\":1,\"z\":1},{\"x\":1,\"y\":0,\"z\":1},{\"x\":1,\"y\":1,\"z\":0}], \"faces\":[[0,4,5],[3,4,5],[2,3,4],[1,3,5]], \"face_colors\":[\"#ff0000\",\"#ff9900\",\"#cbff00\",\"#33ff00\"], \"opacity\":1.0}']\n```",
    "created_at": "2018-04-05T20:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199913",
    "user": "https://github.com/jplab"
}
```

<a id='comment:11'></a>There are 2 failed doctests:

```
File "src/sage/plot/plot3d/index_face_set.pyx", line 964, in sage.plot.plot3d.index_face_set.IndexFaceSet.json_repr
Failed example:
    G.json_repr(G.default_render_params())
Expected:
    ['{"vertices":[{"x":0,"y":0,"z":1},{"x":1,"y":1,"z":1},{"x":2,"y":0,"z":1}], "faces":[[0,1,2]], "color":"#0000ff", "opacity":1}']
Got:
    ['{"vertices":[{"x":0,"y":0,"z":1},{"x":1,"y":1,"z":1},{"x":2,"y":0,"z":1}], "faces":[[0,1,2]], "color":"#0000ff", "opacity":1.0}']
**********************************************************************
File "src/sage/plot/plot3d/index_face_set.pyx", line 976, in sage.plot.plot3d.index_face_set.IndexFaceSet.json_repr
Failed example:
    S.json_repr(S.default_render_params())
Expected:
    ['{"vertices":[{"x":2,"y":0,"z":0},..., "face_colors":["#ff0000","#ff9900","#cbff00","#33ff00"], "opacity":1}']
Got:
    ['{"vertices":[{"x":2,"y":0,"z":0},{"x":0,"y":2,"z":0},{"x":0,"y":0,"z":2},{"x":0,"y":1,"z":1},{"x":1,"y":0,"z":1},{"x":1,"y":1,"z":0}], "faces":[[0,4,5],[3,4,5],[2,3,4],[1,3,5]], "face_colors":["#ff0000","#ff9900","#cbff00","#33ff00"], "opacity":1.0}']
```



---

archive/issue_comments_199914.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-05T20:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199914",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199915.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T20:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199916.json:
```json
{
    "body": "<a id='comment:14'></a>Don't forget to set back to needs_review once reviewer comments are dealt with.",
    "created_at": "2018-04-06T06:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199916",
    "user": "https://github.com/slel"
}
```

<a id='comment:14'></a>Don't forget to set back to needs_review once reviewer comments are dealt with.



---

archive/issue_comments_199917.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-06T14:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199917",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199918.json:
```json
{
    "body": "<a id='comment:16'></a>Looks good to me. Once the bot give a green light, I would put positive review.",
    "created_at": "2018-04-06T16:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199918",
    "user": "https://github.com/jplab"
}
```

<a id='comment:16'></a>Looks good to me. Once the bot give a green light, I would put positive review.



---

archive/issue_comments_199919.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-06T18:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199919",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199920.json:
```json
{
    "body": "<a id='comment:17'></a>See patchbot report:\n\n```\nFile \"src/sage/plot/plot3d/base.pyx\", line 329, in sage.plot.plot3d.base.Graphics3d._rich_repr_canvas3d\nFailed example:\n    out.canvas3d.get()\nExpected:\n    '[{\"vertices\":[{\"x\":0,\"y\":0,\"z\":-1},..., \"color\":\"#6666ff\", \"opacity\":1}]'\nGot:\n    '[{\"vertices\":[{\"x\":0,\"y\":0,\"z\":-1},..., \"color\":\"#6666ff\", \"opacity\":1.0}]'\n```",
    "created_at": "2018-04-06T18:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199920",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>See patchbot report:

```
File "src/sage/plot/plot3d/base.pyx", line 329, in sage.plot.plot3d.base.Graphics3d._rich_repr_canvas3d
Failed example:
    out.canvas3d.get()
Expected:
    '[{"vertices":[{"x":0,"y":0,"z":-1},..., "color":"#6666ff", "opacity":1}]'
Got:
    '[{"vertices":[{"x":0,"y":0,"z":-1},..., "color":"#6666ff", "opacity":1.0}]'
```



---

archive/issue_comments_199921.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-06T18:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199922.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-06T18:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199922",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199923.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-06T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199923",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199924.json:
```json
{
    "body": "<a id='comment:20'></a>It looks good to me.",
    "created_at": "2018-04-06T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199924",
    "user": "https://github.com/jplab"
}
```

<a id='comment:20'></a>It looks good to me.



---

archive/issue_events_046222.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15729#event-46222"
}
```



---

archive/issue_comments_199925.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15729#issuecomment-199925",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
