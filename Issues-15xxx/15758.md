# Issue 15758: Reimplement short vector enumeration

archive/issues_015521.json:
```json
{
    "body": "QuadraticForm(...).short_vector_list_up_to_length(...) currently uses PARI, which provides an incorrect implementation (see #13531). Here is a correct one, which is also faster. For comparison, here are the timings before and after\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 1.1 s per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 7.42 s per loop\n```\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 360 ms per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 11.5 s per loop\n```\n\nAs a big bonus (at least to me), we have a version that doesn't come with conversion to vectors:\n\n```\nsage: from sage.quadratic_forms.enumerate_short_vectors.enumerate_short_vectors_python import short_vectors\nsage: %timeit short_vectors(qf.matrix(), 0, 1000)\n10 loops, best of 3: 65.7 ms per loop\n```\n\nThis depends on boost::python, which hopefully will be integrated soon. Until then, note that you have to have boost_python library installed (we have the headers already).\n\nCC:  akoutsianas\n\nAuthor: Martin Raum\n\nBranch: u/mraum/ticket/15758\n\nStatus: new\n\nCommit: 5ba169fbf00d249938a083e30671c38b758b89d7\n\nIssue created by migration from https://trac.sagemath.org/ticket/15758\n\n",
    "created_at": "2014-01-29T08:19:47Z",
    "labels": [
        "component: quadratic forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Reimplement short vector enumeration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15758",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```
QuadraticForm(...).short_vector_list_up_to_length(...) currently uses PARI, which provides an incorrect implementation (see #13531). Here is a correct one, which is also faster. For comparison, here are the timings before and after

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 1.1 s per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 7.42 s per loop
```

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 360 ms per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 11.5 s per loop
```

As a big bonus (at least to me), we have a version that doesn't come with conversion to vectors:

```
sage: from sage.quadratic_forms.enumerate_short_vectors.enumerate_short_vectors_python import short_vectors
sage: %timeit short_vectors(qf.matrix(), 0, 1000)
10 loops, best of 3: 65.7 ms per loop
```

This depends on boost::python, which hopefully will be integrated soon. Until then, note that you have to have boost_python library installed (we have the headers already).

CC:  akoutsianas

Author: Martin Raum

Branch: u/mraum/ticket/15758

Status: new

Commit: 5ba169fbf00d249938a083e30671c38b758b89d7

Issue created by migration from https://trac.sagemath.org/ticket/15758





---

archive/issue_comments_253861.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mraum/ticket/15758\"",
    "created_at": "2014-01-29T08:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253861",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing branch from "" to "u/mraum/ticket/15758"



---

archive/issue_comments_253862.json:
```json
{
    "body": "<a id='comment:2'></a>I know it's not needs_review, but you cannot yet rely on C++11. With GCC 4.6.3:\n\n```\ncc1plus: error: unrecognized command line option \u2018-std=c++11\u2019\n```\n\n---\nLast 10 new commits:",
    "created_at": "2014-01-29T14:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253862",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I know it's not needs_review, but you cannot yet rely on C++11. With GCC 4.6.3:

```
cc1plus: error: unrecognized command line option ‘-std=c++11’
```

---
Last 10 new commits:



---

archive/issue_comments_253863.json:
```json
{
    "body": "Changing commit from \"\" to \"5ba169fbf00d249938a083e30671c38b758b89d7\"",
    "created_at": "2014-01-29T14:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253863",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "5ba169fbf00d249938a083e30671c38b758b89d7"



---

archive/issue_comments_253864.json:
```json
{
    "body": "<a id='comment:3'></a>On my system, the following changes were needed to make this compile:\n\n```diff\ndiff --git a/src/module_list.py b/src/module_list.py\nindex e3a6ea9..c567ee6 100755\n--- a/src/module_list.py\n+++ b/src/module_list.py\n@@ -1475,9 +1475,9 @@ ext_modules = [\n               depends = ['sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors_boost_python.hpp',\n                          'sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors.hpp'],\n               language = 'c++',\n-              extra_compile_args=['-std=c++11'],\n+              extra_compile_args=[\"-std=c++0x\"],\n               include_dirs = [SAGE_INC, SAGE_INC + '/python2.7', 'sage/c_libs/include'],\n-              libraries = ['stdc++', 'boost_python', 'mpfi', 'mpfr', 'gmp']),\n+              libraries = ['stdc++', 'boost_python-2.7', 'mpfi', 'mpfr', 'gmp']),\n \n     Extension('sage.quadratic_forms.quadratic_form__evaluate',\n               sources = ['sage/quadratic_forms/quadratic_form__evaluate.pyx']),\n```\nI don't know if everybody will be happy that the compiler now needs to support `-std=c++0x` (personally, I don't mind, especially given that Sage's GCC does support it).",
    "created_at": "2014-01-29T14:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253864",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>On my system, the following changes were needed to make this compile:

```diff
diff --git a/src/module_list.py b/src/module_list.py
index e3a6ea9..c567ee6 100755
--- a/src/module_list.py
+++ b/src/module_list.py
@@ -1475,9 +1475,9 @@ ext_modules = [
               depends = ['sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors_boost_python.hpp',
                          'sage/quadratic_forms/enumerate_short_vectors/enumerate_short_vectors.hpp'],
               language = 'c++',
-              extra_compile_args=['-std=c++11'],
+              extra_compile_args=["-std=c++0x"],
               include_dirs = [SAGE_INC, SAGE_INC + '/python2.7', 'sage/c_libs/include'],
-              libraries = ['stdc++', 'boost_python', 'mpfi', 'mpfr', 'gmp']),
+              libraries = ['stdc++', 'boost_python-2.7', 'mpfi', 'mpfr', 'gmp']),
 
     Extension('sage.quadratic_forms.quadratic_form__evaluate',
               sources = ['sage/quadratic_forms/quadratic_form__evaluate.pyx']),
```
I don't know if everybody will be happy that the compiler now needs to support `-std=c++0x` (personally, I don't mind, especially given that Sage's GCC does support it).



---

archive/issue_events_046325.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15758#event-46325"
}
```



---

archive/issue_comments_253865.json:
```json
{
    "body": "<a id='comment:5'></a>According to [the changelog of fpLLL](http://perso.ens-lyon.fr/damien.stehle/fplll/ChangeLog.txt), a \"short lattice vector enumeration algorithm\" appeared in version 3.0 of fpLLL, which is a standard spkg of Sage. Why not interfacing with this implementation ?",
    "created_at": "2014-02-01T23:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253865",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:5'></a>According to [the changelog of fpLLL](http://perso.ens-lyon.fr/damien.stehle/fplll/ChangeLog.txt), a "short lattice vector enumeration algorithm" appeared in version 3.0 of fpLLL, which is a standard spkg of Sage. Why not interfacing with this implementation ?



---

archive/issue_comments_253866.json:
```json
{
    "body": "<a id='comment:6'></a>Honestly, before I implemented this (quite some time ago), I didn't find the short vector implementation in fpLLL's documentation. And I still don't.\n\nIt's a pity for my code, but I'm definitely in favor of wrapping the missing parts of fpLLL instead of my code. Clearly, fpLLL is a much more advanced implementation than I could implement.\n\nDoes anybody know how to invoke enumeration? It seems that topenum.h contains a class for this, but I can't figure out, what kind of date Enumerator.subTree contains.",
    "created_at": "2014-02-02T10:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253866",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:6'></a>Honestly, before I implemented this (quite some time ago), I didn't find the short vector implementation in fpLLL's documentation. And I still don't.

It's a pity for my code, but I'm definitely in favor of wrapping the missing parts of fpLLL instead of my code. Clearly, fpLLL is a much more advanced implementation than I could implement.

Does anybody know how to invoke enumeration? It seems that topenum.h contains a class for this, but I can't figure out, what kind of date Enumerator.subTree contains.



---

archive/issue_comments_253867.json:
```json
{
    "body": "<a id='comment:7'></a>See #15976 for an interface to fpLLL's shortest vector implementation.",
    "created_at": "2014-03-19T17:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253867",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'></a>See #15976 for an interface to fpLLL's shortest vector implementation.



---

archive/issue_events_046326.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15758#event-46326"
}
```



---

archive/issue_events_046327.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15758#event-46327"
}
```



---

archive/issue_events_046328.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15758#event-46328"
}
```



---

archive/issue_events_046329.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15758#event-46329"
}
```



---

archive/issue_comments_253868.json:
```json
{
    "body": "<a id='comment:10'></a>As far as I know, the fpLLL library only deals with sublattices of `ZZ^n`, while pari can deal with enumerating short vectors when the Gram matrix is real.  This is very important for my applications!  So I would very much like this ticket to be revived.\n\nMeanwhile, here is a bug report with the QuadraticForm class in this context, since it does not pass the optional flag=2 to pari's qfminim function when the Gram matrix is real:\n\n```\nsage: A = random_matrix(RR,5)\nsage: A = A*A.transpose()\nsage: Q = QuadraticForm(A)\nsage: Q.short_vector_list_up_to_length(2)\n...\nPariError: incorrect type in qfminim0\n```",
    "created_at": "2014-10-29T12:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15758#issuecomment-253868",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>As far as I know, the fpLLL library only deals with sublattices of `ZZ^n`, while pari can deal with enumerating short vectors when the Gram matrix is real.  This is very important for my applications!  So I would very much like this ticket to be revived.

Meanwhile, here is a bug report with the QuadraticForm class in this context, since it does not pass the optional flag=2 to pari's qfminim function when the Gram matrix is real:

```
sage: A = random_matrix(RR,5)
sage: A = A*A.transpose()
sage: Q = QuadraticForm(A)
sage: Q.short_vector_list_up_to_length(2)
...
PariError: incorrect type in qfminim0
```
