# Issue 15150: Implement NCSym

archive/issues_014913.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "Implement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:\n\n- monomial **m**\n- elementary **e**\n- homogeneous **h**\n- power-sum **p**\n- **x**\n- **q**\n\nas well as the dual basis **w**.\n\nApply: [attachment: trac_15150-ncsym-ts.patch\u200b](https://github.com/sagemath/sage/files/ticket15150/4c8b34f12e835d39d5e45bdc50893444.gz)\n\nDepends on #15143\nDepends on #15164\n\nCC:  @sagetrac-sage-combinat @zabrocki @saliola @darijgr\n\nReviewer: **Mike Zabrocki, Darij Grinberg**\n\nAuthor: **Travis Scrimshaw**\n\nMerged: **sage-5.13.rc0**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15150_\n\n",
    "closed_at": "2013-12-11T11:02:44Z",
    "created_at": "2013-09-03T19:19:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement NCSym",
    "type": "issue",
    "updated_at": "2013-12-11T11:02:44Z",
    "url": "https://github.com/sagemath/sage/issues/15150",
    "user": "https://github.com/tscrim"
}
```
Implement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:

- monomial **m**
- elementary **e**
- homogeneous **h**
- power-sum **p**
- **x**
- **q**

as well as the dual basis **w**.

Apply: [attachment: trac_15150-ncsym-ts.patchâ€‹](https://github.com/sagemath/sage/files/ticket15150/4c8b34f12e835d39d5e45bdc50893444.gz)

Depends on #15143
Depends on #15164

CC:  @sagetrac-sage-combinat @zabrocki @saliola @darijgr

Reviewer: **Mike Zabrocki, Darij Grinberg**

Author: **Travis Scrimshaw**

Merged: **sage-5.13.rc0**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/15150_





---

archive/issue_events_216174.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T19:19:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216174"
}
```



---

archive/issue_events_216175.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T19:19:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216175"
}
```



---

archive/issue_events_216176.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T19:19:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216176"
}
```



---

archive/issue_events_216177.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T19:19:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216177"
}
```



---

archive/issue_events_216178.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2013-09-03T19:19:41Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "subject": "https://github.com/tscrim",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216178"
}
```



---

archive/issue_comments_186327.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n[Answered my own question.]",
    "created_at": "2013-09-03T19:37:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186327",
    "user": "https://github.com/saliola"
}
```

<div id="comment:1" align="right">comment:1</div>

[Answered my own question.]



---

archive/issue_comments_186328.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere's what I currently have. The multiplication in the dual basis isn't working correctly yet. I know there's the `hopf_algebra_of_supercharacters-fs.patch` patch in the queue which seems like its targeted more for base rings of `ZZ[q]` (or like Hall-Littlewoods are to Sym), and I was hoping to link them together at some point (please correct me if I'm wrong). I'd be happy to work with you on this patch.",
    "created_at": "2013-09-03T19:42:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186328",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

Here's what I currently have. The multiplication in the dual basis isn't working correctly yet. I know there's the `hopf_algebra_of_supercharacters-fs.patch` patch in the queue which seems like its targeted more for base rings of `ZZ[q]` (or like Hall-Littlewoods are to Sym), and I was hoping to link them together at some point (please correct me if I'm wrong). I'd be happy to work with you on this patch.



---

archive/issue_comments_186329.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe only problem is that I don't have much time these days to work on this. I've been meaning to implement NCSym. I'll try to take a look at what you have and see what I can offer, if anything.\n\nAs usual, thank you for your work, Travis!",
    "created_at": "2013-09-03T19:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186329",
    "user": "https://github.com/saliola"
}
```

<div id="comment:3" align="right">comment:3</div>

The only problem is that I don't have much time these days to work on this. I've been meaning to implement NCSym. I'll try to take a look at what you have and see what I can offer, if anything.

As usual, thank you for your work, Travis!



---

archive/issue_comments_186330.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nTravis, what sources are you using for this? I'm asking because I haven't read anything about NCSym so far. I have a vague impression it has been introduced in one of Rota's Foundations papers, but not one that I have. A good introduction would simplify my job reviewing this by a lot.",
    "created_at": "2013-09-03T19:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186330",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:4" align="right">comment:4</div>

Travis, what sources are you using for this? I'm asking because I haven't read anything about NCSym so far. I have a vague impression it has been introduced in one of Rota's Foundations papers, but not one that I have. A good introduction would simplify my job reviewing this by a lot.



---

archive/issue_comments_186331.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHere's one of the references (Bergeron, Zabrocki): http://arxiv.org/pdf/math/0509265.pdf. I forget the other references off-hand (it's on my other computer tho), and I'll be adding all of the references to the doc as I finish it up.",
    "created_at": "2013-09-03T19:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186331",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Here's one of the references (Bergeron, Zabrocki): http://arxiv.org/pdf/math/0509265.pdf. I forget the other references off-hand (it's on my other computer tho), and I'll be adding all of the references to the doc as I finish it up.



---

archive/issue_comments_186332.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,11 @@\n Implement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:\n \n-- monomial\n-- elementary\n-- homogeneous\n-- power-sum\n-- x\n-- q\n+- monomial **m**\n+- elementary **e**\n+- homogeneous **h**\n+- power-sum **p**\n+- **x**\n+- **q**\n \n-as well as the dual basis w.\n+as well as the dual basis **w**.\n \n``````\n",
    "created_at": "2013-09-03T20:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186332",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,11 @@
 Implement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:
 
-- monomial
-- elementary
-- homogeneous
-- power-sum
-- x
-- q
+- monomial **m**
+- elementary **e**
+- homogeneous **h**
+- power-sum **p**
+- **x**
+- **q**
 
-as well as the dual basis w.
+as well as the dual basis **w**.
 
``````




---

archive/issue_comments_186333.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlso I just fixed the **w** basis multiplication.",
    "created_at": "2013-09-03T20:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186333",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

Also I just fixed the **w** basis multiplication.



---

archive/issue_comments_186334.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOkay, the patch is now ready for first review. It has full doctest coverage and all tests pass for me. I've removed some of the coercions in the old version since I was worried about possibly breaking coercion commutative diagrams.\n\nSome of the things I'm not perfectly happy about (but can live with currently):\n\n- A descriptive name of the **q**, **x**, and **w** bases.\n- No antipode for the **w** basis.\n- Creating the `SymmetricFunctions` base object when creating `SymmetricFunctionNonCommutingVariables` in order to set up the coercion.\n- Is it safe to put the natural maps `Sym -> NCSym` and `NSym -> NCSym` as coercions?\n\nThe references I used are included in the documentation now too.",
    "created_at": "2013-09-07T00:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186334",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Okay, the patch is now ready for first review. It has full doctest coverage and all tests pass for me. I've removed some of the coercions in the old version since I was worried about possibly breaking coercion commutative diagrams.

Some of the things I'm not perfectly happy about (but can live with currently):

- A descriptive name of the **q**, **x**, and **w** bases.
- No antipode for the **w** basis.
- Creating the `SymmetricFunctions` base object when creating `SymmetricFunctionNonCommutingVariables` in order to set up the coercion.
- Is it safe to put the natural maps `Sym -> NCSym` and `NSym -> NCSym` as coercions?

The references I used are included in the documentation now too.



---

archive/issue_events_216179.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-07T00:42:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216179"
}
```



---

archive/issue_comments_186335.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHi Travis, One initial comment about the `NSym -> NCSym` map.  It is dangerous to call it \"the natural\" map from `NSym` to `NCSym`.  It is one of many.  There does not seem to be a reason to favor the map which sends the complete generators to the complete generators.  If you were to send the elementary generators to the elementary generators you get a map which is equally compelling and (unfortunately) they are not the same map.",
    "created_at": "2013-09-09T17:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186335",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:8" align="right">comment:8</div>

Hi Travis, One initial comment about the `NSym -> NCSym` map.  It is dangerous to call it "the natural" map from `NSym` to `NCSym`.  It is one of many.  There does not seem to be a reason to favor the map which sends the complete generators to the complete generators.  If you were to send the elementary generators to the elementary generators you get a map which is equally compelling and (unfortunately) they are not the same map.



---

archive/issue_comments_186336.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNew version rebased over changes in #15143 and removes the word \"natural\" and instead states that it is the map which fixes `Sym`.",
    "created_at": "2013-09-13T04:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186336",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

New version rebased over changes in #15143 and removes the word "natural" and instead states that it is the map which fixes `Sym`.



---

archive/issue_comments_186337.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHi Travis,\n\nWhat patches and version do you have applied?  I get fuzz on the file sage/combinat/ncsf_qsym/ncsf.py and doc tests failing in ncsym.py (seemingly) because the output displays in a different order.  We may need to put a dependency with other patches that touch ncsf.py.  I am currently running on sage-5.12.beta5 and only #15143 applied.",
    "created_at": "2013-09-13T17:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186337",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:10" align="right">comment:10</div>

Hi Travis,

What patches and version do you have applied?  I get fuzz on the file sage/combinat/ncsf_qsym/ncsf.py and doc tests failing in ncsym.py (seemingly) because the output displays in a different order.  We may need to put a dependency with other patches that touch ncsf.py.  I am currently running on sage-5.12.beta5 and only #15143 applied.



---

archive/issue_comments_186338.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHey Mike,\n\nI have 5.12.beta3 in the combinat queue, but the fuzz is likely due to #15164 (which I'm planning to review soon). What type of fuzz do you get? If it's 0 or 1, we don't need to put it down as a dependency.\n\nI'll build 5.12.beta5 today and see if I also get doctest failing.\n\nBest,\n\nTravis",
    "created_at": "2013-09-13T17:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186338",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Hey Mike,

I have 5.12.beta3 in the combinat queue, but the fuzz is likely due to #15164 (which I'm planning to review soon). What type of fuzz do you get? If it's 0 or 1, we don't need to put it down as a dependency.

I'll build 5.12.beta5 today and see if I also get doctest failing.

Best,

Travis



---

archive/issue_comments_186339.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYou are right that the fuzz is disappears by applying #15164\n\nI get 4 doctest failures on ncsym.py.  They are minor, but I don't know why I see them and you don't (so it doesn't seem like a good idea to change them).  They are on lines 248, 438, 633, 737 and for instance one is\n\n```\n\nFile \"sage/combinat/ncsym/ncsym.py\", line 633, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.elementary.Element.omega\nFailed example:\n    elt = e[[1,3],[2]].omega(); elt\nExpected:\n    -e{{1, 3}, {2}} + 2*e{{1}, {2}, {3}}\nGot:\n    2*e{{1}, {2}, {3}} - e{{1, 3}, {2}}\n```",
    "created_at": "2013-09-13T18:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186339",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:12" align="right">comment:12</div>

You are right that the fuzz is disappears by applying #15164

I get 4 doctest failures on ncsym.py.  They are minor, but I don't know why I see them and you don't (so it doesn't seem like a good idea to change them).  They are on lines 248, 438, 633, 737 and for instance one is

```

File "sage/combinat/ncsym/ncsym.py", line 633, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.elementary.Element.omega
Failed example:
    elt = e[[1,3],[2]].omega(); elt
Expected:
    -e{{1, 3}, {2}} + 2*e{{1}, {2}, {3}}
Got:
    2*e{{1}, {2}, {3}} - e{{1, 3}, {2}}
```



---

archive/issue_comments_186340.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI would have thought that the total ordering on set partitions in #15143 would have `CombinatorialFreeModule` give a unique sorting on the elements:\n\n```\nsage: SetPartition([[1,3],[2]]) < SetPartition([[1],[2],[3]])\nFalse\nsage: SetPartition([[1,3],[2]]) > SetPartition([[1],[2],[3]])\nTrue\nsage: SetPartition([[1],[2],[3]]) < SetPartition([[1,3],[2]])\nTrue\nsage: SetPartition([[1],[2],[3]]) > SetPartition([[1,3],[2]])\nFalse\n```\n\nMy guess as to why we're getting different output is a failure in the comparisons (I didn't see any tickets that seemed like would change the output of `linear_comb()`). Try running:\n\n```\nsage: e = SymmetricFunctionsNonCommutingVariables(QQ).e()\nsage: e.print_options()\n{'bracket': False,\n 'latex_bracket': False,\n 'latex_prefix': None,\n 'latex_scalar_mult': None,\n 'monomial_cmp': <function cmp>,\n 'prefix': 'e',\n 'scalar_mult': '*',\n 'tensor_symbol': None}\nsage: cmp(SetPartition([[1],[2],[3]]), SetPartition([[1,3],[2]]))\n-1\nsage: elt = 2*e[[1],[2],[3]] - e[[1,3],[2]]\nsage: L = elt._monomial_coefficients.items()\nsage: L.sort(cmp=cmp, key=lambda (x,y): x)\nsage: L\n[({{1, 3}, {2}}, -1), ({{1}, {2}, {3}}, 2)]\n```\nDo you get anything different, in particular the last one?",
    "created_at": "2013-09-13T18:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186340",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

I would have thought that the total ordering on set partitions in #15143 would have `CombinatorialFreeModule` give a unique sorting on the elements:

```
sage: SetPartition([[1,3],[2]]) < SetPartition([[1],[2],[3]])
False
sage: SetPartition([[1,3],[2]]) > SetPartition([[1],[2],[3]])
True
sage: SetPartition([[1],[2],[3]]) < SetPartition([[1,3],[2]])
True
sage: SetPartition([[1],[2],[3]]) > SetPartition([[1,3],[2]])
False
```

My guess as to why we're getting different output is a failure in the comparisons (I didn't see any tickets that seemed like would change the output of `linear_comb()`). Try running:

```
sage: e = SymmetricFunctionsNonCommutingVariables(QQ).e()
sage: e.print_options()
{'bracket': False,
 'latex_bracket': False,
 'latex_prefix': None,
 'latex_scalar_mult': None,
 'monomial_cmp': <function cmp>,
 'prefix': 'e',
 'scalar_mult': '*',
 'tensor_symbol': None}
sage: cmp(SetPartition([[1],[2],[3]]), SetPartition([[1,3],[2]]))
-1
sage: elt = 2*e[[1],[2],[3]] - e[[1,3],[2]]
sage: L = elt._monomial_coefficients.items()
sage: L.sort(cmp=cmp, key=lambda (x,y): x)
sage: L
[({{1, 3}, {2}}, -1), ({{1}, {2}, {3}}, 2)]
```
Do you get anything different, in particular the last one?



---

archive/issue_comments_186341.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI do get something different, but all of the comparisons are the same.  For the last one I get:\n`[({{1}, {2}, {3}}, 2), ({{1, 3}, {2}}, -1)]`\n\nAny idea why?",
    "created_at": "2013-09-13T19:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186341",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:14" align="right">comment:14</div>

I do get something different, but all of the comparisons are the same.  For the last one I get:
`[({{1}, {2}, {3}}, 2), ({{1, 3}, {2}}, -1)]`

Any idea why?



---

archive/issue_comments_186342.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis is why:\n\n```\nsage: A = SetPartition([[1],[2],[3]])\nsage: B = SetPartition([[1,3],[2]])\nsage: cmp(A, B)\n-1\nsage: cmp(B, A)\n-1\n```\nThe `cmp` is not correctly using the rich comparisons because `ClonableArray` has (in effect) a `__cmp__` function which calls the underlying list (which contains `Set` objects which don't compare as intended)...\n\nI'm fixing this right now.",
    "created_at": "2013-09-13T19:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186342",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

This is why:

```
sage: A = SetPartition([[1],[2],[3]])
sage: B = SetPartition([[1,3],[2]])
sage: cmp(A, B)
-1
sage: cmp(B, A)
-1
```
The `cmp` is not correctly using the rich comparisons because `ClonableArray` has (in effect) a `__cmp__` function which calls the underlying list (which contains `Set` objects which don't compare as intended)...

I'm fixing this right now.



---

archive/issue_comments_186343.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOkay, now it should be consistent.\n\n```\nsage: A = SetPartition([[1],[2],[3]])\nsage: B = SetPartition([[1,3],[2]])\nsage: cmp(A, B)\n-1\nsage: cmp(B, A)\n1\n```\n\nI added a `__cmp__()` method to `SetPartition` to override the behavior of `ClonableArray`.",
    "created_at": "2013-09-13T19:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186343",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Okay, now it should be consistent.

```
sage: A = SetPartition([[1],[2],[3]])
sage: B = SetPartition([[1,3],[2]])
sage: cmp(A, B)
-1
sage: cmp(B, A)
1
```

I added a `__cmp__()` method to `SetPartition` to override the behavior of `ClonableArray`.



---

archive/issue_comments_186344.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[trac_15150_product_on_basis_q-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150_product_on_basis_q-mz.patch.gz)**\n\nOK. Thanks for fixing that.  I'm looking over the patch and I have some initial changes where the multiplication uses the pipe function and the product is implemented in the `q` basis.\n\nThe change of basis from `q` to `x` or vice versa is slow and so ideally I would like to improve this.\n\nI think that line 180 from `ncsym.py` is wrong.  There should be no morphism from NCSym to Sym, but there is a projection.  There is however a morphism from DNCSym to Sym.\n\nDNCSym is similar to quasi-symmetric functions so that if you add the right elements together (say some linear combination of the `w` basis) then you have an element of Sym.",
    "created_at": "2013-09-15T04:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186344",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[trac_15150_product_on_basis_q-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150_product_on_basis_q-mz.patch.gz)**

OK. Thanks for fixing that.  I'm looking over the patch and I have some initial changes where the multiplication uses the pipe function and the product is implemented in the `q` basis.

The change of basis from `q` to `x` or vice versa is slow and so ideally I would like to improve this.

I think that line 180 from `ncsym.py` is wrong.  There should be no morphism from NCSym to Sym, but there is a projection.  There is however a morphism from DNCSym to Sym.

DNCSym is similar to quasi-symmetric functions so that if you add the right elements together (say some linear combination of the `w` basis) then you have an element of Sym.



---

archive/issue_comments_186345.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAnother thing that was bothering me was that `x[[1,2],[3]]` is ok, but `x([[1,2],[3]])` is not.  Both should be ok.  I think that this should be an easy fix.",
    "created_at": "2013-09-15T04:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186345",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:18" align="right">comment:18</div>

Another thing that was bothering me was that `x[[1,2],[3]]` is ok, but `x([[1,2],[3]])` is not.  Both should be ok.  I think that this should be an easy fix.



---

archive/issue_comments_186346.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSome random comments on ncsym.py.\n\n```\n    The ring of symmetric functions in non-commutative variables,\n    which is not to be confused with the :class:`non-commutative symmetric\n    functions<NonCommutativeSymmetricFunctions>`, are polynomials in `n`\n    non-commuting variables `{\\bf k}[x_1, x_2, \\ldots, x_n]` where the\n    dimension of the subspace of elements of degree `k` is equal to\n    the number of compositions of `k` (with less than `n` parts).\n```\nIf the variables are non-commuting, use angular rather than square brackets. Also, I assume you want infinitely many variables? And do you really want compositions?\n\nTypo:\n\n```\nGrothendeick\n```\n\nOld-style arXiv references like this:\n\n```\n:arxiv:`0208168`\n```\nshould have a \"math/\" in front of them, I believe (also, I'd add a version number, in this case math/0208168v2).\n\nWhat is the \\wedge operation on set partitions? It is used but not defined. If it's the one from the Bergeron-Zabrocki paper, it is simply the meet of set partitions (aka `__mul__`) and should be explained as such.\n\nOn the right hand side of\n\n```\n                S(\\mathbf{p}_A) = \\sum_{\\gamma} (-1)^{\\ell(\\gamma)} \\gamma[A]\n```\ndon't you mean to say ` p_{\\gamma[A]} ` rather than ` \\gamma[A] ` ? And on the next line, do you mean to say <code>of \\`[\\ell(A)]\\`</code> instead of <code>of length \\`\\ell(A)\\`</code>?\n\nSimilarly here:\n\n```\n                p(A) = \\sum_{\\gamma} (-1)^{\\ell(\\gamma)-1} \\gamma[A]\n```\n\nI assume that \"strictly coarser\" in\n\n```\n        where we sum over all strictly coarser set partitions `B`.\n```\nrefers to the relation of strict coarsening as defined in `set_partition.py`. If so, please say this explicitly, as the notation is slightly counterintuitive (one normally thinks \"strictly coarser\" means \"coarser and not equal\").\n\nI'll eventually have a closer look at the patch if only to understand how exactly internal-coproduct-by-coercion works (for use in NSym); I cannot promise that I will ever give this an actual review. Nevertheless, great work here, Travis.",
    "created_at": "2013-09-16T04:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186346",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:19" align="right">comment:19</div>

Some random comments on ncsym.py.

```
    The ring of symmetric functions in non-commutative variables,
    which is not to be confused with the :class:`non-commutative symmetric
    functions<NonCommutativeSymmetricFunctions>`, are polynomials in `n`
    non-commuting variables `{\bf k}[x_1, x_2, \ldots, x_n]` where the
    dimension of the subspace of elements of degree `k` is equal to
    the number of compositions of `k` (with less than `n` parts).
```
If the variables are non-commuting, use angular rather than square brackets. Also, I assume you want infinitely many variables? And do you really want compositions?

Typo:

```
Grothendeick
```

Old-style arXiv references like this:

```
:arxiv:`0208168`
```
should have a "math/" in front of them, I believe (also, I'd add a version number, in this case math/0208168v2).

What is the \wedge operation on set partitions? It is used but not defined. If it's the one from the Bergeron-Zabrocki paper, it is simply the meet of set partitions (aka `__mul__`) and should be explained as such.

On the right hand side of

```
                S(\mathbf{p}_A) = \sum_{\gamma} (-1)^{\ell(\gamma)} \gamma[A]
```
don't you mean to say ` p_{\gamma[A]} ` rather than ` \gamma[A] ` ? And on the next line, do you mean to say <code>of \`[\ell(A)]\`</code> instead of <code>of length \`\ell(A)\`</code>?

Similarly here:

```
                p(A) = \sum_{\gamma} (-1)^{\ell(\gamma)-1} \gamma[A]
```

I assume that "strictly coarser" in

```
        where we sum over all strictly coarser set partitions `B`.
```
refers to the relation of strict coarsening as defined in `set_partition.py`. If so, please say this explicitly, as the notation is slightly counterintuitive (one normally thinks "strictly coarser" means "coarser and not equal").

I'll eventually have a closer look at the patch if only to understand how exactly internal-coproduct-by-coercion works (for use in NSym); I cannot promise that I will ever give this an actual review. Nevertheless, great work here, Travis.



---

archive/issue_comments_186347.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHere's the new version of the patch which (hopefully) takes care of all of Darij's comments. How the `internal_coproduct*` works is a trick with `lazy_attribute` which `*_by_coercion()` creates the correct morphism object if `*_on_basis()` is not implemented and so it behaves like a method.\n\nI've removed the coercion from `NCSym` to `Sym` since it is not a Hopf morphism, which is a requirement for it to be a coercion. I've fixed the input to accept `x([[1,3],[2]])` as well.\n\nCurrently to get from `x` to `q` (or vice versa) there's a few coercions going on, and I don't know of a way to go between them directly. (Data suggests that `x(q[A])` is a sum over some subset of set partitions with all coefficients occurring (-1)<sup>nest(A)</sup>.)\n\nFor `DNCSym`, is there a way to express an element in the **w** basis as a polynomial? Currently I have a map from `Sym` to `DNCSym` which is at least (appears to me to be) an algebra morphism (see the `sum_of_partitions()` method). Is this a Hopf morphism and is the map from `DNCSym` to `Sym` the inverse of this map?\n\nThank you all for looking at this patch,\n\nTravis\n\nEdit - let's see if the patchbot catches it in an edited message:\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-17T03:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186347",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Here's the new version of the patch which (hopefully) takes care of all of Darij's comments. How the `internal_coproduct*` works is a trick with `lazy_attribute` which `*_by_coercion()` creates the correct morphism object if `*_on_basis()` is not implemented and so it behaves like a method.

I've removed the coercion from `NCSym` to `Sym` since it is not a Hopf morphism, which is a requirement for it to be a coercion. I've fixed the input to accept `x([[1,3],[2]])` as well.

Currently to get from `x` to `q` (or vice versa) there's a few coercions going on, and I don't know of a way to go between them directly. (Data suggests that `x(q[A])` is a sum over some subset of set partitions with all coefficients occurring (-1)<sup>nest(A)</sup>.)

For `DNCSym`, is there a way to express an element in the **w** basis as a polynomial? Currently I have a map from `Sym` to `DNCSym` which is at least (appears to me to be) an algebra morphism (see the `sum_of_partitions()` method). Is this a Hopf morphism and is the map from `DNCSym` to `Sym` the inverse of this map?

Thank you all for looking at this patch,

Travis

Edit - let's see if the patchbot catches it in an edited message:

For patchbot:

Apply: trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186348.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,4 @@\n \n as well as the dual basis **w**.\n \n+Apply: [attachment: trac_15150-ncsym-ts.patch\u200b](https://github.com/sagemath/sage/files/ticket15150/4c8b34f12e835d39d5e45bdc50893444.gz)\n``````\n",
    "created_at": "2013-09-17T03:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186348",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,4 @@
 
 as well as the dual basis **w**.
 
+Apply: [attachment: trac_15150-ncsym-ts.patchâ€‹](https://github.com/sagemath/sage/files/ticket15150/4c8b34f12e835d39d5e45bdc50893444.gz)
``````




---

archive/issue_comments_186349.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHi Travis,\nIs it possible that this is the same patch as before?",
    "created_at": "2013-09-19T13:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186349",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:21" align="right">comment:21</div>

Hi Travis,
Is it possible that this is the same patch as before?



---

archive/issue_comments_186350.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think I uploaded the patch from my beta3 install instead of my beta5. Sorry about that. Here's the new one.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-19T14:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186350",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I think I uploaded the patch from my beta3 install instead of my beta5. Sorry about that. Here's the new one.

For patchbot:

Apply: trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186351.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSo about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).\n\nThe morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\\lambda` is equal to the coefficient of `m_\\lambda` in `chi(m_A)`.'  Therefore,\n\n```\n\\sum_{A} A^{!} w_A = h_\\lambda\n```\nwhere the sum is over `A` with set partitions with part lengths a partition `\\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.",
    "created_at": "2013-09-19T14:22:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186351",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:23" align="right">comment:23</div>

So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).

The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\lambda` is equal to the coefficient of `m_\lambda` in `chi(m_A)`.'  Therefore,

```
\sum_{A} A^{!} w_A = h_\lambda
```
where the sum is over `A` with set partitions with part lengths a partition `\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.



---

archive/issue_comments_186352.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@zabrocki](#comment:23):\n> So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).\n> \n> The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\\lambda` is equal to the coefficient of `m_\\lambda` in `chi(m_A)`.'  Therefore,\n> \n> ```\n> \\sum_{A} A^{!} w_A = h_\\lambda\n> ```\n> where the sum is over `A` with set partitions with part lengths a partition `\\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.\n\nOkay, this is describing the image of the map I currently have implemented:\n\n```\nsage: h = SymmetricFunctions(QQ).h()\nsage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()\nsage: w(h[2,1,1])\n2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}\n + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}\n```\nThis map is respecting the multiplication\n\n```\nsage: w[[1,2]] * w[[1]] * w[[1]]\n2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}\n + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}\n```\nso we can at least get `w[This is the Trac macro *1,2,...,n* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,...,n-macro) = h[n]` as the correct expansion. However this does not seem straightforward to me in general as we have\n\n```\nsage: h[2,1,1].expand(2)\nx0^4 + 3*x0^3*x1 + 4*x0^2*x1^2 + 3*x0*x1^3 + x1^4\n```\nIf it does work, it probably uses crossings and/or nestings, but I don't see it.\n\nAnyways, do you think I should add a method `is_symmetric_function()` and/or `to_symmetric_function()` for the dual bases?\n\nAlso I found a bug with the expansion, in that `SetPartition` was not always living in the correct parent when taking `inf` or `sup`. I also added `to_symmetric_function` for the **e**, **h**, and **p** `NCSym` basis to return the correct object in the e, h, and p `Sym` basis resp.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-19T16:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186352",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@zabrocki](#comment:23):
> So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).
> 
> The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\lambda` is equal to the coefficient of `m_\lambda` in `chi(m_A)`.'  Therefore,
> 
> ```
> \sum_{A} A^{!} w_A = h_\lambda
> ```
> where the sum is over `A` with set partitions with part lengths a partition `\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.

Okay, this is describing the image of the map I currently have implemented:

```
sage: h = SymmetricFunctions(QQ).h()
sage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()
sage: w(h[2,1,1])
2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}
 + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}
```
This map is respecting the multiplication

```
sage: w[[1,2]] * w[[1]] * w[[1]]
2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}
 + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}
```
so we can at least get `w[This is the Trac macro *1,2,...,n* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,...,n-macro) = h[n]` as the correct expansion. However this does not seem straightforward to me in general as we have

```
sage: h[2,1,1].expand(2)
x0^4 + 3*x0^3*x1 + 4*x0^2*x1^2 + 3*x0*x1^3 + x1^4
```
If it does work, it probably uses crossings and/or nestings, but I don't see it.

Anyways, do you think I should add a method `is_symmetric_function()` and/or `to_symmetric_function()` for the dual bases?

Also I found a bug with the expansion, in that `SetPartition` was not always living in the correct parent when taking `inf` or `sup`. I also added `to_symmetric_function` for the **e**, **h**, and **p** `NCSym` basis to return the correct object in the e, h, and p `Sym` basis resp.

For patchbot:

Apply: trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186353.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYou are right that the polynomial realization of the `w` basis may not be obvious.  I suspect that you will have a better hope of guessing at what the polynomial realization is by looking at the dual of the **h** basis.\n\nI think that there should be a method for `is_symmetric_function()` for the bases of `DNCSym`.  I don't think that `to_symmetric_function()` makes sense in that space.",
    "created_at": "2013-09-19T21:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186353",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:25" align="right">comment:25</div>

You are right that the polynomial realization of the `w` basis may not be obvious.  I suspect that you will have a better hope of guessing at what the polynomial realization is by looking at the dual of the **h** basis.

I think that there should be a method for `is_symmetric_function()` for the bases of `DNCSym`.  I don't think that `to_symmetric_function()` makes sense in that space.



---

archive/issue_comments_186354.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nfor the **patchbots**:\n\napply only trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-20T18:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186354",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">comment:26</div>

for the **patchbots**:

apply only trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186355.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nfor the **patchbots**:\n\napply only trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-20T19:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186355",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

for the **patchbots**:

apply only trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186356.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nPatchbots are dummy ?\n\napply trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-20T19:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186356",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:28" align="right">comment:28</div>

Patchbots are dummy ?

apply trac_15150-ncsym-ts.patch



---

archive/issue_comments_186357.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n\"Also I found a bug with the expansion, in that SetPartition was not always living in the correct parent when taking inf or sup.\"\n\nHow that?\n\n```\nsage: P = SetPartition([[3,1],[2]])\nsage: parent(P)\nSet partitions\nsage: Q = SetPartition([[1,2],[3]])\nsage: Q.inf(P)\n{{1}, {2}, {3}}\nsage: parent(Q.inf(P))\nSet partitions\nsage: parent(Q.sup(P))\nSet partitions\nsage: P = SetPartitions(3)(P)\nsage: P\n{{1, 3}, {2}}\nsage: parent(P)\nSet partitions of {1, 2, 3}\nsage: Q = SetPartitions(3)(Q)\nsage: parent(Q)\nSet partitions of {1, 2, 3}\nsage: P.inf(Q)\n{{1}, {2}, {3}}\nsage: parent(P.inf(Q))\nSet partitions of {1, 2, 3}\nsage: parent(P.sup(Q))\nSet partitions of {1, 2, 3}\n```",
    "created_at": "2013-09-20T19:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186357",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:29" align="right">comment:29</div>

"Also I found a bug with the expansion, in that SetPartition was not always living in the correct parent when taking inf or sup."

How that?

```
sage: P = SetPartition([[3,1],[2]])
sage: parent(P)
Set partitions
sage: Q = SetPartition([[1,2],[3]])
sage: Q.inf(P)
{{1}, {2}, {3}}
sage: parent(Q.inf(P))
Set partitions
sage: parent(Q.sup(P))
Set partitions
sage: P = SetPartitions(3)(P)
sage: P
{{1, 3}, {2}}
sage: parent(P)
Set partitions of {1, 2, 3}
sage: Q = SetPartitions(3)(Q)
sage: parent(Q)
Set partitions of {1, 2, 3}
sage: P.inf(Q)
{{1}, {2}, {3}}
sage: parent(P.inf(Q))
Set partitions of {1, 2, 3}
sage: parent(P.sup(Q))
Set partitions of {1, 2, 3}
```



---

archive/issue_comments_186358.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nTry it with `SetPartitions(3, [2,1,1])`.",
    "created_at": "2013-09-20T20:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186358",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

Try it with `SetPartitions(3, [2,1,1])`.



---

archive/issue_comments_186359.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nOh, that's ugly (although I hope you mean `SetPartitions(4, [2,1,1])`. I'm wondering if we need a parent for set partitions with given type at all? I can think of very few maps which preserve the type, and it's not just inf and sup that fail:\n\n```\nsage: P = SetPartitions(4, [2,1,1])\nsage: x = P[0]\nsage: x.coarsenings()\n[...]\nAssertionError: \nsage: x.refinements()\n[...]\nAssertionError: \n```",
    "created_at": "2013-09-20T20:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186359",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:31" align="right">comment:31</div>

Oh, that's ugly (although I hope you mean `SetPartitions(4, [2,1,1])`. I'm wondering if we need a parent for set partitions with given type at all? I can think of very few maps which preserve the type, and it's not just inf and sup that fail:

```
sage: P = SetPartitions(4, [2,1,1])
sage: x = P[0]
sage: x.coarsenings()
[...]
AssertionError: 
sage: x.refinements()
[...]
AssertionError: 
```



---

archive/issue_comments_186360.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThis thing actually happens not only with set partitions. Any idea on how to avoid it on a bigger scale?\n\n```\nsage: P = Permutations(recoils=[2,3])\nsage: u = P[1]\nsage: u.complement()\n[5, 3, 2, 4, 1]\nsage: parent(u.complement())\nStandard permutations whose recoils composition is [2, 3]\n```\n\nThe only reason why this doesn't blow up is that the class of permutations whose recoils composition is a given composition is liberal to invalid input.\n\nSimilarly:\n\n```\nsage: P = Permutations(5, avoiding=[1,2,3])\nsage: parent(P[25].complement())\nStandard permutations of 5 avoiding [1, 2, 3]\nsage: P[25].complement()\n[3, 1, 4, 2, 5]\n```",
    "created_at": "2013-09-20T20:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186360",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:32" align="right">comment:32</div>

This thing actually happens not only with set partitions. Any idea on how to avoid it on a bigger scale?

```
sage: P = Permutations(recoils=[2,3])
sage: u = P[1]
sage: u.complement()
[5, 3, 2, 4, 1]
sage: parent(u.complement())
Standard permutations whose recoils composition is [2, 3]
```

The only reason why this doesn't blow up is that the class of permutations whose recoils composition is a given composition is liberal to invalid input.

Similarly:

```
sage: P = Permutations(5, avoiding=[1,2,3])
sage: parent(P[25].complement())
Standard permutations of 5 avoiding [1, 2, 3]
sage: P[25].complement()
[3, 1, 4, 2, 5]
```



---

archive/issue_comments_186361.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nAh, yes I did. I'd want the parent so as to provide an object to iterate over set partitions with a given shape. I thought I also fixed the `coarsenings` and `refinements` in this patch as well.\n\nFlorent was working on a related issue to this in the set factories ticket #10194 and we could tweak the concept to fix this by saying that it's parents must not contain certain conditions. As a current work around, we'd have to revert to a general parent on any method that does not preserve all conditions. I'm worried that this might end up having repercussions in other parts of Sage (mainly symmetric functions).",
    "created_at": "2013-09-20T20:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186361",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">comment:33</div>

Ah, yes I did. I'd want the parent so as to provide an object to iterate over set partitions with a given shape. I thought I also fixed the `coarsenings` and `refinements` in this patch as well.

Florent was working on a related issue to this in the set factories ticket #10194 and we could tweak the concept to fix this by saying that it's parents must not contain certain conditions. As a current work around, we'd have to revert to a general parent on any method that does not preserve all conditions. I'm worried that this might end up having repercussions in other parts of Sage (mainly symmetric functions).



---

archive/issue_comments_186362.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nSimilarly:\n\n```\nsage: C = Compositions(6, inner=[2,2])\nsage: c1 = C[1]\nsage: c1\n[3, 3]\nsage: c1.conjugate()\n[1, 1, 2, 1, 1]\nsage: parent(c1.conjugate())\nCompositions of the integer 6 satisfying constraints inner=[2, 2]\nsage: c1.conjugate() in parent(c1.conjugate())\nFalse\n```\n\nLack of input checking again saves this.",
    "created_at": "2013-09-20T20:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186362",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:34" align="right">comment:34</div>

Similarly:

```
sage: C = Compositions(6, inner=[2,2])
sage: c1 = C[1]
sage: c1
[3, 3]
sage: c1.conjugate()
[1, 1, 2, 1, 1]
sage: parent(c1.conjugate())
Compositions of the integer 6 satisfying constraints inner=[2, 2]
sage: c1.conjugate() in parent(c1.conjugate())
False
```

Lack of input checking again saves this.



---

archive/issue_comments_186363.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHey Mike,\n\nI've added an `is_symmetric()` method to the **w** basis.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-21T06:02:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186363",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Hey Mike,

I've added an `is_symmetric()` method to the **w** basis.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186364.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nmany failing doctests",
    "created_at": "2013-09-22T15:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186364",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:36" align="right">comment:36</div>

many failing doctests



---

archive/issue_events_216180.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2013-09-22T15:52:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216180"
}
```



---

archive/issue_events_216181.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2013-09-22T15:52:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216181"
}
```



---

archive/issue_comments_186365.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nNow with fixed doctests.",
    "created_at": "2013-09-22T19:50:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186365",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

Now with fixed doctests.



---

archive/issue_events_216182.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-22T19:50:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216182"
}
```



---

archive/issue_events_216183.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-22T19:50:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216183"
}
```



---

archive/issue_comments_186366.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nHi Travis,\nSo far I am focusing in on pieces of functionality.  It doesn't quite seem to work as I expect.  The doc string `w.sum_of_partitions?` does not seem to agree with what it does since it is actually a sum with coefficients.\n\nI was trying to figure out how to coerce `f=w[[1,2],[3]]+w[[1,3],[2]]+w[[2,3],[1]]` to the h-basis and I don't see a doc-string and what I tried doesn't seem to work anyway.  `DNCSym.to_symmetric_function?` gives an error and when I try either `h(f)` or `DNCSym.to_symmetric_function(f)`, both give the same error:\n\n```\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-34-98785946d5a3> in <module>()\n----> 1 DNCSym.to_symmetric_function(f)\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/map.so in sage.categories.map.Map.__call__ (sage/categories/map.c:4018)()\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)\n   1711                 j_preimage = j\n   1712             else:\n-> 1713                 j_preimage = self._inverse_on_support(j)\n   1714                 if j_preimage is None:\n   1715                     raise ValueError, \"%s is not in the image of %s\"%(f, self)\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/dual.pyc in _par_to_set_par(self, la)\n    287             ret = []\n    288             for i in sorted(la):\n--> 289                 ret += [range(cur, cur+i)]\n    290                 cur += i\n    291             return SetPartitions()(ret)\n\nTypeError: unsupported operand type(s) for +: 'int' and 'Set_object_enumerated_with_category'\n```\n\nWhat should I do in order to send my element `f` into the symmetric functions?",
    "created_at": "2013-09-22T22:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186366",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:38" align="right">comment:38</div>

Hi Travis,
So far I am focusing in on pieces of functionality.  It doesn't quite seem to work as I expect.  The doc string `w.sum_of_partitions?` does not seem to agree with what it does since it is actually a sum with coefficients.

I was trying to figure out how to coerce `f=w[[1,2],[3]]+w[[1,3],[2]]+w[[2,3],[1]]` to the h-basis and I don't see a doc-string and what I tried doesn't seem to work anyway.  `DNCSym.to_symmetric_function?` gives an error and when I try either `h(f)` or `DNCSym.to_symmetric_function(f)`, both give the same error:

```

TypeError                                 Traceback (most recent call last)
<ipython-input-34-98785946d5a3> in <module>()
----> 1 DNCSym.to_symmetric_function(f)

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/map.so in sage.categories.map.Map.__call__ (sage/categories/map.c:4018)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)
   1711                 j_preimage = j
   1712             else:
-> 1713                 j_preimage = self._inverse_on_support(j)
   1714                 if j_preimage is None:
   1715                     raise ValueError, "%s is not in the image of %s"%(f, self)

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/dual.pyc in _par_to_set_par(self, la)
    287             ret = []
    288             for i in sorted(la):
--> 289                 ret += [range(cur, cur+i)]
    290                 cur += i
    291             return SetPartitions()(ret)

TypeError: unsupported operand type(s) for +: 'int' and 'Set_object_enumerated_with_category'
```

What should I do in order to send my element `f` into the symmetric functions?



---

archive/issue_comments_186367.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nHey Mike,\n\nYou use the new version of the patch which corrects all of the above. I also added a method `to_symmetric_function()` to the `w` basis and, to be consistent with `QSym`, to its elements. Just let me know everything you'd want to see this patch do.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-23T02:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186367",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

Hey Mike,

You use the new version of the patch which corrects all of the above. I also added a method `to_symmetric_function()` to the `w` basis and, to be consistent with `QSym`, to its elements. Just let me know everything you'd want to see this patch do.

Best,

Travis

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186368.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nOverall the functionality looks good.  You covered a lot of ground for a first implementation.  I don't think I will suggest other functionality, but I will check the ones you have.\n\nWhat I can see of the map from  Sym -> NCSym* seems to work well.\n\nHow come you import `SymmetricFunctionsNonCommutingVariables` into the namespace, but not the dual?  It seems as though we can only access it through `NCSym.dual()`.  Is it because there is no name for the dual space?  Actually it is called \u03a0QSym in \"Commutative Combinatorial Hopf Algebras\" `http://arxiv.org/abs/math/0605262`.  I think that we can do better than \u03a0QSym for a name.  This reference seems to realize this space in the ring of polynomials (see equations (23) and (55) for this realization), but not clearly where Sym is a subalgebra.",
    "created_at": "2013-09-23T04:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186368",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:40" align="right">comment:40</div>

Overall the functionality looks good.  You covered a lot of ground for a first implementation.  I don't think I will suggest other functionality, but I will check the ones you have.

What I can see of the map from  Sym -> NCSym* seems to work well.

How come you import `SymmetricFunctionsNonCommutingVariables` into the namespace, but not the dual?  It seems as though we can only access it through `NCSym.dual()`.  Is it because there is no name for the dual space?  Actually it is called Î QSym in "Commutative Combinatorial Hopf Algebras" `http://arxiv.org/abs/math/0605262`.  I think that we can do better than Î QSym for a name.  This reference seems to realize this space in the ring of polynomials (see equations (23) and (55) for this realization), but not clearly where Sym is a subalgebra.



---

archive/issue_comments_186369.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nSorry, but what does this mean:\n\n```\n \t496\t            def to_ncsym_on_basis(self, I): \n \t497\t                r\"\"\" \n \t498\t                The image of the basis element indexed by ``I`` under the \n \t499\t                map to the symmetric functions in non-commuting \n \t500\t                variables that fixes the usual symmetric functions. \n```\n\nHow can a map from NSym to something fix the usual symmetric functions if the latter aren't a subspace of NSym? (Same question for both `to_ncsym` methods.)\n\nOooh, I think you mean \"commutes with the projection onto the usual symmetric functions\". Maybe clarify this?",
    "created_at": "2013-09-23T15:00:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186369",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:41" align="right">comment:41</div>

Sorry, but what does this mean:

```
 	496	            def to_ncsym_on_basis(self, I): 
 	497	                r""" 
 	498	                The image of the basis element indexed by ``I`` under the 
 	499	                map to the symmetric functions in non-commuting 
 	500	                variables that fixes the usual symmetric functions. 
```

How can a map from NSym to something fix the usual symmetric functions if the latter aren't a subspace of NSym? (Same question for both `to_ncsym` methods.)

Oooh, I think you mean "commutes with the projection onto the usual symmetric functions". Maybe clarify this?



---

archive/issue_comments_186370.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nHey Mike,\n\nThe biggest thing why it's not imported is the name, I didn't think just calling it `DualSymmetricFunctionsNonCommutingVariables` was more descriptive than calling `SymmetricFunctionsNonCommutingVariables(QQ).dual()` (and it's not much shorter to call). I'm not 100% happy with the name (being the global namespace) since I seem to want to attach dual to function, as in the dual symmetric functions (as in linear functionals) in non-commuting variables. I know it doesn't make much sense, but it sounded more descriptive than `SymmetricFunctionsNonCommutingVariablesDual`. I'll import `Dual*` in the next version unless we come up with a better name. I can't think of one right now... Franco, you have any ideas as well?\n\nI'll use http://arxiv.org/abs/math/0605262 to give a realization and also define a coercion from `QSym` into `DNCSym`.\n\nHey Darij,\n\nYes, up to abuse of labels on commutative diagrams. I'll change it to explicitly state that <code>\\`\\chi \\circ p = \\phi\\` on Sym</code> (up to function names).\n\nBest,\n\nTravis",
    "created_at": "2013-09-24T21:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186370",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

Hey Mike,

The biggest thing why it's not imported is the name, I didn't think just calling it `DualSymmetricFunctionsNonCommutingVariables` was more descriptive than calling `SymmetricFunctionsNonCommutingVariables(QQ).dual()` (and it's not much shorter to call). I'm not 100% happy with the name (being the global namespace) since I seem to want to attach dual to function, as in the dual symmetric functions (as in linear functionals) in non-commuting variables. I know it doesn't make much sense, but it sounded more descriptive than `SymmetricFunctionsNonCommutingVariablesDual`. I'll import `Dual*` in the next version unless we come up with a better name. I can't think of one right now... Franco, you have any ideas as well?

I'll use http://arxiv.org/abs/math/0605262 to give a realization and also define a coercion from `QSym` into `DNCSym`.

Hey Darij,

Yes, up to abuse of labels on commutative diagrams. I'll change it to explicitly state that <code>\`\chi \circ p = \phi\` on Sym</code> (up to function names).

Best,

Travis



---

archive/issue_comments_186371.json:
```json
{
    "body": "not a review but a few improvement suggestions (docstrings mostly)",
    "created_at": "2013-09-29T06:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186371",
    "user": "https://github.com/darijgr"
}
```

not a review but a few improvement suggestions (docstrings mostly)



---

archive/issue_comments_186372.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nAttachment: **[trac_15150-docs-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-docs-dg.patch.gz)**\n\nNew patch that Mike and I have talked about (removes the QSym stuff and the name for the Hopf dual) and with Darij's docstring improvements folded in.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-30T16:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186372",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

Attachment: **[trac_15150-docs-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-docs-dg.patch.gz)**

New patch that Mike and I have talked about (removes the QSym stuff and the name for the Hopf dual) and with Darij's docstring improvements folded in.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186373.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nShould be a one-line edit:\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/ncsym.py\", line 248, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function\nFailed example:\n    elt = m.from_symmetric_function(mon[2,1,1]); elt\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function[2]>\", line 1, in <module>\n        elt = m.from_symmetric_function(mon[Integer(2),Integer(1),Integer(1)]); elt\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py\", line 255, in from_symmetric_function\n        return self.sum([c * self.sum_of_partitions(i) for i,c in m(f)])\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py\", line 471, in sum_of_partitions\n        la = Partition(la) # Make sure it is a partition\n    NameError: global name 'Partition' is not defined\n```",
    "created_at": "2013-10-02T01:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186373",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:44" align="right">comment:44</div>

Should be a one-line edit:

```
**********************************************************************
File "devel/sage/sage/combinat/ncsym/ncsym.py", line 248, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function
Failed example:
    elt = m.from_symmetric_function(mon[2,1,1]); elt
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function[2]>", line 1, in <module>
        elt = m.from_symmetric_function(mon[Integer(2),Integer(1),Integer(1)]); elt
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py", line 255, in from_symmetric_function
        return self.sum([c * self.sum_of_partitions(i) for i,c in m(f)])
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py", line 471, in sum_of_partitions
        la = Partition(la) # Make sure it is a partition
    NameError: global name 'Partition' is not defined
```



---

archive/issue_comments_186374.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nWhoops. Fixed.\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-02T01:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186374",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Whoops. Fixed.

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186375.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nSorry, more stuff coming up (and I can't edit right now since I'm running doctests):\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 346, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand\nFailed example:\n    w[[1,3],[2]].expand(4)\nExpected:\n    x0*x1*x0 + x0*x2*x0 + x0*x3*x0 + x1*x0*x1 + x1*x2*x1 + x1*x3*x1\n     + x2*x0*x2 + x2*x1*x2 + x2*x3*x2 + x3*x0*x3 + x3*x1*x3 + x3*x2*x3\nGot:\n    x02*x11*x20 + x03*x11*x30 + x03*x22*x30 + x13*x22*x31\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 353, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand\nFailed example:\n    w[[1],[2,3]].expand(3, letter='y')\nExpected:\n    y0*y1^2 + y0*y2^2 + y1*y0^2 + y1*y2^2 + y2*y0^2 + y2*y1^2\nGot:\n    y00*y12*y21\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 492, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt = w.sum_of_compositions([2,1,1])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[1]>\", line 1, in <module>\n        elt = w.sum_of_compositions([Integer(2),Integer(1),Integer(1)])\n      File \"parent.pyx\", line 761, in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6823)\n      File \"misc.pyx\", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)\n    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category' object has no attribute 'sum_of_compositions'\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 493, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt.is_quasisymmetric()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[2]>\", line 1, in <module>\n        elt.is_quasisymmetric()\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 495, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt -= 3*w.sum_of_compositions([1,1])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[3]>\", line 1, in <module>\n        elt -= Integer(3)*w.sum_of_compositions([Integer(1),Integer(1)])\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 496, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt.is_quasisymmetric()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[4]>\", line 1, in <module>\n        elt.is_quasisymmetric()\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 538, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    elt.to_quassymmetric_function()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function[2]>\", line 1, in <module>\n        elt.to_quassymmetric_function()\n      File \"element.pyx\", line 344, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)\n      File \"misc.pyx\", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)\n    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category.element_class' object has no attribute 'to_quassymmetric_function'\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 541, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    elt.to_quasisymmetric_function()\nExpected:\n    1/2*h[2, 1, 1]\nGot:\n    M[1, 1, 2] + M[1, 2, 1] + M[2, 1, 1]\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 549, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    w([]).to_quasisymmetric_function()\nExpected:\n    h[]\nGot:\n    M[]\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 551, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    (2*w([])).to_quasisymmetric_function()\nExpected:\n    2*h[]\nGot:\n    2*M[]\n**********************************************************************\n```\nThis is still the old file, since I didn't want to pop and push during doctesting.",
    "created_at": "2013-10-02T02:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186375",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:46" align="right">comment:46</div>

Sorry, more stuff coming up (and I can't edit right now since I'm running doctests):

```
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 346, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand
Failed example:
    w[[1,3],[2]].expand(4)
Expected:
    x0*x1*x0 + x0*x2*x0 + x0*x3*x0 + x1*x0*x1 + x1*x2*x1 + x1*x3*x1
     + x2*x0*x2 + x2*x1*x2 + x2*x3*x2 + x3*x0*x3 + x3*x1*x3 + x3*x2*x3
Got:
    x02*x11*x20 + x03*x11*x30 + x03*x22*x30 + x13*x22*x31
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 353, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand
Failed example:
    w[[1],[2,3]].expand(3, letter='y')
Expected:
    y0*y1^2 + y0*y2^2 + y1*y0^2 + y1*y2^2 + y2*y0^2 + y2*y1^2
Got:
    y00*y12*y21
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 492, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt = w.sum_of_compositions([2,1,1])
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[1]>", line 1, in <module>
        elt = w.sum_of_compositions([Integer(2),Integer(1),Integer(1)])
      File "parent.pyx", line 761, in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6823)
      File "misc.pyx", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)
    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category' object has no attribute 'sum_of_compositions'
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 493, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt.is_quasisymmetric()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[2]>", line 1, in <module>
        elt.is_quasisymmetric()
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 495, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt -= 3*w.sum_of_compositions([1,1])
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[3]>", line 1, in <module>
        elt -= Integer(3)*w.sum_of_compositions([Integer(1),Integer(1)])
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 496, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt.is_quasisymmetric()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[4]>", line 1, in <module>
        elt.is_quasisymmetric()
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 538, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    elt.to_quassymmetric_function()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function[2]>", line 1, in <module>
        elt.to_quassymmetric_function()
      File "element.pyx", line 344, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)
      File "misc.pyx", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)
    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category.element_class' object has no attribute 'to_quassymmetric_function'
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 541, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    elt.to_quasisymmetric_function()
Expected:
    1/2*h[2, 1, 1]
Got:
    M[1, 1, 2] + M[1, 2, 1] + M[2, 1, 1]
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 549, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    w([]).to_quasisymmetric_function()
Expected:
    h[]
Got:
    M[]
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 551, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    (2*w([])).to_quasisymmetric_function()
Expected:
    2*h[]
Got:
    2*M[]
**********************************************************************
```
This is still the old file, since I didn't want to pop and push during doctesting.



---

archive/issue_comments_186376.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI didn't separate everything off as I thought I did. I also made the expansion live in the correct parent (in HNT it is the quotient of a polynomial ring).\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-02T14:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186376",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:47" align="right">comment:47</div>

I didn't separate everything off as I thought I did. I also made the expansion live in the correct parent (in HNT it is the quotient of a polynomial ring).

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186377.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nHere are some doc changes, but a lot of methods need OUTPUT as well as INPUT.  Remember how I said \"I don't think I will suggest other functionality...\"?  I was wrong.  One thing that I realized that was missing was a `duality_pairing` function.  I have a patch to add this, but I need to add documentation yet.  I'll try to do this shortly.",
    "created_at": "2013-10-03T00:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186377",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:48" align="right">comment:48</div>

Here are some doc changes, but a lot of methods need OUTPUT as well as INPUT.  Remember how I said "I don't think I will suggest other functionality..."?  I was wrong.  One thing that I realized that was missing was a `duality_pairing` function.  I have a patch to add this, but I need to add documentation yet.  I'll try to do this shortly.



---

archive/issue_comments_186378.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nAttachment: **[trac_15150-duality_pairing-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-duality_pairing-mz.patch.gz)**\n\nNew version with both of Mike's patches folded in and functions documented, along with refactoring the categories to a common super category to not duplicate code.",
    "created_at": "2013-10-04T04:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186378",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

Attachment: **[trac_15150-duality_pairing-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-duality_pairing-mz.patch.gz)**

New version with both of Mike's patches folded in and functions documented, along with refactoring the categories to a common super category to not duplicate code.



---

archive/issue_comments_186379.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nHi Travis,\nI was looking at the method `from_symmetric_function` and I want to make sure that I understand.  It is just a linear map of one vector space to another, right?  It does not preserve the product or the coproduct structure if I understand it.",
    "created_at": "2013-10-09T20:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186379",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:50" align="right">comment:50</div>

Hi Travis,
I was looking at the method `from_symmetric_function` and I want to make sure that I understand.  It is just a linear map of one vector space to another, right?  It does not preserve the product or the coproduct structure if I understand it.



---

archive/issue_comments_186380.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nHey Mike.\n\nYes. It is more about it being a section of the natural projection and working with the map with NSym.",
    "created_at": "2013-10-10T00:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186380",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Hey Mike.

Yes. It is more about it being a section of the natural projection and working with the map with NSym.



---

archive/issue_comments_186381.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nHere is one that I can see needs to be fixed.\n\n```\nsage: Sp = SymmetricFunctions(QQ).p()\nsage: Np = SymmetricFunctionsNonCommutingVariables(QQ).p()\nsage: Nh = SymmetricFunctionsNonCommutingVariables(QQ).h()\nsage: Sp(Nh(Np([[1,4],[2,3]])).to_symmetric_function())\n45/2*p[1, 1, 1, 1] - p[2, 1, 1] + 1/2*p[2, 2]\nsage: Np([[1,4],[2,3]]).to_symmetric_function()\np[2, 2]\nsage: Ne = SymmetricFunctionsNonCommutingVariables(QQ).e()\nsage: Sp(Ne(Np([[1,4],[2,3]])).to_symmetric_function())\n45/2*p[1, 1, 1, 1] + p[2, 1, 1] + 1/2*p[2, 2]\n```\nWith **m**, **q**, **x** the coercion is consistent.\n\nI am fairly sure the problem is with the projection `to_symmetric_function` in the **h** and the **e** bases.",
    "created_at": "2013-10-10T12:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186381",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:52" align="right">comment:52</div>

Here is one that I can see needs to be fixed.

```
sage: Sp = SymmetricFunctions(QQ).p()
sage: Np = SymmetricFunctionsNonCommutingVariables(QQ).p()
sage: Nh = SymmetricFunctionsNonCommutingVariables(QQ).h()
sage: Sp(Nh(Np([[1,4],[2,3]])).to_symmetric_function())
45/2*p[1, 1, 1, 1] - p[2, 1, 1] + 1/2*p[2, 2]
sage: Np([[1,4],[2,3]]).to_symmetric_function()
p[2, 2]
sage: Ne = SymmetricFunctionsNonCommutingVariables(QQ).e()
sage: Sp(Ne(Np([[1,4],[2,3]])).to_symmetric_function())
45/2*p[1, 1, 1, 1] + p[2, 1, 1] + 1/2*p[2, 2]
```
With **m**, **q**, **x** the coercion is consistent.

I am fairly sure the problem is with the projection `to_symmetric_function` in the **h** and the **e** bases.



---

archive/issue_comments_186382.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nmore doc changes",
    "created_at": "2013-10-10T13:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186382",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:53" align="right">comment:53</div>

more doc changes



---

archive/issue_comments_186383.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nHey Mike,\n\nI've folded in your latest review patch, fixed the projection in the **h** and **e** bases (I wasn't scaling by the correct constant), and added some exposition to the `NCSym` class.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-13T17:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186383",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:54" align="right">comment:54</div>

Hey Mike,

I've folded in your latest review patch, fixed the projection in the **h** and **e** bases (I wasn't scaling by the correct constant), and added some exposition to the `NCSym` class.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186384.json:
```json
{
    "body": "Changed dependencies from **#15143** to **#15143, #15164**",
    "created_at": "2013-10-26T13:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186384",
    "user": "https://github.com/zabrocki"
}
```

Changed dependencies from **#15143** to **#15143, #15164**



---

archive/issue_comments_186385.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nSorry I had to put this aside for a while.  I factored out `product_on_basis` and moved it to `bases.py` since the product is the same for all bases except the monomial basis.  Added a few more doc changes.  I think that there is more to do, but we are getting close.",
    "created_at": "2013-10-26T13:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186385",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:56" align="right">comment:56</div>

Sorry I had to put this aside for a while.  I factored out `product_on_basis` and moved it to `bases.py` since the product is the same for all bases except the monomial basis.  Added a few more doc changes.  I think that there is more to do, but we are getting close.



---

archive/issue_comments_186386.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nThis version includes changes to `dual.py`.  I deleted the function `_set_par_to_par` because it didn't make sense and the documentation was wrong and it could be replaced with `lambda A: A.shape()`.",
    "created_at": "2013-10-26T16:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186386",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:57" align="right">comment:57</div>

This version includes changes to `dual.py`.  I deleted the function `_set_par_to_par` because it didn't make sense and the documentation was wrong and it could be replaced with `lambda A: A.shape()`.



---

archive/issue_comments_186387.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nHmm. Am I seeing it right that you defined the product to be piping on every basis unless overshadowed explicitly? A bit of an trap if you ask me.\n\nAlso:\n\n```\n \t392\t                The expansion of an element of the `\\mathbf{w}` basis is \n \t393\t                given by equations (26) and (55) in [HNT06]_. \n```\nThe formula numbers refer to a version of the paper other than the one referenced (arXiv; by the way, please add a version number).",
    "created_at": "2013-10-26T16:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186387",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:58" align="right">comment:58</div>

Hmm. Am I seeing it right that you defined the product to be piping on every basis unless overshadowed explicitly? A bit of an trap if you ask me.

Also:

```
 	392	                The expansion of an element of the `\mathbf{w}` basis is 
 	393	                given by equations (26) and (55) in [HNT06]_. 
```
The formula numbers refer to a version of the paper other than the one referenced (arXiv; by the way, please add a version number).



---

archive/issue_comments_186388.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI created a category of multiplicative bases and put the `product_on_basis` there.  In theory, calculations can be sped up by applying homomorphisms to irreducible components of basis elements.",
    "created_at": "2013-10-27T12:50:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186388",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:59" align="right">comment:59</div>

I created a category of multiplicative bases and put the `product_on_basis` there.  In theory, calculations can be sped up by applying homomorphisms to irreducible components of basis elements.



---

archive/issue_comments_186389.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nBut it's in `class NCSymBases(Category_realization_of_parent)`, not in some hypothetical `class MultiplicativeNCSymBases(NCSymBases)` right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the `NCSymBasis_abstract` class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...",
    "created_at": "2013-10-27T16:05:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186389",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:60" align="right">comment:60</div>

But it's in `class NCSymBases(Category_realization_of_parent)`, not in some hypothetical `class MultiplicativeNCSymBases(NCSymBases)` right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the `NCSymBasis_abstract` class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...



---

archive/issue_comments_186390.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nThe method `_set_par_to_par` is needed because does a little bit more than just return the shape and is needed for the [inverse] coercion. The method `_set_par_to_par()` in effect takes a subset of set partitions which are in bijection with partitions and corresponds to leading terms in the coercion.\n\nWith Mike's patch we have:\n\n```python\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: h = SymmetricFunctions(QQ).h()\nsage: h(w[[1,3],[2]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-3-5d0ec5476c79> in <module>()\n----> 1 h(w[[Integer(1),Integer(3)],[Integer(2)]])\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)\n   1715                     raise ValueError, \"%s is not in the image of %s\"%(f, self)\n   1716             s = map(j_preimage)\n-> 1717             assert j == self._dominant_item(s)[0]\n   1718 \n   1719             if not self._unitriangular:\n\nAssertionError:\n```\nWhile it shouldn't work, it is giving the wrong error.\n\nI've folded in your latest patch Mike, but reinstated `_set_par_to_par` with some documentation changes and some doctests. Hopefully it is more clear what it does, but perhaps the method could be renamed.\n\n> But it's in class NCSymBases(Category_realization_of_parent), not in some hypothetical class MultiplicativeNCSymBases(NCSymBases) right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the NCSymBasis_abstract class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...\n\nNot quite. We need the `NCSymBasis_abstract` class to overwrite the `_element_constructor_` from `Parent`. This is not a category object, and all bases inherit from this (as classes). The different categories are used as a slightly different type of abstraction, which includes (in a sense) a mathematical organization.\n\nI've also made the **w** basis inherit from `NCSymBasis_abstract`.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-27T17:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186390",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:61" align="right">comment:61</div>

The method `_set_par_to_par` is needed because does a little bit more than just return the shape and is needed for the [inverse] coercion. The method `_set_par_to_par()` in effect takes a subset of set partitions which are in bijection with partitions and corresponds to leading terms in the coercion.

With Mike's patch we have:

```python
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: h = SymmetricFunctions(QQ).h()
sage: h(w[[1,3],[2]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-3-5d0ec5476c79> in <module>()
----> 1 h(w[[Integer(1),Integer(3)],[Integer(2)]])

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)
   1715                     raise ValueError, "%s is not in the image of %s"%(f, self)
   1716             s = map(j_preimage)
-> 1717             assert j == self._dominant_item(s)[0]
   1718 
   1719             if not self._unitriangular:

AssertionError:
```
While it shouldn't work, it is giving the wrong error.

I've folded in your latest patch Mike, but reinstated `_set_par_to_par` with some documentation changes and some doctests. Hopefully it is more clear what it does, but perhaps the method could be renamed.

> But it's in class NCSymBases(Category_realization_of_parent), not in some hypothetical class MultiplicativeNCSymBases(NCSymBases) right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the NCSymBasis_abstract class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...

Not quite. We need the `NCSymBasis_abstract` class to overwrite the `_element_constructor_` from `Parent`. This is not a category object, and all bases inherit from this (as classes). The different categories are used as a slightly different type of abstraction, which includes (in a sense) a mathematical organization.

I've also made the **w** basis inherit from `NCSymBasis_abstract`.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186391.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nHmm.  I still don't get `_set_par_to_par`.  Where does the `\\lambda_i \\leq \\lambda_{i+1}` come in?\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()\nsage: h = SymmetricFunctions(QQ).h() \nsage: w._set_par_to_par(SetPartition([[1],[2],[3,4,5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1,2,3],[4],[5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1],[2,3,4],[5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1],[2,3,5],[4]]))\nsage: h(w[[1,2],[3]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n...\nAssertionError: \nsage: h(w[[1],[2,3]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n...\nAssertionError: \nsage: h(w[[1,3],[2]])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: w{{1, 3}, {2}} is not in the image of Generic morphism:\n  From: Symmetric Functions over Rational Field in the homogeneous basis\n  To:   Dual symmetric functions in non-commuting variables over the Rational Field in the w basis\nsage: \n```\nWhy is the last one a `ValueError` and the others are assertion errors?",
    "created_at": "2013-10-27T18:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186391",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:62" align="right">comment:62</div>

Hmm.  I still don't get `_set_par_to_par`.  Where does the `\lambda_i \leq \lambda_{i+1}` come in?

```
sage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()
sage: h = SymmetricFunctions(QQ).h() 
sage: w._set_par_to_par(SetPartition([[1],[2],[3,4,5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1,2,3],[4],[5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1],[2,3,4],[5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1],[2,3,5],[4]]))
sage: h(w[[1,2],[3]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
...
AssertionError: 
sage: h(w[[1],[2,3]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
...
AssertionError: 
sage: h(w[[1,3],[2]])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: w{{1, 3}, {2}} is not in the image of Generic morphism:
  From: Symmetric Functions over Rational Field in the homogeneous basis
  To:   Dual symmetric functions in non-commuting variables over the Rational Field in the w basis
sage: 
```
Why is the last one a `ValueError` and the others are assertion errors?



---

archive/issue_comments_186392.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nThere's two problems, the first is the morphism should be the other triangular and the second is the `_set_par_to_par()` is not restrictive enough. I'll be fixing this now.",
    "created_at": "2013-10-27T19:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186392",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:63" align="right">comment:63</div>

There's two problems, the first is the morphism should be the other triangular and the second is the `_set_par_to_par()` is not restrictive enough. I'll be fixing this now.



---

archive/issue_comments_186393.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nOkay, fixed. They all return `ValueError`s now and I'm now using the ordering on `lambda_i` in the method.",
    "created_at": "2013-10-27T19:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186393",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:64" align="right">comment:64</div>

Okay, fixed. They all return `ValueError`s now and I'm now using the ordering on `lambda_i` in the method.



---

archive/issue_comments_186394.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nThere seems to be a problem with coercion for bases other than than `h`.\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: e = SymmetricFunctions(QQ).e()\nsage: e(w(e[2,1]))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-66ec535e7d35> in <module>()\n----> 1 e(w(e[Integer(2),Integer(1)]))\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/sf/classical.pyc in _element_constructor_(self, x)\n    327                 return eclass(self, {sage.combinat.partition.Partition([]):R(x)})\n    328             except StandardError:\n--> 329                 raise TypeError, \"do not know how to make x (= %s) an element of self\"%(x)\n    330 \n    331     # This subclass is currently needed for the test above:\n\nTypeError: do not know how to make x (= 6*w{{1}, {2}, {3}} - w{{1}, {2, 3}} - w{{1, 2}, {3}} - w{{1, 3}, {2}}) an element of self\nsage: h = SymmetricFunctions(QQ).h()\nsage: e(h(w(e[2,1])))\ne[2, 1]\n```",
    "created_at": "2013-10-28T01:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186394",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:65" align="right">comment:65</div>

There seems to be a problem with coercion for bases other than than `h`.

```
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: e = SymmetricFunctions(QQ).e()
sage: e(w(e[2,1]))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-66ec535e7d35> in <module>()
----> 1 e(w(e[Integer(2),Integer(1)]))

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/sf/classical.pyc in _element_constructor_(self, x)
    327                 return eclass(self, {sage.combinat.partition.Partition([]):R(x)})
    328             except StandardError:
--> 329                 raise TypeError, "do not know how to make x (= %s) an element of self"%(x)
    330 
    331     # This subclass is currently needed for the test above:

TypeError: do not know how to make x (= 6*w{{1}, {2}, {3}} - w{{1}, {2, 3}} - w{{1, 2}, {3}} - w{{1, 3}, {2}}) an element of self
sage: h = SymmetricFunctions(QQ).h()
sage: e(h(w(e[2,1])))
e[2, 1]
```



---

archive/issue_comments_186395.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nA few minor changes in whitespace and pyflakes warnings.",
    "created_at": "2013-10-28T01:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186395",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:66" align="right">comment:66</div>

A few minor changes in whitespace and pyflakes warnings.



---

archive/issue_comments_186396.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nMike, you're trying to coerce from a basis of dual NCSym to a basis of Sym? Should that really be a coercion? That would give a noncommutative coercion graph...",
    "created_at": "2013-10-28T02:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186396",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:67" align="right">comment:67</div>

Mike, you're trying to coerce from a basis of dual NCSym to a basis of Sym? Should that really be a coercion? That would give a noncommutative coercion graph...



---

archive/issue_comments_186397.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nTo my eye, the problem is the doc tests.  I see examples of coercion through the `h` basis rather than the use of the `to_symmetric_function` method.  Reading those doc-tests I suspected that the `h` basis is not the only portal and I was wrong.\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: e = SymmetricFunctions(QQ).e()\nsage: w(e[2,1]).to_symmetric_function()\nh[1, 1, 1] - h[2, 1]\n```",
    "created_at": "2013-10-28T02:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186397",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:68" align="right">comment:68</div>

To my eye, the problem is the doc tests.  I see examples of coercion through the `h` basis rather than the use of the `to_symmetric_function` method.  Reading those doc-tests I suspected that the `h` basis is not the only portal and I was wrong.

```
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: e = SymmetricFunctions(QQ).e()
sage: w(e[2,1]).to_symmetric_function()
h[1, 1, 1] - h[2, 1]
```



---

archive/issue_comments_186398.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nOK, this thing is implemented as a conversion (rightly -- it can't be a coercion), whence there is no automatic path discovery. But the docstring is claiming it's a coercion, and could be more explicit about it only leading to `h`.",
    "created_at": "2013-10-28T02:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186398",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:69" align="right">comment:69</div>

OK, this thing is implemented as a conversion (rightly -- it can't be a coercion), whence there is no automatic path discovery. But the docstring is claiming it's a coercion, and could be more explicit about it only leading to `h`.



---

archive/issue_comments_186399.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nI'm not sure if I should be too concerned because the doc tests are in a hidden function and they are there to test if that coercion doesn't work, not to demonstrate how to coerce between NCSym<sup>*</sup> and Sym.  I tried to make it *slightly* clearer by changing the doc test.\n\nI also changed the following because I don't think it is right:\n\n```\n    There is also a natural projection to the usual symmetric functions by\n    letting the variables commute. This projection does *not* preserve the\n    product nor coproduct stucture, but instead is just a module morphism.\n```\nI think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.",
    "created_at": "2013-10-28T13:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186399",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:70" align="right">comment:70</div>

I'm not sure if I should be too concerned because the doc tests are in a hidden function and they are there to test if that coercion doesn't work, not to demonstrate how to coerce between NCSym<sup>*</sup> and Sym.  I tried to make it *slightly* clearer by changing the doc test.

I also changed the following because I don't think it is right:

```
    There is also a natural projection to the usual symmetric functions by
    letting the variables commute. This projection does *not* preserve the
    product nor coproduct stucture, but instead is just a module morphism.
```
I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.



---

archive/issue_comments_186400.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI added a few doc tests that hopefully clarifies the purpose of `from_symmetric_function`.",
    "created_at": "2013-10-28T15:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186400",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:71" align="right">comment:71</div>

I added a few doc tests that hopefully clarifies the purpose of `from_symmetric_function`.



---

archive/issue_comments_186401.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI believe that there is missing documentation due to #9107 (e.g. any methods in `monomial.Element`).  This version includes some minor doc changes.",
    "created_at": "2013-10-29T00:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186401",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:72" align="right">comment:72</div>

I believe that there is missing documentation due to #9107 (e.g. any methods in `monomial.Element`).  This version includes some minor doc changes.



---

archive/issue_comments_186402.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@zabrocki](#comment:70):\n> I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.\n\nIf it doesn't preserve the Hopf structure, we can't have it be a coercion (including the **w** basis to the homogeneous sym funcs). Instead we have to make them all conversions. I'll also add in the natural conversions (ex. the **p** basis to the powersum sym funcs) on the next update.\n\nBest,\n\nTravis",
    "created_at": "2013-10-29T05:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186402",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@zabrocki](#comment:70):
> I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.

If it doesn't preserve the Hopf structure, we can't have it be a coercion (including the **w** basis to the homogeneous sym funcs). Instead we have to make them all conversions. I'll also add in the natural conversions (ex. the **p** basis to the powersum sym funcs) on the next update.

Best,

Travis



---

archive/issue_comments_186403.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\n`from_symmetric_function` is already not a coercion.  It is just a method.  Are you saying that you don't want to make the map from Sym -> NCSym<sup>*</sup> a coercion?  It preserves the Hopf structure.\n\nFor NSym/QSym I believe we have the following:\n* NSym -> Sym is a method `to_symmetric_function`\n* Sym -> QSym is a coercion and can be accessed by `B( sfelement )` where `B` is a basis of QSym\n* QSym -> Sym under the condition that the element in QSym `is_symmetric` by `qsymelement.to_symmetric_function()` or (and this is not preferred) `m( qsymelement )`\n\nAll of these maps preserve the Hopf algebra structure.  Similarly for NCSym/NCSym<sup>*</sup> we have\n* NCSym -> Sym is a method `to_symmetric_function`\n* Sym -> NCSym<sup>*</sup> is a coercion and can be accessed by `w( sfelement )`\n* NCSym<sup>*</sup> -> Sym under the condition that the element in NCSym<sup>*</sup> `is_symmetric` by `ncsymdelement.to_symmetric_function()` or (and this is not preferred) `h( ncsymdelement )`\n\nThe maps NCSym -> Sym and NSym -> Sym are not coercions since these maps are projections and hence not invertible.  The inclusions of Sym -> NCSym<sup>*</sup> and Sym -> QSym have an inverse (one sided) and so I think that they can be coercions.  I am not too concerned that `p( ncsymdelement )` doesn't work.  The reason the portal through the `h` basis works is because of the connection with the **w** basis.",
    "created_at": "2013-10-29T12:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186403",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:74" align="right">comment:74</div>

`from_symmetric_function` is already not a coercion.  It is just a method.  Are you saying that you don't want to make the map from Sym -> NCSym<sup>*</sup> a coercion?  It preserves the Hopf structure.

For NSym/QSym I believe we have the following:
* NSym -> Sym is a method `to_symmetric_function`
* Sym -> QSym is a coercion and can be accessed by `B( sfelement )` where `B` is a basis of QSym
* QSym -> Sym under the condition that the element in QSym `is_symmetric` by `qsymelement.to_symmetric_function()` or (and this is not preferred) `m( qsymelement )`

All of these maps preserve the Hopf algebra structure.  Similarly for NCSym/NCSym<sup>*</sup> we have
* NCSym -> Sym is a method `to_symmetric_function`
* Sym -> NCSym<sup>*</sup> is a coercion and can be accessed by `w( sfelement )`
* NCSym<sup>*</sup> -> Sym under the condition that the element in NCSym<sup>*</sup> `is_symmetric` by `ncsymdelement.to_symmetric_function()` or (and this is not preferred) `h( ncsymdelement )`

The maps NCSym -> Sym and NSym -> Sym are not coercions since these maps are projections and hence not invertible.  The inclusions of Sym -> NCSym<sup>*</sup> and Sym -> QSym have an inverse (one sided) and so I think that they can be coercions.  I am not too concerned that `p( ncsymdelement )` doesn't work.  The reason the portal through the `h` basis works is because of the connection with the **w** basis.



---

archive/issue_comments_186404.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nAh, sorry, I confused myself.\n\nHowever I coercions do not have to be invertible (ex. `ZZ -> QQ`), just are well-defined, preserve the structure, and make commutative diagrams. I think they typically are injections, but this is not a requirement.\n\nThe `QSym -> Sym` can't be a coercion because it is not well-defined (on all elements). Since `NCSym -> Sym` and `NSym -> Sym` preserve the Hopf structure and are well-defined. I don't think there's any danger of breaking coercion commutativity. So I think we should make these coercions. Your thoughts?",
    "created_at": "2013-10-29T17:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186404",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:75" align="right">comment:75</div>

Ah, sorry, I confused myself.

However I coercions do not have to be invertible (ex. `ZZ -> QQ`), just are well-defined, preserve the structure, and make commutative diagrams. I think they typically are injections, but this is not a requirement.

The `QSym -> Sym` can't be a coercion because it is not well-defined (on all elements). Since `NCSym -> Sym` and `NSym -> Sym` preserve the Hopf structure and are well-defined. I don't think there's any danger of breaking coercion commutativity. So I think we should make these coercions. Your thoughts?



---

archive/issue_comments_186405.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI am not comfortable making `NCSym` and `NSym -> Sym` coercions because when I say that they preserve the Hopf structure I mean that the Hopf structure of `NCSym` is mapped onto the Hopf structure of `Sym` but `NCSym` does not exist as a Hopf subalgebra of `Sym`.  For `Sym -> QSym` it is the case that `Sym` exists as a subalgebra of `QSym`.\n\nThat is, let phi : NCSym -> Sym\nthen sometimes we have,\nF != G\nbut \nphi(F) = phi(G) (e.g. F = A*B, G =B*A)\n\nThat is, \"equalities go to equalities, but sometimes inequalities also go to equalities.\" (to my eye, not something I want as a coercion).  This isn't a hard fast rule, but it seems counter-intuitive to be able to coerce from NCSym to Sym rather than use the method `to_symmetric_function` to project onto that space.\n\nFor psi: Sym -> NCSym<sup>*</sup> we have psi(F)=psi(G) iff F=G, that is, \"equalities going to equalities and inequalities going to inequalities\"",
    "created_at": "2013-10-29T18:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186405",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:76" align="right">comment:76</div>

I am not comfortable making `NCSym` and `NSym -> Sym` coercions because when I say that they preserve the Hopf structure I mean that the Hopf structure of `NCSym` is mapped onto the Hopf structure of `Sym` but `NCSym` does not exist as a Hopf subalgebra of `Sym`.  For `Sym -> QSym` it is the case that `Sym` exists as a subalgebra of `QSym`.

That is, let phi : NCSym -> Sym
then sometimes we have,
F != G
but 
phi(F) = phi(G) (e.g. F = A*B, G =B*A)

That is, "equalities go to equalities, but sometimes inequalities also go to equalities." (to my eye, not something I want as a coercion).  This isn't a hard fast rule, but it seems counter-intuitive to be able to coerce from NCSym to Sym rather than use the method `to_symmetric_function` to project onto that space.

For psi: Sym -> NCSym<sup>*</sup> we have psi(F)=psi(G) iff F=G, that is, "equalities going to equalities and inequalities going to inequalities"



---

archive/issue_comments_186406.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nSince it's consistent with `NSym`, I'm fine with `NCSym -> Sym` not being a coercion. So what else needs to be done?",
    "created_at": "2013-10-29T19:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186406",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:77" align="right">comment:77</div>

Since it's consistent with `NSym`, I'm fine with `NCSym -> Sym` not being a coercion. So what else needs to be done?



---

archive/issue_comments_186407.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nI want to be completely convinced everything works properly and haven't missed any details in the documentation.  Give me another day or two to find minor tweaks.  Otherwise I am extremely happy with it.  Nantel asked just today to use it to compute `m_A(x_0,x_1,...,x_n)` and I sent him installation instructions.",
    "created_at": "2013-10-29T20:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186407",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:78" align="right">comment:78</div>

I want to be completely convinced everything works properly and haven't missed any details in the documentation.  Give me another day or two to find minor tweaks.  Otherwise I am extremely happy with it.  Nantel asked just today to use it to compute `m_A(x_0,x_1,...,x_n)` and I sent him installation instructions.



---

archive/issue_comments_186408.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\ncurrent version moves `counit_on_basis` to `NCSymOrNCSymDualBases` parent methods and implements `antipode_on_basis` in the **w** parent methods",
    "created_at": "2013-10-30T03:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186408",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:79" align="right">comment:79</div>

current version moves `counit_on_basis` to `NCSymOrNCSymDualBases` parent methods and implements `antipode_on_basis` in the **w** parent methods



---

archive/issue_comments_186409.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nCan you check if `antipode_on_basis` should be a cached method?  I didn't do that, but it computes the antipode using the definition and it is a rather recursive formula.",
    "created_at": "2013-10-30T03:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186409",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:80" align="right">comment:80</div>

Can you check if `antipode_on_basis` should be a cached method?  I didn't do that, but it computes the antipode using the definition and it is a rather recursive formula.



---

archive/issue_comments_186410.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nAttachment: **[trac_15150-docchanges-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-docchanges-mz.patch.gz)**\n\nMy tests on the antipode seems to run pretty fast without caching, but please take a look.  I just added a new version with some minor doc corrections.",
    "created_at": "2013-10-30T03:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186410",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:81" align="right">comment:81</div>

Attachment: **[trac_15150-docchanges-mz.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-docchanges-mz.patch.gz)**

My tests on the antipode seems to run pretty fast without caching, but please take a look.  I just added a new version with some minor doc corrections.



---

archive/issue_comments_186411.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nAll tests pass, and documentation looks good. please look over my last version of the patch, fold it with yours, make any last changes, and you have my blessing on a positive review.  Nice work!",
    "created_at": "2013-10-30T04:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186411",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:82" align="right">comment:82</div>

All tests pass, and documentation looks good. please look over my last version of the patch, fold it with yours, make any last changes, and you have my blessing on a positive review.  Nice work!



---

archive/issue_comments_186412.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nA couple of things left to change in the version you posted.  Search on *SEEALSO* because it seems to be duplicated in three places.  Also I think that occurrences of `\\kappa \\circ \\chi` should be `\\chi \\circ \\kappa`.",
    "created_at": "2013-10-31T00:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186412",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:83" align="right">comment:83</div>

A couple of things left to change in the version you posted.  Search on *SEEALSO* because it seems to be duplicated in three places.  Also I think that occurrences of `\kappa \circ \chi` should be `\chi \circ \kappa`.



---

archive/issue_comments_186413.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nGood catch; merge issue. Fixed and same with the map composition order.\n\nSince #10963 is finished (yay), I've added it as a dependency since it seems to affect the output of one of the doctests in `bases.py`. Mike, could you double-check to make sure the tests still pass for you? Thanks. And thanks Darij for fixing up the docstrings along the way.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-31T05:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186413",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:84" align="right">comment:84</div>

Good catch; merge issue. Fixed and same with the map composition order.

Since #10963 is finished (yay), I've added it as a dependency since it seems to affect the output of one of the doctests in `bases.py`. Mike, could you double-check to make sure the tests still pass for you? Thanks. And thanks Darij for fixing up the docstrings along the way.

Best,

Travis

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_186414.json:
```json
{
    "body": "Reviewer: **Mike Zabrocki, Darij Grinberg**",
    "created_at": "2013-10-31T05:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186414",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Mike Zabrocki, Darij Grinberg**



---

archive/issue_comments_186415.json:
```json
{
    "body": "Changed dependencies from **#15143, #15164** to **#15143, #15164, #10963**",
    "created_at": "2013-10-31T05:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186415",
    "user": "https://github.com/tscrim"
}
```

Changed dependencies from **#15143, #15164** to **#15143, #15164, #10963**



---

archive/issue_comments_186416.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nOkay, now everything should be squared away wrt the dep on #10963.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-31T05:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186416",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:85" align="right">comment:85</div>

Okay, now everything should be squared away wrt the dep on #10963.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_events_216184.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-11-07T02:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216184"
}
```



---

archive/issue_events_216185.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-11-07T02:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216185"
}
```



---

archive/issue_comments_186417.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nI used sage cloud and git to test this patch.  All tests pass (even with #10963 applied).  I think that we can be confident that once it has a positive review, that this will pass as well.",
    "created_at": "2013-11-07T02:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186417",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:86" align="right">comment:86</div>

I used sage cloud and git to test this patch.  All tests pass (even with #10963 applied).  I think that we can be confident that once it has a positive review, that this will pass as well.



---

archive/issue_events_216186.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-07T07:22:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216186"
}
```



---

archive/issue_events_216187.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-07T07:22:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216187"
}
```



---

archive/issue_comments_186418.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nyay milestone tug of war!\n\nIs there an easy way to commute this past #10963 or will that make code slower/buggier/whatever?",
    "created_at": "2013-11-07T07:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186418",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:88" align="right">comment:88</div>

yay milestone tug of war!

Is there an easy way to commute this past #10963 or will that make code slower/buggier/whatever?



---

archive/issue_comments_186419.json:
```json
{
    "body": "Attachment: **[trac_15150-ncsym-ts.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-ncsym-ts.patch.gz)**\n\nwith fixes",
    "created_at": "2013-12-10T16:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186419",
    "user": "https://github.com/tscrim"
}
```

Attachment: **[trac_15150-ncsym-ts.patch.gz](https://github.com/sagemath/sage/files/ticket15150/trac_15150-ncsym-ts.patch.gz)**

with fixes



---

archive/issue_comments_186420.json:
```json
{
    "body": "Changed dependencies from **#15143, #15164, #10963** to **#15143, #15164**",
    "created_at": "2013-12-10T16:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186420",
    "user": "https://github.com/tscrim"
}
```

Changed dependencies from **#15143, #15164, #10963** to **#15143, #15164**



---

archive/issue_events_216188.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-10T16:38:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216188"
}
```



---

archive/issue_events_216189.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-10T16:38:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216189"
}
```



---

archive/issue_comments_186421.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nSince #10963 is getting pushed back, I've changed the one doctest output to move this past.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-12-10T16:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186421",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:89" align="right">comment:89</div>

Since #10963 is getting pushed back, I've changed the one doctest output to move this past.

For patchbot:

Apply: trac_15150-ncsym-ts.patchâ€‹



---

archive/issue_comments_186422.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nI cannot promise this will be merged in Sage 5.13 though. Did you test this well, that will increase the chances?",
    "created_at": "2013-12-10T17:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186422",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">comment:90</div>

I cannot promise this will be merged in Sage 5.13 though. Did you test this well, that will increase the chances?



---

archive/issue_comments_186423.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nAll tests on the file passed for me on `5.13.beta2`, and once `5.13.beta5` is done compiling, I'll check on that as well.",
    "created_at": "2013-12-10T19:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186423",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:91" align="right">comment:91</div>

All tests on the file passed for me on `5.13.beta2`, and once `5.13.beta5` is done compiling, I'll check on that as well.



---

archive/issue_comments_186424.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nWorks for me on `5.13.beta5`:\n\n```\nsage -t --long bases.py\n    [148 tests, 14.09 s]\nsage -t --long dual.py\n    [74 tests, 6.73 s]\nsage -t --long ncsym.py\n    [197 tests, 26.14 s]\nsage -t --long set_partition.py\n    [266 tests, 45.62 s]\nsage -t --long ncsf.py\n    [381 tests, 15.40 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\nAnd the pdf documentation builds cleanly:\n\n```\nTranscript written on combinat.log.\nBuild finished.  The built documents can be found in /home/travis/sage-5.13.beta5/devel/sage/doc/output/pdf/en/reference/combinat\n```",
    "created_at": "2013-12-11T06:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186424",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:92" align="right">comment:92</div>

Works for me on `5.13.beta5`:

```
sage -t --long bases.py
    [148 tests, 14.09 s]
sage -t --long dual.py
    [74 tests, 6.73 s]
sage -t --long ncsym.py
    [197 tests, 26.14 s]
sage -t --long set_partition.py
    [266 tests, 45.62 s]
sage -t --long ncsf.py
    [381 tests, 15.40 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```
And the pdf documentation builds cleanly:

```
Transcript written on combinat.log.
Build finished.  The built documents can be found in /home/travis/sage-5.13.beta5/devel/sage/doc/output/pdf/en/reference/combinat
```



---

archive/issue_comments_186425.json:
```json
{
    "body": "Merged: **sage-5.13.rc0**",
    "created_at": "2013-12-11T11:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15150#issuecomment-186425",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.rc0**



---

archive/issue_events_216190.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216190"
}
```



---

archive/issue_events_216191.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15150",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15150#event-216191"
}
```
