# Issue 15392: Implement minimal model algorithm

archive/issues_015155.json:
```json
{
    "body": "Bruin-Molnar published an algorithm to compute the minimal model of a morphism on P1, \"Minimal models for rational functions in a dynamical setting\".\n\nTranslate their algorithm and code to work with the existing dynamical framework\n\nApply:\n\n* [attachment:trac_15392_minimal_model.patch]\n\nAssignee: @bhutz\n\nKeywords: sage-days55\n\nReviewer: Nils Bruin\n\nAuthor: Ben Hutz\n\nMerged: sage-5.13.rc0\n\nDependencies: #14219\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15392\n\n",
    "closed_at": "2013-12-10T08:38:51Z",
    "created_at": "2013-11-10T00:58:47Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Implement minimal model algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15392",
    "user": "https://github.com/bhutz"
}
```
Bruin-Molnar published an algorithm to compute the minimal model of a morphism on P1, "Minimal models for rational functions in a dynamical setting".

Translate their algorithm and code to work with the existing dynamical framework

Apply:

* [attachment:trac_15392_minimal_model.patch]

Assignee: @bhutz

Keywords: sage-days55

Reviewer: Nils Bruin

Author: Ben Hutz

Merged: sage-5.13.rc0

Dependencies: #14219

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15392





---

archive/issue_comments_194299.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebraic geometry.",
    "created_at": "2013-11-10T01:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194299",
    "user": "https://github.com/bhutz"
}
```

Changing component from PLEASE CHANGE to algebraic geometry.



---

archive/issue_comments_194300.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-11T17:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194300",
    "user": "https://github.com/bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194301.json:
```json
{
    "body": "<a id='comment:2'></a>Working with Brian Stout we've translated Alexander Molnar's minimal model algorithm/code to work within Sage. A few minors changes from his original work, but the algorithm remains unchanged.",
    "created_at": "2013-11-11T17:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194301",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:2'></a>Working with Brian Stout we've translated Alexander Molnar's minimal model algorithm/code to work within Sage. A few minors changes from his original work, but the algorithm remains unchanged.



---

archive/issue_comments_194302.json:
```json
{
    "body": "<a id='comment:3'></a>forgot to include the GPL in the new file the first time\n\nBrian - can you please add yourself to authors.",
    "created_at": "2013-11-11T18:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194302",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:3'></a>forgot to include the GPL in the new file the first time

Brian - can you please add yourself to authors.



---

archive/issue_comments_194303.json:
```json
{
    "body": "<a id='comment:4'></a>Hello,\n\nIt is very good that the code is documented and contains references! But there are several problem with the documentation (see [sage developer guide](http://sagemath.github.io/git-developer-guide/coding_basics.html#documentation-strings)).\n\n1) there are trailing whitespaces\n\n2) the indentation is not good. The blocks INPUT, EXAMPLES must have the same identation as the documentation and you must have a blankline between the block name EXAMPLES and its content (for example lines 201-202 are wrong).\n\n```\ndef my_function(arg1, arg2):\n    \"\"\"\n    This is a nice function\n\n    INPUT:\n\n    - ``arg1`` - a first nice argument\n\n    - ``arg2`` - an other nice argument\n\n    EXAMPLES::\n\n        sage: my_function(8,3)\n \n    We can also use the function with strings::\n\n        sage: my_function('toto', 'bibi')\n    \"\"\"\n```\n\n3) Bibliography is not set up properly\n\n4) In the examples (at least) respect the convention \"my_variable = f()\" and do not use \"my_variable=f()\". If possible, try to be coherent in function arguments and prefer \"def f(a, b=3, c=4)\" to \"def f(a,b = 3, c=4)\".\n\n5) For the name I guess \"is_affine_minimal\" is more suited than \"affine_minimal\".",
    "created_at": "2013-11-12T01:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194303",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>Hello,

It is very good that the code is documented and contains references! But there are several problem with the documentation (see [sage developer guide](http://sagemath.github.io/git-developer-guide/coding_basics.html#documentation-strings)).

1) there are trailing whitespaces

2) the indentation is not good. The blocks INPUT, EXAMPLES must have the same identation as the documentation and you must have a blankline between the block name EXAMPLES and its content (for example lines 201-202 are wrong).

```
def my_function(arg1, arg2):
    """
    This is a nice function

    INPUT:

    - ``arg1`` - a first nice argument

    - ``arg2`` - an other nice argument

    EXAMPLES::

        sage: my_function(8,3)
 
    We can also use the function with strings::

        sage: my_function('toto', 'bibi')
    """
```

3) Bibliography is not set up properly

4) In the examples (at least) respect the convention "my_variable = f()" and do not use "my_variable=f()". If possible, try to be coherent in function arguments and prefer "def f(a, b=3, c=4)" to "def f(a,b = 3, c=4)".

5) For the name I guess "is_affine_minimal" is more suited than "affine_minimal".



---

archive/issue_comments_194304.json:
```json
{
    "body": "<a id='comment:5'></a>Yes, 1,2,4 are all simple changes that need to be made.  3 was waiting to add an additional citation (which I have now) and will be fixed as well.\n\n5 I disagree with. The minimalmodel.py file is not exposed to the user, so neither is affine_minimal. The two functions exposed to the user are\n\nis_minimal_model() and minimal_model()\n\nPart of the original citation is that it is enough for minimal to check affine minimal, so those names should be fine.",
    "created_at": "2013-11-12T01:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194304",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'></a>Yes, 1,2,4 are all simple changes that need to be made.  3 was waiting to add an additional citation (which I have now) and will be fixed as well.

5 I disagree with. The minimalmodel.py file is not exposed to the user, so neither is affine_minimal. The two functions exposed to the user are

is_minimal_model() and minimal_model()

Part of the original citation is that it is enough for minimal to check affine minimal, so those names should be fine.



---

archive/issue_comments_194305.json:
```json
{
    "body": "<a id='comment:6'></a>Some comments from Alex Molnar:\n\nI ... have finally looked through the code. I only glossed the parts that appear unchanged (with the original code side-by-side) and otherwise think the adaptation to projective morphisms looks good.\n\nJust two minor comments. In line 206, I think you mean ``vp`` to ``newvp``, and in line 1453 ``self`` is written ``sefl``.\n\n---\nI've updated the patch to make those minor corrections.",
    "created_at": "2013-11-29T14:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194305",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:6'></a>Some comments from Alex Molnar:

I ... have finally looked through the code. I only glossed the parts that appear unchanged (with the original code side-by-side) and otherwise think the adaptation to projective morphisms looks good.

Just two minor comments. In line 206, I think you mean ``vp`` to ``newvp``, and in line 1453 ``self`` is written ``sefl``.

---
I've updated the patch to make those minor corrections.



---

archive/issue_comments_194306.json:
```json
{
    "body": "<a id='comment:7'></a>I'm just parking some test code here for my own use:\n\n```\nimport urllib\n\nQx.<x>=QQ[]\ndef interpolate(c,n):\n   M=matrix([[c[i]^k for k in range(n+1)]+[-c[i+1]*c[i]^k for k in range(n+1)] for i in range(len(c)-1)])\n   v=list(M.right_kernel().basis()[0])\n   return Qx(v[:n+1])/Qx(v[n+1:])\n   \nV=[eval(c) for c in urllib.urlopen(\"http://www.cecm.sfu.ca/~nbruin/intorbits/deg2.txt\")]\n\nP1.<X,Y>=ProjectiveSpace(QQ,1)\ndef proj_map(f):\n    phi=f(X/Y)\n    return End(P1)([phi.numerator(),phi.denominator()])\n    \n[proj_map(interpolate(c,2)((x+1)/(x-1))).is_minimal_model() for c in V[:50]]\n```\nI'm noticing it's awfully slow! I think I tried a similar thing with the magma version and that was quite quick. Initial impression is that this is just a sage problem:\n\n```\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n      110    0.033    0.000    0.073    0.001 minimal_model.py:41(bCheck)\n1847/1843    0.026    0.000    0.031    0.000 polynomial_ring.py:299(_element_constructor_)\n    26/22    0.022    0.001    0.062    0.003 minimal_model.py:122(blift)\n      264    0.015    0.000    0.020    0.000 {method 'subs' of 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' objects}\n     2097    0.011    0.000    0.015    0.000 {method 'sub' of '_sre.SRE_Pattern' objects}\n      943    0.010    0.000    0.033    0.000 polynomial_ring_constructor.py:60(PolynomialRing)\n        3    0.008    0.003    0.169    0.056 minimal_model.py:302(Min)\n    19104    0.006    0.000    0.006    0.000 {isinstance}\n     2157    0.004    0.000    0.005    0.000 re.py:226(_compile)\n```\nso it looks like just constructing the polynomials is an expensive proposition already. `bCheck` does take quite a bit of time by itself too, so there may be some algorithmic issues too. Perhaps we don't care about performance at this point?\n\n(Ah, I see: there are lots of polynomial rings constructed *inside* functions. That shouldn't happen)\n\nSome possible packaging problems:\n- I think the file name `sage/schemes/projective/minimal_model.py` will cause problems later on: there are all kinds of projective schemes that have their own concept of minimality, so I think it should be `endP1_minimal_model` or something more appetizing.\n- `phi.is_minimal_model` reads a little strange: `phi` is supposed to be an endomorphism on a `P1` (with coordinate choice, i.e., with `0,1,infty` marked), not a model of one. Would is_PGL_minimal be better (or perhaps is_minimal)?",
    "created_at": "2013-11-29T22:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194306",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>I'm just parking some test code here for my own use:

```
import urllib

Qx.<x>=QQ[]
def interpolate(c,n):
   M=matrix([[c[i]^k for k in range(n+1)]+[-c[i+1]*c[i]^k for k in range(n+1)] for i in range(len(c)-1)])
   v=list(M.right_kernel().basis()[0])
   return Qx(v[:n+1])/Qx(v[n+1:])
   
V=[eval(c) for c in urllib.urlopen("http://www.cecm.sfu.ca/~nbruin/intorbits/deg2.txt")]

P1.<X,Y>=ProjectiveSpace(QQ,1)
def proj_map(f):
    phi=f(X/Y)
    return End(P1)([phi.numerator(),phi.denominator()])
    
[proj_map(interpolate(c,2)((x+1)/(x-1))).is_minimal_model() for c in V[:50]]
```
I'm noticing it's awfully slow! I think I tried a similar thing with the magma version and that was quite quick. Initial impression is that this is just a sage problem:

```
   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
      110    0.033    0.000    0.073    0.001 minimal_model.py:41(bCheck)
1847/1843    0.026    0.000    0.031    0.000 polynomial_ring.py:299(_element_constructor_)
    26/22    0.022    0.001    0.062    0.003 minimal_model.py:122(blift)
      264    0.015    0.000    0.020    0.000 {method 'subs' of 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' objects}
     2097    0.011    0.000    0.015    0.000 {method 'sub' of '_sre.SRE_Pattern' objects}
      943    0.010    0.000    0.033    0.000 polynomial_ring_constructor.py:60(PolynomialRing)
        3    0.008    0.003    0.169    0.056 minimal_model.py:302(Min)
    19104    0.006    0.000    0.006    0.000 {isinstance}
     2157    0.004    0.000    0.005    0.000 re.py:226(_compile)
```
so it looks like just constructing the polynomials is an expensive proposition already. `bCheck` does take quite a bit of time by itself too, so there may be some algorithmic issues too. Perhaps we don't care about performance at this point?

(Ah, I see: there are lots of polynomial rings constructed *inside* functions. That shouldn't happen)

Some possible packaging problems:
- I think the file name `sage/schemes/projective/minimal_model.py` will cause problems later on: there are all kinds of projective schemes that have their own concept of minimality, so I think it should be `endP1_minimal_model` or something more appetizing.
- `phi.is_minimal_model` reads a little strange: `phi` is supposed to be an endomorphism on a `P1` (with coordinate choice, i.e., with `0,1,infty` marked), not a model of one. Would is_PGL_minimal be better (or perhaps is_minimal)?



---

archive/issue_comments_194307.json:
```json
{
    "body": "Attachment [trac15392_referee.patch](tarball://root/attachments/some-uuid/ticket15392/trac15392_referee.patch) by @nbruin created at 2013-12-01 04:05:58\n\nSome suggested improvements",
    "created_at": "2013-12-01T04:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194307",
    "user": "https://github.com/nbruin"
}
```

Attachment [trac15392_referee.patch](tarball://root/attachments/some-uuid/ticket15392/trac15392_referee.patch) by @nbruin created at 2013-12-01 04:05:58

Some suggested improvements



---

archive/issue_comments_194308.json:
```json
{
    "body": "<a id='comment:8'></a>I've attached a \"patch\" with some suggested improvements. With that version, I was able to check the minimality of `[eval(c) for c in urllib.urlopen(\"http://www.cecm.sfu.ca/~nbruin/intorbits/deg2.txt\")]` within a minute (that's a little over 2000 quadratic maps). I'm sure the code could be optimized further, but why bother now? I don't think the current code is doing anything outright silly any more and running `%prun` on some examples produces for me a profile I can believe (most time is spent in the recursive `blift`, which is what one would expect).\n\nThere's still the naming of the file and of the routines to be considered.\n\nThe code itself seems fine. I've run it by giving it (known) minimal maps from the tables referred to above, conjugating by random transformations, and seeing if the minimal model returned has the same resultant (up to sign) as the original, and I didn't find problems.\n\n(I noticed there's a doctest failing for `blift` now, but that's because the test puts an integer in the input list where there should be polynomials. I propose the doctest gets amended, since the internal use of `blift` guarantees that the input consists of a list of polynomials.)",
    "created_at": "2013-12-01T04:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194308",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'></a>I've attached a "patch" with some suggested improvements. With that version, I was able to check the minimality of `[eval(c) for c in urllib.urlopen("http://www.cecm.sfu.ca/~nbruin/intorbits/deg2.txt")]` within a minute (that's a little over 2000 quadratic maps). I'm sure the code could be optimized further, but why bother now? I don't think the current code is doing anything outright silly any more and running `%prun` on some examples produces for me a profile I can believe (most time is spent in the recursive `blift`, which is what one would expect).

There's still the naming of the file and of the routines to be considered.

The code itself seems fine. I've run it by giving it (known) minimal maps from the tables referred to above, conjugating by random transformations, and seeing if the minimal model returned has the same resultant (up to sign) as the original, and I didn't find problems.

(I noticed there's a doctest failing for `blift` now, but that's because the test puts an integer in the input list where there should be polynomials. I propose the doctest gets amended, since the internal use of `blift` guarantees that the input consists of a list of polynomials.)



---

archive/issue_comments_194309.json:
```json
{
    "body": "<a id='comment:9'></a>Those changes look good.\n\nI have thought about the naming and see your point on the file name. Although, I'm inclined to be optimistic for the future and call it `endPN_minimal_model`. This will also allow consistent naming for other algorithms for endomorphisms of PN.\n\nI'm also happy to call the function `is_PGL_minimal`.\n\nYes. we should just update the doctest as well as we made our best guess as to what a reasonable test was for the individual functions.\n\nI can fold the patches together and make these changes unless you want to use your `referee` patch to do them?",
    "created_at": "2013-12-01T15:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194309",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:9'></a>Those changes look good.

I have thought about the naming and see your point on the file name. Although, I'm inclined to be optimistic for the future and call it `endPN_minimal_model`. This will also allow consistent naming for other algorithms for endomorphisms of PN.

I'm also happy to call the function `is_PGL_minimal`.

Yes. we should just update the doctest as well as we made our best guess as to what a reasonable test was for the individual functions.

I can fold the patches together and make these changes unless you want to use your `referee` patch to do them?



---

archive/issue_comments_194310.json:
```json
{
    "body": "<a id='comment:10'></a>I went to fold this together and make the other changes, but your patch doesn't apply on my system. Could you double check your patch?\n\nI'm still using 5.12, but it shouldn't matter since these are all changing the new `minimal_model.py` anyway.",
    "created_at": "2013-12-01T22:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194310",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:10'></a>I went to fold this together and make the other changes, but your patch doesn't apply on my system. Could you double check your patch?

I'm still using 5.12, but it shouldn't matter since these are all changing the new `minimal_model.py` anyway.



---

archive/issue_comments_194311.json:
```json
{
    "body": "Attachment [minimal_model.py](tarball://root/attachments/some-uuid/ticket15392/minimal_model.py) by @nbruin created at 2013-12-02 00:25:19\n\nattached file (due to failing patches)",
    "created_at": "2013-12-02T00:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194311",
    "user": "https://github.com/nbruin"
}
```

Attachment [minimal_model.py](tarball://root/attachments/some-uuid/ticket15392/minimal_model.py) by @nbruin created at 2013-12-02 00:25:19

attached file (due to failing patches)



---

archive/issue_comments_194312.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 bhutz]:\n> I'm still using 5.12, but it shouldn't matter since these are all changing the new `minimal_model.py` anyway.\n\nOK, back to basics then. You may be aware that sage is in the middle of changing the source control system. I'm working on the git version and have no idea how to get a HG patch out of it (importing hg patches doesn't seem to be a problem) Attached is the file that resulted from my editing. You should be able to get out of that whatever you want by just replacing the file and let your source control system of choice figure out what the changes are.",
    "created_at": "2013-12-02T00:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194312",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'></a>Replying to [comment:10 bhutz]:
> I'm still using 5.12, but it shouldn't matter since these are all changing the new `minimal_model.py` anyway.

OK, back to basics then. You may be aware that sage is in the middle of changing the source control system. I'm working on the git version and have no idea how to get a HG patch out of it (importing hg patches doesn't seem to be a problem) Attached is the file that resulted from my editing. You should be able to get out of that whatever you want by just replacing the file and let your source control system of choice figure out what the changes are.



---

archive/issue_comments_194313.json:
```json
{
    "body": "<a id='comment:12'></a>Yes, that would certainly do it. In the near future I'll be switching over to git, I just haven't done it yet.\n\nNew patch attached with your changes, the names changes, and the doctest fixed.\n\napply trac_15392_minimal_model.patch\u200b",
    "created_at": "2013-12-02T00:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194313",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:12'></a>Yes, that would certainly do it. In the near future I'll be switching over to git, I just haven't done it yet.

New patch attached with your changes, the names changes, and the doctest fixed.

apply trac_15392_minimal_model.patch​



---

archive/issue_comments_194314.json:
```json
{
    "body": "<a id='comment:13'></a>apply trac_15392_minimal_model.patch\u200b",
    "created_at": "2013-12-02T00:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194314",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>apply trac_15392_minimal_model.patch​



---

archive/issue_comments_194315.json:
```json
{
    "body": "<a id='comment:14'></a>Looks good to me. Incidentally, the name `is_PGL_minimal` might not be the best name. It's certainly descriptive, but the spelling is perhaps a little painful relative to the rest of sage?\n\nSome very small points:\n\nThe fact that\n\n```\nsage: phi.minimal_model().resultant()\n```\ndoesn't work seems a little strange. Shouldn't it be `return_conjugation=False` by default, so that the default returns a value that can be immediately used rather than needing unpacking? Also, wouldn't `return_transformation` be a better name? \n\nCertainly in the doctest:\n\n```\n     sage: f.minimal_model(False)\n```\nshould refer to the keyword argument by keyword, i.e.,\n\n```\n     sage: f.minimal_model(return_transformation=False)\n```\nA \"positional\" false is rather unclear here, even though it works.\n\nFinally (and this is for another ticket): If we're \"minimizing\" rational transformations, shouldn't we also be \"reducing\" them, i.e., compute an SL(2,Z) transformation that makes the coefficients small? The most simple approach would be to \"reduce\" the binary form describing the fixed points or (if that's too degenerate) the points of period n for some small n.\n\nSee [Stoll, Michael; Cremona, John E., On the reduction theory of binary forms. J. Reine Angew. Math. 565 (2003), 79\u201399.], which is fairly easy to implement and which would be useful to have in sage anyway.",
    "created_at": "2013-12-04T01:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194315",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:14'></a>Looks good to me. Incidentally, the name `is_PGL_minimal` might not be the best name. It's certainly descriptive, but the spelling is perhaps a little painful relative to the rest of sage?

Some very small points:

The fact that

```
sage: phi.minimal_model().resultant()
```
doesn't work seems a little strange. Shouldn't it be `return_conjugation=False` by default, so that the default returns a value that can be immediately used rather than needing unpacking? Also, wouldn't `return_transformation` be a better name? 

Certainly in the doctest:

```
     sage: f.minimal_model(False)
```
should refer to the keyword argument by keyword, i.e.,

```
     sage: f.minimal_model(return_transformation=False)
```
A "positional" false is rather unclear here, even though it works.

Finally (and this is for another ticket): If we're "minimizing" rational transformations, shouldn't we also be "reducing" them, i.e., compute an SL(2,Z) transformation that makes the coefficients small? The most simple approach would be to "reduce" the binary form describing the fixed points or (if that's too degenerate) the points of period n for some small n.

See [Stoll, Michael; Cremona, John E., On the reduction theory of binary forms. J. Reine Angew. Math. 565 (2003), 79–99.], which is fairly easy to implement and which would be useful to have in sage anyway.



---

archive/issue_comments_194316.json:
```json
{
    "body": "<a id='comment:15'></a>Having the default be False is fine and is now changed.\n\nI do have the two optional parameters as positional that is why it is positional in the doctest. It sounds like you think this should be `**kwds` instead of positional. I could change it and don't have a strong opinion either way, but have not done so at this point.\n\nYes, getting the reduced form would be nice and I'll add it to the dynamics todo list on the wiki.",
    "created_at": "2013-12-04T16:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194316",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:15'></a>Having the default be False is fine and is now changed.

I do have the two optional parameters as positional that is why it is positional in the doctest. It sounds like you think this should be `**kwds` instead of positional. I could change it and don't have a strong opinion either way, but have not done so at this point.

Yes, getting the reduced form would be nice and I'll add it to the dynamics todo list on the wiki.



---

archive/issue_comments_194317.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 bhutz]:\n> I do have the two optional parameters as positional that is why it is positional in the doctest.\n\n\nNo, in Python, *all* named arguments can be addressed via keyword. So I wasn't suggesting changing the code, only using the doctest to encourage addressing this option by key. If you prefer, you can still address it by position in your own code. It's just that\n\n```\nphi.minimal_model(True)\n```\nisn't very self-documenting.\n\nI think the patch update didn't quite work. Do you want to stick with `return_conjugation` rather than `return_transformation`?",
    "created_at": "2013-12-04T19:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194317",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:16'></a>Replying to [comment:15 bhutz]:
> I do have the two optional parameters as positional that is why it is positional in the doctest.


No, in Python, *all* named arguments can be addressed via keyword. So I wasn't suggesting changing the code, only using the doctest to encourage addressing this option by key. If you prefer, you can still address it by position in your own code. It's just that

```
phi.minimal_model(True)
```
isn't very self-documenting.

I think the patch update didn't quite work. Do you want to stick with `return_conjugation` rather than `return_transformation`?



---

archive/issue_comments_194318.json:
```json
{
    "body": "<a id='comment:17'></a>ok. That's easy enough to change and is done in this version.\n\nI forgot to qrefresh before, but the correct one should be up.",
    "created_at": "2013-12-04T19:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194318",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>ok. That's easy enough to change and is done in this version.

I forgot to qrefresh before, but the correct one should be up.



---

archive/issue_comments_194319.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-05T05:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194319",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194320.json:
```json
{
    "body": "<a id='comment:18'></a>Good with me. To repeat: I did try the code quite extensively on more or less random examples, where the code has to do non-trivial work and I didn't catch it on any inconsistencies.",
    "created_at": "2013-12-05T05:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194320",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:18'></a>Good with me. To repeat: I did try the code quite extensively on more or less random examples, where the code has to do non-trivial work and I didn't catch it on any inconsistencies.



---

archive/issue_comments_194321.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2013-12-05T08:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194321",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_194322.json:
```json
{
    "body": "<a id='comment:19'></a>Please clarify which patch(es) should be merged.",
    "created_at": "2013-12-05T08:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194322",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Please clarify which patch(es) should be merged.



---

archive/issue_comments_194323.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-12-05T13:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194323",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_194324.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-05T16:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194324",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194325.json:
```json
{
    "body": "<a id='comment:21'></a>Patch hasn't changed, so I don't think \"review\" is necessary. This is just admin to keep Jeroen's job manageable.",
    "created_at": "2013-12-05T16:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194325",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:21'></a>Patch hasn't changed, so I don't think "review" is necessary. This is just admin to keep Jeroen's job manageable.



---

archive/issue_comments_194326.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-12-05T22:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194326",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_194327.json:
```json
{
    "body": "<a id='comment:22'></a>```\ndochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:8: WARNING: Duplicate explicit target name: \"bruin-molnar\".\ndochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:12: WARNING: Duplicate explicit target name: \"molnar\".\ndochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:8: WARNING: duplicate citation Bruin-Molnar, other instance in /scratch/release/merger/sage-5.13.rc0/devel/sage/doc/en/reference/schemes/sage/schemes/projective/projective_morphism.rst\ndochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:12: WARNING: duplicate citation Molnar, other instance in /scratch/release/merger/sage-5.13.rc0/devel/sage/doc/en/reference/schemes/sage/schemes/projective/projective_morphism.rst\n```",
    "created_at": "2013-12-05T22:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194327",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>```
dochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:8: WARNING: Duplicate explicit target name: "bruin-molnar".
dochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:12: WARNING: Duplicate explicit target name: "molnar".
dochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:8: WARNING: duplicate citation Bruin-Molnar, other instance in /scratch/release/merger/sage-5.13.rc0/devel/sage/doc/en/reference/schemes/sage/schemes/projective/projective_morphism.rst
dochtml.log:[schemes  ] /scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.minimal_model:12: WARNING: duplicate citation Molnar, other instance in /scratch/release/merger/sage-5.13.rc0/devel/sage/doc/en/reference/schemes/sage/schemes/projective/projective_morphism.rst
```



---

archive/issue_comments_194328.json:
```json
{
    "body": "<a id='comment:23'></a>hmm...Since I using the same references in two different functions it is giving the warning. I'm not 100% sure what the procedure is here. In looking at some of the toric variety code, it seems to be the case to put the reference listing in one place and then use `[.]` everywhere else.\n\nSo then I've moved the `REFERENCES` block to the 'main' function and just used the citation `[.]` for the other.",
    "created_at": "2013-12-05T23:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194328",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:23'></a>hmm...Since I using the same references in two different functions it is giving the warning. I'm not 100% sure what the procedure is here. In looking at some of the toric variety code, it seems to be the case to put the reference listing in one place and then use `[.]` everywhere else.

So then I've moved the `REFERENCES` block to the 'main' function and just used the citation `[.]` for the other.



---

archive/issue_comments_194329.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-05T23:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194329",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194330.json:
```json
{
    "body": "<a id='comment:24'></a>Please rebase the patch to sage-5.13.beta4 or later.",
    "created_at": "2013-12-06T10:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194330",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Please rebase the patch to sage-5.13.beta4 or later.



---

archive/issue_comments_194331.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-06T10:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194331",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194332.json:
```json
{
    "body": "<a id='comment:25'></a>Yes, sorry, I should have realized. Even though there is no functionality dependency, they do modify the same file. The new version is rebased.",
    "created_at": "2013-12-06T13:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194332",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:25'></a>Yes, sorry, I should have realized. Even though there is no functionality dependency, they do modify the same file. The new version is rebased.



---

archive/issue_comments_194333.json:
```json
{
    "body": "<a id='comment:26'></a>```\nsage -t devel/sage/sage/schemes/projective/endPN_minimal_model.py\n**********************************************************************\nFile \"devel/sage/sage/schemes/projective/endPN_minimal_model.py\", line 65, in sage.schemes.projective.endPN_minimal_model.bCheck\nFailed example:\n    from sage.schemes.projective.minimal_model import bCheck\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.projective.endPN_minimal_model.bCheck[1]>\", line 1, in <module>\n        from sage.schemes.projective.minimal_model import bCheck\n    ImportError: No module named minimal_model\n**********************************************************************\nFile \"devel/sage/sage/schemes/projective/endPN_minimal_model.py\", line 66, in sage.schemes.projective.endPN_minimal_model.bCheck\nFailed example:\n    bCheck(11664*b^2 + 70227*b + 76059, 15/2, 3, b)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.projective.endPN_minimal_model.bCheck[2]>\", line 1, in <module>\n        bCheck(Integer(11664)*b**Integer(2) + Integer(70227)*b + Integer(76059), Integer(15)/Integer(2), Integer(3), b)\n    NameError: name 'bCheck' is not defined\n**********************************************************************\n```",
    "created_at": "2013-12-07T19:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194333",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>```
sage -t devel/sage/sage/schemes/projective/endPN_minimal_model.py
**********************************************************************
File "devel/sage/sage/schemes/projective/endPN_minimal_model.py", line 65, in sage.schemes.projective.endPN_minimal_model.bCheck
Failed example:
    from sage.schemes.projective.minimal_model import bCheck
Exception raised:
    Traceback (most recent call last):
      File "/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.schemes.projective.endPN_minimal_model.bCheck[1]>", line 1, in <module>
        from sage.schemes.projective.minimal_model import bCheck
    ImportError: No module named minimal_model
**********************************************************************
File "devel/sage/sage/schemes/projective/endPN_minimal_model.py", line 66, in sage.schemes.projective.endPN_minimal_model.bCheck
Failed example:
    bCheck(11664*b^2 + 70227*b + 76059, 15/2, 3, b)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/scratch/release/merger/sage-5.13.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.schemes.projective.endPN_minimal_model.bCheck[2]>", line 1, in <module>
        bCheck(Integer(11664)*b**Integer(2) + Integer(70227)*b + Integer(76059), Integer(15)/Integer(2), Integer(3), b)
    NameError: name 'bCheck' is not defined
**********************************************************************
```



---

archive/issue_comments_194334.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-07T23:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194334",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194335.json:
```json
{
    "body": "<a id='comment:27'></a>Attachment [trac_15392_minimal_model.patch](tarball://root/attachments/some-uuid/ticket15392/trac_15392_minimal_model.patch) by @bhutz created at 2013-12-07 23:39:36\n\nok. I fixed that typo in the test and I've doubled checked that the doctests and the docbuild pass on my system.",
    "created_at": "2013-12-07T23:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194335",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:27'></a>Attachment [trac_15392_minimal_model.patch](tarball://root/attachments/some-uuid/ticket15392/trac_15392_minimal_model.patch) by @bhutz created at 2013-12-07 23:39:36

ok. I fixed that typo in the test and I've doubled checked that the doctests and the docbuild pass on my system.



---

archive/issue_comments_194336.json:
```json
{
    "body": "<a id='comment:28'></a>OK, it works now. Nils, can you do the final review?",
    "created_at": "2013-12-08T13:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194336",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>OK, it works now. Nils, can you do the final review?



---

archive/issue_comments_194337.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-08T20:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194337",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194338.json:
```json
{
    "body": "<a id='comment:30'></a>How many reviews do we need?",
    "created_at": "2013-12-08T20:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194338",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:30'></a>How many reviews do we need?



---

archive/issue_events_044736.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-10T08:38:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15392#event-44736"
}
```



---

archive/issue_comments_194339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-10T08:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15392#issuecomment-194339",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
