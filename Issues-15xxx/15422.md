# Issue 15422: factorization of non-squarefree polynomials over the p-adics

archive/issues_015185.json:
```json
{
    "body": "1) The following should be an `ArithmeticError` since whether or not the polynomial factors depends on the `O(3^20)` error term (`t^2 - 3^20` factors while `t^2 - 3^21` does not):\n\n```\nsage: R.<t> = PolynomialRing(Qp(3))\nsage: (t^2).factor()\n((1 + O(3^20))*t + (O(3^20)))^2\n```\n\n2) The following should directly call PARI's `factorpadic` without coercing the coefficients to `Qp` first:\n\n```\nsage: R.<t> = PolynomialRing(QQ)\nsage: ((t-1)^2).factor_padic(3,5)\n(1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))\n```\n\nThe attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.\n\n**Apply** [attachment:15422_factorpadic.patch]\n\n**CC:**  @zimmermann6 @mezzarobba @roed314 @rharron\n\n**Reviewer:** Robert Bradshaw, David Roe\n\n**Author:** Jeroen Demeyer\n\n**Merged:** sage-5.13.rc0\n\n**Dependencies:** #864, #9640, #10018, #11868\n\nIssue created by migration from https://trac.sagemath.org/ticket/15422\n\n",
    "closed_at": "2013-12-07T08:30:40Z",
    "created_at": "2013-11-15T08:23:31Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "factorization of non-squarefree polynomials over the p-adics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15422",
    "user": "https://github.com/jdemeyer"
}
```
1) The following should be an `ArithmeticError` since whether or not the polynomial factors depends on the `O(3^20)` error term (`t^2 - 3^20` factors while `t^2 - 3^21` does not):

```
sage: R.<t> = PolynomialRing(Qp(3))
sage: (t^2).factor()
((1 + O(3^20))*t + (O(3^20)))^2
```

2) The following should directly call PARI's `factorpadic` without coercing the coefficients to `Qp` first:

```
sage: R.<t> = PolynomialRing(QQ)
sage: ((t-1)^2).factor_padic(3,5)
(1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))
```

The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.

**Apply** [attachment:15422_factorpadic.patch]

**CC:**  @zimmermann6 @mezzarobba @roed314 @rharron

**Reviewer:** Robert Bradshaw, David Roe

**Author:** Jeroen Demeyer

**Merged:** sage-5.13.rc0

**Dependencies:** #864, #9640, #10018, #11868

Issue created by migration from https://trac.sagemath.org/ticket/15422





---

archive/issue_comments_236175.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,7 @@\n 2) The following should directly call PARI's `factorpadic` without coercing the coefficients to `Qp` first:\n \n ```\n+sage: R.<t> = PolynomialRing(QQ)\n sage: ((t-1)^2).factor_padic(3,5)\n (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))\n ```\n``````\n",
    "created_at": "2013-11-15T15:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236175",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,7 @@
 2) The following should directly call PARI's `factorpadic` without coercing the coefficients to `Qp` first:
 
 ```
+sage: R.<t> = PolynomialRing(QQ)
 sage: ((t-1)^2).factor_padic(3,5)
 (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))
 ```
``````




---

archive/issue_comments_236176.json:
```json
{
    "body": "**Dependencies:** #9640",
    "created_at": "2013-11-15T21:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236176",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #9640



---

archive/issue_comments_236177.json:
```json
{
    "body": "<a id='comment:4'></a>\nMarc, do you agree with the change in the \"polynomes\" chapter?\n\nPaul",
    "created_at": "2013-11-21T18:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236177",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>
Marc, do you agree with the change in the "polynomes" chapter?

Paul



---

archive/issue_comments_236178.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [zimmerma](#comment%3A4):\n> Marc, do you agree with the change in the \"polynomes\" chapter?\n\n\nI certainly do! I have made the change in the book.",
    "created_at": "2013-11-21T20:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236178",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>
Replying to [zimmerma](#comment%3A4):
> Marc, do you agree with the change in the "polynomes" chapter?


I certainly do! I have made the change in the book.



---

archive/issue_comments_236179.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-11-22T13:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236179",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_236180.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2013-11-22T13:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236180",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_236181.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,3 +13,7 @@\n sage: ((t-1)^2).factor_padic(3,5)\n (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))\n ```\n+\n+The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `_factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.\n+\n+**Apply** [attachment:15422_factorpadic.patch]\n``````\n",
    "created_at": "2013-11-22T14:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236181",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,3 +13,7 @@
 sage: ((t-1)^2).factor_padic(3,5)
 (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))
 ```
+
+The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `_factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.
+
+**Apply** [attachment:15422_factorpadic.patch]
``````




---

archive/issue_comments_236182.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,6 +14,6 @@\n (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))\n ```\n \n-The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `_factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.\n+The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.\n \n **Apply** [attachment:15422_factorpadic.patch]\n``````\n",
    "created_at": "2013-11-22T14:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236182",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,6 +14,6 @@
 (1 + O(3^5))*t^2 + (1 + 2*3 + 2*3^2 + 2*3^3 + 2*3^4 + O(3^5))*t + (1 + O(3^5))
 ```
 
-The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `_factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.
+The attached patch also does some clean-up of the various p-adic polynomial classes, now `_repr()` and `factor()` are implemented in exactly one place. One consequence of this is that `_repr()` for polynomials over `Zp` has changed: non-exact zeros are now printed.
 
 **Apply** [attachment:15422_factorpadic.patch]
``````




---

archive/issue_comments_236183.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mmezzarobba](#comment%3A5):\n> I have made the change in the book.\n\nMaybe that's a bit too quick, this is still only \"needs_review\".",
    "created_at": "2013-11-22T22:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236183",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [mmezzarobba](#comment%3A5):
> I have made the change in the book.

Maybe that's a bit too quick, this is still only "needs_review".



---

archive/issue_comments_236184.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A11):\n> Replying to [mmezzarobba](#comment%3A5):\n> > I have made the change in the book.\n\n> Maybe that's a bit too quick, this is still only \"needs_review\".\n\nYes.  In particular, I disagree with the change to 1.  I'm looking at the code now and writing some more comments.",
    "created_at": "2013-11-22T22:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236184",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A11):
> Replying to [mmezzarobba](#comment%3A5):
> > I have made the change in the book.

> Maybe that's a bit too quick, this is still only "needs_review".

Yes.  In particular, I disagree with the change to 1.  I'm looking at the code now and writing some more comments.



---

archive/issue_comments_236185.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [roed](#comment%3A12):\n> Replying to [jdemeyer](#comment%3A11):\n> > Replying to [mmezzarobba](#comment%3A5):\n> > > I have made the change in the book.\n\n> > Maybe that's a bit too quick, this is still only \"needs_review\".\n> \n> Yes.  In particular, I disagree with the change to 1.  I'm looking at the code now and writing some more comments.\n\n\nNo problem: I only changed the version in our private repository. I'll keep updating it in case the output changes again, and of course test everything before we release a new version. But thanks for mentioning it!",
    "created_at": "2013-11-23T09:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236185",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:13'></a>
Replying to [roed](#comment%3A12):
> Replying to [jdemeyer](#comment%3A11):
> > Replying to [mmezzarobba](#comment%3A5):
> > > I have made the change in the book.

> > Maybe that's a bit too quick, this is still only "needs_review".
> 
> Yes.  In particular, I disagree with the change to 1.  I'm looking at the code now and writing some more comments.


No problem: I only changed the version in our private repository. I'll keep updating it in case the output changes again, and of course test everything before we release a new version. But thanks for mentioning it!



---

archive/issue_comments_236186.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [roed](#comment%3A12):\n> Yes.  In particular, I disagree with the change to 1.\n  \nIf you do, please explain what you think Sage should answer to\n\n```\nsage: R.<t> = PolynomialRing(Qp(3))\nsage: (t^2).factor()\n```\nand\n\n```\nsage: R.<t> = PolynomialRing(Qp(3))\nsage: (t^2).roots()\n```",
    "created_at": "2013-11-23T10:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236186",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [roed](#comment%3A12):
> Yes.  In particular, I disagree with the change to 1.
  
If you do, please explain what you think Sage should answer to

```
sage: R.<t> = PolynomialRing(Qp(3))
sage: (t^2).factor()
```
and

```
sage: R.<t> = PolynomialRing(Qp(3))
sage: (t^2).roots()
```



---

archive/issue_comments_236187.json:
```json
{
    "body": "<a id='comment:15'></a>\nDavid: do you agree with part 2 of the patch? Would you review it if I separated it into a different ticket?",
    "created_at": "2013-11-28T11:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236187",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
David: do you agree with part 2 of the patch? Would you review it if I separated it into a different ticket?



---

archive/issue_comments_236188.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jdemeyer](#comment%3A14):\n> Replying to [roed](#comment%3A12):\n> > Yes.  In particular, I disagree with the change to 1.\n  \n> If you do, please explain what you think Sage should answer to\n\n```\nsage: R.<t> = PolynomialRing(Qp(3))\nsage: (t^2).factor()\n((1 + O(3^20))*t + (O(3^10)))^2\n```\n> and\n\n\n```\n sage: R.<t> = PolynomialRing(Qp(3))\n sage: (t^2).roots()\n [(O(3^10), 2)]\n```\n\nSorry that I didn't manage to review this ticket yet.  I'll work on it now and make some suggestions.",
    "created_at": "2013-11-29T03:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236188",
    "user": "https://github.com/roed314"
}
```

<a id='comment:16'></a>
Replying to [jdemeyer](#comment%3A14):
> Replying to [roed](#comment%3A12):
> > Yes.  In particular, I disagree with the change to 1.
  
> If you do, please explain what you think Sage should answer to

```
sage: R.<t> = PolynomialRing(Qp(3))
sage: (t^2).factor()
((1 + O(3^20))*t + (O(3^10)))^2
```
> and


```
 sage: R.<t> = PolynomialRing(Qp(3))
 sage: (t^2).roots()
 [(O(3^10), 2)]
```

Sorry that I didn't manage to review this ticket yet.  I'll work on it now and make some suggestions.



---

archive/issue_comments_236189.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-11-29T03:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236189",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_236190.json:
```json
{
    "body": "<a id='comment:17'></a>\n**polynomial_padic.py**\n\n* uniformizer_pow rather than prime_pow on line 155\n* rather than raising an `ArithmeticError` on line 159, we should use gcds to return the square, with half the precision.  Xavier Caruso and I are working on precision in p-adic factoring.  In the mean time, I would prefer to switch this to a `NotImplementedError`.  This will change some doctests (line 114 for example).\n**polynomial_element.pyx**\n* Need to update the doctest on line 5327.\n**polynomial_integer_dense_flint.pyx**\n* The output of factor_padic on line 1277 should be \"factorization of self over the completion at `p`\"\n**polynomial_integer_dense_ntl.pyx**\n* The output of factor_padic on line 1002 should be \"factorization of self over the completion at `p`\"\n**polynomial_rational_flint.pyx**\n* Need to update the doctest on line 1585.\n\nThis patch changes the behavior of content for p-adic polynomials, from returning an element to returning an ideal.  I have no problem with that change, but I thought that it should be remarked.\n\nOther than these comments, I'm happy with the changes.",
    "created_at": "2013-11-29T03:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236190",
    "user": "https://github.com/roed314"
}
```

<a id='comment:17'></a>
**polynomial_padic.py**

* uniformizer_pow rather than prime_pow on line 155
* rather than raising an `ArithmeticError` on line 159, we should use gcds to return the square, with half the precision.  Xavier Caruso and I are working on precision in p-adic factoring.  In the mean time, I would prefer to switch this to a `NotImplementedError`.  This will change some doctests (line 114 for example).
**polynomial_element.pyx**
* Need to update the doctest on line 5327.
**polynomial_integer_dense_flint.pyx**
* The output of factor_padic on line 1277 should be "factorization of self over the completion at `p`"
**polynomial_integer_dense_ntl.pyx**
* The output of factor_padic on line 1002 should be "factorization of self over the completion at `p`"
**polynomial_rational_flint.pyx**
* Need to update the doctest on line 1585.

This patch changes the behavior of content for p-adic polynomials, from returning an element to returning an ideal.  I have no problem with that change, but I thought that it should be remarked.

Other than these comments, I'm happy with the changes.



---

archive/issue_comments_236191.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [roed](#comment%3A17):\n>  * rather than raising an `ArithmeticError` on line 159, we should use gcds to return the square, with half the precision.\n \nWhy **should** we do that? My point of view is that we should warn people that they do something which is not mathematically well-defined. And as explained in the ticket description, `factor( (1+O(3<sup>20))*t</sup>2 )` is not well-defined. One simply cannot determine whether it has `p`-adic roots or not.",
    "created_at": "2013-11-29T07:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236191",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [roed](#comment%3A17):
>  * rather than raising an `ArithmeticError` on line 159, we should use gcds to return the square, with half the precision.
 
Why **should** we do that? My point of view is that we should warn people that they do something which is not mathematically well-defined. And as explained in the ticket description, `factor( (1+O(3<sup>20))*t</sup>2 )` is not well-defined. One simply cannot determine whether it has `p`-adic roots or not.



---

archive/issue_comments_236192.json:
```json
{
    "body": "<a id='comment:19'></a>\nIn other words: I think it is wrong to claim that `(t^2 - 3^21)*(1 + O(3^20))` has a 3-adic root of multiplicity 2. When you're interpreting `t^2*(1 + O(3^20))` as the `p`-adic coercion of `t^2` and not `t^2 - 3^21`, you're simply guessing.",
    "created_at": "2013-11-29T07:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236192",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
In other words: I think it is wrong to claim that `(t^2 - 3^21)*(1 + O(3^20))` has a 3-adic root of multiplicity 2. When you're interpreting `t^2*(1 + O(3^20))` as the `p`-adic coercion of `t^2` and not `t^2 - 3^21`, you're simply guessing.



---

archive/issue_comments_236193.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jdemeyer](#comment%3A19):\n> In other words: I think it is wrong to claim that `(t^2 - 3^21)*(1 + O(3^20))` has a 3-adic root of multiplicity 2. When you're interpreting `t^2*(1 + O(3^20))` as the `p`-adic coercion of `t^2` and not `t^2 - 3^21`, you're simply guessing.\n\n\nYou can **never** say that a p-adic polynomial has a root.  The subvariety of irreducible polynomials is open (in either the Zariski or the p-adic topology), and any ball will intersect it.  So for a given p-adic polynomial with finite precision, it is either definitely irreducible, or has unknown status.  Rather than always raising an `ArithmeticError` instead of factoring, we should make the convention that we will return a factorization to the greatest extent possible among the polynomials within that ball.  There is a nice algorithm to determine the precision of the resulting factors.\n\nIn particular, the only thing special about polynomials whose discriminant is indistinguishable from zero is that they have the maximum precision loss among reducible polynomials.  Among the reducible polynomials in the ball `(1 + O(3<sup>20))*t</sup>2 + (O(3^20))*t + (O(3^20))`, all of them have monic factorizations of the form `((1 + O(3^20))*t + (O(3^10)))*((1 + O(3^20))*t + (O(3^10)))`.  For example, (t+3<sup>10</sup>)(t-3<sup>10</sup>) would be another possible factorization.",
    "created_at": "2013-11-29T08:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236193",
    "user": "https://github.com/roed314"
}
```

<a id='comment:20'></a>
Replying to [jdemeyer](#comment%3A19):
> In other words: I think it is wrong to claim that `(t^2 - 3^21)*(1 + O(3^20))` has a 3-adic root of multiplicity 2. When you're interpreting `t^2*(1 + O(3^20))` as the `p`-adic coercion of `t^2` and not `t^2 - 3^21`, you're simply guessing.


You can **never** say that a p-adic polynomial has a root.  The subvariety of irreducible polynomials is open (in either the Zariski or the p-adic topology), and any ball will intersect it.  So for a given p-adic polynomial with finite precision, it is either definitely irreducible, or has unknown status.  Rather than always raising an `ArithmeticError` instead of factoring, we should make the convention that we will return a factorization to the greatest extent possible among the polynomials within that ball.  There is a nice algorithm to determine the precision of the resulting factors.

In particular, the only thing special about polynomials whose discriminant is indistinguishable from zero is that they have the maximum precision loss among reducible polynomials.  Among the reducible polynomials in the ball `(1 + O(3<sup>20))*t</sup>2 + (O(3^20))*t + (O(3^20))`, all of them have monic factorizations of the form `((1 + O(3^20))*t + (O(3^10)))*((1 + O(3^20))*t + (O(3^10)))`.  For example, (t+3<sup>10</sup>)(t-3<sup>10</sup>) would be another possible factorization.



---

archive/issue_comments_236194.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [roed](#comment%3A20):\n> You can **never** say that a p-adic polynomial has a root.\n\nThat can't be true (or I am misunderstanding you). Using Hensel's Lemma, you *can* be certain that polynomials factor in a certain way. For example, any polynomial over `Zp` which is congruent to `(t-1)(t-2)` modulo p, will have a single p-adic root close to 1 and a single p-adic root close to 2. In particular, `(t-1)(t-2) + p*f` will never be irreducible (for f in `Zp[t]`). What am I missing?...",
    "created_at": "2013-11-29T08:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236194",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [roed](#comment%3A20):
> You can **never** say that a p-adic polynomial has a root.

That can't be true (or I am misunderstanding you). Using Hensel's Lemma, you *can* be certain that polynomials factor in a certain way. For example, any polynomial over `Zp` which is congruent to `(t-1)(t-2)` modulo p, will have a single p-adic root close to 1 and a single p-adic root close to 2. In particular, `(t-1)(t-2) + p*f` will never be irreducible (for f in `Zp[t]`). What am I missing?...



---

archive/issue_comments_236195.json:
```json
{
    "body": "<a id='comment:22'></a>\nHensel's Lemma is exactly the reason why p-adic factoring (and root finding) makes sense: because it can give *if and only if* statements between factoring over `Qp` and factoring modulo `p^n`.",
    "created_at": "2013-11-29T08:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236195",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Hensel's Lemma is exactly the reason why p-adic factoring (and root finding) makes sense: because it can give *if and only if* statements between factoring over `Qp` and factoring modulo `p^n`.



---

archive/issue_comments_236196.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe change to `sage/libs/pari/gen.pyx` would conflict with #11868, so I moved that part of the patch to #11868.\n\nI made the changes you requested, except for changing the `ArithmeticError`.",
    "created_at": "2013-11-29T09:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236196",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
The change to `sage/libs/pari/gen.pyx` would conflict with #11868, so I moved that part of the patch to #11868.

I made the changes you requested, except for changing the `ArithmeticError`.



---

archive/issue_comments_236197.json:
```json
{
    "body": "**Changing dependencies** from \"#9640\" to \"#9640, #11868\".",
    "created_at": "2013-11-29T09:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236197",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#9640" to "#9640, #11868".



---

archive/issue_comments_236198.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [roed](#comment%3A17):\n> This patch changes the behavior of content for p-adic polynomials, from returning an element to returning an ideal.\n\nReally? Can you give an example of a result which changed? The following happens both before and after my patch:\n\n```\nsage: parent(polygen(Zp(3, 20, 'capped-abs')).content())\nMonoid of ideals of 3-adic Ring with capped absolute precision 20\nsage: parent(polygen(Zp(3, 20)).content())\n3-adic Ring with capped relative precision 20\n```\n\n(one could argue that this should be changed, but that's unrelated to this ticket)",
    "created_at": "2013-11-29T09:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236198",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [roed](#comment%3A17):
> This patch changes the behavior of content for p-adic polynomials, from returning an element to returning an ideal.

Really? Can you give an example of a result which changed? The following happens both before and after my patch:

```
sage: parent(polygen(Zp(3, 20, 'capped-abs')).content())
Monoid of ideals of 3-adic Ring with capped absolute precision 20
sage: parent(polygen(Zp(3, 20)).content())
3-adic Ring with capped relative precision 20
```

(one could argue that this should be changed, but that's unrelated to this ticket)



---

archive/issue_comments_236199.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw",
    "created_at": "2013-11-29T09:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236199",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Robert Bradshaw



---

archive/issue_comments_236200.json:
```json
{
    "body": "**Changing dependencies** from \"#9640, #11868\" to \"#864, #9640, #10018, #11868\".",
    "created_at": "2013-11-29T09:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236200",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#9640, #11868" to "#864, #9640, #10018, #11868".



---

archive/issue_comments_236201.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-11-29T09:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236201",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_236202.json:
```json
{
    "body": "<a id='comment:26'></a>\nThere is a precedent:\n\n```\nsage: (1 + O(2^2)).is_square()\n---------------------------------------------------------------------------\nPrecisionError                            Traceback (most recent call last)\n<ipython-input-2-a8b4da3a4425> in <module>()\n----> 1 (Integer(1) + O(Integer(2)**Integer(2))).is_square()\n\n/usr/local/src/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/rings/padics/padic_generic_element.so in sage.rings.padics.padic_generic_element.pAdicGenericElement.is_square (sage/rings/padics/padic_generic_element.c:6916)()\n\n/usr/local/src/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/rings/padics/padic_capped_relative_element.so in sage.rings.padics.padic_capped_relative_element.pAdicCappedRelativeElement.residue (sage/rings/padics/padic_capped_relative_element.c:17528)()\n\nPrecisionError: Not enough precision known in order to compute residue.\n```\n\nThis is exactly the same as factoring `t^2 - (1 + O(2^2))`, so the latter should be an error also.\n\n(I didn't know about `PrecisionError`, so I'm changing the patch to return a `PrecisionError` instead of `ArithmeticError`).",
    "created_at": "2013-11-29T09:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236202",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
There is a precedent:

```
sage: (1 + O(2^2)).is_square()
---------------------------------------------------------------------------
PrecisionError                            Traceback (most recent call last)
<ipython-input-2-a8b4da3a4425> in <module>()
----> 1 (Integer(1) + O(Integer(2)**Integer(2))).is_square()

/usr/local/src/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/rings/padics/padic_generic_element.so in sage.rings.padics.padic_generic_element.pAdicGenericElement.is_square (sage/rings/padics/padic_generic_element.c:6916)()

/usr/local/src/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/rings/padics/padic_capped_relative_element.so in sage.rings.padics.padic_capped_relative_element.pAdicCappedRelativeElement.residue (sage/rings/padics/padic_capped_relative_element.c:17528)()

PrecisionError: Not enough precision known in order to compute residue.
```

This is exactly the same as factoring `t^2 - (1 + O(2^2))`, so the latter should be an error also.

(I didn't know about `PrecisionError`, so I'm changing the patch to return a `PrecisionError` instead of `ArithmeticError`).



---

archive/attachments_020438.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "15422_factorpadic.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket15422/15422_factorpadic.patch",
    "created_at": "2013-11-29T10:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_236203.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jdemeyer](#comment%3A21):\n> Replying to [roed](#comment%3A20):\n> > You can **never** say that a p-adic polynomial has a root.\n\n> That can't be true (or I am misunderstanding you). Using Hensel's Lemma, you *can* be certain that polynomials factor in a certain way. For example, any polynomial over `Zp` which is congruent to `(t-1)(t-2)` modulo p, will have a single p-adic root close to 1 and a single p-adic root close to 2. In particular, `(t-1)(t-2) + p*f` will never be irreducible (for f in `Zp[t]`). What am I missing?...\n\nYou're right.  I need to go to sleep now, but I'll think about this more and get back to you tomorrow.  Perhaps we can add an option to pass to `factor` that allows for factoring non-squarefree polynomials.\n\nAs for the `content` comment, it was based on reading through the patch and noting that you'd deleted that function in `Polynomial_element_generic.pyx`.  But I see now that it's defined again in the other classes, so there's no issue.",
    "created_at": "2013-11-29T10:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236203",
    "user": "https://github.com/roed314"
}
```

<a id='comment:27'></a>
Replying to [jdemeyer](#comment%3A21):
> Replying to [roed](#comment%3A20):
> > You can **never** say that a p-adic polynomial has a root.

> That can't be true (or I am misunderstanding you). Using Hensel's Lemma, you *can* be certain that polynomials factor in a certain way. For example, any polynomial over `Zp` which is congruent to `(t-1)(t-2)` modulo p, will have a single p-adic root close to 1 and a single p-adic root close to 2. In particular, `(t-1)(t-2) + p*f` will never be irreducible (for f in `Zp[t]`). What am I missing?...

You're right.  I need to go to sleep now, but I'll think about this more and get back to you tomorrow.  Perhaps we can add an option to pass to `factor` that allows for factoring non-squarefree polynomials.

As for the `content` comment, it was based on reading through the patch and noting that you'd deleted that function in `Polynomial_element_generic.pyx`.  But I see now that it's defined again in the other classes, so there's no issue.



---

archive/issue_comments_236204.json:
```json
{
    "body": "<a id='comment:28'></a>\nSorry for the delay again.\n\nYou are right that original claim is invalidated by Hensel lifting.  But I still believe that we should factor `t<sup>2+O(3</sup>20)` as `(t + O(3<sup>10))</sup>2` by analogy with linear algebra.  Here's what I mean.\n\nConsider the problem of finding the kernel of a matrix `A` over the p-adics.  Sometimes, we will be able to tell that this kernel is trivial (when \n\n```\nA = [1 + O(3^20)     O(3^20)]\n    [    O(3^20) 1 + O(3^20)]\n```\nfor example).  But other times we don't know if the dimension is 0 or 1:\n\n```\nA = [1 + O(3^20)     O(3^20)]\n    [    O(3^20)     O(3^20)],\n```\nor even if the dimension is 0, 1 or 2:\n\n```\nA = [    O(3^20)     O(3^20)]\n    [    O(3^20)     O(3^20)].\n```\nWe often design algorithms so that they produce a matrix with non-trivial kernel, and rely on being able to find it.  I don't want Sage to raise a `PrecisionError` whenever there is a nontrivial kernel.\n\nOf course, if the matrix *does* have a kernel then we can find it, and we can determine the precision to which we know that kernel.  I would argue that that is the more useful answer.  In the same way, if a user actually has a polynomial that is not squarefree, it's more useful to tell them that the polynomial factors in a certain way, assuming that it's reducible in the first place.\n\nI think it's a question of how we warn the user that the result is uncertain in this way: include a warning in the documentation of `factor` or raise a `PrecisionError` unless the user passes in a certain keyword argument.  If we disagree on which option is more appropriate in this case, I would suggest bringing the issue up on `sage-nt` and `sage-padic`.",
    "created_at": "2013-12-03T23:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236204",
    "user": "https://github.com/roed314"
}
```

<a id='comment:28'></a>
Sorry for the delay again.

You are right that original claim is invalidated by Hensel lifting.  But I still believe that we should factor `t<sup>2+O(3</sup>20)` as `(t + O(3<sup>10))</sup>2` by analogy with linear algebra.  Here's what I mean.

Consider the problem of finding the kernel of a matrix `A` over the p-adics.  Sometimes, we will be able to tell that this kernel is trivial (when 

```
A = [1 + O(3^20)     O(3^20)]
    [    O(3^20) 1 + O(3^20)]
```
for example).  But other times we don't know if the dimension is 0 or 1:

```
A = [1 + O(3^20)     O(3^20)]
    [    O(3^20)     O(3^20)],
```
or even if the dimension is 0, 1 or 2:

```
A = [    O(3^20)     O(3^20)]
    [    O(3^20)     O(3^20)].
```
We often design algorithms so that they produce a matrix with non-trivial kernel, and rely on being able to find it.  I don't want Sage to raise a `PrecisionError` whenever there is a nontrivial kernel.

Of course, if the matrix *does* have a kernel then we can find it, and we can determine the precision to which we know that kernel.  I would argue that that is the more useful answer.  In the same way, if a user actually has a polynomial that is not squarefree, it's more useful to tell them that the polynomial factors in a certain way, assuming that it's reducible in the first place.

I think it's a question of how we warn the user that the result is uncertain in this way: include a warning in the documentation of `factor` or raise a `PrecisionError` unless the user passes in a certain keyword argument.  If we disagree on which option is more appropriate in this case, I would suggest bringing the issue up on `sage-nt` and `sage-padic`.



---

archive/issue_comments_236205.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [roed](#comment%3A28):\n> In the same way, if a user actually has a polynomial that is not squarefree, it's more useful to tell them that the polynomial factors in a certain way\n\nI would say it is more useful to tell them that their question is not well-defined. Because, in this case, it is possible to make the question well-defined by either increasing the precision of the given polynomial or by starting with a polynomial over `QQ`.\n\n> raise a `PrecisionError` unless the user passes in a certain keyword argument.\n\nI could live with this, if the default is to raise the exception.",
    "created_at": "2013-12-04T08:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236205",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [roed](#comment%3A28):
> In the same way, if a user actually has a polynomial that is not squarefree, it's more useful to tell them that the polynomial factors in a certain way

I would say it is more useful to tell them that their question is not well-defined. Because, in this case, it is possible to make the question well-defined by either increasing the precision of the given polynomial or by starting with a polynomial over `QQ`.

> raise a `PrecisionError` unless the user passes in a certain keyword argument.

I could live with this, if the default is to raise the exception.



---

archive/issue_comments_236206.json:
```json
{
    "body": "<a id='comment:30'></a>\nGiven that implementing that additional keyword for \"best-effort factoring\" (factor `f` assuming everything which could be a power actually is a power) is going to take some work, would you agree with merging this ticket as-is and leaving your suggestion for later?",
    "created_at": "2013-12-04T17:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236206",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Given that implementing that additional keyword for "best-effort factoring" (factor `f` assuming everything which could be a power actually is a power) is going to take some work, would you agree with merging this ticket as-is and leaving your suggestion for later?



---

archive/issue_comments_236207.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jdemeyer](#comment%3A30):\n> Given that implementing that additional keyword for \"best-effort factoring\" (factor `f` assuming everything which could be a power actually is a power) is going to take some work, would you agree with merging this ticket as-is and leaving your suggestion for later?\n\n\nI definitely think that implementing best-effort factoring should be saved for another ticket.  I'm giving this a positive review, since I think that a keyword argument is a good compromise.  I would like to e-mail `sage-nt` and `sage-padic` to get some more opinions, but any consensus from that discussion can be postponed to a follow up ticket.",
    "created_at": "2013-12-04T19:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236207",
    "user": "https://github.com/roed314"
}
```

<a id='comment:31'></a>
Replying to [jdemeyer](#comment%3A30):
> Given that implementing that additional keyword for "best-effort factoring" (factor `f` assuming everything which could be a power actually is a power) is going to take some work, would you agree with merging this ticket as-is and leaving your suggestion for later?


I definitely think that implementing best-effort factoring should be saved for another ticket.  I'm giving this a positive review, since I think that a keyword argument is a good compromise.  I would like to e-mail `sage-nt` and `sage-padic` to get some more opinions, but any consensus from that discussion can be postponed to a follow up ticket.



---

archive/issue_comments_236208.json:
```json
{
    "body": "**Changing reviewer** from \"Robert Bradshaw\" to \"Robert Bradshaw, David Roe\".",
    "created_at": "2013-12-04T19:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236208",
    "user": "https://github.com/roed314"
}
```

**Changing reviewer** from "Robert Bradshaw" to "Robert Bradshaw, David Roe".



---

archive/issue_comments_236209.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-12-04T19:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236209",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_050944.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-07T08:30:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15422#event-50944"
}
```



---

archive/issue_comments_236210.json:
```json
{
    "body": "**Merged:** sage-5.13.rc0",
    "created_at": "2013-12-07T08:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15422#issuecomment-236210",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.13.rc0
