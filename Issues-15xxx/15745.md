# Issue 15745: The unit ideal is not prime or primary

archive/issues_015508.json:
```json
{
    "body": "On sage-support on 2014-01-27, Jack <kroeker@uni-math.gwdg.de> reported:\n\n```\nI'm a bit confused about Sage's answer if Ideal(1) is prime.\n\nR.<x,y>= QQ[]\nI = Ideal(R(1))\nI.is_prime()\n\nSage (5.11, not only)  says yes,\nconflicting to the definition, http://en.wikipedia.org/wiki/Prime_ideal\nHas somebody an expanation of this behaviour?\n```\nand in the following discussion it was agreed that this is incorrect, as is `I.is_primary()}} (gives True not False) and {{{I.primary_decomposition()` (gives a nonempty list) and {{{I.is_maximal())}} (raises an error instead of returning False).\n\nThis originates with Singular, but could easily be fixed in Sage. \n\n**CC:**  @pjbruin\n\n**Keywords:** unit prime primary ideal\n\n**Branch:** [u/pbruin/15745-primary_decomposition_unit_ideal](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15745-primary_decomposition_unit_ideal)\n\n**Commit:** [295c7fd72cc777f3d5c2b2b25b2895c5c67e6170](https://github.com/sagemath/sagetrac-mirror/commit/295c7fd72cc777f3d5c2b2b25b2895c5c67e6170)\n\n**Reviewer:** John Cremona\n\n**Author:** Peter Bruin\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15745\n\n",
    "closed_at": "2014-02-03T22:58:06Z",
    "created_at": "2014-01-27T14:45:00Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "The unit ideal is not prime or primary",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15745",
    "user": "https://github.com/JohnCremona"
}
```
On sage-support on 2014-01-27, Jack <kroeker@uni-math.gwdg.de> reported:

```
I'm a bit confused about Sage's answer if Ideal(1) is prime.

R.<x,y>= QQ[]
I = Ideal(R(1))
I.is_prime()

Sage (5.11, not only)  says yes,
conflicting to the definition, http://en.wikipedia.org/wiki/Prime_ideal
Has somebody an expanation of this behaviour?
```
and in the following discussion it was agreed that this is incorrect, as is `I.is_primary()}} (gives True not False) and {{{I.primary_decomposition()` (gives a nonempty list) and {{{I.is_maximal())}} (raises an error instead of returning False).

This originates with Singular, but could easily be fixed in Sage. 

**CC:**  @pjbruin

**Keywords:** unit prime primary ideal

**Branch:** [u/pbruin/15745-primary_decomposition_unit_ideal](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15745-primary_decomposition_unit_ideal)

**Commit:** [295c7fd72cc777f3d5c2b2b25b2895c5c67e6170](https://github.com/sagemath/sagetrac-mirror/commit/295c7fd72cc777f3d5c2b2b25b2895c5c67e6170)

**Reviewer:** John Cremona

**Author:** Peter Bruin

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/15745





---

archive/issue_comments_258330.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-01-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258330",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_258331.json:
```json
{
    "body": "**Commit:** [295c7fd72cc777f3d5c2b2b25b2895c5c67e6170](https://github.com/sagemath/sagetrac-mirror/commit/295c7fd72cc777f3d5c2b2b25b2895c5c67e6170)",
    "created_at": "2014-01-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258331",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [295c7fd72cc777f3d5c2b2b25b2895c5c67e6170](https://github.com/sagemath/sagetrac-mirror/commit/295c7fd72cc777f3d5c2b2b25b2895c5c67e6170)



---

archive/issue_comments_258332.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2014-01-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258332",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_comments_258333.json:
```json
{
    "body": "<a id='comment:1'></a>\nIn this branch:\n- return empty primary decomposition for the unit ideal\n- fix a different bug uncovered by the above fix (comparison of ideals was wrong in some cases when using different term orders)\n- improve documentation of `[complete_]primary_decomposition()`",
    "created_at": "2014-01-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258333",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:1'></a>
In this branch:
- return empty primary decomposition for the unit ideal
- fix a different bug uncovered by the above fix (comparison of ideals was wrong in some cases when using different term orders)
- improve documentation of `[complete_]primary_decomposition()`



---

archive/issue_comments_258334.json:
```json
{
    "body": "**Branch:** [u/pbruin/15745-primary_decomposition_unit_ideal](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15745-primary_decomposition_unit_ideal)",
    "created_at": "2014-01-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258334",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/15745-primary_decomposition_unit_ideal](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15745-primary_decomposition_unit_ideal)



---

archive/issue_comments_258335.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.\n\nApart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?",
    "created_at": "2014-01-30T09:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258335",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Looks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.

Apart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?



---

archive/issue_events_052803.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15745#event-52803"
}
```



---

archive/issue_comments_258336.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [cremona](#comment%3A2):\n> Looks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.\n\n\nYes, given that the small primer was already there I thought it made more sense to tidy it up than to remove it altogether.\n\n> Apart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?\n\n\nThe thing that failed after I made the first fix was a doctest that checked that the product of the primary ideals in the primary decomposition was equal to the original ideal.  The problem was that comparison of ideals was broken in the following situation: *I* and *J* are ideals of *R* = **Q**[*x*,*y*], a Gr\u00f6bner basis of *J* has been computed for a different monomial ordering than the default one for *R*, and no Gr\u00f6bner basis for *I* has been computed.  The reason why it didn't work is that the equality *I* = *J* was tested using the default monomial ordering of *R*, but with the \"wrong\" Gr\u00f6bner basis for *J*.  My fix makes sure that the comparison uses the monomial ordering of the cached Gr\u00f6bner basis.\n\nHow was the bug triggered by the new check for the unit ideal?  At the point this check is done, no Gr\u00f6bner bases have been computed for any ideal, so Sage decides to use the `degrevlex` ordering, while the *R* in the doctest has the `lex` ordering.  So a Gr\u00f6bner basis for the `degrevlex` ordering is cached, and on the other hand when the product of the ideals in the primary decomposition is made it has no cached Gr\u00f6bner basis, which brings us in the situation above.\n\nI could have written a new doctest, but since it is already tested by an existing doctest I thought it wasn't really necessary, and I didn't see a natural way of explaining the above problem in the patch.  I should have explained in my previous comment why there is no new doctest in the patch, though.",
    "created_at": "2014-02-03T09:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258336",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
Replying to [cremona](#comment%3A2):
> Looks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.


Yes, given that the small primer was already there I thought it made more sense to tidy it up than to remove it altogether.

> Apart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?


The thing that failed after I made the first fix was a doctest that checked that the product of the primary ideals in the primary decomposition was equal to the original ideal.  The problem was that comparison of ideals was broken in the following situation: *I* and *J* are ideals of *R* = **Q**[*x*,*y*], a Gröbner basis of *J* has been computed for a different monomial ordering than the default one for *R*, and no Gröbner basis for *I* has been computed.  The reason why it didn't work is that the equality *I* = *J* was tested using the default monomial ordering of *R*, but with the "wrong" Gröbner basis for *J*.  My fix makes sure that the comparison uses the monomial ordering of the cached Gröbner basis.

How was the bug triggered by the new check for the unit ideal?  At the point this check is done, no Gröbner bases have been computed for any ideal, so Sage decides to use the `degrevlex` ordering, while the *R* in the doctest has the `lex` ordering.  So a Gröbner basis for the `degrevlex` ordering is cached, and on the other hand when the product of the ideals in the primary decomposition is made it has no cached Gröbner basis, which brings us in the situation above.

I could have written a new doctest, but since it is already tested by an existing doctest I thought it wasn't really necessary, and I didn't see a natural way of explaining the above problem in the patch.  I should have explained in my previous comment why there is no new doctest in the patch, though.



---

archive/issue_comments_258337.json:
```json
{
    "body": "<a id='comment:5'></a>\nThat's certainly a good enough explanation for me!",
    "created_at": "2014-02-03T09:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258337",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
That's certainly a good enough explanation for me!



---

archive/issue_comments_258338.json:
```json
{
    "body": "**Reviewer:** John Cremona",
    "created_at": "2014-02-03T09:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258338",
    "user": "https://github.com/JohnCremona"
}
```

**Reviewer:** John Cremona



---

archive/issue_comments_258339.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-02-03T09:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258339",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_052804.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-03T22:58:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15745#event-52804"
}
```



---

archive/issue_comments_258340.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2014-02-03T22:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15745#issuecomment-258340",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
