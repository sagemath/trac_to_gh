# Issue 15158: R doctests fail for no reason

archive/issues_014921.json:
```json
{
    "body": "Whether or not a certain R version is installed, should not affect doctests, if R works as intended.\n\n**Keywords:** r-project\n\n**Branch:** [u/felixs/r_doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/felixs/r_doctest)\n\n**Commit:** [628d5afab70880b7b7a24d3417d7ff996dbb816c](https://github.com/sagemath/sagetrac-mirror/commit/628d5afab70880b7b7a24d3417d7ff996dbb816c)\n\n**Author:** Felix Salfelder\n\n**Status:** needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/15158\n\n",
    "created_at": "2013-09-05T08:42:29Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "R doctests fail for no reason",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15158",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```
Whether or not a certain R version is installed, should not affect doctests, if R works as intended.

**Keywords:** r-project

**Branch:** [u/felixs/r_doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/felixs/r_doctest)

**Commit:** [628d5afab70880b7b7a24d3417d7ff996dbb816c](https://github.com/sagemath/sagetrac-mirror/commit/628d5afab70880b7b7a24d3417d7ff996dbb816c)

**Author:** Felix Salfelder

**Status:** needs_work

Issue created by migration from https://trac.sagemath.org/ticket/15158





---

archive/issue_comments_230180.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-09-05T08:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230180",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_230181.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is a defect, because sagelib is sometimes used outside ouf sage (the distribution). It will be a defect within sage (the distribution) as soon as R will not be built unconditionally (e.g. #14796).",
    "created_at": "2013-09-05T08:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230181",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:1'></a>
This is a defect, because sagelib is sometimes used outside ouf sage (the distribution). It will be a defect within sage (the distribution) as soon as R will not be built unconditionally (e.g. #14796).



---

archive/issue_comments_230182.json:
```json
{
    "body": "<a id='comment:2'></a>\nCan you be more elaborate about what you mean by this?  The description is remarkably cryptic.\n\nBut I think you mean the function tested in the function changed (correctly) in #13686.  There is a good reason to test this function; it's a function in Sage, so it needs to be doctested.  Perhaps there is a nice clever way to test this without allowing just any old output like `((25,1,3), 'R version -3.2.x')` but that would need to be done, so we shouldn't remove the function.  If that's not what you're implying, my apologies in advance.",
    "created_at": "2013-09-06T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230182",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
Can you be more elaborate about what you mean by this?  The description is remarkably cryptic.

But I think you mean the function tested in the function changed (correctly) in #13686.  There is a good reason to test this function; it's a function in Sage, so it needs to be doctested.  Perhaps there is a nice clever way to test this without allowing just any old output like `((25,1,3), 'R version -3.2.x')` but that would need to be done, so we shouldn't remove the function.  If that's not what you're implying, my apologies in advance.



---

archive/issue_comments_230183.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"r-project\".",
    "created_at": "2013-09-06T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230183",
    "user": "https://github.com/kcrisman"
}
```

**Changing keywords** from "" to "r-project".



---

archive/issue_comments_230184.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [kcrisman](#comment%3A2):\n> Can you be more elaborate about what you mean by this?  The description is remarkably cryptic.\n\n\nOK, I'll try.\n\n> But I think you mean the function tested in the function changed (correctly) in #13686.\n\n\nThe functions `r_version` and `version` in `r.py` are affected, also `source` and `_source`, this seems unrelated to #13686.\n\n> There is a good reason to test this function; it's a function in Sage, so it needs to be doctested. \n\n\nThe return values depend on the R version that is called.\nFor example newer R has additional `L` in the source. So in total, four doctests fail.\n\nWith this patch\n[http://trac.sagemath.org/changeset?new=628d5afab70880b7b7a24d3417d7ff996dbb816c&base=728e542453259b59b7e012f382e141652671d425&old=c29a7554ab4cfd9f0d17a8a242558db5b820b12a#file36](http://trac.sagemath.org/changeset?new=628d5afab70880b7b7a24d3417d7ff996dbb816c&base=728e542453259b59b7e012f382e141652671d425&old=c29a7554ab4cfd9f0d17a8a242558db5b820b12a#file36)\nthey pass (how can I point to a commit from here?).\n\n> Perhaps there is a nice clever way to test this without allowing just any old output like `((25,1,3), 'R version -3.2.x')` \n\n\nIf R is version -3.2.x, and `version` returns that, everything works correctly, doesn't it?\n\n> but that would need to be done.\n\n\nIt's difficult to tell which version is present without a `version` call... In which way would the other tests pass, if R is a wrong one?\n\n> so we shouldn't remove the function.  If that's not what you're implying, my apologies in advance.\n\n\nNo, I dont want to remove the checks, just allow the extra `L` and be a bit more tolerant about the version number.",
    "created_at": "2013-09-06T20:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230184",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:3'></a>
Replying to [kcrisman](#comment%3A2):
> Can you be more elaborate about what you mean by this?  The description is remarkably cryptic.


OK, I'll try.

> But I think you mean the function tested in the function changed (correctly) in #13686.


The functions `r_version` and `version` in `r.py` are affected, also `source` and `_source`, this seems unrelated to #13686.

> There is a good reason to test this function; it's a function in Sage, so it needs to be doctested. 


The return values depend on the R version that is called.
For example newer R has additional `L` in the source. So in total, four doctests fail.

With this patch
[http://trac.sagemath.org/changeset?new=628d5afab70880b7b7a24d3417d7ff996dbb816c&base=728e542453259b59b7e012f382e141652671d425&old=c29a7554ab4cfd9f0d17a8a242558db5b820b12a#file36](http://trac.sagemath.org/changeset?new=628d5afab70880b7b7a24d3417d7ff996dbb816c&base=728e542453259b59b7e012f382e141652671d425&old=c29a7554ab4cfd9f0d17a8a242558db5b820b12a#file36)
they pass (how can I point to a commit from here?).

> Perhaps there is a nice clever way to test this without allowing just any old output like `((25,1,3), 'R version -3.2.x')` 


If R is version -3.2.x, and `version` returns that, everything works correctly, doesn't it?

> but that would need to be done.


It's difficult to tell which version is present without a `version` call... In which way would the other tests pass, if R is a wrong one?

> so we shouldn't remove the function.  If that's not what you're implying, my apologies in advance.


No, I dont want to remove the checks, just allow the extra `L` and be a bit more tolerant about the version number.



---

archive/issue_comments_230185.json:
```json
{
    "body": "<a id='comment:4'></a>\nNeeds to be rebased.",
    "created_at": "2013-12-29T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230185",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Needs to be rebased.



---

archive/issue_comments_230186.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-12-29T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15158#issuecomment-230186",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_events_049702.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15158#event-49702"
}
```



---

archive/issue_events_049703.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15158#event-49703"
}
```



---

archive/issue_events_049704.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15158#event-49704"
}
```



---

archive/issue_events_049705.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15158#event-49705"
}
```



---

archive/issue_events_049706.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15158",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15158#event-49706"
}
```
