# Issue 15552: enumerate_totallyreal_fields_prim does not return polynomial as elements of a polynomial ring

archive/issues_015315.json:
```json
{
    "body": "The function `enumerate_totallyreal_fields_prim` is supposed to return, according to its description,\n\n```\n   OUTPUT:\n\n   the list of fields with entries \"[d,f]\", where \"d\" is the\n   discriminant and \"f\" is a defining polynomial, sorted by\n   discriminant.\n```\nLet us look at an output:\n\n```\nsage: E = enumerate_totallyreal_fields_prim(2, 10); E\n[[5, x^2 - x - 1], [8, x^2 - 2]]\nsage: E[0][1].parent()\nInterface to the PARI C library\n```\nWe notice from here that the polynomial does not actually belong to the polynomial ring of `QQ`. In fact, there is no nice way to directly get the polynomial, as in an element of `PolynomialRing(QQ)` from `E[0][1]`, which can be then used to construct the number field.\n\nThe only way to do this is this lengthy and tedious procedure:\n\n```\nsage: Ecoef = [QQ(_) for _ in E[0][1].list()]\nsage: x = polygen(QQ)\nsage: Epol = sum(x**i * _ for i,_ in enumerate(Ecoef)) \nsage: Epol, Epol.parent()\n(x^2 - x - 1, Univariate Polynomial Ring in x over Rational Field)\n```\n\nThe output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.\n\n---\n\nAdditionally,\n\n1. the first entry of each list should belong to Sage's `Integer` ring instead of being just a python `int`.\n2. the functions `enumerate_totallyreal_fields_all` and `enumerate_totallyreal_fields_rel` should get the same fix.\n\nBranch/Commit: 7e86783229f55e02a208c767747219d73261cdb0\n\nReviewer: Francis Clarke\n\nAuthor: Punarbasu Purkayastha\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15552\n\n",
    "closed_at": "2014-02-27T21:28:46Z",
    "created_at": "2013-12-20T08:44:48Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "enumerate_totallyreal_fields_prim does not return polynomial as elements of a polynomial ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15552",
    "user": "https://github.com/ppurka"
}
```
The function `enumerate_totallyreal_fields_prim` is supposed to return, according to its description,

```
   OUTPUT:

   the list of fields with entries "[d,f]", where "d" is the
   discriminant and "f" is a defining polynomial, sorted by
   discriminant.
```
Let us look at an output:

```
sage: E = enumerate_totallyreal_fields_prim(2, 10); E
[[5, x^2 - x - 1], [8, x^2 - 2]]
sage: E[0][1].parent()
Interface to the PARI C library
```
We notice from here that the polynomial does not actually belong to the polynomial ring of `QQ`. In fact, there is no nice way to directly get the polynomial, as in an element of `PolynomialRing(QQ)` from `E[0][1]`, which can be then used to construct the number field.

The only way to do this is this lengthy and tedious procedure:

```
sage: Ecoef = [QQ(_) for _ in E[0][1].list()]
sage: x = polygen(QQ)
sage: Epol = sum(x**i * _ for i,_ in enumerate(Ecoef)) 
sage: Epol, Epol.parent()
(x^2 - x - 1, Univariate Polynomial Ring in x over Rational Field)
```

The output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.

---

Additionally,

1. the first entry of each list should belong to Sage's `Integer` ring instead of being just a python `int`.
2. the functions `enumerate_totallyreal_fields_all` and `enumerate_totallyreal_fields_rel` should get the same fix.

Branch/Commit: 7e86783229f55e02a208c767747219d73261cdb0

Reviewer: Francis Clarke

Author: Punarbasu Purkayastha

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15552





---

archive/issue_comments_253476.json:
```json
{
    "body": "Replying to [ticket:15552 ppurka]:\n> [...]\n> In fact, there is no nice way to directly get the polynomial, as in an element of `PolynomialRing(QQ)`  [...]\n> \n> The only way to do this is this lengthy and tedious procedure:\n\n\n[...]\n\nIt's not that lengthy, but rather simpler is to relace the line\n> {{{\n> sage: Epol = sum(x**i * _ for i,_ in enumerate(Ecoef)) \n> }}}\n\nby\n\n```\nsage: Epol = x.parent()(Ecoef)\n```\n\n> The output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.\n\n\nYes, this should certainly be changed.  And it would also be better if the integer returned was a Sage `Integer`.  At the moment `E[0][0].factor()` fails.",
    "created_at": "2013-12-20T11:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253476",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Replying to [ticket:15552 ppurka]:
> [...]
> In fact, there is no nice way to directly get the polynomial, as in an element of `PolynomialRing(QQ)`  [...]
> 
> The only way to do this is this lengthy and tedious procedure:


[...]

It's not that lengthy, but rather simpler is to relace the line
> {{{
> sage: Epol = sum(x**i * _ for i,_ in enumerate(Ecoef)) 
> }}}

by

```
sage: Epol = x.parent()(Ecoef)
```

> The output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.


Yes, this should certainly be changed.  And it would also be better if the integer returned was a Sage `Integer`.  At the moment `E[0][0].factor()` fails.



---

archive/issue_comments_253477.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,10 @@\n ```\n \n The output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.\n+\n+---\n+\n+Additionally,\n+\n+1. the first entry of each list should belong to Sage's `Integer` ring instead of being just a python `int`.\n+2. the functions `enumerate_totallyreal_fields_all` and `enumerate_totallyreal_fields_rel` should get the same fix.\n``````\n",
    "created_at": "2013-12-20T11:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253477",
    "user": "https://github.com/ppurka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,10 @@
 ```
 
 The output of the function itself should give back elements of the polynomial ring, instead of giving us elements which are simply output of pari.
+
+---
+
+Additionally,
+
+1. the first entry of each list should belong to Sage's `Integer` ring instead of being just a python `int`.
+2. the functions `enumerate_totallyreal_fields_all` and `enumerate_totallyreal_fields_rel` should get the same fix.
``````




---

archive/issue_comments_253478.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [fwclarke](#comment%3A1):\n> Yes, this should certainly be changed.  And it would also be better if the integer returned was a Sage `Integer`.  At the moment `E[0][0].factor()` fails.\n\nIndeed.\n\nThis is also a problem with all the other `enumerate_totallyreal_*` functions.",
    "created_at": "2013-12-20T11:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253478",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:2'></a>
Replying to [fwclarke](#comment%3A1):
> Yes, this should certainly be changed.  And it would also be better if the integer returned was a Sage `Integer`.  At the moment `E[0][0].factor()` fails.

Indeed.

This is also a problem with all the other `enumerate_totallyreal_*` functions.



---

archive/issue_comments_253479.json:
```json
{
    "body": "<a id='comment:3'></a>\nAdding some patches to fix this. I introduce a new keyword that can be\nset to False to give Sage objects. By default, the new keyword does not\nchange the current behavior of these functions. This is needed because the\nfunctions are used internally, and possibly by others to.",
    "created_at": "2013-12-20T13:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253479",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:3'></a>
Adding some patches to fix this. I introduce a new keyword that can be
set to False to give Sage objects. By default, the new keyword does not
change the current behavior of these functions. This is needed because the
functions are used internally, and possibly by others to.



---

archive/issue_comments_253480.json:
```json
{
    "body": "Changing branch from \"\" to \"u/ppurka/ticket/15552\"",
    "created_at": "2013-12-20T14:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253480",
    "user": "https://github.com/ppurka"
}
```

Changing branch from "" to "u/ppurka/ticket/15552"



---

archive/issue_comments_253481.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-20T14:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253481",
    "user": "https://github.com/ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_253482.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe patches do not deal with the trivial `n=1` case of`enumerate_totallyreal_fields_prim`.  However, the code for this trivial case has *never* worked.  It needs to be moved earlier, before the line\n\n```\n    T = tr_data(n_int,B,a)\n```\nwhich causes an error when `n==1` (because of a call to `hermite_constant(0)`).  Similar remarks apply to `enumerate_totallyreal_fields_rel` when `m=1`.\n\nThere are many other problems with these functions: \n* poor documentation (e.g., the meaning of the four integers `counts` which are output when `return_seqs=True` is not explained); \n* other features not standard in Sage (e.g., built-in file output); \n* too few doctests; \n* over-dependence on PARI (e.g., the following works, as in the doctest:\n\n```\nsage: enumerate_totallyreal_fields_rel(NumberField(x^2 - 2, 't'), 2, 2000)\n[[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]]\n```\nbut\n\n```\nsage: enumerate_totallyreal_fields_rel(NumberField(x^2 - 2, 'a'), 2, 2000)\nTraceback (most recent call last)\n...\nPariError: incorrect type in gsigne\n```\nIn Sage, unlike PARI, the names of variable/generators should not matter.)\n\nBut I suppose these are for a different ticket.\n\n---\nNew commits:\n|                                                                                                         |                                            |\n|---------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[a31f831](https://github.com/sagemath/sagetrac-mirror/commit/a31f831)|`add more fixes for enumerate_totallyreal_*`|\n|[aa82d85](https://github.com/sagemath/sagetrac-mirror/commit/aa82d85)|`fix output of enumerate_totallyreal_*`|",
    "created_at": "2014-01-02T10:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253482",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:6'></a>
The patches do not deal with the trivial `n=1` case of`enumerate_totallyreal_fields_prim`.  However, the code for this trivial case has *never* worked.  It needs to be moved earlier, before the line

```
    T = tr_data(n_int,B,a)
```
which causes an error when `n==1` (because of a call to `hermite_constant(0)`).  Similar remarks apply to `enumerate_totallyreal_fields_rel` when `m=1`.

There are many other problems with these functions: 
* poor documentation (e.g., the meaning of the four integers `counts` which are output when `return_seqs=True` is not explained); 
* other features not standard in Sage (e.g., built-in file output); 
* too few doctests; 
* over-dependence on PARI (e.g., the following works, as in the doctest:

```
sage: enumerate_totallyreal_fields_rel(NumberField(x^2 - 2, 't'), 2, 2000)
[[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]]
```
but

```
sage: enumerate_totallyreal_fields_rel(NumberField(x^2 - 2, 'a'), 2, 2000)
Traceback (most recent call last)
...
PariError: incorrect type in gsigne
```
In Sage, unlike PARI, the names of variable/generators should not matter.)

But I suppose these are for a different ticket.

---
New commits:
|                                                                                                         |                                            |
|---------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[a31f831](https://github.com/sagemath/sagetrac-mirror/commit/a31f831)|`add more fixes for enumerate_totallyreal_*`|
|[aa82d85](https://github.com/sagemath/sagetrac-mirror/commit/aa82d85)|`fix output of enumerate_totallyreal_*`|



---

archive/issue_comments_253483.json:
```json
{
    "body": "Changing commit from \"\" to \"a31f831bfd92e4fa139d12f951b7b12be9a41c55\"",
    "created_at": "2014-01-02T10:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253483",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing commit from "" to "a31f831bfd92e4fa139d12f951b7b12be9a41c55"



---

archive/issue_comments_253484.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-02T10:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253484",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253485.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Francis Clarke\"",
    "created_at": "2014-01-02T10:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253485",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing reviewer from "" to "Francis Clarke"



---

archive/issue_comments_253486.json:
```json
{
    "body": "<a id='comment:7'></a>\nNumber theory is not my area at all. I just fixed what I could! I will have to ask a friend or colleague to understand the output.\n\nIf you have a ready explanation for the variables/output, please go ahead and add them to the documentation. These functions themselves are very old and poorly documented, as you have noticed.",
    "created_at": "2014-01-02T10:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253486",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:7'></a>
Number theory is not my area at all. I just fixed what I could! I will have to ask a friend or colleague to understand the output.

If you have a ready explanation for the variables/output, please go ahead and add them to the documentation. These functions themselves are very old and poorly documented, as you have noticed.



---

archive/issue_comments_253487.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [ppurka](#comment%3A7):\n> If you have a ready explanation for the variables/output, please go ahead and add them to the documentation. These functions themselves are very old and poorly documented, as you have noticed.\n\n\nI see that with `verbose=True` a brief description, but not one that I can fully understand, is given of the four counts.\n\nI would suggest making just the minimal changes required to allow Sage output and to cover the trivial cases and leaving it to someone who understands the algorithm (which I don't) to do the rewrite needed to modernise the functions.",
    "created_at": "2014-01-02T11:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253487",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:8'></a>
Replying to [ppurka](#comment%3A7):
> If you have a ready explanation for the variables/output, please go ahead and add them to the documentation. These functions themselves are very old and poorly documented, as you have noticed.


I see that with `verbose=True` a brief description, but not one that I can fully understand, is given of the four counts.

I would suggest making just the minimal changes required to allow Sage output and to cover the trivial cases and leaving it to someone who understands the algorithm (which I don't) to do the rewrite needed to modernise the functions.



---

archive/issue_comments_253488.json:
```json
{
    "body": "<a id='comment:9'></a>\nOk. I will do this next week, when my colleague will be back. `:-)`",
    "created_at": "2014-01-02T11:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253488",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:9'></a>
Ok. I will do this next week, when my colleague will be back. `:-)`



---

archive/issue_comments_253489.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[7ee1896](https://github.com/sagemath/sagetrac-mirror/commit/7ee1896cee3ed691e47b6bbecc480fc8602237ec)|`merge develop on to ticket #15552`|\n|[0cc8d70](https://github.com/sagemath/sagetrac-mirror/commit/0cc8d70d5489bb61763329c5553c968d9ec638ce)|`stop counting polynomials twice`|\n|[f78fa37](https://github.com/sagemath/sagetrac-mirror/commit/f78fa371cb78f3da5767ac6f7ea3e7171ce8b379)|`Ensure that value of n=1, m=1 works.`|\n|[d1767f9](https://github.com/sagemath/sagetrac-mirror/commit/d1767f9ccc641e6e298ed472724924dea4d79c36)|`fix the documentation for the enumerate_totally_real*`|\n|[980d38f](https://github.com/sagemath/sagetrac-mirror/commit/980d38f26ffc3ea8682f63b859e0bbf3e970006a)|`make sure the output for n=1, or m=1 is a sage object`|\n|[a4ec8a2](https://github.com/sagemath/sagetrac-mirror/commit/a4ec8a27113332bfe2e75355d2330de1b0b2a5de)|`doctest for _rel was incorrect`|\n|[d67b6c3](https://github.com/sagemath/sagetrac-mirror/commit/d67b6c35baf378c3362f38b8b8c8c8dcc661602f)|`the doctstring syntax is not latex syntax!`|",
    "created_at": "2014-01-11T13:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[7ee1896](https://github.com/sagemath/sagetrac-mirror/commit/7ee1896cee3ed691e47b6bbecc480fc8602237ec)|`merge develop on to ticket #15552`|
|[0cc8d70](https://github.com/sagemath/sagetrac-mirror/commit/0cc8d70d5489bb61763329c5553c968d9ec638ce)|`stop counting polynomials twice`|
|[f78fa37](https://github.com/sagemath/sagetrac-mirror/commit/f78fa371cb78f3da5767ac6f7ea3e7171ce8b379)|`Ensure that value of n=1, m=1 works.`|
|[d1767f9](https://github.com/sagemath/sagetrac-mirror/commit/d1767f9ccc641e6e298ed472724924dea4d79c36)|`fix the documentation for the enumerate_totally_real*`|
|[980d38f](https://github.com/sagemath/sagetrac-mirror/commit/980d38f26ffc3ea8682f63b859e0bbf3e970006a)|`make sure the output for n=1, or m=1 is a sage object`|
|[a4ec8a2](https://github.com/sagemath/sagetrac-mirror/commit/a4ec8a27113332bfe2e75355d2330de1b0b2a5de)|`doctest for _rel was incorrect`|
|[d67b6c3](https://github.com/sagemath/sagetrac-mirror/commit/d67b6c35baf378c3362f38b8b8c8c8dcc661602f)|`the doctstring syntax is not latex syntax!`|



---

archive/issue_comments_253490.json:
```json
{
    "body": "Changing commit from \"a31f831bfd92e4fa139d12f951b7b12be9a41c55\" to \"d67b6c35baf378c3362f38b8b8c8c8dcc661602f\"",
    "created_at": "2014-01-11T13:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a31f831bfd92e4fa139d12f951b7b12be9a41c55" to "d67b6c35baf378c3362f38b8b8c8c8dcc661602f"



---

archive/issue_comments_253491.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis is still not completely ready for review -- need to verify that the outputs are fine. But you can look into the changes if you want.\n\nI am actually not confident that the functions give the output corresponding to the documentation! The statements that we get with `verbose=True` do not match the output (for example the discriminant bound). I guess we can just fix the output here and leave the actual program to someone who knows this stuff inside out.\n\nHere is a sample run after my patches.\n\n```\nsage: ZZx = ZZ['x']\nsage: F.<t> = NumberField(x^2-2)\nsage: enumerate_totallyreal_fields_rel(F, 2, 2000, verbose=True) # m=2\n==> [t - 1, t + 1, 1] has discriminant 2624 > B\n==> [-1, t + 1, 1] has discriminant 2624 > B\n==> [-2, 1, 1] is not absolutely irreducible\n==> [-1, t, 1] has discriminant 2304 > B\n==> [t - 1, t, 1] is not squarefree\n==> [-t - 1, t, 1] is not squarefree\n==> [-2, 0, 1] is not squarefree\n==> [t - 2, 0, 1] has discriminant 2048 > B\n==> [-t - 2, 0, 1] has discriminant 2048 > B\n================================================================================\nPolynomials tested: 9\nPolynomials with discriminant with large enough square divisior: 6\nIrreducible polynomials: 5\nPolynomials with nfdisc <= B: 0\n[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]\n[[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]]\n\n\n# return_seqs returns four numbers corresponding to the numbers above\nsage: enumerate_totallyreal_fields_rel(F, 2, 2000, return_seqs=True)\n[[9, 6, 5, 0], [[1600, [4, 0, -6, 0, 1], [-1, 1, 1]]]]\n\n\n# Testing m=1 which wasn't working before\nsage: enumerate_totallyreal_fields_rel(F, 1, 2000, verbose=True) # m=1\n[[1, x - 1, [-2, 0, 1]]]\n\n\n-------------------------- SECOND FUNCTION ----------------------------\n\nLet us try the _all function which calls _rel\n\nsage: enumerate_totallyreal_fields_all(2, 10, return_seqs=True)\n[[0, 0, 0, 0], [[5, [-1, -1, 1]], [8, [-2, 0, 1]]]]\nsage: enumerate_totallyreal_fields_all(2, 10)\n[[5, x^2 - x - 1], [8, x^2 - 2]]\n\n# the verbose output\nsage: enumerate_totallyreal_fields_all(2, 10, verbose=True)\n================================================================================\nPolynomials tested: 0\nPolynomials with sssd poldisc: 0\nIrreducible polynomials: 0\nPolynomials with nfdisc <= B: 0\n[5, x^2 - x - 1]\n[8, x^2 - 2]\n================================================================================\nPolynomials tested: 0\nPolynomials with discriminant with large enough square divisior: 0\nIrreducible polynomials: 0\nPolynomials with nfdisc <= B: 0\n[5, x^2 - x - 1]\n[8, x^2 - 2]\n[[5, x^2 - x - 1], [8, x^2 - 2]]\n\n\n# the case n=1\nsage: enumerate_totallyreal_fields_all(1, 10, verbose=True)\n================================================================================\nPolynomials tested: 0\nPolynomials with discriminant with large enough square divisior: 0\nIrreducible polynomials: 0\nPolynomials with nfdisc <= B: 0\n[1, x - 1]\n[[1, x - 1]]\n\n\n----------------------- THIRD FUNCTION --------------------------------\n\n# the third function\nsage: enumerate_totallyreal_fields_prim(5,5**7)\n[[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],\n [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],\n [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],\n [38569, x^5 - 5*x^3 + 4*x - 1],\n [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],\n [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]]\n\n\nsage: enumerate_totallyreal_fields_prim(5,5**7,verbose=True)\n================================================================================\nPolynomials tested: 953\nPolynomials with sssd poldisc: 359\nIrreducible polynomials: 191\nPolynomials with nfdisc <= B: 38\n[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1]\n[24217, x^5 - 5*x^3 - x^2 + 3*x + 1]\n[36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1]\n[38569, x^5 - 5*x^3 + 4*x - 1]\n[65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1]\n[70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]\n[[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],\n [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],\n [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],\n [38569, x^5 - 5*x^3 + 4*x - 1],\n [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],\n [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]]\n\n# the case n = 1\nsage: enumerate_totallyreal_fields_prim(1,7, verbose=True)\n[[1, x - 1]]\n```",
    "created_at": "2014-01-11T13:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253491",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:11'></a>
This is still not completely ready for review -- need to verify that the outputs are fine. But you can look into the changes if you want.

I am actually not confident that the functions give the output corresponding to the documentation! The statements that we get with `verbose=True` do not match the output (for example the discriminant bound). I guess we can just fix the output here and leave the actual program to someone who knows this stuff inside out.

Here is a sample run after my patches.

```
sage: ZZx = ZZ['x']
sage: F.<t> = NumberField(x^2-2)
sage: enumerate_totallyreal_fields_rel(F, 2, 2000, verbose=True) # m=2
==> [t - 1, t + 1, 1] has discriminant 2624 > B
==> [-1, t + 1, 1] has discriminant 2624 > B
==> [-2, 1, 1] is not absolutely irreducible
==> [-1, t, 1] has discriminant 2304 > B
==> [t - 1, t, 1] is not squarefree
==> [-t - 1, t, 1] is not squarefree
==> [-2, 0, 1] is not squarefree
==> [t - 2, 0, 1] has discriminant 2048 > B
==> [-t - 2, 0, 1] has discriminant 2048 > B
================================================================================
Polynomials tested: 9
Polynomials with discriminant with large enough square divisior: 6
Irreducible polynomials: 5
Polynomials with nfdisc <= B: 0
[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]
[[1600, x^4 - 6*x^2 + 4, xF^2 + xF - 1]]


# return_seqs returns four numbers corresponding to the numbers above
sage: enumerate_totallyreal_fields_rel(F, 2, 2000, return_seqs=True)
[[9, 6, 5, 0], [[1600, [4, 0, -6, 0, 1], [-1, 1, 1]]]]


# Testing m=1 which wasn't working before
sage: enumerate_totallyreal_fields_rel(F, 1, 2000, verbose=True) # m=1
[[1, x - 1, [-2, 0, 1]]]


-------------------------- SECOND FUNCTION ----------------------------

Let us try the _all function which calls _rel

sage: enumerate_totallyreal_fields_all(2, 10, return_seqs=True)
[[0, 0, 0, 0], [[5, [-1, -1, 1]], [8, [-2, 0, 1]]]]
sage: enumerate_totallyreal_fields_all(2, 10)
[[5, x^2 - x - 1], [8, x^2 - 2]]

# the verbose output
sage: enumerate_totallyreal_fields_all(2, 10, verbose=True)
================================================================================
Polynomials tested: 0
Polynomials with sssd poldisc: 0
Irreducible polynomials: 0
Polynomials with nfdisc <= B: 0
[5, x^2 - x - 1]
[8, x^2 - 2]
================================================================================
Polynomials tested: 0
Polynomials with discriminant with large enough square divisior: 0
Irreducible polynomials: 0
Polynomials with nfdisc <= B: 0
[5, x^2 - x - 1]
[8, x^2 - 2]
[[5, x^2 - x - 1], [8, x^2 - 2]]


# the case n=1
sage: enumerate_totallyreal_fields_all(1, 10, verbose=True)
================================================================================
Polynomials tested: 0
Polynomials with discriminant with large enough square divisior: 0
Irreducible polynomials: 0
Polynomials with nfdisc <= B: 0
[1, x - 1]
[[1, x - 1]]


----------------------- THIRD FUNCTION --------------------------------

# the third function
sage: enumerate_totallyreal_fields_prim(5,5**7)
[[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],
 [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],
 [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],
 [38569, x^5 - 5*x^3 + 4*x - 1],
 [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],
 [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]]


sage: enumerate_totallyreal_fields_prim(5,5**7,verbose=True)
================================================================================
Polynomials tested: 953
Polynomials with sssd poldisc: 359
Irreducible polynomials: 191
Polynomials with nfdisc <= B: 38
[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1]
[24217, x^5 - 5*x^3 - x^2 + 3*x + 1]
[36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1]
[38569, x^5 - 5*x^3 + 4*x - 1]
[65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1]
[70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]
[[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],
 [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],
 [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],
 [38569, x^5 - 5*x^3 + 4*x - 1],
 [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],
 [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1]]

# the case n = 1
sage: enumerate_totallyreal_fields_prim(1,7, verbose=True)
[[1, x - 1]]
```



---

archive/issue_comments_253492.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[550bce7](https://github.com/sagemath/sagetrac-mirror/commit/550bce7a255b72caadcf7c64e7e925898a0f9fc9)|`Merge remote-tracking branch 'origin/develop' into ticket/15552`|\n|[f66afcc](https://github.com/sagemath/sagetrac-mirror/commit/f66afcc9a249d951ca839bb58fc8d3faee766cfb)|`Fix order of output for m=1`|",
    "created_at": "2014-01-19T05:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[550bce7](https://github.com/sagemath/sagetrac-mirror/commit/550bce7a255b72caadcf7c64e7e925898a0f9fc9)|`Merge remote-tracking branch 'origin/develop' into ticket/15552`|
|[f66afcc](https://github.com/sagemath/sagetrac-mirror/commit/f66afcc9a249d951ca839bb58fc8d3faee766cfb)|`Fix order of output for m=1`|



---

archive/issue_comments_253493.json:
```json
{
    "body": "Changing commit from \"d67b6c35baf378c3362f38b8b8c8c8dcc661602f\" to \"f66afcc9a249d951ca839bb58fc8d3faee766cfb\"",
    "created_at": "2014-01-19T05:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d67b6c35baf378c3362f38b8b8c8c8dcc661602f" to "f66afcc9a249d951ca839bb58fc8d3faee766cfb"



---

archive/issue_comments_253494.json:
```json
{
    "body": "<a id='comment:13'></a>\nFinal fix is the output for `m=1`. Thanks to my friend Xiaolu Hou for\npointing out the error. The doctest contains the corrected output now.",
    "created_at": "2014-01-19T05:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253494",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:13'></a>
Final fix is the output for `m=1`. Thanks to my friend Xiaolu Hou for
pointing out the error. The doctest contains the corrected output now.



---

archive/issue_comments_253495.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-19T05:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253495",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_051927.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15552#event-51927"
}
```



---

archive/issue_comments_253496.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-13T11:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253496",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_253497.json:
```json
{
    "body": "<a id='comment:16'></a>\nAll looks good.",
    "created_at": "2014-02-13T11:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253497",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:16'></a>
All looks good.



---

archive/issue_comments_253498.json:
```json
{
    "body": "Changing author from \"\" to \"Punarbasu Purkayastha\"",
    "created_at": "2014-02-22T06:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253498",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Punarbasu Purkayastha"



---

archive/issue_comments_253499.json:
```json
{
    "body": "<a id='comment:18'></a>\nDocumentation does not build\n\n```\n[number_fi] /home/release/Sage/local/lib/python2.7/site-packages/sage/rings/number_field/totallyreal_rel.py:docstring of sage.rings.number_field.totallyreal_rel:37: WARNING: Bullet list ends without a blank line; unexpected unindent.\nTraceback (most recent call last):\n  File \"/home/release/Sage/src/doc/common/builder.py\", line 83, in f\n    execfile(sys.argv[0])\n  File \"/home/release/Sage/src/doc/common/custom-sphinx-build.py\", line 185, in <module>\n    sphinx.cmdline.main(sys.argv)\n  File \"/home/release/Sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/cmdline.py\", line 206, in main\n    print >>error\n  File \"/home/release/Sage/src/doc/common/custom-sphinx-build.py\", line 165, in write\n    self._write(str)\n  File \"/home/release/Sage/src/doc/common/custom-sphinx-build.py\", line 139, in _write\n    self._log_line(line)\n  File \"/home/release/Sage/src/doc/common/custom-sphinx-build.py\", line 108, in _log_line\n    raise OSError(line)\nOSError: [number_fi] /home/release/Sage/local/lib/python2.7/site-packages/sage/rings/number_field/totallyreal_rel.py:docstring of sage.rings.number_field.totallyreal_rel:37: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```",
    "created_at": "2014-02-22T07:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253499",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
Documentation does not build

```
[number_fi] /home/release/Sage/local/lib/python2.7/site-packages/sage/rings/number_field/totallyreal_rel.py:docstring of sage.rings.number_field.totallyreal_rel:37: WARNING: Bullet list ends without a blank line; unexpected unindent.
Traceback (most recent call last):
  File "/home/release/Sage/src/doc/common/builder.py", line 83, in f
    execfile(sys.argv[0])
  File "/home/release/Sage/src/doc/common/custom-sphinx-build.py", line 185, in <module>
    sphinx.cmdline.main(sys.argv)
  File "/home/release/Sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/cmdline.py", line 206, in main
    print >>error
  File "/home/release/Sage/src/doc/common/custom-sphinx-build.py", line 165, in write
    self._write(str)
  File "/home/release/Sage/src/doc/common/custom-sphinx-build.py", line 139, in _write
    self._log_line(line)
  File "/home/release/Sage/src/doc/common/custom-sphinx-build.py", line 108, in _log_line
    raise OSError(line)
OSError: [number_fi] /home/release/Sage/local/lib/python2.7/site-packages/sage/rings/number_field/totallyreal_rel.py:docstring of sage.rings.number_field.totallyreal_rel:37: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

archive/issue_comments_253500.json:
```json
{
    "body": "<a id='comment:19'></a>\nThat's strange.\n\nI don't have the latest dev version on my laptop. Will take me a day to fix this.",
    "created_at": "2014-02-22T08:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253500",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:19'></a>
That's strange.

I don't have the latest dev version on my laptop. Will take me a day to fix this.



---

archive/issue_comments_253501.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[026336a](https://github.com/sagemath/sagetrac-mirror/commit/026336add4fef6bdb5bbfb6e01b2accd77f8791f)|`Merge branch 'develop' into ticket/15552`|\n|[7e86783](https://github.com/sagemath/sagetrac-mirror/commit/7e86783229f55e02a208c767747219d73261cdb0)|`fix broken documentation build.`|",
    "created_at": "2014-02-23T07:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[026336a](https://github.com/sagemath/sagetrac-mirror/commit/026336add4fef6bdb5bbfb6e01b2accd77f8791f)|`Merge branch 'develop' into ticket/15552`|
|[7e86783](https://github.com/sagemath/sagetrac-mirror/commit/7e86783229f55e02a208c767747219d73261cdb0)|`fix broken documentation build.`|



---

archive/issue_comments_253502.json:
```json
{
    "body": "Changing commit from \"f66afcc9a249d951ca839bb58fc8d3faee766cfb\" to \"7e86783229f55e02a208c767747219d73261cdb0\"",
    "created_at": "2014-02-23T07:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f66afcc9a249d951ca839bb58fc8d3faee766cfb" to "7e86783229f55e02a208c767747219d73261cdb0"



---

archive/issue_comments_253503.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-02-23T07:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_253504.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-23T07:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253504",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_253505.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis should be fixed now.",
    "created_at": "2014-02-23T07:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253505",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:21'></a>
This should be fixed now.



---

archive/issue_events_051928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-27T21:28:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15552#event-51928"
}
```



---

archive/issue_comments_253506.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-27T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253506",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_253507.json:
```json
{
    "body": "Changing branch from \"u/ppurka/ticket/15552\" to \"7e86783229f55e02a208c767747219d73261cdb0\"",
    "created_at": "2014-02-27T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15552#issuecomment-253507",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/ppurka/ticket/15552" to "7e86783229f55e02a208c767747219d73261cdb0"
