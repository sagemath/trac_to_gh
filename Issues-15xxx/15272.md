# Issue 15272: Bruhat posets and Bruhat graphs for parabolic subgroups of finite Weyl groups

archive/issues_015035.json:
```json
{
    "assignees": [],
    "body": "This patch adds method minimal_representatives and extends the functionality of bruhat_poset and bruhat_graphs.\n\nLet W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \\ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.\n\nThis patch adds a parameters index_set (= S), crossed_nodes and side (left / right).\n\nCC:  @nthiery @dwbump @tscrim @anneschilling\n\nBranch/Commit: **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272) @ [64ea7c8](https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7)**\n\nAuthor: **V\u00edt Tu\u010dek**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15272_\n\n",
    "created_at": "2013-10-12T21:52:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bruhat posets and Bruhat graphs for parabolic subgroups of finite Weyl groups",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/15272",
    "user": "https://github.com/vit-tucek"
}
```
This patch adds method minimal_representatives and extends the functionality of bruhat_poset and bruhat_graphs.

Let W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.

This patch adds a parameters index_set (= S), crossed_nodes and side (left / right).

CC:  @nthiery @dwbump @tscrim @anneschilling

Branch/Commit: **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272) @ [64ea7c8](https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7)**

Author: **Vít Tuček**

_Issue created by migration from https://trac.sagemath.org/ticket/15272_





---

archive/issue_events_199733.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2013-10-12T21:52:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199733"
}
```



---

archive/issue_events_199734.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2013-10-12T21:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199734"
}
```



---

archive/issue_events_199735.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2013-10-12T21:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199735"
}
```



---

archive/issue_events_199736.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2013-10-12T21:52:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199736"
}
```



---

archive/issue_events_199737.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2013-12-03T11:12:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199737"
}
```



---

archive/issue_comments_190951.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nAttachment: **[trac_15272_parabolic_bruhat_posets.patch.gz](https://github.com/sagemath/sage/files/ticket15272/trac_15272_parabolic_bruhat_posets.patch.gz)**",
    "created_at": "2013-12-03T11:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190951",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:1'>Comment 1:</a>
Attachment: **[trac_15272_parabolic_bruhat_posets.patch.gz](https://github.com/sagemath/sage/files/ticket15272/trac_15272_parabolic_bruhat_posets.patch.gz)**



---

archive/issue_comments_190952.json:
```json
{
    "body": "Author: **V\u00edt Tu\u010dek**",
    "created_at": "2013-12-03T11:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190952",
    "user": "https://github.com/vit-tucek"
}
```

Author: **Vít Tuček**



---

archive/issue_events_199738.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199738"
}
```



---

archive/issue_events_199739.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199739"
}
```



---

archive/issue_comments_190953.json:
```json
{
    "body": "Branch: **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)**",
    "created_at": "2014-03-18T17:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190953",
    "user": "https://github.com/vit-tucek"
}
```

Branch: **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)**



---

archive/issue_events_199740.json:
```json
{
    "actor": "https://github.com/vit-tucek",
    "created_at": "2014-03-18T17:51:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "title_is": "Bruhat posets and Bruhat graphs for parabolic subgroups of finite Weyl groups",
    "title_was": "Bruhat posets and Bruhat graphs for parabolic subgroups",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199740"
}
```



---

archive/issue_comments_190954.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,5 @@\n-This patch extends the functionality of bruhat_poset and introduces new parabolic_bruhat_graph for finite Weyl groups. \n+This patch adds method minimal_representatives and extends the functionality of bruhat_poset and bruhat_graphs.\n \n Let W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \\ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.\n \n-This patch adds a parameters index_set (= S) and side (left / right).\n-\n-\n----\n-\n-\n-Introducing parabolic_bruhat_graph is ugly. Ideally, one would just extend the existing bruhat_graph. However, this method is based upon bruhat_interval which belongs to categories/coxeter_groups.py \n-\n-I was unsure where to put the code, which I haven't written yet nor which I need  in the foreseeable future anyway. Since it seems that the best course of action would be to implement class (or category?) for parabolic subroot systems / groups I think that one more method for Weyl group is not much of an issue.\n+This patch adds a parameters index_set (= S), crossed_nodes and side (left / right).\n``````\n",
    "created_at": "2014-03-18T17:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190954",
    "user": "https://github.com/vit-tucek"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,5 @@
-This patch extends the functionality of bruhat_poset and introduces new parabolic_bruhat_graph for finite Weyl groups. 
+This patch adds method minimal_representatives and extends the functionality of bruhat_poset and bruhat_graphs.
 
 Let W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.
 
-This patch adds a parameters index_set (= S) and side (left / right).
-
-
----
-
-
-Introducing parabolic_bruhat_graph is ugly. Ideally, one would just extend the existing bruhat_graph. However, this method is based upon bruhat_interval which belongs to categories/coxeter_groups.py 
-
-I was unsure where to put the code, which I haven't written yet nor which I need  in the foreseeable future anyway. Since it seems that the best course of action would be to implement class (or category?) for parabolic subroot systems / groups I think that one more method for Weyl group is not much of an issue.
+This patch adds a parameters index_set (= S), crossed_nodes and side (left / right).
``````




---

archive/issue_comments_190955.json:
```json
{
    "body": "Commit: **[472c090](https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53)**",
    "created_at": "2014-03-18T17:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190955",
    "user": "https://github.com/vit-tucek"
}
```

Commit: **[472c090](https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53)**



---

archive/issue_comments_190956.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb7c3b3c9864b6a82b9bc87464d9076ad05ebb1\">7bb7c3b</a></td><td><code>Decorate ClassicalWeylSubgroup.simple_reflections() with @cached_method.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6db7b6d186ef715f647c848820b22d4cc7c23110\">6db7b6d</a></td><td><code>First version of minimal coset representatives.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53\">472c090</a></td><td><code>Add parabolic minimal_coset_representatives, bruhat_graph and bruhat_poset</code></td></tr></table>\n",
    "created_at": "2014-03-18T17:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190956",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:4'>Comment 4:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb7c3b3c9864b6a82b9bc87464d9076ad05ebb1">7bb7c3b</a></td><td><code>Decorate ClassicalWeylSubgroup.simple_reflections() with @cached_method.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6db7b6d186ef715f647c848820b22d4cc7c23110">6db7b6d</a></td><td><code>First version of minimal coset representatives.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53">472c090</a></td><td><code>Add parabolic minimal_coset_representatives, bruhat_graph and bruhat_poset</code></td></tr></table>




---

archive/issue_comments_190957.json:
```json
{
    "body": "Changed commit from **[472c090](https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53)** to **[92888b3](https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757)**",
    "created_at": "2014-03-19T12:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190957",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[472c090](https://github.com/sagemath/sagetrac-mirror/commit/472c0908fba197fe9bb73742caab1ebfcde27b53)** to **[92888b3](https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757)**



---

archive/issue_comments_190958.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/860f635db87e1dc8290e956f8c28ec3ef2099456\">860f635</a></td><td><code>Edge labels and other improvements in bruhat_graph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757\">92888b3</a></td><td><code>Raise NotImplementedError in minimal_representatives for infinite W</code></td></tr></table>\n",
    "created_at": "2014-03-19T12:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190958",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/860f635db87e1dc8290e956f8c28ec3ef2099456">860f635</a></td><td><code>Edge labels and other improvements in bruhat_graph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757">92888b3</a></td><td><code>Raise NotImplementedError in minimal_representatives for infinite W</code></td></tr></table>




---

archive/issue_comments_190959.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThere is a merge conflict with develop:\n\n```\n        x = x.coset_representative(index_set,side)\n        y = y.coset_representative(index_set,side)\n        g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)\n        ref = self.reflections()\n        d = {}\n        for x in g:\n<<<<<<< HEAD\n            d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]\n=======\n            d[x] = {}\n            for y in g:\n                if side == \"right\":\n                    r = y*x.inverse()\n                else:\n                    r = x.inverse()*y\n                if x.length() < y.length() and ref.has_key(r):\n                    d[x][y] = r\n>>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757\n        return DiGraph(d)\n```\nI'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the \"for y in g\" loop and the dictionary rather than the list). If this is wrong, please let me know.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d\">1b1220d</a></td><td><code>manual merge commit due to conflict with develop</code></td></tr></table>\n",
    "created_at": "2014-03-25T23:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190959",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:7'>Comment 7:</a>
There is a merge conflict with develop:

```
        x = x.coset_representative(index_set,side)
        y = y.coset_representative(index_set,side)
        g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)
        ref = self.reflections()
        d = {}
        for x in g:
<<<<<<< HEAD
            d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]
=======
            d[x] = {}
            for y in g:
                if side == "right":
                    r = y*x.inverse()
                else:
                    r = x.inverse()*y
                if x.length() < y.length() and ref.has_key(r):
                    d[x][y] = r
>>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757
        return DiGraph(d)
```
I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the "for y in g" loop and the dictionary rather than the list). If this is wrong, please let me know.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d">1b1220d</a></td><td><code>manual merge commit due to conflict with develop</code></td></tr></table>




---

archive/issue_comments_190960.json:
```json
{
    "body": "Changed commit from **[92888b3](https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757)** to **[1b1220d](https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d)**",
    "created_at": "2014-03-25T23:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190960",
    "user": "https://github.com/darijgr"
}
```

Changed commit from **[92888b3](https://github.com/sagemath/sagetrac-mirror/commit/92888b345acb3f6726c1d38ab16d4f1366fbb757)** to **[1b1220d](https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d)**



---

archive/issue_comments_190961.json:
```json
{
    "body": "Changed branch from **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)** to **[public/combinat/15272](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/15272)**",
    "created_at": "2014-03-25T23:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190961",
    "user": "https://github.com/darijgr"
}
```

Changed branch from **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)** to **[public/combinat/15272](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/15272)**



---

archive/issue_comments_190962.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThat said, what do you think about pulling the `if side == \"right\"` check outside of the loop, so as to not repeat it over and over?",
    "created_at": "2014-03-25T23:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190962",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'>Comment 8:</a>
That said, what do you think about pulling the `if side == "right"` check outside of the loop, so as to not repeat it over and over?



---

archive/issue_comments_190963.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nOh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)",
    "created_at": "2014-03-25T23:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190963",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:9'>Comment 9:</a>
Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)



---

archive/issue_comments_190964.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThe `has_key` is being deprecated (removed?) in python3 in favor of the `in` syntax (which I believe is faster...?). Also I agree with Darij since this loop is so small, I'd pull the `side == \"right\"` statement outside as:\n\n```\nif side == \"right\":\n    for y in g:\n        r = y*x.inverse()\n    if x.length() < y.length() and r in ref:\n        d[x][y] = r\nelse:\n    for y in g:\n        r = x.inverse()*y\n    if x.length() < y.length() and r in ref:\n        d[x][y] = r\n```",
    "created_at": "2014-03-26T02:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190964",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'>Comment 10:</a>
The `has_key` is being deprecated (removed?) in python3 in favor of the `in` syntax (which I believe is faster...?). Also I agree with Darij since this loop is so small, I'd pull the `side == "right"` statement outside as:

```
if side == "right":
    for y in g:
        r = y*x.inverse()
    if x.length() < y.length() and r in ref:
        d[x][y] = r
else:
    for y in g:
        r = x.inverse()*y
    if x.length() < y.length() and r in ref:
        d[x][y] = r
```



---

archive/issue_comments_190965.json:
```json
{
    "body": "Changed branch from **[public/combinat/15272](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/15272)** to **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)**",
    "created_at": "2014-03-26T14:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190965",
    "user": "https://github.com/vit-tucek"
}
```

Changed branch from **[public/combinat/15272](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/15272)** to **[u/vittucek/ticket/15272](https://github.com/sagemath/sagetrac-mirror/tree/u/vittucek/ticket/15272)**



---

archive/issue_comments_190966.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@darijgr](#comment%3A7):\n> There is a merge conflict with develop:\n> \n> ```\n>         x = x.coset_representative(index_set,side)\n>         y = y.coset_representative(index_set,side)\n>         g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)\n>         ref = self.reflections()\n>         d = {}\n>         for x in g:\n> <<<<<<< HEAD\n>             d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]\n> =======\n>             d[x] = {}\n>             for y in g:\n>                 if side == \"right\":\n>                     r = y*x.inverse()\n>                 else:\n>                     r = x.inverse()*y\n>                 if x.length() < y.length() and ref.has_key(r):\n>                     d[x][y] = r\n> >>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757\n>         return DiGraph(d)\n> ```\n> I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the \"for y in g\" loop and the dictionary rather than the list). If this is wrong, please let me know.\n> \n> ---\n\nThanks!  I've made the change you've requested (and moreover I've switched the order of tests to benefit from short-circuiting. I didn't know how to add the patch on top of your branch (insufficient permissions?) so I just went with what `sage -dev push` suggested. I hope that's fine.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf\">b1e25e6</a></td><td><code>Performance enhancement in bruhat_graph</code></td></tr></table>\n",
    "created_at": "2014-03-26T14:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190966",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@darijgr](#comment%3A7):
> There is a merge conflict with develop:
> 
> ```
>         x = x.coset_representative(index_set,side)
>         y = y.coset_representative(index_set,side)
>         g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)
>         ref = self.reflections()
>         d = {}
>         for x in g:
> <<<<<<< HEAD
>             d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]
> =======
>             d[x] = {}
>             for y in g:
>                 if side == "right":
>                     r = y*x.inverse()
>                 else:
>                     r = x.inverse()*y
>                 if x.length() < y.length() and ref.has_key(r):
>                     d[x][y] = r
> >>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757
>         return DiGraph(d)
> ```
> I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the "for y in g" loop and the dictionary rather than the list). If this is wrong, please let me know.
> 
> ---

Thanks!  I've made the change you've requested (and moreover I've switched the order of tests to benefit from short-circuiting. I didn't know how to add the patch on top of your branch (insufficient permissions?) so I just went with what `sage -dev push` suggested. I hope that's fine.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf">b1e25e6</a></td><td><code>Performance enhancement in bruhat_graph</code></td></tr></table>




---

archive/issue_comments_190967.json:
```json
{
    "body": "Changed commit from **[1b1220d](https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d)** to **[b1e25e6](https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf)**",
    "created_at": "2014-03-26T14:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190967",
    "user": "https://github.com/vit-tucek"
}
```

Changed commit from **[1b1220d](https://github.com/sagemath/sagetrac-mirror/commit/1b1220d530e96cbfaf0927c539475327891e027d)** to **[b1e25e6](https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf)**



---

archive/issue_comments_190968.json:
```json
{
    "body": "Changed commit from **[b1e25e6](https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf)** to **[64ea7c8](https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7)**",
    "created_at": "2014-03-26T20:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190968",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b1e25e6](https://github.com/sagemath/sagetrac-mirror/commit/b1e25e678525b169df881ef8312ecf30e64d3adf)** to **[64ea7c8](https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7)**



---

archive/issue_comments_190969.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7\">64ea7c8</a></td><td><code>Bugfix: FiniteFamily is not a dictionary!</code></td></tr></table>\n",
    "created_at": "2014-03-26T20:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190969",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64ea7c8216c4d0eb5cc39a648a629d4dd79ad5b7">64ea7c8</a></td><td><code>Bugfix: FiniteFamily is not a dictionary!</code></td></tr></table>




---

archive/issue_comments_190970.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@darijgr](#comment%3A9):\n> Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)\n\nEhm. I have done this change too hastily. As it turns out `ref` is not a dictionary but a `FiniteFamily` which means that its `__contains__` method looks at the values. It's `__contains__` method was changed #15784 to use `in` in favor of `has_key`.",
    "created_at": "2014-03-26T20:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190970",
    "user": "https://github.com/vit-tucek"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@darijgr](#comment%3A9):
> Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)

Ehm. I have done this change too hastily. As it turns out `ref` is not a dictionary but a `FiniteFamily` which means that its `__contains__` method looks at the values. It's `__contains__` method was changed #15784 to use `in` in favor of `has_key`.



---

archive/issue_events_199741.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199741"
}
```



---

archive/issue_events_199742.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199742"
}
```



---

archive/issue_events_199743.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199743"
}
```



---

archive/issue_events_199744.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199744"
}
```



---

archive/issue_comments_190971.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\ndoes not apply",
    "created_at": "2015-04-21T16:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15272#issuecomment-190971",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>Comment 17:</a>
does not apply



---

archive/issue_events_199745.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-21T16:17:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199745"
}
```



---

archive/issue_events_199746.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-21T16:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199746"
}
```



---

archive/issue_events_199747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15272",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15272#event-199747"
}
```
