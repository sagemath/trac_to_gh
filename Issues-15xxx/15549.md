# Issue 15549: Streamline construction of PARI objects

archive/issues_015312.json:
```json
{
    "body": "Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.\n\nBefore:\n\n```\nsage: %timeit -r 1 pari(0)\n1000000 loops, best of 1: 1.02 us per loop\n```\nAfter:\n\n```\nsage: %timeit -r 1 pari(0)\n1000000 loops, best of 1: 875 ns per loop\n```\n\nAlso modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.\n\nCC:  @jdemeyer\n\nKeywords: pari performance\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nBranch: u/jdemeyer/ticket/15549\n\nDependencies: #15461\n\nCommit: 5713c53af6e5caa3c993daf2ba41ba88b473ff33\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15549\n\n",
    "closed_at": "2014-01-05T00:32:07Z",
    "created_at": "2013-12-19T13:37:14Z",
    "labels": [
        "component: interfaces",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Streamline construction of PARI objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15549",
    "user": "https://github.com/pjbruin"
}
```
Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.

Before:

```
sage: %timeit -r 1 pari(0)
1000000 loops, best of 1: 1.02 us per loop
```
After:

```
sage: %timeit -r 1 pari(0)
1000000 loops, best of 1: 875 ns per loop
```

Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.

CC:  @jdemeyer

Keywords: pari performance

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Branch: u/jdemeyer/ticket/15549

Dependencies: #15461

Commit: 5713c53af6e5caa3c993daf2ba41ba88b473ff33

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15549





---

archive/issue_comments_248593.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,15 @@\n-Clean up the construction of PARI objects by inlining some functions.\n+Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.\n+\n+Before:\n+\n+```\n+sage: %timeit -r 1 pari(0)\n+1000000 loops, best of 1: 1.02 us per loop\n+```\n+After:\n+\n+```\n+sage: %timeit -r 1 pari(0)\n+1000000 loops, best of 1: 875 us per loop\n+```\n+\n``````\n",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248593",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,15 @@
-Clean up the construction of PARI objects by inlining some functions.
+Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.
+
+Before:
+
+```
+sage: %timeit -r 1 pari(0)
+1000000 loops, best of 1: 1.02 us per loop
+```
+After:
+
+```
+sage: %timeit -r 1 pari(0)
+1000000 loops, best of 1: 875 us per loop
+```
+
``````




---

archive/issue_comments_248594.json:
```json
{
    "body": "Changing keywords from \"\" to \"pari performance\".",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248594",
    "user": "https://github.com/pjbruin"
}
```

Changing keywords from "" to "pari performance".



---

archive/issue_comments_248595.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#15461\"",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248595",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#15461"



---

archive/issue_comments_248596.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Bruin\"",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248596",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "" to "Peter Bruin"



---

archive/issue_comments_248597.json:
```json
{
    "body": "<a id='comment:2'></a>\nAre you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.",
    "created_at": "2013-12-19T14:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248597",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.



---

archive/issue_comments_248598.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/15549-pari_gen_construction\"",
    "created_at": "2013-12-19T15:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248598",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/15549-pari_gen_construction"



---

archive/issue_comments_248599.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jdemeyer](#comment%3A2):\n> Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.\n\nThat was a typo; I don't know why I didn't simply copy-paste this...\n\n---\nLast 10 new commits:\n|                                                                                                         |                                   |\n|---------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[7a98efb](http://git.sagemath.org/sage.git/commit/?id=7a98efb)|streamline construction of PARI gen|\n|[5bb8f8d](http://git.sagemath.org/sage.git/commit/?id=5bb8f8d)|remove commented-out method gen.python()|\n|[3fa4f1d](http://git.sagemath.org/sage.git/commit/?id=3fa4f1d)|remove redundant methods from sage.libs.pari.gen|\n|[511f05b](http://git.sagemath.org/sage.git/commit/?id=511f05b)|remove global variable mytop|\n|[866f7fd](http://git.sagemath.org/sage.git/commit/?id=866f7fd)|remove methods sage.libs.pari.gen.*_unsafe|\n|[05b93b7](http://git.sagemath.org/sage.git/commit/?id=05b93b7)|remove \"pbw\" as an abbreviation for \"prec_bits_to_words\"|\n|[95a622a](http://git.sagemath.org/sage.git/commit/?id=95a622a)|better fix for real_double.pyx|\n|[11a3bfb](http://git.sagemath.org/sage.git/commit/?id=11a3bfb)|more fixes related to relocation of PariInstance|\n|[34013cc](http://git.sagemath.org/sage.git/commit/?id=34013cc)|fixes in sage.libs.pari|\n|[db8cd7e](http://git.sagemath.org/sage.git/commit/?id=db8cd7e)|top-level changes related to PariInstance|",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248599",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
Replying to [jdemeyer](#comment%3A2):
> Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.

That was a typo; I don't know why I didn't simply copy-paste this...

---
Last 10 new commits:
|                                                                                                         |                                   |
|---------------------------------------------------------------------------------------------------------|-----------------------------------|
|[7a98efb](http://git.sagemath.org/sage.git/commit/?id=7a98efb)|streamline construction of PARI gen|
|[5bb8f8d](http://git.sagemath.org/sage.git/commit/?id=5bb8f8d)|remove commented-out method gen.python()|
|[3fa4f1d](http://git.sagemath.org/sage.git/commit/?id=3fa4f1d)|remove redundant methods from sage.libs.pari.gen|
|[511f05b](http://git.sagemath.org/sage.git/commit/?id=511f05b)|remove global variable mytop|
|[866f7fd](http://git.sagemath.org/sage.git/commit/?id=866f7fd)|remove methods sage.libs.pari.gen.*_unsafe|
|[05b93b7](http://git.sagemath.org/sage.git/commit/?id=05b93b7)|remove "pbw" as an abbreviation for "prec_bits_to_words"|
|[95a622a](http://git.sagemath.org/sage.git/commit/?id=95a622a)|better fix for real_double.pyx|
|[11a3bfb](http://git.sagemath.org/sage.git/commit/?id=11a3bfb)|more fixes related to relocation of PariInstance|
|[34013cc](http://git.sagemath.org/sage.git/commit/?id=34013cc)|fixes in sage.libs.pari|
|[db8cd7e](http://git.sagemath.org/sage.git/commit/?id=db8cd7e)|top-level changes related to PariInstance|



---

archive/issue_comments_248600.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248600",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248601.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n \n ```\n sage: %timeit -r 1 pari(0)\n-1000000 loops, best of 1: 875 us per loop\n+1000000 loops, best of 1: 875 ns per loop\n ```\n \n``````\n",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248601",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 
 ```
 sage: %timeit -r 1 pari(0)
-1000000 loops, best of 1: 875 us per loop
+1000000 loops, best of 1: 875 ns per loop
 ```
 
``````




---

archive/issue_comments_248602.json:
```json
{
    "body": "Changing commit from \"\" to \"7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed\"",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248602",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed"



---

archive/issue_comments_248603.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                         |                                                                    |\n|---------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[ccf2332](http://git.sagemath.org/sage.git/commit/?id=ccf2332)|`raise an error instead of creating a NULL object in gen.__init__()`|",
    "created_at": "2013-12-19T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                         |                                                                    |
|---------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[ccf2332](http://git.sagemath.org/sage.git/commit/?id=ccf2332)|`raise an error instead of creating a NULL object in gen.__init__()`|



---

archive/issue_comments_248604.json:
```json
{
    "body": "Changing commit from \"7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed\" to \"ccf233223fbad8f95d1b41097ca53afe2ca4b973\"",
    "created_at": "2013-12-19T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed" to "ccf233223fbad8f95d1b41097ca53afe2ca4b973"



---

archive/issue_comments_248605.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,4 @@\n 1000000 loops, best of 1: 875 ns per loop\n ```\n \n+Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.\n``````\n",
    "created_at": "2013-12-19T17:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248605",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,4 @@
 1000000 loops, best of 1: 875 ns per loop
 ```
 
+Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.
``````




---

archive/issue_comments_248606.json:
```json
{
    "body": "Changing branch from \"u/pbruin/15549-pari_gen_construction\" to \"u/jdemeyer/ticket/15549\"",
    "created_at": "2014-01-02T11:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248606",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/pbruin/15549-pari_gen_construction" to "u/jdemeyer/ticket/15549"



---

archive/issue_comments_248607.json:
```json
{
    "body": "<a id='comment:8'></a>\nSmall reviewer patch needs review.\n\n---\nNew commits:\n|                                                                                                         |                                       |\n|---------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[5713c53](http://git.sagemath.org/sage.git/commit/?id=5713c53)|`Use \"in\" instead of PyDict_Contains()`|",
    "created_at": "2014-01-02T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248607",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Small reviewer patch needs review.

---
New commits:
|                                                                                                         |                                       |
|---------------------------------------------------------------------------------------------------------|---------------------------------------|
|[5713c53](http://git.sagemath.org/sage.git/commit/?id=5713c53)|`Use "in" instead of PyDict_Contains()`|



---

archive/issue_comments_248608.json:
```json
{
    "body": "Changing commit from \"ccf233223fbad8f95d1b41097ca53afe2ca4b973\" to \"5713c53af6e5caa3c993daf2ba41ba88b473ff33\"",
    "created_at": "2014-01-02T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248608",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "ccf233223fbad8f95d1b41097ca53afe2ca4b973" to "5713c53af6e5caa3c993daf2ba41ba88b473ff33"



---

archive/issue_comments_248609.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A8):\n> Small reviewer patch needs review.\n\nI agree with these changes.",
    "created_at": "2014-01-03T13:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248609",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A8):
> Small reviewer patch needs review.

I agree with these changes.



---

archive/issue_comments_248610.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-01-03T14:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248610",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_248611.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-03T14:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248611",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_045443.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T00:32:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15549#event-45443"
}
```



---

archive/issue_comments_248612.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T00:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-248612",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
