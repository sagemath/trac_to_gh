# Issue 15549: Streamline construction of PARI objects

archive/issues_015312.json:
```json
{
    "body": "Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.\n\nBefore:\n\n```\nsage: %timeit -r 1 pari(0)\n1000000 loops, best of 1: 1.02 us per loop\n```\nAfter:\n\n```\nsage: %timeit -r 1 pari(0)\n1000000 loops, best of 1: 875 ns per loop\n```\n\nAlso modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.\n\n**CC:**  @jdemeyer\n\n**Keywords:** pari performance\n\n**Branch:** [u/jdemeyer/ticket/15549](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/15549)\n\n**Commit:** [5713c53af6e5caa3c993daf2ba41ba88b473ff33](https://github.com/sagemath/sagetrac-mirror/commit/5713c53af6e5caa3c993daf2ba41ba88b473ff33)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Peter Bruin\n\n**Dependencies:** #15461\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15549\n\n",
    "closed_at": "2014-01-05T00:32:07Z",
    "created_at": "2013-12-19T13:37:14Z",
    "labels": [
        "component: interfaces",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Streamline construction of PARI objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15549",
    "user": "https://github.com/pjbruin"
}
```
Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.

Before:

```
sage: %timeit -r 1 pari(0)
1000000 loops, best of 1: 1.02 us per loop
```
After:

```
sage: %timeit -r 1 pari(0)
1000000 loops, best of 1: 875 ns per loop
```

Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.

**CC:**  @jdemeyer

**Keywords:** pari performance

**Branch:** [u/jdemeyer/ticket/15549](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/15549)

**Commit:** [5713c53af6e5caa3c993daf2ba41ba88b473ff33](https://github.com/sagemath/sagetrac-mirror/commit/5713c53af6e5caa3c993daf2ba41ba88b473ff33)

**Reviewer:** Jeroen Demeyer

**Author:** Peter Bruin

**Dependencies:** #15461

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/15549





---

archive/issue_comments_253349.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,15 @@\n-Clean up the construction of PARI objects by inlining some functions.\n+Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.\n+\n+Before:\n+\n+```\n+sage: %timeit -r 1 pari(0)\n+1000000 loops, best of 1: 1.02 us per loop\n+```\n+After:\n+\n+```\n+sage: %timeit -r 1 pari(0)\n+1000000 loops, best of 1: 875 us per loop\n+```\n+\n``````\n",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253349",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,15 @@
-Clean up the construction of PARI objects by inlining some functions.
+Clean up the construction of PARI objects by inlining some functions and initialising the `_refers_to` dictionary only when necessary.
+
+Before:
+
+```
+sage: %timeit -r 1 pari(0)
+1000000 loops, best of 1: 1.02 us per loop
+```
+After:
+
+```
+sage: %timeit -r 1 pari(0)
+1000000 loops, best of 1: 875 us per loop
+```
+
``````




---

archive/issue_comments_253350.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"pari performance\".",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253350",
    "user": "https://github.com/pjbruin"
}
```

**Changing keywords** from "" to "pari performance".



---

archive/issue_comments_253351.json:
```json
{
    "body": "**Dependencies:** #15461",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253351",
    "user": "https://github.com/pjbruin"
}
```

**Dependencies:** #15461



---

archive/issue_comments_253352.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2013-12-19T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253352",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_comments_253353.json:
```json
{
    "body": "<a id='comment:2'></a>\nAre you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.",
    "created_at": "2013-12-19T14:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253353",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.



---

archive/issue_comments_253354.json:
```json
{
    "body": "**Branch:** [u/pbruin/15549-pari_gen_construction](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15549-pari_gen_construction)",
    "created_at": "2013-12-19T15:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253354",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/15549-pari_gen_construction](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15549-pari_gen_construction)



---

archive/issue_comments_253355.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jdemeyer](#comment%3A2):\n> Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.\n\nThat was a typo; I don't know why I didn't simply copy-paste this...\n\n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a98efb\">7a98efb</a></td>streamline construction of PARI gen</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bb8f8d\">5bb8f8d</a></td>remove commented-out method gen.python()</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fa4f1d\">3fa4f1d</a></td>remove redundant methods from sage.libs.pari.gen</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/511f05b\">511f05b</a></td>remove global variable mytop</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/866f7fd\">866f7fd</a></td>remove methods sage.libs.pari.gen.*_unsafe</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05b93b7\">05b93b7</a></td>remove \"pbw\" as an abbreviation for \"prec_bits_to_words\"</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95a622a\">95a622a</a></td>better fix for real_double.pyx</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11a3bfb\">11a3bfb</a></td>more fixes related to relocation of PariInstance</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34013cc\">34013cc</a></td>fixes in sage.libs.pari</tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db8cd7e\">db8cd7e</a></td>top-level changes related to PariInstance</tr></table>\n",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253355",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
Replying to [jdemeyer](#comment%3A2):
> Are you sure the ticket description is right? If so, you **slowed this down** by a factor of 858.

That was a typo; I don't know why I didn't simply copy-paste this...

---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a98efb">7a98efb</a></td>streamline construction of PARI gen</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bb8f8d">5bb8f8d</a></td>remove commented-out method gen.python()</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fa4f1d">3fa4f1d</a></td>remove redundant methods from sage.libs.pari.gen</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/511f05b">511f05b</a></td>remove global variable mytop</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/866f7fd">866f7fd</a></td>remove methods sage.libs.pari.gen.*_unsafe</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05b93b7">05b93b7</a></td>remove "pbw" as an abbreviation for "prec_bits_to_words"</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95a622a">95a622a</a></td>better fix for real_double.pyx</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11a3bfb">11a3bfb</a></td>more fixes related to relocation of PariInstance</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34013cc">34013cc</a></td>fixes in sage.libs.pari</tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db8cd7e">db8cd7e</a></td>top-level changes related to PariInstance</tr></table>




---

archive/issue_comments_253356.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253356",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_253357.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n \n ```\n sage: %timeit -r 1 pari(0)\n-1000000 loops, best of 1: 875 us per loop\n+1000000 loops, best of 1: 875 ns per loop\n ```\n \n``````\n",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253357",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 
 ```
 sage: %timeit -r 1 pari(0)
-1000000 loops, best of 1: 875 us per loop
+1000000 loops, best of 1: 875 ns per loop
 ```
 
``````




---

archive/issue_comments_253358.json:
```json
{
    "body": "**Commit:** [7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed](https://github.com/sagemath/sagetrac-mirror/commit/7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed)",
    "created_at": "2013-12-19T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253358",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed](https://github.com/sagemath/sagetrac-mirror/commit/7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed)



---

archive/issue_comments_253359.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf2332\">ccf2332</a></td><td><code>raise an error instead of creating a NULL object in gen.__init__()</code></td></tr></table>\n",
    "created_at": "2013-12-19T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf2332">ccf2332</a></td><td><code>raise an error instead of creating a NULL object in gen.__init__()</code></td></tr></table>




---

archive/issue_comments_253360.json:
```json
{
    "body": "**Changing commit** from \"[7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed](https://github.com/sagemath/sagetrac-mirror/commit/7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed)\" to \"[ccf233223fbad8f95d1b41097ca53afe2ca4b973](https://github.com/sagemath/sagetrac-mirror/commit/ccf233223fbad8f95d1b41097ca53afe2ca4b973)\".",
    "created_at": "2013-12-19T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed](https://github.com/sagemath/sagetrac-mirror/commit/7a98efbcf2b16ae420cf5f7f05f9f39e0f3894ed)" to "[ccf233223fbad8f95d1b41097ca53afe2ca4b973](https://github.com/sagemath/sagetrac-mirror/commit/ccf233223fbad8f95d1b41097ca53afe2ca4b973)".



---

archive/issue_comments_253361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,3 +13,4 @@\n 1000000 loops, best of 1: 875 ns per loop\n ```\n \n+Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.\n``````\n",
    "created_at": "2013-12-19T17:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253361",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,3 +13,4 @@
 1000000 loops, best of 1: 875 ns per loop
 ```
 
+Also modify gen.__init__() to raise an error instead of creating a gen object wrapping NULL.
``````




---

archive/issue_comments_253362.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/15549-pari_gen_construction](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15549-pari_gen_construction)\" to \"[u/jdemeyer/ticket/15549](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/15549)\".",
    "created_at": "2014-01-02T11:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253362",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/pbruin/15549-pari_gen_construction](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/15549-pari_gen_construction)" to "[u/jdemeyer/ticket/15549](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/15549)".



---

archive/issue_comments_253363.json:
```json
{
    "body": "<a id='comment:8'></a>\nSmall reviewer patch needs review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5713c53\">5713c53</a></td><td><code>Use \"in\" instead of PyDict_Contains()</code></td></tr></table>\n",
    "created_at": "2014-01-02T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253363",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Small reviewer patch needs review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5713c53">5713c53</a></td><td><code>Use "in" instead of PyDict_Contains()</code></td></tr></table>




---

archive/issue_comments_253364.json:
```json
{
    "body": "**Changing commit** from \"[ccf233223fbad8f95d1b41097ca53afe2ca4b973](https://github.com/sagemath/sagetrac-mirror/commit/ccf233223fbad8f95d1b41097ca53afe2ca4b973)\" to \"[5713c53af6e5caa3c993daf2ba41ba88b473ff33](https://github.com/sagemath/sagetrac-mirror/commit/5713c53af6e5caa3c993daf2ba41ba88b473ff33)\".",
    "created_at": "2014-01-02T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253364",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ccf233223fbad8f95d1b41097ca53afe2ca4b973](https://github.com/sagemath/sagetrac-mirror/commit/ccf233223fbad8f95d1b41097ca53afe2ca4b973)" to "[5713c53af6e5caa3c993daf2ba41ba88b473ff33](https://github.com/sagemath/sagetrac-mirror/commit/5713c53af6e5caa3c993daf2ba41ba88b473ff33)".



---

archive/issue_comments_253365.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A8):\n> Small reviewer patch needs review.\n\nI agree with these changes.",
    "created_at": "2014-01-03T13:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253365",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A8):
> Small reviewer patch needs review.

I agree with these changes.



---

archive/issue_comments_253366.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2014-01-03T14:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253366",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_253367.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-01-03T14:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253367",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_051924.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T00:32:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15549#event-51924"
}
```



---

archive/issue_comments_253368.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2014-01-05T00:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15549#issuecomment-253368",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
