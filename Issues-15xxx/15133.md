# Issue 15133: post receive hook on git to update commit on trac

archive/issues_014896.json:
```json
{
    "body": "Here is a post-receive hook that updates the \"Commit\" field on trac. \n\nInstallation instructions:\n* copy the attached [attachment:post-receive-hook.py] to `hooks/post-receive`\n* Add an action to trac to change the status from positive_review back to needs_review. In `trac.ini`:\n  {{{\n[ticket-workflow]\nback_to_review = positive_review -> needs_review\nback_to_review.name = resubmit to review\nback_to_review.permissions = TICKET_MODIFY\n    }}}\n* Add a trac user that makes the changes, e.g. username = `git`. Put the username/password in the post-receive script in `TRAC_URL_LOGIN`.\n\nCC:  @robertwb @ohanar\n\nReviewer: Andew Ohana, \u200bMarc Mezzarobba\n\nAuthor: Volker Braun\n\nDependencies: #15129\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15133\n\n",
    "closed_at": "2014-01-31T21:23:25Z",
    "created_at": "2013-08-31T17:12:01Z",
    "labels": [
        "component: website/wiki"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "post receive hook on git to update commit on trac",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15133",
    "user": "https://github.com/vbraun"
}
```
Here is a post-receive hook that updates the "Commit" field on trac. 

Installation instructions:
* copy the attached [attachment:post-receive-hook.py] to `hooks/post-receive`
* Add an action to trac to change the status from positive_review back to needs_review. In `trac.ini`:
  {{{
[ticket-workflow]
back_to_review = positive_review -> needs_review
back_to_review.name = resubmit to review
back_to_review.permissions = TICKET_MODIFY
    }}}
* Add a trac user that makes the changes, e.g. username = `git`. Put the username/password in the post-receive script in `TRAC_URL_LOGIN`.

CC:  @robertwb @ohanar

Reviewer: Andew Ohana, ​Marc Mezzarobba

Author: Volker Braun

Dependencies: #15129

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15133





---

archive/issue_comments_235436.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n Here is a post-receive hook that updates the \"Commit\" field on trac. \n \n-\n+Installation instructions:\n+* copy the attached [attachment:post-receive-hook.py] to `hooks/post-receive`\n+* Add an action to trac to change the status from positive_review back to needs_review. In `trac.ini`:\n+  {{{\n+[ticket-workflow]\n+back_to_review = positive_review -> needs_review\n+back_to_review.name = resubmit to review\n+back_to_review.permissions = TICKET_MODIFY\n+    }}}\n+* Add a trac user that makes the changes, e.g. username = `git`. Put the username/password in the post-receive script in `TRAC_URL_LOGIN`.\n``````\n",
    "created_at": "2013-08-31T17:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235436",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
 Here is a post-receive hook that updates the "Commit" field on trac. 
 
-
+Installation instructions:
+* copy the attached [attachment:post-receive-hook.py] to `hooks/post-receive`
+* Add an action to trac to change the status from positive_review back to needs_review. In `trac.ini`:
+  {{{
+[ticket-workflow]
+back_to_review = positive_review -> needs_review
+back_to_review.name = resubmit to review
+back_to_review.permissions = TICKET_MODIFY
+    }}}
+* Add a trac user that makes the changes, e.g. username = `git`. Put the username/password in the post-receive script in `TRAC_URL_LOGIN`.
``````




---

archive/issue_comments_235437.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#15129\"",
    "created_at": "2013-08-31T17:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235437",
    "user": "https://github.com/vbraun"
}
```

Changing dependencies from "" to "#15129"



---

archive/issue_comments_235438.json:
```json
{
    "body": "Attachment [post-receive-hook.py](tarball://root/attachments/some-uuid/ticket15133/post-receive-hook.py) by @vbraun created at 2013-08-31 17:19:56\n\nUpdated",
    "created_at": "2013-08-31T17:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235438",
    "user": "https://github.com/vbraun"
}
```

Attachment [post-receive-hook.py](tarball://root/attachments/some-uuid/ticket15133/post-receive-hook.py) by @vbraun created at 2013-08-31 17:19:56

Updated



---

archive/issue_comments_235439.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-31T17:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235439",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235440.json:
```json
{
    "body": "<a id='comment:3'></a>\nOk, it is now enabled (although I haven't had the chance to test it). I've put up a repository with all the server-side hooks at [http://github.com/sagemath/trac-githooks](http://github.com/sagemath/trac-githooks).",
    "created_at": "2013-08-31T21:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235440",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:3'></a>
Ok, it is now enabled (although I haven't had the chance to test it). I've put up a repository with all the server-side hooks at [http://github.com/sagemath/trac-githooks](http://github.com/sagemath/trac-githooks).



---

archive/issue_comments_235441.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe plugin is complaining about authentication, so I've disabled it for the moment(because it displays the git user's password when it errors out).",
    "created_at": "2013-08-31T22:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235441",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>
The plugin is complaining about authentication, so I've disabled it for the moment(because it displays the git user's password when it errors out).



---

archive/issue_comments_235442.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-31T22:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235442",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235443.json:
```json
{
    "body": "<a id='comment:5'></a>\nOk, fixed this by basing it off of the development scripts authentication. Please review: https://github.com/sagemath/trac-githooks/commit/730231a1ec874d68e3afdd56523c71a6ac2ce4ed",
    "created_at": "2013-08-31T22:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235443",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:5'></a>
Ok, fixed this by basing it off of the development scripts authentication. Please review: https://github.com/sagemath/trac-githooks/commit/730231a1ec874d68e3afdd56523c71a6ac2ce4ed



---

archive/issue_comments_235444.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-31T22:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235444",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235445.json:
```json
{
    "body": "<a id='comment:6'></a>\nOk, I edited this a bit: sha1s in the log table now link to the appropriate changeset, and the table for non-forced pushes only show the new changesets. I still think we need something when the branch field is changed to automate populating the commit field (and ideally have a table of new/recent commits).",
    "created_at": "2013-09-01T04:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235445",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:6'></a>
Ok, I edited this a bit: sha1s in the log table now link to the appropriate changeset, and the table for non-forced pushes only show the new changesets. I still think we need something when the branch field is changed to automate populating the commit field (and ideally have a table of new/recent commits).



---

archive/issue_comments_235446.json:
```json
{
    "body": "<a id='comment:7'></a>\nChanges look good to me, thanks!\n\nI agree that we ideally would also figure out the commit field automatically if one fills in the \"Branch\" trac field and the branch already exists. Though that obviously requires another trac plugin. At least for now people just have to first fill in the branch field and then push, so its not terribly urgent.",
    "created_at": "2013-09-01T11:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235446",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Changes look good to me, thanks!

I agree that we ideally would also figure out the commit field automatically if one fills in the "Branch" trac field and the branch already exists. Though that obviously requires another trac plugin. At least for now people just have to first fill in the branch field and then push, so its not terribly urgent.



---

archive/issue_events_057735.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15133#event-57735"
}
```



---

archive/issue_comments_235447.json:
```json
{
    "body": "<a id='comment:9'></a>\nWhy is this ticket still in `needs_review` state? Is it intentional?",
    "created_at": "2014-01-31T20:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235447",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
Why is this ticket still in `needs_review` state? Is it intentional?



---

archive/issue_comments_235448.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andew Ohana, \u200bMarc Mezzarobba\"",
    "created_at": "2014-01-31T21:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235448",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Andew Ohana, ​Marc Mezzarobba"



---

archive/issue_comments_235449.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-31T21:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235449",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235450.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-31T21:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15133#issuecomment-235450",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057736.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-31T21:23:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15133",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15133#event-57736"
}
```
