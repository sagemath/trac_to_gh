# Issue 15247: Introduce a baseclass for singletons

archive/issues_015010.json:
```json
{
    "assignees": [],
    "body": "Since some while, we have `sage.categories.category_singleton.Category_singleton`. A singleton is a class that allows the creation of exactly one instance (of any subclass). The technical implementa\ntion of `Category_singleton` is roughly like this: In some static `__classcall__`, test that the given class is a direct subclass of `Category_singleton`; then create a (the) instance of the class;\nthen set the override the classcall of this class and of the class of the instance (which might be a subclass) by a constant function returning the instance.\n\nI suggest to provide this construction scheme generally, in `sage.misc.fast_methods.SingletonClass`. The idea is: If one write a class inheriting from `SingletonClass` then one does not need to think about caching the unique instance or writing a fast hash or writing fast comparison, since this will all be inherited from `SingletonClass`.\n\nI suggest to use it at least on the rational field, which currently has a custom cache, and its hash method is written in Python.\n\nWith the branch that I am going to add, I get\n\n```\nsage: %timeit RationalField()\n1000000 loops, best of 3: 269 ns per loop\nsage: %timeit hash(QQ)\n10000000 loops, best of 3: 134 ns per loop\nsage: %timeit QQ==ZZ\n10000000 loops, best of 3: 144 ns per loop\n```\n\nWith vanilla sage-5.12.b5, it is a lot slower:\n\n```\nsage: %timeit RationalField()\n10000 loops, best of 3: 82.4 us per loop\nsage: %timeit hash(QQ)\n1000000 loops, best of 3: 496 ns per loop\nsage: %timeit QQ==ZZ\n1000000 loops, best of 3: 878 ns per loop\n```\n\nCC:  @nthiery @nbruin @novoselt\n\nBranch/Commit: **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**\n\nReviewer: **Marc Mezzarobba, Travis Scrimshaw, Nicolas M. Thi\u00e9ry**\n\nAuthor: **Simon King**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15247_\n\n",
    "closed_at": "2014-11-27T15:33:15Z",
    "created_at": "2013-10-01T22:42:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Introduce a baseclass for singletons",
    "type": "issue",
    "updated_at": "2014-11-27T15:33:15Z",
    "url": "https://github.com/sagemath/sage/issues/15247",
    "user": "https://github.com/simon-king-jena"
}
```
Since some while, we have `sage.categories.category_singleton.Category_singleton`. A singleton is a class that allows the creation of exactly one instance (of any subclass). The technical implementa
tion of `Category_singleton` is roughly like this: In some static `__classcall__`, test that the given class is a direct subclass of `Category_singleton`; then create a (the) instance of the class;
then set the override the classcall of this class and of the class of the instance (which might be a subclass) by a constant function returning the instance.

I suggest to provide this construction scheme generally, in `sage.misc.fast_methods.SingletonClass`. The idea is: If one write a class inheriting from `SingletonClass` then one does not need to think about caching the unique instance or writing a fast hash or writing fast comparison, since this will all be inherited from `SingletonClass`.

I suggest to use it at least on the rational field, which currently has a custom cache, and its hash method is written in Python.

With the branch that I am going to add, I get

```
sage: %timeit RationalField()
1000000 loops, best of 3: 269 ns per loop
sage: %timeit hash(QQ)
10000000 loops, best of 3: 134 ns per loop
sage: %timeit QQ==ZZ
10000000 loops, best of 3: 144 ns per loop
```

With vanilla sage-5.12.b5, it is a lot slower:

```
sage: %timeit RationalField()
10000 loops, best of 3: 82.4 us per loop
sage: %timeit hash(QQ)
1000000 loops, best of 3: 496 ns per loop
sage: %timeit QQ==ZZ
1000000 loops, best of 3: 878 ns per loop
```

CC:  @nthiery @nbruin @novoselt

Branch/Commit: **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**

Reviewer: **Marc Mezzarobba, Travis Scrimshaw, Nicolas M. Thi√©ry**

Author: **Simon King**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/15247_





---

archive/issue_events_214732.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-01T22:42:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214732"
}
```



---

archive/issue_events_214733.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-01T22:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214733"
}
```



---

archive/issue_events_214734.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-01T22:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214734"
}
```



---

archive/issue_events_214735.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-01T22:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214735"
}
```



---

archive/issue_comments_188085.json:
```json
{
    "body": "Branch: **[u/SimonKing/ticket/15247](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15247)**",
    "created_at": "2013-10-01T22:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188085",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/ticket/15247](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15247)**



---

archive/issue_comments_188086.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt is not \"needs review\" yet, but I guess it only needs test coverage for the new class.",
    "created_at": "2013-10-01T22:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188086",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

It is not "needs review" yet, but I guess it only needs test coverage for the new class.



---

archive/issue_comments_188087.json:
```json
{
    "body": "Commit: **[`add22e6`](https://github.com/sagemath/sagetrac-mirror/commit/add22e67c8eddafc7097aee8ee1b6883596a8a89)**",
    "created_at": "2013-10-02T10:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188087",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`add22e6`](https://github.com/sagemath/sagetrac-mirror/commit/add22e67c8eddafc7097aee8ee1b6883596a8a89)**



---

archive/issue_comments_188088.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><code>[changeset:add22e6]</code></td><td><code>Add tests for SingletonClass</code></td></tr></table>\n",
    "created_at": "2013-10-02T10:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188088",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><code>[changeset:add22e6]</code></td><td><code>Add tests for SingletonClass</code></td></tr></table>




---

archive/issue_events_214736.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T10:07:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214736"
}
```



---

archive/issue_comments_188089.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI did not run make ptest yet, but I have added tests for the new `SingletonClass` and hence change the ticket into \"needs review\".",
    "created_at": "2013-10-02T10:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188089",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

I did not run make ptest yet, but I have added tests for the new `SingletonClass` and hence change the ticket into "needs review".



---

archive/issue_comments_188090.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2013-10-02T10:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188090",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_188091.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIt will be needed to change the expected output of several hash functions in the tests, as the hash of QQ is changed `object.__hash__(QQ)` with my branch.",
    "created_at": "2013-10-02T11:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188091",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

It will be needed to change the expected output of several hash functions in the tests, as the hash of QQ is changed `object.__hash__(QQ)` with my branch.



---

archive/issue_comments_188092.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!",
    "created_at": "2013-10-02T11:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188092",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!



---

archive/issue_comments_188093.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@simon-king-jena](#comment:6):\n> Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!\n\nI stand corrected: THIS seems to work. But the pickle jar broke.",
    "created_at": "2013-10-02T11:28:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188093",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@simon-king-jena](#comment:6):
> Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!

I stand corrected: THIS seems to work. But the pickle jar broke.



---

archive/issue_events_214737.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T13:04:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214737"
}
```



---

archive/issue_events_214738.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T13:04:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214738"
}
```



---

archive/issue_comments_188094.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI have now clue what is going wrong here.\n\nI tested saving a rational number in vanilla sage, and I could read the pickle after rebuilding Sage with my branch. However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?",
    "created_at": "2013-10-02T13:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188094",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

I have now clue what is going wrong here.

I tested saving a rational number in vanilla sage, and I could read the pickle after rebuilding Sage with my branch. However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?



---

archive/issue_comments_188095.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other, so I'd recommend basing this one on top of #10963.\n\nCheers,\n                             Nicolas",
    "created_at": "2013-10-02T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188095",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other, so I'd recommend basing this one on top of #10963.

Cheers,
                             Nicolas



---

archive/issue_comments_188096.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nthiery](#comment:9):\n> I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other,\n\nWhy? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.",
    "created_at": "2013-10-02T14:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188096",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nthiery](#comment:9):
> I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other,

Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.



---

archive/issue_comments_188097.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@simon-king-jena](#comment:10):\n> Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.\n\nAh, ok, perfect! Double +1 on this ticket then. Well, as long as it does not eat up review time from you on #10963 :-)",
    "created_at": "2013-10-02T14:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188097",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@simon-king-jena](#comment:10):
> Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.

Ah, ok, perfect! Double +1 on this ticket then. Well, as long as it does not eat up review time from you on #10963 :-)



---

archive/issue_comments_188098.json:
```json
{
    "body": "Changed commit from **[`add22e6`](https://github.com/sagemath/sagetrac-mirror/commit/add22e67c8eddafc7097aee8ee1b6883596a8a89)** to **[`44de392`](https://github.com/sagemath/sagetrac-mirror/commit/44de39272977327c5a6b248dc2bc0f54a36db382)**",
    "created_at": "2013-10-02T14:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188098",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`add22e6`](https://github.com/sagemath/sagetrac-mirror/commit/add22e67c8eddafc7097aee8ee1b6883596a8a89)** to **[`44de392`](https://github.com/sagemath/sagetrac-mirror/commit/44de39272977327c5a6b248dc2bc0f54a36db382)**



---

archive/issue_comments_188099.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><code>[changeset:44de392]</code></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr></table>\n",
    "created_at": "2013-10-02T14:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188099",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><code>[changeset:44de392]</code></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr></table>




---

archive/issue_events_214739.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T14:27:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214739"
}
```



---

archive/issue_events_214740.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T14:27:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214740"
}
```



---

archive/issue_comments_188100.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI did not run make ptest yet, but at least the new commit makes unpickle_all() work.",
    "created_at": "2013-10-02T14:27:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188100",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

I did not run make ptest yet, but at least the new commit makes unpickle_all() work.



---

archive/issue_events_214741.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T15:30:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214741"
}
```



---

archive/issue_events_214742.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T15:30:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214742"
}
```



---

archive/issue_comments_188101.json:
```json
{
    "body": "Work Issues: **update hash values in tests**",
    "created_at": "2013-10-02T15:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188101",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **update hash values in tests**



---

archive/issue_comments_188102.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOops, I forgot: Some hash values are to be updated as well.",
    "created_at": "2013-10-02T15:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188102",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Oops, I forgot: Some hash values are to be updated as well.



---

archive/issue_comments_188103.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNice finding: One of the hash tests was in fact wrong, because it was a test for the hash of a *different* class!\n\nI am about to fix this now, by testing against the definition of the respective hash functions. So, I am not testing against the result on 64bit and 32 bit machines, since such tests don't seem meaningful to me.",
    "created_at": "2013-10-02T15:46:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188103",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

Nice finding: One of the hash tests was in fact wrong, because it was a test for the hash of a *different* class!

I am about to fix this now, by testing against the definition of the respective hash functions. So, I am not testing against the result on 64bit and 32 bit machines, since such tests don't seem meaningful to me.



---

archive/issue_comments_188104.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><code>[changeset:86d2b64]</code></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr></table>\n",
    "created_at": "2013-10-02T16:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188104",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><code>[changeset:86d2b64]</code></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr></table>




---

archive/issue_comments_188105.json:
```json
{
    "body": "Changed commit from **[`44de392`](https://github.com/sagemath/sagetrac-mirror/commit/44de39272977327c5a6b248dc2bc0f54a36db382)** to **[`86d2b64`](https://github.com/sagemath/sagetrac-mirror/commit/86d2b6417e5e4814b2a61cb510edef32a5a3b08c)**",
    "created_at": "2013-10-02T16:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188105",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`44de392`](https://github.com/sagemath/sagetrac-mirror/commit/44de39272977327c5a6b248dc2bc0f54a36db382)** to **[`86d2b64`](https://github.com/sagemath/sagetrac-mirror/commit/86d2b6417e5e4814b2a61cb510edef32a5a3b08c)**



---

archive/issue_comments_188106.json:
```json
{
    "body": "Changed work issues from **update hash values in tests** to none",
    "created_at": "2013-10-02T16:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188106",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **update hash values in tests** to none



---

archive/issue_comments_188107.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNow I am confident that the tests will work, and that the branch is ready for review.",
    "created_at": "2013-10-02T16:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188107",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Now I am confident that the tests will work, and that the branch is ready for review.



---

archive/issue_events_214743.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T16:08:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214743"
}
```



---

archive/issue_events_214744.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T16:08:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214744"
}
```



---

archive/issue_events_214745.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T19:34:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214745"
}
```



---

archive/issue_events_214746.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T19:34:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214746"
}
```



---

archive/issue_comments_188108.json:
```json
{
    "body": "Work Issues: **fixs more hash values**",
    "created_at": "2013-10-02T19:34:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188108",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **fixs more hash values**



---

archive/issue_comments_188109.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThere are even more tests that test against the hash value of an instance of the wrong class!",
    "created_at": "2013-10-02T19:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188109",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

There are even more tests that test against the hash value of an instance of the wrong class!



---

archive/issue_comments_188110.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><code>[changeset:26132d9]</code></td><td><code>Fix several more hash tests</code></td></tr></table>\n",
    "created_at": "2013-10-02T20:12:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188110",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><code>[changeset:26132d9]</code></td><td><code>Fix several more hash tests</code></td></tr></table>




---

archive/issue_comments_188111.json:
```json
{
    "body": "Changed commit from **[`86d2b64`](https://github.com/sagemath/sagetrac-mirror/commit/86d2b6417e5e4814b2a61cb510edef32a5a3b08c)** to **[`26132d9`](https://github.com/sagemath/sagetrac-mirror/commit/26132d9f30e881fc75a3bae60c8e526a6e4fef9f)**",
    "created_at": "2013-10-02T20:12:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188111",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`86d2b64`](https://github.com/sagemath/sagetrac-mirror/commit/86d2b6417e5e4814b2a61cb510edef32a5a3b08c)** to **[`26132d9`](https://github.com/sagemath/sagetrac-mirror/commit/26132d9f30e881fc75a3bae60c8e526a6e4fef9f)**



---

archive/issue_events_214747.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T20:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214747"
}
```



---

archive/issue_events_214748.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-10-02T20:16:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214748"
}
```



---

archive/issue_comments_188112.json:
```json
{
    "body": "Changed work issues from **fixs more hash values** to none",
    "created_at": "2013-10-02T20:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188112",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **fixs more hash values** to none



---

archive/issue_comments_188113.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThere were several hash tests to fix. In all cases, I stopped comparing against a particular number, because\n1. the number depends on the architecture (32- versus 64-bit)\n2. the number does not show how the hash function works\n3. one should test the result of `hash` against the hash function of the class being tested---otherwise (and this happened in at least three examples) one might test an instance of the wrong class.\n\nThe tests should work now.",
    "created_at": "2013-10-02T20:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188113",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

There were several hash tests to fix. In all cases, I stopped comparing against a particular number, because
1. the number depends on the architecture (32- versus 64-bit)
2. the number does not show how the hash function works
3. one should test the result of `hash` against the hash function of the class being tested---otherwise (and this happened in at least three examples) one might test an instance of the wrong class.

The tests should work now.



---

archive/issue_comments_188114.json:
```json
{
    "body": "Changed commit from **[`26132d9`](https://github.com/sagemath/sagetrac-mirror/commit/26132d9f30e881fc75a3bae60c8e526a6e4fef9f)** to **[`8489527`](https://github.com/sagemath/sagetrac-mirror/commit/848952746e60990b25a0cf013081f5fad4ffe6e3)**",
    "created_at": "2013-10-02T21:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188114",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`26132d9`](https://github.com/sagemath/sagetrac-mirror/commit/26132d9f30e881fc75a3bae60c8e526a6e4fef9f)** to **[`8489527`](https://github.com/sagemath/sagetrac-mirror/commit/848952746e60990b25a0cf013081f5fad4ffe6e3)**



---

archive/issue_comments_188115.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><code>[changeset:8489527]</code></td><td><code>Use \"sorted\" in one test on sets</code></td></tr></table>\n",
    "created_at": "2013-10-02T21:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188115",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><code>[changeset:8489527]</code></td><td><code>Use "sorted" in one test on sets</code></td></tr></table>




---

archive/issue_comments_188116.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@simon-king-jena](#comment:21):\n> The tests should work now.\n\nAll but one test worked. The failing test was testing against the order of elements of a set. The obvious solution was to use \"sorted\" in the example. Hence, with the branch that I updated a minute ago, all tests pass for me.",
    "created_at": "2013-10-02T21:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188116",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@simon-king-jena](#comment:21):
> The tests should work now.

All but one test worked. The failing test was testing against the order of elements of a set. The obvious solution was to use "sorted" in the example. Hence, with the branch that I updated a minute ago, all tests pass for me.



---

archive/issue_comments_188117.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@simon-king-jena](#comment:8):\n> However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?\n\nI'm not sure I understand what you mean: isn't that (calling `__new__` but not `__init__`) how unpickling works in general?",
    "created_at": "2014-01-28T17:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188117",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@simon-king-jena](#comment:8):
> However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?

I'm not sure I understand what you mean: isn't that (calling `__new__` but not `__init__`) how unpickling works in general?



---

archive/issue_comments_188118.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/ticket/15247](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15247)** to **[u/mmezzarobba/15247-singleton_class](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class)**",
    "created_at": "2014-01-28T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188118",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/SimonKing/ticket/15247](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/ticket/15247)** to **[u/mmezzarobba/15247-singleton_class](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class)**



---

archive/issue_comments_188119.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2014-01-28T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188119",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_188120.json:
```json
{
    "body": "Changed commit from **[`8489527`](https://github.com/sagemath/sagetrac-mirror/commit/848952746e60990b25a0cf013081f5fad4ffe6e3)** to **[`207f6b7`](https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709)**",
    "created_at": "2014-01-28T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188120",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`8489527`](https://github.com/sagemath/sagetrac-mirror/commit/848952746e60990b25a0cf013081f5fad4ffe6e3)** to **[`207f6b7`](https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709)**



---

archive/issue_comments_188121.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n* I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?\n* I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!\n* The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).\n* Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I \"fixed\" was intentional?\n \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9ca799c3b511cba8a113a5c624725fc57f95672\"><code>d9ca799</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5acb88aba8a5665bcb7d18f6254d593a7ab4bfa\"><code>c5acb88</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/949b7b2aa6fb3c1dbc711d5a2776c39127d338ab\"><code>949b7b2</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4123a503029daccca3b58deb18a389924a3ea86c\"><code>4123a50</code></a></td><td><code>Merge in '6.1.rc0' to prevent whitespace conflicts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709\"><code>207f6b7</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>\n",
    "created_at": "2014-01-28T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188121",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:25" align="right">comment:25</div>

* I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?
* I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!
* The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).
* Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I "fixed" was intentional?
 
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9ca799c3b511cba8a113a5c624725fc57f95672"><code>d9ca799</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5acb88aba8a5665bcb7d18f6254d593a7ab4bfa"><code>c5acb88</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/949b7b2aa6fb3c1dbc711d5a2776c39127d338ab"><code>949b7b2</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4123a503029daccca3b58deb18a389924a3ea86c"><code>4123a50</code></a></td><td><code>Merge in '6.1.rc0' to prevent whitespace conflicts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709"><code>207f6b7</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>




---

archive/issue_events_214749.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214749"
}
```



---

archive/issue_events_214750.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214750"
}
```



---

archive/issue_comments_188122.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/15247-singleton_class](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class)** to **[u/mmezzarobba/15247-singleton_class-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class-rebased)**",
    "created_at": "2014-03-14T15:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188122",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/mmezzarobba/15247-singleton_class](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class)** to **[u/mmezzarobba/15247-singleton_class-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class-rebased)**



---

archive/issue_comments_188123.json:
```json
{
    "body": "Changed commit from **[`207f6b7`](https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709)** to **[`a431dad`](https://github.com/sagemath/sagetrac-mirror/commit/a431dadc789f4f519468c3c678937d4fde30e3af)**",
    "created_at": "2014-03-14T15:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188123",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`207f6b7`](https://github.com/sagemath/sagetrac-mirror/commit/207f6b72c0dc4601732c5ca0ee722c4c43c95709)** to **[`a431dad`](https://github.com/sagemath/sagetrac-mirror/commit/a431dadc789f4f519468c3c678937d4fde30e3af)**



---

archive/issue_events_214751.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214751"
}
```



---

archive/issue_events_214752.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214752"
}
```



---

archive/issue_events_214753.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-05-11T08:09:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214753"
}
```



---

archive/issue_events_214754.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-05-11T08:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214754"
}
```



---

archive/issue_comments_188124.json:
```json
{
    "body": "Work Issues: **rebase**",
    "created_at": "2014-05-11T08:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188124",
    "user": "https://github.com/rwst"
}
```

Work Issues: **rebase**



---

archive/issue_comments_188125.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f900b9b4d74efcd1be3be9ee23d08f781b739d2\"><code>0f900b9</code></a></td><td><code>Use WithEqualityById on SingletonClass, replace QQ.__hash__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/159daaa460739957ba81d5c3ef43f1561ec35aaa\"><code>159daaa</code></a></td><td><code>Add tests for SingletonClass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9d0e5a8169c33b0a6d5fe80fc31f40f58bbf0db\"><code>a9d0e5a</code></a></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61ab8c81990f6e40c94f12d739d1a4fa3641cf85\"><code>61ab8c8</code></a></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c1d17bfb9067df4eae9517fb5e079b74a396cd8\"><code>5c1d17b</code></a></td><td><code>Fix several more hash tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4969e24e8de709a37837de438b6216a5f7324a7b\"><code>4969e24</code></a></td><td><code>Use \"sorted\" in one test on sets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2f369d9c56c806d0441bb0bfe61b4867ebb7aea\"><code>a2f369d</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59aea3c46bedc8ecfdc482f25e56628aa222cea9\"><code>59aea3c</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/765b2812f7884e117276501bc049fd61fce72bd7\"><code>765b281</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95\"><code>dfbb8bb</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>\n",
    "created_at": "2014-05-22T15:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188125",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f900b9b4d74efcd1be3be9ee23d08f781b739d2"><code>0f900b9</code></a></td><td><code>Use WithEqualityById on SingletonClass, replace QQ.__hash__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/159daaa460739957ba81d5c3ef43f1561ec35aaa"><code>159daaa</code></a></td><td><code>Add tests for SingletonClass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9d0e5a8169c33b0a6d5fe80fc31f40f58bbf0db"><code>a9d0e5a</code></a></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61ab8c81990f6e40c94f12d739d1a4fa3641cf85"><code>61ab8c8</code></a></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c1d17bfb9067df4eae9517fb5e079b74a396cd8"><code>5c1d17b</code></a></td><td><code>Fix several more hash tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4969e24e8de709a37837de438b6216a5f7324a7b"><code>4969e24</code></a></td><td><code>Use "sorted" in one test on sets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2f369d9c56c806d0441bb0bfe61b4867ebb7aea"><code>a2f369d</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59aea3c46bedc8ecfdc482f25e56628aa222cea9"><code>59aea3c</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/765b2812f7884e117276501bc049fd61fce72bd7"><code>765b281</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95"><code>dfbb8bb</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>




---

archive/issue_comments_188126.json:
```json
{
    "body": "Changed commit from **[`a431dad`](https://github.com/sagemath/sagetrac-mirror/commit/a431dadc789f4f519468c3c678937d4fde30e3af)** to **[`dfbb8bb`](https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95)**",
    "created_at": "2014-05-22T15:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188126",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a431dad`](https://github.com/sagemath/sagetrac-mirror/commit/a431dadc789f4f519468c3c678937d4fde30e3af)** to **[`dfbb8bb`](https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95)**



---

archive/issue_events_214755.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-22T15:18:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214755"
}
```



---

archive/issue_events_214756.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-22T15:18:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214756"
}
```



---

archive/issue_comments_188127.json:
```json
{
    "body": "Changed work issues from **rebase** to none",
    "created_at": "2014-05-22T15:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188127",
    "user": "https://github.com/mezzarobba"
}
```

Changed work issues from **rebase** to none



---

archive/issue_comments_188128.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nrebased (not fully tested yet, but seems to work)\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f900b9b4d74efcd1be3be9ee23d08f781b739d2\"><code>0f900b9</code></a></td><td><code>Use WithEqualityById on SingletonClass, replace QQ.__hash__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/159daaa460739957ba81d5c3ef43f1561ec35aaa\"><code>159daaa</code></a></td><td><code>Add tests for SingletonClass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9d0e5a8169c33b0a6d5fe80fc31f40f58bbf0db\"><code>a9d0e5a</code></a></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61ab8c81990f6e40c94f12d739d1a4fa3641cf85\"><code>61ab8c8</code></a></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c1d17bfb9067df4eae9517fb5e079b74a396cd8\"><code>5c1d17b</code></a></td><td><code>Fix several more hash tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4969e24e8de709a37837de438b6216a5f7324a7b\"><code>4969e24</code></a></td><td><code>Use \"sorted\" in one test on sets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2f369d9c56c806d0441bb0bfe61b4867ebb7aea\"><code>a2f369d</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59aea3c46bedc8ecfdc482f25e56628aa222cea9\"><code>59aea3c</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/765b2812f7884e117276501bc049fd61fce72bd7\"><code>765b281</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95\"><code>dfbb8bb</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>\n",
    "created_at": "2014-05-22T15:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188128",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:31" align="right">comment:31</div>

rebased (not fully tested yet, but seems to work)

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f900b9b4d74efcd1be3be9ee23d08f781b739d2"><code>0f900b9</code></a></td><td><code>Use WithEqualityById on SingletonClass, replace QQ.__hash__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/159daaa460739957ba81d5c3ef43f1561ec35aaa"><code>159daaa</code></a></td><td><code>Add tests for SingletonClass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9d0e5a8169c33b0a6d5fe80fc31f40f58bbf0db"><code>a9d0e5a</code></a></td><td><code>Add Rational.__new__, to make ancient pickles readable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61ab8c81990f6e40c94f12d739d1a4fa3641cf85"><code>61ab8c8</code></a></td><td><code>Fix the hash value doctests of Heegner points</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c1d17bfb9067df4eae9517fb5e079b74a396cd8"><code>5c1d17b</code></a></td><td><code>Fix several more hash tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4969e24e8de709a37837de438b6216a5f7324a7b"><code>4969e24</code></a></td><td><code>Use "sorted" in one test on sets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2f369d9c56c806d0441bb0bfe61b4867ebb7aea"><code>a2f369d</code></a></td><td><code>SingletonClass: cosmetic changes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59aea3c46bedc8ecfdc482f25e56628aa222cea9"><code>59aea3c</code></a></td><td><code>SingletonClass: Less redundant docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/765b2812f7884e117276501bc049fd61fce72bd7"><code>765b281</code></a></td><td><code>QQ/SingletonClass: Delete redundant doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95"><code>dfbb8bb</code></a></td><td><code>Make QQbar, AA, and PariRing 'SingletonClass'es</code></td></tr></table>




---

archive/issue_comments_188129.json:
```json
{
    "body": "Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**",
    "created_at": "2014-06-19T19:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188129",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Travis Scrimshaw**



---

archive/issue_comments_188130.json:
```json
{
    "body": "Changed commit from **[`dfbb8bb`](https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95)** to **[`0d78737`](https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f)**",
    "created_at": "2014-06-19T19:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188130",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`dfbb8bb`](https://github.com/sagemath/sagetrac-mirror/commit/dfbb8bba4a90b1bc30cd33199c9eee9655d8fc95)** to **[`0d78737`](https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f)**



---

archive/issue_comments_188131.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nPerhaps Simon can comment at some point, but here are my thoughts.\n\nReplying to [@mezzarobba](#comment:25):\n> * I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?\n\nI would say this is okay as you can always override `__eq__` as necessary, and python's default is to do equality check by id.\n\n> * I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!\n\nI moved the pickling test to the class-level doc in order to make it more visible.\n\n> * The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).\n> * Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I \"fixed\" was intentional?\n\nI think they were typos.\n\nI've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage? Otherwise I'm happy with the current state of things (and found similar speedups).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ad8e71794f2afe5bae65949426d5670cef4711f\"><code>4ad8e71</code></a></td><td><code>Merge branch 'u/mmezzarobba/15247-singleton_class-rebased' of trac.sagemath.org:sage into public/structure/singleton_class-15247</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f\"><code>0d78737</code></a></td><td><code>Some review changes for #15247.</code></td></tr></table>\n",
    "created_at": "2014-06-19T19:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188131",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Perhaps Simon can comment at some point, but here are my thoughts.

Replying to [@mezzarobba](#comment:25):
> * I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?

I would say this is okay as you can always override `__eq__` as necessary, and python's default is to do equality check by id.

> * I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!

I moved the pickling test to the class-level doc in order to make it more visible.

> * The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).
> * Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I "fixed" was intentional?

I think they were typos.

I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage? Otherwise I'm happy with the current state of things (and found similar speedups).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ad8e71794f2afe5bae65949426d5670cef4711f"><code>4ad8e71</code></a></td><td><code>Merge branch 'u/mmezzarobba/15247-singleton_class-rebased' of trac.sagemath.org:sage into public/structure/singleton_class-15247</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f"><code>0d78737</code></a></td><td><code>Some review changes for #15247.</code></td></tr></table>




---

archive/issue_comments_188132.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/15247-singleton_class-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class-rebased)** to **[public/singleton_class-15247](https://github.com/sagemath/sagetrac-mirror/tree/public/singleton_class-15247)**",
    "created_at": "2014-06-19T19:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188132",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/mmezzarobba/15247-singleton_class-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/15247-singleton_class-rebased)** to **[public/singleton_class-15247](https://github.com/sagemath/sagetrac-mirror/tree/public/singleton_class-15247)**



---

archive/issue_comments_188133.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@tscrim](#comment:32):\n> Perhaps Simon can comment at some point, but here are my thoughts.\n\nWell, at some point I should perhaps look at the code/doc again...\n\n> I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage?\n\nAt #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).\n\nAnd I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.",
    "created_at": "2014-06-19T20:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188133",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@tscrim](#comment:32):
> Perhaps Simon can comment at some point, but here are my thoughts.

Well, at some point I should perhaps look at the code/doc again...

> I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage?

At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).

And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.



---

archive/issue_comments_188134.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2\"><code>391421e</code></a></td><td><code>Merge branch 'public/singleton_class-15247' of trac.sagemath.org:sage into public/singleton_class-15247</code></td></tr></table>\n",
    "created_at": "2014-07-24T07:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188134",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2"><code>391421e</code></a></td><td><code>Merge branch 'public/singleton_class-15247' of trac.sagemath.org:sage into public/singleton_class-15247</code></td></tr></table>




---

archive/issue_comments_188135.json:
```json
{
    "body": "Changed commit from **[`0d78737`](https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f)** to **[`391421e`](https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2)**",
    "created_at": "2014-07-24T07:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188135",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d78737`](https://github.com/sagemath/sagetrac-mirror/commit/0d78737de4a8f364903da0998f02fc9e803c2b0f)** to **[`391421e`](https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2)**



---

archive/issue_comments_188136.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@simon-king-jena](#comment:33):\n> At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).\n\nThanks for reminding me of that (and sorry, I let this ticket slip of my radar); Nicolas told me at one time but I couldn't remember which when where.\n \n> And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.\n\nI agree.\n\n---\n\nRebased and we just need a little bit more review.",
    "created_at": "2014-07-24T07:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188136",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@simon-king-jena](#comment:33):
> At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).

Thanks for reminding me of that (and sorry, I let this ticket slip of my radar); Nicolas told me at one time but I couldn't remember which when where.
 
> And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.

I agree.

---

Rebased and we just need a little bit more review.



---

archive/issue_comments_188137.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab\"><code>3e9e736</code></a></td><td><code>Fix merge error</code></td></tr></table>\n",
    "created_at": "2014-07-29T10:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188137",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab"><code>3e9e736</code></a></td><td><code>Fix merge error</code></td></tr></table>




---

archive/issue_comments_188138.json:
```json
{
    "body": "Changed commit from **[`391421e`](https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2)** to **[`3e9e736`](https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab)**",
    "created_at": "2014-07-29T10:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188138",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`391421e`](https://github.com/sagemath/sagetrac-mirror/commit/391421e37fd4391227aab94b00c447c1a6945bb2)** to **[`3e9e736`](https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab)**



---

archive/issue_events_214757.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214757"
}
```



---

archive/issue_events_214758.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214758"
}
```



---

archive/issue_comments_188139.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\n**ping**\n\nCould someone just review my change `0d78737`? I've given a positive review to everything else.",
    "created_at": "2014-11-24T02:26:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188139",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:38" align="right">comment:38</div>

**ping**

Could someone just review my change `0d78737`? I've given a positive review to everything else.



---

archive/issue_comments_188140.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI just had a look at 0d78737, and it looks good to me.\n\nI would have two semi-unrelated suggestions though:\n\n- Maybe rename the class to `Singleton` rather than `SingletonClass`: then the name of the class will describe, as is usual, what its instances are, rather than the class itself.\n\n- For the test that is modified in 0d78737: make the inheritance explicit by creating a subclasss rather than trigerring such an inheritance through a call to _refine_category.\n\nThanks!\n\nCheers,\n                                  Nicolas",
    "created_at": "2014-11-24T12:41:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188140",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:39" align="right">comment:39</div>

I just had a look at 0d78737, and it looks good to me.

I would have two semi-unrelated suggestions though:

- Maybe rename the class to `Singleton` rather than `SingletonClass`: then the name of the class will describe, as is usual, what its instances are, rather than the class itself.

- For the test that is modified in 0d78737: make the inheritance explicit by creating a subclasss rather than trigerring such an inheritance through a call to _refine_category.

Thanks!

Cheers,
                                  Nicolas



---

archive/issue_comments_188141.json:
```json
{
    "body": "Changed commit from **[`3e9e736`](https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab)** to **[`3bd5ae0`](https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1)**",
    "created_at": "2014-11-25T01:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188141",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3e9e736`](https://github.com/sagemath/sagetrac-mirror/commit/3e9e736a9fbe164d07a2ce1d58efdc3e5b2a49ab)** to **[`3bd5ae0`](https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1)**



---

archive/issue_comments_188142.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1\"><code>3bd5ae0</code></a></td><td><code>Merge branch 'public/singleton_class-15247' of trac.sagemath.org:sage into public/singleton_class-15247</code></td></tr></table>\n",
    "created_at": "2014-11-25T01:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188142",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1"><code>3bd5ae0</code></a></td><td><code>Merge branch 'public/singleton_class-15247' of trac.sagemath.org:sage into public/singleton_class-15247</code></td></tr></table>




---

archive/issue_comments_188143.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nDone and done.",
    "created_at": "2014-11-25T01:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188143",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:41" align="right">comment:41</div>

Done and done.



---

archive/issue_comments_188144.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f\"><code>aa9821e</code></a></td><td><code>Changes from Nicolas' suggestions.</code></td></tr></table>\n",
    "created_at": "2014-11-25T04:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188144",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f"><code>aa9821e</code></a></td><td><code>Changes from Nicolas' suggestions.</code></td></tr></table>




---

archive/issue_comments_188145.json:
```json
{
    "body": "Changed commit from **[`3bd5ae0`](https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1)** to **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**",
    "created_at": "2014-11-25T04:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188145",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3bd5ae0`](https://github.com/sagemath/sagetrac-mirror/commit/3bd5ae067804742cc7e2f47b4e5575699a2f69d1)** to **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**



---

archive/issue_comments_188146.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThank you Travis! I double checked your changes, hence positive review.",
    "created_at": "2014-11-25T09:17:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188146",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:43" align="right">comment:43</div>

Thank you Travis! I double checked your changes, hence positive review.



---

archive/issue_comments_188147.json:
```json
{
    "body": "Changed reviewer from **Marc Mezzarobba, Travis Scrimshaw** to **Marc Mezzarobba, Travis Scrimshaw, Nicolas M. Thi\u00e9ry**",
    "created_at": "2014-11-25T09:17:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188147",
    "user": "https://github.com/nthiery"
}
```

Changed reviewer from **Marc Mezzarobba, Travis Scrimshaw** to **Marc Mezzarobba, Travis Scrimshaw, Nicolas M. Thi√©ry**



---

archive/issue_events_214759.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-11-25T09:17:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214759"
}
```



---

archive/issue_events_214760.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-11-25T09:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214760"
}
```



---

archive/issue_comments_188148.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThank you Nicolas. Also thank you Simon and Marc for your work on this.",
    "created_at": "2014-11-25T15:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188148",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:44" align="right">comment:44</div>

Thank you Nicolas. Also thank you Simon and Marc for your work on this.



---

archive/issue_events_214761.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T15:33:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214761"
}
```



---

archive/issue_events_214762.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e1e7a1ca12104ac4ae252216211ed9e665bcdb6f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-11-27T15:33:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15247#event-214762"
}
```



---

archive/issue_comments_188149.json:
```json
{
    "body": "Changed branch from **[public/singleton_class-15247](https://github.com/sagemath/sagetrac-mirror/tree/public/singleton_class-15247)** to **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**",
    "created_at": "2014-11-27T15:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15247#issuecomment-188149",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/singleton_class-15247](https://github.com/sagemath/sagetrac-mirror/tree/public/singleton_class-15247)** to **[`aa9821e`](https://github.com/sagemath/sagetrac-mirror/commit/aa9821ecb389908ce84b69735ead32bf871bdd4f)**
