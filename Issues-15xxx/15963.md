# Issue 15963: finite_state_machine: New attribute FSMState.color to prohibit merging in simplification

archive/issues_015726.json:
```json
{
    "body": "In some circumstances, it might be desirable to prohibit merging of states\nin finite state machine simplification, e.g., if there is some extra distinction between states\nthat is not captured in outgoing transitions. Therefore, the notion of \"color\" of a state\nis introduced such that states of different colors are never merged.\n\nCC:  skropf\n\nKeywords: finite_state_machine\n\nReviewer: Daniel Krenn\n\nAuthor: Clemens Heuberger\n\nBranch: 2031f53b78c88ec68b7ff2ffc252362174304601\n\nDependencies: #15841, #15847, #15848, #15849, #15850\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15963\n\n",
    "closed_at": "2014-04-05T10:43:44Z",
    "created_at": "2014-03-17T14:52:13Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "finite_state_machine: New attribute FSMState.color to prohibit merging in simplification",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15963",
    "user": "https://github.com/cheuberg"
}
```
In some circumstances, it might be desirable to prohibit merging of states
in finite state machine simplification, e.g., if there is some extra distinction between states
that is not captured in outgoing transitions. Therefore, the notion of "color" of a state
is introduced such that states of different colors are never merged.

CC:  skropf

Keywords: finite_state_machine

Reviewer: Daniel Krenn

Author: Clemens Heuberger

Branch: 2031f53b78c88ec68b7ff2ffc252362174304601

Dependencies: #15841, #15847, #15848, #15849, #15850

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15963





---

archive/issue_comments_258448.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-17T14:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258448",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_258449.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Daniel Krenn\"",
    "created_at": "2014-03-18T09:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258449",
    "user": "https://github.com/dkrenn"
}
```

Changing reviewer from "" to "Daniel Krenn"



---

archive/issue_comments_258450.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-18T09:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258450",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_258451.json:
```json
{
    "body": "<a id='comment:2'></a>code looks fine, doctests pass, docu checked, coverage checked\n\n(also reviewed all its dependencies)",
    "created_at": "2014-03-18T09:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258451",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>code looks fine, doctests pass, docu checked, coverage checked

(also reviewed all its dependencies)



---

archive/issue_comments_258452.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-04-05T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_258453.json:
```json
{
    "body": "Changing commit from \"2031f53b78c88ec68b7ff2ffc252362174304601\" to \"d51be51b8299930abc0e6b72700eca79cd978cfc\"",
    "created_at": "2014-04-05T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258453",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2031f53b78c88ec68b7ff2ffc252362174304601" to "d51be51b8299930abc0e6b72700eca79cd978cfc"



---

archive/issue_comments_258454.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-04-05T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_258455.json:
```json
{
    "body": "<a id='comment:4'></a>The following behaviour is undesired (docstrings says that\ncolors are tuples of the colors of the constituent states,\nbut this is not the case and leads to problems in\nAutomaton.determinisation):\n\n```\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.product_FiniteStateMachine(A,\n....:                                  lambda t1, t2: (0, None))\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.composition(A, algorithm='explorative')\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\n```\nI pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.",
    "created_at": "2014-04-05T07:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258455",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:4'></a>The following behaviour is undesired (docstrings says that
colors are tuples of the colors of the constituent states,
but this is not the case and leads to problems in
Automaton.determinisation):

```
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.product_FiniteStateMachine(A,
....:                                  lambda t1, t2: (0, None))
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.composition(A, algorithm='explorative')
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
```
I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.



---

archive/issue_events_046942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:43:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15963#event-46942"
}
```



---

archive/issue_comments_258456.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-05T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258456",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_258457.json:
```json
{
    "body": "Changing branch from \"u/cheuberg/fsm/state_color\" to \"d51be51b8299930abc0e6b72700eca79cd978cfc\"",
    "created_at": "2014-04-05T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258457",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cheuberg/fsm/state_color" to "d51be51b8299930abc0e6b72700eca79cd978cfc"



---

archive/issue_comments_258458.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [cheuberg](#comment%3A4):\n> The following behaviour is undesired (docstrings says that\n> colors are tuples of the colors of the constituent states,\n> but this is not the case and leads to problems in\n> Automaton.determinisation):\n> ...\n> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.\n\n\nI've reviewed those --> positive_review",
    "created_at": "2014-04-09T17:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258458",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:6'></a>Replying to [cheuberg](#comment%3A4):
> The following behaviour is undesired (docstrings says that
> colors are tuples of the colors of the constituent states,
> but this is not the case and leads to problems in
> Automaton.determinisation):
> ...
> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.


I've reviewed those --> positive_review



---

archive/issue_comments_258459.json:
```json
{
    "body": "Changing commit from \"d51be51b8299930abc0e6b72700eca79cd978cfc\" to \"\"",
    "created_at": "2014-04-09T17:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258459",
    "user": "https://github.com/dkrenn"
}
```

Changing commit from "d51be51b8299930abc0e6b72700eca79cd978cfc" to ""



---

archive/issue_comments_258460.json:
```json
{
    "body": "Changing branch from \"d51be51b8299930abc0e6b72700eca79cd978cfc\" to \"2031f53b78c88ec68b7ff2ffc252362174304601\"",
    "created_at": "2015-04-17T04:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258460",
    "user": "https://github.com/cheuberg"
}
```

Changing branch from "d51be51b8299930abc0e6b72700eca79cd978cfc" to "2031f53b78c88ec68b7ff2ffc252362174304601"



---

archive/issue_comments_258461.json:
```json
{
    "body": "<a id='comment:7'></a>The last commit was not merged in this ticket, but at #16128.",
    "created_at": "2015-04-17T04:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15963#issuecomment-258461",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:7'></a>The last commit was not merged in this ticket, but at #16128.
