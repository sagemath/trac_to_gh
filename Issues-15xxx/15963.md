# Issue 15963: finite_state_machine: New attribute FSMState.color to prohibit merging in simplification

archive/issues_015726.json:
```json
{
    "assignees": [],
    "body": "In some circumstances, it might be desirable to prohibit merging of states\nin finite state machine simplification, e.g., if there is some extra distinction between states\nthat is not captured in outgoing transitions. Therefore, the notion of \"color\" of a state\nis introduced such that states of different colors are never merged.\n\nDepends on #15841\nDepends on #15847\nDepends on #15848\nDepends on #15849\nDepends on #15850\n\nCC:  @sagetrac-skropf\n\nKeywords: **finite_state_machine**\n\nBranch: **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)**\n\nReviewer: **Daniel Krenn**\n\nAuthor: **Clemens Heuberger**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15963_\n\n",
    "closed_at": "2014-04-05T10:43:44Z",
    "created_at": "2014-03-17T14:52:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "finite_state_machine: New attribute FSMState.color to prohibit merging in simplification",
    "type": "issue",
    "updated_at": "2015-04-17T04:25:02Z",
    "url": "https://github.com/sagemath/sage/issues/15963",
    "user": "https://github.com/cheuberg"
}
```
In some circumstances, it might be desirable to prohibit merging of states
in finite state machine simplification, e.g., if there is some extra distinction between states
that is not captured in outgoing transitions. Therefore, the notion of "color" of a state
is introduced such that states of different colors are never merged.

Depends on #15841
Depends on #15847
Depends on #15848
Depends on #15849
Depends on #15850

CC:  @sagetrac-skropf

Keywords: **finite_state_machine**

Branch: **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)**

Reviewer: **Daniel Krenn**

Author: **Clemens Heuberger**

_Issue created by migration from https://trac.sagemath.org/ticket/15963_





---

archive/issue_events_210295.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2014-03-17T14:52:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210295"
}
```



---

archive/issue_events_210296.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2014-03-17T14:52:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210296"
}
```



---

archive/issue_events_210297.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2014-03-17T14:52:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210297"
}
```



---

archive/issue_events_210298.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2014-03-17T14:52:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210298"
}
```



---

archive/issue_events_210299.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2014-03-17T14:52:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210299"
}
```



---

archive/issue_comments_204877.json:
```json
{
    "body": "Reviewer: **Daniel Krenn**",
    "created_at": "2014-03-18T09:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204877",
    "user": "https://github.com/dkrenn"
}
```

Reviewer: **Daniel Krenn**



---

archive/issue_events_210300.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2014-03-18T09:54:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210300"
}
```



---

archive/issue_events_210301.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2014-03-18T09:54:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210301"
}
```



---

archive/issue_comments_204878.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\ncode looks fine, doctests pass, docu checked, coverage checked\n\n(also reviewed all its dependencies)",
    "created_at": "2014-03-18T09:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204878",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:2" align="right">Comment 2</div>

code looks fine, doctests pass, docu checked, coverage checked

(also reviewed all its dependencies)



---

archive/issue_events_210302.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-04-05T07:19:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210302"
}
```



---

archive/issue_events_210303.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-04-05T07:19:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210303"
}
```



---

archive/issue_comments_204879.json:
```json
{
    "body": "Changed commit from **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)** to **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)**",
    "created_at": "2014-04-05T07:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204879",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)** to **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)**



---

archive/issue_comments_204880.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d43fdda50bd5bad3b079e7861fbb725471d1d04\">2d43fdd</a></td><td><code>FiniteStateMachine: add failing doctests: non-hashable colors</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/547968aaa6eff0d3c96018bc72f080a188881134\">547968a</a></td><td><code>FiniteStateMachine.product_FiniteStateMachine, composition: fix unhashable colors</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc\">d51be51</a></td><td><code>Automaton.determinisation(): docstring on hashable colors</code></td></tr></table>\n",
    "created_at": "2014-04-05T07:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204880",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3" align="right">Comment 3</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d43fdda50bd5bad3b079e7861fbb725471d1d04">2d43fdd</a></td><td><code>FiniteStateMachine: add failing doctests: non-hashable colors</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/547968aaa6eff0d3c96018bc72f080a188881134">547968a</a></td><td><code>FiniteStateMachine.product_FiniteStateMachine, composition: fix unhashable colors</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc">d51be51</a></td><td><code>Automaton.determinisation(): docstring on hashable colors</code></td></tr></table>




---

archive/issue_comments_204881.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThe following behaviour is undesired (docstrings says that\ncolors are tuples of the colors of the constituent states,\nbut this is not the case and leads to problems in\nAutomaton.determinisation):\n\n```\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.product_FiniteStateMachine(A,\n....:                                  lambda t1, t2: (0, None))\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.composition(A, algorithm='explorative')\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\n```\nI pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.",
    "created_at": "2014-04-05T07:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204881",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:4" align="right">Comment 4</div>

The following behaviour is undesired (docstrings says that
colors are tuples of the colors of the constituent states,
but this is not the case and leads to problems in
Automaton.determinisation):

```
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.product_FiniteStateMachine(A,
....:                                  lambda t1, t2: (0, None))
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.composition(A, algorithm='explorative')
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
```
I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.



---

archive/issue_events_210304.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:43:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210304"
}
```



---

archive/issue_events_210305.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:43:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15963#event-210305"
}
```



---

archive/issue_comments_204882.json:
```json
{
    "body": "Changed branch from **[u/cheuberg/fsm/state_color](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/fsm/state_color)** to **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)**",
    "created_at": "2014-04-05T10:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204882",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cheuberg/fsm/state_color](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/fsm/state_color)** to **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)**



---

archive/issue_comments_204883.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@cheuberg](#comment%3A4):\n> The following behaviour is undesired (docstrings says that\n> colors are tuples of the colors of the constituent states,\n> but this is not the case and leads to problems in\n> Automaton.determinisation):\n> ...\n> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.\n\nI've reviewed those --> positive_review",
    "created_at": "2014-04-09T17:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204883",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@cheuberg](#comment%3A4):
> The following behaviour is undesired (docstrings says that
> colors are tuples of the colors of the constituent states,
> but this is not the case and leads to problems in
> Automaton.determinisation):
> ...
> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.

I've reviewed those --> positive_review



---

archive/issue_comments_204884.json:
```json
{
    "body": "Changed commit from **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)** to none",
    "created_at": "2014-04-09T17:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204884",
    "user": "https://github.com/dkrenn"
}
```

Changed commit from **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)** to none



---

archive/issue_comments_204885.json:
```json
{
    "body": "Changed branch from **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)** to **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)**",
    "created_at": "2015-04-17T04:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204885",
    "user": "https://github.com/cheuberg"
}
```

Changed branch from **[d51be51](https://github.com/sagemath/sagetrac-mirror/commit/d51be51b8299930abc0e6b72700eca79cd978cfc)** to **[2031f53](https://github.com/sagemath/sagetrac-mirror/commit/2031f53b78c88ec68b7ff2ffc252362174304601)**



---

archive/issue_comments_204886.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nThe last commit was not merged in this ticket, but at #16128.",
    "created_at": "2015-04-17T04:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15963#issuecomment-204886",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:7" align="right">Comment 7</div>

The last commit was not merged in this ticket, but at #16128.
