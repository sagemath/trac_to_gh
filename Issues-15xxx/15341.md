# Issue 15341: Hashing of GammaH congruence groups is broken

archive/issues_015104.json:
```json
{
    "body": "To quote the python reference manual: http://docs.python.org/2/reference/datamodel.html#object.__hash__\n\nThe only required property is that objects which compare equal have the same hash value;\n\nHowever:\n\n```\nG1=GammaH(21,[4])\nG2=GammaH(21,[4,16])\nprint G1==G2\nprint hash(G1)\nprint hash(G2)\n```\n\nprints:\n\n```\nTrue\n1170799062851396877\n8309769839484863814\n```\n\nCC:  tmonteil\n\nBranch/Commit: b2c15d3b200aee1c9658e39d75bdc67fbe59db88\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Maarten Derickx\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15341\n\n",
    "closed_at": "2017-09-10T22:05:58Z",
    "created_at": "2013-10-29T21:33:26Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Hashing of GammaH congruence groups is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15341",
    "user": "https://github.com/koffie"
}
```
To quote the python reference manual: http://docs.python.org/2/reference/datamodel.html#object.__hash__

The only required property is that objects which compare equal have the same hash value;

However:

```
G1=GammaH(21,[4])
G2=GammaH(21,[4,16])
print G1==G2
print hash(G1)
print hash(G2)
```

prints:

```
True
1170799062851396877
8309769839484863814
```

CC:  tmonteil

Branch/Commit: b2c15d3b200aee1c9658e39d75bdc67fbe59db88

Reviewer: Frédéric Chapoton

Author: Maarten Derickx

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15341





---

archive/issue_comments_206417.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,16 +8,16 @@\n G1=GammaH(21,[4])\n G2=GammaH(21,[4,16])\n print G1==G2\n-print hash(GammaH(21,[4,16]))\n-print hash(GammaH(21,[4]))\n+print hash(G1)\n+print hash(G2)\n ```\n \n prints:\n \n ```\n True\n+1170799062851396877\n 8309769839484863814\n-1170799062851396877\n ```\n \n Comment: 1\n``````\n",
    "created_at": "2013-10-29T21:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206417",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,16 +8,16 @@
 G1=GammaH(21,[4])
 G2=GammaH(21,[4,16])
 print G1==G2
-print hash(GammaH(21,[4,16]))
-print hash(GammaH(21,[4]))
+print hash(G1)
+print hash(G2)
 ```
 
 prints:
 
 ```
 True
+1170799062851396877
 8309769839484863814
-1170799062851396877
 ```
 
 Comment: 1
``````




---

archive/issue_events_044494.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44494"
}
```



---

archive/issue_events_044495.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44495"
}
```



---

archive/issue_events_044496.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44496"
}
```



---

archive/issue_events_044497.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44497"
}
```



---

archive/issue_events_044498.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44498"
}
```



---

archive/issue_comments_206418.json:
```json
{
    "body": "<a id='comment:5'></a>It will fail on 32bit systems, this ticket is reviewable if one just keeps in the back of your mind that a doctest needs to be changed for 32bit systems. \n\nHopefully the patchbot will provide the correct value (otherwise we should find someone with a 32 bit system).\n\n---\nNew commits:",
    "created_at": "2017-08-27T06:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206418",
    "user": "https://github.com/koffie"
}
```

<a id='comment:5'></a>It will fail on 32bit systems, this ticket is reviewable if one just keeps in the back of your mind that a doctest needs to be changed for 32bit systems. 

Hopefully the patchbot will provide the correct value (otherwise we should find someone with a 32 bit system).

---
New commits:



---

archive/issue_comments_206419.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-27T06:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206419",
    "user": "https://github.com/koffie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_206420.json:
```json
{
    "body": "<a id='comment:7'></a>Author name.",
    "created_at": "2017-08-27T15:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206420",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Author name.



---

archive/issue_comments_206421.json:
```json
{
    "body": "<a id='comment:8'></a>Why not\n\n```\nif xK in L:\n    rts_L.append((L(xK), mult))\n```",
    "created_at": "2017-08-27T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206421",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Why not

```
if xK in L:
    rts_L.append((L(xK), mult))
```



---

archive/issue_comments_206422.json:
```json
{
    "body": "<a id='comment:9'></a>Hi thanks for looking at this,\n\nSorry, I should have been more clear. Only commmit b96aa08b6fe8cd1809fd514a37cc48bb6c144e99 is new. Al the other commits are just #23656 so your comment only makes sense for that ticket, and doesn't relate to the code under review here.\n\nDo you happen to know a way to only show the new commits at this ticket? I tried setting #23656 as a dependency. But that doesn't work.",
    "created_at": "2017-08-27T17:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206422",
    "user": "https://github.com/koffie"
}
```

<a id='comment:9'></a>Hi thanks for looking at this,

Sorry, I should have been more clear. Only commmit b96aa08b6fe8cd1809fd514a37cc48bb6c144e99 is new. Al the other commits are just #23656 so your comment only makes sense for that ticket, and doesn't relate to the code under review here.

Do you happen to know a way to only show the new commits at this ticket? I tried setting #23656 as a dependency. But that doesn't work.



---

archive/issue_comments_206423.json:
```json
{
    "body": "<a id='comment:10'></a>My comment does not apply to anything, it was intended for #23726",
    "created_at": "2017-08-27T20:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206423",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>My comment does not apply to anything, it was intended for #23726



---

archive/issue_comments_206424.json:
```json
{
    "body": "<a id='comment:12'></a>Hi Thierry Monteil,\n\nI saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.\n\nThanks in advance,\nMaarten",
    "created_at": "2017-08-27T21:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206424",
    "user": "https://github.com/koffie"
}
```

<a id='comment:12'></a>Hi Thierry Monteil,

I saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.

Thanks in advance,
Maarten



---

archive/issue_comments_206425.json:
```json
{
    "body": "<a id='comment:13'></a>I am compiling your branch on a 32bit VM running Debian stretch. Which files chould i doctest ?",
    "created_at": "2017-08-29T16:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206425",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>I am compiling your branch on a 32bit VM running Debian stretch. Which files chould i doctest ?



---

archive/issue_comments_206426.json:
```json
{
    "body": "<a id='comment:14'></a>Thanks, the file is `src/sage/modular/arithgroup/arithgroup_generic.py`",
    "created_at": "2017-08-29T17:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206426",
    "user": "https://github.com/koffie"
}
```

<a id='comment:14'></a>Thanks, the file is `src/sage/modular/arithgroup/arithgroup_generic.py`



---

archive/issue_comments_206427.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-29T22:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206428.json:
```json
{
    "body": "<a id='comment:16'></a>I got : \n\n```\nsagemath@tmonteil-debian-stretch-32:/opt/sagemath/sage-8.0$ ./sage -t src/sage/modular/arithgroup/arithgroup_generic.py\nForcing sage-location, probably because a new package was installed.\nCleaning up, do not interrupt this.\nDone cleaning.\nRunning doctests with ID 2017-08-29-22-50-23-b6ae0811.\nGit branch: develop\nUsing --optional=4ti2,benzene,bliss,buckygen,cbc,ccache,cmake,coxeter3,cryptominisat,csdp,d3js,database_gap,database_pari,frobby,gambit,gap_jupyter,gap_packages,gdb,giacpy_sage,gmpy2,gp2c,igraph,latte_int,libbraiding,libhomfly,libogg,lidia,lrslib,mcqd,meataxe,mpir,normaliz,ore_algebra,pandoc_attributes,pandocfilters,pari_jupyter,plantri,pynormaliz,pysingular,python2,python_igraph,qepcad,rst2ipynb,saclib,sage,scons,singular_jupyter,sip,sirocco,tdlib,termcap,tides,topcom\nDoctesting 1 file.\nsage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py\n**********************************************************************\nFile \"src/sage/modular/arithgroup/arithgroup_generic.py\", line 199, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__\nFailed example:\n    Gamma0(11).__hash__()\nExpected:\n    -545929996 \nGot:\n    118770652\n**********************************************************************\nFile \"src/sage/modular/arithgroup/arithgroup_generic.py\", line 202, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__\nFailed example:\n    Gamma1(11).__hash__()\nExpected:\n    -830809815 \nGot:\n    201042552\n**********************************************************************\n1 item had failures:\n   2 of   8 in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__\n    [159 tests, 2 failures, 5.60 s]\n----------------------------------------------------------------------\nsage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 5.7 seconds\n    cpu time: 3.5 seconds\n    cumulative wall time: 5.6 seconds\n```\n\nWhich is consistent with your latest commit.",
    "created_at": "2017-08-29T22:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206428",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:16'></a>I got : 

```
sagemath@tmonteil-debian-stretch-32:/opt/sagemath/sage-8.0$ ./sage -t src/sage/modular/arithgroup/arithgroup_generic.py
Forcing sage-location, probably because a new package was installed.
Cleaning up, do not interrupt this.
Done cleaning.
Running doctests with ID 2017-08-29-22-50-23-b6ae0811.
Git branch: develop
Using --optional=4ti2,benzene,bliss,buckygen,cbc,ccache,cmake,coxeter3,cryptominisat,csdp,d3js,database_gap,database_pari,frobby,gambit,gap_jupyter,gap_packages,gdb,giacpy_sage,gmpy2,gp2c,igraph,latte_int,libbraiding,libhomfly,libogg,lidia,lrslib,mcqd,meataxe,mpir,normaliz,ore_algebra,pandoc_attributes,pandocfilters,pari_jupyter,plantri,pynormaliz,pysingular,python2,python_igraph,qepcad,rst2ipynb,saclib,sage,scons,singular_jupyter,sip,sirocco,tdlib,termcap,tides,topcom
Doctesting 1 file.
sage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py
**********************************************************************
File "src/sage/modular/arithgroup/arithgroup_generic.py", line 199, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
Failed example:
    Gamma0(11).__hash__()
Expected:
    -545929996 
Got:
    118770652
**********************************************************************
File "src/sage/modular/arithgroup/arithgroup_generic.py", line 202, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
Failed example:
    Gamma1(11).__hash__()
Expected:
    -830809815 
Got:
    201042552
**********************************************************************
1 item had failures:
   2 of   8 in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
    [159 tests, 2 failures, 5.60 s]
----------------------------------------------------------------------
sage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 5.7 seconds
    cpu time: 3.5 seconds
    cumulative wall time: 5.6 seconds
```

Which is consistent with your latest commit.



---

archive/issue_events_044499.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-08-31T05:40:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44499"
}
```



---

archive/issue_events_044500.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-08-31T05:40:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44500"
}
```



---

archive/issue_comments_206429.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:12 mderickx]:\n> Hi Thierry Monteil,\n> \n> I saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.\n\n\nHashing on a 32 bit is just the same thing but modulo `2^32`\n\n```\nsage: 3713075136762760156 % (2**32)\n118770652\n```\n(though the result are in (-2<sup>31</sup>, 2<sup>31</sup>])",
    "created_at": "2017-09-01T23:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206429",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:12 mderickx]:
> Hi Thierry Monteil,
> 
> I saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.


Hashing on a 32 bit is just the same thing but modulo `2^32`

```
sage: 3713075136762760156 % (2**32)
118770652
```
(though the result are in (-2<sup>31</sup>, 2<sup>31</sup>])



---

archive/issue_comments_206430.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-06T05:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206430",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_206431.json:
```json
{
    "body": "<a id='comment:19'></a>ok",
    "created_at": "2017-09-06T05:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206431",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>ok



---

archive/issue_comments_206432.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T22:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15341#issuecomment-206432",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_044501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T22:05:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15341",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15341#event-44501"
}
```
