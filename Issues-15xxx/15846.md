# Issue 15846: Incorrect series expansion of zeta(s) at 1

archive/issues_015609.json:
```json
{
    "assignees": [],
    "body": "The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have\n\n```\nsage: zeta(x).series(x==1,2)\n(Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)\n```\n\nwhen in fact, we should have\n\n```\nsage: zeta(x).series(x==1, 1)\n1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n```\n\n(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n\nDepends on #18237\n\nCC:  @behackl\n\nBranch/Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**\n\nUpstream: **Completely fixed; Fix reported upstream**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Benjamin Hackl**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15846_\n\n",
    "closed_at": "2015-04-19T01:51:59Z",
    "created_at": "2014-02-22T17:48:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Incorrect series expansion of zeta(s) at 1",
    "type": "issue",
    "updated_at": "2015-04-19T01:51:59Z",
    "url": "https://github.com/sagemath/sage/issues/15846",
    "user": "https://github.com/mezzarobba"
}
```
The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have

```
sage: zeta(x).series(x==1,2)
(Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)
```

when in fact, we should have

```
sage: zeta(x).series(x==1, 1)
1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
```

(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)

Depends on #18237

CC:  @behackl

Branch/Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**

Upstream: **Completely fixed; Fix reported upstream**

Reviewer: **Ralf Stephan**

Author: **Benjamin Hackl**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/15846_





---

archive/issue_events_226290.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226290"
}
```



---

archive/issue_events_226291.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226291"
}
```



---

archive/issue_events_226292.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226292"
}
```



---

archive/issue_events_226293.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226293"
}
```



---

archive/issue_events_226294.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226294"
}
```



---

archive/issue_events_226295.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226295"
}
```



---

archive/issue_events_226296.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226296"
}
```



---

archive/issue_events_226297.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226297"
}
```



---

archive/issue_comments_200576.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI *think* I may have tracked down the reason for this back to SymPy. There, we have\n\n```\n>>> from sympy import zeta, gamma\n>>> from sympy.abc import x\n>>> gamma(x).series(x, x0=0, n=1)\n1/x - EulerGamma + O(x)\n```\n\nthat is, expanding the gamma function at a pole works. However, for the zeta function:\n\n```\n>>> zeta(x).series(x, x0=1, n=1)\nTraceback (most recent call last):\n...\nsympy.core.function.PoleError: Cannot expand zeta(_x + 1) around 0\n```\n\nThis could be fixed by implementing `_eval_nseries` directly for `zeta` (which can be found at `local/lib/python/site-packages/sympy/functions/sepecial/zeta_functions.py`) intelligently enough such that the pole at s=1 is handled. Unfortunately, I think there has to be a discussion first how to handle the coefficients in this expansion (cf. http://dlmf.nist.gov/25.2#E4). (AFAIK, the generalized Euler-Mascheroni constants are currently **not** implemented symbolically...)",
    "created_at": "2015-04-07T15:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200576",
    "user": "https://github.com/behackl"
}
```

<div id="comment:3" align="right">comment:3</div>

I *think* I may have tracked down the reason for this back to SymPy. There, we have

```
>>> from sympy import zeta, gamma
>>> from sympy.abc import x
>>> gamma(x).series(x, x0=0, n=1)
1/x - EulerGamma + O(x)
```

that is, expanding the gamma function at a pole works. However, for the zeta function:

```
>>> zeta(x).series(x, x0=1, n=1)
Traceback (most recent call last):
...
sympy.core.function.PoleError: Cannot expand zeta(_x + 1) around 0
```

This could be fixed by implementing `_eval_nseries` directly for `zeta` (which can be found at `local/lib/python/site-packages/sympy/functions/sepecial/zeta_functions.py`) intelligently enough such that the pole at s=1 is handled. Unfortunately, I think there has to be a discussion first how to handle the coefficients in this expansion (cf. http://dlmf.nist.gov/25.2#E4). (AFAIK, the generalized Euler-Mascheroni constants are currently **not** implemented symbolically...)



---

archive/issue_comments_200577.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWell, although there definitely is that problem in SymPy, the erronous expansion in sage seems to originate from Ginac:\n\n```\nbehackl@Jethro ~ $ ginsh\nginsh - GiNaC Interactive Shell (GiNaC V1.6.3)\n  __,  _______  Copyright (C) 1999-2014 Johannes Gutenberg University Mainz,\n (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.\n  ._) i N a C | You are welcome to redistribute it under certain conditions.\n<-------------' For details type `warranty;'.\n\nType ?? for a list of help topics.\n> series(zeta(x+1), x, 2);\n(zeta(1))+(zetaderiv(1,1))*x+Order(x^2)\n```\n\nThis is exactly the output as in sage itself.\n\nThe zeta function does not seem to be very popular in that matter. ;-)",
    "created_at": "2015-04-07T17:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200577",
    "user": "https://github.com/behackl"
}
```

<div id="comment:4" align="right">comment:4</div>

Well, although there definitely is that problem in SymPy, the erronous expansion in sage seems to originate from Ginac:

```
behackl@Jethro ~ $ ginsh
ginsh - GiNaC Interactive Shell (GiNaC V1.6.3)
  __,  _______  Copyright (C) 1999-2014 Johannes Gutenberg University Mainz,
 (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.
  ._) i N a C | You are welcome to redistribute it under certain conditions.
<-------------' For details type `warranty;'.

Type ?? for a list of help topics.
> series(zeta(x+1), x, 2);
(zeta(1))+(zetaderiv(1,1))*x+Order(x^2)
```

This is exactly the output as in sage itself.

The zeta function does not seem to be very popular in that matter. ;-)



---

archive/issue_comments_200578.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@behackl](#comment:4):\n> The zeta function does not seem to be very popular in that matter. ;-)\n\nNeither with Maxima, which is invoked via `taylor`:\n\n```\nsage: taylor(zeta(x),x,1,1)\n...\nTypeError: ECL says: Error executing code in Maxima: taylor: encountered an unfamiliar singularity in:\n```\nCould you please add the exact output you expect from `series` to the ticket description?",
    "created_at": "2015-04-08T06:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200578",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@behackl](#comment:4):
> The zeta function does not seem to be very popular in that matter. ;-)

Neither with Maxima, which is invoked via `taylor`:

```
sage: taylor(zeta(x),x,1,1)
...
TypeError: ECL says: Error executing code in Maxima: taylor: encountered an unfamiliar singularity in:
```
Could you please add the exact output you expect from `series` to the ticket description?



---

archive/issue_comments_200579.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,15 @@\n+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have\n \n ```\n sage: zeta(x).series(x==1,2)\n (Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)\n ```\n+\n+when in fact, we should have\n+\n+```\n+sage: zeta(x).series(x==1, 1)\n+1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+```\n+\n+(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T07:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200579",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,15 @@
+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have
 
 ```
 sage: zeta(x).series(x==1,2)
 (Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)
 ```
+
+when in fact, we should have
+
+```
+sage: zeta(x).series(x==1, 1)
+1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+```
+
+(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_200580.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n\nWhen using zeta's functional equation http://dlmf.nist.gov/25.4.E2 for the series expansion around `s=1`, then within GiNaC, I obtain the expression now stated in the description.\n\nFor a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form \n\n```\nsage: zeta(x).series(x==1, 1)\n1*(-1+x)^(-1)+(euler_gamma)+Order(-1+x)\n```\n\nMaxima probably has a similar problem like SymPy, GiNaC et al.; I guess we should report the issue there as well?",
    "created_at": "2015-04-08T07:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200580",
    "user": "https://github.com/behackl"
}
```

<div id="comment:7" align="right">comment:7</div>

I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.

When using zeta's functional equation http://dlmf.nist.gov/25.4.E2 for the series expansion around `s=1`, then within GiNaC, I obtain the expression now stated in the description.

For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form 

```
sage: zeta(x).series(x==1, 1)
1*(-1+x)^(-1)+(euler_gamma)+Order(-1+x)
```

Maxima probably has a similar problem like SymPy, GiNaC et al.; I guess we should report the issue there as well?



---

archive/issue_comments_200581.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have\n+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have\n \n ```\n sage: zeta(x).series(x==1,2)\n@@ -9,7 +9,7 @@\n \n ```\n sage: zeta(x).series(x==1, 1)\n-1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n ```\n \n (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T07:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200581",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have
+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have
 
 ```
 sage: zeta(x).series(x==1,2)
@@ -9,7 +9,7 @@
 
 ```
 sage: zeta(x).series(x==1, 1)
-1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
 ```
 
 (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_200582.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@behackl](#comment:7):\n> I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n\nWhat do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.\n\n> For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form \n\nYes, see #18141",
    "created_at": "2015-04-08T08:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200582",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@behackl](#comment:7):
> I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.

What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.

> For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form 

Yes, see #18141



---

archive/issue_comments_200583.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[zeta_expansion.patch.gz](https://github.com/sagemath/sage/files/ticket15846/zeta_expansion.patch.gz)**\n\nReplying to [@rwst](#comment:8):\n\n\n> Replying to [@behackl](#comment:7):\n> \n> > I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n> > \n\n> What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.\n\nWell, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)",
    "created_at": "2015-04-08T08:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200583",
    "user": "https://github.com/behackl"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[zeta_expansion.patch.gz](https://github.com/sagemath/sage/files/ticket15846/zeta_expansion.patch.gz)**

Replying to [@rwst](#comment:8):


> Replying to [@behackl](#comment:7):
> 
> > I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.
> > 

> What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.

Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)



---

archive/issue_comments_200584.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@behackl](#comment:9):\n> Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)\n\nI do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made. BTW, if you intend to do changes to Pynac, I have a github mirror/copy which you can use, and I'll actively support you, might even be tempted to do changes myself: https://github.com/rwst/pynac",
    "created_at": "2015-04-08T09:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200584",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@behackl](#comment:9):
> Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)

I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made. BTW, if you intend to do changes to Pynac, I have a github mirror/copy which you can use, and I'll actively support you, might even be tempted to do changes myself: https://github.com/rwst/pynac



---

archive/issue_comments_200585.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n> I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.\n\nAh okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/",
    "created_at": "2015-04-08T09:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200585",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">comment:11</div>

> I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.

Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/



---

archive/issue_comments_200586.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI just compiled sage with the patch added to pynac, and now I get\n\n```\nsage: zeta(x).series(x==1, 1)\n1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n```\n\nSeems to work. :-)\n\nSo, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\nReplying to [@rwst](#comment:11):\n> > I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.\n\n> Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/\n\nWell, as of yet I have done nothing, really (except for fixing this thing locally). ;-)\nBut I guess I could also submit my changes there, the official GiNaC version also has the same problem w.r.t. the expansion of zeta. (However, the version on git wouldn't compile for me yesterday, so for fixing this I initially used the tarball on their website...)",
    "created_at": "2015-04-08T09:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200586",
    "user": "https://github.com/behackl"
}
```

<div id="comment:12" align="right">comment:12</div>

I just compiled sage with the patch added to pynac, and now I get

```
sage: zeta(x).series(x==1, 1)
1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
```

Seems to work. :-)

So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

Replying to [@rwst](#comment:11):
> > I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.

> Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/

Well, as of yet I have done nothing, really (except for fixing this thing locally). ;-)
But I guess I could also submit my changes there, the official GiNaC version also has the same problem w.r.t. the expansion of zeta. (However, the version on git wouldn't compile for me yesterday, so for fixing this I initially used the tarball on their website...)



---

archive/issue_comments_200587.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n \n ```\n sage: zeta(x).series(x==1, 1)\n-1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n ```\n \n (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T09:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200587",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 
 ```
 sage: zeta(x).series(x==1, 1)
-1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
 ```
 
 (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_200588.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@behackl](#comment:12):\n> So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\nGood question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.",
    "created_at": "2015-04-08T09:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200588",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@behackl](#comment:12):
> So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.



---

archive/issue_comments_200589.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@rwst](#comment:13):\n> Replying to [@behackl](#comment:12):\n> > So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\n> Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.\n\nI've send you a pull request on your GitHub clone.\n\nIf you try to push a new Pynac version, I suppose that would be fine. I could also report the issue (altogether with my patch) to the bitbucket site and wait for a response from there -- but what I currently don't want to try is releasing the package myself. Maybe we should also ask those involved with Pynac for their opinion?",
    "created_at": "2015-04-08T10:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200589",
    "user": "https://github.com/behackl"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@rwst](#comment:13):
> Replying to [@behackl](#comment:12):
> > So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

> Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.

I've send you a pull request on your GitHub clone.

If you try to push a new Pynac version, I suppose that would be fine. I could also report the issue (altogether with my patch) to the bitbucket site and wait for a response from there -- but what I currently don't want to try is releasing the package myself. Maybe we should also ask those involved with Pynac for their opinion?



---

archive/issue_comments_200590.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have posted at https://groups.google.com/forum/?hl=en#!topic/sage-devel/hwQXxFmutcU",
    "created_at": "2015-04-08T12:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200590",
    "user": "https://github.com/rwst"
}
```

<div id="comment:15" align="right">comment:15</div>

I have posted at https://groups.google.com/forum/?hl=en#!topic/sage-devel/hwQXxFmutcU



---

archive/issue_comments_200591.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks! Let me know if there is anything I can do to help.",
    "created_at": "2015-04-08T14:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200591",
    "user": "https://github.com/behackl"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks! Let me know if there is anything I can do to help.



---

archive/issue_comments_200592.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@behackl](#comment:16):\n> Thanks! Let me know if there is anything I can do to help.\n\nPlease write two doctests around l.70-80 in `functions/transcendental.py` (one checking symbolic output, the other demonstrating numerics) so that we see whenever there is a regression. They will of course, only pass when Sage is upgraded to pynac-0.3.3, so this ticket depends on the upgrade ticket.",
    "created_at": "2015-04-10T07:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200592",
    "user": "https://github.com/rwst"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@behackl](#comment:16):
> Thanks! Let me know if there is anything I can do to help.

Please write two doctests around l.70-80 in `functions/transcendental.py` (one checking symbolic output, the other demonstrating numerics) so that we see whenever there is a regression. They will of course, only pass when Sage is upgraded to pynac-0.3.3, so this ticket depends on the upgrade ticket.



---

archive/issue_comments_200593.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nDone. For the sake of completeness: the upstream fix can be found at https://github.com/pynac/pynac/pull/1\n\nI'll leave this ticket's status as `new` until I can set the Pynac-update ticket as a dependency.",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200593",
    "user": "https://github.com/behackl"
}
```

<div id="comment:18" align="right">comment:18</div>

Done. For the sake of completeness: the upstream fix can be found at https://github.com/pynac/pynac/pull/1

I'll leave this ticket's status as `new` until I can set the Pynac-update ticket as a dependency.



---

archive/issue_comments_200594.json:
```json
{
    "body": "Branch: **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200594",
    "user": "https://github.com/behackl"
}
```

Branch: **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)**



---

archive/issue_comments_200595.json:
```json
{
    "body": "Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200595",
    "user": "https://github.com/behackl"
}
```

Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**



---

archive/issue_comments_200596.json:
```json
{
    "body": "Upstream: **Completely fixed; Fix reported upstream**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200596",
    "user": "https://github.com/behackl"
}
```

Upstream: **Completely fixed; Fix reported upstream**



---

archive/issue_comments_200597.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOh, sorry -- I did not read the part with the doctest that should demonstrate numerics. \n\nDo you mean something like\n\n```\nsage: zeta(x).series(x==1, 1).coefficient(x, 0).n()\n0.577215664901533\n```",
    "created_at": "2015-04-10T13:36:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200597",
    "user": "https://github.com/behackl"
}
```

<div id="comment:19" align="right">comment:19</div>

Oh, sorry -- I did not read the part with the doctest that should demonstrate numerics. 

Do you mean something like

```
sage: zeta(x).series(x==1, 1).coefficient(x, 0).n()
0.577215664901533
```



---

archive/issue_comments_200598.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nNot sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.",
    "created_at": "2015-04-10T13:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200598",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">comment:20</div>

Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.



---

archive/issue_comments_200599.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@rwst](#comment:20):\n> Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.\n\nWell, there would be some sort of approximation error -- but something like checking the numerical value of the absolute term is certainly possible (like in the modified comment above).",
    "created_at": "2015-04-10T13:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200599",
    "user": "https://github.com/behackl"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@rwst](#comment:20):
> Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.

Well, there would be some sort of approximation error -- but something like checking the numerical value of the absolute term is certainly possible (like in the modified comment above).



---

archive/issue_comments_200600.json:
```json
{
    "body": "Dependencies: **#18155**",
    "created_at": "2015-04-10T14:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200600",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#18155**



---

archive/issue_events_226298.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-10T14:46:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226298"
}
```



---

archive/issue_events_226299.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-10T14:46:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226299"
}
```



---

archive/issue_comments_200601.json:
```json
{
    "body": "Author: **Benjamin Hackl**",
    "created_at": "2015-04-11T14:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200601",
    "user": "https://github.com/behackl"
}
```

Author: **Benjamin Hackl**



---

archive/issue_events_226300.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2015-04-11T14:10:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226300"
}
```



---

archive/issue_comments_200602.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2015-04-11T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200602",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_226301.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-11T14:51:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226301"
}
```



---

archive/issue_events_226302.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-11T14:51:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226302"
}
```



---

archive/issue_comments_200603.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIs fine, thanks.",
    "created_at": "2015-04-11T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200603",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

Is fine, thanks.



---

archive/issue_comments_200604.json:
```json
{
    "body": "Changed dependencies from **#18155** to **#18237**",
    "created_at": "2015-04-17T13:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200604",
    "user": "https://github.com/behackl"
}
```

Changed dependencies from **#18155** to **#18237**



---

archive/issue_comments_200605.json:
```json
{
    "body": "Changed branch from **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)** to **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**",
    "created_at": "2015-04-19T01:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-200605",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)** to **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**



---

archive/issue_events_226303.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T01:51:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226303"
}
```



---

archive/issue_events_226304.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "85b3be28c08fa83da649951156483a05fd189adc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-19T01:51:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-226304"
}
```
