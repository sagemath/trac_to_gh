# Issue 15846: Incorrect series expansion of zeta(s) at 1

archive/issues_015609.json:
```json
{
    "assignees": [],
    "body": "The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have\n\n```\nsage: zeta(x).series(x==1,2)\n(Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)\n```\n\nwhen in fact, we should have\n\n```\nsage: zeta(x).series(x==1, 1)\n1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n```\n\n(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n\nDepends on #18237\n\nCC:  @behackl\n\nBranch/Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**\n\nUpstream: **Completely fixed; Fix reported upstream**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Benjamin Hackl**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15846_\n\n",
    "closed_at": "2015-04-19T01:51:59Z",
    "created_at": "2014-02-22T17:48:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Incorrect series expansion of zeta(s) at 1",
    "type": "issue",
    "updated_at": "2015-04-19T01:51:59Z",
    "url": "https://github.com/sagemath/sage/issues/15846",
    "user": "https://github.com/mezzarobba"
}
```
The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have

```
sage: zeta(x).series(x==1,2)
(Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)
```

when in fact, we should have

```
sage: zeta(x).series(x==1, 1)
1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
```

(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)

Depends on #18237

CC:  @behackl

Branch/Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**

Upstream: **Completely fixed; Fix reported upstream**

Reviewer: **Ralf Stephan**

Author: **Benjamin Hackl**

_Issue created by migration from https://trac.sagemath.org/ticket/15846_





---

archive/issue_events_201337.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201337"
}
```



---

archive/issue_events_201338.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201338"
}
```



---

archive/issue_events_201339.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201339"
}
```



---

archive/issue_events_201340.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-22T17:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201340"
}
```



---

archive/issue_events_201341.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201341"
}
```



---

archive/issue_events_201342.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201342"
}
```



---

archive/issue_events_201343.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201343"
}
```



---

archive/issue_events_201344.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201344"
}
```



---

archive/issue_comments_203026.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI *think* I may have tracked down the reason for this back to SymPy. There, we have\n\n```\n>>> from sympy import zeta, gamma\n>>> from sympy.abc import x\n>>> gamma(x).series(x, x0=0, n=1)\n1/x - EulerGamma + O(x)\n```\n\nthat is, expanding the gamma function at a pole works. However, for the zeta function:\n\n```\n>>> zeta(x).series(x, x0=1, n=1)\nTraceback (most recent call last):\n...\nsympy.core.function.PoleError: Cannot expand zeta(_x + 1) around 0\n```\n\nThis could be fixed by implementing `_eval_nseries` directly for `zeta` (which can be found at `local/lib/python/site-packages/sympy/functions/sepecial/zeta_functions.py`) intelligently enough such that the pole at s=1 is handled. Unfortunately, I think there has to be a discussion first how to handle the coefficients in this expansion (cf. http://dlmf.nist.gov/25.2#E4). (AFAIK, the generalized Euler-Mascheroni constants are currently **not** implemented symbolically...)",
    "created_at": "2015-04-07T15:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203026",
    "user": "https://github.com/behackl"
}
```

<a id='comment:3'>Comment 3:</a>
I *think* I may have tracked down the reason for this back to SymPy. There, we have

```
>>> from sympy import zeta, gamma
>>> from sympy.abc import x
>>> gamma(x).series(x, x0=0, n=1)
1/x - EulerGamma + O(x)
```

that is, expanding the gamma function at a pole works. However, for the zeta function:

```
>>> zeta(x).series(x, x0=1, n=1)
Traceback (most recent call last):
...
sympy.core.function.PoleError: Cannot expand zeta(_x + 1) around 0
```

This could be fixed by implementing `_eval_nseries` directly for `zeta` (which can be found at `local/lib/python/site-packages/sympy/functions/sepecial/zeta_functions.py`) intelligently enough such that the pole at s=1 is handled. Unfortunately, I think there has to be a discussion first how to handle the coefficients in this expansion (cf. http://dlmf.nist.gov/25.2#E4). (AFAIK, the generalized Euler-Mascheroni constants are currently **not** implemented symbolically...)



---

archive/issue_comments_203027.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nWell, although there definitely is that problem in SymPy, the erronous expansion in sage seems to originate from Ginac:\n\n```\nbehackl@Jethro ~ $ ginsh\nginsh - GiNaC Interactive Shell (GiNaC V1.6.3)\n  __,  _______  Copyright (C) 1999-2014 Johannes Gutenberg University Mainz,\n (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.\n  ._) i N a C | You are welcome to redistribute it under certain conditions.\n<-------------' For details type `warranty;'.\n\nType ?? for a list of help topics.\n> series(zeta(x+1), x, 2);\n(zeta(1))+(zetaderiv(1,1))*x+Order(x^2)\n```\n\nThis is exactly the output as in sage itself.\n\nThe zeta function does not seem to be very popular in that matter. ;-)",
    "created_at": "2015-04-07T17:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203027",
    "user": "https://github.com/behackl"
}
```

<a id='comment:4'>Comment 4:</a>
Well, although there definitely is that problem in SymPy, the erronous expansion in sage seems to originate from Ginac:

```
behackl@Jethro ~ $ ginsh
ginsh - GiNaC Interactive Shell (GiNaC V1.6.3)
  __,  _______  Copyright (C) 1999-2014 Johannes Gutenberg University Mainz,
 (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.
  ._) i N a C | You are welcome to redistribute it under certain conditions.
<-------------' For details type `warranty;'.

Type ?? for a list of help topics.
> series(zeta(x+1), x, 2);
(zeta(1))+(zetaderiv(1,1))*x+Order(x^2)
```

This is exactly the output as in sage itself.

The zeta function does not seem to be very popular in that matter. ;-)



---

archive/issue_comments_203028.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@behackl](#comment%3A4):\n> The zeta function does not seem to be very popular in that matter. ;-)\n\nNeither with Maxima, which is invoked via `taylor`:\n\n```\nsage: taylor(zeta(x),x,1,1)\n...\nTypeError: ECL says: Error executing code in Maxima: taylor: encountered an unfamiliar singularity in:\n```\nCould you please add the exact output you expect from `series` to the ticket description?",
    "created_at": "2015-04-08T06:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203028",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@behackl](#comment%3A4):
> The zeta function does not seem to be very popular in that matter. ;-)

Neither with Maxima, which is invoked via `taylor`:

```
sage: taylor(zeta(x),x,1,1)
...
TypeError: ECL says: Error executing code in Maxima: taylor: encountered an unfamiliar singularity in:
```
Could you please add the exact output you expect from `series` to the ticket description?



---

archive/issue_comments_203029.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,15 @@\n+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have\n \n ```\n sage: zeta(x).series(x==1,2)\n (Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)\n ```\n+\n+when in fact, we should have\n+\n+```\n+sage: zeta(x).series(x==1, 1)\n+1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+```\n+\n+(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T07:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203029",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,15 @@
+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have
 
 ```
 sage: zeta(x).series(x==1,2)
 (Infinity) + (zetaderiv(1, 1))*(x - 1) + Order((x - 1)^2)
 ```
+
+when in fact, we should have
+
+```
+sage: zeta(x).series(x==1, 1)
+1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+```
+
+(see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_203030.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n\nWhen using zeta's functional equation http://dlmf.nist.gov/25.4.E2 for the series expansion around `s=1`, then within GiNaC, I obtain the expression now stated in the description.\n\nFor a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form \n\n```\nsage: zeta(x).series(x==1, 1)\n1*(-1+x)^(-1)+(euler_gamma)+Order(-1+x)\n```\n\nMaxima probably has a similar problem like SymPy, GiNaC et al.; I guess we should report the issue there as well?",
    "created_at": "2015-04-08T07:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203030",
    "user": "https://github.com/behackl"
}
```

<a id='comment:7'>Comment 7:</a>
I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.

When using zeta's functional equation http://dlmf.nist.gov/25.4.E2 for the series expansion around `s=1`, then within GiNaC, I obtain the expression now stated in the description.

For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form 

```
sage: zeta(x).series(x==1, 1)
1*(-1+x)^(-1)+(euler_gamma)+Order(-1+x)
```

Maxima probably has a similar problem like SymPy, GiNaC et al.; I guess we should report the issue there as well?



---

archive/issue_comments_203031.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have\n+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have\n \n ```\n sage: zeta(x).series(x==1,2)\n@@ -9,7 +9,7 @@\n \n ```\n sage: zeta(x).series(x==1, 1)\n-1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n ```\n \n (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T07:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203031",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within sage, we have
+The series expansion of the zeta function around its singularity at `s=1` is incorrect. Within Sage, we have
 
 ```
 sage: zeta(x).series(x==1,2)
@@ -9,7 +9,7 @@
 
 ```
 sage: zeta(x).series(x==1, 1)
-1*(-1+x)^(-1)+(log(Pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
 ```
 
 (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_203032.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@behackl](#comment%3A7):\n> I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n\nWhat do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.\n\n> For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form \n\nYes, see #18141",
    "created_at": "2015-04-08T08:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203032",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@behackl](#comment%3A7):
> I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.

What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.

> For a follow-up ticket, it would probably be nice to tell sage that `zetaderiv(0,1)` is equal to `-log(sqrt(2*pi))`, as it simplifies the expansion to the more likeable form 

Yes, see #18141



---

archive/issue_comments_203033.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nAttachment: **[zeta_expansion.patch.gz](https://github.com/sagemath/sage/files/ticket15846/zeta_expansion.patch.gz)**\n\nReplying to [@rwst](#comment%3A8):\n\n\n> Replying to [@behackl](#comment%3A7):\n> \n> > I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.\n> > \n\n> What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.\n\nWell, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)",
    "created_at": "2015-04-08T08:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203033",
    "user": "https://github.com/behackl"
}
```

<a id='comment:9'>Comment 9:</a>
Attachment: **[zeta_expansion.patch.gz](https://github.com/sagemath/sage/files/ticket15846/zeta_expansion.patch.gz)**

Replying to [@rwst](#comment%3A8):


> Replying to [@behackl](#comment%3A7):
> 
> > I managed to find a fix for the problem in GiNaC, which should -- more or less -- directly translate into a fix for Pynac, which Sage uses as a substitute for GiNaC.
> > 

> What do you mean? If it's a patch on top of recent GiNaC it might not be applicable to Pynac.

Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)



---

archive/issue_comments_203034.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@behackl](#comment%3A9):\n> Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)\n\nI do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made. BTW, if you intend to do changes to Pynac, I have a github mirror/copy which you can use, and I'll actively support you, might even be tempted to do changes myself: https://github.com/rwst/pynac",
    "created_at": "2015-04-08T09:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203034",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@behackl](#comment%3A9):
> Well, I just implemented `zeta1_series` in `ginac/inifcns_nstdsums.cpp` -- I don't really know, do you think that would fix the problem in Pynac too? (See attachment.)

I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made. BTW, if you intend to do changes to Pynac, I have a github mirror/copy which you can use, and I'll actively support you, might even be tempted to do changes myself: https://github.com/rwst/pynac



---

archive/issue_comments_203035.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\n> I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.\n\nAh okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/",
    "created_at": "2015-04-08T09:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203035",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'>Comment 11:</a>
> I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.

Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/



---

archive/issue_comments_203036.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nI just compiled sage with the patch added to pynac, and now I get\n\n```\nsage: zeta(x).series(x==1, 1)\n1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n```\n\nSeems to work. :-)\n\nSo, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\nReplying to [@rwst](#comment%3A11):\n> > I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.\n\n> Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/\n\nWell, as of yet I have done nothing, really (except for fixing this thing locally). ;-)\nBut I guess I could also submit my changes there, the official GiNaC version also has the same problem w.r.t. the expansion of zeta. (However, the version on git wouldn't compile for me yesterday, so for fixing this I initially used the tarball on their website...)",
    "created_at": "2015-04-08T09:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203036",
    "user": "https://github.com/behackl"
}
```

<a id='comment:12'>Comment 12:</a>
I just compiled sage with the patch added to pynac, and now I get

```
sage: zeta(x).series(x==1, 1)
1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
```

Seems to work. :-)

So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

Replying to [@rwst](#comment%3A11):
> > I do not have the impression that Pynac has ever upgraded its GiNaC part since the point in time the fork was made.

> Ah okay, I thought you made a patch on top of The Official GiNaC, i.e., http://www.ginac.de/ginac.git/

Well, as of yet I have done nothing, really (except for fixing this thing locally). ;-)
But I guess I could also submit my changes there, the official GiNaC version also has the same problem w.r.t. the expansion of zeta. (However, the version on git wouldn't compile for me yesterday, so for fixing this I initially used the tarball on their website...)



---

archive/issue_comments_203037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n \n ```\n sage: zeta(x).series(x==1, 1)\n-1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)\n+1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)\n ```\n \n (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)\n``````\n",
    "created_at": "2015-04-08T09:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203037",
    "user": "https://github.com/behackl"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 
 ```
 sage: zeta(x).series(x==1, 1)
-1*(-1+x)^(-1)+(log(pi)+log(2)+euler_gamma+2*zetaderiv(1,0))+Order(-1+x)
+1*(x - 1)^(-1) + (euler_gamma + log(2) + log(pi) + 2*zetaderiv(1, 0)) + Order(x - 1)
 ```
 
 (see http://dlmf.nist.gov/25.2.E4 for the expansion like it is supposed to be.)
``````




---

archive/issue_comments_203038.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@behackl](#comment%3A12):\n> So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\nGood question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.",
    "created_at": "2015-04-08T09:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203038",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@behackl](#comment%3A12):
> So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.



---

archive/issue_comments_203039.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@rwst](#comment%3A13):\n> Replying to [@behackl](#comment%3A12):\n> > So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?\n\n> Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.\n\nI've send you a pull request on your GitHub clone.\n\nIf you try to push a new Pynac version, I suppose that would be fine. I could also report the issue (altogether with my patch) to the bitbucket site and wait for a response from there -- but what I currently don't want to try is releasing the package myself. Maybe we should also ask those involved with Pynac for their opinion?",
    "created_at": "2015-04-08T10:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203039",
    "user": "https://github.com/behackl"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@rwst](#comment%3A13):
> Replying to [@behackl](#comment%3A12):
> > So, in order to get this ticket resolved and have the fix in Sage, what is the best way to proceed from here? I'd certainly like to commit the changes to your github mirror -- but what happens then?

> Good question. I would (with perhaps other changes) publish a new Pynac version, refer to it from this ticket, and see what happens: if there is an existing Pynac maintainer s/he should act. 2. You could clone the repo on github and do a new release yourself; or 3. you could propose your patch in an issue at the Pynac bitbucket site.

I've send you a pull request on your GitHub clone.

If you try to push a new Pynac version, I suppose that would be fine. I could also report the issue (altogether with my patch) to the bitbucket site and wait for a response from there -- but what I currently don't want to try is releasing the package myself. Maybe we should also ask those involved with Pynac for their opinion?



---

archive/issue_comments_203040.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI have posted at https://groups.google.com/forum/?hl=en#!topic/sage-devel/hwQXxFmutcU",
    "created_at": "2015-04-08T12:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203040",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'>Comment 15:</a>
I have posted at https://groups.google.com/forum/?hl=en#!topic/sage-devel/hwQXxFmutcU



---

archive/issue_comments_203041.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThanks! Let me know if there is anything I can do to help.",
    "created_at": "2015-04-08T14:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203041",
    "user": "https://github.com/behackl"
}
```

<a id='comment:16'>Comment 16:</a>
Thanks! Let me know if there is anything I can do to help.



---

archive/issue_comments_203042.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@behackl](#comment%3A16):\n> Thanks! Let me know if there is anything I can do to help.\n\nPlease write two doctests around l.70-80 in `functions/transcendental.py` (one checking symbolic output, the other demonstrating numerics) so that we see whenever there is a regression. They will of course, only pass when Sage is upgraded to pynac-0.3.3, so this ticket depends on the upgrade ticket.",
    "created_at": "2015-04-10T07:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203042",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@behackl](#comment%3A16):
> Thanks! Let me know if there is anything I can do to help.

Please write two doctests around l.70-80 in `functions/transcendental.py` (one checking symbolic output, the other demonstrating numerics) so that we see whenever there is a regression. They will of course, only pass when Sage is upgraded to pynac-0.3.3, so this ticket depends on the upgrade ticket.



---

archive/issue_comments_203043.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nDone. For the sake of completeness: the upstream fix can be found at https://github.com/pynac/pynac/pull/1\n\nI'll leave this ticket's status as `new` until I can set the Pynac-update ticket as a dependency.",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203043",
    "user": "https://github.com/behackl"
}
```

<a id='comment:18'>Comment 18:</a>
Done. For the sake of completeness: the upstream fix can be found at https://github.com/pynac/pynac/pull/1

I'll leave this ticket's status as `new` until I can set the Pynac-update ticket as a dependency.



---

archive/issue_comments_203044.json:
```json
{
    "body": "Branch: **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203044",
    "user": "https://github.com/behackl"
}
```

Branch: **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)**



---

archive/issue_comments_203045.json:
```json
{
    "body": "Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203045",
    "user": "https://github.com/behackl"
}
```

Commit: **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**



---

archive/issue_comments_203046.json:
```json
{
    "body": "Upstream: **Completely fixed; Fix reported upstream**",
    "created_at": "2015-04-10T13:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203046",
    "user": "https://github.com/behackl"
}
```

Upstream: **Completely fixed; Fix reported upstream**



---

archive/issue_comments_203047.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nOh, sorry -- I did not read the part with the doctest that should demonstrate numerics. \n\nDo you mean something like\n\n```\nsage: zeta(x).series(x==1, 1).coefficient(x, 0).n()\n0.577215664901533\n```",
    "created_at": "2015-04-10T13:36:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203047",
    "user": "https://github.com/behackl"
}
```

<a id='comment:19'>Comment 19:</a>
Oh, sorry -- I did not read the part with the doctest that should demonstrate numerics. 

Do you mean something like

```
sage: zeta(x).series(x==1, 1).coefficient(x, 0).n()
0.577215664901533
```



---

archive/issue_comments_203048.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nNot sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.",
    "created_at": "2015-04-10T13:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203048",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'>Comment 20:</a>
Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.



---

archive/issue_comments_203049.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@rwst](#comment%3A20):\n> Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.\n\nWell, there would be some sort of approximation error -- but something like checking the numerical value of the absolute term is certainly possible (like in the modified comment above).",
    "created_at": "2015-04-10T13:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203049",
    "user": "https://github.com/behackl"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@rwst](#comment%3A20):
> Not sure if it's necessary, or even correct, to compare `zeta(x).series(x=1,3).subs(x=.999).n()` with `zeta(.999)`.

Well, there would be some sort of approximation error -- but something like checking the numerical value of the absolute term is certainly possible (like in the modified comment above).



---

archive/issue_comments_203050.json:
```json
{
    "body": "Dependencies: **#18155**",
    "created_at": "2015-04-10T14:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203050",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#18155**



---

archive/issue_events_201345.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-10T14:46:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201345"
}
```



---

archive/issue_events_201346.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-10T14:46:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201346"
}
```



---

archive/issue_comments_203051.json:
```json
{
    "body": "Author: **Benjamin Hackl**",
    "created_at": "2015-04-11T14:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203051",
    "user": "https://github.com/behackl"
}
```

Author: **Benjamin Hackl**



---

archive/issue_events_201347.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2015-04-11T14:10:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201347"
}
```



---

archive/issue_comments_203052.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2015-04-11T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203052",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_201348.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-11T14:51:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201348"
}
```



---

archive/issue_events_201349.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-11T14:51:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201349"
}
```



---

archive/issue_comments_203053.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nIs fine, thanks.",
    "created_at": "2015-04-11T14:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203053",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'>Comment 24:</a>
Is fine, thanks.



---

archive/issue_comments_203054.json:
```json
{
    "body": "Changed dependencies from **#18155** to **#18237**",
    "created_at": "2015-04-17T13:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203054",
    "user": "https://github.com/behackl"
}
```

Changed dependencies from **#18155** to **#18237**



---

archive/issue_comments_203055.json:
```json
{
    "body": "Changed branch from **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)** to **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**",
    "created_at": "2015-04-19T01:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15846#issuecomment-203055",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/behackl/functions/zeta_series](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/functions/zeta_series)** to **[eccce02](https://github.com/sagemath/sagetrac-mirror/commit/eccce0202c0a7773f5238af3e5b23f7706e6ff21)**



---

archive/issue_events_201350.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T01:51:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201350"
}
```



---

archive/issue_events_201351.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "85b3be28c08fa83da649951156483a05fd189adc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-19T01:51:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15846",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15846#event-201351"
}
```
