# Issue 15862: Mutability of tableaux part I: lists of tuples instead of lists of lists

archive/issues_015625.json:
```json
{
    "body": "Tableaux in Sage used to be implemented as lists of lists. The outer list was wrapped in a `CombinatorialObject`, which made it immutable (at least without accessing underscored attributes). The inner lists, however, could be easily mutated; for example:\n\n```\nsage: T = Tableau([[1,2],[2]])\nsage: t0 = T[0]\nsage: t0[1] = 3 \nsage: T\n[[1, 3], [2]]\n```\nThis kind of mutability was likely not intended. I, personally, have only ever triggered it by accident.\n\nThe present branch replaces the inner lists in the implementation of tableaux and skew tableaux by tuples. As a consequence, tableaux become completely (rather than just shallowly) immutable (unless their entries themselves are mutable, which can be blamed on the user). They are still printed as lists of lists, but this is just a `_repr_` issue.\n\nThe branch also makes some optimizations and corrections.\n\n---\n\nOld description:\n\nTableaux in Sage are mutable objects, at least indirectly:\n\n```\nsage: T = Tableau([[1,2],[2]])\nsage: t0 = T[0]\nsage: t0[1] = 3 \nsage: T\n[[1, 3], [2]]\n```\nThis in itself is probably not a bug, although not the kind of behavior I like either (what exactly is sped up by mutability of tableaux?). But there are things which probably are bugs given this behavior:\n\n1. Tableaux are hashed by reference:\n\n```\nsage: T = Tableau([[1,2],[2]])\nsage: hash(T)\n-7723024261707595164\nsage: T[0][1] = 4\nsage: hash(T)\n-7723024261707595164\n```\n\n2. Line 311 of `sage/combinat/tableau.py` says:\n\n```\n            # Since we are (suppose to be) immutable, we can share the underlying data\n```\nBut we are not immutable. This comment line is supposed to provide justification for initializing the tableau as a `CombinatorialObject`, but the docstring of `CombinatorialObject` says that \"CombinatorialObjects are shallowly immutable, and the intention is that they are semantically immutable\". The latter is not satisfied for tableaux.\n\nIf we want tableaux to be mutable, why wrap them inside such a class? If we want them to be immutable, wouldn't it be right to encode them as CombinatorialObjects of CombinatorialObjects? Or is the speed cost for this too steep? And, finally, what is it that CombinatorialObject does that tuple does not?\n\nAnd, on a related note, does Sage provide a class for immutable dictionaries? (I'm still hell-bent on implementing arbitrary-shaped tableaux.)\n\n3. Mutating tableaux poisons type judgments (or what passes for type judgments in Sage):\n\n```\nsage: T = StandardTableau([[1,2],[3]])\nsage: T[0][1] = 5\nsage: isinstance(T, StandardTableau)\nTrue\n```\n\n4. There is some action at a distance (although fortunately rare):\n\n```\nsage: T = SkewTableau([[1,2],[3]])\nsage: S = T.to_tableau()  # Tableau(S) doesn't work, wondering if it should?\nsage: S\n[[1, 2], [3]]\nsage: T\n[[1, 2], [3]]\nsage: T[0][1] = 5\nsage: S\n[[1, 5], [3]]\nsage: T\n[[1, 5], [3]]\n```\n\n5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?\n\nCC:  @anneschilling @tscrim @nthiery stumpc5 @AndrewAtLarge @zabrocki sage-combinat @hivert jpswanson\n\nKeywords: tableaux, sage-combinat, mutability, days64\n\nBranch/Commit: 430003da7a7b6d3afc60e385f3d6e812b3864f25\n\nStopgaps: #17997\n\nReviewer: Travis Scrimshaw\n\nAuthor: Josh Swanson, Jan Keitel, Darij Grinberg\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15862\n\n",
    "closed_at": "2015-04-14T19:44:14Z",
    "created_at": "2014-02-25T21:55:23Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Mutability of tableaux part I: lists of tuples instead of lists of lists",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15862",
    "user": "https://github.com/darijgr"
}
```
Tableaux in Sage used to be implemented as lists of lists. The outer list was wrapped in a `CombinatorialObject`, which made it immutable (at least without accessing underscored attributes). The inner lists, however, could be easily mutated; for example:

```
sage: T = Tableau([[1,2],[2]])
sage: t0 = T[0]
sage: t0[1] = 3 
sage: T
[[1, 3], [2]]
```
This kind of mutability was likely not intended. I, personally, have only ever triggered it by accident.

The present branch replaces the inner lists in the implementation of tableaux and skew tableaux by tuples. As a consequence, tableaux become completely (rather than just shallowly) immutable (unless their entries themselves are mutable, which can be blamed on the user). They are still printed as lists of lists, but this is just a `_repr_` issue.

The branch also makes some optimizations and corrections.

---

Old description:

Tableaux in Sage are mutable objects, at least indirectly:

```
sage: T = Tableau([[1,2],[2]])
sage: t0 = T[0]
sage: t0[1] = 3 
sage: T
[[1, 3], [2]]
```
This in itself is probably not a bug, although not the kind of behavior I like either (what exactly is sped up by mutability of tableaux?). But there are things which probably are bugs given this behavior:

1. Tableaux are hashed by reference:

```
sage: T = Tableau([[1,2],[2]])
sage: hash(T)
-7723024261707595164
sage: T[0][1] = 4
sage: hash(T)
-7723024261707595164
```

2. Line 311 of `sage/combinat/tableau.py` says:

```
            # Since we are (suppose to be) immutable, we can share the underlying data
```
But we are not immutable. This comment line is supposed to provide justification for initializing the tableau as a `CombinatorialObject`, but the docstring of `CombinatorialObject` says that "CombinatorialObjects are shallowly immutable, and the intention is that they are semantically immutable". The latter is not satisfied for tableaux.

If we want tableaux to be mutable, why wrap them inside such a class? If we want them to be immutable, wouldn't it be right to encode them as CombinatorialObjects of CombinatorialObjects? Or is the speed cost for this too steep? And, finally, what is it that CombinatorialObject does that tuple does not?

And, on a related note, does Sage provide a class for immutable dictionaries? (I'm still hell-bent on implementing arbitrary-shaped tableaux.)

3. Mutating tableaux poisons type judgments (or what passes for type judgments in Sage):

```
sage: T = StandardTableau([[1,2],[3]])
sage: T[0][1] = 5
sage: isinstance(T, StandardTableau)
True
```

4. There is some action at a distance (although fortunately rare):

```
sage: T = SkewTableau([[1,2],[3]])
sage: S = T.to_tableau()  # Tableau(S) doesn't work, wondering if it should?
sage: S
[[1, 2], [3]]
sage: T
[[1, 2], [3]]
sage: T[0][1] = 5
sage: S
[[1, 5], [3]]
sage: T
[[1, 5], [3]]
```

5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?

CC:  @anneschilling @tscrim @nthiery stumpc5 @AndrewAtLarge @zabrocki sage-combinat @hivert jpswanson

Keywords: tableaux, sage-combinat, mutability, days64

Branch/Commit: 430003da7a7b6d3afc60e385f3d6e812b3864f25

Stopgaps: #17997

Reviewer: Travis Scrimshaw

Author: Josh Swanson, Jan Keitel, Darij Grinberg

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15862





---

archive/issue_comments_215515.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,7 +35,7 @@\n \n ```\n sage: T = StandardTableau([[1,2],[3]])\n-sage: T[0][1] = 2\n+sage: T[0][1] = 5\n sage: isinstance(T, StandardTableau)\n True\n ```\n@@ -58,8 +58,6 @@\n \n 5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?\n \n-Keywords: tableaux, sage-combinat, mutability\n-\n Comment: 1\n \n Summary: Mutability of tableaux, for the n-th time\n``````\n",
    "created_at": "2014-02-25T21:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215515",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,7 +35,7 @@
 
 ```
 sage: T = StandardTableau([[1,2],[3]])
-sage: T[0][1] = 2
+sage: T[0][1] = 5
 sage: isinstance(T, StandardTableau)
 True
 ```
@@ -58,8 +58,6 @@
 
 5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?
 
-Keywords: tableaux, sage-combinat, mutability
-
 Comment: 1
 
 Summary: Mutability of tableaux, for the n-th time
``````




---

archive/issue_comments_215516.json:
```json
{
    "body": "<a id='comment:2'></a>This is definitely an issue. My first thought is to convert all of the sublists (rows) of the tableaux as tuples and upon calling `_repr_`, convert them back to lists. I'll think more about this today.",
    "created_at": "2014-02-26T15:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215516",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>This is definitely an issue. My first thought is to convert all of the sublists (rows) of the tableaux as tuples and upon calling `_repr_`, convert them back to lists. I'll think more about this today.



---

archive/issue_comments_215517.json:
```json
{
    "body": "<a id='comment:3'></a>Any results? I'm also in favor in tuples. Do you think there will be a speed regression to this? It seems to me that we are not making any use of the deep mutability of tableaux, so I wouldn't expect that to happen.",
    "created_at": "2014-02-28T19:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215517",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:3'></a>Any results? I'm also in favor in tuples. Do you think there will be a speed regression to this? It seems to me that we are not making any use of the deep mutability of tableaux, so I wouldn't expect that to happen.



---

archive/issue_comments_215518.json:
```json
{
    "body": "<a id='comment:4'></a>Sorry, I let this one drop off my radar. Here's the block that we should look at IMO (lines 315-318 in `tableau.py`)\n\n```python\n# CombinatorialObject verifies that t is a list\n# We must verify t is a list of lists\nif not all(isinstance(row, list) for row in t):\n    raise ValueError(\"A tableau must be a list of lists.\")\n```\nThe first part of the comment is bogus, `CombinatorialObject` verifies that `t` acts like a list:\n\n```\nsage: CombinatorialObject((1,2,3))\n[1, 2, 3]\n```\nand from it's doc:\n\n```\n- ``l`` -- a list or any object that can be convert to a list by ``list``\n```\nThe part we need to look it is should we just do something like `t = map(tuple, t)` for the tableau input and let that error out?\n\nOverall, there will be speed regression in the printing of tableaux. Here's what I would do for the `_repr_()`:\n\n```python\ndef _repr_(self):\n    return repr(map(list, self._list))\n```\nand here are some sample timings:\n\n```\nsage: L = [(1,2)]*5\nsage: %timeit repr(L)\n100000 loops, best of 3: 14.5 us per loop\nsage: %timeit repr(map(list, L))\n10000 loops, best of 3: 17.2 us per loop\nsage: L = [(1,2)]*20\nsage: %timeit repr(L)\n10000 loops, best of 3: 48.7 us per loop\nsage: %timeit repr(map(list, L))\n10000 loops, best of 3: 62 us per loop\nsage: L = [(1,2,3,4)]*100\nsage: %timeit repr(L)\n1000 loops, best of 3: 332 us per loop\nsage: %timeit repr(map(list, L))\n1000 loops, best of 3: 401 us per loop\n```\nSo it's about 10-20% slowdown.\n(FYI `repr(L)` seems to be ever so slightly faster than `L.__repr__()`.)\nSo perhaps we should make them all `CombinatorialObject` instead of `tuple`...?\n\nThe other option to this would be having `__getitem__()` and the like return tuples or copies of the lists. I'm worried this might also result in a slowdown in code that is called significantly more often.\n\nFor point 2., that shared data comment is about creating a tableau from another tableau. I use `Family` when I want immutable dictionaries, although I would still use a list of list (type) approach to arbitrary shaped tableaux.",
    "created_at": "2014-03-03T15:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215518",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>Sorry, I let this one drop off my radar. Here's the block that we should look at IMO (lines 315-318 in `tableau.py`)

```python
# CombinatorialObject verifies that t is a list
# We must verify t is a list of lists
if not all(isinstance(row, list) for row in t):
    raise ValueError("A tableau must be a list of lists.")
```
The first part of the comment is bogus, `CombinatorialObject` verifies that `t` acts like a list:

```
sage: CombinatorialObject((1,2,3))
[1, 2, 3]
```
and from it's doc:

```
- ``l`` -- a list or any object that can be convert to a list by ``list``
```
The part we need to look it is should we just do something like `t = map(tuple, t)` for the tableau input and let that error out?

Overall, there will be speed regression in the printing of tableaux. Here's what I would do for the `_repr_()`:

```python
def _repr_(self):
    return repr(map(list, self._list))
```
and here are some sample timings:

```
sage: L = [(1,2)]*5
sage: %timeit repr(L)
100000 loops, best of 3: 14.5 us per loop
sage: %timeit repr(map(list, L))
10000 loops, best of 3: 17.2 us per loop
sage: L = [(1,2)]*20
sage: %timeit repr(L)
10000 loops, best of 3: 48.7 us per loop
sage: %timeit repr(map(list, L))
10000 loops, best of 3: 62 us per loop
sage: L = [(1,2,3,4)]*100
sage: %timeit repr(L)
1000 loops, best of 3: 332 us per loop
sage: %timeit repr(map(list, L))
1000 loops, best of 3: 401 us per loop
```
So it's about 10-20% slowdown.
(FYI `repr(L)` seems to be ever so slightly faster than `L.__repr__()`.)
So perhaps we should make them all `CombinatorialObject` instead of `tuple`...?

The other option to this would be having `__getitem__()` and the like return tuples or copies of the lists. I'm worried this might also result in a slowdown in code that is called significantly more often.

For point 2., that shared data comment is about creating a tableau from another tableau. I use `Family` when I want immutable dictionaries, although I would still use a list of list (type) approach to arbitrary shaped tableaux.



---

archive/issue_comments_215519.json:
```json
{
    "body": "<a id='comment:5'></a>`t = map(tuple, t)` sounds like a good idea to me. The immutability of the outer list is handled by `CombinatorialObject`, so we only need to care about the inner ones.\n\nIs `_repr_` slowdown important? That is, is `_repr_` used in any non-IO contexts such as hashing and caching? (I know it sometimes is; the question whether it is here.)\n\nIs `_repr_` the only thing that gets slowed down if we replace the (inner) lists by tuples? I'd say it should be, because any method on tableaux that needs to mess around with rows as lists currently needs to clone them before doing so, and experiments tell me that `t[:]` is considerably faster when `t` is a tuple than when `t` is a list:\n\n```\nsage: g = tuple(range(15))\nsage: %timeit g[:]\n10000000 loops, best of 3: 73.4 ns per loop\nsage: g = range(15)\nsage: %timeit g[:]\n1000000 loops, best of 3: 197 ns per loop\nsage: g = tuple(range(3))\nsage: %timeit g[:]\n10000000 loops, best of 3: 73.4 ns per loop\nsage: g = range(3)\nsage: %timeit g[:]\n10000000 loops, best of 3: 158 ns per loop\n```\n\n***\n\nThis might and not might be related, but do you have any idea where the slowdowns in http://trac.sagemath.org/ticket/14711#comment:107 come from? (I'm aware that running all doctests in series is not the scientific way of assessing performance, but I'm still worried about tableaux getting slower...)",
    "created_at": "2014-03-05T18:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215519",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:5'></a>`t = map(tuple, t)` sounds like a good idea to me. The immutability of the outer list is handled by `CombinatorialObject`, so we only need to care about the inner ones.

Is `_repr_` slowdown important? That is, is `_repr_` used in any non-IO contexts such as hashing and caching? (I know it sometimes is; the question whether it is here.)

Is `_repr_` the only thing that gets slowed down if we replace the (inner) lists by tuples? I'd say it should be, because any method on tableaux that needs to mess around with rows as lists currently needs to clone them before doing so, and experiments tell me that `t[:]` is considerably faster when `t` is a tuple than when `t` is a list:

```
sage: g = tuple(range(15))
sage: %timeit g[:]
10000000 loops, best of 3: 73.4 ns per loop
sage: g = range(15)
sage: %timeit g[:]
1000000 loops, best of 3: 197 ns per loop
sage: g = tuple(range(3))
sage: %timeit g[:]
10000000 loops, best of 3: 73.4 ns per loop
sage: g = range(3)
sage: %timeit g[:]
10000000 loops, best of 3: 158 ns per loop
```

***

This might and not might be related, but do you have any idea where the slowdowns in http://trac.sagemath.org/ticket/14711#comment:107 come from? (I'm aware that running all doctests in series is not the scientific way of assessing performance, but I'm still worried about tableaux getting slower...)



---

archive/issue_comments_215520.json:
```json
{
    "body": "<a id='comment:6'></a>Currently the `_repr_` is used to create the hash for `CombinatorialObject`. We might be better served storing `CombinatorialObject` as a tuple instead of a list and just using the default hash. (Also you can think of `CombinatorialObject` as the `SageObject` equivalent to a python tuple.)\n\nIn regards to #14711 and from what I understand of Simon's comment, it is about the creation of the parent object `Tableaux()` and is not a slowdown per-say. More specifically, it's about the weakly referenced `Tableaux()` parent having to be recreated during Sage's startup since the morphisms which hold a weak reference to it are being recreated. So once you do hold a strong reference to `Tableaux()`, it won't be destroyed/recreated (of course unless you delete the strong reference as well). Moreover, although the relative value is high, the absolute value is still low so I don't think it's affecting things much.",
    "created_at": "2014-03-05T23:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215520",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Currently the `_repr_` is used to create the hash for `CombinatorialObject`. We might be better served storing `CombinatorialObject` as a tuple instead of a list and just using the default hash. (Also you can think of `CombinatorialObject` as the `SageObject` equivalent to a python tuple.)

In regards to #14711 and from what I understand of Simon's comment, it is about the creation of the parent object `Tableaux()` and is not a slowdown per-say. More specifically, it's about the weakly referenced `Tableaux()` parent having to be recreated during Sage's startup since the morphisms which hold a weak reference to it are being recreated. So once you do hold a strong reference to `Tableaux()`, it won't be destroyed/recreated (of course unless you delete the strong reference as well). Moreover, although the relative value is high, the absolute value is still low so I don't think it's affecting things much.



---

archive/issue_comments_215521.json:
```json
{
    "body": "<a id='comment:7'></a>I haven't looked seriously at the code recently so this is just a random thought. A priori, the general plan for this kind of object is to move from `CombinatorialObject` to `ClonableList` or one of its friends. Maybe a `ClonableList` of tuples, or even a Clonable array of arrays of C ints.\n\nCheers,\n                          Nicolas",
    "created_at": "2014-03-07T12:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215521",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>I haven't looked seriously at the code recently so this is just a random thought. A priori, the general plan for this kind of object is to move from `CombinatorialObject` to `ClonableList` or one of its friends. Maybe a `ClonableList` of tuples, or even a Clonable array of arrays of C ints.

Cheers,
                          Nicolas



---

archive/issue_comments_215522.json:
```json
{
    "body": "<a id='comment:8'></a>`@`Nicolas: Thank you. Can you remind me how `ClonableList` differs from `CombinatorialObject`? Does it allow mutation at clone time?\n\nCurrently tableaux can have non-integer entries, and this is both useful and used (e.g. for skew tableaux). So I'm not convinced of switching to C ints.\n\n`@`Travis: Apparently combinatorial objects hash like this:\n\n```\n        if self._hash is None:\n            self._hash = str(self._list).__hash__()\n        return self._hash\n```\nSo the `__repr__` is not used, but rather the list is taken into a string and the latter is hashed. I assume this won't take any longer with tuples? Or am I looking at the wrong hash function?\n\nThanks also for your comments on #14711, though they're still somewhat over my head. What morphisms hold a weak reference to `Tableaux()`?",
    "created_at": "2014-03-07T16:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215522",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>`@`Nicolas: Thank you. Can you remind me how `ClonableList` differs from `CombinatorialObject`? Does it allow mutation at clone time?

Currently tableaux can have non-integer entries, and this is both useful and used (e.g. for skew tableaux). So I'm not convinced of switching to C ints.

`@`Travis: Apparently combinatorial objects hash like this:

```
        if self._hash is None:
            self._hash = str(self._list).__hash__()
        return self._hash
```
So the `__repr__` is not used, but rather the list is taken into a string and the latter is hashed. I assume this won't take any longer with tuples? Or am I looking at the wrong hash function?

Thanks also for your comments on #14711, though they're still somewhat over my head. What morphisms hold a weak reference to `Tableaux()`?



---

archive/issue_comments_215523.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 darij]:\n> `@`Nicolas: Thank you. Can you remind me how `ClonableList` differs from `CombinatorialObject`? Does it allow mutation at clone time?\n\n\nOne is that `ClonableList` is cythonized\n\n> Currently tableaux can have non-integer entries, and this is both useful and used (e.g. for skew tableaux). So I'm not convinced of switching to C ints.\n\n\nI would not switch to C ints since we I believe the crystals of tableaux are filled with wrappers around ints. In either case, it is very conceivable to me that we would want non C ints as entries.\n\n> `@`Travis: Apparently combinatorial objects hash like this:\n> \n> ```\n>         if self._hash is None:\n>             self._hash = str(self._list).__hash__()\n>         return self._hash\n> ```\n> So the `__repr__` is not used, but rather the list is taken into a string and the latter is hashed. I assume this won't take any longer with tuples? Or am I looking at the wrong hash function?\n\n\nThe `__str__()` ends up calling the `__repr__()`, and then the resulting string is hashed since we can't just hash lists. For tuples, we can just call `hash(self._list)`.\n\n> Thanks also for your comments on #14711, though they're still somewhat over my head. What morphisms hold a weak reference to `Tableaux()`?\n\n\n*shrugs* Actually those parents aren't being recreated on startup, I misremembered / misread Simon's comment. It's about when running all tests. There might be some dependency cycle (perhaps directly in the morphism, but maybe not) which creates a tableau (and hence `Tableaux()`) that becomes completely weakly referenced with #14711 and so it gets garbage collected. *shrugs* IDK, it would require some detailed searching and analysis.",
    "created_at": "2014-03-10T02:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215523",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Replying to [comment:8 darij]:
> `@`Nicolas: Thank you. Can you remind me how `ClonableList` differs from `CombinatorialObject`? Does it allow mutation at clone time?


One is that `ClonableList` is cythonized

> Currently tableaux can have non-integer entries, and this is both useful and used (e.g. for skew tableaux). So I'm not convinced of switching to C ints.


I would not switch to C ints since we I believe the crystals of tableaux are filled with wrappers around ints. In either case, it is very conceivable to me that we would want non C ints as entries.

> `@`Travis: Apparently combinatorial objects hash like this:
> 
> ```
>         if self._hash is None:
>             self._hash = str(self._list).__hash__()
>         return self._hash
> ```
> So the `__repr__` is not used, but rather the list is taken into a string and the latter is hashed. I assume this won't take any longer with tuples? Or am I looking at the wrong hash function?


The `__str__()` ends up calling the `__repr__()`, and then the resulting string is hashed since we can't just hash lists. For tuples, we can just call `hash(self._list)`.

> Thanks also for your comments on #14711, though they're still somewhat over my head. What morphisms hold a weak reference to `Tableaux()`?


*shrugs* Actually those parents aren't being recreated on startup, I misremembered / misread Simon's comment. It's about when running all tests. There might be some dependency cycle (perhaps directly in the morphism, but maybe not) which creates a tableau (and hence `Tableaux()`) that becomes completely weakly referenced with #14711 and so it gets garbage collected. *shrugs* IDK, it would require some detailed searching and analysis.



---

archive/issue_events_046665.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15862#event-46665"
}
```



---

archive/issue_events_046666.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15862#event-46666"
}
```



---

archive/issue_events_046667.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15862#event-46667"
}
```



---

archive/issue_comments_215524.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T00:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215525.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T01:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215526.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T09:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215527.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T17:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215527",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215528.json:
```json
{
    "body": "<a id='comment:19'></a>This is a bit ugly at the moment:\n\n```\nsage: t = Tableau([[1,2],[3]])\nsage: list(t)\n[(1, 2), (3,)]\nsage: t.to_list()\n[[1, 2], [3]]\n```\n\nThe first calls the iterator, while the second returns an actual copy with the tuples converted to lists.",
    "created_at": "2015-03-19T17:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215528",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:19'></a>This is a bit ugly at the moment:

```
sage: t = Tableau([[1,2],[3]])
sage: list(t)
[(1, 2), (3,)]
sage: t.to_list()
[[1, 2], [3]]
```

The first calls the iterator, while the second returns an actual copy with the tuples converted to lists.



---

archive/issue_comments_215529.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T19:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215530.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T03:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215531.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-20T04:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215531",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_215532.json:
```json
{
    "body": "<a id='comment:23'></a>Do we have doctests for the issues mentioned in the OP?",
    "created_at": "2015-03-20T04:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215532",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:23'></a>Do we have doctests for the issues mentioned in the OP?



---

archive/issue_comments_215533.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T05:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215534.json:
```json
{
    "body": "<a id='comment:25'></a>We do now.",
    "created_at": "2015-03-20T05:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215534",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:25'></a>We do now.



---

archive/issue_comments_215535.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T15:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215536.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T15:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215537.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T15:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215538.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T15:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215539.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T15:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215540.json:
```json
{
    "body": "Changing keywords from \"tableaux, sage-combinat, mutability\" to \"tableaux, sage-combinat, mutability, days64\".",
    "created_at": "2015-03-20T16:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215540",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "tableaux, sage-combinat, mutability" to "tableaux, sage-combinat, mutability, days64".



---

archive/issue_comments_215541.json:
```json
{
    "body": "<a id='comment:32'></a>Just for the record: Part II of this project, i.e. changing the parent from CombinatorialObject to ClonableList, can be found at `public/TransitionClonable`.",
    "created_at": "2015-03-20T20:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215541",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:32'></a>Just for the record: Part II of this project, i.e. changing the parent from CombinatorialObject to ClonableList, can be found at `public/TransitionClonable`.



---

archive/issue_comments_215542.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T21:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215543.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T21:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215544.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T21:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215545.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T22:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215546.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T22:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215546",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215547.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T22:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215548.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T22:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215549.json:
```json
{
    "body": "<a id='comment:40'></a>This is ready for review.\n\nThere are minor slowdowns in `skew_tableau.py` left, relating to the tuple-cast in its initialization. I don't know if they are avoidable.",
    "created_at": "2015-03-20T22:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215549",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:40'></a>This is ready for review.

There are minor slowdowns in `skew_tableau.py` left, relating to the tuple-cast in its initialization. I don't know if they are avoidable.



---

archive/issue_comments_215550.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T01:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215551.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T01:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215552.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T01:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215553.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,81 @@\n+Tableaux in Sage used to be implemented as lists of lists. The outer list was wrapped in a `CombinatorialObject`, which made it immutable (at least without accessing underscored attributes). The inner lists, however, could be easily mutated; for example:\n \n+```\n+sage: T = Tableau([[1,2],[2]])\n+sage: t0 = T[0]\n+sage: t0[1] = 3 \n+sage: T\n+[[1, 3], [2]]\n+```\n+This kind of mutability was likely not intended. I, personally, have only ever triggered it by accident.\n+\n+The present branch replaces the inner lists in the implementation of tableaux and skew tableaux by tuples. As a consequence, tableaux become completely (rather than just shallowly) immutable (unless their entries themselves are mutable, which can be blamed on the user). They are still printed as lists of lists, but this is just a `_repr_` issue.\n+\n+The branch also makes some optimizations and corrections.\n+\n+---\n+\n+Old description:\n+\n+Tableaux in Sage are mutable objects, at least indirectly:\n+\n+```\n+sage: T = Tableau([[1,2],[2]])\n+sage: t0 = T[0]\n+sage: t0[1] = 3 \n+sage: T\n+[[1, 3], [2]]\n+```\n+This in itself is probably not a bug, although not the kind of behavior I like either (what exactly is sped up by mutability of tableaux?). But there are things which probably are bugs given this behavior:\n+\n+1. Tableaux are hashed by reference:\n+\n+```\n+sage: T = Tableau([[1,2],[2]])\n+sage: hash(T)\n+-7723024261707595164\n+sage: T[0][1] = 4\n+sage: hash(T)\n+-7723024261707595164\n+```\n+\n+2. Line 311 of `sage/combinat/tableau.py` says:\n+\n+```\n+            # Since we are (suppose to be) immutable, we can share the underlying data\n+```\n+But we are not immutable. This comment line is supposed to provide justification for initializing the tableau as a `CombinatorialObject`, but the docstring of `CombinatorialObject` says that \"CombinatorialObjects are shallowly immutable, and the intention is that they are semantically immutable\". The latter is not satisfied for tableaux.\n+\n+If we want tableaux to be mutable, why wrap them inside such a class? If we want them to be immutable, wouldn't it be right to encode them as CombinatorialObjects of CombinatorialObjects? Or is the speed cost for this too steep? And, finally, what is it that CombinatorialObject does that tuple does not?\n+\n+And, on a related note, does Sage provide a class for immutable dictionaries? (I'm still hell-bent on implementing arbitrary-shaped tableaux.)\n+\n+3. Mutating tableaux poisons type judgments (or what passes for type judgments in Sage):\n+\n+```\n+sage: T = StandardTableau([[1,2],[3]])\n+sage: T[0][1] = 5\n+sage: isinstance(T, StandardTableau)\n+True\n+```\n+\n+4. There is some action at a distance (although fortunately rare):\n+\n+```\n+sage: T = SkewTableau([[1,2],[3]])\n+sage: S = T.to_tableau()  # Tableau(S) doesn't work, wondering if it should?\n+sage: S\n+[[1, 2], [3]]\n+sage: T\n+[[1, 2], [3]]\n+sage: T[0][1] = 5\n+sage: S\n+[[1, 5], [3]]\n+sage: T\n+[[1, 5], [3]]\n+```\n+\n+5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-03-21T08:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215553",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,81 @@
+Tableaux in Sage used to be implemented as lists of lists. The outer list was wrapped in a `CombinatorialObject`, which made it immutable (at least without accessing underscored attributes). The inner lists, however, could be easily mutated; for example:
 
+```
+sage: T = Tableau([[1,2],[2]])
+sage: t0 = T[0]
+sage: t0[1] = 3 
+sage: T
+[[1, 3], [2]]
+```
+This kind of mutability was likely not intended. I, personally, have only ever triggered it by accident.
+
+The present branch replaces the inner lists in the implementation of tableaux and skew tableaux by tuples. As a consequence, tableaux become completely (rather than just shallowly) immutable (unless their entries themselves are mutable, which can be blamed on the user). They are still printed as lists of lists, but this is just a `_repr_` issue.
+
+The branch also makes some optimizations and corrections.
+
+---
+
+Old description:
+
+Tableaux in Sage are mutable objects, at least indirectly:
+
+```
+sage: T = Tableau([[1,2],[2]])
+sage: t0 = T[0]
+sage: t0[1] = 3 
+sage: T
+[[1, 3], [2]]
+```
+This in itself is probably not a bug, although not the kind of behavior I like either (what exactly is sped up by mutability of tableaux?). But there are things which probably are bugs given this behavior:
+
+1. Tableaux are hashed by reference:
+
+```
+sage: T = Tableau([[1,2],[2]])
+sage: hash(T)
+-7723024261707595164
+sage: T[0][1] = 4
+sage: hash(T)
+-7723024261707595164
+```
+
+2. Line 311 of `sage/combinat/tableau.py` says:
+
+```
+            # Since we are (suppose to be) immutable, we can share the underlying data
+```
+But we are not immutable. This comment line is supposed to provide justification for initializing the tableau as a `CombinatorialObject`, but the docstring of `CombinatorialObject` says that "CombinatorialObjects are shallowly immutable, and the intention is that they are semantically immutable". The latter is not satisfied for tableaux.
+
+If we want tableaux to be mutable, why wrap them inside such a class? If we want them to be immutable, wouldn't it be right to encode them as CombinatorialObjects of CombinatorialObjects? Or is the speed cost for this too steep? And, finally, what is it that CombinatorialObject does that tuple does not?
+
+And, on a related note, does Sage provide a class for immutable dictionaries? (I'm still hell-bent on implementing arbitrary-shaped tableaux.)
+
+3. Mutating tableaux poisons type judgments (or what passes for type judgments in Sage):
+
+```
+sage: T = StandardTableau([[1,2],[3]])
+sage: T[0][1] = 5
+sage: isinstance(T, StandardTableau)
+True
+```
+
+4. There is some action at a distance (although fortunately rare):
+
+```
+sage: T = SkewTableau([[1,2],[3]])
+sage: S = T.to_tableau()  # Tableau(S) doesn't work, wondering if it should?
+sage: S
+[[1, 2], [3]]
+sage: T
+[[1, 2], [3]]
+sage: T[0][1] = 5
+sage: S
+[[1, 5], [3]]
+sage: T
+[[1, 5], [3]]
+```
+
+5. How would I define Loday's Hopf algebra of tableaux if tableaux are mutable?
 
 Comment: 1
 
``````




---

archive/issue_comments_215554.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-23T22:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215554",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_215555.json:
```json
{
    "body": "<a id='comment:47'></a>LGTM.",
    "created_at": "2015-03-23T22:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215555",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:47'></a>LGTM.



---

archive/issue_comments_215556.json:
```json
{
    "body": "<a id='comment:48'></a>Thank you, Travis!",
    "created_at": "2015-03-23T22:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215556",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:48'></a>Thank you, Travis!



---

archive/issue_comments_215557.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15862#issuecomment-215557",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_046668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15862",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15862#event-46668"
}
```
