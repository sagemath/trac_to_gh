# Issue 15718: Implement the __init_extra__ protocol of categories for Cython classes.

archive/issues_015481.json:
```json
{
    "assignees": [],
    "body": "\n\nBranch/Commit: **[u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_) @ [0ec1c06](https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1)**\n\nAuthor: **Simon King**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15718_\n\n",
    "created_at": "2014-01-23T17:20:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20categories",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20info"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement the __init_extra__ protocol of categories for Cython classes.",
    "type": "issue",
    "updated_at": "2022-08-31T05:25:02Z",
    "url": "https://github.com/sagemath/sage/issues/15718",
    "user": "https://github.com/nthiery"
}
```


Branch/Commit: **[u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_) @ [0ec1c06](https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1)**

Author: **Simon King**

_Issue created by migration from https://trac.sagemath.org/ticket/15718_





---

archive/issue_events_206888.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-01-23T17:20:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206888"
}
```



---

archive/issue_events_206889.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-01-23T17:20:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20categories",
    "label_color": "0000ff",
    "label_name": "component: categories",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206889"
}
```



---

archive/issue_events_206890.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-01-23T17:20:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206890"
}
```



---

archive/issue_events_206891.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-01-23T17:20:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206891"
}
```



---

archive/issue_comments_200483.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nIt would probably be rather easy:\n\nCurrently, we only look into the mro of the class; if the class is a Python class, then it is a subclass of the category's parent class (since the quest for `__init_extra__` takes place after category initialisation). But in the case of Cython class, we simply need to look explicitly into *both* the class' mro and the category's parent class' mro.\n\nIt would detect a lot of Cython classes in which the call to `Parent.__init__` happens too early for `__init_extra__` to work... But these would be exactly the classes that currently do not allow Python subclasses.",
    "created_at": "2014-01-23T18:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200483",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">Comment 1</div>

It would probably be rather easy:

Currently, we only look into the mro of the class; if the class is a Python class, then it is a subclass of the category's parent class (since the quest for `__init_extra__` takes place after category initialisation). But in the case of Cython class, we simply need to look explicitly into *both* the class' mro and the category's parent class' mro.

It would detect a lot of Cython classes in which the call to `Parent.__init__` happens too early for `__init_extra__` to work... But these would be exactly the classes that currently do not allow Python subclasses.



---

archive/issue_comments_200484.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nReplying to [@simon-king-jena](#comment%3A1):\n> It would probably be rather easy:\n> \n> Currently, we only look into the mro of the class; if the class is a Python class, then it is a subclass of the category's parent class (since the quest for `__init_extra__` takes place after category initialisation). But in the case of Cython class, we simply need to look explicitly into *both* the class' mro and the category's parent class' mro.\n\n+1!\n\nFor the record: this will require calling\nsage.misc.structure.getattr_from_other_class, to emulate the parent\nbeing an instance of the category's parent class.",
    "created_at": "2014-01-24T09:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200484",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:2" align="right">Comment 2</div>

Replying to [@simon-king-jena](#comment%3A1):
> It would probably be rather easy:
> 
> Currently, we only look into the mro of the class; if the class is a Python class, then it is a subclass of the category's parent class (since the quest for `__init_extra__` takes place after category initialisation). But in the case of Cython class, we simply need to look explicitly into *both* the class' mro and the category's parent class' mro.

+1!

For the record: this will require calling
sage.misc.structure.getattr_from_other_class, to emulate the parent
being an instance of the category's parent class.



---

archive/issue_comments_200485.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nReplying to [@nthiery](#comment%3A2):\n> For the record: this will require calling\n> sage.misc.structure.getattr_from_other_class, to emulate the parent\n> being an instance of the category's parent class.\n\nI disagree. If I recall correctly, we look up the *whole* class hierarchy and execute *all* `__init_extra__` methods that we can find. `getattr_from_other_class` would only return *one* `__init_extra__`, but we want all, and thus we need to go up both the Cython class' and the category's parent class' mro.",
    "created_at": "2014-01-24T10:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200485",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">Comment 3</div>

Replying to [@nthiery](#comment%3A2):
> For the record: this will require calling
> sage.misc.structure.getattr_from_other_class, to emulate the parent
> being an instance of the category's parent class.

I disagree. If I recall correctly, we look up the *whole* class hierarchy and execute *all* `__init_extra__` methods that we can find. `getattr_from_other_class` would only return *one* `__init_extra__`, but we want all, and thus we need to go up both the Cython class' and the category's parent class' mro.



---

archive/issue_comments_200486.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@simon-king-jena](#comment%3A3):\n> If I recall correctly, we look up the *whole* class hierarchy and execute *all* `__init_extra__` methods that we can find.\n\nYes!\n\nStill, some magic will be needed to bind each such method to the\nobject and call it (by default Python refuses to bind a method of a\nclass to a non-instance of that class); that's were\n`getattr_from_other_class` (or some subpiece thereof) will come into\nplay.",
    "created_at": "2014-01-24T10:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200486",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@simon-king-jena](#comment%3A3):
> If I recall correctly, we look up the *whole* class hierarchy and execute *all* `__init_extra__` methods that we can find.

Yes!

Still, some magic will be needed to bind each such method to the
object and call it (by default Python refuses to bind a method of a
class to a non-instance of that class); that's were
`getattr_from_other_class` (or some subpiece thereof) will come into
play.



---

archive/issue_comments_200487.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@nthiery](#comment%3A4):\n> Still, some magic will be needed to bind each such method to the\n> object and call it (by default Python refuses to bind a method of a\n> class to a non-instance of that class); that's were\n> `getattr_from_other_class` (or some subpiece thereof) will come into\n> play.\n\nDo we need to bind it? We just want to *call* it.",
    "created_at": "2014-01-24T10:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200487",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@nthiery](#comment%3A4):
> Still, some magic will be needed to bind each such method to the
> object and call it (by default Python refuses to bind a method of a
> class to a non-instance of that class); that's were
> `getattr_from_other_class` (or some subpiece thereof) will come into
> play.

Do we need to bind it? We just want to *call* it.



---

archive/issue_comments_200488.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@simon-king-jena](#comment%3A5):\n> Do we need to bind it? We just want to *call* it.\n\nSuch as:\n\n```\nsage: R.<x,y> = ZZ[]\nsage: C = Algebras(ZZ).parent_class\nsage: C.__init_extra__.__func__(R)\n```",
    "created_at": "2014-01-24T12:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200488",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@simon-king-jena](#comment%3A5):
> Do we need to bind it? We just want to *call* it.

Such as:

```
sage: R.<x,y> = ZZ[]
sage: C = Algebras(ZZ).parent_class
sage: C.__init_extra__.__func__(R)
```



---

archive/issue_comments_200489.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI just tested: When one empties the coercion cache and the coerce_from_list, then calling `C.__init_extra__.__func__(R)` will fill it again, which is its purpose. So, it works without binding.",
    "created_at": "2014-01-24T12:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200489",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">Comment 7</div>

I just tested: When one empties the coercion cache and the coerce_from_list, then calling `C.__init_extra__.__func__(R)` will fill it again, which is its purpose. So, it works without binding.



---

archive/issue_comments_200490.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@simon-king-jena](#comment%3A7):\n> I just tested: When one empties the coercion cache and the coerce_from_list, then calling `C.__init_extra__.__func__(R)` will fill it again, which is its purpose. So, it works without binding.\n\nWell ... that works when `C.__init_extra__` is an unbound method that has a `__func__` attribute. Likely all unbound methods do, so you've probably dealt with the case that `__init_extra__` is an unbound method. But attributes aren't necessarily! I think only unbound methods bind when called as attributes on instances. Other objects just get called. But that's a case you should test for if you want this to be properly compatible with python's inheritance. Unbound methods aren't the only things that lead to callable attributes on instances.",
    "created_at": "2014-01-24T15:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200490",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@simon-king-jena](#comment%3A7):
> I just tested: When one empties the coercion cache and the coerce_from_list, then calling `C.__init_extra__.__func__(R)` will fill it again, which is its purpose. So, it works without binding.

Well ... that works when `C.__init_extra__` is an unbound method that has a `__func__` attribute. Likely all unbound methods do, so you've probably dealt with the case that `__init_extra__` is an unbound method. But attributes aren't necessarily! I think only unbound methods bind when called as attributes on instances. Other objects just get called. But that's a case you should test for if you want this to be properly compatible with python's inheritance. Unbound methods aren't the only things that lead to callable attributes on instances.



---

archive/issue_comments_200491.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI guess it's fair enough to write in the specifications of the protocol that `__init_extra__` shall be a method. And if some day we have a serious use case (which I kind of doubt), it will always be time to generalize the protocol.",
    "created_at": "2014-01-25T11:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200491",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">Comment 9</div>

I guess it's fair enough to write in the specifications of the protocol that `__init_extra__` shall be a method. And if some day we have a serious use case (which I kind of doubt), it will always be time to generalize the protocol.



---

archive/issue_comments_200492.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@nthiery](#comment%3A9):\n> I guess it's fair enough to write in the specifications of the protocol that `__init_extra__` shall be a method.\n\nYou'll have to be careful how you formulate that: `cdef` classes can have methods too (some custom cython object of course) and their unbound versions specifically call themselves \"method\" and have no `__func__` attribute. They are callable, though, further suggesting one should probably check if the attribute is callable and if not, see if there is a `__func__` attribute that is callable (or some safe permutation of this that performs better)\n\n> And if some day we have a serious use case (which I kind of doubt), it will always be time to generalize the protocol.\n\nFamous last words... I've seen many cases happen in sage where little design issues (which, at the time perpetrated seemed perfectly reasonable) lead to weird, unforseen and silent failures. The problem this ticket is trying to fix is one of them.",
    "created_at": "2014-01-25T19:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200492",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@nthiery](#comment%3A9):
> I guess it's fair enough to write in the specifications of the protocol that `__init_extra__` shall be a method.

You'll have to be careful how you formulate that: `cdef` classes can have methods too (some custom cython object of course) and their unbound versions specifically call themselves "method" and have no `__func__` attribute. They are callable, though, further suggesting one should probably check if the attribute is callable and if not, see if there is a `__func__` attribute that is callable (or some safe permutation of this that performs better)

> And if some day we have a serious use case (which I kind of doubt), it will always be time to generalize the protocol.

Famous last words... I've seen many cases happen in sage where little design issues (which, at the time perpetrated seemed perfectly reasonable) lead to weird, unforseen and silent failures. The problem this ticket is trying to fix is one of them.



---

archive/issue_comments_200493.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@nbruin](#comment%3A10):\n> You'll have to be careful how you formulate that: `cdef` classes can have methods too (some custom cython object of course) and their unbound versions specifically call themselves \"method\" and have no `__func__` attribute.\n\nNote that the idea is to go up `self.__class__.mro()` on the one hand, and `self.category().parent_class.mro()`, on the other hand. The former is no problem, since self is an instance of its class and thus we don't need the `__func__` attribute. The latter is (currently, at least) no problem, since parent classes of categories are Python classes and thus have `__func__` on their methods. Or am I mistaken?",
    "created_at": "2014-01-25T21:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200493",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@nbruin](#comment%3A10):
> You'll have to be careful how you formulate that: `cdef` classes can have methods too (some custom cython object of course) and their unbound versions specifically call themselves "method" and have no `__func__` attribute.

Note that the idea is to go up `self.__class__.mro()` on the one hand, and `self.category().parent_class.mro()`, on the other hand. The former is no problem, since self is an instance of its class and thus we don't need the `__func__` attribute. The latter is (currently, at least) no problem, since parent classes of categories are Python classes and thus have `__func__` on their methods. Or am I mistaken?



---

archive/issue_comments_200494.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@simon-king-jena](#comment%3A11):\n> Note that the idea is to go up `self.__class__.mro()` on the one hand, and `self.category().parent_class.mro()`, on the other hand. The former is no problem, since self is an instance of its class and thus we don't need the `__func__` attribute. The latter is (currently, at least) no problem, since parent classes of categories are Python classes and thus have `__func__` on their methods. Or am I mistaken?\n\nWell, anything can be assigned to attributes in principle, regardless of whether something is a python class or not. Should we ever migrate to Python 3 then there are no unbound instancemethods at all: they are just plain functions there.\n\nSo I'd say:\n* check if `__init_extra__.im_func` exists (this indicates an `instancemethod` object). If so, perhaps check if `__init_extra__.im_self` is None (unbound method). If it does, then call `im_func`.\n* otherwise, just call `__init_extra__`.\nIt's hardly more coding work and should be far more robust.",
    "created_at": "2014-01-26T04:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200494",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@simon-king-jena](#comment%3A11):
> Note that the idea is to go up `self.__class__.mro()` on the one hand, and `self.category().parent_class.mro()`, on the other hand. The former is no problem, since self is an instance of its class and thus we don't need the `__func__` attribute. The latter is (currently, at least) no problem, since parent classes of categories are Python classes and thus have `__func__` on their methods. Or am I mistaken?

Well, anything can be assigned to attributes in principle, regardless of whether something is a python class or not. Should we ever migrate to Python 3 then there are no unbound instancemethods at all: they are just plain functions there.

So I'd say:
* check if `__init_extra__.im_func` exists (this indicates an `instancemethod` object). If so, perhaps check if `__init_extra__.im_self` is None (unbound method). If it does, then call `im_func`.
* otherwise, just call `__init_extra__`.
It's hardly more coding work and should be far more robust.



---

archive/issue_comments_200495.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@nbruin](#comment%3A12):\n> So I'd say:\n> * check if `__init_extra__.im_func` exists (this indicates an `instancemethod` object).\n\nor use inspect.ismethod.",
    "created_at": "2014-01-26T08:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200495",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@nbruin](#comment%3A12):
> So I'd say:
> * check if `__init_extra__.im_func` exists (this indicates an `instancemethod` object).

or use inspect.ismethod.



---

archive/issue_events_206892.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206892"
}
```



---

archive/issue_events_206893.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206893"
}
```



---

archive/issue_events_206894.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206894"
}
```



---

archive/issue_events_206895.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206895"
}
```



---

archive/issue_events_206896.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206896"
}
```



---

archive/issue_events_206897.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206897"
}
```



---

archive/issue_comments_200496.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nPing to myself. I think the `__init_extra__` can be called similar to what I did in #18756/#18758.",
    "created_at": "2015-07-23T15:01:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200496",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">Comment 17</div>

Ping to myself. I think the `__init_extra__` can be called similar to what I did in #18756/#18758.



---

archive/issue_comments_200497.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nVery strange. The following does not work, even in Python:\n\n```\n            sage: from sage.structure.element import RingElement\n            sage: class E(RingElement):\n            ....:     def __init__(self, P, n):\n            ....:         self.n = n\n            ....:         RingElement.__init__(self, P)\n            ....:     def _repr_(self):\n            ....:         return \"<{}>\".format(self.n)\n            ....:     def _mul_(self, other):\n            ....:         return self.parent()(self.n*other.n)\n            ....:     def _add_(self, other):\n            ....:         return self.parent()(self.n+other.n)\n            ....:     def _lmul_(self, other):\n            ....:         return self.parent()(self.n*other)\n            sage: class P(Parent):\n            ....:     Element = E\n            sage: p = P(base=ZZ, category=Algebras(ZZ))\n            sage: p.has_coerce_map_from(ZZ)\n            False\n```\nI found that `UnitalAlgebras.ParentMethods.__init_extra__` is called. However, it is claimed that the (absence of a) coerce map from ZZ has already been cached, which means that the clearly existing coercion via multiplication with `p.one()` is not registered.\n\nAt what point is a coercion from ZZ requested *before* calling `__init_extra__`?",
    "created_at": "2015-07-23T16:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200497",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">Comment 18</div>

Very strange. The following does not work, even in Python:

```
            sage: from sage.structure.element import RingElement
            sage: class E(RingElement):
            ....:     def __init__(self, P, n):
            ....:         self.n = n
            ....:         RingElement.__init__(self, P)
            ....:     def _repr_(self):
            ....:         return "<{}>".format(self.n)
            ....:     def _mul_(self, other):
            ....:         return self.parent()(self.n*other.n)
            ....:     def _add_(self, other):
            ....:         return self.parent()(self.n+other.n)
            ....:     def _lmul_(self, other):
            ....:         return self.parent()(self.n*other)
            sage: class P(Parent):
            ....:     Element = E
            sage: p = P(base=ZZ, category=Algebras(ZZ))
            sage: p.has_coerce_map_from(ZZ)
            False
```
I found that `UnitalAlgebras.ParentMethods.__init_extra__` is called. However, it is claimed that the (absence of a) coerce map from ZZ has already been cached, which means that the clearly existing coercion via multiplication with `p.one()` is not registered.

At what point is a coercion from ZZ requested *before* calling `__init_extra__`?



---

archive/issue_comments_200498.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nShoot! One needs to do\n\n```\n            ....:     def _lmul_(self, other):\n            ....:         return self.parent().element_class(self.parent(),self.n*other)\n```\nsince `self.parent()(something)` apparently tries to find a coercion from `something.parent()` to `self.parent()`.",
    "created_at": "2015-07-23T16:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200498",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">Comment 19</div>

Shoot! One needs to do

```
            ....:     def _lmul_(self, other):
            ....:         return self.parent().element_class(self.parent(),self.n*other)
```
since `self.parent()(something)` apparently tries to find a coercion from `something.parent()` to `self.parent()`.



---

archive/issue_comments_200499.json:
```json
{
    "body": "Branch: **[u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_)**",
    "created_at": "2015-07-23T16:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200499",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_)**



---

archive/issue_comments_200500.json:
```json
{
    "body": "Commit: **[b0f16f6](https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc)**",
    "created_at": "2015-07-23T16:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200500",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[b0f16f6](https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc)**



---

archive/issue_comments_200501.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nTo make sage start, it was also needed to declare that `MPolynomialRing_libsingular` uses a custom coercion from the base ring. Oops, I just note that the new doctest doesn't pass. Sorry.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc\">b0f16f6</a></td><td><code>implement `__init_extra__` protocol for cython classes</code></td></tr></table>\n",
    "created_at": "2015-07-23T16:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200501",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">Comment 21</div>

To make sage start, it was also needed to declare that `MPolynomialRing_libsingular` uses a custom coercion from the base ring. Oops, I just note that the new doctest doesn't pass. Sorry.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc">b0f16f6</a></td><td><code>implement `__init_extra__` protocol for cython classes</code></td></tr></table>




---

archive/issue_comments_200502.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2015-07-23T16:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200502",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_200503.json:
```json
{
    "body": "Changed commit from **[b0f16f6](https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc)** to **[3c36b95](https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a)**",
    "created_at": "2015-07-23T16:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200503",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b0f16f6](https://github.com/sagemath/sagetrac-mirror/commit/b0f16f6532bc7b3bb214b0c17470fc703f5f7acc)** to **[3c36b95](https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a)**



---

archive/issue_comments_200504.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a\">3c36b95</a></td><td><code>Fix the new doctest</code></td></tr></table>\n",
    "created_at": "2015-07-23T16:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200504",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22" align="right">Comment 22</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a">3c36b95</a></td><td><code>Fix the new doctest</code></td></tr></table>




---

archive/issue_comments_200505.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nWith the additional commit, tests in sage.structure.parent pass, and I hope they do elsewhere, too.",
    "created_at": "2015-07-23T16:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200505",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">Comment 23</div>

With the additional commit, tests in sage.structure.parent pass, and I hope they do elsewhere, too.



---

archive/issue_events_206898.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-23T16:46:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206898"
}
```



---

archive/issue_comments_200506.json:
```json
{
    "body": "Work Issues: **Ensure that __init_extra__ is called in the right moment**",
    "created_at": "2015-07-24T09:47:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200506",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **Ensure that __init_extra__ is called in the right moment**



---

archive/issue_events_206899.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-24T09:47:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206899"
}
```



---

archive/issue_events_206900.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-24T09:47:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206900"
}
```



---

archive/issue_comments_200507.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nOops:\n\n```\nsage -t src/sage/algebras/free_algebra.py  # Killed due to segmentation fault\nsage -t src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to segmentation fault\nsage -t src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Killed due to segmentation fault\nsage -t src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Killed due to segmentation fault\nsage -t src/sage/categories/pushout.py  # 5 doctests failed\nsage -t src/sage/categories/homset.py  # 4 doctests failed\nsage -t src/sage/rings/quotient_ring_element.py  # Killed due to segmentation fault\nsage -t src/sage/rings/ring.pyx  # Killed due to segmentation fault\nsage -t src/sage/rings/quotient_ring.py  # Killed due to segmentation fault\nsage -t src/sage/rings/polynomial/polynomial_quotient_ring.py  # 35 doctests failed\nsage -t src/sage/rings/polynomial/polynomial_quotient_ring_element.py  # 6 doctests failed\n```\nSorry, I am currently unable to continue work on this. I suppose the solution is to either change the point at which `Parent.__init__` is called (since it tests whether `self.one()` works and multiplication works, it needs to be done rather late), or to indicate that there is a custom coercion that is better than the default coerce map (which is what I did in the case of multivariate polynomial rings).",
    "created_at": "2015-07-24T09:47:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200507",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">Comment 24</div>

Oops:

```
sage -t src/sage/algebras/free_algebra.py  # Killed due to segmentation fault
sage -t src/sage/algebras/letterplace/letterplace_ideal.pyx  # Killed due to segmentation fault
sage -t src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx  # Killed due to segmentation fault
sage -t src/sage/algebras/letterplace/free_algebra_letterplace.pyx  # Killed due to segmentation fault
sage -t src/sage/categories/pushout.py  # 5 doctests failed
sage -t src/sage/categories/homset.py  # 4 doctests failed
sage -t src/sage/rings/quotient_ring_element.py  # Killed due to segmentation fault
sage -t src/sage/rings/ring.pyx  # Killed due to segmentation fault
sage -t src/sage/rings/quotient_ring.py  # Killed due to segmentation fault
sage -t src/sage/rings/polynomial/polynomial_quotient_ring.py  # 35 doctests failed
sage -t src/sage/rings/polynomial/polynomial_quotient_ring_element.py  # 6 doctests failed
```
Sorry, I am currently unable to continue work on this. I suppose the solution is to either change the point at which `Parent.__init__` is called (since it tests whether `self.one()` works and multiplication works, it needs to be done rather late), or to indicate that there is a custom coercion that is better than the default coerce map (which is what I did in the case of multivariate polynomial rings).



---

archive/issue_comments_200508.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nI couldn't resist working on it.\n\nIn some cases, the problem is that a parent has not been given a base(ring), however it is initialised in the category of unital algebras, which means that it *has* a base(ring).\n\nShould we perhaps modify `CategoryObject.__init__`, which currently just defines `self._base` and then initialises the category? It could additionally define a base for the parent, if the given category has a base.",
    "created_at": "2015-07-24T14:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200508",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">Comment 25</div>

I couldn't resist working on it.

In some cases, the problem is that a parent has not been given a base(ring), however it is initialised in the category of unital algebras, which means that it *has* a base(ring).

Should we perhaps modify `CategoryObject.__init__`, which currently just defines `self._base` and then initialises the category? It could additionally define a base for the parent, if the given category has a base.



---

archive/issue_comments_200509.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@simon-king-jena](#comment%3A25):\n> Should we perhaps modify `CategoryObject.__init__`, which currently just defines `self._base` and then initialises the category? It could additionally define a base for the parent, if the given category has a base.\n\nIt looks like a good idea, but would break an awful lot of things. `:-(`.",
    "created_at": "2015-07-24T14:54:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200509",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@simon-king-jena](#comment%3A25):
> Should we perhaps modify `CategoryObject.__init__`, which currently just defines `self._base` and then initialises the category? It could additionally define a base for the parent, if the given category has a base.

It looks like a good idea, but would break an awful lot of things. `:-(`.



---

archive/issue_comments_200510.json:
```json
{
    "body": "Changed commit from **[3c36b95](https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a)** to **[e6271e9](https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b)**",
    "created_at": "2015-07-24T15:41:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200510",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3c36b95](https://github.com/sagemath/sagetrac-mirror/commit/3c36b95990f755ac80ab44e3b709240e2e751c0a)** to **[e6271e9](https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b)**



---

archive/issue_comments_200511.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b\">e6271e9</a></td><td><code>fix failing doctests</code></td></tr></table>\n",
    "created_at": "2015-07-24T15:41:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200511",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27" align="right">Comment 27</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b">e6271e9</a></td><td><code>fix failing doctests</code></td></tr></table>




---

archive/issue_comments_200512.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nNow things should work.\n\nChanges:\n- For letterplace rings, one has to call the parent init later, so that the conversions that occur in `__init_extra__` work.\n- In pushout.py, there is one test where a class is defined as a subclass of a parent-class-with-category. By consequence, an instance of that class is not correctly category-initialised.\n- I just realise that I forgot some fixes for tests in homset.py. Here is problematic what I mentioned above: The base ring is not given, but the category has a base ring, and because of the missing base ring, `__init_extra__` fails. Fixing it now...",
    "created_at": "2015-07-24T15:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200512",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">Comment 28</div>

Now things should work.

Changes:
- For letterplace rings, one has to call the parent init later, so that the conversions that occur in `__init_extra__` work.
- In pushout.py, there is one test where a class is defined as a subclass of a parent-class-with-category. By consequence, an instance of that class is not correctly category-initialised.
- I just realise that I forgot some fixes for tests in homset.py. Here is problematic what I mentioned above: The base ring is not given, but the category has a base ring, and because of the missing base ring, `__init_extra__` fails. Fixing it now...



---

archive/issue_comments_200513.json:
```json
{
    "body": "Changed commit from **[e6271e9](https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b)** to **[f72122d](https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d)**",
    "created_at": "2015-07-24T15:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200513",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e6271e9](https://github.com/sagemath/sagetrac-mirror/commit/e6271e9121a3666727299fa61d7f78e122983e9b)** to **[f72122d](https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d)**



---

archive/issue_comments_200514.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d\">f72122d</a></td><td><code>Fix another failing test</code></td></tr></table>\n",
    "created_at": "2015-07-24T15:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200514",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29" align="right">Comment 29</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d">f72122d</a></td><td><code>Fix another failing test</code></td></tr></table>




---

archive/issue_comments_200515.json:
```json
{
    "body": "Changed work issues from **Ensure that __init_extra__ is called in the right moment** to none",
    "created_at": "2015-07-24T15:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200515",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Ensure that __init_extra__ is called in the right moment** to none



---

archive/issue_comments_200516.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nDone! Now tests should pass (at least the previously failed tests should now be fixed...). Needs review!",
    "created_at": "2015-07-24T15:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200516",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">Comment 30</div>

Done! Now tests should pass (at least the previously failed tests should now be fixed...). Needs review!



---

archive/issue_events_206901.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-24T15:50:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206901"
}
```



---

archive/issue_events_206902.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-24T15:50:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206902"
}
```



---

archive/issue_comments_200517.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@simon-king-jena](#comment%3A30):\n> Now tests should pass\n\nThey do, on my machine at least.",
    "created_at": "2015-07-25T05:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200517",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@simon-king-jena](#comment%3A30):
> Now tests should pass

They do, on my machine at least.



---

archive/issue_comments_200518.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nBuild fails.",
    "created_at": "2016-10-19T04:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200518",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:32" align="right">Comment 32</div>

Build fails.



---

archive/issue_events_206903.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-10-19T04:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206903"
}
```



---

archive/issue_events_206904.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-10-19T04:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206904"
}
```



---

archive/issue_comments_200519.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nThe changes look fine to me. It can be set to positive review once the build errors are fixed.",
    "created_at": "2016-10-19T04:21:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200519",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:33" align="right">Comment 33</div>

The changes look fine to me. It can be set to positive review once the build errors are fixed.



---

archive/issue_comments_200520.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nIt would be nice to have an explanation of what this branch does and which problem it solves.\n\nI would like to know why traversing the `mro()` this way is a reasonable solution. I don't know anything else in Python which does that. Why not use more standard Python idioms like `super()` calls?",
    "created_at": "2016-10-19T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200520",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

It would be nice to have an explanation of what this branch does and which problem it solves.

I would like to know why traversing the `mro()` this way is a reasonable solution. I don't know anything else in Python which does that. Why not use more standard Python idioms like `super()` calls?



---

archive/issue_comments_200521.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nAlso: since this code seems to involve categories, why is it in `Parent` and not `CategoryObject`?",
    "created_at": "2016-10-19T14:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200521",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">Comment 35</div>

Also: since this code seems to involve categories, why is it in `Parent` and not `CategoryObject`?



---

archive/issue_comments_200522.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_)** to **[u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_)**",
    "created_at": "2020-07-08T20:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200522",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/implement_the___init_extra___protocol_of_categories_for_cython_classes_)** to **[u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/implement_the___init_extra___protocol_of_categories_for_cython_classes_)**



---

archive/issue_comments_200523.json:
```json
{
    "body": "Changed commit from **[f72122d](https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d)** to **[0ec1c06](https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1)**",
    "created_at": "2020-07-08T20:17:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200523",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[f72122d](https://github.com/sagemath/sagetrac-mirror/commit/f72122d651975408670dbb6db935f280d921146d)** to **[0ec1c06](https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1)**



---

archive/issue_events_206905.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T20:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206905"
}
```



---

archive/issue_events_206906.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T20:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206906"
}
```



---

archive/issue_comments_200524.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nRebased on 9.2.beta3\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a428fa06293816edfafd7c076db7db8aa55db81\">2a428fa</a></td><td><code>implement `__init_extra__` protocol for cython classes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/944324ddcd0922ec2620687baa0734b246fb9283\">944324d</a></td><td><code>Fix the new doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a22113337560a92416894de5c2d9ae441ad1ce7e\">a221133</a></td><td><code>fix failing doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1\">0ec1c06</a></td><td><code>Fix another failing test</code></td></tr></table>\n",
    "created_at": "2020-07-08T20:17:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200524",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">Comment 37</div>

Rebased on 9.2.beta3

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a428fa06293816edfafd7c076db7db8aa55db81">2a428fa</a></td><td><code>implement `__init_extra__` protocol for cython classes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/944324ddcd0922ec2620687baa0734b246fb9283">944324d</a></td><td><code>Fix the new doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a22113337560a92416894de5c2d9ae441ad1ce7e">a221133</a></td><td><code>fix failing doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ec1c066e187dafc899ab117c003059d1fdf56b1">0ec1c06</a></td><td><code>Fix another failing test</code></td></tr></table>




---

archive/issue_events_206907.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T20:17:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206907"
}
```



---

archive/issue_events_206908.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T20:17:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206908"
}
```



---

archive/issue_events_206909.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206909"
}
```



---

archive/issue_events_206910.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206910"
}
```



---

archive/issue_comments_200525.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200525",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">Comment 39</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_206911.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206911"
}
```



---

archive/issue_events_206912.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206912"
}
```



---

archive/issue_events_206913.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206913"
}
```



---

archive/issue_events_206914.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206914"
}
```



---

archive/issue_comments_200526.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200526",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">Comment 40</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_200527.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15718#issuecomment-200527",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">Comment 41</div>

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_206915.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206915"
}
```



---

archive/issue_events_206916.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206916"
}
```



---

archive/issue_events_206917.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206917"
}
```



---

archive/issue_events_206918.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206918"
}
```



---

archive/issue_events_206919.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206919"
}
```



---

archive/issue_events_206920.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15718",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15718#event-206920"
}
```
