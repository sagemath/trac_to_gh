# Issue 15245: Pfaffian of a skew-symmetric matrix

archive/issues_015008.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nI couldn't believe my eyes when I saw we don't have the Pfaffian implemented in Sage.\n\nAttached is an implementation that computes it over any ring in the combinatorial way using perfect matchings. This is probably not an optimal algorithm (and I feel like a lot could already be gained by improving up the PerfectMatchings(n) iterator without even changing the algorithm) but it's enough for my combinatorial needs.\n\nOther than this, the patch makes perfect matchings iterable (no, they weren't) and improves some docstrings related to rook polynomials. The #14117 dependency is because both patches edit matrix2.py and would probably cause some fuzz.\n\nApply:\n\n* [attachment: trac_15245-pfaffian-dg.patch](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)\n\nDepends on #14117\n\nCC:  @sagetrac-sage-combinat @sagetrac-spancratz @sagetrac-tmonteil\n\nComponent: **combinatorics**\n\nKeywords: **matrix, sage-combinat, pfaffian**\n\nAuthor: **Darij Grinberg**\n\nReviewer: **Travis Scrimshaw**\n\nMerged: **sage-5.13.beta1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15245_\n\n",
    "closed_at": "2013-10-12T09:47:54Z",
    "created_at": "2013-10-01T04:12:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Pfaffian of a skew-symmetric matrix",
    "type": "issue",
    "updated_at": "2013-10-12T09:47:54Z",
    "url": "https://github.com/sagemath/sage/issues/15245",
    "user": "https://github.com/darijgr"
}
```
<div id="comment:0"></div>

I couldn't believe my eyes when I saw we don't have the Pfaffian implemented in Sage.

Attached is an implementation that computes it over any ring in the combinatorial way using perfect matchings. This is probably not an optimal algorithm (and I feel like a lot could already be gained by improving up the PerfectMatchings(n) iterator without even changing the algorithm) but it's enough for my combinatorial needs.

Other than this, the patch makes perfect matchings iterable (no, they weren't) and improves some docstrings related to rook polynomials. The #14117 dependency is because both patches edit matrix2.py and would probably cause some fuzz.

Apply:

* [attachment: trac_15245-pfaffian-dg.patch](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)

Depends on #14117

CC:  @sagetrac-sage-combinat @sagetrac-spancratz @sagetrac-tmonteil

Component: **combinatorics**

Keywords: **matrix, sage-combinat, pfaffian**

Author: **Darij Grinberg**

Reviewer: **Travis Scrimshaw**

Merged: **sage-5.13.beta1**

_Issue created by migration from https://trac.sagemath.org/ticket/15245_





---

archive/issue_events_214680.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-01T04:12:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214680"
}
```



---

archive/issue_events_214681.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-01T04:12:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214681"
}
```



---

archive/issue_events_214682.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-01T04:12:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214682"
}
```



---

archive/issue_events_214683.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-01T04:12:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214683"
}
```



---

archive/issue_events_214684.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-01T04:13:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214684"
}
```



---

archive/issue_comments_188026.json:
```json
{
    "body": "Dependencies: **#14117**",
    "created_at": "2013-10-01T04:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188026",
    "user": "https://github.com/darijgr"
}
```

Dependencies: **#14117**



---

archive/issue_comments_188027.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHey Darij,\n\nA few things I'd like to see changed:\n\n- Could you call `self.is_skew_symmetric()` instead of implementing your own test?\n- Instead of doing things such as `3x3` in the examples block, could you put it in full latex <code>\\`3 \\times 3\\`</code>?\n- For the `algorithm` input, I'd rather see something like\n\n```\n- ``algorithm`` -- string, the algorithm to use; currently the following\n  algorithms have been implemented:\n\n  * ``'definition'`` - using the definition given by perfect matchings\n```\n  or a variant with a better name for the algorithm.\n\nAlso since this file is so big and often subject to changes, it would be better to not include as many whitespace changes.\n\nThanks,\n\nTravis",
    "created_at": "2013-10-02T15:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188027",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

Hey Darij,

A few things I'd like to see changed:

- Could you call `self.is_skew_symmetric()` instead of implementing your own test?
- Instead of doing things such as `3x3` in the examples block, could you put it in full latex <code>\`3 \times 3\`</code>?
- For the `algorithm` input, I'd rather see something like

```
- ``algorithm`` -- string, the algorithm to use; currently the following
  algorithms have been implemented:

  * ``'definition'`` - using the definition given by perfect matchings
```
  or a variant with a better name for the algorithm.

Also since this file is so big and often subject to changes, it would be better to not include as many whitespace changes.

Thanks,

Travis



---

archive/issue_comments_188028.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHi Travis,\n\nthanks once again for the reviews! I fixed all of your issues apart from not using `is_skew_symmetric()` because that method doesn't check diagonal entries to be 0 (it only checks them to satisfy x = -x, which is not the same in characteristic 2):\n\n```\nsage: M = Matrix(Zmod(2), [[0,1],[1,1]])\nsage: M.is_skew_symmetric()\nTrue\n```\nIf you ask me, this is a bug, but I don't want to grasp into yet another hornet's nest. But thanks for having me look at my check code again; it contained an ugly indentation error...\n\nI was pretty sure that matrix algorithms are the least busy part of the code, given how long #14117 took to be reviewed. In hindsight I shouldn't have done unrelated docstring fixes, but the rook stuff was just pretty close and caught my eyes.\n\nBest regards,\n\nDarij",
    "created_at": "2013-10-02T17:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188028",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:4" align="right">comment:4</div>

Hi Travis,

thanks once again for the reviews! I fixed all of your issues apart from not using `is_skew_symmetric()` because that method doesn't check diagonal entries to be 0 (it only checks them to satisfy x = -x, which is not the same in characteristic 2):

```
sage: M = Matrix(Zmod(2), [[0,1],[1,1]])
sage: M.is_skew_symmetric()
True
```
If you ask me, this is a bug, but I don't want to grasp into yet another hornet's nest. But thanks for having me look at my check code again; it contained an ugly indentation error...

I was pretty sure that matrix algorithms are the least busy part of the code, given how long #14117 took to be reviewed. In hindsight I shouldn't have done unrelated docstring fixes, but the rook stuff was just pretty close and caught my eyes.

Best regards,

Darij



---

archive/issue_comments_188029.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,7 @@\n Attached is an implementation that computes it over any ring in the combinatorial way using perfect matchings. This is probably not an optimal algorithm (and I feel like a lot could already be gained by improving up the PerfectMatchings(n) iterator without even changing the algorithm) but it's enough for my combinatorial needs.\n \n Other than this, the patch makes perfect matchings iterable (no, they weren't) and improves some docstrings related to rook polynomials. The #14117 dependency is because both patches edit matrix2.py and would probably cause some fuzz.\n+\n+Apply:\n+\n+* [attachment: trac_15245-pfaffian-dg.patch](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)\n``````\n",
    "created_at": "2013-10-02T17:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188029",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,7 @@
 Attached is an implementation that computes it over any ring in the combinatorial way using perfect matchings. This is probably not an optimal algorithm (and I feel like a lot could already be gained by improving up the PerfectMatchings(n) iterator without even changing the algorithm) but it's enough for my combinatorial needs.
 
 Other than this, the patch makes perfect matchings iterable (no, they weren't) and improves some docstrings related to rook polynomials. The #14117 dependency is because both patches edit matrix2.py and would probably cause some fuzz.
+
+Apply:
+
+* [attachment: trac_15245-pfaffian-dg.patch](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)
``````




---

archive/issue_events_214685.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-02T17:24:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214685"
}
```



---

archive/issue_events_214686.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-10-02T17:24:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214686"
}
```



---

archive/issue_comments_188030.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nfor the patchbot:\n\napply trac_15245-pfaffian-dg.patch\u200b",
    "created_at": "2013-10-02T17:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188030",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:6" align="right">comment:6</div>

for the patchbot:

apply trac_15245-pfaffian-dg.patchâ€‹



---

archive/issue_comments_188031.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@darijgr](#comment%3A4):\n> thanks once again for the reviews! I fixed all of your issues apart from not using `is_skew_symmetric()` because that method doesn't check diagonal entries to be 0 (it only checks them to satisfy x = -x, which is not the same in characteristic 2):\n\nI think that's the definition of skew symmetric/antisymmetric: that A<sup>T</sup>=-A. It just happens to be the case that the concepts \"symmetric\" and \"antisymmetric\" coincide in characteristic 2.\n\nIn other words: skew symmetric matrices don't have to have 0 on their diagonal. Note that the terminology comes from bilinear forms, where alternating means (v,v)=0, antisymmetric means (v,w)=-(w,v) and symmetric means (v,w)=(w,v). \"alternating\" is not \"antisymmetric\" in characteristic 2.",
    "created_at": "2013-10-02T18:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188031",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@darijgr](#comment%3A4):
> thanks once again for the reviews! I fixed all of your issues apart from not using `is_skew_symmetric()` because that method doesn't check diagonal entries to be 0 (it only checks them to satisfy x = -x, which is not the same in characteristic 2):

I think that's the definition of skew symmetric/antisymmetric: that A<sup>T</sup>=-A. It just happens to be the case that the concepts "symmetric" and "antisymmetric" coincide in characteristic 2.

In other words: skew symmetric matrices don't have to have 0 on their diagonal. Note that the terminology comes from bilinear forms, where alternating means (v,v)=0, antisymmetric means (v,w)=-(w,v) and symmetric means (v,w)=(w,v). "alternating" is not "antisymmetric" in characteristic 2.



---

archive/issue_comments_188032.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThat's the hornet's nest I was talking about. With the definition you give, the Pfaffian lacks many of its nice properties like squaring to the determinant. It is the definition used on http://en.wikipedia.org/wiki/Skew-symmetric_matrix but not the definition used on http://en.wikipedia.org/wiki/Pfaffian . Since mathematicians can't agree, I figured it is easier to check for the kind of skew-symmetry needed in the definition of the Pfaffian rather than push that definition into the rest of the code. Is there a better solution?",
    "created_at": "2013-10-02T18:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188032",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:8" align="right">comment:8</div>

That's the hornet's nest I was talking about. With the definition you give, the Pfaffian lacks many of its nice properties like squaring to the determinant. It is the definition used on http://en.wikipedia.org/wiki/Skew-symmetric_matrix but not the definition used on http://en.wikipedia.org/wiki/Pfaffian . Since mathematicians can't agree, I figured it is easier to check for the kind of skew-symmetry needed in the definition of the Pfaffian rather than push that definition into the rest of the code. Is there a better solution?



---

archive/issue_events_214687.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-06T09:43:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214687"
}
```



---

archive/issue_events_214688.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-06T09:43:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214688"
}
```



---

archive/issue_events_214689.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-06T09:43:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214689"
}
```



---

archive/issue_events_214690.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-06T09:43:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214690"
}
```



---

archive/issue_comments_188033.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\ndarij: it looks like you reviewed your own patch. I'd say this still needs a \"formal\" review.",
    "created_at": "2013-10-06T09:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

darij: it looks like you reviewed your own patch. I'd say this still needs a "formal" review.



---

archive/issue_comments_188034.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOops -- I just realized what Travis gave were comments, not a review. Sorry!",
    "created_at": "2013-10-06T13:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188034",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:11" align="right">comment:11</div>

Oops -- I just realized what Travis gave were comments, not a review. Sorry!



---

archive/issue_comments_188035.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHey Darij,\n\nSorry for letting this slip away.\n\nFor the skew-symmetric, how about instead calling `is_skew_symmetric()` and then checking that the diagonal entries are 0 with\n\n```\nall(d == 0 for d in self.diagonal())\n```\nOne more minor thing: the `AUTHORS:` block shouldn't be indented.\n\nBest,\n\nTravis",
    "created_at": "2013-10-06T15:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188035",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Hey Darij,

Sorry for letting this slip away.

For the skew-symmetric, how about instead calling `is_skew_symmetric()` and then checking that the diagonal entries are 0 with

```
all(d == 0 for d in self.diagonal())
```
One more minor thing: the `AUTHORS:` block shouldn't be indented.

Best,

Travis



---

archive/issue_comments_188036.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI've given the `is_skew_symmetric` method an additional keyword variable now. All the rest is OK?",
    "created_at": "2013-10-06T16:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188036",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:13" align="right">comment:13</div>

I've given the `is_skew_symmetric` method an additional keyword variable now. All the rest is OK?



---

archive/issue_comments_188037.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@darijgr](#comment%3A13):\n> I've given the `is_skew_symmetric` method an additional keyword variable now. All the rest is OK?\n\nThat keyword should really be `is_alternating`, so the more appropriate thing would be to supply a method `is_alternating`.\n\nIf pfaffians need alternating rather than skew-symmetric (I haven't checked) then the confusion in terminology just comes from the fact that people looking at pfaffians haven't considered characteristic 2. That kind of thing happens all the time, and it's the kind of thing that computer algebra systems need to be a little more pedantic about than math literature, since you don't get to say \"in this paper, with <THIS> we mean <SOMETHING ELSE>\".\n\nIt may well be that pfaffians are simply not all that useful in characteristic 2, so that people didn't bother with them (Cayley certainly wouldn't have).",
    "created_at": "2013-10-06T17:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188037",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@darijgr](#comment%3A13):
> I've given the `is_skew_symmetric` method an additional keyword variable now. All the rest is OK?

That keyword should really be `is_alternating`, so the more appropriate thing would be to supply a method `is_alternating`.

If pfaffians need alternating rather than skew-symmetric (I haven't checked) then the confusion in terminology just comes from the fact that people looking at pfaffians haven't considered characteristic 2. That kind of thing happens all the time, and it's the kind of thing that computer algebra systems need to be a little more pedantic about than math literature, since you don't get to say "in this paper, with <THIS> we mean <SOMETHING ELSE>".

It may well be that pfaffians are simply not all that useful in characteristic 2, so that people didn't bother with them (Cayley certainly wouldn't have).



---

archive/issue_comments_188038.json:
```json
{
    "body": "new version, separating skew-symmetry from alternatingness systematically",
    "created_at": "2013-10-06T22:12:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188038",
    "user": "https://github.com/darijgr"
}
```

new version, separating skew-symmetry from alternatingness systematically



---

archive/issue_comments_188039.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[trac_15245-pfaffian-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)**\n\nDone. A number of people seem to be lax about characteristic 2, among them Knuth from whom I had expected this the least.",
    "created_at": "2013-10-06T22:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188039",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[trac_15245-pfaffian-dg.patch.gz](https://github.com/sagemath/sage/files/ticket15245/trac_15245-pfaffian-dg.patch.gz)**

Done. A number of people seem to be lax about characteristic 2, among them Knuth from whom I had expected this the least.



---

archive/issue_comments_188040.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI'm happy with it (having an `is_alternating()` method). Nils?",
    "created_at": "2013-10-07T16:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188040",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

I'm happy with it (having an `is_alternating()` method). Nils?



---

archive/issue_comments_188041.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@tscrim](#comment%3A16):\n> I'm happy with it (having an `is_alternating()` method). Nils?\n\nYep. It's a pedantic difference, but since this gets exposed in our official matrix API I think it's worth being precise.",
    "created_at": "2013-10-07T22:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188041",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@tscrim](#comment%3A16):
> I'm happy with it (having an `is_alternating()` method). Nils?

Yep. It's a pedantic difference, but since this gets exposed in our official matrix API I think it's worth being precise.



---

archive/issue_comments_188042.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThen it's a positive review.",
    "created_at": "2013-10-08T14:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188042",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

Then it's a positive review.



---

archive/issue_comments_188043.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2013-10-08T14:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188043",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_214691.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-10-08T14:31:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214691"
}
```



---

archive/issue_events_214692.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-10-08T14:31:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214692"
}
```



---

archive/issue_comments_188044.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOh, a comment that may be worthwhile for future work:\n\nThe generic implementations of is_skewsymmetric and is_alternating are probably horribly slow compared to what one can do on specific classes (see, e.g. #15104). Since the difference between is_alternating and is_skewsymmetric only is apparent in characteristic 2, we'd probably get better performance if one of the two calls the other if required. If the specific implementation only applies to characteristic not equal to 2, it only needs to implement one fast method and the generic other one will call it.\n\nProbably `is_skewsymmetric` is the better choice for being the \"main\" method, because it's the more widely used term. We'd get something like:\n\n```\n    def is_alternating(self):\n        if self.base_ring().characteristic() !=2:\n            return self.is_skewsymmetric()\n        <rest of code>\n```",
    "created_at": "2013-10-08T15:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188044",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Oh, a comment that may be worthwhile for future work:

The generic implementations of is_skewsymmetric and is_alternating are probably horribly slow compared to what one can do on specific classes (see, e.g. #15104). Since the difference between is_alternating and is_skewsymmetric only is apparent in characteristic 2, we'd probably get better performance if one of the two calls the other if required. If the specific implementation only applies to characteristic not equal to 2, it only needs to implement one fast method and the generic other one will call it.

Probably `is_skewsymmetric` is the better choice for being the "main" method, because it's the more widely used term. We'd get something like:

```
    def is_alternating(self):
        if self.base_ring().characteristic() !=2:
            return self.is_skewsymmetric()
        <rest of code>
```



---

archive/issue_comments_188045.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nNot sure about it. `is_skewsymmetric` should be a tad slower than `is_alternating` (not seriously so -- it just calls diagonal elements twice rather than once). And I never understood what a characteristic of a ring is; chances are this is another thing not consistently understood in Sage. What we probably cannot do is ask whether the characteristic is not 2; if anything, we should ask for 2 to be invertible. But even then, I fear that excepting the `NotImplementedError` errors will ruin the speed benefits we get from unifying the code.\n\nThanks, Travis and Nils, for the review and the helpful comments!",
    "created_at": "2013-10-08T16:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188045",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:20" align="right">comment:20</div>

Not sure about it. `is_skewsymmetric` should be a tad slower than `is_alternating` (not seriously so -- it just calls diagonal elements twice rather than once). And I never understood what a characteristic of a ring is; chances are this is another thing not consistently understood in Sage. What we probably cannot do is ask whether the characteristic is not 2; if anything, we should ask for 2 to be invertible. But even then, I fear that excepting the `NotImplementedError` errors will ruin the speed benefits we get from unifying the code.

Thanks, Travis and Nils, for the review and the helpful comments!



---

archive/issue_comments_188046.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@darijgr](#comment%3A20):\n> Not sure about it. `is_skewsymmetric` should be a tad slower than `is_alternating` (not seriously so -- it just calls diagonal elements twice rather than once).\n\nIf that matters people can always implement both. \n\n> What we probably cannot do is ask whether the characteristic is not 2;\n\nuh ...\n\n```\nsage: GF(2).characteristic() !=2\nFalse\nsage: ZZ.characteristic() != 2\nTrue\n```\n\n> if anything, we should ask for 2 to be invertible.\n\nNo, that's not the correct check. In ZZ and (ZZ/6ZZ), 2 is not invertible and yet skew symmetric is the same as alternating.\n\nYou could check whether 1+1==0, but that's more expensive.",
    "created_at": "2013-10-08T16:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188046",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@darijgr](#comment%3A20):
> Not sure about it. `is_skewsymmetric` should be a tad slower than `is_alternating` (not seriously so -- it just calls diagonal elements twice rather than once).

If that matters people can always implement both. 

> What we probably cannot do is ask whether the characteristic is not 2;

uh ...

```
sage: GF(2).characteristic() !=2
False
sage: ZZ.characteristic() != 2
True
```

> if anything, we should ask for 2 to be invertible.

No, that's not the correct check. In ZZ and (ZZ/6ZZ), 2 is not invertible and yet skew symmetric is the same as alternating.

You could check whether 1+1==0, but that's more expensive.



---

archive/issue_comments_188047.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think what we really should be checking is if it has positive even characteristic (see the ZZ/4 example in the patch). For example doing something like\n\n```python\ndef is_alternating(self):\n    if not self.is_skew_symmetric():\n        return False\n    c = self.base_ring().characteristic()\n    return c != 0 or c % 2 != 0 \\ # If past here, we have pos. even char.\n        or all(self.get_unsafe(i,i) == 0 for i in range(self._ncols))\n```\nI do agree that `is_skew_symmetric()` should be the \"main\" method, also because it is a larger class of matrices in positive even characteristic. However, I don't see a way to speed up `is_skew_symmetric()` for the mod case, so I'm happy with the two ([more] optimized) implementations.",
    "created_at": "2013-10-08T18:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188047",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I think what we really should be checking is if it has positive even characteristic (see the ZZ/4 example in the patch). For example doing something like

```python
def is_alternating(self):
    if not self.is_skew_symmetric():
        return False
    c = self.base_ring().characteristic()
    return c != 0 or c % 2 != 0 \ # If past here, we have pos. even char.
        or all(self.get_unsafe(i,i) == 0 for i in range(self._ncols))
```
I do agree that `is_skew_symmetric()` should be the "main" method, also because it is a larger class of matrices in positive even characteristic. However, I don't see a way to speed up `is_skew_symmetric()` for the mod case, so I'm happy with the two ([more] optimized) implementations.



---

archive/issue_comments_188048.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSkew symmetric is NOT the same as alternating in ZZ/(6 ZZ); think of a 3 on the main diagonal. Just having 1 + 1 != 0 is not enough. Infinite characteristic in the sense of \"ZZ embeds into the ring\" is not enough since we can have things like ZZ[X] / (2X).",
    "created_at": "2013-10-08T18:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188048",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:23" align="right">comment:23</div>

Skew symmetric is NOT the same as alternating in ZZ/(6 ZZ); think of a 3 on the main diagonal. Just having 1 + 1 != 0 is not enough. Infinite characteristic in the sense of "ZZ embeds into the ring" is not enough since we can have things like ZZ[X] / (2X).



---

archive/issue_comments_188049.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@darijgr](#comment%3A23):\n> Skew symmetric is NOT the same as alternating in ZZ/(6 ZZ); think of a 3 on the main diagonal. Just having 1 + 1 != 0 is not enough. Infinite characteristic in the sense of \"ZZ embeds into the ring\" is not enough since we can have things like ZZ[X] / (2X).\n\nOops, sorry. I should use non-integral domains a little more. I withdraw my proposal then. Deciding whether alternating is the same as skew symmetric is not so easy after all, so we should just have two separate methods and if people want the tests to be quicker they will have to implement both themselves.",
    "created_at": "2013-10-08T19:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188049",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@darijgr](#comment%3A23):
> Skew symmetric is NOT the same as alternating in ZZ/(6 ZZ); think of a 3 on the main diagonal. Just having 1 + 1 != 0 is not enough. Infinite characteristic in the sense of "ZZ embeds into the ring" is not enough since we can have things like ZZ[X] / (2X).

Oops, sorry. I should use non-integral domains a little more. I withdraw my proposal then. Deciding whether alternating is the same as skew symmetric is not so easy after all, so we should just have two separate methods and if people want the tests to be quicker they will have to implement both themselves.



---

archive/issue_comments_188050.json:
```json
{
    "body": "Merged: **sage-5.13.beta1**",
    "created_at": "2013-10-12T09:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15245#issuecomment-188050",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.beta1**



---

archive/issue_events_214693.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-12T09:47:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214693"
}
```



---

archive/issue_events_214694.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-12T09:47:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15245",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15245#event-214694"
}
```
