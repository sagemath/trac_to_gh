# Issue 15216: Parking functions reject their offspring

archive/issues_014979.json:
```json
{
    "body": "```\nsage: [1,1,1] in ParkingFunctions(3)\nTrue\nsage: ParkingFunctions(3)([1,1,1]) in ParkingFunctions(3)\nFalse\nsage: ParkingFunctions(3)([1,1,1]) in ParkingFunctions()\nFalse\nsage: ParkingFunctions()([1,1,1]) in ParkingFunctions()\nFalse\nsage: ParkingFunctions(3)(ParkingFunctions(3)([1,1,1]))\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-57-e5b6b3a9c099> in <module>()\n----> 1 ParkingFunctions(Integer(3))(ParkingFunctions(Integer(3))([Integer(1),Integer(1),Integer(1)]))\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in __call__(self, x)\n   1371             return self._element_constructor_(x)\n   1372         else:\n-> 1373             raise ValueError, \"%s not in %s\"%(x, self)\n   1374 \n   1375     Element = CombinatorialObject # mostly for backward compatibility\n\nValueError: [1, 1, 1] not in Parking functions of size 3\nsage: ParkingFunctions()(ParkingFunctions()([1,1,1]))\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-58-39833821920e> in <module>()\n----> 1 ParkingFunctions()(ParkingFunctions()([Integer(1),Integer(1),Integer(1)]))\n\n/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in __call__(self, x)\n   1371             return self._element_constructor_(x)\n   1372         else:\n-> 1373             raise ValueError, \"%s not in %s\"%(x, self)\n   1374 \n   1375     Element = CombinatorialObject # mostly for backward compatibility\n\nValueError: [1, 1, 1] not in Parking functions\n```\n\nAlso, the docstring of `ParkingFunction` is wrong; this method returns elements, not the class.\n\nThe call `ParkingFunction([1]).diagonal_reading_word()` results in a ValueError; I don't think it should. That, and its docstring shouldn't refer to its pretty print for the definition.\n\nTravis, are you planning to give `parking_function.py` the #12913 treatment?\n\nCC:  @tscrim sage-combinat @zabrocki @slel\n\nKeywords: sage-combinat, parking function, combinatorialclass\n\nBranch/Commit: e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15216\n\n",
    "closed_at": "2021-05-27T20:30:41Z",
    "created_at": "2013-09-22T01:44:50Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Parking functions reject their offspring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15216",
    "user": "https://github.com/darijgr"
}
```
```
sage: [1,1,1] in ParkingFunctions(3)
True
sage: ParkingFunctions(3)([1,1,1]) in ParkingFunctions(3)
False
sage: ParkingFunctions(3)([1,1,1]) in ParkingFunctions()
False
sage: ParkingFunctions()([1,1,1]) in ParkingFunctions()
False
sage: ParkingFunctions(3)(ParkingFunctions(3)([1,1,1]))
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-57-e5b6b3a9c099> in <module>()
----> 1 ParkingFunctions(Integer(3))(ParkingFunctions(Integer(3))([Integer(1),Integer(1),Integer(1)]))

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in __call__(self, x)
   1371             return self._element_constructor_(x)
   1372         else:
-> 1373             raise ValueError, "%s not in %s"%(x, self)
   1374 
   1375     Element = CombinatorialObject # mostly for backward compatibility

ValueError: [1, 1, 1] not in Parking functions of size 3
sage: ParkingFunctions()(ParkingFunctions()([1,1,1]))
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-58-39833821920e> in <module>()
----> 1 ParkingFunctions()(ParkingFunctions()([Integer(1),Integer(1),Integer(1)]))

/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in __call__(self, x)
   1371             return self._element_constructor_(x)
   1372         else:
-> 1373             raise ValueError, "%s not in %s"%(x, self)
   1374 
   1375     Element = CombinatorialObject # mostly for backward compatibility

ValueError: [1, 1, 1] not in Parking functions
```

Also, the docstring of `ParkingFunction` is wrong; this method returns elements, not the class.

The call `ParkingFunction([1]).diagonal_reading_word()` results in a ValueError; I don't think it should. That, and its docstring shouldn't refer to its pretty print for the definition.

Travis, are you planning to give `parking_function.py` the #12913 treatment?

CC:  @tscrim sage-combinat @zabrocki @slel

Keywords: sage-combinat, parking function, combinatorialclass

Branch/Commit: e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15216





---

archive/issue_comments_240365.json:
```json
{
    "body": "<a id='comment:1'></a>At some point I'll give it the #12913 treatment (it needs it), but not anytime soon I think. So if someone else wants to do it, I can offer wisdom and reviews.",
    "created_at": "2013-09-27T22:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240365",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>At some point I'll give it the #12913 treatment (it needs it), but not anytime soon I think. So if someone else wants to do it, I can offer wisdom and reviews.



---

archive/issue_events_043968.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43968"
}
```



---

archive/issue_events_043969.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43969"
}
```



---

archive/issue_events_043970.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43970"
}
```



---

archive/issue_comments_240366.json:
```json
{
    "body": "<a id='comment:4'></a>see also #16595",
    "created_at": "2014-07-02T14:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240366",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>see also #16595



---

archive/issue_comments_240367.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2014-07-09T04:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240367",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_240368.json:
```json
{
    "body": "Changing branch from \"\" to \"u/elixyre/ticket/15216\"",
    "created_at": "2014-07-09T04:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240368",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing branch from "" to "u/elixyre/ticket/15216"



---

archive/issue_comments_240369.json:
```json
{
    "body": "Changing commit from \"\" to \"662155a22ca55386f4016199d42742b753d0e7a3\"",
    "created_at": "2014-07-09T04:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240369",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing commit from "" to "662155a22ca55386f4016199d42742b753d0e7a3"



---

archive/issue_comments_240370.json:
```json
{
    "body": "Changing dependencies from \"\" to \"16465\"",
    "created_at": "2014-07-09T04:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240370",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing dependencies from "" to "16465"



---

archive/issue_comments_240371.json:
```json
{
    "body": "<a id='comment:7'></a>needs rebase, and coordination with #16595",
    "created_at": "2014-07-19T13:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240371",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>needs rebase, and coordination with #16595



---

archive/issue_events_043971.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43971"
}
```



---

archive/issue_events_043972.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43972"
}
```



---

archive/issue_comments_240372.json:
```json
{
    "body": "Changing branch from \"u/elixyre/ticket/15216\" to \"public/ticket/15216\"",
    "created_at": "2014-09-22T14:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240372",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing branch from "u/elixyre/ticket/15216" to "public/ticket/15216"



---

archive/issue_comments_240373.json:
```json
{
    "body": "<a id='comment:9'></a>New commits:",
    "created_at": "2014-09-22T14:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240373",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

<a id='comment:9'></a>New commits:



---

archive/issue_comments_240374.json:
```json
{
    "body": "Changing commit from \"662155a22ca55386f4016199d42742b753d0e7a3\" to \"86e9dc816562e17a0d7e04f581c080cbfb8209b6\"",
    "created_at": "2014-09-22T14:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240374",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Changing commit from "662155a22ca55386f4016199d42742b753d0e7a3" to "86e9dc816562e17a0d7e04f581c080cbfb8209b6"



---

archive/issue_comments_240375.json:
```json
{
    "body": "<a id='comment:10'></a>I'm really not sure about what i did... There is no conflict in *parking_functions.py* and each tests seems to be ok but... I don't understand what's append with others files (I did not touch).\n\nCheers,\nJean-Baptiste",
    "created_at": "2014-09-22T14:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240375",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

<a id='comment:10'></a>I'm really not sure about what i did... There is no conflict in *parking_functions.py* and each tests seems to be ok but... I don't understand what's append with others files (I did not touch).

Cheers,
Jean-Baptiste



---

archive/issue_comments_240376.json:
```json
{
    "body": "Changing dependencies from \"16465\" to \"#16465\"",
    "created_at": "2014-09-23T07:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240376",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "16465" to "#16465"



---

archive/issue_comments_240377.json:
```json
{
    "body": "Changing commit from \"86e9dc816562e17a0d7e04f581c080cbfb8209b6\" to \"f6ffa1dfec0ff95995489d098e43195fa4fa177d\"",
    "created_at": "2021-03-23T19:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240377",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "86e9dc816562e17a0d7e04f581c080cbfb8209b6" to "f6ffa1dfec0ff95995489d098e43195fa4fa177d"



---

archive/issue_comments_240378.json:
```json
{
    "body": "Changing branch from \"public/ticket/15216\" to \"u/chapoton/clonable_parking\"",
    "created_at": "2021-03-23T19:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240378",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "public/ticket/15216" to "u/chapoton/clonable_parking"



---

archive/issue_comments_240379.json:
```json
{
    "body": "<a id='comment:13'></a>Here is a new tentative. Travis, I need your help for the 2 remaining doctest failures in TestSuite, please.\n\n---\nNew commits:",
    "created_at": "2021-03-23T19:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240379",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Here is a new tentative. Travis, I need your help for the 2 remaining doctest failures in TestSuite, please.

---
New commits:



---

archive/issue_events_043973.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-23T19:47:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43973"
}
```



---

archive/issue_events_043974.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-23T19:47:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43974"
}
```



---

archive/issue_comments_240380.json:
```json
{
    "body": "Changing dependencies from \"#16465\" to \"\"",
    "created_at": "2021-03-23T19:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240380",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "#16465" to ""



---

archive/issue_comments_240381.json:
```json
{
    "body": "<a id='comment:14'></a>My guess is the problem is elements aren't being created with the right parent:\n`ParkingFunctions_all.__iter__`: (I also prefer to avoid iteration over `NN` as it is simple to implement)\n\n```diff\n-        for n in NN:\n-            yield from ParkingFunctions_n(n).__iter__()\n+        n = 0\n+        while True:\n+            for pf in ParkingFunctions_n(n):\n+                yield self.element_class(self, list(pf))\n+            n += 1\n```\n`ParkingFunctions_n.__iter__`:\n\n```diff\n-yield ParkingFunction(list(pi))\n+yield self.element_class(self, list(pi))\n```\n`ParkingFunctions_n.random_element`:\n\n```diff\n-return ParkingFunction([(i - free[0]).lift() for i in fun])\n+return self.element_class(self, [(i - free[0]).lift() for i in fun])\n```\n\nAlso, in `ParkingFunction`, this is bad:\n\n```\n    if pf is not None:\n        return ParkingFunction_class(None, pf)\n```\nEverything should have a parent.\n\nOne drawback is that parking functions for different parents will not be comparable (unless a coercion is implemented); in particular for the `all` and the `n` parents.",
    "created_at": "2021-03-23T23:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240381",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>My guess is the problem is elements aren't being created with the right parent:
`ParkingFunctions_all.__iter__`: (I also prefer to avoid iteration over `NN` as it is simple to implement)

```diff
-        for n in NN:
-            yield from ParkingFunctions_n(n).__iter__()
+        n = 0
+        while True:
+            for pf in ParkingFunctions_n(n):
+                yield self.element_class(self, list(pf))
+            n += 1
```
`ParkingFunctions_n.__iter__`:

```diff
-yield ParkingFunction(list(pi))
+yield self.element_class(self, list(pi))
```
`ParkingFunctions_n.random_element`:

```diff
-return ParkingFunction([(i - free[0]).lift() for i in fun])
+return self.element_class(self, [(i - free[0]).lift() for i in fun])
```

Also, in `ParkingFunction`, this is bad:

```
    if pf is not None:
        return ParkingFunction_class(None, pf)
```
Everything should have a parent.

One drawback is that parking functions for different parents will not be comparable (unless a coercion is implemented); in particular for the `all` and the `n` parents.



---

archive/issue_comments_240382.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240383.json:
```json
{
    "body": "Changing commit from \"f6ffa1dfec0ff95995489d098e43195fa4fa177d\" to \"bd1d64cb640f20985d12e30e07e4fac92f8bbd88\"",
    "created_at": "2021-03-24T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f6ffa1dfec0ff95995489d098e43195fa4fa177d" to "bd1d64cb640f20985d12e30e07e4fac92f8bbd88"



---

archive/issue_comments_240384.json:
```json
{
    "body": "<a id='comment:16'></a>ok, things seem to be working now. Thanks a lot for your help !",
    "created_at": "2021-03-24T10:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240384",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>ok, things seem to be working now. Thanks a lot for your help !



---

archive/issue_comments_240385.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-24T10:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240385",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_240386.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-03-24T12:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240386",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "Frédéric Chapoton"



---

archive/issue_comments_240387.json:
```json
{
    "body": "<a id='comment:19'></a>green bot, please review",
    "created_at": "2021-03-24T17:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240387",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>green bot, please review



---

archive/issue_comments_240388.json:
```json
{
    "body": "<a id='comment:20'></a>A few last little details:\n\nThis is (still) bad:\n\n```\n+    return ParkingFunction_class(None,\n+                                 [L.index(i) + 1 - D[L.index(i)]\n                                   for i in range(1, len(L) + 1)])\n```\nYou could construct a parent (probably all parking functions) and pass the list to that.\n\n`def __repr__` -> `def _repr_`\n\nIt is better to put `UniqueRepresentation` before `Parent` in the MRO so the equality/hashing/etc. is called earlier.\n\n`.. warning::` -> `.. WARNING::`\n\nSomething that I prefer is to not have a separate function `ParkingFunction` and element class `ParkingFunction_class`, but instead just have a `ParkingFunction` class that uses `__classcall_private__` for direct construction (see, e.g., `Partition`). I think this is less confusing for the user and is a more logical grouping (at the small expense of an indirection for someone new to the code/mechanism). I can do this if you want.",
    "created_at": "2021-03-24T21:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240388",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>A few last little details:

This is (still) bad:

```
+    return ParkingFunction_class(None,
+                                 [L.index(i) + 1 - D[L.index(i)]
                                   for i in range(1, len(L) + 1)])
```
You could construct a parent (probably all parking functions) and pass the list to that.

`def __repr__` -> `def _repr_`

It is better to put `UniqueRepresentation` before `Parent` in the MRO so the equality/hashing/etc. is called earlier.

`.. warning::` -> `.. WARNING::`

Something that I prefer is to not have a separate function `ParkingFunction` and element class `ParkingFunction_class`, but instead just have a `ParkingFunction` class that uses `__classcall_private__` for direct construction (see, e.g., `Partition`). I think this is less confusing for the user and is a more logical grouping (at the small expense of an indirection for someone new to the code/mechanism). I can do this if you want.



---

archive/issue_comments_240389.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T06:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240390.json:
```json
{
    "body": "Changing commit from \"bd1d64cb640f20985d12e30e07e4fac92f8bbd88\" to \"1c5be937973cf197b65d246b7bb2c9029e61108a\"",
    "created_at": "2021-03-25T06:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bd1d64cb640f20985d12e30e07e4fac92f8bbd88" to "1c5be937973cf197b65d246b7bb2c9029e61108a"



---

archive/issue_comments_240391.json:
```json
{
    "body": "Changing commit from \"1c5be937973cf197b65d246b7bb2c9029e61108a\" to \"9295d58544b4c9feb0d1b6271d8d13abdf6eb76b\"",
    "created_at": "2021-03-25T06:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1c5be937973cf197b65d246b7bb2c9029e61108a" to "9295d58544b4c9feb0d1b6271d8d13abdf6eb76b"



---

archive/issue_comments_240392.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T06:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240393.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks, Travis.\n\nI would rather postpone further refactoring to another ticket. Unless you are really motivated to do the job, of course.\n\nCalling `ParkingFunction_class` with `None` as parent will set a correct parent automatically, namely `ParkingFunctions_n`. So in my mind, it is not so bad.",
    "created_at": "2021-03-25T06:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240393",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>Thanks, Travis.

I would rather postpone further refactoring to another ticket. Unless you are really motivated to do the job, of course.

Calling `ParkingFunction_class` with `None` as parent will set a correct parent automatically, namely `ParkingFunctions_n`. So in my mind, it is not so bad.



---

archive/issue_comments_240394.json:
```json
{
    "body": "Changing commit from \"9295d58544b4c9feb0d1b6271d8d13abdf6eb76b\" to \"e4c0eecae05672227b3e320952ca70cf01b4de7b\"",
    "created_at": "2021-03-25T07:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9295d58544b4c9feb0d1b6271d8d13abdf6eb76b" to "e4c0eecae05672227b3e320952ca70cf01b4de7b"



---

archive/issue_comments_240395.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T07:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240396.json:
```json
{
    "body": "<a id='comment:25'></a>green bot. Travis, please ?",
    "created_at": "2021-03-27T12:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240396",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>green bot. Travis, please ?



---

archive/issue_comments_240397.json:
```json
{
    "body": "<a id='comment:26'></a>I am motivated to make a few other changes I mentioned. I will be doing this tomorrow. I feel it is easier to do this in one go.",
    "created_at": "2021-03-27T21:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240397",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>I am motivated to make a few other changes I mentioned. I will be doing this tomorrow. I feel it is easier to do this in one go.



---

archive/issue_comments_240398.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-03-29T07:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240398",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_240399.json:
```json
{
    "body": "<a id='comment:27'></a>Okay, I did the refactoring. I think this becomes a lot easier for users because then they can do `if isinstance(PF, ParkingFunction)` and not wonder why this is always `False`. This also gives consistent documentation.\n\nI also fixed a bug with the containment check.\n\nCleanup-wise, I fixed another `.. warning::`, removed `self` as an input, and a few other 80 chars/line.\n\nIf all of my changes are good, then you can set a positive review.\n\n---\nNew commits:",
    "created_at": "2021-03-29T07:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240399",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>Okay, I did the refactoring. I think this becomes a lot easier for users because then they can do `if isinstance(PF, ParkingFunction)` and not wonder why this is always `False`. This also gives consistent documentation.

I also fixed a bug with the containment check.

Cleanup-wise, I fixed another `.. warning::`, removed `self` as an input, and a few other 80 chars/line.

If all of my changes are good, then you can set a positive review.

---
New commits:



---

archive/issue_comments_240400.json:
```json
{
    "body": "Changing commit from \"e4c0eecae05672227b3e320952ca70cf01b4de7b\" to \"92e0a720c6e0a15560ebe1a92597c406edaa5ab7\"",
    "created_at": "2021-03-29T07:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240400",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "e4c0eecae05672227b3e320952ca70cf01b4de7b" to "92e0a720c6e0a15560ebe1a92597c406edaa5ab7"



---

archive/issue_comments_240401.json:
```json
{
    "body": "Changing branch from \"u/chapoton/clonable_parking\" to \"public/combinat/clonable_parking-15216\"",
    "created_at": "2021-03-29T07:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240401",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/chapoton/clonable_parking" to "public/combinat/clonable_parking-15216"



---

archive/issue_comments_240402.json:
```json
{
    "body": "<a id='comment:28'></a>This seems to break something in the findstat interface",
    "created_at": "2021-03-29T11:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240402",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>This seems to break something in the findstat interface



---

archive/issue_comments_240403.json:
```json
{
    "body": "Changing commit from \"92e0a720c6e0a15560ebe1a92597c406edaa5ab7\" to \"e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0\"",
    "created_at": "2021-03-29T16:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "92e0a720c6e0a15560ebe1a92597c406edaa5ab7" to "e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0"



---

archive/issue_comments_240404.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-29T16:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240404",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-29T19:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240405",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240406.json:
```json
{
    "body": "<a id='comment:30'></a>ok, bot is green, good to go",
    "created_at": "2021-03-29T19:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240406",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>ok, bot is green, good to go



---

archive/issue_comments_240407.json:
```json
{
    "body": "<a id='comment:31'></a>Thank you for fixing that!",
    "created_at": "2021-03-30T00:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240407",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>Thank you for fixing that!



---

archive/issue_comments_240408.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240408",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_043975.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15216#event-43975"
}
```



---

archive/issue_comments_240409.json:
```json
{
    "body": "Changing branch from \"public/combinat/clonable_parking-15216\" to \"e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0\"",
    "created_at": "2021-05-27T20:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15216#issuecomment-240409",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/combinat/clonable_parking-15216" to "e9b9df48030b061b2f66bd06c8d80d8e4b9ac4f0"
