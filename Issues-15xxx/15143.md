# Issue 15143: Improvements to SetPartitions

archive/issues_014906.json:
```json
{
    "body": "This ticket does the following:\n\n- Creates a class for all set partitions.\n- Allows equality between different set partitions of different parents.\n- Implements a total ordering on set partitions based upon ordering the parts.\n- Implements a fully consistent string representation.\n- Adds multiple methods, including accessing the base set for the set partition.\n\nApply: [attachment:trac_15143-set_partitions-folded-ts.2.patch]\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat @zabrocki\n\n**Reviewer:** Darij Grinberg, Mike Zabrocki\n\n**Author:** Travis Scrimshaw\n\n**Merged:** sage-5.13.beta0\n\n**Dependencies:** #14234\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15143\n\n",
    "closed_at": "2013-10-02T06:38:01Z",
    "created_at": "2013-09-02T16:55:12Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Improvements to SetPartitions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15143",
    "user": "https://github.com/tscrim"
}
```
This ticket does the following:

- Creates a class for all set partitions.
- Allows equality between different set partitions of different parents.
- Implements a total ordering on set partitions based upon ordering the parts.
- Implements a fully consistent string representation.
- Adds multiple methods, including accessing the base set for the set partition.

Apply: [attachment:trac_15143-set_partitions-folded-ts.2.patch]

**Assignee:** sage-combinat

**CC:**  sage-combinat @zabrocki

**Reviewer:** Darij Grinberg, Mike Zabrocki

**Author:** Travis Scrimshaw

**Merged:** sage-5.13.beta0

**Dependencies:** #14234

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/15143





---

archive/issue_comments_243756.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-09-03T19:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243756",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_243757.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere is a started review. Before I continue, I'd like you to address some questions:\n\n- Your `__mul__` method gives the same result as the existing `inf` method, but seems to be faster at arriving there. Better to reimplement the latter as an alias for the former? If you do so, the docstrings should probably be merged.\n\n- I don't understand the docstring of `ordered_set_partition_action`, nor do I understand the definition given in [LM2011] (but I have not really tried). Maybe you can improve it still? What are `A_{i_1`}, `A_{i_2`} etc.?\n\n- I have replaced the docstring and the implementation of `is_atomic` to something that matches the definition of \"atomic\" in the context of multiplicative generators of NCSym. I hope this is what you really meant. First, the empty set partition is no longer atomic; second, [[1, 4], [2], [3]] is now atomic despite max(2) < min(3) because there is a max(1, 4) to spoil the game.\n\n- I have removed the part about set compositions in the docstring of `__mul__` because the method only appears on the SetPartition class.\n\n- I see you have changed the parent of all set partitions to not include the base set. I am not saying this is wrong; just letting you know that I cannot fully test the consequences of this change and so my review will be somewhat incomplete even when it is finished.",
    "created_at": "2013-09-07T00:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243757",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:2'></a>
Here is a started review. Before I continue, I'd like you to address some questions:

- Your `__mul__` method gives the same result as the existing `inf` method, but seems to be faster at arriving there. Better to reimplement the latter as an alias for the former? If you do so, the docstrings should probably be merged.

- I don't understand the docstring of `ordered_set_partition_action`, nor do I understand the definition given in [LM2011] (but I have not really tried). Maybe you can improve it still? What are `A_{i_1`}, `A_{i_2`} etc.?

- I have replaced the docstring and the implementation of `is_atomic` to something that matches the definition of "atomic" in the context of multiplicative generators of NCSym. I hope this is what you really meant. First, the empty set partition is no longer atomic; second, [[1, 4], [2], [3]] is now atomic despite max(2) < min(3) because there is a max(1, 4) to spoil the game.

- I have removed the part about set compositions in the docstring of `__mul__` because the method only appears on the SetPartition class.

- I see you have changed the parent of all set partitions to not include the base set. I am not saying this is wrong; just letting you know that I cannot fully test the consequences of this change and so my review will be somewhat incomplete even when it is finished.



---

archive/issue_comments_243758.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks for looking at this patch.\n\nReplying to [darij](#comment%3A2):\n> Here is a started review. Before I continue, I'd like you to address some questions:\n> \n> - Your `__mul__` method gives the same result as the existing `inf` method, but seems to be faster at arriving there. Better to reimplement the latter as an alias for the former? If you do so, the docstrings should probably be merged.\n\n\nI'll take a look at it (although both of these methods were prior implementations).\n\n> - I don't understand the docstring of `ordered_set_partition_action`, nor do I understand the definition given in [LM2011] (but I have not really tried). Maybe you can improve it still? What are `A_{i_1`}, `A_{i_2`} etc.?\n\n\nI'll expand on the docstring.\n\n> - I have replaced the docstring and the implementation of `is_atomic` to something that matches the definition of \"atomic\" in the context of multiplicative generators of NCSym. I hope this is what you really meant. First, the empty set partition is no longer atomic; second, `[[1, 4], [2], [3]]` is now atomic despite max(2) < min(3) because there is a max(1, 4) to spoil the game.\n\n\nI was worried I oversimplified it. Thanks for fixing it.\n\nLet's see if we can close a small can of worms. Well, since `1` usually isn't considered as a generator of a unital algebra, it's okay that the empty set partition is not atomic. I'm assuming that similarly `1` is not considered a primitive of a Hopf algebra. However by the definition directly, it would be considered atomic since there is no non-trivial split, but I'll change it to state explicitly we don't consider it atomic. This is similar to how we don't consider `1` as being prime.\n\n> - I have removed the part about set compositions in the docstring of `__mul__` because the method only appears on the SetPartition class.\n> \n> - I see you have changed the parent of all set partitions to not include the base set. I am not saying this is wrong; just letting you know that I cannot fully test the consequences of this change and so my review will be somewhat incomplete even when it is finished.\n\n\nI made sure to put in some tests for things like equality and for the `is_less_than` and `is_strict_refinement` methods when comparing objects with different parents. Doing it this way will net a (very) small speedup in creation since we don't have to find the right parent by taking the union of sets (I didn't measure). It also made me feel more secure in my implementation of `NCSym`.\n\nI'll post the new version of the patch tomorrow.",
    "created_at": "2013-09-07T04:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243758",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Thanks for looking at this patch.

Replying to [darij](#comment%3A2):
> Here is a started review. Before I continue, I'd like you to address some questions:
> 
> - Your `__mul__` method gives the same result as the existing `inf` method, but seems to be faster at arriving there. Better to reimplement the latter as an alias for the former? If you do so, the docstrings should probably be merged.


I'll take a look at it (although both of these methods were prior implementations).

> - I don't understand the docstring of `ordered_set_partition_action`, nor do I understand the definition given in [LM2011] (but I have not really tried). Maybe you can improve it still? What are `A_{i_1`}, `A_{i_2`} etc.?


I'll expand on the docstring.

> - I have replaced the docstring and the implementation of `is_atomic` to something that matches the definition of "atomic" in the context of multiplicative generators of NCSym. I hope this is what you really meant. First, the empty set partition is no longer atomic; second, `[[1, 4], [2], [3]]` is now atomic despite max(2) < min(3) because there is a max(1, 4) to spoil the game.


I was worried I oversimplified it. Thanks for fixing it.

Let's see if we can close a small can of worms. Well, since `1` usually isn't considered as a generator of a unital algebra, it's okay that the empty set partition is not atomic. I'm assuming that similarly `1` is not considered a primitive of a Hopf algebra. However by the definition directly, it would be considered atomic since there is no non-trivial split, but I'll change it to state explicitly we don't consider it atomic. This is similar to how we don't consider `1` as being prime.

> - I have removed the part about set compositions in the docstring of `__mul__` because the method only appears on the SetPartition class.
> 
> - I see you have changed the parent of all set partitions to not include the base set. I am not saying this is wrong; just letting you know that I cannot fully test the consequences of this change and so my review will be somewhat incomplete even when it is finished.


I made sure to put in some tests for things like equality and for the `is_less_than` and `is_strict_refinement` methods when comparing objects with different parents. Doing it this way will net a (very) small speedup in creation since we don't have to find the right parent by taking the union of sets (I didn't measure). It also made me feel more secure in my implementation of `NCSym`.

I'll post the new version of the patch tomorrow.



---

archive/issue_comments_243759.json:
```json
{
    "body": "<a id='comment:4'></a>\nOops, I didn't realize `__mul__` was there before you. Anyway, I'll take a look at it if you don't; it sounds like a cheap speedup one can get from just throwing away old code.\n\nThe Bergeron-Zabrocki paper you linked me to (thank you!) says \"A is called atomic if it is non-empty and not splittable\"; note the \"non-empty\" here. But apparently some other sources don't require non-emptiness. As far as I am concerned, the \"non-empty\" convention makes more sense; these are supposed to be a free monoid generating set of the monoid of all set partitions, so there is no reason the unity of the monoid should be there.",
    "created_at": "2013-09-07T15:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243759",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'></a>
Oops, I didn't realize `__mul__` was there before you. Anyway, I'll take a look at it if you don't; it sounds like a cheap speedup one can get from just throwing away old code.

The Bergeron-Zabrocki paper you linked me to (thank you!) says "A is called atomic if it is non-empty and not splittable"; note the "non-empty" here. But apparently some other sources don't require non-emptiness. As far as I am concerned, the "non-empty" convention makes more sense; these are supposed to be a free monoid generating set of the monoid of all set partitions, so there is no reason the unity of the monoid should be there.



---

archive/issue_comments_243760.json:
```json
{
    "body": "<a id='comment:6'></a>\nI started testing parts of this patch and found a minor bug that the partition type isn't checked.\n\n```\nsage: SetPartition([[1,2],[4]]) in SetPartitions([1,2,4],[3])\nTrue\n```\nThe other parts that I did test are looking good.",
    "created_at": "2013-09-09T18:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243760",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:6'></a>
I started testing parts of this patch and found a minor bug that the partition type isn't checked.

```
sage: SetPartition([[1,2],[4]]) in SetPartitions([1,2,4],[3])
True
```
The other parts that I did test are looking good.



---

archive/issue_comments_243761.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, I've found that `SetPartition` accepts the following bad input.  Maybe it should raise an error.\n\n```\nsage: SetPartition([[1,2],[2,3]])\n{{1, 2}, {2, 3}}\n```",
    "created_at": "2013-09-09T18:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243761",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:7'></a>
Also, I've found that `SetPartition` accepts the following bad input.  Maybe it should raise an error.

```
sage: SetPartition([[1,2],[2,3]])
{{1, 2}, {2, 3}}
```



---

archive/issue_comments_243762.json:
```json
{
    "body": "<a id='comment:8'></a>\nI understand this as a tradeoff with speed -- maybe add a check variable which is set to True by default, and go over all existing code that involves set partitions (hopefully not that much, and some of it will have to be modified anyway since #15143 breaks some doctests by changing output order) to make all calls to `SetPartition` call it with False?\n\nPartition algebras are HUGE; I definitely wouldn't want to see them slowed down by input sanitizing.",
    "created_at": "2013-09-09T18:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243762",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>
I understand this as a tradeoff with speed -- maybe add a check variable which is set to True by default, and go over all existing code that involves set partitions (hopefully not that much, and some of it will have to be modified anyway since #15143 breaks some doctests by changing output order) to make all calls to `SetPartition` call it with False?

Partition algebras are HUGE; I definitely wouldn't want to see them slowed down by input sanitizing.



---

archive/issue_comments_243763.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [trac_15143-set_partitions-ts.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-ts.patch) by @tscrim created at 2013-09-10 16:19:15\n\nHere's the new version with better containment checks and doctest corrects to partition algebras.\n\nFor patchbot:\n\nApply: trac_15143-set_partitions-ts.patch",
    "created_at": "2013-09-10T16:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243763",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Attachment [trac_15143-set_partitions-ts.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-ts.patch) by @tscrim created at 2013-09-10 16:19:15

Here's the new version with better containment checks and doctest corrects to partition algebras.

For patchbot:

Apply: trac_15143-set_partitions-ts.patch



---

archive/issue_comments_243764.json:
```json
{
    "body": "**Dependencies:** #14234",
    "created_at": "2013-09-10T16:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243764",
    "user": "https://github.com/tscrim"
}
```

**Dependencies:** #14234



---

archive/issue_comments_243765.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks for the fixes. In other news, I am now sufficiently convinced of the superiority of `__mul__` that I'm replacing `inf` by an alias to `__mul__`:\n\n```\nsage: %timeit SetPartition([[1,3],[2,6,5]]).__mul__(SetPartition([[1,2],[3],[6]]))                                               \n1000 loops, best of 3: 1.61 ms per loop\nsage: %timeit SetPartition([[1,3],[2,6,5]]).inf(SetPartition([[1,2],[3],[6]]))    \n100 loops, best of 3: 1.96 ms per loop\nsage: %timeit SetPartition([[1],[2,3]]).__mul__(SetPartition([[1,2],[3]]))        \n1000 loops, best of 3: 1.3 ms per loop\nsage: %timeit SetPartition([[1],[2,3]]).inf(SetPartition([[1,2],[3]]))    \n1000 loops, best of 3: 1.52 ms per loop\nsage: %timeit SetPartition([[1],[2],[3]]).__mul__(SetPartition([[1],[2],[3]]))\n1000 loops, best of 3: 1.92 ms per loop\nsage: %timeit SetPartition([[1],[2],[3]]).inf(SetPartition([[1],[2],[3]]))    \n100 loops, best of 3: 2.37 ms per loop\nsage: %timeit SetPartition([[1],[2],[3],[4],[5],[6],[7]]).__mul__(SetPartition([[1],[2],[4],[5],[8],[9],[3]]))\n100 loops, best of 3: 5.61 ms per loop\nsage: %timeit SetPartition([[1],[2],[3],[4],[5],[6],[7]]).inf(SetPartition([[1],[2],[4],[5],[8],[9],[3]]))    \n100 loops, best of 3: 9.28 ms per loop\nsage: %timeit SetPartition([[1,3,37]]).__mul__(SetPartition([[13,3,7]]))                                      \n1000 loops, best of 3: 662 us per loop\nsage: %timeit SetPartition([[1,3,37]]).inf(SetPartition([[13,3,7]]))    \n1000 loops, best of 3: 744 us per loop\n```\n\nI think the `check` variable does nothing when one generates a set partition. I'd be happy if you could see if there is something gained by omitting the check, and if so, making the variable work. But I must admit you have sped up the generation of a set partition by a factor of about 2 (compared to pre-#15143) already, so the net effect is a positive one even if the check is left in.\n\nI still don't understand the doc of `ordered_set_partition_action`. What is unclear to me is this:\n\n```\n        `A_{ \\{ i_1, i_2, \\ldots, i_k \\} }` denote the sub-partition\n        `\\{A_{i_1}, A_{i_2}, \\ldots, A_{i_k}\\}`.\n```\n\nOther than this method, I'll call this review done. Unfortunately, I'm out of leeway now as far as free time is concerned, and someone else will likely have to review the NCSym patch.",
    "created_at": "2013-09-11T05:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243765",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'></a>
Thanks for the fixes. In other news, I am now sufficiently convinced of the superiority of `__mul__` that I'm replacing `inf` by an alias to `__mul__`:

```
sage: %timeit SetPartition([[1,3],[2,6,5]]).__mul__(SetPartition([[1,2],[3],[6]]))                                               
1000 loops, best of 3: 1.61 ms per loop
sage: %timeit SetPartition([[1,3],[2,6,5]]).inf(SetPartition([[1,2],[3],[6]]))    
100 loops, best of 3: 1.96 ms per loop
sage: %timeit SetPartition([[1],[2,3]]).__mul__(SetPartition([[1,2],[3]]))        
1000 loops, best of 3: 1.3 ms per loop
sage: %timeit SetPartition([[1],[2,3]]).inf(SetPartition([[1,2],[3]]))    
1000 loops, best of 3: 1.52 ms per loop
sage: %timeit SetPartition([[1],[2],[3]]).__mul__(SetPartition([[1],[2],[3]]))
1000 loops, best of 3: 1.92 ms per loop
sage: %timeit SetPartition([[1],[2],[3]]).inf(SetPartition([[1],[2],[3]]))    
100 loops, best of 3: 2.37 ms per loop
sage: %timeit SetPartition([[1],[2],[3],[4],[5],[6],[7]]).__mul__(SetPartition([[1],[2],[4],[5],[8],[9],[3]]))
100 loops, best of 3: 5.61 ms per loop
sage: %timeit SetPartition([[1],[2],[3],[4],[5],[6],[7]]).inf(SetPartition([[1],[2],[4],[5],[8],[9],[3]]))    
100 loops, best of 3: 9.28 ms per loop
sage: %timeit SetPartition([[1,3,37]]).__mul__(SetPartition([[13,3,7]]))                                      
1000 loops, best of 3: 662 us per loop
sage: %timeit SetPartition([[1,3,37]]).inf(SetPartition([[13,3,7]]))    
1000 loops, best of 3: 744 us per loop
```

I think the `check` variable does nothing when one generates a set partition. I'd be happy if you could see if there is something gained by omitting the check, and if so, making the variable work. But I must admit you have sped up the generation of a set partition by a factor of about 2 (compared to pre-#15143) already, so the net effect is a positive one even if the check is left in.

I still don't understand the doc of `ordered_set_partition_action`. What is unclear to me is this:

```
        `A_{ \{ i_1, i_2, \ldots, i_k \} }` denote the sub-partition
        `\{A_{i_1}, A_{i_2}, \ldots, A_{i_k}\}`.
```

Other than this method, I'll call this review done. Unfortunately, I'm out of leeway now as far as free time is concerned, and someone else will likely have to review the NCSym patch.



---

archive/issue_comments_243766.json:
```json
{
    "body": "review patch for the new version",
    "created_at": "2013-09-11T05:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243766",
    "user": "https://github.com/darijgr"
}
```

review patch for the new version



---

archive/issue_comments_243767.json:
```json
{
    "body": "Attachment [trac_15143-docchanges-mz.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-docchanges-mz.patch) by @zabrocki created at 2013-09-11 14:41:38",
    "created_at": "2013-09-11T14:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243767",
    "user": "https://github.com/zabrocki"
}
```

Attachment [trac_15143-docchanges-mz.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-docchanges-mz.patch) by @zabrocki created at 2013-09-11 14:41:38



---

archive/issue_comments_243768.json:
```json
{
    "body": "<a id='comment:11'></a>\nI have some additional doc changes.\n\nI have one additional recommendation.  I think you should use the name `size` instead of `weight`.  There was no method before this patch for computing the size of a set partition, but it could be done indirectly by `A.to_partition().size()` or `A.to_permutation().size()`.  So why call the \"size\" in this combinatorial object the \"weight\" of a set partition?\n\nIf you are going to call anything the \"weight\" of the set partition I would think it would be the corresponding integer partition (which you called the \"shape\").",
    "created_at": "2013-09-11T14:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243768",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:11'></a>
I have some additional doc changes.

I have one additional recommendation.  I think you should use the name `size` instead of `weight`.  There was no method before this patch for computing the size of a set partition, but it could be done indirectly by `A.to_partition().size()` or `A.to_permutation().size()`.  So why call the "size" in this combinatorial object the "weight" of a set partition?

If you are going to call anything the "weight" of the set partition I would think it would be the corresponding integer partition (which you called the "shape").



---

archive/issue_comments_243769.json:
```json
{
    "body": "<a id='comment:12'></a>\nHey Darij,\n\nHopefully this example will clarify, consider `A = {{1, 4}, {3}, {2,5}}`, then `A_{1,3} = {{1, 4}, {2, 5}}` and `A_{1} = {{1, 4}}` (I've omiting the `\\` and subscript `{}` for readability). The check is currently extraneous, but I'll pass it along to the constructor.\n\nHey Mike,\n\nAlright, and I'll add some more documentation specifying that we are using the terminology for partitions for `size` and `length`.\n\nI'll post a new version later tonight.\n\nThanks,\n\nTravis",
    "created_at": "2013-09-11T19:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243769",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Hey Darij,

Hopefully this example will clarify, consider `A = {{1, 4}, {3}, {2,5}}`, then `A_{1,3} = {{1, 4}, {2, 5}}` and `A_{1} = {{1, 4}}` (I've omiting the `\` and subscript `{}` for readability). The check is currently extraneous, but I'll pass it along to the constructor.

Hey Mike,

Alright, and I'll add some more documentation specifying that we are using the terminology for partitions for `size` and `length`.

I'll post a new version later tonight.

Thanks,

Travis



---

archive/issue_comments_243770.json:
```json
{
    "body": "rest of the review. apply after my rev1 and mike's doc patch",
    "created_at": "2013-09-12T00:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243770",
    "user": "https://github.com/darijgr"
}
```

rest of the review. apply after my rev1 and mike's doc patch



---

archive/issue_comments_243771.json:
```json
{
    "body": "<a id='comment:13'></a>\nAttachment [trac_15143-rev2-dg.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-rev2-dg.patch) by @darijgr created at 2013-09-12 00:32:10\n\nHi Travis,\n\nthanks for the example; I didn't expect that `A_i` would really mean the i-th part of A (with A being unordered, this sounded a bit arbitrary to me). I think I've made the doc for this method a lot more readably now (there was some index confusion with both A and s having the same length q, and a condition r < |S| which I think is completely out of place). Please also look at the pipe method I've added (mainly because its docstring clarifies the notation used in other methods). If you agree with Mike's and my changes, this is a positive_review.\n\nBest regards,\nDarij",
    "created_at": "2013-09-12T00:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243771",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'></a>
Attachment [trac_15143-rev2-dg.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-rev2-dg.patch) by @darijgr created at 2013-09-12 00:32:10

Hi Travis,

thanks for the example; I didn't expect that `A_i` would really mean the i-th part of A (with A being unordered, this sounded a bit arbitrary to me). I think I've made the doc for this method a lot more readably now (there was some index confusion with both A and s having the same length q, and a condition r < |S| which I think is completely out of place). Please also look at the pipe method I've added (mainly because its docstring clarifies the notation used in other methods). If you agree with Mike's and my changes, this is a positive_review.

Best regards,
Darij



---

archive/issue_comments_243772.json:
```json
{
    "body": "**Reviewer:** Darij Grinberg, Mike Zabrocki",
    "created_at": "2013-09-12T15:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243772",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Darij Grinberg, Mike Zabrocki



---

archive/issue_comments_243773.json:
```json
{
    "body": "<a id='comment:14'></a>\nHey Darij and Mike,\n\nHere's a patch with all of the changes folded in, along with:\n\n- changed `weight` to `size`,\n- additions to the `SetPartition` class's documentation about the terminology,\n- tweaks to the `ordered_set_partition_action()` method's docstring (in my old version, the condition should have been `r <= |A|` and there was some abuse of variables).\n\nIf you're happy with my tweaks, then it's positive_review time.\n\nThanks,\n\nTravis",
    "created_at": "2013-09-12T15:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243773",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Hey Darij and Mike,

Here's a patch with all of the changes folded in, along with:

- changed `weight` to `size`,
- additions to the `SetPartition` class's documentation about the terminology,
- tweaks to the `ordered_set_partition_action()` method's docstring (in my old version, the condition should have been `r <= |A|` and there was some abuse of variables).

If you're happy with my tweaks, then it's positive_review time.

Thanks,

Travis



---

archive/issue_comments_243774.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,3 +6,4 @@\n - Implements a fully consistent string representation.\n - Adds multiple methods, including accessing the base set for the set partition.\n \n+Apply: [attachment:trac_15143-set_partitions-folded-ts.patch]\n``````\n",
    "created_at": "2013-09-12T15:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243774",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,3 +6,4 @@
 - Implements a fully consistent string representation.
 - Adds multiple methods, including accessing the base set for the set partition.
 
+Apply: [attachment:trac_15143-set_partitions-folded-ts.patch]
``````




---

archive/issue_comments_243775.json:
```json
{
    "body": "<a id='comment:15'></a>\nFor patchbot:\n\nApply: trac_15143-set_partitions-folded-ts.patch",
    "created_at": "2013-09-12T15:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243775",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
For patchbot:

Apply: trac_15143-set_partitions-folded-ts.patch



---

archive/issue_comments_243776.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think that this looks great and I am ready to put a positive review but I am getting a doc test failure \"File \"combinat/diagram_algebras.py\", line 193\"",
    "created_at": "2013-09-12T16:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243776",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:16'></a>
I think that this looks great and I am ready to put a positive review but I am getting a doc test failure "File "combinat/diagram_algebras.py", line 193"



---

archive/issue_comments_243777.json:
```json
{
    "body": "<a id='comment:17'></a>\nHi Travis,\n\nYou don't want s to be an \"ordered set partition (i.e., set composition) of `[r]` where `r\\leq k`\"; you want it to be an ordered set partition of a SUBSET of `[k]` (which may and may not be an initial interval). See this doctest:\n\n```\nt = OrderedSetPartition([[2], [3,4]])\n```\nwhere it is not an initial interval. Generally, your r's should be k's.\n\nI'm fine with the rest of your changes. Once you've fixed the ordered set partition action docstring, you can set this to positive_review as far as I am concerned. Sorry that I can't help with zabrocki's doctest failure as I'm not near sage right now.\n\nBest regards (also thanks for the ordered set partition review),\\\\ Darij",
    "created_at": "2013-09-12T16:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243777",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:17'></a>
Hi Travis,

You don't want s to be an "ordered set partition (i.e., set composition) of `[r]` where `r\leq k`"; you want it to be an ordered set partition of a SUBSET of `[k]` (which may and may not be an initial interval). See this doctest:

```
t = OrderedSetPartition([[2], [3,4]])
```
where it is not an initial interval. Generally, your r's should be k's.

I'm fine with the rest of your changes. Once you've fixed the ordered set partition action docstring, you can set this to positive_review as far as I am concerned. Sorry that I can't help with zabrocki's doctest failure as I'm not near sage right now.

Best regards (also thanks for the ordered set partition review),\\ Darij



---

archive/issue_comments_243778.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [trac_15143-set_partitions-folded-ts.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-folded-ts.patch) by @tscrim created at 2013-09-12 18:50:42\n\nHey Darij,\n\nYes, good point. Fixed.\n\nHey Mike,\n\nIt seems like a failure due to dictionary display. I'm returning a sorted list, so it should be fixed now.",
    "created_at": "2013-09-12T18:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243778",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Attachment [trac_15143-set_partitions-folded-ts.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-folded-ts.patch) by @tscrim created at 2013-09-12 18:50:42

Hey Darij,

Yes, good point. Fixed.

Hey Mike,

It seems like a failure due to dictionary display. I'm returning a sorted list, so it should be fixed now.



---

archive/issue_comments_243779.json:
```json
{
    "body": "<a id='comment:19'></a>\nLooks great to me and all tests pass.",
    "created_at": "2013-09-12T19:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243779",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:19'></a>
Looks great to me and all tests pass.



---

archive/issue_comments_243780.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-09-12T19:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243780",
    "user": "https://github.com/zabrocki"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_243781.json:
```json
{
    "body": "<a id='comment:20'></a>\nThank you both!",
    "created_at": "2013-09-12T19:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243781",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Thank you both!



---

archive/issue_comments_243782.json:
```json
{
    "body": "<a id='comment:21'></a>\nfor **patchbots**\n\napply trac_15143-set_partitions-folded-ts.patch",
    "created_at": "2013-09-20T19:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243782",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
for **patchbots**

apply trac_15143-set_partitions-folded-ts.patch



---

archive/issue_events_050045.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15143#event-50045"
}
```



---

archive/issue_comments_243783.json:
```json
{
    "body": "<a id='comment:23'></a>\nPlease add a proper commit message. In particular, `imported patch trac_15143-docchanges-mz.patch` shouldn't be there.",
    "created_at": "2013-09-26T16:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243783",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Please add a proper commit message. In particular, `imported patch trac_15143-docchanges-mz.patch` shouldn't be there.



---

archive/issue_comments_243784.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2013-09-26T16:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243784",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_243785.json:
```json
{
    "body": "<a id='comment:24'></a>\nAlso, the pdf documentation doesn't build:\n\n```\n! LaTeX Error: Bad math environment delimiter.\n\nSee the LaTeX manual or LaTeX Companion for explanation.\nType  H <return>  for immediate help.\n ...\n\nl.48086 where $s = \\(\n                     s_1, s_2, \\ldots, s_q\\)$. Here, the pipe symbol\n```",
    "created_at": "2013-09-27T16:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243785",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Also, the pdf documentation doesn't build:

```
! LaTeX Error: Bad math environment delimiter.

See the LaTeX manual or LaTeX Companion for explanation.
Type  H <return>  for immediate help.
 ...

l.48086 where $s = \(
                     s_1, s_2, \ldots, s_q\)$. Here, the pipe symbol
```



---

archive/issue_comments_243786.json:
```json
{
    "body": "Attachment [trac_15143-set_partitions-folded-ts.2.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-folded-ts.2.patch) by @darijgr created at 2013-09-27 18:39:56\n\ndocstring fixed, and with proper commit msg",
    "created_at": "2013-09-27T18:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243786",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_15143-set_partitions-folded-ts.2.patch](tarball://root/attachments/some-uuid/ticket15143/trac_15143-set_partitions-folded-ts.2.patch) by @darijgr created at 2013-09-27 18:39:56

docstring fixed, and with proper commit msg



---

archive/issue_comments_243787.json:
```json
{
    "body": "<a id='comment:25'></a>\nFixed!\n\nfor the patchbot:\n\napply trac_15143-set_partitions-folded-ts.2.patch",
    "created_at": "2013-09-27T18:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243787",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:25'></a>
Fixed!

for the patchbot:

apply trac_15143-set_partitions-folded-ts.2.patch



---

archive/issue_comments_243788.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2013-09-27T18:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243788",
    "user": "https://github.com/darijgr"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_243789.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n - Implements a fully consistent string representation.\n - Adds multiple methods, including accessing the base set for the set partition.\n \n-Apply: [attachment:trac_15143-set_partitions-folded-ts.patch]\n+Apply: [attachment:trac_15143-set_partitions-folded-ts.2.patch]\n``````\n",
    "created_at": "2013-09-27T18:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243789",
    "user": "https://github.com/darijgr"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
 - Implements a fully consistent string representation.
 - Adds multiple methods, including accessing the base set for the set partition.
 
-Apply: [attachment:trac_15143-set_partitions-folded-ts.patch]
+Apply: [attachment:trac_15143-set_partitions-folded-ts.2.patch]
``````




---

archive/issue_comments_243790.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks Darij.",
    "created_at": "2013-09-27T18:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243790",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
Thanks Darij.



---

archive/issue_events_050046.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:38:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15143#event-50046"
}
```



---

archive/issue_comments_243791.json:
```json
{
    "body": "**Merged:** sage-5.13.beta0",
    "created_at": "2013-10-02T06:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243791",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.13.beta0



---

archive/issue_comments_243792.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2013-10-02T06:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15143#issuecomment-243792",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed
