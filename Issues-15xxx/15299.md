# Issue 15299: Implement symplectic and orthogonal bases of Sym

archive/issues_015299.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat @darijgr simonking @nthiery\n\nKeywords: days54, sym\n\nFollowing a paper of Chari and Kleber: *Symmetric functions and representations of quantum affine algebras*, arxiv:0011161v1. We implement the symplectic and orthogonal (filtered) bases of Sym.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15536\n\n",
    "closed_at": "2015-11-03T23:59:25Z",
    "created_at": "2013-12-17T21:12:49Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Implement symplectic and orthogonal bases of Sym",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15299",
    "user": "https://github.com/tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat @darijgr simonking @nthiery

Keywords: days54, sym

Following a paper of Chari and Kleber: *Symmetric functions and representations of quantum affine algebras*, arxiv:0011161v1. We implement the symplectic and orthogonal (filtered) bases of Sym.

Issue created by migration from https://trac.sagemath.org/ticket/15536





---

archive/issue_comments_196563.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-17T21:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196563",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_196564.json:
```json
{
    "body": "Darij (or anyone else who wants to review this),\n\nNicolas said it's fine being in `GradedHopfAlgebrasWithBasis` since `Sym` does admit a graded basis, even if the given basis itself is not graded.",
    "created_at": "2013-12-17T21:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196564",
    "user": "https://github.com/tscrim"
}
```

Darij (or anyone else who wants to review this),

Nicolas said it's fine being in `GradedHopfAlgebrasWithBasis` since `Sym` does admit a graded basis, even if the given basis itself is not graded.



---

archive/issue_comments_196565.json:
```json
{
    "body": "I fear Nicolas is wrong here:\n\n```\nsage: o = Sym.o()\nsage: TestSuite(o).run()\nFailure in _test_antipode:\nTraceback (most recent call last):\n  File \"/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 282, in run\n    test_method(tester = tester)\n  File \"/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/categories/hopf_algebras_with_basis.py\", line 263, in _test_antipode\n    tester.assert_(SI(x) == self.counit(x) * self.one())\n  File \"/home/darij/gitsage/sage-5.13.beta1/local/lib/python/unittest/case.py\", line 424, in assertTrue\n    raise self.failureException(msg)\nAssertionError: False is not true\n------------------------------------------------------------\nThe following tests failed: _test_antipode\n```\nThe problem is that the counit is still defined as the constant coefficient, but that's only true for graded bases. Concrete example:\n\n```\nsage: o[2].counit()\n0\nsage: s(o[2]).counit()\n-1\n```\n\nThe same issue would be happening with antipode and degree_negation if not for the fact that the o and sp bases happen to be graded w.r.t. the induced ZZ/2ZZ-grading.",
    "created_at": "2013-12-20T11:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196565",
    "user": "https://github.com/darijgr"
}
```

I fear Nicolas is wrong here:

```
sage: o = Sym.o()
sage: TestSuite(o).run()
Failure in _test_antipode:
Traceback (most recent call last):
  File "/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 282, in run
    test_method(tester = tester)
  File "/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/sage/categories/hopf_algebras_with_basis.py", line 263, in _test_antipode
    tester.assert_(SI(x) == self.counit(x) * self.one())
  File "/home/darij/gitsage/sage-5.13.beta1/local/lib/python/unittest/case.py", line 424, in assertTrue
    raise self.failureException(msg)
AssertionError: False is not true
------------------------------------------------------------
The following tests failed: _test_antipode
```
The problem is that the counit is still defined as the constant coefficient, but that's only true for graded bases. Concrete example:

```
sage: o[2].counit()
0
sage: s(o[2]).counit()
-1
```

The same issue would be happening with antipode and degree_negation if not for the fact that the o and sp bases happen to be graded w.r.t. the induced ZZ/2ZZ-grading.



---

archive/issue_comments_196566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T06:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196567.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T06:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196567",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196568.json:
```json
{
    "body": "Replying to [comment:2 darij]:\n> I fear Nicolas is wrong here\n\n>\n> ...\n\n>\n> The problem is that the counit is still defined as the constant coefficient, but that's only true for graded bases.\n\n\nYep, but that's technically a fault with the generic symmetric function code, not the category (which I think does it via coercion by default). Fixed.\n\n> The same issue would be happening with antipode and degree_negation if not for the fact that the o and sp bases happen to be graded w.r.t. the induced ZZ/2ZZ-grading.\n\n\nAgain, not the category, but it's nice to know these things.\n\n---\nNew commits:",
    "created_at": "2013-12-27T06:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196568",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:2 darij]:
> I fear Nicolas is wrong here

>
> ...

>
> The problem is that the counit is still defined as the constant coefficient, but that's only true for graded bases.


Yep, but that's technically a fault with the generic symmetric function code, not the category (which I think does it via coercion by default). Fixed.

> The same issue would be happening with antipode and degree_negation if not for the fact that the o and sp bases happen to be graded w.r.t. the induced ZZ/2ZZ-grading.


Again, not the category, but it's nice to know these things.

---
New commits:



---

archive/issue_comments_196569.json:
```json
{
    "body": "I see. Can it be that the `SymmetricFunctionsBases` class should be split into `SymmetricFunctionsBases` and `SymmetricFunctionsConnectedGradedBases` or else we risk running into this whenever other new methods are implemented? If so, I'd suggest doing this (I can do it myself), although I'd wait for #15473 to be merged beforehand.",
    "created_at": "2013-12-27T15:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196569",
    "user": "https://github.com/darijgr"
}
```

I see. Can it be that the `SymmetricFunctionsBases` class should be split into `SymmetricFunctionsBases` and `SymmetricFunctionsConnectedGradedBases` or else we risk running into this whenever other new methods are implemented? If so, I'd suggest doing this (I can do it myself), although I'd wait for #15473 to be merged beforehand.



---

archive/issue_comments_196570.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-27T15:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196571.json:
```json
{
    "body": "I doubt there will be too many new methods which a general implementation does not involve coercing to a basis where we can do the computation explicitly, so I don't think it's necessary. Nevertheless, something for another ticket (possibly after a sage-combinat-devel discussion).",
    "created_at": "2013-12-27T16:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196571",
    "user": "https://github.com/tscrim"
}
```

I doubt there will be too many new methods which a general implementation does not involve coercing to a basis where we can do the computation explicitly, so I don't think it's necessary. Nevertheless, something for another ticket (possibly after a sage-combinat-devel discussion).



---

archive/issue_events_045408.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45408"
}
```



---

archive/issue_comments_196572.json:
```json
{
    "body": "There is a typo \"Scirmshaw\"",
    "created_at": "2014-04-18T20:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196572",
    "user": "https://github.com/fchapoton"
}
```

There is a typo "Scirmshaw"



---

archive/issue_comments_196573.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-19T05:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196573",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196574.json:
```json
{
    "body": "XP",
    "created_at": "2014-04-19T05:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196574",
    "user": "https://github.com/tscrim"
}
```

XP



---

archive/issue_events_045409.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45409"
}
```



---

archive/issue_events_045410.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45410"
}
```



---

archive/issue_events_045411.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45411"
}
```



---

archive/issue_events_045412.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45412"
}
```



---

archive/issue_comments_196575.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-03T04:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196575",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196576.json:
```json
{
    "body": "Please do not use abbreviations like \"lps\" in the name of functions.\n\nNathann",
    "created_at": "2015-02-06T09:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196576",
    "user": "https://github.com/nathanncohen"
}
```

Please do not use abbreviations like "lps" in the name of functions.

Nathann



---

archive/issue_comments_196577.json:
```json
{
    "body": "missing doctests in sf.py, see patchbot report",
    "created_at": "2015-04-25T17:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196577",
    "user": "https://github.com/fchapoton"
}
```

missing doctests in sf.py, see patchbot report



---

archive/issue_comments_196578.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-25T17:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196578",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_196579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-06T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_196580.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-06T02:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196580",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_196581.json:
```json
{
    "body": "I added the requisite doctests and I also implemented functionality for bases of `Sym` to be considered filtered (although we could make these bases be `ZZ / 2ZZ`-graded but the `ZZ`-filtration is more natural), which requires #17096.",
    "created_at": "2015-10-06T02:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196581",
    "user": "https://github.com/tscrim"
}
```

I added the requisite doctests and I also implemented functionality for bases of `Sym` to be considered filtered (although we could make these bases be `ZZ / 2ZZ`-graded but the `ZZ`-filtration is more natural), which requires #17096.



---

archive/issue_events_045413.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-06T02:34:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45413"
}
```



---

archive/issue_events_045414.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-06T02:34:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45414"
}
```



---

archive/issue_comments_196582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-06T02:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196583.json:
```json
{
    "body": "Travis, thanks for pointing this out to me.  The `st` basis in ticket #19327 is very similar and since the group of permutation matrices are orthogonal matrices, it will be that `o(lambda)` has a positive `st` expansion.\n\nThere is an explicit formula for the change of basis from `sp` and `o` to Schur basis (that is almost exactly the same as the `_s_to_sp_on_basis` and `_s_to_o_on_basis` that you have implemented, it just alternates in sign by degree and the set of partitions you sum over are transposed).  Is it faster to use the triangularity like you have here?  Are you aware of it and have you tried it?",
    "created_at": "2015-10-06T12:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196583",
    "user": "https://github.com/zabrocki"
}
```

Travis, thanks for pointing this out to me.  The `st` basis in ticket #19327 is very similar and since the group of permutation matrices are orthogonal matrices, it will be that `o(lambda)` has a positive `st` expansion.

There is an explicit formula for the change of basis from `sp` and `o` to Schur basis (that is almost exactly the same as the `_s_to_sp_on_basis` and `_s_to_o_on_basis` that you have implemented, it just alternates in sign by degree and the set of partitions you sum over are transposed).  Is it faster to use the triangularity like you have here?  Are you aware of it and have you tried it?



---

archive/issue_comments_196584.json:
```json
{
    "body": "No, I was not aware of it and haven't tried it. I'm guessing that just comes from a m\u00f6bius inversion? I suspect it will be significantly faster than using triangularity. Just to make sure I understand the computation, I keep the same coefficient up to a sign (which is the size of `mu`) and then take `mu.transpose()` as the basis element? And/Or do I need to transpose inside the coefficients?",
    "created_at": "2015-10-06T12:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196584",
    "user": "https://github.com/tscrim"
}
```

No, I was not aware of it and haven't tried it. I'm guessing that just comes from a möbius inversion? I suspect it will be significantly faster than using triangularity. Just to make sure I understand the computation, I keep the same coefficient up to a sign (which is the size of `mu`) and then take `mu.transpose()` as the basis element? And/Or do I need to transpose inside the coefficients?



---

archive/issue_comments_196585.json:
```json
{
    "body": "What I said in my last comment isn't quite right.  It is in my paper with Mark Shimozono \"Deformed universal characters for classical and affine algebras, Journal of Algebra, 299 (2006), pp. 33-61\" (arXiv:math.CO/0404288) but it probably goes back to Koike and Terada or maybe even Littlewood.  It is equation (4.1)+(4.5) for the orthogonal and (4.1)+(4.4) for the symplectic in my paper.",
    "created_at": "2015-10-06T13:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196585",
    "user": "https://github.com/zabrocki"
}
```

What I said in my last comment isn't quite right.  It is in my paper with Mark Shimozono "Deformed universal characters for classical and affine algebras, Journal of Algebra, 299 (2006), pp. 33-61" (arXiv:math.CO/0404288) but it probably goes back to Koike and Terada or maybe even Littlewood.  It is equation (4.1)+(4.5) for the orthogonal and (4.1)+(4.4) for the symplectic in my paper.



---

archive/issue_comments_196586.json:
```json
{
    "body": "I'm sorry, but I can't compile anything new right now so I am afraid to push anything.  I can write functions on a working version of sage and I am pretty sure the following is right (following the model of `_s_to_o_on_basis`):\n\n```\n    def _o_to_s_on_basis(self, lam):\n        import sage.libs.lrcalc.lrcalc as lrcalc\n        from sage.combinat.partition import Partitions\n        R = self.base_ring()\n        return self._from_dict({ mu: R.sum(\n            (-1)**j*lrcalc.lrcoef_unsafe(lam, mu, nu)\n            for nu in Partitions(2*j)\n              if all(nu.arm_length(i,i)==nu.leg_length(i,i)+1\n                for i in range(nu.frobenius_rank())) )\n            for j in range(sum(lam)//2+1)\n            for mu in Partitions(sum(lam)-2*j) })\n```\nMoreover, if you switch `arm` and `leg` then that is the `_sp_to_s_on_basis`.\n\nYour `_s_to_o_on_basis` has lots of extra looping going on that is not necessary.  Because `|lam|==|mu|+|nu|` you can remove one sum.  Because `nu` has to be an even partition, you don't need to run over `j` odd.  Here is a suggested modification:\n\n```\ndef _s_to_o_on_basis(self, lam):\n    import sage.libs.lrcalc.lrcalc as lrcalc\n    from sage.combinat.partition import Partitions\n    R = self.base_ring()\n    return self._from_dict({ mu: R.sum( lrcalc.lrcoef_unsafe(lam, mu, nu)\n                                 for nu in Partitions(2*j)\n                                     if all(x % 2 == 0 for x in nu))\n                                 for j in range(sum(lam)//2+1)\n                                 for mu in Partitions(sum(lam)-2*j) })\n```",
    "created_at": "2015-10-06T17:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196586",
    "user": "https://github.com/zabrocki"
}
```

I'm sorry, but I can't compile anything new right now so I am afraid to push anything.  I can write functions on a working version of sage and I am pretty sure the following is right (following the model of `_s_to_o_on_basis`):

```
    def _o_to_s_on_basis(self, lam):
        import sage.libs.lrcalc.lrcalc as lrcalc
        from sage.combinat.partition import Partitions
        R = self.base_ring()
        return self._from_dict({ mu: R.sum(
            (-1)**j*lrcalc.lrcoef_unsafe(lam, mu, nu)
            for nu in Partitions(2*j)
              if all(nu.arm_length(i,i)==nu.leg_length(i,i)+1
                for i in range(nu.frobenius_rank())) )
            for j in range(sum(lam)//2+1)
            for mu in Partitions(sum(lam)-2*j) })
```
Moreover, if you switch `arm` and `leg` then that is the `_sp_to_s_on_basis`.

Your `_s_to_o_on_basis` has lots of extra looping going on that is not necessary.  Because `|lam|==|mu|+|nu|` you can remove one sum.  Because `nu` has to be an even partition, you don't need to run over `j` odd.  Here is a suggested modification:

```
def _s_to_o_on_basis(self, lam):
    import sage.libs.lrcalc.lrcalc as lrcalc
    from sage.combinat.partition import Partitions
    R = self.base_ring()
    return self._from_dict({ mu: R.sum( lrcalc.lrcoef_unsafe(lam, mu, nu)
                                 for nu in Partitions(2*j)
                                     if all(x % 2 == 0 for x in nu))
                                 for j in range(sum(lam)//2+1)
                                 for mu in Partitions(sum(lam)-2*j) })
```



---

archive/issue_comments_196587.json:
```json
{
    "body": "I just thought about it and it would probably be better in `_s_to_o_on_basis` to loop over partitions of `j` and double the lengths of the parts of the partition.",
    "created_at": "2015-10-06T17:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196587",
    "user": "https://github.com/zabrocki"
}
```

I just thought about it and it would probably be better in `_s_to_o_on_basis` to loop over partitions of `j` and double the lengths of the parts of the partition.



---

archive/issue_comments_196588.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-06T20:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196589.json:
```json
{
    "body": "Thank you for those suggestions Mike. I implemented all of them, and they resulted in orders of magnitude speedups (including the inverse basis transformations).",
    "created_at": "2015-10-06T20:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196589",
    "user": "https://github.com/tscrim"
}
```

Thank you for those suggestions Mike. I implemented all of them, and they resulted in orders of magnitude speedups (including the inverse basis transformations).



---

archive/issue_comments_196590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-06T20:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196591.json:
```json
{
    "body": "At some point in the future, we should implement the single box version and the Hall-Littlewood analogs given in your paper with Mark.",
    "created_at": "2015-10-06T20:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196591",
    "user": "https://github.com/tscrim"
}
```

At some point in the future, we should implement the single box version and the Hall-Littlewood analogs given in your paper with Mark.



---

archive/issue_comments_196592.json:
```json
{
    "body": "Here is an important question to resolve we can set to positive review.  Is the following right?\n\n```\nsage: s(o.an_element().homogeneous_component(0))\n2*s[]\nsage: s(o.an_element()).homogeneous_component(0)\n-s[]\n```\nI think the answer is no but I don't want to change it before I get full opinions.  I think that we should look carefully to see if there other methods that are also filter dependent.",
    "created_at": "2015-10-08T11:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196592",
    "user": "https://github.com/zabrocki"
}
```

Here is an important question to resolve we can set to positive review.  Is the following right?

```
sage: s(o.an_element().homogeneous_component(0))
2*s[]
sage: s(o.an_element()).homogeneous_component(0)
-s[]
```
I think the answer is no but I don't want to change it before I get full opinions.  I think that we should look carefully to see if there other methods that are also filter dependent.



---

archive/issue_comments_196593.json:
```json
{
    "body": "Lets look carefully:\n\n```\nsage: o[2].is_homogeneous()\nTrue\nsage: s(o[2]).is_homogeneous()\nFalse\nsage: o.an_element().degree_zero_coefficient()\n2\nsage: s(o.an_element()).degree_zero_coefficient()\n-1\n```\n`degree_negation` seems to work fine but that is special for these bases (and would not say work for the odd-symplectic basis or irreducible S_n character basis).  It would be better if on filtered bases that these methods were done by coercion.",
    "created_at": "2015-10-08T12:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196593",
    "user": "https://github.com/zabrocki"
}
```

Lets look carefully:

```
sage: o[2].is_homogeneous()
True
sage: s(o[2]).is_homogeneous()
False
sage: o.an_element().degree_zero_coefficient()
2
sage: s(o.an_element()).degree_zero_coefficient()
-1
```
`degree_negation` seems to work fine but that is special for these bases (and would not say work for the odd-symplectic basis or irreducible S_n character basis).  It would be better if on filtered bases that these methods were done by coercion.



---

archive/issue_comments_196594.json:
```json
{
    "body": "I would say that is okay because the COB morphism is as filtered algebras, so we can't expect homogeneous components to go to homogeneous components. However this should still work for top-degree homogeneous components.\n\nSo do you want me to do some surgery on the category of Sym bases and make 2 basis categories, one for the filtered and one for the graded? We could then have some generic code for the filtered that uses coercion for those methods that implicitly rely on the basis being graded.",
    "created_at": "2015-10-08T15:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196594",
    "user": "https://github.com/tscrim"
}
```

I would say that is okay because the COB morphism is as filtered algebras, so we can't expect homogeneous components to go to homogeneous components. However this should still work for top-degree homogeneous components.

So do you want me to do some surgery on the category of Sym bases and make 2 basis categories, one for the filtered and one for the graded? We could then have some generic code for the filtered that uses coercion for those methods that implicitly rely on the basis being graded.



---

archive/issue_comments_196595.json:
```json
{
    "body": "To me, the degree of the symmetric function is well defined, even if the basis is filtered.  Degree is what we use on the classical symmetric function bases (not the size of the indexing partition...that is different).  That means homogeneous component, degree and counit are not computed by the size of the indexing partition.\n\nI think that it would be a good idea to factor out those and have two basis categories as you suggest.",
    "created_at": "2015-10-08T17:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196595",
    "user": "https://github.com/zabrocki"
}
```

To me, the degree of the symmetric function is well defined, even if the basis is filtered.  Degree is what we use on the classical symmetric function bases (not the size of the indexing partition...that is different).  That means homogeneous component, degree and counit are not computed by the size of the indexing partition.

I think that it would be a good idea to factor out those and have two basis categories as you suggest.



---

archive/issue_comments_196596.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-08T17:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196597.json:
```json
{
    "body": "Okay, I've done some reworking of things at the category level, including adding a `counit_by_coercion` for realizations.\n\nHowever I get MRO issues when dealing with the finite fields that I don't know how to deal with. I've convinced myself that the categories are almost correct; I want to make this change\n\n```diff\n         cat = HopfAlgebras(self.base().base_ring())\n         return [self.base().Realizations(),\n                 cat.Commutative().WithBasis(),\n-                cat.Graded().Realizations()]\n+                cat.Commutative().Graded().Realizations()]\n```\nBut if I do that, I get `KeyError: (225536, 70)` from the c3 controlled!\n\nSo I don't know what to do at this point. Nicolas, Simon, do you have any ideas?\n\n---\nNew commits:",
    "created_at": "2015-10-09T02:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196597",
    "user": "https://github.com/tscrim"
}
```

Okay, I've done some reworking of things at the category level, including adding a `counit_by_coercion` for realizations.

However I get MRO issues when dealing with the finite fields that I don't know how to deal with. I've convinced myself that the categories are almost correct; I want to make this change

```diff
         cat = HopfAlgebras(self.base().base_ring())
         return [self.base().Realizations(),
                 cat.Commutative().WithBasis(),
-                cat.Graded().Realizations()]
+                cat.Commutative().Graded().Realizations()]
```
But if I do that, I get `KeyError: (225536, 70)` from the c3 controlled!

So I don't know what to do at this point. Nicolas, Simon, do you have any ideas?

---
New commits:



---

archive/issue_comments_196598.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-10-09T02:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196598",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_196599.json:
```json
{
    "body": "Could this be related to the error in #11979 ?\n\nAlso, a trifle:\n\n```\n+class FilteredSymmetricFunctionsBases(Category_realization_of_parent):\n+    r\"\"\"\n+    The category of graded bases of the ring of symmetric functions.\n```\ns/graded/filtered/\n\n(Thanks for fixing the categorical hack that made filtered bases pretend to be graded -- IIRC that was the reason why I was skeptical about this ticket!)",
    "created_at": "2015-10-09T03:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196599",
    "user": "https://github.com/darijgr"
}
```

Could this be related to the error in #11979 ?

Also, a trifle:

```
+class FilteredSymmetricFunctionsBases(Category_realization_of_parent):
+    r"""
+    The category of graded bases of the ring of symmetric functions.
```
s/graded/filtered/

(Thanks for fixing the categorical hack that made filtered bases pretend to be graded -- IIRC that was the reason why I was skeptical about this ticket!)



---

archive/issue_comments_196600.json:
```json
{
    "body": "Yes, I would say so, and also on #15475. The most annoying thing is that it works for NCSF! However the reason why I can't add the commutative is something I have no understanding of what fails.",
    "created_at": "2015-10-09T03:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196600",
    "user": "https://github.com/tscrim"
}
```

Yes, I would say so, and also on #15475. The most annoying thing is that it works for NCSF! However the reason why I can't add the commutative is something I have no understanding of what fails.



---

archive/issue_comments_196601.json:
```json
{
    "body": "To be clear, I'm finding when testing the file `sfa.py` there are errors\n\n```\n    s = SymmetricFunctions(FiniteField(29)).s()\nException raised:\n    Traceback (most recent call last):\n...\n    TypeError: Cannot create a consistent method resolution\n    order (MRO) for bases GradedAlgebras.subcategory_class, CommutativeAlgebras.subcategory_class, Bialgebras.subcategory_class\n```\nAre you able to trigger them outside of the testing environment?  When I enter them by hand they work fine.",
    "created_at": "2015-10-09T11:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196601",
    "user": "https://github.com/zabrocki"
}
```

To be clear, I'm finding when testing the file `sfa.py` there are errors

```
    s = SymmetricFunctions(FiniteField(29)).s()
Exception raised:
    Traceback (most recent call last):
...
    TypeError: Cannot create a consistent method resolution
    order (MRO) for bases GradedAlgebras.subcategory_class, CommutativeAlgebras.subcategory_class, Bialgebras.subcategory_class
```
Are you able to trigger them outside of the testing environment?  When I enter them by hand they work fine.



---

archive/issue_comments_196602.json:
```json
{
    "body": "Yes, those are the errors I get when doctesting `sfa.py`.\n\nYou have to do (in a fresh startup of Sage):\n\n```\nsage: SymmetricFunctions(Integers(23))\nsage: SymmetricFunctions(FiniteField(23))\n```\nIt also fails if you do it in the other order as well.",
    "created_at": "2015-10-09T11:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196602",
    "user": "https://github.com/tscrim"
}
```

Yes, those are the errors I get when doctesting `sfa.py`.

You have to do (in a fresh startup of Sage):

```
sage: SymmetricFunctions(Integers(23))
sage: SymmetricFunctions(FiniteField(23))
```
It also fails if you do it in the other order as well.



---

archive/issue_comments_196603.json:
```json
{
    "body": "Hi!\n\nCould it be that we are mixing categories parametrized by a base ring, and categories parametrized by the category that base ring? Something like ``HopfAlgebras(Fields()).XXX()`` and ``Bialgebras(GF(3)).YYY()`` ?",
    "created_at": "2015-10-12T12:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196603",
    "user": "https://github.com/nthiery"
}
```

Hi!

Could it be that we are mixing categories parametrized by a base ring, and categories parametrized by the category that base ring? Something like ``HopfAlgebras(Fields()).XXX()`` and ``Bialgebras(GF(3)).YYY()`` ?



---

archive/issue_comments_196604.json:
```json
{
    "body": "Replying to [comment:41 nthiery]:\n> Could it be that we are mixing categories parametrized by a base ring, and categories parametrized by the category that base ring? Something like `HopfAlgebras(Fields()).XXX()` and `Bialgebras(GF(3)).YYY()` ?\n\n\nAFAIK we aren't mixing things like that. This is that wonderful category refinement issue that somehow was somehow magically working beforehand, but I think that was because the categories for the bases weren't quite correct.",
    "created_at": "2015-10-12T15:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196604",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:41 nthiery]:
> Could it be that we are mixing categories parametrized by a base ring, and categories parametrized by the category that base ring? Something like `HopfAlgebras(Fields()).XXX()` and `Bialgebras(GF(3)).YYY()` ?


AFAIK we aren't mixing things like that. This is that wonderful category refinement issue that somehow was somehow magically working beforehand, but I think that was because the categories for the bases weren't quite correct.



---

archive/issue_comments_196605.json:
```json
{
    "body": "I wonder if the problem stems from this line in `__classcall_private__` of `Modules`:\n\n```\nif base_ring in _Fields or (isinstance(base_ring, Category)\n                            and base_ring.is_subcategory(_Fields)):\n```\nor this line in `extra_super_categories` of `FilteredAlgebras`:\n\n```\nif base_ring in Fields:\n```\nand that one/both of these triggers the category refinement and breaks the MRO, which was in the process of being constructed when these were called.\n\n```\nsage: R = Integers(7)\nsage: R.category()\nJoin of Category of finite commutative rings and Category of subquotients of monoids and Category of quotients of semigroups and Category of finite enumerated sets\nsage: HopfAlgebras(R)\nCategory of hopf algebras over Ring of integers modulo 7\nsage: R.category()\nJoin of Category of finite fields and Category of subquotients of monoids and Category of quotients of semigroups\n```\nYet this still doesn't explain why this works for NCSF. I think that might be a key in figuring out what is going wrong.",
    "created_at": "2015-10-22T03:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196605",
    "user": "https://github.com/tscrim"
}
```

I wonder if the problem stems from this line in `__classcall_private__` of `Modules`:

```
if base_ring in _Fields or (isinstance(base_ring, Category)
                            and base_ring.is_subcategory(_Fields)):
```
or this line in `extra_super_categories` of `FilteredAlgebras`:

```
if base_ring in Fields:
```
and that one/both of these triggers the category refinement and breaks the MRO, which was in the process of being constructed when these were called.

```
sage: R = Integers(7)
sage: R.category()
Join of Category of finite commutative rings and Category of subquotients of monoids and Category of quotients of semigroups and Category of finite enumerated sets
sage: HopfAlgebras(R)
Category of hopf algebras over Ring of integers modulo 7
sage: R.category()
Join of Category of finite fields and Category of subquotients of monoids and Category of quotients of semigroups
```
Yet this still doesn't explain why this works for NCSF. I think that might be a key in figuring out what is going wrong.



---

archive/issue_comments_196606.json:
```json
{
    "body": "You could be on to something here.  If I delete the following lines:\n\n```\n-        if dispatch:\n-            if base_ring in _Fields or (isinstance(base_ring, Category)\n-                                        and base_ring.is_subcategory(_Fields)):\n-                from vector_spaces import VectorSpaces\n-                return VectorSpaces(base_ring, check=False)\n```\nI find that your example in comment 40 does not raise an error.",
    "created_at": "2015-10-22T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196606",
    "user": "https://github.com/zabrocki"
}
```

You could be on to something here.  If I delete the following lines:

```
-        if dispatch:
-            if base_ring in _Fields or (isinstance(base_ring, Category)
-                                        and base_ring.is_subcategory(_Fields)):
-                from vector_spaces import VectorSpaces
-                return VectorSpaces(base_ring, check=False)
```
I find that your example in comment 40 does not raise an error.



---

archive/issue_comments_196607.json:
```json
{
    "body": "However, I don't think that is the right solution. `:/` The check is reasonable and necessary.\n\nGranted, my current proposal is a major hack, but I don't think too many people will be creating many instances of Sym over various large finite fields (and there are more computationally intensive parts necessary for working with Sym). I'm tired of trying to deal with this here, so I just checked if the base ring was a field before any categories get created.\n\nThere is also another issue with C3 in that I get a `KeyError` if I make this change:\n\n```diff\n         cat = HopfAlgebras(self.base().base_ring())\n         return [self.base().Realizations(),\n                 cat.Commutative().WithBasis(),\n-                cat.Graded().Realizations()]\n+                cat.Commutative().Graded().Realizations()]\n```\nThis is what it should be, but because everything commutative will come from the `cat.Commutative().WithBasis()`, I think we are okay for now.\n\nI really would like to push this ticket in and later reach in and fix the category-refinement/MRO/C3 issues on a separate ticket.\n\n---\nNew commits:",
    "created_at": "2015-10-26T14:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196607",
    "user": "https://github.com/tscrim"
}
```

However, I don't think that is the right solution. `:/` The check is reasonable and necessary.

Granted, my current proposal is a major hack, but I don't think too many people will be creating many instances of Sym over various large finite fields (and there are more computationally intensive parts necessary for working with Sym). I'm tired of trying to deal with this here, so I just checked if the base ring was a field before any categories get created.

There is also another issue with C3 in that I get a `KeyError` if I make this change:

```diff
         cat = HopfAlgebras(self.base().base_ring())
         return [self.base().Realizations(),
                 cat.Commutative().WithBasis(),
-                cat.Graded().Realizations()]
+                cat.Commutative().Graded().Realizations()]
```
This is what it should be, but because everything commutative will come from the `cat.Commutative().WithBasis()`, I think we are okay for now.

I really would like to push this ticket in and later reach in and fix the category-refinement/MRO/C3 issues on a separate ticket.

---
New commits:



---

archive/issue_comments_196608.json:
```json
{
    "body": "I should also mention that there are other places where category refinement would make sense, such as for finite-dimensional algebras after doing an `is_commutative` or `is_unital` test, so IMO it could be useful beyond prime testing for finite fields.",
    "created_at": "2015-10-26T14:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196608",
    "user": "https://github.com/tscrim"
}
```

I should also mention that there are other places where category refinement would make sense, such as for finite-dimensional algebras after doing an `is_commutative` or `is_unital` test, so IMO it could be useful beyond prime testing for finite fields.



---

archive/issue_comments_196609.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-10-26T14:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196609",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_196610.json:
```json
{
    "body": "What does the line \"R in Fields()\" do?  It looks to me like it returns True or False and goes on to the next line.",
    "created_at": "2015-10-26T20:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196610",
    "user": "https://github.com/zabrocki"
}
```

What does the line "R in Fields()" do?  It looks to me like it returns True or False and goes on to the next line.



---

archive/issue_comments_196611.json:
```json
{
    "body": "It makes sure that `R` has had its category refined (if it needs to). Thus this is not done in the process of building the MRO/category heirarchy for `Sym`.",
    "created_at": "2015-10-26T21:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196611",
    "user": "https://github.com/tscrim"
}
```

It makes sure that `R` has had its category refined (if it needs to). Thus this is not done in the process of building the MRO/category heirarchy for `Sym`.



---

archive/issue_comments_196612.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-27T00:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196612",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_196613.json:
```json
{
    "body": "I don't think that this is a bad way of resolving this, but it may be pushing the problem elsewhere.  I am seeing:\n\n```\nFile \"combinat/ncsf_qsym/qsym.py\", line 1873, in sage.combinat.ncsf_qsym.qsym.QuasiSymmetricFunctions.Monomial.lambda_of_monomial\nFailed example:\n    M = QuasiSymmetricFunctions(Integers(5)).Monomial()\n```\n\nAre ncsf/qsym going to require the same hack?  Will every combinatorial Hopf algebra require it?",
    "created_at": "2015-10-27T00:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196613",
    "user": "https://github.com/zabrocki"
}
```

I don't think that this is a bad way of resolving this, but it may be pushing the problem elsewhere.  I am seeing:

```
File "combinat/ncsf_qsym/qsym.py", line 1873, in sage.combinat.ncsf_qsym.qsym.QuasiSymmetricFunctions.Monomial.lambda_of_monomial
Failed example:
    M = QuasiSymmetricFunctions(Integers(5)).Monomial()
```

Are ncsf/qsym going to require the same hack?  Will every combinatorial Hopf algebra require it?



---

archive/issue_comments_196614.json:
```json
{
    "body": "I've not been getting those errors, but Volker just posted on #19397 an issue that smells like the same thing. So right now I'm thinking, \"*!`@`$, we have to deal with this now\". `:/` Nicolas, Simon, I will need you two to get involved now I think.",
    "created_at": "2015-10-27T03:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196614",
    "user": "https://github.com/tscrim"
}
```

I've not been getting those errors, but Volker just posted on #19397 an issue that smells like the same thing. So right now I'm thinking, "*!`@`$, we have to deal with this now". `:/` Nicolas, Simon, I will need you two to get involved now I think.



---

archive/issue_comments_196615.json:
```json
{
    "body": "One strange feature is that the error that you post in comment 40 is triggered on QSym and NCSymD but not on NCSF or NCSym (at least on my computer).  That is,\n\n```\nsage: NCSymD = SymmetricFunctionsNonCommutingVariablesDual(FiniteField(23))\nsage: NCSymD = SymmetricFunctionsNonCommutingVariablesDual(Integers(23))\n```\ntriggers an error but\n\n```\nsage: NCSym = SymmetricFunctionsNonCommutingVariables(FiniteField(23))\nsage: NCSym = SymmetricFunctionsNonCommutingVariables(Integers(23))\n```\ndoes not.",
    "created_at": "2015-10-27T11:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196615",
    "user": "https://github.com/zabrocki"
}
```

One strange feature is that the error that you post in comment 40 is triggered on QSym and NCSymD but not on NCSF or NCSym (at least on my computer).  That is,

```
sage: NCSymD = SymmetricFunctionsNonCommutingVariablesDual(FiniteField(23))
sage: NCSymD = SymmetricFunctionsNonCommutingVariablesDual(Integers(23))
```
triggers an error but

```
sage: NCSym = SymmetricFunctionsNonCommutingVariables(FiniteField(23))
sage: NCSym = SymmetricFunctionsNonCommutingVariables(Integers(23))
```
does not.



---

archive/issue_comments_196616.json:
```json
{
    "body": "The `NCSymD` is caused by this part of the `__init__`:\n\n```\n        Sym = SymmetricFunctions(self.base_ring())\n        Sym_h_to_w = Sym.h().module_morphism(w.sum_of_partitions,\n                                             triangular='lower',\n                                             inverse_on_support=w._set_par_to_par,\n                                             codomain=w, category=category)\n```\nAh...`QSym` fails for the same reason...\n\nI think they all will need this hack for now. I know this is pushing the problem further down, but I don't know of a way to resolve it at present (or at least without forcing a prime check for finite rings).\n\nAlthough there is the issue on comment:45 that is likely unrelated and needs a fix at some point too... I think there might be some issue(s) with join categories...\n\nI also have been working on #19397 under the assumption that these are the same problem. However I am pretty sure this is not the case now and they are different problems (I would love to be wrong).",
    "created_at": "2015-10-31T17:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196616",
    "user": "https://github.com/tscrim"
}
```

The `NCSymD` is caused by this part of the `__init__`:

```
        Sym = SymmetricFunctions(self.base_ring())
        Sym_h_to_w = Sym.h().module_morphism(w.sum_of_partitions,
                                             triangular='lower',
                                             inverse_on_support=w._set_par_to_par,
                                             codomain=w, category=category)
```
Ah...`QSym` fails for the same reason...

I think they all will need this hack for now. I know this is pushing the problem further down, but I don't know of a way to resolve it at present (or at least without forcing a prime check for finite rings).

Although there is the issue on comment:45 that is likely unrelated and needs a fix at some point too... I think there might be some issue(s) with join categories...

I also have been working on #19397 under the assumption that these are the same problem. However I am pretty sure this is not the case now and they are different problems (I would love to be wrong).



---

archive/issue_comments_196617.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-02T01:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196617",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196618.json:
```json
{
    "body": "I agree.  In the end this is a minor change as a hack.  It doesn't locate the problem, but it does fix it from being triggered.  I've pushed some changes which add doctests and replaced `assert(R in Rings())` with `assert(R in Fields() or R in Rings())` in in the `__init__` method for all of these Hopf algebras.  I'll get back to Jean-Baptist's Hopf algebra implementations after we resolve these issues and see if his code can be used to get around these problem.",
    "created_at": "2015-11-02T01:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196618",
    "user": "https://github.com/zabrocki"
}
```

I agree.  In the end this is a minor change as a hack.  It doesn't locate the problem, but it does fix it from being triggered.  I've pushed some changes which add doctests and replaced `assert(R in Rings())` with `assert(R in Fields() or R in Rings())` in in the `__init__` method for all of these Hopf algebras.  I'll get back to Jean-Baptist's Hopf algebra implementations after we resolve these issues and see if his code can be used to get around these problem.



---

archive/issue_comments_196619.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-02T02:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196619",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196620.json:
```json
{
    "body": "I'm okay with things. So let's just leave this hack in there since it works for now. It is also documented for testing later on. Therefore I think we are back to needs review.",
    "created_at": "2015-11-02T02:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196620",
    "user": "https://github.com/tscrim"
}
```

I'm okay with things. So let's just leave this hack in there since it works for now. It is also documented for testing later on. Therefore I think we are back to needs review.



---

archive/issue_comments_196621.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-02T02:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196621",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_196622.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-02T12:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196622",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_196623.json:
```json
{
    "body": "I think it looks good and all tests pass.  Positive review.",
    "created_at": "2015-11-02T12:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196623",
    "user": "https://github.com/zabrocki"
}
```

I think it looks good and all tests pass.  Positive review.



---

archive/issue_comments_196624.json:
```json
{
    "body": "Thanks Mike!",
    "created_at": "2015-11-02T14:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196624",
    "user": "https://github.com/tscrim"
}
```

Thanks Mike!



---

archive/issue_events_045415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-03T23:59:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15299#event-45415"
}
```



---

archive/issue_comments_196625.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-03T23:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15299#issuecomment-196625",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
