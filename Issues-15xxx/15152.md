# Issue 15152: Sage interpreter blocks Tkinter GUI

archive/issues_014915.json:
```json
{
    "body": "IPython allows running Tkinter (and many other GUI toolkits) so that the GUI doesn't block the IPython interpreter.  In Sage 5.10 and earlier this worked in Sage's interpreter as well as vanilla IPython.  However, in Sage 5.11 it only works in vanilla IPython.  A minimal example (for both Linux and OS X) is:\n\n```\nsage: import Tkinter\nsage: root = Tkinter.Tk()\n```\n\nPre version 5.11, this brings up a small window titled \"tk\"; in Sage 5.11 it does nothing.  In 5.11 you can manually start the Tk gui via:\n\n```\nsage: root.mainloop()\n```\n\nbut you don't get a new interpreter prompt until you quit the Tk GUI.  \n\nI strongly suspect the issue is the new IPython inputhook (in \"sage/misc/inputhook.pyx\") that was added in Sage 5.11 as part of #14523.\n\n\nCC:  @unhyperbolic @culler @jdemeyer @jhpalmieri @nexttime @mstreng @nbruin @seblabbe @tscrim @vbraun\n\nKeywords: days74\n\nBranch/Commit: 06e7dbf62c21a536ac1b5b034f7c9e30e170b655\n\nReviewer: Vincent Delecroix, Nathan Dunfield\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15152\n\n",
    "closed_at": "2016-06-26T07:30:21Z",
    "created_at": "2013-09-03T23:54:53Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Sage interpreter blocks Tkinter GUI",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15152",
    "user": "https://github.com/NathanDunfield"
}
```
IPython allows running Tkinter (and many other GUI toolkits) so that the GUI doesn't block the IPython interpreter.  In Sage 5.10 and earlier this worked in Sage's interpreter as well as vanilla IPython.  However, in Sage 5.11 it only works in vanilla IPython.  A minimal example (for both Linux and OS X) is:

```
sage: import Tkinter
sage: root = Tkinter.Tk()
```

Pre version 5.11, this brings up a small window titled "tk"; in Sage 5.11 it does nothing.  In 5.11 you can manually start the Tk gui via:

```
sage: root.mainloop()
```

but you don't get a new interpreter prompt until you quit the Tk GUI.  

I strongly suspect the issue is the new IPython inputhook (in "sage/misc/inputhook.pyx") that was added in Sage 5.11 as part of #14523.


CC:  @unhyperbolic @culler @jdemeyer @jhpalmieri @nexttime @mstreng @nbruin @seblabbe @tscrim @vbraun

Keywords: days74

Branch/Commit: 06e7dbf62c21a536ac1b5b034f7c9e30e170b655

Reviewer: Vincent Delecroix, Nathan Dunfield

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15152





---

archive/issue_comments_235918.json:
```json
{
    "body": "<a id='comment:1'></a>\nI should have mentioned the following work-around in my initial report: \n\n```\nsage: %gui none\n```\nor what is essentially equivalently \n\n```\nsage: import IPython.lib.inputhook as ih\nsage: ih.clear_inputhook()\n```\nThis is why I think the new inputhook is the source of the change in behavior.",
    "created_at": "2013-09-04T00:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235918",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:1'></a>
I should have mentioned the following work-around in my initial report: 

```
sage: %gui none
```
or what is essentially equivalently 

```
sage: import IPython.lib.inputhook as ih
sage: ih.clear_inputhook()
```
This is why I think the new inputhook is the source of the change in behavior.



---

archive/issue_events_057809.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57809"
}
```



---

archive/issue_events_057810.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57810"
}
```



---

archive/issue_events_057811.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57811"
}
```



---

archive/issue_events_057812.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57812"
}
```



---

archive/issue_events_057813.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57813"
}
```



---

archive/issue_comments_235919.json:
```json
{
    "body": "<a id='comment:5'></a>\nCc-ing people from #14523.",
    "created_at": "2016-05-30T10:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235919",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>
Cc-ing people from #14523.



---

archive/issue_comments_235920.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/sage_interpreter_blocks_tkinter_gui\"",
    "created_at": "2016-05-30T15:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235920",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/sage_interpreter_blocks_tkinter_gui"



---

archive/issue_comments_235921.json:
```json
{
    "body": "Changing keywords from \"\" to \"days74\".",
    "created_at": "2016-05-30T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235921",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "days74".



---

archive/issue_comments_235922.json:
```json
{
    "body": "Changing commit from \"\" to \"fb2a1f9e6d73dfee69ff14eaf397de657b646d3a\"",
    "created_at": "2016-05-30T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235922",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "fb2a1f9e6d73dfee69ff14eaf397de657b646d3a"



---

archive/issue_comments_235923.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-30T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235923",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235924.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe branch installs the input hook only while files are attached. Hence tkinter can grab it iff you don't have files attached.",
    "created_at": "2016-05-30T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235924",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
The branch installs the input hook only while files are attached. Hence tkinter can grab it iff you don't have files attached.



---

archive/issue_comments_235925.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[2f375c7](https://github.com/sagemath/sagetrac-mirror/commit/2f375c76580bdd5a66faef9e46f32fee2b492684)|`Add doctest`|",
    "created_at": "2016-05-30T16:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235925",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[2f375c7](https://github.com/sagemath/sagetrac-mirror/commit/2f375c76580bdd5a66faef9e46f32fee2b492684)|`Add doctest`|



---

archive/issue_comments_235926.json:
```json
{
    "body": "Changing commit from \"fb2a1f9e6d73dfee69ff14eaf397de657b646d3a\" to \"2f375c76580bdd5a66faef9e46f32fee2b492684\"",
    "created_at": "2016-05-30T16:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fb2a1f9e6d73dfee69ff14eaf397de657b646d3a" to "2f375c76580bdd5a66faef9e46f32fee2b492684"



---

archive/issue_comments_235927.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2016-05-31T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235927",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_235928.json:
```json
{
    "body": "<a id='comment:9'></a>\nNice! I guess there should be an explicit warning in the documentation of \"attach\".",
    "created_at": "2016-05-31T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235928",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
Nice! I guess there should be an explicit warning in the documentation of "attach".



---

archive/issue_comments_235929.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2016-05-31T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235929",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_235930.json:
```json
{
    "body": "<a id='comment:10'></a>\nI tried out this patch on OS X and everything worked as intended.  Should I set the status to \"positive review\" or does some documentation need to be added first as Vincent suggests?",
    "created_at": "2016-06-14T19:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235930",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:10'></a>
I tried out this patch on OS X and everything worked as intended.  Should I set the status to "positive review" or does some documentation need to be added first as Vincent suggests?



---

archive/issue_comments_235931.json:
```json
{
    "body": "Changing reviewer from \"Vincent Delecroix\" to \"Vincent Delecroix, Nathan Dunfield\"",
    "created_at": "2016-06-14T19:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235931",
    "user": "https://github.com/NathanDunfield"
}
```

Changing reviewer from "Vincent Delecroix" to "Vincent Delecroix, Nathan Dunfield"



---

archive/issue_comments_235932.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-24T07:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235932",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057814.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-24T07:49:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57814"
}
```



---

archive/issue_events_057815.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-24T07:49:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57815"
}
```



---

archive/issue_comments_235933.json:
```json
{
    "body": "<a id='comment:11'></a>\nWould be better with doc but more importantly this should be in Sage asap.",
    "created_at": "2016-06-24T07:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235933",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Would be better with doc but more importantly this should be in Sage asap.



---

archive/issue_comments_235934.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vdelecroix](#comment%3A11):\n> Would be better with doc but more importantly this should be in Sage asap.\n\n\nAgreed.",
    "created_at": "2016-06-25T02:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235934",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:12'></a>
Replying to [vdelecroix](#comment%3A11):
> Would be better with doc but more importantly this should be in Sage asap.


Agreed.



---

archive/issue_comments_235935.json:
```json
{
    "body": "<a id='comment:13'></a>\nI get \n\n```\nError building the documentation.\nTraceback (most recent call last):\n  File \"sage_setup/docbuild/__main__.py\", line 2, in <module>\n    main()\n  File \"/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py\", line 1629, in main\n    builder()\n  File \"/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py\", line 284, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py\", line 495, in _wrapper\n    x.get(99999)\n  File \"/usr/lib64/python2.7/multiprocessing/pool.py\", line 567, in get\n    raise self._value\nOSError: [repl     ] docstring of sage.repl.inputhook.is_installed:15: WARNING: Block quote ends without a blank line; unexpected unindent.\n```",
    "created_at": "2016-06-25T07:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235935",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
I get 

```
Error building the documentation.
Traceback (most recent call last):
  File "sage_setup/docbuild/__main__.py", line 2, in <module>
    main()
  File "/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py", line 1629, in main
    builder()
  File "/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py", line 284, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/__init__.py", line 495, in _wrapper
    x.get(99999)
  File "/usr/lib64/python2.7/multiprocessing/pool.py", line 567, in get
    raise self._value
OSError: [repl     ] docstring of sage.repl.inputhook.is_installed:15: WARNING: Block quote ends without a blank line; unexpected unindent.
```



---

archive/issue_comments_235936.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[3131a68](https://github.com/sagemath/sagetrac-mirror/commit/3131a68c618ddf5ec4ecae9c602b1509654f7ce3)|`Fix documentation build`|\n|[06e7dbf](https://github.com/sagemath/sagetrac-mirror/commit/06e7dbf62c21a536ac1b5b034f7c9e30e170b655)|`Add explanatory note`|",
    "created_at": "2016-06-25T08:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[3131a68](https://github.com/sagemath/sagetrac-mirror/commit/3131a68c618ddf5ec4ecae9c602b1509654f7ce3)|`Fix documentation build`|
|[06e7dbf](https://github.com/sagemath/sagetrac-mirror/commit/06e7dbf62c21a536ac1b5b034f7c9e30e170b655)|`Add explanatory note`|



---

archive/issue_comments_235937.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-06-25T08:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235937",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_235938.json:
```json
{
    "body": "Changing commit from \"2f375c76580bdd5a66faef9e46f32fee2b492684\" to \"06e7dbf62c21a536ac1b5b034f7c9e30e170b655\"",
    "created_at": "2016-06-25T08:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2f375c76580bdd5a66faef9e46f32fee2b492684" to "06e7dbf62c21a536ac1b5b034f7c9e30e170b655"



---

archive/issue_comments_235939.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, that fixed it. It looks like commenting on a ticket doesn't add you to cc automatically anymore...",
    "created_at": "2016-06-25T09:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235939",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Yes, that fixed it. It looks like commenting on a ticket doesn't add you to cc automatically anymore...



---

archive/issue_comments_235940.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-25T09:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235940",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235941.json:
```json
{
    "body": "Changing branch from \"u/vbraun/sage_interpreter_blocks_tkinter_gui\" to \"06e7dbf62c21a536ac1b5b034f7c9e30e170b655\"",
    "created_at": "2016-06-26T07:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235941",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/sage_interpreter_blocks_tkinter_gui" to "06e7dbf62c21a536ac1b5b034f7c9e30e170b655"



---

archive/issue_events_057816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-26T07:30:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15152#event-57816"
}
```



---

archive/issue_comments_235942.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-26T07:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15152#issuecomment-235942",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
