# Issue 15850: FiniteStateMachine: provide hook on_duplicate_transition

archive/issues_015613.json:
```json
{
    "body": "Previously, when inserting a transition which is already present, this\nwas simply ignored. By providing a hook `on_duplicate_transition`, user\ndefined behaviour is now possible. As examples, three functions are\nprovided (the default ignore, maintaining the previous behaviour;\nraise error or add input label). The latter may be used to model a\nMarkov chain where the input labels are interpreted als transition\nprobabilities.\n\n\nCC:  @dkrenn skropf @seblabbe\n\nKeywords: finite_state_machine\n\nReviewer: Daniel Krenn, Volker Braun\n\nAuthor: Clemens Heuberger, Daniel Krenn\n\nBranch: 12351e2a78fa8bf3b6487495499826eacdf9ebdb\n\nDependencies: #15841, #15847, #15848\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15850\n\n",
    "closed_at": "2014-04-04T18:52:27Z",
    "created_at": "2014-02-23T14:17:32Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "FiniteStateMachine: provide hook on_duplicate_transition",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15850",
    "user": "https://github.com/cheuberg"
}
```
Previously, when inserting a transition which is already present, this
was simply ignored. By providing a hook `on_duplicate_transition`, user
defined behaviour is now possible. As examples, three functions are
provided (the default ignore, maintaining the previous behaviour;
raise error or add input label). The latter may be used to model a
Markov chain where the input labels are interpreted als transition
probabilities.


CC:  @dkrenn skropf @seblabbe

Keywords: finite_state_machine

Reviewer: Daniel Krenn, Volker Braun

Author: Clemens Heuberger, Daniel Krenn

Branch: 12351e2a78fa8bf3b6487495499826eacdf9ebdb

Dependencies: #15841, #15847, #15848

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15850





---

archive/issue_comments_252787.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252787",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_252788.json:
```json
{
    "body": "Changing author from \"Clemens Heuberger\" to \"Clemens Heuberger, Daniel Krenn\"",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252788",
    "user": "https://github.com/cheuberg"
}
```

Changing author from "Clemens Heuberger" to "Clemens Heuberger, Daniel Krenn"



---

archive/issue_comments_252789.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#15841, #15847, #15848\"",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252789",
    "user": "https://github.com/cheuberg"
}
```

Changing dependencies from "" to "#15841, #15847, #15848"



---

archive/issue_comments_252790.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cheuberg/fsm/on_duplicate_transition\"",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252790",
    "user": "https://github.com/cheuberg"
}
```

Changing branch from "" to "u/cheuberg/fsm/on_duplicate_transition"



---

archive/issue_comments_252791.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,8 @@\n-When inserting a transition which is already present, this\n-is simply ignored. By providing a hook on_duplicate_transition, user\n-defined behaviour shall be made possible.\n+Previously, when inserting a transition which is already present, this\n+was simply ignored. By providing a hook `on_duplicate_transition`, user\n+defined behaviour is now possible. As examples, three functions are\n+provided (the default ignore, maintaining the previous behaviour;\n+raise error or add input label). The latter may be used to model a\n+Markov chain where the input labels are interpreted als transition\n+probabilities.\n \n-I am preparing a patch and will push it in a few days.\n``````\n",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252791",
    "user": "https://github.com/cheuberg"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,8 @@
-When inserting a transition which is already present, this
-is simply ignored. By providing a hook on_duplicate_transition, user
-defined behaviour shall be made possible.
+Previously, when inserting a transition which is already present, this
+was simply ignored. By providing a hook `on_duplicate_transition`, user
+defined behaviour is now possible. As examples, three functions are
+provided (the default ignore, maintaining the previous behaviour;
+raise error or add input label). The latter may be used to model a
+Markov chain where the input labels are interpreted als transition
+probabilities.
 
-I am preparing a patch and will push it in a few days.
``````




---

archive/issue_comments_252792.json:
```json
{
    "body": "Changing commit from \"\" to \"12351e2a78fa8bf3b6487495499826eacdf9ebdb\"",
    "created_at": "2014-03-17T14:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252792",
    "user": "https://github.com/cheuberg"
}
```

Changing commit from "" to "12351e2a78fa8bf3b6487495499826eacdf9ebdb"



---

archive/issue_comments_252793.json:
```json
{
    "body": "<a id='comment:2'></a>\nDuring the review: Made some small changes. Code itself looks fine, doctests pass, docu checked, coverage checked. For me this is a positive review, but it would be good if someone else could have a look on it.",
    "created_at": "2014-03-18T10:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252793",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>
During the review: Made some small changes. Code itself looks fine, doctests pass, docu checked, coverage checked. For me this is a positive review, but it would be good if someone else could have a look on it.



---

archive/issue_comments_252794.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Daniel Krenn\"",
    "created_at": "2014-03-18T10:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252794",
    "user": "https://github.com/dkrenn"
}
```

Changing reviewer from "" to "Daniel Krenn"



---

archive/issue_comments_252795.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn [#15078, comment 19](http://trac.sagemath.org/ticket/15078#comment:19), slabbe recommended having distinct classes `FiniteStateMachine`, `Transducer`, `Automaton`.\n\nTherefore, I think it to be appropriate to briefly explain why I used a hook in this instance instead of having a new class `MarkovChain`:\n\n- first, I think that it gives us more flexibility to customize the behaviour slightly\n- second, having a class `MarkovChain` would probably require us to check whether the sum of the input weights of the transitions leaving a state adds up to 1. This would be quite cumbersome and inefficient. This checking is dealt with in #15961 (depending on this ticket).",
    "created_at": "2014-03-18T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252795",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:3'></a>
In [#15078, comment 19](http://trac.sagemath.org/ticket/15078#comment:19), slabbe recommended having distinct classes `FiniteStateMachine`, `Transducer`, `Automaton`.

Therefore, I think it to be appropriate to briefly explain why I used a hook in this instance instead of having a new class `MarkovChain`:

- first, I think that it gives us more flexibility to customize the behaviour slightly
- second, having a class `MarkovChain` would probably require us to check whether the sum of the input weights of the transitions leaving a state adds up to 1. This would be quite cumbersome and inefficient. This checking is dealt with in #15961 (depending on this ticket).



---

archive/issue_comments_252796.json:
```json
{
    "body": "Changing reviewer from \"Daniel Krenn\" to \"Daniel Krenn, Volker Braun\"",
    "created_at": "2014-04-04T16:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252796",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "Daniel Krenn" to "Daniel Krenn, Volker Braun"



---

archive/issue_comments_252797.json:
```json
{
    "body": "<a id='comment:4'></a>\nWould be nicer to collect stuff into a class/module `duplicate_transaction.raise_error', maybe in the future.",
    "created_at": "2014-04-04T16:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252797",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Would be nicer to collect stuff into a class/module `duplicate_transaction.raise_error', maybe in the future.



---

archive/issue_comments_252798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-04T16:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252798",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_252799.json:
```json
{
    "body": "Changing branch from \"u/cheuberg/fsm/on_duplicate_transition\" to \"12351e2a78fa8bf3b6487495499826eacdf9ebdb\"",
    "created_at": "2014-04-04T18:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252799",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cheuberg/fsm/on_duplicate_transition" to "12351e2a78fa8bf3b6487495499826eacdf9ebdb"



---

archive/issue_events_060922.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-04T18:52:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15850#event-60922"
}
```



---

archive/issue_comments_252800.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-04T18:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252800",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_252801.json:
```json
{
    "body": "Changing commit from \"12351e2a78fa8bf3b6487495499826eacdf9ebdb\" to \"\"",
    "created_at": "2014-04-12T08:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252801",
    "user": "https://github.com/cheuberg"
}
```

Changing commit from "12351e2a78fa8bf3b6487495499826eacdf9ebdb" to ""



---

archive/issue_comments_252802.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [vbraun](#comment%3A4):\n> Would be nicer to collect stuff into a class/module `duplicate_transaction.raise_error', maybe in the future.\n\n\nSorry, I do not really understand your comment. What should be collected in `duplicate_transaction.raise_error`?",
    "created_at": "2014-04-12T08:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15850#issuecomment-252802",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:6'></a>
Replying to [vbraun](#comment%3A4):
> Would be nicer to collect stuff into a class/module `duplicate_transaction.raise_error', maybe in the future.


Sorry, I do not really understand your comment. What should be collected in `duplicate_transaction.raise_error`?
