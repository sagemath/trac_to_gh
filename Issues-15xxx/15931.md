# Issue 15931: Implement a proper hash function for (combinatorial) free module elements

archive/issues_015694.json:
```json
{
    "body": "Up to now, CombinatorialFreeModule elements used the (horrible)\ndefault implementation of `__hash__` provided by Element which uses the\nstring representation. This was slow! And further fragile! Indeed, the\nstring representation depends on a sorting of the support of the\nelements.  In #14102 we got bitten by this with elements whose support\nmixed int's, Integer's and string. The result of:\n\n```\n    sage: sorted([int(0), 'delta', 1])\n    [0, 1, 'delta']\n```\ndepends on the platform (that's ok) but also on which of 0 and 1 are\nint's or Integer, whereas the corresponding lists test as equal.\nThis led to equal element with distinct hash values.\n\nThis ticket adds an implementation of `__hash__` inspired from that\nproposed for frozendicts in PEP 0416. In particular this\nimplementation does not rely on sorting.\n\nSome timings:\n\n```\n    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n    sage: B = F.basis()\n    sage: f = B['a'] + 3*B['c']\n    sage: %timeit hash(f)                         # new hash function\n    100000 loops, best of 3: 3.57 \u00b5s per loop\n    sage: %timeit hash(f._repr_())                # equivalent to the previous one\n    10000 loops, best of 3: 85 \u00b5s per loop\n```\n\nThere used to be a custom hash function for ambient space elements in\nroot systems, but this is not needed anymore:\n\n```\n    sage: F = RootSystem(['A',2]).ambient_space()\n    sage: f = F.simple_root(0)\n    sage: %timeit hash(f)                         # new hash function\n    100000 loops, best of 3: 3.63 \u00b5s per loop\n    sage: %timeit hash(f._repr_())                # equivalent to the previous one\n    10000 loops, best of 3: 42.3 \u00b5s per loop\n```\n\nSee #15959 for a follow up.\n\n**CC:**  sage-combinat @hivert @simon-king-jena @tscrim @anneschilling @dwbump\n\n**Branch/Commit:** [ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)\n\n**Reviewer:** Florent Hivert, Travis Scrimshaw, Anne Schilling\n\n**Author:** Nicolas M. Thi\u00e9ry\n\nIssue created by migration from https://trac.sagemath.org/ticket/15931\n\n",
    "closed_at": "2014-04-04T18:52:20Z",
    "created_at": "2014-03-13T14:51:16Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "title": "Implement a proper hash function for (combinatorial) free module elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/15931",
    "user": "https://github.com/nthiery"
}
```
Up to now, CombinatorialFreeModule elements used the (horrible)
default implementation of `__hash__` provided by Element which uses the
string representation. This was slow! And further fragile! Indeed, the
string representation depends on a sorting of the support of the
elements.  In #14102 we got bitten by this with elements whose support
mixed int's, Integer's and string. The result of:

```
    sage: sorted([int(0), 'delta', 1])
    [0, 1, 'delta']
```
depends on the platform (that's ok) but also on which of 0 and 1 are
int's or Integer, whereas the corresponding lists test as equal.
This led to equal element with distinct hash values.

This ticket adds an implementation of `__hash__` inspired from that
proposed for frozendicts in PEP 0416. In particular this
implementation does not rely on sorting.

Some timings:

```
    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
    sage: B = F.basis()
    sage: f = B['a'] + 3*B['c']
    sage: %timeit hash(f)                         # new hash function
    100000 loops, best of 3: 3.57 µs per loop
    sage: %timeit hash(f._repr_())                # equivalent to the previous one
    10000 loops, best of 3: 85 µs per loop
```

There used to be a custom hash function for ambient space elements in
root systems, but this is not needed anymore:

```
    sage: F = RootSystem(['A',2]).ambient_space()
    sage: f = F.simple_root(0)
    sage: %timeit hash(f)                         # new hash function
    100000 loops, best of 3: 3.63 µs per loop
    sage: %timeit hash(f._repr_())                # equivalent to the previous one
    10000 loops, best of 3: 42.3 µs per loop
```

See #15959 for a follow up.

**CC:**  sage-combinat @hivert @simon-king-jena @tscrim @anneschilling @dwbump

**Branch/Commit:** [ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)

**Reviewer:** Florent Hivert, Travis Scrimshaw, Anne Schilling

**Author:** Nicolas M. Thiéry

Issue created by migration from https://trac.sagemath.org/ticket/15931





---

archive/issue_comments_204391.json:
```json
{
    "body": "**Branch:** [u/nthiery/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/ticket/15931)",
    "created_at": "2014-03-13T14:57:58Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204391",
    "user": "https://github.com/nthiery"
}
```

**Branch:** [u/nthiery/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/ticket/15931)



---

archive/issue_comments_204392.json:
```json
{
    "body": "**Reviewer:** Florent Hivert",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204392",
    "user": "https://github.com/nthiery"
}
```

**Reviewer:** Florent Hivert



---

archive/issue_comments_204393.json:
```json
{
    "body": "**Author:** Nicolas M. Thi\u00e9ry",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204393",
    "user": "https://github.com/nthiery"
}
```

**Author:** Nicolas M. Thiéry



---

archive/issue_events_141671.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-13T14:59:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141671"
}
```



---

archive/issue_comments_204394.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14\">e8fe5eb</a></td><td><code>Trac 15931: implement a proper hash function for (combinatorial) free module elements</code></td></tr></table>\n",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204394",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14">e8fe5eb</a></td><td><code>Trac 15931: implement a proper hash function for (combinatorial) free module elements</code></td></tr></table>




---

archive/issue_comments_204395.json:
```json
{
    "body": "**Commit:** [e8fe5eb8943debdb457c38d3264167d66e7b2b14](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)",
    "created_at": "2014-03-13T14:59:07Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204395",
    "user": "https://github.com/nthiery"
}
```

**Commit:** [e8fe5eb8943debdb457c38d3264167d66e7b2b14](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)



---

archive/issue_comments_204396.json:
```json
{
    "body": "<a id='comment:3'></a>\nSimon: I don't remember the status: would it be possible now to use cached_method on `__hash__`?",
    "created_at": "2014-03-13T15:00:26Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204396",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>
Simon: I don't remember the status: would it be possible now to use cached_method on `__hash__`?



---

archive/issue_comments_204397.json:
```json
{
    "body": "<a id='comment:4'></a>\nApparently, yes; here is the timing after adding a `@`cached_method:\n\n```\n    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n    sage: B = F.basis()\n    sage: f = B['a'] + 3*B['c']\n    sage: %timeit hash(f) \n    1000000 loops, best of 3: 582 ns per loop\n```\n\nIt's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\nDo we want to do this?",
    "created_at": "2014-03-13T15:10:43Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204397",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Apparently, yes; here is the timing after adding a `@`cached_method:

```
    sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
    sage: B = F.basis()
    sage: f = B['a'] + 3*B['c']
    sage: %timeit hash(f) 
    1000000 loops, best of 3: 582 ns per loop
```

It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.
Do we want to do this?



---

archive/issue_comments_204398.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@nthiery](#comment%3A4):\n> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\n\nGlad to see that the decorator is useful on magical Python methods (by the way, `__len__` and so on can now be cached as well).\n\n> Do we want to do this?\n\nI guess I am biased... ;-) (take that as \"yes, from my viewpoint\")\n\nIt reminds me, though, that I should investigate a potentially nasty detail. Assume that `@`cached_method is applied to the hash. Then an instance `O` is created, that has the hash `h1`. Then we save `O`. Later, the `__hash__` is changed, so that a newly created copy of `O` should have hash `h2!=h1`. Would it be the case that *reloading* `O` from the old pickle still has `hash(O)==h1`, i.e., would the old hash value be part of the pickle? This would be bad.",
    "created_at": "2014-03-13T15:29:25Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204398",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Replying to [@nthiery](#comment%3A4):
> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.

Glad to see that the decorator is useful on magical Python methods (by the way, `__len__` and so on can now be cached as well).

> Do we want to do this?

I guess I am biased... ;-) (take that as "yes, from my viewpoint")

It reminds me, though, that I should investigate a potentially nasty detail. Assume that `@`cached_method is applied to the hash. Then an instance `O` is created, that has the hash `h1`. Then we save `O`. Later, the `__hash__` is changed, so that a newly created copy of `O` should have hash `h2!=h1`. Would it be the case that *reloading* `O` from the old pickle still has `hash(O)==h1`, i.e., would the old hash value be part of the pickle? This would be bad.



---

archive/issue_comments_204399.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@nthiery](#comment%3A4):\n> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.\n> Do we want to do this?\n\nSince `CombinatorialFreeModuleElement` are already large objects dict(index, coeff)) the size of a cached methods without any arguments seems to be 128 byte on a 64bits machine as of Sage 6.1.1. It probably could be lowered (Simon: do you have any idea ?). I'm tempted to say: add the cached method by default.\n\nFor the info, here are the Cython struct of a `CachedMethodNoArgs`:\n\n```\ncdef class CachedFunction(object):\n    cdef public str __name__\n    cdef public str __module__\n    cdef object _argument_fixer\n    cdef public object _fix_to_pos\n    cdef public object f\n    # cache is not always of type \"dict\"!\n    cdef public object cache\n    cdef tuple _default_key\n    cdef bint is_classmethod\n\ncdef class CachedMethodCallerNoArgs(CachedFunction):\n    cdef public object _instance\n``` \nSimon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?",
    "created_at": "2014-03-13T15:44:21Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204399",
    "user": "https://github.com/hivert"
}
```

<a id='comment:6'></a>
Replying to [@nthiery](#comment%3A4):
> It's almost an order of magnitude faster (more with larger elements), assuming we often recompute the hash value of elements.
> Do we want to do this?

Since `CombinatorialFreeModuleElement` are already large objects dict(index, coeff)) the size of a cached methods without any arguments seems to be 128 byte on a 64bits machine as of Sage 6.1.1. It probably could be lowered (Simon: do you have any idea ?). I'm tempted to say: add the cached method by default.

For the info, here are the Cython struct of a `CachedMethodNoArgs`:

```
cdef class CachedFunction(object):
    cdef public str __name__
    cdef public str __module__
    cdef object _argument_fixer
    cdef public object _fix_to_pos
    cdef public object f
    # cache is not always of type "dict"!
    cdef public object cache
    cdef tuple _default_key
    cdef bint is_classmethod

cdef class CachedMethodCallerNoArgs(CachedFunction):
    cdef public object _instance
``` 
Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?



---

archive/issue_comments_204400.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@hivert](#comment%3A6):\n> For the info, here are the Cython struct of a `CachedMethodNoArgs`:\n> \n> ```\n> cdef class CachedFunction(object):\n>     cdef public str __name__\n>     cdef public str __module__\n>     cdef object _argument_fixer\n>     cdef public object _fix_to_pos\n>     cdef public object f\n>     # cache is not always of type \"dict\"!\n>     cdef public object cache\n>     cdef tuple _default_key\n>     cdef bint is_classmethod\n> \n> cdef class CachedMethodCallerNoArgs(CachedFunction):\n>     cdef public object _instance\n> ``` \n> Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?\n\nAsk Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.",
    "created_at": "2014-03-13T15:54:57Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204400",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Replying to [@hivert](#comment%3A6):
> For the info, here are the Cython struct of a `CachedMethodNoArgs`:
> 
> ```
> cdef class CachedFunction(object):
>     cdef public str __name__
>     cdef public str __module__
>     cdef object _argument_fixer
>     cdef public object _fix_to_pos
>     cdef public object f
>     # cache is not always of type "dict"!
>     cdef public object cache
>     cdef tuple _default_key
>     cdef bint is_classmethod
> 
> cdef class CachedMethodCallerNoArgs(CachedFunction):
>     cdef public object _instance
> ``` 
> Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?

Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.



---

archive/issue_comments_204401.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@simon-king-jena](#comment%3A7):\n> > Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?\n\n> \n> Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.\n\nTo bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.",
    "created_at": "2014-03-13T16:07:14Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204401",
    "user": "https://github.com/hivert"
}
```

<a id='comment:8'></a>
Replying to [@simon-king-jena](#comment%3A7):
> > Simon: Wouldn't be possible to replace some attributes such as `__name__`, `__module__` which are seldom used by a slower property ?

> 
> Ask Nicolas! I think he was the one who recently added `__name__` and `__module__` to cached methods.

To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.



---

archive/issue_comments_204402.json:
```json
{
    "body": "**Changing commit** from \"[e8fe5eb8943debdb457c38d3264167d66e7b2b14](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)\" to \"[e6ef605116edd69eb8630d80fc731eeae0316a25](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)\".",
    "created_at": "2014-03-13T16:31:27Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e8fe5eb8943debdb457c38d3264167d66e7b2b14](https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14)" to "[e6ef605116edd69eb8630d80fc731eeae0316a25](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)".



---

archive/issue_comments_204403.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25\">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr></table>\n",
    "created_at": "2014-03-13T16:31:27Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr></table>




---

archive/issue_comments_204404.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@hivert](#comment%3A8):\n> To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.\n\nI did a short experiment. This seems to work: see #15936. So I'm Ok with caching here.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25\">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr></table>\n",
    "created_at": "2014-03-13T16:37:56Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204404",
    "user": "https://github.com/hivert"
}
```

<a id='comment:10'></a>
Replying to [@hivert](#comment%3A8):
> To bad for you ;-) According the git blame he added indeed them on `CachedMethod` whereas here I'm speaking about `CachedFunction` which seems to have been written by you.

I did a short experiment. This seems to work: see #15936. So I'm Ok with caching here.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr></table>




---

archive/issue_comments_204405.json:
```json
{
    "body": "**Changing commit** from \"[e6ef605116edd69eb8630d80fc731eeae0316a25](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)\" to \"[a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)\".",
    "created_at": "2014-03-13T16:59:38Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e6ef605116edd69eb8630d80fc731eeae0316a25](https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25)" to "[a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)".



---

archive/issue_comments_204406.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b\">a2bbe7f</a></td><td><code>Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements</code></td></tr></table>\n",
    "created_at": "2014-03-13T16:59:38Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b">a2bbe7f</a></td><td><code>Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements</code></td></tr></table>




---

archive/issue_events_141672.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2014-03-13T17:00:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141672"
}
```



---

archive/issue_events_141673.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2014-03-13T17:00:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141673"
}
```



---

archive/issue_comments_204407.json:
```json
{
    "body": "<a id='comment:13'></a>\nI get multiple doctest failures",
    "created_at": "2014-03-14T01:50:46Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204407",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
I get multiple doctest failures



---

archive/issue_events_141674.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-17T11:27:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141674"
}
```



---

archive/issue_events_141675.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-17T11:27:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141675"
}
```



---

archive/issue_comments_204408.json:
```json
{
    "body": "<a id='comment:14'></a>\nChanging the hash value of combinatorial free module elements changes the order in which they get sorted when printing, e.g., sets. This causes a bunch of trivial doctest failures that are not deterministic, in particular in crystals and weyl character rings. I am in the process of fixing those, trying at this occasion to make the tests more deterministic when easy. Further work on making those tests deterministic would be desirable in later tickets. \n\nAlso, for now, I removed the hash value of the parent from the hash value of the elements. See #15959. Travis: please check it out!\n\nCheers,",
    "created_at": "2014-03-17T11:27:10Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204408",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>
Changing the hash value of combinatorial free module elements changes the order in which they get sorted when printing, e.g., sets. This causes a bunch of trivial doctest failures that are not deterministic, in particular in crystals and weyl character rings. I am in the process of fixing those, trying at this occasion to make the tests more deterministic when easy. Further work on making those tests deterministic would be desirable in later tickets. 

Also, for now, I removed the hash value of the parent from the hash value of the elements. See #15959. Travis: please check it out!

Cheers,



---

archive/issue_comments_204409.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,3 +40,5 @@\n     sage: %timeit hash(f._repr_())                # equivalent to the previous one\n     10000 loops, best of 3: 42.3 \u00b5s per loop\n ```\n+\n+See #15959 for a follow up.\n``````\n",
    "created_at": "2014-03-17T11:27:10Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204409",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,3 +40,5 @@
     sage: %timeit hash(f._repr_())                # equivalent to the previous one
     10000 loops, best of 3: 42.3 µs per loop
 ```
+
+See #15959 for a follow up.
``````




---

archive/issue_comments_204410.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c1e10a0fbdb7d480cfb3bb90a4b274a79cf6020\">9c1e10a</a></td><td><code>Trac 15931: fix the doctests for the new hash function for (combinatorial) free module elements to be reproducible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240\">fb2cafa</a></td><td><code>    Trac 15931: do not include the hash of the parent in the new hash function for (combinatorial) free module elements after all; see #15959</code></td></tr></table>\n",
    "created_at": "2014-03-17T15:22:11Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c1e10a0fbdb7d480cfb3bb90a4b274a79cf6020">9c1e10a</a></td><td><code>Trac 15931: fix the doctests for the new hash function for (combinatorial) free module elements to be reproducible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240">fb2cafa</a></td><td><code>    Trac 15931: do not include the hash of the parent in the new hash function for (combinatorial) free module elements after all; see #15959</code></td></tr></table>




---

archive/issue_comments_204411.json:
```json
{
    "body": "**Changing commit** from \"[a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)\" to \"[fb2cafab463fa826fb4ed1584ca1d1614f3e3240](https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240)\".",
    "created_at": "2014-03-17T15:22:11Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b](https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b)" to "[fb2cafab463fa826fb4ed1584ca1d1614f3e3240](https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240)".



---

archive/issue_comments_204412.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb\">c61f4b7</a></td><td><code>Trac 15931: update a bunch of non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems, crystals)</code></td></tr></table>\n",
    "created_at": "2014-03-17T15:24:30Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb">c61f4b7</a></td><td><code>Trac 15931: update a bunch of non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems, crystals)</code></td></tr></table>




---

archive/issue_comments_204413.json:
```json
{
    "body": "**Changing commit** from \"[fb2cafab463fa826fb4ed1584ca1d1614f3e3240](https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240)\" to \"[c61f4b7e6cd2389af637f22243150008b3dcc2eb](https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb)\".",
    "created_at": "2014-03-17T15:24:30Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fb2cafab463fa826fb4ed1584ca1d1614f3e3240](https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240)" to "[c61f4b7e6cd2389af637f22243150008b3dcc2eb](https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb)".



---

archive/issue_comments_204414.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868\">492440e</a></td><td><code>Trac 15931: update more non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr></table>\n",
    "created_at": "2014-03-17T16:54:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868">492440e</a></td><td><code>Trac 15931: update more non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr></table>




---

archive/issue_comments_204415.json:
```json
{
    "body": "**Changing commit** from \"[c61f4b7e6cd2389af637f22243150008b3dcc2eb](https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb)\" to \"[492440e35c7c22a78afedf33d46389a995db3868](https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868)\".",
    "created_at": "2014-03-17T16:54:34Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c61f4b7e6cd2389af637f22243150008b3dcc2eb](https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb)" to "[492440e35c7c22a78afedf33d46389a995db3868](https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868)".



---

archive/issue_comments_204416.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6\">1fed58c</a></td><td><code>Trac 15931: update even more *non-deterministic* doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr></table>\n",
    "created_at": "2014-03-17T17:14:51Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6">1fed58c</a></td><td><code>Trac 15931: update even more *non-deterministic* doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr></table>




---

archive/issue_comments_204417.json:
```json
{
    "body": "**Changing commit** from \"[492440e35c7c22a78afedf33d46389a995db3868](https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868)\" to \"[1fed58cd278db93070845be9c2e55761507578a6](https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6)\".",
    "created_at": "2014-03-17T17:14:51Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[492440e35c7c22a78afedf33d46389a995db3868](https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868)" to "[1fed58cd278db93070845be9c2e55761507578a6](https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6)".



---

archive/issue_comments_204418.json:
```json
{
    "body": "<a id='comment:19'></a>\nHopefully I have been through all the failing doctests. Anne, Travis, Dan, please check them!\n\nUsing pprint makes the order depend on the comparison function of free module elements rather than their hash, which should be more robust.\n\nWell, I get a bunch of other failures in the dev scripts, but those also fail for me on the current branch develop; so I assume they are unrelated.\n\n```\nsage -t --long src/sage/dev/sagedev.py  # 273 doctests failed\nsage -t --long src/sage/dev/git_interface.py  # 27 doctests failed\nsage -t --long src/sage/dev/trac_interface.py  # 27 doctests failed\nsage -t --long src/sage/dev/test/server_proxy.py  # 26 doctests failed\nsage -t --long src/sage/dev/test/sagedev.py  # 10 doctests failed\nsage -t --long src/sage/dev/patch.py  # 9 doctests failed\nsage -t --long src/sage/dev/config.py  # 18 doctests failed\nsage -t --long src/sage/dev/cmd_line_interface.py  # 14 doctests failed\nsage -t --long src/sage/dev/test/trac_interface.py  # 8 doctests failed\nsage -t --long src/sage/dev/user_interface.py  # 13 doctests failed\nsage -t --long src/sage/dev/sagedev_wrapper.py  # 4 doctests failed\nsage -t --long src/sage/dev/test/trac_server.py  # 2 doctests failed\nsage -t --long src/sage/dev/test/user_interface.py  # 4 doctests failed\nsage -t --long src/sage/dev/sagedev_instance.py  # 1 doctest failed\nsage -t --long src/sage/dev/test/config.py  # 2 doctests failed\n```",
    "created_at": "2014-03-17T17:23:09Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204418",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:19'></a>
Hopefully I have been through all the failing doctests. Anne, Travis, Dan, please check them!

Using pprint makes the order depend on the comparison function of free module elements rather than their hash, which should be more robust.

Well, I get a bunch of other failures in the dev scripts, but those also fail for me on the current branch develop; so I assume they are unrelated.

```
sage -t --long src/sage/dev/sagedev.py  # 273 doctests failed
sage -t --long src/sage/dev/git_interface.py  # 27 doctests failed
sage -t --long src/sage/dev/trac_interface.py  # 27 doctests failed
sage -t --long src/sage/dev/test/server_proxy.py  # 26 doctests failed
sage -t --long src/sage/dev/test/sagedev.py  # 10 doctests failed
sage -t --long src/sage/dev/patch.py  # 9 doctests failed
sage -t --long src/sage/dev/config.py  # 18 doctests failed
sage -t --long src/sage/dev/cmd_line_interface.py  # 14 doctests failed
sage -t --long src/sage/dev/test/trac_interface.py  # 8 doctests failed
sage -t --long src/sage/dev/user_interface.py  # 13 doctests failed
sage -t --long src/sage/dev/sagedev_wrapper.py  # 4 doctests failed
sage -t --long src/sage/dev/test/trac_server.py  # 2 doctests failed
sage -t --long src/sage/dev/test/user_interface.py  # 4 doctests failed
sage -t --long src/sage/dev/sagedev_instance.py  # 1 doctest failed
sage -t --long src/sage/dev/test/config.py  # 2 doctests failed
```



---

archive/issue_events_141676.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-17T17:23:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141676"
}
```



---

archive/issue_events_141677.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-17T17:23:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141677"
}
```



---

archive/issue_comments_204419.json:
```json
{
    "body": "**Changing commit** from \"[1fed58cd278db93070845be9c2e55761507578a6](https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6)\" to \"[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)\".",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204419",
    "user": "https://github.com/anneschilling"
}
```

**Changing commit** from "[1fed58cd278db93070845be9c2e55761507578a6](https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6)" to "[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)".



---

archive/issue_comments_204420.json:
```json
{
    "body": "<a id='comment:20'></a>\nTravis and I fixed some doc tests and TAB characters. Looks good otherwise.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339\">f9fdb43</a></td><td><code>fixed doc tests</code></td></tr></table>\n",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204420",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:20'></a>
Travis and I fixed some doc tests and TAB characters. Looks good otherwise.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339">f9fdb43</a></td><td><code>fixed doc tests</code></td></tr></table>




---

archive/issue_events_141678.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2014-03-17T23:59:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141678"
}
```



---

archive/issue_events_141679.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2014-03-17T23:59:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141679"
}
```



---

archive/issue_comments_204421.json:
```json
{
    "body": "**Changing branch** from \"[u/nthiery/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/ticket/15931)\" to \"[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)\".",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204421",
    "user": "https://github.com/anneschilling"
}
```

**Changing branch** from "[u/nthiery/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/ticket/15931)" to "[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)".



---

archive/issue_comments_204422.json:
```json
{
    "body": "**Changing reviewer** from \"Florent Hivert\" to \"Florent Hivert, Travis Scrimshaw, Anne Schilling\".",
    "created_at": "2014-03-17T23:59:53Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204422",
    "user": "https://github.com/anneschilling"
}
```

**Changing reviewer** from "Florent Hivert" to "Florent Hivert, Travis Scrimshaw, Anne Schilling".



---

archive/issue_comments_204423.json:
```json
{
    "body": "<a id='comment:21'></a>\nThanks Anne, Travis for the review! I double checked your changes and am indeed happy with them.",
    "created_at": "2014-03-18T14:54:36Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204423",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:21'></a>
Thanks Anne, Travis for the review! I double checked your changes and am indeed happy with them.



---

archive/issue_comments_204424.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)\" to \"[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)\".",
    "created_at": "2014-03-20T20:07:48Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204424",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)" to "[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)".



---

archive/issue_events_141680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-20T20:07:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141680"
}
```



---

archive/issue_events_141681.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-20T20:07:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141681"
}
```



---

archive/issue_comments_204425.json:
```json
{
    "body": "**Changing commit** from \"[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)\" to \"\".",
    "created_at": "2014-03-22T15:46:27Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204425",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)" to "".



---

archive/issue_comments_204426.json:
```json
{
    "body": "<a id='comment:23'></a>\nStill fails on 32-bit\n\n```\nsage -t --long src/sage/combinat/free_module.py\n**********************************************************************\nFile \"src/sage/combinat/free_module.py\", line 116, in sage.combinat.free_module.CombinatorialFreeModuleElement.__hash__\nFailed example:\n    hash(f)\nExpected:\n    3765996081                    \nGot:\n    -528971215\n```",
    "created_at": "2014-03-22T15:46:27Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204426",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>
Still fails on 32-bit

```
sage -t --long src/sage/combinat/free_module.py
**********************************************************************
File "src/sage/combinat/free_module.py", line 116, in sage.combinat.free_module.CombinatorialFreeModuleElement.__hash__
Failed example:
    hash(f)
Expected:
    3765996081                    
Got:
    -528971215
```



---

archive/issue_comments_204427.json:
```json
{
    "body": "<a id='comment:25'></a>\nShoot; I don't have a 32bits machine under hand, and I was hoping the hash value on 32bits would be the hash value on 64bits mod 2^32.\n\nVolker: can you confirm that there is no other failure in 32 bits? If yes, I'll just fix the doctest and push.",
    "created_at": "2014-03-25T11:14:29Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204427",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:25'></a>
Shoot; I don't have a 32bits machine under hand, and I was hoping the hash value on 32bits would be the hash value on 64bits mod 2^32.

Volker: can you confirm that there is no other failure in 32 bits? If yes, I'll just fix the doctest and push.



---

archive/issue_comments_204428.json:
```json
{
    "body": "<a id='comment:26'></a>\nI didn't see any other test failures...",
    "created_at": "2014-03-25T12:07:13Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204428",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
I didn't see any other test failures...



---

archive/issue_comments_204429.json:
```json
{
    "body": "**Commit:** [f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)",
    "created_at": "2014-03-27T18:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204429",
    "user": "https://github.com/nthiery"
}
```

**Commit:** [f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)



---

archive/issue_events_141682.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-03-27T18:51:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141682"
}
```



---

archive/issue_comments_204430.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks Volker.\n\nFinally having a working connection to push my change ...\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14\">e8fe5eb</a></td><td><code>Trac 15931: implement a proper hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25\">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b\">a2bbe7f</a></td><td><code>Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c1e10a0fbdb7d480cfb3bb90a4b274a79cf6020\">9c1e10a</a></td><td><code>Trac 15931: fix the doctests for the new hash function for (combinatorial) free module elements to be reproducible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240\">fb2cafa</a></td><td><code>    Trac 15931: do not include the hash of the parent in the new hash function for (combinatorial) free module elements after all; see #15959</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb\">c61f4b7</a></td><td><code>Trac 15931: update a bunch of non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems, crystals)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868\">492440e</a></td><td><code>Trac 15931: update more non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6\">1fed58c</a></td><td><code>Trac 15931: update even more *non-deterministic* doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339\">f9fdb43</a></td><td><code>fixed doc tests</code></td></tr></table>\n",
    "created_at": "2014-03-27T18:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204430",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:27'></a>
Thanks Volker.

Finally having a working connection to push my change ...

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8fe5eb8943debdb457c38d3264167d66e7b2b14">e8fe5eb</a></td><td><code>Trac 15931: implement a proper hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6ef605116edd69eb8630d80fc731eeae0316a25">e6ef605</a></td><td><code>Trac 15931: add a @cached_method on the new hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b">a2bbe7f</a></td><td><code>Trac 15931: include the hash of the parent in the new hash function for (combinatorial) free module elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c1e10a0fbdb7d480cfb3bb90a4b274a79cf6020">9c1e10a</a></td><td><code>Trac 15931: fix the doctests for the new hash function for (combinatorial) free module elements to be reproducible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb2cafab463fa826fb4ed1584ca1d1614f3e3240">fb2cafa</a></td><td><code>    Trac 15931: do not include the hash of the parent in the new hash function for (combinatorial) free module elements after all; see #15959</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c61f4b7e6cd2389af637f22243150008b3dcc2eb">c61f4b7</a></td><td><code>Trac 15931: update a bunch of non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems, crystals)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/492440e35c7c22a78afedf33d46389a995db3868">492440e</a></td><td><code>Trac 15931: update more non-deterministic'' doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fed58cd278db93070845be9c2e55761507578a6">1fed58c</a></td><td><code>Trac 15931: update even more *non-deterministic* doctests that depend on the hash function for (combinatorial) free module elements, and try to make them more deterministic (root systems)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339">f9fdb43</a></td><td><code>fixed doc tests</code></td></tr></table>




---

archive/issue_comments_204431.json:
```json
{
    "body": "**Changing branch** from \"[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)\" to \"[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)\".",
    "created_at": "2014-03-27T18:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204431",
    "user": "https://github.com/nthiery"
}
```

**Changing branch** from "[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)" to "[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)".



---

archive/issue_comments_204432.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c8801b7610754edab60dd526cb7dc737566bb9f\">4c8801b</a></td><td><code>Trac 15931: Fixed hash value in 32bit doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92\">ffcf2b6</a></td><td><code>Merge branch 'public/ticket/15931' of git://trac.sagemath.org/sage into ticket/15931-hash-free_module</code></td></tr></table>\n",
    "created_at": "2014-03-27T18:54:29Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c8801b7610754edab60dd526cb7dc737566bb9f">4c8801b</a></td><td><code>Trac 15931: Fixed hash value in 32bit doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92">ffcf2b6</a></td><td><code>Merge branch 'public/ticket/15931' of git://trac.sagemath.org/sage into ticket/15931-hash-free_module</code></td></tr></table>




---

archive/issue_comments_204433.json:
```json
{
    "body": "**Changing commit** from \"[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)\" to \"[ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)\".",
    "created_at": "2014-03-27T18:54:29Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f9fdb4347e72af3ba349c6029cf54883fb4df339](https://github.com/sagemath/sagetrac-mirror/commit/f9fdb4347e72af3ba349c6029cf54883fb4df339)" to "[ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)".



---

archive/issue_comments_204434.json:
```json
{
    "body": "<a id='comment:29'></a>\nNicolas, do you want to merge in my fix for the Kyoto path model on #15959 or just let this ticket pass in as is?",
    "created_at": "2014-04-02T01:49:55Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204434",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>
Nicolas, do you want to merge in my fix for the Kyoto path model on #15959 or just let this ticket pass in as is?



---

archive/issue_comments_204435.json:
```json
{
    "body": "<a id='comment:30'></a>\nNo strong opinion. Since we have two tickets anyway, me might maybe as well get them in one by one.\n\nThanks for your fixes on the Kyoto path model! \n\nCheers,\n                    Nicolas",
    "created_at": "2014-04-02T20:02:22Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204435",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:30'></a>
No strong opinion. Since we have two tickets anyway, me might maybe as well get them in one by one.

Thanks for your fixes on the Kyoto path model! 

Cheers,
                    Nicolas



---

archive/issue_comments_204436.json:
```json
{
    "body": "<a id='comment:31'></a>\nOkay, then back to positive review here.",
    "created_at": "2014-04-02T20:03:26Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204436",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>
Okay, then back to positive review here.



---

archive/issue_events_141683.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-04-02T20:03:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141683"
}
```



---

archive/issue_events_141684.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-04-02T20:03:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141684"
}
```



---

archive/issue_events_141685.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-04T18:52:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141685"
}
```



---

archive/issue_events_141686.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3c9702fb557535b54ea7589e304c8baecd198232",
    "created_at": "2014-04-04T18:52:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15931#event-141686"
}
```



---

archive/issue_comments_204437.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)\" to \"[ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)\".",
    "created_at": "2014-04-04T18:52:20Z",
    "issue": "https://github.com/sagemath/sage/issues/15931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15931#issuecomment-204437",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ticket/15931](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/15931)" to "[ffcf2b6a3523055e39284dbffbe52f5199925b92](https://github.com/sagemath/sagetrac-mirror/commit/ffcf2b6a3523055e39284dbffbe52f5199925b92)".
