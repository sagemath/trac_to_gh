# Issue 15760: Speed up short vector enumeration

archive/issues_015523.json:
```json
{
    "body": "The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.\n\nTimings before:\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 1.13 s per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 6.74 s per loop\n```\n\nTimings after:\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n10 loops, best of 3: 34.4 ms per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 1.03 s per loop\n```\n\nCC:  mraum @pjbruin\n\nReviewer: Peter Bruin\n\nAuthor: Jeroen Demeyer\n\nBranch: u/jdemeyer/ticket/15760\n\nCommit: 7081e42db98d67260a1b7754a59093d006123d0b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15760\n\n",
    "closed_at": "2014-02-02T16:57:24Z",
    "created_at": "2014-01-29T10:37:53Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Speed up short vector enumeration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15760",
    "user": "https://github.com/jdemeyer"
}
```
The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.

Timings before:

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 1.13 s per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 6.74 s per loop
```

Timings after:

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
10 loops, best of 3: 34.4 ms per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 1.03 s per loop
```

CC:  mraum @pjbruin

Reviewer: Peter Bruin

Author: Jeroen Demeyer

Branch: u/jdemeyer/ticket/15760

Commit: 7081e42db98d67260a1b7754a59093d006123d0b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15760





---

archive/issue_comments_213743.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n-The \\`short_vector_list_up_to_length\\` method of quadratic forms uses GP but the interface is so badly done that essentially all time is taken up by the Sage interface, and not by the actual computation.\n+The \\`short_vector_list_up_to_length\\` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.\n+\n+Timings before:\n+\n+\\`\\`\\`\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+1 loops, best of 3: 1.13 s per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 6.74 s per loop\n+\\`\\`\\`\n+\n+Timings after:\n+\n+\\`\\`\\`\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+10 loops, best of 3: 34.4 ms per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 1.03 s per loop\n+\\`\\`\\`\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2014-01-29T12:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213743",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
-The \`short_vector_list_up_to_length\` method of quadratic forms uses GP but the interface is so badly done that essentially all time is taken up by the Sage interface, and not by the actual computation.
+The \`short_vector_list_up_to_length\` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.
+
+Timings before:
+
+\`\`\`
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+1 loops, best of 3: 1.13 s per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 6.74 s per loop
+\`\`\`
+
+Timings after:
+
+\`\`\`
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+10 loops, best of 3: 34.4 ms per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 1.03 s per loop
+\`\`\`
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_213744.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2014-01-29T12:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213744",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_213745.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+The \\`short_vector_list_up_to_length\\` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.\n \n+Timings before:\n+\n+\\`\\`\\`\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+1 loops, best of 3: 1.13 s per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 6.74 s per loop\n+\\`\\`\\`\n+\n+Timings after:\n+\n+\\`\\`\\`\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+10 loops, best of 3: 34.4 ms per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 1.03 s per loop\n+\\`\\`\\`\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2014-01-29T12:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213745",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
+The \`short_vector_list_up_to_length\` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.
 
+Timings before:
+
+\`\`\`
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+1 loops, best of 3: 1.13 s per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 6.74 s per loop
+\`\`\`
+
+Timings after:
+
+\`\`\`
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+10 loops, best of 3: 34.4 ms per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 1.03 s per loop
+\`\`\`
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_213746.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-29T13:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213747.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-29T13:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213747",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_213748.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good and I can confirm the speed-up.  Now doctesting...",
    "created_at": "2014-01-29T19:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213748",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>Looks good and I can confirm the speed-up.  Now doctesting...



---

archive/issue_comments_213749.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-29T21:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213749",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_046332.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15760#event-46332"
}
```



---

archive/issue_comments_213750.json:
```json
{
    "body": "<a id='comment:10'></a>\n```\nOSError: [quadratic] /scratch/buildbot/sage/redhawk-1/sage_git/build/local/lib/python2.7/site-packages/sage/quadratic_forms/quadratic_form.py:docstring of sage.quadratic_forms.quadratic_form.QuadraticForm.short_vector_list_up_to_length:8: WARNING: Inline literal start-string without end-string.\n```\nI think thats you ;-)",
    "created_at": "2014-02-01T17:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213750",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
```
OSError: [quadratic] /scratch/buildbot/sage/redhawk-1/sage_git/build/local/lib/python2.7/site-packages/sage/quadratic_forms/quadratic_form.py:docstring of sage.quadratic_forms.quadratic_form.QuadraticForm.short_vector_list_up_to_length:8: WARNING: Inline literal start-string without end-string.
```
I think thats you ;-)



---

archive/issue_comments_213751.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-02-02T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213751",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_213752.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-02-02T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_213753.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-02T14:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213753",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_213754.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-02T16:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-213754",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_046333.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-02T16:57:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15760#event-46333"
}
```
