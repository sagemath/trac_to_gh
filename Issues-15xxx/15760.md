# Issue 15760: Speed up short vector enumeration

archive/issues_015523.json:
```json
{
    "body": "The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.\n\nTimings before:\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n1 loops, best of 3: 1.13 s per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 6.74 s per loop\n```\n\nTimings after:\n\n```\nsage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\nsage: %timeit qf.short_vector_list_up_to_length(100)\n10 loops, best of 3: 34.4 ms per loop\nsage: %timeit qf.short_vector_list_up_to_length(1000)\n1 loops, best of 3: 1.03 s per loop\n```\n\nCC:  mraum @pjbruin\n\nReviewer: Peter Bruin\n\nAuthor: Jeroen Demeyer\n\nBranch: u/jdemeyer/ticket/15760\n\nCommit: 7081e42db98d67260a1b7754a59093d006123d0b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15760\n\n",
    "closed_at": "2014-02-02T16:57:24Z",
    "created_at": "2014-01-29T10:37:53Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Speed up short vector enumeration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15760",
    "user": "https://github.com/jdemeyer"
}
```
The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.

Timings before:

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
1 loops, best of 3: 1.13 s per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 6.74 s per loop
```

Timings after:

```
sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
sage: %timeit qf.short_vector_list_up_to_length(100)
10 loops, best of 3: 34.4 ms per loop
sage: %timeit qf.short_vector_list_up_to_length(1000)
1 loops, best of 3: 1.03 s per loop
```

CC:  mraum @pjbruin

Reviewer: Peter Bruin

Author: Jeroen Demeyer

Branch: u/jdemeyer/ticket/15760

Commit: 7081e42db98d67260a1b7754a59093d006123d0b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15760





---

archive/issue_comments_250471.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,21 @@\n-The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that essentially all time is taken up by the Sage interface, and not by the actual computation.\n+The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.\n+\n+Timings before:\n+\n+```\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+1 loops, best of 3: 1.13 s per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 6.74 s per loop\n+```\n+\n+Timings after:\n+\n+```\n+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))\n+sage: %timeit qf.short_vector_list_up_to_length(100)\n+10 loops, best of 3: 34.4 ms per loop\n+sage: %timeit qf.short_vector_list_up_to_length(1000)\n+1 loops, best of 3: 1.03 s per loop\n+```\n``````\n",
    "created_at": "2014-01-29T12:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250471",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,21 @@
-The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that essentially all time is taken up by the Sage interface, and not by the actual computation.
+The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.
+
+Timings before:
+
+```
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+1 loops, best of 3: 1.13 s per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 6.74 s per loop
+```
+
+Timings after:
+
+```
+sage: qf = QuadraticForm(matrix(3, [2, 1, 1,  1, 2, 1,  1, 1, 2]))
+sage: %timeit qf.short_vector_list_up_to_length(100)
+10 loops, best of 3: 34.4 ms per loop
+sage: %timeit qf.short_vector_list_up_to_length(1000)
+1 loops, best of 3: 1.03 s per loop
+```
``````




---

archive/issue_comments_250472.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/15760\"",
    "created_at": "2014-01-29T12:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250472",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/15760"



---

archive/issue_comments_250473.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[8c12459](https://github.com/sagemath/sagetrac-mirror/commit/8c1245926c73f1692dbdd2d3da07dacb7b6e50b5)|`Speed up short_vector_list_up_to_length()`|",
    "created_at": "2014-01-29T12:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250473",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[8c12459](https://github.com/sagemath/sagetrac-mirror/commit/8c1245926c73f1692dbdd2d3da07dacb7b6e50b5)|`Speed up short_vector_list_up_to_length()`|



---

archive/issue_comments_250474.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.\n+The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.\n \n Timings before:\n \n``````\n",
    "created_at": "2014-01-29T12:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250474",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion to vectors.
+The `short_vector_list_up_to_length` method of quadratic forms uses GP but the interface is so badly done that the majority of the time is taken up by the Sage interface, and not by the actual computation. Still, even with the new implementation, most time is taken by the conversion from PARI to Sage vectors.
 
 Timings before:
 
``````




---

archive/issue_comments_250475.json:
```json
{
    "body": "Changing commit from \"\" to \"8c1245926c73f1692dbdd2d3da07dacb7b6e50b5\"",
    "created_at": "2014-01-29T12:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250475",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "8c1245926c73f1692dbdd2d3da07dacb7b6e50b5"



---

archive/issue_comments_250476.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[3e80bfd](https://github.com/sagemath/sagetrac-mirror/commit/3e80bfdc75d89f154a41e815b004e19207422f76)|`Some \"long time\" fixes in quadratic forms`|",
    "created_at": "2014-01-29T13:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[3e80bfd](https://github.com/sagemath/sagetrac-mirror/commit/3e80bfdc75d89f154a41e815b004e19207422f76)|`Some "long time" fixes in quadratic forms`|



---

archive/issue_comments_250477.json:
```json
{
    "body": "Changing commit from \"8c1245926c73f1692dbdd2d3da07dacb7b6e50b5\" to \"3e80bfdc75d89f154a41e815b004e19207422f76\"",
    "created_at": "2014-01-29T13:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c1245926c73f1692dbdd2d3da07dacb7b6e50b5" to "3e80bfdc75d89f154a41e815b004e19207422f76"



---

archive/issue_comments_250478.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-29T13:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250478",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_250479.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2014-01-29T19:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250479",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_250480.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good and I can confirm the speed-up.  Now doctesting...",
    "created_at": "2014-01-29T19:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250480",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
Looks good and I can confirm the speed-up.  Now doctesting...



---

archive/issue_comments_250481.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-29T21:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250481",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_060610.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15760#event-60610"
}
```



---

archive/issue_comments_250482.json:
```json
{
    "body": "<a id='comment:10'></a>\n\n```\nOSError: [quadratic] /scratch/buildbot/sage/redhawk-1/sage_git/build/local/lib/python2.7/site-packages/sage/quadratic_forms/quadratic_form.py:docstring of sage.quadratic_forms.quadratic_form.QuadraticForm.short_vector_list_up_to_length:8: WARNING: Inline literal start-string without end-string.\n```\nI think thats you ;-)",
    "created_at": "2014-02-01T17:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250482",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>

```
OSError: [quadratic] /scratch/buildbot/sage/redhawk-1/sage_git/build/local/lib/python2.7/site-packages/sage/quadratic_forms/quadratic_form.py:docstring of sage.quadratic_forms.quadratic_form.QuadraticForm.short_vector_list_up_to_length:8: WARNING: Inline literal start-string without end-string.
```
I think thats you ;-)



---

archive/issue_comments_250483.json:
```json
{
    "body": "Changing commit from \"3e80bfdc75d89f154a41e815b004e19207422f76\" to \"7081e42db98d67260a1b7754a59093d006123d0b\"",
    "created_at": "2014-02-02T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3e80bfdc75d89f154a41e815b004e19207422f76" to "7081e42db98d67260a1b7754a59093d006123d0b"



---

archive/issue_comments_250484.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-02-02T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_250485.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[7081e42](https://github.com/sagemath/sagetrac-mirror/commit/7081e42db98d67260a1b7754a59093d006123d0b)|`Fix documentation syntax`|",
    "created_at": "2014-02-02T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[7081e42](https://github.com/sagemath/sagetrac-mirror/commit/7081e42db98d67260a1b7754a59093d006123d0b)|`Fix documentation syntax`|



---

archive/issue_comments_250486.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-02T14:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250486",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_250487.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-02T16:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15760#issuecomment-250487",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-02T16:57:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15760",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15760#event-60611"
}
```
