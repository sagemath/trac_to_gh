# Issue 15605: (-1)^(2/3) evaluates to 1

archive/issues_015368.json:
```json
{
    "assignees": [],
    "body": "Likely a duplicate, but I couldn't find it elsewhere...\n\n```\nsage: (-1)^(2/3)\n1\n```\n\nOf course, this is inconsistent with virtually all interpretations and conversions of symbolic expressions...\n\n```\nsage: CC(-1)^(2/3)\n-0.500000000000000 + 0.866025403784439*I\nsage: QQbar(-1)^(2/3)\n-0.500000000000000? + 0.866025403784439?*I\nsage: RR(-1)^(2/3)\n-0.500000000000000 + 0.866025403784439*I\n```\n\nAlso:\n\n```\nsage: (-1)^(-1/3)\n-1\nsage: 1 / ((-1)^(1/3))\n-1\n```\n\n```\nsage: (-1)^(1/3)*(-1)^(1/5)\n1\n```\nbut\n\n```\nsage: (-1)^(1/15)\n(-1)^(1/15)\n```\n\nCC:  @videlec\n\nBranch: **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Ralf Stephan**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15605_\n\n",
    "closed_at": "2016-12-14T23:15:56Z",
    "created_at": "2013-12-29T09:22:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "(-1)^(2/3) evaluates to 1",
    "type": "issue",
    "updated_at": "2018-10-05T17:03:27Z",
    "url": "https://github.com/sagemath/sage/issues/15605",
    "user": "https://github.com/mezzarobba"
}
```
Likely a duplicate, but I couldn't find it elsewhere...

```
sage: (-1)^(2/3)
1
```

Of course, this is inconsistent with virtually all interpretations and conversions of symbolic expressions...

```
sage: CC(-1)^(2/3)
-0.500000000000000 + 0.866025403784439*I
sage: QQbar(-1)^(2/3)
-0.500000000000000? + 0.866025403784439?*I
sage: RR(-1)^(2/3)
-0.500000000000000 + 0.866025403784439*I
```

Also:

```
sage: (-1)^(-1/3)
-1
sage: 1 / ((-1)^(1/3))
-1
```

```
sage: (-1)^(1/3)*(-1)^(1/5)
1
```
but

```
sage: (-1)^(1/15)
(-1)^(1/15)
```

CC:  @videlec

Branch: **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**

Reviewer: **Vincent Delecroix**

Author: **Ralf Stephan**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/15605_





---

archive/issue_events_222568.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-12-29T09:22:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222568"
}
```



---

archive/issue_events_222569.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-12-29T09:22:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222569"
}
```



---

archive/issue_events_222570.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-12-29T09:22:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222570"
}
```



---

archive/issue_events_222571.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-12-29T09:22:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222571"
}
```



---

archive/issue_comments_195741.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,10 @@\n sage: RR(-1)^(2/3)\n -0.500000000000000 + 0.866025403784439*I\n ```\n+\n+Also:\n+\n+```\n+sage: (-1)^(-1/3)\n+-1\n+```\n``````\n",
    "created_at": "2013-12-29T09:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195741",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,10 @@
 sage: RR(-1)^(2/3)
 -0.500000000000000 + 0.866025403784439*I
 ```
+
+Also:
+
+```
+sage: (-1)^(-1/3)
+-1
+```
``````




---

archive/issue_comments_195742.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,9 @@\n sage: (-1)^(-1/3)\n -1\n ```\n+\n+```\n+sage: (-1)^(1/3)*(-1)^(1/5)\n+1\n+```\n+}}}\n``````\n",
    "created_at": "2013-12-29T09:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195742",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,9 @@
 sage: (-1)^(-1/3)
 -1
 ```
+
+```
+sage: (-1)^(1/3)*(-1)^(1/5)
+1
+```
+}}}
``````




---

archive/issue_events_222572.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222572"
}
```



---

archive/issue_events_222573.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222573"
}
```



---

archive/issue_comments_195743.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSeems to be a problem about \"even\" powers:\n\n```\nsage: [(-1)^(i/77) for i in range(9)]\n[1, (-1)^(1/77), 1, (-1)^(3/77), 1, (-1)^(5/77), 1, (-1)^(1/11), 1]\n```",
    "created_at": "2014-03-07T21:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195743",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

Seems to be a problem about "even" powers:

```
sage: [(-1)^(i/77) for i in range(9)]
[1, (-1)^(1/77), 1, (-1)^(3/77), 1, (-1)^(5/77), 1, (-1)^(1/11), 1]
```



---

archive/issue_comments_195744.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,4 +27,3 @@\n sage: (-1)^(1/3)*(-1)^(1/5)\n 1\n ```\n-}}}\n``````\n",
    "created_at": "2014-03-07T21:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195744",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,4 +27,3 @@
 sage: (-1)^(1/3)*(-1)^(1/5)
 1
 ```
-}}}
``````




---

archive/issue_events_222574.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222574"
}
```



---

archive/issue_events_222575.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222575"
}
```



---

archive/issue_events_222576.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222576"
}
```



---

archive/issue_events_222577.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222577"
}
```



---

archive/issue_comments_195745.json:
```json
{
    "body": "Replying to [ticket:15605 mmezzarobba]:\n> Likely a duplicate, but I couldn't find it elsewhere...\n\nIt is indeed a known issue since at least [this ask answer](http://ask.sagemath.org/question/10063/get-variants-of-complex-cube-root/?answer=14842#post-id-14842), and i use this example in my presentations about Sage and the need to define objects within a reliable parent. \n\nI did not report that on trac because this is somehow a feature of the symbolic ring : no semantics. I remember a discussion with you at sd49 (Orsay) about that precise example and the benefits (or not!) of having such kind of symbolic expressions that are able to make all kind of simplifications/derivatives/evaluations without context.\n\nIf one want to have something that both:\n- applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n- takes principal branches of multi-valued complex function when evaluating,\nthen we should accept that kind of behaviour.\n\nIt would however be awesome to have a well-designed object to work with holomorphic functions, along the same lines that what is done with polynomials, i guess it is a very hard task, and i do not know whether there exists libraries for that.",
    "created_at": "2015-04-07T23:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195745",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Replying to [ticket:15605 mmezzarobba]:
> Likely a duplicate, but I couldn't find it elsewhere...

It is indeed a known issue since at least [this ask answer](http://ask.sagemath.org/question/10063/get-variants-of-complex-cube-root/?answer=14842#post-id-14842), and i use this example in my presentations about Sage and the need to define objects within a reliable parent. 

I did not report that on trac because this is somehow a feature of the symbolic ring : no semantics. I remember a discussion with you at sd49 (Orsay) about that precise example and the benefits (or not!) of having such kind of symbolic expressions that are able to make all kind of simplifications/derivatives/evaluations without context.

If one want to have something that both:
- applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,
- takes principal branches of multi-valued complex function when evaluating,
then we should accept that kind of behaviour.

It would however be awesome to have a well-designed object to work with holomorphic functions, along the same lines that what is done with polynomials, i guess it is a very hard task, and i do not know whether there exists libraries for that.



---

archive/issue_comments_195746.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@sagetrac-tmonteil](#comment:7):\n> If one want to have something that both:\n> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n> - takes principal branches of multi-valued complex function when evaluating,\n> then we should accept that kind of behaviour.\n\nI think that with `bc` numeric (and it only makes sense to me if rational) and `a` negative the rule `a^(bc) = (a<sup>b)</sup>c` should not be applied simply because then `a^b` loses information. With symbolic exponent the user will probaby expect simplification.",
    "created_at": "2015-04-08T06:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195746",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@sagetrac-tmonteil](#comment:7):
> If one want to have something that both:
> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,
> - takes principal branches of multi-valued complex function when evaluating,
> then we should accept that kind of behaviour.

I think that with `bc` numeric (and it only makes sense to me if rational) and `a` negative the rule `a^(bc) = (a<sup>b)</sup>c` should not be applied simply because then `a^b` loses information. With symbolic exponent the user will probaby expect simplification.



---

archive/issue_comments_195747.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@sagetrac-tmonteil](#comment:7):\n> this is somehow a feature of the symbolic ring : no semantics.\n\nI agree in part only. Sure, general symbolic expressions have very weak semantics\u2014essentially, I view them as straight-line programs that are just required to evaluate to what you'd expect when you assign values to free variables. Many *operations* on symbolic expressions, however, only make sense with stronger assumptions on the expressions. Typically, simplifications are supposed to transform these \u201dprograms\u201c into \u201dequivalent\u201c ones, but of course whether two \u201dprograms\u201c are equivalent depends on what the variables can represent.\n\nThe sensible thing to do IMO is to view all variables as complex by default, and require simplifications to be valid for arbitrary complex values of all variables (or more accurately, for a generic choice of complex values: for example, we probably do want `x/x` to simplify to `1`). At least what's what Maple does, and Maple arguably has the best implementation of \u201dgeneral symbolic expressions\u201d over there.\n\nWe'll still get nonsense in many cases when trying to simplify expressions containing constants from finite fields or other parents that do not fit well into this model, but I don't know how to avoid that. (Something that may be worth trying would be to define new symbolic \u201drings\u201c parametrized by a parent. For instance, in `SR(QQ)`, all variables would be assumed to represent elements of `QQ`, constants would automatically be coerced into `QQ`, and arithmetic operations between constants would take place there. But that's not how the existing `SR` works.)\n\n> If one want to have something that both:\n> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n\nI don't think we want that. IMO this rule should be applied only if either assumptions on `a`, `b`, `c` make it safe (e.g., `c` is known to be an integer) or the user explicitely asked for it. Of course, safe simplification routines are more cumbersome to use. To mitigate the issue, Maple's `simplify` accepts an option (`symbolic`) that tells it to disregard all analytical issues related to multivalued functions and just take any branch it likes. Something like that would be convenient in Sage as well.",
    "created_at": "2015-04-08T08:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195747",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@sagetrac-tmonteil](#comment:7):
> this is somehow a feature of the symbolic ring : no semantics.

I agree in part only. Sure, general symbolic expressions have very weak semantics—essentially, I view them as straight-line programs that are just required to evaluate to what you'd expect when you assign values to free variables. Many *operations* on symbolic expressions, however, only make sense with stronger assumptions on the expressions. Typically, simplifications are supposed to transform these ”programs“ into ”equivalent“ ones, but of course whether two ”programs“ are equivalent depends on what the variables can represent.

The sensible thing to do IMO is to view all variables as complex by default, and require simplifications to be valid for arbitrary complex values of all variables (or more accurately, for a generic choice of complex values: for example, we probably do want `x/x` to simplify to `1`). At least what's what Maple does, and Maple arguably has the best implementation of ”general symbolic expressions” over there.

We'll still get nonsense in many cases when trying to simplify expressions containing constants from finite fields or other parents that do not fit well into this model, but I don't know how to avoid that. (Something that may be worth trying would be to define new symbolic ”rings“ parametrized by a parent. For instance, in `SR(QQ)`, all variables would be assumed to represent elements of `QQ`, constants would automatically be coerced into `QQ`, and arithmetic operations between constants would take place there. But that's not how the existing `SR` works.)

> If one want to have something that both:
> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,

I don't think we want that. IMO this rule should be applied only if either assumptions on `a`, `b`, `c` make it safe (e.g., `c` is known to be an integer) or the user explicitely asked for it. Of course, safe simplification routines are more cumbersome to use. To mitigate the issue, Maple's `simplify` accepts an option (`symbolic`) that tells it to disregard all analytical issues related to multivalued functions and just take any branch it likes. Something like that would be convenient in Sage as well.



---

archive/issue_comments_195748.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,9 +21,17 @@\n ```\n sage: (-1)^(-1/3)\n -1\n+sage: 1 / ((-1)^(1/3))\n+-1\n ```\n \n ```\n sage: (-1)^(1/3)*(-1)^(1/5)\n 1\n ```\n+but\n+\n+```\n+sage: (-1)^(1/15)\n+(-1)^(1/15)\n+```\n``````\n",
    "created_at": "2015-04-08T08:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195748",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,9 +21,17 @@
 ```
 sage: (-1)^(-1/3)
 -1
+sage: 1 / ((-1)^(1/3))
+-1
 ```
 
 ```
 sage: (-1)^(1/3)*(-1)^(1/5)
 1
 ```
+but
+
+```
+sage: (-1)^(1/15)
+(-1)^(1/15)
+```
``````




---

archive/issue_comments_195749.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nJust to give some concrete motivations, in #16222 (and #17516) we need a rather small subsets of symbolic expressions that modelize (some) algebraic numbers. Namely:\n- no variable\n- rational coefficients\n- I\n- exp(2*I*pi*a), cos(2*pi*a), sin(2*pi*a) with a rational\n- rational powers\n- taking real and imaginary parts\n\nAn example of such expression is\n\n```\n((cos(pi/7) + (-1)^(1/3))^(2/3)).real()\n```\n\nDo you think this must be out of the symbolic ring?\n\nVincent",
    "created_at": "2015-04-08T09:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195749",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

Just to give some concrete motivations, in #16222 (and #17516) we need a rather small subsets of symbolic expressions that modelize (some) algebraic numbers. Namely:
- no variable
- rational coefficients
- I
- exp(2*I*pi*a), cos(2*pi*a), sin(2*pi*a) with a rational
- rational powers
- taking real and imaginary parts

An example of such expression is

```
((cos(pi/7) + (-1)^(1/3))^(2/3)).real()
```

Do you think this must be out of the symbolic ring?

Vincent



---

archive/issue_comments_195750.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@videlec](#comment:12):\n> Do you think this must be out of the symbolic ring?\n\nI for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.",
    "created_at": "2015-04-08T16:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195750",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@videlec](#comment:12):
> Do you think this must be out of the symbolic ring?

I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.



---

archive/issue_comments_195751.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@mezzarobba](#comment:13):\n> Replying to [@videlec](#comment:12):\n> > Do you think this must be out of the symbolic ring?\n\n> \n> I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.\n\nHere is one problem with using the symbolic ring for constants:\n\n```\nsage: 0.1 * cos(pi/13)\n0.100000000000000*cos(1/13*pi)\n```\nThe answer should be a floating point real number!\n\nVincent",
    "created_at": "2015-04-10T11:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195751",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@mezzarobba](#comment:13):
> Replying to [@videlec](#comment:12):
> > Do you think this must be out of the symbolic ring?

> 
> I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.

Here is one problem with using the symbolic ring for constants:

```
sage: 0.1 * cos(pi/13)
0.100000000000000*cos(1/13*pi)
```
The answer should be a floating point real number!

Vincent



---

archive/issue_comments_195752.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@videlec](#comment:14):\n> Here is one problem with using the symbolic ring for constants:\n> \n> ```\n> sage: 0.1 * cos(pi/13)\n> 0.100000000000000*cos(1/13*pi)\n> ```\n> The answer should be a floating point real number!\n\nYes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?",
    "created_at": "2015-04-10T14:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195752",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@videlec](#comment:14):
> Here is one problem with using the symbolic ring for constants:
> 
> ```
> sage: 0.1 * cos(pi/13)
> 0.100000000000000*cos(1/13*pi)
> ```
> The answer should be a floating point real number!

Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?



---

archive/issue_comments_195753.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@mezzarobba](#comment:15):\n> Replying to [@videlec](#comment:14):\n> > Here is one problem with using the symbolic ring for constants:\n> > \n> > ```\n> > sage: 0.1 * cos(pi/13)\n> > 0.100000000000000*cos(1/13*pi)\n> > ```\n> > The answer should be a floating point real number!\n\n> \n> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?\n\n`0.1 * x * cos(pi/13)` should be an element of the symbolic ring (which might not necessarily be equal to `0.1 * cos(pi/13) * x`). As soon as a variable appear, just go to the symbolic ring. I do not want to remove it, just to get off some part of it that would make something coherent.\n\nThis is why I am arguing for having a new intermediate world:\n- symbolic ring (the same as today),\n- some rings of symbolic constants, explicitely embedded in RR or CC, in which equality is known to be decidable (for example the one I mentioned above).\n\nHaving some `False` positive is also very annoying with respect to my perspective.\n\nVincent",
    "created_at": "2015-04-10T15:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195753",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@mezzarobba](#comment:15):
> Replying to [@videlec](#comment:14):
> > Here is one problem with using the symbolic ring for constants:
> > 
> > ```
> > sage: 0.1 * cos(pi/13)
> > 0.100000000000000*cos(1/13*pi)
> > ```
> > The answer should be a floating point real number!

> 
> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?

`0.1 * x * cos(pi/13)` should be an element of the symbolic ring (which might not necessarily be equal to `0.1 * cos(pi/13) * x`). As soon as a variable appear, just go to the symbolic ring. I do not want to remove it, just to get off some part of it that would make something coherent.

This is why I am arguing for having a new intermediate world:
- symbolic ring (the same as today),
- some rings of symbolic constants, explicitely embedded in RR or CC, in which equality is known to be decidable (for example the one I mentioned above).

Having some `False` positive is also very annoying with respect to my perspective.

Vincent



---

archive/issue_comments_195754.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mezzarobba](#comment:15):\n> Replying to [@videlec](#comment:14):\n> > Here is one problem with using the symbolic ring for constants:\n> > \n> > ```\n> > sage: 0.1 * cos(pi/13)\n> > 0.100000000000000*cos(1/13*pi)\n> > ```\n> > The answer should be a floating point real number!\n\n> \n> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?\n\nBut that would be then a different case? Anyway, the non-symbolic issue is now #18697.",
    "created_at": "2015-06-14T07:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195754",
    "user": "https://github.com/rwst"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mezzarobba](#comment:15):
> Replying to [@videlec](#comment:14):
> > Here is one problem with using the symbolic ring for constants:
> > 
> > ```
> > sage: 0.1 * cos(pi/13)
> > 0.100000000000000*cos(1/13*pi)
> > ```
> > The answer should be a floating point real number!

> 
> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?

But that would be then a different case? Anyway, the non-symbolic issue is now #18697.



---

archive/issue_comments_195755.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nBack to the original issue. The actual problem is in the Pynac logic for powers where usually the Python / Cython code for `Rational.rational_power_parts` is called and used. Apparently to speed things up this is only called if a numeric computation does not return a rational (which does not work as expected).\n\nHowever, we cannot just say always use `rational_power_parts` because that is wrong too,\n\n```\nsage: from sage.rings.rational import rational_power_parts\nsage: rational_power_parts(-1,1/3)\n(1, -1)\nsage: rational_power_parts(-1,2/3)\n(1, 1)\nsage: [rational_power_parts(-1, i/77) for i in range(9)]\n[(1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1)]\n```\n\ni.e. both wrong results in the following are from independent bugs:\n\n```\nsage: SR(-1)^(2/3)\n1\nsage: QQ(-1)^(2/3)\n1\n```",
    "created_at": "2016-12-05T16:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195755",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

Back to the original issue. The actual problem is in the Pynac logic for powers where usually the Python / Cython code for `Rational.rational_power_parts` is called and used. Apparently to speed things up this is only called if a numeric computation does not return a rational (which does not work as expected).

However, we cannot just say always use `rational_power_parts` because that is wrong too,

```
sage: from sage.rings.rational import rational_power_parts
sage: rational_power_parts(-1,1/3)
(1, -1)
sage: rational_power_parts(-1,2/3)
(1, 1)
sage: [rational_power_parts(-1, i/77) for i in range(9)]
[(1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1)]
```

i.e. both wrong results in the following are from independent bugs:

```
sage: SR(-1)^(2/3)
1
sage: QQ(-1)^(2/3)
1
```



---

archive/issue_comments_195756.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe symbolic issue is https://github.com/pynac/pynac/issues/221. We can then fix the Cython code in the rational ring, as well.",
    "created_at": "2016-12-05T16:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195756",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">comment:19</div>

The symbolic issue is https://github.com/pynac/pynac/issues/221. We can then fix the Cython code in the rational ring, as well.



---

archive/issue_comments_195757.json:
```json
{
    "body": "Branch: **[u/rws/__1___2_3__evaluates_to_1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/__1___2_3__evaluates_to_1)**",
    "created_at": "2016-12-07T07:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195757",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/__1___2_3__evaluates_to_1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/__1___2_3__evaluates_to_1)**



---

archive/issue_comments_195758.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac\"><code>046c9f9</code></a></td><td><code>15605: -1 special case was badly handled</code></td></tr></table>\n",
    "created_at": "2016-12-07T07:46:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195758",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac"><code>046c9f9</code></a></td><td><code>15605: -1 special case was badly handled</code></td></tr></table>




---

archive/issue_comments_195759.json:
```json
{
    "body": "Commit: **[`046c9f9`](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)**",
    "created_at": "2016-12-07T07:46:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195759",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`046c9f9`](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)**



---

archive/issue_events_222578.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-07T07:48:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222578"
}
```



---

archive/issue_comments_195760.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2016-12-07T07:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195760",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_195761.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nActually fixing this in `rational.pyx` fixes both instances.",
    "created_at": "2016-12-07T07:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195761",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

Actually fixing this in `rational.pyx` fixes both instances.



---

archive/issue_events_222579.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-07T07:48:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222579"
}
```



---

archive/issue_events_222580.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-07T07:48:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222580"
}
```



---

archive/issue_comments_195762.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNice!\n\nSome more tests\n\n```\nsage: bool((-1)^(2/3) == -1/2 + sqrt(3)/2*I)\nTrue\nsage: all((-1)^(p/q) == cos(p*pi/q) + I * sin(p*pi/q) for p in srange(1,6) for q in srange(1,6))\nTrue\n```",
    "created_at": "2016-12-12T12:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195762",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Nice!

Some more tests

```
sage: bool((-1)^(2/3) == -1/2 + sqrt(3)/2*I)
True
sage: all((-1)^(p/q) == cos(p*pi/q) + I * sin(p*pi/q) for p in srange(1,6) for q in srange(1,6))
True
```



---

archive/issue_comments_195763.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1f15835c67e8deb34fc979d942e59e9c9e5fe66\"><code>c1f1583</code></a></td><td><code>Merge branch 'develop' into t/15605/__1___2_3__evaluates_to_1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da\"><code>69f75ec</code></a></td><td><code>more tests</code></td></tr></table>\n",
    "created_at": "2016-12-12T14:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195763",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1f15835c67e8deb34fc979d942e59e9c9e5fe66"><code>c1f1583</code></a></td><td><code>Merge branch 'develop' into t/15605/__1___2_3__evaluates_to_1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da"><code>69f75ec</code></a></td><td><code>more tests</code></td></tr></table>




---

archive/issue_comments_195764.json:
```json
{
    "body": "Changed commit from **[`046c9f9`](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)** to **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**",
    "created_at": "2016-12-12T14:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195764",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`046c9f9`](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)** to **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**



---

archive/issue_events_222581.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-12-12T14:06:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222581"
}
```



---

archive/issue_events_222582.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-12-12T14:06:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222582"
}
```



---

archive/issue_comments_195765.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\ngood enough. Thanks for the fix!",
    "created_at": "2016-12-12T14:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195765",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">comment:25</div>

good enough. Thanks for the fix!



---

archive/issue_comments_195766.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2016-12-12T14:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195766",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_195767.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThanks for the review.",
    "created_at": "2016-12-12T14:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195767",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">comment:26</div>

Thanks for the review.



---

archive/issue_events_222583.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-14T23:15:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222583"
}
```



---

archive/issue_events_222584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7f1c211b15cd11d87b25fd4ad92db6c2501ae465",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-12-14T23:15:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15605#event-222584"
}
```



---

archive/issue_comments_195768.json:
```json
{
    "body": "Changed branch from **[u/rws/__1___2_3__evaluates_to_1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/__1___2_3__evaluates_to_1)** to **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**",
    "created_at": "2016-12-14T23:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195768",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/__1___2_3__evaluates_to_1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/__1___2_3__evaluates_to_1)** to **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)**



---

archive/issue_comments_195769.json:
```json
{
    "body": "Changed commit from **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)** to none",
    "created_at": "2018-10-05T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195769",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`69f75ec`](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)** to none



---

archive/issue_comments_195770.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI disagree with the fix here. It seems to me that we really should catch more generally `(-a)^(even rational)` instead of only `(-1)^(even rational)`.",
    "created_at": "2018-10-05T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195770",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

I disagree with the fix here. It seems to me that we really should catch more generally `(-a)^(even rational)` instead of only `(-1)^(even rational)`.



---

archive/issue_comments_195771.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSee #26414 for a follow-up.",
    "created_at": "2018-10-05T17:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15605#issuecomment-195771",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

See #26414 for a follow-up.
