# Issue 15605: (-1)^(2/3) evaluates to 1

archive/issues_015368.json:
```json
{
    "body": "Likely a duplicate, but I couldn't find it elsewhere...\n\n```\nsage: (-1)^(2/3)\n1\n```\n\nOf course, this is inconsistent with virtually all interpretations and conversions of symbolic expressions...\n\n```\nsage: CC(-1)^(2/3)\n-0.500000000000000 + 0.866025403784439*I\nsage: QQbar(-1)^(2/3)\n-0.500000000000000? + 0.866025403784439?*I\nsage: RR(-1)^(2/3)\n-0.500000000000000 + 0.866025403784439*I\n```\n\nAlso:\n\n```\nsage: (-1)^(-1/3)\n-1\nsage: 1 / ((-1)^(1/3))\n-1\n```\n\n```\nsage: (-1)^(1/3)*(-1)^(1/5)\n1\n```\nbut\n\n```\nsage: (-1)^(1/15)\n(-1)^(1/15)\n```\n\nCC:  @videlec\n\nReviewer: Vincent Delecroix\n\nAuthor: Ralf Stephan\n\nBranch: 69f75eccbfeb3dbd370f382f6a4129a12a86d7da\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15605\n\n",
    "closed_at": "2016-12-14T23:15:56Z",
    "created_at": "2013-12-29T09:22:54Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "(-1)^(2/3) evaluates to 1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15605",
    "user": "https://github.com/mezzarobba"
}
```
Likely a duplicate, but I couldn't find it elsewhere...

```
sage: (-1)^(2/3)
1
```

Of course, this is inconsistent with virtually all interpretations and conversions of symbolic expressions...

```
sage: CC(-1)^(2/3)
-0.500000000000000 + 0.866025403784439*I
sage: QQbar(-1)^(2/3)
-0.500000000000000? + 0.866025403784439?*I
sage: RR(-1)^(2/3)
-0.500000000000000 + 0.866025403784439*I
```

Also:

```
sage: (-1)^(-1/3)
-1
sage: 1 / ((-1)^(1/3))
-1
```

```
sage: (-1)^(1/3)*(-1)^(1/5)
1
```
but

```
sage: (-1)^(1/15)
(-1)^(1/15)
```

CC:  @videlec

Reviewer: Vincent Delecroix

Author: Ralf Stephan

Branch: 69f75eccbfeb3dbd370f382f6a4129a12a86d7da

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15605





---

archive/issue_comments_255081.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,10 @@\n sage: RR(-1)^(2/3)\n -0.500000000000000 + 0.866025403784439*I\n ```\n+\n+Also:\n+\n+```\n+sage: (-1)^(-1/3)\n+-1\n+```\n``````\n",
    "created_at": "2013-12-29T09:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255081",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,10 @@
 sage: RR(-1)^(2/3)
 -0.500000000000000 + 0.866025403784439*I
 ```
+
+Also:
+
+```
+sage: (-1)^(-1/3)
+-1
+```
``````




---

archive/issue_comments_255082.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,9 @@\n sage: (-1)^(-1/3)\n -1\n ```\n+\n+```\n+sage: (-1)^(1/3)*(-1)^(1/5)\n+1\n+```\n+}}}\n``````\n",
    "created_at": "2013-12-29T09:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255082",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,9 @@
 sage: (-1)^(-1/3)
 -1
 ```
+
+```
+sage: (-1)^(1/3)*(-1)^(1/5)
+1
+```
+}}}
``````




---

archive/issue_events_052175.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52175"
}
```



---

archive/issue_comments_255083.json:
```json
{
    "body": "<a id='comment:4'></a>\nSeems to be a problem about \"even\" powers:\n\n```\nsage: [(-1)^(i/77) for i in range(9)]\n[1, (-1)^(1/77), 1, (-1)^(3/77), 1, (-1)^(5/77), 1, (-1)^(1/11), 1]\n```",
    "created_at": "2014-03-07T21:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255083",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
Seems to be a problem about "even" powers:

```
sage: [(-1)^(i/77) for i in range(9)]
[1, (-1)^(1/77), 1, (-1)^(3/77), 1, (-1)^(5/77), 1, (-1)^(1/11), 1]
```



---

archive/issue_comments_255084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,4 +27,3 @@\n sage: (-1)^(1/3)*(-1)^(1/5)\n 1\n ```\n-}}}\n``````\n",
    "created_at": "2014-03-07T21:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255084",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,4 +27,3 @@
 sage: (-1)^(1/3)*(-1)^(1/5)
 1
 ```
-}}}
``````




---

archive/issue_events_052176.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52176"
}
```



---

archive/issue_events_052177.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52177"
}
```



---

archive/issue_events_052178.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52178"
}
```



---

archive/issue_events_052179.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52179"
}
```



---

archive/issue_comments_255085.json:
```json
{
    "body": "Replying to [ticket:15605 mmezzarobba]:\n> Likely a duplicate, but I couldn't find it elsewhere...\n\n\nIt is indeed a known issue since at least [this ask answer](http://ask.sagemath.org/question/10063/get-variants-of-complex-cube-root/?answer=14842#post-id-14842), and i use this example in my presentations about Sage and the need to define objects within a reliable parent. \n\nI did not report that on trac because this is somehow a feature of the symbolic ring : no semantics. I remember a discussion with you at sd49 (Orsay) about that precise example and the benefits (or not!) of having such kind of symbolic expressions that are able to make all kind of simplifications/derivatives/evaluations without context.\n\nIf one want to have something that both:\n- applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n- takes principal branches of multi-valued complex function when evaluating,\nthen we should accept that kind of behaviour.\n\nIt would however be awesome to have a well-designed object to work with holomorphic functions, along the same lines that what is done with polynomials, i guess it is a very hard task, and i do not know whether there exists libraries for that.",
    "created_at": "2015-04-07T23:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255085",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [ticket:15605 mmezzarobba]:
> Likely a duplicate, but I couldn't find it elsewhere...


It is indeed a known issue since at least [this ask answer](http://ask.sagemath.org/question/10063/get-variants-of-complex-cube-root/?answer=14842#post-id-14842), and i use this example in my presentations about Sage and the need to define objects within a reliable parent. 

I did not report that on trac because this is somehow a feature of the symbolic ring : no semantics. I remember a discussion with you at sd49 (Orsay) about that precise example and the benefits (or not!) of having such kind of symbolic expressions that are able to make all kind of simplifications/derivatives/evaluations without context.

If one want to have something that both:
- applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,
- takes principal branches of multi-valued complex function when evaluating,
then we should accept that kind of behaviour.

It would however be awesome to have a well-designed object to work with holomorphic functions, along the same lines that what is done with polynomials, i guess it is a very hard task, and i do not know whether there exists libraries for that.



---

archive/issue_comments_255086.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tmonteil](#comment%3A7):\n> If one want to have something that both:\n> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n> - takes principal branches of multi-valued complex function when evaluating,\n> then we should accept that kind of behaviour.\n\nI think that with `bc` numeric (and it only makes sense to me if rational) and `a` negative the rule `a^(bc) = (a<sup>b)</sup>c` should not be applied simply because then `a^b` loses information. With symbolic exponent the user will probaby expect simplification.",
    "created_at": "2015-04-08T06:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255086",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
Replying to [tmonteil](#comment%3A7):
> If one want to have something that both:
> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,
> - takes principal branches of multi-valued complex function when evaluating,
> then we should accept that kind of behaviour.

I think that with `bc` numeric (and it only makes sense to me if rational) and `a` negative the rule `a^(bc) = (a<sup>b)</sup>c` should not be applied simply because then `a^b` loses information. With symbolic exponent the user will probaby expect simplification.



---

archive/issue_comments_255087.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [tmonteil](#comment%3A7):\n> this is somehow a feature of the symbolic ring : no semantics.\n\n\nI agree in part only. Sure, general symbolic expressions have very weak semantics\u2014essentially, I view them as straight-line programs that are just required to evaluate to what you'd expect when you assign values to free variables. Many *operations* on symbolic expressions, however, only make sense with stronger assumptions on the expressions. Typically, simplifications are supposed to transform these \u201dprograms\u201c into \u201dequivalent\u201c ones, but of course whether two \u201dprograms\u201c are equivalent depends on what the variables can represent.\n\nThe sensible thing to do IMO is to view all variables as complex by default, and require simplifications to be valid for arbitrary complex values of all variables (or more accurately, for a generic choice of complex values: for example, we probably do want `x/x` to simplify to `1`). At least what's what Maple does, and Maple arguably has the best implementation of \u201dgeneral symbolic expressions\u201d over there.\n\nWe'll still get nonsense in many cases when trying to simplify expressions containing constants from finite fields or other parents that do not fit well into this model, but I don't know how to avoid that. (Something that may be worth trying would be to define new symbolic \u201drings\u201c parametrized by a parent. For instance, in `SR(QQ)`, all variables would be assumed to represent elements of `QQ`, constants would automatically be coerced into `QQ`, and arithmetic operations between constants would take place there. But that's not how the existing `SR` works.)\n\n> If one want to have something that both:\n> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,\n\n\nI don't think we want that. IMO this rule should be applied only if either assumptions on `a`, `b`, `c` make it safe (e.g., `c` is known to be an integer) or the user explicitely asked for it. Of course, safe simplification routines are more cumbersome to use. To mitigate the issue, Maple's `simplify` accepts an option (`symbolic`) that tells it to disregard all analytical issues related to multivalued functions and just take any branch it likes. Something like that would be convenient in Sage as well.",
    "created_at": "2015-04-08T08:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255087",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
Replying to [tmonteil](#comment%3A7):
> this is somehow a feature of the symbolic ring : no semantics.


I agree in part only. Sure, general symbolic expressions have very weak semantics—essentially, I view them as straight-line programs that are just required to evaluate to what you'd expect when you assign values to free variables. Many *operations* on symbolic expressions, however, only make sense with stronger assumptions on the expressions. Typically, simplifications are supposed to transform these ”programs“ into ”equivalent“ ones, but of course whether two ”programs“ are equivalent depends on what the variables can represent.

The sensible thing to do IMO is to view all variables as complex by default, and require simplifications to be valid for arbitrary complex values of all variables (or more accurately, for a generic choice of complex values: for example, we probably do want `x/x` to simplify to `1`). At least what's what Maple does, and Maple arguably has the best implementation of ”general symbolic expressions” over there.

We'll still get nonsense in many cases when trying to simplify expressions containing constants from finite fields or other parents that do not fit well into this model, but I don't know how to avoid that. (Something that may be worth trying would be to define new symbolic ”rings“ parametrized by a parent. For instance, in `SR(QQ)`, all variables would be assumed to represent elements of `QQ`, constants would automatically be coerced into `QQ`, and arithmetic operations between constants would take place there. But that's not how the existing `SR` works.)

> If one want to have something that both:
> - applies rules such as `a^(bc) = (a<sup>b)</sup>c` systematically,


I don't think we want that. IMO this rule should be applied only if either assumptions on `a`, `b`, `c` make it safe (e.g., `c` is known to be an integer) or the user explicitely asked for it. Of course, safe simplification routines are more cumbersome to use. To mitigate the issue, Maple's `simplify` accepts an option (`symbolic`) that tells it to disregard all analytical issues related to multivalued functions and just take any branch it likes. Something like that would be convenient in Sage as well.



---

archive/issue_comments_255088.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,9 +21,17 @@\n ```\n sage: (-1)^(-1/3)\n -1\n+sage: 1 / ((-1)^(1/3))\n+-1\n ```\n \n ```\n sage: (-1)^(1/3)*(-1)^(1/5)\n 1\n ```\n+but\n+\n+```\n+sage: (-1)^(1/15)\n+(-1)^(1/15)\n+```\n``````\n",
    "created_at": "2015-04-08T08:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255088",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,9 +21,17 @@
 ```
 sage: (-1)^(-1/3)
 -1
+sage: 1 / ((-1)^(1/3))
+-1
 ```
 
 ```
 sage: (-1)^(1/3)*(-1)^(1/5)
 1
 ```
+but
+
+```
+sage: (-1)^(1/15)
+(-1)^(1/15)
+```
``````




---

archive/issue_comments_255089.json:
```json
{
    "body": "<a id='comment:12'></a>\nJust to give some concrete motivations, in #16222 (and #17516) we need a rather small subsets of symbolic expressions that modelize (some) algebraic numbers. Namely:\n- no variable\n- rational coefficients\n- I\n- exp(2*I*pi*a), cos(2*pi*a), sin(2*pi*a) with a rational\n- rational powers\n- taking real and imaginary parts\n\nAn example of such expression is\n\n```\n((cos(pi/7) + (-1)^(1/3))^(2/3)).real()\n```\n\nDo you think this must be out of the symbolic ring?\n\nVincent",
    "created_at": "2015-04-08T09:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255089",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
Just to give some concrete motivations, in #16222 (and #17516) we need a rather small subsets of symbolic expressions that modelize (some) algebraic numbers. Namely:
- no variable
- rational coefficients
- I
- exp(2*I*pi*a), cos(2*pi*a), sin(2*pi*a) with a rational
- rational powers
- taking real and imaginary parts

An example of such expression is

```
((cos(pi/7) + (-1)^(1/3))^(2/3)).real()
```

Do you think this must be out of the symbolic ring?

Vincent



---

archive/issue_comments_255090.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vdelecroix](#comment%3A12):\n> Do you think this must be out of the symbolic ring?\n\n\nI for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.",
    "created_at": "2015-04-08T16:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255090",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:13'></a>
Replying to [vdelecroix](#comment%3A12):
> Do you think this must be out of the symbolic ring?


I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.



---

archive/issue_comments_255091.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mmezzarobba](#comment%3A13):\n> Replying to [vdelecroix](#comment%3A12):\n> > Do you think this must be out of the symbolic ring?\n\n> \n> I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.\n\n\nHere is one problem with using the symbolic ring for constants:\n\n```\nsage: 0.1 * cos(pi/13)\n0.100000000000000*cos(1/13*pi)\n```\nThe answer should be a floating point real number!\n\nVincent",
    "created_at": "2015-04-10T11:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255091",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Replying to [mmezzarobba](#comment%3A13):
> Replying to [vdelecroix](#comment%3A12):
> > Do you think this must be out of the symbolic ring?

> 
> I for one don't really see a problem with using the symbolic ring, but it depends if you have more use cases in mind.


Here is one problem with using the symbolic ring for constants:

```
sage: 0.1 * cos(pi/13)
0.100000000000000*cos(1/13*pi)
```
The answer should be a floating point real number!

Vincent



---

archive/issue_comments_255092.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [vdelecroix](#comment%3A14):\n> Here is one problem with using the symbolic ring for constants:\n> \n> ```\n> sage: 0.1 * cos(pi/13)\n> 0.100000000000000*cos(1/13*pi)\n> ```\n> The answer should be a floating point real number!\n\n\nYes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?",
    "created_at": "2015-04-10T14:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255092",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:15'></a>
Replying to [vdelecroix](#comment%3A14):
> Here is one problem with using the symbolic ring for constants:
> 
> ```
> sage: 0.1 * cos(pi/13)
> 0.100000000000000*cos(1/13*pi)
> ```
> The answer should be a floating point real number!


Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?



---

archive/issue_comments_255093.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mmezzarobba](#comment%3A15):\n> Replying to [vdelecroix](#comment%3A14):\n> > Here is one problem with using the symbolic ring for constants:\n> > \n> > ```\n> > sage: 0.1 * cos(pi/13)\n> > 0.100000000000000*cos(1/13*pi)\n> > ```\n> > The answer should be a floating point real number!\n\n> \n> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?\n\n\n`0.1 * x * cos(pi/13)` should be an element of the symbolic ring (which might not necessarily be equal to `0.1 * cos(pi/13) * x`). As soon as a variable appear, just go to the symbolic ring. I do not want to remove it, just to get off some part of it that would make something coherent.\n\nThis is why I am arguing for having a new intermediate world:\n- symbolic ring (the same as today),\n- some rings of symbolic constants, explicitely embedded in RR or CC, in which equality is known to be decidable (for example the one I mentioned above).\n\nHaving some `False` positive is also very annoying with respect to my perspective.\n\nVincent",
    "created_at": "2015-04-10T15:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255093",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Replying to [mmezzarobba](#comment%3A15):
> Replying to [vdelecroix](#comment%3A14):
> > Here is one problem with using the symbolic ring for constants:
> > 
> > ```
> > sage: 0.1 * cos(pi/13)
> > 0.100000000000000*cos(1/13*pi)
> > ```
> > The answer should be a floating point real number!

> 
> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?


`0.1 * x * cos(pi/13)` should be an element of the symbolic ring (which might not necessarily be equal to `0.1 * cos(pi/13) * x`). As soon as a variable appear, just go to the symbolic ring. I do not want to remove it, just to get off some part of it that would make something coherent.

This is why I am arguing for having a new intermediate world:
- symbolic ring (the same as today),
- some rings of symbolic constants, explicitely embedded in RR or CC, in which equality is known to be decidable (for example the one I mentioned above).

Having some `False` positive is also very annoying with respect to my perspective.

Vincent



---

archive/issue_comments_255094.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mmezzarobba](#comment%3A15):\n> Replying to [vdelecroix](#comment%3A14):\n> > Here is one problem with using the symbolic ring for constants:\n> > \n> > ```\n> > sage: 0.1 * cos(pi/13)\n> > 0.100000000000000*cos(1/13*pi)\n> > ```\n> > The answer should be a floating point real number!\n\n> \n> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?\n\nBut that would be then a different case? Anyway, the non-symbolic issue is now #18697.",
    "created_at": "2015-06-14T07:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255094",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>
Replying to [mmezzarobba](#comment%3A15):
> Replying to [vdelecroix](#comment%3A14):
> > Here is one problem with using the symbolic ring for constants:
> > 
> > ```
> > sage: 0.1 * cos(pi/13)
> > 0.100000000000000*cos(1/13*pi)
> > ```
> > The answer should be a floating point real number!

> 
> Yes, perhaps, I'm not sure. Perhaps it should be a symbolic expression wrapping a FP number. Or perhaps it should just stay unevaluated. For instance, if `0.1 * cos(pi/13)` evaluates to a FP number, what should  `0.1 * x * cos(pi/13)` do?

But that would be then a different case? Anyway, the non-symbolic issue is now #18697.



---

archive/issue_comments_255095.json:
```json
{
    "body": "<a id='comment:18'></a>\nBack to the original issue. The actual problem is in the Pynac logic for powers where usually the Python / Cython code for `Rational.rational_power_parts` is called and used. Apparently to speed things up this is only called if a numeric computation does not return a rational (which does not work as expected).\n\nHowever, we cannot just say always use `rational_power_parts` because that is wrong too,\n\n```\nsage: from sage.rings.rational import rational_power_parts\nsage: rational_power_parts(-1,1/3)\n(1, -1)\nsage: rational_power_parts(-1,2/3)\n(1, 1)\nsage: [rational_power_parts(-1, i/77) for i in range(9)]\n[(1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1)]\n```\n\ni.e. both wrong results in the following are from independent bugs:\n\n```\nsage: SR(-1)^(2/3)\n1\nsage: QQ(-1)^(2/3)\n1\n```",
    "created_at": "2016-12-05T16:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255095",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
Back to the original issue. The actual problem is in the Pynac logic for powers where usually the Python / Cython code for `Rational.rational_power_parts` is called and used. Apparently to speed things up this is only called if a numeric computation does not return a rational (which does not work as expected).

However, we cannot just say always use `rational_power_parts` because that is wrong too,

```
sage: from sage.rings.rational import rational_power_parts
sage: rational_power_parts(-1,1/3)
(1, -1)
sage: rational_power_parts(-1,2/3)
(1, 1)
sage: [rational_power_parts(-1, i/77) for i in range(9)]
[(1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1), (1, -1), (1, 1)]
```

i.e. both wrong results in the following are from independent bugs:

```
sage: SR(-1)^(2/3)
1
sage: QQ(-1)^(2/3)
1
```



---

archive/issue_comments_255096.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe symbolic issue is https://github.com/pynac/pynac/issues/221. We can then fix the Cython code in the rational ring, as well.",
    "created_at": "2016-12-05T16:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255096",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
The symbolic issue is https://github.com/pynac/pynac/issues/221. We can then fix the Cython code in the rational ring, as well.



---

archive/issue_comments_255097.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/__1___2_3__evaluates_to_1\"",
    "created_at": "2016-12-07T07:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255097",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/__1___2_3__evaluates_to_1"



---

archive/issue_comments_255098.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[046c9f9](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)|`15605: -1 special case was badly handled`|",
    "created_at": "2016-12-07T07:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[046c9f9](https://github.com/sagemath/sagetrac-mirror/commit/046c9f9c4c8e465af7ed5799267b4162639f7eac)|`15605: -1 special case was badly handled`|



---

archive/issue_comments_255099.json:
```json
{
    "body": "Changing commit from \"\" to \"046c9f9c4c8e465af7ed5799267b4162639f7eac\"",
    "created_at": "2016-12-07T07:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "046c9f9c4c8e465af7ed5799267b4162639f7eac"



---

archive/issue_comments_255100.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-07T07:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255100",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_255101.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2016-12-07T07:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255101",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_255102.json:
```json
{
    "body": "<a id='comment:22'></a>\nActually fixing this in `rational.pyx` fixes both instances.",
    "created_at": "2016-12-07T07:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255102",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Actually fixing this in `rational.pyx` fixes both instances.



---

archive/issue_events_052180.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-07T07:48:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52180"
}
```



---

archive/issue_events_052181.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-12-07T07:48:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52181"
}
```



---

archive/issue_comments_255103.json:
```json
{
    "body": "<a id='comment:23'></a>\nNice!\n\nSome more tests\n\n```\nsage: bool((-1)^(2/3) == -1/2 + sqrt(3)/2*I)\nTrue\nsage: all((-1)^(p/q) == cos(p*pi/q) + I * sin(p*pi/q) for p in srange(1,6) for q in srange(1,6))\nTrue\n```",
    "created_at": "2016-12-12T12:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255103",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Nice!

Some more tests

```
sage: bool((-1)^(2/3) == -1/2 + sqrt(3)/2*I)
True
sage: all((-1)^(p/q) == cos(p*pi/q) + I * sin(p*pi/q) for p in srange(1,6) for q in srange(1,6))
True
```



---

archive/issue_comments_255104.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[c1f1583](https://github.com/sagemath/sagetrac-mirror/commit/c1f15835c67e8deb34fc979d942e59e9c9e5fe66)|`Merge branch 'develop' into t/15605/__1___2_3__evaluates_to_1`|\n|[69f75ec](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)|`more tests`|",
    "created_at": "2016-12-12T14:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[c1f1583](https://github.com/sagemath/sagetrac-mirror/commit/c1f15835c67e8deb34fc979d942e59e9c9e5fe66)|`Merge branch 'develop' into t/15605/__1___2_3__evaluates_to_1`|
|[69f75ec](https://github.com/sagemath/sagetrac-mirror/commit/69f75eccbfeb3dbd370f382f6a4129a12a86d7da)|`more tests`|



---

archive/issue_comments_255105.json:
```json
{
    "body": "Changing commit from \"046c9f9c4c8e465af7ed5799267b4162639f7eac\" to \"69f75eccbfeb3dbd370f382f6a4129a12a86d7da\"",
    "created_at": "2016-12-12T14:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "046c9f9c4c8e465af7ed5799267b4162639f7eac" to "69f75eccbfeb3dbd370f382f6a4129a12a86d7da"



---

archive/issue_comments_255106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-12T14:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255106",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_255107.json:
```json
{
    "body": "<a id='comment:25'></a>\ngood enough. Thanks for the fix!",
    "created_at": "2016-12-12T14:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255107",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
good enough. Thanks for the fix!



---

archive/issue_comments_255108.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2016-12-12T14:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255108",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_255109.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks for the review.",
    "created_at": "2016-12-12T14:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255109",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'></a>
Thanks for the review.



---

archive/issue_events_052182.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-14T23:15:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15605#event-52182"
}
```



---

archive/issue_comments_255110.json:
```json
{
    "body": "Changing branch from \"u/rws/__1___2_3__evaluates_to_1\" to \"69f75eccbfeb3dbd370f382f6a4129a12a86d7da\"",
    "created_at": "2016-12-14T23:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255110",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/__1___2_3__evaluates_to_1" to "69f75eccbfeb3dbd370f382f6a4129a12a86d7da"



---

archive/issue_comments_255111.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-14T23:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255111",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_255112.json:
```json
{
    "body": "Changing commit from \"69f75eccbfeb3dbd370f382f6a4129a12a86d7da\" to \"\"",
    "created_at": "2018-10-05T15:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255112",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "69f75eccbfeb3dbd370f382f6a4129a12a86d7da" to ""



---

archive/issue_comments_255113.json:
```json
{
    "body": "<a id='comment:28'></a>\nI disagree with the fix here. It seems to me that we really should catch more generally `(-a)^(even rational)` instead of only `(-1)^(even rational)`.",
    "created_at": "2018-10-05T15:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255113",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
I disagree with the fix here. It seems to me that we really should catch more generally `(-a)^(even rational)` instead of only `(-1)^(even rational)`.



---

archive/issue_comments_255114.json:
```json
{
    "body": "<a id='comment:29'></a>\nSee #26414 for a follow-up.",
    "created_at": "2018-10-05T17:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15605#issuecomment-255114",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
See #26414 for a follow-up.
