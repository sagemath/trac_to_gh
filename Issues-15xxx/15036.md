# Issue 15036: Speed up matrix repr for matrices larger than 20

archive/issues_014799.json:
```json
{
    "assignees": [],
    "body": "See this [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/Gnw389Bd-0k/bqprN5AxtK8J).\n\nSage has a very nice feature where it tries to not print all entries of a large matrix:\n\n```\nsage: A=matrix(20,20,[2]*400)\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\n```\nBut, as you see, Sage has to do some magic to know that `A` refers to the matrix in question. Indeed, in other situations it won't find a useful name:\n\n```\nsage: B=A\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)\n```\nThe process of finding a name consists of trawling through all \"globals\" dictionaries on the call stack. This is an incredibly expensive operation which also breaks python's programming model: reverse lookups of bindings are not part of the language specification.\n\nThe main concern here is that string representations may not actually make it to an output stream: they may be part of a (perhaps poorly constructed) exception message that gets caught. Fixing the exception message may not be an option, since some of these happen internally in python. TO illustrate the dramatic effect, consider:\n\n```\nsage: def t(depth,N,n):\n....:         if depth:\n....:                 return t(depth-1,N,n)\n....:         else:\n....:                 G = matrix([[2 for u in range(N)] for v in range(N)])\n....:                 for i in range(n):\n....:                         _=repr(G)\n```\nTrying it with a flat call stack is already showing that the repr of a 20x20 matrix is much more expensive to produce than for a 19x19 matrix (a factor 80):\n\n```             \nsage: timeit('t(0,19,10)')\n125 loops, best of 3: 2.14 ms per loop\nsage: timeit('t(0,20,10)')\n5 loops, best of 3: 172 ms per loop\n```\nWith a deep call stack this gets even more pronounced:\n\n```\nsage: sage: timeit('t(100,19,10)') \n125 loops, best of 3: 2.22 ms per loop\nsage: timeit('t(100,20,10)') \n5 loops, best of 3: 5.45 s per loop\n```\n\n\nBranch/Commit: **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**\n\nReviewer: **Travis Scrimshaw, Nathann Cohen**\n\nAuthor: **Nils Bruin**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/15036_\n\n",
    "closed_at": "2014-05-13T08:42:09Z",
    "created_at": "2013-08-11T20:26:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up matrix repr for matrices larger than 20",
    "type": "issue",
    "updated_at": "2014-05-13T08:42:09Z",
    "url": "https://github.com/sagemath/sage/issues/15036",
    "user": "https://github.com/nbruin"
}
```
See this [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/Gnw389Bd-0k/bqprN5AxtK8J).

Sage has a very nice feature where it tries to not print all entries of a large matrix:

```
sage: A=matrix(20,20,[2]*400)
sage: A
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
```
But, as you see, Sage has to do some magic to know that `A` refers to the matrix in question. Indeed, in other situations it won't find a useful name:

```
sage: B=A
sage: A
20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)
```
The process of finding a name consists of trawling through all "globals" dictionaries on the call stack. This is an incredibly expensive operation which also breaks python's programming model: reverse lookups of bindings are not part of the language specification.

The main concern here is that string representations may not actually make it to an output stream: they may be part of a (perhaps poorly constructed) exception message that gets caught. Fixing the exception message may not be an option, since some of these happen internally in python. TO illustrate the dramatic effect, consider:

```
sage: def t(depth,N,n):
....:         if depth:
....:                 return t(depth-1,N,n)
....:         else:
....:                 G = matrix([[2 for u in range(N)] for v in range(N)])
....:                 for i in range(n):
....:                         _=repr(G)
```
Trying it with a flat call stack is already showing that the repr of a 20x20 matrix is much more expensive to produce than for a 19x19 matrix (a factor 80):

```             
sage: timeit('t(0,19,10)')
125 loops, best of 3: 2.14 ms per loop
sage: timeit('t(0,20,10)')
5 loops, best of 3: 172 ms per loop
```
With a deep call stack this gets even more pronounced:

```
sage: sage: timeit('t(100,19,10)') 
125 loops, best of 3: 2.22 ms per loop
sage: timeit('t(100,20,10)') 
5 loops, best of 3: 5.45 s per loop
```


Branch/Commit: **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**

Reviewer: **Travis Scrimshaw, Nathann Cohen**

Author: **Nils Bruin**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/15036_





---

archive/issue_events_213476.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-08-11T20:26:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213476"
}
```



---

archive/issue_events_213477.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-08-11T20:26:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213477"
}
```



---

archive/issue_events_213478.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-08-11T20:26:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213478"
}
```



---

archive/issue_events_213479.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-08-11T20:26:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213479"
}
```



---

archive/issue_comments_184608.json:
```json
{
    "body": "Attachment: **[15036-matrix_repr_fix.patch.gz](https://github.com/sagemath/sage/files/ticket15036/15036-matrix_repr_fix.patch.gz)**\n\nMake matrix repr for large matrices not trawl the call stack",
    "created_at": "2013-08-11T20:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184608",
    "user": "https://github.com/nbruin"
}
```

Attachment: **[15036-matrix_repr_fix.patch.gz](https://github.com/sagemath/sage/files/ticket15036/15036-matrix_repr_fix.patch.gz)**

Make matrix repr for large matrices not trawl the call stack



---

archive/issue_comments_184609.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nStraightforward patch attached. Probably needs some doctest fixes.",
    "created_at": "2013-08-11T20:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184609",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:1" align="right">comment:1</div>

Straightforward patch attached. Probably needs some doctest fixes.



---

archive/issue_events_213480.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-08-11T20:40:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213480"
}
```



---

archive/issue_comments_184610.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n\n```\nsage -t devel/sage/sage/schemes/elliptic_curves/heegner.py  # 2 doctests failed\nsage -t devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed\nsage -t devel/sage/sage/misc/sageinspect.py  # 2 doctests failed\nsage -t devel/sage/sage/modular/modsym/ambient.py  # 3 doctests failed\nsage -t devel/sage/sage/matrix/constructor.py  # 1 doctest failed\nsage -t devel/sage/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/modular/hecke/hecke_operator.py  # 1 doctest failed\nsage -t devel/sage/sage/algebras/steenrod/steenrod_algebra_bases.py  # 2 doctests failed\nsage -t devel/sage/sage/matrix/matrix0.pyx  # 5 doctests failed\nsage -t devel/sage/sage/homology/chain_complex.py  # 1 doctest failed\nsage -t devel/sage/sage/modules/free_module_morphism.py  # 1 doctest failed\nsage -t devel/sage/sage/modular/modsym/relation_matrix.py  # 3 doctests failed\nsage -t devel/sage/sage/modular/hecke/degenmap.py  # 1 doctest failed\n```\nMost of the doctest failures outside of `matrix0.pyx` are of the form\n\n```\nExpected:\n    Vector space of degree 20 and dimension 20 over Rational Field\n    Basis matrix:\n    20 x 20 dense matrix over Rational Field\nGot:\n    Vector space of degree 20 and dimension 20 over Rational Field\n    Basis matrix:\n    20 x 20 dense matrix over Rational Field (type '<matrix>.str()' to see all of the entries)\n```\nwhich suggests that not including a message about `.str()` may be more appropriate.\n\n**A wild thought:** If people feel saying something about `.str()` is really necessary for output printed by the IPython REPL or notebook output, perhaps we should put in a hook on those to do a name lookup in `globals` there. In that case, we'd still get\n\n```\nsage: A = <large matrix>\nsage: A\n* x * matrix over * (type 'print A.str()' to see all entries)\n```\nbut this would happen because TOP LEVEL recognizes it's printing a string representation that may not fully reflect the value. Certainly, TOP LEVEL looking in globals() wouldn't be so bad, AND it wouldn't need to look in stack frames to find what globals dictionary is appropriate.",
    "created_at": "2013-08-11T22:26:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184610",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:3" align="right">comment:3</div>


```
sage -t devel/sage/sage/schemes/elliptic_curves/heegner.py  # 2 doctests failed
sage -t devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed
sage -t devel/sage/sage/misc/sageinspect.py  # 2 doctests failed
sage -t devel/sage/sage/modular/modsym/ambient.py  # 3 doctests failed
sage -t devel/sage/sage/matrix/constructor.py  # 1 doctest failed
sage -t devel/sage/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/modular/hecke/hecke_operator.py  # 1 doctest failed
sage -t devel/sage/sage/algebras/steenrod/steenrod_algebra_bases.py  # 2 doctests failed
sage -t devel/sage/sage/matrix/matrix0.pyx  # 5 doctests failed
sage -t devel/sage/sage/homology/chain_complex.py  # 1 doctest failed
sage -t devel/sage/sage/modules/free_module_morphism.py  # 1 doctest failed
sage -t devel/sage/sage/modular/modsym/relation_matrix.py  # 3 doctests failed
sage -t devel/sage/sage/modular/hecke/degenmap.py  # 1 doctest failed
```
Most of the doctest failures outside of `matrix0.pyx` are of the form

```
Expected:
    Vector space of degree 20 and dimension 20 over Rational Field
    Basis matrix:
    20 x 20 dense matrix over Rational Field
Got:
    Vector space of degree 20 and dimension 20 over Rational Field
    Basis matrix:
    20 x 20 dense matrix over Rational Field (type '<matrix>.str()' to see all of the entries)
```
which suggests that not including a message about `.str()` may be more appropriate.

**A wild thought:** If people feel saying something about `.str()` is really necessary for output printed by the IPython REPL or notebook output, perhaps we should put in a hook on those to do a name lookup in `globals` there. In that case, we'd still get

```
sage: A = <large matrix>
sage: A
* x * matrix over * (type 'print A.str()' to see all entries)
```
but this would happen because TOP LEVEL recognizes it's printing a string representation that may not fully reflect the value. Certainly, TOP LEVEL looking in globals() wouldn't be so bad, AND it wouldn't need to look in stack frames to find what globals dictionary is appropriate.



---

archive/issue_comments_184611.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSecond attachment regains interactive printing. With the notebook fix suggested on #14469, this should work in the notebook as well.",
    "created_at": "2013-08-11T23:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184611",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

Second attachment regains interactive printing. With the notebook fix suggested on #14469, this should work in the notebook as well.



---

archive/issue_comments_184612.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\npatchbot apply 15036-display_hook_fix.patch\n\nPersonally, I wouldn't mind the original patch either. This new patch does stay a little closer to the original output, though.",
    "created_at": "2013-08-11T23:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184612",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:5" align="right">comment:5</div>

patchbot apply 15036-display_hook_fix.patch

Personally, I wouldn't mind the original patch either. This new patch does stay a little closer to the original output, though.



---

archive/issue_comments_184613.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOnly a few doctests to amend with the new patch:\n\n```\nsage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix0.pyx  # 3 doctests failed\n```\nIf people are OK with the proposed fix, I'll upload a patch fixing the doctests.",
    "created_at": "2013-08-11T23:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184613",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

Only a few doctests to amend with the new patch:

```
sage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix0.pyx  # 3 doctests failed
```
If people are OK with the proposed fix, I'll upload a patch fixing the doctests.



---

archive/issue_comments_184614.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nMy 2 cents.\n\n1. I like that large matrices do not get printed entirely without being requested explicitly.\n2. Even with a helpful message, I see students who wonder why they do not get the whole matrix.  So I would rather not see the bare output\n\n```\n20 x 20 dense matrix over Rational Field\n```\n3.  I think it is less important to see the actual name of the matrix parroted in the output (the source of the inefficiency here).  So something like the following would be sufficient in my eyes, if it was easier to code/maintain:\n\n```\n20 x 20 dense matrix over Rational Field (use the '.str()' method to see all of the entries)\n```\n\nThanks for cleaning this up.\n\nRob",
    "created_at": "2013-08-12T17:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184614",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:7" align="right">comment:7</div>

My 2 cents.

1. I like that large matrices do not get printed entirely without being requested explicitly.
2. Even with a helpful message, I see students who wonder why they do not get the whole matrix.  So I would rather not see the bare output

```
20 x 20 dense matrix over Rational Field
```
3.  I think it is less important to see the actual name of the matrix parroted in the output (the source of the inefficiency here).  So something like the following would be sufficient in my eyes, if it was easier to code/maintain:

```
20 x 20 dense matrix over Rational Field (use the '.str()' method to see all of the entries)
```

Thanks for cleaning this up.

Rob



---

archive/issue_comments_184615.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks for the feedback.\n\n**UNPATCHED BEHAVIOUR:**\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: A=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]\nsage: B=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)]\n```\nwhere you can see:\n- No printing tip if no direct binding is found\n- Printing of an explicit name if a unique direct binding is found\n- Printing of a generic `obj` name designator if more than one direct binding was found.\n\nThis all with an excessively verbose:\n\n```\nsage: L=[matrix(20,20,[2]*400)]*10\nsage: A=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]\n```\n\n**WITH THE PATCH:**\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: A=L[0]\nsage: print A\n20 x 20 dense matrix over Integer Ring\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\nsage: B=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)\n```\n\nThus:\n- If the value returned is not a matrix itself (but for instance, a list with matrices in it), no tip is printed. I think that's appropriate.\n- Since the print hook of the interface is the routine that appends the message, a straight print statement never included the tip either\n- If the value itself is a matrix then the tip is included according to the rules that applied before.\n\nI think this is preferable to the old behaviour because\n- we're losing the inefficiency in most string productions\n- the tip is often annoying in list printing. That matrices are abbreviated in a list environment is understandable, I think. People will naturally try to look at the matrix itself if they are interested in the value.\n- we're still getting the tip in most cases where it's likely to be useful.\n\nWe can implement Beezer's static suggestion in the displayhook, which will be more efficient (although that is not so important) and more appropriate. In that case we would get:\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: A=L[0]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: print L[0]\n20 x 20 dense matrix over Integer Ring\n```\n\nI think this is the best solution, because:\n- It provides a useful tip consistently in a minimal case: when a matrix value is returned that gets printed in abbreviated form.\n- It provides a tip that's always correct, regardless of what bindings exist (and indeed, what bindings exist is immaterial for the problem that the user is facing)\n- We won't be digging around in the globals or the call stack without explicitly being asked to do so.\n\nSo should we go for that then?\n\nIncidentally, I think `.str()` is an awful name for this method. The fact that `str(M)` and `M.str()` do similar but different things is a horrible trap. Also, `.str` and `.__str__` are too similar to both exist but be different. I don't have a direct alternative in mind, nor the inclination to follow through on the horrible deprecation process that would be required to remove this wart, though.",
    "created_at": "2013-08-12T18:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184615",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks for the feedback.

**UNPATCHED BEHAVIOUR:**

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: A=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]
sage: B=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)]
```
where you can see:
- No printing tip if no direct binding is found
- Printing of an explicit name if a unique direct binding is found
- Printing of a generic `obj` name designator if more than one direct binding was found.

This all with an excessively verbose:

```
sage: L=[matrix(20,20,[2]*400)]*10
sage: A=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]
```

**WITH THE PATCH:**

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: A=L[0]
sage: print A
20 x 20 dense matrix over Integer Ring
sage: A
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
sage: B=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)
```

Thus:
- If the value returned is not a matrix itself (but for instance, a list with matrices in it), no tip is printed. I think that's appropriate.
- Since the print hook of the interface is the routine that appends the message, a straight print statement never included the tip either
- If the value itself is a matrix then the tip is included according to the rules that applied before.

I think this is preferable to the old behaviour because
- we're losing the inefficiency in most string productions
- the tip is often annoying in list printing. That matrices are abbreviated in a list environment is understandable, I think. People will naturally try to look at the matrix itself if they are interested in the value.
- we're still getting the tip in most cases where it's likely to be useful.

We can implement Beezer's static suggestion in the displayhook, which will be more efficient (although that is not so important) and more appropriate. In that case we would get:

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: A=L[0]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: print L[0]
20 x 20 dense matrix over Integer Ring
```

I think this is the best solution, because:
- It provides a useful tip consistently in a minimal case: when a matrix value is returned that gets printed in abbreviated form.
- It provides a tip that's always correct, regardless of what bindings exist (and indeed, what bindings exist is immaterial for the problem that the user is facing)
- We won't be digging around in the globals or the call stack without explicitly being asked to do so.

So should we go for that then?

Incidentally, I think `.str()` is an awful name for this method. The fact that `str(M)` and `M.str()` do similar but different things is a horrible trap. Also, `.str` and `.__str__` are too similar to both exist but be different. I don't have a direct alternative in mind, nor the inclination to follow through on the horrible deprecation process that would be required to remove this wart, though.



---

archive/issue_comments_184616.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@nbruin](#comment:8):\n> So should we go for that then?\n\nThanks for the very careful examples.  I had not dug that deep.\n\nI agree 100% with 100% of what you said, including the `str()` function/method mess.  I will mostly be very glad to see the \"obj.\" go away from the tip.  Thanks again for wrestling with this one.\n\nRob",
    "created_at": "2013-08-13T03:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184616",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@nbruin](#comment:8):
> So should we go for that then?

Thanks for the very careful examples.  I had not dug that deep.

I agree 100% with 100% of what you said, including the `str()` function/method mess.  I will mostly be very glad to see the "obj." go away from the tip.  Thanks again for wrestling with this one.

Rob



---

archive/issue_comments_184617.json:
```json
{
    "body": "Basic repr and a static message added in displayhook; doctest fixes.",
    "created_at": "2013-08-13T07:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184617",
    "user": "https://github.com/nbruin"
}
```

Basic repr and a static message added in displayhook; doctest fixes.



---

archive/issue_comments_184618.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAttachment: **[15036-display_hook_fix.patch.gz](https://github.com/sagemath/sage/files/ticket15036/15036-display_hook_fix.patch.gz)**\n\npatchbot apply 15036-display_hook_fix.patch",
    "created_at": "2013-08-13T07:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184618",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

Attachment: **[15036-display_hook_fix.patch.gz](https://github.com/sagemath/sage/files/ticket15036/15036-display_hook_fix.patch.gz)**

patchbot apply 15036-display_hook_fix.patch



---

archive/issue_comments_184619.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\none doctest is failing",
    "created_at": "2013-08-20T17:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184619",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

one doctest is failing



---

archive/issue_events_213481.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2013-08-20T17:42:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213481"
}
```



---

archive/issue_events_213482.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2013-08-20T17:42:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213482"
}
```



---

archive/issue_events_213483.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213483"
}
```



---

archive/issue_events_213484.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213484"
}
```



---

archive/issue_comments_184620.json:
```json
{
    "body": "Branch: **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)**",
    "created_at": "2014-02-05T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184620",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)**



---

archive/issue_comments_184621.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI've moved it to a git branch, rebased, and fixed the failing doctest.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30776eb9eea1fdaba9e81c906f2c0e3f3f4f965f\">30776eb</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54\">e852ce1</a></td><td><code>Fixed failing doctest.</code></td></tr></table>\n",
    "created_at": "2014-02-05T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184621",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

I've moved it to a git branch, rebased, and fixed the failing doctest.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30776eb9eea1fdaba9e81c906f2c0e3f3f4f965f">30776eb</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54">e852ce1</a></td><td><code>Fixed failing doctest.</code></td></tr></table>




---

archive/issue_events_213485.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-02-05T00:04:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213485"
}
```



---

archive/issue_events_213486.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-02-05T00:04:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213486"
}
```



---

archive/issue_comments_184622.json:
```json
{
    "body": "Author: **Nils Bruin**",
    "created_at": "2014-02-05T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184622",
    "user": "https://github.com/tscrim"
}
```

Author: **Nils Bruin**



---

archive/issue_comments_184623.json:
```json
{
    "body": "Commit: **[`e852ce1`](https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54)**",
    "created_at": "2014-02-05T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184623",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`e852ce1`](https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54)**



---

archive/issue_comments_184624.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIf someone could check my changes, then it's a positive review.",
    "created_at": "2014-02-06T01:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184624",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

If someone could check my changes, then it's a positive review.



---

archive/issue_comments_184625.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n> If someone could check my changes, then it's a positive review.\n\nThis change looks safe `:-P`\n\nNathann",
    "created_at": "2014-02-06T16:43:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184625",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

> If someone could check my changes, then it's a positive review.

This change looks safe `:-P`

Nathann



---

archive/issue_comments_184626.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Nathann Cohen**",
    "created_at": "2014-02-06T16:43:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184626",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Travis Scrimshaw, Nathann Cohen**



---

archive/issue_events_213487.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-02-06T16:43:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213487"
}
```



---

archive/issue_events_213488.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-02-06T16:43:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213488"
}
```



---

archive/issue_comments_184627.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI liked the unedited comment. `:p` Thanks.",
    "created_at": "2014-02-06T17:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184627",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

I liked the unedited comment. `:p` Thanks.



---

archive/issue_comments_184628.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYou didn't actually move the \"find variable name\" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.",
    "created_at": "2014-02-08T14:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184628",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

You didn't actually move the "find variable name" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.



---

archive/issue_events_213489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-08T14:14:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213489"
}
```



---

archive/issue_events_213490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-08T14:14:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213490"
}
```



---

archive/issue_comments_184629.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@vbraun](#comment:17):\n> You didn't actually move the \"find variable name\" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.\n\nThere is. This was carefully argued, see comment [comment:8]. I'll repeat the (slightly modified) example here for your convenience:\n\n```\nsage: L=[matrix(20,20,[2]*400) for i in range(3)]\nsage: L\n[20 x 20 dense matrix over Integer Ring,\n20 x 20 dense matrix over Integer Ring,\n20 x 20 dense matrix over Integer Ring]\n```\nIt's annoying and not useful to include the '.str()' message with each of these.\n\nThe rest of the examples gives an idea of the balance that is struck by handling the message in displayhook, which Rob and I decided on as the most desirable behaviour.\n\n```\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: A=L[0]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: print L[0]\n20 x 20 dense matrix over Integer Ring\n```\n\nSetting back to \"needs review\"--Volker, would you set it back to positive if this satisfies your concern? If you want the annoying message all the time, go for it, but you'll be changing a LOT more doctests. This behaviour turned out to be much closer to what we already had.",
    "created_at": "2014-02-08T16:28:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184629",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@vbraun](#comment:17):
> You didn't actually move the "find variable name" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.

There is. This was carefully argued, see comment [comment:8]. I'll repeat the (slightly modified) example here for your convenience:

```
sage: L=[matrix(20,20,[2]*400) for i in range(3)]
sage: L
[20 x 20 dense matrix over Integer Ring,
20 x 20 dense matrix over Integer Ring,
20 x 20 dense matrix over Integer Ring]
```
It's annoying and not useful to include the '.str()' message with each of these.

The rest of the examples gives an idea of the balance that is struck by handling the message in displayhook, which Rob and I decided on as the most desirable behaviour.

```
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: A=L[0]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: print L[0]
20 x 20 dense matrix over Integer Ring
```

Setting back to "needs review"--Volker, would you set it back to positive if this satisfies your concern? If you want the annoying message all the time, go for it, but you'll be changing a LOT more doctests. This behaviour turned out to be much closer to what we already had.



---

archive/issue_events_213491.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2014-02-08T16:28:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213491"
}
```



---

archive/issue_events_213492.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2014-02-08T16:28:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213492"
}
```



---

archive/issue_comments_184630.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nFine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module.",
    "created_at": "2014-02-08T16:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184630",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module.



---

archive/issue_comments_184631.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@vbraun](#comment:19):\n> Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module. \n\nI agree that refactoring is worth doing if we have more cases (and will be easy). Currently, the only objects this would appy to would be matrices and lists, and we can't reach into lists to implement the protocol there. For now we'd be designing and implementing a protocol to use *once*.\n\n(Conceptually, it is `DisplayHook` that should provide the hint: the object is simply giving a compact representation. It's not its task to provide help. The top-level interface is the right place to decide to provide help. Once we have more than one object requiring this, it starts making sense to implement this by letting the `DisplayHook` ask the object for a \"more helpful\" string representation.)",
    "created_at": "2014-02-08T17:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184631",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@vbraun](#comment:19):
> Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module. 

I agree that refactoring is worth doing if we have more cases (and will be easy). Currently, the only objects this would appy to would be matrices and lists, and we can't reach into lists to implement the protocol there. For now we'd be designing and implementing a protocol to use *once*.

(Conceptually, it is `DisplayHook` that should provide the hint: the object is simply giving a compact representation. It's not its task to provide help. The top-level interface is the right place to decide to provide help. Once we have more than one object requiring this, it starts making sense to implement this by letting the `DisplayHook` ask the object for a "more helpful" string representation.)



---

archive/issue_comments_184632.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think you should remove the line\n\n```\nfrom sage.misc.sageinspect import sage_getvariablename\n```\nfrom the `__repr__` method in `matrix0.pyx`.",
    "created_at": "2014-02-08T17:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184632",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

I think you should remove the line

```
from sage.misc.sageinspect import sage_getvariablename
```
from the `__repr__` method in `matrix0.pyx`.



---

archive/issue_comments_184633.json:
```json
{
    "body": "Changed branch from **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)** to **[u/nbruin/ticket/15036](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ticket/15036)**",
    "created_at": "2014-02-08T20:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184633",
    "user": "https://github.com/nbruin"
}
```

Changed branch from **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)** to **[u/nbruin/ticket/15036](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ticket/15036)**



---

archive/issue_comments_184634.json:
```json
{
    "body": "Changed commit from **[`e852ce1`](https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54)** to **[`fdb3282`](https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0)**",
    "created_at": "2014-02-08T20:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184634",
    "user": "https://github.com/nbruin"
}
```

Changed commit from **[`e852ce1`](https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54)** to **[`fdb3282`](https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0)**



---

archive/issue_comments_184635.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jhpalmieri](#comment:21):\n> I think you should remove the [import]\n\nGood point. Done.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0\">fdb3282</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr></table>\n",
    "created_at": "2014-02-08T20:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184635",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jhpalmieri](#comment:21):
> I think you should remove the [import]

Good point. Done.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0">fdb3282</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr></table>




---

archive/issue_comments_184636.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis was on the verge of getting a positive review a while ago. Any progress?",
    "created_at": "2014-04-22T21:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184636",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

This was on the verge of getting a positive review a while ago. Any progress?



---

archive/issue_events_213493.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213493"
}
```



---

archive/issue_events_213494.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213494"
}
```



---

archive/issue_events_213495.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-05-11T15:41:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213495"
}
```



---

archive/issue_events_213496.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-05-11T15:41:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213496"
}
```



---

archive/issue_comments_184637.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nWith 6.3base0 (tested only `matrix/`):\n\n```\nsage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t src/sage/matrix/constructor.py  # 1 doctest failed\nsage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\nsage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed\n```",
    "created_at": "2014-05-11T15:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184637",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">comment:26</div>

With 6.3base0 (tested only `matrix/`):

```
sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t src/sage/matrix/constructor.py  # 1 doctest failed
sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed
```



---

archive/issue_comments_184638.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/508e858b0cc01d81547fe4b230863ad024d3c338\">508e858</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6edd34f0c30e4f8459352e5769a215c6c499a097\">6edd34f</a></td><td><code>Fixed failing doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0eb5514f1ac278288abede2a69f0dad819d9d1ef\">0eb5514</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295\">d41816c</a></td><td><code>trac 15036: make some changes for rebase on 6.2</code></td></tr></table>\n",
    "created_at": "2014-05-12T04:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184638",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/508e858b0cc01d81547fe4b230863ad024d3c338">508e858</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6edd34f0c30e4f8459352e5769a215c6c499a097">6edd34f</a></td><td><code>Fixed failing doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0eb5514f1ac278288abede2a69f0dad819d9d1ef">0eb5514</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295">d41816c</a></td><td><code>trac 15036: make some changes for rebase on 6.2</code></td></tr></table>




---

archive/issue_comments_184639.json:
```json
{
    "body": "Changed commit from **[`fdb3282`](https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0)** to **[`d41816c`](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295)**",
    "created_at": "2014-05-12T04:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184639",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fdb3282`](https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0)** to **[`d41816c`](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295)**



---

archive/issue_comments_184640.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@rwst](#comment:26):\n> With 6.3base0 (tested only `matrix/`):\n> \n> ```\n> sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\n> sage -t src/sage/matrix/constructor.py  # 1 doctest failed\n> sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\n> sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed\n> ```\n\nI did not experience those doctest failures, but I did experience some other problems. Hopefully newly rebased branch is OK. If not, please go at it, because fixing this merge is beyond me if this doesn't do the trick.",
    "created_at": "2014-05-12T04:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184640",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@rwst](#comment:26):
> With 6.3base0 (tested only `matrix/`):
> 
> ```
> sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
> sage -t src/sage/matrix/constructor.py  # 1 doctest failed
> sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
> sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed
> ```

I did not experience those doctest failures, but I did experience some other problems. Hopefully newly rebased branch is OK. If not, please go at it, because fixing this merge is beyond me if this doesn't do the trick.



---

archive/issue_events_213497.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2014-05-12T04:43:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213497"
}
```



---

archive/issue_events_213498.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2014-05-12T04:43:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213498"
}
```



---

archive/issue_comments_184641.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n(new broken doctest in combinat/designs/latin_squares.py `^^;`)",
    "created_at": "2014-05-12T09:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184641",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:29" align="right">comment:29</div>

(new broken doctest in combinat/designs/latin_squares.py `^^;`)



---

archive/issue_comments_184642.json:
```json
{
    "body": "Changed branch from **[u/nbruin/ticket/15036](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ticket/15036)** to **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)**",
    "created_at": "2014-05-12T15:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184642",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/nbruin/ticket/15036](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/ticket/15036)** to **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)**



---

archive/issue_comments_184643.json:
```json
{
    "body": "Changed commit from **[`d41816c`](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295)** to **[`f2d8c36`](https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc)**",
    "created_at": "2014-05-12T15:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184643",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`d41816c`](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295)** to **[`f2d8c36`](https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc)**



---

archive/issue_comments_184644.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30776eb9eea1fdaba9e81c906f2c0e3f3f4f965f\">30776eb</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54\">e852ce1</a></td><td><code>Fixed failing doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0\">fdb3282</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a53d28f9903c669105443f1af97ae3beae9c785b\">a53d28f</a></td><td><code>Merge branch 'u/nbruin/ticket/15036' of trac.sagemath.org:sage into public/ticket/large_matrix_repr-15036</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc\">f2d8c36</a></td><td><code>Fixed failing doctests.</code></td></tr></table>\n",
    "created_at": "2014-05-12T15:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184644",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30776eb9eea1fdaba9e81c906f2c0e3f3f4f965f">30776eb</a></td><td><code>Make matrix repr for large matrices not trawl the call stack and move that functionality to displayhook instead.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e852ce10285877db93309db156139a7bf3b8bc54">e852ce1</a></td><td><code>Fixed failing doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdb32821fa9382cb3bd468d1d0615f8f246470b0">fdb3282</a></td><td><code>trac #15036: remove redundant import statement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a53d28f9903c669105443f1af97ae3beae9c785b">a53d28f</a></td><td><code>Merge branch 'u/nbruin/ticket/15036' of trac.sagemath.org:sage into public/ticket/large_matrix_repr-15036</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc">f2d8c36</a></td><td><code>Fixed failing doctests.</code></td></tr></table>




---

archive/issue_comments_184645.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@tscrim](#comment:30):\n> I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.\n\nI don't think you based your branch on the branch from comment [comment:27]. I had to move the\n\n```\nfrom sage.matrix.matrix import is_Matrix\n```\nto inside `simple_format_obj` because otherwise Sage won't start for me: the IPython crash report has a long traceback, showing that somewhere along the line, that import statement fails because the name `ZZ` isn't available (yet).\n\nThis problem only arises with interactive use (and I guess in doctests that test sage via an expect interface and hence running with IPython). It would be surprising, but not impossible, if you're not experiencing this problem (in which case import resolutions aren't deterministic), but the fact that the problematic situation can arise means we need to fix it. The relevant (two line) change is at the bottom of [https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295).",
    "created_at": "2014-05-12T16:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184645",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@tscrim](#comment:30):
> I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.

I don't think you based your branch on the branch from comment [comment:27]. I had to move the

```
from sage.matrix.matrix import is_Matrix
```
to inside `simple_format_obj` because otherwise Sage won't start for me: the IPython crash report has a long traceback, showing that somewhere along the line, that import statement fails because the name `ZZ` isn't available (yet).

This problem only arises with interactive use (and I guess in doctests that test sage via an expect interface and hence running with IPython). It would be surprising, but not impossible, if you're not experiencing this problem (in which case import resolutions aren't deterministic), but the fact that the problematic situation can arise means we need to fix it. The relevant (two line) change is at the bottom of [https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295](https://github.com/sagemath/sagetrac-mirror/commit/d41816c57ede520353ed24ea9534c1219137d295).



---

archive/issue_comments_184646.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f\">f1b2742</a></td><td><code>trac #15036: fix late import of is_Matrix to avoid startup problems</code></td></tr></table>\n",
    "created_at": "2014-05-12T21:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184646",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f">f1b2742</a></td><td><code>trac #15036: fix late import of is_Matrix to avoid startup problems</code></td></tr></table>




---

archive/issue_comments_184647.json:
```json
{
    "body": "Changed commit from **[`f2d8c36`](https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc)** to **[`f1b2742`](https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f)**",
    "created_at": "2014-05-12T21:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184647",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f2d8c36`](https://github.com/sagemath/sagetrac-mirror/commit/f2d8c363fc26c1dfff9a868714cbc22bfc4759dc)** to **[`f1b2742`](https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f)**



---

archive/issue_comments_184648.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nHopefully this provides a more elegant approach to importing the `is_Matrix` symbol at just the right time.",
    "created_at": "2014-05-12T21:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184648",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:33" align="right">comment:33</div>

Hopefully this provides a more elegant approach to importing the `is_Matrix` symbol at just the right time.



---

archive/issue_comments_184649.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI had pulled the current branch that was on trac, but perhaps my merge of `develop` overwrote that...strange... Does this not work with `lazy_import`?",
    "created_at": "2014-05-12T21:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184649",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

I had pulled the current branch that was on trac, but perhaps my merge of `develop` overwrote that...strange... Does this not work with `lazy_import`?



---

archive/issue_comments_184650.json:
```json
{
    "body": "Changed commit from **[`f1b2742`](https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f)** to **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**",
    "created_at": "2014-05-12T22:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184650",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1b2742`](https://github.com/sagemath/sagetrac-mirror/commit/f1b274282301f0b999969e77a620293235cedd8f)** to **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**



---

archive/issue_comments_184651.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740\">3b0cc7a</a></td><td><code>Use lazy_import instead</code></td></tr></table>\n",
    "created_at": "2014-05-12T22:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184651",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740">3b0cc7a</a></td><td><code>Use lazy_import instead</code></td></tr></table>




---

archive/issue_comments_184652.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@tscrim](#comment:34):\n> Does this not work with `lazy_import`?\n\nGood point. That's probably an easier solution (at least to write and understand) And it resolves completely on the first execution.",
    "created_at": "2014-05-12T22:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184652",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@tscrim](#comment:34):
> Does this not work with `lazy_import`?

Good point. That's probably an easier solution (at least to write and understand) And it resolves completely on the first execution.



---

archive/issue_events_213499.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-05-12T22:17:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213499"
}
```



---

archive/issue_events_213500.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-05-12T22:17:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213500"
}
```



---

archive/issue_comments_184653.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nLGTM. Thanks Nils.",
    "created_at": "2014-05-12T22:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184653",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

LGTM. Thanks Nils.



---

archive/issue_comments_184654.json:
```json
{
    "body": "Changed branch from **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)** to **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**",
    "created_at": "2014-05-13T08:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/15036#issuecomment-184654",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/matrix_repr_speedup-15036](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/matrix_repr_speedup-15036)** to **[`3b0cc7a`](https://github.com/sagemath/sagetrac-mirror/commit/3b0cc7a1fc5c45effa3adf72c7e4411ea3a93740)**



---

archive/issue_events_213501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-13T08:42:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213501"
}
```



---

archive/issue_events_213502.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7e8936be90c718217ededa6cca8a0016e5eb7dbc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-13T08:42:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/15036",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/15036#event-213502"
}
```
