# Issue 15201: Fix elias_upper_bound

archive/issues_015201.json:
```json
{
    "body": "Assignee: @ypfmde\n\nCC:  @dimpase @wdjoyner\n\nThe code for the function elias_upper_bound contains an error. A patch for the rather trivial error is provided.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15438\n\n",
    "closed_at": "2014-05-25T17:31:47Z",
    "created_at": "2013-11-19T16:01:14Z",
    "labels": [
        "component: coding theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Fix elias_upper_bound",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15201",
    "user": "https://github.com/ypfmde"
}
```
Assignee: @ypfmde

CC:  @dimpase @wdjoyner

The code for the function elias_upper_bound contains an error. A patch for the rather trivial error is provided.

Issue created by migration from https://trac.sagemath.org/ticket/15438





---

archive/issue_comments_195027.json:
```json
{
    "body": "fix of elias_upper_bound",
    "created_at": "2013-11-19T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195027",
    "user": "https://github.com/ypfmde"
}
```

fix of elias_upper_bound



---

archive/issue_comments_195028.json:
```json
{
    "body": "Attachment [trac_XXXX_elias_bound_fix.patch](tarball://root/attachments/some-uuid/ticket15438/trac_XXXX_elias_bound_fix.patch) by @ypfmde created at 2013-11-19 17:25:25",
    "created_at": "2013-11-19T17:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195028",
    "user": "https://github.com/ypfmde"
}
```

Attachment [trac_XXXX_elias_bound_fix.patch](tarball://root/attachments/some-uuid/ticket15438/trac_XXXX_elias_bound_fix.patch) by @ypfmde created at 2013-11-19 17:25:25



---

archive/issue_comments_195029.json:
```json
{
    "body": "Set assignee to @ypfmde.",
    "created_at": "2013-11-19T17:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195029",
    "user": "https://github.com/ypfmde"
}
```

Set assignee to @ypfmde.



---

archive/issue_comments_195030.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-19T17:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195030",
    "user": "https://github.com/ypfmde"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195031.json:
```json
{
    "body": "I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.\n\nFurthermore, is `RR(fact)==RR(int(fact))` the right way to check if the rational number `fact` is an integer?\n\nWhile these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?\n\nIn my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.",
    "created_at": "2013-11-19T19:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195031",
    "user": "https://github.com/ypfmde"
}
```

I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.

Furthermore, is `RR(fact)==RR(int(fact))` the right way to check if the rational number `fact` is an integer?

While these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?

In my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.



---

archive/issue_comments_195032.json:
```json
{
    "body": "Replying to [comment:3 pmueller]:\n> I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.\n\n\nI think it should raise a `ValueError` instead. A trivial bound would give the incorrect impression that the bound is well defined for those parameters.\n\n> Furthermore, is `RR(fact)==RR(int(fact))` the right way to check if the rational number `fact` is an integer?\n\n\nI agree that that is a really bad way to check for an integer. It should be `isinstance(fact, (ZZ, int, long))`.\n\n> While these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?\n> \n> In my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.\n\n\nI think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).",
    "created_at": "2013-12-15T07:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195032",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:3 pmueller]:
> I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.


I think it should raise a `ValueError` instead. A trivial bound would give the incorrect impression that the bound is well defined for those parameters.

> Furthermore, is `RR(fact)==RR(int(fact))` the right way to check if the rational number `fact` is an integer?


I agree that that is a really bad way to check for an integer. It should be `isinstance(fact, (ZZ, int, long))`.

> While these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?
> 
> In my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.


I think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).



---

archive/issue_comments_195033.json:
```json
{
    "body": "Replying to [comment:4 ppurka]:\n> Replying to [comment:3 pmueller]:\n> > I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.\n\n> \n> I think it should raise a `ValueError` instead. A trivial bound would give the incorrect impression that the bound is well defined for those parameters.\n\nI prefer a true but trivial bound instead, so that one does not have to care about an allowed choice of parameters.\n> \n> > While these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?\n> > \n> > In my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.\n\n> \n> I think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).\n\nI strongly disagree! If we change the order of arguments without changing the function names, then code which was correct will become incorrect in future versions of Sage. I just see another problem: In elias_bound_asymp(delta, q) we *first* have d (via delta) and then q, while in elias_upper_bound(n, q, d) it is the other way around. So maybe we drop the redundant *upper* in the function names, and replace elias/plotkin/etc_upper_bound(n, q, d) by elias/plotkin/etc_bound(n, d, q). Then the naming is consistent with the asymptotic and the delsarte functions.",
    "created_at": "2013-12-15T12:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195033",
    "user": "https://github.com/ypfmde"
}
```

Replying to [comment:4 ppurka]:
> Replying to [comment:3 pmueller]:
> > I just see that there are more problems in the file code_bounds.py. For instance, something like `codesize_upper_bound(10,1,2)` raises an error because it looks for the minimum of the various bounds, but some of them (plotkin, elias) are not defined for these parameters. I think if `elias/plotkin_upper_bound(n, q, d)` isn't defined, it should return a trivial bound like `q^n` instead of an error.

> 
> I think it should raise a `ValueError` instead. A trivial bound would give the incorrect impression that the bound is well defined for those parameters.

I prefer a true but trivial bound instead, so that one does not have to care about an allowed choice of parameters.
> 
> > While these things, like the original mistake in the `elias_upper_bound`, are easy to fix, I'm a little concerned with the order of arguments. Is there any reason to have for instance `hamming_upper_bound(n, q, d)`, but `q` and `d` switched in `delsarte_bound_hamming_space(n, d, q)` and `codesize_upper_bound(n, d, q)`?
> > 
> > In my opinion that's a perfect and unnecessary source for producing errors. However, making things consistent would break compatibility, so maybe the only way out is to keep the present functions, and use new names for those with consistent argument orders.

> 
> I think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).

I strongly disagree! If we change the order of arguments without changing the function names, then code which was correct will become incorrect in future versions of Sage. I just see another problem: In elias_bound_asymp(delta, q) we *first* have d (via delta) and then q, while in elias_upper_bound(n, q, d) it is the other way around. So maybe we drop the redundant *upper* in the function names, and replace elias/plotkin/etc_upper_bound(n, q, d) by elias/plotkin/etc_bound(n, d, q). Then the naming is consistent with the asymptotic and the delsarte functions.



---

archive/issue_comments_195034.json:
```json
{
    "body": "Replying to [comment:7 pmueller]:\n> I prefer a true but trivial bound instead, so that one does not have to care about an allowed choice of parameters.\n\n\nFor `codesize_upper_bound`, I think it would be fine to return a trivial bound that should be valid in all ranges of the minimum distance. But not for the specific bounds such as `elias` or `plotkin` - those are really *undefined* for certain ranges of parameters.\n\nIn fact, the Elias bound should be valid till `d <= (q-1)/q * n`. The Plotkin should then take over from there since it needs `d > (q-1)/q * n`. So, there shouldn't be any range for which the trivial bound `q^n` is required. If it is being required, then the bounds need to be fixed.\n\n> > I think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).\n\n> I strongly disagree! If we change the order of arguments without changing the function names, then code which was correct will become incorrect in future versions of Sage. I just see another problem: In elias_bound_asymp(delta, q) we *first* have d (via delta) and then q, while in elias_upper_bound(n, q, d) it is the other way around. So maybe we drop the redundant *upper* in the function names, and replace elias/plotkin/etc_upper_bound(n, q, d) by elias/plotkin/etc_bound(n, d, q). Then the naming is consistent with the asymptotic and the delsarte functions.\n\nWell, one way is to keep the current commands and put some warnings. Your suggestion however seems good. We can name some new functions and deprecate the old functions. The old functions can be removed after the deprecation period is over.",
    "created_at": "2013-12-15T14:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195034",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:7 pmueller]:
> I prefer a true but trivial bound instead, so that one does not have to care about an allowed choice of parameters.


For `codesize_upper_bound`, I think it would be fine to return a trivial bound that should be valid in all ranges of the minimum distance. But not for the specific bounds such as `elias` or `plotkin` - those are really *undefined* for certain ranges of parameters.

In fact, the Elias bound should be valid till `d <= (q-1)/q * n`. The Plotkin should then take over from there since it needs `d > (q-1)/q * n`. So, there shouldn't be any range for which the trivial bound `q^n` is required. If it is being required, then the bounds need to be fixed.

> > I think the order of those commands should be fixed once and for all. And a `warning` printed for a year (that is the usual period for deprecation, but we can't deprecate anything here).

> I strongly disagree! If we change the order of arguments without changing the function names, then code which was correct will become incorrect in future versions of Sage. I just see another problem: In elias_bound_asymp(delta, q) we *first* have d (via delta) and then q, while in elias_upper_bound(n, q, d) it is the other way around. So maybe we drop the redundant *upper* in the function names, and replace elias/plotkin/etc_upper_bound(n, q, d) by elias/plotkin/etc_bound(n, d, q). Then the naming is consistent with the asymptotic and the delsarte functions.

Well, one way is to keep the current commands and put some warnings. Your suggestion however seems good. We can name some new functions and deprecate the old functions. The old functions can be removed after the deprecation period is over.



---

archive/issue_events_044977.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15201#event-44977"
}
```



---

archive/issue_events_044978.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15201#event-44978"
}
```



---

archive/issue_events_044979.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15201#event-44979"
}
```



---

archive/issue_comments_195035.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-24T15:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195035",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195036.json:
```json
{
    "body": "Sorry, completely forgot about this ticket. This looks good to me. The changes to function names and input arguments can be followed up in #16393\n\n---\nNew commits:",
    "created_at": "2014-05-24T15:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195036",
    "user": "https://github.com/ppurka"
}
```

Sorry, completely forgot about this ticket. This looks good to me. The changes to function names and input arguments can be followed up in #16393

---
New commits:



---

archive/issue_events_044980.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-25T17:31:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15201#event-44980"
}
```



---

archive/issue_comments_195037.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-25T17:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195037",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_195038.json:
```json
{
    "body": "Darn. How do I undo this commit? I should have been working on #16393 but was mistakenly working on this ticket instead.\n  \n---\nNew commits:",
    "created_at": "2014-07-13T11:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195038",
    "user": "https://github.com/ppurka"
}
```

Darn. How do I undo this commit? I should have been working on #16393 but was mistakenly working on this ticket instead.
  
---
New commits:



---

archive/issue_comments_195039.json:
```json
{
    "body": "Ok. I did a hard reset to 906a3c.",
    "created_at": "2014-07-13T12:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15201#issuecomment-195039",
    "user": "https://github.com/ppurka"
}
```

Ok. I did a hard reset to 906a3c.
