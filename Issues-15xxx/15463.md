# Issue 15463: Implement crystal morphisms, subcrystals, and virtual crystals

archive/issues_015226.json:
```json
{
    "body": "This implements:\n\n- Crystal morphisms (usual, twisted, and virtual).\n- Subcrystals, so we no long have to do the subset workaround in `digraph()`.\n- Virtual crystals, so we can now view the elements in the virtual crystal as a crystal graph.\n\nThis also reworks `DirectSumOfCrystals` and `TensorProductOfCrystals` to make them associative as constructions.\n\nAfter this, we will be able to do coercions between crystals.\n\nAssignee: sage-combinat\n\nCC:  sage-combinat @anneschilling @nthiery @bsalisbury1\n\nKeywords: crystals, morphisms, subcrystals\n\nBranch/Commit: 9f3b7e7670734a8f1e2c3b558031f54ab006b951\n\nReviewer: Anne Schilling\n\nAuthor: Travis Scrimshaw\n\nDependencies: #15462 #15882 #16001 #18453 #18722\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/15463\n\n",
    "closed_at": "2015-07-27T15:15:58Z",
    "created_at": "2013-11-28T07:47:43Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Implement crystal morphisms, subcrystals, and virtual crystals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15463",
    "user": "https://github.com/tscrim"
}
```
This implements:

- Crystal morphisms (usual, twisted, and virtual).
- Subcrystals, so we no long have to do the subset workaround in `digraph()`.
- Virtual crystals, so we can now view the elements in the virtual crystal as a crystal graph.

This also reworks `DirectSumOfCrystals` and `TensorProductOfCrystals` to make them associative as constructions.

After this, we will be able to do coercions between crystals.

Assignee: sage-combinat

CC:  sage-combinat @anneschilling @nthiery @bsalisbury1

Keywords: crystals, morphisms, subcrystals

Branch/Commit: 9f3b7e7670734a8f1e2c3b558031f54ab006b951

Reviewer: Anne Schilling

Author: Travis Scrimshaw

Dependencies: #15462 #15882 #16001 #18453 #18722

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/15463





---

archive/issue_comments_208572.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-28T07:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208572",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208573.json:
```json
{
    "body": "<a id='comment:2'></a>Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`, but the KR crystals currently use them. In an ideal world, I'd just do a straight replacement of the method, but this might be too drastic of a change...",
    "created_at": "2013-11-28T07:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208573",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`, but the KR crystals currently use them. In an ideal world, I'd just do a straight replacement of the method, but this might be too drastic of a change...



---

archive/issue_comments_208574.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208574",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_208575.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:2 tscrim]:\n> Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`,\n\n\nI am not sure to have all elements of context for the case at hand, but the name ``crystal_morphism`` is a priori better than ``morphim``. For the same reason, we have module_morphism, algebra_morphism etc else where. The point is that if a set has several structures this naming convention avoids conflicts.",
    "created_at": "2013-11-28T09:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208575",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>Replying to [comment:2 tscrim]:
> Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`,


I am not sure to have all elements of context for the case at hand, but the name ``crystal_morphism`` is a priori better than ``morphim``. For the same reason, we have module_morphism, algebra_morphism etc else where. The point is that if a set has several structures this naming convention avoids conflicts.



---

archive/issue_comments_208576.json:
```json
{
    "body": "<a id='comment:6'></a>You definitely need to give references for similarity techniques and virtual crystals!",
    "created_at": "2013-11-28T16:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208576",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:6'></a>You definitely need to give references for similarity techniques and virtual crystals!



---

archive/issue_comments_208577.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 nthiery]:\n> Replying to [comment:2 tscrim]:\n> > Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`,\n\n> \n> I am not sure to have all elements of context for the case at hand, but the name ``crystal_morphism`` is a priori better than ``morphim``. For the same reason, we have module_morphism, algebra_morphism etc else where. The point is that if a set has several structures this naming convention avoids conflicts.\n\n\nWhat would you recommend doing? The output/behavior of the method would radically change, but is that okay? Then should we then move the old functionality into KR crystals to avoid rewriting the promotion functionality there? Thanks.",
    "created_at": "2013-11-28T21:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208577",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Replying to [comment:5 nthiery]:
> Replying to [comment:2 tscrim]:
> > Also, I'd like to deprecate the method `crystal_morphism` in place of `morphism`,

> 
> I am not sure to have all elements of context for the case at hand, but the name ``crystal_morphism`` is a priori better than ``morphim``. For the same reason, we have module_morphism, algebra_morphism etc else where. The point is that if a set has several structures this naming convention avoids conflicts.


What would you recommend doing? The output/behavior of the method would radically change, but is that okay? Then should we then move the old functionality into KR crystals to avoid rewriting the promotion functionality there? Thanks.



---

archive/issue_events_045092.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45092"
}
```



---

archive/issue_events_045093.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45093"
}
```



---

archive/issue_events_045094.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45094"
}
```



---

archive/issue_comments_208578.json:
```json
{
    "body": "<a id='comment:10'></a>Okay, so I've changed KR crystals to return honest crystal morphisms and made `DirectSumOfCrystals` into a proper facade parent (when requested). I've also changed `morphism()` to `crystal_morphism()` and moved the old function to `kirillov_reshetikhin.py` in case we want to revive it. I also added references to `virtual_crystal.py` and had `Subcrystal` redirect to `VirtualCrystal` depending on parameters so we could have in the future a more uniform interface with the `subcrystal()` method.\n\nHere's some timing tests for KR crystals.\n\nThe test I ran:\n\n```python\ndef test_KR(ct, r, s):\n    print \"construction:\"\n    %time B = KirillovReshetikhinCrystal(ct, r, s)\n    print \"TestSuite:\"\n    %time TestSuite(B).run()\n    print \"Digraph:\"\n    %time G = B.digraph()\n```\n\nWith the branch:\n\n```\nsage: test_KR(['A',4,1], 3, 2)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.04 s\nTestSuite:\nCPU times: user 2.61 s, sys: 0.09 s, total: 2.70 s\nWall time: 3.21 s\nDigraph:\nCPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s\nWall time: 0.26 s\n\nsage: test_KR(['D',4,1], 2, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.01 s\nTestSuite:\nCPU times: user 2.07 s, sys: 0.00 s, total: 2.08 s\nWall time: 2.33 s\nDigraph:\nCPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s\nWall time: 0.27 s\n\nsage: test_KR(['E',6,1], 1, 1)\nconstruction:\nCPU times: user 0.19 s, sys: 0.00 s, total: 0.19 s\nWall time: 0.31 s\nTestSuite:\nCPU times: user 0.57 s, sys: 0.00 s, total: 0.57 s\nWall time: 0.70 s\nDigraph:\nCPU times: user 0.12 s, sys: 0.02 s, total: 0.14 s\nWall time: 0.16 s\n\nsage: test_KR(['A',6,2], 2, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.02 s\nTestSuite:\nCPU times: user 2.23 s, sys: 0.01 s, total: 2.24 s\nWall time: 2.71 s\nDigraph:\nCPU times: user 0.24 s, sys: 0.00 s, total: 0.24 s\nWall time: 0.27 s\n\nsage: test_KR(['D',4,2], 2, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.01 s\nTestSuite:\nCPU times: user 2.91 s, sys: 0.02 s, total: 2.92 s\nWall time: 3.36 s\nDigraph:\nCPU times: user 0.27 s, sys: 0.01 s, total: 0.28 s\nWall time: 0.38 s\n\nsage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)\nsage: %time TestSuite(K).run()\nCPU times: user 58.50 s, sys: 0.10 s, total: 58.60 s\nWall time: 70.46 s\n```\nDevelop:\n\n```\nsage: test_KR(['A',4,1], 3, 2)\nconstruction:\nCPU times: user 0.04 s, sys: 0.00 s, total: 0.04 s\nWall time: 0.18 s\nTestSuite:\nCPU times: user 2.59 s, sys: 0.06 s, total: 2.65 s\nWall time: 3.97 s\nDigraph:\nCPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s\nWall time: 0.33 s\n\nsage: test_KR(['D',4,1], 2, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.02 s\nWall time: 0.07 s\nTestSuite:\nCPU times: user 0.52 s, sys: 0.02 s, total: 0.54 s\nWall time: 0.75 s\nDigraph:\nCPU times: user 0.10 s, sys: 0.00 s, total: 0.10 s\nWall time: 0.12 s\n\nsage: test_KR(['E',6,1], 1, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.02 s\nWall time: 0.07 s\nTestSuite:\nCPU times: user 0.45 s, sys: 0.00 s, total: 0.45 s\nWall time: 0.58 s\nDigraph:\nCPU times: user 0.10 s, sys: 0.01 s, total: 0.11 s\nWall time: 0.12 s\n\nsage: test_KR(['A',6,2], 2, 1)\nconstruction:\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.09 s\nTestSuite:\nCPU times: user 0.64 s, sys: 0.02 s, total: 0.65 s\nWall time: 0.86 s\nDigraph:\nCPU times: user 0.21 s, sys: 0.00 s, total: 0.21 s\nWall time: 0.28 s\n\nsage: test_KR(['D',4,2], 2, 1)\nconstruction:\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.01 s\nTestSuite:\nCPU times: user 0.38 s, sys: 0.01 s, total: 0.39 s\nWall time: 0.50 s\nDigraph:\nCPU times: user 0.12 s, sys: 0.01 s, total: 0.13 s\nWall time: 0.28 s\n\nsage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)\nsage: %time TestSuite(K).run()\nCPU times: user 5.30 s, sys: 0.02 s, total: 5.32 s\nWall time: 6.30 s\n```\n\nSo there's a major speed penality with using promotion as a crystal morphism directly. My guess is caused from the fact we are no longer caching things. On develop we have:\n\n```\nsage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)\nsage: K.promotion()\nCached version of <function morphism at 0xc77133c>\n```\nSo I have a the following questions:\n\n1 - The code and the documentation for the old `crystal_morphism()` did not match as the default was to not cache (i.e. `cache = False` but the code did return a cached function when the `cache` argument was `False`. Do we want to cache the output of the promotion (or something else that's related)?\n\n2 - Do we want to use honest crystal morphisms or use the old function returned from the old `crystal_morphism()`?\n\n3 - Do we want to have an option to cache the output of a crystal morphism, or morphisms in general?",
    "created_at": "2014-03-08T17:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208578",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Okay, so I've changed KR crystals to return honest crystal morphisms and made `DirectSumOfCrystals` into a proper facade parent (when requested). I've also changed `morphism()` to `crystal_morphism()` and moved the old function to `kirillov_reshetikhin.py` in case we want to revive it. I also added references to `virtual_crystal.py` and had `Subcrystal` redirect to `VirtualCrystal` depending on parameters so we could have in the future a more uniform interface with the `subcrystal()` method.

Here's some timing tests for KR crystals.

The test I ran:

```python
def test_KR(ct, r, s):
    print "construction:"
    %time B = KirillovReshetikhinCrystal(ct, r, s)
    print "TestSuite:"
    %time TestSuite(B).run()
    print "Digraph:"
    %time G = B.digraph()
```

With the branch:

```
sage: test_KR(['A',4,1], 3, 2)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.04 s
TestSuite:
CPU times: user 2.61 s, sys: 0.09 s, total: 2.70 s
Wall time: 3.21 s
Digraph:
CPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s
Wall time: 0.26 s

sage: test_KR(['D',4,1], 2, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.01 s
TestSuite:
CPU times: user 2.07 s, sys: 0.00 s, total: 2.08 s
Wall time: 2.33 s
Digraph:
CPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s
Wall time: 0.27 s

sage: test_KR(['E',6,1], 1, 1)
construction:
CPU times: user 0.19 s, sys: 0.00 s, total: 0.19 s
Wall time: 0.31 s
TestSuite:
CPU times: user 0.57 s, sys: 0.00 s, total: 0.57 s
Wall time: 0.70 s
Digraph:
CPU times: user 0.12 s, sys: 0.02 s, total: 0.14 s
Wall time: 0.16 s

sage: test_KR(['A',6,2], 2, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.02 s
TestSuite:
CPU times: user 2.23 s, sys: 0.01 s, total: 2.24 s
Wall time: 2.71 s
Digraph:
CPU times: user 0.24 s, sys: 0.00 s, total: 0.24 s
Wall time: 0.27 s

sage: test_KR(['D',4,2], 2, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.01 s
TestSuite:
CPU times: user 2.91 s, sys: 0.02 s, total: 2.92 s
Wall time: 3.36 s
Digraph:
CPU times: user 0.27 s, sys: 0.01 s, total: 0.28 s
Wall time: 0.38 s

sage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)
sage: %time TestSuite(K).run()
CPU times: user 58.50 s, sys: 0.10 s, total: 58.60 s
Wall time: 70.46 s
```
Develop:

```
sage: test_KR(['A',4,1], 3, 2)
construction:
CPU times: user 0.04 s, sys: 0.00 s, total: 0.04 s
Wall time: 0.18 s
TestSuite:
CPU times: user 2.59 s, sys: 0.06 s, total: 2.65 s
Wall time: 3.97 s
Digraph:
CPU times: user 0.23 s, sys: 0.01 s, total: 0.24 s
Wall time: 0.33 s

sage: test_KR(['D',4,1], 2, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.02 s
Wall time: 0.07 s
TestSuite:
CPU times: user 0.52 s, sys: 0.02 s, total: 0.54 s
Wall time: 0.75 s
Digraph:
CPU times: user 0.10 s, sys: 0.00 s, total: 0.10 s
Wall time: 0.12 s

sage: test_KR(['E',6,1], 1, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.02 s
Wall time: 0.07 s
TestSuite:
CPU times: user 0.45 s, sys: 0.00 s, total: 0.45 s
Wall time: 0.58 s
Digraph:
CPU times: user 0.10 s, sys: 0.01 s, total: 0.11 s
Wall time: 0.12 s

sage: test_KR(['A',6,2], 2, 1)
construction:
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.09 s
TestSuite:
CPU times: user 0.64 s, sys: 0.02 s, total: 0.65 s
Wall time: 0.86 s
Digraph:
CPU times: user 0.21 s, sys: 0.00 s, total: 0.21 s
Wall time: 0.28 s

sage: test_KR(['D',4,2], 2, 1)
construction:
CPU times: user 0.00 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.01 s
TestSuite:
CPU times: user 0.38 s, sys: 0.01 s, total: 0.39 s
Wall time: 0.50 s
Digraph:
CPU times: user 0.12 s, sys: 0.01 s, total: 0.13 s
Wall time: 0.28 s

sage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)
sage: %time TestSuite(K).run()
CPU times: user 5.30 s, sys: 0.02 s, total: 5.32 s
Wall time: 6.30 s
```

So there's a major speed penality with using promotion as a crystal morphism directly. My guess is caused from the fact we are no longer caching things. On develop we have:

```
sage: K = KirillovReshetikhinCrystal(['D',4,1], 2,2)
sage: K.promotion()
Cached version of <function morphism at 0xc77133c>
```
So I have a the following questions:

1 - The code and the documentation for the old `crystal_morphism()` did not match as the default was to not cache (i.e. `cache = False` but the code did return a cached function when the `cache` argument was `False`. Do we want to cache the output of the promotion (or something else that's related)?

2 - Do we want to use honest crystal morphisms or use the old function returned from the old `crystal_morphism()`?

3 - Do we want to have an option to cache the output of a crystal morphism, or morphisms in general?



---

archive/issue_comments_208579.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-08T17:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208580.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-02T01:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208581.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-09T02:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208582.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-12T14:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208583.json:
```json
{
    "body": "<a id='comment:15'></a>With the new custom promotion map, I actually get a speedup when running the test suite except with the twisted types -- most likely from the maps to/from the ambient type which aren't cached as well:\n\n```\nsage: test_KR(['A',4,1], 3, 2)\nconstruction\nCPU times: user 36 ms, sys: 4 ms, total: 40 ms\nWall time: 40.1 ms\nTestSuite:\nCPU times: user 1.1 s, sys: 36 ms, total: 1.13 s\nWall time: 1.15 s\nDigraph:\nCPU times: user 144 ms, sys: 4 ms, total: 148 ms\nWall time: 164 ms\nsage: test_KR(['A',4,1], 3, 2)\nconstruction\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 240 \u00b5s\nTestSuite:\nCPU times: user 708 ms, sys: 24 ms, total: 732 ms\nWall time: 712 ms\nDigraph:\nCPU times: user 180 ms, sys: 4 ms, total: 184 ms\nWall time: 207 ms\nsage: test_KR(['D',4,1], 2, 1)\nconstruction\nCPU times: user 24 ms, sys: 4 ms, total: 28 ms\nWall time: 26.5 ms\nTestSuite:\nCPU times: user 412 ms, sys: 0 ns, total: 412 ms\nWall time: 421 ms\nDigraph:\nCPU times: user 112 ms, sys: 4 ms, total: 116 ms\nWall time: 126 ms\nsage: test_KR(['E',6,1], 1, 1)\nconstruction\nCPU times: user 124 ms, sys: 8 ms, total: 132 ms\nWall time: 132 ms\nTestSuite:\nCPU times: user 232 ms, sys: 0 ns, total: 232 ms\nWall time: 234 ms\nDigraph:\nCPU times: user 104 ms, sys: 8 ms, total: 112 ms\nWall time: 124 ms\nsage: test_KR(['A',6,2], 2, 1)\nconstruction\nCPU times: user 12 ms, sys: 4 ms, total: 16 ms\nWall time: 15.3 ms\nTestSuite:\nCPU times: user 1.2 s, sys: 8 ms, total: 1.2 s\nWall time: 1.23 s\nDigraph:\nCPU times: user 184 ms, sys: 4 ms, total: 188 ms\nWall time: 200 ms\nsage: test_KR(['D',4,2], 2, 1)\nconstruction\nCPU times: user 8 ms, sys: 4 ms, total: 12 ms\nWall time: 11 ms\nTestSuite:\nCPU times: user 1.02 s, sys: 8 ms, total: 1.03 s\nWall time: 1.05 s\nDigraph:\nCPU times: user 164 ms, sys: 4 ms, total: 168 ms\nWall time: 176 ms\nsage: test_KR(['D',4,1], 2, 2)\nconstruction\nCPU times: user 20 ms, sys: 0 ns, total: 20 ms\nWall time: 17.7 ms\nTestSuite:\nCPU times: user 4.07 s, sys: 4 ms, total: 4.07 s\nWall time: 4.08 s\nDigraph:\nCPU times: user 328 ms, sys: 4 ms, total: 332 ms\nWall time: 344 ms\n```\nBefore:\n\n```\nsage: test_KR(['A',4,1], 3, 2)\nconstruction\nCPU times: user 32 ms, sys: 0 ns, total: 32 ms\nWall time: 128 ms\nTestSuite:\nCPU times: user 2.88 s, sys: 72 ms, total: 2.95 s\nWall time: 3.54 s\nDigraph:\nCPU times: user 236 ms, sys: 8 ms, total: 244 ms\nWall time: 253 ms\n\nsage: test_KR(['D',4,1], 2, 1)\nconstruction\nCPU times: user 20 ms, sys: 4 ms, total: 24 ms\nWall time: 58.2 ms\nTestSuite:\nCPU times: user 528 ms, sys: 12 ms, total: 540 ms\nWall time: 602 ms\nDigraph:\nCPU times: user 104 ms, sys: 4 ms, total: 108 ms\nWall time: 121 ms\n\nsage: test_KR(['E',6,1], 1, 1)\nconstruction\nCPU times: user 28 ms, sys: 8 ms, total: 36 ms\nWall time: 47.7 ms\nTestSuite:\nCPU times: user 424 ms, sys: 16 ms, total: 440 ms\nWall time: 445 ms\nDigraph:\nCPU times: user 96 ms, sys: 24 ms, total: 120 ms\nWall time: 128 ms\n\nsage: test_KR(['A',6,2], 2, 1)\nconstruction\nCPU times: user 20 ms, sys: 0 ns, total: 20 ms\nWall time: 97.4 ms\nTestSuite:\nCPU times: user 716 ms, sys: 16 ms, total: 732 ms\nWall time: 762 ms\nDigraph:\nCPU times: user 168 ms, sys: 8 ms, total: 176 ms\nWall time: 189 ms\n\nsage: test_KR(['D',4,2], 2, 1)\nconstruction\nCPU times: user 12 ms, sys: 0 ns, total: 12 ms\nWall time: 11.3 ms\nTestSuite:\nCPU times: user 404 ms, sys: 28 ms, total: 432 ms\nWall time: 480 ms\nDigraph:\nCPU times: user 124 ms, sys: 8 ms, total: 132 ms\nWall time: 170 ms\n\nsage: test_KR(['D',4,1], 2, 2)\nconstruction\nCPU times: user 16 ms, sys: 4 ms, total: 20 ms\nWall time: 18 ms\nTestSuite:\nCPU times: user 5.08 s, sys: 12 ms, total: 5.1 s\nWall time: 5.13 s\nDigraph:\nCPU times: user 312 ms, sys: 4 ms, total: 316 ms\nWall time: 328 ms\n```\nNow to merge with #15882 and do some work on the doc and make all tests pass.",
    "created_at": "2014-04-13T04:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208583",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>With the new custom promotion map, I actually get a speedup when running the test suite except with the twisted types -- most likely from the maps to/from the ambient type which aren't cached as well:

```
sage: test_KR(['A',4,1], 3, 2)
construction
CPU times: user 36 ms, sys: 4 ms, total: 40 ms
Wall time: 40.1 ms
TestSuite:
CPU times: user 1.1 s, sys: 36 ms, total: 1.13 s
Wall time: 1.15 s
Digraph:
CPU times: user 144 ms, sys: 4 ms, total: 148 ms
Wall time: 164 ms
sage: test_KR(['A',4,1], 3, 2)
construction
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 240 Âµs
TestSuite:
CPU times: user 708 ms, sys: 24 ms, total: 732 ms
Wall time: 712 ms
Digraph:
CPU times: user 180 ms, sys: 4 ms, total: 184 ms
Wall time: 207 ms
sage: test_KR(['D',4,1], 2, 1)
construction
CPU times: user 24 ms, sys: 4 ms, total: 28 ms
Wall time: 26.5 ms
TestSuite:
CPU times: user 412 ms, sys: 0 ns, total: 412 ms
Wall time: 421 ms
Digraph:
CPU times: user 112 ms, sys: 4 ms, total: 116 ms
Wall time: 126 ms
sage: test_KR(['E',6,1], 1, 1)
construction
CPU times: user 124 ms, sys: 8 ms, total: 132 ms
Wall time: 132 ms
TestSuite:
CPU times: user 232 ms, sys: 0 ns, total: 232 ms
Wall time: 234 ms
Digraph:
CPU times: user 104 ms, sys: 8 ms, total: 112 ms
Wall time: 124 ms
sage: test_KR(['A',6,2], 2, 1)
construction
CPU times: user 12 ms, sys: 4 ms, total: 16 ms
Wall time: 15.3 ms
TestSuite:
CPU times: user 1.2 s, sys: 8 ms, total: 1.2 s
Wall time: 1.23 s
Digraph:
CPU times: user 184 ms, sys: 4 ms, total: 188 ms
Wall time: 200 ms
sage: test_KR(['D',4,2], 2, 1)
construction
CPU times: user 8 ms, sys: 4 ms, total: 12 ms
Wall time: 11 ms
TestSuite:
CPU times: user 1.02 s, sys: 8 ms, total: 1.03 s
Wall time: 1.05 s
Digraph:
CPU times: user 164 ms, sys: 4 ms, total: 168 ms
Wall time: 176 ms
sage: test_KR(['D',4,1], 2, 2)
construction
CPU times: user 20 ms, sys: 0 ns, total: 20 ms
Wall time: 17.7 ms
TestSuite:
CPU times: user 4.07 s, sys: 4 ms, total: 4.07 s
Wall time: 4.08 s
Digraph:
CPU times: user 328 ms, sys: 4 ms, total: 332 ms
Wall time: 344 ms
```
Before:

```
sage: test_KR(['A',4,1], 3, 2)
construction
CPU times: user 32 ms, sys: 0 ns, total: 32 ms
Wall time: 128 ms
TestSuite:
CPU times: user 2.88 s, sys: 72 ms, total: 2.95 s
Wall time: 3.54 s
Digraph:
CPU times: user 236 ms, sys: 8 ms, total: 244 ms
Wall time: 253 ms

sage: test_KR(['D',4,1], 2, 1)
construction
CPU times: user 20 ms, sys: 4 ms, total: 24 ms
Wall time: 58.2 ms
TestSuite:
CPU times: user 528 ms, sys: 12 ms, total: 540 ms
Wall time: 602 ms
Digraph:
CPU times: user 104 ms, sys: 4 ms, total: 108 ms
Wall time: 121 ms

sage: test_KR(['E',6,1], 1, 1)
construction
CPU times: user 28 ms, sys: 8 ms, total: 36 ms
Wall time: 47.7 ms
TestSuite:
CPU times: user 424 ms, sys: 16 ms, total: 440 ms
Wall time: 445 ms
Digraph:
CPU times: user 96 ms, sys: 24 ms, total: 120 ms
Wall time: 128 ms

sage: test_KR(['A',6,2], 2, 1)
construction
CPU times: user 20 ms, sys: 0 ns, total: 20 ms
Wall time: 97.4 ms
TestSuite:
CPU times: user 716 ms, sys: 16 ms, total: 732 ms
Wall time: 762 ms
Digraph:
CPU times: user 168 ms, sys: 8 ms, total: 176 ms
Wall time: 189 ms

sage: test_KR(['D',4,2], 2, 1)
construction
CPU times: user 12 ms, sys: 0 ns, total: 12 ms
Wall time: 11.3 ms
TestSuite:
CPU times: user 404 ms, sys: 28 ms, total: 432 ms
Wall time: 480 ms
Digraph:
CPU times: user 124 ms, sys: 8 ms, total: 132 ms
Wall time: 170 ms

sage: test_KR(['D',4,1], 2, 2)
construction
CPU times: user 16 ms, sys: 4 ms, total: 20 ms
Wall time: 18 ms
TestSuite:
CPU times: user 5.08 s, sys: 12 ms, total: 5.1 s
Wall time: 5.13 s
Digraph:
CPU times: user 312 ms, sys: 4 ms, total: 316 ms
Wall time: 328 ms
```
Now to merge with #15882 and do some work on the doc and make all tests pass.



---

archive/issue_comments_208584.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-04-13T06:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_208585.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T02:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_045095.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45095"
}
```



---

archive/issue_events_045096.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45096"
}
```



---

archive/issue_comments_208586.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-14T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208586",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_208587.json:
```json
{
    "body": "<a id='comment:19'></a>patchbot:\n\n```\nsage -t --long src/sage/combinat/crystals/monomial_crystals.py  # 1 doctest failed\nsage -t --long src/sage/matrix/matrix_integer_dense.pyx  # 1 doctest failed\nsage -t --long src/sage/combinat/crystals/generalized_young_walls.py  # 7 doctests failed\nsage -t --long src/sage/combinat/crystals/infinity_crystals.py  # 8 doctests failed\nsage -t --long src/sage/categories/regular_crystals.py  # 1 doctest failed\nsage -t --long src/sage/combinat/crystals/direct_sum.py  # 3 doctests failed\nsage -t --long src/sage/combinat/crystals/subcrystal.py  # 2 doctests failed\nsage -t --long src/sage/combinat/crystals/virtual_crystal.py  # 1 doctest failed\n```",
    "created_at": "2014-05-14T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208587",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>patchbot:

```
sage -t --long src/sage/combinat/crystals/monomial_crystals.py  # 1 doctest failed
sage -t --long src/sage/matrix/matrix_integer_dense.pyx  # 1 doctest failed
sage -t --long src/sage/combinat/crystals/generalized_young_walls.py  # 7 doctests failed
sage -t --long src/sage/combinat/crystals/infinity_crystals.py  # 8 doctests failed
sage -t --long src/sage/categories/regular_crystals.py  # 1 doctest failed
sage -t --long src/sage/combinat/crystals/direct_sum.py  # 3 doctests failed
sage -t --long src/sage/combinat/crystals/subcrystal.py  # 2 doctests failed
sage -t --long src/sage/combinat/crystals/virtual_crystal.py  # 1 doctest failed
```



---

archive/issue_comments_208588.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-15T07:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208589.json:
```json
{
    "body": "<a id='comment:21'></a>Hey Ralf,\n\nPlease don't use the patchbot as absolute truth for doctest failures as it can give false negatives. I could not reproduce the integer matrix failures (which is completely unrelated to this ticket). If you're going to change the status of the ticket, I would like you to make sure to actually test the files in question as part of an actual review. Thank you.",
    "created_at": "2014-05-15T07:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208589",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>Hey Ralf,

Please don't use the patchbot as absolute truth for doctest failures as it can give false negatives. I could not reproduce the integer matrix failures (which is completely unrelated to this ticket). If you're going to change the status of the ticket, I would like you to make sure to actually test the files in question as part of an actual review. Thank you.



---

archive/issue_comments_208590.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-15T07:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208590",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_208591.json:
```json
{
    "body": "<a id='comment:23'></a>Will do!",
    "created_at": "2014-05-15T08:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208591",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'></a>Will do!



---

archive/issue_comments_208592.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-17T19:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208593.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-26T03:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_045097.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45097"
}
```



---

archive/issue_events_045098.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45098"
}
```



---

archive/issue_comments_208594.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-15T14:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208595.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-16T08:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208596.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-17T05:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208597.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-25T20:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208598.json:
```json
{
    "body": "<a id='comment:31'></a>Conflicts with #16001.",
    "created_at": "2014-09-25T20:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208598",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>Conflicts with #16001.



---

archive/issue_comments_208599.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-17T18:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208600.json:
```json
{
    "body": "<a id='comment:33'></a>many failing doctests, see patchbot report",
    "created_at": "2015-04-09T19:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208600",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>many failing doctests, see patchbot report



---

archive/issue_comments_208601.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-09T19:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208601",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_208602.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-15T20:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208603.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-16T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208604.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-16T17:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208604",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_208605.json:
```json
{
    "body": "<a id='comment:36'></a>I simplified the classes for the different types of crystal morphisms down to a single class as Anne and I discussed.\n\nI also implemented a `subtype` method for `CartanType` to simplify the overall interface so that crystal morphisms does not directly depend on the index set (instead it is indirectly as part of the Cartan type).",
    "created_at": "2015-06-16T17:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208605",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>I simplified the classes for the different types of crystal morphisms down to a single class as Anne and I discussed.

I also implemented a `subtype` method for `CartanType` to simplify the overall interface so that crystal morphisms does not directly depend on the index set (instead it is indirectly as part of the Cartan type).



---

archive/issue_events_045099.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-06-16T17:34:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45099"
}
```



---

archive/issue_events_045100.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-06-16T17:34:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45100"
}
```



---

archive/issue_comments_208606.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-17T10:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208606",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_208607.json:
```json
{
    "body": "<a id='comment:37'></a>4 doctests failing, and one old-style raise statement re-introduced",
    "created_at": "2015-06-17T10:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208607",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>4 doctests failing, and one old-style raise statement re-introduced



---

archive/issue_comments_208608.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-06-17T19:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_208609.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-17T19:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208610.json:
```json
{
    "body": "<a id='comment:40'></a>Fixed.\n\n#18453 introduced a bug in computing the weight for elements in the highest weight Nakajima monomial model (mainly, the weight of any highest weight element is 0). I have fixed it on this branch, but if this will not be getting in soon, we should split that fix off into a separate branch.",
    "created_at": "2015-06-17T19:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208610",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Fixed.

#18453 introduced a bug in computing the weight for elements in the highest weight Nakajima monomial model (mainly, the weight of any highest weight element is 0). I have fixed it on this branch, but if this will not be getting in soon, we should split that fix off into a separate branch.



---

archive/issue_comments_208611.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-17T19:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208611",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_208612.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:40 tscrim]:\n> Fixed.\n> \n> #18453 introduced a bug in computing the weight for elements in the highest weight Nakajima monomial model (mainly, the weight of any highest weight element is 0). I have fixed it on this branch, but if this will not be getting in soon, we should split that fix off into a separate branch.\n\n\nIf there is a bug in Nakajima monomials, I suggest that you split that off (since I will have quite a few changes to this patch) and discuss it with Ben (as he did most of the changes in #18453 to Nakajima monomials).\n\nBest,\n\nAnne",
    "created_at": "2015-06-17T20:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208612",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:41'></a>Replying to [comment:40 tscrim]:
> Fixed.
> 
> #18453 introduced a bug in computing the weight for elements in the highest weight Nakajima monomial model (mainly, the weight of any highest weight element is 0). I have fixed it on this branch, but if this will not be getting in soon, we should split that fix off into a separate branch.


If there is a bug in Nakajima monomials, I suggest that you split that off (since I will have quite a few changes to this patch) and discuss it with Ben (as he did most of the changes in #18453 to Nakajima monomials).

Best,

Anne



---

archive/issue_comments_208613.json:
```json
{
    "body": "<a id='comment:42'></a>This is now #18722.",
    "created_at": "2015-06-17T20:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208613",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>This is now #18722.



---

archive/issue_comments_208614.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-17T20:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208614",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208615.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-20T04:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208616.json:
```json
{
    "body": "<a id='comment:45'></a>Hi Travis,\n\nHere are some comments on the current branch:\n\n- I am not quite sure how to use the induced crystal. Either the code is wrong or the documentation needs to be updated\n\n```\nsage: X = Words(2,4)\nsage: L = crystals.Letters(['A',1])\nsage: T = crystals.TensorProduct(*[L]*4)\nsage: Phi = lambda x : Word([i.value for i in x])\nsage: I = crystals.Induced(T,Phi,preimage=X,from_crystal=True)\nsage: b = I[0]\nsage: b\nword: 1111\nsage: b.parent()\nCrystal induced by <function <lambda> at 0x1102d8c80> from Full tensor product of the crystals [The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1]]\nsage: b.f(1)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-43-0a3acf464041> in <module>()\n----> 1 b.f(Integer(1))\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in f(self, i)\n    593             \"\"\"\n    594             P = self.parent()\n--> 595             ret = P._preimage(self.value).f(i)\n    596             if ret is None:\n    597                 return None\n\nAttributeError: 'FiniteWord_list' object has no attribute 'f'\n```\n\n- The other way is really also not what one would expect\n\n```\nsage: X = Words(2,4)\nsage: L = crystals.Letters(['A',1])\nsage: T = crystals.TensorProduct(*[L]*4)\nsage: Phi = lambda x : T(*[L(i) for i in x])\nsage: I = crystals.Induced(X,Phi,preimage=T)\nsage: view(I)\n```\n\n- Many of the morphism methods do not work\n\n```\nsage: B = crystals.Tableaux(['C',2], shape=[1,1])\nsage: C = crystals.Tableaux(['C',2], ([2,1], [1,1]))\nsage: psi = B.crystal_morphism(C.module_generators[1:], codomain=C)\nsage: psi.is_surjective()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-64-cf3b5c84f16e> in <module>()\n----> 1 psi.is_surjective()\n\n/Applications/sage/src/sage/categories/map.pyx in sage.categories.map.Map.is_surjective (/Applications/sage/src/build/cythonized/sage/categories/map.c:8344)()\n   1207             NotImplementedError: <type 'sage.categories.map.Map'>\n   1208         \"\"\"\n-> 1209         raise NotImplementedError, type(self)\n   1210 \n   1211     def __pow__(Map self, n, dummy):\n\nNotImplementedError: <class 'sage.categories.highest_weight_crystals.HighestWeightCrystalHomset_with_category.element_class'>\nsage: psi.is_zero()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-65-39b9856b43ed> in <module>()\n----> 1 psi.is_zero()\n\n/Applications/sage/src/sage/structure/element.pyx in sage.structure.element.Element.is_zero (/Applications/sage/src/build/cythonized/sage/structure/element.c:8906)()\n    905             implement ``__nonzero__`` instead.\n    906         \"\"\"\n--> 907         return not self\n    908 \n    909     cdef int _cmp(self, other) except -2:\n\n/Applications/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__nonzero__ (/Applications/sage/src/build/cythonized/sage/structure/element.c:8819)()\n    891             False\n    892         \"\"\"\n--> 893         return self != self._parent.zero()\n    894 \n    895     def is_zero(self):\n\n/Applications/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__getattr__ (/Applications/sage/src/build/cythonized/sage/structure/parent.c:7833)()\n    839             return self.__cached_methods[name]\n    840         except KeyError:\n--> 841             attr = getattr_from_other_class(self, self._category.parent_class, name)\n    842             self.__cached_methods[name] = attr\n    843             return attr\n\n/Applications/sage/src/sage/structure/misc.pyx in sage.structure.misc.getattr_from_other_class (/Applications/sage/src/build/cythonized/sage/structure/misc.c:1580)()\n    251         dummy_error_message.cls = type(self)\n    252         dummy_error_message.name = name\n--> 253         raise dummy_attribute_error\n    254     try:\n    255         attribute = getattr(cls, name)\n\nAttributeError: 'HighestWeightCrystalHomset_with_category_with_equality_by_id' object has no attribute 'zero'\n```\n\n- subcrystals now has options ``virtualization``, ``scaling_factors``, but there are no examples on how to use them. Please add examples that test all options.\n\n- What is the status on the slow down that you mentioned earlier for KR crystals? I think such a huge slow down would not be acceptable (since they are anyway slow already).\n\nSo much for now,\n\nAnne",
    "created_at": "2015-06-21T02:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208616",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:45'></a>Hi Travis,

Here are some comments on the current branch:

- I am not quite sure how to use the induced crystal. Either the code is wrong or the documentation needs to be updated

```
sage: X = Words(2,4)
sage: L = crystals.Letters(['A',1])
sage: T = crystals.TensorProduct(*[L]*4)
sage: Phi = lambda x : Word([i.value for i in x])
sage: I = crystals.Induced(T,Phi,preimage=X,from_crystal=True)
sage: b = I[0]
sage: b
word: 1111
sage: b.parent()
Crystal induced by <function <lambda> at 0x1102d8c80> from Full tensor product of the crystals [The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1]]
sage: b.f(1)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-43-0a3acf464041> in <module>()
----> 1 b.f(Integer(1))

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in f(self, i)
    593             """
    594             P = self.parent()
--> 595             ret = P._preimage(self.value).f(i)
    596             if ret is None:
    597                 return None

AttributeError: 'FiniteWord_list' object has no attribute 'f'
```

- The other way is really also not what one would expect

```
sage: X = Words(2,4)
sage: L = crystals.Letters(['A',1])
sage: T = crystals.TensorProduct(*[L]*4)
sage: Phi = lambda x : T(*[L(i) for i in x])
sage: I = crystals.Induced(X,Phi,preimage=T)
sage: view(I)
```

- Many of the morphism methods do not work

```
sage: B = crystals.Tableaux(['C',2], shape=[1,1])
sage: C = crystals.Tableaux(['C',2], ([2,1], [1,1]))
sage: psi = B.crystal_morphism(C.module_generators[1:], codomain=C)
sage: psi.is_surjective()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-64-cf3b5c84f16e> in <module>()
----> 1 psi.is_surjective()

/Applications/sage/src/sage/categories/map.pyx in sage.categories.map.Map.is_surjective (/Applications/sage/src/build/cythonized/sage/categories/map.c:8344)()
   1207             NotImplementedError: <type 'sage.categories.map.Map'>
   1208         """
-> 1209         raise NotImplementedError, type(self)
   1210 
   1211     def __pow__(Map self, n, dummy):

NotImplementedError: <class 'sage.categories.highest_weight_crystals.HighestWeightCrystalHomset_with_category.element_class'>
sage: psi.is_zero()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-65-39b9856b43ed> in <module>()
----> 1 psi.is_zero()

/Applications/sage/src/sage/structure/element.pyx in sage.structure.element.Element.is_zero (/Applications/sage/src/build/cythonized/sage/structure/element.c:8906)()
    905             implement ``__nonzero__`` instead.
    906         """
--> 907         return not self
    908 
    909     cdef int _cmp(self, other) except -2:

/Applications/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__nonzero__ (/Applications/sage/src/build/cythonized/sage/structure/element.c:8819)()
    891             False
    892         """
--> 893         return self != self._parent.zero()
    894 
    895     def is_zero(self):

/Applications/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__getattr__ (/Applications/sage/src/build/cythonized/sage/structure/parent.c:7833)()
    839             return self.__cached_methods[name]
    840         except KeyError:
--> 841             attr = getattr_from_other_class(self, self._category.parent_class, name)
    842             self.__cached_methods[name] = attr
    843             return attr

/Applications/sage/src/sage/structure/misc.pyx in sage.structure.misc.getattr_from_other_class (/Applications/sage/src/build/cythonized/sage/structure/misc.c:1580)()
    251         dummy_error_message.cls = type(self)
    252         dummy_error_message.name = name
--> 253         raise dummy_attribute_error
    254     try:
    255         attribute = getattr(cls, name)

AttributeError: 'HighestWeightCrystalHomset_with_category_with_equality_by_id' object has no attribute 'zero'
```

- subcrystals now has options ``virtualization``, ``scaling_factors``, but there are no examples on how to use them. Please add examples that test all options.

- What is the status on the slow down that you mentioned earlier for KR crystals? I think such a huge slow down would not be acceptable (since they are anyway slow already).

So much for now,

Anne



---

archive/issue_comments_208617.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 aschilling]:\n> - I am not quite sure how to use the induced crystal. Either the code is wrong or the documentation needs to be updated\n> \n> ```\n> sage: X = Words(2,4)\n> sage: L = crystals.Letters(['A',1])\n> sage: T = crystals.TensorProduct(*[L]*4)\n> sage: Phi = lambda x : Word([i.value for i in x])\n> sage: I = crystals.Induced(T,Phi,preimage=X,from_crystal=True)\n> sage: b = I[0]\n> sage: b\n> word: 1111\n> sage: b.parent()\n> Crystal induced by <function <lambda> at 0x1102d8c80> from Full tensor product of the crystals [The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1]]\n> sage: b.f(1)\n> ---------------------------------------------------------------------------\n> AttributeError                            Traceback (most recent call last)\n> <ipython-input-43-0a3acf464041> in <module>()\n> ----> 1 b.f(Integer(1))\n> \n> /Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in f(self, i)\n>     593             \"\"\"\n>     594             P = self.parent()\n> --> 595             ret = P._preimage(self.value).f(i)\n>     596             if ret is None:\n>     597                 return None\n> \n> AttributeError: 'FiniteWord_list' object has no attribute 'f'\n> ```\n> \n> - The other way is really also not what one would expect\n> \n> ```\n> sage: X = Words(2,4)\n> sage: L = crystals.Letters(['A',1])\n> sage: T = crystals.TensorProduct(*[L]*4)\n> sage: Phi = lambda x : T(*[L(i) for i in x])\n> sage: I = crystals.Induced(X,Phi,preimage=T)\n> sage: view(I)\n> ```\n\n\nI will take a look at this in more detail and update documentation/examples accordingly.\n\n> - Many of the morphism methods do not work\n> \n> ```\n> sage: B = crystals.Tableaux(['C',2], shape=[1,1])\n> sage: C = crystals.Tableaux(['C',2], ([2,1], [1,1]))\n> sage: psi = B.crystal_morphism(C.module_generators[1:], codomain=C)\n> sage: psi.is_surjective()\n> [...]\n> NotImplementedError: <class 'sage.categories.highest_weight_crystals.HighestWeightCrystalHomset_with_category.element_class'>\n> ```\n\n\nIn general, this is an undecidable problem and should result in this error. However, since this is a morphism of a finite crystal, this should work at the very least by brute force. Will implement.\n\n> {{{\n> sage: psi.is_zero()\n> [...]\n> AttributeError: 'HighestWeightCrystalHomset_with_category_with_equality_by_id' object has no attribute 'zero'\n> }}}\n\n\nThis is easy enough to check as long as the crystals have a finite generating set; otherwise it may run forever.\n\n> - subcrystals now has options ``virtualization``, ``scaling_factors``, but there are no examples on how to use them. Please add examples that test all options.\n\n\nWill do.\n\n> - What is the status on the slow down that you mentioned earlier for KR crystals? I think such a huge slow down would not be acceptable (since they are anyway slow already).\n\n\nSee comment:15. Overall it seems the caching and construction of the morphisms I do is faster than before. However there seems to be some slowdowns when there is no caching (and for some object creations, but these are acceptable IMO as it is small in absolute time and the creation of KR crystals is infrequent). I can try and optimize it more if you think what is currently there is insufficient.",
    "created_at": "2015-06-21T06:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208617",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Replying to [comment:45 aschilling]:
> - I am not quite sure how to use the induced crystal. Either the code is wrong or the documentation needs to be updated
> 
> ```
> sage: X = Words(2,4)
> sage: L = crystals.Letters(['A',1])
> sage: T = crystals.TensorProduct(*[L]*4)
> sage: Phi = lambda x : Word([i.value for i in x])
> sage: I = crystals.Induced(T,Phi,preimage=X,from_crystal=True)
> sage: b = I[0]
> sage: b
> word: 1111
> sage: b.parent()
> Crystal induced by <function <lambda> at 0x1102d8c80> from Full tensor product of the crystals [The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1], The crystal of letters for type ['A', 1]]
> sage: b.f(1)
> ---------------------------------------------------------------------------
> AttributeError                            Traceback (most recent call last)
> <ipython-input-43-0a3acf464041> in <module>()
> ----> 1 b.f(Integer(1))
> 
> /Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in f(self, i)
>     593             """
>     594             P = self.parent()
> --> 595             ret = P._preimage(self.value).f(i)
>     596             if ret is None:
>     597                 return None
> 
> AttributeError: 'FiniteWord_list' object has no attribute 'f'
> ```
> 
> - The other way is really also not what one would expect
> 
> ```
> sage: X = Words(2,4)
> sage: L = crystals.Letters(['A',1])
> sage: T = crystals.TensorProduct(*[L]*4)
> sage: Phi = lambda x : T(*[L(i) for i in x])
> sage: I = crystals.Induced(X,Phi,preimage=T)
> sage: view(I)
> ```


I will take a look at this in more detail and update documentation/examples accordingly.

> - Many of the morphism methods do not work
> 
> ```
> sage: B = crystals.Tableaux(['C',2], shape=[1,1])
> sage: C = crystals.Tableaux(['C',2], ([2,1], [1,1]))
> sage: psi = B.crystal_morphism(C.module_generators[1:], codomain=C)
> sage: psi.is_surjective()
> [...]
> NotImplementedError: <class 'sage.categories.highest_weight_crystals.HighestWeightCrystalHomset_with_category.element_class'>
> ```


In general, this is an undecidable problem and should result in this error. However, since this is a morphism of a finite crystal, this should work at the very least by brute force. Will implement.

> {{{
> sage: psi.is_zero()
> [...]
> AttributeError: 'HighestWeightCrystalHomset_with_category_with_equality_by_id' object has no attribute 'zero'
> }}}


This is easy enough to check as long as the crystals have a finite generating set; otherwise it may run forever.

> - subcrystals now has options ``virtualization``, ``scaling_factors``, but there are no examples on how to use them. Please add examples that test all options.


Will do.

> - What is the status on the slow down that you mentioned earlier for KR crystals? I think such a huge slow down would not be acceptable (since they are anyway slow already).


See comment:15. Overall it seems the caching and construction of the morphisms I do is faster than before. However there seems to be some slowdowns when there is no caching (and for some object creations, but these are acceptable IMO as it is small in absolute time and the creation of KR crystals is infrequent). I can try and optimize it more if you think what is currently there is insufficient.



---

archive/issue_comments_208618.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-21T19:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208618",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208619.json:
```json
{
    "body": "<a id='comment:48'></a>I've added support for many of the methods for the morphisms (and generalized them so that they work when the domain is finite).\n\nFor the induced crystals, `preimage` was the wrong word; it should have been `inverse`. I've updated the documentation accordingly.\n\nDo you want me to try and further optimize the KR crystals?",
    "created_at": "2015-06-21T19:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208619",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:48'></a>I've added support for many of the methods for the morphisms (and generalized them so that they work when the domain is finite).

For the induced crystals, `preimage` was the wrong word; it should have been `inverse`. I've updated the documentation accordingly.

Do you want me to try and further optimize the KR crystals?



---

archive/issue_comments_208620.json:
```json
{
    "body": "<a id='comment:49'></a>> For the induced crystals, `preimage` was the wrong word; it should have been `inverse`. I've updated the documentation accordingly.\n\n\nWell, Travis, it still does not work\n\n```\nsage: X = Words(2,4)\nsage: L = crystals.Letters(['A',1])\nsage: T = crystals.TensorProduct(*[L]*4)\nsage: Phi = lambda x : T(*[L(i) for i in x])\nsage: I = crystals.Induced(X,Phi)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-21-64af8dd3a5ae> in <module>()\n----> 1 I = crystals.Induced(X,Phi)\n\n/Applications/sage/src/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (/Applications/sage/src/build/cythonized/sage/misc/classcall_metaclass.c:1207)()\n    324         \"\"\"\n    325         if cls.classcall is not None:\n--> 326             return cls.classcall(cls, *args, **kwds)\n    327         else:\n    328             # Fast version of type.__call__(cls, *args, **kwds)\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in __classcall_private__(cls, X, phi, inverse, codomain, from_crystal)\n    134                 codomain = phi(X.an_element()).parent()\n    135 \n--> 136         return super(InducedCrystal, cls).__classcall__(cls, X, phi, inverse, codomain)\n    137 \n    138     def __init__(self, X, phi, inverse, codomain):\n\n/Applications/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.WeakCachedFunction.__call__ (/Applications/sage/src/build/cythonized/sage/misc/cachefunc.c:8111)()\n   1308             except TypeError: # k is not hashable\n   1309                 k = (_cache_key,_cache_key(k))\n-> 1310                 return self.cache[k]\n   1311         except KeyError:\n   1312             w = self.f(*args, **kwds)\n\n/Applications/sage/src/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (/Applications/sage/src/build/cythonized/sage/misc/weak_dict.c:3661)()\n    876 \n    877         \"\"\"\n--> 878         cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    879         if wr == NULL:\n    880             raise KeyError(k)\n\n/Applications/sage/src/sage/misc/weak_dict.pyx in sage.misc.weak_dict.PyDict_GetItemWithError (/Applications/sage/src/build/cythonized/sage/misc/weak_dict.c:1073)()\n    147     cdef PyDictEntry* ep\n    148     cdef PyDictObject* mp = <PyDictObject*><void *>op\n--> 149     ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))\n    150     if ep:\n    151         return ep.me_value\n\nTypeError: unhashable type: 'dict'\n```\nSo please either remove this from the patch or fix it and show me how to do it in the above example.\n\nThanks,\n\nAnne",
    "created_at": "2015-06-21T21:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208620",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:49'></a>> For the induced crystals, `preimage` was the wrong word; it should have been `inverse`. I've updated the documentation accordingly.


Well, Travis, it still does not work

```
sage: X = Words(2,4)
sage: L = crystals.Letters(['A',1])
sage: T = crystals.TensorProduct(*[L]*4)
sage: Phi = lambda x : T(*[L(i) for i in x])
sage: I = crystals.Induced(X,Phi)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-21-64af8dd3a5ae> in <module>()
----> 1 I = crystals.Induced(X,Phi)

/Applications/sage/src/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (/Applications/sage/src/build/cythonized/sage/misc/classcall_metaclass.c:1207)()
    324         """
    325         if cls.classcall is not None:
--> 326             return cls.classcall(cls, *args, **kwds)
    327         else:
    328             # Fast version of type.__call__(cls, *args, **kwds)

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/induced_structure.pyc in __classcall_private__(cls, X, phi, inverse, codomain, from_crystal)
    134                 codomain = phi(X.an_element()).parent()
    135 
--> 136         return super(InducedCrystal, cls).__classcall__(cls, X, phi, inverse, codomain)
    137 
    138     def __init__(self, X, phi, inverse, codomain):

/Applications/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.WeakCachedFunction.__call__ (/Applications/sage/src/build/cythonized/sage/misc/cachefunc.c:8111)()
   1308             except TypeError: # k is not hashable
   1309                 k = (_cache_key,_cache_key(k))
-> 1310                 return self.cache[k]
   1311         except KeyError:
   1312             w = self.f(*args, **kwds)

/Applications/sage/src/sage/misc/weak_dict.pyx in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (/Applications/sage/src/build/cythonized/sage/misc/weak_dict.c:3661)()
    876 
    877         """
--> 878         cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    879         if wr == NULL:
    880             raise KeyError(k)

/Applications/sage/src/sage/misc/weak_dict.pyx in sage.misc.weak_dict.PyDict_GetItemWithError (/Applications/sage/src/build/cythonized/sage/misc/weak_dict.c:1073)()
    147     cdef PyDictEntry* ep
    148     cdef PyDictObject* mp = <PyDictObject*><void *>op
--> 149     ep = mp.ma_lookup(mp, <PyObject*><void*>key, PyObject_Hash(key))
    150     if ep:
    151         return ep.me_value

TypeError: unhashable type: 'dict'
```
So please either remove this from the patch or fix it and show me how to do it in the above example.

Thanks,

Anne



---

archive/issue_comments_208621.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-22T02:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208622.json:
```json
{
    "body": "<a id='comment:51'></a>Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.",
    "created_at": "2015-06-22T02:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208622",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:51'></a>Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.



---

archive/issue_comments_208623.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 tscrim]:\n> Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.\n\n\nOk, it works better now. But why do you let the user input the inverse function? Is it checked that the function is the inverse and that the result is a crystal? The following gives the wrong results (I agree that Phi_inv is not the inverse of Phi, but this could happen by accident):\n\n```\nsage: X = Words(2,3)\nsage: L = crystals.Letters(['A',1])\nsage: T = crystals.TensorProduct(*[L]*3)\nsage: Phi = lambda x : Word([i.value for i in x])\nsage: Phi_inv = lambda x : T(*[L(i) for i in x.reversal()])\nsage: I = crystals.Induced(T,Phi,Phi_inv,from_crystal=True)\nsage: view(I)\n```\nAlso, I was able to input the wrong codomain and the code did not complain. Why should this be inputted?\n\nBest,\n\nAnne",
    "created_at": "2015-06-22T18:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208623",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:52'></a>Replying to [comment:51 tscrim]:
> Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.


Ok, it works better now. But why do you let the user input the inverse function? Is it checked that the function is the inverse and that the result is a crystal? The following gives the wrong results (I agree that Phi_inv is not the inverse of Phi, but this could happen by accident):

```
sage: X = Words(2,3)
sage: L = crystals.Letters(['A',1])
sage: T = crystals.TensorProduct(*[L]*3)
sage: Phi = lambda x : Word([i.value for i in x])
sage: Phi_inv = lambda x : T(*[L(i) for i in x.reversal()])
sage: I = crystals.Induced(T,Phi,Phi_inv,from_crystal=True)
sage: view(I)
```
Also, I was able to input the wrong codomain and the code did not complain. Why should this be inputted?

Best,

Anne



---

archive/issue_comments_208624.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:52 aschilling]:\n> Replying to [comment:51 tscrim]:\n> > Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.\n\n> \n> Ok, it works better now. But why do you let the user input the inverse function? Is it checked that the function is the inverse and that the result is a crystal? The following gives the wrong results (I agree that Phi_inv is not the inverse of Phi, but this could happen by accident):\n> \n> ```\n> sage: X = Words(2,3)\n> sage: L = crystals.Letters(['A',1])\n> sage: T = crystals.TensorProduct(*[L]*3)\n> sage: Phi = lambda x : Word([i.value for i in x])\n> sage: Phi_inv = lambda x : T(*[L(i) for i in x.reversal()])\n> sage: I = crystals.Induced(T,Phi,Phi_inv,from_crystal=True)\n> sage: view(I)\n> ```\n\n\nI made it this way because I wanted it to work with infinite sets. For finite sets, I could add an explicit check that it is the inverse function (with an optional check argument).\n\n> Also, I was able to input the wrong codomain and the code did not complain. Why should this be inputted?\n\n\nI guess I really don't need this since I'm operating under the assumption that the crystal is non-empty. Will change.\n\nNote for self, add examples for virtualization arguments to subcrystal.",
    "created_at": "2015-06-22T18:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208624",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'></a>Replying to [comment:52 aschilling]:
> Replying to [comment:51 tscrim]:
> > Hmmm....that's an interesting way for an unhashable to be obtained and shows what I get for only testing by explicitly constructing the inverse map and passing that in. I've moved the logic for determining an inverse map when none is specified into the appropriate classes, so it should work now.

> 
> Ok, it works better now. But why do you let the user input the inverse function? Is it checked that the function is the inverse and that the result is a crystal? The following gives the wrong results (I agree that Phi_inv is not the inverse of Phi, but this could happen by accident):
> 
> ```
> sage: X = Words(2,3)
> sage: L = crystals.Letters(['A',1])
> sage: T = crystals.TensorProduct(*[L]*3)
> sage: Phi = lambda x : Word([i.value for i in x])
> sage: Phi_inv = lambda x : T(*[L(i) for i in x.reversal()])
> sage: I = crystals.Induced(T,Phi,Phi_inv,from_crystal=True)
> sage: view(I)
> ```


I made it this way because I wanted it to work with infinite sets. For finite sets, I could add an explicit check that it is the inverse function (with an optional check argument).

> Also, I was able to input the wrong codomain and the code did not complain. Why should this be inputted?


I guess I really don't need this since I'm operating under the assumption that the crystal is non-empty. Will change.

Note for self, add examples for virtualization arguments to subcrystal.



---

archive/issue_comments_208625.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T01:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208626.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-11T12:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208626",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208627.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-12T11:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208628.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-12T11:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208628",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208629.json:
```json
{
    "body": "<a id='comment:58'></a>I get doctest failures:\n\n```\nsage -t ../../categories/crystals.py\n**********************************************************************\nFile \"../../categories/crystals.py\", line 395, in sage.categories.crystals.Crystals.ParentMethods.?\nFailed example:\n    list(C.subcrystal(index_set=[1,3], generators=[C(1,4)], direction='upper'))\nExpected:\n    [[[1, 4]], [[1, 3]]]\nGot:\n    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]\n**********************************************************************\nFile \"../../categories/crystals.py\", line 397, in sage.categories.crystals.Crystals.ParentMethods.?\nFailed example:\n    list(C.subcrystal(index_set=[1,3], generators=[C(1,4)], direction='lower'))\nExpected:\n    [[[1, 4]], [[2, 4]]]\nGot:\n    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]\n**********************************************************************\nFile \"../../categories/crystals.py\", line 1641, in sage.categories.crystals.Crystals.ElementMethods.?\nFailed example:\n    list(elt.subcrystal(index_set=[1,3], direction='upper'))\nExpected:\n    [[[1, 4]], [[1, 3]]]\nGot:\n    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]\n**********************************************************************\nFile \"../../categories/crystals.py\", line 1643, in sage.categories.crystals.Crystals.ElementMethods.?\nFailed example:\n    list(elt.subcrystal(index_set=[1,3], direction='lower'))\nExpected:\n    [[[1, 4]], [[2, 4]]]\nGot:\n    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]\n**********************************************************************\n[...]\nsage -t subcrystal.py\n**********************************************************************\nFile \"subcrystal.py\", line 74, in sage.combinat.crystals.subcrystal.Subcrystal\nFailed example:\n    S.cardinality()\nExpected:\n    11\nGot:\n    20\n**********************************************************************\nFile \"subcrystal.py\", line 97, in sage.combinat.crystals.subcrystal.Subcrystal\nFailed example:\n    list(U)\nExpected:\n    [[[1, 1], [2]]]\nGot:\n    [[[1, 1], [2]],\n     [[1, 1], [3]],\n     [[1, 2], [2]],\n     [[1, 2], [3]],\n     [[1, 3], [2]],\n     [[1, 3], [3]],\n     [[2, 2], [3]],\n     [[2, 3], [3]]]\n**********************************************************************\n```\nthat I am working on fixing, but the rest of my changes are good and up for review.",
    "created_at": "2015-07-12T11:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208629",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:58'></a>I get doctest failures:

```
sage -t ../../categories/crystals.py
**********************************************************************
File "../../categories/crystals.py", line 395, in sage.categories.crystals.Crystals.ParentMethods.?
Failed example:
    list(C.subcrystal(index_set=[1,3], generators=[C(1,4)], direction='upper'))
Expected:
    [[[1, 4]], [[1, 3]]]
Got:
    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]
**********************************************************************
File "../../categories/crystals.py", line 397, in sage.categories.crystals.Crystals.ParentMethods.?
Failed example:
    list(C.subcrystal(index_set=[1,3], generators=[C(1,4)], direction='lower'))
Expected:
    [[[1, 4]], [[2, 4]]]
Got:
    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]
**********************************************************************
File "../../categories/crystals.py", line 1641, in sage.categories.crystals.Crystals.ElementMethods.?
Failed example:
    list(elt.subcrystal(index_set=[1,3], direction='upper'))
Expected:
    [[[1, 4]], [[1, 3]]]
Got:
    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]
**********************************************************************
File "../../categories/crystals.py", line 1643, in sage.categories.crystals.Crystals.ElementMethods.?
Failed example:
    list(elt.subcrystal(index_set=[1,3], direction='lower'))
Expected:
    [[[1, 4]], [[2, 4]]]
Got:
    [[[1, 4]], [[2, 4]], [[1, 3]], [[2, 3]]]
**********************************************************************
[...]
sage -t subcrystal.py
**********************************************************************
File "subcrystal.py", line 74, in sage.combinat.crystals.subcrystal.Subcrystal
Failed example:
    S.cardinality()
Expected:
    11
Got:
    20
**********************************************************************
File "subcrystal.py", line 97, in sage.combinat.crystals.subcrystal.Subcrystal
Failed example:
    list(U)
Expected:
    [[[1, 1], [2]]]
Got:
    [[[1, 1], [2]],
     [[1, 1], [3]],
     [[1, 2], [2]],
     [[1, 2], [3]],
     [[1, 3], [2]],
     [[1, 3], [3]],
     [[2, 2], [3]],
     [[2, 3], [3]]]
**********************************************************************
```
that I am working on fixing, but the rest of my changes are good and up for review.



---

archive/issue_comments_208630.json:
```json
{
    "body": "<a id='comment:59'></a>could you please correct the INPUT:: and OUTPUT:: that you introduce ?",
    "created_at": "2015-07-12T11:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208630",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:59'></a>could you please correct the INPUT:: and OUTPUT:: that you introduce ?



---

archive/issue_comments_208631.json:
```json
{
    "body": "<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-12T11:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208631",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208632.json:
```json
{
    "body": "<a id='comment:61'></a>I found the `INPUT::` mistake(s). Good catch, thanks! (Although I couldn't find any `OUTPUT::`.)",
    "created_at": "2015-07-12T11:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208632",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:61'></a>I found the `INPUT::` mistake(s). Good catch, thanks! (Although I couldn't find any `OUTPUT::`.)



---

archive/issue_comments_208633.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-12T12:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208634.json:
```json
{
    "body": "<a id='comment:63'></a>All bugs should be gone now.",
    "created_at": "2015-07-12T12:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208634",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:63'></a>All bugs should be gone now.



---

archive/issue_comments_208635.json:
```json
{
    "body": "<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T03:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208635",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208636.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T04:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208636",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208637.json:
```json
{
    "body": "<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T06:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208637",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208638.json:
```json
{
    "body": "<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T07:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208639.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T07:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208639",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208640.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T10:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208640",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208641.json:
```json
{
    "body": "<a id='comment:70'></a>I get the following doctest failure\n\n```\nsage -t --long affinization.py\n**********************************************************************\nFile \"affinization.py\", line 235, in sage.combinat.crystals.affinization.AffinizationOfCrystal.Element.__lt__\nFailed example:\n    sorted(S)\nExpected:\n    [[[1, 1], [2, 2]](0),\n     [[1, 1], [2, 3]](0),\n     [[1, 2], [2, 3]](0),\n     [[1, 1], [3, 3]](0),\n     [[1, 1], [2, 3]](1),\n     [[1, 2], [2, 3]](1),\n     [[1, 2], [3, 3]](1),\n     [[2, 2], [3, 3]](2)]\nGot:\n    [[[1, 1], [2, 2]](0),\n     [[1, 2], [2, 3]](1),\n     [[1, 1], [2, 3]](0),\n     [[1, 2], [3, 3]](1),\n     [[1, 1], [2, 3]](1),\n     [[1, 2], [2, 3]](0),\n     [[1, 1], [3, 3]](0),\n     [[2, 2], [3, 3]](2)]\n**********************************************************************\n```",
    "created_at": "2015-07-13T11:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208641",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:70'></a>I get the following doctest failure

```
sage -t --long affinization.py
**********************************************************************
File "affinization.py", line 235, in sage.combinat.crystals.affinization.AffinizationOfCrystal.Element.__lt__
Failed example:
    sorted(S)
Expected:
    [[[1, 1], [2, 2]](0),
     [[1, 1], [2, 3]](0),
     [[1, 2], [2, 3]](0),
     [[1, 1], [3, 3]](0),
     [[1, 1], [2, 3]](1),
     [[1, 2], [2, 3]](1),
     [[1, 2], [3, 3]](1),
     [[2, 2], [3, 3]](2)]
Got:
    [[[1, 1], [2, 2]](0),
     [[1, 2], [2, 3]](1),
     [[1, 1], [2, 3]](0),
     [[1, 2], [3, 3]](1),
     [[1, 1], [2, 3]](1),
     [[1, 2], [2, 3]](0),
     [[1, 1], [3, 3]](0),
     [[2, 2], [3, 3]](2)]
**********************************************************************
```



---

archive/issue_comments_208642.json:
```json
{
    "body": "<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T11:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208643.json:
```json
{
    "body": "<a id='comment:72'></a>I implemented the necessary `__lt__`. My Sage is still recompiling; could you fix the doctest I added?",
    "created_at": "2015-07-13T11:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208643",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:72'></a>I implemented the necessary `__lt__`. My Sage is still recompiling; could you fix the doctest I added?



---

archive/issue_comments_208644.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T11:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208644",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208645.json:
```json
{
    "body": "<a id='comment:74'></a>Ok, looks good now!",
    "created_at": "2015-07-13T11:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208645",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:74'></a>Ok, looks good now!



---

archive/issue_comments_208646.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-13T11:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208646",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208647.json:
```json
{
    "body": "<a id='comment:76'></a>Thank you!",
    "created_at": "2015-07-13T11:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208647",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:76'></a>Thank you!



---

archive/issue_comments_208648.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-07-13T20:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208648",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_208649.json:
```json
{
    "body": "<a id='comment:77'></a>Tests fail",
    "created_at": "2015-07-13T20:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208649",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:77'></a>Tests fail



---

archive/issue_comments_208650.json:
```json
{
    "body": "<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-13T23:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208651.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-07-13T23:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208651",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_208652.json:
```json
{
    "body": "<a id='comment:79'></a>Trivial failures because the elements for subcrystals are now ordered by the `__lt__` added.",
    "created_at": "2015-07-13T23:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208652",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:79'></a>Trivial failures because the elements for subcrystals are now ordered by the `__lt__` added.



---

archive/issue_comments_208653.json:
```json
{
    "body": "<a id='comment:80'></a>Some `# long time` tests still fail",
    "created_at": "2015-07-14T22:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208653",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:80'></a>Some `# long time` tests still fail



---

archive/issue_comments_208654.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-07-14T22:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208654",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_208655.json:
```json
{
    "body": "<a id='comment:81'></a>So the issue is in `rigged_configurations/bij_infinity.py` where we test elements in a subcrystal, whose elements are no longer elements in the crystal and there is no coercion map from the subcrystal to the ambient crystal. I'm working on implementing the coercion.",
    "created_at": "2015-07-14T23:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208655",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:81'></a>So the issue is in `rigged_configurations/bij_infinity.py` where we test elements in a subcrystal, whose elements are no longer elements in the crystal and there is no coercion map from the subcrystal to the ambient crystal. I'm working on implementing the coercion.



---

archive/issue_comments_208656.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-15T00:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208656",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208657.json:
```json
{
    "body": "<a id='comment:83'></a>So implementing the coercion and getting those tests to work seems to be a minor can of worms. Instead I just changed the tests to work (and they are still testing what they should be).",
    "created_at": "2015-07-15T00:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208657",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:83'></a>So implementing the coercion and getting those tests to work seems to be a minor can of worms. Instead I just changed the tests to work (and they are still testing what they should be).



---

archive/issue_comments_208658.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-15T00:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208658",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_208659.json:
```json
{
    "body": "<a id='comment:85'></a>Tests pass for me now!",
    "created_at": "2015-07-15T01:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208659",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:85'></a>Tests pass for me now!



---

archive/issue_comments_208660.json:
```json
{
    "body": "<a id='comment:86'></a>Tests pass for me now!",
    "created_at": "2015-07-15T01:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208660",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:86'></a>Tests pass for me now!



---

archive/issue_comments_208661.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-15T01:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208661",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208662.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-27T15:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15463#issuecomment-208662",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_045101.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-27T15:15:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15463",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15463#event-45101"
}
```
