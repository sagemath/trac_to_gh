# Issue 16187: is_triangular_number() speed up

archive/issues_016187.json:
```json
{
    "body": "The name implies a boolean return value (contrary to the implementation), and used that way the function is way too slow:\n\n```\nsage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')\n625 loops, best of 3: 909 \u00b5s per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n5 loops, best of 3: 200 ms per loop\nsage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')\n625 loops, best of 3: 903 \u00b5s per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n5 loops, best of 3: 195 ms per loop\n```\n\nThe reason is that the simple boolean test used above is not performed before the more involved computation of the index.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16424\n\n",
    "created_at": "2014-06-02T07:13:14Z",
    "labels": [
        "quadratic forms",
        "minor",
        "enhancement"
    ],
    "title": "is_triangular_number() speed up",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16187",
    "user": "rws"
}
```
The name implies a boolean return value (contrary to the implementation), and used that way the function is way too slow:

```
sage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')
625 loops, best of 3: 909 µs per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
5 loops, best of 3: 200 ms per loop
sage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')
625 loops, best of 3: 903 µs per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
5 loops, best of 3: 195 ms per loop
```

The reason is that the simple boolean test used above is not performed before the more involved computation of the index.

Issue created by migration from https://trac.sagemath.org/ticket/16424





---

archive/issue_comments_211360.json:
```json
{
    "body": "Now it's only 10x slower:\n\n```\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n25 loops, best of 3: 10.6 ms per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n25 loops, best of 3: 10.1 ms per loop\n```\n\nbut that is because the function does more than it should, judging from the name.\n----\nNew commits:",
    "created_at": "2014-06-02T07:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211360",
    "user": "rws"
}
```

Now it's only 10x slower:

```
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
25 loops, best of 3: 10.6 ms per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
25 loops, best of 3: 10.1 ms per loop
```

but that is because the function does more than it should, judging from the name.
----
New commits:



---

archive/issue_comments_211361.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-02T07:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211361",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211362.json:
```json
{
    "body": "Hi Ralf,\n\nsee my branch at public/16424\n\nI rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.\n\nTell me what you think...\n\nAnyway, I am not sure it is worth it to have a function which is just equivalent to\n\n```\nis_triangular = lambda n: (8*n+1).is_square()\n```\n\n\nVincent",
    "created_at": "2014-06-15T17:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211362",
    "user": "vdelecroix"
}
```

Hi Ralf,

see my branch at public/16424

I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.

Tell me what you think...

Anyway, I am not sure it is worth it to have a function which is just equivalent to

```
is_triangular = lambda n: (8*n+1).is_square()
```


Vincent



---

archive/issue_comments_211363.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-15T17:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211363",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_211364.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-06-16T06:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211364",
    "user": "rws"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_211365.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> see my branch at public/16424\n> \n> I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.\n> \n> Tell me what you think...\n> \n> Anyway, I am not sure it is worth it to have a function which is just equivalent to\n> {{{\n> is_triangular = lambda n: (8*n+1).is_square()\n> }}}\n\nHi Vincent, the branch is fine. I would agree that the function is not worth occupying one of the precious global slots. However, I think it is still good to have, so you can set positive if you also remove it from `quadratic_forms/all.py`.\n----\nNew commits:",
    "created_at": "2014-06-16T06:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211365",
    "user": "rws"
}
```

Replying to [comment:3 vdelecroix]:
> see my branch at public/16424
> 
> I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.
> 
> Tell me what you think...
> 
> Anyway, I am not sure it is worth it to have a function which is just equivalent to
> {{{
> is_triangular = lambda n: (8*n+1).is_square()
> }}}

Hi Vincent, the branch is fine. I would agree that the function is not worth occupying one of the precious global slots. However, I think it is still good to have, so you can set positive if you also remove it from `quadratic_forms/all.py`.
----
New commits:



---

archive/issue_comments_211366.json:
```json
{
    "body": "Hi Ralf,\n\nI have no problem removing it from the global namespace but then how the user would find it? The path is really unguessable!\n\n```\nsage: from sage.quadratic_forms.extra import is_triangular_number\n```\n\nVincent",
    "created_at": "2014-06-16T06:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211366",
    "user": "vdelecroix"
}
```

Hi Ralf,

I have no problem removing it from the global namespace but then how the user would find it? The path is really unguessable!

```
sage: from sage.quadratic_forms.extra import is_triangular_number
```

Vincent



---

archive/issue_comments_211367.json:
```json
{
    "body": "I don't know. Searching the reference will turn up lots of other links. I don't think we should put more thought into it, so any outcome is fine with me, as is the branch. Another ticket will resolve the global namespace cleanup.",
    "created_at": "2014-06-16T08:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211367",
    "user": "rws"
}
```

I don't know. Searching the reference will turn up lots of other links. I don't think we should put more thought into it, so any outcome is fine with me, as is the branch. Another ticket will resolve the global namespace cleanup.



---

archive/issue_comments_211368.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-06-16T08:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211368",
    "user": "rws"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_211369.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-18T14:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16187#issuecomment-211369",
    "user": "vbraun"
}
```

Resolution: fixed
