# Issue 26984: Add Pynac unordered_map patch

Issue created by migration from https://trac.sagemath.org/ticket/27221

Original creator: jdemeyer

Original creation time: 2019-02-05 08:10:36

CC:  rws fbissey arojas

In order to finish #22029, we need one patch to Pynac. This affects only 2 doctests in all of Sage, so it's quite innocent.


---

Comment by jdemeyer created at 2019-02-05 08:15:32

New commits:


---

Comment by jdemeyer created at 2019-02-05 08:15:32

Changing status from new to needs_review.


---

Comment by @timokau created at 2019-02-05 09:06:53

We've had the same discussion already, but: Why patch? Given that sage is the main consumer of pynac, why not cut a new release instead?


---

Comment by fbissey created at 2019-02-05 09:20:34

Replying to [comment:3 gh-timokau]:
> We've had the same discussion already, but: Why patch? Given that sage is the main consumer of pynac, why not cut a new release instead?

Right, right. Is there a matching pull request? Does the maintainer (Ralph) react in a swift enough fashion for a new release? If a new release is cut now, are there any new features or changes beside this patch that will require changes on sage side?

Yes in an ideal world we want and wait for the next release and we can make that request but sage is a bit of a fast conveyor belt at times :)


---

Comment by jdemeyer created at 2019-02-05 10:04:21

Replying to [comment:3 gh-timokau]:
> Given that sage is the main consumer of pynac, why not cut a new release instead?

Sage is the main consumer of pynac, but Sage is not pynac.


---

Comment by jdemeyer created at 2019-02-05 10:07:25

Replying to [comment:4 fbissey]:
> If a new release is cut now, are there any new features or changes beside this patch that will require changes on sage side?

No. That might actually be a reason not to make a new release: we just had an upgrade (#26995) and the PR for this ticket is the only change to master since then.

As I mentioned in the ticket description, this patch affects only 2 doctests in Sage which would otherwise break with #22029.


---

Comment by @timokau created at 2019-02-05 10:41:14

Replying to [comment:7 jdemeyer]:
> Replying to [comment:4 fbissey]:
> > If a new release is cut now, are there any new features or changes beside this patch that will require changes on sage side?
> 
> No. That might actually be a reason not to make a new release: we just had an upgrade (#26995) and the PR for this ticket is the only change to master since then.

Why would that be an argument against a new release? The only reason against frequent releases I can think of is packager fatigue. Adding a patch to pynac would be more work for packagers than just bumping the version. Is there another reason?


---

Comment by jdemeyer created at 2019-02-05 13:07:13

Replying to [comment:8 gh-timokau]:
> Adding a patch to pynac would be more work for packagers than just bumping the version.

You could also not add the patch and live with 2 additional doctest failures.

I think that #22029 is too important to be held back by a Pynac release.


---

Comment by @timokau created at 2019-02-05 14:30:43

Replying to [comment:9 jdemeyer]:
> Replying to [comment:8 gh-timokau]:
> > Adding a patch to pynac would be more work for packagers than just bumping the version.
> 
> You could also not add the patch and live with 2 additional doctest failures.

I couldn't, any test failures fail the build.

> I think that #22029 is too important to be held back by a Pynac release.

What makes that 2yr old ticket so urgent now?


---

Comment by jdemeyer created at 2019-02-08 06:26:00

Replying to [comment:10 gh-timokau]:
> Replying to [comment:9 jdemeyer]:
> > Replying to [comment:8 gh-timokau]:
> > > Adding a patch to pynac would be more work for packagers than just bumping the version.
> > 
> > You could also not add the patch and live with 2 additional doctest failures.
> 
> I couldn't, any test failures fail the build.

Debian seems to think otherwise, but I'm actually glad that you don't want any test failures. OK, but then you could still add a patch to remove/disable those 2 tests.

> What makes that 2yr old ticket so urgent now?

It's a ticket which makes far-reaching changing and I'm worried about regressions against it.


---

Comment by @timokau created at 2019-02-08 10:57:48

Replying to [comment:11 jdemeyer]:
> Replying to [comment:10 gh-timokau]:
> > Replying to [comment:9 jdemeyer]:
> > > Replying to [comment:8 gh-timokau]:
> > > > Adding a patch to pynac would be more work for packagers than just bumping the version.
> > > 
> > > You could also not add the patch and live with 2 additional doctest failures.
> > 
> > I couldn't, any test failures fail the build.
> 
> Debian seems to think otherwise, but I'm actually glad that you don't want any test failures. OK, but then you could still add a patch to remove/disable those 2 tests.

Debian is in a somewhat more difficult position, with their limited control of the environment sage executes in and additional bureaucracy. Still, if you ask me they would be better off explicitly marking known failures instead of just picking some threshold of acceptable test failures. This doesn't really fit into this ticket though, if anyone wants to continue that discussion we can do that on sage-packaging :)

(One more thing I'm pretty excited about: Nix is now [available in debian](https://ftp-master.debian.org/new/nix_2.2.1-2.html))

> > What makes that 2yr old ticket so urgent now?
> 
> It's a ticket which makes far-reaching changing and I'm worried about regressions against it.

Alright, I haven't looked into the details and don't know how important it is. Patching pynac is not a terribly big deal for me (especially since sage is its *only* consumer in nixpkgs). So I'm mostly arguing out of principle, since I'm trying to change the "just patch" attitude.

Having expressed my opinion about this (I'm still not convinced patching is worth it here, waiting for a new pynac release would probably only introduce a couple of days delay), I won't argue any further.


---

Comment by mmezzarobba created at 2019-02-09 08:35:41

Ralf just released Pynac 0.7.24 = 0.7.23 + this patch. See #27241.


---

Comment by jdemeyer created at 2019-02-09 08:47:13

Resolution: invalid
