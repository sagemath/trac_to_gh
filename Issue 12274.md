# Issue 12274: sage access in cython_lambda broken

archive/issues_012274.json:
```json
{
    "body": "Assignee: @jasongrout\n\nthis is a quote from cython_lambda's documentation.\n\n```\nWe access a global function and variable.\n sage: a = 25 sage: f = cython_lambda('double x',\n 'sage.math.sin(x) + sage.a')                 # optional -- gcc\n  sage: f(10)\n```\n\napart from the missing newline, this doesn't work.\n\n```\nsage: a = 25; f = cython_lambda('double x','sage.math.sin(x) + sage.a')\nsage: f(1)\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n\n/home/harri/Programming/psnobfit/<ipython console> in <module>()\n\n/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0.f (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:621)()\n     11 sage = _s()\n     12 \n     13 def f(double x):\n---> 14  return sage.math.sin(x) + sage.a\n     15     \n/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0._s.__getattr__ (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:559)()\n      7 class _s:\n      8    def __getattr__(self, x):\n----> 9        return globals()[x]\n     10 \n     11 sage = _s()\n\nKeyError: 'math'\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/12446\n\n",
    "created_at": "2012-02-04T22:32:43Z",
    "labels": [
        "component: misc",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "sage access in cython_lambda broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12274",
    "user": "https://github.com/haraldschilly"
}
```
Assignee: @jasongrout

this is a quote from cython_lambda's documentation.

```
We access a global function and variable.
 sage: a = 25 sage: f = cython_lambda('double x',
 'sage.math.sin(x) + sage.a')                 # optional -- gcc
  sage: f(10)
```

apart from the missing newline, this doesn't work.

```
sage: a = 25; f = cython_lambda('double x','sage.math.sin(x) + sage.a')
sage: f(1)
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)

/home/harri/Programming/psnobfit/<ipython console> in <module>()

/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0.f (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:621)()
     11 sage = _s()
     12 
     13 def f(double x):
---> 14  return sage.math.sin(x) + sage.a
     15     
/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0._s.__getattr__ (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:559)()
      7 class _s:
      8    def __getattr__(self, x):
----> 9        return globals()[x]
     10 
     11 sage = _s()

KeyError: 'math'
```

Issue created by migration from https://trac.sagemath.org/ticket/12446





---

archive/issue_comments_144003.json:
```json
{
    "body": "This is Mac OS X 10.7.4, I actually get a couple other errors.\n\n```\n\nsage -t -only-optional=gcc \"devel/sage-main/sage/misc/cython.py\"\n**********************************************************************\nFile \"/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py\", line 617:\n    sage: g(2,3)                                                                     # optional -- gcc\nExpected:\n    55.200000000000003\nGot:\n    55.2\n**********************************************************************\nFile \"/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py\", line 619:\n    sage: g(0,0)                                                                     # optional -- gcc\nExpected:\n    3.2000000000000002\nGot:\n    3.2\n**********************************************************************\nFile \"/Users.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py\", line 626:\n    sage: f(10)                                                                      # optional -- gcc\nException raised:\n    KeyError: 'math'\n**********************************************************************\nFile \"/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py\", line 629:\n    sage: f(10)                                                                      # optional -- gcc\nException raised:\n    KeyError: 'math'\n**********************************************************************\n1 items had failures:\n   4 of  12 in __main__.example_0\n***Test Failed*** 4 failures.\n```",
    "created_at": "2012-09-28T18:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144003",
    "user": "https://github.com/kcrisman"
}
```

This is Mac OS X 10.7.4, I actually get a couple other errors.

```

sage -t -only-optional=gcc "devel/sage-main/sage/misc/cython.py"
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 617:
    sage: g(2,3)                                                                     # optional -- gcc
Expected:
    55.200000000000003
Got:
    55.2
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 619:
    sage: g(0,0)                                                                     # optional -- gcc
Expected:
    3.2000000000000002
Got:
    3.2
**********************************************************************
File "/Users.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 626:
    sage: f(10)                                                                      # optional -- gcc
Exception raised:
    KeyError: 'math'
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 629:
    sage: f(10)                                                                      # optional -- gcc
Exception raised:
    KeyError: 'math'
**********************************************************************
1 items had failures:
   4 of  12 in __main__.example_0
***Test Failed*** 4 failures.
```



---

archive/issue_comments_144004.json:
```json
{
    "body": "Actually, the floating point ones are fixed at #13533, so I guess this globals thing is still all this ticket is about.  However, that's not documented at #13533, so I figure I'll at least post this error message for posterity.",
    "created_at": "2012-09-28T18:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144004",
    "user": "https://github.com/kcrisman"
}
```

Actually, the floating point ones are fixed at #13533, so I guess this globals thing is still all this ticket is about.  However, that's not documented at #13533, so I figure I'll at least post this error message for posterity.



---

archive/issue_comments_144005.json:
```json
{
    "body": "Changing component from misc to cython.",
    "created_at": "2013-06-07T13:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144005",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from misc to cython.



---

archive/issue_comments_144006.json:
```json
{
    "body": "Changing assignee from @jasongrout to @jdemeyer.",
    "created_at": "2013-06-07T13:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144006",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @jasongrout to @jdemeyer.



---

archive/issue_events_033495.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33495"
}
```



---

archive/issue_events_033496.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33496"
}
```



---

archive/issue_events_033497.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33497"
}
```



---

archive/issue_events_033498.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33498"
}
```



---

archive/issue_events_033499.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33499"
}
```



---

archive/issue_events_033500.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33500"
}
```



---

archive/issue_events_033501.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33501"
}
```



---

archive/issue_events_033502.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-29T10:46:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33502"
}
```



---

archive/issue_events_033503.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-29T10:46:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33503"
}
```



---

archive/issue_comments_144007.json:
```json
{
    "body": "Changing assignee from @jdemeyer to @williamstein.",
    "created_at": "2015-03-29T10:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144007",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @jdemeyer to @williamstein.



---

archive/issue_comments_144008.json:
```json
{
    "body": "Changing component from cython to user interface.",
    "created_at": "2015-03-29T10:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144008",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from cython to user interface.



---

archive/issue_comments_144009.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-29T10:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_144010.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-29T10:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144010",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T18:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144012.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-29T20:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144012",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_033504.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12274#event-33504"
}
```



---

archive/issue_comments_144013.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12274#issuecomment-144013",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
