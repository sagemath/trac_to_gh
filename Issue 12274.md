# Issue 12274: sage access in cython_lambda broken

Issue created by migration from Trac.

Original creator: schilly

Original creation time: 2012-02-04 22:32:43

Assignee: jason

this is a quote from cython_lambda's documentation.


```
We access a global function and variable.
 sage: a = 25 sage: f = cython_lambda('double x',
 'sage.math.sin(x) + sage.a')                 # optional -- gcc
  sage: f(10)
```


apart from the missing newline, this doesn't work.


```
sage: a = 25; f = cython_lambda('double x','sage.math.sin(x) + sage.a')
sage: f(1)
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)

/home/harri/Programming/psnobfit/<ipython console> in <module>()

/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0.f (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:621)()
     11 sage = _s()
     12 
     13 def f(double x):
---> 14  return sage.math.sin(x) + sage.a
     15     
/home/harri/.sage/temp/x220/11839/spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx/_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.so in _home_harri__sage_temp_x220_11839_tmp_0_spyx_0._s.__getattr__ (_home_harri__sage_temp_x220_11839_tmp_0_spyx_0.c:559)()
      7 class _s:
      8    def __getattr__(self, x):
----> 9        return globals()[x]
     10 
     11 sage = _s()

KeyError: 'math'
```



---

Comment by kcrisman created at 2012-09-28 18:35:16

This is Mac OS X 10.7.4, I actually get a couple other errors.

```

sage -t -only-optional=gcc "devel/sage-main/sage/misc/cython.py"
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 617:
    sage: g(2,3)                                                                     # optional -- gcc
Expected:
    55.200000000000003
Got:
    55.2
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 619:
    sage: g(0,0)                                                                     # optional -- gcc
Expected:
    3.2000000000000002
Got:
    3.2
**********************************************************************
File "/Users.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 626:
    sage: f(10)                                                                      # optional -- gcc
Exception raised:
    KeyError: 'math'
**********************************************************************
File "/Users/.../sage-5.4.beta2/devel/sage-main/sage/misc/cython.py", line 629:
    sage: f(10)                                                                      # optional -- gcc
Exception raised:
    KeyError: 'math'
**********************************************************************
1 items had failures:
   4 of  12 in __main__.example_0
***Test Failed*** 4 failures.
```



---

Comment by kcrisman created at 2012-09-28 18:41:46

Actually, the floating point ones are fixed at #13533, so I guess this globals thing is still all this ticket is about.  However, that's not documented at #13533, so I figure I'll at least post this error message for posterity.


---

Comment by jdemeyer created at 2013-06-07 13:11:37

Changing component from misc to cython.


---

Comment by jdemeyer created at 2013-06-07 13:11:37

Changing assignee from jason to jdemeyer.


---

Comment by jdemeyer created at 2015-03-29 10:46:56

Changing priority from minor to major.


---

Comment by jdemeyer created at 2015-03-29 10:46:56

Changing assignee from jdemeyer to was.


---

Comment by jdemeyer created at 2015-03-29 10:46:56

Changing component from cython to user interface.


---

Comment by git created at 2015-03-29 10:52:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2015-03-29 10:52:58

Changing status from new to needs_review.


---

Comment by git created at 2015-03-29 18:33:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-03-29 20:00:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-14 19:44:21

Resolution: fixed
