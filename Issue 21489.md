# Issue 21489: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)

Issue created by migration from https://trac.sagemath.org/ticket/21726

Original creator: mkoeppe

Original creation time: 2016-10-19 01:25:18

CC:  jdemeyer fbissey embray vbraun dimpase tscrim

Here's a new attempt toward #21537 that is perhaps more elegant.

Let's change `build/bin/sage-spkg` as follows:

- If `spkg-build` exists, call that, followed by `$SAGE_SUDO spkg-install`. 
- Otherwise, just call `spkg-install` (with $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable.)


---

Comment by mkoeppe created at 2016-10-19 03:49:08

New commits:


---

Comment by mkoeppe created at 2016-10-19 03:49:08

Changing status from new to needs_review.


---

Comment by embray created at 2016-11-07 11:48:44

So, if I understand correctly, the point of calling `spkg-install` _without_ `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be "special" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?


---

Comment by embray created at 2016-11-07 11:51:57

What is this about?


```
+    if [ ! -x spkg-build ]; then
+	echo >&2 "WARNING: spkg-build is not executable, making it executable"
+	chmod +x spkg-build
+    fi
```


Why not just require it to be executable in the first place?


---

Comment by embray created at 2016-11-07 11:54:22

LGTM otherwise.  This looks like what I had in mind in #21537.


---

Comment by mkoeppe created at 2016-11-08 12:34:16

Replying to [comment:8 embray]:
> So, if I understand correctly, the point of calling `spkg-install` _without_ `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be "special" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?

That's right.


---

Comment by mkoeppe created at 2016-11-08 12:35:21

Replying to [comment:9 embray]:
> What is this about?
> 
> {{{
> +    if [ ! -x spkg-build ]; then
> +	echo >&2 "WARNING: spkg-build is not executable, making it executable"
> +	chmod +x spkg-build
> +    fi
> }}}
> 
> Why not just require it to be executable in the first place?

It's imitating existing code that does the same for `spkg-install`. I don't know why it does that. Hysterical raisins?


---

Comment by embray created at 2016-11-08 12:50:09

I see that now.  Might as well keep it for now then :(


---

Comment by embray created at 2016-11-08 12:50:26

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-11-08 18:52:34

Thanks!


---

Comment by vbraun created at 2016-11-09 18:16:17

Resolution: fixed


---

Comment by embray created at 2017-03-03 13:46:14

Semi-related, see #22510.
