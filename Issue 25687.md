# Issue 25687: Optimize is_regular and is_isoform

Issue created by migration from https://trac.sagemath.org/ticket/25924

Original creator: jmantysalo

Original creation time: 2018-07-25 12:18:03

CC:  tscrim

An isoform congruence is uniform; a uniform congruence is regular. It is fast to check if a congruence is uniform. Hence it makes sense to use it as a short-circuit in `is_isoform` and `is_regular`. Also trivial congruences should not be tested.

I timed this with list of all lattices of exactly ten elements. Before


```
sum(1 for L in Lats if L.is_regular())
sum(1 for L in Lats if L.is_isoform())
```


took 60 and 40 seconds. After this those take 32 and 27 seconds.

(More to come after #25895 is closed.)


---

Comment by jmantysalo created at 2018-07-25 12:21:49

New commits:


---

Comment by jmantysalo created at 2018-07-25 12:21:49

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-07-25 18:15:53

For python3 compatibility, this has to be wrapped with list:

```
+            x = cong.root_to_elements_dict().values()
```



---

Comment by tscrim created at 2018-07-26 03:34:25

Possibly a better change could be

```sage
            x = iter(cong.root_to_elements_dict().values())
            ell = len(next(x))
            if all(len(p) == ell for p in x):
```

This avoids the extra `len` and `[]` calls (granted, these are so very small to really matter) and is Python3 compatible (or maybe use the `six` itervalues?).


---

Comment by git created at 2018-07-26 05:58:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-07-26 06:05:29

As you wish. Modification suggested by Travis does not make measurable difference in timings.

Actually we should think if every _principal_ congruence is regular|uniform|isoform, is then the whole lattice regular|uniform|isoform? If so, it would greatly reduce computation time. I have not found a counter-example, but neither have a proof for that.

Also, we for example know that a relatively complemented lattice is isoform. Can that be used to found a non-isoform congruence without checking all of them?


---

Comment by jmantysalo created at 2018-07-26 10:14:50

I asked about this in https://math.stackexchange.com/questions/2863117/is-lattice-regular-if-all-principal-congruences-are-regular


---

Comment by tscrim created at 2018-07-26 12:31:19

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-07-26 12:31:19

Changing keywords from "" to "sagedays@icerm".


---

Comment by tscrim created at 2018-07-26 12:31:19

Replying to [comment:6 jmantysalo]:
> As you wish. Modification suggested by Travis does not make measurable difference in timings.

I am not surprised, it is a micro-optimization at best.

> Actually we should think if every _principal_ congruence is regular|uniform|isoform, is then the whole lattice regular|uniform|isoform? If so, it would greatly reduce computation time. I have not found a counter-example, but neither have a proof for that.
> 
> Also, we for example know that a relatively complemented lattice is isoform. Can that be used to found a non-isoform congruence without checking all of them?

Sounds like something to think about and implement (if true) in a follow-up ticket. :)


---

Comment by vbraun created at 2018-08-29 22:27:06

Resolution: fixed
