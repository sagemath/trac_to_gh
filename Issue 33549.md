# Issue 33549: Top-level sage script: Unconditionally set SAGE_ROOT

Issue created by migration from https://trac.sagemath.org/ticket/33786

Original creator: mkoeppe

Original creation time: 2022-05-02 16:54:16

CC:  dimpase mjo jhpalmieri

This will make it more robust when accidentally invoked from a sage shell inside another Sage installation.

Related to https://groups.google.com/g/sage-release/c/GOGWk66zaCQ/m/0o9KtVDIAAAJ


---

Comment by mkoeppe created at 2022-05-02 21:03:04

New commits:


---

Comment by mkoeppe created at 2022-05-02 21:03:04

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-05-10 23:08:59

It looks like this doesn't change the behavior of `SAGE_ROOT/sage`, just the documentation. Is that correct?


---

Comment by mkoeppe created at 2022-05-10 23:28:21

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-05-10 23:28:21

Looks like I forgot to push a commit


---

Comment by git created at 2022-05-10 23:31:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-10 23:32:21

Here it is


---

Comment by mkoeppe created at 2022-05-10 23:32:21

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-05-10 23:33:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2022-05-11 05:01:05

How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break? Should we deprecate the setting of `SAGE_ROOT` first?

```
if [ -z "$SAGE_ROOT" ];  then
   ...
else
   (print deprecation warning)
fi
```



---

Comment by mkoeppe created at 2022-05-11 05:21:07

Replying to [comment:10 jhpalmieri]:
> How do we determine whether people are actually setting `SAGE_ROOT` outside of this file and/or modifying the commented-out line in this file? That is, how do we determine how many Sage installations this might break?

I don't think this change can break anyone's installation if that was done using the old instructions ("system-wide install"):
- the first variant, using symlinks, still works (we just don't advertise it any more)

- in the second variant, using a copy of the script, there's no problem because users were instructed to make the change (setting SAGE_ROOT) in the copy, not in the original. Their old copy will continue to work. If they attempt to copy and make the change again, they will see that there is no longer a place that prompts them to make the change.


---

Comment by jhpalmieri created at 2022-05-12 03:57:35

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2022-05-12 03:57:35

Okay, let's merge it (in 9.7).


---

Comment by mkoeppe created at 2022-05-12 04:21:11

Thanks!


---

Comment by vbraun created at 2022-05-24 22:45:01

Resolution: fixed
