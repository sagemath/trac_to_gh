# Issue 13507: charpoly error on matrices with pi

Issue created by migration from Trac.

Original creator: eviatarbach

Original creation time: 2012-11-15 08:09:45

Assignee: jason, was

Sage returns an error when attempting to calculate the characteristic polynomial of a matrix with pi:



```
sage: matrix([[sqrt(2), -1], [1, e^2]]).charpoly()    
x^2 + (-sqrt(2) - e^2)*x + sqrt(2)*e^2 + 1
sage: matrix([[sqrt(2), -1], [pi, e^2]]).charpoly()
TypeError
```



---

Comment by eviatarbach created at 2013-04-24 09:40:48

Okay, I think I found the source of the error; Sage tries to coerce the pyobjects of the symbolic constants into the Symbolic Ring, which doesn't work:


```
sage: SR(pi.pyobject())
TypeError
sage: SR(euler_gamma.pyobject())
TypeError
```


What would be the best way to fix this? It seems to be quite a major problem, since characteristic polynomials cannot at the moment be computed for any matrices with symbolic constants (it does work for `e`, since it is defined differently, and `golden_ratio`, since it is replaced with its numerical value before running into this error).


---

Comment by nbruin created at 2013-04-24 17:02:13

The right way of turning a constant into an expression is apparently via the `expression` method. The element constructor for `SR` tests for the presence of a `_symbolic_` method on its argument. If we add a method to `sage.symbolic.constants.Constant`:

```
    def _symbolic_(self,SR):
        """
        doctest:
            sage: SR(sage.symbolic.constants.Constant('a'))
            a
            sage: SR(sage.symbolic.constants.Constant('a')).subs(a=10)
            a
        """
        return SR(self.expression())
```

the system picks up the conversion. The double conversion that's happening here is a little sad, but the interface for `_symbolic_` is that the ring in question is given as a parameter. I guess our design does not rule out the existence of multiple symbolic rings, whereas `expression` will return a member of whatever symbolic ring is considered "home" by pynac.

One solution would be to give `sage.symbolic.constants_c.PynacConstant.expression` an optional argument `SR` to specify in which ring the expression should lie (defaulting to what SR is there now). This routine now just reads:

```
    def expression(self):
       return new_Expression_from_GEx(SR, <GEx>(self.pointer[0]))
```

so making that `def expression(self, SR=SR)` shouldn't make too much difference. With that in place we can just alias `_symbolic_` to `expression`.


---

Attachment

ensure that SymbolicConstant object convert into SR


---

Comment by nbruin created at 2013-04-24 17:43:37

Changing status from new to needs_review.


---

Comment by nbruin created at 2013-04-24 17:50:19

Note that once you get a characteristic polynomial, it's likely wrong. See #14403


---

Comment by eviatarbach created at 2013-04-24 18:33:06

Great! The patch works for me, and all tests pass on `constants_c.pyx` and `constants.py`.


---

Comment by eviatarbach created at 2013-04-25 19:05:08

Maybe it would be good to add doctests for `matrix([pi]).charpoly()` and `SR(pi.pyobject())`?


---

Comment by kcrisman created at 2013-05-22 19:08:22

> Maybe it would be good to add doctests for `matrix([pi]).charpoly()` and `SR(pi.pyobject())`?
Agreed.


---

Comment by kcrisman created at 2013-05-22 19:08:22

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-04-08 23:02:39

Just works fine on 6.6-rc2

```
sage: sage: matrix([[sqrt(2), -1], [pi, e^2]]).charpoly()
x^2 + (-sqrt(2) - e^2)*x + pi + sqrt(2)*e^2
```


Migt be because symbolic constants are now element of the symbolic ring:

```
sage: type(pi)
<type 'sage.symbolic.expression.Expression'>
sage: pi.pyobject()
pi
sage: type(_)
<class 'sage.symbolic.constants.Pi'>
```


Vincent


---

Comment by vdelecroix created at 2015-04-14 20:42:49

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-04-14 20:42:49

New commits:


---

Comment by jdemeyer created at 2015-04-14 21:11:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-15 06:07:31

Resolution: fixed
