# Issue 16938: Replace some __cmp__() by rich comparison

Issue created by migration from Trac.

Original creator: aapitzsch

Original creation time: 2014-10-18 12:39:52

This is part of #16537.


---

Comment by aapitzsch created at 2014-10-18 12:41:27

New commits:


---

Comment by aapitzsch created at 2014-10-18 12:41:27

Changing status from new to needs_review.


---

Comment by ohanar created at 2014-10-18 20:08:11

Changing status from needs_review to needs_work.


---

Comment by ohanar created at 2014-10-18 20:08:11

Thanks for working on this. I haven't looked through everything thoroughly yet, but here are some initial comments/questions:

 * In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.

 * In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).

 * In `sage.combinat.root_system.type_irreducible`, it seems to me that the added `__ne__` method is unecessary.

 * In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).


---

Comment by aapitzsch created at 2014-10-18 21:59:52

Removing `__ne__` from `sage.combinat.root_system.type_reducible` raises doctest errors like

```
sage -t src/sage/combinat/root_system/branching_rules.py
**********************************************************************
File "src/sage/combinat/root_system/branching_rules.py", line 667, in sage.combinat.root_system.branching_rules.branch_weyl_character
Failed example:
    F4(0,0,1,0).branch(G2xA1,rule="miscellaneous")
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.root_system.branching_rules.branch_weyl_character[130]>", line 1, in <module>
        F4(Integer(0),Integer(0),Integer(1),Integer(0)).branch(G2xA1,rule="miscellaneous")
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/weyl_characters.py", line 1103, in branch
        return sage.combinat.root_system.branching_rules.branch_weyl_character(self, self.parent(), S, rule=rule)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/branching_rules.py", line 985, in branch_weyl_character
        raise ValueError("rule has wrong target Cartan type")
    ValueError: rule has wrong target Cartan type
```


We should keep it for now and check again when all `__cmp__()` have been removed.


---

Comment by git created at 2014-10-18 22:21:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-19 08:46:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aapitzsch created at 2014-10-19 08:52:48

Replying to [comment:2 ohanar]:
>  * In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.

Didn't know about it. Fixed now.

>  * In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).
> 
Fixed this.

>  * In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).

Added functions and tests.


---

Comment by aapitzsch created at 2014-10-19 08:52:48

Changing status from needs_work to needs_review.


---

Comment by wluebbe created at 2014-11-18 18:55:31

Hi André, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious! 

By the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...

What is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?


---

Comment by wluebbe created at 2014-11-18 18:55:31

Changing keywords from "" to "python3".


---

Comment by aapitzsch created at 2014-11-18 19:54:55

Replying to [comment:7 wluebbe]:
> Hi André, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious!

Up to some exceptions I chose the `__cmp__()` functions which only checked for equality, where I hadn't to implement `__gt__()` etc.
 
> By the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...

The main "problem" of replacing `__cmp__()` is pointed out in http://www.mail-archive.com/sage-devel`@`googlegroups.com/msg73051.html. Until we find a reasonable solution for it, we should continue with the easier tickets, like #16529.

> What is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?

All comparisons need `self._marked_separatrix == other._marked_separatrix` and I think this leads to problems with the class decorator.


---

Comment by wluebbe created at 2014-11-19 10:30:46

I do not think that it is //always// the right approach to solve the easier problems before the hard ones.

We have done this with good reason for stage 1 (#15980). But the completion of stage 1 has to precede the completion of stage 2. And now we have the hard problems that remain in stage 1!

I think that stage 2 (#16052) could use a tool like https://github.com/PythonCharmers/python-future to good effect. 
Clearly this does not prevent us from solving some of the problems (added originally to stage 2) in a stage 1 style (as was possible for `filter` and `reduce`, and I think it is also possible for `map` #16073!).

But we should try to complete stage 1 as soon as possible: if we cannot solve those remaining hard problems then Sage will not available under Python 3.

Anyway I will have a look at #16529 ;-)
And I will try to grok the //rich comparison// stuff - it is difficult and but it is also necessary!


---

Comment by mmezzarobba created at 2015-02-05 13:39:59

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-02-17 17:15:22

Same question as in #16537: Can the work be reduced by including the code in http://www.voidspace.org.uk/python/articles/comparison.shtml into the `SageObject` class? Please reply there.


---

Comment by rws created at 2015-04-12 15:02:02

Changing status from needs_work to needs_info.


---

Comment by rws created at 2015-04-12 15:02:02

With the new arguments in #16537 I think this is at least needs_info, if not wontfix.


---

Comment by jdemeyer created at 2016-05-02 13:33:31

Changing component from misc to python3.


---

Comment by chapoton created at 2017-08-26 15:50:54

This is way outdated. Let it be closed as invalid.


---

Comment by chapoton created at 2017-08-26 15:50:54

Changing status from needs_info to positive_review.


---

Comment by embray created at 2017-12-12 08:23:33

Resolution: wontfix
