# Issue 16938: Replace some __cmp__() by rich comparison

archive/issues_016938.json:
```json
{
    "body": "This is part of #16537.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17175\n\n",
    "created_at": "2014-10-18T12:39:52Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "title": "Replace some __cmp__() by rich comparison",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16938",
    "user": "aapitzsch"
}
```
This is part of #16537.

Issue created by migration from https://trac.sagemath.org/ticket/17175





---

archive/issue_comments_224463.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-18T12:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224463",
    "user": "aapitzsch"
}
```

New commits:



---

archive/issue_comments_224464.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-18T12:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224464",
    "user": "aapitzsch"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224465.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-18T20:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224465",
    "user": "ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224466.json:
```json
{
    "body": "Thanks for working on this. I haven't looked through everything thoroughly yet, but here are some initial comments/questions:\n\n* In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.\n\n* In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).\n\n* In `sage.combinat.root_system.type_irreducible`, it seems to me that the added `__ne__` method is unecessary.\n\n* In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).",
    "created_at": "2014-10-18T20:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224466",
    "user": "ohanar"
}
```

Thanks for working on this. I haven't looked through everything thoroughly yet, but here are some initial comments/questions:

* In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.

* In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).

* In `sage.combinat.root_system.type_irreducible`, it seems to me that the added `__ne__` method is unecessary.

* In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).



---

archive/issue_comments_224467.json:
```json
{
    "body": "Removing `__ne__` from `sage.combinat.root_system.type_reducible` raises doctest errors like\n\n```\nsage -t src/sage/combinat/root_system/branching_rules.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/branching_rules.py\", line 667, in sage.combinat.root_system.branching_rules.branch_weyl_character\nFailed example:\n    F4(0,0,1,0).branch(G2xA1,rule=\"miscellaneous\")\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 851, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.root_system.branching_rules.branch_weyl_character[130]>\", line 1, in <module>\n        F4(Integer(0),Integer(0),Integer(1),Integer(0)).branch(G2xA1,rule=\"miscellaneous\")\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/weyl_characters.py\", line 1103, in branch\n        return sage.combinat.root_system.branching_rules.branch_weyl_character(self, self.parent(), S, rule=rule)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/branching_rules.py\", line 985, in branch_weyl_character\n        raise ValueError(\"rule has wrong target Cartan type\")\n    ValueError: rule has wrong target Cartan type\n```\n\n\nWe should keep it for now and check again when all `__cmp__()` have been removed.",
    "created_at": "2014-10-18T21:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224467",
    "user": "aapitzsch"
}
```

Removing `__ne__` from `sage.combinat.root_system.type_reducible` raises doctest errors like

```
sage -t src/sage/combinat/root_system/branching_rules.py
**********************************************************************
File "src/sage/combinat/root_system/branching_rules.py", line 667, in sage.combinat.root_system.branching_rules.branch_weyl_character
Failed example:
    F4(0,0,1,0).branch(G2xA1,rule="miscellaneous")
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.root_system.branching_rules.branch_weyl_character[130]>", line 1, in <module>
        F4(Integer(0),Integer(0),Integer(1),Integer(0)).branch(G2xA1,rule="miscellaneous")
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/weyl_characters.py", line 1103, in branch
        return sage.combinat.root_system.branching_rules.branch_weyl_character(self, self.parent(), S, rule=rule)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/branching_rules.py", line 985, in branch_weyl_character
        raise ValueError("rule has wrong target Cartan type")
    ValueError: rule has wrong target Cartan type
```


We should keep it for now and check again when all `__cmp__()` have been removed.



---

archive/issue_comments_224468.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-18T22:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224468",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-19T08:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224469",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224470.json:
```json
{
    "body": "Replying to [comment:2 ohanar]:\n>  * In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.\n\nDidn't know about it. Fixed now.\n\n>  * In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).\n> \nFixed this.\n\n>  * In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).\n\nAdded functions and tests.",
    "created_at": "2014-10-19T08:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224470",
    "user": "aapitzsch"
}
```

Replying to [comment:2 ohanar]:
>  * In `sage.combinat.e_one_star` (and in general), why do you change the expression in `__eq__` method to use backslashes instead of parens? According to PEP8, wrapping long lines should be done with parens, brackets, and braces rather than with backslashes.

Didn't know about it. Fixed now.

>  * In `sage.combinat.root_system.branching_rules`, `sage.doctest.*`, and `sage.rings.finit_rings.residue_field`, using `not isinstance(other, type(self))` is not equivalent to the previous line of reasoning (i.e. `type(self)` might be a super class of `type(other)`). Instead use something like `other.__class__ is not self.__class__` (using `__class__` is better than `type` for duck typing purposes).
> 
Fixed this.

>  * In `sage.dynamics.flat_surfaces.strata`, you seemed to have removed the less than and greater than functionality (that wasn't being tested by the doctests).

Added functions and tests.



---

archive/issue_comments_224471.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-19T08:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224471",
    "user": "aapitzsch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_224472.json:
```json
{
    "body": "Hi Andr\u00e9, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious! \n\nBy the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...\n\nWhat is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?",
    "created_at": "2014-11-18T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224472",
    "user": "wluebbe"
}
```

Hi André, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious! 

By the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...

What is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?



---

archive/issue_comments_224473.json:
```json
{
    "body": "Changing keywords from \"\" to \"python3\".",
    "created_at": "2014-11-18T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224473",
    "user": "wluebbe"
}
```

Changing keywords from "" to "python3".



---

archive/issue_comments_224474.json:
```json
{
    "body": "Replying to [comment:7 wluebbe]:\n> Hi Andr\u00e9, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious!\n\nUp to some exceptions I chose the `__cmp__()` functions which only checked for equality, where I hadn't to implement `__gt__()` etc.\n \n> By the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...\n\nThe main \"problem\" of replacing `__cmp__()` is pointed out in http://www.mail-archive.com/sage-devel`@`googlegroups.com/msg73051.html. Until we find a reasonable solution for it, we should continue with the easier tickets, like #16529.\n\n> What is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?\n\nAll comparisons need `self._marked_separatrix == other._marked_separatrix` and I think this leads to problems with the class decorator.",
    "created_at": "2014-11-18T19:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224474",
    "user": "aapitzsch"
}
```

Replying to [comment:7 wluebbe]:
> Hi André, how did you select the modules from the //mountain// of affected modules from ticket:16537? Is there a common theme? Just curious!

Up to some exceptions I chose the `__cmp__()` functions which only checked for equality, where I hadn't to implement `__gt__()` etc.
 
> By the way, after seeing the size of the //cmp//-problem in ticket:16537 I was so shocked that I stopped working on Sage and Python 3! So this gives me some fresh motivation ...

The main "problem" of replacing `__cmp__()` is pointed out in http://www.mail-archive.com/sage-devel`@`googlegroups.com/msg73051.html. Until we find a reasonable solution for it, we should continue with the easier tickets, like #16529.

> What is the reason for explicitly defining all 4 comparisons in `src/sage/dynamics/flat_surfaces/strata.py` instead of defining one (e.g. `__gt__`) and using the class decorator `functools.total_ordering`?

All comparisons need `self._marked_separatrix == other._marked_separatrix` and I think this leads to problems with the class decorator.



---

archive/issue_comments_224475.json:
```json
{
    "body": "I do not think that it is //always// the right approach to solve the easier problems before the hard ones.\n\nWe have done this with good reason for stage 1 (#15980). But the completion of stage 1 has to precede the completion of stage 2. And now we have the hard problems that remain in stage 1!\n\nI think that stage 2 (#16052) could use a tool like https://github.com/PythonCharmers/python-future to good effect. \nClearly this does not prevent us from solving some of the problems (added originally to stage 2) in a stage 1 style (as was possible for `filter` and `reduce`, and I think it is also possible for `map` #16073!).\n\nBut we should try to complete stage 1 as soon as possible: if we cannot solve those remaining hard problems then Sage will not available under Python 3.\n\nAnyway I will have a look at #16529 ;-)\nAnd I will try to grok the //rich comparison// stuff - it is difficult and but it is also necessary!",
    "created_at": "2014-11-19T10:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224475",
    "user": "wluebbe"
}
```

I do not think that it is //always// the right approach to solve the easier problems before the hard ones.

We have done this with good reason for stage 1 (#15980). But the completion of stage 1 has to precede the completion of stage 2. And now we have the hard problems that remain in stage 1!

I think that stage 2 (#16052) could use a tool like https://github.com/PythonCharmers/python-future to good effect. 
Clearly this does not prevent us from solving some of the problems (added originally to stage 2) in a stage 1 style (as was possible for `filter` and `reduce`, and I think it is also possible for `map` #16073!).

But we should try to complete stage 1 as soon as possible: if we cannot solve those remaining hard problems then Sage will not available under Python 3.

Anyway I will have a look at #16529 ;-)
And I will try to grok the //rich comparison// stuff - it is difficult and but it is also necessary!



---

archive/issue_comments_224476.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T13:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224476",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224477.json:
```json
{
    "body": "Same question as in #16537: Can the work be reduced by including the code in http://www.voidspace.org.uk/python/articles/comparison.shtml into the `SageObject` class? Please reply there.",
    "created_at": "2015-02-17T17:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224477",
    "user": "rws"
}
```

Same question as in #16537: Can the work be reduced by including the code in http://www.voidspace.org.uk/python/articles/comparison.shtml into the `SageObject` class? Please reply there.



---

archive/issue_comments_224478.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2015-04-12T15:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224478",
    "user": "rws"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_224479.json:
```json
{
    "body": "With the new arguments in #16537 I think this is at least needs_info, if not wontfix.",
    "created_at": "2015-04-12T15:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224479",
    "user": "rws"
}
```

With the new arguments in #16537 I think this is at least needs_info, if not wontfix.



---

archive/issue_comments_224480.json:
```json
{
    "body": "Changing component from misc to python3.",
    "created_at": "2016-05-02T13:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224480",
    "user": "jdemeyer"
}
```

Changing component from misc to python3.



---

archive/issue_comments_224481.json:
```json
{
    "body": "This is way outdated. Let it be closed as invalid.",
    "created_at": "2017-08-26T15:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224481",
    "user": "chapoton"
}
```

This is way outdated. Let it be closed as invalid.



---

archive/issue_comments_224482.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2017-08-26T15:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224482",
    "user": "chapoton"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_224483.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16938#issuecomment-224483",
    "user": "embray"
}
```

Resolution: wontfix
