# Issue 25201: Calculus in embedded submanifolds

archive/issues_025201.json:
```json
{
    "body": "CC:  egourgoulhon\n\nKeywords: submanifold, embedding, immersion, manifold, foliation\n\nThis ticket is the logical continuation of #25164\n\nIt implements various calculus methods on pseudo-riemannian submanifolds (for example: normal vector, first/second fundamental form, gauss/principal/mean curvature...).\n\nSome methods are also used exclusively in the case a foliation is provided (shift, lapse, ...).\n\nUsing these functions, one can for example easily perform n+1 decomposition of any tensorfield.\n\nThis is part of the \u200b[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. \n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25438\n\n",
    "created_at": "2018-05-24T16:07:53Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Calculus in embedded submanifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25201",
    "user": "@FlorentinJ"
}
```
CC:  egourgoulhon

Keywords: submanifold, embedding, immersion, manifold, foliation

This ticket is the logical continuation of #25164

It implements various calculus methods on pseudo-riemannian submanifolds (for example: normal vector, first/second fundamental form, gauss/principal/mean curvature...).

Some methods are also used exclusively in the case a foliation is provided (shift, lapse, ...).

Using these functions, one can for example easily perform n+1 decomposition of any tensorfield.

This is part of the â€‹[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. 


Issue created by migration from https://trac.sagemath.org/ticket/25438





---

archive/issue_comments_354979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-30T15:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354979",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354980.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T07:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354980",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354981.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-01T07:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354981",
    "user": "@FlorentinJ"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354982.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-03T17:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354982",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354983.json:
```json
{
    "body": "Have you noticed the errors reported by the patchbot (2 doctests + various plugins)?\n\nTo understand what the plugins check presicely, see the docstrings in the source file [plugins.py](https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py). For instance, you will see that `\\overrightarrow`, which is a valid LaTeX instruction, triggers the plugin `foreign_latex`...",
    "created_at": "2018-06-03T17:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354983",
    "user": "egourgoulhon"
}
```

Have you noticed the errors reported by the patchbot (2 doctests + various plugins)?

To understand what the plugins check presicely, see the docstrings in the source file [plugins.py](https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py). For instance, you will see that `\overrightarrow`, which is a valid LaTeX instruction, triggers the plugin `foreign_latex`...



---

archive/issue_comments_354984.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-05T16:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354984",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354985.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-05T16:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354985",
    "user": "@FlorentinJ"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354986.json:
```json
{
    "body": "This is a nice enhancement regarding differential geometry!\n\nThe code is carefully written and documented. \nThe main issue is the long time of some doctests, for instance:\n\n```\nFile \"src/sage/manifolds/differentiable/pseudo_riemannian_submanifold.py\", \nline 156, in sage.manifolds.differentiable.pseudo_riemannian_submanifold\nWarning, slow doctest:\n    N.extrinsic_curvature()[:] # long time\nTest ran for 462.97 s\n```\n\nThis is far too long for a single doctest. On my computer, there are 7 doctests with a time above 50 s. This increases too much the total time for doctesting all Sage library. Probably the solution would be to decrease the dimensionality of your examples, i.e. consider hypersurfaces embedded in a 3-dimensional manifold instead of a 4-dimensional one. \n\nAnother remark: the documentation generated for the method `ambient_extrinsic_curvature` appears to be that of the decorator ``@`cached_method`, because of the alias\n\n```\nambient_extrinsic_curvature = cached_method(ambient_second_fundamental_form)\n```\n\nin line 974 of `pseudo_riemannian_submanifold.py`. Same issue for `extrinsic_curvature`, `induced_metric`, `ambient_induced_metric`.",
    "created_at": "2018-06-12T14:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354986",
    "user": "egourgoulhon"
}
```

This is a nice enhancement regarding differential geometry!

The code is carefully written and documented. 
The main issue is the long time of some doctests, for instance:

```
File "src/sage/manifolds/differentiable/pseudo_riemannian_submanifold.py", 
line 156, in sage.manifolds.differentiable.pseudo_riemannian_submanifold
Warning, slow doctest:
    N.extrinsic_curvature()[:] # long time
Test ran for 462.97 s
```

This is far too long for a single doctest. On my computer, there are 7 doctests with a time above 50 s. This increases too much the total time for doctesting all Sage library. Probably the solution would be to decrease the dimensionality of your examples, i.e. consider hypersurfaces embedded in a 3-dimensional manifold instead of a 4-dimensional one. 

Another remark: the documentation generated for the method `ambient_extrinsic_curvature` appears to be that of the decorator ``@`cached_method`, because of the alias

```
ambient_extrinsic_curvature = cached_method(ambient_second_fundamental_form)
```

in line 974 of `pseudo_riemannian_submanifold.py`. Same issue for `extrinsic_curvature`, `induced_metric`, `ambient_induced_metric`.



---

archive/issue_comments_354987.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-12T14:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354987",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-13T09:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354988",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354989.json:
```json
{
    "body": "I went from 4D Minkowsky to 3D Minkowsky in the first example, which resulted in a total test time of about 4 minutes on my laptop:\n\n\n```\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 247.5 seconds\n    cpu time: 269.6 seconds\n    cumulative wall time: 247.4 seconds\n\n```\n\n\nFurther reducing this time would mean further reducing the dimension, but 1D foliation of 2D manifold are not very interesting.",
    "created_at": "2018-06-13T10:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354989",
    "user": "@FlorentinJ"
}
```

I went from 4D Minkowsky to 3D Minkowsky in the first example, which resulted in a total test time of about 4 minutes on my laptop:


```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 247.5 seconds
    cpu time: 269.6 seconds
    cumulative wall time: 247.4 seconds

```


Further reducing this time would mean further reducing the dimension, but 1D foliation of 2D manifold are not very interesting.



---

archive/issue_comments_354990.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-13T13:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354990",
    "user": "@FlorentinJ"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354991.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354991",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354992.json:
```json
{
    "body": "In the above \"reviewer tweaks\", I've mostly amended the documentation. The main change is the removal of the ``@`cached_method` decorator on methods like `first_fundamental_form` and the removal of the duplicated code in methods like `induced_metric`. I understand that this was introduced to address the documentation issue related to ``@`cached_method` mentioned in comment:8. In the new setting, the caching is performed \"manually\", by checking whether the attribute `self._first_fundamental_form` is `None` or not, and the alias is properly defined as \n\n```\nextrinsic_curvature = second_fundamental_form\n```\n\nThis avoids the duplication of doctests. As a result, the doctest time for the file `pseudo_riemannian_submanifold.py` decreases from 315 s to 248 s (on my computer). However this is still too much! A solution would be to replace most (all?) the sphere examples by simpler ones, like those for a cylinder, or even by those for a plane, in cases where they are not trivial (e.g. for the normal).\n\nAnother thing to do is to distinguish which methods are valid for a generic submanifold, like `first_fundamental_form` or `projector`, and those that are valid only for hypersurfaces, like `second_fundamental_form` or `normal`. \n\nI am leaving the ticket status to \"needs review\" to catch the attention of the patchbot...",
    "created_at": "2018-06-19T15:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354992",
    "user": "egourgoulhon"
}
```

In the above "reviewer tweaks", I've mostly amended the documentation. The main change is the removal of the ``@`cached_method` decorator on methods like `first_fundamental_form` and the removal of the duplicated code in methods like `induced_metric`. I understand that this was introduced to address the documentation issue related to ``@`cached_method` mentioned in comment:8. In the new setting, the caching is performed "manually", by checking whether the attribute `self._first_fundamental_form` is `None` or not, and the alias is properly defined as 

```
extrinsic_curvature = second_fundamental_form
```

This avoids the duplication of doctests. As a result, the doctest time for the file `pseudo_riemannian_submanifold.py` decreases from 315 s to 248 s (on my computer). However this is still too much! A solution would be to replace most (all?) the sphere examples by simpler ones, like those for a cylinder, or even by those for a plane, in cases where they are not trivial (e.g. for the normal).

Another thing to do is to distinguish which methods are valid for a generic submanifold, like `first_fundamental_form` or `projector`, and those that are valid only for hypersurfaces, like `second_fundamental_form` or `normal`. 

I am leaving the ticket status to "needs review" to catch the attention of the patchbot...



---

archive/issue_comments_354993.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-19T21:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354993",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354994.json:
```json
{
    "body": "Now that one patchbot has done its job... (it's reporting only a failure of the `commit_messages` plugin, which looks a false report to me, since all commits involved in this ticket do have a commit message...)",
    "created_at": "2018-06-19T21:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354994",
    "user": "egourgoulhon"
}
```

Now that one patchbot has done its job... (it's reporting only a failure of the `commit_messages` plugin, which looks a false report to me, since all commits involved in this ticket do have a commit message...)



---

archive/issue_comments_354995.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-20T10:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354995",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354996.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-25T09:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354996",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354997.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-25T09:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354997",
    "user": "@FlorentinJ"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354998.json:
```json
{
    "body": "Thanks for the changes. LGTM. Thanks for this nice piece of work!",
    "created_at": "2018-06-26T13:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354998",
    "user": "egourgoulhon"
}
```

Thanks for the changes. LGTM. Thanks for this nice piece of work!



---

archive/issue_comments_354999.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-26T13:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-354999",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355000.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-29T22:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25201#issuecomment-355000",
    "user": "vbraun"
}
```

Resolution: fixed
