# Issue 25201: Calculus in embedded submanifolds

Issue created by migration from https://trac.sagemath.org/ticket/25438

Original creator: @FlorentinJ

Original creation time: 2018-05-24 16:07:53

CC:  egourgoulhon

Keywords: submanifold, embedding, immersion, manifold, foliation

This ticket is the logical continuation of #25164

It implements various calculus methods on pseudo-riemannian submanifolds (for example: normal vector, first/second fundamental form, gauss/principal/mean curvature...).

Some methods are also used exclusively in the case a foliation is provided (shift, lapse, ...).

Using these functions, one can for example easily perform n+1 decomposition of any tensorfield.

This is part of the â€‹[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. 



---

Comment by git created at 2018-05-30 15:05:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-31 07:35:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-06-01 07:44:55

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2018-06-03 17:01:23

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2018-06-03 17:01:23

Have you noticed the errors reported by the patchbot (2 doctests + various plugins)?

To understand what the plugins check presicely, see the docstrings in the source file [plugins.py](https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py). For instance, you will see that `\overrightarrow`, which is a valid LaTeX instruction, triggers the plugin `foreign_latex`...


---

Comment by git created at 2018-06-05 16:33:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-06-05 16:35:26

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2018-06-12 14:12:03

This is a nice enhancement regarding differential geometry!

The code is carefully written and documented. 
The main issue is the long time of some doctests, for instance:

```
File "src/sage/manifolds/differentiable/pseudo_riemannian_submanifold.py", 
line 156, in sage.manifolds.differentiable.pseudo_riemannian_submanifold
Warning, slow doctest:
    N.extrinsic_curvature()[:] # long time
Test ran for 462.97 s
```

This is far too long for a single doctest. On my computer, there are 7 doctests with a time above 50 s. This increases too much the total time for doctesting all Sage library. Probably the solution would be to decrease the dimensionality of your examples, i.e. consider hypersurfaces embedded in a 3-dimensional manifold instead of a 4-dimensional one. 

Another remark: the documentation generated for the method `ambient_extrinsic_curvature` appears to be that of the decorator ``@`cached_method`, because of the alias

```
ambient_extrinsic_curvature = cached_method(ambient_second_fundamental_form)
```

in line 974 of `pseudo_riemannian_submanifold.py`. Same issue for `extrinsic_curvature`, `induced_metric`, `ambient_induced_metric`.


---

Comment by egourgoulhon created at 2018-06-12 14:12:03

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-06-13 09:51:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-06-13 10:00:14

I went from 4D Minkowsky to 3D Minkowsky in the first example, which resulted in a total test time of about 4 minutes on my laptop:


```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 247.5 seconds
    cpu time: 269.6 seconds
    cumulative wall time: 247.4 seconds

```


Further reducing this time would mean further reducing the dimension, but 1D foliation of 2D manifold are not very interesting.


---

Comment by @FlorentinJ created at 2018-06-13 13:48:22

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-06-19 15:28:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-06-19 15:49:55

In the above "reviewer tweaks", I've mostly amended the documentation. The main change is the removal of the ``@`cached_method` decorator on methods like `first_fundamental_form` and the removal of the duplicated code in methods like `induced_metric`. I understand that this was introduced to address the documentation issue related to ``@`cached_method` mentioned in comment:8. In the new setting, the caching is performed "manually", by checking whether the attribute `self._first_fundamental_form` is `None` or not, and the alias is properly defined as 

```
extrinsic_curvature = second_fundamental_form
```

This avoids the duplication of doctests. As a result, the doctest time for the file `pseudo_riemannian_submanifold.py` decreases from 315 s to 248 s (on my computer). However this is still too much! A solution would be to replace most (all?) the sphere examples by simpler ones, like those for a cylinder, or even by those for a plane, in cases where they are not trivial (e.g. for the normal).

Another thing to do is to distinguish which methods are valid for a generic submanifold, like `first_fundamental_form` or `projector`, and those that are valid only for hypersurfaces, like `second_fundamental_form` or `normal`. 

I am leaving the ticket status to "needs review" to catch the attention of the patchbot...


---

Comment by egourgoulhon created at 2018-06-19 21:01:44

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2018-06-19 21:01:44

Now that one patchbot has done its job... (it's reporting only a failure of the `commit_messages` plugin, which looks a false report to me, since all commits involved in this ticket do have a commit message...)


---

Comment by git created at 2018-06-20 10:02:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-25 09:18:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-06-25 09:18:24

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2018-06-26 13:43:42

Thanks for the changes. LGTM. Thanks for this nice piece of work!


---

Comment by egourgoulhon created at 2018-06-26 13:43:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-29 22:33:58

Resolution: fixed
