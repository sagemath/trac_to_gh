# Issue 18205: Implement a barycentric subdivision method for Polyhedron class

Issue created by migration from Trac.

Original creator: jipilab

Original creation time: 2015-05-18 15:52:58

CC:  vbraun mhampton moritz chapoton

Keywords: polytope, barycentric subdivision

The barycentric subdivision of a compact polytope is a new polytope obtained by subdividing every face of the polytope by a vertex. Its faces are in bijection with flags of faces of the input polytope.


---

Comment by jipilab created at 2015-05-18 15:54:49

New commits:


---

Comment by jipilab created at 2015-05-18 15:54:49

Changing status from new to needs_review.


---

Comment by jipilab created at 2015-05-20 09:21:16

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2015-05-20 09:21:43

The current code only works for simplicial polytopes. I have to correct the code for more general cases.


---

Comment by git created at 2015-05-20 15:58:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-05-21 11:51:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-06-07 10:38:02

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-06-08 11:57:51

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-06-08 11:57:51

* the doc does not build, Seems to be some indentation error

* do not use assert to check the input. Rather raise `ValueError('text')` or `TypeError('text')`


---

Comment by git created at 2015-06-09 08:24:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-09 08:29:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-09 08:30:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-06-09 08:31:43

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-06-13 13:02:17

I have made a first review.

Do you really need to build a polyhedron so many times ?

The doctest with pentagon in AA was very slow. I replaced AA by RDF and it failed.
----
New commits:


---

Comment by chapoton created at 2015-06-13 13:02:17

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2015-06-25 13:48:41

Hi Frédéric,

Yes, I was wondering if it was absolutely necessary to use all these intermediate polyhedra. It is very costly indeed. I have to think how to improve this.


---

Comment by jipilab created at 2015-06-28 08:49:59

Hi again,

So, I looked at bit at the literature, maybe I'm missing some efficient way to compute it...

Suppose we have a very round polytope and we want to do the barycentric subdivision of it. To do it, I used the face fan of the polar (which is the normal fan of the original) for the implementation since cutting by an hyperplane was algorithmically easier than adding a vertex (as I saw it...).

We need to start with adding a vertex at the barycenter of all the facets. This is done dually by chopping every vertex of the polar polytope. The "chopping height" is determined by the location of the vertices of the polytope: we cut 1/3 of the shortest edge touching this vertex in the direction of the normal of the hyperplane.

Once all the facets are done, we really need (I believe) to compute an intermediate polytope to proceed to the ridges and lower dimensional faces to subdivide, since the location of the next cuts will depend on the location of the newly created vertices (remember that the polytope is assumed very round so the interval in which we can put the next vertices depend highly on the previous ones).

Topologically, this is not necessary, but to realize the barycentric subdivision convexly I'm afraid this is necessary.

In any case, I believe that the barycentric subdivision is known to be very costly (counting flags in a lattice grows exponentially...) so it is to be expected that it gets slow very fast. Of course, it also depends in which ring the computation is done.

Does the way I used make sense at all?


---

Comment by git created at 2015-06-28 08:51:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-10-12 15:40:30

The problem pointed out is created by the following behavior:

sage: P = polytopes.regular_polygon(5)
sage: a_vertex = P.vertices()[0]
sage: for facet in P.Hrepresentation():
    print facet.contains(a_vertex), facet.interior_contains(a_vertex)
True False
True True
True False
True True
True True
sage: P = polytopes.regular_polygon(5, base_ring=RDF)
sage: a_vertex = P.vertices()[0]
sage: for facet in P.Hrepresentation():
    print facet.contains(a_vertex), facet.interior_contains(a_vertex)  
True True
True True
True True
True True
True True

The last behavior is indeed problematic since we can not recognize the vertices by the containment using the specific methods. Is this a bug?

Basically, I would never really do computation in RDF using polytopes or do it in very specific contexts. In the context of barycentric subdivision also.

For the sake of this patch, perhaps taking a regular pentagon is not ideal, although it aloud to show this problem.

I could simply replace this example with a square.


---

Comment by dimpase created at 2015-10-13 16:15:18

I do not understand the ticket description. A subdivision of a polytope is not a polytope, at least if by subdivision you mean a partition into polytopes with non-intersecting interiors.


---

Comment by dimpase created at 2015-10-13 17:30:13

Hmm, now the title says you subdivide the boundary only, while you still have  `barycentric_subdivision()` subdividing the whole polytope, no?


---

Comment by dimpase created at 2015-10-13 17:31:49

and what is "compact polyhedron"? I can think of two quite different meanings...


---

Comment by jipilab created at 2015-10-13 17:45:34

Yes, I guess I should change the name of the method too then.

There is a method in polyhedron called .is_compact() which verifies for boundedness. This is the definition I use for compact polyhedron.


---

Comment by dimpase created at 2015-10-13 18:06:11

Replying to [comment:24 jipilab]:
> Yes, I guess I should change the name of the method too then.
> 
> There is a method in polyhedron called .is_compact() which verifies for boundedness. This is the definition I use for compact polyhedron.

Does this mean that your compact polyhedra are polytopes, or not?


---

Comment by jipilab created at 2015-10-13 18:11:28

Yes. This is the definition of a polytope: a bounded polyhedron.

Basically the notion of polytope is subsumed in Sage by the class Polyhedron.

Theorically a polyhedron (with H representation) is always decomposed as the sum of a polyhedral cone and a convex polytope, therefore polytopes are considered in the class polyhedron simply where the cone is a point, and the way to detect them is by checking compactness.

The description uses polyhedron simply because polytope is more or less absent from the nomenclature in sage apart from the database of polytopes...


---

Comment by dimpase created at 2015-10-13 18:40:10

Replying to [comment:26 jipilab]:
> Yes. This is the definition of a polytope: a bounded polyhedron.

you might also find definitions of polyheda, as finite unions of convex polyhedra.
That is, convexity is not always assumed.

> 
> Basically the notion of polytope is subsumed in Sage by the class Polyhedron.
> 
> Theorically a polyhedron (with H representation) is always decomposed as the sum of a polyhedral cone and a convex polytope, therefore polytopes are considered in the class polyhedron simply where the cone is a point, and the way to detect them is by checking compactness.
> 
> The description uses polyhedron simply because polytope is more or less absent from the nomenclature in sage apart from the database of polytopes.
> 
hmm, and what do you compute then? The boundary of a polyhedron is not convex...


---

Comment by jipilab created at 2015-10-14 06:59:09

Replying to [comment:27 dimpase]:
> Replying to [comment:26 jipilab]:
> > Yes. This is the definition of a polytope: a bounded polyhedron.
> 
> you might also find definitions of polyheda, as finite unions of convex polyhedra.
> That is, convexity is not always assumed.

This is true, for example in rigidity theory. As far as I know, the Polyhedron class in Sage deals only with convex polyhedra. In this case, it is assumed that it is convex.

> 
> > 
> > Basically the notion of polytope is subsumed in Sage by the class Polyhedron.
> > 
> > Theorically a polyhedron (with H representation) is always decomposed as the sum of a polyhedral cone and a convex polytope, therefore polytopes are considered in the class polyhedron simply where the cone is a point, and the way to detect them is by checking compactness.
> > 
> > The description uses polyhedron simply because polytope is more or less absent from the nomenclature in sage apart from the database of polytopes.
> > 
> hmm, and what do you compute then? The boundary of a polyhedron is not convex...

The boundary of a polytope is a CW-complex for which we compute a geometric realization of its barycentric subdivision.


---

Comment by git created at 2015-10-21 12:35:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-10-21 12:40:58

The discussion on sage-devel available here:

https://groups.google.com/forum/#!searchin/sage-devel/barycentric/sage-devel/HubsPplvkE4/gw0avDkWCQAJ

Led me to only test for rational polytopes. The barycentric subdivision is fast enough on the rationals and will ultimately lead to problems in RDF in any case, therefore I would say it is not necessary to test it.

I would say it is also not necessary to warn the user, as the user should know that doing such computations in RDF will lead to errors.

Is that reasonable?

The current last commit made test pass on sage-6.9.


---

Comment by jipilab created at 2015-10-21 12:40:58

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-10-30 16:05:00

Replying to [comment:30 jipilab]:
> The discussion on sage-devel available here:
> 
> https://groups.google.com/forum/#!searchin/sage-devel/barycentric/sage-devel/HubsPplvkE4/gw0avDkWCQAJ
> 
> Led me to only test for rational polytopes. The barycentric subdivision is fast enough on the rationals and will ultimately lead to problems in RDF in any case, therefore I would say it is not necessary to test it.
> 
> I would say it is also not necessary to warn the user, as the user should know that doing such computations in RDF will lead to errors.
> 
> Is that reasonable?
> 
> The current last commit made test pass on sage-6.9.

there is also a backend to work with real algebraic numbers.
(`Polyhedron(...., backend='field'...)`)
I think your code needs to be tested with it, too...


---

Comment by git created at 2015-11-25 08:54:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-11-25 08:57:20

I added a test for the field backend.

All test passed on sage-6.10.beta2. The bot should be fine with beta5 I guess.

Needs review!


---

Comment by dimpase created at 2015-11-25 12:24:23

looks good to me; I even tried

```
sage: P = Polyhedron(vertices=[[0,0,0],[0,AA(sqrt(2)),0],[1,0,0],[0,0,1]], backend='field')
sage: P.barycentric_subdivision(1/AA(sqrt(5)))
A 3-dimensional polyhedron in AA^3 defined as the convex hull of 14 vertices
```

slow, but works...


---

Comment by dimpase created at 2015-11-25 12:24:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-11-25 23:29:39

Resolution: fixed
