# Issue 31240: Error in pynac's numeric::gcd method

Issue created by migration from https://trac.sagemath.org/ticket/31477

Original creator: @DaveWitteMorris

Original creation time: 2021-03-10 06:19:09

Keywords: gcd, pynac

Functions in pynac expect the `gcd` of two rational numbers `p` and `q` to be the largest number `d`, such that `p/d` and `q/d` are integers (except that `gcd(0,0) = 0`). But pynac's `numeric::gcd` method says that `gcd(p,1) = 1` for all `p`, which does not have to be true when `p` is not an integer.

Related ticket: #24880


---

Comment by @DaveWitteMorris created at 2021-03-10 06:44:36

This is part of metaticket #31478.
----
New commits:


---

Comment by @DaveWitteMorris created at 2021-03-10 06:44:36

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-04-19 00:53:46

Wouldn't it make sense to check that if `a.is_one()` you return the denominator of `b` (and vice versa) so you don't completely loose the special case optimizations?


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by @DaveWitteMorris created at 2021-06-28 04:39:27

Changing status from needs_review to needs_work.


---

Comment by @DaveWitteMorris created at 2021-06-28 04:39:27

Replying to [comment:3 tscrim]:
> Wouldn't it make sense to check that if `a.is_one()` you return the denominator of `b` (and vice versa) so you don't completely loose the special case optimizations?

That seems reasonable, but needs some thought, because it will change the value of the function in some cases. Without the change you suggest, I think `1.gcd(b)` will return `1` whenever `b` is a `PyObject` (such as a complex number), even if the denominator of `b` is not `1` (for example, if `b` is a rational multiple of `I`). 

I think your change is probably correct (so the rest of the `numeric::gcd` code should be modified to match this), but this should be verified by looking at the uses of the `gcd` function to see what behaviour is expected.

Related ticket: #31884.

PS. Once the correct behaviour has been implemented, the description of the `gcd(const numeric &a, const numeric &b)` function (in this same file) should be corrected. It currently says "return  The GCD of two numbers if both are integer, a numerical 1 if they are not."


---

Comment by mkoeppe created at 2021-08-16 22:06:43

With #32386, the new patch can just be applied to the merged-in sources


---

Comment by mkoeppe created at 2021-09-04 01:22:00

... by doing `(cd src/sage/symbolic && patch -p1) < build/pkgs/pynac/patches/gcd1.patch`


---

Comment by git created at 2021-09-26 17:57:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-09-26 17:58:09

9.5.beta2 has merged #32386, so I have applied your patch as indicated in comment:8
