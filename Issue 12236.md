# Issue 12236: Segfault on a simple piece of call using matrices that used to work with 4.7.2

Issue created by migration from https://trac.sagemath.org/ticket/12408

Original creator: nthiery

Original creation time: 2012-02-01 11:44:39

Assignee: jason, was

CC:  robertwb

The following piece of code, inserted in the matrix code, triggers a segfault in Sage 4.8, whereas it used to work in 4.7.2:


```
    def _travel_column( self, dict d, int k):
        r"""
        Triggers a seg fault in Sage 4.8 but not 4.7.2

            sage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M
            [ 0  1  0]
            [-1  0 -1]
            [ 0  1  0]
            sage: M._travel_column({0:1},0)
            ** BOOM, Segfault **

        """
        cdef int i
        for i from 0 <= i < self.ncols():
            d[i] = 1
            print any(self[i,j] != 1 for j in d)
```


To reproduce: apply the attached patch on vanilla Sage 4.8, and run
the example above. Platform: at least Ubuntu 11.10 on a Macbook pro.

Note: the code is meaningless by itself; it's the smallest reduction I
could make of a real piece of code that triggered the seg fault in the
first place (#10347). For example there is no segfault if `any` is
replaced by a list comprehension. I suspect this issue to be related
to the upgraded iterators in the new version of Cython included in
Sage.

Cython experts, please!

Also, please update the component once we know more precisely what the issue is.


---

Comment by nthiery created at 2012-02-01 11:46:09

Sample code triggering the segfault. DO NOT MERGE IN SAGE!


---

Attachment


---

Attachment

fix for the problem calling any( ... ) in cython


---

Comment by stumpc5 created at 2012-02-02 09:48:21

Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).


---

Comment by nthiery created at 2012-02-02 10:25:58

Replying to [comment:2 stumpc5]:
> Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).

Thanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.


---

Comment by stumpc5 created at 2012-02-02 11:03:07

Replying to [comment:3 nthiery]:
> Replying to [comment:2 stumpc5]:
> > Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).
> 
> Thanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.

done.


---

Comment by jdemeyer created at 2018-02-15 15:29:04

Resolution: worksforme


---

Comment by jdemeyer created at 2018-02-15 15:29:04

In Sage 8.2.beta5 (after fixing the `print` statement):

```
sage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M
[ 0  1  0]
[-1  0 -1]
[ 0  1  0]
sage: M._travel_column({0:1},0)
True
True
True
```



---

Comment by nthiery created at 2018-02-16 09:29:05

Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?


---

Comment by jdemeyer created at 2018-02-16 14:24:35

Replying to [comment:10 nthiery]:
> Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?

I could have been a Cython bug, I have no idea.
