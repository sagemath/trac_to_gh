# Issue 12236: Segfault on a simple piece of call using matrices that used to work with 4.7.2

archive/issues_012236.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @robertwb\n\nThe following piece of code, inserted in the matrix code, triggers a segfault in Sage 4.8, whereas it used to work in 4.7.2:\n\n\n```\n    def _travel_column( self, dict d, int k):\n        r\"\"\"\n        Triggers a seg fault in Sage 4.8 but not 4.7.2\n\n            sage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M\n            [ 0  1  0]\n            [-1  0 -1]\n            [ 0  1  0]\n            sage: M._travel_column({0:1},0)\n            ** BOOM, Segfault **\n\n        \"\"\"\n        cdef int i\n        for i from 0 <= i < self.ncols():\n            d[i] = 1\n            print any(self[i,j] != 1 for j in d)\n```\n\n\nTo reproduce: apply the attached patch on vanilla Sage 4.8, and run\nthe example above. Platform: at least Ubuntu 11.10 on a Macbook pro.\n\nNote: the code is meaningless by itself; it's the smallest reduction I\ncould make of a real piece of code that triggered the seg fault in the\nfirst place (#10347). For example there is no segfault if `any` is\nreplaced by a list comprehension. I suspect this issue to be related\nto the upgraded iterators in the new version of Cython included in\nSage.\n\nCython experts, please!\n\nAlso, please update the component once we know more precisely what the issue is.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12408\n\n",
    "created_at": "2012-02-01T11:44:39Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Segfault on a simple piece of call using matrices that used to work with 4.7.2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12236",
    "user": "@nthiery"
}
```
Assignee: jason, was

CC:  @robertwb

The following piece of code, inserted in the matrix code, triggers a segfault in Sage 4.8, whereas it used to work in 4.7.2:


```
    def _travel_column( self, dict d, int k):
        r"""
        Triggers a seg fault in Sage 4.8 but not 4.7.2

            sage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M
            [ 0  1  0]
            [-1  0 -1]
            [ 0  1  0]
            sage: M._travel_column({0:1},0)
            ** BOOM, Segfault **

        """
        cdef int i
        for i from 0 <= i < self.ncols():
            d[i] = 1
            print any(self[i,j] != 1 for j in d)
```


To reproduce: apply the attached patch on vanilla Sage 4.8, and run
the example above. Platform: at least Ubuntu 11.10 on a Macbook pro.

Note: the code is meaningless by itself; it's the smallest reduction I
could make of a real piece of code that triggered the seg fault in the
first place (#10347). For example there is no segfault if `any` is
replaced by a list comprehension. I suspect this issue to be related
to the upgraded iterators in the new version of Cython included in
Sage.

Cython experts, please!

Also, please update the component once we know more precisely what the issue is.

Issue created by migration from https://trac.sagemath.org/ticket/12408





---

archive/issue_comments_143016.json:
```json
{
    "body": "Sample code triggering the segfault. DO NOT MERGE IN SAGE!",
    "created_at": "2012-02-01T11:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143016",
    "user": "@nthiery"
}
```

Sample code triggering the segfault. DO NOT MERGE IN SAGE!



---

archive/issue_comments_143017.json:
```json
{
    "body": "Attachment [trac_12408-code_trigerring_segfault-nt.patch](tarball://root/attachments/some-uuid/ticket12408/trac_12408-code_trigerring_segfault-nt.patch) by @nthiery created at 2012-02-01 14:09:46",
    "created_at": "2012-02-01T14:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143017",
    "user": "@nthiery"
}
```

Attachment [trac_12408-code_trigerring_segfault-nt.patch](tarball://root/attachments/some-uuid/ticket12408/trac_12408-code_trigerring_segfault-nt.patch) by @nthiery created at 2012-02-01 14:09:46



---

archive/issue_comments_143018.json:
```json
{
    "body": "Attachment [trac_12408-travel_column-cs.patch](tarball://root/attachments/some-uuid/ticket12408/trac_12408-travel_column-cs.patch) by stumpc5 created at 2012-02-02 09:46:31\n\nfix for the problem calling any( ... ) in cython",
    "created_at": "2012-02-02T09:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143018",
    "user": "stumpc5"
}
```

Attachment [trac_12408-travel_column-cs.patch](tarball://root/attachments/some-uuid/ticket12408/trac_12408-travel_column-cs.patch) by stumpc5 created at 2012-02-02 09:46:31

fix for the problem calling any( ... ) in cython



---

archive/issue_comments_143019.json:
```json
{
    "body": "Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).",
    "created_at": "2012-02-02T09:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143019",
    "user": "stumpc5"
}
```

Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).



---

archive/issue_comments_143020.json:
```json
{
    "body": "Replying to [comment:2 stumpc5]:\n> Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).\n\nThanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.",
    "created_at": "2012-02-02T10:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143020",
    "user": "@nthiery"
}
```

Replying to [comment:2 stumpc5]:
> Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).

Thanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.



---

archive/issue_comments_143021.json:
```json
{
    "body": "Replying to [comment:3 nthiery]:\n> Replying to [comment:2 stumpc5]:\n> > Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).\n> \n> Thanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.\n\ndone.",
    "created_at": "2012-02-02T11:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143021",
    "user": "stumpc5"
}
```

Replying to [comment:3 nthiery]:
> Replying to [comment:2 stumpc5]:
> > Thanks Nicolas for reporting the problem. I provided a patch solving the issue in this particular case (though it would be better to simply get any( ... ) working again in cython).
> 
> Thanks! Please fold your patch into #10347, so that #10347 does not depend on this ticket. Anyway, in that particular case, the code is not worst looking without the any.

done.



---

archive/issue_comments_143022.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2018-02-15T15:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143022",
    "user": "@jdemeyer"
}
```

Resolution: worksforme



---

archive/issue_comments_143023.json:
```json
{
    "body": "In Sage 8.2.beta5 (after fixing the `print` statement):\n\n```\nsage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M\n[ 0  1  0]\n[-1  0 -1]\n[ 0  1  0]\nsage: M._travel_column({0:1},0)\nTrue\nTrue\nTrue\n```\n",
    "created_at": "2018-02-15T15:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143023",
    "user": "@jdemeyer"
}
```

In Sage 8.2.beta5 (after fixing the `print` statement):

```
sage: M = matrix(ZZ,3,[0,1,0,-1,0,-1,0,1,0]); M
[ 0  1  0]
[-1  0 -1]
[ 0  1  0]
sage: M._travel_column({0:1},0)
True
True
True
```




---

archive/issue_comments_143024.json:
```json
{
    "body": "Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?",
    "created_at": "2018-02-16T09:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143024",
    "user": "@nthiery"
}
```

Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?



---

archive/issue_comments_143025.json:
```json
{
    "body": "Replying to [comment:10 nthiery]:\n> Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?\n\nI could have been a Cython bug, I have no idea.",
    "created_at": "2018-02-16T14:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12236#issuecomment-143025",
    "user": "@jdemeyer"
}
```

Replying to [comment:10 nthiery]:
> Cool. Thanks for checking this out. Do you have some intuition on why this is resolved now? Presumably improvements in Cython?

I could have been a Cython bug, I have no idea.
