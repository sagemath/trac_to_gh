# Issue 28728: enhance LibGapGroup

Issue created by migration from https://trac.sagemath.org/ticket/28965

Original creator: vdelecroix

Original creation time: 2020-01-07 09:52:00

CC:  chapoton tscrim sbrandhorst

- fix libgap conversion of elements
- faster group operations
- more methods


---

Comment by vdelecroix created at 2020-01-07 09:52:26

New commits:


---

Comment by vdelecroix created at 2020-01-07 09:52:26

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2020-01-07 12:23:59

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2020-01-07 12:23:59

the part on `class Element(ArtinGroupElement):` 
looks unrelated. Please move that to a different ticket.
Otherwise it looks good to me.


---

Comment by vdelecroix created at 2020-01-07 12:27:12

Replying to [comment:3 sbrandhorst]:
> the part on `class Element(ArtinGroupElement):` 
> looks unrelated. Please move that to a different ticket.
> Otherwise it looks good to me. 

It is related! Without this, the `ArtinGroupElement` can not be rebuilt from libgap objects. Without this change, the two tests introduced in commit d90c228 just fail.


---

Comment by sbrandhorst created at 2020-01-07 14:03:37

Changing status from needs_work to positive_review.


---

Comment by sbrandhorst created at 2020-01-07 14:03:37

Whether or not the internal logic is okay, I do not know.
The code seems to do what it says. So I am okay.


---

Comment by vdelecroix created at 2020-01-07 15:58:34

Thank you!


---

Comment by vbraun created at 2020-01-11 17:34:26

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-01-11 17:34:26

On Python 2:

```
**********************************************************************
File "src/sage/groups/libgap_wrapper.pyx", line 505, in sage.groups.libgap_wrapper.ElementLibGAP.gap
Failed example:
    type(libgap(FreeGroup('a, b').an_element()))
Expected:
    <class 'sage.libs.gap.element.GapElement'>
Got:
    <type 'sage.libs.gap.element.GapElement'>
**********************************************************************
1 item had failures:
   1 of   9 in sage.groups.libgap_wrapper.ElementLibGAP.gap
    [141 tests, 1 failure, 0.59 s]
----------------------------------------------------------------------
sage -t --long src/sage/groups/libgap_wrapper.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by vdelecroix created at 2020-01-11 18:10:19

Is this supposed to fail? There are tons of doctest with randomly chosen `<class X>` or `<type X>`!

```
$ git grep "<class " | wc -l
1627
$ git grep "<type " | wc -l
937
```



---

Comment by tscrim created at 2020-01-11 18:21:03

Replying to [comment:9 vdelecroix]:
> Is this supposed to fail? There are tons of doctest with randomly chosen `<class X>` or `<type X>`!

It comes from a difference between Python2 and 3, and they are not randomly chosen. However, you can use `<... X>` to make it compatible with both.


---

Comment by vdelecroix created at 2020-01-11 18:28:42

`sage/groups/abelian_gps/abelian_group.py` line 961-962

```
sage: F = AbelianGroup(3, [2], names='abc')
sage: list(map(type, F.gens_orders()))
[<type 'sage.rings.integer.Integer'>,
 <type 'sage.rings.integer.Integer'>,
 <type 'sage.rings.integer.Integer'>]
```

Which is not the output you get with Python 3. Should I just change it to `type` then (it makes `sage -t` happy).


---

Comment by git created at 2020-01-11 18:33:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2020-01-11 18:33:25

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-01-20 21:18:23

Resolution: fixed
