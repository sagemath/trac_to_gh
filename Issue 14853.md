# Issue 14853: Make random matrices respect Sage's seed for random number gnerators

Issue created by migration from https://trac.sagemath.org/ticket/15090

Original creator: rbeezer

Original creation time: 2013-08-23 20:37:37

CC:  dimpase

GSL distributions are used in the creation of random matrices, so they need to be seeded with an integer from Sage's random number generators in order to make the results predictably random.  Then the random matrices will be reproducible for doctests (#10122) and for WeBWorK homework exercises provided by AskSage with a random seed from the WeBWorK system.  Symptomatic of the current state is:


```
sage: from sage.matrix.constructor import random_rref_matrix
sage: MS = MatrixSpace(QQ, 5, 8)

sage: set_random_seed(666)
sage: first = [random_rref_matrix(MS, 4) for _ in range(10)]

sage: set_random_seed(666)
sage: second = [random_rref_matrix(MS, 4) for _ in range(10)]

sage: first == second
False
```



---

Attachment


---

Comment by rbeezer created at 2013-08-23 21:57:21

Changing status from new to needs_review.


---

Comment by rbeezer created at 2013-08-26 18:14:10

Update, standalone


---

Attachment

"v2" patch is self-contained.  Minor parameter changes in new doctests which will better exercise fixes, and a few new comments with guidance about possible future code adjustments.  No new code.


---

Comment by jason created at 2013-08-27 18:39:04

I get some random_matrix doctests failing:


```
**********************************************************************
File "constructor.py", line 1175, in sage.matrix.constructor.random_matrix
Failed example:
    random_matrix(RR, 3, 4, density=0.66)
Expected:
    [ 0.000000000000000 -0.806696574554030 -0.693915509972359  0.000000000000000]
    [ 0.629781664418083  0.000000000000000 -0.833709843116637  0.000000000000000]
    [ 0.922346867410064  0.000000000000000  0.000000000000000 -0.940316454178921]
Got:
    [  0.000000000000000 -0.0929719759949936   0.676820913302280   0.000000000000000]
    [ -0.741052529138296   0.000000000000000  -0.806696574554030   0.000000000000000]
    [ -0.940316454178921   0.000000000000000   0.000000000000000  -0.614664118017468]
**********************************************************************
File "constructor.py", line 1180, in sage.matrix.constructor.random_matrix
Failed example:
    A = random_matrix(ComplexField(32), 3, density=0.8, sparse=True); A
Expected:
    [                 0.000000000  0.399739209 + 0.909948633*I                  0.000000000]
    [-0.361911424 - 0.455087671*I -0.687810605 + 0.460619713*I  0.625520058 - 0.360952012*I]
    [                 0.000000000                  0.000000000 -0.162196416 - 0.193242896*I]
Got:
    [                 0.000000000  0.877097711 - 0.662290146*I                  0.000000000]
    [0.700430447 + 0.0870635174*I  0.332155072 - 0.728572036*I -0.361911424 - 0.455087671*I]
    [                 0.000000000                  0.000000000  0.577682751 - 0.276405104*I]
```



---

Comment by rbeezer created at 2013-08-27 19:05:57

On 5.11, I grabbed the dependency and this patch, built and tested with no problems whatever in any of it.  In particular `matrix/constructor.py` passes tests.

I'd be willing to believe that new calls to the `randint` function would upset the sequence of random numbers *if* these tests came *after* some of the tests for echelonizable matrices, etc.  But that does not appear to be the case, so I can't see the problem.


---

Comment by jason created at 2014-03-05 02:48:24

#15887 fixes this issue.  Do not apply this patch (unless you want to just push the doctests into the library).


---

Comment by jason created at 2014-03-05 02:50:41

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2014-10-21 22:10:05

Agreed with Jason - fixed by #15887.


---

Comment by novoselt created at 2014-10-21 22:10:05

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-10-27 16:26:27

Resolution: fixed
