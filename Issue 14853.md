# Issue 14853: Make random matrices respect Sage's seed for random number gnerators

archive/issues_014853.json:
```json
{
    "body": "CC:  dimpase\n\nGSL distributions are used in the creation of random matrices, so they need to be seeded with an integer from Sage's random number generators in order to make the results predictably random.  Then the random matrices will be reproducible for doctests (#10122) and for WeBWorK homework exercises provided by AskSage with a random seed from the WeBWorK system.  Symptomatic of the current state is:\n\n\n```\nsage: from sage.matrix.constructor import random_rref_matrix\nsage: MS = MatrixSpace(QQ, 5, 8)\n\nsage: set_random_seed(666)\nsage: first = [random_rref_matrix(MS, 4) for _ in range(10)]\n\nsage: set_random_seed(666)\nsage: second = [random_rref_matrix(MS, 4) for _ in range(10)]\n\nsage: first == second\nFalse\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15090\n\n",
    "created_at": "2013-08-23T20:37:37Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "title": "Make random matrices respect Sage's seed for random number gnerators",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14853",
    "user": "rbeezer"
}
```
CC:  dimpase

GSL distributions are used in the creation of random matrices, so they need to be seeded with an integer from Sage's random number generators in order to make the results predictably random.  Then the random matrices will be reproducible for doctests (#10122) and for WeBWorK homework exercises provided by AskSage with a random seed from the WeBWorK system.  Symptomatic of the current state is:


```
sage: from sage.matrix.constructor import random_rref_matrix
sage: MS = MatrixSpace(QQ, 5, 8)

sage: set_random_seed(666)
sage: first = [random_rref_matrix(MS, 4) for _ in range(10)]

sage: set_random_seed(666)
sage: second = [random_rref_matrix(MS, 4) for _ in range(10)]

sage: first == second
False
```


Issue created by migration from https://trac.sagemath.org/ticket/15090





---

archive/issue_comments_189464.json:
```json
{
    "body": "Attachment [trac_15090-random-matrix-seeds.patch](tarball://root/attachments/some-uuid/ticket15090/trac_15090-random-matrix-seeds.patch) by rbeezer created at 2013-08-23 21:57:21",
    "created_at": "2013-08-23T21:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189464",
    "user": "rbeezer"
}
```

Attachment [trac_15090-random-matrix-seeds.patch](tarball://root/attachments/some-uuid/ticket15090/trac_15090-random-matrix-seeds.patch) by rbeezer created at 2013-08-23 21:57:21



---

archive/issue_comments_189465.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-23T21:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189465",
    "user": "rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_189466.json:
```json
{
    "body": "Update, standalone",
    "created_at": "2013-08-26T18:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189466",
    "user": "rbeezer"
}
```

Update, standalone



---

archive/issue_comments_189467.json:
```json
{
    "body": "Attachment [trac_15090-random-matrix-seeds-v2.patch](tarball://root/attachments/some-uuid/ticket15090/trac_15090-random-matrix-seeds-v2.patch) by rbeezer created at 2013-08-26 18:17:28\n\n\"v2\" patch is self-contained.  Minor parameter changes in new doctests which will better exercise fixes, and a few new comments with guidance about possible future code adjustments.  No new code.",
    "created_at": "2013-08-26T18:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189467",
    "user": "rbeezer"
}
```

Attachment [trac_15090-random-matrix-seeds-v2.patch](tarball://root/attachments/some-uuid/ticket15090/trac_15090-random-matrix-seeds-v2.patch) by rbeezer created at 2013-08-26 18:17:28

"v2" patch is self-contained.  Minor parameter changes in new doctests which will better exercise fixes, and a few new comments with guidance about possible future code adjustments.  No new code.



---

archive/issue_comments_189468.json:
```json
{
    "body": "I get some random_matrix doctests failing:\n\n\n```\n**********************************************************************\nFile \"constructor.py\", line 1175, in sage.matrix.constructor.random_matrix\nFailed example:\n    random_matrix(RR, 3, 4, density=0.66)\nExpected:\n    [ 0.000000000000000 -0.806696574554030 -0.693915509972359  0.000000000000000]\n    [ 0.629781664418083  0.000000000000000 -0.833709843116637  0.000000000000000]\n    [ 0.922346867410064  0.000000000000000  0.000000000000000 -0.940316454178921]\nGot:\n    [  0.000000000000000 -0.0929719759949936   0.676820913302280   0.000000000000000]\n    [ -0.741052529138296   0.000000000000000  -0.806696574554030   0.000000000000000]\n    [ -0.940316454178921   0.000000000000000   0.000000000000000  -0.614664118017468]\n**********************************************************************\nFile \"constructor.py\", line 1180, in sage.matrix.constructor.random_matrix\nFailed example:\n    A = random_matrix(ComplexField(32), 3, density=0.8, sparse=True); A\nExpected:\n    [                 0.000000000  0.399739209 + 0.909948633*I                  0.000000000]\n    [-0.361911424 - 0.455087671*I -0.687810605 + 0.460619713*I  0.625520058 - 0.360952012*I]\n    [                 0.000000000                  0.000000000 -0.162196416 - 0.193242896*I]\nGot:\n    [                 0.000000000  0.877097711 - 0.662290146*I                  0.000000000]\n    [0.700430447 + 0.0870635174*I  0.332155072 - 0.728572036*I -0.361911424 - 0.455087671*I]\n    [                 0.000000000                  0.000000000  0.577682751 - 0.276405104*I]\n```\n",
    "created_at": "2013-08-27T18:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189468",
    "user": "jason"
}
```

I get some random_matrix doctests failing:


```
**********************************************************************
File "constructor.py", line 1175, in sage.matrix.constructor.random_matrix
Failed example:
    random_matrix(RR, 3, 4, density=0.66)
Expected:
    [ 0.000000000000000 -0.806696574554030 -0.693915509972359  0.000000000000000]
    [ 0.629781664418083  0.000000000000000 -0.833709843116637  0.000000000000000]
    [ 0.922346867410064  0.000000000000000  0.000000000000000 -0.940316454178921]
Got:
    [  0.000000000000000 -0.0929719759949936   0.676820913302280   0.000000000000000]
    [ -0.741052529138296   0.000000000000000  -0.806696574554030   0.000000000000000]
    [ -0.940316454178921   0.000000000000000   0.000000000000000  -0.614664118017468]
**********************************************************************
File "constructor.py", line 1180, in sage.matrix.constructor.random_matrix
Failed example:
    A = random_matrix(ComplexField(32), 3, density=0.8, sparse=True); A
Expected:
    [                 0.000000000  0.399739209 + 0.909948633*I                  0.000000000]
    [-0.361911424 - 0.455087671*I -0.687810605 + 0.460619713*I  0.625520058 - 0.360952012*I]
    [                 0.000000000                  0.000000000 -0.162196416 - 0.193242896*I]
Got:
    [                 0.000000000  0.877097711 - 0.662290146*I                  0.000000000]
    [0.700430447 + 0.0870635174*I  0.332155072 - 0.728572036*I -0.361911424 - 0.455087671*I]
    [                 0.000000000                  0.000000000  0.577682751 - 0.276405104*I]
```




---

archive/issue_comments_189469.json:
```json
{
    "body": "On 5.11, I grabbed the dependency and this patch, built and tested with no problems whatever in any of it.  In particular `matrix/constructor.py` passes tests.\n\nI'd be willing to believe that new calls to the `randint` function would upset the sequence of random numbers **if** these tests came **after** some of the tests for echelonizable matrices, etc.  But that does not appear to be the case, so I can't see the problem.",
    "created_at": "2013-08-27T19:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189469",
    "user": "rbeezer"
}
```

On 5.11, I grabbed the dependency and this patch, built and tested with no problems whatever in any of it.  In particular `matrix/constructor.py` passes tests.

I'd be willing to believe that new calls to the `randint` function would upset the sequence of random numbers **if** these tests came **after** some of the tests for echelonizable matrices, etc.  But that does not appear to be the case, so I can't see the problem.



---

archive/issue_comments_189470.json:
```json
{
    "body": "#15887 fixes this issue.  Do not apply this patch (unless you want to just push the doctests into the library).",
    "created_at": "2014-03-05T02:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189470",
    "user": "jason"
}
```

#15887 fixes this issue.  Do not apply this patch (unless you want to just push the doctests into the library).



---

archive/issue_comments_189471.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-03-05T02:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189471",
    "user": "jason"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189472.json:
```json
{
    "body": "Agreed with Jason - fixed by #15887.",
    "created_at": "2014-10-21T22:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189472",
    "user": "novoselt"
}
```

Agreed with Jason - fixed by #15887.



---

archive/issue_comments_189473.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-21T22:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189473",
    "user": "novoselt"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_189474.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-27T16:26:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14853#issuecomment-189474",
    "user": "vbraun"
}
```

Resolution: fixed
