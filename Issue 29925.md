# Issue 29925: Make doctests accept Python 3.8.x respellings of some error messages

Issue created by migration from https://trac.sagemath.org/ticket/30162

Original creator: mkoeppe

Original creation time: 2020-07-17 02:05:34

CC:  jhpalmieri thansen chapoton arojas fbissey

From 
https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/u0-version-python-3.8.patch


---

Comment by mkoeppe created at 2020-07-17 02:22:51

New commits:


---

Comment by mkoeppe created at 2020-07-17 02:22:51

Changing status from new to needs_review.


---

Comment by arojas created at 2020-07-17 05:57:05

The one in `src/doc/en/faq/faq-usage.rst` is not a test, should be changed to one of the two variants but not to the wildcard IMO


---

Comment by git created at 2020-07-17 05:59:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-17 05:59:33

Thanks for catching this; fixed.


---

Comment by arojas created at 2020-07-17 06:18:39

Some errors need further wildcarding

```
File "src/sage/combinat/words/word.py", line 511, in sage.combinat.words.word.InfiniteWord_iter_with_caching
Failed example:
    dumps(w)
Expected:
    Traceback (most recent call last):
    ...
    TypeError: can...t pickle generator objects
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "sage/misc/persist.pyx", line 290, in sage.misc.persist.dumps (build/cythonized/sage/misc/persist.c:4285)
        return obj.dumps(compress)
      File "sage/structure/sage_object.pyx", line 476, in sage.structure.sage_object.SageObject.dumps (build/cythonized/sage/structure/sage_object.c:3788)
        return _base_dumps(self, compress=compress)
      File "sage/misc/persist.pyx", line 263, in sage.misc.persist._base_dumps (build/cythonized/sage/misc/persist.c:4013)
        gherkin = SagePickler.dumps(obj)
      File "sage/misc/persist.pyx", line 878, in sage.misc.persist.SagePickler.dumps (build/cythonized/sage/misc/persist.c:6802)
        pickler.dump(obj)
    TypeError: cannot pickle 'generator' object
```



---

Comment by arojas created at 2020-07-17 06:18:39

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-07-17 06:24:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-17 06:28:14

Changing status from needs_work to needs_review.


---

Comment by arojas created at 2020-07-17 06:41:57

Some further error message changes that you may want to address here (taken from my downstream patch):

```
diff --git a/src/sage/cpython/getattr.pyx b/src/sage/cpython/getattr.pyx
index 0e4f9a4969..54310a6e8c 100644
--- a/src/sage/cpython/getattr.pyx
+++ b/src/sage/cpython/getattr.pyx
@@ -319,7 +319,7 @@ cpdef getattr_from_other_class(self, cls, name):
         Traceback (most recent call last):
         ...
         TypeError: descriptor '__weakref__' for 'A' objects doesn't apply
-        to 'sage.rings.integer.Integer' object
+        to a 'sage.rings.integer.Integer' object
 
     When this occurs, an ``AttributeError`` is raised::
 
diff --git a/src/sage/cpython/wrapperdescr.pyx b/src/sage/cpython/wrapperdescr.pyx
index c25d955fa0..ba1092dd81 100644
--- a/src/sage/cpython/wrapperdescr.pyx
+++ b/src/sage/cpython/wrapperdescr.pyx
@@ -79,7 +79,7 @@ def wrapperdescr_call(slotwrapper, self, *args, **kwds):
         sage: wrapperdescr_call(Integer.__mul__, 1, 2, 3)
         Traceback (most recent call last):
         ...
-        TypeError: expected 1 arguments, got 2
+        TypeError: expected 1 argument, got 2
         sage: wrapperdescr_call(Integer.__mul__, 6, other=9)
         Traceback (most recent call last):
         ...
diff --git a/src/sage/repl/preparse.py b/src/sage/repl/preparse.py
index 6a9c2b4fe4..ab4a83ec83 100644
--- a/src/sage/repl/preparse.py
+++ b/src/sage/repl/preparse.py
@@ -804,7 +804,7 @@ def preparse_numeric_literals(code, extract=False):
         sage: 123__45 # py3
         Traceback (most recent call last):
         ...
-        SyntaxError: invalid token
+        SyntaxError: invalid decimal literal
 
         sage: preparse_numeric_literals('3040_1_')
         '3040_1_'
@@ -815,7 +815,7 @@ def preparse_numeric_literals(code, extract=False):
         sage: 3040_1_ # py3
         Traceback (most recent call last):
         ...
-        SyntaxError: invalid token
+        SyntaxError: invalid decimal literal
     """
     literals = {}
     last = 0
diff --git a/src/sage/sets/real_set.py b/src/sage/sets/real_set.py
index 537501f526..b6842fbcda 100644
--- a/src/sage/sets/real_set.py
+++ b/src/sage/sets/real_set.py
@@ -20,7 +20,7 @@ half-open intervals does not work::
     sage: RealSet([0,1))
     Traceback (most recent call last):
     ...
-    SyntaxError: invalid syntax
+    SyntaxError: closing parenthesis ')' does not match opening parenthesis '['
     
 Instead, you can use the following construction functions::
 
```



---

Comment by mkoeppe created at 2020-07-17 06:43:40

Thank you! Will do.


---

Comment by git created at 2020-07-17 06:48:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-19 15:19:44

The pyflakes warning is a flake. 
Otherwise green. Needs review


---

Comment by arojas created at 2020-07-19 15:29:02

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-07-19 16:31:41

Thanks!


---

Comment by vbraun created at 2020-07-28 22:32:14

Resolution: fixed
