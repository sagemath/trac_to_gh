# Issue 17406: Update scipy to 0.15

Issue created by migration from https://trac.sagemath.org/ticket/17643

Original creator: jpflori

Original creation time: 2015-01-16 10:28:42

http://sourceforge.net/projects/scipy/files/scipy/0.15.0/scipy-0.15.0.tar.gz/download


---

Comment by fbissey created at 2015-01-16 11:12:58

Didn't know it was out. Not in the Gentoo tree yet so I have no idea so far.


---

Comment by fbissey created at 2015-08-05 01:22:42

scipy 0.16.0 is out, one doctest broken:

```
sage -t --long usr/share/doc/sage/en/faq/faq-usage.rst
Running doctests with ID 2015-08-05-11-07-08-20037f0b.
Using --optional=optional,sage
Doctesting 1 file.
sage -t --long --warn-long 64.8 usr/share/doc/sage/en/faq/faq-usage.rst
**********************************************************************
File "usr/share/doc/sage/en/faq/faq-usage.rst", line 351, in faq-usage
Failed example:
    stats.ttest_ind(list([1,2,3,4,5]),list([2,3,4,5,.6]))
Expected:
    (array(0.07675295564533369), 0.94070490247380478)
Got:
    Ttest_indResult(statistic=array(0.07675295564533369), pvalue=0.94070490247380478)
**********************************************************************
1 item had failures:
   1 of  36 in faq-usage
    [24 tests, 1 failure, 0.68 s]
----------------------------------------------------------------------
sage -t --long --warn-long 64.8 usr/share/doc/sage/en/faq/faq-usage.rst  # 1 doctest failed
----------------------------------------------------------------------
```

this is on top of 6.9.beta0.


---

Comment by fbissey created at 2015-11-08 23:17:58

New commits:


---

Comment by git created at 2015-11-09 00:59:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-09 01:55:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-10 11:57:03

New branch compatible with the new push at #19556 coming soon.


---

Comment by fbissey created at 2015-11-10 22:33:53

New commits:


---

Comment by fbissey created at 2015-11-11 00:21:43

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-11-13 13:29:01

Just a confirmation that with the three tickets applied all tests pass (debian 64bits).

Could you replace

```
if np.array_equal(vert1, tpath.vertices) and np.array_equal(code1, tpath.codes):
     return True
else:
     return False
```

with

```
return np.array_equal(vert1, tpath.vertices) and np.array_equal(code1, tpath.codes)
```

Or there is a reason to let it as you did?


---

Comment by fbissey created at 2015-11-13 19:45:20

No reason I didn't do that. I was so focused in finding a replacement for that particular line (it took some effort for me) that I didn't realise the code could be streamlined. 
I will make the change your suggest in a few hours. Would you otherwise be happy to review positively the tickets?


---

Comment by git created at 2015-11-14 07:48:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-14 07:50:02

Replying to [comment:13 fbissey]:

> I will make the change your suggest in a few hours. Would you otherwise be happy to review positively the tickets?

All done.


---

Comment by vbraun created at 2015-11-22 21:08:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-11-23 06:32:47

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-11-23 06:32:47

Fails on arm

```
gfortran: error: unrecognized command line option '-msse2'
error: Command "gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -O2 -march=x86-64 -DMS_WIN64 -mtune=generic -msse2 -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -c -c scipy/fftpack/src/dfftpack/dfftf1.f -o build/temp.linux-armv7l-2.7/scipy/fftpack/src/dfftpack/dfftf1.o" failed with exit status 1
```

http://build.sagedev.org/release/builders/%20%20slow%20Oxford%20ARM%20%28Ubuntu%2012.10%29%20incremental/builds/327/steps/compile/logs/scipy


---

Comment by fbissey created at 2015-11-23 07:37:39

Serious fail from distutils

```
customize Gnu95FCompiler
customize Gnu95FCompiler using build_clib
building 'dfftpack' library
compiling Fortran sources
Fortran f77 compiler: gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -O2 -march=x86-64 -DMS_WIN64 -mtune=generic -msse2
Fortran f90 compiler: gfortran -Wall -g -fno-second-underscore -fPIC -O2 -march=x86-64 -DMS_WIN64 -mtune=generic -msse2
Fortran fix compiler: gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -fPIC -O2 -march=x86-64 -DMS_WIN64 -mtune=generic -msse2
```

arm being mistaken for windows64?


---

Comment by fbissey created at 2015-11-23 08:52:23

Looking around distros that provide `arm` support I am wondering how it was building on arm before. I think none of fedora, debian or gentoo have trouble with arm but they all pass `config_fc --noarch` to `setup.py` which was done at some point in sage but has been removed a while ago.

I note from [https://pkgs.fedoraproject.org/cgit/numpy.git/tree/numpy.spec](https://pkgs.fedoraproject.org/cgit/numpy.git/tree/numpy.spec)

```
* Wed Oct 14 2015 Thomas Spura <tomspur@fedoraproject.org> - 1:1.10.1-3
- Remove fortran flags or arm would build with -march=x86-64
```


I am guessing from this that the bug is recent but because everyone but `sage` passes `--noarch` it did go unnoticed in `scipy`. I'll add it and put this back to need_review.


---

Comment by git created at 2015-11-23 09:03:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-23 09:05:26

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2015-11-23 09:20:01

Can you report it somewhere upstream?


---

Comment by vbraun created at 2015-11-23 09:20:01

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-11-23 09:25:32

I'll look into it. I am guessing it is technically a bug in `numpy`'s distutils rather than `scipy` but I have no idea how to fix it or how it happens.


---

Comment by fbissey created at 2015-11-23 09:32:41

It looks like someone already acted in upstream `numpy`, I guess an option is to try to backport the commit in the `numpy` we ship.
[https://github.com/numpy/numpy/commit/a08437e12d6b6796f4b0beda49bce9adc37db63d](https://github.com/numpy/numpy/commit/a08437e12d6b6796f4b0beda49bce9adc37db63d)


---

Comment by jpflori created at 2015-11-23 09:47:48

I think I might have removed the `no_arch` stuff when I began to clean up the spkg mess.
Backporting the fix looks a good idea for a further ticket.
Or we just wait for a numpy version bump.


---

Comment by fbissey created at 2015-11-23 09:55:08

Replying to [comment:27 jpflori]:
> Backporting the fix looks a good idea for a further ticket.
> Or we just wait for a numpy version bump.
The danger with those two scenario is that the removal will be forgotten. However considering that everyone else has it with some variations (Gentoo has `noopt` and fedora has `fcompiler=gunf95` [or something]) I guess it doesn't hurt to keep it.


---

Comment by vbraun created at 2015-11-23 18:08:15

Resolution: fixed


---

Comment by fbissey created at 2015-11-23 20:14:48

I must say I spent a bit of my night worrying that it was the wrong fix. Good that it really works.


---

Comment by vbraun created at 2015-11-23 21:46:38

Changing status from closed to new.


---

Comment by vbraun created at 2015-11-23 21:46:38

Argh still doesn't work... http://build.sagedev.org/release/builders/%20%20slow%20Oxford%20ARM%20%28Ubuntu%2012.10%29%20incremental/builds/330/steps/compile/logs/scipy
----
Last 10 new commits:


---

Comment by vbraun created at 2015-11-23 21:46:38

Resolution changed from fixed to 


---

Comment by fbissey created at 2015-11-23 21:49:16

OK so I was right to worry it was the wrong fix. I'll remove the last commit on the scipy branch and add the upstream commit in `numpy`. I guess if I had gone for `noopt` instead of `noarch` it would have worked.


---

Comment by git created at 2015-11-23 21:51:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-23 22:03:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-23 22:07:01

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-11-24 13:01:14

Resolution: fixed
