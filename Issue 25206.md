# Issue 25206: bijections for set partitions

archive/issues_025206.json:
```json
{
    "body": "CC:  sage-combinat tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25443\n\n",
    "created_at": "2018-05-25T05:35:26Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "bijections for set partitions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25206",
    "user": "mantepse"
}
```
CC:  sage-combinat tscrim



Issue created by migration from https://trac.sagemath.org/ticket/25443





---

archive/issue_comments_355045.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2018-05-25T05:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355045",
    "user": "mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_355046.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-05-25T05:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355046",
    "user": "mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_355047.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-25T05:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355047",
    "user": "mantepse"
}
```

New commits:



---

archive/issue_comments_355048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T22:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355048",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355049.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-26T22:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355049",
    "user": "mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_355050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T22:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355050",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T23:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355051",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T23:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355052",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T23:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355053",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355054.json:
```json
{
    "body": "Could you update the ticket description?\n\nIn the methods `openers` and `closers`, why do you sort? (Note that you do not use these methods except in doctests in which you sort again)\n\nRook placement corresponds to position in a matrix. It is very unconvenient to have them start at 1...\n\nWhat does the following has to do with the ticket!?\n\n```\n+        sage: from sage.combinat.q_analogues import q_int\n+        sage: q = ZZ['q'].gen(); h = SymmetricFunctions(ZZ).h()\n+        sage: n = 6;\n+        sage: s = lambda k: {\"x%s\"%i: q_int(i+1) for i in range(k)}\n+        sage: all(q_stirling_number2(n,k) == q^binomial(k,2)*h[n-k].expand(k, s(k).keys()).subs(**s(k)) for k in range(1,n))\n+        True\n```\n\n\nInstead of things like `r = next(i for i,j in rooks if c == j)` you would better convert a rook placement into a dictionary `j -> i`.\n\nIn `from_rook_placement_gamma`, you would better use `set` rather than `list` and use the method `discard` for removing element.",
    "created_at": "2018-06-03T09:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355054",
    "user": "vdelecroix"
}
```

Could you update the ticket description?

In the methods `openers` and `closers`, why do you sort? (Note that you do not use these methods except in doctests in which you sort again)

Rook placement corresponds to position in a matrix. It is very unconvenient to have them start at 1...

What does the following has to do with the ticket!?

```
+        sage: from sage.combinat.q_analogues import q_int
+        sage: q = ZZ['q'].gen(); h = SymmetricFunctions(ZZ).h()
+        sage: n = 6;
+        sage: s = lambda k: {"x%s"%i: q_int(i+1) for i in range(k)}
+        sage: all(q_stirling_number2(n,k) == q^binomial(k,2)*h[n-k].expand(k, s(k).keys()).subs(**s(k)) for k in range(1,n))
+        True
```


Instead of things like `r = next(i for i,j in rooks if c == j)` you would better convert a rook placement into a dictionary `j -> i`.

In `from_rook_placement_gamma`, you would better use `set` rather than `list` and use the method `discard` for removing element.



---

archive/issue_comments_355055.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-17T09:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355055",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355056.json:
```json
{
    "body": "(I have actually done the modifications, but was mostly without internet for the last two weeks)",
    "created_at": "2018-06-18T06:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355056",
    "user": "mantepse"
}
```

(I have actually done the modifications, but was mostly without internet for the last two weeks)



---

archive/issue_comments_355057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355057",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355058.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-19T15:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355058",
    "user": "mantepse"
}
```

New commits:



---

archive/issue_comments_355059.json:
```json
{
    "body": "Hi Vincent!\n\n> In the methods `openers` and `closers`, why do you sort? (Note that you do not use these methods except in doctests in which you sort again)\n\nI think of these as convenience methods for the user, so sorting seemed appropriate to me.  I wouldn't use them in library code, because there is little to be gained. In the doctest I have to sort again, because I am adding other elements.\n\nI won't insist: I can remove the sorting, too.\n\n> Rook placement corresponds to position in a matrix. It is very unconvenient to have them start at 1...\n\nThis is something I actually thought about for quite some time, with no really good conclusion.  There are several ways to turn a set partition into a rook placement, the most common is to take the set of arcs.  Most but not all papers think of a rook placement corresponding to a set partition as an upper triangular matrix, so that's the convention I followed.\n\nThe entries of the set partitions in sage are {1,...,n}, so I would have to subtract 1 from each entry.  Are you sure that this is more convenient in the end?  I think most of the time the user is going to convert from arc-like things, but I don't know.  I think `from_arcs` is convenient, should I simply add another method `from_rook_placement_arcs`, which is zero-based?\n\nI followed all your other comments and found them very good!",
    "created_at": "2018-06-19T15:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355059",
    "user": "mantepse"
}
```

Hi Vincent!

> In the methods `openers` and `closers`, why do you sort? (Note that you do not use these methods except in doctests in which you sort again)

I think of these as convenience methods for the user, so sorting seemed appropriate to me.  I wouldn't use them in library code, because there is little to be gained. In the doctest I have to sort again, because I am adding other elements.

I won't insist: I can remove the sorting, too.

> Rook placement corresponds to position in a matrix. It is very unconvenient to have them start at 1...

This is something I actually thought about for quite some time, with no really good conclusion.  There are several ways to turn a set partition into a rook placement, the most common is to take the set of arcs.  Most but not all papers think of a rook placement corresponding to a set partition as an upper triangular matrix, so that's the convention I followed.

The entries of the set partitions in sage are {1,...,n}, so I would have to subtract 1 from each entry.  Are you sure that this is more convenient in the end?  I think most of the time the user is going to convert from arc-like things, but I don't know.  I think `from_arcs` is convenient, should I simply add another method `from_rook_placement_arcs`, which is zero-based?

I followed all your other comments and found them very good!



---

archive/issue_comments_355060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355061.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-19T15:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355061",
    "user": "mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355062.json:
```json
{
    "body": "New commits:\n----\nNew commits:",
    "created_at": "2018-06-19T15:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355062",
    "user": "mantepse"
}
```

New commits:
----
New commits:



---

archive/issue_comments_355063.json:
```json
{
    "body": "Perhaps it does not matter so much, but what you do in `to_restricted_growth_word_blocks` is quite inefficient\n\n```\n[next(i for i, B in enumerate(self) if j in B) for j in range(1, self.size()+1)]\n```\n\nYou would better use the linear time\n\n```\nl = [0] * self.size()\nfor i,B in enumerate(S):\n    for j in B:\n        l[j-1] = i\n```\n\n(here agin the shift in indices `j-1` quite frustrating)",
    "created_at": "2018-06-19T21:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355063",
    "user": "vdelecroix"
}
```

Perhaps it does not matter so much, but what you do in `to_restricted_growth_word_blocks` is quite inefficient

```
[next(i for i, B in enumerate(self) if j in B) for j in range(1, self.size()+1)]
```

You would better use the linear time

```
l = [0] * self.size()
for i,B in enumerate(S):
    for j in B:
        l[j-1] = i
```

(here agin the shift in indices `j-1` quite frustrating)



---

archive/issue_comments_355064.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-20T05:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355064",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355065.json:
```json
{
    "body": "ping?",
    "created_at": "2018-08-26T22:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355065",
    "user": "mantepse"
}
```

ping?



---

archive/issue_comments_355066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-20T03:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355066",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355067.json:
```json
{
    "body": "Marta Yip's article has been published: http://www.combinatorics.org/ojs/index.php/eljc/article/view/v25i1p68.\n\nBeside, if the code does what you expect it to do, I would have one brief final look...",
    "created_at": "2018-11-20T11:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355067",
    "user": "stumpc5"
}
```

Marta Yip's article has been published: http://www.combinatorics.org/ojs/index.php/eljc/article/view/v25i1p68.

Beside, if the code does what you expect it to do, I would have one brief final look...



---

archive/issue_comments_355068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-20T12:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355068",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355069.json:
```json
{
    "body": "Done!",
    "created_at": "2018-11-20T12:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355069",
    "user": "mantepse"
}
```

Done!



---

archive/issue_comments_355070.json:
```json
{
    "body": "> # we can assume that the blocks are sorted by minimal element\n\nThe constructor of set partitions does not promise this property. I am not sure it is worth assuming it and then getting into trouble in 10 years from now because someone changed the implementation (or factored this code out into a category).",
    "created_at": "2018-11-20T12:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355070",
    "user": "stumpc5"
}
```

> # we can assume that the blocks are sorted by minimal element

The constructor of set partitions does not promise this property. I am not sure it is worth assuming it and then getting into trouble in 10 years from now because someone changed the implementation (or factored this code out into a category).



---

archive/issue_comments_355071.json:
```json
{
    "body": "I can replace\n\n```\n        for i, B in enumerate(self):\n```\n\nwith\n\n```\n        for i, B in enumerate(sorted(self, key=min)):\n```\n\nbut I would be surprised if this isn't used outside of the new code, too.\n\nDo you want me to make this change?",
    "created_at": "2018-11-20T12:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355071",
    "user": "mantepse"
}
```

I can replace

```
        for i, B in enumerate(self):
```

with

```
        for i, B in enumerate(sorted(self, key=min)):
```

but I would be surprised if this isn't used outside of the new code, too.

Do you want me to make this change?



---

archive/issue_comments_355072.json:
```json
{
    "body": "I agree that this is probably done already somewhere. The question is just if you want to rely on this property that is not promised to hold. You decide.",
    "created_at": "2018-11-20T12:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355072",
    "user": "stumpc5"
}
```

I agree that this is probably done already somewhere. The question is just if you want to rely on this property that is not promised to hold. You decide.



---

archive/issue_comments_355073.json:
```json
{
    "body": "Out of curiosity I tried what happens if I do not sort by minimal element in `SetPartition.__init__` (but do so only in `_repr_`).  Surprisingly, except for equality of set partitions, there are not so many failures.\n\nHowever, I wonder where would you document that the internal representation keeps the blocks sorted by minimal element?  Would you put it into the docstring of `__init__`?",
    "created_at": "2018-11-20T13:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355073",
    "user": "mantepse"
}
```

Out of curiosity I tried what happens if I do not sort by minimal element in `SetPartition.__init__` (but do so only in `_repr_`).  Surprisingly, except for equality of set partitions, there are not so many failures.

However, I wonder where would you document that the internal representation keeps the blocks sorted by minimal element?  Would you put it into the docstring of `__init__`?



---

archive/issue_comments_355074.json:
```json
{
    "body": "Maybe yes, into `__init__`. I do think it should be clarified *somewhere* whether or not `__iter__` promises anything about the order of the iterator.\n\nThis sorting is also assumed elsewhere, such as\n\n```\ndef standard_form(self):\n    return [sorted(_) for _ in self]\n```\n\nwhich only makes sense if self is sorted already.\n\nSince this sorting is also used in other places, would you add a promise into the `__init__` so that everyone can rely on it ?",
    "created_at": "2018-11-20T13:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355074",
    "user": "stumpc5"
}
```

Maybe yes, into `__init__`. I do think it should be clarified *somewhere* whether or not `__iter__` promises anything about the order of the iterator.

This sorting is also assumed elsewhere, such as

```
def standard_form(self):
    return [sorted(_) for _ in self]
```

which only makes sense if self is sorted already.

Since this sorting is also used in other places, would you add a promise into the `__init__` so that everyone can rely on it ?



---

archive/issue_comments_355075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-20T13:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355075",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355076.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-21T10:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355076",
    "user": "stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355077.json:
```json
{
    "body": "okay, I think it's ready to go",
    "created_at": "2018-11-21T10:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355077",
    "user": "stumpc5"
}
```

okay, I think it's ready to go



---

archive/issue_comments_355078.json:
```json
{
    "body": "Many thanks!",
    "created_at": "2018-11-21T11:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355078",
    "user": "mantepse"
}
```

Many thanks!



---

archive/issue_comments_355079.json:
```json
{
    "body": "Reviewer name.",
    "created_at": "2018-11-21T15:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355079",
    "user": "tscrim"
}
```

Reviewer name.



---

archive/issue_comments_355080.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-11-21T15:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355080",
    "user": "tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_355081.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-11-21T16:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355081",
    "user": "stumpc5"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_355082.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-22T21:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25206#issuecomment-355082",
    "user": "vbraun"
}
```

Resolution: fixed
