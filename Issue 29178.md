# Issue 29178: tox.ini: Add environment local-conda

archive/issues_029178.json:
```json
{
    "body": "CC:  dimpase jhpalmieri isuruf saraedum @kliem\n\nThis environment would create and use an isolated conda installation within the tox environment directory,\nsimilar to `local-homebrew`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29415\n\n",
    "created_at": "2020-03-27T15:24:09Z",
    "labels": [
        "porting",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "tox.ini: Add environment local-conda",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29178",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri isuruf saraedum @kliem

This environment would create and use an isolated conda installation within the tox environment directory,
similar to `local-homebrew`.

Issue created by migration from https://trac.sagemath.org/ticket/29415





---

archive/issue_comments_413361.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413361",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_413362.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413362",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_413363.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-29T02:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413363",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_413364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-29T03:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413364",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_413365.json:
```json
{
    "body": "Rebased on 9.1.beta9+#29087",
    "created_at": "2020-03-29T03:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413365",
    "user": "mkoeppe"
}
```

Rebased on 9.1.beta9+#29087



---

archive/issue_comments_413366.json:
```json
{
    "body": "Needs testing, in particular on Linux",
    "created_at": "2020-03-30T18:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413366",
    "user": "mkoeppe"
}
```

Needs testing, in particular on Linux



---

archive/issue_comments_413367.json:
```json
{
    "body": "I end up with a C++ error in Singular\n\n```\nlibtool: compile:  /home/dimpase/sage/.tox/local-conda-forge-standard/conda/bin/x86_64-conda_cos6-linux-gnu-c++ -DHAVE_CONFIG_H -I. -I.\n./../.. -I. -I../../.. -I../../.. -I../../../libpolys -I../../../libpolys -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src/factory/include -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -pthread -DDYNAMIC_VERSION -DGMPRATIONAL -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -O2 -g -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-delete-null-pointer-checks -fno-rtti -fexceptions -frtti -c groebnerCone.cc  -fPIC -DPIC -o .libs/gfanlib_la-groebnerCone.o\ngroebnerCone.cc:428:58: error: no 'bool groebnerCone::pointsOutwards(gfan::ZVector) const' member function declared in class 'groebnerCone'\n bool groebnerCone::pointsOutwards(const gfan::ZVector w) const\n                                                          ^~~~~\ngroebnerCone.cc: In member function 'groebnerCones groebnerCone::tropicalNeighbours() const':\ngroebnerCone.cc:449:13: error: 'pointsOutwards' was not declared in this scope\n         if (pointsOutwards(ray[j]))\n             ^~~~~~~~~~~~~~\nmake[9]: *** [Makefile:726: gfanlib_la-groebnerCone.lo] Error 1\n```\n\n\nthis is on Debian, and might be due to using gfan from the system.",
    "created_at": "2020-03-31T04:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413367",
    "user": "dimpase"
}
```

I end up with a C++ error in Singular

```
libtool: compile:  /home/dimpase/sage/.tox/local-conda-forge-standard/conda/bin/x86_64-conda_cos6-linux-gnu-c++ -DHAVE_CONFIG_H -I. -I.
./../.. -I. -I../../.. -I../../.. -I../../../libpolys -I../../../libpolys -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src/factory/include -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -pthread -DDYNAMIC_VERSION -DGMPRATIONAL -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -O2 -g -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-delete-null-pointer-checks -fno-rtti -fexceptions -frtti -c groebnerCone.cc  -fPIC -DPIC -o .libs/gfanlib_la-groebnerCone.o
groebnerCone.cc:428:58: error: no 'bool groebnerCone::pointsOutwards(gfan::ZVector) const' member function declared in class 'groebnerCone'
 bool groebnerCone::pointsOutwards(const gfan::ZVector w) const
                                                          ^~~~~
groebnerCone.cc: In member function 'groebnerCones groebnerCone::tropicalNeighbours() const':
groebnerCone.cc:449:13: error: 'pointsOutwards' was not declared in this scope
         if (pointsOutwards(ray[j]))
             ^~~~~~~~~~~~~~
make[9]: *** [Makefile:726: gfanlib_la-groebnerCone.lo] Error 1
```


this is on Debian, and might be due to using gfan from the system.



---

archive/issue_comments_413368.json:
```json
{
    "body": "This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6\n\nA workaround is to do `export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"` in Singular build script.",
    "created_at": "2020-03-31T04:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413368",
    "user": "isuruf"
}
```

This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6

A workaround is to do `export CPPFLAGS="$CPPFLAGS -UNDEBUG"` in Singular build script.



---

archive/issue_comments_413369.json:
```json
{
    "body": "should we upgrade Sage's singular?",
    "created_at": "2020-03-31T07:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413369",
    "user": "dimpase"
}
```

should we upgrade Sage's singular?



---

archive/issue_comments_413370.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> should we upgrade Sage's singular?\nThat's #25993.",
    "created_at": "2020-03-31T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413370",
    "user": "mkoeppe"
}
```

Replying to [comment:11 dimpase]:
> should we upgrade Sage's singular?
That's #25993.



---

archive/issue_comments_413371.json:
```json
{
    "body": "I also see a failure (testing with #29417):\n\n- `local-conda-forge-macos-standard`: \n\n```\n  [dochtml]       from sage.symbolic.all   import *\n  [dochtml]     File \"/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py\", line 3, in <module>\n  [dochtml]       from sage.libs.pynac.pynac import I\n  [dochtml]     File \"sage/symbolic/expression.pxd\", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)\n   [dochtml]     File \"sage/symbolic/expression.pyx\", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)\n  [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb\n  [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n  [dochtml]     Expected in: flat namespace\n  [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n```\n\n(this is with #29404 -- should take another look)",
    "created_at": "2020-03-31T11:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413371",
    "user": "mkoeppe"
}
```

I also see a failure (testing with #29417):

- `local-conda-forge-macos-standard`: 

```
  [dochtml]       from sage.symbolic.all   import *
  [dochtml]     File "/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py", line 3, in <module>
  [dochtml]       from sage.libs.pynac.pynac import I
  [dochtml]     File "sage/symbolic/expression.pxd", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)
   [dochtml]     File "sage/symbolic/expression.pyx", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)
  [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb
  [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
  [dochtml]     Expected in: flat namespace
  [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
```

(this is with #29404 -- should take another look)



---

archive/issue_comments_413372.json:
```json
{
    "body": "In any case, the present ticket is about adding the testing framework for local-conda, which appears to work. Needs review.",
    "created_at": "2020-03-31T12:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413372",
    "user": "mkoeppe"
}
```

In any case, the present ticket is about adding the testing framework for local-conda, which appears to work. Needs review.



---

archive/issue_comments_413373.json:
```json
{
    "body": "Shameless plug. Use miniforge instead of miniconda?",
    "created_at": "2020-03-31T16:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413373",
    "user": "isuruf"
}
```

Shameless plug. Use miniforge instead of miniconda?



---

archive/issue_comments_413374.json:
```json
{
    "body": "Replying to [comment:16 isuruf]:\n> Shameless plug. Use miniforge instead of miniconda?\nJust tried it and it behaves a bit different from miniconda:\n\n```\nlocal-macos-conda-forge-standard-python2 run-test-pre: commands[6] | bash -c '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda update -n base --yes conda'\nTraceback (most recent call last):\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda\", line 12, in <module>\n    from conda.cli import main\nModuleNotFoundError: No module named 'conda'\n```\n\nDo I need to activate the environment before using that?",
    "created_at": "2020-03-31T17:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413374",
    "user": "mkoeppe"
}
```

Replying to [comment:16 isuruf]:
> Shameless plug. Use miniforge instead of miniconda?
Just tried it and it behaves a bit different from miniconda:

```
local-macos-conda-forge-standard-python2 run-test-pre: commands[6] | bash -c '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda update -n base --yes conda'
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda", line 12, in <module>
    from conda.cli import main
ModuleNotFoundError: No module named 'conda'
```

Do I need to activate the environment before using that?



---

archive/issue_comments_413375.json:
```json
{
    "body": "Replying to [comment:10 isuruf]:\n> This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6\n> \n> A workaround is to do `export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"` in Singular build script.\n\nBecause the singular upgrade (#25993) will not be ready for 9.1, I have opened #29438 for this",
    "created_at": "2020-03-31T17:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413375",
    "user": "mkoeppe"
}
```

Replying to [comment:10 isuruf]:
> This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6
> 
> A workaround is to do `export CPPFLAGS="$CPPFLAGS -UNDEBUG"` in Singular build script.

Because the singular upgrade (#25993) will not be ready for 9.1, I have opened #29438 for this



---

archive/issue_comments_413376.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> Do I need to activate the environment before using that?\n\nYes, but even miniconda needs activation.",
    "created_at": "2020-03-31T17:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413376",
    "user": "isuruf"
}
```

Replying to [comment:17 mkoeppe]:
> Do I need to activate the environment before using that?

Yes, but even miniconda needs activation.



---

archive/issue_comments_413377.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-31T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413377",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_413378.json:
```json
{
    "body": "Attachment [openblas.log](tarball://root/attachments/some-uuid/ticket29415/openblas.log) by @kliem created at 2020-04-01 09:19:02",
    "created_at": "2020-04-01T09:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413378",
    "user": "@kliem"
}
```

Attachment [openblas.log](tarball://root/attachments/some-uuid/ticket29415/openblas.log) by @kliem created at 2020-04-01 09:19:02



---

archive/issue_comments_413379.json:
```json
{
    "body": "I guess it works in the way that it doesn't work.\n\n\n```\n* package:         openblas-0.3.6.p0\n  last build time: Apr 1 10:54\n  log file:        /srv/public/kliem/sage/logs/pkgs/openblas-0.3.6.p0.log\n  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/openblas-0.3.6.p0                                                               \n\n* package:         singular-4.1.1p2.p0\n  last build time: Apr 1 11:00\n  log file:        /srv/public/kliem/sage/logs/pkgs/singular-4.1.1p2.p0.log\n  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0                                                             \n\n```\n\n\nI attached the logs.",
    "created_at": "2020-04-01T09:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413379",
    "user": "@kliem"
}
```

I guess it works in the way that it doesn't work.


```
* package:         openblas-0.3.6.p0
  last build time: Apr 1 10:54
  log file:        /srv/public/kliem/sage/logs/pkgs/openblas-0.3.6.p0.log
  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/openblas-0.3.6.p0                                                               

* package:         singular-4.1.1p2.p0
  last build time: Apr 1 11:00
  log file:        /srv/public/kliem/sage/logs/pkgs/singular-4.1.1p2.p0.log
  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0                                                             

```


I attached the logs.



---

archive/issue_comments_413380.json:
```json
{
    "body": "Singular might need the fix proposed by Isuru above",
    "created_at": "2020-04-01T09:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413380",
    "user": "dimpase"
}
```

Singular might need the fix proposed by Isuru above



---

archive/issue_comments_413381.json:
```json
{
    "body": "I'm not sure that I understand.\n\nAt least this here did not fix the problem.\n\n```\n+++ b/build/pkgs/singular/spkg-install.in\n@@ -19,6 +19,7 @@ else\n fi\n \n export CFLAGS CXXFLAGS\n+export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"\n \n \n remove_old_version()\n```\n\n\nNow openblas, tachyon, m4ri, givaro, ecm, python3, giac, singular fail to install.",
    "created_at": "2020-04-01T12:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413381",
    "user": "@kliem"
}
```

I'm not sure that I understand.

At least this here did not fix the problem.

```
+++ b/build/pkgs/singular/spkg-install.in
@@ -19,6 +19,7 @@ else
 fi
 
 export CFLAGS CXXFLAGS
+export CPPFLAGS="$CPPFLAGS -UNDEBUG"
 
 
 remove_old_version()
```


Now openblas, tachyon, m4ri, givaro, ecm, python3, giac, singular fail to install.



---

archive/issue_comments_413382.json:
```json
{
    "body": "Singular fixes - please on  #29438, not here",
    "created_at": "2020-04-01T13:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413382",
    "user": "mkoeppe"
}
```

Singular fixes - please on  #29438, not here



---

archive/issue_comments_413383.json:
```json
{
    "body": "This ticket is about adding the testing environment for conda, not fixing everything that may be broken in the conda build",
    "created_at": "2020-04-01T13:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413383",
    "user": "mkoeppe"
}
```

This ticket is about adding the testing environment for conda, not fixing everything that may be broken in the conda build



---

archive/issue_comments_413384.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-03T16:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413384",
    "user": "isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413385.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-04-03T16:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413385",
    "user": "mkoeppe"
}
```

Thank you.



---

archive/issue_comments_413386.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-09T22:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413386",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_413387.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> I also see a failure (testing with #29417):\n> \n> - `local-conda-forge-macos-standard`: \n> {{{\n>   [dochtml]       from sage.symbolic.all   import *\n>   [dochtml]     File \"/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py\", line 3, in <module>\n>   [dochtml]       from sage.libs.pynac.pynac import I\n>   [dochtml]     File \"sage/symbolic/expression.pxd\", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)\n>    [dochtml]     File \"sage/symbolic/expression.pyx\", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)\n>   [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb\n>   [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n>   [dochtml]     Expected in: flat namespace\n>   [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n> }}}\n> (this is with #29404 -- should take another look)\n\nThis is now #29574",
    "created_at": "2020-04-25T03:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29178#issuecomment-413387",
    "user": "mkoeppe"
}
```

Replying to [comment:13 mkoeppe]:
> I also see a failure (testing with #29417):
> 
> - `local-conda-forge-macos-standard`: 
> {{{
>   [dochtml]       from sage.symbolic.all   import *
>   [dochtml]     File "/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py", line 3, in <module>
>   [dochtml]       from sage.libs.pynac.pynac import I
>   [dochtml]     File "sage/symbolic/expression.pxd", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)
>    [dochtml]     File "sage/symbolic/expression.pyx", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)
>   [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb
>   [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
>   [dochtml]     Expected in: flat namespace
>   [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
> }}}
> (this is with #29404 -- should take another look)

This is now #29574
