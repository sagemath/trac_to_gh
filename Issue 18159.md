# Issue 18159: Handle substitutions of partial sums and products

Issue created by migration from https://trac.sagemath.org/ticket/18396

Original creator: vdelecroix

Original creation time: 2015-05-10 16:21:49

CC:  mjo mmezzarobba

Sage is not able to identify partial sum in a substitution

```
sage: var('x,y,z')
sage: f = x^4 + x^2 + x
sage: f.subs(x^4 + x^2 == y)
x^4 + x^2 + x
```

Similarly with products

```
sage: f = x * cos(x) * sin(x)
sage: f.subs( cos(x) * sin(x) == y)
x*cos(x)*sin(x)
```


As mentioned in the doc, this is the same behavior as in Maple but differ from Mathematica. We should be clearer on the semantic of `substitute` and potentially implement partial sum and product substitutions.


---

Comment by nbruin created at 2015-05-10 16:47:22

I'm not so sure we have to do more than document it. Obviously you cannot expect substitutions to happen on any "equal" subexpression, since that concept isn't well-defined.

The thing is: `x+x^2` isn't a syntactical subunit of `x + x^2 + x^4` for the internal representation, which is roughly `('+',x,('^',x,2))` versus `('+',x,('<sup>',x,2),('</sup>',x,4))`

You'll have to decide how much tricks are worthwhile to implement before you just add the relation `y-(x^2+x)` and ask for elimination of x via groebner bases.


---

Comment by vdelecroix created at 2015-05-10 18:52:47

Replying to [comment:2 nbruin]:
> I'm not so sure we have to do more than document it. Obviously you cannot expect substitutions to happen on any "equal" subexpression, since that concept isn't well-defined.

I do not want to substitute "equal" subexpression but only identical ones. And doing so, I want to consider 'a+c' as a unit of 'a+b+c+d' and 'a*c' as a unit in 'a*b*c*d'. This is perhaps not desirable though.

> The thing is: `x+x^2` isn't a syntactical subunit of `x + x^2 + x^4` for the internal representation, which is roughly `('+',x,('^',x,2))` versus `('+',x,('<sup>',x,2),('</sup>',x,4))`

I know, and this is precisely the purpose of the ticket.

> You'll have to decide how much tricks are worthwhile to implement before you just add the relation `y-(x^2+x)` and ask for elimination of x via groebner bases.

Note that `x + y - (u + v)` does not exist. But I agree that there is an ambiguous `+/-` issue (as far as the ticket description is concerned).


---

Comment by rws created at 2017-08-10 13:19:05

However, even the `whole matching` does not work consistently. See https://github.com/pynac/pynac/issues/269
