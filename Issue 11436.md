# Issue 11436: RDF/CDF eigenvalues: symmetric matrices, multiplicities

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2011-07-18 02:39:26

Assignee: jason, was

CC:  jason

As the summary says, this patch improves eigenvalues of matrices with double-precision floating-point entries.

  1. Uses SciPy's `eigh` routine for symmetric and Hermitian matrices.
  1. Allows grouping of "equal" eigenvalues, based on a tolerance parameter.


---

Comment by rbeezer created at 2011-07-18 02:48:58

Changing status from new to needs_review.


---

Comment by davidloeffler created at 2012-03-13 01:53:59

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2012-03-13 01:53:59

Patch does not apply to 5.0.beta7 (see patchbot logs)


---

Attachment

Rebased on 5.0-beta10


---

Comment by rbeezer created at 2012-05-03 06:03:12

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2012-05-04 18:21:00

it's kind of weird that one coerces a complex matrix into real symmetric, but then treats it as a Hermitian one...
Surely with real symmetric matrices there might be better options, no?


---

Comment by vbraun created at 2012-05-04 18:28:38

Despite the name, `scipy.linalg.eigh` will call lapack `syevr` / `heevr` depending on whether the field is real / complex.


---

Comment by rbeezer created at 2012-05-04 18:50:55

The `algorithm='symmetric'` keyword is meant to allow the routine accomodate both base rings (RDF/CDF) while also allowing a user to specify that a matrix is known to be symmetric.  In this case, the conversion from CDF to RDF is made by the routine and then the SciPy behavior that Volker notes will take place.

Any suggestions on making the docstring clearer?  Maybe saying "then applies the algorithm for Hermitian matrices" should be stated differently?


---

Comment by vbraun created at 2012-05-05 03:20:54

On Fedora 16 x86_64, I get

```
sage -t  devel/sage-main/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "/home/vbraun/opt/sage-5.0.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1570:
    sage: A.eigenvalues(algorithm='symmetric', tol=1.0e-20)
Expected:
    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (3.0, 1)]
Got:
    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 2), (1.0, 1), (3.0, 1)]
```

ATLAS is from Fedora, CPU is a Sandy-Bridge i7 quad-core. 

Minor nitpicks while we are at it:
  * Can you return a tuple (=immutable) instead of a list?
  * the symmetric docstring, how about: "converts `self` to a real matrix and applies the algorithm for Hermitian matrices". Note: technically you convert (explicit), not coerce (implicit).
  * in the hermitian docstring, how about: "uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...". This would make it clear that the `syevr` implementation is used if possible.
  * the ".. warning::" block is not indented, so it is not typeset correctly.


---

Comment by vbraun created at 2012-05-05 03:20:54

Changing status from needs_review to needs_work.


---

Comment by rbeezer created at 2012-05-05 03:48:20

Replying to [comment:8 vbraun]:
> On Fedora 16 x86_64, I get...

Thanks, I'll increase the tolerance and that should work better across platforms.  You'd think I'd get the hang of this numerical stuff...


> Minor nitpicks while we are at it:
>   * Can you return a tuple (=immutable) instead of a list?

I'm not opposed, but other eigenvalue routines return mutable objects.  I'd prefer to do one grand change across all matrix types, on a single-purpose ticket of its own.


```
sage: A = matrix(QQ, [This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro))
sage: ev=A.eigenvalues()   
sage: type(ev)
<class 'sage.structure.sequence.Sequence_generic'>
sage: ev[0]=5
sage: ev
[5]
```


>   * the symmetric docstring, how about: "converts `self` to a real matrix and applies the algorithm for Hermitian matrices". Note: technically you convert (explicit), not coerce (implicit).
>   * in the hermitian docstring, how about: "uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...". This would make it clear that the `syevr` implementation is used if possible.
>   * the ".. warning::" block is not indented, so it is not typeset correctly.

Thanks for the nits.  I'll make some changes right now.

Rob


---

Comment by rbeezer created at 2012-05-05 04:32:52

"Update" patch:

  1. Removes the `10^-20` tolerance doctest.  Not really needed and will only cause trouble. (It was suppose to illustrate how a very small tolerance would split up "equal" eigenvalues.)
  1. Adjusts documentation according to suggestions above.
  1. Includes new pointers to routines to check symmetric and Hermitian properties.
  1. No code changes.

Rob


---

Comment by rbeezer created at 2012-05-05 04:32:52

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2012-05-05 16:35:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-05-05 16:35:30

Looks great!


---

Comment by rbeezer created at 2012-05-05 20:21:56

Replying to [comment:11 vbraun]:
> Looks great!

Thanks, Volker!

This was built on various 5.0-beta's, so I just double-checked that it applies, tests and builds on 5.0-rc0.

Rob


---

Comment by jdemeyer created at 2012-05-07 06:42:06

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-05-07 06:42:06

The `warning` in the docstring is misformatted, see [http://sagemath.org/doc/developer/conventions.html#documentation-strings](http://sagemath.org/doc/developer/conventions.html#documentation-strings)


---

Comment by rbeezer created at 2012-05-24 21:41:44

Changing status from needs_work to positive_review.


---

Attachment

I thought this was OK and I just triple-checked, and I think it is OK.  One change: made "warning" all capital letters, this is the only change to the v2 version of the update patch.

The HTML documentation renders the warning blocks as they should.  I'm going to move this back to positive review.

Jeroen - please let me know if I am really missing something here.  Thanks.

Rob


---

Comment by jdemeyer created at 2012-05-27 04:05:02

Changing keywords from "" to "sd40.5".


---

Comment by jdemeyer created at 2012-05-27 04:05:02

Yes, it looks okay now.  I don't remember what precisely was wrong before.


---

Comment by jdemeyer created at 2012-06-14 06:38:12

Resolution: fixed
