# Issue 11436: RDF/CDF eigenvalues: symmetric matrices, multiplicities

archive/issues_011436.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @jasongrout\n\nAs the summary says, this patch improves eigenvalues of matrices with double-precision floating-point entries.\n\n1. Uses SciPy's `eigh` routine for symmetric and Hermitian matrices.\n2. Allows grouping of \"equal\" eigenvalues, based on a tolerance parameter.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11608\n\n",
    "created_at": "2011-07-18T02:39:26Z",
    "labels": [
        "component: linear algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "RDF/CDF eigenvalues: symmetric matrices, multiplicities",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11436",
    "user": "https://github.com/rbeezer"
}
```
Assignee: jason, was

CC:  @jasongrout

As the summary says, this patch improves eigenvalues of matrices with double-precision floating-point entries.

1. Uses SciPy's `eigh` routine for symmetric and Hermitian matrices.
2. Allows grouping of "equal" eigenvalues, based on a tolerance parameter.

Issue created by migration from https://trac.sagemath.org/ticket/11608





---

archive/issue_comments_127426.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-18T02:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127426",
    "user": "https://github.com/rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127427.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-13T01:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127427",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127428.json:
```json
{
    "body": "Patch does not apply to 5.0.beta7 (see patchbot logs)",
    "created_at": "2012-03-13T01:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127428",
    "user": "https://github.com/loefflerd"
}
```

Patch does not apply to 5.0.beta7 (see patchbot logs)



---

archive/issue_comments_127429.json:
```json
{
    "body": "Attachment [trac_11608-eigenvalues-symmetric-multiplicity-rebase.patch](tarball://root/attachments/some-uuid/ticket11608/trac_11608-eigenvalues-symmetric-multiplicity-rebase.patch) by @rbeezer created at 2012-05-03 06:01:16\n\nRebased on 5.0-beta10",
    "created_at": "2012-05-03T06:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127429",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11608-eigenvalues-symmetric-multiplicity-rebase.patch](tarball://root/attachments/some-uuid/ticket11608/trac_11608-eigenvalues-symmetric-multiplicity-rebase.patch) by @rbeezer created at 2012-05-03 06:01:16

Rebased on 5.0-beta10



---

archive/issue_comments_127430.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-03T06:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127430",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127431.json:
```json
{
    "body": "it's kind of weird that one coerces a complex matrix into real symmetric, but then treats it as a Hermitian one...\nSurely with real symmetric matrices there might be better options, no?",
    "created_at": "2012-05-04T18:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127431",
    "user": "https://github.com/dimpase"
}
```

it's kind of weird that one coerces a complex matrix into real symmetric, but then treats it as a Hermitian one...
Surely with real symmetric matrices there might be better options, no?



---

archive/issue_comments_127432.json:
```json
{
    "body": "Despite the name, `scipy.linalg.eigh` will call lapack `syevr` / `heevr` depending on whether the field is real / complex.",
    "created_at": "2012-05-04T18:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127432",
    "user": "https://github.com/vbraun"
}
```

Despite the name, `scipy.linalg.eigh` will call lapack `syevr` / `heevr` depending on whether the field is real / complex.



---

archive/issue_comments_127433.json:
```json
{
    "body": "The `algorithm='symmetric'` keyword is meant to allow the routine accomodate both base rings (RDF/CDF) while also allowing a user to specify that a matrix is known to be symmetric.  In this case, the conversion from CDF to RDF is made by the routine and then the SciPy behavior that Volker notes will take place.\n\nAny suggestions on making the docstring clearer?  Maybe saying \"then applies the algorithm for Hermitian matrices\" should be stated differently?",
    "created_at": "2012-05-04T18:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127433",
    "user": "https://github.com/rbeezer"
}
```

The `algorithm='symmetric'` keyword is meant to allow the routine accomodate both base rings (RDF/CDF) while also allowing a user to specify that a matrix is known to be symmetric.  In this case, the conversion from CDF to RDF is made by the routine and then the SciPy behavior that Volker notes will take place.

Any suggestions on making the docstring clearer?  Maybe saying "then applies the algorithm for Hermitian matrices" should be stated differently?



---

archive/issue_comments_127434.json:
```json
{
    "body": "On Fedora 16 x86_64, I get\n\n```\nsage -t  devel/sage-main/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"/home/vbraun/opt/sage-5.0.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1570:\n    sage: A.eigenvalues(algorithm='symmetric', tol=1.0e-20)\nExpected:\n    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (3.0, 1)]\nGot:\n    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 2), (1.0, 1), (3.0, 1)]\n```\nATLAS is from Fedora, CPU is a Sandy-Bridge i7 quad-core. \n\nMinor nitpicks while we are at it:\n* Can you return a tuple (=immutable) instead of a list?\n* the symmetric docstring, how about: \"converts `self` to a real matrix and applies the algorithm for Hermitian matrices\". Note: technically you convert (explicit), not coerce (implicit).\n* in the hermitian docstring, how about: \"uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...\". This would make it clear that the `syevr` implementation is used if possible.\n* the \".. warning::\" block is not indented, so it is not typeset correctly.",
    "created_at": "2012-05-05T03:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127434",
    "user": "https://github.com/vbraun"
}
```

On Fedora 16 x86_64, I get

```
sage -t  devel/sage-main/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "/home/vbraun/opt/sage-5.0.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1570:
    sage: A.eigenvalues(algorithm='symmetric', tol=1.0e-20)
Expected:
    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (1.0, 1), (3.0, 1)]
Got:
    [(-2.0, 1), (-2.0, 2), (-2.0, 1), (1.0, 1), (1.0, 1), (1.0, 2), (1.0, 1), (3.0, 1)]
```
ATLAS is from Fedora, CPU is a Sandy-Bridge i7 quad-core. 

Minor nitpicks while we are at it:
* Can you return a tuple (=immutable) instead of a list?
* the symmetric docstring, how about: "converts `self` to a real matrix and applies the algorithm for Hermitian matrices". Note: technically you convert (explicit), not coerce (implicit).
* in the hermitian docstring, how about: "uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...". This would make it clear that the `syevr` implementation is used if possible.
* the ".. warning::" block is not indented, so it is not typeset correctly.



---

archive/issue_comments_127435.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-05T03:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127435",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127436.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> On Fedora 16 x86_64, I get...\n\n\nThanks, I'll increase the tolerance and that should work better across platforms.  You'd think I'd get the hang of this numerical stuff...\n\n\n> Minor nitpicks while we are at it:\n> * Can you return a tuple (=immutable) instead of a list?\n\n\nI'm not opposed, but other eigenvalue routines return mutable objects.  I'd prefer to do one grand change across all matrix types, on a single-purpose ticket of its own.\n\n```\nsage: A = matrix(QQ, [[1]])\nsage: ev=A.eigenvalues()   \nsage: type(ev)\n<class 'sage.structure.sequence.Sequence_generic'>\nsage: ev[0]=5\nsage: ev\n[5]\n```\n\n>   * the symmetric docstring, how about: \"converts `self` to a real matrix and applies the algorithm for Hermitian matrices\". Note: technically you convert (explicit), not coerce (implicit).\n>   * in the hermitian docstring, how about: \"uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...\". This would make it clear that the `syevr` implementation is used if possible.\n>   * the \".. warning::\" block is not indented, so it is not typeset correctly.\n\n\nThanks for the nits.  I'll make some changes right now.\n\nRob",
    "created_at": "2012-05-05T03:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127436",
    "user": "https://github.com/rbeezer"
}
```

Replying to [comment:8 vbraun]:
> On Fedora 16 x86_64, I get...


Thanks, I'll increase the tolerance and that should work better across platforms.  You'd think I'd get the hang of this numerical stuff...


> Minor nitpicks while we are at it:
> * Can you return a tuple (=immutable) instead of a list?


I'm not opposed, but other eigenvalue routines return mutable objects.  I'd prefer to do one grand change across all matrix types, on a single-purpose ticket of its own.

```
sage: A = matrix(QQ, [[1]])
sage: ev=A.eigenvalues()   
sage: type(ev)
<class 'sage.structure.sequence.Sequence_generic'>
sage: ev[0]=5
sage: ev
[5]
```

>   * the symmetric docstring, how about: "converts `self` to a real matrix and applies the algorithm for Hermitian matrices". Note: technically you convert (explicit), not coerce (implicit).
>   * in the hermitian docstring, how about: "uses the :meth:`~scipy.linalg.eigh` method from SciPy, which applies only to real symmetric or complex Hermitian matrices. Since...". This would make it clear that the `syevr` implementation is used if possible.
>   * the ".. warning::" block is not indented, so it is not typeset correctly.


Thanks for the nits.  I'll make some changes right now.

Rob



---

archive/issue_comments_127437.json:
```json
{
    "body": "\"Update\" patch:\n\n1. Removes the `10^-20` tolerance doctest.  Not really needed and will only cause trouble. (It was suppose to illustrate how a very small tolerance would split up \"equal\" eigenvalues.)\n2. Adjusts documentation according to suggestions above.\n3. Includes new pointers to routines to check symmetric and Hermitian properties.\n4. No code changes.\n\nRob",
    "created_at": "2012-05-05T04:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127437",
    "user": "https://github.com/rbeezer"
}
```

"Update" patch:

1. Removes the `10^-20` tolerance doctest.  Not really needed and will only cause trouble. (It was suppose to illustrate how a very small tolerance would split up "equal" eigenvalues.)
2. Adjusts documentation according to suggestions above.
3. Includes new pointers to routines to check symmetric and Hermitian properties.
4. No code changes.

Rob



---

archive/issue_comments_127438.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-05T04:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127438",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127439.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-05T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127439",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127440.json:
```json
{
    "body": "Looks great!",
    "created_at": "2012-05-05T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127440",
    "user": "https://github.com/vbraun"
}
```

Looks great!



---

archive/issue_comments_127441.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> Looks great!\n\n\nThanks, Volker!\n\nThis was built on various 5.0-beta's, so I just double-checked that it applies, tests and builds on 5.0-rc0.\n\nRob",
    "created_at": "2012-05-05T20:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127441",
    "user": "https://github.com/rbeezer"
}
```

Replying to [comment:11 vbraun]:
> Looks great!


Thanks, Volker!

This was built on various 5.0-beta's, so I just double-checked that it applies, tests and builds on 5.0-rc0.

Rob



---

archive/issue_events_030451.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-05T21:28:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11436#event-30451"
}
```



---

archive/issue_comments_127442.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-07T06:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127442",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_127443.json:
```json
{
    "body": "The `warning` in the docstring is misformatted, see [http://sagemath.org/doc/developer/conventions.html#documentation-strings](http://sagemath.org/doc/developer/conventions.html#documentation-strings)",
    "created_at": "2012-05-07T06:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127443",
    "user": "https://github.com/jdemeyer"
}
```

The `warning` in the docstring is misformatted, see [http://sagemath.org/doc/developer/conventions.html#documentation-strings](http://sagemath.org/doc/developer/conventions.html#documentation-strings)



---

archive/issue_comments_127444.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-05-24T21:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127444",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_127445.json:
```json
{
    "body": "Attachment [trac_11608-eigenvalues-symmetric-multiplicity-update-v2.patch](tarball://root/attachments/some-uuid/ticket11608/trac_11608-eigenvalues-symmetric-multiplicity-update-v2.patch) by @rbeezer created at 2012-05-24 21:41:44\n\nI thought this was OK and I just triple-checked, and I think it is OK.  One change: made \"warning\" all capital letters, this is the only change to the v2 version of the update patch.\n\nThe HTML documentation renders the warning blocks as they should.  I'm going to move this back to positive review.\n\nJeroen - please let me know if I am really missing something here.  Thanks.\n\nRob",
    "created_at": "2012-05-24T21:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127445",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11608-eigenvalues-symmetric-multiplicity-update-v2.patch](tarball://root/attachments/some-uuid/ticket11608/trac_11608-eigenvalues-symmetric-multiplicity-update-v2.patch) by @rbeezer created at 2012-05-24 21:41:44

I thought this was OK and I just triple-checked, and I think it is OK.  One change: made "warning" all capital letters, this is the only change to the v2 version of the update patch.

The HTML documentation renders the warning blocks as they should.  I'm going to move this back to positive review.

Jeroen - please let me know if I am really missing something here.  Thanks.

Rob



---

archive/issue_comments_127446.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-27T04:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127446",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_127447.json:
```json
{
    "body": "Yes, it looks okay now.  I don't remember what precisely was wrong before.",
    "created_at": "2012-05-27T04:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127447",
    "user": "https://github.com/jdemeyer"
}
```

Yes, it looks okay now.  I don't remember what precisely was wrong before.



---

archive/issue_events_030452.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-14T06:38:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11436#event-30452"
}
```



---

archive/issue_comments_127448.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-14T06:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11436#issuecomment-127448",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
