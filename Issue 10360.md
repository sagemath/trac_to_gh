# Issue 10360: upgrade setuptools to 0.6c11

Issue created by migration from https://trac.sagemath.org/ticket/10361

Original creator: Koen

Original creation time: 2010-12-01 16:42:17

Assignee: tbd

CC:  jsp

The current setuptools version in Sage is 0.6c9. However, in the 0.6c11 update, there's an important change:

```
 * Fixes for various dependency management problems such as looping builds, 
   re-downloading packages already present on sys.path (but not in a registered
   "site" directory), and semi-randomly preferring local "-f" packages over
   local installed packages
```


The problem in the PyCUDA package with a corrupted setuptools ( http://trac.sagemath.org/sage_trac/ticket/10010 ) after installing distribute is caused due to this outdated setuptools version.

The package is really simple (like the current 0.6c9 package), because it has no patches compared to the vanilla setuptools from http://pypi.python.org/pypi/setuptools . Therefore, I just copied in the new source and that was it.


---

Comment by Koen created at 2010-12-02 12:13:49

Changing status from new to needs_review.


---

Comment by Koen created at 2010-12-02 12:13:49

Changing priority from major to critical.


---

Comment by leif created at 2010-12-15 09:24:50

(Almost) regardless of its size, never attach a binary file on trac... ;-)

Instead, put a link to it on the ticket, and perhaps attach an spkg diff or Mercurial patch to the ticket for reference / review.

If you don't have a sagemath account (or some other place to upload it), you can use http://code.google.com/p/spkg-upload/ .

I think I've already made such an spkg IIRC, with further clean-up a while ago. Let me see...


---

Comment by leif created at 2010-12-15 09:24:50

Changing keywords from "" to "distribute".


---

Comment by leif created at 2010-12-15 09:38:22

Replying to [comment:2 leif]:
> I think I've already made such an spkg IIRC, with further clean-up a while ago. Let me see...

Ah, no. I looked at the 0.6c11, but did not make a new spkg, but only patched the 0.6c9 with some "debug" code, adding more messages regarding the handling of `.pth` files with which we had trouble.

I'll take a look at your spkg.


---

Attachment

SPKG patch. Adds error checking etc.


---

Comment by leif created at 2010-12-15 10:06:43

I've attached a patch to `spkg-install`.


Koen: You haven't updated `SPKG.txt`.

(I haven't either.) Can you do that and provide an updated spkg somewhere else (with also my patch applied)?

I'll then ask someone powerful to remove the spkg attached to the ticket.


(P.S.: Sorry, confused your name...)


---

Comment by leif created at 2010-12-15 10:10:54

Besides applying the patch, you apparently also have to

```sh
chmod +x spkg-install
```

again.


---

Comment by leif created at 2010-12-15 10:23:03

Also, please delete Michael Abshoff from the spkg maintainer list in `SPKG.txt`, and

```sh
rm setuptools-0.6c11.p0/src/setuptools/gui.exe
rm setuptools-0.6c11.p0/src/setuptools/cli.exe
```


A comment on this should go into the (not yet existing) _Special Update/Build Instructions_ section.


---

Comment by leif created at 2010-12-15 10:33:16

CC'ing the remaining spkg maintainer...


---

Comment by Koen created at 2010-12-15 12:17:02

Here's the updated package:
http://code.google.com/p/spkg-upload/downloads/detail?name=setuptools-0.6c11.p0.spkg
Also, I'm under the impression that SPKG.txt/spkg-install are under version control somewhere. Note that I modified the files and haven't committed them anywhere.


---

Comment by leif created at 2010-12-15 12:34:02

Replying to [comment:8 Koen]:
> Also, I'm under the impression that SPKG.txt/spkg-install are under version control somewhere. Note that I modified the files and haven't committed them anywhere.

_Somewhere_? :)

Every spkg has its Mercurial repository (`.hg`), which contains the Sage part of the spkg, but not the upstream code (`src/`, which is in `.hgignore`).

So you just have to `hg commit` and provide a commit message, starting with the ticket number (`#10361`), and a brief (one-line) description. (You can optionally _in addition_ provide a longer description, e.g. a copy of your Changelog entry, below that first and a blank line.)

You may have to create/edit your `~/.hgrc` first, such that Mercurial adds the proper name and e-mail address.

I'll see how you applied my patch without using Mercurial(?)... You should have perhaps first updated `SPKG.txt`, committed your changes, and then `hg import /path/to/my/patch`.


---

Comment by leif created at 2010-12-15 13:28:45

P.S.:

In case you want to update your spkg at spkg-upload, *first delete the old one*, then you can (re-)upload a new one with the same name.

We usually provide the md5sum of an spkg along with the (raw) download link on the ticket, (also) to avoid confusion with previous versions.


---

Comment by Koen created at 2010-12-15 17:04:48

OK, this time by using version control (I didn't realize the complete repository is in the spkg, I thought there was a centralized repository somewhere).

[http://spkg-upload.googlecode.com/files/setuptools-0.6c11.p0.spkg](http://spkg-upload.googlecode.com/files/setuptools-0.6c11.p0.spkg)
SHA1 Checksum: bd8a3be6200f66163ab51ec2c08b9a10cb46fc7f


---

Comment by leif created at 2010-12-15 18:29:18

Replying to [comment:11 Koen]:
> OK, this time by using version control (I didn't realize the complete repository is in the spkg, I thought there was a centralized repository somewhere).
> 
> [http://spkg-upload.googlecode.com/files/setuptools-0.6c11.p0.spkg](http://spkg-upload.googlecode.com/files/setuptools-0.6c11.p0.spkg)
> SHA1 Checksum: bd8a3be6200f66163ab51ec2c08b9a10cb46fc7f

Ok, the `.exe` files are back, but they're quite small (8 KB each).

The changelog entry should name the whole spkg (base)name (i.e. setuptools-0.6c11*.p0*), and it's convenient to also have the ticket number in the changelog, but I don't mind.

I've tested it with both Sage 4.6.1.alpha2 and alpha3, also by reinstalling SageNB (which uses setuptools).

So if you are ok with my changes, too, we have a positive review.


---

Comment by drkirkby created at 2010-12-15 23:19:13

I'm responding to Leif's email for the .spkg to be deleted, so I've done it. 

Note, that .spkg's should *never* be attached to trac. The system is not set up to handle large files, which .spkg's generally are. (In fact, I've lost count the number of times trac stops working because a file system is full) 

Please instead put them on a server of some sort and provide a link with and ideally state the md5 checksum too. 

Note William will give any Sage developer an account on the *.math.washington.edu network. Since your home directory is then publicly readable, just stick .spkg's in your home directory, or probably more logically make a sub-directory and stick them there. 

Here's my directory - I should clean some of the older ones out!

http://boxen.math.washington.edu/home/kirkby/patches/

Dave


---

Comment by Koen created at 2010-12-16 00:09:45

I'm ok with the changes by Leif, so we're now at positive review.


---

Comment by Koen created at 2010-12-16 00:09:45

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-01-19 22:22:49

Resolution: fixed


---

Comment by jdemeyer created at 2011-01-20 14:11:06

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2011-01-20 14:11:06

Could this cause `twisted` to fail to install on `bsd.math` (OS X)?


---

Comment by jdemeyer created at 2011-01-20 14:11:06

Changing status from closed to new.


---

Comment by jdemeyer created at 2011-01-20 14:11:22

Changing status from new to needs_work.


---

Comment by jdemeyer created at 2011-01-20 20:38:46

Confirmed that this new spkg actually breaks building twisted on bsd.math.


---

Comment by jdemeyer created at 2011-06-07 09:07:13

Resolution: duplicate


---

Comment by jdemeyer created at 2011-06-07 09:07:13

See #11363 instead.
