# Issue 25089: Schützenberger anti-automorphisms for WQSym, FQSym, FSym

Issue created by migration from https://trac.sagemath.org/ticket/25326

Original creator: @darijgr

Original creation time: 2018-05-10 10:56:20

CC:  sage-combinat tscrim darij zabrocki alauve saliola amypang chapoton

Keywords: combinatorial hopf algebras, sage-combinat

The combinatorial Hopf algebras WQSym, FQSym and FSym have various anti-automorphisms:

On WQSym:

- The one that, in the M-basis, reverses the ordered set partition, or equivalently complements the packed word (i.e., replaces letters 1,2,...,k by k,k-1,...,1). This is an automorphism of the algebra structure and an anti-automorphism of the coalgebra structure.

- The one that, in the M-basis, complements the (elements of the blocks of the) ordered set partition, or equivalently reverts the packed word. This is an anti-automorphism of the algebra structure (which is obvious if you look at WQSym as a subring of formal power series in non-commutative variables: then it's just a restriction of the anti-automorphism that fixes each letter) and an automorphism of the coalgebra structure.

- The composition of the above two. This is best called the Schützenberger anti-automorphism, and is an anti-automorphism of the whole Hopf algebra.

On FQSym:

All the three homomorphisms above restrict to FQSym. One corresponds to reversal, one to complement, one to Schützenberger; but which one depends on the basis.

On FSym:

According to my understanding of Poirier and Reutenauer, all the three homomorphisms above restrict to FSym.

On FSym*:

According to my understanding of Poirier and Reutenauer, all the three homomorphisms above restrict to FSym*.


---

Comment by @darijgr created at 2018-06-06 22:48:31

WQSym part has been implemented, at least on the M basis. I have formulas for all other basis except for C, but I haven't overridden the method so far, to avoid duplicating documentation. (I'm not actually sure if the overrides will significantly speed up the computation, except for the star involution -- since the other two involutions don't involve cancellations when you go through the M basis.)
----
New commits:


---

Comment by @darijgr created at 2018-06-06 22:48:31

Changing keywords from "combinatorial hopf algebras, sage-combinat" to "combinatorial hopf algebras, sage-combinat, WQSym".


---

Comment by git created at 2018-06-07 10:09:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-07 16:47:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-07 23:45:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-07 23:47:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 10:47:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 11:24:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 11:30:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 12:55:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 12:56:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @darijgr created at 2018-06-08 13:00:51

I've implemented an explicit M-to-F transition matrix for FQSym as well, as was suggested in one of the TODOs. This speeds up computations for all but the simplest cases (warning: these times are on Cygwin):

Before:

```
sage: FQSym = algebras.FQSym(ZZ); FQSym.inject_shorthands()
Defining F as shorthand for Free Quasi-symmetric functions over Integer Ring in the F basis
Defining G as shorthand for Free Quasi-symmetric functions over Integer Ring in the G basis
Defining M as shorthand for Free Quasi-symmetric functions over Integer Ring in the Monomial basis
sage: %timeit F(M[3,2,1])
10000 loops, best of 3: 88.2 µs per loop
sage: %timeit F(M[1,2,3])
1000 loops, best of 3: 489 µs per loop
sage: %timeit F(M[2,1,3])
1000 loops, best of 3: 214 µs per loop
sage: %timeit F(M[1])
The slowest run took 4.19 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 81 µs per loop
sage: %timeit F(M[1,2,3,4])
100 loops, best of 3: 2.9 ms per loop
sage: %timeit F(M[4,2,1,3])
1000 loops, best of 3: 220 µs per loop
sage: %timeit F(M[6,2,5,1,3,4])
100 loops, best of 3: 2.06 ms per loop
sage: %timeit F(M[8,3,2,1,4,5,6,7])
1 loop, best of 3: 1.66 s per loop
```


After:

```
sage: FQSym = algebras.FQSym(ZZ); FQSym.inject_shorthands()
Defining F as shorthand for Free Quasi-symmetric functions over Integer Ring in the F basis
Defining G as shorthand for Free Quasi-symmetric functions over Integer Ring in the G basis
Defining M as shorthand for Free Quasi-symmetric functions over Integer Ring in the Monomial basis
sage: %timeit F(M[3,2,1])
10000 loops, best of 3: 196 µs per loop
sage: %timeit F(M[1,2,3])
1000 loops, best of 3: 243 µs per loop
sage: %timeit F(M[2,1,3])
10000 loops, best of 3: 191 µs per loop
sage: %timeit F(M[1])
10000 loops, best of 3: 136 µs per loop
sage: %timeit F(M[1,2,3,4])
1000 loops, best of 3: 382 µs per loop
sage: %timeit F(M[4,2,1,3])
10000 loops, best of 3: 203 µs per loop
sage: %timeit F(M[6,2,5,1,3,4])
1000 loops, best of 3: 281 µs per loop
sage: %timeit F(M[8,3,2,1,4,5,6,7])
1000 loops, best of 3: 776 µs per loop
```



---

Comment by git created at 2018-06-08 13:39:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-08 13:45:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-06-08 13:49:04

Changing status from new to needs_review.


---

Comment by git created at 2018-06-12 05:09:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-12 05:12:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-06-12 05:18:24

Frédéric, I wanted to let you know that my previous commit is a fix for the long tests on this ticket.

Also for the new test, here is the top of a `%prun`:

```
         60055285 function calls (59625813 primitive calls) in 22.503 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
 22568202    6.561    0.000    9.473    0.000 combinat.py:930(__eq__)
     6564    4.433    0.001   19.148    0.003 tools.py:20(transitive_ideal)
23590175/23590174    3.045    0.000    3.045    0.000 {isinstance}
   360076    1.124    0.000    2.176    0.000 permutation.py:483(__init__)
   180428    0.830    0.000    4.829    0.000 permutation.py:3772(permutohedron_succ)
   188037    0.577    0.000    0.882    0.000 free_module.py:1049(_monomial)
   360076    0.556    0.000    0.855    0.000 combinat.py:1256(__init__)
  2399452    0.507    0.000    0.909    0.000 combinat.py:1201(index)
   180428    0.483    0.000    1.144    0.000 permutation.py:3805(<lambda>)
  2417264    0.406    0.000    0.406    0.000 {method 'index' of 'list' objects}
```

So about 1/2 of the time is spent just checking that two permutations are equal.


---

Comment by @darijgr created at 2018-06-12 06:13:40

Thanks, Travis!


---

Comment by git created at 2018-06-12 06:29:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-06-12 06:32:23

Thinking more about the doc, I don't like the fact that the definitions are in one category file that is basically overwritten in the special cases. So the documentation is not well localized. Although one of the annoying things is it would require a fair bit of duplication. So I am inclined to let it be.

Thus, if my changes are good, then positive review.


---

Comment by git created at 2018-06-12 06:49:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-12 06:50:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-06-12 06:54:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-06-12 06:55:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-06-12 07:04:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @darijgr created at 2018-06-12 07:12:19

Changing status from needs_review to positive_review.


---

Comment by @darijgr created at 2018-06-12 07:12:19

Thanks, Travis! Newest version of your commit looks good.


---

Comment by vbraun created at 2018-06-14 07:41:12

Resolution: fixed
