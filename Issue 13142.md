# Issue 13142: segmentation fault with roots over ComplexField

archive/issues_013142.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  jdemeyer cremona\n\nthis was reported to me by Benjamin Dadoun:\n\n```\n\nsage: CC=ComplexField(128)\nsage: z=polygen(CC, 'z')\nsage: p=340282366920938463463374607431768211457*z^84 - 446662175392119146634315\\\n708974074167296*z^80 + 279189840125316599983095153558720348160*z^76 - 110522928\\\n999596165272398266482588385280*z^72 + 31087466142071580858231009754176552960*z^\\\n68 - 6606701181888932299640001500276588544*z^64 + 11012193014312756111509855712\\\n98443264*z^60 - 147498447216213728441335387395194880*z^56 + 1613414321773705176\\\n1322600788131840*z^52 - 1456690062677843407408776850964480*z^48 + 1092619146982\\\n48556477361418141696*z^44 - 6829504668478678587441535778816*z^40 + 355736441058\\\n167833075415777280*z^36 - 15393873200469425036030115840*z^32 + 5498322942774330\\\n90197422080*z^28 - 16038265915694612515651584*z^24 + 375931794881970935169024*z\\\n^20 - 6911153168471496130560*z^16 + 95997158355731169280*z^12 - 947428403886210\\\n560*z^8 + 5921977682886976*z^4 - 17626570956801\nsage: p.roots(ring=CC)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/users/caramel/bdadoun/Desktop/ceval/<ipython console> in <module>()\n\n/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2\\\n.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.poly\\\nnomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_el\\\nement.c:31093)()\n\n/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2\\\n.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage\\\n/libs/pari/gen.c:35318)()\n\nRuntimeError: Segmentation fault\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13314\n\n",
    "created_at": "2012-07-31T16:01:37Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "title": "segmentation fault with roots over ComplexField",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13142",
    "user": "zimmerma"
}
```
Assignee: burcin

CC:  jdemeyer cremona

this was reported to me by Benjamin Dadoun:

```

sage: CC=ComplexField(128)
sage: z=polygen(CC, 'z')
sage: p=340282366920938463463374607431768211457*z^84 - 446662175392119146634315\
708974074167296*z^80 + 279189840125316599983095153558720348160*z^76 - 110522928\
999596165272398266482588385280*z^72 + 31087466142071580858231009754176552960*z^\
68 - 6606701181888932299640001500276588544*z^64 + 11012193014312756111509855712\
98443264*z^60 - 147498447216213728441335387395194880*z^56 + 1613414321773705176\
1322600788131840*z^52 - 1456690062677843407408776850964480*z^48 + 1092619146982\
48556477361418141696*z^44 - 6829504668478678587441535778816*z^40 + 355736441058\
167833075415777280*z^36 - 15393873200469425036030115840*z^32 + 5498322942774330\
90197422080*z^28 - 16038265915694612515651584*z^24 + 375931794881970935169024*z\
^20 - 6911153168471496130560*z^16 + 95997158355731169280*z^12 - 947428403886210\
560*z^8 + 5921977682886976*z^4 - 17626570956801
sage: p.roots(ring=CC)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/users/caramel/bdadoun/Desktop/ceval/<ipython console> in <module>()

/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2\
.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.poly\
nomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_el\
ement.c:31093)()

/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2\
.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage\
/libs/pari/gen.c:35318)()

RuntimeError: Segmentation fault
```


Issue created by migration from https://trac.sagemath.org/ticket/13314





---

archive/issue_comments_160068.json:
```json
{
    "body": "I get the same with Sage 5.2 [rc0] built from source on Ubuntu 10.04.4 LTS x86_64 (GCC 4.7.0).",
    "created_at": "2012-07-31T16:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160068",
    "user": "leif"
}
```

I get the same with Sage 5.2 [rc0] built from source on Ubuntu 10.04.4 LTS x86_64 (GCC 4.7.0).



---

archive/issue_comments_160069.json:
```json
{
    "body": "FWIW, the segfault occurs in the PARI library, and apparently depends on the precision of the complex field (works for me with up to 64 bits).",
    "created_at": "2012-07-31T17:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160069",
    "user": "leif"
}
```

FWIW, the segfault occurs in the PARI library, and apparently depends on the precision of the complex field (works for me with up to 64 bits).



---

archive/issue_comments_160070.json:
```json
{
    "body": "yes the Seg. fault occurs for a precision of 65 bits or more. However I was unable to reproduce it using the GP interpreter (with version 2.5.0). It would be easier to report upstream if we can reproduce it using GP than the Pari library.\n\nPaul",
    "created_at": "2012-08-01T06:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160070",
    "user": "zimmerma"
}
```

yes the Seg. fault occurs for a precision of 65 bits or more. However I was unable to reproduce it using the GP interpreter (with version 2.5.0). It would be easier to report upstream if we can reproduce it using GP than the Pari library.

Paul



---

archive/issue_comments_160071.json:
```json
{
    "body": "I tried to trace the error down to the Pari library. In file `rootpol.c`, function\n`roots_aux`, the segmentation fault happens in the call to `roots_com` with\n`l=4` and `bit_accuracy(l)=128` where `p` is (as printed by the Pari `output`\nfunction):\n\n```\n(1.00000000000000000000000000000000000000+0.E-38*I)*z^84+(0.E-38+0.E-38*I)*z^83+(0.E-38+0.E-38*I)*z^82+(0.E-38+0.E-38*I)*z^81+(-1.31262215974857454625635000411421060562+0.E-38*I)*z^80+(0.E-38+0.E-38*I)*z^79+(0.E-38+0.E-38*I)*z^78+(0.E-38+0.E-38*I)*z^77+(0.82046519968571818282043750514276325703+0.E-38*I)*z^76+(0.E-38+0.E-38*I)*z^75+(0.E-38+0.E-38*I)*z^74+(0.E-38+0.E-38*I)*z^73+(-0.324797696688395171049634768678515683860+0.E-38*I)*z^72+(0.E-38+0.E-38*I)*z^71+(0.E-38+0.E-38*I)*z^70+(0.E-38+0.E-38*I)*z^69+(0.091357852078460689143613038254443381448+0.E-38*I)*z^68+(0.E-38+0.E-38*I)*z^67+(0.E-38+0.E-38*I)*z^66+(0.E-38+0.E-38*I)*z^65+(-0.0194153497922034252412722132863365231970+0.E-38*I)*z^64+(0.E-38+0.E-38*I)*z^63+(0.E-38+0.E-38*I)*z^62+(0.E-38+0.E-38*I)*z^61+(0.00323619266962232567325444265726730463939+0.E-38*I)*z^60+(0.E-38+0.E-38*I)*z^59+(0.E-38+0.E-38*I)*z^58+(0.E-38+0.E-38*I)*z^57+(-0.000433458978644296491914756665198016349904+0.E-38*I)*z^56+(0.E-38+0.E-38*I)*z^55+(0.E-38+0.E-38*I)*z^54+(0.E-38+0.E-38*I)*z^53+(4.74139855195190713770398956497520437380E-5+0.E-38*I)*z^52+(0.E-38+0.E-38*I)*z^51+(0.E-38+0.E-38*I)*z^50+(0.E-38+0.E-38*I)*z^49+(-4.2808273489419220927898795386466919422E-6+0.E-38*I)*z^48+(0.E-38+0.E-38*I)*z^47+(0.E-38+0.E-38*I)*z^46+(0.E-38+0.E-38*I)*z^45+(3.21091908719544601469774304001807661846E-7+0.E-38*I)*z^44+(0.E-38+0.E-38*I)*z^43+(0.E-38+0.E-38*I)*z^42+(0.E-38+0.E-38*I)*z^41+(-2.00701103917778153737692276628195892519E-8+0.E-38*I)*z^40+(0.E-38+0.E-38*I)*z^39+(0.E-38+0.E-38*I)*z^38+(0.E-38+0.E-38*I)*z^37+(1.04541544211375485185820631903782289784E-9+0.E-38*I)*z^36+(0.E-38+0.E-38*I)*z^35+(0.E-38+0.E-38*I)*z^34+(0.E-38+0.E-38*I)*z^33+(-4.52385274610660402740066744025679312462E-11+0.E-38*I)*z^32+(0.E-38+0.E-38*I)*z^31+(0.E-38+0.E-38*I)*z^30+(0.E-38+0.E-38*I)*z^29+(1.61581188955695039273058373628568909992E-12+0.E-38*I)*z^28+(0.E-38+0.E-38*I)*z^27+(0.E-38+0.E-38*I)*z^26+(0.E-38+0.E-38*I)*z^25+(-4.71322274522116476238604321139902691134E-14+0.E-38*I)*z^24+(0.E-38+0.E-38*I)*z^23+(0.E-38+0.E-38*I)*z^22+(0.E-38+0.E-38*I)*z^21+(1.10476425294559942483778527936674858155E-15+0.E-38*I)*z^20+(0.E-38+0.E-38*I)*z^19+(0.E-38+0.E-38*I)*z^18+(0.E-38+0.E-38*I)*z^17+(-2.03100537680144918840320161959898939477E-17+0.E-38*I)*z^16+(0.E-38+0.E-38*I)*z^15+(0.E-38+0.E-38*I)*z^14+(0.E-38+0.E-38*I)*z^13+(2.82110293355386359309869812795381913797E-19+0.E-38*I)*z^12+(0.E-38+0.E-38*I)*z^11+(0.E-38+0.E-38*I)*z^10+(0.E-38+0.E-38*I)*z^9+(-2.78424184144204274350181426076550186938E-21+0.E-38*I)*z^8+(0.E-38+0.E-38*I)*z^7+(0.E-38+0.E-38*I)*z^6+(0.E-38+0.E-38*I)*z^5+(1.74031282798232506192330105295904480920E-23+0.E-38*I)*z^4+(0.E-38+0.E-38*I)*z^3+(0.E-38+0.E-38*I)*z^2+(0.E-38+0.E-38*I)*z+(-5.1799836460219446701130005742251516370E-26+0.E-38*I)\n```\n\nPaul",
    "created_at": "2012-08-01T13:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160071",
    "user": "zimmerma"
}
```

I tried to trace the error down to the Pari library. In file `rootpol.c`, function
`roots_aux`, the segmentation fault happens in the call to `roots_com` with
`l=4` and `bit_accuracy(l)=128` where `p` is (as printed by the Pari `output`
function):

```
(1.00000000000000000000000000000000000000+0.E-38*I)*z^84+(0.E-38+0.E-38*I)*z^83+(0.E-38+0.E-38*I)*z^82+(0.E-38+0.E-38*I)*z^81+(-1.31262215974857454625635000411421060562+0.E-38*I)*z^80+(0.E-38+0.E-38*I)*z^79+(0.E-38+0.E-38*I)*z^78+(0.E-38+0.E-38*I)*z^77+(0.82046519968571818282043750514276325703+0.E-38*I)*z^76+(0.E-38+0.E-38*I)*z^75+(0.E-38+0.E-38*I)*z^74+(0.E-38+0.E-38*I)*z^73+(-0.324797696688395171049634768678515683860+0.E-38*I)*z^72+(0.E-38+0.E-38*I)*z^71+(0.E-38+0.E-38*I)*z^70+(0.E-38+0.E-38*I)*z^69+(0.091357852078460689143613038254443381448+0.E-38*I)*z^68+(0.E-38+0.E-38*I)*z^67+(0.E-38+0.E-38*I)*z^66+(0.E-38+0.E-38*I)*z^65+(-0.0194153497922034252412722132863365231970+0.E-38*I)*z^64+(0.E-38+0.E-38*I)*z^63+(0.E-38+0.E-38*I)*z^62+(0.E-38+0.E-38*I)*z^61+(0.00323619266962232567325444265726730463939+0.E-38*I)*z^60+(0.E-38+0.E-38*I)*z^59+(0.E-38+0.E-38*I)*z^58+(0.E-38+0.E-38*I)*z^57+(-0.000433458978644296491914756665198016349904+0.E-38*I)*z^56+(0.E-38+0.E-38*I)*z^55+(0.E-38+0.E-38*I)*z^54+(0.E-38+0.E-38*I)*z^53+(4.74139855195190713770398956497520437380E-5+0.E-38*I)*z^52+(0.E-38+0.E-38*I)*z^51+(0.E-38+0.E-38*I)*z^50+(0.E-38+0.E-38*I)*z^49+(-4.2808273489419220927898795386466919422E-6+0.E-38*I)*z^48+(0.E-38+0.E-38*I)*z^47+(0.E-38+0.E-38*I)*z^46+(0.E-38+0.E-38*I)*z^45+(3.21091908719544601469774304001807661846E-7+0.E-38*I)*z^44+(0.E-38+0.E-38*I)*z^43+(0.E-38+0.E-38*I)*z^42+(0.E-38+0.E-38*I)*z^41+(-2.00701103917778153737692276628195892519E-8+0.E-38*I)*z^40+(0.E-38+0.E-38*I)*z^39+(0.E-38+0.E-38*I)*z^38+(0.E-38+0.E-38*I)*z^37+(1.04541544211375485185820631903782289784E-9+0.E-38*I)*z^36+(0.E-38+0.E-38*I)*z^35+(0.E-38+0.E-38*I)*z^34+(0.E-38+0.E-38*I)*z^33+(-4.52385274610660402740066744025679312462E-11+0.E-38*I)*z^32+(0.E-38+0.E-38*I)*z^31+(0.E-38+0.E-38*I)*z^30+(0.E-38+0.E-38*I)*z^29+(1.61581188955695039273058373628568909992E-12+0.E-38*I)*z^28+(0.E-38+0.E-38*I)*z^27+(0.E-38+0.E-38*I)*z^26+(0.E-38+0.E-38*I)*z^25+(-4.71322274522116476238604321139902691134E-14+0.E-38*I)*z^24+(0.E-38+0.E-38*I)*z^23+(0.E-38+0.E-38*I)*z^22+(0.E-38+0.E-38*I)*z^21+(1.10476425294559942483778527936674858155E-15+0.E-38*I)*z^20+(0.E-38+0.E-38*I)*z^19+(0.E-38+0.E-38*I)*z^18+(0.E-38+0.E-38*I)*z^17+(-2.03100537680144918840320161959898939477E-17+0.E-38*I)*z^16+(0.E-38+0.E-38*I)*z^15+(0.E-38+0.E-38*I)*z^14+(0.E-38+0.E-38*I)*z^13+(2.82110293355386359309869812795381913797E-19+0.E-38*I)*z^12+(0.E-38+0.E-38*I)*z^11+(0.E-38+0.E-38*I)*z^10+(0.E-38+0.E-38*I)*z^9+(-2.78424184144204274350181426076550186938E-21+0.E-38*I)*z^8+(0.E-38+0.E-38*I)*z^7+(0.E-38+0.E-38*I)*z^6+(0.E-38+0.E-38*I)*z^5+(1.74031282798232506192330105295904480920E-23+0.E-38*I)*z^4+(0.E-38+0.E-38*I)*z^3+(0.E-38+0.E-38*I)*z^2+(0.E-38+0.E-38*I)*z+(-5.1799836460219446701130005742251516370E-26+0.E-38*I)
```

Paul



---

archive/issue_comments_160072.json:
```json
{
    "body": "investigation is underway with the help of the Pari developers.\n\nPaul",
    "created_at": "2012-08-01T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160072",
    "user": "zimmerma"
}
```

investigation is underway with the help of the Pari developers.

Paul



---

archive/issue_comments_160073.json:
```json
{
    "body": "for the record, here are the instructions from the Pari developers to (try to) reproduce the problem with Pari: first remove the `static` declaration for the function `roots_com`,\nthen add `gpwritebin(\"/tmp/gp.tmp\", p);` before the `roots_com` call in `rootpol.c`, then under GP:\n\n```\n? install(\"roots_com\", GL)\n? pol = read(\"/tmp/gp.tmp\");\n> ? roots_com(pol, 4)\n  ***   bug in PARI/GP (Segmentation Fault), please report\n  ***   Break loop: type 'break' to go back to GP\n```\n\nPaul",
    "created_at": "2012-08-02T06:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160073",
    "user": "zimmerma"
}
```

for the record, here are the instructions from the Pari developers to (try to) reproduce the problem with Pari: first remove the `static` declaration for the function `roots_com`,
then add `gpwritebin("/tmp/gp.tmp", p);` before the `roots_com` call in `rootpol.c`, then under GP:

```
? install("roots_com", GL)
? pol = read("/tmp/gp.tmp");
> ? roots_com(pol, 4)
  ***   bug in PARI/GP (Segmentation Fault), please report
  ***   Break loop: type 'break' to go back to GP
```

Paul



---

archive/issue_comments_160074.json:
```json
{
    "body": "we are unable to reproduce the Segmentation fault from GP:\n\n```\n? install(\"roots_com\", GL)\n? pol = read(\"/tmp/gp.tmp\");\n? var = roots_com(p, 128)\n%2 = [0.E-38]\n```\n\nPaul",
    "created_at": "2012-08-02T06:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160074",
    "user": "zimmerma"
}
```

we are unable to reproduce the Segmentation fault from GP:

```
? install("roots_com", GL)
? pol = read("/tmp/gp.tmp");
? var = roots_com(p, 128)
%2 = [0.E-38]
```

Paul



---

archive/issue_comments_160075.json:
```json
{
    "body": "Karim Belabas tells me he can now reproduce the Segmentation fault with Pari 2.5.2, but not with 2.6.*.\n\nPaul",
    "created_at": "2012-08-02T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160075",
    "user": "zimmerma"
}
```

Karim Belabas tells me he can now reproduce the Segmentation fault with Pari 2.5.2, but not with 2.6.*.

Paul



---

archive/issue_comments_160076.json:
```json
{
    "body": "the bug is fixed with the following Pari patch (from Karim Belabas):\n\n```\n    fix typo introduced in 7b985ff8a726e89191d2733b9052b2e2c228bfde\n    \"minor improvements root_error()\"\n    prod was not re-initialized to 1.\n\ndiff --git a/src/basemath/rootpol.c b/src/basemath/rootpol.c\nindex 3099bb2..0be400f 100644\n--- a/src/basemath/rootpol.c\n+++ b/src/basemath/rootpol.c\n@@ -1611,8 +1611,8 @@ split_0(GEN p, long bit, GEN *F, GEN *G)\n static GEN\n root_error(long n, long k, GEN roots_pol, long pari_err, GEN shatzle)\n {\n-  GEN rho, d, eps, epsbis, eps2, prod, aux, rap = NULL;\n-  long i, j, m;\n+  GEN rho, d, eps, epsbis, eps2, aux, rap = NULL;\n+  long i, j;\n\n   d = cgetg(n+1,t_VEC);\n   for (i=1; i<=n; i++)\n@@ -1627,11 +1627,11 @@ root_error(long n, long k, GEN roots_pol, long pari_err\\\n, GEN shatzle)\n   if (expo(rho) < 0) rho = real_1(DEFAULTPREC);\n   eps = mulrr(rho, shatzle);\n   aux = shiftr(powru(rho,n), pari_err);\n-  prod = NULL; /* 1. */\n\n   for (j=1; j<=2 || (j<=5 && cmprr(rap, dbltor(1.2)) > 0); j++)\n   {\n-    m = n;\n+    GEN prod = NULL; /* 1. */\n+    long m = n;\n     epsbis = mulrr(eps, dbltor(1.25));\n     for (i=1; i<=n; i++)\n     {\n```\n\nNote this bug is fixed in the \"master\" branch upstream (2.6.*, no official release yet).\n\nPaul\n\nPS: I leave for 3 weeks of vacations, feel free to submit a proper patch in the meantime.",
    "created_at": "2012-08-03T09:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160076",
    "user": "zimmerma"
}
```

the bug is fixed with the following Pari patch (from Karim Belabas):

```
    fix typo introduced in 7b985ff8a726e89191d2733b9052b2e2c228bfde
    "minor improvements root_error()"
    prod was not re-initialized to 1.

diff --git a/src/basemath/rootpol.c b/src/basemath/rootpol.c
index 3099bb2..0be400f 100644
--- a/src/basemath/rootpol.c
+++ b/src/basemath/rootpol.c
@@ -1611,8 +1611,8 @@ split_0(GEN p, long bit, GEN *F, GEN *G)
 static GEN
 root_error(long n, long k, GEN roots_pol, long pari_err, GEN shatzle)
 {
-  GEN rho, d, eps, epsbis, eps2, prod, aux, rap = NULL;
-  long i, j, m;
+  GEN rho, d, eps, epsbis, eps2, aux, rap = NULL;
+  long i, j;

   d = cgetg(n+1,t_VEC);
   for (i=1; i<=n; i++)
@@ -1627,11 +1627,11 @@ root_error(long n, long k, GEN roots_pol, long pari_err\
, GEN shatzle)
   if (expo(rho) < 0) rho = real_1(DEFAULTPREC);
   eps = mulrr(rho, shatzle);
   aux = shiftr(powru(rho,n), pari_err);
-  prod = NULL; /* 1. */

   for (j=1; j<=2 || (j<=5 && cmprr(rap, dbltor(1.2)) > 0); j++)
   {
-    m = n;
+    GEN prod = NULL; /* 1. */
+    long m = n;
     epsbis = mulrr(eps, dbltor(1.25));
     for (i=1; i<=n; i++)
     {
```

Note this bug is fixed in the "master" branch upstream (2.6.*, no official release yet).

Paul

PS: I leave for 3 weeks of vacations, feel free to submit a proper patch in the meantime.



---

archive/issue_comments_160077.json:
```json
{
    "body": "since nobody did a patch, I will try. How to do a patch to a standard spkg? Should I build a\nnew one?\n\nPaul",
    "created_at": "2012-08-29T07:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160077",
    "user": "zimmerma"
}
```

since nobody did a patch, I will try. How to do a patch to a standard spkg? Should I build a
new one?

Paul



---

archive/issue_comments_160078.json:
```json
{
    "body": "Replying to [comment:10 zimmerma]:\n> since nobody did a patch, I will try.\n\nJeroen usually merges such fixes to the pari package immediately. Perhaps he hasn't seen this yet.\n\n> How to do a patch to a standard spkg? Should I build a\n> new one?\n\nThe usual way is to create a new package and bump the revision number, from pari-2.5.2.p0 to pari-2.5.2.p1 for example.\n\n\nThanks for following up on this.",
    "created_at": "2012-08-29T10:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160078",
    "user": "burcin"
}
```

Replying to [comment:10 zimmerma]:
> since nobody did a patch, I will try.

Jeroen usually merges such fixes to the pari package immediately. Perhaps he hasn't seen this yet.

> How to do a patch to a standard spkg? Should I build a
> new one?

The usual way is to create a new package and bump the revision number, from pari-2.5.2.p0 to pari-2.5.2.p1 for example.


Thanks for following up on this.



---

archive/issue_comments_160079.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-08-29T12:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160079",
    "user": "zimmerma"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160080.json:
```json
{
    "body": "I've put a new spkg at http://www.loria.fr/~zimmerma/pari-2.5.1.p4.spkg.\nPlease be cool with me since it is the first time I update a spkg.\n\nPaul",
    "created_at": "2012-08-29T12:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160080",
    "user": "zimmerma"
}
```

I've put a new spkg at http://www.loria.fr/~zimmerma/pari-2.5.1.p4.spkg.
Please be cool with me since it is the first time I update a spkg.

Paul



---

archive/issue_comments_160081.json:
```json
{
    "body": "Could you please put a link to the upstream bug tracker for futute reference?\n\nFor the spkg, this should be based on the most recent version, which is pari-2.5.2.  I can take care of that.",
    "created_at": "2012-08-29T12:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160081",
    "user": "jdemeyer"
}
```

Could you please put a link to the upstream bug tracker for futute reference?

For the spkg, this should be based on the most recent version, which is pari-2.5.2.  I can take care of that.



---

archive/issue_comments_160082.json:
```json
{
    "body": "Except for not committing the changes the to hg repository, it seems you made the spkg correctly.",
    "created_at": "2012-08-29T12:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160082",
    "user": "jdemeyer"
}
```

Except for not committing the changes the to hg repository, it seems you made the spkg correctly.



---

archive/issue_comments_160083.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-08-29T12:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160083",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_160084.json:
```json
{
    "body": "Jeroen,\n\nReplying to [comment:13 jdemeyer]:\n> Could you please put a link to the upstream bug tracker for futute reference?\n> \n> For the spkg, this should be based on the most recent version, which is pari-2.5.2.  I can take care of that.\n\nyes please do!\n\nPaul",
    "created_at": "2012-08-29T12:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160084",
    "user": "zimmerma"
}
```

Jeroen,

Replying to [comment:13 jdemeyer]:
> Could you please put a link to the upstream bug tracker for futute reference?
> 
> For the spkg, this should be based on the most recent version, which is pari-2.5.2.  I can take care of that.

yes please do!

Paul



---

archive/issue_comments_160085.json:
```json
{
    "body": "Added a regression test ;-)  Needs review.",
    "created_at": "2012-08-29T13:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160085",
    "user": "jdemeyer"
}
```

Added a regression test ;-)  Needs review.



---

archive/issue_comments_160086.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-09-03T11:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160086",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_160087.json:
```json
{
    "body": "There was one doctest failure on 32-bit systems, fixed now.\n\nStill needs review.",
    "created_at": "2012-09-03T11:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160087",
    "user": "jdemeyer"
}
```

There was one doctest failure on 32-bit systems, fixed now.

Still needs review.



---

archive/issue_comments_160088.json:
```json
{
    "body": "John, please could you review that easy one?\n\nPaul",
    "created_at": "2012-09-03T12:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160088",
    "user": "zimmerma"
}
```

John, please could you review that easy one?

Paul



---

archive/issue_comments_160089.json:
```json
{
    "body": "Replying to [comment:20 zimmerma]:\n> John, please could you review that easy one?\n> \n> Paul\n\nOK -- should I install the new spkg using sage -f and then apply the patch and then test?  I think other spkgs depend on the pari one (e.g. eclib does) so I am not sure how that will work.\n\nJohn",
    "created_at": "2012-09-03T12:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160089",
    "user": "cremona"
}
```

Replying to [comment:20 zimmerma]:
> John, please could you review that easy one?
> 
> Paul

OK -- should I install the new spkg using sage -f and then apply the patch and then test?  I think other spkgs depend on the pari one (e.g. eclib does) so I am not sure how that will work.

John



---

archive/issue_comments_160090.json:
```json
{
    "body": "First of all: reviewing a ticket is mainly about looking at the patch and checking that it makes sense.\n\nIf `eclib` uses PARI to do root-finding over the complex numbers, then yes, it could affect `eclib`.  However, assuming `eclib` does dynamic linking, then it's not required to actually recompile `eclib`.  The upgraded PARI would automatically be used by `eclib`.\n\nSo, for a ticket like this, I would suggest to run *all* doctests in Sage (root-finding affects many things) but I don't think a full rebuild is needed.\n\nIn any case, any failures would be caught by the Buildbot.  So the worst that can happen is that you waste the time of the release manager and possibly anger him slightly if the failure is particularly obvious (e.g. if somebody edits file X and there are doctests failures in file X, then the author/reviewer did not do their due diligence).",
    "created_at": "2012-09-03T13:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160090",
    "user": "jdemeyer"
}
```

First of all: reviewing a ticket is mainly about looking at the patch and checking that it makes sense.

If `eclib` uses PARI to do root-finding over the complex numbers, then yes, it could affect `eclib`.  However, assuming `eclib` does dynamic linking, then it's not required to actually recompile `eclib`.  The upgraded PARI would automatically be used by `eclib`.

So, for a ticket like this, I would suggest to run *all* doctests in Sage (root-finding affects many things) but I don't think a full rebuild is needed.

In any case, any failures would be caught by the Buildbot.  So the worst that can happen is that you waste the time of the release manager and possibly anger him slightly if the failure is particularly obvious (e.g. if somebody edits file X and there are doctests failures in file X, then the author/reviewer did not do their due diligence).



---

archive/issue_comments_160091.json:
```json
{
    "body": "Thanks.  I did what I said (built the new spkg with sage -f, then sage -b to rebuild which did trigger a lot of compilations, then applied the patch).  The touched files test OK, and I'm now testing everything (i.e. sage -t -long).\n\nThe last thing I would want to do is anger the release manager (even if only slightly)!\n\nThe Sage patch looks fine, and also the spkg patching (assuming that Karim has fixed this properly, which seems likely).",
    "created_at": "2012-09-03T13:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160091",
    "user": "cremona"
}
```

Thanks.  I did what I said (built the new spkg with sage -f, then sage -b to rebuild which did trigger a lot of compilations, then applied the patch).  The touched files test OK, and I'm now testing everything (i.e. sage -t -long).

The last thing I would want to do is anger the release manager (even if only slightly)!

The Sage patch looks fine, and also the spkg patching (assuming that Karim has fixed this properly, which seems likely).



---

archive/issue_comments_160092.json:
```json
{
    "body": "All good except:\n\n```\nsage -t -long devel/sage-main/sage/matrix/matrix_integer_dense.pyx\n**********************************************************************\nFile \"/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx\", line 4967:\n    sage: pari('mathnf(Mat([0,1]), 4)')\nExpected:\n    [Mat([0, 1]), [1, 0; 0, 1]]\nGot:\n    [Mat(1), [1, 0; 0, 1]]\n**********************************************************************\nFile \"/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx\", line 5040:\n    sage: pari('mathnf(Mat([0,1]), 4)')\nExpected:\n    [Mat([0, 1]), [1, 0; 0, 1]]\nGot:\n    [Mat(1), [1, 0; 0, 1]]\n**********************************************************************\n```\n\nwhich look strange to me (and also not relevant to the changes made)!",
    "created_at": "2012-09-03T13:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160092",
    "user": "cremona"
}
```

All good except:

```
sage -t -long devel/sage-main/sage/matrix/matrix_integer_dense.pyx
**********************************************************************
File "/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx", line 4967:
    sage: pari('mathnf(Mat([0,1]), 4)')
Expected:
    [Mat([0, 1]), [1, 0; 0, 1]]
Got:
    [Mat(1), [1, 0; 0, 1]]
**********************************************************************
File "/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx", line 5040:
    sage: pari('mathnf(Mat([0,1]), 4)')
Expected:
    [Mat([0, 1]), [1, 0; 0, 1]]
Got:
    [Mat(1), [1, 0; 0, 1]]
**********************************************************************
```

which look strange to me (and also not relevant to the changes made)!



---

archive/issue_comments_160093.json:
```json
{
    "body": "Replying to [comment:24 cremona]:\n> All good except:\n> {{{\n> sage -t -long devel/sage-main/sage/matrix/matrix_integer_dense.pyx\n> **********************************************************************\n> File \"/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx\", line 4967:\n>     sage: pari('mathnf(Mat([0,1]), 4)')\n> Expected:\n>     [Mat([0, 1]), [1, 0; 0, 1]]\n> Got:\n>     [Mat(1), [1, 0; 0, 1]]\n> **********************************************************************\n> File \"/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx\", line 5040:\n>     sage: pari('mathnf(Mat([0,1]), 4)')\n> Expected:\n>     [Mat([0, 1]), [1, 0; 0, 1]]\n> Got:\n>     [Mat(1), [1, 0; 0, 1]]\n> **********************************************************************\n> }}}\nApply the patch from #12346 (merged in sage-5.3.beta2, I assume you use an older version).",
    "created_at": "2012-09-03T13:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160093",
    "user": "jdemeyer"
}
```

Replying to [comment:24 cremona]:
> All good except:
> {{{
> sage -t -long devel/sage-main/sage/matrix/matrix_integer_dense.pyx
> **********************************************************************
> File "/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx", line 4967:
>     sage: pari('mathnf(Mat([0,1]), 4)')
> Expected:
>     [Mat([0, 1]), [1, 0; 0, 1]]
> Got:
>     [Mat(1), [1, 0; 0, 1]]
> **********************************************************************
> File "/home/jec/sage-5.3.beta1/devel/sage-main/sage/matrix/matrix_integer_dense.pyx", line 5040:
>     sage: pari('mathnf(Mat([0,1]), 4)')
> Expected:
>     [Mat([0, 1]), [1, 0; 0, 1]]
> Got:
>     [Mat(1), [1, 0; 0, 1]]
> **********************************************************************
> }}}
Apply the patch from #12346 (merged in sage-5.3.beta2, I assume you use an older version).



---

archive/issue_comments_160094.json:
```json
{
    "body": "Sorry, I was using beta1 and did not know about the dependencies.  Watch this space...",
    "created_at": "2012-09-03T14:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160094",
    "user": "cremona"
}
```

Sorry, I was using beta1 and did not know about the dependencies.  Watch this space...



---

archive/issue_comments_160095.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-03T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160095",
    "user": "cremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160096.json:
```json
{
    "body": "Replying to [comment:26 cremona]:\n> Sorry, I was using beta1 and did not know about the dependencies.  Watch this space...\n\nOK now with that patch!",
    "created_at": "2012-09-03T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160096",
    "user": "cremona"
}
```

Replying to [comment:26 cremona]:
> Sorry, I was using beta1 and did not know about the dependencies.  Watch this space...

OK now with that patch!



---

archive/issue_comments_160097.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-03T14:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160097",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_160098.json:
```json
{
    "body": "thank you very much John for the efficient review!\n\nPaul",
    "created_at": "2012-09-03T14:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13142#issuecomment-160098",
    "user": "zimmerma"
}
```

thank you very much John for the efficient review!

Paul
