# Issue 21583: Split src/sage/libs/pari

Issue created by migration from https://trac.sagemath.org/ticket/21820

Original creator: jdemeyer

Original creation time: 2016-11-04 14:40:15

CC:  defeo

Split the directory `src/sage/libs/pari` in two:

- `src/sage/libs/cypari2` contains what will be the `cypari2` package.

- `src/sage/libs/pari` contains what will remain in Sage.


---

Comment by jdemeyer created at 2016-11-04 18:12:43

New commits:


---

Comment by jdemeyer created at 2016-11-04 18:12:43

Changing status from new to needs_review.


---

Comment by git created at 2016-11-10 14:59:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by defeo created at 2016-11-10 16:26:15

Compilation fails complaining about missing `sage/libs/pari/paridecl.pxd` during the auto-generation step. Is this expected?


---

Comment by jdemeyer created at 2016-11-10 16:50:27

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-11-10 16:50:45

That was a bad merge with #21821.


---

Comment by git created at 2016-11-10 19:20:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-11-10 19:21:15

Changing status from needs_work to needs_review.


---

Comment by defeo created at 2016-11-11 00:44:25

Starting from a non-clean repo, this leaves behind `src/sage/libs/pari/auto_gen.pxi` and `src/sage/libs/pari/auto_instance.pxi` (easily spotted by `git status`). Removing them by hand causes a doctest failure.

Is this the expected behaviour?


---

Comment by jdemeyer created at 2016-11-11 08:25:50

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-11-11 15:41:33

Replying to [comment:12 defeo]:
> Removing them by hand causes a doctest failure.

Details please...


---

Comment by defeo created at 2016-11-11 15:47:13


```
$ sage -t src/sage_setup/clean.py
too many failed tests, not using stored timings
Running doctests with ID 2016-11-11-16-46-20-c1cba75e.
Git branch: t/21820/split_src_sage_libs_pari
Using --optional=atlas,mpir,python2,sage
Doctesting 1 file.
sage -t src/sage_setup/clean.py
**********************************************************************
File "src/sage_setup/clean.py", line 87, in sage_setup.clean._find_stale_files
Failed example:
    for f in stale_iter:
        if f.endswith(skip_extensions): continue
        print('Found stale file: ' + f)
Expected nothing
Got:
    Found stale file: sage/libs/pari/auto_gen.pxi
    Found stale file: sage/libs/pari/auto_instance.pxi
**********************************************************************
1 item had failures:
   1 of  10 in sage_setup.clean._find_stale_files
    [15 tests, 1 failure, 0.13 s]
----------------------------------------------------------------------
sage -t src/sage_setup/clean.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.6 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 0.1 seconds
```



---

Comment by git created at 2016-11-11 15:48:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-11-11 15:49:25

Changing status from needs_work to needs_review.


---

Comment by defeo created at 2016-11-11 16:23:31

Changing status from needs_review to positive_review.


---

Comment by defeo created at 2016-11-11 16:23:31

I don't understand why the fix works, but it does. Good to go.


---

Comment by vbraun created at 2016-11-11 17:56:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-11-11 17:56:49

Reviweer name


---

Comment by jdemeyer created at 2016-11-11 19:34:37

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-11-15 23:25:07

Resolution: fixed
