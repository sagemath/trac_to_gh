# Issue 18583: Upgrade R to 3.2.1

Issue created by migration from https://trac.sagemath.org/ticket/18820

Original creator: charpent

Original creation time: 2015-06-30 05:32:20

Keywords: r-project

This minor update deserves admission in R in order to be able to get support on R-help.


---

Comment by charpent created at 2015-06-30 06:55:04

Used the new convention allowing capitalized tarball names.

Passes ptestlong on Debian testing.


---

Comment by charpent created at 2015-06-30 06:55:04

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-06-30 07:26:38

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2015-06-30 07:26:38

Where is the tarball?...


---

Comment by charpent created at 2015-06-30 08:09:13

Changing status from needs_info to needs_review.


---

Comment by charpent created at 2015-06-30 08:09:13

<Wups !> Forgot the (link to) the tarball... Fixed.


---

Comment by ncohen created at 2015-06-30 10:04:14

Why did you remove the `spkg-src` file?


---

Comment by charpent created at 2015-06-30 10:22:50

Replying to [comment:5 ncohen]:

Dear Nathaan,

> Why did you remove the `spkg-src` file?

You advised (see #16711 about upgrade to 3.1.1) adding this file to document the renaming of the tarball (from R-x-y-z.tar.gz to r-x-y-z.tar.gz), needed by the then-current convention of all-lowercase tarball names.

Since this convention has been obsoleted (see #18229 for the previous upgrade to 3.2.0), this renaming is no longer necessary and one can use the original tarball. There is nothing to document. Since, according to [the developer's guide](http://doc.sagemath.org/html/en/developer/packaging.html), this file is optional, it becomes superfluous. QED.

Do you advise keeping a no-op `spkg-src` ?


---

Comment by ncohen created at 2015-06-30 10:37:08

Hellooooooo,

> You advised (see #16711 about upgrade to 3.1.1) adding this file to document the renaming of the tarball (from R-x-y-z.tar.gz to r-x-y-z.tar.gz), needed by the then-current convention of all-lowercase tarball names.

A `spkg-src` file to document a renaming? Why? `O_o`

> Do you advise keeping a no-op `spkg-src` ?

No. I advise to keep a file that re-builds the archive from network ressources only. Then it becomes easier to check that the archive's content is what it should be. I do not see anything wrong with a script that downloads a distant file (whose url is generated from the locally stored version number), and does nothing else to it if there is nothing else to do.

Actually, I will try to solve this once and for all. I'll write some 'sage --sanity-check-package whatever' that uses whatever's spkg-src script (if any), and checks whether the content of the file in `upstream/` matches it.

This way, checking that the archive is legit will only be a call to 'sanity-check'. In this setting, your spkg-src, even though it just downloads something, will be useful.

Nathann


---

Comment by charpent created at 2015-06-30 12:34:38

Replying to [comment:7 ncohen]:
> Hellooooooo,
> 
> > You advised (see #16711 about upgrade to 3.1.1) adding this file to document the renaming of the tarball (from R-x-y-z.tar.gz to r-x-y-z.tar.gz), needed by the then-current convention of all-lowercase tarball names.
> 
> A `spkg-src` file to document a renaming? Why? `O_o`
> 
> > Do you advise keeping a no-op `spkg-src` ?
> 
> No. I advise to keep a file that re-builds the archive from network ressources only.

Please don't do that (unless you have a solid reason to do so) : some firewall setup do exceedingly annoying thing to network downloads. The recent "enhancement" to downloads that tries to select the closest/fastest mirror left me with an unupdateable tree (and, yes, this machines lives behind a "corporate-style" fascist firewall, run by incompetents...). I didn't yet had time to figure out how to unwedge it in order to test your (and vbraun's) solution)....

> Then it becomes easier to check that the archive's content is what it should be. I do not see anything wrong with a script that downloads a distant file (whose url is generated from the locally stored version number), and does nothing else to it if there is nothing else to do.
> 
> Actually, I will try to solve this once and for all. I'll write some 'sage --sanity-check-package whatever' that uses whatever's spkg-src script (if any), and checks whether the content of the file in `upstream/` matches it.
> 
> This way, checking that the archive is legit will only be a call to 'sanity-check'. In this setting, your spkg-src, even though it just downloads something, will be useful.

Again, ponder what you're planning. Im currently in a hell paved of yur good intentins.

Whatever you decide to do, could you please open a SEPARATE ticket, instead of hijacking this innocent R upgrade YET AGAIN (that would be the fourth time...) ? Thanks in advance !


---

Comment by ncohen created at 2015-06-30 12:40:40

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-06-30 12:40:40

> Please don't do that (unless you have a solid reason to do so) : some firewall setup do exceedingly annoying thing to network downloads.

How are the two connected? Nobody will be forced to run the script I just wrote.

> Again, ponder what you're planning. Im currently in a hell paved of yur good intentins.
> 
> Whatever you decide to do, could you please open a SEPARATE ticket, instead of hijacking this innocent R upgrade YET AGAIN (that would be the fourth time...) ? Thanks in advance !

I had no intention to do it here. I was about to mail to sage-devel, as this is a much larger change. What I will do here, however, is ask you to not remove the spkg-src script.

Nathann


---

Comment by ncohen created at 2015-06-30 12:45:15

> > Whatever you decide to do, could you please open a SEPARATE ticket, instead of hijacking this innocent R upgrade YET AGAIN (that would be the fourth time...) ? Thanks in advance !

Please provide the list of the other tickets that you think I hijacked.

Nathann


---

Comment by charpent created at 2015-06-30 13:04:51

Replying to [comment:10 ncohen]:
> > > Whatever you decide to do, could you please open a SEPARATE ticket, instead of hijacking this innocent R upgrade YET AGAIN (that would be the fourth time...) ? Thanks in advance !
> 
> Please provide the list of the other tickets that you think I hijacked.

Whoa ! I didn't say **YOU** hijacked them. Apologies for loose redaction. 

I said that R upgrades (which should be very plain vanilla affairs) seem to attract delays from unrelated issues. From memory (not real time to dig them out)

- Upgrade to 3.2.0 was hijacked by the lowercase-tarball-convention reversing

- A couple of versions before, hijacking for cygnus-building issues

- [ I don't have the exact third issue on hand nor on memory, but I know that the Cignus-related one wasn't the first. I'll have to look with a bit more time ]

So your use of a previously unused spkg-src file would have been the fourth time...

Emmanuel Charpentier


---

Comment by charpent created at 2015-06-30 13:11:35

Replying to [comment:9 ncohen]:
> > Please don't do that (unless you have a solid reason to do so) : some firewall setup do exceedingly annoying thing to network downloads.
> 
> How are the two connected? Nobody will be forced to run the script I just wrote.
> 
> > Again, ponder what you're planning. Im currently in a hell paved of yur good intentins.
> > 
> > Whatever you decide to do, could you please open a SEPARATE ticket, instead of hijacking this innocent R upgrade YET AGAIN (that would be the fourth time...) ? Thanks in advance !
> 
> I had no intention to do it here. I was about to mail to sage-devel, as this is a much larger change. What I will do here, however, is ask you to not remove the spkg-src script.

Okay. I'll post a new commit tonight (can't do that now : I'm at work, and I prepare tickets on a home machine).

I intend to discuss your proposal seriously : it entails creating a spkg-src file for **all** packages, thus making it mandatory. And making mandatory the use of a functional Internet connection for any installation/update. No more updates for an isolated/firewalled machine...

And since we pay this price, it should be logical to limit Sage tarballs to a very bare minimum of sage-specific files and patches.

I'm not sure that's where we should go... But this is the subject of your proposal-to-be, that will be discussed on its ticket.


---

Comment by ncohen created at 2015-06-30 13:45:37

> Whoa ! I didn't say **YOU** hijacked them. Apologies for loose redaction. 

Oh. I did misread it a bit too, apparently. Sorry.

Nathann


---

Comment by ncohen created at 2015-06-30 13:48:08

> I intend to discuss your proposal seriously : it entails creating a spkg-src file for **all** packages, thus making it mandatory. And making mandatory the use of a functional Internet connection for any installation/update. No more updates for an isolated/firewalled machine...

Nonono, it is much more innocent than that. I just want to have some script that reviewers can run whenever they review a package, to make sure everything is fine. I don't plan to make it automatic at all. Just a helper code for reviewers.

> And since we pay this price, it should be logical to limit Sage tarballs to a very bare minimum of sage-specific files and patches.

It would help with that, for sure. There have been recent complaints about how we sometimes change upstream's package, and how it is not always said explicitly.

> I'm not sure that's where we should go... But this is the subject of your proposal-to-be, that will be discussed on its ticket.

On #18826, right.

Nathann


---

Comment by git created at 2015-06-30 19:31:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2015-06-30 19:34:58

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2015-06-30 19:34:58

Nathaan,

Voluntatem tuam satisfeci. Hoc super caput tuum requiet.

Emmanuel Charpentier


---

Comment by ncohen created at 2015-07-01 08:28:52

Hello again,

In its new version, your branch removes *one* line from the spkg-src. It is not that I care much about this line, but rather that the next one has absolutely no meaning: you removed the instruction that moves the archive to upstream/, but left the one which updates the pacakges' checksums using the information from upstream/.

Could you sort this out (in the way that you prefer)? You can then set this ticket to `positive_review`.

THaaaaaaaaaanks,

Nathann


---

Comment by jdemeyer created at 2015-07-01 09:31:25

Given that you're not actually _using_ the `spkg-src` script, why don't you just remove it?


---

Comment by ncohen created at 2015-07-01 09:36:51

> Given that you're not actually _using_ the `spkg-src` script, why don't you just remove it?

He did, and I asked him not to. You can tell from the history of this ticket.

I asked him to keep that file in, because we may need it if we end up using #18826.

Nathann


---

Comment by git created at 2015-07-01 13:20:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-07-01 13:21:34

Hey hey...

It's not exactly what "Could you sort this out (in the way that you prefer)" means.

Nathann


---

Comment by jdemeyer created at 2015-07-01 13:23:03

This `spkg-src` does not produce the tarball in the ticket description.


---

Comment by jdemeyer created at 2015-07-01 13:23:03

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-07-01 13:25:19

..............

What exactly are you trying to achieve, Jeroen ? Let this ticket go, he just wants to upgrade his package and his ticket does the job. His branch does not even touch the spkg-src file. Since when can a reviewer block a ticket like that?

Nathann


---

Comment by ncohen created at 2015-07-01 13:26:58

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2015-07-01 13:28:26

Replying to [comment:24 ncohen]:
> His branch does not even touch the spkg-src file.
Right...


---

Comment by charpent created at 2015-07-01 13:29:23

Replying to [comment:22 ncohen]:
> Hey hey...
> 
> It's not exactly what "Could you sort this out (in the way that you prefer)" means.

Sorry, Nathaan, sorry, Jeroen. I'm still running //Homo Sapiens Sapiens// version 1.0 : no telepathic interface. I do **not** understand nor guess what you two ghouls want.

Please feel free to do it yourself (if you can manage to agree on something...). I might review it.

Emmanuel Charpentier


---

Comment by ncohen created at 2015-07-01 13:32:34

> > It's not exactly what "Could you sort this out (in the way that you prefer)" means.
> 
> Sorry, Nathaan, sorry, Jeroen. I'm still running //Homo Sapiens Sapiens// version 1.0 : no telepathic interface. I do **not** understand nor guess what you two ghouls want.

My message was not clear: I was answering to your commit message. The commit is fine. Your commit message is "Restored ORIGINAL non-functional spkg-src as par Nathaann Cohen's request", which seemed a bit more abrupt than my previous "in the way that you prefer".

The branch is fine, I thank you for doing this last modifications, and I am sorry that we don't seem able in this community to sort this all out while preserving a light mood.

Your branch is okay, and does the job. We will probably rewrite the spkg-src script later anyway, if #18826 ends up being merged.

Nathann


---

Comment by vbraun created at 2015-07-02 20:09:17

Resolution: fixed
