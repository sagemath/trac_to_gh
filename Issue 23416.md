# Issue 23416: py3: fixing the sage-cython script

archive/issues_023416.json:
```json
{
    "body": "CC:  @jdemeyer @jhpalmieri @embray\n\nextracted from #23106\n\nIssue created by migration from https://trac.sagemath.org/ticket/23653\n\n",
    "created_at": "2017-08-19T16:30:11Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: fixing the sage-cython script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23416",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jdemeyer @jhpalmieri @embray

extracted from #23106

Issue created by migration from https://trac.sagemath.org/ticket/23653





---

archive/issue_comments_327332.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327332",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327333.json:
```json
{
    "body": "easy one, please review\n----\nNew commits:",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327333",
    "user": "https://github.com/fchapoton"
}
```

easy one, please review
----
New commits:



---

archive/issue_comments_327334.json:
```json
{
    "body": "I think it's fine. I suppose stylistically some people might prefer\n\n```\ntry:\n    SAGE_SRC = os.environ[\"SAGE_SRC\"]\nexcept KeyError:\n    ...\n```\n\nbut it doesn't matter to me.",
    "created_at": "2017-08-20T20:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327334",
    "user": "https://github.com/jhpalmieri"
}
```

I think it's fine. I suppose stylistically some people might prefer

```
try:
    SAGE_SRC = os.environ["SAGE_SRC"]
except KeyError:
    ...
```

but it doesn't matter to me.



---

archive/issue_comments_327335.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-20T20:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327335",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327336.json:
```json
{
    "body": "Well, I prefer `from sage.env import SAGE_SRC` personally. I am sure my sage-on-distro colleagues are of the same mind. I am not sure why trying to get `SAGE_SRC` from the shell environment is any better or fix anything. Do you want it to work while sage is not installed yet? \n\nBut that brings me to a uglier point. You are using sage's source at run time? OK, you need .pxi files that are not currently installed by \"vanilla\" sage (sage-on-gentoo does so I can point to my sage install instead). And yet another problem with that file is that it is full of .pxi which are currently being systematically phased out.\n\nVolker's already started to merge this ticket so it may be too late, but at least can someone explain the rationale for using `os.environ`?",
    "created_at": "2017-08-22T09:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327336",
    "user": "https://github.com/kiwifb"
}
```

Well, I prefer `from sage.env import SAGE_SRC` personally. I am sure my sage-on-distro colleagues are of the same mind. I am not sure why trying to get `SAGE_SRC` from the shell environment is any better or fix anything. Do you want it to work while sage is not installed yet? 

But that brings me to a uglier point. You are using sage's source at run time? OK, you need .pxi files that are not currently installed by "vanilla" sage (sage-on-gentoo does so I can point to my sage install instead). And yet another problem with that file is that it is full of .pxi which are currently being systematically phased out.

Volker's already started to merge this ticket so it may be too late, but at least can someone explain the rationale for using `os.environ`?



---

archive/issue_comments_327337.json:
```json
{
    "body": "the reason is python3 : under a python3 sage install, \"python\" means python2, so that the import of sage.env would fail. See #23106 for another possibility, namely use \"sage-python23\" in the headline instead of \"python\"",
    "created_at": "2017-08-22T09:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327337",
    "user": "https://github.com/fchapoton"
}
```

the reason is python3 : under a python3 sage install, "python" means python2, so that the import of sage.env would fail. See #23106 for another possibility, namely use "sage-python23" in the headline instead of "python"



---

archive/issue_comments_327338.json:
```json
{
    "body": "I see. I have other tools at my disposal for wrapping python scripts, so that particular issue doesn't exist for me. From sage-on-distro point of view, we are not thrilled by `sage-python23` in scripts. But at least it is easy to spot and fix systematically.",
    "created_at": "2017-08-22T10:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327338",
    "user": "https://github.com/kiwifb"
}
```

I see. I have other tools at my disposal for wrapping python scripts, so that particular issue doesn't exist for me. From sage-on-distro point of view, we are not thrilled by `sage-python23` in scripts. But at least it is easy to spot and fix systematically.



---

archive/issue_comments_327339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-327339",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_021958.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-26T09:57:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23416#event-21958"
}
```
