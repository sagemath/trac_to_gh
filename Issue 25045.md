# Issue 25045: Fix .is_prime() for symbolic expression

archive/issues_025045.json:
```json
{
    "body": "CC:  vdelecroix rws\n\nsage: f(n)=n^2\nsage: f(3).is_prime()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-2-9727cba91e39> in <module>()\n----> 1 f(Integer(3)).is_prime()\n\n/home/vklein/odk/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.is_prime (build/cythonized/sage/structure/element.c:19230)()\n   2741         if not self:  # We exclude the 0 element\n   2742             return False\n-> 2743         return self._parent.ideal(self).is_prime()\n   2744 \n   2745 \n\n/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/ideal.pyc in is_prime(self)\n    822             ass = self.associated_primes()\n    823         except (NotImplementedError, ValueError):\n--> 824             raise NotImplementedError\n    825         if len(ass) != 1:\n    826             return False\n\nNotImplementedError:\n\nIssue created by migration from https://trac.sagemath.org/ticket/25282\n\n",
    "created_at": "2018-05-02T19:33:53Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Fix .is_prime() for symbolic expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25045",
    "user": "vklein"
}
```
CC:  vdelecroix rws

sage: f(n)=n^2
sage: f(3).is_prime()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-2-9727cba91e39> in <module>()
----> 1 f(Integer(3)).is_prime()

/home/vklein/odk/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.is_prime (build/cythonized/sage/structure/element.c:19230)()
   2741         if not self:  # We exclude the 0 element
   2742             return False
-> 2743         return self._parent.ideal(self).is_prime()
   2744 
   2745 

/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/ideal.pyc in is_prime(self)
    822             ass = self.associated_primes()
    823         except (NotImplementedError, ValueError):
--> 824             raise NotImplementedError
    825         if len(ass) != 1:
    826             return False

NotImplementedError:

Issue created by migration from https://trac.sagemath.org/ticket/25282





---

archive/issue_comments_352443.json:
```json
{
    "body": "Set assignee to vklein.",
    "created_at": "2018-05-07T09:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352443",
    "user": "vklein"
}
```

Set assignee to vklein.



---

archive/issue_comments_352444.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-07T11:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352444",
    "user": "vklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_352445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-07T12:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352445",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_352446.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-15T06:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352446",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_352447.json:
```json
{
    "body": "1. Instead of `prime number` I would rather use `prime integer`.\n\n2. Because of the changes in this branch, the following\n\n```\nsage: is_prime(SR(2/3))\nTraceback (most recent call last):\n...\nTypeError: no conversion of this rational to integer\n```\n\n  becomes\n\n```\nsage: is_prime(SR(2/3))\nFalse\n```\n\n  you need to check whether `self.pyobject()` is actually an integer.\n\n3. (possibly for a later ticket) I think that a cleaner way to proceed is to introduce a symbolic `is_prime` function that would also handle variables like\n\n```\nsage: factorial(x)\nfactorial(x)\nsage: factorial(x).subs(x=3)\n6\n```\n\n  In other words the following should ideally work\n\n```\nsage: n = SR.var('n')\nsage: assume(n, 'integer')\nsage: is_prime(n)\nis_prime(n)\nsage: is_prime(n).subs(n=3)\nTrue\n```\n\n  You can have a look at `sage.functions.other`.",
    "created_at": "2018-05-15T06:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352447",
    "user": "vdelecroix"
}
```

1. Instead of `prime number` I would rather use `prime integer`.

2. Because of the changes in this branch, the following

```
sage: is_prime(SR(2/3))
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```

  becomes

```
sage: is_prime(SR(2/3))
False
```

  you need to check whether `self.pyobject()` is actually an integer.

3. (possibly for a later ticket) I think that a cleaner way to proceed is to introduce a symbolic `is_prime` function that would also handle variables like

```
sage: factorial(x)
factorial(x)
sage: factorial(x).subs(x=3)
6
```

  In other words the following should ideally work

```
sage: n = SR.var('n')
sage: assume(n, 'integer')
sage: is_prime(n)
is_prime(n)
sage: is_prime(n).subs(n=3)
True
```

  You can have a look at `sage.functions.other`.



---

archive/issue_comments_352448.json:
```json
{
    "body": "Replying to [comment:10 vdelecroix]:\n> 2. Because of the changes in this branch, the following\n> {{{\n> sage: is_prime(SR(2/3))\n> Traceback (most recent call last):\n> ...\n> TypeError: no conversion of this rational to integer\n> }}}\n>   becomes\n> {{{\n> sage: is_prime(SR(2/3))\n> False\n> }}}\n>   you need to check whether `self.pyobject()` is actually an integer.\\\\\n\nOn the other hand even without this branch we have this :\n\n\n```\nsage: is_prime(2/3)\nFalse\n```\n\n\n\nShouldn't `is_prime(SR(2/3))` and `is_prime(2/3)` behave the same way ?\n\nThe next question is if we want \"This number is not an integer and therefore it is not prime\" or \"This number is not an integer so calling is_prime on it is an error\"",
    "created_at": "2018-05-15T09:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352448",
    "user": "vklein"
}
```

Replying to [comment:10 vdelecroix]:
> 2. Because of the changes in this branch, the following
> {{{
> sage: is_prime(SR(2/3))
> Traceback (most recent call last):
> ...
> TypeError: no conversion of this rational to integer
> }}}
>   becomes
> {{{
> sage: is_prime(SR(2/3))
> False
> }}}
>   you need to check whether `self.pyobject()` is actually an integer.\\

On the other hand even without this branch we have this :


```
sage: is_prime(2/3)
False
```



Shouldn't `is_prime(SR(2/3))` and `is_prime(2/3)` behave the same way ?

The next question is if we want "This number is not an integer and therefore it is not prime" or "This number is not an integer so calling is_prime on it is an error"



---

archive/issue_comments_352449.json:
```json
{
    "body": "Replying to [comment:11 vklein]:\n> Replying to [comment:10 vdelecroix]:\n> > 2. Because of the changes in this branch, the following\n> > {{{\n> > sage: is_prime(SR(2/3))\n> > Traceback (most recent call last):\n> > ...\n> > TypeError: no conversion of this rational to integer\n> > }}}\n> >   becomes\n> > {{{\n> > sage: is_prime(SR(2/3))\n> > False\n> > }}}\n> >   you need to check whether `self.pyobject()` is actually an integer.\\\\\n> \n> On the other hand even without this branch we have this :\n> \n> {{{\n> sage: is_prime(2/3)\n> False\n> }}}\n> \n> \n> Shouldn't `is_prime(SR(2/3))` and `is_prime(2/3)` behave the same way ?\n\nPerhaps.\n\n> The next question is if we want \"This number is not an integer and therefore it is not prime\" or \"This number is not an integer so calling is_prime on it is an error\"\n\nI think so, see https://groups.google.com/forum/#!topic/sage-devel/NN0VP-OVZLw (but definitely a distinct ticket)",
    "created_at": "2018-05-15T12:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352449",
    "user": "vdelecroix"
}
```

Replying to [comment:11 vklein]:
> Replying to [comment:10 vdelecroix]:
> > 2. Because of the changes in this branch, the following
> > {{{
> > sage: is_prime(SR(2/3))
> > Traceback (most recent call last):
> > ...
> > TypeError: no conversion of this rational to integer
> > }}}
> >   becomes
> > {{{
> > sage: is_prime(SR(2/3))
> > False
> > }}}
> >   you need to check whether `self.pyobject()` is actually an integer.\\
> 
> On the other hand even without this branch we have this :
> 
> {{{
> sage: is_prime(2/3)
> False
> }}}
> 
> 
> Shouldn't `is_prime(SR(2/3))` and `is_prime(2/3)` behave the same way ?

Perhaps.

> The next question is if we want "This number is not an integer and therefore it is not prime" or "This number is not an integer so calling is_prime on it is an error"

I think so, see https://groups.google.com/forum/#!topic/sage-devel/NN0VP-OVZLw (but definitely a distinct ticket)



---

archive/issue_comments_352450.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-05-15T13:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352450",
    "user": "vklein"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_352451.json:
```json
{
    "body": "This ticket is on hold. A discussion about what `is_prime` should do is in progress : [\"How much do we support the casual user\"](https://groups.google.com/forum/#!topic/sage-devel/NN0VP-OVZLw).",
    "created_at": "2018-05-15T13:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352451",
    "user": "vklein"
}
```

This ticket is on hold. A discussion about what `is_prime` should do is in progress : ["How much do we support the casual user"](https://groups.google.com/forum/#!topic/sage-devel/NN0VP-OVZLw).



---

archive/issue_comments_352452.json:
```json
{
    "body": "milestone update 8.3 -> 8.4",
    "created_at": "2018-08-03T19:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25045#issuecomment-352452",
    "user": "vdelecroix"
}
```

milestone update 8.3 -> 8.4
