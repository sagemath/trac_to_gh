# Issue 18680: Speed up NumberField.zeta()

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-07-17 20:11:08

CC:  pbruin lorenz roed cremona kedlaya

Use PARI's `nfrootsof1()` function to massively speed up `zeta()`.


---

Comment by chapoton created at 2021-09-03 09:40:22

First remark:

`primitive_root_of_unity` uses `nfrootsof1`

`zeta_order` also.

But `zeta` does not indeed, and factorises a cyclotomic polynomial.


---

Comment by chapoton created at 2022-11-09 14:14:59

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-11-09 14:14:59

New commits:


---

Comment by git created at 2022-11-09 16:15:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-11-09 20:32:36

one should check if this is really faster or not..


---

Comment by chapoton created at 2022-11-10 11:14:34

Before

```
sage: K=NumberField(x**60+691*x**12-25,'a')
sage: %timeit [K.zeta(n,all=True) for n in range(1,25) if not 60%euler_phi(n)]
4.13 s ± 68.4 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

sage: K=NumberField(x**6+691*x**4-25,'a')
sage: %timeit [K.zeta(n,all=True) for n in range(1,25) if not 6%euler_phi(n)]
11.8 ms ± 29.2 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

```

and after:

```
sage: K=NumberField(x**60+691*x**12-25,'a')
sage: %timeit [K.zeta(n,all=True) for n in range(1,25) if not 60%euler_phi(n)]
616 µs ± 5.66 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

sage: K=NumberField(x**6+691*x**4-25,'a')
sage: %timeit [K.zeta(n,all=True) for n in range(1,25) if not 60%euler_phi(n)]
373 µs ± 811 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```



---

Comment by git created at 2022-11-10 11:19:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-11-10 13:36:39

green lights, so please review


---

Comment by roed created at 2022-11-13 21:46:45

Changing status from needs_review to positive_review.


---

Comment by roed created at 2022-11-13 21:46:45

Looks good.


---

Comment by vbraun created at 2022-11-15 23:43:17

Resolution: fixed
