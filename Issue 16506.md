# Issue 16506: Extend IsogenyClass_EC to work over number fields

archive/issues_016506.json:
```json
{
    "body": "Keywords: isogeny class\n\nIf E is an elliptic curve over QQ then E.isogeny_class() is an object of type (class) IsogenyClass_EC which which one can work in a nice way.  This should be extended to number fields.  Two reasons why this is notn-trivial (and hence was not done at the same time as over QQ):  (1) bounding the possible primes degrees of isogenies;  (2) handling curves with CM.  For (1),  the module `gal_reps_number_field` does what is required.  For (2) new code has been written.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16743\n\n",
    "closed_at": "2014-11-15T16:22:41Z",
    "created_at": "2014-07-30T13:20:05Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Extend IsogenyClass_EC to work over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16506",
    "user": "https://github.com/JohnCremona"
}
```
Keywords: isogeny class

If E is an elliptic curve over QQ then E.isogeny_class() is an object of type (class) IsogenyClass_EC which which one can work in a nice way.  This should be extended to number fields.  Two reasons why this is notn-trivial (and hence was not done at the same time as over QQ):  (1) bounding the possible primes degrees of isogenies;  (2) handling curves with CM.  For (1),  the module `gal_reps_number_field` does what is required.  For (2) new code has been written.

Issue created by migration from https://trac.sagemath.org/ticket/16743





---

archive/issue_events_049045.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16506#event-49045"
}
```



---

archive/issue_comments_216848.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2014-08-13T14:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216848",
    "user": "https://github.com/JohnCremona"
}
```

Last 10 new commits:



---

archive/issue_comments_216849.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-13T14:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216849",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216850.json:
```json
{
    "body": "To potential reviewers:  don't be put off by the large number of commits listed, that is just because of the dependencies.  Once the dependencies are accepted there is just one commit which is relevant (3c96a71 #16743: elliptic curve isogeny classes over number fields).",
    "created_at": "2014-08-13T14:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216850",
    "user": "https://github.com/JohnCremona"
}
```

To potential reviewers:  don't be put off by the large number of commits listed, that is just because of the dependencies.  Once the dependencies are accepted there is just one commit which is relevant (3c96a71 #16743: elliptic curve isogeny classes over number fields).



---

archive/issue_comments_216851.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-08-27T14:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_216852.json:
```json
{
    "body": "I added #16806 as a dependency: that ticket concerns Gal Reps over number fields and provides an isogeny_bound() function (method) for those, to which I have added a function reducible_primes() for compatibility with the class for Gal Reps over QQ, which takes the primes in isogeny_bounds() and actually checks if there are isogenies of those degrees.  At the same time I simplified the reducible_primes() method for the Gap Reps class over Q so that it does not compute the whole isogeny class but is slightly more clever, since apart from 2,3,5,7,13 one can tell by looking at a list of special j-invariants.\n\nTODO (but not on this ticket):  unify the two GaloisRepresentation classes!  Perhaps there should be a base class which is rather abstract but defines the interface, with child classes for Galois Reps attached to (1) elliptic curves over number fields, (1') same over QQ, (2) modular forms, etc etc.",
    "created_at": "2014-08-27T14:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216852",
    "user": "https://github.com/JohnCremona"
}
```

I added #16806 as a dependency: that ticket concerns Gal Reps over number fields and provides an isogeny_bound() function (method) for those, to which I have added a function reducible_primes() for compatibility with the class for Gal Reps over QQ, which takes the primes in isogeny_bounds() and actually checks if there are isogenies of those degrees.  At the same time I simplified the reducible_primes() method for the Gap Reps class over Q so that it does not compute the whole isogeny class but is slightly more clever, since apart from 2,3,5,7,13 one can tell by looking at a list of special j-invariants.

TODO (but not on this ticket):  unify the two GaloisRepresentation classes!  Perhaps there should be a base class which is rather abstract but defines the interface, with child classes for Galois Reps attached to (1) elliptic curves over number fields, (1') same over QQ, (2) modular forms, etc etc.



---

archive/issue_comments_216853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-24T12:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216854.json:
```json
{
    "body": "The last push only does one small thing really, the rest being to merge in other branches which have positive review or are merged.  The actual change (\"tweak\") is to the comparison of ideals in number fields using the HNF: we were comparing the values of I.pari_hnf() which is a wrapped Pari GEN, and did not agree with what was intended, which comes from comparing I.pari_hnf().sage().\n\nThis is actually important for the purpose of ordering the primes in a number field, first by norm and then by their HNF.  The observant reviewer may notice one doctest change in the prime_ideals() function, but this is a red herring caused by merging in the pari upgrade to 2.7.1 which gives a different generator for one ideal.  For an actual change which the tweak causes you can look at the two primes of norm 17 in Q(i).",
    "created_at": "2014-09-24T12:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216854",
    "user": "https://github.com/JohnCremona"
}
```

The last push only does one small thing really, the rest being to merge in other branches which have positive review or are merged.  The actual change ("tweak") is to the comparison of ideals in number fields using the HNF: we were comparing the values of I.pari_hnf() which is a wrapped Pari GEN, and did not agree with what was intended, which comes from comparing I.pari_hnf().sage().

This is actually important for the purpose of ordering the primes in a number field, first by norm and then by their HNF.  The observant reviewer may notice one doctest change in the prime_ideals() function, but this is a red herring caused by merging in the pari upgrade to 2.7.1 which gives a different generator for one ideal.  For an actual change which the tweak causes you can look at the two primes of norm 17 in Q(i).



---

archive/issue_comments_216855.json:
```json
{
    "body": "Sorry to bother, but it really would be much better to add the functions which have nothing to do with elliptic curves to the relevant places. For example, `prime_ideals()` should really be a method `prime_ideals_of_bounded_norm()` of `NumberField`. We don't want another #11905.",
    "created_at": "2014-09-24T13:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216855",
    "user": "https://github.com/jdemeyer"
}
```

Sorry to bother, but it really would be much better to add the functions which have nothing to do with elliptic curves to the relevant places. For example, `prime_ideals()` should really be a method `prime_ideals_of_bounded_norm()` of `NumberField`. We don't want another #11905.



---

archive/issue_comments_216856.json:
```json
{
    "body": "Good point, will do.  It's clear for prime_ideals() and hnf_cmp() BUT in the latter case there is already a cmp function for ideals which is very similar but not good for my purposes:  it does not first compare norms, and it uses the pari_hnf directly.  So The simplest thing to do (replace the existing ideal cmp with mine) may cause a lot of annoying doctest changes.  I'll try and see.\n\ncurve_cmp() can be a method of the class for elliptic curves over number fields, or even (almost) for generic elliptic curves as it uses no special number field stuff, just compares the list of a-invariants. Not quite since I replace each ai with its list of coefficients and flatten to get a list of 5*d rational numbers where d is the degree of the field.\n\ncurve_cmp_cm() is a bit of an experiment:  for curves with (rational) CM only.\n\nI really need these comparison functions for ordering of the elliptic curves in a single isogeny class in a deterministic way.  For CM isogeny classes it is nicer to group together the curves whose Endomorphism ring is the same (they are all orders in the same imaginary quadratic field, but can have different indices in the maximal order).  So curve_cmp_cm() is only really relevant in the context of isogeny classes.  Comments?\n\nLastly there are a couple of utility functions concerning binary quadratic forms, which I will put elsewhere.",
    "created_at": "2014-09-24T13:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216856",
    "user": "https://github.com/JohnCremona"
}
```

Good point, will do.  It's clear for prime_ideals() and hnf_cmp() BUT in the latter case there is already a cmp function for ideals which is very similar but not good for my purposes:  it does not first compare norms, and it uses the pari_hnf directly.  So The simplest thing to do (replace the existing ideal cmp with mine) may cause a lot of annoying doctest changes.  I'll try and see.

curve_cmp() can be a method of the class for elliptic curves over number fields, or even (almost) for generic elliptic curves as it uses no special number field stuff, just compares the list of a-invariants. Not quite since I replace each ai with its list of coefficients and flatten to get a list of 5*d rational numbers where d is the degree of the field.

curve_cmp_cm() is a bit of an experiment:  for curves with (rational) CM only.

I really need these comparison functions for ordering of the elliptic curves in a single isogeny class in a deterministic way.  For CM isogeny classes it is nicer to group together the curves whose Endomorphism ring is the same (they are all orders in the same imaginary quadratic field, but can have different indices in the maximal order).  So curve_cmp_cm() is only really relevant in the context of isogeny classes.  Comments?

Lastly there are a couple of utility functions concerning binary quadratic forms, which I will put elsewhere.



---

archive/issue_comments_216857.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-24T13:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216857",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_216858.json:
```json
{
    "body": "OK, so I would like some feedback on the change in ideal comparison.  Quite a lot of doctests will need changing in sage/rings/number_field (I have not yet gone further), which looks bad BUT thee seem to be all due not to the addition of using a norm comparison first, but in the change from comparing pari_hfn() and pari_hnf().sage(), which in particular causes the primes in factorizations to be ordered differently.  This looks like a big negative -- but see my earlier remark:  I don't think we can trust the comparison of two Pari-GEN objects to mean what we think, so that although the old comparison appears to be comaring the HNFs of the ideals, it is not really doing that as far as I can see.",
    "created_at": "2014-09-24T13:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216858",
    "user": "https://github.com/JohnCremona"
}
```

OK, so I would like some feedback on the change in ideal comparison.  Quite a lot of doctests will need changing in sage/rings/number_field (I have not yet gone further), which looks bad BUT thee seem to be all due not to the addition of using a norm comparison first, but in the change from comparing pari_hfn() and pari_hnf().sage(), which in particular causes the primes in factorizations to be ordered differently.  This looks like a big negative -- but see my earlier remark:  I don't think we can trust the comparison of two Pari-GEN objects to mean what we think, so that although the old comparison appears to be comaring the HNFs of the ideals, it is not really doing that as far as I can see.



---

archive/issue_comments_216859.json:
```json
{
    "body": "Replying to [comment:10 cremona]:\n> Good point, will do.  It's clear for prime_ideals() and hnf_cmp() BUT in the latter case there is already a cmp function for ideals which is very similar but not good for my purposes:  it does not first compare norms, and it uses the pari_hnf directly.  So The simplest thing to do (replace the existing ideal cmp with mine) may cause a lot of annoying doctest changes.  I'll try and see.\n\nI don't think this should be the default `cmp()` for ideals (it's more expensive to compute), but it should be function defined in `rings/number_field/number_field_ideal.py`. And why do you need\n\n```\ncmp(I.pari_hnf().sage(), J.pari_hnf().sage())\n```\nas opposed to\n\n```\ncmp(I.pari_hnf(), J.pari_hnf())\n```\nThat's not clear to me...\n\nFinally, a Python tip: you can shorten\n\n```\nt = int(I.norm() - J.norm())\nif t:\n    return cmp(t,0)\n\nreturn cmp(I.pari_hnf().sage(), J.pari_hnf().sage())\n```\nto\n\n```\nreturn cmp(I.norm(), J.norm()) or cmp(I.pari_hnf().sage(), J.pari_hnf().sage())\n```",
    "created_at": "2014-09-24T13:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216859",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 cremona]:
> Good point, will do.  It's clear for prime_ideals() and hnf_cmp() BUT in the latter case there is already a cmp function for ideals which is very similar but not good for my purposes:  it does not first compare norms, and it uses the pari_hnf directly.  So The simplest thing to do (replace the existing ideal cmp with mine) may cause a lot of annoying doctest changes.  I'll try and see.

I don't think this should be the default `cmp()` for ideals (it's more expensive to compute), but it should be function defined in `rings/number_field/number_field_ideal.py`. And why do you need

```
cmp(I.pari_hnf().sage(), J.pari_hnf().sage())
```
as opposed to

```
cmp(I.pari_hnf(), J.pari_hnf())
```
That's not clear to me...

Finally, a Python tip: you can shorten

```
t = int(I.norm() - J.norm())
if t:
    return cmp(t,0)

return cmp(I.pari_hnf().sage(), J.pari_hnf().sage())
```
to

```
return cmp(I.norm(), J.norm()) or cmp(I.pari_hnf().sage(), J.pari_hnf().sage())
```



---

archive/issue_comments_216860.json:
```json
{
    "body": "Replying to [comment:11 cremona]:\n> I don't think we can trust the comparison of two Pari-GEN objects to mean what we think\n\nWhat do you think that comparing HNFs should mean? I don't see a meaningful comparison, we just need it to be consistent.",
    "created_at": "2014-09-24T13:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216860",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 cremona]:
> I don't think we can trust the comparison of two Pari-GEN objects to mean what we think

What do you think that comparing HNFs should mean? I don't see a meaningful comparison, we just need it to be consistent.



---

archive/issue_comments_216861.json:
```json
{
    "body": "Concerning comparisons, there is also #16127 and #17026.",
    "created_at": "2014-09-24T13:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216861",
    "user": "https://github.com/jdemeyer"
}
```

Concerning comparisons, there is also #16127 and #17026.



---

archive/issue_comments_216862.json:
```json
{
    "body": "OK, so here is an example:\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: I = K.ideal(4+i)\nsage: J = K.ideal(4-i)\nsage: HI = I.pari_hnf()\nsage: HJ = J.pari_hnf()\nsage: HIS = HI.sage()\nsage: HJS = HJ.sage()\nsage: cmp(HI,HJ)\n1\nsage: cmp(HIS,HJS)\n-1\n```\nso they diagree.  We have\n\n```\nsage: HI, HJ\n([17, 4; 0, 1], [17, 13; 0, 1])\nsage: HIS, HJS\n(\n[17  4]  [17 13]\n[ 0  1], [ 0  1]\n)\n```\nand I think that I should come before J but using the pari_hnf as is gives the reverse.\n\nBackground: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.  This is a special case: two conjugate primes above a rational prime p which plsits in a quadratic field.  I need to order these, and want to do so using the HNFs which only differ in one entry.  Using pari_hnf is not consistent!  (Try the ideals (2+i) and (2-i) and the pari_hnf's compare \"correctly\".)\n\nI'll have to look at those two other tickets, certainly.  Yet another quagmire!",
    "created_at": "2014-09-24T13:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216862",
    "user": "https://github.com/JohnCremona"
}
```

OK, so here is an example:

```
sage: K.<i> = QuadraticField(-1)
sage: I = K.ideal(4+i)
sage: J = K.ideal(4-i)
sage: HI = I.pari_hnf()
sage: HJ = J.pari_hnf()
sage: HIS = HI.sage()
sage: HJS = HJ.sage()
sage: cmp(HI,HJ)
1
sage: cmp(HIS,HJS)
-1
```
so they diagree.  We have

```
sage: HI, HJ
([17, 4; 0, 1], [17, 13; 0, 1])
sage: HIS, HJS
(
[17  4]  [17 13]
[ 0  1], [ 0  1]
)
```
and I think that I should come before J but using the pari_hnf as is gives the reverse.

Background: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.  This is a special case: two conjugate primes above a rational prime p which plsits in a quadratic field.  I need to order these, and want to do so using the HNFs which only differ in one entry.  Using pari_hnf is not consistent!  (Try the ideals (2+i) and (2-i) and the pari_hnf's compare "correctly".)

I'll have to look at those two other tickets, certainly.  Yet another quagmire!



---

archive/issue_comments_216863.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Finally, a Python tip: you can shorten\n> \n> ```\n> t = int(I.norm() - J.norm())\n> if t:\n>     return cmp(t,0)\n> \n> return cmp(I.pari_hnf().sage(), J.pari_hnf().sage())\n> ```\n> to\n> \n> ```\n> return cmp(I.norm(), J.norm()) or cmp(I.pari_hnf().sage(), J.pari_hnf().sage())\n> ```\n\nBetter yet: define a sorting *key* instead of a comparison function, this is the only(!) way in Python 3 and already works now. Your key would then be the tuple `(norm,hnf)`. See [http://python3porting.com/preparing.html#when-sorting-use-key-instead-of-cmp](http://python3porting.com/preparing.html#when-sorting-use-key-instead-of-cmp)",
    "created_at": "2014-09-24T14:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216863",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 jdemeyer]:
> Finally, a Python tip: you can shorten
> 
> ```
> t = int(I.norm() - J.norm())
> if t:
>     return cmp(t,0)
> 
> return cmp(I.pari_hnf().sage(), J.pari_hnf().sage())
> ```
> to
> 
> ```
> return cmp(I.norm(), J.norm()) or cmp(I.pari_hnf().sage(), J.pari_hnf().sage())
> ```

Better yet: define a sorting *key* instead of a comparison function, this is the only(!) way in Python 3 and already works now. Your key would then be the tuple `(norm,hnf)`. See [http://python3porting.com/preparing.html#when-sorting-use-key-instead-of-cmp](http://python3porting.com/preparing.html#when-sorting-use-key-instead-of-cmp)



---

archive/issue_comments_216864.json:
```json
{
    "body": "Replying to [comment:15 cremona]:\n> I'll have to look at those two other tickets, certainly.\n\nI think that those will solve your problem, since matrices would be compared entry-wise, starting with the first column (top-left entry first, then the one below that).",
    "created_at": "2014-09-24T14:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216864",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 cremona]:
> I'll have to look at those two other tickets, certainly.

I think that those will solve your problem, since matrices would be compared entry-wise, starting with the first column (top-left entry first, then the one below that).



---

archive/issue_comments_216865.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Replying to [comment:15 cremona]:\n> > I'll have to look at those two other tickets, certainly.\n\n> I think that those will solve your problem, since matrices would be compared entry-wise, starting with the first column (top-left entry first, then the one below that).\n\nRight, so I have some work to do, and this ticket will acqure another dependency or two -- I hope those two tickets are not going to get held up!",
    "created_at": "2014-09-24T14:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216865",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:17 jdemeyer]:
> Replying to [comment:15 cremona]:
> > I'll have to look at those two other tickets, certainly.

> I think that those will solve your problem, since matrices would be compared entry-wise, starting with the first column (top-left entry first, then the one below that).

Right, so I have some work to do, and this ticket will acqure another dependency or two -- I hope those two tickets are not going to get held up!



---

archive/issue_comments_216866.json:
```json
{
    "body": "Thanks a lot for your help and suggestions.  I did not need that ideal comparison for this ticket anyway, so I have left alone the ideal comparison function except to tidy the code as you suggested.  the two elliptic curve comparison functions have gone, replaced by little key comparison functions in the code where they are used -- much better and shorter and faster!\n\nI am doing some final testing and then will upload a new branch in which you will find no utility functions in the wrong place.\n\nIn the other tickets where you are dealing with comparing pari objects, good luck:  if you have not already discovered this, you will find that hunderds of number field factorizations have their orders changed....",
    "created_at": "2014-09-24T14:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216866",
    "user": "https://github.com/JohnCremona"
}
```

Thanks a lot for your help and suggestions.  I did not need that ideal comparison for this ticket anyway, so I have left alone the ideal comparison function except to tidy the code as you suggested.  the two elliptic curve comparison functions have gone, replaced by little key comparison functions in the code where they are used -- much better and shorter and faster!

I am doing some final testing and then will upload a new branch in which you will find no utility functions in the wrong place.

In the other tickets where you are dealing with comparing pari objects, good luck:  if you have not already discovered this, you will find that hunderds of number field factorizations have their orders changed....



---

archive/issue_comments_216867.json:
```json
{
    "body": "Replying to [comment:15 cremona]:\n> Background: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.\n\nBefore worrying about ideals, first consider the ring O_K. Since the HNF is essentially coordinates w.r.t. to a basis, the chosen Z-basis of O_K also matters a lot. For quadratic fields, one can easily define a canonical basis, but in higher degree that gets a lot more tricky.",
    "created_at": "2014-09-24T15:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216867",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 cremona]:
> Background: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.

Before worrying about ideals, first consider the ring O_K. Since the HNF is essentially coordinates w.r.t. to a basis, the chosen Z-basis of O_K also matters a lot. For quadratic fields, one can easily define a canonical basis, but in higher degree that gets a lot more tricky.



---

archive/issue_comments_216868.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Replying to [comment:15 cremona]:\n> > Background: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.\n\n> Before worrying about ideals, first consider the ring O_K. Since the HNF is essentially coordinates w.r.t. to a basis, the chosen Z-basis of O_K also matters a lot. For quadratic fields, one can easily define a canonical basis, but in higher degree that gets a lot more tricky.\n\nAbsolutely right!   We have had alot of such discussions with the LMFDB project.  Personally, I will stick to quadratic fields at least as far as making databases of elliptic curves is concerned (though the LMFDB does have some over the cubic field of discriminant -23).....",
    "created_at": "2014-09-24T15:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216868",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:20 jdemeyer]:
> Replying to [comment:15 cremona]:
> > Background: I am making databases of things like elliptic curves over number fields, and am having to be very explicit indeed about how various objects are ordered.

> Before worrying about ideals, first consider the ring O_K. Since the HNF is essentially coordinates w.r.t. to a basis, the chosen Z-basis of O_K also matters a lot. For quadratic fields, one can easily define a canonical basis, but in higher degree that gets a lot more tricky.

Absolutely right!   We have had alot of such discussions with the LMFDB project.  Personally, I will stick to quadratic fields at least as far as making databases of elliptic curves is concerned (though the LMFDB does have some over the cubic field of discriminant -23).....



---

archive/issue_comments_216869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-24T15:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216870.json:
```json
{
    "body": "I hope I have done what was wanted.  On testing the whole library I find some doctest failures which I think were caused by merging the pari 2.7.1 upgrade branch, and I hope they will go away by themselves.  I see that ticket #15767 is merged, but I am not sure whether all of the relevant branch is already merged here.",
    "created_at": "2014-09-24T15:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216870",
    "user": "https://github.com/JohnCremona"
}
```

I hope I have done what was wanted.  On testing the whole library I find some doctest failures which I think were caused by merging the pari 2.7.1 upgrade branch, and I hope they will go away by themselves.  I see that ticket #15767 is merged, but I am not sure whether all of the relevant branch is already merged here.



---

archive/issue_comments_216871.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-24T15:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216871",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_216872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-24T16:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216873.json:
```json
{
    "body": "Oops, forgot to sort the primes using a dual key (norm,ideal).  Note that the order will change after the comparison of pari gen objects changes.",
    "created_at": "2014-09-24T16:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216873",
    "user": "https://github.com/JohnCremona"
}
```

Oops, forgot to sort the primes using a dual key (norm,ideal).  Note that the order will change after the comparison of pari gen objects changes.



---

archive/issue_comments_216874.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-24T18:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216874",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_216875.json:
```json
{
    "body": "Shaks -> Shanks",
    "created_at": "2014-09-24T18:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216875",
    "user": "https://github.com/jdemeyer"
}
```

Shaks -> Shanks



---

archive/issue_comments_216876.json:
```json
{
    "body": "Hurwitx -> Hurwitz",
    "created_at": "2014-09-24T18:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216876",
    "user": "https://github.com/jdemeyer"
}
```

Hurwitx -> Hurwitz



---

archive/issue_comments_216877.json:
```json
{
    "body": "In the implementation of `quadclassunit()`, using `0` for `prec` is wrong. Usually, `prec` arguments are set to `prec_bits_to_words(precision)` where `long precision=0` is the last argument of the Sage method. The `flag` is obsolete and `tech` should best be left alone, so I don't mind that you don't allow to set those.",
    "created_at": "2014-09-24T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216877",
    "user": "https://github.com/jdemeyer"
}
```

In the implementation of `quadclassunit()`, using `0` for `prec` is wrong. Usually, `prec` arguments are set to `prec_bits_to_words(precision)` where `long precision=0` is the last argument of the Sage method. The `flag` is obsolete and `tech` should best be left alone, so I don't mind that you don't allow to set those.



---

archive/issue_comments_216878.json:
```json
{
    "body": "The `EXAMPLES::` blocks in `BinaryQF.solve()` and in `small_prime_value()` are badly indented.",
    "created_at": "2014-09-24T19:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216878",
    "user": "https://github.com/jdemeyer"
}
```

The `EXAMPLES::` blocks in `BinaryQF.solve()` and in `small_prime_value()` are badly indented.



---

archive/issue_comments_216879.json:
```json
{
    "body": "In this `solve()` method, I would prefer it made more clear that you're solving for integers (as opposed to, say, rationals). For example, replace the first line by\n\n```\nSolve `Q(x,y) = n` in integers `x` and `y` where `Q` is this quadratic form.\n```\nIn the light of a future `solve()` for rationals, it might even be good to rename this method `solve_integer()`",
    "created_at": "2014-09-24T19:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216879",
    "user": "https://github.com/jdemeyer"
}
```

In this `solve()` method, I would prefer it made more clear that you're solving for integers (as opposed to, say, rationals). For example, replace the first line by

```
Solve `Q(x,y) = n` in integers `x` and `y` where `Q` is this quadratic form.
```
In the light of a future `solve()` for rationals, it might even be good to rename this method `solve_integer()`



---

archive/issue_comments_216880.json:
```json
{
    "body": "Obvious failure:\n\n```\nsage -t src/sage/rings/number_field/number_field.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field.py\", line 3073, in sage.rings.number_field.number_field.NumberField_generic.primes_of_bounded_norm\nFailed example:\n    K.primes_of_bounded_norm(10)\nExpected:\n    [Fractional ideal (i + 1), Fractional ideal (3), Fractional ideal (-i - 2), Fractional ideal (2*i + 1)]\nGot:\n    [Fractional ideal (i + 1), Fractional ideal (-i - 2), Fractional ideal (2*i + 1), Fractional ideal (3)]\n**********************************************************************\n```",
    "created_at": "2014-09-24T19:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216880",
    "user": "https://github.com/jdemeyer"
}
```

Obvious failure:

```
sage -t src/sage/rings/number_field/number_field.py
**********************************************************************
File "src/sage/rings/number_field/number_field.py", line 3073, in sage.rings.number_field.number_field.NumberField_generic.primes_of_bounded_norm
Failed example:
    K.primes_of_bounded_norm(10)
Expected:
    [Fractional ideal (i + 1), Fractional ideal (3), Fractional ideal (-i - 2), Fractional ideal (2*i + 1)]
Got:
    [Fractional ideal (i + 1), Fractional ideal (-i - 2), Fractional ideal (2*i + 1), Fractional ideal (3)]
**********************************************************************
```



---

archive/issue_comments_216881.json:
```json
{
    "body": "You can simplify\n\n```\nfrom sage.misc.all import flatten\nP = flatten([pp for pp in [self.primes_above(p) for p in primes(B+1)]])\n```\nby\n\n```\nP = [pp for p in primes(B+1) for pp in self.primes_above(p)]\n```\n(note the order of the `for` statements!)",
    "created_at": "2014-09-24T19:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216881",
    "user": "https://github.com/jdemeyer"
}
```

You can simplify

```
from sage.misc.all import flatten
P = flatten([pp for pp in [self.primes_above(p) for p in primes(B+1)]])
```
by

```
P = [pp for p in primes(B+1) for pp in self.primes_above(p)]
```
(note the order of the `for` statements!)



---

archive/issue_comments_216882.json:
```json
{
    "body": "In `primes_of_bounded_norm()`, why `B.ceil()`? This would disallow Python `int`s for no good reason. I think you can remove the whole block\n\n```\ntry:\n    B = ZZ(B.ceil())\nexcept (TypeError, AttributeError):\n    raise TypeError(\"%s is not valid bound on prime ideals\" % B)\n```",
    "created_at": "2014-09-24T19:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216882",
    "user": "https://github.com/jdemeyer"
}
```

In `primes_of_bounded_norm()`, why `B.ceil()`? This would disallow Python `int`s for no good reason. I think you can remove the whole block

```
try:
    B = ZZ(B.ceil())
except (TypeError, AttributeError):
    raise TypeError("%s is not valid bound on prime ideals" % B)
```



---

archive/issue_comments_216883.json:
```json
{
    "body": "I'll make a reviewer patch with these changes...",
    "created_at": "2014-09-24T19:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216883",
    "user": "https://github.com/jdemeyer"
}
```

I'll make a reviewer patch with these changes...



---

archive/issue_comments_216884.json:
```json
{
    "body": "These are some reviewer fixes, however I do not intend to fully review this ticket.\n\n---\nNew commits:",
    "created_at": "2014-09-24T20:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216884",
    "user": "https://github.com/jdemeyer"
}
```

These are some reviewer fixes, however I do not intend to fully review this ticket.

---
New commits:



---

archive/issue_comments_216885.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-24T20:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216885",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_216886.json:
```json
{
    "body": "Thanks a lot for tidying various things up ( at least some of which were not introduced by me, I think!).\n\nWe do need someone with a good knowledge of isogenies to check this.  In writing the code I had to work out quite a lot of mathematics for which I do not know a good source (in the CM and potential CM cases).  I am actually using the code a lot all the time now, on many thousands of curves, which is a good test, but the field degrees are small.\n\nI have merged your changes into my branch so if I make any further changes the branch name will go back to what it was (not that it really matters).  I did this using\n\n```\ngit remote update\ngit merge trac/u/jdemeyer/ticket/16743\nmake\n```\n(in my own local branch), for the record.",
    "created_at": "2014-09-25T08:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216886",
    "user": "https://github.com/JohnCremona"
}
```

Thanks a lot for tidying various things up ( at least some of which were not introduced by me, I think!).

We do need someone with a good knowledge of isogenies to check this.  In writing the code I had to work out quite a lot of mathematics for which I do not know a good source (in the CM and potential CM cases).  I am actually using the code a lot all the time now, on many thousands of curves, which is a good test, but the field degrees are small.

I have merged your changes into my branch so if I make any further changes the branch name will go back to what it was (not that it really matters).  I did this using

```
git remote update
git merge trac/u/jdemeyer/ticket/16743
make
```
(in my own local branch), for the record.



---

archive/issue_comments_216887.json:
```json
{
    "body": "I usually use `./sage -dev` and then you can simply do `./sage -dev pull`.",
    "created_at": "2014-09-25T09:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216887",
    "user": "https://github.com/jdemeyer"
}
```

I usually use `./sage -dev` and then you can simply do `./sage -dev pull`.



---

archive/issue_comments_216888.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-25T09:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216889.json:
```json
{
    "body": "Replying to [comment:40 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                          |                                                 |\n> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n> |[2d89c05](http://git.sagemath.org/sage.git/commit/?id=2d89c050dc89bc4dcb760e3558304c7c61cf119d)|`Add # long time is 2 places where it was needed`|\n\n\nIt's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.",
    "created_at": "2014-09-25T09:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216889",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:40 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                          |                                                 |
> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
> |[2d89c05](http://git.sagemath.org/sage.git/commit/?id=2d89c050dc89bc4dcb760e3558304c7c61cf119d)|`Add # long time is 2 places where it was needed`|


It's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.



---

archive/issue_comments_216890.json:
```json
{
    "body": "Replying to [comment:41 cremona]:\n> It's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.\n\nNo no, it is because those 2 tests depend on an earlier `# long time` test. The following doesn't work:\n\n```\nsage: x = answer_to_the_ultimate_question()  # long time (7.5 million years)\nsage: x\n42\n```\nIf you run this without `--long` the first line will be skipped and the second line will therefore fail.",
    "created_at": "2014-09-25T09:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216890",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:41 cremona]:
> It's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.

No no, it is because those 2 tests depend on an earlier `# long time` test. The following doesn't work:

```
sage: x = answer_to_the_ultimate_question()  # long time (7.5 million years)
sage: x
42
```
If you run this without `--long` the first line will be skipped and the second line will therefore fail.



---

archive/issue_comments_216891.json:
```json
{
    "body": "Replying to [comment:42 jdemeyer]:\n> Replying to [comment:41 cremona]:\n> > It's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.\n\n> No no, it is because those 2 tests depend on an earlier `# long time` test. The following doesn't work:\n> {{{\n> sage: x = answer_to_the_ultimate_question()  # long time (7.5 million years)\n> sage: x\n> 42\n> }}}\n> If you run this without `--long` the first line will be skipped and the second line will therefore fail.\n\n\nOf course, my stupidity.",
    "created_at": "2014-09-25T12:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216891",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:42 jdemeyer]:
> Replying to [comment:41 cremona]:
> > It's pretty shocking that to take a list of 4 elliptic curves and compute their j-invariants and count the distinct ones takes a long time!  Even if it is over a number field of degree 6.  But so be it.

> No no, it is because those 2 tests depend on an earlier `# long time` test. The following doesn't work:
> {{{
> sage: x = answer_to_the_ultimate_question()  # long time (7.5 million years)
> sage: x
> 42
> }}}
> If you run this without `--long` the first line will be skipped and the second line will therefore fail.


Of course, my stupidity.



---

archive/issue_comments_216892.json:
```json
{
    "body": "Note to potential reviewers:  Jeroen has reviewed the Sage-technical aspects of this, but we need someone to vouch for its mathematical correctness.  For curves without CM there was little to do given the dependent tickets (now closed) which give the finite list of prime degrees to test, as the structure of the code already existed for curves over Q.  The main thing which needs to be looked at is the CM case, where I had to work out several things myself, not knowing of suitable references.",
    "created_at": "2014-09-25T12:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216892",
    "user": "https://github.com/JohnCremona"
}
```

Note to potential reviewers:  Jeroen has reviewed the Sage-technical aspects of this, but we need someone to vouch for its mathematical correctness.  For curves without CM there was little to do given the dependent tickets (now closed) which give the finite list of prime degrees to test, as the structure of the code already existed for curves over Q.  The main thing which needs to be looked at is the CM case, where I had to work out several things myself, not knowing of suitable references.



---

archive/issue_comments_216893.json:
```json
{
    "body": "I spotted that one of the commits of #16806 does not seem to be included in this :\n\nhttp://git.sagemath.org/sage.git/commit/?h=8c9301671b354f7ba6c24d48f28d0e2b0698f39f\n\nNot sure this is important, but it seems the right thing to include it if it is depending on that ticket.\n\nI fear I won't have time to check the maths anytime soon. But I put it on my list of things to do.",
    "created_at": "2014-09-25T13:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216893",
    "user": "https://github.com/categorie"
}
```

I spotted that one of the commits of #16806 does not seem to be included in this :

http://git.sagemath.org/sage.git/commit/?h=8c9301671b354f7ba6c24d48f28d0e2b0698f39f

Not sure this is important, but it seems the right thing to include it if it is depending on that ticket.

I fear I won't have time to check the maths anytime soon. But I put it on my list of things to do.



---

archive/issue_comments_216894.json:
```json
{
    "body": "Replying to [comment:44 cremona]:\n> Note to potential reviewers:  Jeroen has reviewed the Sage-technical aspects of this\n\nTo be more precise, let's say I reviewed everything outside of `src/sage/schemes/elliptic_curves`\n\nWhile skimming through the rest of the patch, I just noticed several `# not tested` for the graphs. Any reason?",
    "created_at": "2014-09-25T13:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216894",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:44 cremona]:
> Note to potential reviewers:  Jeroen has reviewed the Sage-technical aspects of this

To be more precise, let's say I reviewed everything outside of `src/sage/schemes/elliptic_curves`

While skimming through the rest of the patch, I just noticed several `# not tested` for the graphs. Any reason?



---

archive/issue_comments_216895.json:
```json
{
    "body": "You are right, and while  think the system would deal with this automatically (it's your addition to include new stuff in the ref manual, right?) I'll merge that in.",
    "created_at": "2014-09-25T13:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216895",
    "user": "https://github.com/JohnCremona"
}
```

You are right, and while  think the system would deal with this automatically (it's your addition to include new stuff in the ref manual, right?) I'll merge that in.



---

archive/issue_comments_216896.json:
```json
{
    "body": "Sorry, my comment was in reply to Chris.  I have merged in the commit he mentioned (and then switched back the branch of this ticket to my name, ha ha).\n\nTo answer Jeroen:  I think I was under the impression that displaying graphs during testing would create problems, while it is nice to have the examples in the manual.  If it is harmless then we can remove these tags.",
    "created_at": "2014-09-25T13:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216896",
    "user": "https://github.com/JohnCremona"
}
```

Sorry, my comment was in reply to Chris.  I have merged in the commit he mentioned (and then switched back the branch of this ticket to my name, ha ha).

To answer Jeroen:  I think I was under the impression that displaying graphs during testing would create problems, while it is nice to have the examples in the manual.  If it is harmless then we can remove these tags.



---

archive/issue_comments_216897.json:
```json
{
    "body": "A quick look at the doc output shows quite a few problems in isogeny_class of elliptic curves over number fields.",
    "created_at": "2014-09-25T14:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216897",
    "user": "https://github.com/categorie"
}
```

A quick look at the doc output shows quite a few problems in isogeny_class of elliptic curves over number fields.



---

archive/issue_comments_216898.json:
```json
{
    "body": "Replying to [comment:49 wuthrich]:\n> A quick look at the doc output shows quite a few problems in isogeny_class of elliptic curves over number fields.\n\n\nApologies.  I will sort that out, no need for you to.",
    "created_at": "2014-09-25T14:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216898",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:49 wuthrich]:
> A quick look at the doc output shows quite a few problems in isogeny_class of elliptic curves over number fields.


Apologies.  I will sort that out, no need for you to.



---

archive/issue_comments_216899.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-25T14:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216899",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_216900.json:
```json
{
    "body": "Replying to [comment:48 cremona]:\n> I was under the impression that displaying graphs during testing would create problems, while it is nice to have the examples in the manual.  If it is harmless then we can remove these tags.\n\nPlease do! Graphics objects are doctested by plotting them to a temporary file. It's good to have those tests, since they check that plotting works (to some extent, it's not checked how the picture looks like).\n\nNote that this plotting machinery might take a while, so it would be prudent to add `# long time` to those plotting tests.",
    "created_at": "2014-09-25T14:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216900",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:48 cremona]:
> I was under the impression that displaying graphs during testing would create problems, while it is nice to have the examples in the manual.  If it is harmless then we can remove these tags.

Please do! Graphics objects are doctested by plotting them to a temporary file. It's good to have those tests, since they check that plotting works (to some extent, it's not checked how the picture looks like).

Note that this plotting machinery might take a while, so it would be prudent to add `# long time` to those plotting tests.



---

archive/issue_comments_216901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-25T15:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216902.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-25T15:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216902",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_216903.json:
```json
{
    "body": "OK, I fixed the documentation display problem in ell_number_field (and a typo), and changed the \"not tested\" graph displays with \"long time\" which revealed 2 typos there which have been fixed (I had a matplotlib parameter as \"edges_labels\" twice.\n\nNext!\n\n---\nNew commits:",
    "created_at": "2014-09-25T15:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216903",
    "user": "https://github.com/JohnCremona"
}
```

OK, I fixed the documentation display problem in ell_number_field (and a typo), and changed the "not tested" graph displays with "long time" which revealed 2 typos there which have been fixed (I had a matplotlib parameter as "edges_labels" twice.

Next!

---
New commits:



---

archive/issue_comments_216904.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T13:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216905.json:
```json
{
    "body": "ping!",
    "created_at": "2014-10-28T13:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216905",
    "user": "https://github.com/JohnCremona"
}
```

ping!



---

archive/issue_comments_216906.json:
```json
{
    "body": "pong!\n\nI thought I would improve the documentation a little bit by including the isogeny class file into it. Other than that I can't see any reason to object against this ticket.\n\nI am running the tests now.\n\nAs to the mathematics in here. Well, there is a lot and not all is trivial. I have read most of the new code, but I won't be able to verify everything. So my review is to confirm that John does very good work and that I have no doubts that it is as good as it can be. \n\n---\nNew commits:",
    "created_at": "2014-10-30T12:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216906",
    "user": "https://github.com/categorie"
}
```

pong!

I thought I would improve the documentation a little bit by including the isogeny class file into it. Other than that I can't see any reason to object against this ticket.

I am running the tests now.

As to the mathematics in here. Well, there is a lot and not all is trivial. I have read most of the new code, but I won't be able to verify everything. So my review is to confirm that John does very good work and that I have no doubts that it is as good as it can be. 

---
New commits:



---

archive/issue_comments_216907.json:
```json
{
    "body": "Thanks, Chris.    Of course there may well still be bugs, as always.  The code was tested against completely independent determination of complete isogeny classes for a lot of curves over Q(sqrt(5)) and the cubic field of discriminant -23, and we find the same curves.  That did not test the hardest part (namely the CM cases) though where I have done some systematic testing over imaginary quadratic fields of class number 1.",
    "created_at": "2014-10-30T12:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216907",
    "user": "https://github.com/JohnCremona"
}
```

Thanks, Chris.    Of course there may well still be bugs, as always.  The code was tested against completely independent determination of complete isogeny classes for a lot of curves over Q(sqrt(5)) and the cubic field of discriminant -23, and we find the same curves.  That did not test the hardest part (namely the CM cases) though where I have done some systematic testing over imaginary quadratic fields of class number 1.



---

archive/issue_comments_216908.json:
```json
{
    "body": "The tests passed.\n\nI also played a bit around. Seems all ok to me.",
    "created_at": "2014-10-30T17:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216908",
    "user": "https://github.com/categorie"
}
```

The tests passed.

I also played a bit around. Seems all ok to me.



---

archive/issue_comments_216909.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-30T17:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216909",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_049046.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-15T16:22:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16506#event-49046"
}
```



---

archive/issue_comments_216910.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-15T16:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16506#issuecomment-216910",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
