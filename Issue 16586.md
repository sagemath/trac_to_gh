# Issue 16586: Implement the free Lie algebra

Issue created by migration from https://trac.sagemath.org/ticket/16823

Original creator: tscrim

Original creation time: 2014-08-14 10:53:56

Assignee: tscrim

CC:  sd67 bsalisbury1

Keywords: lie algebras

Part of #14901. Implements the free Lie algebra in two different bases.


---

Comment by tscrim created at 2015-04-14 15:18:17

Last 10 new commits:


---

Comment by tscrim created at 2015-04-14 15:18:17

Changing status from new to needs_review.


---

Comment by git created at 2015-10-11 19:18:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2015-10-11 19:21:52

New commits:


---

Comment by git created at 2016-06-02 13:35:09

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-04-01 23:36:48

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-04-13 21:41:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2017-04-13 23:13:03

Travis: What Hall basis is this? Are you following a specific source? There are many different Hall bases, and the simplest one (I believe using the lexicographic order) is just the Lyndon basis IIRC; hence the question.


---

Comment by git created at 2017-04-13 23:14:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-14 00:28:12

IIRC, I followed [MKO1998], which I thought was based on Hall's original construction, but I can't seem to find that reference. I am not tied to the name, and another name might be better if someone wants to implement the other 2 "natural" Hall set based bases. It's up to you.

Also, we should get rid of this filter:

```diff
-cf = filter(lambda x: x != 0, c)
+cf = [x for x in c if x != 0]
```

Just below that, we could also do:

```diff
-                nonzero_indices = []
-                for i in range(len(c)):
-                    if c[i] != 0:
-                        nonzero_indices.append(i)
+                nonzero_indices = [i for i,val in enumerate(c) if val != 0]
```

I can make these changes if you want.


---

Comment by darij created at 2017-04-14 00:53:56

Would be great if you did them. I squinted with some unease at the filter as well, but I thought you had a rationale for using it :)


---

Comment by tscrim created at 2017-04-14 00:54:58

Old code, back before I knew as much as I do now.


---

Comment by git created at 2017-04-23 22:30:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-04-23 22:33:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-23 22:34:04

This makes the changes I noted in comment:10, as well as making it Python3 compatible and full doctest coverage (I missed one hidden method).


---

Comment by git created at 2017-06-05 13:57:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-05 18:34:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-06-17 06:00:11

does not apply


---

Comment by chapoton created at 2017-06-17 06:00:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-06-17 06:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-06-17 06:13:16

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-06-20 06:15:19

doc does not build

```
+[dochtml] OSError: [groups   ] /home/chapoton/sage/local/lib/python2.7/site-packages/sage/groups/matrix_gps/finitely_generated.py:docstring of sage.groups.matrix_gps.finitely_generated.FinitelyGeneratedMatrixGroup_gap.invariant_generators:59: WARNING: citation not found: Stu1993
```



---

Comment by chapoton created at 2017-06-21 07:00:14

Changing status from needs_review to needs_work.


---

Comment by darij created at 2017-06-21 20:35:09

Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?

Doc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).

I'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.

Based on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.

Where did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided ("Elements of the same length are ordered internally as we please"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.

Also, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.


---

Comment by git created at 2017-06-23 00:23:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-23 00:28:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-06-23 00:45:56

Replying to [comment:25 darij]:
> Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?

Yep, bad merge.

> Doc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).

Done.

> I'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.

It makes no sense anywhere else as this is the only class that has elements stored as trees of Lie brackets.

> Based on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.

Not quite. This is a shortcut for creating elements of the free Lie algebra without explicitly specifying the basis (think `SymmetricFunctions`). If you create the Hall basis, which is a separate object, then you have a different `lie_algebra_generators`.

> Where did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided ("Elements of the same length are ordered internally as we please"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.

For the most part, it was far too long ago that I wrote this that I do not really remember. I am pretty sure I used [MKO...], but I can't say for certain. However, length := degree in this construction. Feel free to change what you want, but I know this works. IIRC, it agrees with the monomials in [MKO...]. As you point out, there are a number of different Hall sets (well, really I think there are 4 by fundamentally playing two types of left vs right games), and the code seems very sensitive when things are not correct (infinite recursions).

> Also, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.

It is precisely what it says it is: it is a Lie bracket with a grading. In particular, we use the natural grading of generators being degree 1. However, it is basically a helper class used to construct the basis elements and not really meant to be manipulated by the user.


---

Comment by tscrim created at 2017-11-04 05:42:11

Bringing over the side discussion from #24144: If you're worried about the Hall basis, then how about I mark it as `experimental` (yes, there something for that similar to `deprecation`). I recall doing a fair bit of testing with it, so I have some confidence it is solid. However, I am willing to give somewhat to get some implementation of the free Lie algebra into Sage. Moreover, if there are serious problems, we can always fix them on later tickets (Sage reviews do not have to be as thorough as math reviews `:)`).


---

Comment by tscrim created at 2017-11-04 05:43:34

So if you're willing to review everything else now and simply mark the Hall as experimental (unless you find a bug if you do look at it), then I can rebase the ticket with that added in.


---

Comment by darij created at 2017-11-04 05:43:53

Please do so!


---

Comment by git created at 2017-11-04 06:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-11-04 06:13:11

Done.

Note that this will trivially conflict with #24134. So if this is positively reviewed before #24134 is merged, then we will merge it in here. However, we will not do it beforehand.

Edit - Need the right ticket number.


---

Comment by tscrim created at 2017-11-04 06:13:11

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-11-21 11:01:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-12-20 09:24:38

This needs a non-fully-trivial rebase, that I did not know how to do myself.


---

Comment by chapoton created at 2017-12-20 09:24:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-12-20 11:09:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-12-20 11:10:14

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-12-20 11:10:14

Wasn't too bad.


---

Comment by git created at 2017-12-28 01:22:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-12-28 02:09:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-12-29 02:18:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-12-30 19:37:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2017-12-30 19:39:44

TODO:

* Review Hall basis. (Which Hall set and which ordering does it use?)

* Extend Lyndon and Hall basis to arbitrary orderings perhaps. (Next ticket.)

* If you don't like my doc for the helper classes, please suggest better alternatives. Doc is highly necessary there. These classes *are* exposed: they are the parents for basis indices, and so will be relevant to anyone defining e.g. maps out of a free Lie algebra. And their use is sufficiently complex that a grep doesn't answer the questions (this is where I got stuck trying to review the ticket months ago).


---

Comment by git created at 2017-12-31 14:24:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-13 19:57:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2018-04-13 20:02:40

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-04-13 20:04:42

Thank you. See #25166 for a follow-up.


---

Comment by vbraun created at 2018-05-06 10:47:49

PDF docs don't build


---

Comment by vbraun created at 2018-05-06 10:47:49

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-05-06 21:34:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2018-05-06 21:41:34

Better now? I regret I can't test PDF output on the university machine where I have sage installed (latexmk is missing).


---

Comment by darij created at 2018-05-06 21:41:34

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2018-05-06 22:20:16

I am testing it right now.


---

Comment by tscrim created at 2018-05-06 22:20:16

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-05-06 22:45:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-06 22:45:48

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-05-06 22:45:48

I was able to build the pdf with these changes.


---

Comment by vbraun created at 2018-05-09 09:50:01

Resolution: fixed
