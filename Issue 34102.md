# Issue 34102: Speedup adding horizontal and vertical border strips

Issue created by migration from https://trac.sagemath.org/ticket/34339

Original creator: tscrim

Original creation time: 2022-08-11 01:35:29

CC:  tkarn aschilling nthiery darij zabrocki

Keywords: combinat, partition

We can be better about the number of conjugations involved.


---

Comment by tscrim created at 2022-08-11 02:38:03

With my branch, this is now

```
sage: %timeit Partition([2,2]).add_vertical_border_strip(2)
57.9 µs ± 484 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([3,2,2]).add_vertical_border_strip(2)
101 µs ± 1.02 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([7,4,2,2,2,1,1]).add_vertical_border_strip(5)  # 43 partitions
871 µs ± 6.03 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

sage: %timeit Partition([2,2]).add_horizontal_border_strip(2)
54.6 µs ± 388 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([3,2,2]).add_horizontal_border_strip(2)
99.3 µs ± 1.01 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([7,4,2,2,2,1,1]).add_horizontal_border_strip(5)  # 43 partitions
908 µs ± 3.09 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
sage: %timeit Partition([5,4,3,2,1]).add_horizontal_border_strip(5)  # 32 partitions
769 µs ± 2.95 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```

versus before:

```
109 µs ± 650 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
170 µs ± 1.31 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
1.32 ms ± 5.69 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

99.2 µs ± 773 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
158 µs ± 559 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
1.15 ms ± 4.29 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
997 µs ± 4.7 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```

The output order of the `add_horizontal_border_strip()` has changed, but this should be inconsequential.
----
New commits:


---

Comment by tscrim created at 2022-08-11 02:38:03

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-08-11 17:51:15

pathbot reports a failing doctest in `src/sage/tests/book_schilling_zabrocki_kschur_primer`


---

Comment by git created at 2022-08-12 05:45:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-12 05:45:46

Fixed.


---

Comment by chapoton created at 2022-08-12 18:16:58

ok, let's move on


---

Comment by chapoton created at 2022-08-12 18:16:58

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-08-13 02:18:45

Thank you.


---

Comment by vbraun created at 2022-08-30 06:51:26

Resolution: fixed
