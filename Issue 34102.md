# Issue 34102: Speedup adding horizontal and vertical border strips

archive/issues_034102.json:
```json
{
    "body": "CC:  tkarn aschilling nthiery darij zabrocki\n\nKeywords: combinat, partition\n\nWe can be better about the number of conjugations involved.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34339\n\n",
    "created_at": "2022-08-11T01:35:29Z",
    "labels": [
        "performance",
        "major",
        "enhancement"
    ],
    "title": "Speedup adding horizontal and vertical border strips",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34102",
    "user": "tscrim"
}
```
CC:  tkarn aschilling nthiery darij zabrocki

Keywords: combinat, partition

We can be better about the number of conjugations involved.

Issue created by migration from https://trac.sagemath.org/ticket/34339





---

archive/issue_comments_483723.json:
```json
{
    "body": "With my branch, this is now\n\n```\nsage: %timeit Partition([2,2]).add_vertical_border_strip(2)\n57.9 \u00b5s \u00b1 484 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit Partition([3,2,2]).add_vertical_border_strip(2)\n101 \u00b5s \u00b1 1.02 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit Partition([7,4,2,2,2,1,1]).add_vertical_border_strip(5)  # 43 partitions\n871 \u00b5s \u00b1 6.03 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n\nsage: %timeit Partition([2,2]).add_horizontal_border_strip(2)\n54.6 \u00b5s \u00b1 388 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit Partition([3,2,2]).add_horizontal_border_strip(2)\n99.3 \u00b5s \u00b1 1.01 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit Partition([7,4,2,2,2,1,1]).add_horizontal_border_strip(5)  # 43 partitions\n908 \u00b5s \u00b1 3.09 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\nsage: %timeit Partition([5,4,3,2,1]).add_horizontal_border_strip(5)  # 32 partitions\n769 \u00b5s \u00b1 2.95 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n```\n\nversus before:\n\n```\n109 \u00b5s \u00b1 650 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n170 \u00b5s \u00b1 1.31 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n1.32 ms \u00b1 5.69 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n\n99.2 \u00b5s \u00b1 773 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n158 \u00b5s \u00b1 559 ns per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\n1.15 ms \u00b1 4.29 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n997 \u00b5s \u00b1 4.7 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n```\n\nThe output order of the `add_horizontal_border_strip()` has changed, but this should be inconsequential.\n----\nNew commits:",
    "created_at": "2022-08-11T02:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483723",
    "user": "tscrim"
}
```

With my branch, this is now

```
sage: %timeit Partition([2,2]).add_vertical_border_strip(2)
57.9 µs ± 484 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([3,2,2]).add_vertical_border_strip(2)
101 µs ± 1.02 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([7,4,2,2,2,1,1]).add_vertical_border_strip(5)  # 43 partitions
871 µs ± 6.03 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

sage: %timeit Partition([2,2]).add_horizontal_border_strip(2)
54.6 µs ± 388 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([3,2,2]).add_horizontal_border_strip(2)
99.3 µs ± 1.01 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit Partition([7,4,2,2,2,1,1]).add_horizontal_border_strip(5)  # 43 partitions
908 µs ± 3.09 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
sage: %timeit Partition([5,4,3,2,1]).add_horizontal_border_strip(5)  # 32 partitions
769 µs ± 2.95 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```

versus before:

```
109 µs ± 650 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
170 µs ± 1.31 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
1.32 ms ± 5.69 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)

99.2 µs ± 773 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
158 µs ± 559 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
1.15 ms ± 4.29 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
997 µs ± 4.7 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```

The output order of the `add_horizontal_border_strip()` has changed, but this should be inconsequential.
----
New commits:



---

archive/issue_comments_483724.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-11T02:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483724",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483725.json:
```json
{
    "body": "pathbot reports a failing doctest in `src/sage/tests/book_schilling_zabrocki_kschur_primer`",
    "created_at": "2022-08-11T17:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483725",
    "user": "chapoton"
}
```

pathbot reports a failing doctest in `src/sage/tests/book_schilling_zabrocki_kschur_primer`



---

archive/issue_comments_483726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-12T05:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483726",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483727.json:
```json
{
    "body": "Fixed.",
    "created_at": "2022-08-12T05:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483727",
    "user": "tscrim"
}
```

Fixed.



---

archive/issue_comments_483728.json:
```json
{
    "body": "ok, let's move on",
    "created_at": "2022-08-12T18:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483728",
    "user": "chapoton"
}
```

ok, let's move on



---

archive/issue_comments_483729.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-12T18:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483729",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483730.json:
```json
{
    "body": "Thank you.",
    "created_at": "2022-08-13T02:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483730",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_483731.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-30T06:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34102#issuecomment-483731",
    "user": "vbraun"
}
```

Resolution: fixed
