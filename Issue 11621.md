# Issue 11621: autogenerate doc directories in sage-maketest

archive/issues_011621.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  leif jdemeyer\n\nThe script `sage-maketest` is supposed to test everything in the Sage library, but it says\n\n```\n\"$SAGE_ROOT\"/sage -t -sagenb \"$@\" \"$SAGE_ROOT\"/devel/sage/doc/common \"$SAGE_ROOT\"/devel/sage/doc/en \"$SAGE_ROOT\"/devel/sage/doc/fr  \"$SAGE_ROOT\"/devel/sage/sage 2>&1 | tee -a \"$SAGE_TEST_LOG\"\n```\n\nThe relatively new directories .../doc/de and .../doc/ru are not there.  We should autogenerate this list.  The same goes for the script `sage-apply-ticket`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11793\n\n",
    "created_at": "2011-09-13T00:01:09Z",
    "labels": [
        "doctest coverage",
        "major",
        "bug"
    ],
    "title": "autogenerate doc directories in sage-maketest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11621",
    "user": "jhpalmieri"
}
```
Assignee: mvngu

CC:  leif jdemeyer

The script `sage-maketest` is supposed to test everything in the Sage library, but it says

```
"$SAGE_ROOT"/sage -t -sagenb "$@" "$SAGE_ROOT"/devel/sage/doc/common "$SAGE_ROOT"/devel/sage/doc/en "$SAGE_ROOT"/devel/sage/doc/fr  "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

The relatively new directories .../doc/de and .../doc/ru are not there.  We should autogenerate this list.  The same goes for the script `sage-apply-ticket`.

Issue created by migration from https://trac.sagemath.org/ticket/11793





---

archive/issue_comments_131304.json:
```json
{
    "body": "The attached patch is not perfect; a shell script guru could help here.  See the comment on line 36 of the patched `sage-maketest`.",
    "created_at": "2011-09-13T00:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131304",
    "user": "jhpalmieri"
}
```

The attached patch is not perfect; a shell script guru could help here.  See the comment on line 36 of the patched `sage-maketest`.



---

archive/issue_comments_131305.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-13T00:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131305",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131306.json:
```json
{
    "body": "Leif: can you provide any feedback on this, especially the issue raised in line 36 of the patch to sage-maketest?",
    "created_at": "2011-10-30T03:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131306",
    "user": "jhpalmieri"
}
```

Leif: can you provide any feedback on this, especially the issue raised in line 36 of the patch to sage-maketest?



---

archive/issue_comments_131307.json:
```json
{
    "body": "Replying to [ticket:11793 jhpalmieri]:\n> The script `sage-maketest` is supposed to test everything in the Sage library, but it says\n\n```\n\"$SAGE_ROOT\"/sage -t -sagenb \"$@\" \"$SAGE_ROOT\"/devel/sage/doc/common \"$SAGE_ROOT\"/devel/sage/doc/en \"$SAGE_ROOT\"/devel/sage/doc/fr  \"$SAGE_ROOT\"/devel/sage/sage 2>&1 | tee -a \"$SAGE_TEST_LOG\"\n```\n\n> The relatively new directories .../doc/de and .../doc/ru are not there.\n\nWhy not\n\n```sh\n\"$SAGE_ROOT\"/sage -t -sagenb \"$@\" \\\n    \"$SAGE_ROOT\"/devel/sage/doc/common \\\n    \"$SAGE_ROOT\"/devel/sage/doc/?? \\\n    \"$SAGE_ROOT\"/devel/sage/sage 2>&1 | tee -a \"$SAGE_TEST_LOG\"\n```\n\nor use `[a-z][a-z}` instead of `??`.\n\nThese should always be two-letter country codes, ASCII.",
    "created_at": "2011-10-30T04:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131307",
    "user": "leif"
}
```

Replying to [ticket:11793 jhpalmieri]:
> The script `sage-maketest` is supposed to test everything in the Sage library, but it says

```
"$SAGE_ROOT"/sage -t -sagenb "$@" "$SAGE_ROOT"/devel/sage/doc/common "$SAGE_ROOT"/devel/sage/doc/en "$SAGE_ROOT"/devel/sage/doc/fr  "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

> The relatively new directories .../doc/de and .../doc/ru are not there.

Why not

```sh
"$SAGE_ROOT"/sage -t -sagenb "$@" \
    "$SAGE_ROOT"/devel/sage/doc/common \
    "$SAGE_ROOT"/devel/sage/doc/?? \
    "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

or use `[a-z][a-z}` instead of `??`.

These should always be two-letter country codes, ASCII.



---

archive/issue_comments_131308.json:
```json
{
    "body": "We should IMHO stop to build (and hence test) **all** languages by default since doing so just wastes time and disk space and doesn't make sense.\n\nMaybe always build \"en\", and also what's in `SAGE_LANGUAGE` or `SAGE_LANGUAGES`.",
    "created_at": "2011-10-30T05:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131308",
    "user": "leif"
}
```

We should IMHO stop to build (and hence test) **all** languages by default since doing so just wastes time and disk space and doesn't make sense.

Maybe always build "en", and also what's in `SAGE_LANGUAGE` or `SAGE_LANGUAGES`.



---

archive/issue_comments_131309.json:
```json
{
    "body": "You could also use\n\n```sh\nlang_dirs=`cd \"$SAGE_ROOT\"/devel/sage/doc/output/html/ && ls -1d ??`\n```\n\n(Again, perhaps use `[a-z][a-z]`.)",
    "created_at": "2011-10-30T05:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131309",
    "user": "leif"
}
```

You could also use

```sh
lang_dirs=`cd "$SAGE_ROOT"/devel/sage/doc/output/html/ && ls -1d ??`
```

(Again, perhaps use `[a-z][a-z]`.)



---

archive/issue_comments_131310.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> You could also use\n\n```sh\nlang_dirs=`cd \"$SAGE_ROOT\"/devel/sage/doc/output/html/ && ls -1d ??`\n```\n\n> (Again, perhaps use `[a-z][a-z]`.)\n\nI mean that gives you a list of the languages, without the full path.\n\nOmit the `cd` and prepend the path to `??` if you need the full path.",
    "created_at": "2011-10-30T05:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131310",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> You could also use

```sh
lang_dirs=`cd "$SAGE_ROOT"/devel/sage/doc/output/html/ && ls -1d ??`
```

> (Again, perhaps use `[a-z][a-z]`.)

I mean that gives you a list of the languages, without the full path.

Omit the `cd` and prepend the path to `??` if you need the full path.



---

archive/issue_comments_131311.json:
```json
{
    "body": "If you want to avoid trouble with spaces in `$f`, use\n\n```sh\ndocdirs=\"$docdirs '$f'\"\n```\n\n\nBut that's not necessary if you just use the shell's file pattern matching as given above.",
    "created_at": "2011-10-30T05:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131311",
    "user": "leif"
}
```

If you want to avoid trouble with spaces in `$f`, use

```sh
docdirs="$docdirs '$f'"
```


But that's not necessary if you just use the shell's file pattern matching as given above.



---

archive/issue_comments_131312.json:
```json
{
    "body": "Thanks for the suggestions.  I think using `[a-z][a-z]` is clear and definitely accomplishes what we want.  I think I'll change that in the `Makefile`, too.  New patches attached.\n\nAs far as testing, I think we need to make sure to test everything, every time.  This is one of the underlying philosophies of Sage.  For example, if we don't test the Russian documentation by default, it might get tested very rarely, and not on a wide variety of platforms, and so failures might slip through.  As you probably know, the documentation in the different languages is not very well synchronized, so testing the different languages may actually run different tests.  It's also not bad to make sure testing keeps working with unicode files.  Also, there isn't much documentation not in English right now, so this won't slow things down much.\n\nFor building, it doesn't take long to build the non-English documentation.  If the reference manual ever gets translated, then it would make a lot of sense to only build the appropriate versions, but the rest of the docs are quick to build.  Regardless, I don't want to address this here.",
    "created_at": "2011-11-02T02:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131312",
    "user": "jhpalmieri"
}
```

Thanks for the suggestions.  I think using `[a-z][a-z]` is clear and definitely accomplishes what we want.  I think I'll change that in the `Makefile`, too.  New patches attached.

As far as testing, I think we need to make sure to test everything, every time.  This is one of the underlying philosophies of Sage.  For example, if we don't test the Russian documentation by default, it might get tested very rarely, and not on a wide variety of platforms, and so failures might slip through.  As you probably know, the documentation in the different languages is not very well synchronized, so testing the different languages may actually run different tests.  It's also not bad to make sure testing keeps working with unicode files.  Also, there isn't much documentation not in English right now, so this won't slow things down much.

For building, it doesn't take long to build the non-English documentation.  If the reference manual ever gets translated, then it would make a lot of sense to only build the appropriate versions, but the rest of the docs are quick to build.  Regardless, I don't want to address this here.



---

archive/issue_comments_131313.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-11-02T08:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131313",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131314.json:
```json
{
    "body": "Why do we need `sage-maketest` in the first place?  All other test targets (`testall`, `testlong`, `ptest`,...) simply use the top-level `Makefile`.  Why does `make test` need to be special?\n\nIn any case, needs_work because the `Makefile` patch should be rebased to #11926 + #11959.",
    "created_at": "2011-11-02T08:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131314",
    "user": "jdemeyer"
}
```

Why do we need `sage-maketest` in the first place?  All other test targets (`testall`, `testlong`, `ptest`,...) simply use the top-level `Makefile`.  Why does `make test` need to be special?

In any case, needs_work because the `Makefile` patch should be rebased to #11926 + #11959.



---

archive/issue_comments_131315.json:
```json
{
    "body": "Apologies, it *does* apply on top of #11926 and #11959 (it conflicts with #11969 but you don't need to rebase to that).\n\nLine 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?",
    "created_at": "2011-11-02T08:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131315",
    "user": "jdemeyer"
}
```

Apologies, it *does* apply on top of #11926 and #11959 (it conflicts with #11969 but you don't need to rebase to that).

Line 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?



---

archive/issue_comments_131316.json:
```json
{
    "body": "Attachment\n\nscripts repo",
    "created_at": "2011-11-02T17:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131316",
    "user": "jhpalmieri"
}
```

Attachment

scripts repo



---

archive/issue_comments_131317.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-11-02T17:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131317",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_131318.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> Line 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?\n\nYes, fixed.",
    "created_at": "2011-11-02T17:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131318",
    "user": "jhpalmieri"
}
```

Replying to [comment:11 jdemeyer]:
> Line 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?

Yes, fixed.



---

archive/issue_comments_131319.json:
```json
{
    "body": "Rebased to Sage 5.0.beta8.",
    "created_at": "2012-03-21T21:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131319",
    "user": "jhpalmieri"
}
```

Rebased to Sage 5.0.beta8.



---

archive/issue_comments_131320.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-05-28T23:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131320",
    "user": "mhansen"
}
```

Attachment



---

archive/issue_comments_131321.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-28T23:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131321",
    "user": "mhansen"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_131322.json:
```json
{
    "body": "I'm okay with trac_11793-makefile.patch and trac_11793.v2.patch.  I've added trac_11793-main.patch which should apply to the main repo and autogenerate LANGUAGES in build_options.py \n\nJohn, could you look over this.  Assuming that's okay, I think we can give this a positive review.",
    "created_at": "2012-05-28T23:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131322",
    "user": "mhansen"
}
```

I'm okay with trac_11793-makefile.patch and trac_11793.v2.patch.  I've added trac_11793-main.patch which should apply to the main repo and autogenerate LANGUAGES in build_options.py 

John, could you look over this.  Assuming that's okay, I think we can give this a positive review.



---

archive/issue_comments_131323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-29T18:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131323",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_131324.json:
```json
{
    "body": "Your change looks good to me.",
    "created_at": "2012-05-29T18:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131324",
    "user": "jhpalmieri"
}
```

Your change looks good to me.



---

archive/issue_comments_131325.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131325",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_131326.json:
```json
{
    "body": "Attachment\n\nroot repo",
    "created_at": "2012-06-18T13:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11621#issuecomment-131326",
    "user": "jdemeyer"
}
```

Attachment

root repo
