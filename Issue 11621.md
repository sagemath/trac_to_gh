# Issue 11621: autogenerate doc directories in sage-maketest

Issue created by migration from https://trac.sagemath.org/ticket/11793

Original creator: jhpalmieri

Original creation time: 2011-09-13 00:01:09

Assignee: mvngu

CC:  leif jdemeyer

The script `sage-maketest` is supposed to test everything in the Sage library, but it says

```
"$SAGE_ROOT"/sage -t -sagenb "$@" "$SAGE_ROOT"/devel/sage/doc/common "$SAGE_ROOT"/devel/sage/doc/en "$SAGE_ROOT"/devel/sage/doc/fr  "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

The relatively new directories .../doc/de and .../doc/ru are not there.  We should autogenerate this list.  The same goes for the script `sage-apply-ticket`.


---

Comment by jhpalmieri created at 2011-09-13 00:04:40

The attached patch is not perfect; a shell script guru could help here.  See the comment on line 36 of the patched `sage-maketest`.


---

Comment by jhpalmieri created at 2011-09-13 00:04:40

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2011-10-30 03:21:47

Leif: can you provide any feedback on this, especially the issue raised in line 36 of the patch to sage-maketest?


---

Comment by leif created at 2011-10-30 04:55:35

Replying to [ticket:11793 jhpalmieri]:
> The script `sage-maketest` is supposed to test everything in the Sage library, but it says

```
"$SAGE_ROOT"/sage -t -sagenb "$@" "$SAGE_ROOT"/devel/sage/doc/common "$SAGE_ROOT"/devel/sage/doc/en "$SAGE_ROOT"/devel/sage/doc/fr  "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

> The relatively new directories .../doc/de and .../doc/ru are not there.

Why not

```sh
"$SAGE_ROOT"/sage -t -sagenb "$@" \
    "$SAGE_ROOT"/devel/sage/doc/common \
    "$SAGE_ROOT"/devel/sage/doc/?? \
    "$SAGE_ROOT"/devel/sage/sage 2>&1 | tee -a "$SAGE_TEST_LOG"
```

or use `[a-z][a-z}` instead of `??`.

These should always be two-letter country codes, ASCII.


---

Comment by leif created at 2011-10-30 05:01:57

We should IMHO stop to build (and hence test) *all* languages by default since doing so just wastes time and disk space and doesn't make sense.

Maybe always build "en", and also what's in `SAGE_LANGUAGE` or `SAGE_LANGUAGES`.


---

Comment by leif created at 2011-10-30 05:05:51

You could also use

```sh
lang_dirs=`cd "$SAGE_ROOT"/devel/sage/doc/output/html/ && ls -1d ??`
```

(Again, perhaps use `[a-z][a-z]`.)


---

Comment by leif created at 2011-10-30 05:08:38

Replying to [comment:5 leif]:
> You could also use

```sh
lang_dirs=`cd "$SAGE_ROOT"/devel/sage/doc/output/html/ && ls -1d ??`
```

> (Again, perhaps use `[a-z][a-z]`.)

I mean that gives you a list of the languages, without the full path.

Omit the `cd` and prepend the path to `??` if you need the full path.


---

Comment by leif created at 2011-10-30 05:13:33

If you want to avoid trouble with spaces in `$f`, use

```sh
docdirs="$docdirs '$f'"
```


But that's not necessary if you just use the shell's file pattern matching as given above.


---

Comment by jhpalmieri created at 2011-11-02 02:22:21

Thanks for the suggestions.  I think using `[a-z][a-z]` is clear and definitely accomplishes what we want.  I think I'll change that in the `Makefile`, too.  New patches attached.

As far as testing, I think we need to make sure to test everything, every time.  This is one of the underlying philosophies of Sage.  For example, if we don't test the Russian documentation by default, it might get tested very rarely, and not on a wide variety of platforms, and so failures might slip through.  As you probably know, the documentation in the different languages is not very well synchronized, so testing the different languages may actually run different tests.  It's also not bad to make sure testing keeps working with unicode files.  Also, there isn't much documentation not in English right now, so this won't slow things down much.

For building, it doesn't take long to build the non-English documentation.  If the reference manual ever gets translated, then it would make a lot of sense to only build the appropriate versions, but the rest of the docs are quick to build.  Regardless, I don't want to address this here.


---

Comment by jdemeyer created at 2011-11-02 08:38:28

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-11-02 08:38:28

Why do we need `sage-maketest` in the first place?  All other test targets (`testall`, `testlong`, `ptest`,...) simply use the top-level `Makefile`.  Why does `make test` need to be special?

In any case, needs_work because the `Makefile` patch should be rebased to #11926 + #11959.


---

Comment by jdemeyer created at 2011-11-02 08:46:53

Apologies, it _does_ apply on top of #11926 and #11959 (it conflicts with #11969 but you don't need to rebase to that).

Line 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?


---

Attachment

scripts repo


---

Comment by jhpalmieri created at 2011-11-02 17:05:45

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2011-11-02 17:05:45

Replying to [comment:11 jdemeyer]:
> Line 31 of `sage-apply-ticket`: shouldn't `ROOT` be `SAGE_ROOT`?

Yes, fixed.


---

Comment by jhpalmieri created at 2012-03-21 21:21:31

Rebased to Sage 5.0.beta8.


---

Attachment


---

Comment by mhansen created at 2012-05-28 23:22:15

Changing keywords from "" to "sd40.5".


---

Comment by mhansen created at 2012-05-28 23:22:15

I'm okay with trac_11793-makefile.patch and trac_11793.v2.patch.  I've added trac_11793-main.patch which should apply to the main repo and autogenerate LANGUAGES in build_options.py 

John, could you look over this.  Assuming that's okay, I think we can give this a positive review.


---

Comment by jhpalmieri created at 2012-05-29 18:39:13

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-05-29 18:39:13

Your change looks good to me.


---

Comment by jdemeyer created at 2012-06-18 10:23:09

Resolution: fixed


---

Attachment

root repo
