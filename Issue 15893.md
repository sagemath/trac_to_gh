# Issue 15893: Matrices over Universal Cyclotomic field failing to echelonize/inverse

archive/issues_015893.json:
```json
{
    "body": "CC:  sage-combinat nthiery stumpc5 vripoll\n\nKeywords: cyclotomic field, matrix, echelon form, inverse, days57\n\nHere is an instance of smallest failing example.\n\n\n```\n    sage: UCF.<E>=UniversalCyclotomicField()\n    sage: MS=MatrixSpace(UCF,2,2)\n    sage: bad_mat=MS([-4, 2*E(7)^6, -5*E(13)^3 + 5*E(13)^8 - 4*E(13)^9, 0]) #this matrix was obtained via random_element\n    sage: bad_mat._echelon_classical()\n    Traceback (most recent call last)\n    [...]\n    OverflowError: value too large to convert to int\n    sage: bad_mat.inverse()\n    Traceback (most recent call last)\n    [...]\n    NotImplementedError: value too large to convert to int\n    Echelon form not implemented over 'Universal Cyclotomic Field'.\n```\n\n\nThe error handling of inverse should be looked at to reflect the origin of the error. In this case, that the echelonize method converts to integers and therefore fails for too big denominators but is still implemented over Universal Cyclotomic Field. For example, the following case does work:\n\n\n```\n    sage: good_mat=MS([E(4), 0, -2*E(17)^2 - 4*E(17)^3, -2])\n    sage: good_mat.echelon_form()\n    [1 0]\n    [0 1]\n    sage: good_mat.inverse()\n    [                -E(4)                     0]\n    [E(68)^25 + 2*E(68)^29                  -1/2]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16130\n\n",
    "created_at": "2014-04-11T08:53:59Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Matrices over Universal Cyclotomic field failing to echelonize/inverse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15893",
    "user": "jipilab"
}
```
CC:  sage-combinat nthiery stumpc5 vripoll

Keywords: cyclotomic field, matrix, echelon form, inverse, days57

Here is an instance of smallest failing example.


```
    sage: UCF.<E>=UniversalCyclotomicField()
    sage: MS=MatrixSpace(UCF,2,2)
    sage: bad_mat=MS([-4, 2*E(7)^6, -5*E(13)^3 + 5*E(13)^8 - 4*E(13)^9, 0]) #this matrix was obtained via random_element
    sage: bad_mat._echelon_classical()
    Traceback (most recent call last)
    [...]
    OverflowError: value too large to convert to int
    sage: bad_mat.inverse()
    Traceback (most recent call last)
    [...]
    NotImplementedError: value too large to convert to int
    Echelon form not implemented over 'Universal Cyclotomic Field'.
```


The error handling of inverse should be looked at to reflect the origin of the error. In this case, that the echelonize method converts to integers and therefore fails for too big denominators but is still implemented over Universal Cyclotomic Field. For example, the following case does work:


```
    sage: good_mat=MS([E(4), 0, -2*E(17)^2 - 4*E(17)^3, -2])
    sage: good_mat.echelon_form()
    [1 0]
    [0 1]
    sage: good_mat.inverse()
    [                -E(4)                     0]
    [E(68)^25 + 2*E(68)^29                  -1/2]
```


Issue created by migration from https://trac.sagemath.org/ticket/16130





---

archive/issue_comments_206406.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-04-11T08:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206406",
    "user": "jipilab"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_206407.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to number fields.",
    "created_at": "2014-04-11T08:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206407",
    "user": "jipilab"
}
```

Changing component from PLEASE CHANGE to number fields.



---

archive/issue_comments_206408.json:
```json
{
    "body": "Hello,\n\nIn #18152, I reimplemented the universal cyclotomic field using libgap (faster and more reliable). In that version the issue disappears. My goal would be to close this ticket as \"won't fix\" as soon as #18152 would be reviewed.\n\nVincent",
    "created_at": "2015-04-09T22:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206408",
    "user": "vdelecroix"
}
```

Hello,

In #18152, I reimplemented the universal cyclotomic field using libgap (faster and more reliable). In that version the issue disappears. My goal would be to close this ticket as "won't fix" as soon as #18152 would be reviewed.

Vincent



---

archive/issue_comments_206409.json:
```json
{
    "body": "Hi Vincent,\n\nThis is great! Looking forward to it!\n\nJean-Philippe",
    "created_at": "2015-04-10T06:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206409",
    "user": "jipilab"
}
```

Hi Vincent,

This is great! Looking forward to it!

Jean-Philippe



---

archive/issue_comments_206410.json:
```json
{
    "body": "Hi Jean-Philippe,\n\nIt can be even faster if you review it!\n\nVincent",
    "created_at": "2015-04-10T15:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206410",
    "user": "vdelecroix"
}
```

Hi Jean-Philippe,

It can be even faster if you review it!

Vincent



---

archive/issue_comments_206411.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-24T13:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206411",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_206412.json:
```json
{
    "body": "Now works with libgap version",
    "created_at": "2015-05-24T13:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206412",
    "user": "chapoton"
}
```

Now works with libgap version



---

archive/issue_comments_206413.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-25T10:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206413",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_206414.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-19T08:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15893#issuecomment-206414",
    "user": "vbraun"
}
```

Resolution: fixed
