# Issue 11003: abs(pi+I) = pi+I

archive/issues_011003.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  burcin\n\nabs(pi+I) returns pi+I\n\none would have expected:\nsqrt(pi^2+1)\n\nIssue created by migration from https://trac.sagemath.org/ticket/11155\n\n",
    "created_at": "2011-04-08T03:36:25Z",
    "labels": [
        "PLEASE CHANGE",
        "minor",
        "bug"
    ],
    "title": "abs(pi+I) = pi+I",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11003",
    "user": "benreynwar"
}
```
Assignee: tbd

CC:  burcin

abs(pi+I) returns pi+I

one would have expected:
sqrt(pi^2+1)

Issue created by migration from https://trac.sagemath.org/ticket/11155





---

archive/issue_comments_119586.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to symbolics.",
    "created_at": "2011-04-14T01:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119586",
    "user": "kcrisman"
}
```

Changing component from PLEASE CHANGE to symbolics.



---

archive/issue_comments_119587.json:
```json
{
    "body": "In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.  Thanks for the bug report; mathematically incorrect is definitely bad!\n\nI can confirm this.  Moving to major.  \n\nNote the following.\n\n```\nsage: abs(pi+i)\npi + I\nsage: abs(1+i)\nsqrt(2)\nsage: abs(n(pi)+i)\n3.29690830947562\n```\n\n\nPynac is somehow missing this.  Note that it gets e right.\n\n```\nsage: abs(e+i)\nabs(e + I)\n```\n",
    "created_at": "2011-04-14T01:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119587",
    "user": "kcrisman"
}
```

In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.  Thanks for the bug report; mathematically incorrect is definitely bad!

I can confirm this.  Moving to major.  

Note the following.

```
sage: abs(pi+i)
pi + I
sage: abs(1+i)
sqrt(2)
sage: abs(n(pi)+i)
3.29690830947562
```


Pynac is somehow missing this.  Note that it gets e right.

```
sage: abs(e+i)
abs(e + I)
```




---

archive/issue_comments_119588.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2011-04-14T01:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119588",
    "user": "kcrisman"
}
```

Changing priority from minor to major.



---

archive/issue_comments_119589.json:
```json
{
    "body": "Changing assignee from tbd to burcin.",
    "created_at": "2011-04-14T01:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119589",
    "user": "kcrisman"
}
```

Changing assignee from tbd to burcin.



---

archive/issue_comments_119590.json:
```json
{
    "body": "I can confirm this further.  It's mathematically seriously incorrect... so now moving from major to critical, and cc'ing burcin.\n\nNote: \n\n\n```\nsage: z = pi + i\nsage: abs(z)\npi + I\nsage: sqrt((z*z.conjugate()).expand())\nsqrt(pi^2 + 1)\n```\n",
    "created_at": "2012-02-26T19:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119590",
    "user": "was"
}
```

I can confirm this further.  It's mathematically seriously incorrect... so now moving from major to critical, and cc'ing burcin.

Note: 


```
sage: z = pi + i
sage: abs(z)
pi + I
sage: sqrt((z*z.conjugate()).expand())
sqrt(pi^2 + 1)
```




---

archive/issue_comments_119591.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2012-02-26T19:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119591",
    "user": "was"
}
```

Changing priority from major to critical.



---

archive/issue_comments_119592.json:
```json
{
    "body": "Reported to the ginac-devel list:\n\nhttp://thread.gmane.org/gmane.comp.mathematics.ginac.devel/1363\n\nMore detailed about the problem are in my message linked above.",
    "created_at": "2012-02-28T11:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119592",
    "user": "burcin"
}
```

Reported to the ginac-devel list:

http://thread.gmane.org/gmane.comp.mathematics.ginac.devel/1363

More detailed about the problem are in my message linked above.



---

archive/issue_comments_119593.json:
```json
{
    "body": "Apparently [already fixed](http://article.gmane.org/gmane.comp.mathematics.ginac.devel/1365)!",
    "created_at": "2012-02-28T19:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119593",
    "user": "kcrisman"
}
```

Apparently [already fixed](http://article.gmane.org/gmane.comp.mathematics.ginac.devel/1365)!



---

archive/issue_comments_119594.json:
```json
{
    "body": "[Here](http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=05b3a16973aad40a9c17ee0f0bd06b02ac4706ef;hp=4077d8b144e2e5f3db75cf95fbb590981b2eb8d4) is the diff.\n\n\n```diff\ndiff --git a/check/exam_numeric.cpp b/check/exam_numeric.cpp\nindex 715acff..d5ae27b 100644 (file)\n--- a/check/exam_numeric.cpp\n+++ b/check/exam_numeric.cpp\n@@ -68,6 +68,11 @@ static unsigned exam_numeric1()\n                     << \" erroneously not recognized as complex rational\" << endl;\n                ++result;\n        }\n+       if (test_crat.info(info_flags::nonnegative)) {\n+               clog << test_crat\n+                    << \" erroneously recognized as non-negative number\" << endl;\n+               ++result;\n+       }\n        \n        int i = numeric(1984).to_int();\n        if (i-1984) {\ndiff --git a/ginac/numeric.cpp b/ginac/numeric.cpp\nindex f05763d..18725b2 100644 (file)\n--- a/ginac/numeric.cpp\n+++ b/ginac/numeric.cpp\n@@ -700,7 +700,7 @@ bool numeric::info(unsigned inf) const\n                case info_flags::negative:\n                        return is_negative();\n                case info_flags::nonnegative:\n-                       return !is_negative();\n+                       return is_zero() || is_positive();\n                case info_flags::posint:\n                        return is_pos_integer();\n                case info_flags::negint:\n```\n",
    "created_at": "2012-02-28T19:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119594",
    "user": "kcrisman"
}
```

[Here](http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=05b3a16973aad40a9c17ee0f0bd06b02ac4706ef;hp=4077d8b144e2e5f3db75cf95fbb590981b2eb8d4) is the diff.


```diff
diff --git a/check/exam_numeric.cpp b/check/exam_numeric.cpp
index 715acff..d5ae27b 100644 (file)
--- a/check/exam_numeric.cpp
+++ b/check/exam_numeric.cpp
@@ -68,6 +68,11 @@ static unsigned exam_numeric1()
                     << " erroneously not recognized as complex rational" << endl;
                ++result;
        }
+       if (test_crat.info(info_flags::nonnegative)) {
+               clog << test_crat
+                    << " erroneously recognized as non-negative number" << endl;
+               ++result;
+       }
        
        int i = numeric(1984).to_int();
        if (i-1984) {
diff --git a/ginac/numeric.cpp b/ginac/numeric.cpp
index f05763d..18725b2 100644 (file)
--- a/ginac/numeric.cpp
+++ b/ginac/numeric.cpp
@@ -700,7 +700,7 @@ bool numeric::info(unsigned inf) const
                case info_flags::negative:
                        return is_negative();
                case info_flags::nonnegative:
-                       return !is_negative();
+                       return is_zero() || is_positive();
                case info_flags::posint:
                        return is_pos_integer();
                case info_flags::negint:
```




---

archive/issue_comments_119595.json:
```json
{
    "body": "Making this change in Pynac does fix it:\n\n```\nsage: abs(pi+i)\nabs(pi + I)\nsage: abs(pi+i).n()\n3.29690830947562\n```\n\nSo now we just need to package this up.  See #12501 for the most recently merged Pynac.",
    "created_at": "2012-03-01T03:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119595",
    "user": "kcrisman"
}
```

Making this change in Pynac does fix it:

```
sage: abs(pi+i)
abs(pi + I)
sage: abs(pi+i).n()
3.29690830947562
```

So now we just need to package this up.  See #12501 for the most recently merged Pynac.



---

archive/issue_comments_119596.json:
```json
{
    "body": "Attachment [trac_11155-doctest.patch](tarball://root/attachments/some-uuid/ticket11155/trac_11155-doctest.patch) by titusn created at 2012-05-12 07:59:16\n\nPull request of the patch to the main repository https://bitbucket.org/burcin/pynac/pull-request/1/bugfix-numeric-info-nonnegative-correctly",
    "created_at": "2012-05-12T07:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119596",
    "user": "titusn"
}
```

Attachment [trac_11155-doctest.patch](tarball://root/attachments/some-uuid/ticket11155/trac_11155-doctest.patch) by titusn created at 2012-05-12 07:59:16

Pull request of the patch to the main repository https://bitbucket.org/burcin/pynac/pull-request/1/bugfix-numeric-info-nonnegative-correctly



---

archive/issue_comments_119597.json:
```json
{
    "body": "Pynac 0.2.4 available in #12950 contains the upstream fix. This ticket can be closed once that is merged.",
    "created_at": "2012-05-15T22:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119597",
    "user": "burcin"
}
```

Pynac 0.2.4 available in #12950 contains the upstream fix. This ticket can be closed once that is merged.



---

archive/issue_comments_119598.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-23T17:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119598",
    "user": "burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_119599.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-23T17:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119599",
    "user": "burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_119600.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-14T06:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11003#issuecomment-119600",
    "user": "jdemeyer"
}
```

Resolution: fixed
