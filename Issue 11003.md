# Issue 11003: abs(pi+I) = pi+I

Issue created by migration from https://trac.sagemath.org/ticket/11155

Original creator: benreynwar

Original creation time: 2011-04-08 03:36:25

Assignee: tbd

CC:  burcin

abs(pi+I) returns pi+I

one would have expected:
sqrt(pi^2+1)


---

Comment by kcrisman created at 2011-04-14 01:56:46

Changing component from PLEASE CHANGE to symbolics.


---

Comment by kcrisman created at 2011-04-14 01:56:46

In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.  Thanks for the bug report; mathematically incorrect is definitely bad!

I can confirm this.  Moving to major.  

Note the following.

```
sage: abs(pi+i)
pi + I
sage: abs(1+i)
sqrt(2)
sage: abs(n(pi)+i)
3.29690830947562
```


Pynac is somehow missing this.  Note that it gets e right.

```
sage: abs(e+i)
abs(e + I)
```



---

Comment by kcrisman created at 2011-04-14 01:56:46

Changing priority from minor to major.


---

Comment by kcrisman created at 2011-04-14 01:56:46

Changing assignee from tbd to burcin.


---

Comment by was created at 2012-02-26 19:38:47

I can confirm this further.  It's mathematically seriously incorrect... so now moving from major to critical, and cc'ing burcin.

Note: 


```
sage: z = pi + i
sage: abs(z)
pi + I
sage: sqrt((z*z.conjugate()).expand())
sqrt(pi^2 + 1)
```



---

Comment by was created at 2012-02-26 19:38:47

Changing priority from major to critical.


---

Comment by burcin created at 2012-02-28 11:06:05

Reported to the ginac-devel list:

http://thread.gmane.org/gmane.comp.mathematics.ginac.devel/1363

More detailed about the problem are in my message linked above.


---

Comment by kcrisman created at 2012-02-28 19:46:24

Apparently [already fixed](http://article.gmane.org/gmane.comp.mathematics.ginac.devel/1365)!


---

Comment by kcrisman created at 2012-02-28 19:49:04

[Here](http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=05b3a16973aad40a9c17ee0f0bd06b02ac4706ef;hp=4077d8b144e2e5f3db75cf95fbb590981b2eb8d4) is the diff.


```diff
diff --git a/check/exam_numeric.cpp b/check/exam_numeric.cpp
index 715acff..d5ae27b 100644 (file)
--- a/check/exam_numeric.cpp
+++ b/check/exam_numeric.cpp
@@ -68,6 +68,11 @@ static unsigned exam_numeric1()
                     << " erroneously not recognized as complex rational" << endl;
                ++result;
        }
+       if (test_crat.info(info_flags::nonnegative)) {
+               clog << test_crat
+                    << " erroneously recognized as non-negative number" << endl;
+               ++result;
+       }
        
        int i = numeric(1984).to_int();
        if (i-1984) {
diff --git a/ginac/numeric.cpp b/ginac/numeric.cpp
index f05763d..18725b2 100644 (file)
--- a/ginac/numeric.cpp
+++ b/ginac/numeric.cpp
@@ -700,7 +700,7 @@ bool numeric::info(unsigned inf) const
                case info_flags::negative:
                        return is_negative();
                case info_flags::nonnegative:
-                       return !is_negative();
+                       return is_zero() || is_positive();
                case info_flags::posint:
                        return is_pos_integer();
                case info_flags::negint:
```



---

Comment by kcrisman created at 2012-03-01 03:56:12

Making this change in Pynac does fix it:

```
sage: abs(pi+i)
abs(pi + I)
sage: abs(pi+i).n()
3.29690830947562
```

So now we just need to package this up.  See #12501 for the most recently merged Pynac.


---

Attachment

Pull request of the patch to the main repository https://bitbucket.org/burcin/pynac/pull-request/1/bugfix-numeric-info-nonnegative-correctly


---

Comment by burcin created at 2012-05-15 22:34:45

Pynac 0.2.4 available in #12950 contains the upstream fix. This ticket can be closed once that is merged.


---

Comment by burcin created at 2012-05-23 17:31:41

Changing status from new to needs_review.


---

Comment by burcin created at 2012-05-23 17:32:09

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-14 06:37:54

Resolution: fixed
