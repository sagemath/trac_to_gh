# Issue 10784: composition and comparison of number-field homomorphisms

Issue created by migration from Trac.

Original creator: fwclarke

Original creation time: 2011-02-25 09:53:28

Assignee: davidloeffler

CC:  simonking

As of 4.6.2.rc0, when homomorphisms of number fields are composed the 
result has type `RingHomomorphism_im_gens` rather than 
`NumberFieldHomomorphism_im_gens`:

```
sage: K = QuadraticField(2)
sage: e, f = End(K)
sage: type(f)
<class 'sage.rings.number_field.morphism.NumberFieldHomomorphism_im_gens'>
sage: type(f*f)
<type 'sage.rings.morphism.RingHomomorphism_im_gens'>
```

Consequently, comparison fails to work correctly:

```
sage: f*f == e
False
sage: f*f
Ring endomorphism of Number Field in a with defining polynomial x^2 - 2
  Defn: a |--> a
sage: e
Ring endomorphism of Number Field in a with defining polynomial x^2 - 2
  Defn: a |--> a
```


Moreover, for relative number fields composition yields a formal composite 
map:

```
sage: L.<a, b> = NumberField([x^2 - 2, x^2 - 3])
sage: g = End(L)[1]
sage: type(g*g)
<type 'sage.categories.map.FormalCompositeMap'>
```

and this means that powers beyond cubes produce an error:

```
sage: g^4
Traceback (most recent call last)
...
AttributeError: 'sage.categories.map.FormalCompositeMap' object has no attribute '_rational_'
```

Comparison for homomorphisms out of relative number fields needs fixing 
too, because they are not standard im_gens homomorphisms.

The patch deals with these issues.


---

Comment by fwclarke created at 2011-02-25 09:58:11

Changing status from new to needs_review.


---

Attachment


---

Comment by davidloeffler created at 2011-09-23 08:39:32

This looks great to me -- a simple, clear and well-documented fix. All doctests in sage/rings pass, and the reference manual builds cleanly. Positive review. Always a pleasure to review your patches, Francis!


---

Comment by davidloeffler created at 2011-09-23 08:39:32

Changing status from needs_review to positive_review.


---

Comment by leif created at 2011-09-27 17:42:52

Resolution: fixed
