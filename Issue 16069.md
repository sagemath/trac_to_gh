# Issue 16069: Replace =0 by is_zero() in test for matrix being alternating

archive/issues_016069.json:
```json
{
    "body": "CC:  @nbruin stumpc5\n\nJust a couple small fixes, the one in the summary being the main one. (Not all rings R have their zero element equal to R(0).)\n\nIssue created by migration from https://trac.sagemath.org/ticket/16306\n\n",
    "created_at": "2014-05-07T23:08:10Z",
    "labels": [
        "component: linear algebra",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Replace =0 by is_zero() in test for matrix being alternating",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16069",
    "user": "https://github.com/darijgr"
}
```
CC:  @nbruin stumpc5

Just a couple small fixes, the one in the summary being the main one. (Not all rings R have their zero element equal to R(0).)

Issue created by migration from https://trac.sagemath.org/ticket/16306





---

archive/issue_comments_208962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-07T23:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208962",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_208963.json:
```json
{
    "body": "Hi Darij,\n\n1) Could you provide examples of rings for which the test fails? It is not clear to me why we need this and if you do not want that such bug reproduces you need to test it. More precisely, in the documentation write something along the lines of\n\n```\nIn the following example, we show that we solve the issue in :trac:`16306` is solved::\n\n    sage: a_nice_example()\n    Hey!\n```\n\n\n2) why not\n\n```\n-            if self.get_unsafe(i,i) != 0:\n+            if self.get_unsafe(i,i):\n```\n\nDo we know that `__nonzero__` always does what we expect?\n\nVincent",
    "created_at": "2014-05-08T21:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208963",
    "user": "https://github.com/videlec"
}
```

Hi Darij,

1) Could you provide examples of rings for which the test fails? It is not clear to me why we need this and if you do not want that such bug reproduces you need to test it. More precisely, in the documentation write something along the lines of

```
In the following example, we show that we solve the issue in :trac:`16306` is solved::

    sage: a_nice_example()
    Hey!
```


2) why not

```
-            if self.get_unsafe(i,i) != 0:
+            if self.get_unsafe(i,i):
```

Do we know that `__nonzero__` always does what we expect?

Vincent



---

archive/issue_comments_208964.json:
```json
{
    "body": "1) I don't have good examples. We have semirings where 0 is not the zero in Sage (try `TropicalSemiring(ZZ)`), but this particular method doesn't make much sense for these. This is more an issue of principle: We might eventually get rings like Grothendieck's lambda-rings (the ring of power series over a given ring K, with multiplication of power series as addition, and a weirder multiplication -- and, before you ask, there are finite-dimensional quotients of this, so it's not all lazy power series, so testing for zeroness does make sense), on which there will suddenly be a lot of failing code due to the fact that the coerce of 1 (not the coerce of 0) is the zero element. Better to fix as many of these issues as we can right now.\n\nHowever, in most examples I've tried, `is_zero` is faster than `== 0` due to the coercion that has to be resolved for the latter.\n\n2) I don't know. I wouldn't make an assumption on the boolean coerce of a ring element. But maybe I could...",
    "created_at": "2014-05-08T22:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208964",
    "user": "https://github.com/darijgr"
}
```

1) I don't have good examples. We have semirings where 0 is not the zero in Sage (try `TropicalSemiring(ZZ)`), but this particular method doesn't make much sense for these. This is more an issue of principle: We might eventually get rings like Grothendieck's lambda-rings (the ring of power series over a given ring K, with multiplication of power series as addition, and a weirder multiplication -- and, before you ask, there are finite-dimensional quotients of this, so it's not all lazy power series, so testing for zeroness does make sense), on which there will suddenly be a lot of failing code due to the fact that the coerce of 1 (not the coerce of 0) is the zero element. Better to fix as many of these issues as we can right now.

However, in most examples I've tried, `is_zero` is faster than `== 0` due to the coercion that has to be resolved for the latter.

2) I don't know. I wouldn't make an assumption on the boolean coerce of a ring element. But maybe I could...



---

archive/issue_comments_208965.json:
```json
{
    "body": "Replying to [comment:4 darij]:\n> 1) I don't have good examples. We have semirings where 0 is not the zero in Sage (try `TropicalSemiring(ZZ)`), but this particular method doesn't make much sense for these. This is more an issue of principle: We might eventually get rings like Grothendieck's lambda-rings (the ring of power series over a given ring K, with multiplication of power series as addition, and a weirder multiplication -- and, before you ask, there are finite-dimensional quotients of this, so it's not all lazy power series, so testing for zeroness does make sense), on which there will suddenly be a lot of failing code due to the fact that the coerce of 1 (not the coerce of 0) is the zero element. Better to fix as many of these issues as we can right now.\n\nSo, I do not understand the description of the ticket. You wrote `Not all rings R have their zero element equal to R(0)`. But now that I asked for an example, you say that no such ring exists.\n\n> However, in most examples I've tried, `is_zero` is faster than `== 0` due to the coercion that has to be resolved for the latter.\n\nOk. Looks like a better argument than claiming that there are other rings. Could you provide timings then?\n\n> 2) I don't know. I wouldn't make an assumption on the boolean coerce of a ring element. But maybe I could...\n\nNo. I was just asking. Because, if you care about speed, this is by far the fastest.\n\nVincent",
    "created_at": "2014-05-09T06:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208965",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:4 darij]:
> 1) I don't have good examples. We have semirings where 0 is not the zero in Sage (try `TropicalSemiring(ZZ)`), but this particular method doesn't make much sense for these. This is more an issue of principle: We might eventually get rings like Grothendieck's lambda-rings (the ring of power series over a given ring K, with multiplication of power series as addition, and a weirder multiplication -- and, before you ask, there are finite-dimensional quotients of this, so it's not all lazy power series, so testing for zeroness does make sense), on which there will suddenly be a lot of failing code due to the fact that the coerce of 1 (not the coerce of 0) is the zero element. Better to fix as many of these issues as we can right now.

So, I do not understand the description of the ticket. You wrote `Not all rings R have their zero element equal to R(0)`. But now that I asked for an example, you say that no such ring exists.

> However, in most examples I've tried, `is_zero` is faster than `== 0` due to the coercion that has to be resolved for the latter.

Ok. Looks like a better argument than claiming that there are other rings. Could you provide timings then?

> 2) I don't know. I wouldn't make an assumption on the boolean coerce of a ring element. But maybe I could...

No. I was just asking. Because, if you care about speed, this is by far the fastest.

Vincent



---

archive/issue_comments_208966.json:
```json
{
    "body": "I hope you will agree that \"all rings\" and \"all rings in Sage\" are two rather different things... :)\n\nSome timings on zero elements:\n\n\n```\nsage: %timeit ZZ(1) == 0\n1000000 loops, best of 3: 419 ns per loop\nsage: %timeit ZZ(1).is_zero()\n1000000 loops, best of 3: 389 ns per loop\nsage: %timeit QQ(1) == 0\n100000 loops, best of 3: 2.15 \u00b5s per loop\nsage: %timeit QQ(1).is_zero()\n1000000 loops, best of 3: 853 ns per loop\nsage: P.<x> = PolynomialRing(QQ)\nsage: %timeit x == 0\n100000 loops, best of 3: 2.76 \u00b5s per loop\nsage: %timeit x.is_zero()\n1000000 loops, best of 3: 223 ns per loop\nsage: Sym = SymmetricFunctions(QQ); e = Sym.e(); ez = e.zero()\nsage: %timeit ez == 0\n10000 loops, best of 3: 27.9 \u00b5s per loop\nsage: %timeit ez.is_zero()\n100000 loops, best of 3: 4.45 \u00b5s per loop\n```\n\nand on nonzero elements:\n\n```\nsage: %timeit ZZ(2) == 0     \n1000000 loops, best of 3: 416 ns per loop\nsage: %timeit ZZ(2).is_zero()\n1000000 loops, best of 3: 383 ns per loop\nsage: %timeit QQ(2) == 0\n100000 loops, best of 3: 2.15 \u00b5s per loop\nsage: %timeit QQ(2).is_zero()\n1000000 loops, best of 3: 877 ns per loop\nsage: e2 = e[2]\nsage: %timeit e2 == 0\n10000 loops, best of 3: 27.8 \u00b5s per loop\nsage: %timeit e2.is_zero()\n100000 loops, best of 3: 5.91 \u00b5s per loop\nsage: %timeit Integer(2) == 0     \n1000000 loops, best of 3: 417 ns per loop\nsage: %timeit Integer(2).is_zero()\n1000000 loops, best of 3: 360 ns per loop\n```\n\n\nI don't know how much of the coercion overhead can be removed by improving the coercion system, but for now it looks like `is_zero` wins against coercion.",
    "created_at": "2014-05-09T20:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208966",
    "user": "https://github.com/darijgr"
}
```

I hope you will agree that "all rings" and "all rings in Sage" are two rather different things... :)

Some timings on zero elements:


```
sage: %timeit ZZ(1) == 0
1000000 loops, best of 3: 419 ns per loop
sage: %timeit ZZ(1).is_zero()
1000000 loops, best of 3: 389 ns per loop
sage: %timeit QQ(1) == 0
100000 loops, best of 3: 2.15 µs per loop
sage: %timeit QQ(1).is_zero()
1000000 loops, best of 3: 853 ns per loop
sage: P.<x> = PolynomialRing(QQ)
sage: %timeit x == 0
100000 loops, best of 3: 2.76 µs per loop
sage: %timeit x.is_zero()
1000000 loops, best of 3: 223 ns per loop
sage: Sym = SymmetricFunctions(QQ); e = Sym.e(); ez = e.zero()
sage: %timeit ez == 0
10000 loops, best of 3: 27.9 µs per loop
sage: %timeit ez.is_zero()
100000 loops, best of 3: 4.45 µs per loop
```

and on nonzero elements:

```
sage: %timeit ZZ(2) == 0     
1000000 loops, best of 3: 416 ns per loop
sage: %timeit ZZ(2).is_zero()
1000000 loops, best of 3: 383 ns per loop
sage: %timeit QQ(2) == 0
100000 loops, best of 3: 2.15 µs per loop
sage: %timeit QQ(2).is_zero()
1000000 loops, best of 3: 877 ns per loop
sage: e2 = e[2]
sage: %timeit e2 == 0
10000 loops, best of 3: 27.8 µs per loop
sage: %timeit e2.is_zero()
100000 loops, best of 3: 5.91 µs per loop
sage: %timeit Integer(2) == 0     
1000000 loops, best of 3: 417 ns per loop
sage: %timeit Integer(2).is_zero()
1000000 loops, best of 3: 360 ns per loop
```


I don't know how much of the coercion overhead can be removed by improving the coercion system, but for now it looks like `is_zero` wins against coercion.



---

archive/issue_comments_208967.json:
```json
{
    "body": "Actually, checking equality with parent.zero() is even faster than checking is_zero(). I'll push this once I am back home.",
    "created_at": "2014-05-09T20:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208967",
    "user": "https://github.com/darijgr"
}
```

Actually, checking equality with parent.zero() is even faster than checking is_zero(). I'll push this once I am back home.



---

archive/issue_comments_208968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-14T01:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208969.json:
```json
{
    "body": "Fixed. Sorry for it taking such a while!",
    "created_at": "2014-05-14T01:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208969",
    "user": "https://github.com/darijgr"
}
```

Fixed. Sorry for it taking such a while!



---

archive/issue_comments_208970.json:
```json
{
    "body": "Replying to [comment:7 darij]:\n> Actually, checking equality with parent.zero() is even faster than checking is_zero(). I'll push this once I am back home.\n\nI see, the following tests are more appropriate\n\n```\nsage: n = 12\nsage: %timeit n.is_zero()\n1000000 loops, best of 3: 204 ns per loop\nsage: zero = n.parent().zero()\nsage: %timeit n == zero\n10000000 loops, best of 3: 149 ns per loop\n```\n",
    "created_at": "2014-05-14T05:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208970",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:7 darij]:
> Actually, checking equality with parent.zero() is even faster than checking is_zero(). I'll push this once I am back home.

I see, the following tests are more appropriate

```
sage: n = 12
sage: %timeit n.is_zero()
1000000 loops, best of 3: 204 ns per loop
sage: zero = n.parent().zero()
sage: %timeit n == zero
10000000 loops, best of 3: 149 ns per loop
```




---

archive/issue_comments_208971.json:
```json
{
    "body": "Hi Darij,\n\nWhat is the point of `if not self.get_unsafe(i,i) == zero:` instead of `if self.get_unsafe(i,i) != zero:`? Could you write an appropriate title and an appropriate description for the ticket?\n\nI agree that it is a small ticket. But it is not a reason to not do it cleanly!\n\nThanks,\nVincent",
    "created_at": "2014-05-14T06:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208971",
    "user": "https://github.com/videlec"
}
```

Hi Darij,

What is the point of `if not self.get_unsafe(i,i) == zero:` instead of `if self.get_unsafe(i,i) != zero:`? Could you write an appropriate title and an appropriate description for the ticket?

I agree that it is a small ticket. But it is not a reason to not do it cleanly!

Thanks,
Vincent



---

archive/issue_comments_208972.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-14T06:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208972",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208973.json:
```json
{
    "body": "Oops, the use of \"not\" was a relic of the old version.\n\nPart of the reason why comparison with parent().zero() takes so long is that parent() and zero() have to be computed. This can be done once per call of the method, and so the time amortizes quite well.\n----\nNew commits:",
    "created_at": "2014-05-14T06:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208973",
    "user": "https://github.com/darijgr"
}
```

Oops, the use of "not" was a relic of the old version.

Part of the reason why comparison with parent().zero() takes so long is that parent() and zero() have to be computed. This can be done once per call of the method, and so the time amortizes quite well.
----
New commits:



---

archive/issue_comments_208974.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-14T13:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208974",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208975.json:
```json
{
    "body": "Hi Darij,\n\nI still do not understand the motivation for the ticket: the function is not time critical and as you confirmed there is nowhere in Sage a ring whose zero is not 0. The code is better with the branch applied so I set to positive review.\n\nVincent",
    "created_at": "2014-05-14T13:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208975",
    "user": "https://github.com/videlec"
}
```

Hi Darij,

I still do not understand the motivation for the ticket: the function is not time critical and as you confirmed there is nowhere in Sage a ring whose zero is not 0. The code is better with the branch applied so I set to positive review.

Vincent



---

archive/issue_comments_208976.json:
```json
{
    "body": "Thank you!\n\nThis is a really minor change I wouldn't have done if the code in question wasn't my code from an older ticket.",
    "created_at": "2014-05-14T16:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208976",
    "user": "https://github.com/darijgr"
}
```

Thank you!

This is a really minor change I wouldn't have done if the code in question wasn't my code from an older ticket.



---

archive/issue_comments_208977.json:
```json
{
    "body": "reviewer name",
    "created_at": "2014-05-15T15:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208977",
    "user": "https://github.com/vbraun"
}
```

reviewer name



---

archive/issue_comments_208978.json:
```json
{
    "body": "FTR, there is one:\n\n```\nsage: T = TropicalSemiring(QQ)\nsage: T(0)\n0\nsage: T.zero()\n+infinity\n```\n\n(which we have to do because `TestSuite` uses `zero` as the additive identity, so we might want a separate categories for tropical stuff, but that's an issue for a different ticket).",
    "created_at": "2014-05-15T16:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208978",
    "user": "https://github.com/tscrim"
}
```

FTR, there is one:

```
sage: T = TropicalSemiring(QQ)
sage: T(0)
0
sage: T.zero()
+infinity
```

(which we have to do because `TestSuite` uses `zero` as the additive identity, so we might want a separate categories for tropical stuff, but that's an issue for a different ticket).



---

archive/issue_comments_208979.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-19T10:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16069#issuecomment-208979",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015635.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-05-19T10:25:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16069",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16069#event-15635"
}
```
