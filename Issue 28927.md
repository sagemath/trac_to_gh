# Issue 28927: Computing log(0, 2) takes a long time

Issue created by migration from https://trac.sagemath.org/ticket/29164

Original creator: bouvier

Original creation time: 2020-02-07 10:47:18

Keywords: log float integer

The following commands run "instantly":

```
sage: log (0.0)
-infinity
sage: log (0.0, 2)
-infinity
sage: log (0)
-Infinity
```


But the command

```
sage: log (0, 2)
```

takes a very long time (at least a few minutes). Moreover, the python process needs to be killed, using Ctrl+C does not work to stop the computation.

I was able to reproduce the bug with Sage 9.0 (using Python3) and Sage 8.9 (using Python2). But i was not able to reproduce the bug with Sage 7.6.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2020-08-29 15:59:03

Changing priority from major to critical.


---

Comment by @bmlivin created at 2020-09-05 23:05:55

In `sage.rings.integer.Integer.exact_log`, this triggers a `ValueError`:


```
if mpz_sgn(self.value) <= 0 or mpz_sgn(_m.value) <= 0:
    raise ValueError("both self and m must be positive")
```


In your example, `self.value` is 0 and `_m.value` is 2. It seems to me like it would be better to return `-infinity` instead of raising this error if `self.value` is 0, but in a sense that is beside the point. What instead happens is that this `ValueError` is in a try-except in `sage.functions.log.log`:


```
    try:
        return args[0].log(args[1])
    except ValueError as ex:
        if repr(ex)[12:27] == "No discrete log":
            raise
        return logb(args[0], args[1])
```


Here, `args[0]` is 0 and `args[1]` is 2. Calling the function `logb` results in the same `ValueError` and the same try-except, and thus an infinite loop. 

To avoid this, `-infinity` needs to be returned at some point. I think that point should be in `sage.rings.integer.Integer.exact_log`, immediately before raising the `ValueError`.


---

Comment by @bmlivin created at 2020-09-05 23:46:07

Set assignee to @bmlivin.


---

Comment by @bmlivin created at 2020-09-12 21:16:17

Changing status from new to needs_review.


---

Comment by @bmlivin created at 2020-09-12 21:16:17

New commits:


---

Comment by chapoton created at 2020-09-13 19:55:36

in the doctest, please add the missing empty line after `::`

```
+    
+    Check if :track:`29164` is fixed::
+        sage: log(0, 2)
+        -Infinity
```



---

Comment by chapoton created at 2020-09-13 19:56:09

also use `:trac:` and not `:track:`


---

Comment by git created at 2020-09-13 20:36:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2020-09-14 10:25:13

Full names in "Authors" and "Reviewers" fields please.


---

Comment by chapoton created at 2020-09-15 10:30:32

Ben, please add your full real name in the author field here above.


---

Comment by chapoton created at 2020-09-16 06:28:24

ok, let it be then. Thanks


---

Comment by chapoton created at 2020-09-16 06:28:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-23 21:28:04

Resolution: fixed
