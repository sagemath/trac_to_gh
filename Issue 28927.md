# Issue 28927: Computing log(0, 2) takes a long time

archive/issues_028927.json:
```json
{
    "body": "Keywords: log float integer\n\nThe following commands run \"instantly\":\n\n```\nsage: log (0.0)\n-infinity\nsage: log (0.0, 2)\n-infinity\nsage: log (0)\n-Infinity\n```\n\n\nBut the command\n\n```\nsage: log (0, 2)\n```\n\ntakes a very long time (at least a few minutes). Moreover, the python process needs to be killed, using Ctrl+C does not work to stop the computation.\n\nI was able to reproduce the bug with Sage 9.0 (using Python3) and Sage 8.9 (using Python2). But i was not able to reproduce the bug with Sage 7.6.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29164\n\n",
    "created_at": "2020-02-07T10:47:18Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "title": "Computing log(0, 2) takes a long time",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28927",
    "user": "bouvier"
}
```
Keywords: log float integer

The following commands run "instantly":

```
sage: log (0.0)
-infinity
sage: log (0.0, 2)
-infinity
sage: log (0)
-Infinity
```


But the command

```
sage: log (0, 2)
```

takes a very long time (at least a few minutes). Moreover, the python process needs to be killed, using Ctrl+C does not work to stop the computation.

I was able to reproduce the bug with Sage 9.0 (using Python3) and Sage 8.9 (using Python2). But i was not able to reproduce the bug with Sage 7.6.

Issue created by migration from https://trac.sagemath.org/ticket/29164





---

archive/issue_comments_409439.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409439",
    "user": "mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_409440.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-08-29T15:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409440",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_409441.json:
```json
{
    "body": "In `sage.rings.integer.Integer.exact_log`, this triggers a `ValueError`:\n\n\n```\nif mpz_sgn(self.value) <= 0 or mpz_sgn(_m.value) <= 0:\n    raise ValueError(\"both self and m must be positive\")\n```\n\n\nIn your example, `self.value` is 0 and `_m.value` is 2. It seems to me like it would be better to return `-infinity` instead of raising this error if `self.value` is 0, but in a sense that is beside the point. What instead happens is that this `ValueError` is in a try-except in `sage.functions.log.log`:\n\n\n```\n    try:\n        return args[0].log(args[1])\n    except ValueError as ex:\n        if repr(ex)[12:27] == \"No discrete log\":\n            raise\n        return logb(args[0], args[1])\n```\n\n\nHere, `args[0]` is 0 and `args[1]` is 2. Calling the function `logb` results in the same `ValueError` and the same try-except, and thus an infinite loop. \n\nTo avoid this, `-infinity` needs to be returned at some point. I think that point should be in `sage.rings.integer.Integer.exact_log`, immediately before raising the `ValueError`.",
    "created_at": "2020-09-05T23:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409441",
    "user": "@bmlivin"
}
```

In `sage.rings.integer.Integer.exact_log`, this triggers a `ValueError`:


```
if mpz_sgn(self.value) <= 0 or mpz_sgn(_m.value) <= 0:
    raise ValueError("both self and m must be positive")
```


In your example, `self.value` is 0 and `_m.value` is 2. It seems to me like it would be better to return `-infinity` instead of raising this error if `self.value` is 0, but in a sense that is beside the point. What instead happens is that this `ValueError` is in a try-except in `sage.functions.log.log`:


```
    try:
        return args[0].log(args[1])
    except ValueError as ex:
        if repr(ex)[12:27] == "No discrete log":
            raise
        return logb(args[0], args[1])
```


Here, `args[0]` is 0 and `args[1]` is 2. Calling the function `logb` results in the same `ValueError` and the same try-except, and thus an infinite loop. 

To avoid this, `-infinity` needs to be returned at some point. I think that point should be in `sage.rings.integer.Integer.exact_log`, immediately before raising the `ValueError`.



---

archive/issue_comments_409442.json:
```json
{
    "body": "Set assignee to @bmlivin.",
    "created_at": "2020-09-05T23:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409442",
    "user": "@bmlivin"
}
```

Set assignee to @bmlivin.



---

archive/issue_comments_409443.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-12T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409443",
    "user": "@bmlivin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_409444.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-12T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409444",
    "user": "@bmlivin"
}
```

New commits:



---

archive/issue_comments_409445.json:
```json
{
    "body": "in the doctest, please add the missing empty line after `::`\n\n```\n+    \n+    Check if :track:`29164` is fixed::\n+        sage: log(0, 2)\n+        -Infinity\n```\n",
    "created_at": "2020-09-13T19:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409445",
    "user": "chapoton"
}
```

in the doctest, please add the missing empty line after `::`

```
+    
+    Check if :track:`29164` is fixed::
+        sage: log(0, 2)
+        -Infinity
```




---

archive/issue_comments_409446.json:
```json
{
    "body": "also use `:trac:` and not `:track:`",
    "created_at": "2020-09-13T19:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409446",
    "user": "chapoton"
}
```

also use `:trac:` and not `:track:`



---

archive/issue_comments_409447.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-13T20:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409447",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_409448.json:
```json
{
    "body": "Full names in \"Authors\" and \"Reviewers\" fields please.",
    "created_at": "2020-09-14T10:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409448",
    "user": "slelievre"
}
```

Full names in "Authors" and "Reviewers" fields please.



---

archive/issue_comments_409449.json:
```json
{
    "body": "Ben, please add your full real name in the author field here above.",
    "created_at": "2020-09-15T10:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409449",
    "user": "chapoton"
}
```

Ben, please add your full real name in the author field here above.



---

archive/issue_comments_409450.json:
```json
{
    "body": "ok, let it be then. Thanks",
    "created_at": "2020-09-16T06:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409450",
    "user": "chapoton"
}
```

ok, let it be then. Thanks



---

archive/issue_comments_409451.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-16T06:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409451",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_409452.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-23T21:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28927#issuecomment-409452",
    "user": "vbraun"
}
```

Resolution: fixed
