# Issue 10451: Sage in emacs fails for some functions

Issue created by migration from Trac.

Original creator: fmaltey

Original creation time: 2010-12-20 15:35:04

Assignee: was

I can define this function in a xterm or in a emacs buffer linked to the sage shell buffer.

I get an error when I type it in the *Sage Inferior* mode.


```
def test (n) :
  if n==2 :
    return 2
  else :
    return 3
```

In emacs I get the error around the "else :" line


```
------------------------------------------------
  File "<ipython console>", line 4
    se :
      ^^

SyntaxError: invalid syntax

sage:     return 3

-----------------------------------------------------
  File "<ipython console>", line 1
SyntaxError: 'return' outside function (<ipython console>, line 1)
```


This error isn't in the sage*.el mode because I get the same problem in any shell buffer that I run with [Alt-x] shell [return] sage [return].


---

Comment by iandrus created at 2012-05-25 19:09:14

FWIW typing it in without indenting works:


```

sage: def test(n) :
....: if n==2 :
....: return 2
....: else :
....: return 3
....: 
sage: test(2)
2
```


But indenting it "manually" causes problems:


```
def test (n) :
....:   if n==2 :
....:     return 2
....:   else :
------------------------------------------------------------
   File "<ipython console>", line 4
     se :
      ^
SyntaxError: invalid syntax
```


In a shell, the proper indentation is added automatically i.e. the transcript below resulted from typing exactly the same characters as the first:

```
sage: def test(n) :
....:     if n==2:
....:         return 2
....:     else:
....:         return 3
....:     
sage: test(3)
3
```


It's probably related to the TERM environment variable (set to "dumb" inside emacs), but I don't know where this is handled in Sage (probably ipython).


---

Comment by iandrus created at 2012-05-25 19:09:14

Changing assignee from was to iandrus.


---

Comment by iandrus created at 2012-12-27 17:01:43

This can be done by adding to `main()` in `ipy_user_conf.py`:


```

    import os
    if os.environ['TERM'] == 'dumb':
        o.autoindent = 0
```


I plan to wait until after #12167 to fix this.


---

Comment by iandrus created at 2014-06-04 07:03:24

New commits:


---

Comment by iandrus created at 2014-06-04 07:03:24

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-04-13 17:44:23

Does it actually merge?

Also, wouldn't the same hold for plain IPython? Maybe its better to fix the default upstream?


---

Comment by iandrus created at 2015-04-14 04:45:27

Replying to [comment:4 vbraun]:
> Does it actually merge?

Sorry, I must have tried merging it when I had an old branch checked out.

> Also, wouldn't the same hold for plain IPython? Maybe its better to fix the default upstream?

Yes, you are right.  It probably should be fixed upstream.  You can close this ticket.


---

Comment by vbraun created at 2015-04-14 08:56:27

Can you link to the upstream ticket when you open it? IPython uses github as issue tracker.


---

Comment by chapoton created at 2016-04-16 18:37:35

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-04-16 18:37:35

let us close that


---

Comment by vbraun created at 2016-06-12 12:02:30

Resolution: fixed
