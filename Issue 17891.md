# Issue 17891: Add a face truncation method to Polyhedron class

Issue created by migration from Trac.

Original creator: jipilab

Original creation time: 2015-04-06 15:44:41

CC:  vbraun mhampton moritz

Keywords: face truncation, polytope

Currently, it is possible to do a truncation of a polytope via the method ".edge_truncation()".

See http://en.wikipedia.org/wiki/Truncation_%28geometry%29

I currently need the notion of edge-truncation, which is achieve by cutting the polytope along a "well-chosen" hyperplane whose normal vector lies in the normal cone of the edge. This edge truncation uses only one edge. Not all edges at once.

Further, one can define a face truncation similarly with the same code. I am implementing a method called ".face_truncation(face, normal_coefficient, cut_frac)" taking a face of the polytope, and two optional parameters to vary the angle of the cut.

This new method makes the old method ill-named. It should be recalled simply "truncation" or "complete_vertex_truncation".


---

Comment by jipilab created at 2015-04-07 11:08:35

Changing status from new to needs_review.


---

Comment by jipilab created at 2015-04-07 11:08:35

New commits:


---

Comment by jipilab created at 2015-04-07 11:11:47

All test passed on sage 6.6.b5. The tests do not take more than 0.1 sec more than before on my old laptop.


---

Comment by vbraun created at 2015-04-29 10:51:23

Conflicts, can you merge in the latest beta?


---

Comment by jipilab created at 2015-04-29 12:43:25

Sure, will do.


---

Comment by git created at 2015-04-29 15:23:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-04-29 15:36:11

I don't really know why there are two commits for the merge. Perhaps I typed something more by accident(!?)


---

Comment by vbraun created at 2015-04-30 00:56:26

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2015-04-30 00:56:26

You checked in a conflict marker (the thing starting with `<<<<<<< HEAD`).


---

Comment by git created at 2015-04-30 07:28:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-04-30 07:29:56

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-06-07 12:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-08-20 08:33:17

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-08-20 08:33:17

two failing doctests (should be easy to fix)


---

Comment by git created at 2015-11-25 09:17:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-11-25 09:19:48

It seems there was a conflict with the latest version. Also, the test seem to pass on 6.10.b2.

Let's see what the bot says.


---

Comment by jipilab created at 2015-11-25 09:19:48

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-11-26 09:33:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-02 02:42:37

CONFLICT (content): Merge conflict in src/sage/geometry/polyhedron/base.py


---

Comment by vdelecroix created at 2015-12-02 02:42:37

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-12-06 16:00:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-12-06 16:02:18

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-12-06 23:38:28

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-12-06 23:38:28

Hello,

Why did you changed the default value of the argument `cut_frac`?

The following is by far not enough to understand what the method is doing

```
+        - ``linear_coefficients`` -- tuple of integer. Specify the coefficient
+          of the normal vector of the cutting hyperplane.
```

You should add more description in the docstring. (that would help me to understand what this method is doing)

In your examples you are only showing how combinatorially the method behave. I guess that the actual added vertices are indeed interesting. (that would help me to understand what this method is doing (bis))

There is a trailing whitespace after the docstring and many before the `return`.

You should replace

```
if False not in map(lambda x: facet.contains(x) and
        not facet.interior_contains(x), face_vertices):
```

by

```
if any(facet.contains(x) and not facet.interior_contains(x) for x in face_vertices):
```


Also replace

```
linear_evaluation.difference(set([B]))
```

by

```
linear_evaluation.difference(B)
```


And add an example where the base ring does change.

Vincent


---

Comment by jipilab created at 2015-12-07 06:55:45

Dear Vincent,

Thanks a lot for the detailed review!

I'm on it!


---

Comment by git created at 2015-12-15 16:05:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-15 16:12:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2015-12-15 16:13:40

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-12-21 23:58:52

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2015-12-21 23:58:52

Salut Jean-Philippe,

I am confused with terminology. The `truncation` (= the old `edge_truncation`) is an operation that can be obtained by several applications of your `face_truncation` isn't it? But if I want to do that it would be a nightmare since the coefficient would changed depending on whether or not the face has been touched before...

If true, wouldn't be possible to join the two methods? For example I might want to truncate all faces of dimension 1 in the cube with the same coefficient. This would be a sort of intermediate between the two currently available methods.

Vincent


---

Comment by jipilab created at 2015-12-22 07:10:14

Salut Vincent,

I was also confused with the choice `edge_truncation` already. I have no idea why it was named this way. The only reason I can find is if you think of a polytope as a graph only and you cut all the edges simultaneously twice: close to each of their ends. But geometrically, there is much much more happening.

As I said, this method does the truncations all at the same time, giving a different result than cutting a single face at a time, where you then also have to take care of how deep you cut.

The previous `edge_truncation` (which is now `truncation` inspired by the wikipedia page above), actually performs face truncations with faces being vertices, again all simultaneously.

I tried to think of how to join the two methods. Doing the `truncation` using the function `face_truncation` one vertex at a time while also recording the old data for where to cut each vertex next seemed like over doing what it was already doing with very simple code.

So, I don't really see an advantage in joining the functions...


---

Comment by vdelecroix created at 2015-12-24 15:57:10

What I meant is that instead of feeding the function with one face, you might want to feed it with several. In which case the coefficient `cut_frac` would make reference to the original faces. The function `truncation` would just be a shortcut for `p.face_truncation(p.faces(0))`.

Vincent


---

Comment by jipilab created at 2016-02-22 12:40:01

Replying to [comment:27 vdelecroix]:
> 
> If true, wouldn't be possible to join the two methods? For example I might want to truncate all faces of dimension 1 in the cube with the same coefficient. This would be a sort of intermediate between the two currently available methods.

So I would say that the answer is No. The truncation method does things simultaneously while face_truncation really needs the current whole polytope in order to truncate a face with the appropriate proportion. This operation does not commute with itself as even the second face may not be a face of the result anymore. So I would leave the function as it currently is...

I'm currently working on the conflict...


---

Comment by git created at 2016-02-22 12:45:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2016-02-22 12:46:15

Changing status from needs_info to needs_review.


---

Comment by git created at 2016-02-22 13:19:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2016-02-23 09:19:58

I have difficulty decoding what is the test which fails on the bot.


---

Comment by chapoton created at 2016-02-23 09:27:25

The patchbot librae currently misbehaves. Look at the other bots instead.


---

Comment by jipilab created at 2016-02-28 10:03:48

Okay, so the other bots seems to give a green flag...

Needs proper review again then!


---

Comment by chapoton created at 2016-03-08 13:21:49

does not apply..


---

Comment by chapoton created at 2016-03-08 13:21:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-06 09:41:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2017-02-06 10:08:26

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2017-02-06 10:08:26

This is a rebased version on 7.6.b2, solved the conflicts.

All test passed on the three modified files. Let's see what the bot says.


---

Comment by chapoton created at 2017-02-08 21:13:11

Salut,

two remarks, otherwise this is good to go:

1) in

```
+            normal_vector = sum([linear_coefficients[i]*normal_vectors[i] for i
+                                 in range(len(normal_vectors))])
```

there is no need for the [ ] just inside sum()

2) similarly in 

```
+        linear_evaluation = set([-normal_vector * (v.vector()) for v in
+            self.vertices()])
```

inside set()

Once done and checked, you can set a positive review on my behalf.


---

Comment by jipilab created at 2017-02-09 08:32:32

Salut!

Replying to [comment:40 chapoton]:
> Salut,
> 
> two remarks, otherwise this is good to go:
> 
> 1) in
> {{{
> +            normal_vector = sum([linear_coefficients[i]*normal_vectors[i] for i
> +                                 in range(len(normal_vectors))])
> }}}
> there is no need for the [ ] just inside sum()
> 
> 2) similarly in 
> {{{
> +        linear_evaluation = set([-normal_vector * (v.vector()) for v in
> +            self.vertices()])
> }}}
> inside set()
> 

Just for my information, where is this feature coming from? python3, sage?

> Once done and checked, you can set a positive review on my behalf.

Great! Thanks a lot!


---

Comment by git created at 2017-02-09 08:33:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2017-02-09 08:34:18

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-02-09 08:34:55

> 
> Just for my information, where is this feature coming from? python3, sage?
> 

This is just python. One can feed them an iterator, this avoids to build the list twice.


---

Comment by jipilab created at 2017-02-09 08:36:26

> This is just python. One can feed them an iterator, this avoids to build the list twice.

Good to know! Thanks!


---

Comment by vbraun created at 2017-02-11 10:24:13

Resolution: fixed
