# Issue 27592: Mark some tests involving `long` using the `# py2` tag

Issue created by migration from https://trac.sagemath.org/ticket/27829

Original creator: jhpalmieri

Original creation time: 2019-05-13 22:42:28

Since `long` is not available in Python 3, we should mark tests involving it as for Python 2 only. This is part of #27696.



---

Comment by jhpalmieri created at 2019-05-13 22:49:57

New commits:


---

Comment by jhpalmieri created at 2019-05-13 22:49:57

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-05-13 22:52:10

There are a few cases I didn't know what to do with. In the following, I don't think `long(...)` adds much, so I think it's okay to make these changes. I have not yet done so. Opinions?

```diff
diff --git a/src/sage/rings/complex_double.pyx b/src/sage/rings/complex_double.pyx
index ec43d0e199..21c9818780 100644
--- a/src/sage/rings/complex_double.pyx
+++ b/src/sage/rings/complex_double.pyx
@@ -398,7 +398,7 @@ cdef class ComplexDoubleField_class(sage.rings.ring.Field):
 
             sage: CDF(1) + RR(1)
             2.0
-            sage: CDF.0 - CC(1) - long(1) - RR(1) - QQbar(1)
+            sage: CDF.0 - CC(1) - ZZ(1) - RR(1) - QQbar(1)
             -4.0 + 1.0*I
             sage: CDF.has_coerce_map_from(ComplexField(20))
             False
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 03d4d57a28..e069377806 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
@@ -382,7 +382,7 @@ def vector(arg0, arg1=None, arg2=None, sparse=None):
         (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
         sage: v[3].parent()
         Integer Ring
-        sage: v = vector([float(23.4), int(2), complex(2+7*I), long(1)]); v
+        sage: v = vector([float(23.4), int(2), complex(2+7*I), 1]); v
         (23.4, 2.0, 2.0 + 7.0*I, 1.0)
         sage: v[1].parent()
         Complex Double Field
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index ae74119795..a579b5a575 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -719,7 +719,7 @@ cdef class RealField_class(sage.rings.ring.Field):
 
         TESTS::
 
-            sage: 1.0 - ZZ(1) - int(1) - long(1) - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)
+            sage: 1.0 - ZZ(1) - int(1) - 1 - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)
             -6.00000000000000
             sage: R = RR['x']   # Hold reference to avoid garbage collection, see Trac #24709
             sage: R.get_action(ZZ)
```



---

Comment by git created at 2019-05-15 20:02:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-05-16 12:36:01

I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.


---

Comment by jdemeyer created at 2019-05-16 12:39:20

For large numbers (which don't fit in a Python 2 `int` anyway), you can replace `long()` by `int()`, for example

```
a = long(-901824309821093821093812093810928309183091832091)
```

becomes

```
a = int(-901824309821093821093812093810928309183091832091)
```

(unless the goal of the doctest is precisely testing `__long__` which is not the case here).


---

Comment by jhpalmieri created at 2019-05-16 15:18:32

Replying to [comment:5 jdemeyer]:
> I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.

It works exactly the way I think it does, I just made a mistake.


---

Comment by jhpalmieri created at 2019-05-16 20:22:04

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2019-05-16 20:22:04

Any changes in #27826 are likely to affect this ticket, so marking as "needs work" until #27826 has stabilized.


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by vbraun created at 2019-11-30 11:42:25

Surely these all have been fixed by now and this ticket can be closed?


---

Comment by jhpalmieri created at 2019-11-30 17:35:07

No, because we still have 

```
    if six.PY2:
        extra_globals = {}
    else:
        extra_globals = {'long': int}
```

in `doctest/forker.py`, so tests involving `long` can still pass with Python 3.

#27826 should be resolved first, and then this ticket afterwards.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2020-07-19 05:53:32

Replying to [comment:11 jhpalmieri]:
> #27826 should be resolved first, and then this ticket afterwards.
This has happened


---

Comment by jhpalmieri created at 2020-07-19 19:06:39

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2020-07-19 19:06:39

I think we can close this as invalid now that we don't build Python 2 anymore.


---

Comment by mkoeppe created at 2020-07-20 02:06:24

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-08-17 18:36:51

Resolution: invalid
