# Issue 13309: Build Sage on OS X Mountain Lion

archive/issues_013137.json:
```json
{
    "body": "To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg from #13541.\n\nAssignee: GeorgSWeber\n\nCC:  @jhpalmieri yomcat minz\n\nReviewer: Dmitrii Pasechnik\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/13309\n\n",
    "closed_at": "2012-11-07T07:57:17Z",
    "created_at": "2012-07-31T09:54:49Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Build Sage on OS X Mountain Lion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13309",
    "user": "https://github.com/hedtke"
}
```
To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg from #13541.

Assignee: GeorgSWeber

CC:  @jhpalmieri yomcat minz

Reviewer: Dmitrii Pasechnik

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/13309





---

archive/issue_comments_204013.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [mercurial-2.2.2.p0.log](tarball://root/attachments/some-uuid/ticket13309/mercurial-2.2.2.p0.log) by @nexttime created at 2012-07-31 13:53:42\n\nMacOS X 10.8 [is not yet a supported platform](http://wiki.sagemath.org/SupportedPlatforms#Mac_OS_X-2), also because XCode seems to currently be broken on it; see several recent posts on [sage-release](http://groups.google.com/group/sage-release).",
    "created_at": "2012-07-31T13:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204013",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
Attachment [mercurial-2.2.2.p0.log](tarball://root/attachments/some-uuid/ticket13309/mercurial-2.2.2.p0.log) by @nexttime created at 2012-07-31 13:53:42

MacOS X 10.8 [is not yet a supported platform](http://wiki.sagemath.org/SupportedPlatforms#Mac_OS_X-2), also because XCode seems to currently be broken on it; see several recent posts on [sage-release](http://groups.google.com/group/sage-release).



---

archive/issue_comments_204014.json:
```json
{
    "body": "<a id='comment:2'></a>\nWe should probably make this a meta-ticket.",
    "created_at": "2012-07-31T13:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204014",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
We should probably make this a meta-ticket.



---

archive/issue_comments_204015.json:
```json
{
    "body": "<a id='comment:3'></a>\nCan anybody give remote access to such a system?",
    "created_at": "2012-07-31T21:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204015",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Can anybody give remote access to such a system?



---

archive/issue_comments_204016.json:
```json
{
    "body": "<a id='comment:4'></a>\nGiven no work has been done here, I don't think we should let it block the sage-5.3 release.",
    "created_at": "2012-08-27T08:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204016",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Given no work has been done here, I don't think we should let it block the sage-5.3 release.



---

archive/issue_comments_204017.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere is a subtle change in Mountain Lion which defaults to that system header files will use Objective C syntax constructs\nalthough we are compiling just pure C.  This explains the build error in mercurial above. Setting the compiler flag OS_OBJECT_USE_OBJC=0\nreverts this change, so that setting (globally, as I guess there is only pure C in sage) \n\n `export CFLAGS=\"-DOS_OBJECT_USE_OBJC=0\"`\\\\\n `make`\n\nwill compile mercurial.\n\nA second build error occurred in gd-2.0.35.p7 where the header file fontconfig/fontconfig.h was not found. If you experience this, adding the include /opt/X11/include helps to compile gd but induces a version incompatibility between the fontconfig and freetype later when starting sage. A workaround for me was to compile fontconfig into the sage local tree using the correct free type libs and then continue with make.\n\nA third error occurred  during compilation of scipy, where Mountain Lion does not specify the correct accelerators. Here the following helps.\n\n `export CPPFLAGS=\"-D__ACCELERATE__\"` \\\\\n `make clean` \\\\\n `make`\n\nAfter that sage 5.3 compiled (at least on my 10.8.1).",
    "created_at": "2012-09-19T20:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204017",
    "user": "https://trac.sagemath.org/admin/accounts/users/chsorger"
}
```

<a id='comment:5'></a>
There is a subtle change in Mountain Lion which defaults to that system header files will use Objective C syntax constructs
although we are compiling just pure C.  This explains the build error in mercurial above. Setting the compiler flag OS_OBJECT_USE_OBJC=0
reverts this change, so that setting (globally, as I guess there is only pure C in sage) 

 `export CFLAGS="-DOS_OBJECT_USE_OBJC=0"`\\
 `make`

will compile mercurial.

A second build error occurred in gd-2.0.35.p7 where the header file fontconfig/fontconfig.h was not found. If you experience this, adding the include /opt/X11/include helps to compile gd but induces a version incompatibility between the fontconfig and freetype later when starting sage. A workaround for me was to compile fontconfig into the sage local tree using the correct free type libs and then continue with make.

A third error occurred  during compilation of scipy, where Mountain Lion does not specify the correct accelerators. Here the following helps.

 `export CPPFLAGS="-D__ACCELERATE__"` \\
 `make clean` \\
 `make`

After that sage 5.3 compiled (at least on my 10.8.1).



---

archive/issue_comments_204018.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,8 @@\n Error installing package mercurial-2.2.2.p0\n \n The log is attached.\n+\n+---\n+\n+Attempted fix: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use a new scipy spkg: http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg.\n+\n``````\n",
    "created_at": "2012-09-20T05:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204018",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,8 @@
 Error installing package mercurial-2.2.2.p0
 
 The log is attached.
+
+---
+
+Attempted fix: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use a new scipy spkg: http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg.
+
``````




---

archive/issue_comments_204019.json:
```json
{
    "body": "<a id='comment:6'></a>\nAfter upgrading to the latest Mountain Lion (10.8.2) and the latest Xcode (4.5 (4G182)), many of these problems are going away for me. Note that I do not have any version of X11 installed on my machine, which is perhaps good (I don't have any problem with gd, fontconfig, etc.) but perhaps not (there is a small issue with matplotlib).\n\nFor me, I need chsorger's fix for scipy, and I have a new spkg ready \u2013 see the ticket description for the URL and see the attachments for the difference between the old spkg and the new one. There also seems to be a slightly different, but similar, fix in an unreleased upstream version: see  http://projects.scipy.org/scipy/ticket/1710.\n\nAlso, when matplotlib is being installed, I get a window saying\n\n```\nTo open \"gs,\" you need to install X11.\nWould you like to install X11 now?\n```\nIt turns out that on this machine, `/usr/local/bin/gs` was a link to `/usr/local/bin/gs-X11`, and changing the link to point to `/usr/local/bin/gs-noX11` fixed the problem.\n\nOther than that, everything seems to work, at least on this machine.",
    "created_at": "2012-09-20T05:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204019",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
After upgrading to the latest Mountain Lion (10.8.2) and the latest Xcode (4.5 (4G182)), many of these problems are going away for me. Note that I do not have any version of X11 installed on my machine, which is perhaps good (I don't have any problem with gd, fontconfig, etc.) but perhaps not (there is a small issue with matplotlib).

For me, I need chsorger's fix for scipy, and I have a new spkg ready â€“ see the ticket description for the URL and see the attachments for the difference between the old spkg and the new one. There also seems to be a slightly different, but similar, fix in an unreleased upstream version: see  http://projects.scipy.org/scipy/ticket/1710.

Also, when matplotlib is being installed, I get a window saying

```
To open "gs," you need to install X11.
Would you like to install X11 now?
```
It turns out that on this machine, `/usr/local/bin/gs` was a link to `/usr/local/bin/gs-X11`, and changing the link to point to `/usr/local/bin/gs-noX11` fixed the problem.

Other than that, everything seems to work, at least on this machine.



---

archive/issue_comments_204020.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-20T05:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204020",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204021.json:
```json
{
    "body": "patch for scipy spkg; for review only",
    "created_at": "2012-09-20T05:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204021",
    "user": "https://github.com/jhpalmieri"
}
```

patch for scipy spkg; for review only



---

archive/issue_comments_204022.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_13309-scipy.patch](tarball://root/attachments/some-uuid/ticket13309/trac_13309-scipy.patch) by chsorger created at 2012-09-20 21:07:58\n\nIndeed, upgrading to 10.8.2 and XCode 4.5 worked. No need to specify the compiler flag OS_OBJECT_USE_OBJC any more (apparently Apple silently corrected this with the update). Also jhpalmieri's patch for scipy works very well, so no need to specify by hand the accelerator flag later!\n\nI still run into gd complaining about the missing fontconfig/fontconfig.h file. But on my machine I installed Quartz (Apple no longer installs X11 by default) so that this is obviously related to this. On the other hand, I need X11 for programs like surf/surfex I use. I also installed poppler through brew (which in turn installed fontconfig and free type) as I compile texmaker on my own which depends on poppler. In short, this problem about gd is probably very much related to my own config. Anyhow, I found a workaround for this, so that sage happily compiles now.",
    "created_at": "2012-09-20T21:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204022",
    "user": "https://trac.sagemath.org/admin/accounts/users/chsorger"
}
```

<a id='comment:7'></a>
Attachment [trac_13309-scipy.patch](tarball://root/attachments/some-uuid/ticket13309/trac_13309-scipy.patch) by chsorger created at 2012-09-20 21:07:58

Indeed, upgrading to 10.8.2 and XCode 4.5 worked. No need to specify the compiler flag OS_OBJECT_USE_OBJC any more (apparently Apple silently corrected this with the update). Also jhpalmieri's patch for scipy works very well, so no need to specify by hand the accelerator flag later!

I still run into gd complaining about the missing fontconfig/fontconfig.h file. But on my machine I installed Quartz (Apple no longer installs X11 by default) so that this is obviously related to this. On the other hand, I need X11 for programs like surf/surfex I use. I also installed poppler through brew (which in turn installed fontconfig and free type) as I compile texmaker on my own which depends on poppler. In short, this problem about gd is probably very much related to my own config. Anyhow, I found a workaround for this, so that sage happily compiles now.



---

archive/issue_comments_204023.json:
```json
{
    "body": "<a id='comment:8'></a>\nI have X11 installed (XQuartz 2.7.3 (xorg-server 1.12.4) to be exact), and both gd and matplotlib build without issues. The build hasn't finished yet, but it's looking good. I haven't done anything to X11. I just installed the one that Apple linked me to when I got that notice jhpalmieri got. So a standard install, including X11/XQuartz, causes no issues.\n\nOh, Sage 5.4-beta1 and XCode 4.5 on 10.8.2.\n\nUpdate: Built fine, with no errors. The docs are building now.",
    "created_at": "2012-09-20T23:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204023",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

<a id='comment:8'></a>
I have X11 installed (XQuartz 2.7.3 (xorg-server 1.12.4) to be exact), and both gd and matplotlib build without issues. The build hasn't finished yet, but it's looking good. I haven't done anything to X11. I just installed the one that Apple linked me to when I got that notice jhpalmieri got. So a standard install, including X11/XQuartz, causes no issues.

Oh, Sage 5.4-beta1 and XCode 4.5 on 10.8.2.

Update: Built fine, with no errors. The docs are building now.



---

archive/issue_events_042887.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "rename": {
        "from": "Build fails on Mountain Lion",
        "to": "Build Sage on OS X Mountain Lion"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13309#event-42887"
}
```



---

archive/issue_comments_204024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,2 @@\n-I did a fresh install of Mountain Lion (after formatting the disk) and I installed the current version of Xcode and the commandline Tools. I downloaded sage 5.2 and it fails to build.\n+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).\n \n-Error installing package mercurial-2.2.2.p0\n-\n-The log is attached.\n-\n----\n-\n-Attempted fix: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use a new scipy spkg: http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg.\n-\n``````\n",
    "created_at": "2012-09-22T01:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204024",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,2 @@
-I did a fresh install of Mountain Lion (after formatting the disk) and I installed the current version of Xcode and the commandline Tools. I downloaded sage 5.2 and it fails to build.
+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).
 
-Error installing package mercurial-2.2.2.p0
-
-The log is attached.
-
----
-
-Attempted fix: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use a new scipy spkg: http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg.
-
``````




---

archive/issue_comments_204025.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).\n \n+Experimental version 0.11.0 scipy spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg).\n``````\n",
    "created_at": "2012-09-27T04:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204025",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).
 
+Experimental version 0.11.0 scipy spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg).
``````




---

archive/issue_comments_204026.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've posted an experimental spkg for version 0.11.0 of scipy. This is experimental because I haven't tried it out very much. It builds on OS X 10.7, OS X 10.8, and on sage.math, but I haven't run any doctests yet.",
    "created_at": "2012-09-27T04:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204026",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
I've posted an experimental spkg for version 0.11.0 of scipy. This is experimental because I haven't tried it out very much. It builds on OS X 10.7, OS X 10.8, and on sage.math, but I haven't run any doctests yet.



---

archive/issue_comments_204027.json:
```json
{
    "body": "patch for 0.11.0 scipy spkg",
    "created_at": "2012-09-27T04:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204027",
    "user": "https://github.com/jhpalmieri"
}
```

patch for 0.11.0 scipy spkg



---

archive/issue_comments_204028.json:
```json
{
    "body": "<a id='comment:11'></a>\nAttachment [trac_13309-scipy.0.11.0.patch](tarball://root/attachments/some-uuid/ticket13309/trac_13309-scipy.0.11.0.patch) by @jhpalmieri created at 2012-09-27 15:27:41\n\nThe new scipy spkg requires a few modifications to doctests, which I'll probably get to later today. Maybe I'll move all of that (i.e., upgrading scipy) to another ticket.",
    "created_at": "2012-09-27T15:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204028",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Attachment [trac_13309-scipy.0.11.0.patch](tarball://root/attachments/some-uuid/ticket13309/trac_13309-scipy.0.11.0.patch) by @jhpalmieri created at 2012-09-27 15:27:41

The new scipy spkg requires a few modifications to doctests, which I'll probably get to later today. Maybe I'll move all of that (i.e., upgrading scipy) to another ticket.



---

archive/issue_comments_204029.json:
```json
{
    "body": "<a id='comment:12'></a>\nSee #13541 for version 0.11.0 of scipy. I wonder if we should just make that a dependency for this ticket, and ignore the scipy spkg here.",
    "created_at": "2012-09-27T18:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204029",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
See #13541 for version 0.11.0 of scipy. I wonder if we should just make that a dependency for this ticket, and ignore the scipy spkg here.



---

archive/issue_comments_204030.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n-To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).\n-\n-Experimental version 0.11.0 scipy spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg).\n+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg). Alternatively, use the new scipy spkg from #13541.\n``````\n",
    "created_at": "2012-09-27T18:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204030",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1 @@
-To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg).
-
-Experimental version 0.11.0 scipy spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.11.0.spkg).
+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg). Alternatively, use the new scipy spkg from #13541.
``````




---

archive/issue_comments_204031.json:
```json
{
    "body": "<a id='comment:14'></a>\nNew iMac, updated to 10.8.2, trying to install Sage.\n\nFirst issue: there is a new OSX \"feature\" that puts the machine to sleep during long-running tasks like compiling software, big downloads, Time Machine backups, .... Any ideas on how to get around this? I don't really have the time or patience to wake the machine every 15 minutes. From what I've read, setting the computer to never go to sleep doesn't seem to help either.",
    "created_at": "2012-10-25T13:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204031",
    "user": "https://github.com/saliola"
}
```

<a id='comment:14'></a>
New iMac, updated to 10.8.2, trying to install Sage.

First issue: there is a new OSX "feature" that puts the machine to sleep during long-running tasks like compiling software, big downloads, Time Machine backups, .... Any ideas on how to get around this? I don't really have the time or patience to wake the machine every 15 minutes. From what I've read, setting the computer to never go to sleep doesn't seem to help either.



---

archive/issue_comments_204032.json:
```json
{
    "body": "<a id='comment:15'></a>\nSaliola, use the new command \"caffeinate\" (see man caffeinate).",
    "created_at": "2012-10-25T13:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204032",
    "user": "https://trac.sagemath.org/admin/accounts/users/chsorger"
}
```

<a id='comment:15'></a>
Saliola, use the new command "caffeinate" (see man caffeinate).



---

archive/issue_comments_204033.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [chsorger](#comment%3A15):\n> Saliola, use the new command \"caffeinate\" (see man caffeinate).\n\n\nThanks! I guess we need to mention this in the installation guide. I'll put this in the \"work issues\" field for now so that we don't forget, and I'll continue with the review.",
    "created_at": "2012-10-25T14:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204033",
    "user": "https://github.com/saliola"
}
```

<a id='comment:16'></a>
Replying to [chsorger](#comment%3A15):
> Saliola, use the new command "caffeinate" (see man caffeinate).


Thanks! I guess we need to mention this in the installation guide. I'll put this in the "work issues" field for now so that we don't forget, and I'll continue with the review.



---

archive/issue_comments_204034.json:
```json
{
    "body": "Changing work_issues from \"\" to \"add caffeinate to installation guide\"",
    "created_at": "2012-10-25T14:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204034",
    "user": "https://github.com/saliola"
}
```

Changing work_issues from "" to "add caffeinate to installation guide"



---

archive/issue_comments_204035.json:
```json
{
    "body": "<a id='comment:17'></a>\niMac, 10.8.2. Works great.\n\nHere is what I did:\n\n1. install XCode from the App Store\n2. install the [XCode command line tools](http://stackoverflow.com/questions/9329243/xcode-4-4-command-line-tools)\n3. download and extract sage-5.4.rc2.tar\n4. switch to $SAGE_ROOT/spkg/standard directory and delete the scipy package (this step is not needed, I think)\n5. download the scipy spkg from #13541 into $SAGE_ROOT/spkg/standard\n6. `caffeinate make`\n\nNotes:\n\n5. I used the spkg from #13541 because it has a positive review and will likely be merged into version 5.5.\n6. `caffeinate` prevents the machine from sleeping during the compilation: see [here](http://osxdaily.com/2012/08/03/disable-sleep-mac-caffeinate-command).\n\nIs there anything else that needs to be checked before I set this to positive review?",
    "created_at": "2012-10-26T14:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204035",
    "user": "https://github.com/saliola"
}
```

<a id='comment:17'></a>
iMac, 10.8.2. Works great.

Here is what I did:

1. install XCode from the App Store
2. install the [XCode command line tools](http://stackoverflow.com/questions/9329243/xcode-4-4-command-line-tools)
3. download and extract sage-5.4.rc2.tar
4. switch to $SAGE_ROOT/spkg/standard directory and delete the scipy package (this step is not needed, I think)
5. download the scipy spkg from #13541 into $SAGE_ROOT/spkg/standard
6. `caffeinate make`

Notes:

5. I used the spkg from #13541 because it has a positive review and will likely be merged into version 5.5.
6. `caffeinate` prevents the machine from sleeping during the compilation: see [here](http://osxdaily.com/2012/08/03/disable-sleep-mac-caffeinate-command).

Is there anything else that needs to be checked before I set this to positive review?



---

archive/issue_comments_204036.json:
```json
{
    "body": "<a id='comment:18'></a>\nTwo possible ideas, although these could go on new tickets instead: we could always use `caffeinate` on Mountain Lion, with a patch like this to the root repository:\n\n```diff\ndiff --git a/spkg/install b/spkg/install\n--- a/spkg/install\n+++ b/spkg/install\n@@ -481,10 +481,19 @@ echo \"*** ALL ENVIRONMENT VARIABLES BEFO\n env | sort\n echo \"***********************************************\"\n \n+# Use 'caffeinate' to prevent sleep if on OS X Mountain Lion.\n+CAFFEINATE=''\n+if [ `uname` = \"Darwin\" ]; then\n+    DARWIN_VERSION=`uname -r | cut '-d.' -f1`\n+    if [ $DARWIN_VERSION -eq 12 ]; then\n+       CAFFEINATE=caffeinate\n+    fi\n+fi\n+\n ###############################################################################\n # NOW do the actual build:\n ###############################################################################\n-time $MAKE \"$@\"\n+time $CAFFEINATE $MAKE \"$@\"\n if [ $? -ne 0 ]; then\n     echo >&2 \"Error building Sage.\"\n     exit 1\n```\nWe could also try to avoid potential issues with gs pointing to gs-X11 by creating a new link, for example with this possible change to the matplotlib spkg:\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -12,6 +12,18 @@ if [ \"x$SAGE64\" = xyes ]; then\n    LDFLAGS=\"-m64 \"; export LDFLAGS\n fi\n \n+# If on OS X Mountain Lion: see if 'gs' points to\n+# /usr/local/bin/gs-X11. If so, link instead to\n+# /usr/local/bin/gs-noX11.\n+if [ `uname` = \"Darwin\" ]; then\n+    DARWIN_VERSION=`uname -r | cut '-d.' -f1`\n+    GS=`command -v gs`\n+    GSNOX11=`command -v gs-noX11`\n+    if [ $DARWIN_VERSION -eq 12 ] && [ `readlink \"$GS\"` = \"gs-X11\" ] && [ -x \"$GSNOX11\" ]; then\n+       ln -s \"$GSNOX11\" \"$SAGE_LOCAL\"/bin/gs\n+    fi\n+fi\n+\n # Write a configuration file to src/setup.cfg\n python make-setup-config.py\n \n```\nI'm not sure about this second idea, though, because the user might actually have X11 installed, so we would want a more sophisticated check. The linbox configure script also calls gs, so we would need a similar change there.",
    "created_at": "2012-10-31T17:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204036",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
Two possible ideas, although these could go on new tickets instead: we could always use `caffeinate` on Mountain Lion, with a patch like this to the root repository:

```diff
diff --git a/spkg/install b/spkg/install
--- a/spkg/install
+++ b/spkg/install
@@ -481,10 +481,19 @@ echo "*** ALL ENVIRONMENT VARIABLES BEFO
 env | sort
 echo "***********************************************"
 
+# Use 'caffeinate' to prevent sleep if on OS X Mountain Lion.
+CAFFEINATE=''
+if [ `uname` = "Darwin" ]; then
+    DARWIN_VERSION=`uname -r | cut '-d.' -f1`
+    if [ $DARWIN_VERSION -eq 12 ]; then
+       CAFFEINATE=caffeinate
+    fi
+fi
+
 ###############################################################################
 # NOW do the actual build:
 ###############################################################################
-time $MAKE "$@"
+time $CAFFEINATE $MAKE "$@"
 if [ $? -ne 0 ]; then
     echo >&2 "Error building Sage."
     exit 1
```
We could also try to avoid potential issues with gs pointing to gs-X11 by creating a new link, for example with this possible change to the matplotlib spkg:

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -12,6 +12,18 @@ if [ "x$SAGE64" = xyes ]; then
    LDFLAGS="-m64 "; export LDFLAGS
 fi
 
+# If on OS X Mountain Lion: see if 'gs' points to
+# /usr/local/bin/gs-X11. If so, link instead to
+# /usr/local/bin/gs-noX11.
+if [ `uname` = "Darwin" ]; then
+    DARWIN_VERSION=`uname -r | cut '-d.' -f1`
+    GS=`command -v gs`
+    GSNOX11=`command -v gs-noX11`
+    if [ $DARWIN_VERSION -eq 12 ] && [ `readlink "$GS"` = "gs-X11" ] && [ -x "$GSNOX11" ]; then
+       ln -s "$GSNOX11" "$SAGE_LOCAL"/bin/gs
+    fi
+fi
+
 # Write a configuration file to src/setup.cfg
 python make-setup-config.py
 
```
I'm not sure about this second idea, though, because the user might actually have X11 installed, so we would want a more sophisticated check. The linbox configure script also calls gs, so we would need a similar change there.



---

archive/issue_comments_204037.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [saliola](#comment%3A17):\n> iMac, 10.8.2. Works great.\n> Is there anything else that needs to be checked before I set this to positive review?\n\n\nI'd also check that the package/patches continues to build on usual systems (say, Debian Linux).\nOr you can just give it positive review as it is, assuming that the author was careful to check this.",
    "created_at": "2012-10-31T17:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204037",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [saliola](#comment%3A17):
> iMac, 10.8.2. Works great.
> Is there anything else that needs to be checked before I set this to positive review?


I'd also check that the package/patches continues to build on usual systems (say, Debian Linux).
Or you can just give it positive review as it is, assuming that the author was careful to check this.



---

archive/issue_comments_204038.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis ticket no longer contains any patches or packages. It just points out the scipy spkg from #13541 (which already has a positive review). So I'm not sure what we need to do to close this ticket. Get a buildbot running Mountain Lion? Close now as \"works for me\"? Add information and/or patches re caffeinate?",
    "created_at": "2012-10-31T19:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204038",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
This ticket no longer contains any patches or packages. It just points out the scipy spkg from #13541 (which already has a positive review). So I'm not sure what we need to do to close this ticket. Get a buildbot running Mountain Lion? Close now as "works for me"? Add information and/or patches re caffeinate?



---

archive/issue_comments_204039.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg). Alternatively, use the new scipy spkg from #13541.\n+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg from #13541.\n``````\n",
    "created_at": "2012-10-31T19:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204039",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg at [http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/scipy-0.9.p2.spkg). Alternatively, use the new scipy spkg from #13541.
+To build Sage on OS X Mountain Lion: update to latest Mountain Lion (10.8.2 as of Sept 19) and Xcode (4.5). Use the new scipy spkg from #13541.
``````




---

archive/issue_comments_204040.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jhpalmieri](#comment%3A20):\n> This ticket no longer contains any patches or packages. It just points out the scipy spkg from #13541 (which already has a positive review). So I'm not sure what we need to do to close this ticket. Get a buildbot running Mountain Lion? Close now as \"works for me\"? Add information and/or patches re caffeinate?\n\n\nI'm giving it a positive review. I suppose it's better to open a separate ticket on the `caffeinate` issue. (I'm not doing it, as I don't have OSX 10.8 machine available, sorry.)",
    "created_at": "2012-10-31T20:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204040",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Replying to [jhpalmieri](#comment%3A20):
> This ticket no longer contains any patches or packages. It just points out the scipy spkg from #13541 (which already has a positive review). So I'm not sure what we need to do to close this ticket. Get a buildbot running Mountain Lion? Close now as "works for me"? Add information and/or patches re caffeinate?


I'm giving it a positive review. I suppose it's better to open a separate ticket on the `caffeinate` issue. (I'm not doing it, as I don't have OSX 10.8 machine available, sorry.)



---

archive/issue_comments_204041.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-31T20:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204041",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_042888.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T10:43:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13309#event-42888"
}
```



---

archive/issue_comments_204042.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2012-11-01T10:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204042",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_204043.json:
```json
{
    "body": "Changing work_issues from \"add caffeinate to installation guide\" to \"\"",
    "created_at": "2012-11-01T13:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204043",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "add caffeinate to installation guide" to ""



---

archive/issue_comments_204044.json:
```json
{
    "body": "<a id='comment:23'></a>\nPaul-Olivier Dehaye is kindly providing an [OS X 10.8 buildslave](http://build.sagemath.org/sage/builders/Dehaye%20%28OSX%2010.8%20x86_64%29)",
    "created_at": "2012-11-01T13:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204044",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Paul-Olivier Dehaye is kindly providing an [OS X 10.8 buildslave](http://build.sagemath.org/sage/builders/Dehaye%20%28OSX%2010.8%20x86_64%29)



---

archive/issue_events_042889.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-07T07:57:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13309#event-42889"
}
```



---

archive/issue_comments_204045.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-11-07T07:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13309",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13309#issuecomment-204045",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
