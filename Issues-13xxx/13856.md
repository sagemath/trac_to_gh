# Issue 13856: Add a top_class method to the Steenrod algebra

archive/issues_013652.json:
```json
{
    "body": "The attached patch introduces a new method `top_class` that computes the highest dimensional basis element of a finite sub algebra of the Steenrod algebra:\n\n   {{{#!python\n     sage: SteenrodAlgebra(3,profile=((2,1),(2,2,2,2))).top_class()\n     Q_0 Q_1 Q_2 Q_3 P(8,2)\n     sage: SteenrodAlgebra(2,profile=(3,2,1),basis='pst').top_class()\n     P^0_1 P^0_2 P^1_1 P^0_3 P^1_2 P^2_1\n     sage: SteenrodAlgebra(7).top_class()\n     Traceback (most recent call last):\n     ...\n     ValueError: the algebra is not finite dimensional\n   }}}\n\n\nAssignee: @jhpalmieri\n\nKeywords: Steenrod algebra\n\nReviewer: John Palmieri\n\nAuthor: Christian Nassau\n\nMerged: sage-5.8.beta0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13856\n\n",
    "closed_at": "2013-02-17T22:43:28Z",
    "created_at": "2012-12-21T11:55:52Z",
    "labels": [
        "component: algebraic topology",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Add a top_class method to the Steenrod algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13856",
    "user": "https://github.com/cnassau"
}
```
The attached patch introduces a new method `top_class` that computes the highest dimensional basis element of a finite sub algebra of the Steenrod algebra:

   {{{#!python
     sage: SteenrodAlgebra(3,profile=((2,1),(2,2,2,2))).top_class()
     Q_0 Q_1 Q_2 Q_3 P(8,2)
     sage: SteenrodAlgebra(2,profile=(3,2,1),basis='pst').top_class()
     P^0_1 P^0_2 P^1_1 P^0_3 P^1_2 P^2_1
     sage: SteenrodAlgebra(7).top_class()
     Traceback (most recent call last):
     ...
     ValueError: the algebra is not finite dimensional
   }}}


Assignee: @jhpalmieri

Keywords: Steenrod algebra

Reviewer: John Palmieri

Author: Christian Nassau

Merged: sage-5.8.beta0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13856





---

archive/issue_comments_215727.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-21T11:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215727",
    "user": "https://github.com/cnassau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_215728.json:
```json
{
    "body": "<a id='comment:2'></a>\nI suppose it might be slightly better to define `AM` to just be `SteenrodAlgebra(basis='milnor', p=p)`: you just need to multiply in it, you don't need to use its profile function. If someone is working with many subalgebras at a single prime, then each call to your version of `AM` will create a new subalgebra, whereas each call to `SteenrodAlgebra(basis='milnor', p=p)` just will only create an instance of the Steenrod algebra the first time through.\n\nOtherwise, this looks good to me.",
    "created_at": "2013-02-07T22:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215728",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I suppose it might be slightly better to define `AM` to just be `SteenrodAlgebra(basis='milnor', p=p)`: you just need to multiply in it, you don't need to use its profile function. If someone is working with many subalgebras at a single prime, then each call to your version of `AM` will create a new subalgebra, whereas each call to `SteenrodAlgebra(basis='milnor', p=p)` just will only create an instance of the Steenrod algebra the first time through.

Otherwise, this looks good to me.



---

archive/issue_comments_215729.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [topclass.patch](tarball://root/attachments/some-uuid/ticket13856/topclass.patch) by @cnassau created at 2013-02-08 09:56:09\n\nReplying to [jhpalmieri](#comment%3A2):\n> I suppose it might be slightly better to define `AM` to just be `SteenrodAlgebra(basis='milnor', p=p)`: you just need to multiply in it, you don't need to use its profile function. If someone is working with many subalgebras at a single prime, then each call to your version of `AM` will create a new subalgebra, whereas each call to `SteenrodAlgebra(basis='milnor', p=p)` just will only create an instance of the Steenrod algebra the first time through.\n> \n> Otherwise, this looks good to me.\n\n\nI have changed the line as you suggested, but also added a cast to self at the end. This is intended to make sure that\n\n```\nA.top_class().parent() is A\n```\nalthough I don't know if that's important. Anyway, I have also added this as a doctest.\n\nThanks for looking into this, \\\\\nChristian",
    "created_at": "2013-02-08T09:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215729",
    "user": "https://github.com/cnassau"
}
```

<a id='comment:3'></a>
Attachment [topclass.patch](tarball://root/attachments/some-uuid/ticket13856/topclass.patch) by @cnassau created at 2013-02-08 09:56:09

Replying to [jhpalmieri](#comment%3A2):
> I suppose it might be slightly better to define `AM` to just be `SteenrodAlgebra(basis='milnor', p=p)`: you just need to multiply in it, you don't need to use its profile function. If someone is working with many subalgebras at a single prime, then each call to your version of `AM` will create a new subalgebra, whereas each call to `SteenrodAlgebra(basis='milnor', p=p)` just will only create an instance of the Steenrod algebra the first time through.
> 
> Otherwise, this looks good to me.


I have changed the line as you suggested, but also added a cast to self at the end. This is intended to make sure that

```
A.top_class().parent() is A
```
although I don't know if that's important. Anyway, I have also added this as a doctest.

Thanks for looking into this, \\
Christian



---

archive/issue_comments_215730.json:
```json
{
    "body": "<a id='comment:4'></a>\nPerhaps for another ticket: I think your code reveals a bug. What do you think about this change:\n\n```diff\ndiff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py\n--- a/sage/algebras/steenrod/steenrod_algebra.py\n+++ b/sage/algebras/steenrod/steenrod_algebra.py\n@@ -2008,8 +2008,9 @@\n             else:\n                 a = x.milnor()\n                 if self.basis_name() == 'milnor':\n-                    return a\n-                return a.change_basis(self.basis_name())\n+                    return self._from_dict(a.monomial_coefficients(), coerce=True)\n+                a = a.change_basis(self.basis_name())\n+                return self._from_dict(a.monomial_coefficients(), coerce=True)\n         raise ValueError(\"Element does not lie in this Steenrod algebra\")\n \n     def __contains__(self, x):\n```\nAs it stands:\n\n```\nsage: SteenrodAlgebra(2,profile=(3,2,1), basis='pst')(Sq(4)).parent()\nmod 2 Steenrod algebra, pst_revz basis\n```\nWith the change:\n\n```\nsage: SteenrodAlgebra(2,profile=(3,2,1), basis='pst')(Sq(4)).parent()\nsub-Hopf algebra of mod 2 Steenrod algebra, pst_revz basis, profile function [3, 2, 1]\n```\nMy suggested patch would need some doctests, but it would also allow you to change your last line:\n\n```diff\ndiff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py\n--- a/sage/algebras/steenrod/steenrod_algebra.py\n+++ b/sage/algebras/steenrod/steenrod_algebra.py\n@@ -2821,7 +2822,7 @@\n             e = [k for k in range(0,len(ep)) if ep[k]==2]\n             r = [p**k-1 for k in rp]\n             ans = AM.monomial((tuple(e),tuple(r)))\n-        return self(ans.change_basis(self.basis_name()))\n+        return self(ans)\n \n     def order(self):\n         r\"\"\"\n```",
    "created_at": "2013-02-08T20:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215730",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Perhaps for another ticket: I think your code reveals a bug. What do you think about this change:

```diff
diff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py
--- a/sage/algebras/steenrod/steenrod_algebra.py
+++ b/sage/algebras/steenrod/steenrod_algebra.py
@@ -2008,8 +2008,9 @@
             else:
                 a = x.milnor()
                 if self.basis_name() == 'milnor':
-                    return a
-                return a.change_basis(self.basis_name())
+                    return self._from_dict(a.monomial_coefficients(), coerce=True)
+                a = a.change_basis(self.basis_name())
+                return self._from_dict(a.monomial_coefficients(), coerce=True)
         raise ValueError("Element does not lie in this Steenrod algebra")
 
     def __contains__(self, x):
```
As it stands:

```
sage: SteenrodAlgebra(2,profile=(3,2,1), basis='pst')(Sq(4)).parent()
mod 2 Steenrod algebra, pst_revz basis
```
With the change:

```
sage: SteenrodAlgebra(2,profile=(3,2,1), basis='pst')(Sq(4)).parent()
sub-Hopf algebra of mod 2 Steenrod algebra, pst_revz basis, profile function [3, 2, 1]
```
My suggested patch would need some doctests, but it would also allow you to change your last line:

```diff
diff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py
--- a/sage/algebras/steenrod/steenrod_algebra.py
+++ b/sage/algebras/steenrod/steenrod_algebra.py
@@ -2821,7 +2822,7 @@
             e = [k for k in range(0,len(ep)) if ep[k]==2]
             r = [p**k-1 for k in rp]
             ans = AM.monomial((tuple(e),tuple(r)))
-        return self(ans.change_basis(self.basis_name()))
+        return self(ans)
 
     def order(self):
         r"""
```



---

archive/issue_comments_215731.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A4):\n\nI think I would generally expect that \"`P(x).parent() is P`\" for every parent `P`, so your change seems pretty sensible. But maybe this expectation is too naive, as I've recently come across the (new?) notion of a \"facade set\" - I haven't studied those but they made me wonder whether a subalgebra should best be a facade for the ambient parent? Currently I have no idea what the impact of that approach would be... so I think we should indeed leave this question for a different ticket.\n\nBest, \\\\\nChristian",
    "created_at": "2013-02-08T22:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215731",
    "user": "https://github.com/cnassau"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A4):

I think I would generally expect that "`P(x).parent() is P`" for every parent `P`, so your change seems pretty sensible. But maybe this expectation is too naive, as I've recently come across the (new?) notion of a "facade set" - I haven't studied those but they made me wonder whether a subalgebra should best be a facade for the ambient parent? Currently I have no idea what the impact of that approach would be... so I think we should indeed leave this question for a different ticket.

Best, \\
Christian



---

archive/issue_comments_215732.json:
```json
{
    "body": "<a id='comment:6'></a>\nLooks good to me.",
    "created_at": "2013-02-11T23:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215732",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Looks good to me.



---

archive/issue_comments_215733.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2013-02-11T23:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215733",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_215734.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-11T23:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215734",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_045043.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-12T07:20:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13856#event-45043"
}
```



---

archive/issue_events_045044.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-17T22:43:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13856#event-45044"
}
```



---

archive/issue_comments_215735.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-17T22:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215735",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_215736.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.8.beta0\"",
    "created_at": "2013-02-17T22:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13856#issuecomment-215736",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.8.beta0"
