# Issue 13669: sage -gdb ImportError

archive/issues_013465.json:
```json
{
    "body": "I get the following with sage-5.4.rc2:\n\n```\n[patchbot@volker-desktop sage-5.4.rc2]$ ./sage -gdb\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n/mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/bin/sage-ipython\nGNU gdb (GDB) Fedora (7.4.50.20120120-52.fc17)\nCopyright (C) 2012 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-redhat-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>...\nReading symbols from /mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/bin/python...done.\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\nPython 2.7.3 (default, Oct 30 2012, 10:13:41) \n[GCC 4.7.2 20120921 (Red Hat 4.7.2-2)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n---------------------------------------------------------------------------\nImportError                               Traceback (most recent call last)\n| Sage Version 5.4.rc2, Release Date: 2012-10-18                     |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n/mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/lib/python2.7/site-packages/IPython/ipmaker.pyc in force_import(modname, force_reload)\n     61         reload(sys.modules[modname])\n     62     else:\n---> 63         __import__(modname)\n     64         \n     65 \n\nImportError: No module named ipy_profile_sage\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n\nsage: \n```\n\nApply\n* [attachment:trac_13669_fix_sage_gdb.patch] to the `SAGE_ROOT` repo,\n* [attachment:trac_13669_bin_remove_sage-gdb.patch] to the `local/bin` repo.\n\nAssignee: @nexttime\n\nCC:  @jdemeyer\n\nReviewer: Simon King\n\nAuthor: Volker Braun\n\nMerged: sage-5.6.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13669\n\n",
    "closed_at": "2013-01-01T11:37:49Z",
    "created_at": "2012-10-30T12:56:35Z",
    "labels": [
        "component: scripts",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "sage -gdb ImportError",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13669",
    "user": "https://github.com/vbraun"
}
```
I get the following with sage-5.4.rc2:

```
[patchbot@volker-desktop sage-5.4.rc2]$ ./sage -gdb
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
/mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/bin/sage-ipython
GNU gdb (GDB) Fedora (7.4.50.20120120-52.fc17)
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-redhat-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/bin/python...done.
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Python 2.7.3 (default, Oct 30 2012, 10:13:41) 
[GCC 4.7.2 20120921 (Red Hat 4.7.2-2)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
| Sage Version 5.4.rc2, Release Date: 2012-10-18                     |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
/mnt/storage2TB/patchbot/Sage/sage-5.4.rc2/local/lib/python2.7/site-packages/IPython/ipmaker.pyc in force_import(modname, force_reload)
     61         reload(sys.modules[modname])
     62     else:
---> 63         __import__(modname)
     64         
     65 

ImportError: No module named ipy_profile_sage
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.

sage: 
```

Apply
* [attachment:trac_13669_fix_sage_gdb.patch] to the `SAGE_ROOT` repo,
* [attachment:trac_13669_bin_remove_sage-gdb.patch] to the `local/bin` repo.

Assignee: @nexttime

CC:  @jdemeyer

Reviewer: Simon King

Author: Volker Braun

Merged: sage-5.6.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13669





---

archive/issue_comments_165773.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-10-30T13:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165773",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_165774.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-30T13:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165774",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165775.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_13669_bin_remove_sage-gdb.patch](tarball://root/attachments/some-uuid/ticket13669/trac_13669_bin_remove_sage-gdb.patch) by @vbraun created at 2012-10-30 13:04:06\n\nThe patch rewires `sage -gdb` to use `local/bin/sage-ipython`, so the behavior will match the standard sage behavior more closely.",
    "created_at": "2012-10-30T13:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165775",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Attachment [trac_13669_bin_remove_sage-gdb.patch](tarball://root/attachments/some-uuid/ticket13669/trac_13669_bin_remove_sage-gdb.patch) by @vbraun created at 2012-10-30 13:04:06

The patch rewires `sage -gdb` to use `local/bin/sage-ipython`, so the behavior will match the standard sage behavior more closely.



---

archive/issue_comments_165776.json:
```json
{
    "body": "<a id='comment:3'></a>The Patch Buildbot can't apply the patchs:\n\n```\nhg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13669/trac_13669_fix_sage_gdb.patch\nadding trac_13669_fix_sage_gdb.patch to series file\nhg qpush\napplying trac_13669_fix_sage_gdb.patch\nunable to find 'spkg/bin/sage' for patching\n1 out of 1 hunks FAILED -- saving rejects to file spkg/bin/sage.rej\n```\n\nAs say in http://wiki.sagemath.org/buildbot,\n\n    Only the devel repository has branches, so the buildbot is unable to apply and try out patches to extcode/scripts/etc.",
    "created_at": "2012-10-30T16:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165776",
    "user": "https://trac.sagemath.org/admin/accounts/users/r.gaia.cs"
}
```

<a id='comment:3'></a>The Patch Buildbot can't apply the patchs:

```
hg qimport http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13669/trac_13669_fix_sage_gdb.patch
adding trac_13669_fix_sage_gdb.patch to series file
hg qpush
applying trac_13669_fix_sage_gdb.patch
unable to find 'spkg/bin/sage' for patching
1 out of 1 hunks FAILED -- saving rejects to file spkg/bin/sage.rej
```

As say in http://wiki.sagemath.org/buildbot,

    Only the devel repository has branches, so the buildbot is unable to apply and try out patches to extcode/scripts/etc.



---

archive/issue_comments_165777.json:
```json
{
    "body": "<a id='comment:4'></a>What should be done to review the patches?\n\nFrom looking at them, they seem good to me, but I am no expert for gdb. And I can confirm that \"sage -gdb\" now starts without error, in the sense of \"I was able to do some non-trivial computation in an interactive session and quit Sage without gdb complaining\".\n\nBut is that enough to constitute a positive review?",
    "created_at": "2012-12-23T22:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165777",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>What should be done to review the patches?

From looking at them, they seem good to me, but I am no expert for gdb. And I can confirm that "sage -gdb" now starts without error, in the sense of "I was able to do some non-trivial computation in an interactive session and quit Sage without gdb complaining".

But is that enough to constitute a positive review?



---

archive/issue_comments_165778.json:
```json
{
    "body": "<a id='comment:5'></a>I don't think there is anything to review, nor does this have anything to do with gdb really. Its just about starting up Python in the same way with or without gdb. The old sage-gdb script was very hackish.",
    "created_at": "2012-12-23T22:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165778",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>I don't think there is anything to review, nor does this have anything to do with gdb really. Its just about starting up Python in the same way with or without gdb. The old sage-gdb script was very hackish.



---

archive/issue_comments_165779.json:
```json
{
    "body": "<a id='comment:6'></a>`./sage -t -gdb devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py` works as well.\n\nSlight complaint: `./sage -gdb -t devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py` does not work.\n\nWould it be possible to make the options -gdb and -t commute?",
    "created_at": "2012-12-23T22:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165779",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>`./sage -t -gdb devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py` works as well.

Slight complaint: `./sage -gdb -t devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py` does not work.

Would it be possible to make the options -gdb and -t commute?



---

archive/issue_comments_165780.json:
```json
{
    "body": "<a id='comment:7'></a>The option parsing in general should be overhauled and probably based on the argparse Python module. Right now its a pain to extend the way options work.",
    "created_at": "2012-12-23T22:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165780",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>The option parsing in general should be overhauled and probably based on the argparse Python module. Right now its a pain to extend the way options work.



---

archive/issue_comments_165781.json:
```json
{
    "body": "<a id='comment:8'></a>See #21",
    "created_at": "2012-12-24T07:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165781",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:8'></a>See #21



---

archive/issue_comments_165782.json:
```json
{
    "body": "<a id='comment:9'></a>So, here's your chance to fix a two-digit ticket...",
    "created_at": "2012-12-24T09:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165782",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>So, here's your chance to fix a two-digit ticket...



---

archive/issue_comments_165783.json:
```json
{
    "body": "<a id='comment:10'></a>Q: How many Sage contributors does it take to change a light bulb? \n\nA: While looking at the broken light bulb we noticed some paint peeling on the wall, so we should probably re-do the foundation of the house first.",
    "created_at": "2012-12-24T12:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165783",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>Q: How many Sage contributors does it take to change a light bulb? 

A: While looking at the broken light bulb we noticed some paint peeling on the wall, so we should probably re-do the foundation of the house first.



---

archive/issue_comments_165784.json:
```json
{
    "body": "<a id='comment:11'></a>The patches, when chosing to the right repositories, cleanly apply, and sage -gdb does start fine.\n\nI'd say this is enough for a positive review.",
    "created_at": "2012-12-28T19:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165784",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>The patches, when chosing to the right repositories, cleanly apply, and sage -gdb does start fine.

I'd say this is enough for a positive review.



---

archive/issue_comments_165785.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-28T19:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165785",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165786.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-29T19:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165786",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_165787.json:
```json
{
    "body": "<a id='comment:13'></a>Please use proper quoting:\n\n```\ngdb -x \"$SAGE_ROOT/local/bin/sage-gdb-commands\" -args python \"$SAGE_ROOT/local/bin/sage-ipython\" \"$@\" -i\n```",
    "created_at": "2012-12-29T19:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165787",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Please use proper quoting:

```
gdb -x "$SAGE_ROOT/local/bin/sage-gdb-commands" -args python "$SAGE_ROOT/local/bin/sage-ipython" "$@" -i
```



---

archive/issue_comments_165788.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-12-29T20:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165788",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_165789.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [trac_13669_fix_sage_gdb.patch](tarball://root/attachments/some-uuid/ticket13669/trac_13669_fix_sage_gdb.patch) by @vbraun created at 2012-12-29 20:12:24\n\nDone",
    "created_at": "2012-12-29T20:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165789",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Attachment [trac_13669_fix_sage_gdb.patch](tarball://root/attachments/some-uuid/ticket13669/trac_13669_fix_sage_gdb.patch) by @vbraun created at 2012-12-29 20:12:24

Done



---

archive/issue_comments_165790.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-29T20:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165790",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_038190.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-01T11:37:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13669#event-38190"
}
```



---

archive/issue_comments_165791.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-01T11:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13669#issuecomment-165791",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
