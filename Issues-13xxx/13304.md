# Issue 13304: Very inefficient scalar multiplication on FreeModule_ambient with somewhat large rank

archive/issues_013132.json:
```json
{
    "body": "As reported in a [thread in sage-support](https://groups.google.com/d/topic/sage-support/jlLTyY-8H8c/discussion) trivial scalar multiplication in `FreeModule_ambient` can be extremely slow or lead to out of memory errors:\n\n```\nn = 10000\nv = vector([0]*n)   # ok so far\nv2 = v/1            # kaboom\n```\n\nThe problem is that, during coercion, `_an_element_impl()` and in turn `gen(0)` of `FreeModule_ambient` gets called. The default implementation of `gen` calls `basis()`, computing the entire standard basis, and then returns the first basis vector.\n\n\n\n**Assignee:** @dansme\n\n**CC:**  @jdemeyer\n\n**Branch/Commit:** [8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Daniel Smertnig, Marc Mezzarobba\n\nIssue created by migration from https://trac.sagemath.org/ticket/13304\n\n",
    "closed_at": "2015-02-21T12:40:44Z",
    "created_at": "2012-07-27T11:24:49Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "title": "Very inefficient scalar multiplication on FreeModule_ambient with somewhat large rank",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13304",
    "user": "https://github.com/dansme"
}
```
As reported in a [thread in sage-support](https://groups.google.com/d/topic/sage-support/jlLTyY-8H8c/discussion) trivial scalar multiplication in `FreeModule_ambient` can be extremely slow or lead to out of memory errors:

```
n = 10000
v = vector([0]*n)   # ok so far
v2 = v/1            # kaboom
```

The problem is that, during coercion, `_an_element_impl()` and in turn `gen(0)` of `FreeModule_ambient` gets called. The default implementation of `gen` calls `basis()`, computing the entire standard basis, and then returns the first basis vector.



**Assignee:** @dansme

**CC:**  @jdemeyer

**Branch/Commit:** [8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)

**Reviewer:** Vincent Delecroix

**Author:** Daniel Smertnig, Marc Mezzarobba

Issue created by migration from https://trac.sagemath.org/ticket/13304





---

archive/attachments_018011.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13304_gen_speedup.patch",
    "asset_url": "tarball://root/attachments/ticket13304/trac_13304_gen_speedup.patch",
    "created_at": "2012-07-27T11:27:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13304/trac_13304_gen_speedup.patch",
    "user": "https://github.com/dansme"
}
```



---

archive/issue_comments_156052.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_13304_gen_speedup.patch](https://github.com/sagemath/sage/files/ticket13304/trac_13304_gen_speedup.patch) by @dansme created at 2012-07-27 11:27:34\n\nThe patch overrides `gen` in `FreeModule_ambient` to avoid generating the entire standard basis.",
    "created_at": "2012-07-27T11:27:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156052",
    "user": "https://github.com/dansme"
}
```

<a id='comment:1'></a>
Attachment [trac_13304_gen_speedup.patch](https://github.com/sagemath/sage/files/ticket13304/trac_13304_gen_speedup.patch) by @dansme created at 2012-07-27 11:27:34

The patch overrides `gen` in `FreeModule_ambient` to avoid generating the entire standard basis.



---

archive/issue_events_112868.json:
```json
{
    "actor": "https://github.com/dansme",
    "created_at": "2012-07-31T09:47:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112868"
}
```



---

archive/issue_comments_156053.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe change looks fine to me and passes all tests. Maybe you should\n- fill in your real name as Author of this ticket\n- add your name to the author section of the file\n- mark the doctest with the ticket number as an in-line comment\n- explain the speed efficiency gained after applying the patch.",
    "created_at": "2012-08-30T11:12:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156053",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:3'></a>
The change looks fine to me and passes all tests. Maybe you should
- fill in your real name as Author of this ticket
- add your name to the author section of the file
- mark the doctest with the ticket number as an in-line comment
- explain the speed efficiency gained after applying the patch.



---

archive/issue_comments_156054.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt's possible that calling `base_ring().one_element()` is a bit faster than converting the integer 1 into the ring every time. The method `one_element`normally gets cached.\n\nWhat's more, previously, asking for one basis element triggered basis computation and caching. After that, getting basis elements should be fast. With your patch this caching doesn't get triggered by asking for one basis vector any more. Code that previously benefited m might see a decrease in speed (which can be solved by first explicitly asking for the whole basis to trigger caching).\n\nIt might still be a good idea to not cache, but you might document the possible pitfall.",
    "created_at": "2012-08-30T15:54:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156054",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>
It's possible that calling `base_ring().one_element()` is a bit faster than converting the integer 1 into the ring every time. The method `one_element`normally gets cached.

What's more, previously, asking for one basis element triggered basis computation and caching. After that, getting basis elements should be fast. With your patch this caching doesn't get triggered by asking for one basis vector any more. Code that previously benefited m might see a decrease in speed (which can be solved by first explicitly asking for the whole basis to trigger caching).

It might still be a good idea to not cache, but you might document the possible pitfall.



---

archive/issue_comments_156055.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe question is, in which situations do we actually ask for the basis of the ambient space? I found out that there is a similar problem when constructing subspaces, see\n[sage-devel](https://groups.google.com/d/topic/sage-devel/ULcyJECqT4M/discussion). Unfortunately, this is not solved with this patch.\n\nSurprisingly, there is a difference between the fields `GF(4, 'a')` and `QQ`.",
    "created_at": "2012-08-31T06:07:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156055",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:5'></a>
The question is, in which situations do we actually ask for the basis of the ambient space? I found out that there is a similar problem when constructing subspaces, see
[sage-devel](https://groups.google.com/d/topic/sage-devel/ULcyJECqT4M/discussion). Unfortunately, this is not solved with this patch.

Surprisingly, there is a difference between the fields `GF(4, 'a')` and `QQ`.



---

archive/issue_events_112869.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112869"
}
```



---

archive/issue_events_112870.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112870"
}
```



---

archive/issue_events_112871.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-12-02T15:57:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112871"
}
```



---

archive/issue_events_112872.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-12-02T15:57:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112872"
}
```



---

archive/issue_comments_156056.json:
```json
{
    "body": "<a id='comment:7'></a>\n(from the previous comments, it looks like the patch in its current state is not waiting for a review)",
    "created_at": "2013-12-02T15:57:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156056",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
(from the previous comments, it looks like the patch in its current state is not waiting for a review)



---

archive/issue_events_112873.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112873"
}
```



---

archive/issue_events_112874.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112874"
}
```



---

archive/issue_comments_156057.json:
```json
{
    "body": "<a id='comment:9'></a>\nSee also #10262.\n\nReplying to [nbruin](#comment%3A4):\n> What's more, previously, asking for one basis element triggered basis computation and caching. After that, getting basis elements should be fast.\n\n\nIf I understand correctly, the basis we are talking about is essentially the identity matrix. In fact, I am not convinced caching it (strongly at least) is such a good idea even in general\u2014either recomputing it or computing whatever information one really needs instead sounds better in all cases I can think of. But in any case I think it is insane to call a function that may keep in cache a basis of, say, \u2124<sup>10000</sup>, unless one absolutely needs the whole basis!",
    "created_at": "2014-03-16T12:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156057",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
See also #10262.

Replying to [nbruin](#comment%3A4):
> What's more, previously, asking for one basis element triggered basis computation and caching. After that, getting basis elements should be fast.


If I understand correctly, the basis we are talking about is essentially the identity matrix. In fact, I am not convinced caching it (strongly at least) is such a good idea even in general—either recomputing it or computing whatever information one really needs instead sounds better in all cases I can think of. But in any case I think it is insane to call a function that may keep in cache a basis of, say, ℤ<sup>10000</sup>, unless one absolutely needs the whole basis!



---

archive/issue_comments_156058.json:
```json
{
    "body": "**Author:** Daniel Smertnig, Marc Mezzarobba",
    "created_at": "2014-03-16T13:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156058",
    "user": "https://github.com/mezzarobba"
}
```

**Author:** Daniel Smertnig, Marc Mezzarobba



---

archive/issue_comments_156059.json:
```json
{
    "body": "**Branch:** [u/mmezzarobba/13304-free_module_ambient+coerce](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13304-free_module_ambient+coerce)",
    "created_at": "2014-03-16T13:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156059",
    "user": "https://github.com/mezzarobba"
}
```

**Branch:** [u/mmezzarobba/13304-free_module_ambient+coerce](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13304-free_module_ambient+coerce)



---

archive/issue_comments_156060.json:
```json
{
    "body": "<a id='comment:10'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c87ef3761f382386c9080e1650fd950e4a8d5eb\">3c87ef3</a></td><td><code>Trac 13304: FreeModule_Ambient.gen speedup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2\">8fd7f88</a></td><td><code>Implement reviewer suggestions, + cosmetic changes</code></td></tr></table>\n",
    "created_at": "2014-03-16T13:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156060",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:10'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c87ef3761f382386c9080e1650fd950e4a8d5eb">3c87ef3</a></td><td><code>Trac 13304: FreeModule_Ambient.gen speedup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2">8fd7f88</a></td><td><code>Implement reviewer suggestions, + cosmetic changes</code></td></tr></table>




---

archive/issue_comments_156061.json:
```json
{
    "body": "**Commit:** [8fd7f887c5485001dbb8f6b2919db06ae8e686e2](https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2)",
    "created_at": "2014-03-16T13:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156061",
    "user": "https://github.com/mezzarobba"
}
```

**Commit:** [8fd7f887c5485001dbb8f6b2919db06ae8e686e2](https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2)



---

archive/issue_events_112875.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-03-16T13:26:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112875"
}
```



---

archive/issue_events_112876.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-03-16T13:26:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112876"
}
```



---

archive/issue_comments_156062.json:
```json
{
    "body": "<a id='comment:11'></a>\nI opened a separate ticket (#15953) for the more general issue of whether and when to cache the basis.",
    "created_at": "2014-03-16T13:26:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156062",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>
I opened a separate ticket (#15953) for the more general issue of whether and when to cache the basis.



---

archive/issue_events_112877.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-03-25T08:17:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112877"
}
```



---

archive/issue_events_112878.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112878"
}
```



---

archive/issue_events_112879.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112879"
}
```



---

archive/issue_events_112880.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112880"
}
```



---

archive/issue_events_112881.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112881"
}
```



---

archive/issue_comments_156063.json:
```json
{
    "body": "**Changing branch** from \"[u/mmezzarobba/13304-free_module_ambient+coerce](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13304-free_module_ambient+coerce)\" to \"[public/ticket/13304](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/13304)\".",
    "created_at": "2014-10-10T19:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156063",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/mmezzarobba/13304-free_module_ambient+coerce](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13304-free_module_ambient+coerce)" to "[public/ticket/13304](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/13304)".



---

archive/issue_comments_156064.json:
```json
{
    "body": "<a id='comment:15'></a>\nI just made a small clean-up and checked that doc builds and look nice.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fba50fce907d370e717f29503cb89b31f94a219\">8fba50f</a></td><td><code>Merge with 6.4.beta4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce\">8f09d51</a></td><td><code>trac #13304 put raise statement into py3 shape, plus minor cleanup</code></td></tr></table>\n",
    "created_at": "2014-10-10T19:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156064",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
I just made a small clean-up and checked that doc builds and look nice.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fba50fce907d370e717f29503cb89b31f94a219">8fba50f</a></td><td><code>Merge with 6.4.beta4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce">8f09d51</a></td><td><code>trac #13304 put raise statement into py3 shape, plus minor cleanup</code></td></tr></table>




---

archive/issue_comments_156065.json:
```json
{
    "body": "**Changing commit** from \"[8fd7f887c5485001dbb8f6b2919db06ae8e686e2](https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2)\" to \"[8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)\".",
    "created_at": "2014-10-10T19:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156065",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[8fd7f887c5485001dbb8f6b2919db06ae8e686e2](https://github.com/sagemath/sagetrac-mirror/commit/8fd7f887c5485001dbb8f6b2919db06ae8e686e2)" to "[8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)".



---

archive/issue_comments_156066.json:
```json
{
    "body": "<a id='comment:16'></a>\nFr\u00e9d\u00e9ric, did you review the commits prior to yours?",
    "created_at": "2015-02-05T16:21:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156066",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>
Frédéric, did you review the commits prior to yours?



---

archive/issue_comments_156067.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2015-02-08T15:55:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156067",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_events_112882.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-08T15:55:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112882"
}
```



---

archive/issue_events_112883.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-08T15:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112883"
}
```



---

archive/issue_comments_156068.json:
```json
{
    "body": "<a id='comment:17'></a>\nHello,\n\nYou got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way\n\n```\n    coefficient_ring = parent.basis()[0][0].parent()\n```\nIn particular the following also takes life time for the very same reason\n\n```\nsage: V = ZZ['x']^50000\nsage: V([0]*50000)\n```",
    "created_at": "2015-02-08T15:55:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156068",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
Hello,

You got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way

```
    coefficient_ring = parent.basis()[0][0].parent()
```
In particular the following also takes life time for the very same reason

```
sage: V = ZZ['x']^50000
sage: V([0]*50000)
```



---

archive/issue_comments_156069.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [vdelecroix](#comment%3A17):\n> You got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way\n> \n> ```\n>     coefficient_ring = parent.basis()[0][0].parent()\n> ```\n> In particular the following also takes life time for the very same reason\n> \n> ```\n> sage: V = ZZ['x']^50000\n> sage: V([0]*50000)\n> ```\n\n\nDoes it make the solution in this ticket inadequate? Or is it just a similar problem that can be handled separately?",
    "created_at": "2015-02-08T16:05:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156069",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:18'></a>
Replying to [vdelecroix](#comment%3A17):
> You got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way
> 
> ```
>     coefficient_ring = parent.basis()[0][0].parent()
> ```
> In particular the following also takes life time for the very same reason
> 
> ```
> sage: V = ZZ['x']^50000
> sage: V([0]*50000)
> ```


Does it make the solution in this ticket inadequate? Or is it just a similar problem that can be handled separately?



---

archive/issue_comments_156070.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mmezzarobba](#comment%3A18):\n> Replying to [vdelecroix](#comment%3A17):\n> > You got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way\n> > \n> > ```\n> >     coefficient_ring = parent.basis()[0][0].parent()\n> > ```\n> > In particular the following also takes life time for the very same reason\n> > \n> > ```\n> > sage: V = ZZ['x']^50000\n> > sage: V([0]*50000)\n> > ```\n\n> \n> Does it make the solution in this ticket inadequate? Or is it just a similar problem that can be handled separately?\n\n\nSecond option. It is just a one line change (that I can even do myself). Do you prefer this one line change to be on another ticket?",
    "created_at": "2015-02-08T16:29:35Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156070",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
Replying to [mmezzarobba](#comment%3A18):
> Replying to [vdelecroix](#comment%3A17):
> > You got it right for integer vectors but the generic constructor of `FreeModuleElement_generic_dense` does call the basis in a very stupid way
> > 
> > ```
> >     coefficient_ring = parent.basis()[0][0].parent()
> > ```
> > In particular the following also takes life time for the very same reason
> > 
> > ```
> > sage: V = ZZ['x']^50000
> > sage: V([0]*50000)
> > ```

> 
> Does it make the solution in this ticket inadequate? Or is it just a similar problem that can be handled separately?


Second option. It is just a one line change (that I can even do myself). Do you prefer this one line change to be on another ticket?



---

archive/issue_comments_156071.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [vdelecroix](#comment%3A19):\n> Second option. It is just a one line change (that I can even do myself). Do you prefer this one line change to be on another ticket?\n\n\nNo, please feel free to do it here if you like. (I can't do it myself at the moment.)",
    "created_at": "2015-02-08T16:35:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156071",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:20'></a>
Replying to [vdelecroix](#comment%3A19):
> Second option. It is just a one line change (that I can even do myself). Do you prefer this one line change to be on another ticket?


No, please feel free to do it here if you like. (I can't do it myself at the moment.)



---

archive/issue_comments_156072.json:
```json
{
    "body": "<a id='comment:21'></a>\nWow! Because of #11751 that introduces a very weird behavior the call to `.basis()` is somewhat unavoidable. Jeroen already pointed that out in #11751 and proposed to revert the changes. I am in favor of also reverting the changes. Might be better within another ticket?",
    "created_at": "2015-02-08T17:14:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156072",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
Wow! Because of #11751 that introduces a very weird behavior the call to `.basis()` is somewhat unavoidable. Jeroen already pointed that out in #11751 and proposed to revert the changes. I am in favor of also reverting the changes. Might be better within another ticket?



---

archive/issue_comments_156073.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [vdelecroix](#comment%3A21):\n> Wow! Because of #11751 that introduces a very weird behavior the call to `.basis()` is somewhat unavoidable. Jeroen already pointed that out in #11751 and proposed to revert the changes. I am in favor of also reverting the changes. Might be better within another ticket?\n\n\nThe problem mentioned in [comment:17](#comment%3A17) and the follow-ups needs #17585. In the meantime I am running the test for this branch on sage-6.6.beta0 and will set a positive review accordinlgy.\n\nVincent",
    "created_at": "2015-02-20T15:24:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156073",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
Replying to [vdelecroix](#comment%3A21):
> Wow! Because of #11751 that introduces a very weird behavior the call to `.basis()` is somewhat unavoidable. Jeroen already pointed that out in #11751 and proposed to revert the changes. I am in favor of also reverting the changes. Might be better within another ticket?


The problem mentioned in [comment:17](#comment%3A17) and the follow-ups needs #17585. In the meantime I am running the test for this branch on sage-6.6.beta0 and will set a positive review accordinlgy.

Vincent



---

archive/issue_events_112884.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-20T15:54:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112884"
}
```



---

archive/issue_events_112885.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-20T15:54:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112885"
}
```



---

archive/issue_comments_156074.json:
```json
{
    "body": "<a id='comment:24'></a>\nI think that #17585 provides a better and more fundamental fix to the problem: the line\n\n```\ncoefficient_ring = parent.basis()[0][0].parent()\n```\nis just removed completely.",
    "created_at": "2015-02-20T16:08:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156074",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
I think that #17585 provides a better and more fundamental fix to the problem: the line

```
coefficient_ring = parent.basis()[0][0].parent()
```
is just removed completely.



---

archive/issue_events_112886.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-20T16:16:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112886"
}
```



---

archive/issue_events_112887.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-20T16:16:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112887"
}
```



---

archive/issue_comments_156075.json:
```json
{
    "body": "<a id='comment:25'></a>\nActually, #17585 fixes\n\n```\nsage: V = ZZ['x']^50000\nsage: V([0]*50000)\n```\nbut not\n\n```\nsage: vector([0]*50000)/1\n```\n\nSince this ticket looks quite independent of #17585, it makes sense to have both.\n\nI do suggest to add the *two* doctests above, since they clearly test different issues.",
    "created_at": "2015-02-20T16:16:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156075",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Actually, #17585 fixes

```
sage: V = ZZ['x']^50000
sage: V([0]*50000)
```
but not

```
sage: vector([0]*50000)/1
```

Since this ticket looks quite independent of #17585, it makes sense to have both.

I do suggest to add the *two* doctests above, since they clearly test different issues.



---

archive/issue_comments_156076.json:
```json
{
    "body": "**Work_Issues:** add doctest",
    "created_at": "2015-02-20T16:16:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156076",
    "user": "https://github.com/jdemeyer"
}
```

**Work_Issues:** add doctest



---

archive/issue_comments_156077.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [jdemeyer](#comment%3A25):\n> Actually, #17585 fixes\n> \n> ```\n> sage: V = ZZ['x']^50000\n> sage: V([0]*50000)\n> ```\n> but not\n> \n> ```\n> sage: vector([0]*50000)/1\n> ```\n> \n> Since this ticket looks quite independent of #17585, it makes sense to have both.\n> \n> I do suggest to add the *two* doctests above, since they clearly test different issues.\n\n\nThe first one should go in #17585, no?",
    "created_at": "2015-02-20T16:24:26Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156077",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
Replying to [jdemeyer](#comment%3A25):
> Actually, #17585 fixes
> 
> ```
> sage: V = ZZ['x']^50000
> sage: V([0]*50000)
> ```
> but not
> 
> ```
> sage: vector([0]*50000)/1
> ```
> 
> Since this ticket looks quite independent of #17585, it makes sense to have both.
> 
> I do suggest to add the *two* doctests above, since they clearly test different issues.


The first one should go in #17585, no?



---

archive/issue_comments_156078.json:
```json
{
    "body": "**Changing work_issues** from \"add doctest\" to \"\".",
    "created_at": "2015-02-20T16:38:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156078",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work_issues** from "add doctest" to "".



---

archive/issue_comments_156079.json:
```json
{
    "body": "<a id='comment:27'></a>\nSorry, there was a misunderstanding. I thought that this ticket fixed both issues.",
    "created_at": "2015-02-20T16:38:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156079",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Sorry, there was a misunderstanding. I thought that this ticket fixed both issues.



---

archive/issue_events_112888.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-20T16:38:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112888"
}
```



---

archive/issue_events_112889.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-20T16:38:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112889"
}
```



---

archive/issue_events_112890.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-21T12:40:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112890"
}
```



---

archive/issue_events_112891.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "efe44a00750a046494f9964e8e4ac6c45bfb3197",
    "created_at": "2015-02-21T12:40:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13304#event-112891"
}
```



---

archive/issue_comments_156080.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket/13304](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/13304)\" to \"[8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)\".",
    "created_at": "2015-02-21T12:40:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13304#issuecomment-156080",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ticket/13304](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/13304)" to "[8f09d5198e060add5dea75ed240739f6485ba8ce](https://github.com/sagemath/sagetrac-mirror/commit/8f09d5198e060add5dea75ed240739f6485ba8ce)".
