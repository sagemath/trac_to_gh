# Issue 13615: Extend elliptic curve isogenies to arbitrary prime degrees

archive/issues_013411.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nAs of Sage 5.4, we can compute l-isogenies of elliptic curves only for l=2,3,5,7,13 (the ones for which X_0(l) has genus 0), together with some \"sporadic\" degrees which can occur over QQ.\n\nIn this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n\nApply only: [attachment: trac_13615_combined_4th_review.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)\u200b, [attachment: trac_13615_fix.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)\n\n\nCC:  @sagetrac-kimi @defeo\n\nComponent: **elliptic curves**\n\nKeywords: **isogenies, sd51, sd52**\n\nAuthor: **Kimi Tsukazaki, John Cremona, Luca De Feo**\n\nReviewer: **John Cremona, Jenny Cooley, Samuele Anni, Luca De Feo**\n\nMerged: **sage-5.13.beta0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13615_\n\n",
    "closed_at": "2013-10-02T06:35:02Z",
    "created_at": "2012-10-18T09:48:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Extend elliptic curve isogenies to arbitrary prime degrees",
    "type": "issue",
    "updated_at": "2013-11-18T13:01:22Z",
    "url": "https://github.com/sagemath/sage/issues/13615",
    "user": "https://github.com/JohnCremona"
}
```
<div id="comment:0"></div>

As of Sage 5.4, we can compute l-isogenies of elliptic curves only for l=2,3,5,7,13 (the ones for which X_0(l) has genus 0), together with some "sporadic" degrees which can occur over QQ.

In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.

Apply only: [attachment: trac_13615_combined_4th_review.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)​, [attachment: trac_13615_fix.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)


CC:  @sagetrac-kimi @defeo

Component: **elliptic curves**

Keywords: **isogenies, sd51, sd52**

Author: **Kimi Tsukazaki, John Cremona, Luca De Feo**

Reviewer: **John Cremona, Jenny Cooley, Samuele Anni, Luca De Feo**

Merged: **sage-5.13.beta0**

_Issue created by migration from https://trac.sagemath.org/ticket/13615_





---

archive/issue_events_188540.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2012-10-18T09:48:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188540"
}
```



---

archive/issue_events_188541.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2012-10-18T09:48:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188541"
}
```



---

archive/issue_events_188542.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2012-10-18T09:48:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188542"
}
```



---

archive/issue_events_188543.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2012-10-18T09:48:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188543"
}
```



---

archive/issue_comments_159472.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI have two patches which are ready for testing.",
    "created_at": "2013-07-22T08:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159472",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

I have two patches which are ready for testing.



---

archive/issue_comments_159473.json:
```json
{
    "body": "Changed keywords from **isogenies** to **isogenies, sd51**",
    "created_at": "2013-07-22T08:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159473",
    "user": "https://github.com/JohnCremona"
}
```

Changed keywords from **isogenies** to **isogenies, sd51**



---

archive/issue_comments_159474.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n\\# Files: \n\n1. ell_curve_isogeny_split.patch\n2. isogeny_genus_0.patch\n\n\\# Description:\n\n1. It splits the current \"ell_curve_isogeny.py\" to two files, namely \n    \"ell_curve_isogeny.py\" and \"isogeny_genus_0.py\".\n\n2. It adds new isogeny codes in \"isogeny_genus_0.py\", including:\n\n \u30fbl-isogeny computation using generic kernel polynomial for \n\u3000\u3000\u3000\u3000\u3000l = 11,17,19,23,29,31,41,47,59,71. (from ch.5 in Kimi's thesis)\n\n \u30fbl-isogeny computation using the l-division polynomial (from ch.3 in Kimi's thesis)\n\n\\# NOTE:\nPlease apply ell_curve_isogeny_split.patch first and \nthen apply isogeny_genus_0.patch.",
    "created_at": "2013-07-22T08:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159474",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

\# Files: 

1. ell_curve_isogeny_split.patch
2. isogeny_genus_0.patch

\# Description:

1. It splits the current "ell_curve_isogeny.py" to two files, namely 
    "ell_curve_isogeny.py" and "isogeny_genus_0.py".

2. It adds new isogeny codes in "isogeny_genus_0.py", including:

 ・l-isogeny computation using generic kernel polynomial for 
　　　　　l = 11,17,19,23,29,31,41,47,59,71. (from ch.5 in Kimi's thesis)

 ・l-isogeny computation using the l-division polynomial (from ch.3 in Kimi's thesis)

\# NOTE:
Please apply ell_curve_isogeny_split.patch first and 
then apply isogeny_genus_0.patch.



---

archive/issue_comments_159475.json:
```json
{
    "body": "Attachment: **[ell_curve_isogeny_split.patch.gz](https://github.com/sagemath/sage/files/ticket13615/ell_curve_isogeny_split.patch.gz)**\n\nAttachment: **[isogeny_genus_0.patch.gz](https://github.com/sagemath/sage/files/ticket13615/isogeny_genus_0.patch.gz)**",
    "created_at": "2013-07-22T08:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159475",
    "user": "https://github.com/JohnCremona"
}
```

Attachment: **[ell_curve_isogeny_split.patch.gz](https://github.com/sagemath/sage/files/ticket13615/ell_curve_isogeny_split.patch.gz)**

Attachment: **[isogeny_genus_0.patch.gz](https://github.com/sagemath/sage/files/ticket13615/isogeny_genus_0.patch.gz)**



---

archive/issue_comments_159476.json:
```json
{
    "body": "Author: **Kimi Tsukazaki**",
    "created_at": "2013-07-22T14:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159476",
    "user": "https://github.com/JohnCremona"
}
```

Author: **Kimi Tsukazaki**



---

archive/issue_comments_159477.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe patches apply fine to version 5.11.beta3.  But there are some issues which need to be addressed:\n\n1. The references to John C and Jenny C need to be moved to the new file, and the header information on the new file needs to be completed with additional author, dates, etc. with a citation to Kimi's thesis for justification of all the formulae.\n\n2. Some new functions have no docstring, or no one-line summary:  `hyperelliptic_isogeny_data`,  `Psi2`.\n\n3. `least_semi_primitive` docstring missing an asterisk.\n\n4. The interface to the isogeny function from the elliptic curve class in `ell_field.py` needs to be updated, otherwise the new functionality will not be available to users!   This should include a new helper function in `isogenies_genus_0` which makes the decision about which of the three functions to call.   It will also be necessary to disable the code which allows for an empty list of primes to be given, since we can now handle *all* primes with the sole exception of the characteristic.",
    "created_at": "2013-07-22T15:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159477",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5" align="right">comment:5</div>

The patches apply fine to version 5.11.beta3.  But there are some issues which need to be addressed:

1. The references to John C and Jenny C need to be moved to the new file, and the header information on the new file needs to be completed with additional author, dates, etc. with a citation to Kimi's thesis for justification of all the formulae.

2. Some new functions have no docstring, or no one-line summary:  `hyperelliptic_isogeny_data`,  `Psi2`.

3. `least_semi_primitive` docstring missing an asterisk.

4. The interface to the isogeny function from the elliptic curve class in `ell_field.py` needs to be updated, otherwise the new functionality will not be available to users!   This should include a new helper function in `isogenies_genus_0` which makes the decision about which of the three functions to call.   It will also be necessary to disable the code which allows for an empty list of primes to be given, since we can now handle *all* primes with the sole exception of the characteristic.



---

archive/issue_events_188544.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-22T15:25:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188544"
}
```



---

archive/issue_comments_159478.json:
```json
{
    "body": "Reviewer: **John Cremona, Jenny Cooley, Samuele Anni**",
    "created_at": "2013-07-22T15:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159478",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona, Jenny Cooley, Samuele Anni**



---

archive/issue_events_188545.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-22T15:25:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188545"
}
```



---

archive/issue_events_188546.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-22T15:25:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188546"
}
```



---

archive/issue_comments_159479.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@JohnCremona](#comment%3A7):\nI am starting to work on the points listed above.",
    "created_at": "2013-07-25T14:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159479",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@JohnCremona](#comment%3A7):
I am starting to work on the points listed above.



---

archive/issue_comments_159480.json:
```json
{
    "body": "Attachment: **[trac_13615_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_review.patch.gz)**\n\nApply after previous patches",
    "created_at": "2013-07-26T11:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159480",
    "user": "https://github.com/JohnCremona"
}
```

Attachment: **[trac_13615_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_review.patch.gz)**

Apply after previous patches



---

archive/issue_comments_159481.json:
```json
{
    "body": "Changed author from **Kimi Tsukazaki** to **Kimi Tsukazaki, John Cremona**",
    "created_at": "2013-07-26T11:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159481",
    "user": "https://github.com/JohnCremona"
}
```

Changed author from **Kimi Tsukazaki** to **Kimi Tsukazaki, John Cremona**



---

archive/issue_events_188547.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-26T11:15:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188547"
}
```



---

archive/issue_events_188548.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-26T11:15:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188548"
}
```



---

archive/issue_events_188549.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-26T11:15:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188549"
}
```



---

archive/issue_events_188550.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-26T11:15:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188550"
}
```



---

archive/issue_comments_159482.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch\n+\n``````\n",
    "created_at": "2013-07-26T11:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159482",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch
+
``````




---

archive/issue_comments_159483.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nNice work! I'm reviewing the patch, but of all the new functions in `isogeny_genus_0.py` the only one I could understand is `isogenies_prime_degree_general()`.\n\nI can't seem to find Kimi's thesis online. Could you put it somewhere, so that we can compare with the theory? Also, it would be nice if the docstrings of the new functions pointed to the corresponding sections in Kimi's thesis (assuming that's the only source).\n\nHere's more thoughts:\n\n- It seems weird that `isogenies_prime_degree_general()` is in `isogeny_genus_0.py`. Why is it not in `ell_curve_isogeny.py()` or in some other *generic* place?\n\n- `least_semi_primitive()` is a purely internal function, I would rename it to `_least_semi_primitive()`. \n\n- In the docstring of `least_semi_primitive()`, the `{1,-1}` should be `\\{1,-1\\}` (although this is not very important if you follow my previous suggestion).",
    "created_at": "2013-08-21T18:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159483",
    "user": "https://github.com/defeo"
}
```

<div id="comment:10" align="right">comment:10</div>

Nice work! I'm reviewing the patch, but of all the new functions in `isogeny_genus_0.py` the only one I could understand is `isogenies_prime_degree_general()`.

I can't seem to find Kimi's thesis online. Could you put it somewhere, so that we can compare with the theory? Also, it would be nice if the docstrings of the new functions pointed to the corresponding sections in Kimi's thesis (assuming that's the only source).

Here's more thoughts:

- It seems weird that `isogenies_prime_degree_general()` is in `isogeny_genus_0.py`. Why is it not in `ell_curve_isogeny.py()` or in some other *generic* place?

- `least_semi_primitive()` is a purely internal function, I would rename it to `_least_semi_primitive()`. 

- In the docstring of `least_semi_primitive()`, the `{1,-1}` should be `\{1,-1\}` (although this is not very important if you follow my previous suggestion).



---

archive/issue_comments_159484.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI have put the thesis at http://homepages.warwick.ac.uk/staff/J.E.Cremona/theses/tsukazaki.pdf\nsince it has not appeared on Warwick's official repository (but was approved in July 2013).\n\nI agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the \"general\" one belongs in the other file.\n\n`least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.\n\nI am about to go on holiday, but feel free to ask more questions if you don't mind a little delay.",
    "created_at": "2013-08-21T19:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159484",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

I have put the thesis at http://homepages.warwick.ac.uk/staff/J.E.Cremona/theses/tsukazaki.pdf
since it has not appeared on Warwick's official repository (but was approved in July 2013).

I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the "general" one belongs in the other file.

`least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.

I am about to go on holiday, but feel free to ask more questions if you don't mind a little delay.



---

archive/issue_comments_159485.json:
```json
{
    "body": "Changed reviewer from **John Cremona, Jenny Cooley, Samuele Anni** to **John Cremona, Jenny Cooley, Samuele Anni, Luca De Feo**",
    "created_at": "2013-08-22T18:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159485",
    "user": "https://github.com/defeo"
}
```

Changed reviewer from **John Cremona, Jenny Cooley, Samuele Anni** to **John Cremona, Jenny Cooley, Samuele Anni, Luca De Feo**



---

archive/issue_comments_159486.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,4 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch\n \n``````\n",
    "created_at": "2013-08-22T18:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159486",
    "user": "https://github.com/defeo"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,4 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch
 
``````




---

archive/issue_comments_159487.json:
```json
{
    "body": "Branch: **[u/defeo/trac13615](https://github.com/sagemath/sagetrac-mirror/tree/u/defeo/trac13615)**",
    "created_at": "2013-08-22T18:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159487",
    "user": "https://github.com/defeo"
}
```

Branch: **[u/defeo/trac13615](https://github.com/sagemath/sagetrac-mirror/tree/u/defeo/trac13615)**



---

archive/issue_comments_159488.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThanks for the link, and congratulations to Kimi. I quickly read it through. I obviously didn't check line by line, but no doubt that you got the maths and the coding right. So, I'm ready to give a positive review.\n\n> I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the \"general\" one belongs in the other file.\n\nI agree, it is best to keep specific algorithms separate from the isogeny class. On second thought, all the algorithms in that file have something in common: they are generic algorithms only practical for small prime degrees (as you suggest in the title of the doc page). Maybe it's just the filename that needs to be changed. What about `isogenies_small_degree.py`?\n\n> `least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.\n\nI had the same feeling about the variable `isog_table` and the function `hyperelliptic_isogeny_data`. Hence, I renamed all the three by adding an underscore in front of them.\n\nI also \n\n- Edited the copyright banner by adding your names\n- Fixed the docstring of `_least_semi_primitive()`\n- Added `ALGORITHM::` sections to some functions, pointing to the relevant chapter in Kimi's thesis.\n\nI'm attaching my reviewer's patch. I'm working with the git repo, and I'm confused by this directory renaming stuff, so I guess it'll be easier if I link to my git branch on trac.\n\nI'm not giving a positive review right away, so that you can review my patch, and give your opinion on renaming the file. Enjoy vacation!",
    "created_at": "2013-08-22T18:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159488",
    "user": "https://github.com/defeo"
}
```

<div id="comment:12" align="right">comment:12</div>

Thanks for the link, and congratulations to Kimi. I quickly read it through. I obviously didn't check line by line, but no doubt that you got the maths and the coding right. So, I'm ready to give a positive review.

> I agree that the filename is not wonderful, but we  did want to split off the general isogeny code now in ell_curve_isogeny from the special cases.  Perhaps you are right that the "general" one belongs in the other file.

I agree, it is best to keep specific algorithms separate from the isogeny class. On second thought, all the algorithms in that file have something in common: they are generic algorithms only practical for small prime degrees (as you suggest in the title of the doc page). Maybe it's just the filename that needs to be changed. What about `isogenies_small_degree.py`?

> `least_semi_primitive` is indeed internal. If I thught there would be other applications I might have suggested putting it with primitive roots and similar functions.

I had the same feeling about the variable `isog_table` and the function `hyperelliptic_isogeny_data`. Hence, I renamed all the three by adding an underscore in front of them.

I also 

- Edited the copyright banner by adding your names
- Fixed the docstring of `_least_semi_primitive()`
- Added `ALGORITHM::` sections to some functions, pointing to the relevant chapter in Kimi's thesis.

I'm attaching my reviewer's patch. I'm working with the git repo, and I'm confused by this directory renaming stuff, so I guess it'll be easier if I link to my git branch on trac.

I'm not giving a positive review right away, so that you can review my patch, and give your opinion on renaming the file. Enjoy vacation!



---

archive/issue_comments_159489.json:
```json
{
    "body": "reviewer patch",
    "created_at": "2013-08-28T16:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159489",
    "user": "https://github.com/defeo"
}
```

reviewer patch



---

archive/issue_comments_159490.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[trac_13615_second_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_second_review.patch.gz)**\n\nFound the time to make a mercurial patch.\n\nApply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b",
    "created_at": "2013-08-28T16:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159490",
    "user": "https://github.com/defeo"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[trac_13615_second_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_second_review.patch.gz)**

Found the time to make a mercurial patch.

Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​



---

archive/issue_comments_159491.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b\n \n``````\n",
    "created_at": "2013-08-28T16:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159491",
    "user": "https://github.com/defeo"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​
 
``````




---

archive/issue_comments_159492.json:
```json
{
    "body": "Changed branch from **[u/defeo/trac13615](https://github.com/sagemath/sagetrac-mirror/tree/u/defeo/trac13615)** to none",
    "created_at": "2013-08-28T16:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159492",
    "user": "https://github.com/defeo"
}
```

Changed branch from **[u/defeo/trac13615](https://github.com/sagemath/sagetrac-mirror/tree/u/defeo/trac13615)** to none



---

archive/issue_comments_159493.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThanks a lot for making your changes in to a mercurial patch.  Looking at it reminded me that I had always intended to remove the global (to the module) isog_table anyway, replacing it with a function as we did for the hyperelliptic_isogeny_data which plays a rather similar role.  IN addition this meanse that instaed of having these mysterious numbers in there, I can put in a function which by default returns stored values, but can also compute them on the fly, which then (1) allowed doctesting and (2) makes it clearer where they come from (currently this is partially done in an extended comment).  The result will be something like the (cached) function Psi(l, use_stored=True) which was converted to this form when someone noticed that this file contributed a non-negligible amount to Sage's startup time.  I will do that tomorrow.",
    "created_at": "2013-09-03T15:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159493",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:14" align="right">comment:14</div>

Thanks a lot for making your changes in to a mercurial patch.  Looking at it reminded me that I had always intended to remove the global (to the module) isog_table anyway, replacing it with a function as we did for the hyperelliptic_isogeny_data which plays a rather similar role.  IN addition this meanse that instaed of having these mysterious numbers in there, I can put in a function which by default returns stored values, but can also compute them on the fly, which then (1) allowed doctesting and (2) makes it clearer where they come from (currently this is partially done in an extended comment).  The result will be something like the (cached) function Psi(l, use_stored=True) which was converted to this form when someone noticed that this file contributed a non-negligible amount to Sage's startup time.  I will do that tomorrow.



---

archive/issue_comments_159494.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nExcellent! I should have time to review it before the end of the week.\n\nNote that the patches do not apply anymore, according to patchbot.",
    "created_at": "2013-09-03T16:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159494",
    "user": "https://github.com/defeo"
}
```

<div id="comment:15" align="right">comment:15</div>

Excellent! I should have time to review it before the end of the week.

Note that the patches do not apply anymore, according to patchbot.



---

archive/issue_comments_159495.json:
```json
{
    "body": "Apply after all previous patches",
    "created_at": "2013-09-04T10:52:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159495",
    "user": "https://github.com/JohnCremona"
}
```

Apply after all previous patches



---

archive/issue_comments_159496.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b\n+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b, trac_13615_extra.patch\n \n``````\n",
    "created_at": "2013-09-04T10:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159496",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​
+Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​, trac_13615_extra.patch
 
``````




---

archive/issue_comments_159497.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_13615_extra.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_extra.patch.gz)**\n\nI had no trouble in applying the 4 patches to 5.12.beta4.  The additional patch does what I said before, i.e. replaces the global dict called _isog_table with a function _sporadic_Q_data which by default returns precomputed data, but can also compute it from scratch.  The function has a test (which only takes 2 seconds to run) which checks that the computed and stored values are the same for all 11 possible inputs.\n\nI think we have now done everything mentioned above, except for possibly changing the name of the new file from isogeny_genus_0 to isogeny_small_degree.  If you want that, I can change my patch to do that too.  \n\nI am just running a full test...done.",
    "created_at": "2013-09-04T10:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159497",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_13615_extra.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_extra.patch.gz)**

I had no trouble in applying the 4 patches to 5.12.beta4.  The additional patch does what I said before, i.e. replaces the global dict called _isog_table with a function _sporadic_Q_data which by default returns precomputed data, but can also compute it from scratch.  The function has a test (which only takes 2 seconds to run) which checks that the computed and stored values are the same for all 11 possible inputs.

I think we have now done everything mentioned above, except for possibly changing the name of the new file from isogeny_genus_0 to isogeny_small_degree.  If you want that, I can change my patch to do that too.  

I am just running a full test...done.



---

archive/issue_comments_159498.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nJust doctested with `--all --long`. Everything looks ok.\n\nThe patchbot is still skipping my patch, so I guess it won't be able to apply.\n\nMaybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?",
    "created_at": "2013-09-04T13:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159498",
    "user": "https://github.com/defeo"
}
```

<div id="comment:17" align="right">comment:17</div>

Just doctested with `--all --long`. Everything looks ok.

The patchbot is still skipping my patch, so I guess it won't be able to apply.

Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?



---

archive/issue_comments_159499.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@defeo](#comment%3A17):\n> Just doctested with `--all --long`. Everything looks ok.\n> \n> The patchbot is still skipping my patch, so I guess it won't be able to apply.\n> \n> Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?\n\nOK, I will do that.  Watch this space.",
    "created_at": "2013-09-04T13:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159499",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@defeo](#comment%3A17):
> Just doctested with `--all --long`. Everything looks ok.
> 
> The patchbot is still skipping my patch, so I guess it won't be able to apply.
> 
> Maybe folding all the patches into a single one could help; that would also be a good occasion to change the file name. Can you do it?

OK, I will do that.  Watch this space.



---

archive/issue_comments_159500.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch\u200b, trac_13615_extra.patch\n+Apply: trac_13615_combined.patch\n \n``````\n",
    "created_at": "2013-09-04T13:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159500",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply: ell_curve_isogeny_split.patch, isogeny_genus_0.patch, trac_13615_review.patch, trac_13615_second_review.patch​, trac_13615_extra.patch
+Apply: trac_13615_combined.patch
 
``````




---

archive/issue_comments_159501.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe new patch trac_13615_combined.patch combines all thre previous patches into one, which applies to 5.12.beta4.  The only additional difference is that the new file which was called isogeny_genus_0.py is now  classed isogeny_small_degree.py.\n\nReady for a final review!",
    "created_at": "2013-09-04T13:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159501",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:20" align="right">comment:20</div>

The new patch trac_13615_combined.patch combines all thre previous patches into one, which applies to 5.12.beta4.  The only additional difference is that the new file which was called isogeny_genus_0.py is now  classed isogeny_small_degree.py.

Ready for a final review!



---

archive/issue_comments_159502.json:
```json
{
    "body": "Attachment: **[trac_13615_3rd_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_3rd_review.patch.gz)**",
    "created_at": "2013-09-04T14:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159502",
    "user": "https://github.com/defeo"
}
```

Attachment: **[trac_13615_3rd_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_3rd_review.patch.gz)**



---

archive/issue_comments_159503.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply: trac_13615_combined.patch\n+Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch\n \n``````\n",
    "created_at": "2013-09-04T14:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159503",
    "user": "https://github.com/defeo"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply: trac_13615_combined.patch
+Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch
 
``````




---

archive/issue_comments_159504.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHere's one more review. I've corrected a few spelling mistakes, and modified `isogenies_sporadic_Q` to be slightly more readable and pythonic.\n\nIt is good to go for me. Feel free to give positive review if you accept my reviewer patch.\n\nApply only: trac_13615_combined.patch, trac_13615_3rd_review.patch",
    "created_at": "2013-09-04T14:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159504",
    "user": "https://github.com/defeo"
}
```

<div id="comment:21" align="right">comment:21</div>

Here's one more review. I've corrected a few spelling mistakes, and modified `isogenies_sporadic_Q` to be slightly more readable and pythonic.

It is good to go for me. Feel free to give positive review if you accept my reviewer patch.

Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch



---

archive/issue_comments_159505.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nYou have done rather more than that in your second change.  Yes, it looks neater;  but I have used the knowledge that isogenies of these degrees exist if and only if the j-invariant is one of the known values.  On the other hand, the _sporadic_Q_data function will quickly determine whichm if any, of these apply.  I still feel something has been lost though:  at most one of these l values gives an isogeny, but your core will try them all.",
    "created_at": "2013-09-04T14:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159505",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:22" align="right">comment:22</div>

You have done rather more than that in your second change.  Yes, it looks neater;  but I have used the knowledge that isogenies of these degrees exist if and only if the j-invariant is one of the known values.  On the other hand, the _sporadic_Q_data function will quickly determine whichm if any, of these apply.  I still feel something has been lost though:  at most one of these l values gives an isogeny, but your core will try them all.



---

archive/issue_comments_159506.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nYes, definitely. But,\n\n1. These j-invariants are big numbers, hard to compare visually. Before your last patch they used to be only in one place: `_isog_table`, after they were replicated in `_sporadic_Q_data` **and** `isogenies_sporadic_Q`, making it harder to verify that you did not leave out some j by mistake.\n\n2. Efficiency-wise, your code does 11 + 11 equality tests in `QQ`, mine does 11 * 11. An equality test in `QQ` takes ~3\u03bcs on my laptop, and indeed testing `isogenies_sporadic_Q` I get a ~300\u03bcs slowdown for a curve which has no isogeny (and thus goes through all tests). That's a serious penalty (about 10x) for a curve which has no isogeny, but it's negligible for a sporadic curve (where it takes in the order of milliseconds to return the isogeny). Do we really care?",
    "created_at": "2013-09-04T15:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159506",
    "user": "https://github.com/defeo"
}
```

<div id="comment:23" align="right">comment:23</div>

Yes, definitely. But,

1. These j-invariants are big numbers, hard to compare visually. Before your last patch they used to be only in one place: `_isog_table`, after they were replicated in `_sporadic_Q_data` **and** `isogenies_sporadic_Q`, making it harder to verify that you did not leave out some j by mistake.

2. Efficiency-wise, your code does 11 + 11 equality tests in `QQ`, mine does 11 * 11. An equality test in `QQ` takes ~3μs on my laptop, and indeed testing `isogenies_sporadic_Q` I get a ~300μs slowdown for a curve which has no isogeny (and thus goes through all tests). That's a serious penalty (about 10x) for a curve which has no isogeny, but it's negligible for a sporadic curve (where it takes in the order of milliseconds to return the isogeny). Do we really care?



---

archive/issue_comments_159507.json:
```json
{
    "body": "Changed keywords from **isogenies, sd51** to **isogenies, sd51, sd52**",
    "created_at": "2013-09-04T15:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159507",
    "user": "https://github.com/defeo"
}
```

Changed keywords from **isogenies, sd51** to **isogenies, sd51, sd52**



---

archive/issue_comments_159508.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI definitely agree that there should be only one place where this finite list of exceptional pairs is listed!  One advantage of the old dict was that one could easily check whether (l,j) was in isog_table.keys(), and perhaps that list should still exist somewhere, and used in the function _sporadic_data_Q instead of what I do now.\n\nYou have certainly done a thorough job checking the timings!  Of course, curves which are not sporadic are the vast majority (and I use this code on files with many thousands of curves) so I would like to eliminate them from consideration as soon as possible.\n\nHere's one possible plan:  have a global dict with 11 entries, the keys are the sporadic j-invariants and the vales are the associated primes l.   Then _sporadic_data_Q can check if the j-invariant is a key and return what it does now if so, while isogenies_sporadic_Q can also use the same dict.  If you like that, I will do it.",
    "created_at": "2013-09-04T15:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159508",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:25" align="right">comment:25</div>

I definitely agree that there should be only one place where this finite list of exceptional pairs is listed!  One advantage of the old dict was that one could easily check whether (l,j) was in isog_table.keys(), and perhaps that list should still exist somewhere, and used in the function _sporadic_data_Q instead of what I do now.

You have certainly done a thorough job checking the timings!  Of course, curves which are not sporadic are the vast majority (and I use this code on files with many thousands of curves) so I would like to eliminate them from consideration as soon as possible.

Here's one possible plan:  have a global dict with 11 entries, the keys are the sporadic j-invariants and the vales are the associated primes l.   Then _sporadic_data_Q can check if the j-invariant is a key and return what it does now if so, while isogenies_sporadic_Q can also use the same dict.  If you like that, I will do it.



---

archive/issue_comments_159509.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nIf it's sheer speed you're looking after, you should revert to the old code. The time for `isogenies_sporadic_Q` on a non-sporadic curve has gone up from ~4\u03bcs before this ticket, to ~35\u03bcs after your patch (to ~340\u03bcs after mine).\n\nEither you can keep the old `_isog_table` and implement `_sporadic_Q_data` just for test purposes (and why not make doctests #optional, in that case), or, if you want to improve startup time, you make `_sporadic_Q_data` return the whole dictionary, and apply the `@cached_function` decorator to it.",
    "created_at": "2013-09-04T16:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159509",
    "user": "https://github.com/defeo"
}
```

<div id="comment:26" align="right">comment:26</div>

If it's sheer speed you're looking after, you should revert to the old code. The time for `isogenies_sporadic_Q` on a non-sporadic curve has gone up from ~4μs before this ticket, to ~35μs after your patch (to ~340μs after mine).

Either you can keep the old `_isog_table` and implement `_sporadic_Q_data` just for test purposes (and why not make doctests #optional, in that case), or, if you want to improve startup time, you make `_sporadic_Q_data` return the whole dictionary, and apply the `@cached_function` decorator to it.



---

archive/issue_comments_159510.json:
```json
{
    "body": "Attachment: **[trac_13615_combined.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined.patch.gz)**\n\nReplaces all previous patches",
    "created_at": "2013-09-04T16:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159510",
    "user": "https://github.com/JohnCremona"
}
```

Attachment: **[trac_13615_combined.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined.patch.gz)**

Replaces all previous patches



---

archive/issue_comments_159511.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI have repalced my combined patch with one which corrects the typo you found and implements an alternative solution to the problem you noted.  Back to you!",
    "created_at": "2013-09-04T16:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159511",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:27" align="right">comment:27</div>

I have repalced my combined patch with one which corrects the typo you found and implements an alternative solution to the problem you noted.  Back to you!



---

archive/issue_comments_159512.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch\n+Apply only: trac_13615_combined.patch\n \n``````\n",
    "created_at": "2013-09-04T16:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159512",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply only: trac_13615_combined.patch, trac_13615_3rd_review.patch
+Apply only: trac_13615_combined.patch
 
``````




---

archive/issue_comments_159513.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI did not notive your last comment until I had posted mine (and the new patch), but I have had enough on this for today...",
    "created_at": "2013-09-04T16:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159513",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:28" align="right">comment:28</div>

I did not notive your last comment until I had posted mine (and the new patch), but I have had enough on this for today...



---

archive/issue_comments_159514.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAttachment: **[trac_13615_combined_4th_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)**\n\nApply only: trac_13615_combined_4th_review.patch\u200b \n\n`_sporadic_Q_data` takes less than 1/2 a second to compute its output from scratch for any j-invariant. I see no reason not to compute the data on the fly and store it with `@cached_function`\n\nThis new patch removes the precomputed data from the code (most of it is moved in the doctest), and makes `_sporadic_Q_data` a cached function. `isogeny_sporadic_Q` now tests its input against a dictionary mapping j-invariants to degrees, and is thus much faster on non-sporadic curves.\n\nHere is the timings I get on my laptop.\n\n```\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import sporadic_j, _sporadic_Q_data\nsage: for j in sporadic_j.keys():\n....:    timeit('_sporadic_Q_data(j)', globals=globals().update({'j':j}), number=1, repeat=1)\n1 loops, best of 1: 167 ms per loop\n1 loops, best of 1: 71.2 ms per loop\n1 loops, best of 1: 400 ms per loop\n1 loops, best of 1: 69.1 ms per loop\n1 loops, best of 1: 59.7 ms per loop\n1 loops, best of 1: 110 ms per loop\n1 loops, best of 1: 139 ms per loop\n1 loops, best of 1: 64.8 ms per loop\n1 loops, best of 1: 107 ms per loop\n1 loops, best of 1: 113 ms per loop\n1 loops, best of 1: 66.9 ms per loop\n\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_sporadic_Q\nsage: E = EllipticCurve(j=QQ.random_element())\nsage: timeit('isogenies_sporadic_Q(E)', globals=globals())\n625 loops, best of 3: 1.1 \u00b5s per loop\n```\n\nWhat do you think of it?",
    "created_at": "2013-09-06T23:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159514",
    "user": "https://github.com/defeo"
}
```

<div id="comment:29" align="right">comment:29</div>

Attachment: **[trac_13615_combined_4th_review.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)**

Apply only: trac_13615_combined_4th_review.patch​ 

`_sporadic_Q_data` takes less than 1/2 a second to compute its output from scratch for any j-invariant. I see no reason not to compute the data on the fly and store it with `@cached_function`

This new patch removes the precomputed data from the code (most of it is moved in the doctest), and makes `_sporadic_Q_data` a cached function. `isogeny_sporadic_Q` now tests its input against a dictionary mapping j-invariants to degrees, and is thus much faster on non-sporadic curves.

Here is the timings I get on my laptop.

```
sage: from sage.schemes.elliptic_curves.isogeny_small_degree import sporadic_j, _sporadic_Q_data
sage: for j in sporadic_j.keys():
....:    timeit('_sporadic_Q_data(j)', globals=globals().update({'j':j}), number=1, repeat=1)
1 loops, best of 1: 167 ms per loop
1 loops, best of 1: 71.2 ms per loop
1 loops, best of 1: 400 ms per loop
1 loops, best of 1: 69.1 ms per loop
1 loops, best of 1: 59.7 ms per loop
1 loops, best of 1: 110 ms per loop
1 loops, best of 1: 139 ms per loop
1 loops, best of 1: 64.8 ms per loop
1 loops, best of 1: 107 ms per loop
1 loops, best of 1: 113 ms per loop
1 loops, best of 1: 66.9 ms per loop

sage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_sporadic_Q
sage: E = EllipticCurve(j=QQ.random_element())
sage: timeit('isogenies_sporadic_Q(E)', globals=globals())
625 loops, best of 3: 1.1 µs per loop
```

What do you think of it?



---

archive/issue_comments_159515.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,4 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply only: trac_13615_combined.patch\n-\n+Apply only: trac_13615_combined_4th_review.patch\u200b \n``````\n",
    "created_at": "2013-09-06T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159515",
    "user": "https://github.com/defeo"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,4 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply only: trac_13615_combined.patch
-
+Apply only: trac_13615_combined_4th_review.patch​ 
``````




---

archive/issue_comments_159516.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nApply only: trac_13615_combined_4th_review.patch\u200b",
    "created_at": "2013-09-06T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159516",
    "user": "https://github.com/defeo"
}
```

<div id="comment:30" align="right">comment:30</div>

Apply only: trac_13615_combined_4th_review.patch​



---

archive/issue_comments_159517.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThanks a lot for your work on this.  I'll look at it properly as soon as I can.  \n\nSome explanation:  I generally prefer to do things algebraically,  and when I first coded these `_sporadic_Q_data` things about 4 years ago, I did so algebraically, except for the 163 case for which which that was impractical.  When I started to write the function a few days ago, which returned precomputed data by default but also could do the computations on the fly, I also went for the algebraic approach for the first few (which is very quick for 11, 17, 19), but then for simplicity decided that if any were to be computed via floating point then they all could be.  Precision issues were easy to deal with, since we already knew the correct result, so I just did some experimentation to determine how much precision was required to get it right in each case.   And as you just observed, the result is so quick in every case that having the precomputed values stored is no longer necessary!  I still like the idea of preserving the \"correct\" data in doctests, though they do take up quite a few lines in the file.",
    "created_at": "2013-09-07T13:41:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159517",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:31" align="right">comment:31</div>

Thanks a lot for your work on this.  I'll look at it properly as soon as I can.  

Some explanation:  I generally prefer to do things algebraically,  and when I first coded these `_sporadic_Q_data` things about 4 years ago, I did so algebraically, except for the 163 case for which which that was impractical.  When I started to write the function a few days ago, which returned precomputed data by default but also could do the computations on the fly, I also went for the algebraic approach for the first few (which is very quick for 11, 17, 19), but then for simplicity decided that if any were to be computed via floating point then they all could be.  Precision issues were easy to deal with, since we already knew the correct result, so I just did some experimentation to determine how much precision was required to get it right in each case.   And as you just observed, the result is so quick in every case that having the precomputed values stored is no longer necessary!  I still like the idea of preserving the "correct" data in doctests, though they do take up quite a few lines in the file.



---

archive/issue_comments_159518.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.",
    "created_at": "2013-09-07T13:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159518",
    "user": "https://github.com/defeo"
}
```

<div id="comment:32" align="right">comment:32</div>

I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.



---

archive/issue_comments_159519.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@defeo](#comment%3A32):\n> I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.\n\nIt isn't necessary, as any test which computes a 163-isogeny from an elliptic curve with that invariant will implicitly check that the output is correct.",
    "created_at": "2013-09-07T14:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159519",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@defeo](#comment%3A32):
> I preserved all the data, except the 163 case, in the doctest. But if you like it, I have nothing against including 163 too.

It isn't necessary, as any test which computes a 163-isogeny from an elliptic curve with that invariant will implicitly check that the output is correct.



---

archive/issue_comments_159520.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI'm just investigating this:\n\n```\nFile \"sage/schemes/elliptic_curves/ell_rational_field.py\", line 4191, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.reduction.isogenies_prime_degree\nFailed example:\n    E.isogenies_prime_degree(4) \nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: 4 is not prime.\nGot:\n    []\n```\nPreviously the function `isogenies_sporadic_Q` checked that l is primes before tesing to see if (l,j) is in the list.  Now we don't.  But I think that this is fair, since by definition there are no sporadic l-isogenies if l is not prime.  So I am moving the (pseudo-)primality test for l into `ell_rational_field` where the failing doctest is.",
    "created_at": "2013-09-07T14:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159520",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:34" align="right">comment:34</div>

I'm just investigating this:

```
File "sage/schemes/elliptic_curves/ell_rational_field.py", line 4191, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.reduction.isogenies_prime_degree
Failed example:
    E.isogenies_prime_degree(4) 
Expected:
    Traceback (most recent call last):
    ...
    ValueError: 4 is not prime.
Got:
    []
```
Previously the function `isogenies_sporadic_Q` checked that l is primes before tesing to see if (l,j) is in the list.  Now we don't.  But I think that this is fair, since by definition there are no sporadic l-isogenies if l is not prime.  So I am moving the (pseudo-)primality test for l into `ell_rational_field` where the failing doctest is.



---

archive/issue_comments_159521.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nMy fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.",
    "created_at": "2013-09-07T14:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159521",
    "user": "https://github.com/defeo"
}
```

<div id="comment:35" align="right">comment:35</div>

My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.



---

archive/issue_comments_159522.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@defeo](#comment%3A35):\n> My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.\n\nNo problem.  I'm about to upload a small addition patch for this.",
    "created_at": "2013-09-07T14:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159522",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@defeo](#comment%3A35):
> My fault. I removed a test for the primality of l in `isogenies_sporadic_Q`.

No problem.  I'm about to upload a small addition patch for this.



---

archive/issue_comments_159523.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply only: trac_13615_combined_4th_review.patch\u200b \n+Apply only: trac_13615_combined_4th_review.patch\u200b, trac_13615_fix.patch\n``````\n",
    "created_at": "2013-09-07T14:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159523",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply only: trac_13615_combined_4th_review.patch​ 
+Apply only: trac_13615_combined_4th_review.patch​, trac_13615_fix.patch
``````




---

archive/issue_comments_159524.json:
```json
{
    "body": "Changed author from **Kimi Tsukazaki, John Cremona** to **Kimi Tsukazaki, John Cremona, Luca de Feo**",
    "created_at": "2013-09-07T14:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159524",
    "user": "https://github.com/JohnCremona"
}
```

Changed author from **Kimi Tsukazaki, John Cremona** to **Kimi Tsukazaki, John Cremona, Luca de Feo**



---

archive/issue_comments_159525.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nDone.  It's slightly better than before since now `E.isogenies_prime_degree(\"rubbish\")` calmly raises an error saying that \"rubbish\" is no prime, rather than an error saying that strings do not have an `is_prime` attribute.  (But I did not add another doctest for that.)\n\nSince I am happy with your other reviewer changes, if you agree with this latest one then I think you can set this to positive review.",
    "created_at": "2013-09-07T14:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159525",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:37" align="right">comment:37</div>

Done.  It's slightly better than before since now `E.isogenies_prime_degree("rubbish")` calmly raises an error saying that "rubbish" is no prime, rather than an error saying that strings do not have an `is_prime` attribute.  (But I did not add another doctest for that.)

Since I am happy with your other reviewer changes, if you agree with this latest one then I think you can set this to positive review.



---

archive/issue_comments_159526.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nLooks ok to me. Good job.",
    "created_at": "2013-09-07T14:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159526",
    "user": "https://github.com/defeo"
}
```

<div id="comment:38" align="right">comment:38</div>

Looks ok to me. Good job.



---

archive/issue_comments_159527.json:
```json
{
    "body": "Changed author from **Kimi Tsukazaki, John Cremona, Luca de Feo** to **Kimi Tsukazaki, John Cremona, Luca De Feo**",
    "created_at": "2013-09-07T14:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159527",
    "user": "https://github.com/defeo"
}
```

Changed author from **Kimi Tsukazaki, John Cremona, Luca de Feo** to **Kimi Tsukazaki, John Cremona, Luca De Feo**



---

archive/issue_events_188551.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2013-09-07T14:57:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188551"
}
```



---

archive/issue_events_188552.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2013-09-07T14:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188552"
}
```



---

archive/issue_comments_159528.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nApply only: trac_13615_combined_4th_review.patch\u200b, trac_13615_fix.patch\u200b",
    "created_at": "2013-09-07T14:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159528",
    "user": "https://github.com/defeo"
}
```

<div id="comment:39" align="right">comment:39</div>

Apply only: trac_13615_combined_4th_review.patch​, trac_13615_fix.patch​



---

archive/issue_comments_159529.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@defeo](#comment%3A38):\n> Looks ok to me. Good job.\n\nThanks -- and a good case of thorough and constructive reviewing!  Sorry about /d/D/.",
    "created_at": "2013-09-07T14:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159529",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@defeo](#comment%3A38):
> Looks ok to me. Good job.

Thanks -- and a good case of thorough and constructive reviewing!  Sorry about /d/D/.



---

archive/issue_comments_159530.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nPatchbot is still not getting it. I don't know what else to do!\n\nApply trac_13615_combined_4th_review.patch\u200b\n\nApply trac_13615_fix.patch\u200b",
    "created_at": "2013-09-07T15:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159530",
    "user": "https://github.com/defeo"
}
```

<div id="comment:41" align="right">comment:41</div>

Patchbot is still not getting it. I don't know what else to do!

Apply trac_13615_combined_4th_review.patch​

Apply trac_13615_fix.patch​



---

archive/issue_comments_159531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.\n \n-Apply only: trac_13615_combined_4th_review.patch\u200b, trac_13615_fix.patch\n+Apply only: [attachment: trac_13615_combined_4th_review.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)\u200b, [attachment: trac_13615_fix.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)\n+\n``````\n",
    "created_at": "2013-09-07T17:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159531",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 In this ticket we will add extra functionality to be able to compute l-isogenies for arbitrary prime degrees.
 
-Apply only: trac_13615_combined_4th_review.patch​, trac_13615_fix.patch
+Apply only: [attachment: trac_13615_combined_4th_review.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_combined_4th_review.patch.gz)​, [attachment: trac_13615_fix.patch](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)
+
``````




---

archive/issue_comments_159532.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI changed the formatting of the patching instructions.  Perhaps that will work.",
    "created_at": "2013-09-07T17:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159532",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:43" align="right">comment:43</div>

I changed the formatting of the patching instructions.  Perhaps that will work.



---

archive/issue_events_188553.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188553"
}
```



---

archive/issue_events_188554.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188554"
}
```



---

archive/issue_events_188555.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-29T16:17:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188555"
}
```



---

archive/issue_events_188556.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-29T16:17:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188556"
}
```



---

archive/issue_comments_159533.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThere are problems while building the documentation:\n\n```\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_general:15: WARNING: Literal block expected; none found.\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_0:22: WARNING: Literal block expected; none found.\ndochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_plus_0:21: WARNING: Literal block expected; none found.\n```",
    "created_at": "2013-09-29T16:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159533",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

There are problems while building the documentation:

```
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_general:15: WARNING: Literal block expected; none found.
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_0:22: WARNING: Literal block expected; none found.
dochtml.log:[plane_cur] /scratch/release/merger/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py:docstring of sage.schemes.elliptic_curves.isogeny_small_degree.isogenies_prime_degree_genus_plus_0:21: WARNING: Literal block expected; none found.
```



---

archive/issue_comments_159534.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nNote: the errors above usually arise if you do something like\n\n```\nEXAMPLES::\n\nSome explaining text::\n\n    sage: 1+1\n    2\n```\nThe above is **wrong**, the first line should have single colon.",
    "created_at": "2013-09-29T16:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159534",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Note: the errors above usually arise if you do something like

```
EXAMPLES::

Some explaining text::

    sage: 1+1
    2
```
The above is **wrong**, the first line should have single colon.



---

archive/issue_comments_159535.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nCertainly -- and this will be fixed very soon!  Don't let 5.13 out without this, please!",
    "created_at": "2013-09-29T16:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159535",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:47" align="right">comment:47</div>

Certainly -- and this will be fixed very soon!  Don't let 5.13 out without this, please!



---

archive/issue_comments_159536.json:
```json
{
    "body": "Attachment: **[trac_13615_fix.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)**\n\nsmall fix for trac_13615_combined_4th_review.patch",
    "created_at": "2013-09-30T10:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159536",
    "user": "https://github.com/JohnCremona"
}
```

Attachment: **[trac_13615_fix.patch.gz](https://github.com/sagemath/sage/files/ticket13615/trac_13615_fix.patch.gz)**

small fix for trac_13615_combined_4th_review.patch



---

archive/issue_comments_159537.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI changed the second patch which fixes the three problems (which were, in fact all the same: an ALGORITHM block erroneously had :: instead of :).\n\nI took the liberty of changing back to positive review.",
    "created_at": "2013-09-30T10:50:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159537",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:48" align="right">comment:48</div>

I changed the second patch which fixes the three problems (which were, in fact all the same: an ALGORITHM block erroneously had :: instead of :).

I took the liberty of changing back to positive review.



---

archive/issue_events_188557.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-09-30T10:50:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188557"
}
```



---

archive/issue_events_188558.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-09-30T10:50:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188558"
}
```



---

archive/issue_comments_159538.json:
```json
{
    "body": "Merged: **sage-5.13.beta0**",
    "created_at": "2013-10-02T06:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159538",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.beta0**



---

archive/issue_events_188559.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:35:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188559"
}
```



---

archive/issue_events_188560.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:35:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13615#event-188560"
}
```



---

archive/issue_comments_159539.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nWe have a problem, which I am investigating:\n\n```\nsage: K.<i> = NumberField(x^2+1)                                                                         \nsage: E = EllipticCurve(K,[-2*i-1,0])                                                                   \nsage: E.isogenies_prime_degree(17)\n...\n\nValueError: The polynomial does not define a finite subgroup of the elliptic curve.\n```\nwhile in fact this curve does have 2 17-isogenies:\n\n```\nsage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general\nsage: isogenies_prime_degree_general(E,17) # rather slow\n[Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-82*i-641)*x over Number Field in i with defining polynomial x^2 + 1,\n Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-562*i+319)*x over Number Field in i with defining polynomial x^2 + 1]\n```\n\nThis was found by Warwick undergraduate Warren Moore, and I am looking into it....\n\nThis problem can be fixed as follows:  in line 1770 of isogeny_small_degree.py replace -27*c4 by -27*c4/1296 (or -c4/48) twice.  Something similar may be needed on line 1690 (the j=0 endomorphism case).  I will check that out and make a patch.\n\nSee #15434 for the extra patch!",
    "created_at": "2013-11-18T09:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13615",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13615#issuecomment-159539",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:50" align="right">comment:50</div>

We have a problem, which I am investigating:

```
sage: K.<i> = NumberField(x^2+1)                                                                         
sage: E = EllipticCurve(K,[-2*i-1,0])                                                                   
sage: E.isogenies_prime_degree(17)
...

ValueError: The polynomial does not define a finite subgroup of the elliptic curve.
```
while in fact this curve does have 2 17-isogenies:

```
sage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general
sage: isogenies_prime_degree_general(E,17) # rather slow
[Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-82*i-641)*x over Number Field in i with defining polynomial x^2 + 1,
 Isogeny of degree 17 from Elliptic Curve defined by y^2 = x^3 + (-2*i-1)*x over Number Field in i with defining polynomial x^2 + 1 to Elliptic Curve defined by y^2 = x^3 + (-562*i+319)*x over Number Field in i with defining polynomial x^2 + 1]
```

This was found by Warwick undergraduate Warren Moore, and I am looking into it....

This problem can be fixed as follows:  in line 1770 of isogeny_small_degree.py replace -27*c4 by -27*c4/1296 (or -c4/48) twice.  Something similar may be needed on line 1690 (the j=0 endomorphism case).  I will check that out and make a patch.

See #15434 for the extra patch!
