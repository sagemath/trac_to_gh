# Issue 13785: Export a graph to a dictionary

archive/issues_013581.json:
```json
{
    "body": "This can be useful, and it can even be used internally. dictionaries are faster than Sage graphs. We currently use networx to improve speed in some algorithms.\n\nAssignee: jason, ncohen, rlm\n\nCC:  @dcoudert\n\nReviewer: David Coudert\n\nAuthor: Nathann Cohen\n\nMerged: sage-5.6.beta1\n\nDependencies: #13784\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13785\n\n",
    "closed_at": "2012-12-21T09:33:28Z",
    "created_at": "2012-12-01T12:36:42Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Export a graph to a dictionary",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13785",
    "user": "https://github.com/nathanncohen"
}
```
This can be useful, and it can even be used internally. dictionaries are faster than Sage graphs. We currently use networx to improve speed in some algorithms.

Assignee: jason, ncohen, rlm

CC:  @dcoudert

Reviewer: David Coudert

Author: Nathann Cohen

Merged: sage-5.6.beta1

Dependencies: #13784

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13785





---

archive/issue_comments_167763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-01T12:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167763",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167764.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_13785.patch](tarball://root/attachments/some-uuid/ticket13785/trac_13785.patch) by @dcoudert created at 2012-12-01 15:02:47\n\nHello,\n\nThis will certainly be useful when one wants to iterate many times over the neighbors and so.\nBut networkx graphs will remain useful when one wants to modify the graph during the algorithm (remove edge or vertex), unless patch #13730 is able to speed up iterations.\n\nI'm waiting for patch #13784 before starting reviewing this patch.",
    "created_at": "2012-12-01T15:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167764",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>Attachment [trac_13785.patch](tarball://root/attachments/some-uuid/ticket13785/trac_13785.patch) by @dcoudert created at 2012-12-01 15:02:47

Hello,

This will certainly be useful when one wants to iterate many times over the neighbors and so.
But networkx graphs will remain useful when one wants to modify the graph during the algorithm (remove edge or vertex), unless patch #13730 is able to speed up iterations.

I'm waiting for patch #13784 before starting reviewing this patch.



---

archive/issue_comments_167765.json:
```json
{
    "body": "<a id='comment:3'></a>Well. I actually begin to write that after a few seconds over you Suurballe algorithm. I read how it worked on wikipedia, and it looks like you just need to change vertex weights and remove a few edges. This can easily be done with dictionaries too `:-)`\n\nOf course, if you need to run Dijkstra on the graph afterwards... `:-P`\n\nBut didn't you have a triangle_count code at Python-level which could use this method already ?\n\nNathann",
    "created_at": "2012-12-02T09:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167765",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Well. I actually begin to write that after a few seconds over you Suurballe algorithm. I read how it worked on wikipedia, and it looks like you just need to change vertex weights and remove a few edges. This can easily be done with dictionaries too `:-)`

Of course, if you need to run Dijkstra on the graph afterwards... `:-P`

But didn't you have a triangle_count code at Python-level which could use this method already ?

Nathann



---

archive/issue_comments_167766.json:
```json
{
    "body": "<a id='comment:4'></a>In patch #13380, I need to modify a copy of the graph (including weights) and then to compute a shortest path on the modified copy. So turning the graph into a dictionary is not sufficient. Furthermore, since we not only modify the weights, but also the graph topology (addition of reverse arcs), a solution allowing to pass to the shortest path method a dictionary of weights is not sufficient. \n\n\nFor triangle counts (#13503), we can replace \n\n```\nggnx = self.networkx_graph() \nfor u in ggnx.nodes_iter(): \n    tr += sum(ggnx.has_edge(v,w) for v,w in combinations_iterator(ggnx.neighbors(u),2)) \nreturn tr/3 \n```\nwith\n\n```\ngg = self.to_dictionary() \nfor u in gg.iterkeys(): \n    tr += sum(w in gg[v] for v,w in combinations_iterator(gg[u],2)) \nreturn tr/3 \n```\nThis will certainly be faster since we don't need edge labels or any other decoration to count.",
    "created_at": "2012-12-02T10:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167766",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>In patch #13380, I need to modify a copy of the graph (including weights) and then to compute a shortest path on the modified copy. So turning the graph into a dictionary is not sufficient. Furthermore, since we not only modify the weights, but also the graph topology (addition of reverse arcs), a solution allowing to pass to the shortest path method a dictionary of weights is not sufficient. 


For triangle counts (#13503), we can replace 

```
ggnx = self.networkx_graph() 
for u in ggnx.nodes_iter(): 
    tr += sum(ggnx.has_edge(v,w) for v,w in combinations_iterator(ggnx.neighbors(u),2)) 
return tr/3 
```
with

```
gg = self.to_dictionary() 
for u in gg.iterkeys(): 
    tr += sum(w in gg[v] for v,w in combinations_iterator(gg[u],2)) 
return tr/3 
```
This will certainly be faster since we don't need edge labels or any other decoration to count.



---

archive/issue_comments_167767.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-02T11:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167767",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167768.json:
```json
{
    "body": "<a id='comment:5'></a>The patch is working properly and passes all tests (including docbuild).\nLoops in digraphs are also properly taken into account.\n\nWe shall later use it to speed up some methods (e.g., triangle count)",
    "created_at": "2012-12-02T11:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167768",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>The patch is working properly and passes all tests (including docbuild).
Loops in digraphs are also properly taken into account.

We shall later use it to speed up some methods (e.g., triangle count)



---

archive/issue_comments_167769.json:
```json
{
    "body": "<a id='comment:6'></a>Thaaaaaaaaaaaaaaaaaanks !!!\n\nNathann",
    "created_at": "2012-12-02T11:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167769",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Thaaaaaaaaaaaaaaaaaanks !!!

Nathann



---

archive/issue_events_038651.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-21T09:33:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13785#event-38651"
}
```



---

archive/issue_comments_167770.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-21T09:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13785#issuecomment-167770",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
