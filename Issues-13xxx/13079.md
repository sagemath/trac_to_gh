# Issue 13079: Use a ranked poset's rank function to determine heights for plotting

archive/issues_012907.json:
```json
{
    "body": "In #12993, Christian had the great idea to use the rank function (for a ranked poset) to compute the heights when plotting a poset.\n\nFor example, we would want the following poset\n\n```\nsage: P = Poset(([1,2,3,4],[[1,4],[2,3],[3,4]]), facade = True)\nsage: P.plot()\n```\nto be plotted like this:\n\n```\n        o\n       / \\\n      o   o\n     /\n    o\n```\n\napply trac-13079-rebase-fc.patch\n\nAssignee: sage-combinat\n\nCC:  sage-combinat stumpc5 @anneschilling @saliola darijgrinberg@gmail.com\n\nKeywords: posets, combinat, plotting, graphics\n\nReviewer: Christian Stump\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Franco Saliola\n\nMerged: sage-5.8.beta0\n\nDependencies: #14006\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13079\n\n",
    "closed_at": "2013-02-17T22:42:22Z",
    "created_at": "2012-06-02T14:55:35Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Use a ranked poset's rank function to determine heights for plotting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13079",
    "user": "https://github.com/saliola"
}
```
In #12993, Christian had the great idea to use the rank function (for a ranked poset) to compute the heights when plotting a poset.

For example, we would want the following poset

```
sage: P = Poset(([1,2,3,4],[[1,4],[2,3],[3,4]]), facade = True)
sage: P.plot()
```
to be plotted like this:

```
        o
       / \
      o   o
     /
    o
```

apply trac-13079-rebase-fc.patch

Assignee: sage-combinat

CC:  sage-combinat stumpc5 @anneschilling @saliola darijgrinberg@gmail.com

Keywords: posets, combinat, plotting, graphics

Reviewer: Christian Stump

Author: Frédéric Chapoton, Franco Saliola

Merged: sage-5.8.beta0

Dependencies: #14006

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13079





---

archive/issue_comments_165208.json:
```json
{
    "body": "Changing keywords from \"posets, combinat\" to \"posets, combinat, plotting, graphics\".",
    "created_at": "2012-06-02T15:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165208",
    "user": "https://github.com/saliola"
}
```

Changing keywords from "posets, combinat" to "posets, combinat, plotting, graphics".



---

archive/issue_comments_165209.json:
```json
{
    "body": "<a id='comment:1'></a>The patch I just posted extracted the relevant bits from #12993. It probably doesn't even apply, but one can reconstruct the modifications from the patch.\n\n**Work issues:**\n\n- fix the patch\n- figure out the pickling issue\n\nI won't have time to work on this over the next week.",
    "created_at": "2012-06-02T15:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165209",
    "user": "https://github.com/saliola"
}
```

<a id='comment:1'></a>The patch I just posted extracted the relevant bits from #12993. It probably doesn't even apply, but one can reconstruct the modifications from the patch.

**Work issues:**

- fix the patch
- figure out the pickling issue

I won't have time to work on this over the next week.



---

archive/issue_comments_165210.json:
```json
{
    "body": "<a id='comment:2'></a>Here is a patch that applies to sage 5.3\n\nBut there is still an annoying pickling problem that I do not understand. Could somebody more advanced have a look ?\n\nApply only trac_13079-plot_ranked_poset-fs.v2.patch",
    "created_at": "2012-09-22T09:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165210",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>Here is a patch that applies to sage 5.3

But there is still an annoying pickling problem that I do not understand. Could somebody more advanced have a look ?

Apply only trac_13079-plot_ranked_poset-fs.v2.patch



---

archive/issue_comments_165211.json:
```json
{
    "body": "<a id='comment:3'></a>apply trac_13079-plot_ranked_poset-fs.v2.patch",
    "created_at": "2013-01-24T14:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165211",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>apply trac_13079-plot_ranked_poset-fs.v2.patch



---

archive/issue_comments_165212.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -16,7 +16,7 @@\n     o\n \\`\\`\\`\n \n-Keywords: posets, combinat\n+apply trac_13079-plot_ranked_poset-fs.v2.patch\n \n Comment: 1\n \n```\n",
    "created_at": "2013-01-24T14:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165212",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -16,7 +16,7 @@
     o
 \`\`\`
 
-Keywords: posets, combinat
+apply trac_13079-plot_ranked_poset-fs.v2.patch
 
 Comment: 1
 
```




---

archive/issue_comments_165213.json:
```json
{
    "body": "<a id='comment:4'></a>This has been reduced to the following problem :\n\n```\nsage: P = Poset(DiGraph())                      \nsage: dumps(P)\n```\nthe dumps work. Then\n\n```\nsage: P.rank_function()\n```\n\n```\nsage: dumps(P) \n```\nthe dumps does no longer work",
    "created_at": "2013-01-24T14:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165213",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>This has been reduced to the following problem :

```
sage: P = Poset(DiGraph())                      
sage: dumps(P)
```
the dumps work. Then

```
sage: P.rank_function()
```

```
sage: dumps(P) 
```
the dumps does no longer work



---

archive/issue_comments_165214.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-25T12:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165214",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165215.json:
```json
{
    "body": "<a id='comment:7'></a>Franco, would you have time to review this little patch ? It makes the bot happy right now, so there is an opportunity to have it into sage soon.\n\nCheers,\n\nFred",
    "created_at": "2013-01-31T17:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165215",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Franco, would you have time to review this little patch ? It makes the bot happy right now, so there is an opportunity to have it into sage soon.

Cheers,

Fred



---

archive/issue_comments_165216.json:
```json
{
    "body": "<a id='comment:8'></a>Hi Fred,\n\nis there a chance to merge the (basically identical) iterations:\n\n```\nif rank_function:\n    for i in self:\n        heights[rank_function(i)].append(relabelling[i])\n```",
    "created_at": "2013-02-01T08:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165216",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:8'></a>Hi Fred,

is there a chance to merge the (basically identical) iterations:

```
if rank_function:
    for i in self:
        heights[rank_function(i)].append(relabelling[i])
```



---

archive/issue_comments_165217.json:
```json
{
    "body": "<a id='comment:9'></a>Well, I do not see a better way to write that. The two iterations are not the same, because one uses the relabelling and the other does not. If you see a more clever way, please tell me.",
    "created_at": "2013-02-01T09:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165217",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>Well, I do not see a better way to write that. The two iterations are not the same, because one uses the relabelling and the other does not. If you see a more clever way, please tell me.



---

archive/issue_comments_165218.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 chapoton]:\n> Well, I do not see a better way to write that. The two iterations are not the same, because one uses the relabelling and the other does not. If you see a more clever way, please tell me.\n\n\nI thought one could use a dummy relabelling dict, but do it as you like!",
    "created_at": "2013-02-01T09:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165218",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:10'></a>Replying to [comment:9 chapoton]:
> Well, I do not see a better way to write that. The two iterations are not the same, because one uses the relabelling and the other does not. If you see a more clever way, please tell me.


I thought one could use a dummy relabelling dict, but do it as you like!



---

archive/issue_comments_165219.json:
```json
{
    "body": "<a id='comment:11'></a>I think that using a relabelling dict when one does not make a relabelling is not a good idea. I would prefer to keep the code as it is now.",
    "created_at": "2013-02-01T09:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165219",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I think that using a relabelling dict when one does not make a relabelling is not a good idea. I would prefer to keep the code as it is now.



---

archive/issue_comments_165220.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 chapoton]:\n> I think that using a relabelling dict when one does not make a relabelling is not a good idea. I would prefer to keep the code as it is now.\n\n\nOkay -- then the only thing left is to somehow test the new behaviour in the doctests. Either by just adding to one of the doctests that it also tests the new code from this patch, or by creating a new doctest.",
    "created_at": "2013-02-01T09:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165220",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:12'></a>Replying to [comment:11 chapoton]:
> I think that using a relabelling dict when one does not make a relabelling is not a good idea. I would prefer to keep the code as it is now.


Okay -- then the only thing left is to somehow test the new behaviour in the doctests. Either by just adding to one of the doctests that it also tests the new code from this patch, or by creating a new doctest.



---

archive/issue_comments_165221.json:
```json
{
    "body": "<a id='comment:13'></a>I have tried to enhance the documentation.",
    "created_at": "2013-02-02T20:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165221",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>I have tried to enhance the documentation.



---

archive/issue_comments_165222.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-04T15:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165222",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165223.json:
```json
{
    "body": "<a id='comment:15'></a>This needs to be rebased to sage-5.7.beta3.",
    "created_at": "2013-02-05T09:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165223",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>This needs to be rebased to sage-5.7.beta3.



---

archive/issue_comments_165224.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-02-05T09:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165224",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_165225.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 jdemeyer]:\n> This needs to be rebased to sage-5.7.beta3.\n\n\nIs sage-5.7.beta3 already released somewhere? -- I can only find beta2...",
    "created_at": "2013-02-05T12:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165225",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:16'></a>Replying to [comment:15 jdemeyer]:
> This needs to be rebased to sage-5.7.beta3.


Is sage-5.7.beta3 already released somewhere? -- I can only find beta2...



---

archive/issue_comments_165226.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 stumpc5]:\n> Replying to [comment:15 jdemeyer]:\n> > This needs to be rebased to sage-5.7.beta3.\n\n> \n> Is sage-5.7.beta3 already released somewhere? -- I can only find beta2...\n\nNow it is.",
    "created_at": "2013-02-05T12:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165226",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:16 stumpc5]:
> Replying to [comment:15 jdemeyer]:
> > This needs to be rebased to sage-5.7.beta3.

> 
> Is sage-5.7.beta3 already released somewhere? -- I can only find beta2...

Now it is.



---

archive/issue_comments_165227.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:15 jdemeyer]:\n> This needs to be rebased to sage-5.7.beta3.\n\n\nHi Fred -- I don't know why the reject is almost everything, could you maybe look at it?\n\nCheers, Christian",
    "created_at": "2013-02-06T13:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165227",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:18'></a>Replying to [comment:15 jdemeyer]:
> This needs to be rebased to sage-5.7.beta3.


Hi Fred -- I don't know why the reject is almost everything, could you maybe look at it?

Cheers, Christian



---

archive/issue_comments_165228.json:
```json
{
    "body": "<a id='comment:19'></a>I guess it is necessary to re-do the ticket starting from the modifications made in #13891\n\nI will not have time to do that until next week.",
    "created_at": "2013-02-06T13:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165228",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>I guess it is necessary to re-do the ticket starting from the modifications made in #13891

I will not have time to do that until next week.



---

archive/issue_comments_165229.json:
```json
{
    "body": "Attachment [trac-13079-rebase-fc.patch](tarball://root/attachments/some-uuid/ticket13079/trac-13079-rebase-fc.patch) by @fchapoton created at 2013-02-09 14:00:51",
    "created_at": "2013-02-09T14:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165229",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac-13079-rebase-fc.patch](tarball://root/attachments/some-uuid/ticket13079/trac-13079-rebase-fc.patch) by @fchapoton created at 2013-02-09 14:00:51



---

archive/issue_comments_165230.json:
```json
{
    "body": "<a id='comment:20'></a>I have rebased the patch on 5.7.beta3\n\napply trac-13079-rebase-fc.patch",
    "created_at": "2013-02-09T14:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165230",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>I have rebased the patch on 5.7.beta3

apply trac-13079-rebase-fc.patch



---

archive/issue_comments_165231.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-09T14:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165231",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_165232.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,22 @@\n+In #12993, Christian had the great idea to use the rank function (for a ranked poset) to compute the heights when plotting a poset.\n \n+For example, we would want the following poset\n+\n+\\`\\`\\`\n+sage: P = Poset(([1,2,3,4],[[1,4],[2,3],[3,4]]), facade = True)\n+sage: P.plot()\n+\\`\\`\\`\n+to be plotted like this:\n+\n+\\`\\`\\`\n+        o\n+       / \\\n+      o   o\n+     /\n+    o\n+\\`\\`\\`\n+\n+apply trac-13079-rebase-fc.patch\n \n Comment: 1\n \n```\n",
    "created_at": "2013-02-09T14:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165232",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,22 @@
+In #12993, Christian had the great idea to use the rank function (for a ranked poset) to compute the heights when plotting a poset.
 
+For example, we would want the following poset
+
+\`\`\`
+sage: P = Poset(([1,2,3,4],[[1,4],[2,3],[3,4]]), facade = True)
+sage: P.plot()
+\`\`\`
+to be plotted like this:
+
+\`\`\`
+        o
+       / \
+      o   o
+     /
+    o
+\`\`\`
+
+apply trac-13079-rebase-fc.patch
 
 Comment: 1
 
```




---

archive/issue_comments_165233.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 chapoton]:\n> I have rebased the patch on 5.7.beta3\n> \n> apply trac-13079-rebase-fc.patch\n\n\ndo you mind if I delete trac_13079-plot_ranked_poset-fs.v2.patch to not confuse the patchbot?",
    "created_at": "2013-02-09T15:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165233",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:21'></a>Replying to [comment:20 chapoton]:
> I have rebased the patch on 5.7.beta3
> 
> apply trac-13079-rebase-fc.patch


do you mind if I delete trac_13079-plot_ranked_poset-fs.v2.patch to not confuse the patchbot?



---

archive/issue_comments_165234.json:
```json
{
    "body": "<a id='comment:22'></a>if you think this can help, please remove the old patch",
    "created_at": "2013-02-09T17:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165234",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>if you think this can help, please remove the old patch



---

archive/issue_comments_165235.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-09T18:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165235",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_035929.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-11T09:16:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13079#event-35929"
}
```



---

archive/issue_events_035930.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-17T22:42:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13079#event-35930"
}
```



---

archive/issue_comments_165236.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-17T22:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13079#issuecomment-165236",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
