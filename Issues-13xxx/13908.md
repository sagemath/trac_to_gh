# Issue 13908: Exit Sage gracefully upon SIGHUP

archive/issues_013704.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "Change the signal handling code to allow a graceful forced exit of Sage. \"graceful\" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.\n\nThis might be used by the doctesting framework to handle timeouts.\n\nThis patch also improves interrupt debugging:\n1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.\n2. Show time between signal received and exception raised. \n\n**Apply**: [attachment: 13908_terminate.patch](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)\n\nDepends on #13748\nDepends on #13946\n\nReviewer: **Volker Braun**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.7.beta2**\n\nComponent: **c_lib**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13908_\n\n",
    "closed_at": "2013-01-30T07:34:48Z",
    "created_at": "2013-01-04T13:25:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20c%20lib",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Exit Sage gracefully upon SIGHUP",
    "type": "issue",
    "updated_at": "2013-02-23T10:15:05Z",
    "url": "https://github.com/sagemath/sage/issues/13908",
    "user": "https://github.com/jdemeyer"
}
```
Change the signal handling code to allow a graceful forced exit of Sage. "graceful" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.

This might be used by the doctesting framework to handle timeouts.

This patch also improves interrupt debugging:
1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.
2. Show time between signal received and exception raised. 

**Apply**: [attachment: 13908_terminate.patch](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)

Depends on #13748
Depends on #13946

Reviewer: **Volker Braun**

Author: **Jeroen Demeyer**

Merged: **sage-5.7.beta2**

Component: **c_lib**

_Issue created by migration from https://trac.sagemath.org/ticket/13908_





---

archive/issue_events_195323.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T13:25:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195323"
}
```



---

archive/issue_events_195324.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T13:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20c%20lib",
    "label_color": "000080",
    "label_name": "c: c lib",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195324"
}
```



---

archive/issue_events_195325.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T13:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195325"
}
```



---

archive/issue_events_195326.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T13:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195326"
}
```



---

archive/issue_events_195327.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T13:25:06Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195327"
}
```



---

archive/issue_events_195328.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-11T10:03:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "title_is": "Exit Sage gracefully upon SIGHUP/SIGTERM",
    "title_was": "Exit Sage gracefully upon SIGHUP",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195328"
}
```



---

archive/issue_comments_164529.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-Change the signal handling code to allow a graceful forced exit of Sage. \"graceful\" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is not interruptible would not be exited.\n+Change the signal handling code to allow a graceful forced exit of Sage. \"graceful\" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.\n \n This might be used by the doctesting framework to handle timeouts.\n-\n-One could argue that we should also handle `SIGTERM` this way, but since the exit is not guaranteed, I prefer not to do this.\n``````\n",
    "created_at": "2013-01-11T10:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164529",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-Change the signal handling code to allow a graceful forced exit of Sage. "graceful" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is not interruptible would not be exited.
+Change the signal handling code to allow a graceful forced exit of Sage. "graceful" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.
 
 This might be used by the doctesting framework to handle timeouts.
-
-One could argue that we should also handle `SIGTERM` this way, but since the exit is not guaranteed, I prefer not to do this.
``````




---

archive/issue_events_195329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-11T14:09:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195329"
}
```



---

archive/issue_comments_164530.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2013-01-11T14:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164530",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_164531.json:
```json
{
    "body": "Changed dependencies from **#13748** to **#13748, #13946**",
    "created_at": "2013-01-11T22:42:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164531",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13748** to **#13748, #13946**



---

archive/issue_events_195330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:15:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195330"
}
```



---

archive/issue_events_195331.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:15:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195331"
}
```



---

archive/issue_events_195332.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-14T16:02:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195332"
}
```



---

archive/issue_events_195333.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-14T16:02:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195333"
}
```



---

archive/issue_comments_164532.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSounds good to me.",
    "created_at": "2013-01-20T17:46:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164532",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Sounds good to me.



---

archive/issue_events_195334.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-01-20T17:46:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195334"
}
```



---

archive/issue_events_195335.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-01-20T17:46:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195335"
}
```



---

archive/issue_comments_164533.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2013-01-20T17:46:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164533",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_195336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-20T20:15:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195336"
}
```



---

archive/issue_events_195337.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-20T20:15:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195337"
}
```



---

archive/issue_events_195338.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T16:19:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195338"
}
```



---

archive/issue_events_195339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T16:19:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195339"
}
```



---

archive/issue_comments_164534.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSee sage-devel.",
    "created_at": "2013-01-21T16:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164534",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

See sage-devel.



---

archive/issue_comments_164535.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSince the main motivation is to have *some* way of gracefully terminating Sage, I'm handling only `SIGHUP` now, not `SIGTERM`.",
    "created_at": "2013-01-28T10:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164535",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Since the main motivation is to have *some* way of gracefully terminating Sage, I'm handling only `SIGHUP` now, not `SIGTERM`.



---

archive/issue_events_195340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-28T10:54:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "title_is": "Exit Sage gracefully upon SIGHUP",
    "title_was": "Exit Sage gracefully upon SIGHUP/SIGTERM",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195340"
}
```



---

archive/issue_comments_164536.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n Change the signal handling code to allow a graceful forced exit of Sage. \"graceful\" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.\n \n This might be used by the doctesting framework to handle timeouts.\n+\n+This patch also improves interrupt debugging:\n+1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.\n+2. Show time between signal received and exception raised. \n+\n+\n``````\n",
    "created_at": "2013-01-28T10:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164536",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
 Change the signal handling code to allow a graceful forced exit of Sage. "graceful" meaning that code is interrupted and the normal exit handlers are run. This graceful exit is not guaranteed to work, code which is currently not interruptible would not be exited.
 
 This might be used by the doctesting framework to handle timeouts.
+
+This patch also improves interrupt debugging:
+1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.
+2. Show time between signal received and exception raised. 
+
+
``````




---

archive/issue_comments_164537.json:
```json
{
    "body": "Attachment: **[13908_no_SIGTERM.patch.gz](https://github.com/sagemath/sage/files/ticket13908/13908_no_SIGTERM.patch.gz)**",
    "created_at": "2013-01-28T10:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164537",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[13908_no_SIGTERM.patch.gz](https://github.com/sagemath/sage/files/ticket13908/13908_no_SIGTERM.patch.gz)**



---

archive/issue_comments_164538.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAttachment: **[13908_terminate.patch.gz](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)**",
    "created_at": "2013-01-28T10:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164538",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Attachment: **[13908_terminate.patch.gz](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)**



---

archive/issue_comments_164539.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n 1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.\n 2. Show time between signal received and exception raised. \n \n-\n+**Apply**: [attachment: 13908_terminate.patch](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)\n``````\n",
    "created_at": "2013-01-28T10:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164539",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
 1. Different debug levels, set in a C file such that not everything needs to be recompiled when changing the debug level.
 2. Show time between signal received and exception raised. 
 
-
+**Apply**: [attachment: 13908_terminate.patch](https://github.com/sagemath/sage/files/ticket13908/13908_terminate.patch.gz)
``````




---

archive/issue_events_195341.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-28T11:25:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195341"
}
```



---

archive/issue_events_195342.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-28T11:25:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195342"
}
```



---

archive/issue_events_195343.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-01-28T14:53:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195343"
}
```



---

archive/issue_events_195344.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-01-28T14:53:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195344"
}
```



---

archive/issue_comments_164540.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHmm I didn't see any discussion on sage-devel about SIGTERM but getting started with just catching SIGHUP is fine, too.",
    "created_at": "2013-01-28T14:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164540",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Hmm I didn't see any discussion on sage-devel about SIGTERM but getting started with just catching SIGHUP is fine, too.



---

archive/issue_comments_164541.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nFor the SIGTERM problem, see [https://groups.google.com/forum/?fromgroups#!search/sage-devel$2013908/sage-devel/5BfDSSdN5qw/AcWANg5v2KwJ](https://groups.google.com/forum/?fromgroups#!search/sage-devel$2013908/sage-devel/5BfDSSdN5qw/AcWANg5v2KwJ)",
    "created_at": "2013-01-28T15:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164541",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

For the SIGTERM problem, see [https://groups.google.com/forum/?fromgroups#!search/sage-devel$2013908/sage-devel/5BfDSSdN5qw/AcWANg5v2KwJ](https://groups.google.com/forum/?fromgroups#!search/sage-devel$2013908/sage-devel/5BfDSSdN5qw/AcWANg5v2KwJ)



---

archive/issue_events_195345.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-30T07:34:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195345"
}
```



---

archive/issue_events_195346.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-30T07:34:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13908#event-195346"
}
```



---

archive/issue_comments_164542.json:
```json
{
    "body": "Merged: **sage-5.7.beta2**",
    "created_at": "2013-01-30T07:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164542",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.7.beta2**



---

archive/issue_comments_164543.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI was running a moinmoin wiki with sage. With this patch applied, that doesn't work anymore because of the new interruption handling in `sage.ext._init_csage`:\n\nWhen running the wiki using\n\n```\n$ sage wikiserver.py\n```\nand importing `sage.all.*` therein, I get the following error:\n\n```\n    from sage.all import *\n  File \"/home/stumpc5/progs/sage-5.7/devel/sage-main/build/sage/all.py\", line 59, in <module>\n    _init_csage()\n  File \"c_lib.pyx\", line 41, in sage.ext.c_lib._init_csage (sage/ext/c_lib.c:569)\n    \nValueError: signal only works in main thread\n```\n\nThe issue seems to be solved when I comment out the signal in `_init_csage`.\n\nQuestion: Is there a (reasonable and finite) way to fix this issue properly? Can something serious go wrong if I comment these lines out?\n\nThanks, Christian",
    "created_at": "2013-02-23T10:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164543",
    "user": "https://github.com/stumpc5"
}
```

<div id="comment:16" align="right">comment:16</div>

I was running a moinmoin wiki with sage. With this patch applied, that doesn't work anymore because of the new interruption handling in `sage.ext._init_csage`:

When running the wiki using

```
$ sage wikiserver.py
```
and importing `sage.all.*` therein, I get the following error:

```
    from sage.all import *
  File "/home/stumpc5/progs/sage-5.7/devel/sage-main/build/sage/all.py", line 59, in <module>
    _init_csage()
  File "c_lib.pyx", line 41, in sage.ext.c_lib._init_csage (sage/ext/c_lib.c:569)
    
ValueError: signal only works in main thread
```

The issue seems to be solved when I comment out the signal in `_init_csage`.

Question: Is there a (reasonable and finite) way to fix this issue properly? Can something serious go wrong if I comment these lines out?

Thanks, Christian



---

archive/issue_comments_164544.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@stumpc5](#comment:16):\n> Can something serious go wrong if I comment these lines out?\n\nNot very serious. Interrupt handling might be a bit messed up, in particular some interrupts (CTRL-C) might be seen twice: once by the default Python handler (`raise KeyboardInterrupt`) and once by the special Sage handler (written in C).\n\nThe line\n\n```\nsignal.signal(signal.SIGINT, sage_python_check_interrupt)\n```\nis mainly used to ensure that only the Sage signal handler is used.\n\nBut this will certainly have no consequences beyond interrupt handling.",
    "created_at": "2013-02-23T10:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13908#issuecomment-164544",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@stumpc5](#comment:16):
> Can something serious go wrong if I comment these lines out?

Not very serious. Interrupt handling might be a bit messed up, in particular some interrupts (CTRL-C) might be seen twice: once by the default Python handler (`raise KeyboardInterrupt`) and once by the special Sage handler (written in C).

The line

```
signal.signal(signal.SIGINT, sage_python_check_interrupt)
```
is mainly used to ensure that only the Sage signal handler is used.

But this will certainly have no consequences beyond interrupt handling.
