# Issue 13640: q-numbers coutings flags stable under a nilpotent endomorphism

archive/issues_013436.json:
```json
{
    "body": "Here is a small patch implementing the function q_jordan which computes the number of complete flags in F_q^n stable under a nilpotent linear endomorphism given by its Jordan type.\n\nThis function is used in ticket #13215.\n\nApply [attachment:trac_13640_qjordan-4.patch]\n\nAssignee: sage-combinat\n\nKeywords: combinatorics, q-numbers\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Xavier Caruso\n\nMerged: sage-5.5.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13640\n\n",
    "closed_at": "2012-11-16T21:25:27Z",
    "created_at": "2012-10-22T14:03:52Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "q-numbers coutings flags stable under a nilpotent endomorphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13640",
    "user": "https://github.com/xcaruso"
}
```
Here is a small patch implementing the function q_jordan which computes the number of complete flags in F_q^n stable under a nilpotent linear endomorphism given by its Jordan type.

This function is used in ticket #13215.

Apply [attachment:trac_13640_qjordan-4.patch]

Assignee: sage-combinat

Keywords: combinatorics, q-numbers

Reviewer: Frédéric Chapoton

Author: Xavier Caruso

Merged: sage-5.5.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13640





---

archive/issue_comments_165389.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-22T14:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165389",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165390.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-09T16:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165390",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_165391.json:
```json
{
    "body": "<a id='comment:3'></a>* it does not look good to use a global variable dict_jordan\n\n* You should instead use the decorator `@`cached_function to cache the results of a procedure.\n\n* every procedure should be doctested.\n\n* do you really need two procedures to do that ?",
    "created_at": "2012-11-09T16:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165391",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>* it does not look good to use a global variable dict_jordan

* You should instead use the decorator `@`cached_function to cache the results of a procedure.

* every procedure should be doctested.

* do you really need two procedures to do that ?



---

archive/issue_comments_165392.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-11-09T18:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165392",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_165393.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 chapoton]:\n> * it does not look good to use a global variable dict_jordan\n> * You should instead use the decorator `@`cached_function to cache the results of a procedure.\n> * every procedure should be doctested.\n> * do you really need two procedures to do that ?\n\n\nThe main problem is that lists are not hashable. Therefore a cached function can't take a list as an argument and, consequently, I can't use the decorator `@`cached_function to cache the result of q_jordan (at least without changing the prototype of this function).\nMoreover, working with just one function would imply to check the shape of the inputs at each recursive call (which is of course useless and may cost a lot).\n\nI propose another implementation (using `@`cached_function and a nested function) in trac_13640_qjordan-2.patch. Please tell me whether it's better or not according to you.",
    "created_at": "2012-11-09T18:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165393",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:4'></a>Replying to [comment:3 chapoton]:
> * it does not look good to use a global variable dict_jordan
> * You should instead use the decorator `@`cached_function to cache the results of a procedure.
> * every procedure should be doctested.
> * do you really need two procedures to do that ?


The main problem is that lists are not hashable. Therefore a cached function can't take a list as an argument and, consequently, I can't use the decorator `@`cached_function to cache the result of q_jordan (at least without changing the prototype of this function).
Moreover, working with just one function would imply to check the shape of the inputs at each recursive call (which is of course useless and may cost a lot).

I propose another implementation (using `@`cached_function and a nested function) in trac_13640_qjordan-2.patch. Please tell me whether it's better or not according to you.



---

archive/issue_comments_165394.json:
```json
{
    "body": "<a id='comment:5'></a>Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.\n\nMaybe this would also solve the hash problem ?",
    "created_at": "2012-11-09T19:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165394",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.

Maybe this would also solve the hash problem ?



---

archive/issue_comments_165395.json:
```json
{
    "body": "<a id='comment:6'></a>Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)",
    "created_at": "2012-11-12T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165395",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:6'></a>Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)



---

archive/issue_comments_165396.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 chapoton]:\n> Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.\n> Maybe this would also solve the hash problem ?\n\n\nSorry I did not comment earlier; the network at the airport was crappy. It would certainly be natural for the input to q_jordan to be a partition, and it should indeed fix the problem.\n\nThat being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.\n\nI let you judge which option is best.\n\nCheers,\n                           Nicolas",
    "created_at": "2012-11-12T20:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165396",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>Replying to [comment:5 chapoton]:
> Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.
> Maybe this would also solve the hash problem ?


Sorry I did not comment earlier; the network at the airport was crappy. It would certainly be natural for the input to q_jordan to be a partition, and it should indeed fix the problem.

That being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.

I let you judge which option is best.

Cheers,
                           Nicolas



---

archive/issue_comments_165397.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 caruso]:\n> Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)\n\n\nDid you run it with %prun? Among other things, it will tell you how many times the method is called, from which you can check whether the cache works.\n\nAh, in this situation, you probably want to use `@`cached_in_parent. Otherwise, the result for p.q_jordan() is cached in p. So if you recreate an identical partition as p2, p2.q_jordan won't see the cache in p.\n\nCheers,\n                                Nicolas",
    "created_at": "2012-11-12T20:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165397",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>Replying to [comment:6 caruso]:
> Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)


Did you run it with %prun? Among other things, it will tell you how many times the method is called, from which you can check whether the cache works.

Ah, in this situation, you probably want to use `@`cached_in_parent. Otherwise, the result for p.q_jordan() is cached in p. So if you recreate an identical partition as p2, p2.q_jordan won't see the cache in p.

Cheers,
                                Nicolas



---

archive/issue_comments_165398.json:
```json
{
    "body": "<a id='comment:9'></a>apply trac_13640_qjordan-4.patch\n\nok, here is a new variant. Still slow, I am afraid.",
    "created_at": "2012-11-12T21:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165398",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>apply trac_13640_qjordan-4.patch

ok, here is a new variant. Still slow, I am afraid.



---

archive/issue_comments_165399.json:
```json
{
    "body": "<a id='comment:10'></a>apply trac_13640_qjordan-4.patch\n\nhere is a new one, thanks to Nicolas comments : with cached_in_parent_method",
    "created_at": "2012-11-12T21:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165399",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>apply trac_13640_qjordan-4.patch

here is a new one, thanks to Nicolas comments : with cached_in_parent_method



---

archive/issue_comments_165400.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-11-12T21:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165400",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_165401.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:7 nthiery]:\n> That being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.\n> \n> I let you judge which option is best.\n\n\nWell, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input. (And note that ``@`cached_function` works well with this solution.)",
    "created_at": "2012-11-13T09:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165401",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:12'></a>Replying to [comment:7 nthiery]:
> That being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.
> 
> I let you judge which option is best.


Well, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input. (And note that ``@`cached_function` works well with this solution.)



---

archive/issue_comments_165402.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 caruso]:\n> Well, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input.\n\n\nSounds good to me.\n\n> (And note that ``@`cached_function` works well with this solution.)\n\n\nYup.",
    "created_at": "2012-11-13T09:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165402",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>Replying to [comment:12 caruso]:
> Well, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input.


Sounds good to me.

> (And note that ``@`cached_function` works well with this solution.)


Yup.



---

archive/issue_comments_165403.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [trac_13640_qjordan-4.patch](tarball://root/attachments/some-uuid/ticket13640/trac_13640_qjordan-4.patch) by @fchapoton created at 2012-11-13 20:02:23\n\napply trac_13640_qjordan-4.patch\n\nhere is a new patch, not touching partition.py at all\n\nthis seems ok to me\n\nlet us wait for the green light",
    "created_at": "2012-11-13T20:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165403",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>Attachment [trac_13640_qjordan-4.patch](tarball://root/attachments/some-uuid/ticket13640/trac_13640_qjordan-4.patch) by @fchapoton created at 2012-11-13 20:02:23

apply trac_13640_qjordan-4.patch

here is a new patch, not touching partition.py at all

this seems ok to me

let us wait for the green light



---

archive/issue_comments_165404.json:
```json
{
    "body": "<a id='comment:15'></a>ok, positive review",
    "created_at": "2012-11-14T08:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165404",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>ok, positive review



---

archive/issue_comments_165405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-14T08:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165405",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165406.json:
```json
{
    "body": "<a id='comment:16'></a>I assume the positive review implies that the work issues have been solved?",
    "created_at": "2012-11-15T09:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165406",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>I assume the positive review implies that the work issues have been solved?



---

archive/issue_comments_165407.json:
```json
{
    "body": "<a id='comment:17'></a>Yes, indeed. I should have removed them, sorry.",
    "created_at": "2012-11-15T09:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165407",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>Yes, indeed. I should have removed them, sorry.



---

archive/issue_events_038067.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-16T21:25:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13640#event-38067"
}
```



---

archive/issue_comments_165408.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-16T21:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13640#issuecomment-165408",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
