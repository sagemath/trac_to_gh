# Issue 13130: Ring support for projective space points and morphisms

archive/issues_012958.json:
```json
{
    "body": "Projective points and morphisms are currently only support over fields. Support for rings is needed.\n\n\nApply:\n* [attachment:trac_13130_rings_for_projective_space.patch]\n\nAssignee: @bhutz\n\nCC:  minz\n\nKeywords: projective space ring\n\nReviewer: Michelle Manes\n\nAuthor: Ben Hutz\n\nMerged: sage-5.8.beta3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13130\n\n",
    "closed_at": "2013-03-04T07:37:05Z",
    "created_at": "2012-06-18T14:59:31Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Ring support for projective space points and morphisms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13130",
    "user": "https://github.com/bhutz"
}
```
Projective points and morphisms are currently only support over fields. Support for rings is needed.


Apply:
* [attachment:trac_13130_rings_for_projective_space.patch]

Assignee: @bhutz

CC:  minz

Keywords: projective space ring

Reviewer: Michelle Manes

Author: Ben Hutz

Merged: sage-5.8.beta3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13130





---

archive/issue_comments_199437.json:
```json
{
    "body": "<a id='comment:1'></a>\nSummary: Adding support for rings in projective spaces.\n\nSee comments from: https://groups.google.com/forum/?fromgroups#!topic/sage-devel/HXXqQ_XP358\n\n\npoint.py:\n\n-no automatic normalization (as is currently done with fields)\n\n-implemented __eq__ and __ne__, added a note in __cmp__ for ell_point.py that __eq__ and __ne__ are implemented for projective points\n\n-implemented scale_by() - scales the coordinates by a given amount\n\n-implemented normalize_coordinates() - removes the gcd of the coordinates\n\n\nmorphism.py:\n\n-no automatic gcd removal (even over CC this does not work)\nThis change reverses part of Trac: 3964 (http://trac.sagemath.org/sage_trac/ticket/3964)\n\n-removed \"immutable\" for .__polys since you can scale projective coordinates\n\n-added \"check\" to __call__ to help deal with indeterminacies and allow for bypassing the initialization checks for points\n\n-implemented scale_by() - scales the coordinates by a given amount\n\n-implemented normalize_coordinates() - removes the gcd of the coordinates\n\n\nhomset.py:\n\n-allowed rings\n\n\nprojective_space.py:\n\n-implemented dimension() - since the current implementation was giving incorrect values when the base ring is a ring (for example ZZ)\n\n\ngeneral changes:\n\n-added many examples\n\n-cleaned up imports",
    "created_at": "2012-06-18T15:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199437",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:1'></a>
Summary: Adding support for rings in projective spaces.

See comments from: https://groups.google.com/forum/?fromgroups#!topic/sage-devel/HXXqQ_XP358


point.py:

-no automatic normalization (as is currently done with fields)

-implemented __eq__ and __ne__, added a note in __cmp__ for ell_point.py that __eq__ and __ne__ are implemented for projective points

-implemented scale_by() - scales the coordinates by a given amount

-implemented normalize_coordinates() - removes the gcd of the coordinates


morphism.py:

-no automatic gcd removal (even over CC this does not work)
This change reverses part of Trac: 3964 (http://trac.sagemath.org/sage_trac/ticket/3964)

-removed "immutable" for .__polys since you can scale projective coordinates

-added "check" to __call__ to help deal with indeterminacies and allow for bypassing the initialization checks for points

-implemented scale_by() - scales the coordinates by a given amount

-implemented normalize_coordinates() - removes the gcd of the coordinates


homset.py:

-allowed rings


projective_space.py:

-implemented dimension() - since the current implementation was giving incorrect values when the base ring is a ring (for example ZZ)


general changes:

-added many examples

-cleaned up imports



---

archive/issue_comments_199438.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-18T15:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199438",
    "user": "https://github.com/bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199439.json:
```json
{
    "body": "Changing author from \"bhutz\" to \"Ben Hutz\"",
    "created_at": "2012-06-18T18:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199439",
    "user": "https://github.com/novoselt"
}
```

Changing author from "bhutz" to "Ben Hutz"



---

archive/issue_comments_199440.json:
```json
{
    "body": "<a id='comment:4'></a>\nUpdated so that it applies on Sage-5.1",
    "created_at": "2012-07-17T12:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199440",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:4'></a>
Updated so that it applies on Sage-5.1



---

archive/issue_comments_199441.json:
```json
{
    "body": "Replaces trac_13130_rings_for_projective_space.patch",
    "created_at": "2012-08-04T18:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199441",
    "user": "https://github.com/annahaensch"
}
```

Replaces trac_13130_rings_for_projective_space.patch



---

archive/issue_comments_199442.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [trac_13130_rings_for_projective_space_v2.patch](tarball://root/attachments/some-uuid/ticket13130/trac_13130_rings_for_projective_space_v2.patch) by @annahaensch created at 2012-08-04 18:45:45\n\nI ran -t on each of the following files:\n\n* schemes/elliptic_curves/ell_point.py\n* schemes/generic/homset.py\n* schemes/generic/morphism.py\n* schemes/generic/point.py\n* schemes/generic/projective_space.py\n* schemes/readme.py\n\nand \"All tests passed!\" \n\nI ran -coverage to check the doctest coverage, all affected files had 100% coverage, except: \n\n* schemes/generic/morphism.py (95%) \n* schemes/generic/point.py (37%)\n\n****************\nI brought morphism.py to 100%, but point.py is still missing things.\n\nI ran --testall --long and got the following error:\n\n```\n******************************\nFile \"/Users/annahaensch/sage-5.2/devel/sage/sage/interfaces/r.py\", line 1169:\n    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())\nExpected:\n    True\nGot:\n    False\n******************************************\n1 items had failures:\n   1 of   7 in __main__.example_43\nTest Failed**** 1 failures.\n```\n\nJust to be sure, I ran a longtest just on interfaces/r.py, and all tests passed, which is unsurprising, since this patch doesn't touch that file\u2026not sure what to do about that one.\n\nI ran -docbuild reference html and got one LaTex error, line 531 of sage/schemes/generic/projective_space.py.  Changed ``\\PP^N`` to `'\\mathbb{P}^N` `.",
    "created_at": "2012-08-04T18:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199442",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:5'></a>
Attachment [trac_13130_rings_for_projective_space_v2.patch](tarball://root/attachments/some-uuid/ticket13130/trac_13130_rings_for_projective_space_v2.patch) by @annahaensch created at 2012-08-04 18:45:45

I ran -t on each of the following files:

* schemes/elliptic_curves/ell_point.py
* schemes/generic/homset.py
* schemes/generic/morphism.py
* schemes/generic/point.py
* schemes/generic/projective_space.py
* schemes/readme.py

and "All tests passed!" 

I ran -coverage to check the doctest coverage, all affected files had 100% coverage, except: 

* schemes/generic/morphism.py (95%) 
* schemes/generic/point.py (37%)

****************
I brought morphism.py to 100%, but point.py is still missing things.

I ran --testall --long and got the following error:

```
******************************
File "/Users/annahaensch/sage-5.2/devel/sage/sage/interfaces/r.py", line 1169:
    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())
Expected:
    True
Got:
    False
******************************************
1 items had failures:
   1 of   7 in __main__.example_43
Test Failed**** 1 failures.
```

Just to be sure, I ran a longtest just on interfaces/r.py, and all tests passed, which is unsurprising, since this patch doesn't touch that fileâ€¦not sure what to do about that one.

I ran -docbuild reference html and got one LaTex error, line 531 of sage/schemes/generic/projective_space.py.  Changed ``\PP^N`` to `'\mathbb{P}^N` `.



---

archive/issue_comments_199443.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-04T18:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199443",
    "user": "https://github.com/annahaensch"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199444.json:
```json
{
    "body": "<a id='comment:7'></a>\nWhat is the reason for `needs_work`?\n\nMore importantly - what is the reason for replacing the original patch? Do you propose a different implementation? Why? What are the differences?",
    "created_at": "2012-08-04T20:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199444",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>
What is the reason for `needs_work`?

More importantly - what is the reason for replacing the original patch? Do you propose a different implementation? Why? What are the differences?



---

archive/issue_comments_199445.json:
```json
{
    "body": "<a id='comment:8'></a>\nAs I describe in the comment above, the new patch reflects some minor changes to bring doctest coverage up to 100% and fix the docbuild errors.  Also, mentioned above, it still fails to pass the long test, due to some errors in r functionality, which is why the patch needs_work.",
    "created_at": "2012-08-04T22:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199445",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:8'></a>
As I describe in the comment above, the new patch reflects some minor changes to bring doctest coverage up to 100% and fix the docbuild errors.  Also, mentioned above, it still fails to pass the long test, due to some errors in r functionality, which is why the patch needs_work.



---

archive/issue_comments_199446.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks for reviewing this Anna (and the doc fix).  Just to be sure I understand the current situation:\n\nwhen you run --testall --long you get an error in r.py, but when you run -t --long on r.py you get all passed?",
    "created_at": "2012-08-04T22:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199446",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:9'></a>
Thanks for reviewing this Anna (and the doc fix).  Just to be sure I understand the current situation:

when you run --testall --long you get an error in r.py, but when you run -t --long on r.py you get all passed?



---

archive/issue_comments_199447.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [bhutz](#comment%3A9):\n> Thanks for reviewing this Anna (and the doc fix).  Just to be sure I understand the current situation:\n> \n> when you run --testall --long you get an error in r.py, but when you run -t --long on r.py you get all passed?\n\n\nThat's correct.  The patch must call some routines from r.py, but not actually touch r.py.",
    "created_at": "2012-08-04T22:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199447",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:10'></a>
Replying to [bhutz](#comment%3A9):
> Thanks for reviewing this Anna (and the doc fix).  Just to be sure I understand the current situation:
> 
> when you run --testall --long you get an error in r.py, but when you run -t --long on r.py you get all passed?


That's correct.  The patch must call some routines from r.py, but not actually touch r.py.



---

archive/issue_comments_199448.json:
```json
{
    "body": "<a id='comment:11'></a>\nIf the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.\n\nIt is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?",
    "created_at": "2012-08-04T22:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199448",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>
If the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.

It is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?



---

archive/issue_comments_199449.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [novoselt](#comment%3A11):\n> If the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.\n> \n\n\nI wasn't sure what the convention was for fixing patches.  If that's easier, I can certainly upload a new patch to reflect that convention.\n\n> It is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?\n\n\nThat's correct.  Before testing this patch I built sage-5.2 from source and ran --testall --long, and all tests passed.  I applied the patch, re-ran the test, and got the error.",
    "created_at": "2012-08-04T22:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199449",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:12'></a>
Replying to [novoselt](#comment%3A11):
> If the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.
> 


I wasn't sure what the convention was for fixing patches.  If that's easier, I can certainly upload a new patch to reflect that convention.

> It is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?


That's correct.  Before testing this patch I built sage-5.2 from source and ran --testall --long, and all tests passed.  I applied the patch, re-ran the test, and got the error.



---

archive/issue_comments_199450.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [annahaensch](#comment%3A12):\n> Replying to [novoselt](#comment%3A11):\n> > If the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.\n> > \n\n> \n> I wasn't sure what the convention was for fixing patches.  If that's easier, I can certainly upload a new patch to reflect that convention.\n> \n\n\nPlease do ;-)\n\n> > It is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?\n\n> \n> That's correct.  Before testing this patch I built sage-5.2 from source and ran --testall --long, and all tests passed.  I applied the patch, re-ran the test, and got the error.  \n\n\nSo - you ran tests ONCE without the patch and there were no error and then ONCE with the patch and there was one? If that is the case and the error does not appear when testing that file separately, it is still quite that you hit a sporadic bug which is not relates to this ticket (and I am pretty sure I've seen recently other complains on this module). Can you test with the patch and `--testall --long` again several times and see if it is always the same failure?",
    "created_at": "2012-08-05T00:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199450",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:13'></a>
Replying to [annahaensch](#comment%3A12):
> Replying to [novoselt](#comment%3A11):
> > If the new patch reflect some minor changes, it should be a small reviewer patch on top of the original (quite big) one. If the original patch cannot be applied anymore at all, that's another issue.
> > 

> 
> I wasn't sure what the convention was for fixing patches.  If that's easier, I can certainly upload a new patch to reflect that convention.
> 


Please do ;-)

> > It is also not clear if failures in `r.py` are related to this ticket. Do you always get an error with `--testall` when this patch is installed and never without it?

> 
> That's correct.  Before testing this patch I built sage-5.2 from source and ran --testall --long, and all tests passed.  I applied the patch, re-ran the test, and got the error.  


So - you ran tests ONCE without the patch and there were no error and then ONCE with the patch and there was one? If that is the case and the error does not appear when testing that file separately, it is still quite that you hit a sporadic bug which is not relates to this ticket (and I am pretty sure I've seen recently other complains on this module). Can you test with the patch and `--testall --long` again several times and see if it is always the same failure?



---

archive/issue_comments_199451.json:
```json
{
    "body": "<a id='comment:14'></a>\nFor the original patch:\n* `NOTES::` should be formatted as `.. note::`\n* Names of methods, types, etc. should be at the very least double quoted like ```__eq__``` or better yet referred to like `:class:`ValueError``\n* Why `_element_constructor_` was removed? It is part of the coercion framework and it is likely that it has to be present.\n* It looks to me like the code of `class SchemeMorphism_polynomial_projective_space` was moved inside the same file. Why? Was it changed?\n* Input/output is not documented everywhere and formatting is not always correct. See http://www.sagemath.org/doc/developer/conventions.html#documentation-strings\n* `dimension` method is defined to just return `relative_dimension` Why??? `dimension` does work already and works differently:\n {{{\nsage: ProjectiveSpace(3,QQ[\"y\"],'x').dimension_relative()\n3\nsage: ProjectiveSpace(3,QQ[\"y\"],'x').dimension()\n4\n}}}\n The patch breaks backward compatibility and makes dimension inconsistent between different spaces.",
    "created_at": "2012-08-05T00:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199451",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:14'></a>
For the original patch:
* `NOTES::` should be formatted as `.. note::`
* Names of methods, types, etc. should be at the very least double quoted like ```__eq__``` or better yet referred to like `:class:`ValueError``
* Why `_element_constructor_` was removed? It is part of the coercion framework and it is likely that it has to be present.
* It looks to me like the code of `class SchemeMorphism_polynomial_projective_space` was moved inside the same file. Why? Was it changed?
* Input/output is not documented everywhere and formatting is not always correct. See http://www.sagemath.org/doc/developer/conventions.html#documentation-strings
* `dimension` method is defined to just return `relative_dimension` Why??? `dimension` does work already and works differently:
 {{{
sage: ProjectiveSpace(3,QQ["y"],'x').dimension_relative()
3
sage: ProjectiveSpace(3,QQ["y"],'x').dimension()
4
}}}
 The patch breaks backward compatibility and makes dimension inconsistent between different spaces.



---

archive/issue_comments_199452.json:
```json
{
    "body": "<a id='comment:15'></a>\nas another data point the --testall --long passes on my machine (Ubuntu)\n\nTo answer the questions in the last comment:\n\nThe formatting I can address. I had thought I'd followed the conventions, but I'll go back through and check all the changes.\n\n_element_constructor was removed since it was simply returning NotImplemented. As in \npoints_projective_field, removing that place holder allows the SchemeHomset_points _element_constructor to be used for point_projective_ring\n\n\nSchemeMorphism_polynomial_projective_space was moved to have the projective classes together. If it is more standard in Sage to have the _polynomial_ classes together, then I can certainly move it back.\n\n\nDimension was changed since it seemed to be not working for projective spaces. Before the new dimension function you would get\n\nsage: ProjectiveSpace(QQ,2,'x').dimension()\n\n2\n\nsage: ProjectiveSpace(ZZ,2,'x').dimension()\n\n3\n\nI assumed that the value for ZZ was wrong. Although it seems that Spec(ZZ).dimension() does in fact return 1 while Spec(QQ).dimension() returns 0. Is this really the desired behavior, that the dimension of projective space over the integers is +1?",
    "created_at": "2012-08-05T01:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199452",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:15'></a>
as another data point the --testall --long passes on my machine (Ubuntu)

To answer the questions in the last comment:

The formatting I can address. I had thought I'd followed the conventions, but I'll go back through and check all the changes.

_element_constructor was removed since it was simply returning NotImplemented. As in 
points_projective_field, removing that place holder allows the SchemeHomset_points _element_constructor to be used for point_projective_ring


SchemeMorphism_polynomial_projective_space was moved to have the projective classes together. If it is more standard in Sage to have the _polynomial_ classes together, then I can certainly move it back.


Dimension was changed since it seemed to be not working for projective spaces. Before the new dimension function you would get

sage: ProjectiveSpace(QQ,2,'x').dimension()

2

sage: ProjectiveSpace(ZZ,2,'x').dimension()

3

I assumed that the value for ZZ was wrong. Although it seems that Spec(ZZ).dimension() does in fact return 1 while Spec(QQ).dimension() returns 0. Is this really the desired behavior, that the dimension of projective space over the integers is +1?



---

archive/issue_comments_199453.json:
```json
{
    "body": "<a id='comment:16'></a>\nIt is standard in Sage to keep track of who is doing what and why, if you rearrange a file, then you will be shown as the author of new lines and this ticket will be listed as a reason for its addition. There can be different schemes of arranging names and classes (e.g. I like to have everything alphabetically). I don't think we have any standard conventions for that. But you should never \"just move\" existing code because of the history loss.\n\nIntegers have a chain of prime ideals of length 1, e.g. (0) contained in (2), so its dimension is one. Rationals have dimension zero since there is only one prime ideal (length of the chain is zero), as for other fields.\n\nIf you look at the documentation of existing dimension function, you will see that it is indeed supposed to work like this: dimension of the base ring is taken into consideration. Moreover, you can see that there are long names for either way `dimension_absolute` and `dimension_relative`, and just `dimension` is explicitly shown to work as `dimension_absolute`. So it is definitely not a good idea to make this \"default\" dimension mean relative in the case of projective spaces.",
    "created_at": "2012-08-05T03:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199453",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'></a>
It is standard in Sage to keep track of who is doing what and why, if you rearrange a file, then you will be shown as the author of new lines and this ticket will be listed as a reason for its addition. There can be different schemes of arranging names and classes (e.g. I like to have everything alphabetically). I don't think we have any standard conventions for that. But you should never "just move" existing code because of the history loss.

Integers have a chain of prime ideals of length 1, e.g. (0) contained in (2), so its dimension is one. Rationals have dimension zero since there is only one prime ideal (length of the chain is zero), as for other fields.

If you look at the documentation of existing dimension function, you will see that it is indeed supposed to work like this: dimension of the base ring is taken into consideration. Moreover, you can see that there are long names for either way `dimension_absolute` and `dimension_relative`, and just `dimension` is explicitly shown to work as `dimension_absolute`. So it is definitely not a good idea to make this "default" dimension mean relative in the case of projective spaces.



---

archive/issue_comments_199454.json:
```json
{
    "body": "<a id='comment:17'></a>\nI've made the following changes:\n\n- found and fixed the formatting\n- included the docstring fix and the coverage fix from Anna's version\n- no longer implement a dimension function\n- returned the :class:SchemeMorphism_polynomial_projective_space to its original location\n\ntestall passes on my machine.\n\nHowever, I'm not sure what the right step for the file attachment is. I can replace my original patch with my new one, but cannot replace or remove Anna's version.  Should I replace my original version or upload it as a new (3rd) version?",
    "created_at": "2012-08-05T16:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199454",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>
I've made the following changes:

- found and fixed the formatting
- included the docstring fix and the coverage fix from Anna's version
- no longer implement a dimension function
- returned the :class:SchemeMorphism_polynomial_projective_space to its original location

testall passes on my machine.

However, I'm not sure what the right step for the file attachment is. I can replace my original patch with my new one, but cannot replace or remove Anna's version.  Should I replace my original version or upload it as a new (3rd) version?



---

archive/issue_comments_199455.json:
```json
{
    "body": "<a id='comment:18'></a>\nUsually it is OK to replace your patch with an updated one. When there is more than one patch on the ticket, it is also a good idea to include \"Apply\" section in the description, see e.g. #11763. This is for reviewers and the release manager, who should not go through all the comments once this ticket is ready to be merged. You can also add a comment \"Apply ...\" for the patchbot, but it is moody and does not always pick it up.",
    "created_at": "2012-08-05T16:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199455",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:18'></a>
Usually it is OK to replace your patch with an updated one. When there is more than one patch on the ticket, it is also a good idea to include "Apply" section in the description, see e.g. #11763. This is for reviewers and the release manager, who should not go through all the comments once this ticket is ready to be merged. You can also add a comment "Apply ..." for the patchbot, but it is moody and does not always pick it up.



---

archive/issue_comments_199456.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n Projective points and morphisms are currently only support over fields. Support for rings is needed.\n+\n+\n+Apply:\n+* [attachment:trac_13130_rings_for_projective_space.patch]\n``````\n",
    "created_at": "2012-08-05T17:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199456",
    "user": "https://github.com/bhutz"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
 Projective points and morphisms are currently only support over fields. Support for rings is needed.
+
+
+Apply:
+* [attachment:trac_13130_rings_for_projective_space.patch]
``````




---

archive/issue_comments_199457.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-05T17:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199457",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199458.json:
```json
{
    "body": "<a id='comment:22'></a>\nI went to check this on 5.3 and noticed that I had implemented scale_by() and normalize_coordinates() in class::SchemeMorphism_polynomial. That was wrong since they should only apply to projective maps. So I've moved those to SchemeMorphism_polynomial_projective_space.\n\nThey modify the _ _polys attribute of the SchememMorphism_polynomial, but a _ _ attribute is private. Since it makes sense to inherit the polys attribute, I changed it to ._polys. I checked through the source and found no place where that created an issue and all tests currently pass.\n\nAlso, I noticed that somehow I've created a bunch of\n\n_ 'blank line'\n\n+ 'blank line'\n\nI tried to removed those directly from the patch file and wrecked patch. If someone could tell me how to get those out of there, I'd like to remove them.",
    "created_at": "2012-10-05T13:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199458",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:22'></a>
I went to check this on 5.3 and noticed that I had implemented scale_by() and normalize_coordinates() in class::SchemeMorphism_polynomial. That was wrong since they should only apply to projective maps. So I've moved those to SchemeMorphism_polynomial_projective_space.

They modify the _ _polys attribute of the SchememMorphism_polynomial, but a _ _ attribute is private. Since it makes sense to inherit the polys attribute, I changed it to ._polys. I checked through the source and found no place where that created an issue and all tests currently pass.

Also, I noticed that somehow I've created a bunch of

_ 'blank line'

+ 'blank line'

I tried to removed those directly from the patch file and wrecked patch. If someone could tell me how to get those out of there, I'd like to remove them.



---

archive/issue_comments_199459.json:
```json
{
    "body": "<a id='comment:23'></a>\nUpdated to work with Sage 5.5.",
    "created_at": "2013-01-03T17:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199459",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:23'></a>
Updated to work with Sage 5.5.



---

archive/issue_comments_199460.json:
```json
{
    "body": "<a id='comment:24'></a>\nWhile working on something else, I found a bug in the patch. It's been fixed and the new patch uploaded.",
    "created_at": "2013-01-08T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199460",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:24'></a>
While working on something else, I found a bug in the patch. It's been fixed and the new patch uploaded.



---

archive/issue_comments_199461.json:
```json
{
    "body": "<a id='comment:25'></a>\nPatch needs to be rediffed for current sage...",
    "created_at": "2013-02-24T04:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199461",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
Patch needs to be rediffed for current sage...



---

archive/issue_comments_199462.json:
```json
{
    "body": "<a id='comment:26'></a>\nAll seems good on 5.7",
    "created_at": "2013-02-24T21:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199462",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:26'></a>
All seems good on 5.7



---

archive/issue_comments_199463.json:
```json
{
    "body": "<a id='comment:27'></a>\nPatchbot:\napply trac_13130_rings_for_projective_space.patch",
    "created_at": "2013-02-25T01:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199463",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
Patchbot:
apply trac_13130_rings_for_projective_space.patch



---

archive/issue_comments_199464.json:
```json
{
    "body": "<a id='comment:28'></a>\nMinor changes from review.",
    "created_at": "2013-02-28T02:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199464",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:28'></a>
Minor changes from review.



---

archive/issue_comments_199465.json:
```json
{
    "body": "Attachment [trac_13130_rings_for_projective_space.patch](tarball://root/attachments/some-uuid/ticket13130/trac_13130_rings_for_projective_space.patch) by @bhutz created at 2013-03-01 14:10:50\n\nminor changes from review",
    "created_at": "2013-03-01T14:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199465",
    "user": "https://github.com/bhutz"
}
```

Attachment [trac_13130_rings_for_projective_space.patch](tarball://root/attachments/some-uuid/ticket13130/trac_13130_rings_for_projective_space.patch) by @bhutz created at 2013-03-01 14:10:50

minor changes from review



---

archive/issue_comments_199466.json:
```json
{
    "body": "<a id='comment:29'></a>\nI have run longtest, done docbuild, and checked for coverage.  Everything passes 100%.\n\nI have also tested functionality pretty extensively, and everything works great.\n\nThis patch should definitely be incorporate because it is the foundation that will allow future development of arithmetic dynamics functionality.",
    "created_at": "2013-03-02T01:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199466",
    "user": "https://trac.sagemath.org/admin/accounts/users/mmanes"
}
```

<a id='comment:29'></a>
I have run longtest, done docbuild, and checked for coverage.  Everything passes 100%.

I have also tested functionality pretty extensively, and everything works great.

This patch should definitely be incorporate because it is the foundation that will allow future development of arithmetic dynamics functionality.



---

archive/issue_comments_199467.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-02T01:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199467",
    "user": "https://trac.sagemath.org/admin/accounts/users/mmanes"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199468.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michelle Manes\"",
    "created_at": "2013-03-02T12:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199468",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Michelle Manes"



---

archive/issue_comments_199469.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.8.beta3\"",
    "created_at": "2013-03-04T07:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199469",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.8.beta3"



---

archive/issue_comments_199470.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-04T07:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199470",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_042151.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-04T07:37:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13130#event-42151"
}
```



---

archive/issue_comments_199471.json:
```json
{
    "body": "<a id='comment:32'></a>\nWell, this is closed, but you still need to correct the doc : there are wrong \"INPUT::\" everywhere.",
    "created_at": "2013-03-06T13:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199471",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:32'></a>
Well, this is closed, but you still need to correct the doc : there are wrong "INPUT::" everywhere.



---

archive/issue_comments_199472.json:
```json
{
    "body": "<a id='comment:33'></a>\nI agree, the documentation formatting is horrible.",
    "created_at": "2013-03-06T13:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199472",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
I agree, the documentation formatting is horrible.



---

archive/issue_comments_199473.json:
```json
{
    "body": "<a id='comment:34'></a>\nOk. This will be fixed as part of #14217.",
    "created_at": "2013-03-06T13:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13130#issuecomment-199473",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:34'></a>
Ok. This will be fixed as part of #14217.
