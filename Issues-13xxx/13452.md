# Issue 13452: Refactor sage-location

archive/issues_013280.json:
```json
{
    "body": "Some various clean-up of `sage-location`, in particular:\n1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.\n2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.\n3. Improve the logic, i.e. `install_moved()` should not write the processor flags.\n4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.\n5. Better documentation.\n\nFollow-up tickets: #13407, #5155.\n\nAssignee: tdb\n\nReviewer: Dmitrii Pasechnik\n\nAuthor: Jeroen Demeyer\n\nMerged: sage-5.4.1.rc1\n\nDependencies: #13397\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13452\n\n",
    "closed_at": "2012-11-14T08:30:26Z",
    "created_at": "2012-09-12T15:28:38Z",
    "labels": [
        "component: relocation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4.1",
    "title": "Refactor sage-location",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13452",
    "user": "https://github.com/jdemeyer"
}
```
Some various clean-up of `sage-location`, in particular:
1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.
2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.
3. Improve the logic, i.e. `install_moved()` should not write the processor flags.
4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.
5. Better documentation.

Follow-up tickets: #13407, #5155.

Assignee: tdb

Reviewer: Dmitrii Pasechnik

Author: Jeroen Demeyer

Merged: sage-5.4.1.rc1

Dependencies: #13397

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13452





---

archive/issue_comments_202692.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n-Some various clean-up of `sage-location`.\n+Some various clean-up of `sage-location`, in particular:\n+1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.\n+2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.\n+3. Better documentation of the functions inside `sage_location()`.\n``````\n",
    "created_at": "2012-09-12T17:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202692",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
-Some various clean-up of `sage-location`.
+Some various clean-up of `sage-location`, in particular:
+1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.
+2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.
+3. Better documentation of the functions inside `sage_location()`.
``````




---

archive/issue_comments_202693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n Some various clean-up of `sage-location`, in particular:\n 1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.\n 2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.\n-3. Better documentation of the functions inside `sage_location()`.\n+3. Improve the logic, i.e. `install_moved()` should not write the processor flags.\n+4. Better documentation.\n``````\n",
    "created_at": "2012-09-12T20:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202693",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
 Some various clean-up of `sage-location`, in particular:
 1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.
 2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.
-3. Better documentation of the functions inside `sage_location()`.
+3. Improve the logic, i.e. `install_moved()` should not write the processor flags.
+4. Better documentation.
``````




---

archive/issue_comments_202694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n 1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.\n 2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.\n 3. Improve the logic, i.e. `install_moved()` should not write the processor flags.\n-4. Better documentation.\n+4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.\n+5. Better documentation.\n``````\n",
    "created_at": "2012-09-13T22:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202694",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 1. Don't use `realpath()` or `abspath()` everywhere.  Just once should be more than sufficient.
 2. Merge `initialize_pkgconfig_files()` and `update_pkgconfig_files()`.
 3. Improve the logic, i.e. `install_moved()` should not write the processor flags.
-4. Better documentation.
+4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.
+5. Better documentation.
``````




---

archive/issue_comments_202695.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-16T17:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202695",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202696.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,5 @@\n 3. Improve the logic, i.e. `install_moved()` should not write the processor flags.\n 4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.\n 5. Better documentation.\n+\n+Follow-up tickets: #13407, #5155.\n``````\n",
    "created_at": "2012-09-16T17:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202696",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,5 @@
 3. Improve the logic, i.e. `install_moved()` should not write the processor flags.
 4. Improve structure by creating a new top-level function `sage_relocate()` which then calls the other functions.
 5. Better documentation.
+
+Follow-up tickets: #13407, #5155.
``````




---

archive/issue_comments_202697.json:
```json
{
    "body": "<a id='comment:6'></a>According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`. Since you are already touching those lines, do you think we could set the `location_file` to `SAGE_LOCAL/var/lib/sage/current-location.txt` (and similarly for `cflags_file`)?",
    "created_at": "2012-09-16T21:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202697",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:6'></a>According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`. Since you are already touching those lines, do you think we could set the `location_file` to `SAGE_LOCAL/var/lib/sage/current-location.txt` (and similarly for `cflags_file`)?



---

archive/issue_comments_202698.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 ohanar]:\n> According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`. Since you are already touching those lines, do you think we could set the `location_file` to `SAGE_LOCAL/var/lib/sage/current-location.txt` (and similarly for `cflags_file`)?\n\n\nNot on this ticket.",
    "created_at": "2012-09-16T21:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202698",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 ohanar]:
> According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`. Since you are already touching those lines, do you think we could set the `location_file` to `SAGE_LOCAL/var/lib/sage/current-location.txt` (and similarly for `cflags_file`)?


Not on this ticket.



---

archive/issue_comments_202699.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 ohanar]:\n> According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`.\n\nI don't think there is `/usr/var` or `/usr/local/var`.  I would vote for `local/etc` instead (which does exist, although it's rarely used).",
    "created_at": "2012-09-16T21:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202699",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:6 ohanar]:
> According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`.

I don't think there is `/usr/var` or `/usr/local/var`.  I would vote for `local/etc` instead (which does exist, although it's rarely used).



---

archive/issue_comments_202700.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:6 ohanar]:\n> > According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`.\n\n> I don't think there is `/usr/var` or `/usr/local/var`.  I would vote for `local/etc` instead (which does exist, although it's rarely used).\n-1, `etc` should be used for text configuration -- these files aren't configuration files, they are storing state information (which is precisely what `var/lib` is for).\n\nAt least according to the FHS, there shouldn't be an `/usr/etc` either. The FHS doesn't really cover prefixed environments, so I think it is fair to use relevant directories in `/` when necessary. (For instance, IMO, `SAGE_ROOT/ipython/*` should probably be installed into `SAGE_LOCAL/etc` somewhere).",
    "created_at": "2012-09-16T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202700",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 ohanar]:
> > According to the FHS, the `location_file` and `cflags_file` should live in `SAGE_LOCAL/var/lib`.

> I don't think there is `/usr/var` or `/usr/local/var`.  I would vote for `local/etc` instead (which does exist, although it's rarely used).
-1, `etc` should be used for text configuration -- these files aren't configuration files, they are storing state information (which is precisely what `var/lib` is for).

At least according to the FHS, there shouldn't be an `/usr/etc` either. The FHS doesn't really cover prefixed environments, so I think it is fair to use relevant directories in `/` when necessary. (For instance, IMO, `SAGE_ROOT/ipython/*` should probably be installed into `SAGE_LOCAL/etc` somewhere).



---

archive/issue_comments_202701.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 ohanar]:\n> -1, `etc` should be used for text configuration -- these files aren't configuration files, they are storing state information (which is precisely what `var/lib` is for).\n> \n> At least according to the FHS, there shouldn't be an `/usr/etc` either. The FHS doesn't really cover prefixed environments, so I think it is fair to use relevant directories in `/` when necessary. (For instance, IMO, `SAGE_ROOT/ipython/*` should probably be installed into `SAGE_LOCAL/etc` somewhere).\n\n\nOK, `/usr/etc` isn't official either, so that part of the argument is moot.\n\nStill (I know, bikeshedding) I think the description of `etc` as read-only configuration files fits these files much better than `var`'s \"state information\".  It's something which under normal usage of Sage does not change.  It's equally read-only as the content of `$SAGE_ROOT/local/bin`.\n\nRegardless, I prefer not to change this in this ticket because other tickets depend on it.  I'd rather finish #5155 first and then think about where to put these files.",
    "created_at": "2012-09-17T14:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202701",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [comment:9 ohanar]:
> -1, `etc` should be used for text configuration -- these files aren't configuration files, they are storing state information (which is precisely what `var/lib` is for).
> 
> At least according to the FHS, there shouldn't be an `/usr/etc` either. The FHS doesn't really cover prefixed environments, so I think it is fair to use relevant directories in `/` when necessary. (For instance, IMO, `SAGE_ROOT/ipython/*` should probably be installed into `SAGE_LOCAL/etc` somewhere).


OK, `/usr/etc` isn't official either, so that part of the argument is moot.

Still (I know, bikeshedding) I think the description of `etc` as read-only configuration files fits these files much better than `var`'s "state information".  It's something which under normal usage of Sage does not change.  It's equally read-only as the content of `$SAGE_ROOT/local/bin`.

Regardless, I prefer not to change this in this ticket because other tickets depend on it.  I'd rather finish #5155 first and then think about where to put these files.



---

archive/issue_comments_202702.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-12T10:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202702",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202703.json:
```json
{
    "body": "<a id='comment:11'></a>Attachment [13452_sage_location.patch](tarball://root/attachments/some-uuid/ticket13452/13452_sage_location.patch) by @dimpase created at 2012-11-12 10:52:52\n\nVery nice. I noticed quite a speedup upon trying to move installations around.",
    "created_at": "2012-11-12T10:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202703",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Attachment [13452_sage_location.patch](tarball://root/attachments/some-uuid/ticket13452/13452_sage_location.patch) by @dimpase created at 2012-11-12 10:52:52

Very nice. I noticed quite a speedup upon trying to move installations around.



---

archive/issue_comments_202704.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2012-11-12T10:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202704",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_202705.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> I noticed quite a speedup upon trying to move installations around.\n\nA speed-up was never the intention of this ticket. Perhaps the speed-up is because files are opened only once instead of twice?",
    "created_at": "2012-11-12T10:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202705",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> I noticed quite a speedup upon trying to move installations around.

A speed-up was never the intention of this ticket. Perhaps the speed-up is because files are opened only once instead of twice?



---

archive/issue_events_037407.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-12T16:37:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "milestone": "sage-5.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13452#event-37407"
}
```



---

archive/issue_comments_202706.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.4.1.rc1\"",
    "created_at": "2012-11-14T08:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202706",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.4.1.rc1"



---

archive/issue_events_037408.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-14T08:30:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13452#event-37408"
}
```



---

archive/issue_comments_202707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-14T08:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13452#issuecomment-202707",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
