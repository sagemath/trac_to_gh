# Issue 13693: Upgrade matplotlib to 1.2.1

archive/issues_013489.json:
```json
{
    "body": "Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n\n**spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)\n\n**apply**: [attachment:trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @kcrisman jpflori\n\n**Reviewer:** John Palmieri, Fran\u00e7ois Bissey\n\n**Author:** Jason Grout, John Palmieri,Jean-Pierre Flori\n\n**Merged:** sage-5.10.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/13693\n\n",
    "closed_at": "2013-04-13T13:49:04Z",
    "created_at": "2012-11-09T08:02:42Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "title": "Upgrade matplotlib to 1.2.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13693",
    "user": "https://github.com/jasongrout"
}
```
Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html

**spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)

**apply**: [attachment:trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)

**Assignee:** @jasongrout, @williamstein

**CC:**  @kcrisman jpflori

**Reviewer:** John Palmieri, François Bissey

**Author:** Jason Grout, John Palmieri,Jean-Pierre Flori

**Merged:** sage-5.10.beta0

Issue created by migration from https://trac.sagemath.org/ticket/13693





---

archive/issue_comments_163080.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Matplotlib 1.2.0 was released today.  Here's an updated spkg.\n+Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg\n``````\n",
    "created_at": "2012-11-09T08:03:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163080",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Matplotlib 1.2.0 was released today.  Here's an updated spkg.
+Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg
``````




---

archive/issue_events_117112.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-11-09T08:06:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117112"
}
```



---

archive/issue_comments_163081.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm trying this out. A few quick comments:\n\n- In SPKG.txt, the line `=== matplotlib-1.1.0 (Jason Grout, 09 Nov 2012) ===` should say `1.2.0`.\n- The file `patches/mkdir-race-condition.patch` should be removed from the repository (according to `hg status`, the repo is not clean right now).\n- I'm getting doctest failures in the plot directory:\n\n```\nThe following tests failed:\n\n\tsage -t  devel/sage-main/sage/plot/colors.py # 8 doctests failed\n\tsage -t  devel/sage-main/sage/plot/graphics.py # 1 doctests failed\n\tsage -t  devel/sage-main/sage/plot/plot.py # 2 doctests failed\n\tsage -t  devel/sage-main/sage/plot/plot3d/plot_field3d.py # 1 doctests failed\n```\n The ones in colors.py are all of the form\n\n```\n    sage: get_cmap('jet')\nExpected:\n    <matplotlib.colors.LinearSegmentedColormap instance at 0x...>\nGot:\n    <matplotlib.colors.LinearSegmentedColormap object at 0x11103e8d0>\n```\n and the ones in graphics.py are similar. These are easy to fix, of course. Other failures:\n\n```\nFile \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.4.rc4-IPYTHON/devel/sage-main/sage/plot/plot.py\", line 1176:\n    sage: len((q1).matplotlib().axes[0].legend().texts) # used to raise AttributeError\nExpected:\n    1\nGot:\n    2\n**********************************************************************\nFile \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.4.rc4-IPYTHON/devel/sage-main/sage/plot/plot.py\", line 1186:\n    sage: len(p1.matplotlib().axes[0].legend().texts)\nExpected:\n    1\nGot:\n    3\n```\n Why is this failing now? Was there a change in the format of the legend? The error in plot_field3d.py is `ValueError: Colormap red is not recognized`. I don't know what to do about this one. I haven't run full doctests, just on the plot directory. I'll let you know if I find anything else.",
    "created_at": "2012-11-10T19:59:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163081",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
I'm trying this out. A few quick comments:

- In SPKG.txt, the line `=== matplotlib-1.1.0 (Jason Grout, 09 Nov 2012) ===` should say `1.2.0`.
- The file `patches/mkdir-race-condition.patch` should be removed from the repository (according to `hg status`, the repo is not clean right now).
- I'm getting doctest failures in the plot directory:

```
The following tests failed:

	sage -t  devel/sage-main/sage/plot/colors.py # 8 doctests failed
	sage -t  devel/sage-main/sage/plot/graphics.py # 1 doctests failed
	sage -t  devel/sage-main/sage/plot/plot.py # 2 doctests failed
	sage -t  devel/sage-main/sage/plot/plot3d/plot_field3d.py # 1 doctests failed
```
 The ones in colors.py are all of the form

```
    sage: get_cmap('jet')
Expected:
    <matplotlib.colors.LinearSegmentedColormap instance at 0x...>
Got:
    <matplotlib.colors.LinearSegmentedColormap object at 0x11103e8d0>
```
 and the ones in graphics.py are similar. These are easy to fix, of course. Other failures:

```
File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.4.rc4-IPYTHON/devel/sage-main/sage/plot/plot.py", line 1176:
    sage: len((q1).matplotlib().axes[0].legend().texts) # used to raise AttributeError
Expected:
    1
Got:
    2
**********************************************************************
File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.4.rc4-IPYTHON/devel/sage-main/sage/plot/plot.py", line 1186:
    sage: len(p1.matplotlib().axes[0].legend().texts)
Expected:
    1
Got:
    3
```
 Why is this failing now? Was there a change in the format of the legend? The error in plot_field3d.py is `ValueError: Colormap red is not recognized`. I don't know what to do about this one. I haven't run full doctests, just on the plot directory. I'll let you know if I find anything else.



---

archive/issue_events_117113.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-11-10T22:50:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117113"
}
```



---

archive/issue_events_117114.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-11-10T22:50:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117114"
}
```



---

archive/issue_comments_163082.json:
```json
{
    "body": "<a id='comment:4'></a>\nWow, sorry, that was really sloppy on my part.  This is definitely needs work right now.",
    "created_at": "2012-11-10T22:50:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163082",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
Wow, sorry, that was really sloppy on my part.  This is definitely needs work right now.



---

archive/issue_comments_163083.json:
```json
{
    "body": "<a id='comment:5'></a>\nThose printing issues are weird.  I wonder if that's from the upgrade to IPython 0.13.1?",
    "created_at": "2012-11-10T22:53:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163083",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
Those printing issues are weird.  I wonder if that's from the upgrade to IPython 0.13.1?



---

archive/issue_comments_163084.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've uploaded a new spkg that should fix the two issues with the spkg.",
    "created_at": "2012-11-10T22:57:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163084",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
I've uploaded a new spkg that should fix the two issues with the spkg.



---

archive/issue_comments_163085.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think I get the printing issues with both the old and the new IPython. See /scratch/palmieri/sage-5.4.rc4-13693/ on sage.math for a build with a stock 5.4.rc4 plus this spkg.",
    "created_at": "2012-11-11T02:02:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163085",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
I think I get the printing issues with both the old and the new IPython. See /scratch/palmieri/sage-5.4.rc4-13693/ on sage.math for a build with a stock 5.4.rc4 plus this spkg.



---

archive/issue_comments_163086.json:
```json
{
    "body": "<a id='comment:8'></a>\nI hope we can get this into Sage -- version 1.2 has [support for PGF/TikZ output](http://matplotlib.org/users/whats_new.html#pgf-tikz-backend) which opens up some pretty amazing opportunities with SageTeX. (Not that I will have time to implement that in the near future, but getting this upgrade in is a necessary first step.)",
    "created_at": "2013-03-02T23:30:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163086",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:8'></a>
I hope we can get this into Sage -- version 1.2 has [support for PGF/TikZ output](http://matplotlib.org/users/whats_new.html#pgf-tikz-backend) which opens up some pretty amazing opportunities with SageTeX. (Not that I will have time to implement that in the near future, but getting this upgrade in is a necessary first step.)



---

archive/issue_comments_163087.json:
```json
{
    "body": "<a id='comment:9'></a>\nSee also [streamplots](http://matplotlib.org/users/whats_new.html#streamplot) - for #10775.",
    "created_at": "2013-03-03T01:01:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163087",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
See also [streamplots](http://matplotlib.org/users/whats_new.html#streamplot) - for #10775.



---

archive/issue_comments_163088.json:
```json
{
    "body": "<a id='comment:10'></a>\nDefinitely would be nice. I had seen the  failures before in sage-on-gentoo before forcing 1.1.0. I will see if I can dedicate some time to it this week.",
    "created_at": "2013-03-03T02:25:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163088",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Definitely would be nice. I had seen the  failures before in sage-on-gentoo before forcing 1.1.0. I will see if I can dedicate some time to it this week.



---

archive/issue_comments_163089.json:
```json
{
    "body": "<a id='comment:11'></a>\nRegarding the failures: I can easily fix all of them except the ones in plot.py:\n\n```\n        sage: q1 = plot([sin(x), tan(x)], legend_label='trig')\n        sage: len(q1.matplotlib().axes[0].legend().texts) # used to raise AttributeError\n        1\n\n    ::\n\n    Make sure that we don't get multiple legend labels for plot segments\n    (:trac:`11998`)::\n\n        sage: p1 = plot(1/(x^2-1),(x,-2,2),legend_label=\"foo\",detect_poles=True)\n        sage: len(p1.matplotlib().axes[0].legend().texts)\n        1\n```\nFor the first one (`q1`), with the new spkg there are two legend labels (\"trig\" and \"None\"), where there used to be just one. For `p1`, there are now three labels, in direct contradiction of the text. It looks like the picture at #11998, except the labels are \"None\", \"None\", and \"foo\". I don't know how to fix these. See my patch for the other fixes.",
    "created_at": "2013-03-05T20:07:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163089",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Regarding the failures: I can easily fix all of them except the ones in plot.py:

```
        sage: q1 = plot([sin(x), tan(x)], legend_label='trig')
        sage: len(q1.matplotlib().axes[0].legend().texts) # used to raise AttributeError
        1

    ::

    Make sure that we don't get multiple legend labels for plot segments
    (:trac:`11998`)::

        sage: p1 = plot(1/(x^2-1),(x,-2,2),legend_label="foo",detect_poles=True)
        sage: len(p1.matplotlib().axes[0].legend().texts)
        1
```
For the first one (`q1`), with the new spkg there are two legend labels ("trig" and "None"), where there used to be just one. For `p1`, there are now three labels, in direct contradiction of the text. It looks like the picture at #11998, except the labels are "None", "None", and "foo". I don't know how to fix these. See my patch for the other fixes.



---

archive/issue_comments_163090.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg\n+\n+1.2.1 is now going to be released soon: http://sourceforge.net/mailarchive/message.php?msg_id=30648158\n``````\n",
    "created_at": "2013-03-26T17:02:15Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163090",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg
+
+1.2.1 is now going to be released soon: http://sourceforge.net/mailarchive/message.php?msg_id=30648158
``````




---

archive/issue_comments_163091.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg\n \n-1.2.1 is now going to be released soon: http://sourceforge.net/mailarchive/message.php?msg_id=30648158\n+1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n``````\n",
    "created_at": "2013-03-27T16:09:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163091",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg
 
-1.2.1 is now going to be released soon: http://sourceforge.net/mailarchive/message.php?msg_id=30648158
+1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html
``````




---

archive/issue_events_117115.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-03-28T20:47:13Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "rename": {
        "from": "Upgrade matplotlib to 1.2.0",
        "to": "Upgrade matplotlib to 1.2.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117115"
}
```



---

archive/issue_comments_163092.json:
```json
{
    "body": "<a id='comment:14'></a>\nI was just doing the same thing this evening to try random Cygwin stuff.\n\nI guess we should look for 1.2.1.",
    "created_at": "2013-03-28T20:47:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163092",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:14'></a>
I was just doing the same thing this evening to try random Cygwin stuff.

I guess we should look for 1.2.1.



---

archive/issue_comments_163093.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg\n \n 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n+Updated spkg at:\n+http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg\n``````\n",
    "created_at": "2013-03-28T21:37:36Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163093",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg
 
 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html
+Updated spkg at:
+http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg
``````




---

archive/issue_comments_163094.json:
```json
{
    "body": "<a id='comment:15'></a>\nUpdated spkg at:\nhttp://boxen.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg",
    "created_at": "2013-03-28T21:37:36Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163094",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>
Updated spkg at:
http://boxen.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg



---

archive/issue_events_117116.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-03-28T21:48:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117116"
}
```



---

archive/issue_events_117117.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-03-28T21:48:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117117"
}
```



---

archive/issue_comments_163095.json:
```json
{
    "body": "<a id='comment:16'></a>\nNot sure if it's the update wihch changed something but I have no failures in plot.py on my 5.9.beta1 install.\n\nI'm putting this back to needs_review though I could not run \"make ptestlong\" yet cause the install I have access to is kind of borken because of ATLAS black magic.",
    "created_at": "2013-03-28T21:48:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163095",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:16'></a>
Not sure if it's the update wihch changed something but I have no failures in plot.py on my 5.9.beta1 install.

I'm putting this back to needs_review though I could not run "make ptestlong" yet cause the install I have access to is kind of borken because of ATLAS black magic.



---

archive/issue_comments_163096.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jpflori](#comment%3A16):\n> Not sure if it's the update wihch changed something but I have no failures in plot.py on my 5.9.beta1 install.\n\nSame for me, too. I'll try `make ptestlong` on a few machines to see what happens.",
    "created_at": "2013-03-28T23:07:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163096",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Replying to [jpflori](#comment%3A16):
> Not sure if it's the update wihch changed something but I have no failures in plot.py on my 5.9.beta1 install.

Same for me, too. I'll try `make ptestlong` on a few machines to see what happens.



---

archive/issue_comments_163097.json:
```json
{
    "body": "<a id='comment:18'></a>\nHas anyone manually checked the images connected to the failing doctests from before, just to make sure we're not missing a problem?",
    "created_at": "2013-03-28T23:13:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163097",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:18'></a>
Has anyone manually checked the images connected to the failing doctests from before, just to make sure we're not missing a problem?



---

archive/issue_comments_163098.json:
```json
{
    "body": "<a id='comment:19'></a>\nI had a look at the q1 one to spot the problem but it looked fine (blue sine and other curve, axes, little box with a blue segment and trig, no None anywhere) and was confused and then indeed there was no failing doctest.",
    "created_at": "2013-03-28T23:18:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163098",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>
I had a look at the q1 one to spot the problem but it looked fine (blue sine and other curve, axes, little box with a blue segment and trig, no None anywhere) and was confused and then indeed there was no failing doctest.



---

archive/issue_comments_163099.json:
```json
{
    "body": "<a id='comment:20'></a>\nI also looked at the examples by hand, and they looked fine (as opposed to with the 1.2.0 spkg). `make ptestlong` passed on two platforms: boxen.math.washington.edu and an OS X 10.8.3 machine.\n\nSo I'm happy with the spkg. If people are happy with my patch, can we give this a positive review?",
    "created_at": "2013-03-29T03:40:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163099",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
I also looked at the examples by hand, and they looked fine (as opposed to with the 1.2.0 spkg). `make ptestlong` passed on two platforms: boxen.math.washington.edu and an OS X 10.8.3 machine.

So I'm happy with the spkg. If people are happy with my patch, can we give this a positive review?



---

archive/issue_comments_163100.json:
```json
{
    "body": "<a id='comment:21'></a>\nI think the patch is all fine. I had to check if it was the intended behavior for plot_field3d.py (monochrome 3d field, I guess it can be useful sometimes).",
    "created_at": "2013-04-05T09:22:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163100",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
I think the patch is all fine. I had to check if it was the intended behavior for plot_field3d.py (monochrome 3d field, I guess it can be useful sometimes).



---

archive/issue_comments_163101.json:
```json
{
    "body": "**Changing author** from \"Jason Grout\" to \"Jason Grout, John Palmieri,Jean-Pierre Flori\".",
    "created_at": "2013-04-05T09:31:49Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163101",
    "user": "https://github.com/kiwifb"
}
```

**Changing author** from "Jason Grout" to "Jason Grout, John Palmieri,Jean-Pierre Flori".



---

archive/issue_comments_163102.json:
```json
{
    "body": "**Reviewer:** John Palmieri, Francois Bissey",
    "created_at": "2013-04-05T09:31:49Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163102",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** John Palmieri, Francois Bissey



---

archive/issue_events_117118.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-04-05T09:31:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117118"
}
```



---

archive/issue_events_117119.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-04-05T09:31:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117119"
}
```



---

archive/issue_comments_163103.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg\n+Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n \n-1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n-Updated spkg at:\n-http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg\n+**spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)\n``````\n",
    "created_at": "2013-04-05T09:38:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163103",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-Matplotlib 1.2.0 was released today.  Here's an updated spkg: http://sage.math.washington.edu/home/jason/matplotlib-1.2.0.spkg
+Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html
 
-1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html
-Updated spkg at:
-http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg
+**spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)
``````




---

archive/issue_events_117120.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-05T09:38:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "milestone": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117120"
}
```



---

archive/issue_events_117121.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-05T09:38:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117121"
}
```



---

archive/issue_comments_163104.json:
```json
{
    "body": "<a id='comment:24'></a>\nI'm assuming the patch should be applied...",
    "created_at": "2013-04-05T09:39:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
I'm assuming the patch should be applied...



---

archive/issue_comments_163105.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html\n \n **spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)\n+\n+**apply**: [attachment:trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)\n``````\n",
    "created_at": "2013-04-05T09:39:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163105",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Matplotlib 1.2.1 is released now: http://matplotlib.1069221.n5.nabble.com/ANN-matplotlib-1-2-1-release-td40752.html
 
 **spkg**: [http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg](http://sage.math.washington.edu/home/jpflori/matplotlib-1.2.1.spkg)
+
+**apply**: [attachment:trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)
``````




---

archive/issue_comments_163106.json:
```json
{
    "body": "<a id='comment:25'></a>\nYes I should have done the clean up of the description.",
    "created_at": "2013-04-05T09:44:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163106",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
Yes I should have done the clean up of the description.



---

archive/issue_comments_163107.json:
```json
{
    "body": "<a id='comment:26'></a>\nThis is very wrong and should be fixed:\n\n```\n        assert(cm is not None) \n    except (TypeError, AssertionError, ValueError): \n```\n`AssertionError` should *never* be handled in an exception block, unless you have very good reasons to do so. The obvious solution is replacing `assert()` by something else.\n\nI know this problem isn't caused by this patch, but since it is easy to fix, you should fix it.",
    "created_at": "2013-04-08T07:13:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163107",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
This is very wrong and should be fixed:

```
        assert(cm is not None) 
    except (TypeError, AssertionError, ValueError): 
```
`AssertionError` should *never* be handled in an exception block, unless you have very good reasons to do so. The obvious solution is replacing `assert()` by something else.

I know this problem isn't caused by this patch, but since it is easy to fix, you should fix it.



---

archive/issue_comments_163108.json:
```json
{
    "body": "<a id='comment:27'></a>\nFor example, you could do:\n\n```\ntry:\n    cm = get_cmap(colors)\nexcept (TypeError, ValueError):\n    cm = None\nif cm is None:\n    ...\n```",
    "created_at": "2013-04-08T07:14:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163108",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
For example, you could do:

```
try:
    cm = get_cmap(colors)
except (TypeError, ValueError):
    cm = None
if cm is None:
    ...
```



---

archive/issue_events_117122.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-08T12:33:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117122"
}
```



---

archive/issue_events_117123.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-08T12:33:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117123"
}
```



---

archive/issue_comments_163109.json:
```json
{
    "body": "<a id='comment:29'></a>\nOkay, here's a new version of the patch. The only change is this:\n\n```diff\ndiff --git a/sage/plot/plot3d/plot_field3d.py b/sage/plot/plot3d/plot_field3d.py\n--- a/sage/plot/plot3d/plot_field3d.py\n+++ b/sage/plot/plot3d/plot_field3d.py\n@@ -72,8 +72,9 @@\n     try:\n         from matplotlib.cm import get_cmap\n         cm = get_cmap(colors)\n-        assert(cm is not None)\n-    except (TypeError, AssertionError, ValueError):\n+    except (TypeError, ValueError):\n+        cm = None\n+    if cm is None:\n         if isinstance(colors, (list, tuple)):\n             from matplotlib.colors import LinearSegmentedColormap\n             cm = LinearSegmentedColormap.from_list('mymap',colors)\n```",
    "created_at": "2013-04-08T19:00:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163109",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
Okay, here's a new version of the patch. The only change is this:

```diff
diff --git a/sage/plot/plot3d/plot_field3d.py b/sage/plot/plot3d/plot_field3d.py
--- a/sage/plot/plot3d/plot_field3d.py
+++ b/sage/plot/plot3d/plot_field3d.py
@@ -72,8 +72,9 @@
     try:
         from matplotlib.cm import get_cmap
         cm = get_cmap(colors)
-        assert(cm is not None)
-    except (TypeError, AssertionError, ValueError):
+    except (TypeError, ValueError):
+        cm = None
+    if cm is None:
         if isinstance(colors, (list, tuple)):
             from matplotlib.colors import LinearSegmentedColormap
             cm = LinearSegmentedColormap.from_list('mymap',colors)
```



---

archive/issue_events_117124.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-04-08T19:00:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117124"
}
```



---

archive/issue_events_117125.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-04-08T19:00:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117125"
}
```



---

archive/issue_comments_163110.json:
```json
{
    "body": "fixes for failures except for plot.py",
    "created_at": "2013-04-08T19:01:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163110",
    "user": "https://github.com/jhpalmieri"
}
```

fixes for failures except for plot.py



---

archive/attachments_019161.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13693-part1.patch",
    "asset_url": "tarball://root/attachments/ticket13693/trac_13693-part1.patch",
    "created_at": "2013-04-08T19:02:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_163111.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Attachment:** [trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)\n\nI'm going to restore the positive review, also; you can view my change as a positive review of Jeroen's suggestion...",
    "created_at": "2013-04-08T19:02:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163111",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
**Attachment:** [trac_13693-part1.patch](https://github.com/sagemath/sage/files/ticket13693/trac_13693-part1.patch)

I'm going to restore the positive review, also; you can view my change as a positive review of Jeroen's suggestion...



---

archive/issue_events_117126.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-04-08T19:02:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117126"
}
```



---

archive/issue_events_117127.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-04-08T19:02:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117127"
}
```



---

archive/issue_comments_163112.json:
```json
{
    "body": "**Merged:** sage-5.10.beta0",
    "created_at": "2013-04-13T13:49:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163112",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.beta0



---

archive/issue_events_117128.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-13T13:49:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117128"
}
```



---

archive/issue_events_117129.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-13T13:49:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13693#event-117129"
}
```



---

archive/issue_comments_163113.json:
```json
{
    "body": "<a id='comment:32'></a>\nAs a followup: the new version of matplotlib seems to be causing an issue with saving graphs in pdf. See:\n\nhttps://groups.google.com/forum/?fromgroups=#!topic/sage-devel/6l9Z4y5rCuM",
    "created_at": "2013-05-06T16:28:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163113",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:32'></a>
As a followup: the new version of matplotlib seems to be causing an issue with saving graphs in pdf. See:

https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/6l9Z4y5rCuM



---

archive/issue_comments_163114.json:
```json
{
    "body": "**Changing reviewer** from \"John Palmieri, Francois Bissey\" to \"John Palmieri, Fran\u00e7ois Bissey\".",
    "created_at": "2013-06-06T12:52:02Z",
    "issue": "https://github.com/sagemath/sage/issues/13693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13693#issuecomment-163114",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "John Palmieri, Francois Bissey" to "John Palmieri, François Bissey".
