# Issue 13811: Meta-ticket: Support Python's __copy__ / __deepcopy__ protocol

archive/issues_013607.json:
```json
{
    "body": "Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).\n\n```\nsage: a = 0\nsage: copy(a) is a\nFalse\n```\n\n\nAnother symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:\n\n  ```\n     sage: def unpicklableFamily():\n     ...       x = 10\n     ...       return LazyFamily([1,2,3], lambda n: x*n)\n     sage: f = unpicklableFamily() \n     sage: copy(f)\n     Traceback (most recent call last):\n     ...\n     ValueError: Cannot pickle code objects from closures\n  ```\n\nThe case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.\n\nTickets: \n- #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n- #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements\n- #32480 trivial `__copy__` and `__deepcopy__` methods for symbolic expressions and functions\n- #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n- #32453 `__copy__` methods for all classes that define `copy` methods\n- #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods\n- #23075 `copy(CombinatorialFreeModule.Element)` broken by #22632\n- #5417 Fix some more deepcopy/caching issues in the quadratic forms code\nRelated:\n- #30387\n\n\nDepends on #32454\n\n**Assignee:** @williamstein\n\n**CC:**  @tscrim @mjungmath @nbruin @kwankyu @williamstein @mwageringel @kcrisman\n\n**Keywords:** LazyFamily, copy, pickle\n\n**Branch:** [u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects)\n\n**Commit:** [2bd01ae26f1447cfc35d2fc1901413baab43819d](https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d)\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/13811\n\n",
    "created_at": "2012-12-08T12:49:43Z",
    "labels": [
        "component: pickling",
        "critical",
        "bug",
        "needs info"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Meta-ticket: Support Python's __copy__ / __deepcopy__ protocol",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13811",
    "user": "https://github.com/cnassau"
}
```
Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).

```
sage: a = 0
sage: copy(a) is a
False
```


Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:

  ```
     sage: def unpicklableFamily():
     ...       x = 10
     ...       return LazyFamily([1,2,3], lambda n: x*n)
     sage: f = unpicklableFamily() 
     sage: copy(f)
     Traceback (most recent call last):
     ...
     ValueError: Cannot pickle code objects from closures
  ```

The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.

Tickets: 
- #32454 trivial `__copy__` and `__deepcopy__` methods for number types
- #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements
- #32480 trivial `__copy__` and `__deepcopy__` methods for symbolic expressions and functions
- #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
- #32453 `__copy__` methods for all classes that define `copy` methods
- #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods
- #23075 `copy(CombinatorialFreeModule.Element)` broken by #22632
- #5417 Fix some more deepcopy/caching issues in the quadratic forms code
Related:
- #30387


Depends on #32454

**Assignee:** @williamstein

**CC:**  @tscrim @mjungmath @nbruin @kwankyu @williamstein @mwageringel @kcrisman

**Keywords:** LazyFamily, copy, pickle

**Branch:** [u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects)

**Commit:** [2bd01ae26f1447cfc35d2fc1901413baab43819d](https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d)

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/13811





---

archive/issue_events_118461.json:
```json
{
    "actor": "https://github.com/cnassau",
    "created_at": "2012-12-08T14:11:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118461"
}
```



---

archive/issue_comments_165082.json:
```json
{
    "body": "**Author:** cnassau",
    "created_at": "2012-12-08T14:13:28Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165082",
    "user": "https://github.com/cnassau"
}
```

**Author:** cnassau



---

archive/issue_comments_165083.json:
```json
{
    "body": "**Changing author** from \"cnassau\" to \"Christian Nassau\".",
    "created_at": "2012-12-08T14:14:15Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165083",
    "user": "https://github.com/cnassau"
}
```

**Changing author** from "cnassau" to "Christian Nassau".



---

archive/issue_comments_165084.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Christian!\n\nFamilies are (semantically) immutable objects. Why would we want to copy them?\n\nCheers,\n                                   Nicolas",
    "created_at": "2012-12-13T09:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165084",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Hi Christian!

Families are (semantically) immutable objects. Why would we want to copy them?

Cheers,
                                   Nicolas



---

archive/issue_comments_165085.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [nthiery](#comment%3A4):\n>     Hi Christian!\n> \n> Families are (semantically) immutable objects. Why would we want to copy them?\n\nGood point... I stumbled across this issue while I was struggling to create a disjoint union of a dynamically generated family of `LazyFamily` objects, while the *real* problem was that I was using closures with reference to a loop variable. I eventually resolved this issue, and my solution does not requiry any copies now. So I agree that there's no need to create shallow copies.\n\nI **do** think that user code can expect that `copy(any_sage_object)` does not throw an error. Maybe `LazyFamily.__copy__(self)` should just return `self`? This would be in accordance with\n\n   ```\n   sage: copy(Integers()) is Integers()\n   True\n   ```\n      \nCheers,\nChristian",
    "created_at": "2012-12-13T10:17:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165085",
    "user": "https://github.com/cnassau"
}
```

<a id='comment:5'></a>
Replying to [nthiery](#comment%3A4):
>     Hi Christian!
> 
> Families are (semantically) immutable objects. Why would we want to copy them?

Good point... I stumbled across this issue while I was struggling to create a disjoint union of a dynamically generated family of `LazyFamily` objects, while the *real* problem was that I was using closures with reference to a loop variable. I eventually resolved this issue, and my solution does not requiry any copies now. So I agree that there's no need to create shallow copies.

I **do** think that user code can expect that `copy(any_sage_object)` does not throw an error. Maybe `LazyFamily.__copy__(self)` should just return `self`? This would be in accordance with

   ```
   sage: copy(Integers()) is Integers()
   True
   ```
      
Cheers,
Christian



---

archive/issue_comments_165086.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [cnassau](#comment%3A5):\n> I **do** think that user code can expect that `copy(any_sage_object)` does not throw an error. Maybe `LazyFamily.__copy__(self)` should just return `self`? This would be in accordance with\n> \n>    ```\n>    sage: copy(Integers()) is Integers()\n>    True\n>    ```\n\nYes, it would make sense to have copy(x) return x for all immutable objects in Sage. I am not sure how to achieve this though: we do not (yet?) have a class for providing code for all immutable objects in Sage, and I would not want to force every relevant class to reimplement a trivial `__copy__` method.\n\nFor the case at hand (families), maybe one could add a method Parent.__copy__ returning `self`? As far as I can tell, parents are required to be immutable anyway. But one should double check this.\n\nCheers,\n                              Nicolas",
    "created_at": "2012-12-13T10:29:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165086",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>
Replying to [cnassau](#comment%3A5):
> I **do** think that user code can expect that `copy(any_sage_object)` does not throw an error. Maybe `LazyFamily.__copy__(self)` should just return `self`? This would be in accordance with
> 
>    ```
>    sage: copy(Integers()) is Integers()
>    True
>    ```

Yes, it would make sense to have copy(x) return x for all immutable objects in Sage. I am not sure how to achieve this though: we do not (yet?) have a class for providing code for all immutable objects in Sage, and I would not want to force every relevant class to reimplement a trivial `__copy__` method.

For the case at hand (families), maybe one could add a method Parent.__copy__ returning `self`? As far as I can tell, parents are required to be immutable anyway. But one should double check this.

Cheers,
                              Nicolas



---

archive/issue_comments_165087.json:
```json
{
    "body": "A patch for this problem",
    "created_at": "2013-01-26T12:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165087",
    "user": "https://github.com/cnassau"
}
```

A patch for this problem



---

archive/issue_events_118462.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118462"
}
```



---

archive/issue_events_118463.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118463"
}
```



---

archive/attachments_019317.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "lazyfamcopy.patch",
    "asset_url": "tarball://root/attachments/ticket13811/lazyfamcopy.patch",
    "created_at": "2013-08-13T15:35:53Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13811/lazyfamcopy.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_165088.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Attachment:** [lazyfamcopy.patch](https://github.com/sagemath/sage/files/ticket13811/lazyfamcopy.patch)",
    "created_at": "2013-08-13T15:35:53Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165088",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
**Attachment:** [lazyfamcopy.patch](https://github.com/sagemath/sage/files/ticket13811/lazyfamcopy.patch)



---

archive/issue_events_118464.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118464"
}
```



---

archive/issue_events_118465.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118465"
}
```



---

archive/issue_events_118466.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118466"
}
```



---

archive/issue_events_118467.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118467"
}
```



---

archive/issue_events_118468.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118468"
}
```



---

archive/issue_events_118469.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118469"
}
```



---

archive/issue_events_118470.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-01T11:29:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118470"
}
```



---

archive/issue_events_118471.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-01T11:29:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118471"
}
```



---

archive/issue_comments_165089.json:
```json
{
    "body": "<a id='comment:11'></a>\nHi,\n\nAs Nicolas suggested in [his comnent 6](#comment%3A6), `__copy__` should be implemented as\n\n```\ndef __copy__(self):\n    return self\n```\nIt is standard Python for immutable objects\n\n```\nsage: t = (1,2,3)\nsage: copy(t) is t\nTrue\nsage: i = 1231491283r\nsage: copy(i) is i\nTrue \n```\n\nVincent",
    "created_at": "2015-02-01T11:29:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165089",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Hi,

As Nicolas suggested in [his comnent 6](#comment%3A6), `__copy__` should be implemented as

```
def __copy__(self):
    return self
```
It is standard Python for immutable objects

```
sage: t = (1,2,3)
sage: copy(t) is t
True
sage: i = 1231491283r
sage: copy(i) is i
True 
```

Vincent



---

archive/issue_events_118472.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T01:18:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118472"
}
```



---

archive/issue_events_118473.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T01:18:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118473"
}
```



---

archive/issue_comments_165090.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n-Currently, copying of `LazyFamily` objects only works for families that can be pickled:\n+Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__`, `__deepcopy__` methods (which should just return the object).\n+\n+```\n+sage: copy(0) is 0\n+False\n+```\n+\n+\n+\n+Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:\n \n   ```\n      sage: def unpicklableFamily():\n@@ -11,6 +20,4 @@\n      ValueError: Cannot pickle code objects from closures\n   ```\n \n-I suggest adding a `LazyFamily.__copy__` method that fixes this.\n \n-\n``````\n",
    "created_at": "2021-09-01T01:18:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165090",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
-Currently, copying of `LazyFamily` objects only works for families that can be pickled:
+Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__`, `__deepcopy__` methods (which should just return the object).
+
+```
+sage: copy(0) is 0
+False
+```
+
+
+
+Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:
 
   ```
      sage: def unpicklableFamily():
@@ -11,6 +20,4 @@
      ValueError: Cannot pickle code objects from closures
   ```
 
-I suggest adding a `LazyFamily.__copy__` method that fixes this.
 
-
``````




---

archive/issue_events_118474.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T01:18:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "rename": {
        "from": "LazyFamily cannot be copied if it can't be pickled",
        "to": "__copy__ and __deepcopy__ methods for all immutable Sage objects"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118474"
}
```



---

archive/issue_events_118475.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T01:18:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118475"
}
```



---

archive/issue_events_118476.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T01:18:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118476"
}
```



---

archive/issue_comments_165091.json:
```json
{
    "body": "**Changing author** from \"Christian Nassau\" to \"\".",
    "created_at": "2021-09-01T01:18:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165091",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Christian Nassau" to "".



---

archive/issue_comments_165092.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n False\n ```\n \n-\n+Related: #30387\n \n Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:\n \n``````\n",
    "created_at": "2021-09-01T01:23:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165092",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 False
 ```
 
-
+Related: #30387
 
 Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:
 
``````




---

archive/issue_comments_165093.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__`, `__deepcopy__` methods (which should just return the object).\n+Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).\n \n ```\n sage: copy(0) is 0\n@@ -20,4 +20,6 @@\n      ValueError: Cannot pickle code objects from closures\n   ```\n \n+The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? \n \n+\n``````\n",
    "created_at": "2021-09-01T20:20:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165093",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__`, `__deepcopy__` methods (which should just return the object).
+Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).
 
 ```
 sage: copy(0) is 0
@@ -20,4 +20,6 @@
      ValueError: Cannot pickle code objects from closures
   ```
 
+The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? 
 
+
``````




---

archive/issue_comments_165094.json:
```json
{
    "body": "<a id='comment:16'></a>\nImmutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input.",
    "created_at": "2021-09-01T21:07:09Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165094",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Immutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input.



---

archive/issue_comments_165095.json:
```json
{
    "body": "<a id='comment:17'></a>\nWell, that's certainly not true for `tuple`.",
    "created_at": "2021-09-01T21:25:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165095",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Well, that's certainly not true for `tuple`.



---

archive/issue_comments_165096.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [tscrim](#comment%3A16):\n> Immutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input. \n\nThat's not quite the case in python, though: tuples are \"immutable\", but you're free to put mutable objects in them. Because tuples compute their hash by incorporating the hashes of all the constituents, such tuples then fail to be hashable. From that perspective, I think it can be fairly expensive in general to determine if an object is hashable/really immutable in a generic way (concrete implementations can answer these questions much better), so it might not be such a good idea to let copy/deepcopy really depend on it. I don't see why it's important to optimize the operations anyway: if you're interested in optimizing your code, then you should probably be avoiding unnecessary copying yourself.",
    "created_at": "2021-09-01T21:25:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165096",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:18'></a>
Replying to [tscrim](#comment%3A16):
> Immutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input. 

That's not quite the case in python, though: tuples are "immutable", but you're free to put mutable objects in them. Because tuples compute their hash by incorporating the hashes of all the constituents, such tuples then fail to be hashable. From that perspective, I think it can be fairly expensive in general to determine if an object is hashable/really immutable in a generic way (concrete implementations can answer these questions much better), so it might not be such a good idea to let copy/deepcopy really depend on it. I don't see why it's important to optimize the operations anyway: if you're interested in optimizing your code, then you should probably be avoiding unnecessary copying yourself.



---

archive/issue_comments_165097.json:
```json
{
    "body": "<a id='comment:19'></a>\nI think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)",
    "created_at": "2021-09-01T21:30:32Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)



---

archive/issue_comments_165098.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A19):\n> I think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)\n\nBut by then: why would you bother? You've already done the hard work. I don't think there's much benefit and you'd make the code more complex. Just make a deep copy. That's what was requested.",
    "created_at": "2021-09-01T22:45:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165098",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A19):
> I think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)

But by then: why would you bother? You've already done the hard work. I don't think there's much benefit and you'd make the code more complex. Just make a deep copy. That's what was requested.



---

archive/issue_comments_165099.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects)",
    "created_at": "2021-09-01T22:49:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165099",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__copy___and___deepcopy___methods_for_all_immutable_sage_objects)



---

archive/issue_comments_165100.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [nbruin](#comment%3A20):\n> Replying to [mkoeppe](#comment%3A19):\n> > I think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)\n\n> \n> But by then: why would you bother? \n\nThe time for copying is sunk, but the memory isn't\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65ba0c8a04bca713d68fe4c67b8470fbbbf8ac68\">65ba0c8</a></td><td><code>Vector_integer_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2df991cd4e35f125cfc563846b72e6617d01da86\">2df991c</a></td><td><code>Vector_integer_dense.__deepcopy__: New, delegate to __copy__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc79c29c0670b55dd7875f105d5205840d9b244b\">dc79c29</a></td><td><code>Sequence_generic.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e\">5102264</a></td><td><code>Sequence_generic.__deepcopy__: New</code></td></tr></table>\n",
    "created_at": "2021-09-01T22:51:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165100",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Replying to [nbruin](#comment%3A20):
> Replying to [mkoeppe](#comment%3A19):
> > I think in `__deepcopy__` of an immutable container-like object, we should first call `deepcopy` for all elements; and if the copies are all identical to the source elements, then we can just return `self` instead of making a new object.  (The positive result of this test can be cached.)

> 
> But by then: why would you bother? 

The time for copying is sunk, but the memory isn't

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65ba0c8a04bca713d68fe4c67b8470fbbbf8ac68">65ba0c8</a></td><td><code>Vector_integer_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2df991cd4e35f125cfc563846b72e6617d01da86">2df991c</a></td><td><code>Vector_integer_dense.__deepcopy__: New, delegate to __copy__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc79c29c0670b55dd7875f105d5205840d9b244b">dc79c29</a></td><td><code>Sequence_generic.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e">5102264</a></td><td><code>Sequence_generic.__deepcopy__: New</code></td></tr></table>




---

archive/issue_comments_165101.json:
```json
{
    "body": "**Commit:** [51022647e924e985224785d7dfd3948dcf42f29e](https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e)",
    "created_at": "2021-09-01T22:51:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165101",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [51022647e924e985224785d7dfd3948dcf42f29e](https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e)



---

archive/issue_comments_165102.json:
```json
{
    "body": "<a id='comment:23'></a>\nHere's an implementation for two example classes. Obviously we would have to do the same for many more classes.",
    "created_at": "2021-09-01T22:52:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165102",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Here's an implementation for two example classes. Obviously we would have to do the same for many more classes.



---

archive/issue_comments_165103.json:
```json
{
    "body": "**Changing commit** from \"[51022647e924e985224785d7dfd3948dcf42f29e](https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e)\" to \"[c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8](https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8)\".",
    "created_at": "2021-09-01T22:59:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[51022647e924e985224785d7dfd3948dcf42f29e](https://github.com/sagemath/sagetrac-mirror/commit/51022647e924e985224785d7dfd3948dcf42f29e)" to "[c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8](https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8)".



---

archive/issue_comments_165104.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8\">c9539d0</a></td><td><code>Sequence_generic.__deepcopy__: Fixup doctest</code></td></tr></table>\n",
    "created_at": "2021-09-01T22:59:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8">c9539d0</a></td><td><code>Sequence_generic.__deepcopy__: Fixup doctest</code></td></tr></table>




---

archive/issue_events_118477.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T23:41:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118477"
}
```



---

archive/issue_events_118478.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T23:41:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118478"
}
```



---

archive/issue_comments_165105.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-09-01T23:41:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165105",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_165106.json:
```json
{
    "body": "<a id='comment:25'></a>\nSetting to needs review so the patchbot will run",
    "created_at": "2021-09-01T23:41:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165106",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Setting to needs review so the patchbot will run



---

archive/issue_comments_165107.json:
```json
{
    "body": "**Changing commit** from \"[c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8](https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8)\" to \"[d5096b6eb4645bc5579f7318c794972e72ffc92f](https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f)\".",
    "created_at": "2021-09-01T23:42:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8](https://github.com/sagemath/sagetrac-mirror/commit/c9539d05b98c07fb988d1ca1cb0625eeb66cf7a8)" to "[d5096b6eb4645bc5579f7318c794972e72ffc92f](https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f)".



---

archive/issue_comments_165108.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f\">d5096b6</a></td><td><code>FreeModuleElement[_generic_{dense,sparse}].__copy__: If immutable, return self</code></td></tr></table>\n",
    "created_at": "2021-09-01T23:42:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f">d5096b6</a></td><td><code>FreeModuleElement[_generic_{dense,sparse}].__copy__: If immutable, return self</code></td></tr></table>




---

archive/issue_comments_165109.json:
```json
{
    "body": "**Changing commit** from \"[d5096b6eb4645bc5579f7318c794972e72ffc92f](https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f)\" to \"[6fe95340b9d002ead9770b0f51470467403f194b](https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b)\".",
    "created_at": "2021-09-02T01:30:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d5096b6eb4645bc5579f7318c794972e72ffc92f](https://github.com/sagemath/sagetrac-mirror/commit/d5096b6eb4645bc5579f7318c794972e72ffc92f)" to "[6fe95340b9d002ead9770b0f51470467403f194b](https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b)".



---

archive/issue_comments_165110.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64eabb53ee4a0fc6b5852ac8125d59645aacf9a5\">64eabb5</a></td><td><code>Vector_rational_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b\">6fe9534</a></td><td><code>Vector_rational_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>\n",
    "created_at": "2021-09-02T01:30:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64eabb53ee4a0fc6b5852ac8125d59645aacf9a5">64eabb5</a></td><td><code>Vector_rational_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b">6fe9534</a></td><td><code>Vector_rational_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>




---

archive/issue_comments_165111.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61ceb67f00cd8bf7dd5440f8915c63328c160b4f\">61ceb67</a></td><td><code>Vector_mod2_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c744c2c6c3b3fec08d030b20fc0b1cb41fccf115\">c744c2c</a></td><td><code>Vector_mod2_dense.__deepcopy__: New, delegate to __copy__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c907f7b76bfe12153b97c724a275760315a76f68\">c907f7b</a></td><td><code>Vector_modn_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6\">4a902ef</a></td><td><code>Vector_modn_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>\n",
    "created_at": "2021-09-02T01:42:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61ceb67f00cd8bf7dd5440f8915c63328c160b4f">61ceb67</a></td><td><code>Vector_mod2_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c744c2c6c3b3fec08d030b20fc0b1cb41fccf115">c744c2c</a></td><td><code>Vector_mod2_dense.__deepcopy__: New, delegate to __copy__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c907f7b76bfe12153b97c724a275760315a76f68">c907f7b</a></td><td><code>Vector_modn_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6">4a902ef</a></td><td><code>Vector_modn_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>




---

archive/issue_comments_165112.json:
```json
{
    "body": "**Changing commit** from \"[6fe95340b9d002ead9770b0f51470467403f194b](https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b)\" to \"[4a902ef9b7c4c252fb5fac5c37462627d37e81f6](https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6)\".",
    "created_at": "2021-09-02T01:42:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6fe95340b9d002ead9770b0f51470467403f194b](https://github.com/sagemath/sagetrac-mirror/commit/6fe95340b9d002ead9770b0f51470467403f194b)" to "[4a902ef9b7c4c252fb5fac5c37462627d37e81f6](https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6)".



---

archive/issue_comments_165113.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d22d4efeda1eb9076f90a08420711edfe11d8492\">d22d4ef</a></td><td><code>Vector_double_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122\">90c982f</a></td><td><code>Vector_double_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>\n",
    "created_at": "2021-09-02T02:05:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d22d4efeda1eb9076f90a08420711edfe11d8492">d22d4ef</a></td><td><code>Vector_double_dense.__copy__: If immutable, just return self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122">90c982f</a></td><td><code>Vector_double_dense.__deepcopy__: New, delegate to __copy__</code></td></tr></table>




---

archive/issue_comments_165114.json:
```json
{
    "body": "**Changing commit** from \"[4a902ef9b7c4c252fb5fac5c37462627d37e81f6](https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6)\" to \"[90c982f323adaf3187e96d6707fd948c18297122](https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122)\".",
    "created_at": "2021-09-02T02:05:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4a902ef9b7c4c252fb5fac5c37462627d37e81f6](https://github.com/sagemath/sagetrac-mirror/commit/4a902ef9b7c4c252fb5fac5c37462627d37e81f6)" to "[90c982f323adaf3187e96d6707fd948c18297122](https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122)".



---

archive/issue_comments_165115.json:
```json
{
    "body": "<a id='comment:30'></a>\nMissing in `sage.modules` is now only a `__deepcopy__` method for generic dense and sparse vectors.  Not sure if we may assume that ring elements are immutable (see #32450)...",
    "created_at": "2021-09-02T02:08:03Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165115",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Missing in `sage.modules` is now only a `__deepcopy__` method for generic dense and sparse vectors.  Not sure if we may assume that ring elements are immutable (see #32450)...



---

archive/issue_comments_165116.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [nbruin](#comment%3A18):\n> Replying to [tscrim](#comment%3A16):\n> > Immutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input. \n\n> \n> That's not quite the case in python, though: tuples are \"immutable\", but you're free to put mutable objects in them. Because tuples compute their hash by incorporating the hashes of all the constituents, such tuples then fail to be hashable.\n\nRight, that is what I was saying that there is an assumption on good input (which is something we can check when necessary).\n\n> From that perspective, I think it can be fairly expensive in general to determine if an object is hashable/really immutable in a generic way (concrete implementations can answer these questions much better), so it might not be such a good idea to let copy/deepcopy really depend on it. I don't see why it's important to optimize the operations anyway: if you're interested in optimizing your code, then you should probably be avoiding unnecessary copying yourself.\n\nSometimes you are using an algorithm that is designed to handle something that is designed to work with something that does mutate (say, uses `+=`) as it makes a copy to be sure to be safe. Granted, I don't think this occurs so frequently, but it is good to support this case as I don't think it adds that much more to the complexity.",
    "created_at": "2021-09-02T03:52:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165116",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>
Replying to [nbruin](#comment%3A18):
> Replying to [tscrim](#comment%3A16):
> > Immutability of a container object implies all elements of it are also immutable. This is important for hashability. Although there is not a strict adherence to this, it can be an assumption of good input. 

> 
> That's not quite the case in python, though: tuples are "immutable", but you're free to put mutable objects in them. Because tuples compute their hash by incorporating the hashes of all the constituents, such tuples then fail to be hashable.

Right, that is what I was saying that there is an assumption on good input (which is something we can check when necessary).

> From that perspective, I think it can be fairly expensive in general to determine if an object is hashable/really immutable in a generic way (concrete implementations can answer these questions much better), so it might not be such a good idea to let copy/deepcopy really depend on it. I don't see why it's important to optimize the operations anyway: if you're interested in optimizing your code, then you should probably be avoiding unnecessary copying yourself.

Sometimes you are using an algorithm that is designed to handle something that is designed to work with something that does mutate (say, uses `+=`) as it makes a copy to be sure to be safe. Granted, I don't think this occurs so frequently, but it is good to support this case as I don't think it adds that much more to the complexity.



---

archive/issue_comments_165117.json:
```json
{
    "body": "<a id='comment:32'></a>\nIn any case, adding the `__deepcopy__` methods gives some speedup also for mutable vectors:\n\nBefore:\n\n```\nsage: %timeit deepcopy(vector(ZZ, 100000))                                                                                                                     \n396 ms \u00b1 1.67 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\nAfter:\n\n```\nsage: %timeit deepcopy(vector(ZZ, 100000))\n1.39 ms \u00b1 15 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```",
    "created_at": "2021-09-02T04:46:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
In any case, adding the `__deepcopy__` methods gives some speedup also for mutable vectors:

Before:

```
sage: %timeit deepcopy(vector(ZZ, 100000))                                                                                                                     
396 ms  1.67 ms per loop (mean  std. dev. of 7 runs, 1 loop each)
```
After:

```
sage: %timeit deepcopy(vector(ZZ, 100000))
1.39 ms  15 s per loop (mean  std. dev. of 7 runs, 1000 loops each)
```



---

archive/issue_comments_165118.json:
```json
{
    "body": "<a id='comment:33'></a>\nSage even has actual method `Integer.__copy__` that makes an actual copy! The implementation is from 15 years ago; perhaps mutable integers similar to mpz were considered at the time.",
    "created_at": "2021-09-02T05:22:28Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Sage even has actual method `Integer.__copy__` that makes an actual copy! The implementation is from 15 years ago; perhaps mutable integers similar to mpz were considered at the time.



---

archive/issue_comments_165119.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2\">a2f43ea</a></td><td><code>Integer.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>\n",
    "created_at": "2021-09-02T05:31:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2">a2f43ea</a></td><td><code>Integer.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>




---

archive/issue_comments_165120.json:
```json
{
    "body": "**Changing commit** from \"[90c982f323adaf3187e96d6707fd948c18297122](https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122)\" to \"[a2f43eade80a0438f7e839e12e7c45626b3676d2](https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2)\".",
    "created_at": "2021-09-02T05:31:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[90c982f323adaf3187e96d6707fd948c18297122](https://github.com/sagemath/sagetrac-mirror/commit/90c982f323adaf3187e96d6707fd948c18297122)" to "[a2f43eade80a0438f7e839e12e7c45626b3676d2](https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2)".



---

archive/issue_comments_165121.json:
```json
{
    "body": "**Changing commit** from \"[a2f43eade80a0438f7e839e12e7c45626b3676d2](https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2)\" to \"[75e43a18114a5d0ab5a6bfc9439ec07dba357e14](https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14)\".",
    "created_at": "2021-09-02T05:43:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a2f43eade80a0438f7e839e12e7c45626b3676d2](https://github.com/sagemath/sagetrac-mirror/commit/a2f43eade80a0438f7e839e12e7c45626b3676d2)" to "[75e43a18114a5d0ab5a6bfc9439ec07dba357e14](https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14)".



---

archive/issue_comments_165122.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14\">75e43a1</a></td><td><code>Rational.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>\n",
    "created_at": "2021-09-02T05:43:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14">75e43a1</a></td><td><code>Rational.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>




---

archive/issue_comments_165123.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44\">ecc13bc</a></td><td><code>NumberFieldElement_quadratic.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>\n",
    "created_at": "2021-09-02T05:54:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44">ecc13bc</a></td><td><code>NumberFieldElement_quadratic.__copy__, __deepcopy__: Immutable, so just return self</code></td></tr></table>




---

archive/issue_comments_165124.json:
```json
{
    "body": "**Changing commit** from \"[75e43a18114a5d0ab5a6bfc9439ec07dba357e14](https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14)\" to \"[ecc13bc7e360138323c258e917226ef673ff5b44](https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44)\".",
    "created_at": "2021-09-02T05:54:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[75e43a18114a5d0ab5a6bfc9439ec07dba357e14](https://github.com/sagemath/sagetrac-mirror/commit/75e43a18114a5d0ab5a6bfc9439ec07dba357e14)" to "[ecc13bc7e360138323c258e917226ef673ff5b44](https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44)".



---

archive/issue_comments_165125.json:
```json
{
    "body": "<a id='comment:37'></a>\nMaking the same change to `src/sage/rings/number_field/number_field_element.pyx` gives weird errors:\n\n```\nsage -t --random-seed=0 src/sage/rings/number_field/number_field_element.pyx\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field_element.pyx\", line 4193, in sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism\nFailed example:\n    alpha._matrix_over_base_morphism(h) == alpha.matrix(QQ)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism[3]>\", line 1, in <module>\n        alpha._matrix_over_base_morphism(h) == alpha.matrix(QQ)\n      File \"sage/rings/number_field/number_field_element.pyx\", line 4204, in sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism (build/cythonized/sage/rings/number_field/number_field_element.cpp:34434)\n        raise ValueError(\"codomain of phi must be parent of self\")\n    ValueError: codomain of phi must be parent of self\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field_element.pyx\", line 4470, in sage.rings.number_field.number_field_element.NumberFieldElement.different\nFailed example:\n    b.different(K=phi)\nExpected:\n    4*b^3\nGot:\n    4*alpha^3\n**********************************************************************\n```\nAre number field elements mutable??",
    "created_at": "2021-09-02T06:00:36Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Making the same change to `src/sage/rings/number_field/number_field_element.pyx` gives weird errors:

```
sage -t --random-seed=0 src/sage/rings/number_field/number_field_element.pyx
**********************************************************************
File "src/sage/rings/number_field/number_field_element.pyx", line 4193, in sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism
Failed example:
    alpha._matrix_over_base_morphism(h) == alpha.matrix(QQ)
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism[3]>", line 1, in <module>
        alpha._matrix_over_base_morphism(h) == alpha.matrix(QQ)
      File "sage/rings/number_field/number_field_element.pyx", line 4204, in sage.rings.number_field.number_field_element.NumberFieldElement._matrix_over_base_morphism (build/cythonized/sage/rings/number_field/number_field_element.cpp:34434)
        raise ValueError("codomain of phi must be parent of self")
    ValueError: codomain of phi must be parent of self
**********************************************************************
File "src/sage/rings/number_field/number_field_element.pyx", line 4470, in sage.rings.number_field.number_field_element.NumberFieldElement.different
Failed example:
    b.different(K=phi)
Expected:
    4*b^3
Got:
    4*alpha^3
**********************************************************************
```
Are number field elements mutable??



---

archive/issue_comments_165126.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021\">4b260e0</a></td><td><code>RealIntervalFieldElement.__deepcopy__: New</code></td></tr></table>\n",
    "created_at": "2021-09-02T06:28:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021">4b260e0</a></td><td><code>RealIntervalFieldElement.__deepcopy__: New</code></td></tr></table>




---

archive/issue_comments_165127.json:
```json
{
    "body": "**Changing commit** from \"[ecc13bc7e360138323c258e917226ef673ff5b44](https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44)\" to \"[4b260e0c802b8403ea8a7076a727350a0755f021](https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021)\".",
    "created_at": "2021-09-02T06:28:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ecc13bc7e360138323c258e917226ef673ff5b44](https://github.com/sagemath/sagetrac-mirror/commit/ecc13bc7e360138323c258e917226ef673ff5b44)" to "[4b260e0c802b8403ea8a7076a727350a0755f021](https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021)".



---

archive/issue_comments_165128.json:
```json
{
    "body": "**Changing commit** from \"[4b260e0c802b8403ea8a7076a727350a0755f021](https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021)\" to \"[9f7f45a936a153973cc9690e0d3cd0bfd261d816](https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816)\".",
    "created_at": "2021-09-02T06:29:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4b260e0c802b8403ea8a7076a727350a0755f021](https://github.com/sagemath/sagetrac-mirror/commit/4b260e0c802b8403ea8a7076a727350a0755f021)" to "[9f7f45a936a153973cc9690e0d3cd0bfd261d816](https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816)".



---

archive/issue_comments_165129.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816\">9f7f45a</a></td><td><code>FreeModuleElement.__deepcopy__: New</code></td></tr></table>\n",
    "created_at": "2021-09-02T06:29:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816">9f7f45a</a></td><td><code>FreeModuleElement.__deepcopy__: New</code></td></tr></table>




---

archive/issue_comments_165130.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [mkoeppe](#comment%3A30):\n> Missing in `sage.modules` is now only a `__deepcopy__` method for generic dense and sparse vectors.  Not sure if we may assume that ring elements are immutable (see #32450)...\n\nDone now in the same way as for `Sequence_generic`. In this ticket I'll not use new assumptions.",
    "created_at": "2021-09-02T06:31:49Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165130",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Replying to [mkoeppe](#comment%3A30):
> Missing in `sage.modules` is now only a `__deepcopy__` method for generic dense and sparse vectors.  Not sure if we may assume that ring elements are immutable (see #32450)...

Done now in the same way as for `Sequence_generic`. In this ticket I'll not use new assumptions.



---

archive/issue_comments_165131.json:
```json
{
    "body": "**Changing commit** from \"[9f7f45a936a153973cc9690e0d3cd0bfd261d816](https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816)\" to \"[2bd01ae26f1447cfc35d2fc1901413baab43819d](https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d)\".",
    "created_at": "2021-09-02T06:40:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9f7f45a936a153973cc9690e0d3cd0bfd261d816](https://github.com/sagemath/sagetrac-mirror/commit/9f7f45a936a153973cc9690e0d3cd0bfd261d816)" to "[2bd01ae26f1447cfc35d2fc1901413baab43819d](https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d)".



---

archive/issue_comments_165132.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcc7e8939fde97a6ca66477084d48026c693c289\">fcc7e89</a></td><td><code>RealNumber.__deepcopy__: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5553742e013818b2642737588faaa70d292f5913\">5553742</a></td><td><code>RealDoubleElement.__deepcopy__: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d\">2bd01ae</a></td><td><code>MPComplexNumber.__deepcopy__: New</code></td></tr></table>\n",
    "created_at": "2021-09-02T06:40:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcc7e8939fde97a6ca66477084d48026c693c289">fcc7e89</a></td><td><code>RealNumber.__deepcopy__: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5553742e013818b2642737588faaa70d292f5913">5553742</a></td><td><code>RealDoubleElement.__deepcopy__: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bd01ae26f1447cfc35d2fc1901413baab43819d">2bd01ae</a></td><td><code>MPComplexNumber.__deepcopy__: New</code></td></tr></table>




---

archive/issue_comments_165133.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -20,6 +20,6 @@\n      ValueError: Cannot pickle code objects from closures\n   ```\n \n-The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? \n+The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.\n \n \n``````\n",
    "created_at": "2021-09-02T06:42:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165133",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -20,6 +20,6 @@
      ValueError: Cannot pickle code objects from closures
   ```
 
-The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? 
+The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.
 
 
``````




---

archive/issue_comments_165134.json:
```json
{
    "body": "<a id='comment:43'></a>\nObviously a lot of the added trivial `__copy__` and `__deepcopy__` methods could be replaced by using a mixin class; but I am not sure what it would be called or if it would be better in terms of the clarity of the code.",
    "created_at": "2021-09-02T06:44:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165134",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Obviously a lot of the added trivial `__copy__` and `__deepcopy__` methods could be replaced by using a mixin class; but I am not sure what it would be called or if it would be better in terms of the clarity of the code.



---

archive/issue_comments_165135.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [mkoeppe](#comment%3A43):\n> Obviously a lot of the added trivial `__copy__` and `__deepcopy__` methods could be replaced by using a mixin class; but I am not sure what it would be called or if it would be better in terms of the clarity of the code.\n\nA number of them we probably wouldn't want for the very low level classes as `cdef` classes don't allow for multiple inheritance. This might mitigate some of the utility of a mixin class.",
    "created_at": "2021-09-02T12:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165135",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>
Replying to [mkoeppe](#comment%3A43):
> Obviously a lot of the added trivial `__copy__` and `__deepcopy__` methods could be replaced by using a mixin class; but I am not sure what it would be called or if it would be better in terms of the clarity of the code.

A number of them we probably wouldn't want for the very low level classes as `cdef` classes don't allow for multiple inheritance. This might mitigate some of the utility of a mixin class.



---

archive/issue_comments_165136.json:
```json
{
    "body": "<a id='comment:45'></a>\nThere are some doctest failures now from bad code like this in `src/sage/geometry/cone.py`:\n\n```\n                    # rays has immutable elements\n                    rays = [copy(ray) for ray in rays]\n\n                    for i, ray in enumerate(rays):\n                        rays[i][0] = pm * (ray[0].abs() + 1)\n```",
    "created_at": "2021-09-02T16:10:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
There are some doctest failures now from bad code like this in `src/sage/geometry/cone.py`:

```
                    # rays has immutable elements
                    rays = [copy(ray) for ray in rays]

                    for i, ray in enumerate(rays):
                        rays[i][0] = pm * (ray[0].abs() + 1)
```



---

archive/issue_comments_165137.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,6 @@\n False\n ```\n \n-Related: #30387\n \n Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:\n \n@@ -22,4 +21,7 @@\n \n The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.\n \n+Related: \n+- #30387\n+- #32453 `__copy__` methods for all classes the define `copy` methods\n \n``````\n",
    "created_at": "2021-09-02T16:27:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165137",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,6 @@
 False
 ```
 
-Related: #30387
 
 Another symptom (from the original ticket description): Copying of (immutable!) `LazyFamily` objects only works for families that can be pickled:
 
@@ -22,4 +21,7 @@
 
 The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.
 
+Related: 
+- #30387
+- #32453 `__copy__` methods for all classes the define `copy` methods
 
``````




---

archive/issue_events_118479.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T16:27:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118479"
}
```



---

archive/issue_events_118480.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T16:27:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118480"
}
```



---

archive/issue_comments_165138.json:
```json
{
    "body": "<a id='comment:48'></a>\nFor the pattern in [comment:45](#comment%3A45), with #29101 (\"Refined protocol for `_element_constructor_  `\") we would generally be able to replace `copy(ray)` by `ray.parent()(ray, mutable=True, copy=True)`; but perhaps we should define a shorthand for that.\n- #32353 proposes new methods `mutable`, `immutable` for this\n- `src/sage/combinat/constellation.py` defines `.mutable_copy`\n- `src/sage/graphs/generic_graph.py` defines `GenericGraph.copy`, which has a parameter `immutable=None`:\n- some classes have `copy` methods with optional arguments that could be extended (see also #32453) to allow `ray.copy(mutable=True)` (proposed in https://groups.google.com/g/sage-devel/c/DNrbtItMVmQ/m/BbMwM-qeAQAJ)\n\nDecision time...",
    "created_at": "2021-09-02T16:43:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165138",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
For the pattern in [comment:45](#comment%3A45), with #29101 ("Refined protocol for `_element_constructor_  `") we would generally be able to replace `copy(ray)` by `ray.parent()(ray, mutable=True, copy=True)`; but perhaps we should define a shorthand for that.
- #32353 proposes new methods `mutable`, `immutable` for this
- `src/sage/combinat/constellation.py` defines `.mutable_copy`
- `src/sage/graphs/generic_graph.py` defines `GenericGraph.copy`, which has a parameter `immutable=None`:
- some classes have `copy` methods with optional arguments that could be extended (see also #32453) to allow `ray.copy(mutable=True)` (proposed in https://groups.google.com/g/sage-devel/c/DNrbtItMVmQ/m/BbMwM-qeAQAJ)

Decision time...



---

archive/issue_comments_165139.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [mkoeppe](#comment%3A45):\n> There are some doctest failures now from bad code like this in `src/sage/geometry/cone.py`:\n> \n> ```\n>                     # rays has immutable elements\n>                     rays = [copy(ray) for ray in rays]\n> \n>                     for i, ray in enumerate(rays):\n>                         rays[i][0] = pm * (ray[0].abs() + 1)\n> ```\n\nThis pattern -- expecting that `ray.__copy__` (and thus `copy(ray)`) make a mutable copy of an immutable object -- appears to come from a decision made many many years ago in Sage (#111, #6522, #15132, ...). This was probably a good idea at the time, but I think it is not compatible with current Python practices.",
    "created_at": "2021-09-02T17:13:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165139",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
Replying to [mkoeppe](#comment%3A45):
> There are some doctest failures now from bad code like this in `src/sage/geometry/cone.py`:
> 
> ```
>                     # rays has immutable elements
>                     rays = [copy(ray) for ray in rays]
> 
>                     for i, ray in enumerate(rays):
>                         rays[i][0] = pm * (ray[0].abs() + 1)
> ```

This pattern -- expecting that `ray.__copy__` (and thus `copy(ray)`) make a mutable copy of an immutable object -- appears to come from a decision made many many years ago in Sage (#111, #6522, #15132, ...). This was probably a good idea at the time, but I think it is not compatible with current Python practices.



---

archive/issue_comments_165140.json:
```json
{
    "body": "**Dependencies:** #32454",
    "created_at": "2021-09-02T17:27:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165140",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #32454



---

archive/issue_events_118481.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T17:29:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118481"
}
```



---

archive/issue_events_118482.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T17:29:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118482"
}
```



---

archive/issue_comments_165141.json:
```json
{
    "body": "<a id='comment:52'></a>\n> This pattern -- expecting that `ray.__copy__` (and thus `copy(ray)`) make a mutable copy of an immutable object -- appears to come from a decision made many many years ago in Sage (#111, #6522, #15132, ...). This was probably a good idea at the time, but I think it is not compatible with current Python practices.\n\nThat may indeed be the case.  As you say, at the time the goal was standardized *Sage* command structure, but if there is a more (modern) Pythonic way to handle this, #6522 alone shows how much gnashing of teeth surrounded some of these changes at the time, so more power to you as long as any syntax changes would be documented.  \n\nOne should also be sure that things which would \"naturally\" be seen as copyable are, but other than `Sequence` which I am not as familiar with, it seems like e.g. vectors can still be copied unless asked not to be, so seems fine to me.",
    "created_at": "2021-09-02T17:37:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165141",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:52'></a>
> This pattern -- expecting that `ray.__copy__` (and thus `copy(ray)`) make a mutable copy of an immutable object -- appears to come from a decision made many many years ago in Sage (#111, #6522, #15132, ...). This was probably a good idea at the time, but I think it is not compatible with current Python practices.

That may indeed be the case.  As you say, at the time the goal was standardized *Sage* command structure, but if there is a more (modern) Pythonic way to handle this, #6522 alone shows how much gnashing of teeth surrounded some of these changes at the time, so more power to you as long as any syntax changes would be documented.  

One should also be sure that things which would "naturally" be seen as copyable are, but other than `Sequence` which I am not as familiar with, it seems like e.g. vectors can still be copied unless asked not to be, so seems fine to me.



---

archive/issue_comments_165142.json:
```json
{
    "body": "<a id='comment:53'></a>\nRegarding the pair of methods `v.mutable()`, `v.immutable()` proposed in #32353: `v.immutable()` is clear, of course, and shorter than `v.copy(mutable=False)`.  But I think it is unclear what `v.mutable()` is supposed to be if `v` is already mutable. Does it return a copy? Then the method's name should say so that it is obvious to users / readers of the code that mutating the result is not only allowed but also safe.\nSo a pair `v.mutable_copy()`, `v.immutable_copy()` would be fine, although I'm not sure if it's much better than `v.copy(mutable=True)`, `v.copy(mutable=False)`",
    "created_at": "2021-09-03T07:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165142",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
Regarding the pair of methods `v.mutable()`, `v.immutable()` proposed in #32353: `v.immutable()` is clear, of course, and shorter than `v.copy(mutable=False)`.  But I think it is unclear what `v.mutable()` is supposed to be if `v` is already mutable. Does it return a copy? Then the method's name should say so that it is obvious to users / readers of the code that mutating the result is not only allowed but also safe.
So a pair `v.mutable_copy()`, `v.immutable_copy()` would be fine, although I'm not sure if it's much better than `v.copy(mutable=True)`, `v.copy(mutable=False)`



---

archive/issue_events_118483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-03T19:28:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "rename": {
        "from": "__copy__ and __deepcopy__ methods for all immutable Sage objects",
        "to": "Meta-ticket: __copy__ and __deepcopy__ methods for all immutable Sage objects"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118483"
}
```



---

archive/issue_comments_165143.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).\n \n ```\n-sage: copy(0) is 0\n+sage: a = 0\n+sage: copy(a) is a\n False\n ```\n \n@@ -21,7 +22,11 @@\n \n The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.\n \n-Related: \n+Tickets: \n+- #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n+- #32462 trivial `__copy__` and `__deepcopy__` methods for Family and Set\n+- #32453 `__copy__` methods for all classes that define `copy` methods\n+\n+Related:\n - #30387\n-- #32453 `__copy__` methods for all classes the define `copy` methods\n \n``````\n",
    "created_at": "2021-09-03T19:50:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165143",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
 Most Sage objects are immutable. Nevertheless, `copy` and `deepcopy` make copies (through pickling/unpickling) for them because we have not provided the classes with `__copy__` methods (which should just return the object) and `__deepcopy__` methods (which in many cases should just return the object).
 
 ```
-sage: copy(0) is 0
+sage: a = 0
+sage: copy(a) is a
 False
 ```
 
@@ -21,7 +22,11 @@
 
 The case of `__deepcopy__` of immutable container-like objects (like `Family` or `Sequence`) is a bit trickier: Is immutability intended to imply that the elements are immutable too? In this ticket, we make no such assumption.
 
-Related: 
+Tickets: 
+- #32454 trivial `__copy__` and `__deepcopy__` methods for number types
+- #32462 trivial `__copy__` and `__deepcopy__` methods for Family and Set
+- #32453 `__copy__` methods for all classes that define `copy` methods
+
+Related:
 - #30387
-- #32453 `__copy__` methods for all classes the define `copy` methods
 
``````




---

archive/issue_comments_165144.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,7 +24,7 @@\n \n Tickets: \n - #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n-- #32462 trivial `__copy__` and `__deepcopy__` methods for Family and Set\n+- #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n - #32453 `__copy__` methods for all classes that define `copy` methods\n \n Related:\n``````\n",
    "created_at": "2021-09-03T19:51:22Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165144",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,7 +24,7 @@
 
 Tickets: 
 - #32454 trivial `__copy__` and `__deepcopy__` methods for number types
-- #32462 trivial `__copy__` and `__deepcopy__` methods for Family and Set
+- #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
 - #32453 `__copy__` methods for all classes that define `copy` methods
 
 Related:
``````




---

archive/issue_comments_165145.json:
```json
{
    "body": "<a id='comment:57'></a>\nSome more data points on other libraries:\n- numpy's `ndarray`s (and subclasses) have a `copy` method with an optional parameter that controls the memory layout of the copy; the `__copy__` method is equivalent to one of these choices.\n- sympy defines `copy` methods but no `deepcopy`, `__copy__`, or `__deepcopy__` methods",
    "created_at": "2021-09-04T02:09:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165145",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
Some more data points on other libraries:
- numpy's `ndarray`s (and subclasses) have a `copy` method with an optional parameter that controls the memory layout of the copy; the `__copy__` method is equivalent to one of these choices.
- sympy defines `copy` methods but no `deepcopy`, `__copy__`, or `__deepcopy__` methods



---

archive/issue_comments_165146.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,6 +26,7 @@\n - #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n - #32453 `__copy__` methods for all classes that define `copy` methods\n+- #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods\n \n Related:\n - #30387\n``````\n",
    "created_at": "2021-09-05T18:29:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165146",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,6 +26,7 @@
 - #32454 trivial `__copy__` and `__deepcopy__` methods for number types
 - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
 - #32453 `__copy__` methods for all classes that define `copy` methods
+- #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods
 
 Related:
 - #30387
``````




---

archive/issue_comments_165147.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,6 +24,7 @@\n \n Tickets: \n - #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n+- #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements\n - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n - #32453 `__copy__` methods for all classes that define `copy` methods\n - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods\n``````\n",
    "created_at": "2021-09-05T23:07:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165147",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,6 +24,7 @@
 
 Tickets: 
 - #32454 trivial `__copy__` and `__deepcopy__` methods for number types
+- #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements
 - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
 - #32453 `__copy__` methods for all classes that define `copy` methods
 - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods
``````




---

archive/issue_comments_165148.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,6 +25,7 @@\n Tickets: \n - #32454 trivial `__copy__` and `__deepcopy__` methods for number types\n - #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements\n+- #32480 trivial `__copy__` and `__deepcopy__` methods for symbolic expressions and functions\n - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n - #32453 `__copy__` methods for all classes that define `copy` methods\n - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods\n``````\n",
    "created_at": "2021-09-06T03:37:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165148",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,6 +25,7 @@
 Tickets: 
 - #32454 trivial `__copy__` and `__deepcopy__` methods for number types
 - #32478 trivial `__copy__` and `__deepcopy__` methods for number field elements
+- #32480 trivial `__copy__` and `__deepcopy__` methods for symbolic expressions and functions
 - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
 - #32453 `__copy__` methods for all classes that define `copy` methods
 - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods
``````




---

archive/issue_comments_165149.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -29,7 +29,8 @@\n - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`\n - #32453 `__copy__` methods for all classes that define `copy` methods\n - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods\n-\n+- #23075 `copy(CombinatorialFreeModule.Element)` broken by #22632\n+- #5417 Fix some more deepcopy/caching issues in the quadratic forms code\n Related:\n - #30387\n \n``````\n",
    "created_at": "2021-09-06T05:58:46Z",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13811#issuecomment-165149",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -29,7 +29,8 @@
 - #32462 trivial `__copy__` and `__deepcopy__` methods for `Family` and `Set`
 - #32453 `__copy__` methods for all classes that define `copy` methods
 - #32476 `sage.tensor`, `sage.manifolds`: `__copy__`, `__deepcopy__` methods for all classes that define `copy` methods
-
+- #23075 `copy(CombinatorialFreeModule.Element)` broken by #22632
+- #5417 Fix some more deepcopy/caching issues in the quadratic forms code
 Related:
 - #30387
 
``````




---

archive/issue_events_118484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-06T21:02:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "rename": {
        "from": "Meta-ticket: __copy__ and __deepcopy__ methods for all immutable Sage objects",
        "to": "Meta-ticket: Support Python's __copy__ / __deepcopy__ protocol"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118484"
}
```



---

archive/issue_events_118485.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118485"
}
```



---

archive/issue_events_118486.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118486"
}
```



---

archive/issue_events_118487.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118487"
}
```



---

archive/issue_events_118488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118488"
}
```



---

archive/issue_events_118489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118489"
}
```



---

archive/issue_events_118490.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13811",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13811#event-118490"
}
```
