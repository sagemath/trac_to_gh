# Issue 13415: Prevent unneeded rebuilding when upgrading

archive/issues_013243.json:
```json
{
    "body": "Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.\n\nAn update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n\nWe should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n\n**Apply** to the SAGE_ROOT repository:\n1. [attachment:13415_separate_base_deps_auto.patch] -- automatically generated by\n\n```\nsed -i 's| *\\$(BASE)||; s| *\\$(INST)/\\$(PATCH)||' spkg/standard/deps\n```\n1. [attachment:13415_separate_base_deps_2.patch]\n\n**Assignee:** GeorgSWeber\n\n**CC:**  @jhpalmieri\n\n**Reviewer:** John Palmieri\n\n**Author:** Jeroen Demeyer\n\n**Merged:** sage-5.4.beta2\n\n**Dependencies:** #13395, #13392, #13416, #12994, #9906, #12883, #13123\n\nIssue created by migration from https://trac.sagemath.org/ticket/13415\n\n",
    "closed_at": "2012-09-19T06:34:54Z",
    "created_at": "2012-08-31T10:19:23Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Prevent unneeded rebuilding when upgrading",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13415",
    "user": "https://github.com/jdemeyer"
}
```
Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.

An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).

We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.

**Apply** to the SAGE_ROOT repository:
1. [attachment:13415_separate_base_deps_auto.patch] -- automatically generated by

```
sed -i 's| *\$(BASE)||; s| *\$(INST)/\$(PATCH)||' spkg/standard/deps
```
1. [attachment:13415_separate_base_deps_2.patch]

**Assignee:** GeorgSWeber

**CC:**  @jhpalmieri

**Reviewer:** John Palmieri

**Author:** Jeroen Demeyer

**Merged:** sage-5.4.beta2

**Dependencies:** #13395, #13392, #13416, #12994, #9906, #12883, #13123

Issue created by migration from https://trac.sagemath.org/ticket/13415





---

archive/issue_comments_158667.json:
```json
{
    "body": "**Changing dependencies** from \"#13395\" to \"#13395, #13392\".",
    "created_at": "2012-08-31T12:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158667",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395" to "#13395, #13392".



---

archive/issue_comments_158668.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.\n \n-An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking when install the new prereq and therefore rebuild everything).\n+An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n \n We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n``````\n",
    "created_at": "2012-08-31T13:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158668",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.
 
-An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking when install the new prereq and therefore rebuild everything).
+An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).
 
 We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.
``````




---

archive/issue_comments_158669.json:
```json
{
    "body": "**Changing dependencies** from \"#13395, #13392\" to \"#13395, #13392, #13416\".",
    "created_at": "2012-08-31T13:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158669",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395, #13392" to "#13395, #13392, #13416".



---

archive/issue_comments_158670.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2012-08-31T13:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158670",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_158671.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,11 @@\n An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n \n We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n+\n+**Apply** to the SAGE_ROOT repository:\n+1. [attachment:13415_separate_base_deps_auto.patch] -- automatically generated by\n+\n+```\n+sed -i 's| *\\$(BASE)||; s| *\\$(INST)/\\$(PATCH)||' spkg/standard/deps\n+```\n+1. [attachment:13415_separate_base_deps_2.patch]\n``````\n",
    "created_at": "2012-09-04T08:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158671",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,11 @@
 An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).
 
 We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.
+
+**Apply** to the SAGE_ROOT repository:
+1. [attachment:13415_separate_base_deps_auto.patch] -- automatically generated by
+
+```
+sed -i 's| *\$(BASE)||; s| *\$(INST)/\$(PATCH)||' spkg/standard/deps
+```
+1. [attachment:13415_separate_base_deps_2.patch]
``````




---

archive/issue_comments_158672.json:
```json
{
    "body": "**Changing dependencies** from \"#13395, #13392, #13416\" to \"#13395, #13392, #13416, #12994\".",
    "created_at": "2012-09-04T09:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158672",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395, #13392, #13416" to "#13395, #13392, #13416, #12994".



---

archive/issue_comments_158673.json:
```json
{
    "body": "**Changing dependencies** from \"#13395, #13392, #13416, #12994\" to \"#13395, #13392, #13416, #12994, #9906\".",
    "created_at": "2012-09-04T10:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158673",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395, #13392, #13416, #12994" to "#13395, #13392, #13416, #12994, #9906".



---

archive/issue_comments_158674.json:
```json
{
    "body": "<a id='comment:8'></a>\nJohn, do you agree in principle with these patches?  They are sort-of ready, but I still have to test things properly (including upgrading).",
    "created_at": "2012-09-04T11:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158674",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
John, do you agree in principle with these patches?  They are sort-of ready, but I still have to test things properly (including upgrading).



---

archive/issue_comments_158675.json:
```json
{
    "body": "<a id='comment:9'></a>\nI've only given the patches a quick look, but this looks like a good idea (especially after trying an update recently which updated prereq).",
    "created_at": "2012-09-04T21:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158675",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
I've only given the patches a quick look, but this looks like a good idea (especially after trying an update recently which updated prereq).



---

archive/issue_comments_158676.json:
```json
{
    "body": "**Changing dependencies** from \"#13395, #13392, #13416, #12994, #9906\" to \"#13395, #13392, #13416, #12994, #9906, #12883\".",
    "created_at": "2012-09-11T11:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158676",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395, #13392, #13416, #12994, #9906" to "#13395, #13392, #13416, #12994, #9906, #12883".



---

archive/issue_comments_158677.json:
```json
{
    "body": "**Changing dependencies** from \"#13395, #13392, #13416, #12994, #9906, #12883\" to \"#13395, #13392, #13416, #12994, #9906, #12883, #13123\".",
    "created_at": "2012-09-13T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158677",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13395, #13392, #13416, #12994, #9906, #12883" to "#13395, #13392, #13416, #12994, #9906, #12883, #13123".



---

archive/attachments_018201.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13415_separate_base_deps_2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13415/13415_separate_base_deps_2.patch",
    "created_at": "2012-09-13T17:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_158678.json:
```json
{
    "body": "",
    "created_at": "2012-09-13T17:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158678",
    "user": "https://github.com/jdemeyer"
}
```





---

archive/issue_events_114146.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-16T17:42:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13415#event-114146"
}
```



---

archive/attachments_018202.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13415_separate_base_deps_auto.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13415/13415_separate_base_deps_auto.patch",
    "created_at": "2012-09-18T06:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_158679.json:
```json
{
    "body": "<a id='comment:13'></a>\nJohn, any chance you could formally review this?  I have tested this many times on the buildbot (together with other tickets) and it seems to work fine.",
    "created_at": "2012-09-18T06:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158679",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
John, any chance you could formally review this?  I have tested this many times on the buildbot (together with other tickets) and it seems to work fine.



---

archive/issue_comments_158680.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis will conflict (not much) with the changes at #10508, which basically has positive review...",
    "created_at": "2012-09-19T01:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158680",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
This will conflict (not much) with the changes at #10508, which basically has positive review...



---

archive/issue_comments_158681.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2012-09-19T05:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158681",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_158682.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis looks okay to me. I think the conflicts will be easy to resolve.",
    "created_at": "2012-09-19T05:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158682",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
This looks okay to me. I think the conflicts will be easy to resolve.



---

archive/issue_events_114147.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-09-19T05:19:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13415#event-114147"
}
```



---

archive/issue_events_114148.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-09-19T05:19:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13415#event-114148"
}
```



---

archive/issue_comments_158683.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jhpalmieri](#comment%3A15):\n> This looks okay to me. I think the conflicts will be easy to resolve.\n\nIndeed, it's just a matter of regenerating the auto-generated patch.",
    "created_at": "2012-09-19T06:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158683",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [jhpalmieri](#comment%3A15):
> This looks okay to me. I think the conflicts will be easy to resolve.

Indeed, it's just a matter of regenerating the auto-generated patch.



---

archive/issue_comments_158684.json:
```json
{
    "body": "<a id='comment:17'></a>\nMany thanks for the review!",
    "created_at": "2012-09-19T06:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158684",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Many thanks for the review!



---

archive/issue_events_114149.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:34:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13415#event-114149"
}
```



---

archive/issue_events_114150.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:34:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13415#event-114150"
}
```



---

archive/issue_comments_158685.json:
```json
{
    "body": "**Merged:** sage-5.4.beta2",
    "created_at": "2012-09-19T06:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13415#issuecomment-158685",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.4.beta2
