# Issue 13415: Prevent unneeded rebuilding when upgrading

archive/issues_013243.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.\n\nAn update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n\nWe should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n\n**Apply** to the SAGE_ROOT repository:\n1. [attachment: 13415_separate_base_deps_auto.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz) -- automatically generated by\n\n```\nsed -i 's| *\\$(BASE)||; s| *\\$(INST)/\\$(PATCH)||' spkg/standard/deps\n```\n1. [attachment: 13415_separate_base_deps_2.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)\n\nDepends on #13395\nDepends on #13392\nDepends on #13416\nDepends on #12994\nDepends on #9906\nDepends on #12883\nDepends on #13123\n\nCC:  @jhpalmieri\n\nComponent: **build**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-5.4.beta2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13415_\n\n",
    "closed_at": "2012-09-19T06:34:54Z",
    "created_at": "2012-08-31T10:19:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Prevent unneeded rebuilding when upgrading",
    "type": "issue",
    "updated_at": "2012-09-19T06:34:54Z",
    "url": "https://github.com/sagemath/sage/issues/13415",
    "user": "https://github.com/jdemeyer"
}
```
Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.

An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).

We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.

**Apply** to the SAGE_ROOT repository:
1. [attachment: 13415_separate_base_deps_auto.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz) -- automatically generated by

```
sed -i 's| *\$(BASE)||; s| *\$(INST)/\$(PATCH)||' spkg/standard/deps
```
1. [attachment: 13415_separate_base_deps_2.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)

Depends on #13395
Depends on #13392
Depends on #13416
Depends on #12994
Depends on #9906
Depends on #12883
Depends on #13123

CC:  @jhpalmieri

Component: **build**

Author: **Jeroen Demeyer**

Reviewer: **John Palmieri**

Merged: **sage-5.4.beta2**

_Issue created by migration from https://trac.sagemath.org/ticket/13415_





---

archive/issue_events_185616.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-31T10:19:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185616"
}
```



---

archive/issue_events_185617.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-31T10:19:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185617"
}
```



---

archive/issue_events_185618.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-31T10:19:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185618"
}
```



---

archive/issue_events_185619.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-31T10:19:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185619"
}
```



---

archive/issue_events_185620.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-08-31T10:19:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185620"
}
```



---

archive/issue_comments_156361.json:
```json
{
    "body": "Changed dependencies from **#13395** to **#13395, #13392**",
    "created_at": "2012-08-31T12:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156361",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395** to **#13395, #13392**



---

archive/issue_comments_156362.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.\n \n-An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking when install the new prereq and therefore rebuild everything).\n+An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n \n We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n``````\n",
    "created_at": "2012-08-31T13:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156362",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Since (almost) every package depends on `patch` and `bzip2`, an update of either of these packages causes a rebuild of everything when upgrading.
 
-An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking when install the new prereq and therefore rebuild everything).
+An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).
 
 We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.
``````




---

archive/issue_comments_156363.json:
```json
{
    "body": "Changed dependencies from **#13395, #13392** to **#13395, #13392, #13416**",
    "created_at": "2012-08-31T13:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156363",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395, #13392** to **#13395, #13392, #13416**



---

archive/issue_comments_156364.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2012-08-31T13:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156364",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_156365.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,11 @@\n An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).\n \n We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.\n+\n+**Apply** to the SAGE_ROOT repository:\n+1. [attachment: 13415_separate_base_deps_auto.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz) -- automatically generated by\n+\n+```\n+sed -i 's| *\\$(BASE)||; s| *\\$(INST)/\\$(PATCH)||' spkg/standard/deps\n+```\n+1. [attachment: 13415_separate_base_deps_2.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)\n``````\n",
    "created_at": "2012-09-04T08:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156365",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,11 @@
 An update of `prereq` even causes everything to be built twice(!) when upgrading (the new prereq script is only seen after the new root repo is installed, so the second `sage-upgrade` run for double-checking will install the new `prereq` and therefore rebuild everything).
 
 We should simply remove dependencies of packages on `PREREQ`, `BZIP2` and `PATCH` and build those packages separately.
+
+**Apply** to the SAGE_ROOT repository:
+1. [attachment: 13415_separate_base_deps_auto.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz) -- automatically generated by
+
+```
+sed -i 's| *\$(BASE)||; s| *\$(INST)/\$(PATCH)||' spkg/standard/deps
+```
+1. [attachment: 13415_separate_base_deps_2.patch](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)
``````




---

archive/issue_comments_156366.json:
```json
{
    "body": "Changed dependencies from **#13395, #13392, #13416** to **#13395, #13392, #13416, #12994**",
    "created_at": "2012-09-04T09:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156366",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395, #13392, #13416** to **#13395, #13392, #13416, #12994**



---

archive/issue_comments_156367.json:
```json
{
    "body": "Changed dependencies from **#13395, #13392, #13416, #12994** to **#13395, #13392, #13416, #12994, #9906**",
    "created_at": "2012-09-04T10:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156367",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395, #13392, #13416, #12994** to **#13395, #13392, #13416, #12994, #9906**



---

archive/issue_comments_156368.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nJohn, do you agree in principle with these patches?  They are sort-of ready, but I still have to test things properly (including upgrading).",
    "created_at": "2012-09-04T11:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156368",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

John, do you agree in principle with these patches?  They are sort-of ready, but I still have to test things properly (including upgrading).



---

archive/issue_comments_156369.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI've only given the patches a quick look, but this looks like a good idea (especially after trying an update recently which updated prereq).",
    "created_at": "2012-09-04T21:34:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156369",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

I've only given the patches a quick look, but this looks like a good idea (especially after trying an update recently which updated prereq).



---

archive/issue_comments_156370.json:
```json
{
    "body": "Changed dependencies from **#13395, #13392, #13416, #12994, #9906** to **#13395, #13392, #13416, #12994, #9906, #12883**",
    "created_at": "2012-09-11T11:42:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156370",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395, #13392, #13416, #12994, #9906** to **#13395, #13392, #13416, #12994, #9906, #12883**



---

archive/issue_comments_156371.json:
```json
{
    "body": "Changed dependencies from **#13395, #13392, #13416, #12994, #9906, #12883** to **#13395, #13392, #13416, #12994, #9906, #12883, #13123**",
    "created_at": "2012-09-13T09:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156371",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13395, #13392, #13416, #12994, #9906, #12883** to **#13395, #13392, #13416, #12994, #9906, #12883, #13123**



---

archive/issue_comments_156372.json:
```json
{
    "body": "Attachment: **[13415_separate_base_deps_2.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)**",
    "created_at": "2012-09-13T17:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156372",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[13415_separate_base_deps_2.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_2.patch.gz)**



---

archive/issue_events_185621.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-16T17:42:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185621"
}
```



---

archive/issue_comments_156373.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[13415_separate_base_deps_auto.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz)**\n\nJohn, any chance you could formally review this?  I have tested this many times on the buildbot (together with other tickets) and it seems to work fine.",
    "created_at": "2012-09-18T06:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156373",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[13415_separate_base_deps_auto.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto.patch.gz)**

John, any chance you could formally review this?  I have tested this many times on the buildbot (together with other tickets) and it seems to work fine.



---

archive/issue_comments_156374.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis will conflict (not much) with the changes at #10508, which basically has positive review...",
    "created_at": "2012-09-19T01:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156374",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:14" align="right">comment:14</div>

This will conflict (not much) with the changes at #10508, which basically has positive review...



---

archive/issue_comments_156375.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2012-09-19T05:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156375",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_156376.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis looks okay to me. I think the conflicts will be easy to resolve.",
    "created_at": "2012-09-19T05:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156376",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

This looks okay to me. I think the conflicts will be easy to resolve.



---

archive/issue_events_185622.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-09-19T05:19:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185622"
}
```



---

archive/issue_events_185623.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-09-19T05:19:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185623"
}
```



---

archive/issue_comments_156377.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jhpalmieri](#comment%3A15):\n> This looks okay to me. I think the conflicts will be easy to resolve.\n\nIndeed, it's just a matter of regenerating the auto-generated patch.",
    "created_at": "2012-09-19T06:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156377",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jhpalmieri](#comment%3A15):
> This looks okay to me. I think the conflicts will be easy to resolve.

Indeed, it's just a matter of regenerating the auto-generated patch.



---

archive/issue_comments_156378.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nMany thanks for the review!",
    "created_at": "2012-09-19T06:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156378",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Many thanks for the review!



---

archive/issue_events_185624.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:34:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185624"
}
```



---

archive/issue_events_185625.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:34:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13415#event-185625"
}
```



---

archive/issue_comments_156379.json:
```json
{
    "body": "Merged: **sage-5.4.beta2**",
    "created_at": "2012-09-19T06:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156379",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.4.beta2**



---

archive/issue_comments_156380.json:
```json
{
    "body": "Attachment: **[13415_separate_base_deps_auto_without_12883.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto_without_12883.patch.gz)**",
    "created_at": "2012-10-08T13:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13415#issuecomment-156380",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[13415_separate_base_deps_auto_without_12883.patch.gz](https://github.com/sagemath/sage/files/ticket13415/13415_separate_base_deps_auto_without_12883.patch.gz)**
