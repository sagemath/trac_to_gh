# Issue 13189: Report startuptime exclusive children

archive/issues_013189.json:
```json
{
    "body": "Assignee: tbd\n\nRight now `sage -startuptime` reports startup time including children. This isn't particularly useful since that just means that the first module (which loads most of sage as dependencies) is the slowest. The more meaningful number is exclusive children, which can tell us if the module does computations during initialization.\n\n* Apply [attachment:trac_13361_startuptime.patch] to the scripts (`SAGE_LOCAL/bin`) repository.\n* Apply [attachment:trac_13361_startuptime_args.patch] and [attachment:trac_13361-root-referee.patch] to the root repository.\n* Apply [attachment:trac_13361_fix_test.patch] and [attachment:trac_13361-sagelib-referee.patch] to the Sage library\n\nIssue created by migration from https://trac.sagemath.org/ticket/13361\n\n",
    "closed_at": "2012-09-23T16:22:10Z",
    "created_at": "2012-08-12T17:34:03Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Report startuptime exclusive children",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13189",
    "user": "https://github.com/vbraun"
}
```
Assignee: tbd

Right now `sage -startuptime` reports startup time including children. This isn't particularly useful since that just means that the first module (which loads most of sage as dependencies) is the slowest. The more meaningful number is exclusive children, which can tell us if the module does computations during initialization.

* Apply [attachment:trac_13361_startuptime.patch] to the scripts (`SAGE_LOCAL/bin`) repository.
* Apply [attachment:trac_13361_startuptime_args.patch] and [attachment:trac_13361-root-referee.patch] to the root repository.
* Apply [attachment:trac_13361_fix_test.patch] and [attachment:trac_13361-sagelib-referee.patch] to the Sage library

Issue created by migration from https://trac.sagemath.org/ticket/13361





---

archive/issue_comments_160789.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-08-12T17:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160789",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_160790.json:
```json
{
    "body": "Attachment [trac_12883_startuptime.patch](tarball://root/attachments/some-uuid/ticket13361/trac_12883_startuptime.patch) by @vbraun created at 2012-08-12 17:36:34",
    "created_at": "2012-08-12T17:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160790",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_12883_startuptime.patch](tarball://root/attachments/some-uuid/ticket13361/trac_12883_startuptime.patch) by @vbraun created at 2012-08-12 17:36:34



---

archive/issue_comments_160791.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-08-12T17:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160791",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160792.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-08-13T00:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160792",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_160793.json:
```json
{
    "body": "Attachment [trac_13361_startuptime_args.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_startuptime_args.patch) by @vbraun created at 2012-08-13 00:45:45\n\nNow with disabled garbage collector (it did skew timings) and with optional argument a module that you want to know more about:\n\n```\n[vbraun@laptop sage]$ sage -startuptime sage.geometry.fan\n\n========================================================================\n## Slowest modules importing sage.geometry.fan\nexclude/ms include/ms   #parents  module name\n     0.115     51.405          3  sage.geometry.all\n     0.224      0.246          1  sage.schemes.toric.library\n     0.332      0.398          1  sage.geometry.triangulation.fan_refinement\n     0.383      0.471          2  sage.geometry.fan_morphism\n     0.560      0.782          3  sage.schemes.toric.variety\n\n## Slowest modules imported by sage.geometry.fan\nexclude/ms include/ms   #parents  module name\n     0.533      2.509         19  collections\n     0.607     67.336          5  sage.combinat.posets.posets\n     0.631    140.774         51  sage.misc.all\n     0.734     49.422          5  sage.geometry.cone\n     0.772      2.777          4  sage.geometry.lattice_polytope\n     1.121      1.124        175  sage.misc.abstract_method\n     1.247      1.247        180  sage.misc.lazy_attribute\n     1.304     65.086        230  sage.rings.all\n     1.332      1.332         63  copy\n     3.837      5.491        218  sage.misc.sageinspect\n\n## module sage.geometry.fan\nTime to import:  0.751ms\nCumulative time: 0.823ms\nNames: fan, sage.geometry.fan\n```",
    "created_at": "2012-08-13T00:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160793",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13361_startuptime_args.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_startuptime_args.patch) by @vbraun created at 2012-08-13 00:45:45

Now with disabled garbage collector (it did skew timings) and with optional argument a module that you want to know more about:

```
[vbraun@laptop sage]$ sage -startuptime sage.geometry.fan

========================================================================
## Slowest modules importing sage.geometry.fan
exclude/ms include/ms   #parents  module name
     0.115     51.405          3  sage.geometry.all
     0.224      0.246          1  sage.schemes.toric.library
     0.332      0.398          1  sage.geometry.triangulation.fan_refinement
     0.383      0.471          2  sage.geometry.fan_morphism
     0.560      0.782          3  sage.schemes.toric.variety

## Slowest modules imported by sage.geometry.fan
exclude/ms include/ms   #parents  module name
     0.533      2.509         19  collections
     0.607     67.336          5  sage.combinat.posets.posets
     0.631    140.774         51  sage.misc.all
     0.734     49.422          5  sage.geometry.cone
     0.772      2.777          4  sage.geometry.lattice_polytope
     1.121      1.124        175  sage.misc.abstract_method
     1.247      1.247        180  sage.misc.lazy_attribute
     1.304     65.086        230  sage.rings.all
     1.332      1.332         63  copy
     3.837      5.491        218  sage.misc.sageinspect

## module sage.geometry.fan
Time to import:  0.751ms
Cumulative time: 0.823ms
Names: fan, sage.geometry.fan
```



---

archive/issue_comments_160794.json:
```json
{
    "body": "Attachment [trac_13361_startuptime.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_startuptime.patch) by @vbraun created at 2012-08-13 16:42:21\n\nImproved patch",
    "created_at": "2012-08-13T16:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160794",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13361_startuptime.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_startuptime.patch) by @vbraun created at 2012-08-13 16:42:21

Improved patch



---

archive/issue_comments_160795.json:
```json
{
    "body": "New patch has better handling of ambiguous command line argument and prints module file.",
    "created_at": "2012-08-13T16:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160795",
    "user": "https://github.com/vbraun"
}
```

New patch has better handling of ambiguous command line argument and prints module file.



---

archive/issue_comments_160796.json:
```json
{
    "body": "Attachment [trac_13361_fix_test.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_fix_test.patch) by @vbraun created at 2012-09-19 12:01:59\n\nInitial patch",
    "created_at": "2012-09-19T12:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160796",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13361_fix_test.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361_fix_test.patch) by @vbraun created at 2012-09-19 12:01:59

Initial patch



---

archive/issue_comments_160797.json:
```json
{
    "body": "Two questions:\n\n- would it be useful to be able to sort by times including children (keeping the default as is) by specifying a command-line argument? (I don't know the answer to this one.)\n\n- should the usage `sage --startuptime [modulename]` be documented in `sage --advanced` and in `devel/sage/doc/en/reference/options.rst`? (I think the answer to this one is \"yes\". See the attached referee patches.)",
    "created_at": "2012-09-19T17:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160797",
    "user": "https://github.com/jhpalmieri"
}
```

Two questions:

- would it be useful to be able to sort by times including children (keeping the default as is) by specifying a command-line argument? (I don't know the answer to this one.)

- should the usage `sage --startuptime [modulename]` be documented in `sage --advanced` and in `devel/sage/doc/en/reference/options.rst`? (I think the answer to this one is "yes". See the attached referee patches.)



---

archive/issue_comments_160798.json:
```json
{
    "body": "root repo: documentation",
    "created_at": "2012-09-19T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160798",
    "user": "https://github.com/jhpalmieri"
}
```

root repo: documentation



---

archive/issue_comments_160799.json:
```json
{
    "body": "Attachment [trac_13361-root-referee.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361-root-referee.patch) by @vbraun created at 2012-09-19 18:04:56\n\nI don't think there is much point in the inclusive startup time, that just tells you which library was imported first (and then pulled in a lot of sage modules for the first time). Thats why the old startuptime always showed a ridiculously long time for `sage.algebras.iwahori_hecke_algebra` despite this being a very lightweight module.\n\nThanks for the referee patches, they look great!",
    "created_at": "2012-09-19T18:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160799",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13361-root-referee.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361-root-referee.patch) by @vbraun created at 2012-09-19 18:04:56

I don't think there is much point in the inclusive startup time, that just tells you which library was imported first (and then pulled in a lot of sage modules for the first time). Thats why the old startuptime always showed a ridiculously long time for `sage.algebras.iwahori_hecke_algebra` despite this being a very lightweight module.

Thanks for the referee patches, they look great!



---

archive/issue_comments_160800.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-19T18:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160800",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160801.json:
```json
{
    "body": "Oops, we missed one thing: the test in tests/startup.py has to be rewritten to take into account the changed output of `sage --startuptime`. (This will only make a difference when testing on sage.math.)",
    "created_at": "2012-09-19T23:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160801",
    "user": "https://github.com/jhpalmieri"
}
```

Oops, we missed one thing: the test in tests/startup.py has to be rewritten to take into account the changed output of `sage --startuptime`. (This will only make a difference when testing on sage.math.)



---

archive/issue_comments_160802.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-09-19T23:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160802",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_160803.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-09-20T18:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160803",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_160804.json:
```json
{
    "body": "I've added to my referee's patch to fix the doctest in tests/startup.py. Also, now if the test fails, it prints how long `sage --startuptime` took, instead of just returning `False`.",
    "created_at": "2012-09-20T18:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160804",
    "user": "https://github.com/jhpalmieri"
}
```

I've added to my referee's patch to fix the doctest in tests/startup.py. Also, now if the test fails, it prints how long `sage --startuptime` took, instead of just returning `False`.



---

archive/issue_comments_160805.json:
```json
{
    "body": "Attachment [trac_13361-sagelib-referee.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361-sagelib-referee.patch) by @jhpalmieri created at 2012-09-20 18:18:42\n\nSage library: documentation and doctest fix",
    "created_at": "2012-09-20T18:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160805",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13361-sagelib-referee.patch](tarball://root/attachments/some-uuid/ticket13361/trac_13361-sagelib-referee.patch) by @jhpalmieri created at 2012-09-20 18:18:42

Sage library: documentation and doctest fix



---

archive/issue_comments_160806.json:
```json
{
    "body": "Hmm a hostname-dependent doctest ;-)\n\nThanks for the patch, looks good!",
    "created_at": "2012-09-20T18:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160806",
    "user": "https://github.com/vbraun"
}
```

Hmm a hostname-dependent doctest ;-)

Thanks for the patch, looks good!



---

archive/issue_comments_160807.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-20T18:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160807",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_037047.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-23T16:22:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13189#event-37047"
}
```



---

archive/issue_comments_160808.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-23T16:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13189",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13189#issuecomment-160808",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
