# Issue 13588: libGAP! -- create a Cython library interface to gap

archive/issues_013384.json:
```json
{
    "body": "Currently, libGAP doesn't give useful errors if something goes wrong during initialization.\n\nAlso, the GAP SIGINT handler got installed, this is fixed in the new spkg. Now Ctrl-C works as expected.\n\n* Start with sage-5.6.beta3 or later.\n* Install [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgap-4.5.7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgap-4.5.7.spkg)\n* Apply [attachment:13588_libGAP_root.patch] to the root repository\n* Apply [attachment:trac_6391_libGAP.patch] to the Sage library\n* Apply [attachment:trac_13588_improve_libGAP.patch] to the Sage library\n* Apply [attachment:trac_13588_exec_fix.patch] to the Sage library\n* Apply [attachment:trac_13588_manifest.patch] to the Sage library\n* Apply [attachment:trac_13588_docbuild.patch] to the Sage library\n\nThe `trac_6391_*` patch has already been reviewed at #6391.\n\nAssignee: joyner\n\nCC:  @miguelmarco tfeulner @gvol simonking\n\nReviewer: Dmitrii Pasechnik\n\nAuthor: Volker Braun\n\nMerged: sage-5.7.beta1\n\nDependencies: #13211, #13880\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13588\n\n",
    "closed_at": "2013-01-26T09:54:00Z",
    "created_at": "2012-10-08T21:03:45Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "libGAP! -- create a Cython library interface to gap",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13588",
    "user": "https://github.com/vbraun"
}
```
Currently, libGAP doesn't give useful errors if something goes wrong during initialization.

Also, the GAP SIGINT handler got installed, this is fixed in the new spkg. Now Ctrl-C works as expected.

* Start with sage-5.6.beta3 or later.
* Install [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgap-4.5.7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgap-4.5.7.spkg)
* Apply [attachment:13588_libGAP_root.patch] to the root repository
* Apply [attachment:trac_6391_libGAP.patch] to the Sage library
* Apply [attachment:trac_13588_improve_libGAP.patch] to the Sage library
* Apply [attachment:trac_13588_exec_fix.patch] to the Sage library
* Apply [attachment:trac_13588_manifest.patch] to the Sage library
* Apply [attachment:trac_13588_docbuild.patch] to the Sage library

The `trac_6391_*` patch has already been reviewed at #6391.

Assignee: joyner

CC:  @miguelmarco tfeulner @gvol simonking

Reviewer: Dmitrii Pasechnik

Author: Volker Braun

Merged: sage-5.7.beta1

Dependencies: #13211, #13880

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13588





---

archive/issue_comments_164406.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-09T10:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164406",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164407.json:
```json
{
    "body": "<a id='comment:1'></a>Miguel, you said that you had some mysterious error. Can you try this patch? It depends on the recently-updated patches on #6391, #13211.",
    "created_at": "2012-10-09T10:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164407",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Miguel, you said that you had some mysterious error. Can you try this patch? It depends on the recently-updated patches on #6391, #13211.



---

archive/issue_comments_164408.json:
```json
{
    "body": "<a id='comment:2'></a>I have been checking the different updates of libgap, and the error seemed to go away several versions ago. Anyways, i will keep testing it.",
    "created_at": "2012-10-09T11:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164408",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:2'></a>I have been checking the different updates of libgap, and the error seemed to go away several versions ago. Anyways, i will keep testing it.



---

archive/issue_comments_164409.json:
```json
{
    "body": "<a id='comment:3'></a>I don't know if it is an issue related with this patch or if it comes from libgap itself, but i have experienced some problems when i use tab completion in a session in the command line (i haven't checked it in the notebook).\n\nAn example:\n\n```\nsage: F=libgap.eval('FreeGroup(2)')\nsage: (a,b)=F.GeneratorsOfGroup()\nsage: H=F/libgap([a^2,b^2,a*b*a*b])\nsage: H\n<fp group on the generators [ f1, f2 ]>\nsage: H.IsomorphismSimplifiedFpGroup()\n[ f1, f2 ] -> [ f1, f2 ]\nsage: H=F/libgap([a^2,b^2,a*b])    \nsage: c=H.Gene\nH.GeneralLinearGroup      H.GeneralisedEigenspaces  H.GeneralizedEigenvalues  H.GeneratorsOfIdeal\nH.GeneralOrthogonalGroup  H.GeneralisedEigenvalues  H.GeneratorsOfField       \nH.GeneralUnitaryGroup     H.GeneralizedEigenspaces  H.GeneratorsOfGroup       \nsage: c=H.GeneratorsOfGroup()[0]\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()\n\nAttributeError: Name \"GeneratorsOfGroup\" is not defined in GAP.\nsage: c=H.GeneratorsOfGroup()   \n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()\n\nAttributeError: Name \"GeneratorsOfGroup\" is not defined in GAP.\nsage: H\nException RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored\n<fp group on the generators [ f1, f2 ]>\nsage: H.GeneratorsOfGroup()\n[ f1, f2 ]\nsage: c=H.GeneratorsOfGroup()[0]\nsage: c\nf1\nsage: c=H.Generat\nH.GeneratorsOfField  H.GeneratorsOfGroup  H.GeneratorsOfIdeal  \nsage: c=H.GeneratorsOfGroup()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()\n\nAttributeError: Name \"GeneratorsOfGroup\" is not defined in GAP.\nsage: c=H.GeneratorsOfGroup()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/mmarco/sage-5.4/<ipython console> in <module>()\n\n/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()\n\nAttributeError: Name \"GeneratorsOfGroup\" is not defined in GAP.\nsage: H\nException RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored\n<fp group on the generators [ f1, f2 ]>\nsage: c=H.GeneratorsOfGroup()\n```",
    "created_at": "2012-10-11T20:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164409",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:3'></a>I don't know if it is an issue related with this patch or if it comes from libgap itself, but i have experienced some problems when i use tab completion in a session in the command line (i haven't checked it in the notebook).

An example:

```
sage: F=libgap.eval('FreeGroup(2)')
sage: (a,b)=F.GeneratorsOfGroup()
sage: H=F/libgap([a^2,b^2,a*b*a*b])
sage: H
<fp group on the generators [ f1, f2 ]>
sage: H.IsomorphismSimplifiedFpGroup()
[ f1, f2 ] -> [ f1, f2 ]
sage: H=F/libgap([a^2,b^2,a*b])    
sage: c=H.Gene
H.GeneralLinearGroup      H.GeneralisedEigenspaces  H.GeneralizedEigenvalues  H.GeneratorsOfIdeal
H.GeneralOrthogonalGroup  H.GeneralisedEigenvalues  H.GeneratorsOfField       
H.GeneralUnitaryGroup     H.GeneralizedEigenspaces  H.GeneratorsOfGroup       
sage: c=H.GeneratorsOfGroup()[0]
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()

AttributeError: Name "GeneratorsOfGroup" is not defined in GAP.
sage: c=H.GeneratorsOfGroup()   
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()

AttributeError: Name "GeneratorsOfGroup" is not defined in GAP.
sage: H
Exception RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored
<fp group on the generators [ f1, f2 ]>
sage: H.GeneratorsOfGroup()
[ f1, f2 ]
sage: c=H.GeneratorsOfGroup()[0]
sage: c
f1
sage: c=H.Generat
H.GeneratorsOfField  H.GeneratorsOfGroup  H.GeneratorsOfIdeal  
sage: c=H.GeneratorsOfGroup()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()

AttributeError: Name "GeneratorsOfGroup" is not defined in GAP.
sage: c=H.GeneratorsOfGroup()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/mmarco/sage-5.4/<ipython console> in <module>()

/home/mmarco/sage-5.4/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.__getattr__ (sage/libs/gap/element.c:3555)()

AttributeError: Name "GeneratorsOfGroup" is not defined in GAP.
sage: H
Exception RuntimeError: 'Entered a critical block twice' in 'sage.libs.gap.util.error_handler' ignored
<fp group on the generators [ f1, f2 ]>
sage: c=H.GeneratorsOfGroup()
```



---

archive/issue_comments_164410.json:
```json
{
    "body": "<a id='comment:4'></a>This same behaviour appears when i don't use this patch, so reported in the libgap ticket.",
    "created_at": "2012-10-12T13:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164410",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:4'></a>This same behaviour appears when i don't use this patch, so reported in the libgap ticket.



---

archive/issue_comments_164411.json:
```json
{
    "body": "<a id='comment:6'></a>Updated patch fixes the issue with the command line completion",
    "created_at": "2012-10-22T13:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164411",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Updated patch fixes the issue with the command line completion



---

archive/issue_comments_164412.json:
```json
{
    "body": "<a id='comment:7'></a>Updated spkg fixes long input lines (>32k characters):\n\n```\nsage: S = SymmetricGroup(10000)\nsage: s = S.random_element()\nsage: len(str(s._gap_()))\n61673\nsage: libgap(s)\n(1,5243,8582,5012,6862,7477,1681,7423,8405,3101,...,5257,9362,2495,8500)( [...] )\n```",
    "created_at": "2012-11-09T19:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164412",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Updated spkg fixes long input lines (>32k characters):

```
sage: S = SymmetricGroup(10000)
sage: s = S.random_element()
sage: len(str(s._gap_()))
61673
sage: libgap(s)
(1,5243,8582,5012,6862,7477,1681,7423,8405,3101,...,5257,9362,2495,8500)( [...] )
```



---

archive/issue_comments_164413.json:
```json
{
    "body": "<a id='comment:9'></a>I've added the same workaround for the gap command line option issue as just discussed in #13211",
    "created_at": "2012-11-13T02:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164413",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>I've added the same workaround for the gap command line option issue as just discussed in #13211



---

archive/issue_comments_164414.json:
```json
{
    "body": "<a id='comment:10'></a>I've added `__nonzero__` for wrapped GAP booleans for easier use.",
    "created_at": "2012-11-16T00:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164414",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>I've added `__nonzero__` for wrapped GAP booleans for easier use.



---

archive/issue_comments_164415.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-11-20T01:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164415",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_164416.json:
```json
{
    "body": "<a id='comment:11'></a>Attachment [trac_13588_improve_libGAP.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_improve_libGAP.patch) by @vbraun created at 2012-11-20 01:23:37\n\nThe new patch allows to change the comparison method for libgap objects since not all GAP objects can be compared. This is important if you want use them as cache keys.\n\nAlso, the comparison was not properly wrapped in `sig_on/sig_off`",
    "created_at": "2012-11-20T01:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164416",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>Attachment [trac_13588_improve_libGAP.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_improve_libGAP.patch) by @vbraun created at 2012-11-20 01:23:37

The new patch allows to change the comparison method for libgap objects since not all GAP objects can be compared. This is important if you want use them as cache keys.

Also, the comparison was not properly wrapped in `sig_on/sig_off`



---

archive/issue_comments_164417.json:
```json
{
    "body": "<a id='comment:12'></a>I forgot to package `aclocal.m4`, updated spkg adds that file.",
    "created_at": "2012-12-18T12:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164417",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>I forgot to package `aclocal.m4`, updated spkg adds that file.



---

archive/issue_comments_164418.json:
```json
{
    "body": "<a id='comment:15'></a>Updated to libGap-4.5.7",
    "created_at": "2012-12-26T13:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164418",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Updated to libGap-4.5.7



---

archive/issue_comments_164419.json:
```json
{
    "body": "patch from #6391",
    "created_at": "2012-12-26T13:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164419",
    "user": "https://github.com/vbraun"
}
```

patch from #6391



---

archive/issue_comments_164420.json:
```json
{
    "body": "Attachment [trac_6391_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket13588/trac_6391_libGAP_root.patch) by @vbraun created at 2012-12-26 13:12:38\n\npatch from #6391",
    "created_at": "2012-12-26T13:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164420",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_6391_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket13588/trac_6391_libGAP_root.patch) by @vbraun created at 2012-12-26 13:12:38

patch from #6391



---

archive/issue_events_037862.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-26T13:48:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13588#event-37862"
}
```



---

archive/issue_comments_164421.json:
```json
{
    "body": "<a id='comment:21'></a>I still see the segfault when trying to execute \"Exec\" trough libgap. This seems to make it impossible to load gap packages that make use of external programs.",
    "created_at": "2012-12-27T12:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164421",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:21'></a>I still see the segfault when trying to execute "Exec" trough libgap. This seems to make it impossible to load gap packages that make use of external programs.



---

archive/issue_comments_164422.json:
```json
{
    "body": "<a id='comment:22'></a>Thanks for reminding me, I completely forgot about the Exec thing.\n\nIn the meantime, can we get this reviewed and included into Sage before the next GAP version comes out?",
    "created_at": "2012-12-27T12:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164422",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Thanks for reminding me, I completely forgot about the Exec thing.

In the meantime, can we get this reviewed and included into Sage before the next GAP version comes out?



---

archive/issue_comments_164423.json:
```json
{
    "body": "<a id='comment:23'></a>I've replaced the spkg with a new version that fixes the GAP Exec command.",
    "created_at": "2012-12-27T12:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164423",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>I've replaced the spkg with a new version that fixes the GAP Exec command.



---

archive/issue_comments_164424.json:
```json
{
    "body": "Attachment [trac_13588_exec_fix.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_exec_fix.patch) by @vbraun created at 2012-12-27 12:48:14\n\nUpdated patch",
    "created_at": "2012-12-27T12:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164424",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13588_exec_fix.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_exec_fix.patch) by @vbraun created at 2012-12-27 12:48:14

Updated patch



---

archive/issue_comments_164425.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks. Still i can't load the kbmag package :(",
    "created_at": "2012-12-27T13:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164425",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:24'></a>Thanks. Still i can't load the kbmag package :(



---

archive/issue_comments_164426.json:
```json
{
    "body": "<a id='comment:25'></a>I've updated the spkg, now loading kbmag works for me. I had to install it by hand since your spkg at #13673 is offline.",
    "created_at": "2012-12-27T14:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164426",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>I've updated the spkg, now loading kbmag works for me. I had to install it by hand since your spkg at #13673 is offline.



---

archive/issue_comments_164427.json:
```json
{
    "body": "<a id='comment:26'></a>I get a slew of errors in ptestlong after following the instructions of the ticket with Sage 5.5; e.g.:\n\n```\nsage -t  --long -force_lib devel/sage/sage/libs/gap/libgap.pyx\n**********************************************************************\nFile \"/usr/local/src/sage/sage-5.5/devel/sage-main/sage/libs/gap/libgap.pyx\", line 11:\n    sage: a = libgap(10)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.5/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[2]>\", line 1, in <module>\n        a = libgap(Integer(10))###line 11:\n    sage: a = libgap(10)\n      File \"lazy_import.pyx\", line 244, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2012)\n      File \"lazy_import.pyx\", line 148, in sage.misc.lazy_import.LazyImport._get_object (sage/misc/lazy_import.c:1291)\n      File \"libgap.pyx\", line 574, in init sage.libs.gap.libgap (sage/libs/gap/libgap.c:4157)\n        libgap = Gap()\n      File \"libgap.pyx\", line 395, in sage.libs.gap.libgap.Gap.__init__ (sage/libs/gap/libgap.c:2716)\n        initialize()\n      File \"util.pyx\", line 193, in sage.libs.gap.util.initialize (sage/libs/gap/util.c:3312)\n        from sage.interfaces.gap import get_gap_memory_pool_size\n    ImportError: cannot import name get_gap_memory_pool_size\n**********************************************************************\nFile \"/usr/local/src/sage/sage-5.5/devel/sage-main/sage/libs/gap/libgap.pyx\", line 12:\n    sage: a\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.5/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[3]>\", line 1, in <module>\n        a###line 12:\n    sage: a\n    NameError: name 'a' is not defined\n\n```\n\nare some patches missing or not up date?",
    "created_at": "2013-01-02T15:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164427",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>I get a slew of errors in ptestlong after following the instructions of the ticket with Sage 5.5; e.g.:

```
sage -t  --long -force_lib devel/sage/sage/libs/gap/libgap.pyx
**********************************************************************
File "/usr/local/src/sage/sage-5.5/devel/sage-main/sage/libs/gap/libgap.pyx", line 11:
    sage: a = libgap(10)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.5/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[2]>", line 1, in <module>
        a = libgap(Integer(10))###line 11:
    sage: a = libgap(10)
      File "lazy_import.pyx", line 244, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2012)
      File "lazy_import.pyx", line 148, in sage.misc.lazy_import.LazyImport._get_object (sage/misc/lazy_import.c:1291)
      File "libgap.pyx", line 574, in init sage.libs.gap.libgap (sage/libs/gap/libgap.c:4157)
        libgap = Gap()
      File "libgap.pyx", line 395, in sage.libs.gap.libgap.Gap.__init__ (sage/libs/gap/libgap.c:2716)
        initialize()
      File "util.pyx", line 193, in sage.libs.gap.util.initialize (sage/libs/gap/util.c:3312)
        from sage.interfaces.gap import get_gap_memory_pool_size
    ImportError: cannot import name get_gap_memory_pool_size
**********************************************************************
File "/usr/local/src/sage/sage-5.5/devel/sage-main/sage/libs/gap/libgap.pyx", line 12:
    sage: a
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.5/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.5/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[3]>", line 1, in <module>
        a###line 12:
    sage: a
    NameError: name 'a' is not defined

```

are some patches missing or not up date?



---

archive/issue_comments_164428.json:
```json
{
    "body": "<a id='comment:27'></a>Did you apply the patches from #13211? The `get_gap_memory_pool_size()` function was added in `trac_13211_fix_gap_doctests_vb.patch`.",
    "created_at": "2013-01-02T16:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164428",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>Did you apply the patches from #13211? The `get_gap_memory_pool_size()` function was added in `trac_13211_fix_gap_doctests_vb.patch`.



---

archive/issue_comments_164429.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 vbraun]:\n> Did you apply the patches from #13211? The `get_gap_memory_pool_size()` function was added in `trac_13211_fix_gap_doctests_vb.patch`.\n\n\nindeed, I overlooked that #13211 isn't merged in 5.5. Sorry for noise.",
    "created_at": "2013-01-02T16:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164429",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>Replying to [comment:27 vbraun]:
> Did you apply the patches from #13211? The `get_gap_memory_pool_size()` function was added in `trac_13211_fix_gap_doctests_vb.patch`.


indeed, I overlooked that #13211 isn't merged in 5.5. Sorry for noise.



---

archive/issue_comments_164430.json:
```json
{
    "body": "<a id='comment:29'></a>Does sig_on() need a matching sig_off() in case sig_on() is issued in a try block, which throws an exception?\n\nComparison functions returning -1, 0, +1... So FORTRAN |V... :-)",
    "created_at": "2013-01-02T17:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164430",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>Does sig_on() need a matching sig_off() in case sig_on() is issued in a try block, which throws an exception?

Comparison functions returning -1, 0, +1... So FORTRAN |V... :-)



---

archive/issue_comments_164431.json:
```json
{
    "body": "<a id='comment:30'></a>`sig_on` and `sig_off` must be paired, though ideally they enclose only C/Cython code which cannot raise Python exceptions. A C signal will jump back to `sig_on` and raise there.\n\nhttp://www.sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off",
    "created_at": "2013-01-02T17:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164431",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>`sig_on` and `sig_off` must be paired, though ideally they enclose only C/Cython code which cannot raise Python exceptions. A C signal will jump back to `sig_on` and raise there.

http://www.sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off



---

archive/issue_comments_164432.json:
```json
{
    "body": "<a id='comment:31'></a>patches from #13880 are needed for doctests to (eventually) pass here.",
    "created_at": "2013-01-03T03:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164432",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>patches from #13880 are needed for doctests to (eventually) pass here.



---

archive/issue_comments_164433.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-05T05:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164433",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164434.json:
```json
{
    "body": "<a id='comment:35'></a>Is the test program `sage/libs/gap/test/main.c` used anywhere in the Sage library?  I don't mind having such a program, but I'd say it belongs in the libgap spkg and not in the Sage library.  It could be run when installing libGAP.",
    "created_at": "2013-01-10T13:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164434",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>Is the test program `sage/libs/gap/test/main.c` used anywhere in the Sage library?  I don't mind having such a program, but I'd say it belongs in the libgap spkg and not in the Sage library.  It could be run when installing libGAP.



---

archive/issue_comments_164435.json:
```json
{
    "body": "<a id='comment:37'></a>`sage/libs/gap/test/main.c` is not used anywhere. As the readme file explains, it is there if you need an example for how to link with libGAP without Sage. This can be useful for debugging. LibGAP has its own testsuite.",
    "created_at": "2013-01-10T13:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164435",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>`sage/libs/gap/test/main.c` is not used anywhere. As the readme file explains, it is there if you need an example for how to link with libGAP without Sage. This can be useful for debugging. LibGAP has its own testsuite.



---

archive/issue_comments_164436.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-10T14:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164436",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164437.json:
```json
{
    "body": "<a id='comment:38'></a>libgap tries to run various autotools, which should be avoided (as it can lead to build errors).  Probably this is simply timestamps were clobbered during the packaging.\n\n```\nlibgap-4.5.7.log:WARNING: 'aclocal-1.12' is missing on your system.  You should only need it if\nlibgap-4.5.7.log:WARNING: 'automake-1.12' is missing on your system.  You should only need it if\nlibgap-4.5.7.log:WARNING: 'autoconf' is missing on your system.  You should only need it if\nlibgap-4.5.7.log:WARNING: 'autoheader' is missing on your system.  You should only need it if\n```",
    "created_at": "2013-01-10T14:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164437",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>libgap tries to run various autotools, which should be avoided (as it can lead to build errors).  Probably this is simply timestamps were clobbered during the packaging.

```
libgap-4.5.7.log:WARNING: 'aclocal-1.12' is missing on your system.  You should only need it if
libgap-4.5.7.log:WARNING: 'automake-1.12' is missing on your system.  You should only need it if
libgap-4.5.7.log:WARNING: 'autoconf' is missing on your system.  You should only need it if
libgap-4.5.7.log:WARNING: 'autoheader' is missing on your system.  You should only need it if
```



---

archive/issue_comments_164438.json:
```json
{
    "body": "<a id='comment:39'></a>Ok I've regenerated the files and checked that it builds without the WARNING on an older machine. Spkg at the same place.",
    "created_at": "2013-01-10T19:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164438",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>Ok I've regenerated the files and checked that it builds without the WARNING on an older machine. Spkg at the same place.



---

archive/issue_comments_164439.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-10T19:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164439",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164440.json:
```json
{
    "body": "<a id='comment:40'></a>While building the documentation with this patch included, twice something went wrong.\n1. First time, I got an \"unhandled SIGSEGV\" in Sage while reading the sources of some elliptic curve file (sorry, forgot which one) for the PDF documentation.  I didn't store the exact logs since I thought it was a cosmic ray or something...\n2. Next attempt, building from scratch again during the build of the HTML documentation:\n\n```\nreading sources... [ 86%] sage/schemes/elliptic_curves/cm\nreading sources... [ 87%] sage/schemes/elliptic_curves/constructor\nreading sources... [ 87%] sage/schemes/elliptic_curves/ec_database\nreading sources... [ 87%] sage/schemes/elliptic_curves/ell_curve_isogeny\nreading sources... [ 87%] sage/schemes/elliptic_curves/ell_field\nreading sources... [ 87%] sage/schemes/elliptic_curves/ell_finite_field\nreading sources... [ 87%] sage/schemes/elliptic_curves/ell_generic\n\nException occurred:\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py\", line 831, in read_doc\n    pickle.dump(doctree, f, pickle.HIGHEST_PROTOCOL)\nMemoryError\nThe full traceback has been saved in /tmp/release/sphinx-err-QDcECu.log, if you want to report the issue to the developers.\n```\n\nFull traceback:\n\n```\n# Sphinx version: 1.1.2\n# Python version: 2.7.3\n# Docutils version: 0.7 release\n# Jinja2 version: 2.5.5\nTraceback (most recent call last):\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/cmdline.py\", line 189, in main\n    app.build(force_all, filenames)\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/application.py\", line 204, in build\n    self.builder.build_update()\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py\", line 196, in build_update\n    'out of date' % len(to_build))\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py\", line 216, in build\n    purple, length):\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py\", line 120, in status_iterator\n    for item in iterable:\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py\", line 616, in update_generator\n    self.read_doc(docname, app=app)\n  File \"/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py\", line 831, in read_doc\n    pickle.dump(doctree, f, pickle.HIGHEST_PROTOCOL)\nMemoryError\n```\n\nI cannot say for sure that this ticket is to blame, but the `MemoryError` certainly made me suspect GAP. And I also saw some \"halving pool size\" messages appear during the docbuilding.",
    "created_at": "2013-01-11T09:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164440",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>While building the documentation with this patch included, twice something went wrong.
1. First time, I got an "unhandled SIGSEGV" in Sage while reading the sources of some elliptic curve file (sorry, forgot which one) for the PDF documentation.  I didn't store the exact logs since I thought it was a cosmic ray or something...
2. Next attempt, building from scratch again during the build of the HTML documentation:

```
reading sources... [ 86%] sage/schemes/elliptic_curves/cm
reading sources... [ 87%] sage/schemes/elliptic_curves/constructor
reading sources... [ 87%] sage/schemes/elliptic_curves/ec_database
reading sources... [ 87%] sage/schemes/elliptic_curves/ell_curve_isogeny
reading sources... [ 87%] sage/schemes/elliptic_curves/ell_field
reading sources... [ 87%] sage/schemes/elliptic_curves/ell_finite_field
reading sources... [ 87%] sage/schemes/elliptic_curves/ell_generic

Exception occurred:
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py", line 831, in read_doc
    pickle.dump(doctree, f, pickle.HIGHEST_PROTOCOL)
MemoryError
The full traceback has been saved in /tmp/release/sphinx-err-QDcECu.log, if you want to report the issue to the developers.
```

Full traceback:

```
# Sphinx version: 1.1.2
# Python version: 2.7.3
# Docutils version: 0.7 release
# Jinja2 version: 2.5.5
Traceback (most recent call last):
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/cmdline.py", line 189, in main
    app.build(force_all, filenames)
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/application.py", line 204, in build
    self.builder.build_update()
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py", line 196, in build_update
    'out of date' % len(to_build))
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py", line 216, in build
    purple, length):
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/builders/__init__.py", line 120, in status_iterator
    for item in iterable:
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py", line 616, in update_generator
    self.read_doc(docname, app=app)
  File "/release/merger/sage-5.7.alpha0/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/environment.py", line 831, in read_doc
    pickle.dump(doctree, f, pickle.HIGHEST_PROTOCOL)
MemoryError
```

I cannot say for sure that this ticket is to blame, but the `MemoryError` certainly made me suspect GAP. And I also saw some "halving pool size" messages appear during the docbuilding.



---

archive/issue_comments_164441.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:40 jdemeyer]:\n> While building the documentation with this patch included, twice something went wrong.\n> 1. First time, I got an \"unhandled SIGSEGV\" in Sage while reading the sources of some elliptic curve file (sorry, forgot which one) for the PDF documentation.  I didn't store the exact logs since I thought it was a cosmic ray or something...\n> 2. Next attempt, building from scratch again during the build of the HTML documentation:\n\n\nif this happens on one host only, I'd blame the RAM there.",
    "created_at": "2013-01-11T09:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164441",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>Replying to [comment:40 jdemeyer]:
> While building the documentation with this patch included, twice something went wrong.
> 1. First time, I got an "unhandled SIGSEGV" in Sage while reading the sources of some elliptic curve file (sorry, forgot which one) for the PDF documentation.  I didn't store the exact logs since I thought it was a cosmic ray or something...
> 2. Next attempt, building from scratch again during the build of the HTML documentation:


if this happens on one host only, I'd blame the RAM there.



---

archive/issue_comments_164442.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 dimpase]:\n> if this happens on one host only, I'd blame the RAM there.\n\nIf this happens *only* with the libGAP patches, I'd blame libGAP.  Besides, why would faulty RAM lead to a `MemoryError` exception?",
    "created_at": "2013-01-11T09:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164442",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>Replying to [comment:41 dimpase]:
> if this happens on one host only, I'd blame the RAM there.

If this happens *only* with the libGAP patches, I'd blame libGAP.  Besides, why would faulty RAM lead to a `MemoryError` exception?



---

archive/issue_comments_164443.json:
```json
{
    "body": "<a id='comment:43'></a>All GAP/libGAP processes should be terminated by the time we are building the manual, so I don't see how we could possibly impact that.\n\nIs this a 32-bit machine? There you might run into warts caused by the limited address space, and the halving pool size would support that. Sphinx uses quite a lot of memory and might fail to load its pickles if there is no memory left **or** no contiguous address space block available.",
    "created_at": "2013-01-11T10:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164443",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'></a>All GAP/libGAP processes should be terminated by the time we are building the manual, so I don't see how we could possibly impact that.

Is this a 32-bit machine? There you might run into warts caused by the limited address space, and the halving pool size would support that. Sphinx uses quite a lot of memory and might fail to load its pickles if there is no memory left **or** no contiguous address space block available.



---

archive/issue_comments_164444.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 vbraun]:\n> All GAP/libGAP processes should be terminated by the time we are building the manual\n\nNot really, as building the manual runs Sage code (as witnessed for example that Segmentation Faults run the Sage signal handler and display \"Unhandled SIGSEGV...\")",
    "created_at": "2013-01-11T10:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164444",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>Replying to [comment:43 vbraun]:
> All GAP/libGAP processes should be terminated by the time we are building the manual

Not really, as building the manual runs Sage code (as witnessed for example that Segmentation Faults run the Sage signal handler and display "Unhandled SIGSEGV...")



---

archive/issue_comments_164445.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 jdemeyer]:\n> Not really, as building the manual runs Sage code (as witnessed for example that Segmentation Faults run the Sage signal handler and display \"Unhandled SIGSEGV...\")\n\n\nTheoretically true, but a normal Sage session won't start GAP until it has to and libGAP is lazily imported as well. Even then, none of that has anything to do with the elliptic curve stuff. \n\nRight now the only thing in this ticket that seems to actually influence the docbuild is that the documentation becomes larger.",
    "created_at": "2013-01-11T10:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164445",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:45'></a>Replying to [comment:44 jdemeyer]:
> Not really, as building the manual runs Sage code (as witnessed for example that Segmentation Faults run the Sage signal handler and display "Unhandled SIGSEGV...")


Theoretically true, but a normal Sage session won't start GAP until it has to and libGAP is lazily imported as well. Even then, none of that has anything to do with the elliptic curve stuff. 

Right now the only thing in this ticket that seems to actually influence the docbuild is that the documentation becomes larger.



---

archive/issue_comments_164446.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 vbraun]:\n> Theoretically true, but a normal Sage session won't start GAP until it has to and libGAP is lazily imported as well.\n\nThe fact that I'm seeing \"halving pool size\" messages during the docbuilding proves that GAP is started.",
    "created_at": "2013-01-11T10:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164446",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'></a>Replying to [comment:45 vbraun]:
> Theoretically true, but a normal Sage session won't start GAP until it has to and libGAP is lazily imported as well.

The fact that I'm seeing "halving pool size" messages during the docbuilding proves that GAP is started.



---

archive/issue_comments_164447.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 jdemeyer]:\n> The fact that I'm seeing \"halving pool size\" messages during the docbuilding proves that GAP is started.\n\n\nThat indeed means that something is wonky. We are trying hard to pick a pool size that **should fit into memory** yet it doesn't. As I said before, this means that either there is very little memory to start with or the available address space is so fragmented that there is no contiguous piece left (32-bit only).",
    "created_at": "2013-01-11T12:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164447",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:47'></a>Replying to [comment:46 jdemeyer]:
> The fact that I'm seeing "halving pool size" messages during the docbuilding proves that GAP is started.


That indeed means that something is wonky. We are trying hard to pick a pool size that **should fit into memory** yet it doesn't. As I said before, this means that either there is very little memory to start with or the available address space is so fragmented that there is no contiguous piece left (32-bit only).



---

archive/issue_comments_164448.json:
```json
{
    "body": "<a id='comment:48'></a>I guess sphinx has to resolve the lazy imports in order to get at the docstrings? That would pull in libGAP, which then subtracts ~250MB from the available address space. On a 32-bit machine that might push you over the cliff since sphinx is the most memory-demanding piece of the whole sage build process. Can you tell us which architecture we are talking about?",
    "created_at": "2013-01-11T12:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164448",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'></a>I guess sphinx has to resolve the lazy imports in order to get at the docstrings? That would pull in libGAP, which then subtracts ~250MB from the available address space. On a 32-bit machine that might push you over the cliff since sphinx is the most memory-demanding piece of the whole sage build process. Can you tell us which architecture we are talking about?



---

archive/issue_comments_164449.json:
```json
{
    "body": "<a id='comment:49'></a>Sorry, I wasn't immediately aware of this, but this was with `ulimit -v 2500000` (2.5GB) set on a 64-bit system.",
    "created_at": "2013-01-11T12:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164449",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'></a>Sorry, I wasn't immediately aware of this, but this was with `ulimit -v 2500000` (2.5GB) set on a 64-bit system.



---

archive/issue_comments_164450.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-12T21:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164450",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164451.json:
```json
{
    "body": "<a id='comment:50'></a>This needs a patch to `MANIFEST.in` to add the `Makefile` (but again: I doubt that this really belongs in the Sage library).",
    "created_at": "2013-01-12T21:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164451",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>This needs a patch to `MANIFEST.in` to add the `Makefile` (but again: I doubt that this really belongs in the Sage library).



---

archive/issue_comments_164452.json:
```json
{
    "body": "Attachment [trac_13588_manifest.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_manifest.patch) by @vbraun created at 2013-01-13 21:07:31\n\nInitial patch",
    "created_at": "2013-01-13T21:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164452",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13588_manifest.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_manifest.patch) by @vbraun created at 2013-01-13 21:07:31

Initial patch



---

archive/issue_comments_164453.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-13T21:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164453",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164454.json:
```json
{
    "body": "<a id='comment:51'></a>I've added it to the manifest. I do think it is useful, when I started working on libgap that was one of the first things that I had to figure out.",
    "created_at": "2013-01-13T21:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164454",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:51'></a>I've added it to the manifest. I do think it is useful, when I started working on libgap that was one of the first things that I had to figure out.



---

archive/issue_comments_164455.json:
```json
{
    "body": "Attachment [13588_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket13588/13588_libGAP_root.patch) by @jdemeyer created at 2013-01-15 09:36:41",
    "created_at": "2013-01-15T09:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164455",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [13588_libGAP_root.patch](tarball://root/attachments/some-uuid/ticket13588/13588_libGAP_root.patch) by @jdemeyer created at 2013-01-15 09:36:41



---

archive/issue_comments_164456.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-15T09:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164456",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164457.json:
```json
{
    "body": "<a id='comment:53'></a>New `SAGE_ROOT` patch which adds libgap as dependency of the Sage library.",
    "created_at": "2013-01-15T09:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164457",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'></a>New `SAGE_ROOT` patch which adds libgap as dependency of the Sage library.



---

archive/issue_comments_164458.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-15T09:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164458",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164459.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-15T09:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164459",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164460.json:
```json
{
    "body": "<a id='comment:54'></a>Looks good to me!",
    "created_at": "2013-01-15T09:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164460",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:54'></a>Looks good to me!



---

archive/issue_comments_164461.json:
```json
{
    "body": "Patch needed for SPARC",
    "created_at": "2013-01-17T19:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164461",
    "user": "https://github.com/jdemeyer"
}
```

Patch needed for SPARC



---

archive/issue_comments_164462.json:
```json
{
    "body": "<a id='comment:55'></a>Attachment [libgap_sparc.patch](tarball://root/attachments/some-uuid/ticket13588/libgap_sparc.patch) by @jdemeyer created at 2013-01-17 19:23:15\n\n[attachment:libgap_sparc.patch] must be added to the spkg to work on SPARC.",
    "created_at": "2013-01-17T19:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164462",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>Attachment [libgap_sparc.patch](tarball://root/attachments/some-uuid/ticket13588/libgap_sparc.patch) by @jdemeyer created at 2013-01-17 19:23:15

[attachment:libgap_sparc.patch] must be added to the spkg to work on SPARC.



---

archive/issue_comments_164463.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-17T19:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164463",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164464.json:
```json
{
    "body": "<a id='comment:56'></a>Thanks. I've added it to the symbol rewriting code in the `make_spkg.sh` script.\n\n```\n#ifdef SPARC\n#if SPARC\n        asm(\"           .globl  SparcStackFuncBags              \");\n        asm(\"   SparcStackFuncBags:                             \");\n        asm(\"           ta      0x3     ! ST_FLUSH_WINDOWS      \");\n        asm(\"           mov     %sp,%o0                         \");\n        asm(\"           retl                                    \");\n        asm(\"           nop                                     \");\n#endif\n#endif\n\n/* sunos */\n#ifdef SPARC\n#if SPARC\n        asm(\"           .globl  _SparcStackFuncBags             \");\n        asm(\"   _SparcStackFuncBags:                            \");\n        asm(\"           ta      0x3     ! ST_FLUSH_WINDOWS      \");\n        asm(\"           mov     %sp,%o0                         \");\n        asm(\"           retl                                    \");\n        asm(\"           nop                                     \");\n#endif\n#endif\n#else\n#if defined(SPARC) && SPARC\nvoid SparcStackFuncBags( void )\n{\n  asm (\" ta 0x3 \");\n  asm (\" mov %sp,%o0\" );\n  return;\n}\n#endif\n```\nI presume the offending code has grown organically over the decades...",
    "created_at": "2013-01-17T19:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164464",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>Thanks. I've added it to the symbol rewriting code in the `make_spkg.sh` script.

```
#ifdef SPARC
#if SPARC
        asm("           .globl  SparcStackFuncBags              ");
        asm("   SparcStackFuncBags:                             ");
        asm("           ta      0x3     ! ST_FLUSH_WINDOWS      ");
        asm("           mov     %sp,%o0                         ");
        asm("           retl                                    ");
        asm("           nop                                     ");
#endif
#endif

/* sunos */
#ifdef SPARC
#if SPARC
        asm("           .globl  _SparcStackFuncBags             ");
        asm("   _SparcStackFuncBags:                            ");
        asm("           ta      0x3     ! ST_FLUSH_WINDOWS      ");
        asm("           mov     %sp,%o0                         ");
        asm("           retl                                    ");
        asm("           nop                                     ");
#endif
#endif
#else
#if defined(SPARC) && SPARC
void SparcStackFuncBags( void )
{
  asm (" ta 0x3 ");
  asm (" mov %sp,%o0" );
  return;
}
#endif
```
I presume the offending code has grown organically over the decades...



---

archive/issue_comments_164465.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-17T19:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164465",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164466.json:
```json
{
    "body": "<a id='comment:58'></a>The similar operation needs to be done for\n\n```\nItaniumRegisterStackTop\n```",
    "created_at": "2013-01-18T16:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164466",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'></a>The similar operation needs to be done for

```
ItaniumRegisterStackTop
```



---

archive/issue_comments_164467.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-18T16:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164467",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164468.json:
```json
{
    "body": "<a id='comment:59'></a>Also: please remove `src/src/gasman.c.orig`",
    "created_at": "2013-01-18T16:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164468",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'></a>Also: please remove `src/src/gasman.c.orig`



---

archive/issue_comments_164469.json:
```json
{
    "body": "<a id='comment:60'></a>Yay, more conditional compilation ;-)  I've added the conditional `itanium.s` source. I also changed the `make_spkg.sh` script to start from the tarball, so no superfluous files should be included. I tested the new spkg (same location) successfully on sage.math and iras.",
    "created_at": "2013-01-18T16:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164469",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:60'></a>Yay, more conditional compilation ;-)  I've added the conditional `itanium.s` source. I also changed the `make_spkg.sh` script to start from the tarball, so no superfluous files should be included. I tested the new spkg (same location) successfully on sage.math and iras.



---

archive/issue_comments_164470.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-18T16:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164470",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164471.json:
```json
{
    "body": "<a id='comment:62'></a>Replying to [comment:60 vbraun]:\n> I tested the new spkg\n\nI assume that also includes running libgap doctests, because that's where the error shows up.",
    "created_at": "2013-01-18T17:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164471",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'></a>Replying to [comment:60 vbraun]:
> I tested the new spkg

I assume that also includes running libgap doctests, because that's where the error shows up.



---

archive/issue_comments_164472.json:
```json
{
    "body": "<a id='comment:63'></a>Well I checked that `itanium.s` is compiled and linked into libgap on iras.",
    "created_at": "2013-01-18T18:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164472",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:63'></a>Well I checked that `itanium.s` is compiled and linked into libgap on iras.



---

archive/issue_comments_164473.json:
```json
{
    "body": "<a id='comment:64'></a>I compiled sage on iras overnight and doctests pass, too ;-)",
    "created_at": "2013-01-19T12:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164473",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:64'></a>I compiled sage on iras overnight and doctests pass, too ;-)



---

archive/issue_comments_164474.json:
```json
{
    "body": "<a id='comment:65'></a>Something went wrong with your search/replace script, on `mark` (Solaris):\n\n```\nld.so.1: python2.7: fatal: relocation error: file /home/buildbot/build/sage/mark-1/mark_full/build/sage-5.7.beta0/local/lib/libgap.so.0: symbol libGAP_libGAP_SparcStackFuncBags: referenced symbol not found\n```",
    "created_at": "2013-01-21T07:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164474",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>Something went wrong with your search/replace script, on `mark` (Solaris):

```
ld.so.1: python2.7: fatal: relocation error: file /home/buildbot/build/sage/mark-1/mark_full/build/sage-5.7.beta0/local/lib/libgap.so.0: symbol libGAP_libGAP_SparcStackFuncBags: referenced symbol not found
```



---

archive/issue_comments_164475.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-21T07:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164475",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164476.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-21T11:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164476",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164477.json:
```json
{
    "body": "<a id='comment:67'></a>Fixed - the SparcStackFuncBags occurs in inline assembly and in C, so I now made sure to only rename it once.",
    "created_at": "2013-01-21T11:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164477",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:67'></a>Fixed - the SparcStackFuncBags occurs in inline assembly and in C, so I now made sure to only rename it once.



---

archive/issue_comments_164478.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-22T07:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164478",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164479.json:
```json
{
    "body": "<a id='comment:68'></a>I'm still not entirely happy with the memory allocation during docbuilding.  For reasons I cannot understand, the documentation used to build fine with\n\n```\nulimit -v 2500000\n```\nbut now it needs (I tested 100MB increments)\n\n```\nulimit -v 3500000\n```\nwhich is an increase of 1GB.  Of course, the documentation is also getting bigger, but that explains only a small part of the increase.  Also, on the buildbot I'm seeing sometimes errors of the form\n\n```\nsphinx-build -b html -d /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/output/doctrees/de/tutorial    /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/de/tutorial /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/output/html/de/tutorial\nTraceback (most recent call last):\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py\", line 1093, in <module>\n    getattr(get_builder(name), type)()\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py\", line 232, in _wrapper\n    getattr(get_builder(document), name)(*args, **kwds)\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py\", line 88, in f\n    subprocess.call(build_command, shell=True)\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py\", line 493, in call\n    return Popen(*popenargs, **kwargs).wait()\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py\", line 679, in __init__\n    errread, errwrite)\n  File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py\", line 1143, in _execute_child\n    self.pid = os.fork()\nOSError: [Errno 12] Cannot allocate memory\nmake: *** [doc-html-mathjax] Error 1\n```\nI suspect that GAP has something to do with this.\n\nCould you somehow fix the memory allocation to allocate an absolutely minimal amount during docbuilding?  Maybe it would make sense to introduce an environment variable `SAGE_GAP_MEGABYTES` which could be user-set to the desired memory size and which would be set by the docbuilder to a small number (say, 1 MB).",
    "created_at": "2013-01-22T07:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164479",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'></a>I'm still not entirely happy with the memory allocation during docbuilding.  For reasons I cannot understand, the documentation used to build fine with

```
ulimit -v 2500000
```
but now it needs (I tested 100MB increments)

```
ulimit -v 3500000
```
which is an increase of 1GB.  Of course, the documentation is also getting bigger, but that explains only a small part of the increase.  Also, on the buildbot I'm seeing sometimes errors of the form

```
sphinx-build -b html -d /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/output/doctrees/de/tutorial    /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/de/tutorial /home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/output/html/de/tutorial
Traceback (most recent call last):
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py", line 1093, in <module>
    getattr(get_builder(name), type)()
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py", line 232, in _wrapper
    getattr(get_builder(document), name)(*args, **kwds)
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/devel/sage/doc/common/builder.py", line 88, in f
    subprocess.call(build_command, shell=True)
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py", line 493, in call
    return Popen(*popenargs, **kwargs).wait()
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py", line 679, in __init__
    errread, errwrite)
  File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.7.beta0/local/lib/python/subprocess.py", line 1143, in _execute_child
    self.pid = os.fork()
OSError: [Errno 12] Cannot allocate memory
make: *** [doc-html-mathjax] Error 1
```
I suspect that GAP has something to do with this.

Could you somehow fix the memory allocation to allocate an absolutely minimal amount during docbuilding?  Maybe it would make sense to introduce an environment variable `SAGE_GAP_MEGABYTES` which could be user-set to the desired memory size and which would be set by the docbuilder to a small number (say, 1 MB).



---

archive/issue_comments_164480.json:
```json
{
    "body": "<a id='comment:69'></a>I've added a setting to our Sphinx config (`doc/common/conf.py`) and builder config (`build_options.py`) to use only the minimum amount for GAP memory pool. The builder and sphinx itself both import everything to get at docstrings, so two libgap instances are being created when building the documentation. I verified that I can now build all documentation with `ulimit -v 2500000`).",
    "created_at": "2013-01-22T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164480",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:69'></a>I've added a setting to our Sphinx config (`doc/common/conf.py`) and builder config (`build_options.py`) to use only the minimum amount for GAP memory pool. The builder and sphinx itself both import everything to get at docstrings, so two libgap instances are being created when building the documentation. I verified that I can now build all documentation with `ulimit -v 2500000`).



---

archive/issue_comments_164481.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-22T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164481",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164482.json:
```json
{
    "body": "<a id='comment:70'></a>The following is fairly reproducible (with #13717 applied):\n\n```\nsage -t  -force_lib devel/sagenb-main/sagenb/misc/support.py\n**********************************************************************\nFile \"/release/merger/sage-5.7.beta1/devel/sagenb-main/sagenb/misc/support.py\", line 479:\n    sage: sage.server.support.syseval(gap, \"2+3\")\nExpected:\n    '5'\nGot:\n    ** Gap crashed or quit executing '2+3;' **\n    Restarting Gap and trying again\n    '5'\n**********************************************************************\n```\n\nNote that GAP is started with only 1MB of memory, as the top of this `strace` log shows:\n\n```\nexecve(\"/release/merger/sage-5.7.beta1/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap\", [\"/release/merger/sage-5.7.beta1/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap\", \"-m\", \"24m\", \"-l\", \"/release/merger/sage-5.7.beta1/local/gap/latest\", \"-r\", \"-b\", \"-p\", \"-T\", \"-o\", \"1m\", \"-s\", \"1m\", \"/release/merger/sage-5.7.beta1/local/share/sage/ext/gap/sage.g\"], [/* 84 vars */]) = 0\n```\n\nFull strace log: [http://boxen.math.washington.edu/home/jdemeyer/gap.28216](http://boxen.math.washington.edu/home/jdemeyer/gap.28216)",
    "created_at": "2013-01-23T17:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164482",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:70'></a>The following is fairly reproducible (with #13717 applied):

```
sage -t  -force_lib devel/sagenb-main/sagenb/misc/support.py
**********************************************************************
File "/release/merger/sage-5.7.beta1/devel/sagenb-main/sagenb/misc/support.py", line 479:
    sage: sage.server.support.syseval(gap, "2+3")
Expected:
    '5'
Got:
    ** Gap crashed or quit executing '2+3;' **
    Restarting Gap and trying again
    '5'
**********************************************************************
```

Note that GAP is started with only 1MB of memory, as the top of this `strace` log shows:

```
execve("/release/merger/sage-5.7.beta1/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap", ["/release/merger/sage-5.7.beta1/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap", "-m", "24m", "-l", "/release/merger/sage-5.7.beta1/local/gap/latest", "-r", "-b", "-p", "-T", "-o", "1m", "-s", "1m", "/release/merger/sage-5.7.beta1/local/share/sage/ext/gap/sage.g"], [/* 84 vars */]) = 0
```

Full strace log: [http://boxen.math.washington.edu/home/jdemeyer/gap.28216](http://boxen.math.washington.edu/home/jdemeyer/gap.28216)



---

archive/issue_comments_164483.json:
```json
{
    "body": "Attachment [trac_13588_docbuild.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_docbuild.patch) by @vbraun created at 2013-01-23 20:02:22\n\nUpdated patch",
    "created_at": "2013-01-23T20:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164483",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13588_docbuild.patch](tarball://root/attachments/some-uuid/ticket13588/trac_13588_docbuild.patch) by @vbraun created at 2013-01-23 20:02:22

Updated patch



---

archive/issue_comments_164484.json:
```json
{
    "body": "<a id='comment:71'></a>I see, introspection runs Sphinx as well so there is a chance to get `conf.py` imported in Sage. Though curiously, it doesn't cause any doctest failure on my machine. I moved the part that limits GAP to a branch in `conf.py` that is only executed when we actually build the documentation, this should fix it.",
    "created_at": "2013-01-23T20:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164484",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:71'></a>I see, introspection runs Sphinx as well so there is a chance to get `conf.py` imported in Sage. Though curiously, it doesn't cause any doctest failure on my machine. I moved the part that limits GAP to a branch in `conf.py` that is only executed when we actually build the documentation, this should fix it.



---

archive/issue_events_037863.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-26T09:54:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13588#event-37863"
}
```



---

archive/issue_comments_164485.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-26T09:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13588#issuecomment-164485",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
