# Issue 13045: Deprecate cholesky_decomposition() in favor of cholesky()

archive/issues_012873.json:
```json
{
    "body": "`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` alongside.\n\nThe old `cholesky_decomposition()` is so broken that nobody should be using it anyway, thus it should be no problem to obsolete it.\n\n**Depends**: #12966, #13018, #11274, #13035\n\n**Apply**:\n1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]\n2. [attachment:trac_13045-deprecate-cholesky-decomposition-update.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @dandrake\n\n**Keywords:** sd40.5\n\n**Reviewer:** Dan Drake\n\n**Author:** Rob Beezer\n\n**Merged:** sage-5.1.beta5\n\n**Dependencies:** #12966, #13018, #11274, #13035\n\nIssue created by migration from https://trac.sagemath.org/ticket/13045\n\n",
    "closed_at": "2012-06-18T10:26:14Z",
    "created_at": "2012-05-28T05:32:28Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Deprecate cholesky_decomposition() in favor of cholesky()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13045",
    "user": "https://github.com/rbeezer"
}
```
`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` alongside.

The old `cholesky_decomposition()` is so broken that nobody should be using it anyway, thus it should be no problem to obsolete it.

**Depends**: #12966, #13018, #11274, #13035

**Apply**:
1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]
2. [attachment:trac_13045-deprecate-cholesky-decomposition-update.patch]

**Assignee:** @jasongrout, @williamstein

**CC:**  @dandrake

**Keywords:** sd40.5

**Reviewer:** Dan Drake

**Author:** Rob Beezer

**Merged:** sage-5.1.beta5

**Dependencies:** #12966, #13018, #11274, #13035

Issue created by migration from https://trac.sagemath.org/ticket/13045





---

archive/attachments_017621.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13045-deprecate-cholesky-decomposition-v1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13045/trac_13045-deprecate-cholesky-decomposition-v1.patch",
    "created_at": "2012-05-28T05:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_150832.json:
```json
{
    "body": "",
    "created_at": "2012-05-28T05:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150832",
    "user": "https://github.com/rbeezer"
}
```





---

archive/issue_comments_150833.json:
```json
{
    "body": "**Dependencies:** #12966, #13018, #11274, #13035",
    "created_at": "2012-05-28T05:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150833",
    "user": "https://github.com/rbeezer"
}
```

**Dependencies:** #12966, #13018, #11274, #13035



---

archive/issue_comments_150834.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2012-05-28T05:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150834",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_150835.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n-`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` along side.\n+`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` alongside.\n \n The old `cholesky_decomposition()` is so broken that nobody should be using it anyway, thus it should be no problem to obsolete it.\n+\n+**Depends**: #12966, #13018, #11274, #13035\n+\n+**Apply**:\n+1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]\n``````\n",
    "created_at": "2012-05-28T05:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150835",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
-`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` along side.
+`cholesky_decomposition()` is needlessly verbose, and the existing spaghetti code with `_cholesky_decomposition()` is too convoluted to unwind.  Dependencies install the **new** `cholesky()` alongside.
 
 The old `cholesky_decomposition()` is so broken that nobody should be using it anyway, thus it should be no problem to obsolete it.
+
+**Depends**: #12966, #13018, #11274, #13035
+
+**Apply**:
+1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]
``````




---

archive/issue_comments_150836.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd40.5\".",
    "created_at": "2012-05-28T05:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150836",
    "user": "https://github.com/rbeezer"
}
```

**Changing keywords** from "" to "sd40.5".



---

archive/issue_comments_150837.json:
```json
{
    "body": "<a id='comment:1'></a>\nImporting the deprecation machinery seemed to set off some Python deprecation warnings about messages on exceptions, so those have been modernized.",
    "created_at": "2012-05-28T05:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150837",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'></a>
Importing the deprecation machinery seemed to set off some Python deprecation warnings about messages on exceptions, so those have been modernized.



---

archive/issue_events_109545.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-28T05:42:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13045#event-109545"
}
```



---

archive/issue_comments_150838.json:
```json
{
    "body": "<a id='comment:2'></a>\nOne note: string formatting when raising an exception is, in many cases, a really bad idea, since generating the string may take a really long time. This mostly happens when trying to represent a very large number or other Sage object, and can dramatically slow down some algorithms which try things, catch exceptions, and then try other things without looking at the error message.\n\nI *think* the string formatting here is fine, since it should just be mixing in another simple error message, but it seems wise to leave a warning here.",
    "created_at": "2012-05-28T20:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150838",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:2'></a>
One note: string formatting when raising an exception is, in many cases, a really bad idea, since generating the string may take a really long time. This mostly happens when trying to represent a very large number or other Sage object, and can dramatically slow down some algorithms which try things, catch exceptions, and then try other things without looking at the error message.

I *think* the string formatting here is fine, since it should just be mixing in another simple error message, but it seems wise to leave a warning here.



---

archive/issue_comments_150839.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn the warning, you should link to the new `cholesky` function:  <code>:meth:\\`cholesky\\`</code>.",
    "created_at": "2012-05-28T21:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150839",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:3'></a>
In the warning, you should link to the new `cholesky` function:  <code>:meth:\`cholesky\`</code>.



---

archive/issue_comments_150840.json:
```json
{
    "body": "<a id='comment:4'></a>\nMore seriously, the caching means that this broken, crappy function can infect the new, correct function:\n\n```\nsage: r = matrix(CDF, 2, 2, [ 1, -2*I, 2*I, 0 ]); r\n[   1.0 -2.0*I]\n[ 2.0*I    0.0]\nsage: r[0,0] = 0\nsage: r.cholesky_decomposition()\n[        0.0         0.0]\n[NaN + NaN*I NaN + NaN*I]\nsage: r.cholesky()\n[        0.0         0.0]\n[NaN + NaN*I NaN + NaN*I]\n```\nThe documentation makes it clear that `cholesky_decomposition` can return bad answers, but the new function shouldn't be infected by that.",
    "created_at": "2012-05-28T21:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150840",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>
More seriously, the caching means that this broken, crappy function can infect the new, correct function:

```
sage: r = matrix(CDF, 2, 2, [ 1, -2*I, 2*I, 0 ]); r
[   1.0 -2.0*I]
[ 2.0*I    0.0]
sage: r[0,0] = 0
sage: r.cholesky_decomposition()
[        0.0         0.0]
[NaN + NaN*I NaN + NaN*I]
sage: r.cholesky()
[        0.0         0.0]
[NaN + NaN*I NaN + NaN*I]
```
The documentation makes it clear that `cholesky_decomposition` can return bad answers, but the new function shouldn't be infected by that.



---

archive/issue_comments_150841.json:
```json
{
    "body": "**Reviewer:** Dan Drake",
    "created_at": "2012-05-28T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150841",
    "user": "https://github.com/rbeezer"
}
```

**Reviewer:** Dan Drake



---

archive/attachments_017622.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13045-deprecate-cholesky-decomposition-update.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13045/trac_13045-deprecate-cholesky-decomposition-update.patch",
    "created_at": "2012-05-28T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_150842.json:
```json
{
    "body": "<a id='comment:5'></a>\nUpdate patch addresses reviewer comments: cholesky is linked in warning, cache strings are separated, and a doctest for that is added.\n\nApply new patch on top of old.",
    "created_at": "2012-05-28T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150842",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'></a>
Update patch addresses reviewer comments: cholesky is linked in warning, cache strings are separated, and a doctest for that is added.

Apply new patch on top of old.



---

archive/issue_comments_150843.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,3 +6,4 @@\n \n **Apply**:\n 1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]\n+2. [attachment:trac_13045-deprecate-cholesky-decomposition-update.patch]\n``````\n",
    "created_at": "2012-05-28T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150843",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,3 +6,4 @@
 
 **Apply**:
 1. [attachment:trac_13045-deprecate-cholesky-decomposition-v1.patch]
+2. [attachment:trac_13045-deprecate-cholesky-decomposition-update.patch]
``````




---

archive/issue_comments_150844.json:
```json
{
    "body": "<a id='comment:6'></a>\nSeparating the caches does show us that the new routine is much faster:\n\n```\nsage: A= random_matrix(CDF, 200); M = A*A.conjugate_transpose()\nsage: %time M.cholesky()\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.03 s\n200 x 200 dense matrix over Complex Double Field\nsage: %time M.cholesky_decomposition()\n/home/drake/s/sage-5.1.beta0/local/lib/python2.7/site-packages/IPython/Magic.py:1981: DeprecationWarning: (Since Sage Version 5.1) cholesky_decomposition() is deprecated; please use cholesky() instead.\n  out = eval(code,glob)\nCPU times: user 23.33 s, sys: 0.01 s, total: 23.34 s\nWall time: 23.42 s\n200 x 200 dense matrix over Complex Double Field\n```\nAbout three orders of magnitude. Nice.",
    "created_at": "2012-05-29T00:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150844",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:6'></a>
Separating the caches does show us that the new routine is much faster:

```
sage: A= random_matrix(CDF, 200); M = A*A.conjugate_transpose()
sage: %time M.cholesky()
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.03 s
200 x 200 dense matrix over Complex Double Field
sage: %time M.cholesky_decomposition()
/home/drake/s/sage-5.1.beta0/local/lib/python2.7/site-packages/IPython/Magic.py:1981: DeprecationWarning: (Since Sage Version 5.1) cholesky_decomposition() is deprecated; please use cholesky() instead.
  out = eval(code,glob)
CPU times: user 23.33 s, sys: 0.01 s, total: 23.34 s
Wall time: 23.42 s
200 x 200 dense matrix over Complex Double Field
```
About three orders of magnitude. Nice.



---

archive/issue_comments_150845.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe second patch is good. Positive review to all.\n\nApply trac_13045-deprecate-cholesky-decomposition-v1.patch and  \ntrac_13045-deprecate-cholesky-decomposition-update.patch",
    "created_at": "2012-05-29T01:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150845",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:7'></a>
The second patch is good. Positive review to all.

Apply trac_13045-deprecate-cholesky-decomposition-v1.patch and  
trac_13045-deprecate-cholesky-decomposition-update.patch



---

archive/issue_events_109546.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-29T01:53:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13045#event-109546"
}
```



---

archive/issue_events_109547.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-29T01:53:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13045#event-109547"
}
```



---

archive/issue_comments_150846.json:
```json
{
    "body": "**Merged:** sage-5.1.beta5",
    "created_at": "2012-06-18T10:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13045#issuecomment-150846",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta5



---

archive/issue_events_109548.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:26:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13045#event-109548"
}
```



---

archive/issue_events_109549.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:26:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13045",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13045#event-109549"
}
```
