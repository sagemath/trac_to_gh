# Issue 13881: Enhanced debugging: cygdb and better backtraces

archive/issues_013677.json:
```json
{
    "body": "The purpose of these patches is to make cython emit debugging output (unless `SAGE_DEBUG=no` since it only costs some disk space) and run cygdb instead of gdb for `sage --gdb` (unless `SAGE_DEBUG=no`, in which case you get the plain gdb). cydbg can be a bit slow to start up, but gives cython source-level debugging. For example:\n\n```\n[vbraun@volker-desktop sage-5.6.beta1]$ SAGE_DEBUG=yes ./sage -gdb\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nGNU gdb (GDB) 7.5.1\nCopyright (C) 2012 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-unknown-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>...\nReading symbols from /home/vbraun/opt/sage-5.6.beta1/local/bin/python...done.\nPython was not compiled with debug symbols (or it was stripped). Some functionality may not work (properly).\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\n| Sage Version 5.6.beta1, Release Date: 2012-12-27                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nsage: from sage.tests.interrupt import unguarded_dereference_null_pointer\nsage: unguarded_dereference_null_pointer()\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fffc1f9d04a in __pyx_f_4sage_5tests_9interrupt_dereference_null_pointer ()\n    at sage/tests/interrupt.c:894\n894\t  (__pyx_v_ptr[__pyx_t_1]) = ((__pyx_v_ptr[__pyx_t_1]) + 1);\n(gdb) cy list\n    59    # Dereference a NULL pointer on purpose. This signals a SIGSEGV on most\n    60    # systems, but on older Mac OS X and possibly other systems, this\n    61    # signals a SIGBUS instead. In any case, this should give some signal.\n    62    cdef void dereference_null_pointer():\n    63        cdef long* ptr = <long*>(0)\n>   64        ptr[0] += 1\n    65    \n    66    \n    67    ########################################################################\n    68    # Python helper functions                                              #\n```\n\nApply\n* [attachment:trac_13881_cython_debug_symbols.patch] to the Sage library\n* [attachment:trac_13881_launch_cygdb.patch] to the Sage root repository\n\nand then rebuild the sage libarary.\n\nAssignee: GeorgSWeber\n\nReviewer: Jeroen Demeyer\n\nAuthor: Volker Braun\n\nMerged: sage-5.6.beta3\n\nDependencies: #13669\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13881\n\n",
    "closed_at": "2013-01-07T20:57:54Z",
    "created_at": "2012-12-29T20:56:51Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Enhanced debugging: cygdb and better backtraces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13881",
    "user": "https://github.com/vbraun"
}
```
The purpose of these patches is to make cython emit debugging output (unless `SAGE_DEBUG=no` since it only costs some disk space) and run cygdb instead of gdb for `sage --gdb` (unless `SAGE_DEBUG=no`, in which case you get the plain gdb). cydbg can be a bit slow to start up, but gives cython source-level debugging. For example:

```
[vbraun@volker-desktop sage-5.6.beta1]$ SAGE_DEBUG=yes ./sage -gdb
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
GNU gdb (GDB) 7.5.1
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-unknown-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /home/vbraun/opt/sage-5.6.beta1/local/bin/python...done.
Python was not compiled with debug symbols (or it was stripped). Some functionality may not work (properly).
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
| Sage Version 5.6.beta1, Release Date: 2012-12-27                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
sage: from sage.tests.interrupt import unguarded_dereference_null_pointer
sage: unguarded_dereference_null_pointer()

Program received signal SIGSEGV, Segmentation fault.
0x00007fffc1f9d04a in __pyx_f_4sage_5tests_9interrupt_dereference_null_pointer ()
    at sage/tests/interrupt.c:894
894	  (__pyx_v_ptr[__pyx_t_1]) = ((__pyx_v_ptr[__pyx_t_1]) + 1);
(gdb) cy list
    59    # Dereference a NULL pointer on purpose. This signals a SIGSEGV on most
    60    # systems, but on older Mac OS X and possibly other systems, this
    61    # signals a SIGBUS instead. In any case, this should give some signal.
    62    cdef void dereference_null_pointer():
    63        cdef long* ptr = <long*>(0)
>   64        ptr[0] += 1
    65    
    66    
    67    ########################################################################
    68    # Python helper functions                                              #
```

Apply
* [attachment:trac_13881_cython_debug_symbols.patch] to the Sage library
* [attachment:trac_13881_launch_cygdb.patch] to the Sage root repository

and then rebuild the sage libarary.

Assignee: GeorgSWeber

Reviewer: Jeroen Demeyer

Author: Volker Braun

Merged: sage-5.6.beta3

Dependencies: #13669

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13881





---

archive/issue_comments_169232.json:
```json
{
    "body": "<a id='comment:1'></a>* Make Cython emit debugging information (unless `SAGE_DEBUG=no`). This costs only a bit of disk space.",
    "created_at": "2012-12-29T21:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169232",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>* Make Cython emit debugging information (unless `SAGE_DEBUG=no`). This costs only a bit of disk space.



---

archive/issue_comments_169233.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-30T10:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169233",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_169234.json:
```json
{
    "body": "<a id='comment:3'></a>Rediffed, was accidentally based on an old version of #13669",
    "created_at": "2012-12-30T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169234",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>Rediffed, was accidentally based on an old version of #13669



---

archive/issue_comments_169235.json:
```json
{
    "body": "<a id='comment:5'></a>Any reason why you don't always use `cygdb` instead of `gdb`?\n\nAlso, while you're at it, can you change\n\n```\npython `which cython`\n```\nby\n\n```\ncython\n```",
    "created_at": "2012-12-31T10:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169235",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Any reason why you don't always use `cygdb` instead of `gdb`?

Also, while you're at it, can you change

```
python `which cython`
```
by

```
cython
```



---

archive/issue_comments_169236.json:
```json
{
    "body": "<a id='comment:6'></a>I wouldn't mind always using cygdb, but there might be compatibility issues with gdb versions as the Python support needs a relatively new version. How about we default to cygdb unless `SAGE_DEBUG=no`?",
    "created_at": "2012-12-31T10:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169236",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>I wouldn't mind always using cygdb, but there might be compatibility issues with gdb versions as the Python support needs a relatively new version. How about we default to cygdb unless `SAGE_DEBUG=no`?



---

archive/issue_comments_169237.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-12-31T10:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169237",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_169238.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [trac_13881_cython_debug_symbols.patch](tarball://root/attachments/some-uuid/ticket13881/trac_13881_cython_debug_symbols.patch) by @vbraun created at 2012-12-31 10:42:56",
    "created_at": "2012-12-31T10:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169238",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Attachment [trac_13881_cython_debug_symbols.patch](tarball://root/attachments/some-uuid/ticket13881/trac_13881_cython_debug_symbols.patch) by @vbraun created at 2012-12-31 10:42:56



---

archive/issue_comments_169239.json:
```json
{
    "body": "<a id='comment:8'></a>[attachment:trac_13881_launch_cygdb.patch] doesn't apply for me. Even though I have #13669 applied on top of sage-5.6.b1.",
    "created_at": "2013-01-01T15:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169239",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>[attachment:trac_13881_launch_cygdb.patch] doesn't apply for me. Even though I have #13669 applied on top of sage-5.6.b1.



---

archive/issue_comments_169240.json:
```json
{
    "body": "<a id='comment:9'></a>Got it!\n\nI did not have the latest version of #13669 applied, but only a preliminary version with improper quotation marks. So, it should work<sup>(T)</sup> now.",
    "created_at": "2013-01-01T16:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169240",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>Got it!

I did not have the latest version of #13669 applied, but only a preliminary version with improper quotation marks. So, it should work<sup>(T)</sup> now.



---

archive/issue_comments_169241.json:
```json
{
    "body": "<a id='comment:10'></a>What needs to be done in order to make it work?\n\nI have now both patches applied, did sage -b, but sage -gdb gives me\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nUsage: cygdb [PATH [GDB_ARGUMENTS]].\nNo debug files were found in /home/simon/SAGE/debug/sage-5.6.beta1/devel/sage. Aborting.\n```",
    "created_at": "2013-01-01T16:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169241",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>What needs to be done in order to make it work?

I have now both patches applied, did sage -b, but sage -gdb gives me

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
Usage: cygdb [PATH [GDB_ARGUMENTS]].
No debug files were found in /home/simon/SAGE/debug/sage-5.6.beta1/devel/sage. Aborting.
```



---

archive/issue_comments_169242.json:
```json
{
    "body": "<a id='comment:11'></a>You need to rebuild the Sage library once (`sage -ba`)",
    "created_at": "2013-01-01T16:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169242",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>You need to rebuild the Sage library once (`sage -ba`)



---

archive/issue_comments_169243.json:
```json
{
    "body": "<a id='comment:13'></a>You should use spaces instead of TABs for indentation in [attachment:trac_13881_launch_cygdb.patch]",
    "created_at": "2013-01-04T09:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169243",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>You should use spaces instead of TABs for indentation in [attachment:trac_13881_launch_cygdb.patch]



---

archive/issue_comments_169244.json:
```json
{
    "body": "<a id='comment:14'></a>There was another place where tabs where used for indentation, fixed that as well.",
    "created_at": "2013-01-04T14:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169244",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>There was another place where tabs where used for indentation, fixed that as well.



---

archive/issue_comments_169245.json:
```json
{
    "body": "<a id='comment:15'></a>Those other TABs are already fixed by #13899, so I'm removing that hunk.",
    "created_at": "2013-01-04T20:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169245",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Those other TABs are already fixed by #13899, so I'm removing that hunk.



---

archive/issue_comments_169246.json:
```json
{
    "body": "Attachment [trac_13881_launch_cygdb.patch](tarball://root/attachments/some-uuid/ticket13881/trac_13881_launch_cygdb.patch) by @jdemeyer created at 2013-01-04 20:58:04\n\nUpdated patch",
    "created_at": "2013-01-04T20:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169246",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_13881_launch_cygdb.patch](tarball://root/attachments/some-uuid/ticket13881/trac_13881_launch_cygdb.patch) by @jdemeyer created at 2013-01-04 20:58:04

Updated patch



---

archive/issue_comments_169247.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-07T09:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169247",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_038948.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-07T20:57:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13881#event-38948"
}
```



---

archive/issue_comments_169248.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-07T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13881",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13881#issuecomment-169248",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
