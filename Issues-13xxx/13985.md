# Issue 13985: Fix doctests that want write access to $HOME

archive/issues_013781.json:
```json
{
    "assignees": [],
    "body": "In order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).\n\nIn #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.\n\n**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)\n\nDepends on #13992\n\nCC:  @kiwifb\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.7.beta1**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13985_\n\n",
    "closed_at": "2013-01-25T21:20:14Z",
    "created_at": "2013-01-22T14:05:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix doctests that want write access to $HOME",
    "type": "issue",
    "updated_at": "2013-02-05T20:29:17Z",
    "url": "https://github.com/sagemath/sage/issues/13985",
    "user": "https://github.com/jdemeyer"
}
```
In order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).

In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.

**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)

Depends on #13992

CC:  @kiwifb

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **François Bissey**

Author: **Jeroen Demeyer**

Merged: **sage-5.7.beta1**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/13985_





---

archive/issue_events_196493.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-22T14:05:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196493"
}
```



---

archive/issue_events_196494.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-22T14:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196494"
}
```



---

archive/issue_events_196495.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-22T14:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196495"
}
```



---

archive/issue_events_196496.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-22T14:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196496"
}
```



---

archive/issue_comments_165626.json:
```json
{
    "body": "Diff for the SciPy spkg, for review only",
    "created_at": "2013-01-22T14:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165626",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the SciPy spkg, for review only



---

archive/issue_comments_165627.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n In order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).\n \n In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.\n+\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)\n``````\n",
    "created_at": "2013-01-22T14:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165627",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 In order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).
 
 In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.
+
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)
``````




---

archive/issue_comments_165628.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[scipy-0.11.0.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13985/scipy-0.11.0.p0.diff.gz)**",
    "created_at": "2013-01-22T14:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165628",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[scipy-0.11.0.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13985/scipy-0.11.0.p0.diff.gz)**



---

archive/issue_events_196497.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-22T19:41:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196497"
}
```



---

archive/issue_comments_165629.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNot using sage_fortran anymore is good. i am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct? This is very important for scipy (which will test for any fortran compiler that it knows off including the ones broken because they don't have a license).  Is weave the only file to want access to .pythonxx_compiled? Sounds like an upstream bug to me in any case. I'll give this a closer look from something else than an iPad before approving.",
    "created_at": "2013-01-22T20:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165629",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Not using sage_fortran anymore is good. i am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct? This is very important for scipy (which will test for any fortran compiler that it knows off including the ones broken because they don't have a license).  Is weave the only file to want access to .pythonxx_compiled? Sounds like an upstream bug to me in any case. I'll give this a closer look from something else than an iPad before approving.



---

archive/issue_comments_165630.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@kiwifb](#comment:4):\n> Is weave the only file to want access to .pythonxx_compiled?\n\nYes.\n\n> Sounds like an upstream bug to me in any case.\n\nAgreed.",
    "created_at": "2013-01-22T20:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165630",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@kiwifb](#comment:4):
> Is weave the only file to want access to .pythonxx_compiled?

Yes.

> Sounds like an upstream bug to me in any case.

Agreed.



---

archive/issue_comments_165631.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@kiwifb](#comment:4):\n> I am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct?\n\nNot quite.  If the GCC spkg is installed, then yes, we force the use of Sage's `gfortran`.  If it's not installed, we don't set any variables and let `scipy` figure it out.  That sounds reasonable and in any case seems to work fine for the `R` spkg.",
    "created_at": "2013-01-22T20:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165631",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@kiwifb](#comment:4):
> I am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct?

Not quite.  If the GCC spkg is installed, then yes, we force the use of Sage's `gfortran`.  If it's not installed, we don't set any variables and let `scipy` figure it out.  That sounds reasonable and in any case seems to work fine for the `R` spkg.



---

archive/issue_comments_165632.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.\n \n+**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)\n+\n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)\n``````\n",
    "created_at": "2013-01-22T20:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165632",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.
 
+**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)
+
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)
``````




---

archive/issue_comments_165633.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2013-01-22T20:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165633",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_165634.json:
```json
{
    "body": "Dependencies: **#13992**",
    "created_at": "2013-01-23T07:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165634",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#13992**



---

archive/issue_comments_165635.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe Fortran stuff has problems indeed, it seems that SCons does The Wrong Thing on OpenSolaris (which just proves my point again that SCons is utter crap compared to an autotools-based system, R for example compiles Fortran code just fine).",
    "created_at": "2013-01-23T07:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165635",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

The Fortran stuff has problems indeed, it seems that SCons does The Wrong Thing on OpenSolaris (which just proves my point again that SCons is utter crap compared to an autotools-based system, R for example compiles Fortran code just fine).



---

archive/issue_comments_165636.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt would be easy to make this ticket  a !SCons bashing exercise (I am sure your expressed opinion is watered down compared to your real one and I would be agreeing to the non-watered down too).",
    "created_at": "2013-01-23T08:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165636",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

It would be easy to make this ticket  a !SCons bashing exercise (I am sure your expressed opinion is watered down compared to your real one and I would be agreeing to the non-watered down too).



---

archive/issue_comments_165637.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2013-01-24T07:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165637",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_165638.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFran\u00e7ois: any chance you can review this, now that the Fortran problem is solved?",
    "created_at": "2013-01-25T15:29:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165638",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

François: any chance you can review this, now that the Fortran problem is solved?



---

archive/issue_comments_165639.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSince upstream has approved the patch and all the other issues have been dealt with, I am reviewing this positive. I was going to do test builds but you do more of these than me :)",
    "created_at": "2013-01-25T19:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165639",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">comment:12</div>

Since upstream has approved the patch and all the other issues have been dealt with, I am reviewing this positive. I was going to do test builds but you do more of these than me :)



---

archive/issue_events_196498.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-01-25T19:12:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196498"
}
```



---

archive/issue_events_196499.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-01-25T19:12:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196499"
}
```



---

archive/issue_comments_165640.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2013-01-25T19:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165640",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_events_196500.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-25T21:20:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196500"
}
```



---

archive/issue_events_196501.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-25T21:20:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13985#event-196501"
}
```



---

archive/issue_comments_165641.json:
```json
{
    "body": "Merged: **sage-5.7.beta1**",
    "created_at": "2013-01-25T21:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165641",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.7.beta1**



---

archive/issue_comments_165642.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2013-02-05T20:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13985#issuecomment-165642",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**
