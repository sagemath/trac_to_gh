# Issue 13981: Faster int -> Integer coercion for common ints

archive/issues_013777.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Defaulting to the same range as Python, namely [-5, 256]. \n\nDepends on #12615\n\nBranch/Commit: **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**\n\nReviewer: **Paul Zimmermann, Marc Mezzarobba**\n\nAuthor: **Robert Bradshaw**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13981_\n\n",
    "closed_at": "2014-03-02T16:15:22Z",
    "created_at": "2013-01-22T05:37:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster int -> Integer coercion for common ints",
    "type": "issue",
    "updated_at": "2014-03-02T16:15:22Z",
    "url": "https://github.com/sagemath/sage/issues/13981",
    "user": "https://github.com/robertwb"
}
```
Defaulting to the same range as Python, namely [-5, 256]. 

Depends on #12615

Branch/Commit: **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**

Reviewer: **Paul Zimmermann, Marc Mezzarobba**

Author: **Robert Bradshaw**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/13981_





---

archive/issue_events_197238.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-01-22T05:37:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197238"
}
```



---

archive/issue_events_197239.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-01-22T05:37:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197239"
}
```



---

archive/issue_events_197240.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-01-22T05:37:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197240"
}
```



---

archive/issue_events_197241.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-01-22T05:37:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197241"
}
```



---

archive/issue_events_197242.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2013-01-22T05:37:43Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197242"
}
```



---

archive/issue_comments_165481.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[13981-fast-int-ZZ.patch.gz](https://github.com/sagemath/sage/files/ticket13981/13981-fast-int-ZZ.patch.gz)**",
    "created_at": "2013-01-22T06:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165481",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[13981-fast-int-ZZ.patch.gz](https://github.com/sagemath/sage/files/ticket13981/13981-fast-int-ZZ.patch.gz)**



---

archive/issue_events_197243.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-01-22T06:27:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197243"
}
```



---

archive/issue_comments_165482.json:
```json
{
    "body": "Attachment: **[13981-fast-int-ZZ-doctests.patch.gz](https://github.com/sagemath/sage/files/ticket13981/13981-fast-int-ZZ-doctests.patch.gz)**",
    "created_at": "2013-01-22T23:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165482",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[13981-fast-int-ZZ-doctests.patch.gz](https://github.com/sagemath/sage/files/ticket13981/13981-fast-int-ZZ-doctests.patch.gz)**



---

archive/issue_comments_165483.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nRobert, please could you explain the rationale behind this ticket?\nAlso, any hint on how to review it would be welcome. Is there any standard efficiency test?\n\nPaul",
    "created_at": "2013-01-23T08:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165483",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:2" align="right">comment:2</div>

Robert, please could you explain the rationale behind this ticket?
Also, any hint on how to review it would be welcome. Is there any standard efficiency test?

Paul



---

archive/issue_events_197244.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-01-23T08:12:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197244"
}
```



---

archive/issue_events_197245.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-01-23T08:12:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197245"
}
```



---

archive/issue_comments_165484.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nRobert, the first patch failed to apply to 5.5:\n\n```\nsage: hg_sage.import_patch(\"/tmp/13981-fast-int-ZZ.patch\")\ncd \"/localdisk/tmp/sage-5.5/devel/sage\" && sage --hg import   \"/tmp/13981-fast-int-ZZ.patch\"\napplying /tmp/13981-fast-int-ZZ.patch\npatching file sage/rings/integer.pyx\nHunk #1 FAILED at 5666\n1 out of 2 hunks FAILED -- saving rejects to file sage/rings/integer.pyx.rej\nabort: patch failed to apply\n```\nPaul",
    "created_at": "2013-01-23T08:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165484",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:3" align="right">comment:3</div>

Robert, the first patch failed to apply to 5.5:

```
sage: hg_sage.import_patch("/tmp/13981-fast-int-ZZ.patch")
cd "/localdisk/tmp/sage-5.5/devel/sage" && sage --hg import   "/tmp/13981-fast-int-ZZ.patch"
applying /tmp/13981-fast-int-ZZ.patch
patching file sage/rings/integer.pyx
Hunk #1 FAILED at 5666
1 out of 2 hunks FAILED -- saving rejects to file sage/rings/integer.pyx.rej
abort: patch failed to apply
```
Paul



---

archive/issue_comments_165485.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nTicket #12615 is a dependency, you need to apply that first. \n\nI can't think of any standard efficiency tests, but this is most useful when creating a large number of small Sage integers. For example, \n\nBefore:\n\n```\nsage: sage: E = EllipticCurve('37a')             \nsage: sage: v = E.anlist(10000, python_ints=True)\nsage: sage: %timeit [ZZ(a) for a in v]           \n25 loops, best of 3: 15.5 ms per loop\n```\n\nAfter:\n\n```\nsage: E = EllipticCurve('37a')             \nsage: v = E.anlist(10000, python_ints=True)\nsage: %timeit [ZZ(a) for a in v]           \n25 loops, best of 3: 12.8 ms per loop\n```\n\nIt'll be faster elsewhere, but it's mostly a tiny improvement all over the place. Startup time may also be slightly improved (despite initializing the pool). The most important is to review the code for correctness (and of course verify the tests pass).",
    "created_at": "2013-01-23T17:45:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165485",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:4" align="right">comment:4</div>

Ticket #12615 is a dependency, you need to apply that first. 

I can't think of any standard efficiency tests, but this is most useful when creating a large number of small Sage integers. For example, 

Before:

```
sage: sage: E = EllipticCurve('37a')             
sage: sage: v = E.anlist(10000, python_ints=True)
sage: sage: %timeit [ZZ(a) for a in v]           
25 loops, best of 3: 15.5 ms per loop
```

After:

```
sage: E = EllipticCurve('37a')             
sage: v = E.anlist(10000, python_ints=True)
sage: %timeit [ZZ(a) for a in v]           
25 loops, best of 3: 12.8 ms per loop
```

It'll be faster elsewhere, but it's mostly a tiny improvement all over the place. Startup time may also be slightly improved (despite initializing the pool). The most important is to review the code for correctness (and of course verify the tests pass).



---

archive/issue_comments_165486.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRobert, I see nothing wrong in this patch, except the description says `[-1, 256]` but the code says `[-5, 256]`. Where is the default Python range documented?\n\nPaul",
    "created_at": "2013-01-24T08:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165486",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:5" align="right">comment:5</div>

Robert, I see nothing wrong in this patch, except the description says `[-1, 256]` but the code says `[-5, 256]`. Where is the default Python range documented?

Paul



---

archive/issue_comments_165487.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nall doctests pass. The only issue is that in comment [comment:5].\n\nPaul",
    "created_at": "2013-01-24T09:23:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165487",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:6" align="right">comment:6</div>

all doctests pass. The only issue is that in comment [comment:5].

Paul



---

archive/issue_events_197246.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197246"
}
```



---

archive/issue_events_197247.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197247"
}
```



---

archive/issue_comments_165488.json:
```json
{
    "body": "Branch: **[u/robertwb/ticket/13981](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/13981)**",
    "created_at": "2014-01-28T05:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165488",
    "user": "https://github.com/robertwb"
}
```

Branch: **[u/robertwb/ticket/13981](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/13981)**



---

archive/issue_events_197248.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2014-01-28T05:09:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197248"
}
```



---

archive/issue_events_197249.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2014-01-28T05:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197249"
}
```



---

archive/issue_comments_165489.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc527f273168bf1be3aeaf01d43db0f3b6582fc1\"><code>bc527f2</code></a></td><td><code>Faster int -> ZZ coercions using a pool.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7\"><code>6dbeaa1</code></a></td><td><code>Small refinements, clarification.</code></td></tr></table>\n",
    "created_at": "2014-01-28T05:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165489",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:9"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc527f273168bf1be3aeaf01d43db0f3b6582fc1"><code>bc527f2</code></a></td><td><code>Faster int -> ZZ coercions using a pool.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7"><code>6dbeaa1</code></a></td><td><code>Small refinements, clarification.</code></td></tr></table>




---

archive/issue_comments_165490.json:
```json
{
    "body": "Commit: **[`6dbeaa1`](https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7)**",
    "created_at": "2014-01-28T05:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165490",
    "user": "https://github.com/robertwb"
}
```

Commit: **[`6dbeaa1`](https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7)**



---

archive/issue_comments_165491.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Defaulting to the same range as Python, namely [-1, 256]. \n+Defaulting to the same range as Python, namely [-5, 256]. \n``````\n",
    "created_at": "2014-01-28T05:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165491",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Defaulting to the same range as Python, namely [-1, 256]. 
+Defaulting to the same range as Python, namely [-5, 256]. 
``````




---

archive/issue_comments_165492.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI think this should be fixed also. Otherwise, I don't really see the point.\n\n```\nsage: 20 is 20\nFalse\n```",
    "created_at": "2014-01-28T17:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165492",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

I think this should be fixed also. Otherwise, I don't really see the point.

```
sage: 20 is 20
False
```



---

archive/issue_events_197250.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-28T17:15:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197250"
}
```



---

archive/issue_events_197251.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-28T17:15:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197251"
}
```



---

archive/issue_comments_165493.json:
```json
{
    "body": "Changed commit from **[`6dbeaa1`](https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7)** to **[`47fa846`](https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056)**",
    "created_at": "2014-01-30T12:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165493",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6dbeaa1`](https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7)** to **[`47fa846`](https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056)**



---

archive/issue_comments_165494.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056\"><code>47fa846</code></a></td><td><code>Fix mutation of cached Integer.</code></td></tr></table>\n",
    "created_at": "2014-01-30T12:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165494",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056"><code>47fa846</code></a></td><td><code>Fix mutation of cached Integer.</code></td></tr></table>




---

archive/issue_events_197252.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197252"
}
```



---

archive/issue_events_197253.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197253"
}
```



---

archive/issue_events_197254.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2014-02-04T04:58:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197254"
}
```



---

archive/issue_events_197255.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2014-02-04T04:58:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197255"
}
```



---

archive/issue_comments_165495.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis helps for all the coercions. I did a bit of playing around with `Integer(20) is Integer(20)` and a bunch of stuff broke (probably due to people mutating `Integer(0)` for example), so let's split that off as a separate feature request. (By the time you get there you've already committed to making a new Integer..",
    "created_at": "2014-02-04T04:58:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165495",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:14" align="right">comment:14</div>

This helps for all the coercions. I did a bit of playing around with `Integer(20) is Integer(20)` and a bunch of stuff broke (probably due to people mutating `Integer(0)` for example), so let's split that off as a separate feature request. (By the time you get there you've already committed to making a new Integer..



---

archive/issue_comments_165496.json:
```json
{
    "body": "Changed branch from **[u/robertwb/ticket/13981](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/13981)** to **[u/mmezarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezarobba/13981-small_int)**",
    "created_at": "2014-02-22T22:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165496",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/robertwb/ticket/13981](https://github.com/sagemath/sagetrac-mirror/tree/u/robertwb/ticket/13981)** to **[u/mmezarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezarobba/13981-small_int)**



---

archive/issue_comments_165497.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2014-02-22T22:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165497",
    "user": "https://github.com/mezzarobba"
}
```

Author: **Robert Bradshaw**



---

archive/issue_comments_165498.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI fixed a typo and saved a few more cycles (I think) by changing two `cdef long`s into `DEF`s. The branch merges cleanly and all tests pass. Can you please check the changes and set the ticket to positive review (after reverting my patch if you disagree)?",
    "created_at": "2014-02-22T22:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165498",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

I fixed a typo and saved a few more cycles (I think) by changing two `cdef long`s into `DEF`s. The branch merges cleanly and all tests pass. Can you please check the changes and set the ticket to positive review (after reverting my patch if you disagree)?



---

archive/issue_comments_165499.json:
```json
{
    "body": "Reviewer: **Paul Zimmermann, Marc Mezzarobba**",
    "created_at": "2014-02-22T22:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165499",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Paul Zimmermann, Marc Mezzarobba**



---

archive/issue_comments_165500.json:
```json
{
    "body": "Changed commit from **[`47fa846`](https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056)** to none",
    "created_at": "2014-02-22T22:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165500",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`47fa846`](https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056)** to none



---

archive/issue_comments_165501.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nsorry with the change to git I don't know how to review that ticket (and no time currently to learn how to)\n\nPaul",
    "created_at": "2014-02-25T08:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165501",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:16" align="right">comment:16</div>

sorry with the change to git I don't know how to review that ticket (and no time currently to learn how to)

Paul



---

archive/issue_comments_165502.json:
```json
{
    "body": "Changed branch from **[u/mmezarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezarobba/13981-small_int)** to **[u/mmezzarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13981-small_int)**",
    "created_at": "2014-02-25T10:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165502",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/mmezarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezarobba/13981-small_int)** to **[u/mmezzarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13981-small_int)**



---

archive/issue_comments_165503.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc527f273168bf1be3aeaf01d43db0f3b6582fc1\"><code>bc527f2</code></a></td><td><code>Faster int -> ZZ coercions using a pool.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7\"><code>6dbeaa1</code></a></td><td><code>Small refinements, clarification.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056\"><code>47fa846</code></a></td><td><code>Fix mutation of cached Integer.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850\"><code>9ab4bd0</code></a></td><td><code>#13981 reviewer patch</code></td></tr></table>\n",
    "created_at": "2014-02-25T10:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165503",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:17"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc527f273168bf1be3aeaf01d43db0f3b6582fc1"><code>bc527f2</code></a></td><td><code>Faster int -> ZZ coercions using a pool.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6dbeaa1df723103a3b1014fd1195c20c6ca878f7"><code>6dbeaa1</code></a></td><td><code>Small refinements, clarification.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47fa84600b5b09478f1474cb52c7c9906e71a056"><code>47fa846</code></a></td><td><code>Fix mutation of cached Integer.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850"><code>9ab4bd0</code></a></td><td><code>#13981 reviewer patch</code></td></tr></table>




---

archive/issue_comments_165504.json:
```json
{
    "body": "Commit: **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**",
    "created_at": "2014-02-25T10:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165504",
    "user": "https://github.com/mezzarobba"
}
```

Commit: **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**



---

archive/issue_comments_165505.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n[Hmm, there was a typo in the branch name, sorry for that.]\n\nReplying to [@zimmermann6](#comment:16):\n> sorry with the change to git I don't know how to review that ticket (and no time currently to learn how to)\n\nI think all that remains to do is for someone to have a look at my patch (https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850).\n\nIf you want to test it:\n* checkout the corresponding branch (using something like `git checkout trac/u/mmezzarobba/13981-small_int`);\n* optionally, merge in the main development branch (`git merge develop`);\n* rebuild sage, test;\n* use `git checkout master` or `git checkout develop` to go back to the mainline when you are done.",
    "created_at": "2014-02-25T10:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165505",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:18" align="right">comment:18</div>

[Hmm, there was a typo in the branch name, sorry for that.]

Replying to [@zimmermann6](#comment:16):
> sorry with the change to git I don't know how to review that ticket (and no time currently to learn how to)

I think all that remains to do is for someone to have a look at my patch (https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850).

If you want to test it:
* checkout the corresponding branch (using something like `git checkout trac/u/mmezzarobba/13981-small_int`);
* optionally, merge in the main development branch (`git merge develop`);
* rebuild sage, test;
* use `git checkout master` or `git checkout develop` to go back to the mainline when you are done.



---

archive/issue_comments_165506.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYour change looks fine to me.",
    "created_at": "2014-02-25T18:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165506",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:19" align="right">comment:19</div>

Your change looks fine to me.



---

archive/issue_events_197256.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-25T20:33:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197256"
}
```



---

archive/issue_events_197257.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-02-25T20:33:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197257"
}
```



---

archive/issue_comments_165507.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nMarc, where should I do `git checkout ...`?\n\n```\ntarte% pwd\n/localdisk/tmp/sage-6.0\ntarte% git checkout trac/u/mmezzarobba/13981-small_int\nerror: pathspec 'trac/u/mmezzarobba/13981-small_int' did not match any file(s) known to git.\n```",
    "created_at": "2014-02-26T08:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165507",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:21" align="right">comment:21</div>

Marc, where should I do `git checkout ...`?

```
tarte% pwd
/localdisk/tmp/sage-6.0
tarte% git checkout trac/u/mmezzarobba/13981-small_int
error: pathspec 'trac/u/mmezzarobba/13981-small_int' did not match any file(s) known to git.
```



---

archive/issue_comments_165508.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n`sage -dev checkout --ticket=13981` or within sage: `dev.checkout(ticket='13981')`",
    "created_at": "2014-02-26T08:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165508",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

`sage -dev checkout --ticket=13981` or within sage: `dev.checkout(ticket='13981')`



---

archive/issue_comments_165509.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nmany thanks!\n\nPaul",
    "created_at": "2014-02-26T09:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165509",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:23" align="right">comment:23</div>

many thanks!

Paul



---

archive/issue_comments_165510.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI confirm the speedup on my machine.\n\nVanilla 6.0:\n\n```\nsage: sage: E = EllipticCurve('37a')    \nsage: v = E.anlist(10000, python_ints=True)\nsage: %timeit [ZZ(a) for a in v]       \n100 loops, best of 3: 15.3 ms per loop\n```\n\nWith the patch applied:\n\n```\nsage: sage: E = EllipticCurve('37a')    \nsage: v = E.anlist(10000, python_ints=True)\nsage: %timeit [ZZ(a) for a in v]       \n100 loops, best of 3: 13.2 ms per loop\n```\nPaul",
    "created_at": "2014-02-26T09:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165510",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:24" align="right">comment:24</div>

I confirm the speedup on my machine.

Vanilla 6.0:

```
sage: sage: E = EllipticCurve('37a')    
sage: v = E.anlist(10000, python_ints=True)
sage: %timeit [ZZ(a) for a in v]       
100 loops, best of 3: 15.3 ms per loop
```

With the patch applied:

```
sage: sage: E = EllipticCurve('37a')    
sage: v = E.anlist(10000, python_ints=True)
sage: %timeit [ZZ(a) for a in v]       
100 loops, best of 3: 13.2 ms per loop
```
Paul



---

archive/issue_events_197258.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-02T16:15:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197258"
}
```



---

archive/issue_events_197259.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4aaae777ceee535afada3767a0e2f18ac66ef192",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-03-02T16:15:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13981#event-197259"
}
```



---

archive/issue_comments_165511.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13981-small_int)** to **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**",
    "created_at": "2014-03-02T16:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13981#issuecomment-165511",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmezzarobba/13981-small_int](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/13981-small_int)** to **[`9ab4bd0`](https://github.com/sagemath/sagetrac-mirror/commit/9ab4bd04dfac93d95c7b169be62a3054f2eef850)**
