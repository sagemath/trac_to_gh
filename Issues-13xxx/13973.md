# Issue 13973: Upgrade Maxima to 5.33.0

archive/issues_013769.json:
```json
{
    "body": "This is a continuation of #13364, and aims at including more upstream bug fixes, which e.g. fix an\n[issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \nwhich was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n\nFixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n\nOught to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).\n\nOught to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).\n\nDoes not fix #14591, #14677, #15033.\n\n**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n\nNote about the existing `maxima_bug_2526.patch`: \u200bthe bug was marked \"closed\" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.\n\n**CC:**  Snark\n\n**Keywords:** sd48\n\n**Branch:** [a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)\n\n**Reviewer:** Marc Mezzarobba\n\n**Author:** Peter Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/13973\n\n",
    "closed_at": "2014-05-25T17:31:52Z",
    "created_at": "2013-01-19T12:29:28Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "title": "Upgrade Maxima to 5.33.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13973",
    "user": "https://github.com/dimpase"
}
```
This is a continuation of #13364, and aims at including more upstream bug fixes, which e.g. fix an
[issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.

Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.

Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).

Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).

Does not fix #14591, #14677, #15033.

**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)

Note about the existing `maxima_bug_2526.patch`: â€‹the bug was marked "closed" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.

**CC:**  Snark

**Keywords:** sd48

**Branch:** [a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)

**Reviewer:** Marc Mezzarobba

**Author:** Peter Bruin

Issue created by migration from https://trac.sagemath.org/ticket/13973





---

archive/issue_comments_167723.json:
```json
{
    "body": "**Changing dependencies** from \"13364\" to \"#13364\".",
    "created_at": "2013-01-20T01:35:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167723",
    "user": "https://github.com/kcrisman"
}
```

**Changing dependencies** from "13364" to "#13364".



---

archive/issue_comments_167724.json:
```json
{
    "body": "<a id='comment:2'></a>\nSo for instance going at least as far as the fix for #13733 would be good.",
    "created_at": "2013-01-20T01:39:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167724",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
So for instance going at least as far as the fix for #13733 would be good.



---

archive/issue_comments_167725.json:
```json
{
    "body": "<a id='comment:3'></a>\nwhile we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:\n\n```\nFile \"/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py\", line 422:\n    sage: maxima.version()\nExpected:\n    '5.26.0'\nGot:\n    '5.29.1'\n```\nWhat really matters is the **functionality** provided, not the actual version?\nDoes Sage check the actual version of each component?\n\nPaul",
    "created_at": "2013-01-23T08:08:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167725",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:3'></a>
while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:

```
File "/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py", line 422:
    sage: maxima.version()
Expected:
    '5.26.0'
Got:
    '5.29.1'
```
What really matters is the **functionality** provided, not the actual version?
Does Sage check the actual version of each component?

Paul



---

archive/issue_comments_167726.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [zimmerma](#comment%3A3):\n> while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:\n> \n> ```\n> File \"/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py\", line 422:\n>     sage: maxima.version()\n> Expected:\n>     '5.26.0'\n> Got:\n>     '5.29.1'\n> ```\n\n\nseems that https://github.com/sagemath/sage/files/ticket13364/doctests.2.patch\nwas not installed into the Sage installation you work with.\n\n> What really matters is the **functionality** provided, not the actual version?\n> Does Sage check the actual version of each component?\n\n\nSage provides versions at least for some other components, e.g. `gap.version()`\n\nSometimes it might be useful; AFAIK some optional packages check this.\n\nDima\n\n\n> \n> Paul\n",
    "created_at": "2013-01-23T09:45:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167726",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
Replying to [zimmerma](#comment%3A3):
> while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:
> 
> ```
> File "/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py", line 422:
>     sage: maxima.version()
> Expected:
>     '5.26.0'
> Got:
>     '5.29.1'
> ```


seems that https://github.com/sagemath/sage/files/ticket13364/doctests.2.patch
was not installed into the Sage installation you work with.

> What really matters is the **functionality** provided, not the actual version?
> Does Sage check the actual version of each component?


Sage provides versions at least for some other components, e.g. `gap.version()`

Sometimes it might be useful; AFAIK some optional packages check this.

Dima


> 
> Paul




---

archive/issue_comments_167727.json:
```json
{
    "body": "<a id='comment:5'></a>\nDima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.\n\nPaul",
    "created_at": "2013-01-23T10:15:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167727",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.

Paul



---

archive/issue_comments_167728.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [zimmerma](#comment%3A5):\n> Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.\n> \n\n\nwell, one would like to test Sage functions... How else would you check that it works and returns something meaningful?\n\n> Paul\n",
    "created_at": "2013-01-23T12:33:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167728",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
Replying to [zimmerma](#comment%3A5):
> Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.
> 


well, one would like to test Sage functions... How else would you check that it works and returns something meaningful?

> Paul




---

archive/issue_comments_167729.json:
```json
{
    "body": "<a id='comment:7'></a>\nwe could for example check that the version is of the form `x.y.z`, or is greater than or equal to a given number.\n\nPaul",
    "created_at": "2013-01-23T12:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167729",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'></a>
we could for example check that the version is of the form `x.y.z`, or is greater than or equal to a given number.

Paul



---

archive/issue_comments_167730.json:
```json
{
    "body": "<a id='comment:8'></a>\nsee #14306 (issue fixed in Maxima git)\n\nPaul",
    "created_at": "2013-05-07T08:54:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167730",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:8'></a>
see #14306 (issue fixed in Maxima git)

Paul



---

archive/issue_comments_167731.json:
```json
{
    "body": "<a id='comment:9'></a>\nAlso note that Maxima is now at 5.30.0.",
    "created_at": "2013-05-08T02:42:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167731",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Also note that Maxima is now at 5.30.0.



---

archive/issue_comments_167732.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes it is at 5.30.0. No check from sage-on-gentoo on whether it works so far because the maxima ecl library building is currently broken for that particular version - an adsf upgrade problem in gentoo.\n\nI second checking the form of the version returned rather than the value. That would make my life easier when R, maxima are upgraded in s-o-g independently of sage itself (and without side effects at leat in doctests).",
    "created_at": "2013-05-08T09:30:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167732",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Yes it is at 5.30.0. No check from sage-on-gentoo on whether it works so far because the maxima ecl library building is currently broken for that particular version - an adsf upgrade problem in gentoo.

I second checking the form of the version returned rather than the value. That would make my life easier when R, maxima are upgraded in s-o-g independently of sage itself (and without side effects at leat in doctests).



---

archive/issue_comments_167733.json:
```json
{
    "body": "<a id='comment:12'></a>\nI'll try making a new Maxima spkg just to see what happpens...",
    "created_at": "2013-06-13T08:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167733",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
I'll try making a new Maxima spkg just to see what happpens...



---

archive/issue_events_120061.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:57:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120061"
}
```



---

archive/issue_events_120062.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:57:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120062"
}
```



---

archive/issue_comments_167734.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2013-06-13T08:57:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167734",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_167735.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,4 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n``````\n",
    "created_at": "2013-06-13T08:57:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167735",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,4 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
``````




---

archive/issue_comments_167736.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n+\n+Fixes #13526, #14306, #13712, #14591, #14677.\n``````\n",
    "created_at": "2013-06-13T09:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167736",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
+
+Fixes #13526, #14306, #13712, #14591, #14677.
``````




---

archive/issue_comments_167737.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis looks problematic:\n\n```\nsage -t devel/sage/sage/calculus/calculus.py\n**********************************************************************\nFile \"devel/sage/sage/calculus/calculus.py\", line 145, in sage.calculus.calculus\nFailed example:\n    e^M\nException raised:\n    Traceback (most recent call last):\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n        exec compiled in globs\n      File \"<doctest sage.calculus.calculus[32]>\", line 1, in <module>\n        e**M\n      File \"constants_c.pyx\", line 275, in sage.symbolic.constants_c.E.__pow__ (sage/symbolic/constants_c.cpp:2779)\n      File \"matrix_symbolic_dense.pyx\", line 387, in sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense.exp (sage/matrix/matrix_symbolic_dense.c:3433)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 199, in __call__\n        return cls(self, x, name=name)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 626, in __init__\n        raise TypeError, x\n    TypeError: ECL says: Error executing code in Maxima: Unable to find the spectral representation\n**********************************************************************\n```",
    "created_at": "2013-06-13T09:30:54Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167737",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
This looks problematic:

```
sage -t devel/sage/sage/calculus/calculus.py
**********************************************************************
File "devel/sage/sage/calculus/calculus.py", line 145, in sage.calculus.calculus
Failed example:
    e^M
Exception raised:
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
        exec compiled in globs
      File "<doctest sage.calculus.calculus[32]>", line 1, in <module>
        e**M
      File "constants_c.pyx", line 275, in sage.symbolic.constants_c.E.__pow__ (sage/symbolic/constants_c.cpp:2779)
      File "matrix_symbolic_dense.pyx", line 387, in sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense.exp (sage/matrix/matrix_symbolic_dense.c:3433)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 199, in __call__
        return cls(self, x, name=name)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 626, in __init__
        raise TypeError, x
    TypeError: ECL says: Error executing code in Maxima: Unable to find the spectral representation
**********************************************************************
```



---

archive/issue_comments_167738.json:
```json
{
    "body": "<a id='comment:16'></a>\nAlso\n\n```\nsage -t devel/sage/sage/interfaces/maxima.py  # Time out\n```\ndue to a timeout of\n\n```\nsage: maxima('limit(x^a,x,0)')\n```\nThis is fixable, it is because of a slightly different output format of assumptions.",
    "created_at": "2013-06-13T09:36:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167738",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Also

```
sage -t devel/sage/sage/interfaces/maxima.py  # Time out
```
due to a timeout of

```
sage: maxima('limit(x^a,x,0)')
```
This is fixable, it is because of a slightly different output format of assumptions.



---

archive/issue_comments_167739.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, but not in a stable release.\" to \"\".",
    "created_at": "2013-06-13T09:58:08Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167739",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "Fixed upstream, but not in a stable release." to "".



---

archive/issue_comments_167740.json:
```json
{
    "body": "<a id='comment:18'></a>\nThat is awesome, thanks for checking this, Jeroen.",
    "created_at": "2013-06-13T14:13:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167740",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
That is awesome, thanks for checking this, Jeroen.



---

archive/issue_comments_167741.json:
```json
{
    "body": "<a id='comment:19'></a>\n> This is fixable, it is because of a slightly different output format of assumptions.\n\nJeroen, while it's true that the error is slightly different in format, I don't think this is the problem (or at least not the whole one).  The other things are still passing doctests, and we never even *get* to the \n\n```\n           if i > 0:\n                v = self._expect.before\n```\nbranch, as one can verify by inserting print statements.\n> This looks problematic:\n\nThis is #2400 again, to some extent.  Not sure why this doesn't work any more.  In Maxima 5.29.1, this is fine.\n\n```\nMaxima 5.29.1 http://maxima.sourceforge.net\nusing Lisp ECL 12.12.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) m: matrix([%i*%pi]);\n(%o1)                             [ %i %pi ]\n(%i4) matrixexp(m), keepfloat:true;\n(%o4)                                 - 1\n(%i5) matrixexp(m),keepfloat:false;\n(%o5)                                 - 1\n```\n\nwhich is good.  In 5.30, though, we have\n\n```\n(%i1) m: matrix([%i*%pi]);\n(%o1)                             [ %i %pi ]\n(%i6) matrixexp(m),keepfloat:true;\n\nUnable to find the spectral representation\n -- an error. To debug this try: debugmode(true);\n(%i7) matrixexp(m),keepfloat:false;\n\nUnable to find the spectral representation\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2013-06-18T18:30:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167741",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
> This is fixable, it is because of a slightly different output format of assumptions.

Jeroen, while it's true that the error is slightly different in format, I don't think this is the problem (or at least not the whole one).  The other things are still passing doctests, and we never even *get* to the 

```
           if i > 0:
                v = self._expect.before
```
branch, as one can verify by inserting print statements.
> This looks problematic:

This is #2400 again, to some extent.  Not sure why this doesn't work any more.  In Maxima 5.29.1, this is fine.

```
Maxima 5.29.1 http://maxima.sourceforge.net
using Lisp ECL 12.12.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) m: matrix([%i*%pi]);
(%o1)                             [ %i %pi ]
(%i4) matrixexp(m), keepfloat:true;
(%o4)                                 - 1
(%i5) matrixexp(m),keepfloat:false;
(%o5)                                 - 1
```

which is good.  In 5.30, though, we have

```
(%i1) m: matrix([%i*%pi]);
(%o1)                             [ %i %pi ]
(%i6) matrixexp(m),keepfloat:true;

Unable to find the spectral representation
 -- an error. To debug this try: debugmode(true);
(%i7) matrixexp(m),keepfloat:false;

Unable to find the spectral representation
 -- an error. To debug this try: debugmode(true);
```



---

archive/issue_comments_167742.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd48\".",
    "created_at": "2013-06-18T18:37:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167742",
    "user": "https://github.com/kcrisman"
}
```

**Changing keywords** from "" to "sd48".



---

archive/issue_comments_167743.json:
```json
{
    "body": "<a id='comment:21'></a>\nNote that the spkg changes are not committed.",
    "created_at": "2013-06-18T18:38:58Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167743",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
Note that the spkg changes are not committed.



---

archive/issue_comments_167744.json:
```json
{
    "body": "**Changing dependencies** from \"#13364\" to \"\".",
    "created_at": "2013-06-19T13:44:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167744",
    "user": "https://github.com/kcrisman"
}
```

**Changing dependencies** from "#13364" to "".



---

archive/issue_comments_167745.json:
```json
{
    "body": "**Upstream:** Reported upstream. Developers acknowledge bug.",
    "created_at": "2013-06-19T13:44:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167745",
    "user": "https://github.com/kcrisman"
}
```

**Upstream:** Reported upstream. Developers acknowledge bug.



---

archive/issue_comments_167746.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks to Barton Willis for this workaround.\n\n```\nThis bug is due to circa January 2013 changes to matrix inversion. A workaround is to set ratmx to true:\n\nMaxima branch_5_30_base_98_g29f9239_dirty http://maxima.sourceforge.net\nusing Lisp Clozure Common Lisp Version 1.9-r15764  (WindowsX8632)\n\n(%i1) matrixexp(matrix([%i*%pi]));\n\nUnable to find the spectral representation\n\n(%i2) matrixexp(matrix([%i*%pi])), ratmx=true;\n(%o2)                                 - 1\n```\nI've reported this [here](https://sourceforge.net/p/maxima/bugs/2596/).  I don't know if doing this ratmx thing universally is good, though:\n\n```\n if FALSE will cause determinant and matrix addition, subtraction, and multiplication to be performed in the representation of the matrix elements and will cause the result of matrix inversion to be left in general representation. If it is TRUE, the 4 operations mentioned above will be performed in CRE form and the result of matrix inverse will be in CRE form. Note that this may cause the elements to be expanded (depending on the setting of RATFAC) which might not always be desired.\n```",
    "created_at": "2013-06-19T13:44:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167746",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
Thanks to Barton Willis for this workaround.

```
This bug is due to circa January 2013 changes to matrix inversion. A workaround is to set ratmx to true:

Maxima branch_5_30_base_98_g29f9239_dirty http://maxima.sourceforge.net
using Lisp Clozure Common Lisp Version 1.9-r15764  (WindowsX8632)

(%i1) matrixexp(matrix([%i*%pi]));

Unable to find the spectral representation

(%i2) matrixexp(matrix([%i*%pi])), ratmx=true;
(%o2)                                 - 1
```
I've reported this [here](https://sourceforge.net/p/maxima/bugs/2596/).  I don't know if doing this ratmx thing universally is good, though:

```
 if FALSE will cause determinant and matrix addition, subtraction, and multiplication to be performed in the representation of the matrix elements and will cause the result of matrix inversion to be left in general representation. If it is TRUE, the 4 operations mentioned above will be performed in CRE form and the result of matrix inverse will be in CRE form. Note that this may cause the elements to be expanded (depending on the setting of RATFAC) which might not always be desired.
```



---

archive/issue_comments_167747.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n \n-Fixes #13526, #14306, #13712, #14591, #14677.\n+Fixes #13526, #14306, #13712, #14591, #14677, #8728.\n``````\n",
    "created_at": "2013-06-26T14:46:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167747",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
 
-Fixes #13526, #14306, #13712, #14591, #14677.
+Fixes #13526, #14306, #13712, #14591, #14677, #8728.
``````




---

archive/issue_events_120063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120063"
}
```



---

archive/issue_events_120064.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120064"
}
```



---

archive/issue_comments_167748.json:
```json
{
    "body": "<a id='comment:25'></a>\n5.31 has been released.",
    "created_at": "2013-09-04T22:52:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167748",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:25'></a>
5.31 has been released.



---

archive/issue_events_120065.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120065"
}
```



---

archive/issue_events_120066.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120066"
}
```



---

archive/issue_events_120067.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120067"
}
```



---

archive/issue_events_120068.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120068"
}
```



---

archive/issue_comments_167749.json:
```json
{
    "body": "<a id='comment:28'></a>\nMaxima is now at version 5.33.0.  The bug described in comments 15, 19 and 22 still exists.",
    "created_at": "2014-05-15T21:50:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167749",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:28'></a>
Maxima is now at version 5.33.0.  The bug described in comments 15, 19 and 22 still exists.



---

archive/issue_comments_167750.json:
```json
{
    "body": "<a id='comment:29'></a>\nI found a patch that I think has the same effect as the workaround in [comment:22](#comment%3A22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:\n\n```diff\n--- a/share/linearalgebra/matrixexp.lisp        2013-10-07 04:37:12.000000000 +0100\n+++ b/share/linearalgebra/matrixexp.lisp        2014-05-16 02:16:09.112011893 +0100\n@@ -138,8 +138,8 @@\n           (print `(ratvars = ,$ratvars gcd = '$gcd algebraic = ,$algebraic))\n           (print `(ratfac = ,$ratfac))\n           (merror \"Unable to find the spectrum\")))\n-   \n-    (setq res ($fullratsimp (ncpower (sub (mult z ($ident n)) mat) -1) z))\n+\n+    (setq res ($fullratsimp ($invert (sub (mult z ($ident n)) mat) '$crering) z))\n     (setq m (length sp))\n     (dotimes (i m)\n       (setq zi (nth i sp))\n```\nI'll try to see if upgrading to 5.33.0 gives any further unexpected problems.",
    "created_at": "2014-05-16T03:18:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167750",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:29'></a>
I found a patch that I think has the same effect as the workaround in [comment:22](#comment%3A22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:

```diff
--- a/share/linearalgebra/matrixexp.lisp        2013-10-07 04:37:12.000000000 +0100
+++ b/share/linearalgebra/matrixexp.lisp        2014-05-16 02:16:09.112011893 +0100
@@ -138,8 +138,8 @@
           (print `(ratvars = ,$ratvars gcd = '$gcd algebraic = ,$algebraic))
           (print `(ratfac = ,$ratfac))
           (merror "Unable to find the spectrum")))
-   
-    (setq res ($fullratsimp (ncpower (sub (mult z ($ident n)) mat) -1) z))
+
+    (setq res ($fullratsimp ($invert (sub (mult z ($ident n)) mat) '$crering) z))
     (setq m (length sp))
     (dotimes (i m)
       (setq zi (nth i sp))
```
I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.



---

archive/issue_comments_167751.json:
```json
{
    "body": "<a id='comment:30'></a>\n> I found a patch that I think has the same effect as the workaround in [comment:22](#comment%3A22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:\n\n\nI have added it to the [bug report in question](https://sourceforge.net/p/maxima/bugs/2596/).\n> I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.\n\nLet's hope not!",
    "created_at": "2014-05-16T13:47:03Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167751",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:30'></a>
> I found a patch that I think has the same effect as the workaround in [comment:22](#comment%3A22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:


I have added it to the [bug report in question](https://sourceforge.net/p/maxima/bugs/2596/).
> I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.

Let's hope not!



---

archive/issue_comments_167752.json:
```json
{
    "body": "<a id='comment:31'></a>\nThanks!  No major problems so far; there is one integration doctest that does not finish, but Maxima itself returns the answer quickly, so the timeout has to occur in the interface.",
    "created_at": "2014-05-16T14:14:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167752",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:31'></a>
Thanks!  No major problems so far; there is one integration doctest that does not finish, but Maxima itself returns the answer quickly, so the timeout has to occur in the interface.



---

archive/issue_comments_167753.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe problematic doctest is the following one from `sage/misc/functional.py`:\n\n```\nsage: f = exp(-x) * sinh(sqrt(x))\nsage: t = integrate(f, x, 0, Infinity)\n```\nWith an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for\n\n```\nsage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')\n```\n\nThis is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):\n\n```\n(%i1) integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf); \n(%o1) \n    1/4                                              1\n  %e    (2 gamma_incomplete(1, 1) - gamma_incomplete(-, 1) - sqrt(%pi) - 2)\n                                                     2\n- -------------------------------------------------------------------------\n                                      4\n                                    1/4                  1\n     1/4                          %e    gamma_incomplete(-, 1)\n   %e    gamma_incomplete(1, 1)                          2\n + ---------------------------- - ----------------------------\n                2                              4\n     1/4               1/4\n   %e    sqrt(%pi)   %e\n + --------------- - -----\n          4            2\n```\nIt would seem to be an interface problem that already exists in some form in Sage 6.2 and manifests itself more relentlessly with the Maxima 5.33.0 spkg I am making.",
    "created_at": "2014-05-16T15:14:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167753",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:32'></a>
The problematic doctest is the following one from `sage/misc/functional.py`:

```
sage: f = exp(-x) * sinh(sqrt(x))
sage: t = integrate(f, x, 0, Infinity)
```
With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for

```
sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')
```

This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):

```
(%i1) integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf); 
(%o1) 
    1/4                                              1
  %e    (2 gamma_incomplete(1, 1) - gamma_incomplete(-, 1) - sqrt(%pi) - 2)
                                                     2
- -------------------------------------------------------------------------
                                      4
                                    1/4                  1
     1/4                          %e    gamma_incomplete(-, 1)
   %e    gamma_incomplete(1, 1)                          2
 + ---------------------------- - ----------------------------
                2                              4
     1/4               1/4
   %e    sqrt(%pi)   %e
 + --------------- - -----
          4            2
```
It would seem to be an interface problem that already exists in some form in Sage 6.2 and manifests itself more relentlessly with the Maxima 5.33.0 spkg I am making.



---

archive/issue_comments_167754.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [pbruin](#comment%3A32):\n> The problematic doctest is the following one from `sage/misc/functional.py`:\n> \n> ```\n> sage: f = exp(-x) * sinh(sqrt(x))\n> sage: t = integrate(f, x, 0, Infinity)\n> ```\n> With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for\n> \n> ```\n> sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')\n> ```\n> \n> This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):\n\n\nI am not at all convinced it is the interface problem. It is more likely the Maxima packages loaded by default in Sage library (see the corr. Sage source files) and not loaded in your test run. When I only `load(abs_integrate)` i Sage's 6.2 Maxima, or don't load anything at all, I get an almost instant answer.\nWhen I load the whole bunch from lines 142-4 of `sage/interfaces/maxima_lib.py`\n\n```\ninit_code = ['display2d : false', 'domain : complex', 'keepfloat : true',\n            'load(to_poly_solve)', 'load(simplify_sum)',\n            'load(abs_integrate)']\n```\nit goes much slower.",
    "created_at": "2014-05-16T15:38:29Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167754",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
Replying to [pbruin](#comment%3A32):
> The problematic doctest is the following one from `sage/misc/functional.py`:
> 
> ```
> sage: f = exp(-x) * sinh(sqrt(x))
> sage: t = integrate(f, x, 0, Infinity)
> ```
> With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for
> 
> ```
> sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')
> ```
> 
> This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):


I am not at all convinced it is the interface problem. It is more likely the Maxima packages loaded by default in Sage library (see the corr. Sage source files) and not loaded in your test run. When I only `load(abs_integrate)` i Sage's 6.2 Maxima, or don't load anything at all, I get an almost instant answer.
When I load the whole bunch from lines 142-4 of `sage/interfaces/maxima_lib.py`

```
init_code = ['display2d : false', 'domain : complex', 'keepfloat : true',
            'load(to_poly_solve)', 'load(simplify_sum)',
            'load(abs_integrate)']
```
it goes much slower.



---

archive/issue_comments_167755.json:
```json
{
    "body": "<a id='comment:34'></a>\nThanks!  In fact it seems to be the `domain : complex` setting that is causing the slowness.",
    "created_at": "2014-05-16T15:44:22Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167755",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:34'></a>
Thanks!  In fact it seems to be the `domain : complex` setting that is causing the slowness.



---

archive/issue_comments_167756.json:
```json
{
    "body": "<a id='comment:35'></a>\nHow about the minimal workaround of temporarily setting `domain: real` in this doctest?",
    "created_at": "2014-05-16T15:55:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167756",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:35'></a>
How about the minimal workaround of temporarily setting `domain: real` in this doctest?



---

archive/issue_comments_167757.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [pbruin](#comment%3A35):\n> How about the minimal workaround of temporarily setting `domain: real` in this doctest?\n\n\nsure, this is not the 1st time something like this is needed.",
    "created_at": "2014-05-17T08:27:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167757",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>
Replying to [pbruin](#comment%3A35):
> How about the minimal workaround of temporarily setting `domain: real` in this doctest?


sure, this is not the 1st time something like this is needed.



---

archive/issue_events_120069.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-17T11:28:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "rename": {
        "from": "Upgrade Maxima past the release 5.29.1",
        "to": "Upgrade Maxima to 5.33.0"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120069"
}
```



---

archive/issue_comments_167758.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,10 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n+Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n \n-Fixes #13526, #14306, #13712, #14591, #14677, #8728.\n+May fix #8728 (Maxima asks for more constraints).\n+\n+Does not fix #14591, #14677.\n+\n+**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n``````\n",
    "created_at": "2014-05-17T11:28:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167758",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,10 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
+Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
 
-Fixes #13526, #14306, #13712, #14591, #14677, #8728.
+May fix #8728 (Maxima asks for more constraints).
+
+Does not fix #14591, #14677.
+
+**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
``````




---

archive/issue_comments_167759.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer\" to \"Peter Bruin\".",
    "created_at": "2014-05-17T11:28:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167759",
    "user": "https://github.com/pjbruin"
}
```

**Changing author** from "Jeroen Demeyer" to "Peter Bruin".



---

archive/issue_comments_167760.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Developers acknowledge bug.\" to \"Completely fixed; Fix reported upstream\".",
    "created_at": "2014-05-17T11:28:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167760",
    "user": "https://github.com/pjbruin"
}
```

**Changing upstream** from "Reported upstream. Developers acknowledge bug." to "Completely fixed; Fix reported upstream".



---

archive/issue_comments_167761.json:
```json
{
    "body": "**Commit:** [13d48c244fa349d456ecd74cc426931433266102](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)",
    "created_at": "2014-05-17T11:28:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167761",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [13d48c244fa349d456ecd74cc426931433266102](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)



---

archive/issue_events_120070.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-17T11:28:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120070"
}
```



---

archive/issue_comments_167762.json:
```json
{
    "body": "**Branch:** [u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)",
    "created_at": "2014-05-17T11:28:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167762",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)



---

archive/issue_comments_167763.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n \n May fix #8728 (Maxima asks for more constraints).\n \n``````\n",
    "created_at": "2014-05-17T14:00:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167763",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
 
 May fix #8728 (Maxima asks for more constraints).
 
``````




---

archive/issue_comments_167764.json:
```json
{
    "body": "<a id='comment:38'></a>\nNote about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.",
    "created_at": "2014-05-17T14:00:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167764",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:38'></a>
Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.



---

archive/issue_comments_167765.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,10 +2,12 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n \n May fix #8728 (Maxima asks for more constraints).\n \n Does not fix #14591, #14677.\n \n-**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n+**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n+\n+Note about the patches: `maxima_bug_2526.patch`, which fixes \u200bhttp://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. \n``````\n",
    "created_at": "2014-05-17T14:09:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167765",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,10 +2,12 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.
 
 May fix #8728 (Maxima asks for more constraints).
 
 Does not fix #14591, #14677.
 
-**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
+**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
+
+Note about the patches: `maxima_bug_2526.patch`, which fixes â€‹http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. 
``````




---

archive/issue_comments_167766.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,8 +6,8 @@\n \n May fix #8728 (Maxima asks for more constraints).\n \n-Does not fix #14591, #14677.\n+Does not fix #14591, #14677, #15033.\n \n **tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n \n-Note about the patches: `maxima_bug_2526.patch`, which fixes \u200bhttp://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. \n+Note about the existing `maxima_bug_2526.patch`: \u200bthe bug was marked \"closed\" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.\n``````\n",
    "created_at": "2014-05-20T22:33:22Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167766",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,8 +6,8 @@
 
 May fix #8728 (Maxima asks for more constraints).
 
-Does not fix #14591, #14677.
+Does not fix #14591, #14677, #15033.
 
 **tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
 
-Note about the patches: `maxima_bug_2526.patch`, which fixes â€‹http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. 
+Note about the existing `maxima_bug_2526.patch`: â€‹the bug was marked "closed" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.
``````




---

archive/issue_comments_167767.json:
```json
{
    "body": "<a id='comment:41'></a>\n\n```\nsage -t --long src/sage/interfaces/maxima_lib.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_lib.py\", line 702, in sage.interfaces.maxima_lib.MaximaLib.sr_integral\nFailed example:\n    integrate(cos(x + abs(x)), x)\nExpected:\n    -1/4*(2*x - sin(2*x))*realpart(sgn(x)) + 1/2*x + 1/4*sin(2*x)\nGot:\n    -1/4*(2*x - sin(2*x))*real_part(sgn(x)) + 1/2*x + 1/4*sin(2*x)\n**********************************************************************\n```\n\nThis is with Volker's current `develop` branch on github (`d409685`), which includes a few dozens new tickets compared to `6.3.beta1`.",
    "created_at": "2014-05-23T12:46:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167767",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:41'></a>

```
sage -t --long src/sage/interfaces/maxima_lib.py
**********************************************************************
File "src/sage/interfaces/maxima_lib.py", line 702, in sage.interfaces.maxima_lib.MaximaLib.sr_integral
Failed example:
    integrate(cos(x + abs(x)), x)
Expected:
    -1/4*(2*x - sin(2*x))*realpart(sgn(x)) + 1/2*x + 1/4*sin(2*x)
Got:
    -1/4*(2*x - sin(2*x))*real_part(sgn(x)) + 1/2*x + 1/4*sin(2*x)
**********************************************************************
```

This is with Volker's current `develop` branch on github (`d409685`), which includes a few dozens new tickets compared to `6.3.beta1`.



---

archive/issue_events_120071.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T12:46:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120071"
}
```



---

archive/issue_events_120072.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T12:46:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120072"
}
```



---

archive/issue_comments_167768.json:
```json
{
    "body": "**Changing commit** from \"[13d48c244fa349d456ecd74cc426931433266102](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)\" to \"[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)\".",
    "created_at": "2014-05-23T13:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[13d48c244fa349d456ecd74cc426931433266102](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)" to "[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)".



---

archive/issue_comments_167769.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df\">a130eed</a></td><td><code>Trac 13973: realpart should be real_part</code></td></tr></table>\n",
    "created_at": "2014-05-23T13:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df">a130eed</a></td><td><code>Trac 13973: realpart should be real_part</code></td></tr></table>




---

archive/issue_comments_167770.json:
```json
{
    "body": "<a id='comment:43'></a>\nThanks, that must be a consequence of #16224.",
    "created_at": "2014-05-23T13:05:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167770",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:43'></a>
Thanks, that must be a consequence of #16224.



---

archive/issue_events_120073.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T13:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120073"
}
```



---

archive/issue_events_120074.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120074"
}
```



---

archive/issue_comments_167771.json:
```json
{
    "body": "<a id='comment:44'></a>\n> Thanks, that must be a consequence of #16224.\nSo... did we have an incorrect translation of Maxima's `realpart` all along?  Interesting.",
    "created_at": "2014-05-23T13:46:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167771",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:44'></a>
> Thanks, that must be a consequence of #16224.
So... did we have an incorrect translation of Maxima's `realpart` all along?  Interesting.



---

archive/issue_comments_167772.json:
```json
{
    "body": "<a id='comment:45'></a>\nIs there a reason for no longer using `z...` in the following test?\n\n```\n@@ -9231,7 +9231,7 @@ cdef class Expression(CommutativeRingElement):\n             sage: from sage.calculus.calculus import maxima\n             sage: sol = maxima(cos(x)==0).to_poly_solve(x)\n             sage: sol.sage()\n-            [[x == -1/2*pi + 2*pi*z...], [x == 1/2*pi + 2*pi*z...]]\n+            [[x == 1/2*pi + pi*z82]]\n \n         If a returned unsolved expression has a denominator, but the\n         original one did not, this may also be true::\n```\n\nThe same comment may apply to `z[0-9]+` in \n\n```\nsrc/sage/interfaces/maxima_lib.py:            [[x == pi*z54]]\nsrc/sage/symbolic/relation.py:        [[x == 1/4*pi + pi*z80, y == -1/4*pi - pi*z80]]\n```\n\nThe bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:\n\n```\nsage: integral(log(cot(x)-1),x,0,pi/4)\n...\nRuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.\n```\n\nOtherwise looks good to me.",
    "created_at": "2014-05-23T15:11:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167772",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:45'></a>
Is there a reason for no longer using `z...` in the following test?

```
@@ -9231,7 +9231,7 @@ cdef class Expression(CommutativeRingElement):
             sage: from sage.calculus.calculus import maxima
             sage: sol = maxima(cos(x)==0).to_poly_solve(x)
             sage: sol.sage()
-            [[x == -1/2*pi + 2*pi*z...], [x == 1/2*pi + 2*pi*z...]]
+            [[x == 1/2*pi + pi*z82]]
 
         If a returned unsolved expression has a denominator, but the
         original one did not, this may also be true::
```

The same comment may apply to `z[0-9]+` in 

```
src/sage/interfaces/maxima_lib.py:            [[x == pi*z54]]
src/sage/symbolic/relation.py:        [[x == 1/4*pi + pi*z80, y == -1/4*pi - pi*z80]]
```

The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:

```
sage: integral(log(cot(x)-1),x,0,pi/4)
...
RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.
```

Otherwise looks good to me.



---

archive/issue_comments_167773.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,9 +2,11 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n \n-May fix #8728 (Maxima asks for more constraints).\n+Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).\n+\n+Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).\n \n Does not fix #14591, #14677, #15033.\n \n``````\n",
    "created_at": "2014-05-23T17:26:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167773",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,9 +2,11 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.
 
-May fix #8728 (Maxima asks for more constraints).
+Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).
+
+Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).
 
 Does not fix #14591, #14677, #15033.
 
``````




---

archive/issue_comments_167774.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [mmezzarobba](#comment%3A45):\n> Is there a reason for no longer using `z...` in the following test?\n\nMostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a \"serial number\" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.\n> The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:\n> \n> ```\n> sage: integral(log(cot(x)-1),x,0,pi/4)\n> ...\n> RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.\n> ```\n\nYou're right; I tested this inside Maxima (`sage --maxima`), but Sage loads additional packages.  In this case the failure is caused by loading `abs_integrate`.  Using 5.33.0:\n\n```\n$ sage --maxima\n...\n(%i1) display2d: false$\n\n(%i2) integrate(log(cot(x)-1),x,0,%pi/4);\n\n(%o2) (%i*li[2]((%i+1)/2)-%i*li[2](-(%i-1)/2))/2\n -(%i*(2*li[2](%i+1)-2*li[2](1-%i))+%pi*log(2))/4\n(%i3) load(abs_integrate)$\n\n(%i4) integrate(log(cot(x)-1),x,0,%pi/4);\n\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nPSLOG: internal error.\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2014-05-23T17:26:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167774",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:46'></a>
Replying to [mmezzarobba](#comment%3A45):
> Is there a reason for no longer using `z...` in the following test?

Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a "serial number" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.
> The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:
> 
> ```
> sage: integral(log(cot(x)-1),x,0,pi/4)
> ...
> RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.
> ```

You're right; I tested this inside Maxima (`sage --maxima`), but Sage loads additional packages.  In this case the failure is caused by loading `abs_integrate`.  Using 5.33.0:

```
$ sage --maxima
...
(%i1) display2d: false$

(%i2) integrate(log(cot(x)-1),x,0,%pi/4);

(%o2) (%i*li[2]((%i+1)/2)-%i*li[2](-(%i-1)/2))/2
 -(%i*(2*li[2](%i+1)-2*li[2](1-%i))+%pi*log(2))/4
(%i3) load(abs_integrate)$

(%i4) integrate(log(cot(x)-1),x,0,%pi/4);

log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
PSLOG: internal error.
 -- an error. To debug this try: debugmode(true);
```



---

archive/issue_comments_167775.json:
```json
{
    "body": "**Reviewer:** Marc Mezzarobba",
    "created_at": "2014-05-23T17:46:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167775",
    "user": "https://github.com/mezzarobba"
}
```

**Reviewer:** Marc Mezzarobba



---

archive/issue_comments_167776.json:
```json
{
    "body": "**Changing upstream** from \"Completely fixed; Fix reported upstream\" to \"\".",
    "created_at": "2014-05-23T17:46:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167776",
    "user": "https://github.com/mezzarobba"
}
```

**Changing upstream** from "Completely fixed; Fix reported upstream" to "".



---

archive/issue_comments_167777.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [pbruin](#comment%3A46):\n> Replying to [mmezzarobba](#comment%3A45):\n> > Is there a reason for no longer using `z...` in the following test?\n\n> Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a \"serial number\" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.\n\nNo, that's fine with me, I just wanted to make sure that it was intentional.",
    "created_at": "2014-05-23T17:46:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167777",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:47'></a>
Replying to [pbruin](#comment%3A46):
> Replying to [mmezzarobba](#comment%3A45):
> > Is there a reason for no longer using `z...` in the following test?

> Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a "serial number" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.

No, that's fine with me, I just wanted to make sure that it was intentional.



---

archive/issue_events_120075.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T17:46:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120075"
}
```



---

archive/issue_events_120076.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T17:46:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120076"
}
```



---

archive/issue_comments_167778.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)\" to \"[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)\".",
    "created_at": "2014-05-25T17:31:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167778",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)" to "[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)".



---

archive/issue_events_120077.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-25T17:31:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120077"
}
```



---

archive/issue_events_120078.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6220027f174e01ae252f277acb3a75de7053239c",
    "created_at": "2014-05-25T17:31:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-120078"
}
```



---

archive/issue_comments_167779.json:
```json
{
    "body": "<a id='comment:49'></a>\n> Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.\n\n\nOkay, this is [finally in Maxima](http://sourceforge.net/p/maxima/bugs/2526/?limit=10&page=1#4cee), so the next Maxima upgrade will get to remove this patch.",
    "created_at": "2014-06-04T13:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167779",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:49'></a>
> Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.


Okay, this is [finally in Maxima](http://sourceforge.net/p/maxima/bugs/2526/?limit=10&page=1#4cee), so the next Maxima upgrade will get to remove this patch.



---

archive/issue_comments_167780.json:
```json
{
    "body": "**Changing commit** from \"[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)\" to \"\".",
    "created_at": "2014-06-04T13:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167780",
    "user": "https://github.com/kcrisman"
}
```

**Changing commit** from "[a130eed39a9e2e86301e94d9e16932fd38be64df](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)" to "".



---

archive/issue_comments_167781.json:
```json
{
    "body": "<a id='comment:50'></a>\n#14306 needs review.",
    "created_at": "2014-06-04T13:55:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-167781",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:50'></a>
#14306 needs review.
