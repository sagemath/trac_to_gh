# Issue 13973: Upgrade Maxima to 5.33.0

archive/issues_013769.json:
```json
{
    "assignees": [],
    "body": "This is a continuation of #13364, and aims at including more upstream bug fixes, which e.g. fix an\n[issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \nwhich was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n\nFixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n\nOught to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).\n\nOught to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).\n\nDoes not fix #14591, #14677, #15033.\n\n**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n\nNote about the existing `maxima_bug_2526.patch`: \u200bthe bug was marked \"closed\" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.\n\nCC:  @SnarkBoojum\n\nKeywords: **sd48**\n\nBranch: **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**\n\nReviewer: **Marc Mezzarobba**\n\nAuthor: **Peter Bruin**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13973_\n\n",
    "closed_at": "2014-05-25T17:31:52Z",
    "created_at": "2013-01-19T12:29:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade Maxima to 5.33.0",
    "type": "issue",
    "updated_at": "2014-06-04T13:55:50Z",
    "url": "https://github.com/sagemath/sage/issues/13973",
    "user": "https://github.com/dimpase"
}
```
This is a continuation of #13364, and aims at including more upstream bug fixes, which e.g. fix an
[issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.

Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.

Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).

Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).

Does not fix #14591, #14677, #15033.

**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)

Note about the existing `maxima_bug_2526.patch`: â€‹the bug was marked "closed" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.

CC:  @SnarkBoojum

Keywords: **sd48**

Branch: **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**

Reviewer: **Marc Mezzarobba**

Author: **Peter Bruin**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/13973_





---

archive/issue_events_194378.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2013-01-19T12:29:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194378"
}
```



---

archive/issue_events_194379.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2013-01-19T12:29:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194379"
}
```



---

archive/issue_events_194380.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2013-01-19T12:29:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194380"
}
```



---

archive/issue_events_194381.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2013-01-19T12:29:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194381"
}
```



---

archive/issue_comments_165359.json:
```json
{
    "body": "Changed dependencies from **13364** to **#13364**",
    "created_at": "2013-01-20T01:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165359",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **13364** to **#13364**



---

archive/issue_comments_165360.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSo for instance going at least as far as the fix for #13733 would be good.",
    "created_at": "2013-01-20T01:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165360",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

So for instance going at least as far as the fix for #13733 would be good.



---

archive/issue_comments_165361.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nwhile we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:\n\n```\nFile \"/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py\", line 422:\n    sage: maxima.version()\nExpected:\n    '5.26.0'\nGot:\n    '5.29.1'\n```\nWhat really matters is the **functionality** provided, not the actual version?\nDoes Sage check the actual version of each component?\n\nPaul",
    "created_at": "2013-01-23T08:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165361",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:3" align="right">comment:3</div>

while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:

```
File "/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py", line 422:
    sage: maxima.version()
Expected:
    '5.26.0'
Got:
    '5.29.1'
```
What really matters is the **functionality** provided, not the actual version?
Does Sage check the actual version of each component?

Paul



---

archive/issue_comments_165362.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@zimmermann6](#comment:3):\n> while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:\n> \n> ```\n> File \"/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py\", line 422:\n>     sage: maxima.version()\n> Expected:\n>     '5.26.0'\n> Got:\n>     '5.29.1'\n> ```\n\nseems that https://github.com/sagemath/sage/files/ticket13364/doctests.2.patch.gz\nwas not installed into the Sage installation you work with.\n\n> What really matters is the **functionality** provided, not the actual version?\n> Does Sage check the actual version of each component?\n\nSage provides versions at least for some other components, e.g. `gap.version()`\n\nSometimes it might be useful; AFAIK some optional packages check this.\n\nDima\n\n\n> \n> Paul",
    "created_at": "2013-01-23T09:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165362",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@zimmermann6](#comment:3):
> while we are at it, it seems strange to me that `sage/interfaces/maxima_abstract.py` contains a doctest for the maxima version used:
> 
> ```
> File "/localdisk/tmp/sage-5.5/devel/sage-12615b/sage/interfaces/maxima_abstract.py", line 422:
>     sage: maxima.version()
> Expected:
>     '5.26.0'
> Got:
>     '5.29.1'
> ```

seems that https://github.com/sagemath/sage/files/ticket13364/doctests.2.patch.gz
was not installed into the Sage installation you work with.

> What really matters is the **functionality** provided, not the actual version?
> Does Sage check the actual version of each component?

Sage provides versions at least for some other components, e.g. `gap.version()`

Sometimes it might be useful; AFAIK some optional packages check this.

Dima


> 
> Paul



---

archive/issue_comments_165363.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.\n\nPaul",
    "created_at": "2013-01-23T10:15:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165363",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:5" align="right">comment:5</div>

Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.

Paul



---

archive/issue_comments_165364.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@zimmermann6](#comment:5):\n> Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.\n> \n\nwell, one would like to test Sage functions... How else would you check that it works and returns something meaningful?\n\n> Paul",
    "created_at": "2013-01-23T12:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165364",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@zimmermann6](#comment:5):
> Dima, I don't object about **providing** a function `maxima_version()`, but **checking** it returns a particular value.
> 

well, one would like to test Sage functions... How else would you check that it works and returns something meaningful?

> Paul



---

archive/issue_comments_165365.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nwe could for example check that the version is of the form `x.y.z`, or is greater than or equal to a given number.\n\nPaul",
    "created_at": "2013-01-23T12:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165365",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:7" align="right">comment:7</div>

we could for example check that the version is of the form `x.y.z`, or is greater than or equal to a given number.

Paul



---

archive/issue_comments_165366.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nsee #14306 (issue fixed in Maxima git)\n\nPaul",
    "created_at": "2013-05-07T08:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165366",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:8" align="right">comment:8</div>

see #14306 (issue fixed in Maxima git)

Paul



---

archive/issue_comments_165367.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAlso note that Maxima is now at 5.30.0.",
    "created_at": "2013-05-08T02:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165367",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

Also note that Maxima is now at 5.30.0.



---

archive/issue_comments_165368.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes it is at 5.30.0. No check from sage-on-gentoo on whether it works so far because the maxima ecl library building is currently broken for that particular version - an adsf upgrade problem in gentoo.\n\nI second checking the form of the version returned rather than the value. That would make my life easier when R, maxima are upgraded in s-o-g independently of sage itself (and without side effects at leat in doctests).",
    "created_at": "2013-05-08T09:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165368",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes it is at 5.30.0. No check from sage-on-gentoo on whether it works so far because the maxima ecl library building is currently broken for that particular version - an adsf upgrade problem in gentoo.

I second checking the form of the version returned rather than the value. That would make my life easier when R, maxima are upgraded in s-o-g independently of sage itself (and without side effects at leat in doctests).



---

archive/issue_comments_165369.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI'll try making a new Maxima spkg just to see what happpens...",
    "created_at": "2013-06-13T08:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165369",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

I'll try making a new Maxima spkg just to see what happpens...



---

archive/issue_events_194382.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:57:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194382"
}
```



---

archive/issue_events_194383.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:57:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194383"
}
```



---

archive/issue_comments_165370.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2013-06-13T08:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165370",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_165371.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,4 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n``````\n",
    "created_at": "2013-06-13T08:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165371",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,4 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
``````




---

archive/issue_comments_165372.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n+\n+Fixes #13526, #14306, #13712, #14591, #14677.\n``````\n",
    "created_at": "2013-06-13T09:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165372",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
+
+Fixes #13526, #14306, #13712, #14591, #14677.
``````




---

archive/issue_comments_165373.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis looks problematic:\n\n```\nsage -t devel/sage/sage/calculus/calculus.py\n**********************************************************************\nFile \"devel/sage/sage/calculus/calculus.py\", line 145, in sage.calculus.calculus\nFailed example:\n    e^M\nException raised:\n    Traceback (most recent call last):\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n        exec compiled in globs\n      File \"<doctest sage.calculus.calculus[32]>\", line 1, in <module>\n        e**M\n      File \"constants_c.pyx\", line 275, in sage.symbolic.constants_c.E.__pow__ (sage/symbolic/constants_c.cpp:2779)\n      File \"matrix_symbolic_dense.pyx\", line 387, in sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense.exp (sage/matrix/matrix_symbolic_dense.c:3433)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 199, in __call__\n        return cls(self, x, name=name)\n      File \"/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 626, in __init__\n        raise TypeError, x\n    TypeError: ECL says: Error executing code in Maxima: Unable to find the spectral representation\n**********************************************************************\n```",
    "created_at": "2013-06-13T09:30:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165373",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

This looks problematic:

```
sage -t devel/sage/sage/calculus/calculus.py
**********************************************************************
File "devel/sage/sage/calculus/calculus.py", line 145, in sage.calculus.calculus
Failed example:
    e^M
Exception raised:
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
        exec compiled in globs
      File "<doctest sage.calculus.calculus[32]>", line 1, in <module>
        e**M
      File "constants_c.pyx", line 275, in sage.symbolic.constants_c.E.__pow__ (sage/symbolic/constants_c.cpp:2779)
      File "matrix_symbolic_dense.pyx", line 387, in sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense.exp (sage/matrix/matrix_symbolic_dense.c:3433)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 199, in __call__
        return cls(self, x, name=name)
      File "/mazur/release/merger/sage-5.10.rc2/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 626, in __init__
        raise TypeError, x
    TypeError: ECL says: Error executing code in Maxima: Unable to find the spectral representation
**********************************************************************
```



---

archive/issue_comments_165374.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAlso\n\n```\nsage -t devel/sage/sage/interfaces/maxima.py  # Time out\n```\ndue to a timeout of\n\n```\nsage: maxima('limit(x^a,x,0)')\n```\nThis is fixable, it is because of a slightly different output format of assumptions.",
    "created_at": "2013-06-13T09:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165374",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Also

```
sage -t devel/sage/sage/interfaces/maxima.py  # Time out
```
due to a timeout of

```
sage: maxima('limit(x^a,x,0)')
```
This is fixable, it is because of a slightly different output format of assumptions.



---

archive/issue_comments_165375.json:
```json
{
    "body": "Changed upstream from **Fixed upstream, but not in a stable release.** to none",
    "created_at": "2013-06-13T09:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165375",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Fixed upstream, but not in a stable release.** to none



---

archive/issue_comments_165376.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThat is awesome, thanks for checking this, Jeroen.",
    "created_at": "2013-06-13T14:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165376",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

That is awesome, thanks for checking this, Jeroen.



---

archive/issue_comments_165377.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n> This is fixable, it is because of a slightly different output format of assumptions.\n\nJeroen, while it's true that the error is slightly different in format, I don't think this is the problem (or at least not the whole one).  The other things are still passing doctests, and we never even *get* to the \n\n```\n           if i > 0:\n                v = self._expect.before\n```\nbranch, as one can verify by inserting print statements.\n> This looks problematic:\n\nThis is #2400 again, to some extent.  Not sure why this doesn't work any more.  In Maxima 5.29.1, this is fine.\n\n```\nMaxima 5.29.1 http://maxima.sourceforge.net\nusing Lisp ECL 12.12.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) m: matrix([%i*%pi]);\n(%o1)                             [ %i %pi ]\n(%i4) matrixexp(m), keepfloat:true;\n(%o4)                                 - 1\n(%i5) matrixexp(m),keepfloat:false;\n(%o5)                                 - 1\n```\n\nwhich is good.  In 5.30, though, we have\n\n```\n(%i1) m: matrix([%i*%pi]);\n(%o1)                             [ %i %pi ]\n(%i6) matrixexp(m),keepfloat:true;\n\nUnable to find the spectral representation\n -- an error. To debug this try: debugmode(true);\n(%i7) matrixexp(m),keepfloat:false;\n\nUnable to find the spectral representation\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2013-06-18T18:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165377",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

> This is fixable, it is because of a slightly different output format of assumptions.

Jeroen, while it's true that the error is slightly different in format, I don't think this is the problem (or at least not the whole one).  The other things are still passing doctests, and we never even *get* to the 

```
           if i > 0:
                v = self._expect.before
```
branch, as one can verify by inserting print statements.
> This looks problematic:

This is #2400 again, to some extent.  Not sure why this doesn't work any more.  In Maxima 5.29.1, this is fine.

```
Maxima 5.29.1 http://maxima.sourceforge.net
using Lisp ECL 12.12.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) m: matrix([%i*%pi]);
(%o1)                             [ %i %pi ]
(%i4) matrixexp(m), keepfloat:true;
(%o4)                                 - 1
(%i5) matrixexp(m),keepfloat:false;
(%o5)                                 - 1
```

which is good.  In 5.30, though, we have

```
(%i1) m: matrix([%i*%pi]);
(%o1)                             [ %i %pi ]
(%i6) matrixexp(m),keepfloat:true;

Unable to find the spectral representation
 -- an error. To debug this try: debugmode(true);
(%i7) matrixexp(m),keepfloat:false;

Unable to find the spectral representation
 -- an error. To debug this try: debugmode(true);
```



---

archive/issue_comments_165378.json:
```json
{
    "body": "Changed keywords from none to **sd48**",
    "created_at": "2013-06-18T18:37:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165378",
    "user": "https://github.com/kcrisman"
}
```

Changed keywords from none to **sd48**



---

archive/issue_comments_165379.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNote that the spkg changes are not committed.",
    "created_at": "2013-06-18T18:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165379",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

Note that the spkg changes are not committed.



---

archive/issue_comments_165380.json:
```json
{
    "body": "Changed dependencies from **#13364** to none",
    "created_at": "2013-06-19T13:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165380",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **#13364** to none



---

archive/issue_comments_165381.json:
```json
{
    "body": "Upstream: **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2013-06-19T13:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165381",
    "user": "https://github.com/kcrisman"
}
```

Upstream: **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_165382.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThanks to Barton Willis for this workaround.\n\n```\nThis bug is due to circa January 2013 changes to matrix inversion. A workaround is to set ratmx to true:\n\nMaxima branch_5_30_base_98_g29f9239_dirty http://maxima.sourceforge.net\nusing Lisp Clozure Common Lisp Version 1.9-r15764  (WindowsX8632)\n\n(%i1) matrixexp(matrix([%i*%pi]));\n\nUnable to find the spectral representation\n\n(%i2) matrixexp(matrix([%i*%pi])), ratmx=true;\n(%o2)                                 - 1\n```\nI've reported this [here](https://sourceforge.net/p/maxima/bugs/2596/).  I don't know if doing this ratmx thing universally is good, though:\n\n```\n if FALSE will cause determinant and matrix addition, subtraction, and multiplication to be performed in the representation of the matrix elements and will cause the result of matrix inversion to be left in general representation. If it is TRUE, the 4 operations mentioned above will be performed in CRE form and the result of matrix inverse will be in CRE form. Note that this may cause the elements to be expanded (depending on the setting of RATFAC) which might not always be desired.\n```",
    "created_at": "2013-06-19T13:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165382",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">comment:22</div>

Thanks to Barton Willis for this workaround.

```
This bug is due to circa January 2013 changes to matrix inversion. A workaround is to set ratmx to true:

Maxima branch_5_30_base_98_g29f9239_dirty http://maxima.sourceforge.net
using Lisp Clozure Common Lisp Version 1.9-r15764  (WindowsX8632)

(%i1) matrixexp(matrix([%i*%pi]));

Unable to find the spectral representation

(%i2) matrixexp(matrix([%i*%pi])), ratmx=true;
(%o2)                                 - 1
```
I've reported this [here](https://sourceforge.net/p/maxima/bugs/2596/).  I don't know if doing this ratmx thing universally is good, though:

```
 if FALSE will cause determinant and matrix addition, subtraction, and multiplication to be performed in the representation of the matrix elements and will cause the result of matrix inversion to be left in general representation. If it is TRUE, the 4 operations mentioned above will be performed in CRE form and the result of matrix inverse will be in CRE form. Note that this may cause the elements to be expanded (depending on the setting of RATFAC) which might not always be desired.
```



---

archive/issue_comments_165383.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n \n-Fixes #13526, #14306, #13712, #14591, #14677.\n+Fixes #13526, #14306, #13712, #14591, #14677, #8728.\n``````\n",
    "created_at": "2013-06-26T14:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165383",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
 
-Fixes #13526, #14306, #13712, #14591, #14677.
+Fixes #13526, #14306, #13712, #14591, #14677, #8728.
``````




---

archive/issue_events_194384.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194384"
}
```



---

archive/issue_events_194385.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194385"
}
```



---

archive/issue_comments_165384.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n5.31 has been released.",
    "created_at": "2013-09-04T22:52:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165384",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

5.31 has been released.



---

archive/issue_events_194386.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194386"
}
```



---

archive/issue_events_194387.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194387"
}
```



---

archive/issue_events_194388.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194388"
}
```



---

archive/issue_events_194389.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194389"
}
```



---

archive/issue_comments_165385.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nMaxima is now at version 5.33.0.  The bug described in comments 15, 19 and 22 still exists.",
    "created_at": "2014-05-15T21:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165385",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:28" align="right">comment:28</div>

Maxima is now at version 5.33.0.  The bug described in comments 15, 19 and 22 still exists.



---

archive/issue_comments_165386.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI found a patch that I think has the same effect as the workaround in [comment:22](#comment:22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:\n\n```diff\n--- a/share/linearalgebra/matrixexp.lisp        2013-10-07 04:37:12.000000000 +0100\n+++ b/share/linearalgebra/matrixexp.lisp        2014-05-16 02:16:09.112011893 +0100\n@@ -138,8 +138,8 @@\n           (print `(ratvars = ,$ratvars gcd = '$gcd algebraic = ,$algebraic))\n           (print `(ratfac = ,$ratfac))\n           (merror \"Unable to find the spectrum\")))\n-   \n-    (setq res ($fullratsimp (ncpower (sub (mult z ($ident n)) mat) -1) z))\n+\n+    (setq res ($fullratsimp ($invert (sub (mult z ($ident n)) mat) '$crering) z))\n     (setq m (length sp))\n     (dotimes (i m)\n       (setq zi (nth i sp))\n```\nI'll try to see if upgrading to 5.33.0 gives any further unexpected problems.",
    "created_at": "2014-05-16T03:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165386",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:29" align="right">comment:29</div>

I found a patch that I think has the same effect as the workaround in [comment:22](#comment:22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:

```diff
--- a/share/linearalgebra/matrixexp.lisp        2013-10-07 04:37:12.000000000 +0100
+++ b/share/linearalgebra/matrixexp.lisp        2014-05-16 02:16:09.112011893 +0100
@@ -138,8 +138,8 @@
           (print `(ratvars = ,$ratvars gcd = '$gcd algebraic = ,$algebraic))
           (print `(ratfac = ,$ratfac))
           (merror "Unable to find the spectrum")))
-   
-    (setq res ($fullratsimp (ncpower (sub (mult z ($ident n)) mat) -1) z))
+
+    (setq res ($fullratsimp ($invert (sub (mult z ($ident n)) mat) '$crering) z))
     (setq m (length sp))
     (dotimes (i m)
       (setq zi (nth i sp))
```
I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.



---

archive/issue_comments_165387.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n> I found a patch that I think has the same effect as the workaround in [comment:22](#comment:22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:\n\nI have added it to the [bug report in question](https://sourceforge.net/p/maxima/bugs/2596/).\n> I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.\n\nLet's hope not!",
    "created_at": "2014-05-16T13:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165387",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">comment:30</div>

> I found a patch that I think has the same effect as the workaround in [comment:22](#comment:22).  I don't have a sourceforge account, so here it is in case there are any Maxima experts here who want to check it and (if it is any good) maybe forward it to the Maxima bug tracking system:

I have added it to the [bug report in question](https://sourceforge.net/p/maxima/bugs/2596/).
> I'll try to see if upgrading to 5.33.0 gives any further unexpected problems.

Let's hope not!



---

archive/issue_comments_165388.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThanks!  No major problems so far; there is one integration doctest that does not finish, but Maxima itself returns the answer quickly, so the timeout has to occur in the interface.",
    "created_at": "2014-05-16T14:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165388",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:31" align="right">comment:31</div>

Thanks!  No major problems so far; there is one integration doctest that does not finish, but Maxima itself returns the answer quickly, so the timeout has to occur in the interface.



---

archive/issue_comments_165389.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThe problematic doctest is the following one from `sage/misc/functional.py`:\n\n```\nsage: f = exp(-x) * sinh(sqrt(x))\nsage: t = integrate(f, x, 0, Infinity)\n```\nWith an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for\n\n```\nsage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')\n```\n\nThis is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):\n\n```\n(%i1) integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf); \n(%o1) \n    1/4                                              1\n  %e    (2 gamma_incomplete(1, 1) - gamma_incomplete(-, 1) - sqrt(%pi) - 2)\n                                                     2\n- -------------------------------------------------------------------------\n                                      4\n                                    1/4                  1\n     1/4                          %e    gamma_incomplete(-, 1)\n   %e    gamma_incomplete(1, 1)                          2\n + ---------------------------- - ----------------------------\n                2                              4\n     1/4               1/4\n   %e    sqrt(%pi)   %e\n + --------------- - -----\n          4            2\n```\nIt would seem to be an interface problem that already exists in some form in Sage 6.2 and manifests itself more relentlessly with the Maxima 5.33.0 spkg I am making.",
    "created_at": "2014-05-16T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165389",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:32" align="right">comment:32</div>

The problematic doctest is the following one from `sage/misc/functional.py`:

```
sage: f = exp(-x) * sinh(sqrt(x))
sage: t = integrate(f, x, 0, Infinity)
```
With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for

```
sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')
```

This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):

```
(%i1) integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf); 
(%o1) 
    1/4                                              1
  %e    (2 gamma_incomplete(1, 1) - gamma_incomplete(-, 1) - sqrt(%pi) - 2)
                                                     2
- -------------------------------------------------------------------------
                                      4
                                    1/4                  1
     1/4                          %e    gamma_incomplete(-, 1)
   %e    gamma_incomplete(1, 1)                          2
 + ---------------------------- - ----------------------------
                2                              4
     1/4               1/4
   %e    sqrt(%pi)   %e
 + --------------- - -----
          4            2
```
It would seem to be an interface problem that already exists in some form in Sage 6.2 and manifests itself more relentlessly with the Maxima 5.33.0 spkg I am making.



---

archive/issue_comments_165390.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@pjbruin](#comment:32):\n> The problematic doctest is the following one from `sage/misc/functional.py`:\n> \n> ```\n> sage: f = exp(-x) * sinh(sqrt(x))\n> sage: t = integrate(f, x, 0, Infinity)\n> ```\n> With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for\n> \n> ```\n> sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')\n> ```\n> \n> This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):\n\nI am not at all convinced it is the interface problem. It is more likely the Maxima packages loaded by default in Sage library (see the corr. Sage source files) and not loaded in your test run. When I only `load(abs_integrate)` i Sage's 6.2 Maxima, or don't load anything at all, I get an almost instant answer.\nWhen I load the whole bunch from lines 142-4 of `sage/interfaces/maxima_lib.py`\n\n```\ninit_code = ['display2d : false', 'domain : complex', 'keepfloat : true',\n            'load(to_poly_solve)', 'load(simplify_sum)',\n            'load(abs_integrate)']\n```\nit goes much slower.",
    "created_at": "2014-05-16T15:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165390",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@pjbruin](#comment:32):
> The problematic doctest is the following one from `sage/misc/functional.py`:
> 
> ```
> sage: f = exp(-x) * sinh(sqrt(x))
> sage: t = integrate(f, x, 0, Infinity)
> ```
> With an unpatched Sage 6.2 this does finish, but takes a very long time (2-3 minutes).  The same situation occurs for
> 
> ```
> sage: maxima('integrate(exp(-x)*sinh(sqrt(x)), x, 0, inf);')
> ```
> 
> This is surprising given that the following takes less than a second in Maxima (both the one that comes with Sage and a standalone copy, and both versions 5.29.1 and 5.33.0):

I am not at all convinced it is the interface problem. It is more likely the Maxima packages loaded by default in Sage library (see the corr. Sage source files) and not loaded in your test run. When I only `load(abs_integrate)` i Sage's 6.2 Maxima, or don't load anything at all, I get an almost instant answer.
When I load the whole bunch from lines 142-4 of `sage/interfaces/maxima_lib.py`

```
init_code = ['display2d : false', 'domain : complex', 'keepfloat : true',
            'load(to_poly_solve)', 'load(simplify_sum)',
            'load(abs_integrate)']
```
it goes much slower.



---

archive/issue_comments_165391.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThanks!  In fact it seems to be the `domain : complex` setting that is causing the slowness.",
    "created_at": "2014-05-16T15:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165391",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:34" align="right">comment:34</div>

Thanks!  In fact it seems to be the `domain : complex` setting that is causing the slowness.



---

archive/issue_comments_165392.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHow about the minimal workaround of temporarily setting `domain: real` in this doctest?",
    "created_at": "2014-05-16T15:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165392",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:35" align="right">comment:35</div>

How about the minimal workaround of temporarily setting `domain: real` in this doctest?



---

archive/issue_comments_165393.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@pjbruin](#comment:35):\n> How about the minimal workaround of temporarily setting `domain: real` in this doctest?\n\nsure, this is not the 1st time something like this is needed.",
    "created_at": "2014-05-17T08:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165393",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@pjbruin](#comment:35):
> How about the minimal workaround of temporarily setting `domain: real` in this doctest?

sure, this is not the 1st time something like this is needed.



---

archive/issue_events_194390.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-17T11:28:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "title_is": "Upgrade Maxima to 5.33.0",
    "title_was": "Upgrade Maxima past the release 5.29.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194390"
}
```



---

archive/issue_comments_165394.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,10 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)\n+Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n \n-Fixes #13526, #14306, #13712, #14591, #14677, #8728.\n+May fix #8728 (Maxima asks for more constraints).\n+\n+Does not fix #14591, #14677.\n+\n+**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n``````\n",
    "created_at": "2014-05-17T11:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165394",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,10 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/maxima-5.30.0.p0.spkg)
+Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
 
-Fixes #13526, #14306, #13712, #14591, #14677, #8728.
+May fix #8728 (Maxima asks for more constraints).
+
+Does not fix #14591, #14677.
+
+**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
``````




---

archive/issue_comments_165395.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to **Peter Bruin**",
    "created_at": "2014-05-17T11:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165395",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Jeroen Demeyer** to **Peter Bruin**



---

archive/issue_comments_165396.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Completely fixed; Fix reported upstream**",
    "created_at": "2014-05-17T11:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165396",
    "user": "https://github.com/pjbruin"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Completely fixed; Fix reported upstream**



---

archive/issue_comments_165397.json:
```json
{
    "body": "Commit: **[`13d48c2`](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)**",
    "created_at": "2014-05-17T11:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165397",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`13d48c2`](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)**



---

archive/issue_events_194391.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-17T11:28:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194391"
}
```



---

archive/issue_comments_165398.json:
```json
{
    "body": "Branch: **[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)**",
    "created_at": "2014-05-17T11:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165398",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)**



---

archive/issue_comments_165399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n \n May fix #8728 (Maxima asks for more constraints).\n \n``````\n",
    "created_at": "2014-05-17T14:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165399",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
 
 May fix #8728 (Maxima asks for more constraints).
 
``````




---

archive/issue_comments_165400.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nNote about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.",
    "created_at": "2014-05-17T14:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165400",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:38" align="right">comment:38</div>

Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.



---

archive/issue_comments_165401.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,10 +2,12 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n \n May fix #8728 (Maxima asks for more constraints).\n \n Does not fix #14591, #14677.\n \n-**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n+**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n+\n+Note about the patches: `maxima_bug_2526.patch`, which fixes \u200bhttp://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. \n``````\n",
    "created_at": "2014-05-17T14:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165401",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,10 +2,12 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #11894, #13526, #13712, #13733, #14306, and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.
 
 May fix #8728 (Maxima asks for more constraints).
 
 Does not fix #14591, #14677.
 
-**tarball**: [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
+**tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
+
+Note about the patches: `maxima_bug_2526.patch`, which fixes â€‹http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. 
``````




---

archive/issue_comments_165402.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,8 @@\n \n May fix #8728 (Maxima asks for more constraints).\n \n-Does not fix #14591, #14677.\n+Does not fix #14591, #14677, #15033.\n \n **tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)\n \n-Note about the patches: `maxima_bug_2526.patch`, which fixes \u200bhttp://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. \n+Note about the existing `maxima_bug_2526.patch`: \u200bthe bug was marked \"closed\" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.\n``````\n",
    "created_at": "2014-05-20T22:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165402",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,8 @@
 
 May fix #8728 (Maxima asks for more constraints).
 
-Does not fix #14591, #14677.
+Does not fix #14591, #14677, #15033.
 
 **tarball:** [http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2](http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.33.0.tar.bz2)
 
-Note about the patches: `maxima_bug_2526.patch`, which fixes â€‹http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository. 
+Note about the existing `maxima_bug_2526.patch`: â€‹the bug was marked "closed" in the [Maxima bug tracking system](http://sourceforge.net/p/maxima/bugs/2526/), but the commit somehow disappeared from the Maxima repository and the bug has been reopened.  Hence this patch is still needed to fix it.
``````




---

archive/issue_comments_165403.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\n\n```\nsage -t --long src/sage/interfaces/maxima_lib.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_lib.py\", line 702, in sage.interfaces.maxima_lib.MaximaLib.sr_integral\nFailed example:\n    integrate(cos(x + abs(x)), x)\nExpected:\n    -1/4*(2*x - sin(2*x))*realpart(sgn(x)) + 1/2*x + 1/4*sin(2*x)\nGot:\n    -1/4*(2*x - sin(2*x))*real_part(sgn(x)) + 1/2*x + 1/4*sin(2*x)\n**********************************************************************\n```\n\nThis is with Volker's current `develop` branch on github (`d409685`), which includes a few dozens new tickets compared to `6.3.beta1`.",
    "created_at": "2014-05-23T12:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165403",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:41" align="right">comment:41</div>


```
sage -t --long src/sage/interfaces/maxima_lib.py
**********************************************************************
File "src/sage/interfaces/maxima_lib.py", line 702, in sage.interfaces.maxima_lib.MaximaLib.sr_integral
Failed example:
    integrate(cos(x + abs(x)), x)
Expected:
    -1/4*(2*x - sin(2*x))*realpart(sgn(x)) + 1/2*x + 1/4*sin(2*x)
Got:
    -1/4*(2*x - sin(2*x))*real_part(sgn(x)) + 1/2*x + 1/4*sin(2*x)
**********************************************************************
```

This is with Volker's current `develop` branch on github (`d409685`), which includes a few dozens new tickets compared to `6.3.beta1`.



---

archive/issue_events_194392.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T12:46:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194392"
}
```



---

archive/issue_events_194393.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T12:46:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194393"
}
```



---

archive/issue_comments_165404.json:
```json
{
    "body": "Changed commit from **[`13d48c2`](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)** to **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**",
    "created_at": "2014-05-23T13:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165404",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`13d48c2`](https://github.com/sagemath/sagetrac-mirror/commit/13d48c244fa349d456ecd74cc426931433266102)** to **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**



---

archive/issue_comments_165405.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df\"><code>a130eed</code></a></td><td><code>Trac 13973: realpart should be real_part</code></td></tr></table>\n",
    "created_at": "2014-05-23T13:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165405",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df"><code>a130eed</code></a></td><td><code>Trac 13973: realpart should be real_part</code></td></tr></table>




---

archive/issue_comments_165406.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThanks, that must be a consequence of #16224.",
    "created_at": "2014-05-23T13:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165406",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:43" align="right">comment:43</div>

Thanks, that must be a consequence of #16224.



---

archive/issue_events_194394.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T13:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194394"
}
```



---

archive/issue_events_194395.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194395"
}
```



---

archive/issue_comments_165407.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\n> Thanks, that must be a consequence of #16224.\n\nSo... did we have an incorrect translation of Maxima's `realpart` all along?  Interesting.",
    "created_at": "2014-05-23T13:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165407",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:44" align="right">comment:44</div>

> Thanks, that must be a consequence of #16224.

So... did we have an incorrect translation of Maxima's `realpart` all along?  Interesting.



---

archive/issue_comments_165408.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nIs there a reason for no longer using `z...` in the following test?\n\n```\n@@ -9231,7 +9231,7 @@ cdef class Expression(CommutativeRingElement):\n             sage: from sage.calculus.calculus import maxima\n             sage: sol = maxima(cos(x)==0).to_poly_solve(x)\n             sage: sol.sage()\n-            [[x == -1/2*pi + 2*pi*z...], [x == 1/2*pi + 2*pi*z...]]\n+            [[x == 1/2*pi + pi*z82]]\n \n         If a returned unsolved expression has a denominator, but the\n         original one did not, this may also be true::\n```\n\nThe same comment may apply to `z[0-9]+` in \n\n```\nsrc/sage/interfaces/maxima_lib.py:            [[x == pi*z54]]\nsrc/sage/symbolic/relation.py:        [[x == 1/4*pi + pi*z80, y == -1/4*pi - pi*z80]]\n```\n\nThe bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:\n\n```\nsage: integral(log(cot(x)-1),x,0,pi/4)\n...\nRuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.\n```\n\nOtherwise looks good to me.",
    "created_at": "2014-05-23T15:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165408",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:45" align="right">comment:45</div>

Is there a reason for no longer using `z...` in the following test?

```
@@ -9231,7 +9231,7 @@ cdef class Expression(CommutativeRingElement):
             sage: from sage.calculus.calculus import maxima
             sage: sol = maxima(cos(x)==0).to_poly_solve(x)
             sage: sol.sage()
-            [[x == -1/2*pi + 2*pi*z...], [x == 1/2*pi + 2*pi*z...]]
+            [[x == 1/2*pi + pi*z82]]
 
         If a returned unsolved expression has a denominator, but the
         original one did not, this may also be true::
```

The same comment may apply to `z[0-9]+` in 

```
src/sage/interfaces/maxima_lib.py:            [[x == pi*z54]]
src/sage/symbolic/relation.py:        [[x == 1/4*pi + pi*z80, y == -1/4*pi - pi*z80]]
```

The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:

```
sage: integral(log(cot(x)-1),x,0,pi/4)
...
RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.
```

Otherwise looks good to me.



---

archive/issue_comments_165409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,11 @@\n [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), \n which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.\n \n-Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n+Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.\n \n-May fix #8728 (Maxima asks for more constraints).\n+Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).\n+\n+Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).\n \n Does not fix #14591, #14677, #15033.\n \n``````\n",
    "created_at": "2014-05-23T17:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165409",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,11 @@
 [issue reported on sage-support](http://permalink.gmane.org/gmane.comp.mathematics.sage.support/30644), 
 which was reported as Maxima bug [2535](https://sourceforge.net/p/maxima/bugs/2535), and marked there as closed in post-5.29.1.
 
-Fixes #11894, #13526, #13712, #13733, #14209, #14306, #15386 and possibly other Maxima-related bugs.
+Fixes #11894, #13526, #13712, #14209, #14306, #15386 and possibly other Maxima-related bugs.
 
-May fix #8728 (Maxima asks for more constraints).
+Ought to fix #13733 (but loading the `abs_integrate` package currently causes this to fail).
+
+Ought to fix #8728 (but Maxima asks for more constraints which follow from the existing ones).
 
 Does not fix #14591, #14677, #15033.
 
``````




---

archive/issue_comments_165410.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@mezzarobba](#comment:45):\n> Is there a reason for no longer using `z...` in the following test?\n\nMostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a \"serial number\" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.\n> The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:\n> \n> ```\n> sage: integral(log(cot(x)-1),x,0,pi/4)\n> ...\n> RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.\n> ```\n\nYou're right; I tested this inside Maxima (`sage --maxima`), but Sage loads additional packages.  In this case the failure is caused by loading `abs_integrate`.  Using 5.33.0:\n\n```\n$ sage --maxima\n...\n(%i1) display2d: false$\n\n(%i2) integrate(log(cot(x)-1),x,0,%pi/4);\n\n(%o2) (%i*li[2]((%i+1)/2)-%i*li[2](-(%i-1)/2))/2\n -(%i*(2*li[2](%i+1)-2*li[2](1-%i))+%pi*log(2))/4\n(%i3) load(abs_integrate)$\n\n(%i4) integrate(log(cot(x)-1),x,0,%pi/4);\n\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nlog: encountered log(0).\nPSLOG: internal error.\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2014-05-23T17:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165410",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@mezzarobba](#comment:45):
> Is there a reason for no longer using `z...` in the following test?

Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a "serial number" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.
> The bugs listed in the description indeed appear to be fixed with the update, **except** #13733, for which I get:
> 
> ```
> sage: integral(log(cot(x)-1),x,0,pi/4)
> ...
> RuntimeError: ECL says: Error executing code in Maxima: PSLOG: internal error.
> ```

You're right; I tested this inside Maxima (`sage --maxima`), but Sage loads additional packages.  In this case the failure is caused by loading `abs_integrate`.  Using 5.33.0:

```
$ sage --maxima
...
(%i1) display2d: false$

(%i2) integrate(log(cot(x)-1),x,0,%pi/4);

(%o2) (%i*li[2]((%i+1)/2)-%i*li[2](-(%i-1)/2))/2
 -(%i*(2*li[2](%i+1)-2*li[2](1-%i))+%pi*log(2))/4
(%i3) load(abs_integrate)$

(%i4) integrate(log(cot(x)-1),x,0,%pi/4);

log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
log: encountered log(0).
PSLOG: internal error.
 -- an error. To debug this try: debugmode(true);
```



---

archive/issue_comments_165411.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2014-05-23T17:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165411",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_165412.json:
```json
{
    "body": "Changed upstream from **Completely fixed; Fix reported upstream** to none",
    "created_at": "2014-05-23T17:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165412",
    "user": "https://github.com/mezzarobba"
}
```

Changed upstream from **Completely fixed; Fix reported upstream** to none



---

archive/issue_comments_165413.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@pjbruin](#comment:46):\n> Replying to [@mezzarobba](#comment:45):\n> > Is there a reason for no longer using `z...` in the following test?\n\n> Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a \"serial number\" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.\n\nNo, that's fine with me, I just wanted to make sure that it was intentional.",
    "created_at": "2014-05-23T17:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165413",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@pjbruin](#comment:46):
> Replying to [@mezzarobba](#comment:45):
> > Is there a reason for no longer using `z...` in the following test?

> Mostly readability (since the tests are also part of the documentation); with the `...` it is not clear that it is just a "serial number" and not part of a larger expression that has been left out.  Of course it is somewhat random, so it may change once in a while with Maxima upgrades or changes in other doctests in the same file.  I personally think displaying a complete answer is worth the trouble of having to change it every now and then, but if you insist I can change all such examples to `...`.

No, that's fine with me, I just wanted to make sure that it was intentional.



---

archive/issue_events_194396.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T17:46:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194396"
}
```



---

archive/issue_events_194397.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-05-23T17:46:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194397"
}
```



---

archive/issue_comments_165414.json:
```json
{
    "body": "Changed branch from **[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)** to **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**",
    "created_at": "2014-05-25T17:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165414",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/13973-maxima_update](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/13973-maxima_update)** to **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)**



---

archive/issue_events_194398.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-25T17:31:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194398"
}
```



---

archive/issue_events_194399.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6220027f174e01ae252f277acb3a75de7053239c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-25T17:31:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13973#event-194399"
}
```



---

archive/issue_comments_165415.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\n> Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked \"closed\" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.\n\nOkay, this is [finally in Maxima](http://sourceforge.net/p/maxima/bugs/2526/?limit=10&page=1#4cee), so the next Maxima upgrade will get to remove this patch.",
    "created_at": "2014-06-04T13:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165415",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:49" align="right">comment:49</div>

> Note about the patches: `maxima_bug_2526.patch`, which fixes http://sourceforge.net/p/maxima/bugs/2526/, is still necessary even though the bug is marked "closed" in the Maxima bug tracking system; the commit somehow didn't make it into the Maxima repository.

Okay, this is [finally in Maxima](http://sourceforge.net/p/maxima/bugs/2526/?limit=10&page=1#4cee), so the next Maxima upgrade will get to remove this patch.



---

archive/issue_comments_165416.json:
```json
{
    "body": "Changed commit from **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)** to none",
    "created_at": "2014-06-04T13:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165416",
    "user": "https://github.com/kcrisman"
}
```

Changed commit from **[`a130eed`](https://github.com/sagemath/sagetrac-mirror/commit/a130eed39a9e2e86301e94d9e16932fd38be64df)** to none



---

archive/issue_comments_165417.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\n#14306 needs review.",
    "created_at": "2014-06-04T13:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13973#issuecomment-165417",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:50" align="right">comment:50</div>

#14306 needs review.
