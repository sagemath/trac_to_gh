# Issue 13202: conversion problems in BooleanPolynomialRing with degrevlex order

archive/issues_013030.json:
```json
{
    "assignees": [
        "https://github.com/malb"
    ],
    "body": "Some conversion between different BooleanPolynomial rings fail but they should not.\n\nexample :\n\n```\nsage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\nsage: P.<c,d> = BooleanPolynomialRing(order='lex')\nsage: P(B('c'))\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1369, 0))\n.......\nTypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n```\n\n* **Apply**: [attachment: pbori_consistent_degrevlex_5-2.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)\n\nDepends on #13229\n\nCC:  @malb @alexanderdreyer @sagetrac-PolyBoRi\n\nComponent: **commutative algebra**\n\nKeywords: **conversion**\n\nAuthor: **Alexander Dreyer, Charles Bouillaguet**\n\nReviewer: **Martin Albrecht, Charles Bouillaguet**\n\nMerged: **sage-5.3.beta1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13202_\n\n",
    "closed_at": "2012-08-12T19:01:08Z",
    "created_at": "2012-07-04T23:24:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "conversion problems in BooleanPolynomialRing with degrevlex order",
    "type": "issue",
    "updated_at": "2012-08-12T19:01:08Z",
    "url": "https://github.com/sagemath/sage/issues/13202",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```
Some conversion between different BooleanPolynomial rings fail but they should not.

example :

```
sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
sage: P.<c,d> = BooleanPolynomialRing(order='lex')
sage: P(B('c'))
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1369, 0))
.......
TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
```

* **Apply**: [attachment: pbori_consistent_degrevlex_5-2.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)

Depends on #13229

CC:  @malb @alexanderdreyer @sagetrac-PolyBoRi

Component: **commutative algebra**

Keywords: **conversion**

Author: **Alexander Dreyer, Charles Bouillaguet**

Reviewer: **Martin Albrecht, Charles Bouillaguet**

Merged: **sage-5.3.beta1**

_Issue created by migration from https://trac.sagemath.org/ticket/13202_





---

archive/issue_events_181842.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T23:24:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181842"
}
```



---

archive/issue_events_181843.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T23:24:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181843"
}
```



---

archive/issue_events_181844.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T23:24:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181844"
}
```



---

archive/issue_events_181845.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T23:24:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181845"
}
```



---

archive/issue_events_181846.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-07-04T23:24:43Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "subject": "https://github.com/sagetrac-Bouillaguet",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181846"
}
```



---

archive/issue_comments_151451.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n-Some conversion between different BooleanPolynomial rings fail but they should not\n+Some conversion between different BooleanPolynomial rings fail but they should not.\n \n example :\n-{{\n+\n+```\n sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\n sage: P.<c,d> = BooleanPolynomialRing(order='lex')\n sage: P(B('c'))\n@@ -10,4 +11,4 @@\n The error message is: ('EOF in multi-line statement', (1369, 0))\n .......\n TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n-}}\n+```\n``````\n",
    "created_at": "2012-07-04T23:26:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151451",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
-Some conversion between different BooleanPolynomial rings fail but they should not
+Some conversion between different BooleanPolynomial rings fail but they should not.
 
 example :
-{{
+
+```
 sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
 sage: P.<c,d> = BooleanPolynomialRing(order='lex')
 sage: P(B('c'))
@@ -10,4 +11,4 @@
 The error message is: ('EOF in multi-line statement', (1369, 0))
 .......
 TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
-}}
+```
``````




---

archive/issue_comments_151452.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nin `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).",
    "created_at": "2012-07-05T22:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151452",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:2" align="right">comment:2</div>

in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).



---

archive/issue_comments_151453.json:
```json
{
    "body": "Attachment: **[dp_quickfix.patch.gz](https://github.com/sagemath/sage/files/ticket13202/dp_quickfix.patch.gz)**",
    "created_at": "2012-07-05T22:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151453",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment: **[dp_quickfix.patch.gz](https://github.com/sagemath/sage/files/ticket13202/dp_quickfix.patch.gz)**



---

archive/issue_comments_151454.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@alexanderdreyer](#comment%3A2):\n> in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).\n\nWow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.\n\nSo, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore...",
    "created_at": "2012-07-05T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151454",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@alexanderdreyer](#comment%3A2):
> in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).

Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.

So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore...



---

archive/issue_comments_151455.json:
```json
{
    "body": "Author: **Alexander Dreyer**",
    "created_at": "2012-07-05T23:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151455",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Author: **Alexander Dreyer**



---

archive/issue_comments_151456.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI made a new patch that includes the first patch but adds a doctest that checks that everything goes well",
    "created_at": "2012-07-05T23:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151456",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:4" align="right">comment:4</div>

I made a new patch that includes the first patch but adds a doctest that checks that everything goes well



---

archive/issue_comments_151457.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A3):\n> Replying to [@alexanderdreyer](#comment%3A2):\n> > in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).\n\n> \n> Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.\n\nI'll try to find some time to write some comments. (out out office and today)\n\n> So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore.\n\nNo,it's not the same! It's the same like a having `PolyBoRi`'s \"dp_asc\" with reversed indices. \nBut, there's no dp_asc in Sage. (Because we invented this in `PolyBoRi` for technical reasons.)\ndegrevlex is necessary, because it's he most popular ordering in computational algebra, because it's the fastest for homogenous problem (and behaves well in others). So one cannot drop it.",
    "created_at": "2012-07-06T06:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151457",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A3):
> Replying to [@alexanderdreyer](#comment%3A2):
> > in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).

> 
> Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.

I'll try to find some time to write some comments. (out out office and today)

> So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore.

No,it's not the same! It's the same like a having `PolyBoRi`'s "dp_asc" with reversed indices. 
But, there's no dp_asc in Sage. (Because we invented this in `PolyBoRi` for technical reasons.)
degrevlex is necessary, because it's he most popular ordering in computational algebra, because it's the fastest for homogenous problem (and behaves well in others). So one cannot drop it.



---

archive/issue_comments_151458.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nRe: Alexander, okay, let's try to fix it then :)\nRe: Charles, can you remove that `if True`?",
    "created_at": "2012-07-06T09:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151458",
    "user": "https://github.com/malb"
}
```

<div id="comment:6" align="right">comment:6</div>

Re: Alexander, okay, let's try to fix it then :)
Re: Charles, can you remove that `if True`?



---

archive/issue_events_181847.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-06T13:56:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181847"
}
```



---

archive/issue_comments_151459.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nDone",
    "created_at": "2012-07-06T13:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151459",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:7" align="right">comment:7</div>

Done



---

archive/issue_comments_151460.json:
```json
{
    "body": "Reviewer: **Martin Albrecht**",
    "created_at": "2012-07-06T15:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151460",
    "user": "https://github.com/malb"
}
```

Reviewer: **Martin Albrecht**



---

archive/issue_comments_151461.json:
```json
{
    "body": "Changed author from **Alexander Dreyer** to **Alexander Dreyer, Charles Bouillaguet**",
    "created_at": "2012-07-06T15:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151461",
    "user": "https://github.com/malb"
}
```

Changed author from **Alexander Dreyer** to **Alexander Dreyer, Charles Bouillaguet**



---

archive/issue_comments_151462.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLooks good, I'll let the patchbot decide whether doctests pass or not.",
    "created_at": "2012-07-06T15:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151462",
    "user": "https://github.com/malb"
}
```

<div id="comment:8" align="right">comment:8</div>

Looks good, I'll let the patchbot decide whether doctests pass or not.



---

archive/issue_comments_151463.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@malb](#comment%3A8):\n> Looks good, I'll let the patchbot decide whether doctests pass or not.\n\nFor that to work, we would need to tell it to only apply the second patch. How do you do that ?",
    "created_at": "2012-07-08T01:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151463",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@malb](#comment%3A8):
> Looks good, I'll let the patchbot decide whether doctests pass or not.

For that to work, we would need to tell it to only apply the second patch. How do you do that ?



---

archive/issue_comments_151464.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nStill, there is something relatively annoying :\n\n```\nsage: R.<x,y,z> = BooleanPolynomialRing(order='degrevlex')\nsage: m = x          # a random monomial\nsage: x.lm().index() # the index of the first variable of m, most people would expect \"0\"\n2\nsage: R.gen(2)\nz\n```\nAnd in fact, to make it shorter:\n\n```\nsage: R.gen(0) == R.gen( R.gen(0).lm().index() )\nFalse\n```\n\nWhile this is not a bug in itself, it is disturbing, and it has caused at least one problem in my code. It also exposes to the user something that should be kept hidden from her (namely, how the sage interface implements the degrevlex ordering on top of polybori). \n\nFixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this \"feature\"",
    "created_at": "2012-07-08T06:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151464",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:10" align="right">comment:10</div>

Still, there is something relatively annoying :

```
sage: R.<x,y,z> = BooleanPolynomialRing(order='degrevlex')
sage: m = x          # a random monomial
sage: x.lm().index() # the index of the first variable of m, most people would expect "0"
2
sage: R.gen(2)
z
```
And in fact, to make it shorter:

```
sage: R.gen(0) == R.gen( R.gen(0).lm().index() )
False
```

While this is not a bug in itself, it is disturbing, and it has caused at least one problem in my code. It also exposes to the user something that should be kept hidden from her (namely, how the sage interface implements the degrevlex ordering on top of polybori). 

Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this "feature"



---

archive/issue_comments_151465.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,3 +12,5 @@\n .......\n TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n ```\n+\n+Apply pbori_degrevlex_problem.patch\n``````\n",
    "created_at": "2012-07-08T07:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151465",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,3 +12,5 @@
 .......
 TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
 ```
+
+Apply pbori_degrevlex_problem.patch
``````




---

archive/issue_comments_151466.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nApply pbori_degrevlex_problem.patch",
    "created_at": "2012-07-08T07:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151466",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:12" align="right">comment:12</div>

Apply pbori_degrevlex_problem.patch



---

archive/issue_comments_151467.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this \"feature\"\n\nWell, it would break much more since the the Sage uses `pbori.pyx` also to interconnect betweento `PolyBoRi`'s  python modules and its C++-based kernel (supplementing `PolyBoRi`'s original interface here). As long as Sage-only and `PolyBoRi`-only function are not mixed, this should not be a problem.\n\nBut I just realized, that `.variable()` is reordered (unlike `.gen()` it shouldn't), so I'll check this for consistency.",
    "created_at": "2012-07-08T20:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151467",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:13" align="right">comment:13</div>

> Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this "feature"

Well, it would break much more since the the Sage uses `pbori.pyx` also to interconnect betweento `PolyBoRi`'s  python modules and its C++-based kernel (supplementing `PolyBoRi`'s original interface here). As long as Sage-only and `PolyBoRi`-only function are not mixed, this should not be a problem.

But I just realized, that `.variable()` is reordered (unlike `.gen()` it shouldn't), so I'll check this for consistency.



---

archive/issue_comments_151468.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI thought about this. For a clean fix, we will need to distinguish between pure `dp_asc` and `DegRevLex`. So I prepared a patch to add `dp_asc` (as `DegNegLex`) to Sage, see #13229.\n\nBTW: Was the patchbot successful?",
    "created_at": "2012-07-11T13:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151468",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:14" align="right">comment:14</div>

I thought about this. For a clean fix, we will need to distinguish between pure `dp_asc` and `DegRevLex`. So I prepared a patch to add `dp_asc` (as `DegNegLex`) to Sage, see #13229.

BTW: Was the patchbot successful?



---

archive/issue_comments_151469.json:
```json
{
    "body": "Attachment: **[pbori_degrevlex_problem.2.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_degrevlex_problem.2.patch.gz)**\n\nincludes first patch (dp_quickfix.patch) + add doctest",
    "created_at": "2012-07-12T11:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151469",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Attachment: **[pbori_degrevlex_problem.2.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_degrevlex_problem.2.patch.gz)**

includes first patch (dp_quickfix.patch) + add doctest



---

archive/issue_comments_151470.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[pbori_degrevlex_problem.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_degrevlex_problem.patch.gz)**\n\nSo, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:\n\n- m.index() exposes the hack behind the current implementation of degreglex\n- Alexander seems to believe that there is a problem with variables() \n\nSo, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)",
    "created_at": "2012-07-12T11:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151470",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[pbori_degrevlex_problem.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_degrevlex_problem.patch.gz)**

So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:

- m.index() exposes the hack behind the current implementation of degreglex
- Alexander seems to believe that there is a problem with variables() 

So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)



---

archive/issue_comments_151471.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A15):\n> So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:\n> \n> - m.index() exposes the hack behind the current implementation of degreglex\n\nYes, I'm about to fix that. (It's not only index to be fixed.)\n\n> - Alexander seems to believe that there is a problem with variables() \n\nI thought ring.variable(i) should give the i-th polybori variable (not reordered). But thinking twice, that would cause more problems than it solves.\n \n> So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)\n\nThe problem is the ambigious nature of pbori.pyx:\nOn the one hand, it is the Sage implementation of BooleanPolynomial which should support degrevlex in such a way, that the user is not aware of the reversed variables hack.\nOn the other hand, Sage uses pbori.pyx as a lightweight alternative to polybori's original (boost-based) C++-to-python interface (for running polybori's highlevel library stuff in <python-site>/polybori/*). We don't need degrevlex here (but degneglex).\n\nThe latter is trivial, once `DegNegLex` is in Sage. For the first point, I will provide a first variant later this day.",
    "created_at": "2012-07-12T11:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151471",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A15):
> So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:
> 
> - m.index() exposes the hack behind the current implementation of degreglex

Yes, I'm about to fix that. (It's not only index to be fixed.)

> - Alexander seems to believe that there is a problem with variables() 

I thought ring.variable(i) should give the i-th polybori variable (not reordered). But thinking twice, that would cause more problems than it solves.
 
> So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)

The problem is the ambigious nature of pbori.pyx:
On the one hand, it is the Sage implementation of BooleanPolynomial which should support degrevlex in such a way, that the user is not aware of the reversed variables hack.
On the other hand, Sage uses pbori.pyx as a lightweight alternative to polybori's original (boost-based) C++-to-python interface (for running polybori's highlevel library stuff in <python-site>/polybori/*). We don't need degrevlex here (but degneglex).

The latter is trivial, once `DegNegLex` is in Sage. For the first point, I will provide a first variant later this day.



---

archive/issue_comments_151472.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHere's my proposed change to `pbori.pyx` `.index()`, `.iterindex()` and related functions obey the variable reordering in degrevlex now. Also, degneglex is supported now. Feel free to test it. (There are only a few degrevlex examples in the doctests, so some functionality might not be covered.)",
    "created_at": "2012-07-12T22:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151472",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Here's my proposed change to `pbori.pyx` `.index()`, `.iterindex()` and related functions obey the variable reordering in degrevlex now. Also, degneglex is supported now. Feel free to test it. (There are only a few degrevlex examples in the doctests, so some functionality might not be covered.)



---

archive/issue_comments_151473.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n ```\n \n-Apply pbori_degrevlex_problem.patch\n+* **Apply**: [attachment: pbori_consistent_degrevlex.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)\n``````\n",
    "created_at": "2012-07-12T22:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151473",
    "user": "https://github.com/alexanderdreyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
 ```
 
-Apply pbori_degrevlex_problem.patch
+* **Apply**: [attachment: pbori_consistent_degrevlex.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)
``````




---

archive/issue_comments_151474.json:
```json
{
    "body": "Dependencies: **#13229**",
    "created_at": "2012-07-12T22:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151474",
    "user": "https://github.com/alexanderdreyer"
}
```

Dependencies: **#13229**



---

archive/issue_comments_151475.json:
```json
{
    "body": "Attachment: **[pbori_consistent_degrevlex.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)**\n\nIndices obey variable reordering for DegRevLex, introduces DegNegLex",
    "created_at": "2012-07-12T22:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151475",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment: **[pbori_consistent_degrevlex.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)**

Indices obey variable reordering for DegRevLex, introduces DegNegLex



---

archive/issue_comments_151476.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nApply pbori_consistent_degrevlex.patch",
    "created_at": "2012-07-13T06:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151476",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Apply pbori_consistent_degrevlex.patch



---

archive/issue_comments_151477.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n ```\n \n-* **Apply**: [attachment: pbori_consistent_degrevlex.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)\n+* **Apply**: [attachment: pbori_consistent_degrevlex_5-2.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)\n``````\n",
    "created_at": "2012-07-13T06:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151477",
    "user": "https://github.com/alexanderdreyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
 ```
 
-* **Apply**: [attachment: pbori_consistent_degrevlex.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex.patch.gz)
+* **Apply**: [attachment: pbori_consistent_degrevlex_5-2.patch](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)
``````




---

archive/issue_comments_151478.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nRebased patch to Sage 5.2 rc0: \nApply pbori_consistent_degrevlex_5-2.patch",
    "created_at": "2012-07-13T06:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151478",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Rebased patch to Sage 5.2 rc0: 
Apply pbori_consistent_degrevlex_5-2.patch



---

archive/issue_comments_151479.json:
```json
{
    "body": "Attachment: **[pbori_consistent_degrevlex_5-2.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)**\n\nIndices obey variable reordering for `DegRevLex`, introduces `DegNegLex` (rebased to Sage 5.2 rc0)",
    "created_at": "2012-07-13T07:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151479",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment: **[pbori_consistent_degrevlex_5-2.patch.gz](https://github.com/sagemath/sage/files/ticket13202/pbori_consistent_degrevlex_5-2.patch.gz)**

Indices obey variable reordering for `DegRevLex`, introduces `DegNegLex` (rebased to Sage 5.2 rc0)



---

archive/issue_comments_151480.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nApply pbori_consistent_degrevlex_5-2.patch",
    "created_at": "2012-07-13T07:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151480",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Apply pbori_consistent_degrevlex_5-2.patch



---

archive/issue_comments_151481.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n`@`Charles Bouillaguet: Does the new design (avoid internal index exposing to the user) fit your needs?",
    "created_at": "2012-07-19T06:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151481",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:21" align="right">comment:21</div>

`@`Charles Bouillaguet: Does the new design (avoid internal index exposing to the user) fit your needs?



---

archive/issue_comments_151482.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n@AlexanderDreyer: I'm happy with it! It makes the patchbot happy so I suppose we could go for a positive review... malb?",
    "created_at": "2012-07-22T09:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151482",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:22" align="right">comment:22</div>

@AlexanderDreyer: I'm happy with it! It makes the patchbot happy so I suppose we could go for a positive review... malb?



---

archive/issue_comments_151483.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nLet's do it.",
    "created_at": "2012-07-22T09:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151483",
    "user": "https://github.com/malb"
}
```

<div id="comment:23" align="right">comment:23</div>

Let's do it.



---

archive/issue_events_181848.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-07-22T09:18:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181848"
}
```



---

archive/issue_events_181849.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-07-22T09:18:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181849"
}
```



---

archive/issue_comments_151484.json:
```json
{
    "body": "Changed reviewer from **Martin Albrecht** to **Martin Albrecht, Charles Bouillaguet**",
    "created_at": "2012-07-22T09:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151484",
    "user": "https://github.com/malb"
}
```

Changed reviewer from **Martin Albrecht** to **Martin Albrecht, Charles Bouillaguet**



---

archive/issue_comments_151485.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nNice to see that the refactored interface turns out to be useful!",
    "created_at": "2012-07-22T21:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151485",
    "user": "https://github.com/alexanderdreyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Nice to see that the refactored interface turns out to be useful!



---

archive/issue_events_181850.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-23T06:56:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181850"
}
```



---

archive/issue_events_181851.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-23T06:56:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181851"
}
```



---

archive/issue_comments_151486.json:
```json
{
    "body": "Merged: **sage-5.3.beta1**",
    "created_at": "2012-08-12T19:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13202#issuecomment-151486",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.3.beta1**



---

archive/issue_events_181852.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T19:01:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181852"
}
```



---

archive/issue_events_181853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T19:01:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13202",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13202#event-181853"
}
```
