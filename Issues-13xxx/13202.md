# Issue 13202: conversion problems in BooleanPolynomialRing with degrevlex order

archive/issues_013030.json:
```json
{
    "body": "Some conversion between different BooleanPolynomial rings fail but they should not.\n\nexample :\n\n```\nsage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\nsage: P.<c,d> = BooleanPolynomialRing(order='lex')\nsage: P(B('c'))\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1369, 0))\n.......\nTypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n```\n\n* **Apply**: attachment:pbori_consistent_degrevlex_5-2.patch\n\nAssignee: @malb\n\nCC:  @malb alexanderdreyer polybori\n\nKeywords: conversion\n\nReviewer: Martin Albrecht, Charles Bouillaguet\n\nAuthor: Alexander Dreyer, Charles Bouillaguet\n\nMerged: sage-5.3.beta1\n\nDependencies: #13229\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13202\n\n",
    "closed_at": "2012-08-12T19:01:08Z",
    "created_at": "2012-07-04T23:24:43Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.3",
    "title": "conversion problems in BooleanPolynomialRing with degrevlex order",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13202",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```
Some conversion between different BooleanPolynomial rings fail but they should not.

example :

```
sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
sage: P.<c,d> = BooleanPolynomialRing(order='lex')
sage: P(B('c'))
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1369, 0))
.......
TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
```

* **Apply**: attachment:pbori_consistent_degrevlex_5-2.patch

Assignee: @malb

CC:  @malb alexanderdreyer polybori

Keywords: conversion

Reviewer: Martin Albrecht, Charles Bouillaguet

Author: Alexander Dreyer, Charles Bouillaguet

Merged: sage-5.3.beta1

Dependencies: #13229

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13202





---

archive/issue_comments_167646.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n-Some conversion between different BooleanPolynomial rings fail but they should not\n+Some conversion between different BooleanPolynomial rings fail but they should not.\n \n example :\n-{{\n+\n+```\n sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\n sage: P.<c,d> = BooleanPolynomialRing(order='lex')\n sage: P(B('c'))\n@@ -10,7 +11,7 @@\n The error message is: ('EOF in multi-line statement', (1369, 0))\n .......\n TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n-}}\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-07-04T23:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167646",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
-Some conversion between different BooleanPolynomial rings fail but they should not
+Some conversion between different BooleanPolynomial rings fail but they should not.
 
 example :
-{{
+
+```
 sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
 sage: P.<c,d> = BooleanPolynomialRing(order='lex')
 sage: P(B('c'))
@@ -10,7 +11,7 @@
 The error message is: ('EOF in multi-line statement', (1369, 0))
 .......
 TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
-}}
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_167647.json:
```json
{
    "body": "<a id='comment:2'></a>in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).",
    "created_at": "2012-07-05T22:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167647",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:2'></a>in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).



---

archive/issue_comments_167648.json:
```json
{
    "body": "Attachment [dp_quickfix.patch](tarball://root/attachments/some-uuid/ticket13202/dp_quickfix.patch) by @alexanderdreyer created at 2012-07-05 22:53:52",
    "created_at": "2012-07-05T22:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167648",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment [dp_quickfix.patch](tarball://root/attachments/some-uuid/ticket13202/dp_quickfix.patch) by @alexanderdreyer created at 2012-07-05 22:53:52



---

archive/issue_comments_167649.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 AlexanderDreyer]:\n> in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).\n\n\nWow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.\n\nSo, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore...",
    "created_at": "2012-07-05T23:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167649",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:3'></a>Replying to [comment:2 AlexanderDreyer]:
> in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).


Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.

So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore...



---

archive/issue_comments_167650.json:
```json
{
    "body": "<a id='comment:4'></a>I made a new patch that includes the first patch but adds a doctest that checks that everything goes well",
    "created_at": "2012-07-05T23:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167650",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:4'></a>I made a new patch that includes the first patch but adds a doctest that checks that everything goes well



---

archive/issue_comments_167651.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 Bouillaguet]:\n> Replying to [comment:2 AlexanderDreyer]:\n> > in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).\n\n> \n> Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.\n\nI'll try to find some time to write some comments. (out out office and today)\n\n> So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore.\n\nNo,it's not the same! It's the same like a having `PolyBoRi`'s \"dp_asc\" with reversed indices. \nBut, there's no dp_asc in Sage. (Because we invented this in `PolyBoRi` for technical reasons.)\ndegrevlex is necessary, because it's he most popular ordering in computational algebra, because it's the fastest for homogenous problem (and behaves well in others). So one cannot drop it.",
    "created_at": "2012-07-06T06:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167651",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:5'></a>Replying to [comment:3 Bouillaguet]:
> Replying to [comment:2 AlexanderDreyer]:
> > in `pbori.pyx`'s function `get_var_mapping`, indices are used to represent the variables, but the reversing of the internal variable order is not obeyed here (`PolyBoRi` does not support degrevlex directly, but a variant with revered variable order.). I attach a quick fix for that problem, but one can probably do better by using the the indexed reordering from the ring (I'm not so familiar with that part of pbori.pyx).

> 
> Wow ! Your patch seems to do it. I tried to patch the function myself but I couldn't. It would be great if some comments in the file explained what's going on. For instance, I somehow convinced myself that I wouldn't be able to solve the problem without accessing the `pbind` array.

I'll try to find some time to write some comments. (out out office and today)

> So, I discussed this off-list with malb, and we kind of agreed to deprecate degreglex for boolean polynomials (after all, it is exactly the same as deglex with variables in reverse order). How do you feel about this? I suppose that with your patch it is not necessary anymore.

No,it's not the same! It's the same like a having `PolyBoRi`'s "dp_asc" with reversed indices. 
But, there's no dp_asc in Sage. (Because we invented this in `PolyBoRi` for technical reasons.)
degrevlex is necessary, because it's he most popular ordering in computational algebra, because it's the fastest for homogenous problem (and behaves well in others). So one cannot drop it.



---

archive/issue_comments_167652.json:
```json
{
    "body": "<a id='comment:6'></a>Re: Alexander, okay, let's try to fix it then :)\nRe: Charles, can you remove that `if True`?",
    "created_at": "2012-07-06T09:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167652",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>Re: Alexander, okay, let's try to fix it then :)
Re: Charles, can you remove that `if True`?



---

archive/issue_comments_167653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-06T13:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167653",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167654.json:
```json
{
    "body": "<a id='comment:7'></a>Done",
    "created_at": "2012-07-06T13:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167654",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:7'></a>Done



---

archive/issue_comments_167655.json:
```json
{
    "body": "<a id='comment:8'></a>Looks good, I'll let the patchbot decide whether doctests pass or not.",
    "created_at": "2012-07-06T15:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167655",
    "user": "https://github.com/malb"
}
```

<a id='comment:8'></a>Looks good, I'll let the patchbot decide whether doctests pass or not.



---

archive/issue_comments_167656.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 malb]:\n> Looks good, I'll let the patchbot decide whether doctests pass or not.\n\n\nFor that to work, we would need to tell it to only apply the second patch. How do you do that ?",
    "created_at": "2012-07-08T01:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167656",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:9'></a>Replying to [comment:8 malb]:
> Looks good, I'll let the patchbot decide whether doctests pass or not.


For that to work, we would need to tell it to only apply the second patch. How do you do that ?



---

archive/issue_comments_167657.json:
```json
{
    "body": "<a id='comment:10'></a>Still, there is something relatively annoying :\n\n```\nsage: R.<x,y,z> = BooleanPolynomialRing(order='degrevlex')\nsage: m = x          # a random monomial\nsage: x.lm().index() # the index of the first variable of m, most people would expect \"0\"\n2\nsage: R.gen(2)\nz\n```\nAnd in fact, to make it shorter:\n\n```\nsage: R.gen(0) == R.gen( R.gen(0).lm().index() )\nFalse\n```\n\nWhile this is not a bug in itself, it is disturbing, and it has caused at least one problem in my code. It also exposes to the user something that should be kept hidden from her (namely, how the sage interface implements the degrevlex ordering on top of polybori). \n\nFixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this \"feature\"",
    "created_at": "2012-07-08T06:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167657",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:10'></a>Still, there is something relatively annoying :

```
sage: R.<x,y,z> = BooleanPolynomialRing(order='degrevlex')
sage: m = x          # a random monomial
sage: x.lm().index() # the index of the first variable of m, most people would expect "0"
2
sage: R.gen(2)
z
```
And in fact, to make it shorter:

```
sage: R.gen(0) == R.gen( R.gen(0).lm().index() )
False
```

While this is not a bug in itself, it is disturbing, and it has caused at least one problem in my code. It also exposes to the user something that should be kept hidden from her (namely, how the sage interface implements the degrevlex ordering on top of polybori). 

Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this "feature"



---

archive/issue_comments_167658.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Some conversion between different BooleanPolynomial rings fail but they should not.\n \n+example :\n+\n+```\n+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\n+sage: P.<c,d> = BooleanPolynomialRing(order='lex')\n+sage: P(B('c'))\n+ERROR: An unexpected error occurred while tokenizing input\n+The following traceback may be corrupted or invalid\n+The error message is: ('EOF in multi-line statement', (1369, 0))\n+.......\n+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n+```\n+\n+Apply pbori_degrevlex_problem.patch\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-07-08T07:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167658",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Some conversion between different BooleanPolynomial rings fail but they should not.
 
+example :
+
+```
+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
+sage: P.<c,d> = BooleanPolynomialRing(order='lex')
+sage: P(B('c'))
+ERROR: An unexpected error occurred while tokenizing input
+The following traceback may be corrupted or invalid
+The error message is: ('EOF in multi-line statement', (1369, 0))
+.......
+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
+```
+
+Apply pbori_degrevlex_problem.patch
 
 Comment: 1
 
``````




---

archive/issue_comments_167659.json:
```json
{
    "body": "<a id='comment:12'></a>Apply pbori_degrevlex_problem.patch",
    "created_at": "2012-07-08T07:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167659",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:12'></a>Apply pbori_degrevlex_problem.patch



---

archive/issue_comments_167660.json:
```json
{
    "body": "<a id='comment:13'></a>> Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this \"feature\"\n\nWell, it would break much more since the the Sage uses `pbori.pyx` also to interconnect betweento `PolyBoRi`'s  python modules and its C++-based kernel (supplementing `PolyBoRi`'s original interface here). As long as Sage-only and `PolyBoRi`-only function are not mixed, this should not be a problem.\n\nBut I just realized, that `.variable()` is reordered (unlike `.gen()` it shouldn't), so I'll check this for consistency.",
    "created_at": "2012-07-08T20:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167660",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:13'></a>> Fixing the .index() function to avoid this would in any case break Alexander's patch. If I understand correctly, his patch relies on this "feature"

Well, it would break much more since the the Sage uses `pbori.pyx` also to interconnect betweento `PolyBoRi`'s  python modules and its C++-based kernel (supplementing `PolyBoRi`'s original interface here). As long as Sage-only and `PolyBoRi`-only function are not mixed, this should not be a problem.

But I just realized, that `.variable()` is reordered (unlike `.gen()` it shouldn't), so I'll check this for consistency.



---

archive/issue_comments_167661.json:
```json
{
    "body": "<a id='comment:14'></a>I thought about this. For a clean fix, we will need to distinguish between pure `dp_asc` and `DegRevLex`. So I prepared a patch to add `dp_asc` (as `DegNegLex`) to Sage, see #13229.\n\nBTW: Was the patchbot successful?",
    "created_at": "2012-07-11T13:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167661",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:14'></a>I thought about this. For a clean fix, we will need to distinguish between pure `dp_asc` and `DegRevLex`. So I prepared a patch to add `dp_asc` (as `DegNegLex`) to Sage, see #13229.

BTW: Was the patchbot successful?



---

archive/issue_comments_167662.json:
```json
{
    "body": "Attachment [pbori_degrevlex_problem.2.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_degrevlex_problem.2.patch) by Bouillaguet created at 2012-07-12 11:03:14\n\nincludes first patch (dp_quickfix.patch) + add doctest",
    "created_at": "2012-07-12T11:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167662",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Attachment [pbori_degrevlex_problem.2.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_degrevlex_problem.2.patch) by Bouillaguet created at 2012-07-12 11:03:14

includes first patch (dp_quickfix.patch) + add doctest



---

archive/issue_comments_167663.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [pbori_degrevlex_problem.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_degrevlex_problem.patch) by Bouillaguet created at 2012-07-12 11:07:41\n\nSo, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:\n\n- m.index() exposes the hack behind the current implementation of degreglex\n- Alexander seems to believe that there is a problem with variables() \n\nSo, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)",
    "created_at": "2012-07-12T11:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167663",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:15'></a>Attachment [pbori_degrevlex_problem.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_degrevlex_problem.patch) by Bouillaguet created at 2012-07-12 11:07:41

So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:

- m.index() exposes the hack behind the current implementation of degreglex
- Alexander seems to believe that there is a problem with variables() 

So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)



---

archive/issue_comments_167664.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 Bouillaguet]:\n> So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:\n> \n> - m.index() exposes the hack behind the current implementation of degreglex\n \nYes, I'm about to fix that. (It's not only index to be fixed.)\n\n> - Alexander seems to believe that there is a problem with variables() \n \nI thought ring.variable(i) should give the i-th polybori variable (not reordered). But thinking twice, that would cause more problems than it solves.\n \n> So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)\n\nThe problem is the ambigious nature of pbori.pyx:\nOn the one hand, it is the Sage implementation of BooleanPolynomial which should support degrevlex in such a way, that the user is not aware of the reversed variables hack.\nOn the other hand, Sage uses pbori.pyx as a lightweight alternative to polybori's original (boost-based) C++-to-python interface (for running polybori's highlevel library stuff in <python-site>/polybori/*). We don't need degrevlex here (but degneglex).\n\nThe latter is trivial, once `DegNegLex` is in Sage. For the first point, I will provide a first variant later this day.",
    "created_at": "2012-07-12T11:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167664",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:16'></a>Replying to [comment:15 Bouillaguet]:
> So, I don't exactly understand what the plan is. The patch, even though it fixes the problem at the origin of this ticket, does not fixes all problems:
> 
> - m.index() exposes the hack behind the current implementation of degreglex
 
Yes, I'm about to fix that. (It's not only index to be fixed.)

> - Alexander seems to believe that there is a problem with variables() 
 
I thought ring.variable(i) should give the i-th polybori variable (not reordered). But thinking twice, that would cause more problems than it solves.
 
> So, do we want to remove the degrevlex from BooleanPolynomialRing altogether, and instruct users to use the newly implemented degneglex instead, or do we want to actually support degrevlex? (and how?)

The problem is the ambigious nature of pbori.pyx:
On the one hand, it is the Sage implementation of BooleanPolynomial which should support degrevlex in such a way, that the user is not aware of the reversed variables hack.
On the other hand, Sage uses pbori.pyx as a lightweight alternative to polybori's original (boost-based) C++-to-python interface (for running polybori's highlevel library stuff in <python-site>/polybori/*). We don't need degrevlex here (but degneglex).

The latter is trivial, once `DegNegLex` is in Sage. For the first point, I will provide a first variant later this day.



---

archive/issue_comments_167665.json:
```json
{
    "body": "<a id='comment:17'></a>Here's my proposed change to `pbori.pyx` `.index()`, `.iterindex()` and related functions obey the variable reordering in degrevlex now. Also, degneglex is supported now. Feel free to test it. (There are only a few degrevlex examples in the doctests, so some functionality might not be covered.)",
    "created_at": "2012-07-12T22:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167665",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:17'></a>Here's my proposed change to `pbori.pyx` `.index()`, `.iterindex()` and related functions obey the variable reordering in degrevlex now. Also, degneglex is supported now. Feel free to test it. (There are only a few degrevlex examples in the doctests, so some functionality might not be covered.)



---

archive/issue_comments_167666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Some conversion between different BooleanPolynomial rings fail but they should not.\n \n+example :\n+\n+```\n+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\n+sage: P.<c,d> = BooleanPolynomialRing(order='lex')\n+sage: P(B('c'))\n+ERROR: An unexpected error occurred while tokenizing input\n+The following traceback may be corrupted or invalid\n+The error message is: ('EOF in multi-line statement', (1369, 0))\n+.......\n+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n+```\n+\n+* **Apply**: attachment:pbori_consistent_degrevlex.patch\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-07-12T22:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167666",
    "user": "https://github.com/alexanderdreyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Some conversion between different BooleanPolynomial rings fail but they should not.
 
+example :
+
+```
+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
+sage: P.<c,d> = BooleanPolynomialRing(order='lex')
+sage: P(B('c'))
+ERROR: An unexpected error occurred while tokenizing input
+The following traceback may be corrupted or invalid
+The error message is: ('EOF in multi-line statement', (1369, 0))
+.......
+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
+```
+
+* **Apply**: attachment:pbori_consistent_degrevlex.patch
 
 Comment: 1
 
``````




---

archive/issue_comments_167667.json:
```json
{
    "body": "Attachment [pbori_consistent_degrevlex.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_consistent_degrevlex.patch) by @alexanderdreyer created at 2012-07-12 22:47:45\n\nIndices obey variable reordering for DegRevLex, introduces DegNegLex",
    "created_at": "2012-07-12T22:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167667",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment [pbori_consistent_degrevlex.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_consistent_degrevlex.patch) by @alexanderdreyer created at 2012-07-12 22:47:45

Indices obey variable reordering for DegRevLex, introduces DegNegLex



---

archive/issue_comments_167668.json:
```json
{
    "body": "<a id='comment:18'></a>Apply pbori_consistent_degrevlex.patch",
    "created_at": "2012-07-13T06:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167668",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:18'></a>Apply pbori_consistent_degrevlex.patch



---

archive/issue_comments_167669.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Some conversion between different BooleanPolynomial rings fail but they should not.\n \n+example :\n+\n+```\n+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')\n+sage: P.<c,d> = BooleanPolynomialRing(order='lex')\n+sage: P(B('c'))\n+ERROR: An unexpected error occurred while tokenizing input\n+The following traceback may be corrupted or invalid\n+The error message is: ('EOF in multi-line statement', (1369, 0))\n+.......\n+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined\n+```\n+\n+* **Apply**: attachment:pbori_consistent_degrevlex_5-2.patch\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-07-13T06:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167669",
    "user": "https://github.com/alexanderdreyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Some conversion between different BooleanPolynomial rings fail but they should not.
 
+example :
+
+```
+sage: B.<a,b,c,d> = BooleanPolynomialRing(order='degrevlex')
+sage: P.<c,d> = BooleanPolynomialRing(order='lex')
+sage: P(B('c'))
+ERROR: An unexpected error occurred while tokenizing input
+The following traceback may be corrupted or invalid
+The error message is: ('EOF in multi-line statement', (1369, 0))
+.......
+TypeError: cannot convert polynomial c to Boolean PolynomialRing in c, d: name b not defined
+```
+
+* **Apply**: attachment:pbori_consistent_degrevlex_5-2.patch
 
 Comment: 1
 
``````




---

archive/issue_comments_167670.json:
```json
{
    "body": "<a id='comment:19'></a>Rebased patch to Sage 5.2 rc0: \nApply pbori_consistent_degrevlex_5-2.patch",
    "created_at": "2012-07-13T06:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167670",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:19'></a>Rebased patch to Sage 5.2 rc0: 
Apply pbori_consistent_degrevlex_5-2.patch



---

archive/issue_comments_167671.json:
```json
{
    "body": "Attachment [pbori_consistent_degrevlex_5-2.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_consistent_degrevlex_5-2.patch) by @alexanderdreyer created at 2012-07-13 07:18:22\n\nIndices obey variable reordering for `DegRevLex`, introduces `DegNegLex` (rebased to Sage 5.2 rc0)",
    "created_at": "2012-07-13T07:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167671",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment [pbori_consistent_degrevlex_5-2.patch](tarball://root/attachments/some-uuid/ticket13202/pbori_consistent_degrevlex_5-2.patch) by @alexanderdreyer created at 2012-07-13 07:18:22

Indices obey variable reordering for `DegRevLex`, introduces `DegNegLex` (rebased to Sage 5.2 rc0)



---

archive/issue_comments_167672.json:
```json
{
    "body": "<a id='comment:20'></a>Apply pbori_consistent_degrevlex_5-2.patch",
    "created_at": "2012-07-13T07:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167672",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:20'></a>Apply pbori_consistent_degrevlex_5-2.patch



---

archive/issue_comments_167673.json:
```json
{
    "body": "<a id='comment:21'></a>`@`Charles Bouillaguet: Does the new design (avoid internal index exposing to the user) fit your needs?",
    "created_at": "2012-07-19T06:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167673",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:21'></a>`@`Charles Bouillaguet: Does the new design (avoid internal index exposing to the user) fit your needs?



---

archive/issue_comments_167674.json:
```json
{
    "body": "<a id='comment:22'></a>`@`AlexanderDreyer: I'm happy with it! It makes the patchbot happy so I suppose we could go for a positive review... malb?",
    "created_at": "2012-07-22T09:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167674",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:22'></a>`@`AlexanderDreyer: I'm happy with it! It makes the patchbot happy so I suppose we could go for a positive review... malb?



---

archive/issue_comments_167675.json:
```json
{
    "body": "<a id='comment:23'></a>Let's do it.",
    "created_at": "2012-07-22T09:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167675",
    "user": "https://github.com/malb"
}
```

<a id='comment:23'></a>Let's do it.



---

archive/issue_comments_167676.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-22T09:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167676",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167677.json:
```json
{
    "body": "<a id='comment:24'></a>Nice to see that the refactored interface turns out to be useful!",
    "created_at": "2012-07-22T21:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167677",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:24'></a>Nice to see that the refactored interface turns out to be useful!



---

archive/issue_events_036402.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-23T06:56:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13202#event-36402"
}
```



---

archive/issue_comments_167678.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-12T19:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13202#issuecomment-167678",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_036403.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T19:01:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13202",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13202#event-36403"
}
```
