# Issue 13223: Implement Poset.is_graded using a polynomial time (linear?) algorithm.

archive/issues_013051.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "Title says it all. See also #13222.\n\nDepends on #13222\n\nCC:  @sagetrac-sage-combinat mcco0489@math.umn.edu @nathanncohen\n\nComponent: **combinatorics**\n\nKeywords: **sd40**\n\nAuthor: **Jori M\u00e4ntysalo**\n\nBranch/Commit: **[u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_) @ [`a9896c7`](https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13223_\n\n",
    "closed_at": "2014-10-13T15:52:27Z",
    "created_at": "2012-07-10T17:36:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement Poset.is_graded using a polynomial time (linear?) algorithm.",
    "type": "issue",
    "updated_at": "2014-10-13T15:52:27Z",
    "url": "https://github.com/sagemath/sage/issues/13223",
    "user": "https://github.com/nthiery"
}
```
Title says it all. See also #13222.

Depends on #13222

CC:  @sagetrac-sage-combinat mcco0489@math.umn.edu @nathanncohen

Component: **combinatorics**

Keywords: **sd40**

Author: **Jori Mäntysalo**

Branch/Commit: **[u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_) @ [`a9896c7`](https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf)**

_Issue created by migration from https://trac.sagemath.org/ticket/13223_





---

archive/issue_events_182295.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-07-10T17:36:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182295"
}
```



---

archive/issue_events_182296.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-07-10T17:36:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182296"
}
```



---

archive/issue_events_182297.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-07-10T17:36:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182297"
}
```



---

archive/issue_events_182298.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-07-10T17:36:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182298"
}
```



---

archive/issue_events_182299.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2012-07-10T17:36:56Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "subject": "https://github.com/nthiery",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182299"
}
```



---

archive/issue_comments_152317.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThomas McConville will be implementing this",
    "created_at": "2012-09-05T20:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152317",
    "user": "https://github.com/sagetrac-gmoose05"
}
```

<div id="comment:1" align="right">comment:1</div>

Thomas McConville will be implementing this



---

archive/issue_events_182300.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182300"
}
```



---

archive/issue_events_182301.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182301"
}
```



---

archive/issue_comments_152318.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI've improved the situation in #13240; the algorithm is now polynomial time. Wouldn't hurt to improve it nevertheless.",
    "created_at": "2013-10-21T02:52:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152318",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:4" align="right">comment:4</div>

I've improved the situation in #13240; the algorithm is now polynomial time. Wouldn't hurt to improve it nevertheless.



---

archive/issue_events_182302.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182302"
}
```



---

archive/issue_events_182303.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182303"
}
```



---

archive/issue_events_182304.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182304"
}
```



---

archive/issue_events_182305.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182305"
}
```



---

archive/issue_events_182306.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182306"
}
```



---

archive/issue_events_182307.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182307"
}
```



---

archive/issue_comments_152319.json:
```json
{
    "body": "Attachment: **[faster-isgraded.txt](https://github.com/sagemath/sage/files/ticket13223/faster-isgraded.txt)**",
    "created_at": "2014-10-06T13:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152319",
    "user": "https://github.com/jm58660"
}
```

Attachment: **[faster-isgraded.txt](https://github.com/sagemath/sage/files/ticket13223/faster-isgraded.txt)**



---

archive/issue_comments_152320.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI attached an example code. Before integrating to Sage it must be changed so that rank list is saved, or should it? For now `is_graded()` starts with `is_ranked()`, and it saves rank of every element to internal variable.",
    "created_at": "2014-10-06T13:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152320",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:8" align="right">comment:8</div>

I attached an example code. Before integrating to Sage it must be changed so that rank list is saved, or should it? For now `is_graded()` starts with `is_ranked()`, and it saves rank of every element to internal variable.



---

archive/issue_comments_152321.json:
```json
{
    "body": "Branch: **[u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_)**",
    "created_at": "2014-10-07T10:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152321",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/implement_poset_is_graded_using_a_polynomial_time__linear___algorithm_)**



---

archive/issue_comments_152322.json:
```json
{
    "body": "Commit: **[`a9896c7`](https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf)**",
    "created_at": "2014-10-07T10:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152322",
    "user": "https://github.com/jm58660"
}
```

Commit: **[`a9896c7`](https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf)**



---

archive/issue_events_182308.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-07T10:34:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182308"
}
```



---

archive/issue_comments_152323.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI should now be O(n). (Where `n` if number of cover relations, not number of elements.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32a7eb719139f71290050d3f9f322badc7f33bb1\"><code>32a7eb7</code></a></td><td><code>New algorithm.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf\"><code>a9896c7</code></a></td><td><code>.</code></td></tr></table>\n",
    "created_at": "2014-10-07T10:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152323",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:10" align="right">comment:10</div>

I should now be O(n). (Where `n` if number of cover relations, not number of elements.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32a7eb719139f71290050d3f9f322badc7f33bb1"><code>32a7eb7</code></a></td><td><code>New algorithm.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9896c7e9f9e8e6c6f52a25a3370c2d595e2fecf"><code>a9896c7</code></a></td><td><code>.</code></td></tr></table>




---

archive/issue_comments_152324.json:
```json
{
    "body": "Author: **Jori M\u00e4ntysalo**",
    "created_at": "2014-10-07T10:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152324",
    "user": "https://github.com/jm58660"
}
```

Author: **Jori Mäntysalo**



---

archive/issue_comments_152325.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nDuh, must to do more timings. This is somewhat faster when going throught Posets(8), but much slower with bigger random posets. Algorithm should probably be selected by number of elements and cover relations.",
    "created_at": "2014-10-07T12:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152325",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:11" align="right">comment:11</div>

Duh, must to do more timings. This is somewhat faster when going throught Posets(8), but much slower with bigger random posets. Algorithm should probably be selected by number of elements and cover relations.



---

archive/issue_comments_152326.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI do not understand. According to Wikipedia, isn't this poset graded by the function which associates to every element the length of its label ?\n\nhttp://en.wikipedia.org/wiki/Graded_poset\n\n```\nsage: d=DiGraph(); d.add_path([\"aaaa\",\"aaa\",\"aa\",\"a\"]); d.add_path([\"bbb\",\"aa\"])\nsage: Poset(d).is_graded()\nFalse\n```\n\n(same result with or without your branch applied)\n\nNathann",
    "created_at": "2014-10-07T19:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152326",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

I do not understand. According to Wikipedia, isn't this poset graded by the function which associates to every element the length of its label ?

http://en.wikipedia.org/wiki/Graded_poset

```
sage: d=DiGraph(); d.add_path(["aaaa","aaa","aa","a"]); d.add_path(["bbb","aa"])
sage: Poset(d).is_graded()
False
```

(same result with or without your branch applied)

Nathann



---

archive/issue_events_182309.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-10-07T19:29:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182309"
}
```



---

archive/issue_events_182310.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-10-07T19:29:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182310"
}
```



---

archive/issue_events_182311.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-08T04:39:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182311"
}
```



---

archive/issue_events_182312.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-08T04:39:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182312"
}
```



---

archive/issue_events_182313.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-08T04:39:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182313"
}
```



---

archive/issue_events_182314.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-08T04:39:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182314"
}
```



---

archive/issue_comments_152327.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSome sources define graded poset like what Sage define ranked. For that see #16998 and doc for `is_graded` on `posets.py`.\n\nMy code lacked one `set()` function. But after that also `minimal_elements()` takes more time that I thinked, hence this code is still slower than original in many (most?) cases.\n\nAlso, original code is O(n). Hence I dropped this to minor priority.",
    "created_at": "2014-10-08T04:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152327",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:13" align="right">comment:13</div>

Some sources define graded poset like what Sage define ranked. For that see #16998 and doc for `is_graded` on `posets.py`.

My code lacked one `set()` function. But after that also `minimal_elements()` takes more time that I thinked, hence this code is still slower than original in many (most?) cases.

Also, original code is O(n). Hence I dropped this to minor priority.



---

archive/issue_comments_152328.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nA side note about #17002: It makes `minimal_elements` slightly slower. Must modify functions `sinks()` and `sources()` on `digraph.py`.",
    "created_at": "2014-10-08T13:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152328",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:14" align="right">comment:14</div>

A side note about #17002: It makes `minimal_elements` slightly slower. Must modify functions `sinks()` and `sources()` on `digraph.py`.



---

archive/issue_comments_152329.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOh. I thought that it would go unnoticed.\n\nWell, try replacing the code of sinks/source from\n\n```\nreturn [x for x in self if self.out_degree(x)==0]\n```\n\nto\n\n```\nreturn [x for x,d in self.out_degree(labels=True).iteritems() if d==0]\n```\n\nIt means less calls to `out_degree`. Perhaps that's what you detected ?\n\nNathann",
    "created_at": "2014-10-08T13:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152329",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

Oh. I thought that it would go unnoticed.

Well, try replacing the code of sinks/source from

```
return [x for x in self if self.out_degree(x)==0]
```

to

```
return [x for x,d in self.out_degree(labels=True).iteritems() if d==0]
```

It means less calls to `out_degree`. Perhaps that's what you detected ?

Nathann



---

archive/issue_comments_152330.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI'll try that.\n\nWhole question is irrelevant, but interesting. It should be clear that checking if a poset is graded is faster when doing it \"directly\" and not throught rank function. Rank should need both in- ja out-edges of underlying graph, direct method just out-edges; and out-edges are just picked up from memory, not searched in any way.\n\nHowever, many timinigs say against this.",
    "created_at": "2014-10-08T17:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152330",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:16" align="right">comment:16</div>

I'll try that.

Whole question is irrelevant, but interesting. It should be clear that checking if a poset is graded is faster when doing it "directly" and not throught rank function. Rank should need both in- ja out-edges of underlying graph, direct method just out-edges; and out-edges are just picked up from memory, not searched in any way.

However, many timinigs say against this.



---

archive/issue_comments_152331.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHello !\n\nJust looked at the code again, but I do not see what possible improvement you expect. Algorithmically, things are done correctly. Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.\n\nAbout definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins. This `Poset` is not graded according to the definition involving \"all maximal chains\":\n\n`Poset(DiGraph({1:[2],3:[2],4:[3]})).show()`\n\nIt would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.\n\nNathann",
    "created_at": "2014-10-12T14:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152331",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

Hello !

Just looked at the code again, but I do not see what possible improvement you expect. Algorithmically, things are done correctly. Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.

About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins. This `Poset` is not graded according to the definition involving "all maximal chains":

`Poset(DiGraph({1:[2],3:[2],4:[3]})).show()`

It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.

Nathann



---

archive/issue_comments_152332.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@nathanncohen](#comment%3A17):\n\n> Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.\n\nYep. Should this one be marked as positive_review and moved to wontfix-milestone?\n\n> About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins.\n\nTrue.\n\n> It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.\n\nI made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF \"going up\" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.",
    "created_at": "2014-10-13T05:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152332",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@nathanncohen](#comment%3A17):

> Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.

Yep. Should this one be marked as positive_review and moved to wontfix-milestone?

> About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins.

True.

> It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.

I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF "going up" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.



---

archive/issue_comments_152333.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYooooooo !\n\n> Yep. Should this one be marked as positive_review and moved to wontfix-milestone?\n\n+1 to that\n\n> I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF \"going up\" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.\n\nWell, going up or down should be the same cost. The edges are stored twice (in each direction) in digraphs.\n\nNathann",
    "created_at": "2014-10-13T09:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152333",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:19" align="right">comment:19</div>

Yooooooo !

> Yep. Should this one be marked as positive_review and moved to wontfix-milestone?

+1 to that

> I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF "going up" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.

Well, going up or down should be the same cost. The edges are stored twice (in each direction) in digraphs.

Nathann



---

archive/issue_events_182315.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-13T10:45:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182315"
}
```



---

archive/issue_events_182316.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-13T10:45:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182316"
}
```



---

archive/issue_events_182317.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2014-10-13T10:45:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182317"
}
```



---

archive/issue_comments_152334.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAs current algorithm already is `O(n)` with small constant factor, and Nathann also suggest closing this, I mark this ticket as dontfix-positive_review.\n\nTodo-note from `posets.py` must also be removed. However, I can do that on #16998.",
    "created_at": "2014-10-13T10:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152334",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:20" align="right">comment:20</div>

As current algorithm already is `O(n)` with small constant factor, and Nathann also suggest closing this, I mark this ticket as dontfix-positive_review.

Todo-note from `posets.py` must also be removed. However, I can do that on #16998.



---

archive/issue_comments_152335.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSorry for the confusion that came from me. When I said that \"Wouldn't hurt to improve it nevertheless\", I didn't have any particular improvements in mind, just an impression that I wasn't being very thorough. And I think it wasn't exactly my algorithm that got implemented in Sage, but rather an improved version by Anne(?) and Nicolas(?).",
    "created_at": "2014-10-13T13:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152335",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:21" align="right">comment:21</div>

Sorry for the confusion that came from me. When I said that "Wouldn't hurt to improve it nevertheless", I didn't have any particular improvements in mind, just an impression that I wasn't being very thorough. And I think it wasn't exactly my algorithm that got implemented in Sage, but rather an improved version by Anne(?) and Nicolas(?).



---

archive/issue_comments_152336.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOkay. Well, for sure I do not know any algorithmic way to compute that which would be better than the current one.\n\nNathann",
    "created_at": "2014-10-13T13:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13223#issuecomment-152336",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">comment:22</div>

Okay. Well, for sure I do not know any algorithmic way to compute that which would be better than the current one.

Nathann



---

archive/issue_events_182318.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-13T15:52:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182318"
}
```



---

archive/issue_events_182319.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-13T15:52:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182319"
}
```



---

archive/issue_events_182320.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-13T15:52:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182320"
}
```



---

archive/issue_events_182321.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-13T15:52:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13223",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13223#event-182321"
}
```
