# Issue 13393: Vector normalization

archive/issues_013221.json:
```json
{
    "body": "Assignee: Chris Berg\n\nCC:  @jasongrout @saliola @novoselt @rbeezer serrano @gagern\n\nKeywords: vector, normalize\n\nFix vector normalization so that it agrees with the standard definition of normalizing a vector. Right now it divides the entries of the vector by the first nonzero entry of the vector. For instance:\n\n`sage: v = vector([1,2,3])`\n\n`sage: v.normalize()`\n\n`(1, 2, 3)`\n\nShouldn't the default implementation be the Euclidean norm? Especially since v.norm() returns the Euclidean norm.\n\n---\n\n**Apply** [attachment:combined.patch] and [attachment:trac_13393_reviewer.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/13393\n\n",
    "closed_at": "2013-01-21T21:08:33Z",
    "created_at": "2012-08-23T15:15:58Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Vector normalization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13393",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```
Assignee: Chris Berg

CC:  @jasongrout @saliola @novoselt @rbeezer serrano @gagern

Keywords: vector, normalize

Fix vector normalization so that it agrees with the standard definition of normalizing a vector. Right now it divides the entries of the vector by the first nonzero entry of the vector. For instance:

`sage: v = vector([1,2,3])`

`sage: v.normalize()`

`(1, 2, 3)`

Shouldn't the default implementation be the Euclidean norm? Especially since v.norm() returns the Euclidean norm.

---

**Apply** [attachment:combined.patch] and [attachment:trac_13393_reviewer.patch]

Issue created by migration from https://trac.sagemath.org/ticket/13393





---

archive/issue_comments_161557.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-18T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161557",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_161558.json:
```json
{
    "body": "Hmm, would this need deprecation?  (Though I totally agree that this is the 'usual' definition.)  I wonder what the original author of this was thinking ... maybe there is a use case in which this is a very natural thing to do?",
    "created_at": "2012-09-19T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161558",
    "user": "https://github.com/kcrisman"
}
```

Hmm, would this need deprecation?  (Though I totally agree that this is the 'usual' definition.)  I wonder what the original author of this was thinking ... maybe there is a use case in which this is a very natural thing to do?



---

archive/issue_comments_161559.json:
```json
{
    "body": "I assume it would. I put this patch up in hopes that the patchbot would show me where it needs deprecation. Perhaps putting it to needs review was premature, I was just trying to get the patchbot to run, and didn't realize someone would respond so quickly. Changing back to needs work. \n\nI can't see how dividing by the first part is more natural than dividing by the norm.",
    "created_at": "2012-09-19T02:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161559",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

I assume it would. I put this patch up in hopes that the patchbot would show me where it needs deprecation. Perhaps putting it to needs review was premature, I was just trying to get the patchbot to run, and didn't realize someone would respond so quickly. Changing back to needs work. 

I can't see how dividing by the first part is more natural than dividing by the norm.



---

archive/issue_comments_161560.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-09-19T02:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161560",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_161561.json:
```json
{
    "body": "I think I've seen such a normalization in projective spaces code. But it seems that the point there was to get a concrete representative for a projective point - making the first non-zero to be one worked. (I am not sure if it is still used somewhere, Volker has rewritten a lot of schemes code.)",
    "created_at": "2012-09-19T02:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161561",
    "user": "https://github.com/novoselt"
}
```

I think I've seen such a normalization in projective spaces code. But it seems that the point there was to get a concrete representative for a projective point - making the first non-zero to be one worked. (I am not sure if it is still used somewhere, Volker has rewritten a lot of schemes code.)



---

archive/issue_comments_161562.json:
```json
{
    "body": "Personally, I think someone ought to ping sage-devel about this change.  The \"standard definition\" may be different in number theory or other fields, for example.",
    "created_at": "2012-09-19T02:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161562",
    "user": "https://github.com/jasongrout"
}
```

Personally, I think someone ought to ping sage-devel about this change.  The "standard definition" may be different in number theory or other fields, for example.



---

archive/issue_comments_161563.json:
```json
{
    "body": "CCing rbeezer, since he likely already advocated for this change... :)",
    "created_at": "2012-09-19T02:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161563",
    "user": "https://github.com/jasongrout"
}
```

CCing rbeezer, since he likely already advocated for this change... :)



---

archive/issue_comments_161564.json:
```json
{
    "body": "What if your base ring/field does not have any square roots?\n\n```\nsage: v = vector([1,2,3])\nsage: n = v.norm()\nsage: n\nsqrt(14)\nsage: u = (1/n)*v\nsage: u.base_ring()\nSymbolic Ring\n```\n\nWe start with a free module element (integer entries) and then we end up in the Symbolic Ring (which is often hard to get out of).\n\nOver RDF/CDF I'd agree entirely.  For **exact** linear algebra, I'm not convinced.",
    "created_at": "2012-09-19T04:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161564",
    "user": "https://github.com/rbeezer"
}
```

What if your base ring/field does not have any square roots?

```
sage: v = vector([1,2,3])
sage: n = v.norm()
sage: n
sqrt(14)
sage: u = (1/n)*v
sage: u.base_ring()
Symbolic Ring
```

We start with a free module element (integer entries) and then we end up in the Symbolic Ring (which is often hard to get out of).

Over RDF/CDF I'd agree entirely.  For **exact** linear algebra, I'm not convinced.



---

archive/issue_comments_161565.json:
```json
{
    "body": "Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.",
    "created_at": "2012-09-19T12:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161565",
    "user": "https://github.com/kcrisman"
}
```

Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.



---

archive/issue_comments_161566.json:
```json
{
    "body": "Replying to [comment:11 kcrisman]:\n> Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.\n\n\nIf you think of vectors as specifying directions, then normalization gives you a \"random but fixed\" vector pointing in the same direction as the original. If you store a lot of directions, then comparing normalized vectors is quicker than using dot-products.",
    "created_at": "2012-09-19T12:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161566",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:11 kcrisman]:
> Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.


If you think of vectors as specifying directions, then normalization gives you a "random but fixed" vector pointing in the same direction as the original. If you store a lot of directions, then comparing normalized vectors is quicker than using dot-products.



---

archive/issue_comments_161567.json:
```json
{
    "body": "I've also used this normalization when dealing with projective spaces, like mentioned in one of the comments above.",
    "created_at": "2012-09-19T13:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161567",
    "user": "https://github.com/jasongrout"
}
```

I've also used this normalization when dealing with projective spaces, like mentioned in one of the comments above.



---

archive/issue_comments_161568.json:
```json
{
    "body": "If you want to go that route, I could argue, what if your ring doesn't have division...\n\nI'm sure you have a good point, and I'm not as Sage savvy as most users here, but from my perspective someone who is trying to use Sage for basic functionality (like an undergrad trying to do homework) will be really confused and frustrated if v.normalize() does not return a normalized vector. In fact, this was how it was pointed out to me. I'm sure other mathematicians use the functionality of what v.normalize() was doing before, but these people are smart enough to write their own such code. Or if it really is important it should be there, but shouldn't be called normalize.\n\nReplying to [comment:10 rbeezer]:\n> What if your base ring/field does not have any square roots?\n> \n> \n> ```\n> sage: v = vector([1,2,3])\n> sage: n = v.norm()\n> sage: n\n> sqrt(14)\n> sage: u = (1/n)*v\n> sage: u.base_ring()\n> Symbolic Ring\n> ```\n> \n> We start with a free module element (integer entries) and then we end up in the Symbolic Ring (which is often hard to get out of).\n> \n> Over RDF/CDF I'd agree entirely.  For **exact** linear algebra, I'm not convinced.",
    "created_at": "2012-09-19T16:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161568",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

If you want to go that route, I could argue, what if your ring doesn't have division...

I'm sure you have a good point, and I'm not as Sage savvy as most users here, but from my perspective someone who is trying to use Sage for basic functionality (like an undergrad trying to do homework) will be really confused and frustrated if v.normalize() does not return a normalized vector. In fact, this was how it was pointed out to me. I'm sure other mathematicians use the functionality of what v.normalize() was doing before, but these people are smart enough to write their own such code. Or if it really is important it should be there, but shouldn't be called normalize.

Replying to [comment:10 rbeezer]:
> What if your base ring/field does not have any square roots?
> 
> 
> ```
> sage: v = vector([1,2,3])
> sage: n = v.norm()
> sage: n
> sqrt(14)
> sage: u = (1/n)*v
> sage: u.base_ring()
> Symbolic Ring
> ```
> 
> We start with a free module element (integer entries) and then we end up in the Symbolic Ring (which is often hard to get out of).
> 
> Over RDF/CDF I'd agree entirely.  For **exact** linear algebra, I'm not convinced.



---

archive/issue_comments_161569.json:
```json
{
    "body": "I personally think normalize should be what Chris says, but we have to take into account backwards compatibility and people that may have code that depends on the current functionality.  The way to resolve this design decision is to take a vote on sage-devel.  Chris, can you post there, explain what is done now and what you'd like to change it to (maybe give an example and link to this ticket), and call for a vote for the design change?\n\nI personally will vote +1 for this change.",
    "created_at": "2012-09-19T16:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161569",
    "user": "https://github.com/jasongrout"
}
```

I personally think normalize should be what Chris says, but we have to take into account backwards compatibility and people that may have code that depends on the current functionality.  The way to resolve this design decision is to take a vote on sage-devel.  Chris, can you post there, explain what is done now and what you'd like to change it to (maybe give an example and link to this ticket), and call for a vote for the design change?

I personally will vote +1 for this change.



---

archive/issue_comments_161570.json:
```json
{
    "body": "> > Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.\n\n> \n> If you think of vectors as specifying directions, then normalization gives you a \"random but fixed\" vector pointing in the same direction as the original. If you store a lot of directions, then comparing normalized vectors is quicker than using dot-products.\n\n\nMy point was that if there isn't a consistent way to do it that makes everybody happy...  At the least, can we find another name for the current function when you make that vote on sage-devel?  Someone will presumably need it...",
    "created_at": "2012-09-19T17:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161570",
    "user": "https://github.com/kcrisman"
}
```

> > Hmm, but in that case what does normalization even mean?  Then we should just get rid of this function entirely.

> 
> If you think of vectors as specifying directions, then normalization gives you a "random but fixed" vector pointing in the same direction as the original. If you store a lot of directions, then comparing normalized vectors is quicker than using dot-products.


My point was that if there isn't a consistent way to do it that makes everybody happy...  At the least, can we find another name for the current function when you make that vote on sage-devel?  Someone will presumably need it...



---

archive/issue_comments_161571.json:
```json
{
    "body": "Patchbot!\n\nApply:trac_13393_vector_normalization_cb.patch",
    "created_at": "2012-10-02T19:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161571",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

Patchbot!

Apply:trac_13393_vector_normalization_cb.patch



---

archive/issue_comments_161572.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-06T02:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161572",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_161573.json:
```json
{
    "body": "Whatever happened to the consensus from sage-devel?\n\nhttps://groups.google.com/forum/?fromgroups=#!topic/sage-devel/p5ZfTfgBIAs\n\n* deprecate normalize() and point to normalized() and normal_form()\n* normalized() is division by L2-norm\n* normal_form() is the old normalize()",
    "created_at": "2012-10-06T04:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161573",
    "user": "https://github.com/jasongrout"
}
```

Whatever happened to the consensus from sage-devel?

https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/p5ZfTfgBIAs

* deprecate normalize() and point to normalized() and normal_form()
* normalized() is division by L2-norm
* normal_form() is the old normalize()



---

archive/issue_comments_161574.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-06T04:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161574",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_161575.json:
```json
{
    "body": "How does this patch look? I added normalized() for p-norm, deprecated normalize(), and renamed it to monic() (couldn't get too much consensus on sage-devel, but that seemed to be the most popular option).",
    "created_at": "2012-12-22T03:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161575",
    "user": "https://github.com/eviatarbach"
}
```

How does this patch look? I added normalized() for p-norm, deprecated normalize(), and renamed it to monic() (couldn't get too much consensus on sage-devel, but that seemed to be the most popular option).



---

archive/issue_comments_161576.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-22T03:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161576",
    "user": "https://github.com/eviatarbach"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_161577.json:
```json
{
    "body": "Looks good to me. I'll wait for patchbot and other folks to chime in if they desire before giving a positive review.\n\nPatchbot, please, if you would, apply:\n\n* [attachment:trac_13393_normalized.patch]\n* [attachment:trac_13393_normalized_2.patch]",
    "created_at": "2012-12-23T06:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161577",
    "user": "https://github.com/benjaminfjones"
}
```

Looks good to me. I'll wait for patchbot and other folks to chime in if they desire before giving a positive review.

Patchbot, please, if you would, apply:

* [attachment:trac_13393_normalized.patch]
* [attachment:trac_13393_normalized_2.patch]



---

archive/issue_comments_161578.json:
```json
{
    "body": "`@`benjaminfjones - here's the proper syntax for patchbot - no links, everything in one line and in the order in which to apply. What is really important is the apply part. The patchbot part is not necessary, but it is useful to tell us poor humans that we are not addressing someone else ;)\n\nPatchbot: apply trac_13393_normalized.patch trac_13393_normalized_2.patch",
    "created_at": "2012-12-24T07:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161578",
    "user": "https://github.com/ppurka"
}
```

`@`benjaminfjones - here's the proper syntax for patchbot - no links, everything in one line and in the order in which to apply. What is really important is the apply part. The patchbot part is not necessary, but it is useful to tell us poor humans that we are not addressing someone else ;)

Patchbot: apply trac_13393_normalized.patch trac_13393_normalized_2.patch



---

archive/issue_comments_161579.json:
```json
{
    "body": "`@`ppurka - Thanks. I feel stupid for not knowing this by now :) \n\n`@`eviatarbach - It looks like the `normalize()` needs a docstring and doctest. One doctest that covers the deprecation exception should do it.",
    "created_at": "2012-12-27T05:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161579",
    "user": "https://github.com/benjaminfjones"
}
```

`@`ppurka - Thanks. I feel stupid for not knowing this by now :) 

`@`eviatarbach - It looks like the `normalize()` needs a docstring and doctest. One doctest that covers the deprecation exception should do it.



---

archive/issue_comments_161580.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-27T05:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161580",
    "user": "https://github.com/benjaminfjones"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_161581.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-28T07:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161581",
    "user": "https://github.com/eviatarbach"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_161582.json:
```json
{
    "body": "Ah, yes. Hope another cumulative patch is okay.",
    "created_at": "2012-12-28T07:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161582",
    "user": "https://github.com/eviatarbach"
}
```

Ah, yes. Hope another cumulative patch is okay.



---

archive/issue_comments_161583.json:
```json
{
    "body": "I think these are all small changes, and so you can merge them all into one file - the first patch. You can do the merge using [mercurial itself](http://mercurial.selenic.com/wiki/EditingHistory?highlight=%28qfold%29#Editing_recent_history_with_MQ). You will need to do the following - for details see the wiki I linked to. I will assume that you have your three patches in your queue and are unapplied.\n\n```\n...6.beta0/devel/sage [255] \u00bb hg qser  # <<< how it looks now\ntrac13032_doc.patch                # <<< blue color, already applied\ntrac_10508_doctest.patch           # <<< blue color, already applied\ntrac_10508_update_atlas_docs.patch # <<< blue color, already applied\nnew.patch                          # <<< grey color, unapplied patch\ntrac_13393_normalized_2.patch      # <<< grey color, unapplied patch\ntrac_13393_normalized.patch        # <<< grey color, unapplied patch\n\n...sage-5.6.beta0/devel/sage\u00bb hg qpush --move trac_13393_normalized.patch\napplying trac_13393_normalized.patch\nnow at: trac_13393_normalized.patch\n\n...sage-5.6.beta0/devel/sage\u00bb hg qfold trac_13393_normalized_2.patch\n...sage-5.6.beta0/devel/sage\u00bb hg qfold new.patch\n\n...sage-5.6.beta0/devel/sage\u00bb hg export tip | head  # <<<< Notice the merged commit messages.\n# HG changeset patch\n# User Eviatar Bach <snip>\n# Date 1356146661 28800\n# Node ID 110394caabbfb0cc7dd9f81ce865f68bdb9c17b9\n# Parent  d6de0068244b5820661ab3bde2082862a53bf536\nTrac 13393: new 'normalized' method for vectors, deprecating 'normalize'\n* * *\nTrac 13393: proper deprecation\n* * *\nTrac 13393: Docstring and doctest for .normalize()\n\n...sage-5.6.beta0/devel/sage\u00bb hg qser  # <<< How the queue looks after the merge\ntrac13032_doc.patch\ntrac_10508_doctest.patch\ntrac_10508_update_atlas_docs.patch\ntrac_13393_normalized.patch\n```\nOnce you are done you can upload the merged patch, give the correct 'apply' command to the patchbot, and modify the description of this ticket to let others know which patch to apply (otherwise one has to read through all of the comments to figure it out).",
    "created_at": "2012-12-28T07:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161583",
    "user": "https://github.com/ppurka"
}
```

I think these are all small changes, and so you can merge them all into one file - the first patch. You can do the merge using [mercurial itself](http://mercurial.selenic.com/wiki/EditingHistory?highlight=%28qfold%29#Editing_recent_history_with_MQ). You will need to do the following - for details see the wiki I linked to. I will assume that you have your three patches in your queue and are unapplied.

```
...6.beta0/devel/sage [255] » hg qser  # <<< how it looks now
trac13032_doc.patch                # <<< blue color, already applied
trac_10508_doctest.patch           # <<< blue color, already applied
trac_10508_update_atlas_docs.patch # <<< blue color, already applied
new.patch                          # <<< grey color, unapplied patch
trac_13393_normalized_2.patch      # <<< grey color, unapplied patch
trac_13393_normalized.patch        # <<< grey color, unapplied patch

...sage-5.6.beta0/devel/sage» hg qpush --move trac_13393_normalized.patch
applying trac_13393_normalized.patch
now at: trac_13393_normalized.patch

...sage-5.6.beta0/devel/sage» hg qfold trac_13393_normalized_2.patch
...sage-5.6.beta0/devel/sage» hg qfold new.patch

...sage-5.6.beta0/devel/sage» hg export tip | head  # <<<< Notice the merged commit messages.
# HG changeset patch
# User Eviatar Bach <snip>
# Date 1356146661 28800
# Node ID 110394caabbfb0cc7dd9f81ce865f68bdb9c17b9
# Parent  d6de0068244b5820661ab3bde2082862a53bf536
Trac 13393: new 'normalized' method for vectors, deprecating 'normalize'
* * *
Trac 13393: proper deprecation
* * *
Trac 13393: Docstring and doctest for .normalize()

...sage-5.6.beta0/devel/sage» hg qser  # <<< How the queue looks after the merge
trac13032_doc.patch
trac_10508_doctest.patch
trac_10508_update_atlas_docs.patch
trac_13393_normalized.patch
```
Once you are done you can upload the merged patch, give the correct 'apply' command to the patchbot, and modify the description of this ticket to let others know which patch to apply (otherwise one has to read through all of the comments to figure it out).



---

archive/issue_comments_161584.json:
```json
{
    "body": "Thanks :)\n\nPatchbot: apply combined.patch",
    "created_at": "2012-12-28T08:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161584",
    "user": "https://github.com/eviatarbach"
}
```

Thanks :)

Patchbot: apply combined.patch



---

archive/issue_comments_161585.json:
```json
{
    "body": "Attachment [combined.patch](tarball://root/attachments/some-uuid/ticket13393/combined.patch) by @ppurka created at 2012-12-28 10:37:20\n\nPatchbot apply combined.patch",
    "created_at": "2012-12-28T10:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161585",
    "user": "https://github.com/ppurka"
}
```

Attachment [combined.patch](tarball://root/attachments/some-uuid/ticket13393/combined.patch) by @ppurka created at 2012-12-28 10:37:20

Patchbot apply combined.patch



---

archive/issue_comments_161586.json:
```json
{
    "body": "Looks good, thanks! Waiting on doctests to finish..",
    "created_at": "2012-12-28T21:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161586",
    "user": "https://github.com/benjaminfjones"
}
```

Looks good, thanks! Waiting on doctests to finish..



---

archive/issue_comments_161587.json:
```json
{
    "body": "All doctests pass.",
    "created_at": "2012-12-28T22:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161587",
    "user": "https://github.com/benjaminfjones"
}
```

All doctests pass.



---

archive/issue_comments_161588.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-28T22:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161588",
    "user": "https://github.com/benjaminfjones"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_161589.json:
```json
{
    "body": "```\nsage -t  -force_lib devel/sage/sage/modules/finite_submodule_iter.pyx\n**********************************************************************\nFile \"/release/merger/sage-5.6.beta2/devel/sage-main/sage/modules/finite_submodule_iter.pyx\", line 314:\n    sage: all([ x.normalize() == x for x in FiniteFieldsubspace_projPoint_iterator(A, True) ])\nExpected:\n    True\nGot:\n    doctest:1172: DeprecationWarning: 'normalize' is deprecated. For division by the p-norm use 'normalized', and for division by the firs\nt nonzero entry use 'monic'.\n    See http://trac.sagemath.org/13393 for details.\n    True\n**********************************************************************\n```",
    "created_at": "2012-12-30T08:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161589",
    "user": "https://github.com/jdemeyer"
}
```

```
sage -t  -force_lib devel/sage/sage/modules/finite_submodule_iter.pyx
**********************************************************************
File "/release/merger/sage-5.6.beta2/devel/sage-main/sage/modules/finite_submodule_iter.pyx", line 314:
    sage: all([ x.normalize() == x for x in FiniteFieldsubspace_projPoint_iterator(A, True) ])
Expected:
    True
Got:
    doctest:1172: DeprecationWarning: 'normalize' is deprecated. For division by the p-norm use 'normalized', and for division by the firs
t nonzero entry use 'monic'.
    See http://trac.sagemath.org/13393 for details.
    True
**********************************************************************
```



---

archive/issue_comments_161590.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-30T08:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161590",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_161591.json:
```json
{
    "body": "*** ping ***",
    "created_at": "2013-01-10T15:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161591",
    "user": "https://github.com/jdemeyer"
}
```

*** ping ***



---

archive/issue_comments_161592.json:
```json
{
    "body": "I'll provide a reviewer patch for this.",
    "created_at": "2013-01-10T18:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161592",
    "user": "https://github.com/benjaminfjones"
}
```

I'll provide a reviewer patch for this.



---

archive/issue_comments_161593.json:
```json
{
    "body": "Attachment [trac_13393_reviewer.patch](tarball://root/attachments/some-uuid/ticket13393/trac_13393_reviewer.patch) by @benjaminfjones created at 2013-01-10 21:16:40\n\nreviewer patch",
    "created_at": "2013-01-10T21:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161593",
    "user": "https://github.com/benjaminfjones"
}
```

Attachment [trac_13393_reviewer.patch](tarball://root/attachments/some-uuid/ticket13393/trac_13393_reviewer.patch) by @benjaminfjones created at 2013-01-10 21:16:40

reviewer patch



---

archive/issue_comments_161594.json:
```json
{
    "body": "Reviewer patch addresses the work issues. `@`jdemeyer, do you mind reviewing the reviewer patch?\n\nPatchbot, apply combined.patch  trac_13393_reviewer.patch",
    "created_at": "2013-01-10T21:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161594",
    "user": "https://github.com/benjaminfjones"
}
```

Reviewer patch addresses the work issues. `@`jdemeyer, do you mind reviewing the reviewer patch?

Patchbot, apply combined.patch  trac_13393_reviewer.patch



---

archive/issue_comments_161595.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-10T21:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161595",
    "user": "https://github.com/benjaminfjones"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_161596.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-10T21:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161596",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_037168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-10T21:27:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13393#event-37168"
}
```



---

archive/issue_events_037169.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:08:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13393#event-37169"
}
```



---

archive/issue_comments_161597.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-21T21:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13393#issuecomment-161597",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
