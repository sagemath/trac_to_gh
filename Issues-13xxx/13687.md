# Issue 13687: Parents for groups

archive/issues_013483.json:
```json
{
    "body": "Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n\nTo limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n\nVarious oddities needed to be cleaned up in the process:\n* make parents unique and elements immutable (often requires tuples instead of lists)\n* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n* rename `element.list()` -> `element.exponents()` for the exponent vector.\n* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n* lots of places return lists when they should return tuples\n\nI haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n\nApply\n* [attachment:13687_parent_for_groups_all_vb.patch]\n* [attachment:13687_32bitfix.patch]\n\nAssignee: joyner\n\nCC:  @miguelmarco @roed314 @wdjoyner simonking\n\nKeywords: new Parent\n\nReviewer: David Roe\n\nAuthor: Volker Braun\n\nMerged: sage-5.7.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13687\n\n",
    "closed_at": "2013-01-31T09:20:04Z",
    "created_at": "2012-11-05T16:12:01Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Parents for groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13687",
    "user": "https://github.com/vbraun"
}
```
Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.

To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`

Various oddities needed to be cleaned up in the process:
* make parents unique and elements immutable (often requires tuples instead of lists)
* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
* rename `element.list()` -> `element.exponents()` for the exponent vector.
* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
* lots of places return lists when they should return tuples

I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.

Apply
* [attachment:13687_parent_for_groups_all_vb.patch]
* [attachment:13687_32bitfix.patch]

Assignee: joyner

CC:  @miguelmarco @roed314 @wdjoyner simonking

Keywords: new Parent

Reviewer: David Roe

Author: Volker Braun

Merged: sage-5.7.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13687





---

archive/issue_comments_177003.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -7,6 +7,8 @@\n * rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n * rename `element.list()` -> `element.exponents()` for the exponent vector.\n * implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-05T20:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177003",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -7,6 +7,8 @@
 * rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
 * rename `element.list()` -> `element.exponents()` for the exponent vector.
 * implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
 
 Comment: 1
 
```




---

archive/issue_comments_177004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-05T20:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177004",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177005.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-06T01:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177005",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,15 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
 
 Comment: 1
 
```




---

archive/issue_comments_177006.json:
```json
{
    "body": "Changing keywords from \"\" to \"new Parent\".",
    "created_at": "2012-11-06T01:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177006",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "new Parent".



---

archive/issue_comments_177007.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-06T10:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177007",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_177008.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Volker,\nI'm about halfway through this.  Overall it's looking great.  Here are some comments (let me know if anything is unclear):\n\n* in the `_normalize` function for `AbelianGroup`, perhaps the 0s should come last, since that lines up with the standard divisibility condition for invariants.  Also, if `gens_orders` is a string of length `n` then it will get through your error checking.\n\n* `_normalize` should have examples.\n\n* In `random_element`, shouldn't the fact that doctesting consistently chooses a random seed mean we don't need to mark `G.random_element()` as `# random output`?\n\n* In the docstring for `equals`, the documentation for the output is wrong: should be checking whether they are the same subset.\n\n* In `invs()`, where you write `raise Exception # WTF`, maybe we should figure out what was intended by this function and fix it.  :-)\n\n* In the module summary of `dual_abelian_group`, you can use floating point tolerance rather than just marking the output as random.  In particular, shouldn't your first example be exact?\n\n* In module doctoring for `dual_abelian_group_element`, you should take out the `# random` marking on some doctests (using floating point tolerance instead if necessary)\n\nI should go to sleep, but I'll try to get through more of this tomorrow.  When you make changes, could you upload a separate patch?",
    "created_at": "2012-11-06T10:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177008",
    "user": "https://github.com/roed314"
}
```

<a id='comment:5'></a>Hi Volker,
I'm about halfway through this.  Overall it's looking great.  Here are some comments (let me know if anything is unclear):

* in the `_normalize` function for `AbelianGroup`, perhaps the 0s should come last, since that lines up with the standard divisibility condition for invariants.  Also, if `gens_orders` is a string of length `n` then it will get through your error checking.

* `_normalize` should have examples.

* In `random_element`, shouldn't the fact that doctesting consistently chooses a random seed mean we don't need to mark `G.random_element()` as `# random output`?

* In the docstring for `equals`, the documentation for the output is wrong: should be checking whether they are the same subset.

* In `invs()`, where you write `raise Exception # WTF`, maybe we should figure out what was intended by this function and fix it.  :-)

* In the module summary of `dual_abelian_group`, you can use floating point tolerance rather than just marking the output as random.  In particular, shouldn't your first example be exact?

* In module doctoring for `dual_abelian_group_element`, you should take out the `# random` marking on some doctests (using floating point tolerance instead if necessary)

I should go to sleep, but I'll try to get through more of this tomorrow.  When you make changes, could you upload a separate patch?



---

archive/issue_comments_177009.json:
```json
{
    "body": "<a id='comment:6'></a>1. The 0's were prepended, I just kept that behavior. I think its more in line with the mathematical expectation of writing a group as free+torsion instead of the other way round. Also, the `gens_orders` are not the abelian invariants. \n\n5. I still haven't figured out what `invs()` is for, I'll just delete it ;-)\n\nI agree with the rest. Most of it is just stuff that was already there and I didn't fix...",
    "created_at": "2012-11-06T16:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177009",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>1. The 0's were prepended, I just kept that behavior. I think its more in line with the mathematical expectation of writing a group as free+torsion instead of the other way round. Also, the `gens_orders` are not the abelian invariants. 

5. I still haven't figured out what `invs()` is for, I'll just delete it ;-)

I agree with the rest. Most of it is just stuff that was already there and I didn't fix...



---

archive/issue_comments_177010.json:
```json
{
    "body": "<a id='comment:7'></a>1.  Fair enough.\n\n5.  Sounds good.\n\nI know, I saw the old code.  But if you're making changes this extensive you might as well fix some more stuff.  :-)",
    "created_at": "2012-11-06T17:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177010",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>1.  Fair enough.

5.  Sounds good.

I know, I saw the old code.  But if you're making changes this extensive you might as well fix some more stuff.  :-)



---

archive/issue_comments_177011.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-06T17:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177011",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_177012.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n+\n+Apply\n+* [attachment:trac_13687_Parent_for_groups.patch]\n+* [attachment:trac_13687_review.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-06T17:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177012",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
+
+Apply
+* [attachment:trac_13687_Parent_for_groups.patch]
+* [attachment:trac_13687_review.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_177013.json:
```json
{
    "body": "<a id='comment:9'></a>Here are some more suggestions.  I'm going to leave it marked as needs review so that the patchbot will continue testing.\n\n1. In `AbelianGroupElement.__init__`, I think it's useful to allow `ints` in the `generator_orders`, rather than asserting that they all be `Integers`\n\n2. Documentation of `exponents` doesn't line up with `__init__` method in `AbelianGroupElementBase`.  You should give an example in the documentation of that function showing that the exponents are still integers, not elements of the base ring.\n\n3. In docstring for `AbelianGroupWithValues`, maybe you should note that `values_group` could be a ring or field, since Sage doesn't currently support the group of units in a ring very well.\n\n4. I don't think that `AbelianGroupWithValuesEmbedding` should inherit from `CallMorphism`, but rather just from `Morphism`.\n\n5. For the arithmetic operations in `AbelianGroupWithValuesElement`, I would keep the computation of `_value` lazy (check to see if both left and right values are not None).  By being nonlazy you'll get more floating point drift and also you may compute unnecessary values.  \n\n6. Your docstring for `AbelianGroupWithValues_class.values_group` is incomplete.\n\n7. Indentation problem at the end of the docstring for `Group` (right before `def __init__`)\n\n8. You set  `Element = FractionalIdealClass` on `SFractionalIdealClass(FractionalIdealClass)`.  This should be done on the parent, not the element.\n\n9. There doesn't seem to be a failure in the test suite for `ClassGroup`, so you should remove the sentence about a failure caused by not having a category of additive abelian groups.\n\n10. In `unit_group.py` you use `_.value()` a few times; can you give `UK.torsion_generator()` (etc)  a name and use it instead of `_`?\n\n21. You have a docstring floating that needs to be deleted where `gen(self, i=0)` used to be in `UnitGroup`",
    "created_at": "2012-11-06T21:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177013",
    "user": "https://github.com/roed314"
}
```

<a id='comment:9'></a>Here are some more suggestions.  I'm going to leave it marked as needs review so that the patchbot will continue testing.

1. In `AbelianGroupElement.__init__`, I think it's useful to allow `ints` in the `generator_orders`, rather than asserting that they all be `Integers`

2. Documentation of `exponents` doesn't line up with `__init__` method in `AbelianGroupElementBase`.  You should give an example in the documentation of that function showing that the exponents are still integers, not elements of the base ring.

3. In docstring for `AbelianGroupWithValues`, maybe you should note that `values_group` could be a ring or field, since Sage doesn't currently support the group of units in a ring very well.

4. I don't think that `AbelianGroupWithValuesEmbedding` should inherit from `CallMorphism`, but rather just from `Morphism`.

5. For the arithmetic operations in `AbelianGroupWithValuesElement`, I would keep the computation of `_value` lazy (check to see if both left and right values are not None).  By being nonlazy you'll get more floating point drift and also you may compute unnecessary values.  

6. Your docstring for `AbelianGroupWithValues_class.values_group` is incomplete.

7. Indentation problem at the end of the docstring for `Group` (right before `def __init__`)

8. You set  `Element = FractionalIdealClass` on `SFractionalIdealClass(FractionalIdealClass)`.  This should be done on the parent, not the element.

9. There doesn't seem to be a failure in the test suite for `ClassGroup`, so you should remove the sentence about a failure caused by not having a category of additive abelian groups.

10. In `unit_group.py` you use `_.value()` a few times; can you give `UK.torsion_generator()` (etc)  a name and use it instead of `_`?

21. You have a docstring floating that needs to be deleted where `gen(self, i=0)` used to be in `UnitGroup`



---

archive/issue_comments_177014.json:
```json
{
    "body": "<a id='comment:10'></a>1. `AbelianGroup_class` derives from `UniqueRepresentation`, so I want to enforce canonical arguments with the assertions. Its the job of the `AbelianGroup` factory function to canonicalize the user input.\n\n5. For the unit group, say, its much more expensive to do the exponentiation than non-lazy multiplication. Imagine you want to list all units. This is also what the `FractionalIdealClass` and friends do. If its cheap to exponentiate the values then I would agree with you, but in that case you probably don't need such an elaborate `AbelianGroupWithValues`.",
    "created_at": "2012-11-07T02:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177014",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>1. `AbelianGroup_class` derives from `UniqueRepresentation`, so I want to enforce canonical arguments with the assertions. Its the job of the `AbelianGroup` factory function to canonicalize the user input.

5. For the unit group, say, its much more expensive to do the exponentiation than non-lazy multiplication. Imagine you want to list all units. This is also what the `FractionalIdealClass` and friends do. If its cheap to exponentiate the values then I would agree with you, but in that case you probably don't need such an elaborate `AbelianGroupWithValues`.



---

archive/issue_comments_177015.json:
```json
{
    "body": "<a id='comment:11'></a>The updated patch addresses all remaining issues. I've also based `ClassGroup` on `AbelianGroupWithValues` and some other improvements.",
    "created_at": "2012-11-08T04:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177015",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>The updated patch addresses all remaining issues. I've also based `ClassGroup` on `AbelianGroupWithValues` and some other improvements.



---

archive/issue_comments_177016.json:
```json
{
    "body": "<a id='comment:12'></a>Looks good.  Two more comments and then I'm happy to give a positive review:\n\n* In docstring for `SFractionalIdealClass`, your example blocks are indented.  There should also only be one block rather than three.\n\n* There's a failure in the startup plugin.  I have no problem giving a positive review even so, but I thought I'd point it out in case you wanted to change anything related to imports.  :-)",
    "created_at": "2012-11-08T08:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177016",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'></a>Looks good.  Two more comments and then I'm happy to give a positive review:

* In docstring for `SFractionalIdealClass`, your example blocks are indented.  There should also only be one block rather than three.

* There's a failure in the startup plugin.  I have no problem giving a positive review even so, but I thought I'd point it out in case you wanted to change anything related to imports.  :-)



---

archive/issue_comments_177017.json:
```json
{
    "body": "<a id='comment:13'></a>Good eyes with the indent ;-)\n\nI noticed that startup modules changed. Fun fact: the `operator` Python module (for `operator.mul`, say) was imported as a by-product of Abelian groups. And the coercion framework assumes that it is imported in its doctests. I've moved the actual import to `sage.all`, as you saw. In any case, I'm planning to make everything lazy if possible, but first I should go through the rest of the groups and port them to the new parents.",
    "created_at": "2012-11-08T16:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177017",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>Good eyes with the indent ;-)

I noticed that startup modules changed. Fun fact: the `operator` Python module (for `operator.mul`, say) was imported as a by-product of Abelian groups. And the coercion framework assumes that it is imported in its doctests. I've moved the actual import to `sage.all`, as you saw. In any case, I'm planning to make everything lazy if possible, but first I should go through the rest of the groups and port them to the new parents.



---

archive/issue_comments_177018.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-08T16:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177018",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177019.json:
```json
{
    "body": "<a id='comment:14'></a>Sounds good.  Let me know when you need a review for the transition on the other groups.  Thanks for all the changes here: fixing Groups has been a daunting task.",
    "created_at": "2012-11-08T18:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177019",
    "user": "https://github.com/roed314"
}
```

<a id='comment:14'></a>Sounds good.  Let me know when you need a review for the transition on the other groups.  Thanks for all the changes here: fixing Groups has been a daunting task.



---

archive/issue_comments_177020.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2012-11-13T19:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177020",
    "user": "https://github.com/vbraun"
}
```

Rebased patch



---

archive/issue_comments_177021.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [trac_13687_Parent_for_groups.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_Parent_for_groups.patch) by @vbraun created at 2012-11-13 19:52:06\n\nPatch rebased for sage-5.5.beta0",
    "created_at": "2012-11-13T19:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177021",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Attachment [trac_13687_Parent_for_groups.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_Parent_for_groups.patch) by @vbraun created at 2012-11-13 19:52:06

Patch rebased for sage-5.5.beta0



---

archive/issue_comments_177022.json:
```json
{
    "body": "<a id='comment:16'></a>Long doctests fail:\n\n```\nsage -t -long \"devel/sage/sage/rings/number_field/number_field_ideal.py\"\n  ***   Warning: precision too low for generators, not given.\n**********************************************************************\nFile \"/release/merger/sage-5.5.beta1/devel/sage/sage/rings/number_field/number_field_ideal.py\", line 2462:\n    sage: G.gens_values()\nExpected:\n    (2*a^2 - 1, 2*a^2 + 2*a - 2)\nGot:\n    (2*a - 1, 2*a^2 + 2*a - 2)\n**********************************************************************\n```",
    "created_at": "2012-11-14T15:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177022",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Long doctests fail:

```
sage -t -long "devel/sage/sage/rings/number_field/number_field_ideal.py"
  ***   Warning: precision too low for generators, not given.
**********************************************************************
File "/release/merger/sage-5.5.beta1/devel/sage/sage/rings/number_field/number_field_ideal.py", line 2462:
    sage: G.gens_values()
Expected:
    (2*a^2 - 1, 2*a^2 + 2*a - 2)
Got:
    (2*a - 1, 2*a^2 + 2*a - 2)
**********************************************************************
```



---

archive/issue_comments_177023.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-14T15:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177023",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_177024.json:
```json
{
    "body": "Attachment [trac_13687_review.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_review.patch) by @vbraun created at 2012-11-14 20:50:19\n\nImproved patch",
    "created_at": "2012-11-14T20:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177024",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13687_review.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_review.patch) by @vbraun created at 2012-11-14 20:50:19

Improved patch



---

archive/issue_comments_177025.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-11-14T20:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177025",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_177026.json:
```json
{
    "body": "<a id='comment:17'></a>I've marked the offending doctest as `# random `, which is what it was before the patch.",
    "created_at": "2012-11-14T20:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177026",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>I've marked the offending doctest as `# random `, which is what it was before the patch.



---

archive/issue_comments_177027.json:
```json
{
    "body": "<a id='comment:18'></a>This patch introduces some bad uses of `assert`. You should only use \"assert\" to check for actual bugs, not for bad user input. If there is any way at all to reproduce an AssertionError using documented public functions, that is by definition a bug.",
    "created_at": "2012-11-15T08:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177027",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>This patch introduces some bad uses of `assert`. You should only use "assert" to check for actual bugs, not for bad user input. If there is any way at all to reproduce an AssertionError using documented public functions, that is by definition a bug.



---

archive/issue_comments_177028.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-15T08:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177028",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_177029.json:
```json
{
    "body": "<a id='comment:20'></a>Most importantly, you must never use `assert` for control flow. So the following is very wrong:\n\n```\ntry:\n    ...\nexcept AssertionError:\n    ...\n```",
    "created_at": "2012-11-15T08:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177029",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Most importantly, you must never use `assert` for control flow. So the following is very wrong:

```
try:
    ...
except AssertionError:
    ...
```



---

archive/issue_comments_177030.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-15T17:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177030",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_177031.json:
```json
{
    "body": "<a id='comment:21'></a>Agreed, but its only \"introduced\" in the sense that I copied the old `groups.pyx` to `old.pyx` to support old-style parents until every group is switched over. I've cleaned up the `AssertionError` in the new `group.pyx` but not in the `old.pyx`.",
    "created_at": "2012-11-15T17:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177031",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Agreed, but its only "introduced" in the sense that I copied the old `groups.pyx` to `old.pyx` to support old-style parents until every group is switched over. I've cleaned up the `AssertionError` in the new `group.pyx` but not in the `old.pyx`.



---

archive/issue_comments_177032.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n+\n+Apply\n+* [attachment:trac_13687_Parent_for_groups.patch]\n+* [attachment:trac_13687_review.patch]\n+* [attachment:trac_13687_assertions.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-15T17:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177032",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,20 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
+
+Apply
+* [attachment:trac_13687_Parent_for_groups.patch]
+* [attachment:trac_13687_review.patch]
+* [attachment:trac_13687_assertions.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_177033.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-11-22T21:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177033",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_177034.json:
```json
{
    "body": "<a id='comment:22'></a>Attachment [trac_13687_assertions.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_assertions.patch) by @miguelmarco created at 2012-12-04 13:33:36\n\nI can't seem to be able to apply the patch on sage-5.4.1 Is it rebased for some other version? Or maybe it conflicts with patches from #13211, #6391 or #13588?",
    "created_at": "2012-12-04T13:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177034",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:22'></a>Attachment [trac_13687_assertions.patch](tarball://root/attachments/some-uuid/ticket13687/trac_13687_assertions.patch) by @miguelmarco created at 2012-12-04 13:33:36

I can't seem to be able to apply the patch on sage-5.4.1 Is it rebased for some other version? Or maybe it conflicts with patches from #13211, #6391 or #13588?



---

archive/issue_comments_177035.json:
```json
{
    "body": "<a id='comment:23'></a>I have based the patches on sage-5.5.rc0. Can you give that a try?",
    "created_at": "2012-12-04T14:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177035",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>I have based the patches on sage-5.5.rc0. Can you give that a try?



---

archive/issue_comments_177036.json:
```json
{
    "body": "<a id='comment:24'></a>Yes, that works. Thank you.",
    "created_at": "2012-12-04T18:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177036",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:24'></a>Yes, that works. Thank you.



---

archive/issue_comments_177037.json:
```json
{
    "body": "<a id='comment:25'></a>So, Jeroen, would you be happy with a positive review now that the assertion issue is cleaned from the new code, but kept in the old one?  Or should we make the full transition of groups before accepting this?",
    "created_at": "2013-01-03T09:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177037",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:25'></a>So, Jeroen, would you be happy with a positive review now that the assertion issue is cleaned from the new code, but kept in the old one?  Or should we make the full transition of groups before accepting this?



---

archive/issue_comments_177038.json:
```json
{
    "body": "<a id='comment:26'></a>I combined and rebased the patches and marked `old.pyx` and `old.pxd` as copies.",
    "created_at": "2013-01-03T09:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177038",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>I combined and rebased the patches and marked `old.pyx` and `old.pxd` as copies.



---

archive/issue_comments_177039.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n+\n+Apply\n+* [attachment:13687_parent_for_groups_all.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2013-01-03T09:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177039",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,18 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
+
+Apply
+* [attachment:13687_parent_for_groups_all.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_177040.json:
```json
{
    "body": "Attachment [13687_parent_for_groups_all.patch](tarball://root/attachments/some-uuid/ticket13687/13687_parent_for_groups_all.patch) by @jdemeyer created at 2013-01-03 09:39:47",
    "created_at": "2013-01-03T09:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177040",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [13687_parent_for_groups_all.patch](tarball://root/attachments/some-uuid/ticket13687/13687_parent_for_groups_all.patch) by @jdemeyer created at 2013-01-03 09:39:47



---

archive/issue_comments_177041.json:
```json
{
    "body": "<a id='comment:27'></a>It's not required to fix all of `old.pyx`. If the *newly introduced assertions* are fine, then that's sufficient.",
    "created_at": "2013-01-03T09:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177041",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>It's not required to fix all of `old.pyx`. If the *newly introduced assertions* are fine, then that's sufficient.



---

archive/issue_comments_177042.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-24T12:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177042",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177043.json:
```json
{
    "body": "<a id='comment:28'></a>I'm fine with the rebasing... don't think there is anything else to review.",
    "created_at": "2013-01-24T12:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177043",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>I'm fine with the rebasing... don't think there is anything else to review.



---

archive/issue_comments_177044.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-26T10:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177044",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_177045.json:
```json
{
    "body": "<a id='comment:29'></a>This needs to rebased to sage-5.7.beta1.",
    "created_at": "2013-01-26T10:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177045",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>This needs to rebased to sage-5.7.beta1.



---

archive/issue_comments_177046.json:
```json
{
    "body": "Attachment [13687_parent_for_groups_all_vb.patch](tarball://root/attachments/some-uuid/ticket13687/13687_parent_for_groups_all_vb.patch) by @vbraun created at 2013-01-26 17:58:42\n\nUpdated patch",
    "created_at": "2013-01-26T17:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177046",
    "user": "https://github.com/vbraun"
}
```

Attachment [13687_parent_for_groups_all_vb.patch](tarball://root/attachments/some-uuid/ticket13687/13687_parent_for_groups_all_vb.patch) by @vbraun created at 2013-01-26 17:58:42

Updated patch



---

archive/issue_comments_177047.json:
```json
{
    "body": "<a id='comment:30'></a>Rebased to sage-5.7.beta1",
    "created_at": "2013-01-26T18:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177047",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>Rebased to sage-5.7.beta1



---

archive/issue_comments_177048.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-26T18:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177048",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_177049.json:
```json
{
    "body": "<a id='comment:31'></a>I ran into a strange issue here: http://tracker.gap-system.org/issues/224. I've added a larger initial workspace size (`-m 64m`) which should be a workaround. In any case it has nothing to do with upgrading the group parents.",
    "created_at": "2013-01-26T18:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177049",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>I ran into a strange issue here: http://tracker.gap-system.org/issues/224. I've added a larger initial workspace size (`-m 64m`) which should be a workaround. In any case it has nothing to do with upgrading the group parents.



---

archive/issue_comments_177050.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-29T20:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177050",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_177051.json:
```json
{
    "body": "<a id='comment:32'></a>There are 2 failures on 32-bit:\n\n```\nsage -t  --long -force_lib devel/sage/sage/rings/number_field/unit_group.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.beta2/devel/sage-main/sage/rings/number_field/unit_group.py\", line 138:\n    sage: u.value()\nExpected:\n    -1/4*a^3 - 7/4*a^2 - 17/4*a - 19/4\nGot:\n    -1/4*a^3 + 7/4*a^2 - 17/4*a + 19/4\n**********************************************************************\nsage -t  --long -force_lib devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.beta2/devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py\", line 974:\n    sage: S.S_class_group([K.ideal(a)])\nExpected:\n    [((2, -a + 1, 1/2*xbar + 1/2, -1/2*a*xbar + 1/2*a + 1), 6, 1/2*xbar - 3/2)] \nGot:\n    [((2, -a + 1, 1/2*xbar + 1/2, -1/2*a*xbar + 1/2*a + 1), 6, -1/2*xbar + 3/2)]\n**********************************************************************\n```",
    "created_at": "2013-01-29T20:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177051",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>There are 2 failures on 32-bit:

```
sage -t  --long -force_lib devel/sage/sage/rings/number_field/unit_group.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.beta2/devel/sage-main/sage/rings/number_field/unit_group.py", line 138:
    sage: u.value()
Expected:
    -1/4*a^3 - 7/4*a^2 - 17/4*a - 19/4
Got:
    -1/4*a^3 + 7/4*a^2 - 17/4*a + 19/4
**********************************************************************
sage -t  --long -force_lib devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.beta2/devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py", line 974:
    sage: S.S_class_group([K.ideal(a)])
Expected:
    [((2, -a + 1, 1/2*xbar + 1/2, -1/2*a*xbar + 1/2*a + 1), 6, 1/2*xbar - 3/2)] 
Got:
    [((2, -a + 1, 1/2*xbar + 1/2, -1/2*a*xbar + 1/2*a + 1), 6, -1/2*xbar + 3/2)]
**********************************************************************
```



---

archive/issue_comments_177052.json:
```json
{
    "body": "Attachment [13687_32bitfix.patch](tarball://root/attachments/some-uuid/ticket13687/13687_32bitfix.patch) by @vbraun created at 2013-01-29 22:02:16\n\nInitial patch",
    "created_at": "2013-01-29T22:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177052",
    "user": "https://github.com/vbraun"
}
```

Attachment [13687_32bitfix.patch](tarball://root/attachments/some-uuid/ticket13687/13687_32bitfix.patch) by @vbraun created at 2013-01-29 22:02:16

Initial patch



---

archive/issue_comments_177053.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-29T22:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177053",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_177054.json:
```json
{
    "body": "<a id='comment:33'></a>I've added the necessary `# 32-bit` clauses...",
    "created_at": "2013-01-29T22:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177054",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>I've added the necessary `# 32-bit` clauses...



---

archive/issue_comments_177055.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n+\n+Apply\n+* [attachment:13687_parent_for_groups_all.patch]\n+* [attachment:13687_32bitfix.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2013-01-29T22:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177055",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
+
+Apply
+* [attachment:13687_parent_for_groups_all.patch]
+* [attachment:13687_32bitfix.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_177056.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.\n \n+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`\n+\n+Various oddities needed to be cleaned up in the process:\n+* make parents unique and elements immutable (often requires tuples instead of lists)\n+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).\n+* rename `element.list()` -> `element.exponents()` for the exponent vector.\n+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.\n+* lots of places return lists when they should return tuples\n+\n+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.\n+\n+Apply\n+* [attachment:13687_parent_for_groups_all_vb.patch]\n+* [attachment:13687_32bitfix.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2013-01-30T08:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177056",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Groups are based on the deprecated `ParentWithGens`. This ticket is about forward-porting them to the new coercion framework.
 
+To limit the size of the patchbomb I'm only porting the Abelian groups. The rest depends on `old.Group`
+
+Various oddities needed to be cleaned up in the process:
+* make parents unique and elements immutable (often requires tuples instead of lists)
+* rename `AbelianGroup_class.invariants()` -> `AbelianGroup_class.gens_orders()` since they are not necessarily the abelian invariants (=elementary divisors).
+* rename `element.list()` -> `element.exponents()` for the exponent vector.
+* implement a `AbelianGroupWithValues` where you attach values to the (abstract) generators. Used in the unit group of a number field, for example.
+* lots of places return lists when they should return tuples
+
+I haven't actually deprecated `.invariants()` and `.list()`, just changed the documentation to suggest the equivalent `.gens_orders()` and .exponents()` methods. But I think we should deprecate them. Though I first want to work my way through the remaining groups code.
+
+Apply
+* [attachment:13687_parent_for_groups_all_vb.patch]
+* [attachment:13687_32bitfix.patch]
 
 Comment: 1
 
```




---

archive/issue_events_038282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-31T09:20:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13687#event-38282"
}
```



---

archive/issue_comments_177057.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-31T09:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13687#issuecomment-177057",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
