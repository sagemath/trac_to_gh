# Issue 13838: Implementation of virtual Klebers algorithm

archive/issues_013634.json:
```json
{
    "body": "The current implementation of `KleberTree` is only valid for the simply laced types. This ticket will implement the virtual Kleber algorithm and thus expand `KleberTree` to generate rigged configurations for all affine types.\n\nApply: [attachment:trac_13838-virtual_kleber_alg-ts.patch]\n\nAssignee: @tscrim\n\nCC:  sage-combinat @anneschilling\n\nKeywords: rigged configurations\n\nReviewer: Anne Schilling\n\nAuthor: Travis Scrimshaw\n\nMerged: sage-5.13.beta0\n\nDependencies: #13871 #14469\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13838\n\n",
    "closed_at": "2013-10-02T06:35:07Z",
    "created_at": "2012-12-17T07:55:25Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Implementation of virtual Klebers algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13838",
    "user": "https://github.com/tscrim"
}
```
The current implementation of `KleberTree` is only valid for the simply laced types. This ticket will implement the virtual Kleber algorithm and thus expand `KleberTree` to generate rigged configurations for all affine types.

Apply: [attachment:trac_13838-virtual_kleber_alg-ts.patch]

Assignee: @tscrim

CC:  sage-combinat @anneschilling

Keywords: rigged configurations

Reviewer: Anne Schilling

Author: Travis Scrimshaw

Merged: sage-5.13.beta0

Dependencies: #13871 #14469

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13838





---

archive/issue_comments_179678.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-13T21:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179678",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_179679.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [trac_13871-virtual_cartan_type-ts.patch](tarball://root/attachments/some-uuid/ticket13838/trac_13871-virtual_cartan_type-ts.patch) by @tscrim created at 2013-02-25 22:41:01\n\nSince I attached the wrong patch...\n\nFor patchbot:\n\nApply only: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-02-25T22:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179679",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>Attachment [trac_13871-virtual_cartan_type-ts.patch](tarball://root/attachments/some-uuid/ticket13838/trac_13871-virtual_cartan_type-ts.patch) by @tscrim created at 2013-02-25 22:41:01

Since I attached the wrong patch...

For patchbot:

Apply only: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179680.json:
```json
{
    "body": "<a id='comment:5'></a>New version based over the changes in #13871.\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-07-09T10:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179680",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>New version based over the changes in #13871.

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179681.json:
```json
{
    "body": "<a id='comment:6'></a>Removed workaround of #14870 because it is now part of #13871.\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-07-09T11:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179681",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Removed workaround of #14870 because it is now part of #13871.

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179682.json:
```json
{
    "body": "<a id='comment:7'></a>New version with (trivial) rebase over #14469.\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-07-13T11:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179682",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>New version with (trivial) rebase over #14469.

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_events_038814.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13838#event-38814"
}
```



---

archive/issue_comments_179683.json:
```json
{
    "body": "<a id='comment:9'></a>New version over changes in #13871.\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-08-30T22:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179683",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>New version over changes in #13871.

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179684.json:
```json
{
    "body": "<a id='comment:10'></a>Hello,\n\n* there is a small typo \"Kleber tree clases\"\n* maybe you can use the `:arxiv:` role in the references ?",
    "created_at": "2013-09-08T07:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179684",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Hello,

* there is a small typo "Kleber tree clases"
* maybe you can use the `:arxiv:` role in the references ?



---

archive/issue_comments_179685.json:
```json
{
    "body": "<a id='comment:11'></a>With added arXiv role, fixed the typo, and bringing the doc up to new specs. Thanks for having a look at this Frederic.\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-09-10T23:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179685",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>With added arXiv role, fixed the typo, and bringing the doc up to new specs. Thanks for having a look at this Frederic.

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179686.json:
```json
{
    "body": "<a id='comment:12'></a>Hi Travis,\n\nIt would be good if you could implement the tensor product multiplicity (and please call it tensor_product_multiplicity) which is formula (3.2) of http://arxiv.org/pdf/math/9809087.pdf in order to check that the code is giving the correct output. For nonsimply-laced types it would be the virtual analogue of this formula. The Kleber tree gives the admissible partitions, but to get the multiplicity one needs to sum over the product of binomial coefficients.\n\nAlso, I think it would be better to access the VirtualKleberTree through its own class (rather than through KleberTree). It is fine to inherit from KleberTree, but the construction is mathematically inherently different. For example for type `C_n^{(1)}` the construction is via the `A_{2n-1}^{(1)}` Kleber tree and type A weights, rather than type C weights. Since this is mostly just used in later code on rigged configuration, I think it won't be necessary to export VirtualKleberTree into the namespace.\n\nThanks for your work on this!\n\nAnne",
    "created_at": "2013-09-12T20:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179686",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:12'></a>Hi Travis,

It would be good if you could implement the tensor product multiplicity (and please call it tensor_product_multiplicity) which is formula (3.2) of http://arxiv.org/pdf/math/9809087.pdf in order to check that the code is giving the correct output. For nonsimply-laced types it would be the virtual analogue of this formula. The Kleber tree gives the admissible partitions, but to get the multiplicity one needs to sum over the product of binomial coefficients.

Also, I think it would be better to access the VirtualKleberTree through its own class (rather than through KleberTree). It is fine to inherit from KleberTree, but the construction is mathematically inherently different. For example for type `C_n^{(1)}` the construction is via the `A_{2n-1}^{(1)}` Kleber tree and type A weights, rather than type C weights. Since this is mostly just used in later code on rigged configuration, I think it won't be necessary to export VirtualKleberTree into the namespace.

Thanks for your work on this!

Anne



---

archive/issue_comments_179687.json:
```json
{
    "body": "<a id='comment:13'></a>Hey Anne,\n\nHere's the new version with the changes we've discussed (via e-mail/in person) along with a method `latex_options()` for controlling the latex output. I also think it's okay for the virtual Kleber tree to accept simply-laced types as input and for them to not compare as equal (since they are different mathematical constructions because we consider it as a folded type). I've documented this behavior.\n\nThank you for doing the review,\n\nTravis\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-09-18T15:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179687",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Hey Anne,

Here's the new version with the changes we've discussed (via e-mail/in person) along with a method `latex_options()` for controlling the latex output. I also think it's okay for the virtual Kleber tree to accept simply-laced types as input and for them to not compare as equal (since they are different mathematical constructions because we consider it as a folded type). I've documented this behavior.

Thank you for doing the review,

Travis

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179688.json:
```json
{
    "body": "<a id='comment:14'></a>Hi Travis,\n\nIf you want to allow for simply-laced input in the VirtualKleberTree, don't you want to select all nodes and bracket them in the output? Otherwise the behavior is different from the simply-laced and non-simply-laced types. If it is really just the same as the usual KleberTree, then why not make them equal in this case?\n\nBest,\n\nAnne",
    "created_at": "2013-09-18T16:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179688",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:14'></a>Hi Travis,

If you want to allow for simply-laced input in the VirtualKleberTree, don't you want to select all nodes and bracket them in the output? Otherwise the behavior is different from the simply-laced and non-simply-laced types. If it is really just the same as the usual KleberTree, then why not make them equal in this case?

Best,

Anne



---

archive/issue_comments_179689.json:
```json
{
    "body": "New version",
    "created_at": "2013-09-18T21:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179689",
    "user": "https://github.com/tscrim"
}
```

New version



---

archive/issue_comments_179690.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The current implementation of \\`KleberTree\\` is only valid for the simply laced types. This ticket will implement the virtual Kleber algorithm and thus expand \\`KleberTree\\` to generate rigged configurations for all affine types.\n+\n+Apply: [attachment:trac_13838-virtual_kleber_alg-ts.patch]\n \n Author: Travis Scrimshaw\n \n```\n",
    "created_at": "2013-09-18T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179690",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The current implementation of \`KleberTree\` is only valid for the simply laced types. This ticket will implement the virtual Kleber algorithm and thus expand \`KleberTree\` to generate rigged configurations for all affine types.
+
+Apply: [attachment:trac_13838-virtual_kleber_alg-ts.patch]
 
 Author: Travis Scrimshaw
 
```




---

archive/issue_comments_179691.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [trac_13838-virtual_kleber_alg-ts.patch](tarball://root/attachments/some-uuid/ticket13838/trac_13838-virtual_kleber_alg-ts.patch) by @tscrim created at 2013-09-18 21:51:53\n\nHey Anne,\n\nI made it raise an error on simply-laced types.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_13838-virtual_kleber_alg-ts.patch",
    "created_at": "2013-09-18T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179691",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>Attachment [trac_13838-virtual_kleber_alg-ts.patch](tarball://root/attachments/some-uuid/ticket13838/trac_13838-virtual_kleber_alg-ts.patch) by @tscrim created at 2013-09-18 21:51:53

Hey Anne,

I made it raise an error on simply-laced types.

Best,

Travis

For patchbot:

Apply: trac_13838-virtual_kleber_alg-ts.patch



---

archive/issue_comments_179692.json:
```json
{
    "body": "<a id='comment:16'></a>Hi Travis,\n\nLooks good now (you want to add a test for the simply-laced types in the VirtualKleberTree for completeness). \n\nAnne",
    "created_at": "2013-09-18T23:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179692",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:16'></a>Hi Travis,

Looks good now (you want to add a test for the simply-laced types in the VirtualKleberTree for completeness). 

Anne



---

archive/issue_comments_179693.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-18T23:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179693",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_179694.json:
```json
{
    "body": "Changing keywords from \"\" to \"rigged configurations\".",
    "created_at": "2013-09-18T23:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179694",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "" to "rigged configurations".



---

archive/issue_events_038815.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13838#event-38815"
}
```



---

archive/issue_events_038816.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13838#event-38816"
}
```



---

archive/issue_events_038817.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:35:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13838#event-38817"
}
```



---

archive/issue_comments_179695.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-02T06:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13838#issuecomment-179695",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
