# Issue 13126: Update and clean up openssl

archive/issues_012954.json:
```json
{
    "body": "The current openssl package doesn't build on OS X Lion and OS X PowerPC. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:\n\n- [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)\n\n\n**Keywords:** openssl PyOpenSSL ssl.h SageNB notebook 0.9.0\n\n**Reviewer:** Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman, Benjamin Jones\n\n**Author:** John Palmieri, Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/13126\n\n",
    "closed_at": "2012-07-02T13:00:27Z",
    "created_at": "2012-06-17T17:50:58Z",
    "labels": [
        "component: packages: optional",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.2",
    "title": "Update and clean up openssl",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13126",
    "user": "https://github.com/jhpalmieri"
}
```
The current openssl package doesn't build on OS X Lion and OS X PowerPC. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:

- [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)


**Keywords:** openssl PyOpenSSL ssl.h SageNB notebook 0.9.0

**Reviewer:** Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman, Benjamin Jones

**Author:** John Palmieri, Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/13126





---

archive/issue_comments_152417.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe previous version of openssl had no Mercurial repository (!), so I created one, then made the changes relevant to this ticket.  I'm attaching the diff showing those changes. This also adds an spkg-check script.\n\nOS X Lion: builds and passes tests\nsage.math: builds but fails tests\ncleo: builds but fails tests\ntaurus: builds but fails tests\nsilius: builds but fails tests\n\nmark, hawk: the build fails, but it did with the old version also.\n\nI don't have the time to track down the test failures right now. I'm guessing that they would have happened with the old spkg as well, but I haven't actually tried that. For OS X, I don't have access to any non-Lion machines.",
    "created_at": "2012-06-17T17:55:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152417",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
The previous version of openssl had no Mercurial repository (!), so I created one, then made the changes relevant to this ticket.  I'm attaching the diff showing those changes. This also adds an spkg-check script.

OS X Lion: builds and passes tests
sage.math: builds but fails tests
cleo: builds but fails tests
taurus: builds but fails tests
silius: builds but fails tests

mark, hawk: the build fails, but it did with the old version also.

I don't have the time to track down the test failures right now. I'm guessing that they would have happened with the old spkg as well, but I haven't actually tried that. For OS X, I don't have access to any non-Lion machines.



---

archive/issue_events_110624.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-17T17:55:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110624"
}
```



---

archive/issue_comments_152418.json:
```json
{
    "body": "<a id='comment:2'></a>\nTwo immediate details: mention the Trac number in `SPKG.txt`, use `$MAKE` instead of `make` in `spkg-check`.",
    "created_at": "2012-06-20T07:39:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152418",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Two immediate details: mention the Trac number in `SPKG.txt`, use `$MAKE` instead of `make` in `spkg-check`.



---

archive/issue_comments_152419.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The current openssl package doesn't build on OS X Lion. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:\n+The current openssl package doesn't build on OS X. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:\n \n - [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)\n \n``````\n",
    "created_at": "2012-06-20T07:45:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152419",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The current openssl package doesn't build on OS X Lion. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:
+The current openssl package doesn't build on OS X. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:
 
 - [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)
 
``````




---

archive/issue_events_110625.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-20T07:45:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "rename": {
        "from": "update and clean up openssl",
        "to": "Update and clean up openssl"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110625"
}
```



---

archive/issue_events_110626.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-20T07:45:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110626"
}
```



---

archive/issue_events_110627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-20T07:45:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110627"
}
```



---

archive/issue_comments_152420.json:
```json
{
    "body": "<a id='comment:3'></a>\nCould you make it support OS X PPC also (removing `-arch ppc` analogously).",
    "created_at": "2012-06-20T07:45:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152420",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Could you make it support OS X PPC also (removing `-arch ppc` analogously).



---

archive/issue_comments_152421.json:
```json
{
    "body": "<a id='comment:4'></a>\nCould you please post the error message of the old OpenSSL spkg on OS X Lion?",
    "created_at": "2012-06-20T07:50:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152421",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Could you please post the error message of the old OpenSSL spkg on OS X Lion?



---

archive/issue_comments_152422.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The current openssl package doesn't build on OS X. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:\n+The current openssl package doesn't build on OS X Lion and OS X PowerPC. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:\n \n - [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)\n \n``````\n",
    "created_at": "2012-06-20T07:50:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152422",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The current openssl package doesn't build on OS X. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:
+The current openssl package doesn't build on OS X Lion and OS X PowerPC. Here is an spkg which does; it also updates openssl from 1.0.1a to 1.0.1c:
 
 - [http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/openssl-1.0.1c.p0.spkg)
 
``````




---

archive/issue_comments_152423.json:
```json
{
    "body": "<a id='comment:5'></a>\nGood news!  Unlike the old spkg, the new one does build on Skynet `iras`.",
    "created_at": "2012-06-20T07:55:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152423",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Good news!  Unlike the old spkg, the new one does build on Skynet `iras`.



---

archive/issue_comments_152424.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe openssl `config` script is fairly broken, causing it to fail to build on Solaris.",
    "created_at": "2012-06-20T18:56:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152424",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
The openssl `config` script is fairly broken, causing it to fail to build on Solaris.



---

archive/attachments_018366.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "config.patch",
    "asset_url": "tarball://root/attachments/ticket13126/config.patch",
    "created_at": "2012-06-20T19:54:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13126/config.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_152425.json:
```json
{
    "body": "**Attachment:** [config.patch](https://github.com/sagemath/sage/files/ticket13126/config.patch)\n\nPatch to the openssl sources to fix building on Solaris",
    "created_at": "2012-06-20T19:54:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152425",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [config.patch](https://github.com/sagemath/sage/files/ticket13126/config.patch)

Patch to the openssl sources to fix building on Solaris



---

archive/issue_comments_152426.json:
```json
{
    "body": "<a id='comment:7'></a>\nAfter putting [attachment:config.patch](https://github.com/sagemath/sage/files/ticket13126/config.patch) in `patches`, the build works on Solaris.  Please add this to the spkg.",
    "created_at": "2012-06-20T19:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152426",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
After putting [attachment:config.patch](https://github.com/sagemath/sage/files/ticket13126/config.patch) in `patches`, the build works on Solaris.  Please add this to the spkg.



---

archive/issue_comments_152427.json:
```json
{
    "body": "<a id='comment:8'></a>\n> Could you please post the error message of the old OpenSSL spkg on OS X Lion?\n\n```\ngcc -I. -I.. -I../include  -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch i386 -O3 -fomit-frame-pointer -DL_ENDIAN -DOPENSSL_BN_ASM_PART_WORDS -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DRMD160_ASM -DAES_ASM -DVPAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM   -c -o cryptlib.o cryptlib.c\ngcc: error: i386: No such file or directory\ngcc: error: unrecognized option \u2018-arch\u2019\nmake[1]: *** [cryptlib.o] Error 1\n```\n\nI've now added config.patch to the spkg, applying it in all cases (not just on Solaris). Is this what you meant? For me, this still builds on OS X Lion (and passes tests), builds on sage.math (and fails tests), builds on mark, but doesn't build on hawk:\n\n```\nmake[4]: Entering directory `/export/home/palmieri/testing/sage-5.1.beta3/spkg/build/openssl-1.0.1c.p0/src'\nld: fatal: file /export/home/palmieri/testing/sage-5.1.beta3/local/bin/../lib/gcc/i386-pc-solaris2.11/4.6.3/crtbegin.o: wrong ELF class: ELFCLASS32\nld: fatal: file processing errors. No output written to libcrypto.so.1.0.0\ncollect2: ld returned 1 exit status\nmake[4]: *** [link_a.solaris] Error 1\nmake[4]: Leaving directory `/export/home/palmieri/testing/sage-5.1.beta3/spkg/build/openssl-1.0.1c.p0/src'\n```\nThis is from a version of Sage built with `SAGE_INSTALL_GCC=yes`, but I think my environment variables are messed up on hawk. I'll try again later.",
    "created_at": "2012-06-20T21:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152427",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
> Could you please post the error message of the old OpenSSL spkg on OS X Lion?

```
gcc -I. -I.. -I../include  -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch i386 -O3 -fomit-frame-pointer -DL_ENDIAN -DOPENSSL_BN_ASM_PART_WORDS -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DRMD160_ASM -DAES_ASM -DVPAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM   -c -o cryptlib.o cryptlib.c
gcc: error: i386: No such file or directory
gcc: error: unrecognized option ‘-arch’
make[1]: *** [cryptlib.o] Error 1
```

I've now added config.patch to the spkg, applying it in all cases (not just on Solaris). Is this what you meant? For me, this still builds on OS X Lion (and passes tests), builds on sage.math (and fails tests), builds on mark, but doesn't build on hawk:

```
make[4]: Entering directory `/export/home/palmieri/testing/sage-5.1.beta3/spkg/build/openssl-1.0.1c.p0/src'
ld: fatal: file /export/home/palmieri/testing/sage-5.1.beta3/local/bin/../lib/gcc/i386-pc-solaris2.11/4.6.3/crtbegin.o: wrong ELF class: ELFCLASS32
ld: fatal: file processing errors. No output written to libcrypto.so.1.0.0
collect2: ld returned 1 exit status
make[4]: *** [link_a.solaris] Error 1
make[4]: Leaving directory `/export/home/palmieri/testing/sage-5.1.beta3/spkg/build/openssl-1.0.1c.p0/src'
```
This is from a version of Sage built with `SAGE_INSTALL_GCC=yes`, but I think my environment variables are messed up on hawk. I'll try again later.



---

archive/issue_comments_152428.json:
```json
{
    "body": "<a id='comment:9'></a>\nOkay, with a better Sage installation on hawk, this openssl spkg builds for me. It fails self-tests, but that seems to be common...",
    "created_at": "2012-06-21T01:05:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152428",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Okay, with a better Sage installation on hawk, this openssl spkg builds for me. It fails self-tests, but that seems to be common...



---

archive/issue_events_110628.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-21T01:05:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110628"
}
```



---

archive/issue_events_110629.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-21T01:05:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110629"
}
```



---

archive/issue_comments_152429.json:
```json
{
    "body": "<a id='comment:11'></a>\n\n```\nif [ \"$SAGE_LOCAL\" = \"\" ]; then \n   echo \"SAGE_LOCAL undefined ... exiting\"; \n```\netc., probably ok, but [the developer guide](http://www.sagemath.org/doc/developer/producing_spkgs.html#section-spkg-install) has\n\n```\nif [ -z \"$SAGE_LOCAL\" ]; then\n    echo >&2 \"SAGE_LOCAL undefined ... exiting\"\n    echo >&2 \"Maybe run 'sage --sh'?\"\n    exit 1\nfi\n```\nnot that I want to hold up #11080 at all.\n\nAlso, I really didn't understand the very long discussion about licensing at #11080 at all - but I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev \"headers\" and wants to build from scratch and/or use the OpenID logins?",
    "created_at": "2012-06-27T15:53:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152429",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>

```
if [ "$SAGE_LOCAL" = "" ]; then 
   echo "SAGE_LOCAL undefined ... exiting"; 
```
etc., probably ok, but [the developer guide](http://www.sagemath.org/doc/developer/producing_spkgs.html#section-spkg-install) has

```
if [ -z "$SAGE_LOCAL" ]; then
    echo >&2 "SAGE_LOCAL undefined ... exiting"
    echo >&2 "Maybe run 'sage --sh'?"
    exit 1
fi
```
not that I want to hold up #11080 at all.

Also, I really didn't understand the very long discussion about licensing at #11080 at all - but I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev "headers" and wants to build from scratch and/or use the OpenID logins?



---

archive/issue_comments_152430.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [kcrisman](#comment%3A11):\n> I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev \"headers\" and wants to build from scratch and/or use the OpenID logins?\n\nOpenSSL would be *required* both to build and run Sage.  The spkg is optional only in the sense that you don't need it if the operating system provides it.  Since OpenSSL is truly *required* for Sage, it's dubious that Sage is obeying the GPL, but IANAL.",
    "created_at": "2012-06-27T16:11:28Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152430",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [kcrisman](#comment%3A11):
> I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev "headers" and wants to build from scratch and/or use the OpenID logins?

OpenSSL would be *required* both to build and run Sage.  The spkg is optional only in the sense that you don't need it if the operating system provides it.  Since OpenSSL is truly *required* for Sage, it's dubious that Sage is obeying the GPL, but IANAL.



---

archive/issue_comments_152431.json:
```json
{
    "body": "<a id='comment:13'></a>\n> > I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev \"headers\" and wants to build from scratch and/or use the OpenID logins?\n\n> OpenSSL would be *required* both to build and run Sage.  The spkg is optional only in the sense that you don't need it if the operating system provides it.  Since OpenSSL is truly *required* for Sage, it's dubious that Sage is obeying the GPL, but IANAL.\n\nRight, I just meant that under ordinary circumstances this spkg would not be required.\n\n---\n\nThis actually takes a while to build, I'm a little surprised... did it overwrite my existing openssl headers, by the way?  Hopefully that wouldn't be a problem :(\n\nBuilt ok on OS X 10.6 Intel and OS X 10.4 PPC.  I did not run self-tests, pursuant to John's comment above and since it's an optional spkg.\n\nSo I guess it's ok that `-fno-common:-arch ppc` and friends are still in there, since it worked?  I notice that in the `\"darwin64-x86_64-cc\"` line, all references to `arch` were removed...\n\n---\n\nWhat is the status here?  John tested the Solaris patch from Jeroen.  If Jeroen tested on Lion, then this should be mostly okay, possibly except my comment about `arch` and slight changing of the spkg-install (probably pointless).",
    "created_at": "2012-06-27T16:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152431",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
> > I assume that this will be an *optional* spkg, only needed if one's computer doesn't have openssl dev "headers" and wants to build from scratch and/or use the OpenID logins?

> OpenSSL would be *required* both to build and run Sage.  The spkg is optional only in the sense that you don't need it if the operating system provides it.  Since OpenSSL is truly *required* for Sage, it's dubious that Sage is obeying the GPL, but IANAL.

Right, I just meant that under ordinary circumstances this spkg would not be required.

---

This actually takes a while to build, I'm a little surprised... did it overwrite my existing openssl headers, by the way?  Hopefully that wouldn't be a problem :(

Built ok on OS X 10.6 Intel and OS X 10.4 PPC.  I did not run self-tests, pursuant to John's comment above and since it's an optional spkg.

So I guess it's ok that `-fno-common:-arch ppc` and friends are still in there, since it worked?  I notice that in the `"darwin64-x86_64-cc"` line, all references to `arch` were removed...

---

What is the status here?  John tested the Solaris patch from Jeroen.  If Jeroen tested on Lion, then this should be mostly okay, possibly except my comment about `arch` and slight changing of the spkg-install (probably pointless).



---

archive/issue_comments_152432.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman",
    "created_at": "2012-06-27T16:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152432",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman



---

archive/issue_comments_152433.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Jeroen Demeyer\".",
    "created_at": "2012-06-27T16:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152433",
    "user": "https://github.com/kcrisman"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Jeroen Demeyer".



---

archive/issue_comments_152434.json:
```json
{
    "body": "<a id='comment:14'></a>\nI modified the patch to make the `SAGE_LOCAL` check the same as in the developer's guide, and I also changed a few other error messages from `echo \"blah\"` to `echo >&2 \"blah\"`.\n\nIf it builds on OS X 10.6 Intel and OS X 10.4 PPC, that's good news, since the patches were affecting those builds and I don't have access to those platforms to test.",
    "created_at": "2012-06-27T17:05:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152434",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I modified the patch to make the `SAGE_LOCAL` check the same as in the developer's guide, and I also changed a few other error messages from `echo "blah"` to `echo >&2 "blah"`.

If it builds on OS X 10.6 Intel and OS X 10.4 PPC, that's good news, since the patches were affecting those builds and I don't have access to those platforms to test.



---

archive/issue_comments_152435.json:
```json
{
    "body": "<a id='comment:15'></a>\n> I modified the patch to make the `SAGE_LOCAL` check the same as in the developer's guide, and I also changed a few other error messages from `echo \"blah\"` to `echo >&2 \"blah\"`.\n\nLike I said, not crucial, but if it wasn't too much effort.\n> If it builds on OS X 10.6 Intel and OS X 10.4 PPC, that's good news, since the patches were affecting those builds and I don't have access to those platforms to test.\n\nFull disclosure; the PPC one still was using the Apple gcc, because I hadn't had access to it for a while (no keyboard) and it's still building the latest beta.  So maybe that's a false alarm, though I have no reason to suspect not - I can try again whenever that finishes if it's really important.  But the 10.6 was with Sage 5.1.beta3, so that should have the Sage-provided gcc in use.\n\nSo no worries about the other `arch` locations?  Jeroen, have you been able to test on a Lion machine?  I can't.",
    "created_at": "2012-06-27T17:18:15Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152435",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
> I modified the patch to make the `SAGE_LOCAL` check the same as in the developer's guide, and I also changed a few other error messages from `echo "blah"` to `echo >&2 "blah"`.

Like I said, not crucial, but if it wasn't too much effort.
> If it builds on OS X 10.6 Intel and OS X 10.4 PPC, that's good news, since the patches were affecting those builds and I don't have access to those platforms to test.

Full disclosure; the PPC one still was using the Apple gcc, because I hadn't had access to it for a while (no keyboard) and it's still building the latest beta.  So maybe that's a false alarm, though I have no reason to suspect not - I can try again whenever that finishes if it's really important.  But the 10.6 was with Sage 5.1.beta3, so that should have the Sage-provided gcc in use.

So no worries about the other `arch` locations?  Jeroen, have you been able to test on a Lion machine?  I can't.



---

archive/issue_comments_152436.json:
```json
{
    "body": "<a id='comment:16'></a>\nFor what it's worth, I've tested on two Lion machines, and it has not only built, but passed self-tests.",
    "created_at": "2012-06-27T17:25:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152436",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
For what it's worth, I've tested on two Lion machines, and it has not only built, but passed self-tests.



---

archive/issue_comments_152437.json:
```json
{
    "body": "<a id='comment:17'></a>\nInteresting, for me it fails on OS X 10.4 PPC:\n\n```\n****************************************************\nHost system:\nDarwin moufang.ugent.be 8.11.0 Darwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC Power Macintos\nh powerpc\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/Users/jdemeyer/sage-5.1.beta5/local/libexec/gcc/powerpc-apple-darwin8.11.0/4.6.3/lto-wrapper\nTarget: powerpc-apple-darwin8.11.0\nConfigured with: ../src/configure --prefix=/Users/jdemeyer/sage-5.1.beta5/local --with-local-prefix=/Users/jdemeyer/sage-5.1.beta5/local -\n-with-gmp=/Users/jdemeyer/sage-5.1.beta5/local --with-mpfr=/Users/jdemeyer/sage-5.1.beta5/local --with-mpc=/Users/jdemeyer/sage-5.1.beta5/\nlocal --with-system-zlib --disable-multilib\nThread model: posix\ngcc version 4.6.3 (GCC)\n****************************************************\nPatching openssl...\npatching file Configure\npatching file config\n\nConfiguring openssl...\nOperating system: ppc-apple-darwinDarwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC\nWARNING! If you wish to build 64-bit library, then you have to\n         invoke './Configure darwin64-ppc-cc' *manually*.\nConfiguring for darwin-ppc-cc\nConfiguring for darwin-ppc-cc\n[...]\nif [ -n \"libcrypto.1.0.0.dylib libssl.1.0.0.dylib\" ]; then \\\n        (cd ..; make -j1 libcrypto.1.0.0.dylib); \\\nfi\n[ -z \"\" ] || gcc -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -O3 -DB_ENDIAN -Wa,-force_cpusubtype_ALL -DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DAES_ASM -Iinclude \\\n        -DFINGERPRINT_PREMAIN_DSO_LOAD -o fips_premain_dso  \\\n        fips_premain.c fipscanister.o \\\n        libcrypto.a\ngcc: error: ppc: No such file or directory\ngcc: error: unrecognized option '-arch'\nmake[4]: *** [link_a.darwin] Error 1\nmake[3]: *** [do_darwin-shared] Error 2\nmake[2]: *** [libcrypto.1.0.0.dylib] Error 2\nmake[1]: *** [shared] Error 2\nmake: *** [build_crypto] Error 1\nError building openssl.\n```",
    "created_at": "2012-06-27T19:49:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152437",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Interesting, for me it fails on OS X 10.4 PPC:

```
****************************************************
Host system:
Darwin moufang.ugent.be 8.11.0 Darwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC Power Macintos
h powerpc
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Users/jdemeyer/sage-5.1.beta5/local/libexec/gcc/powerpc-apple-darwin8.11.0/4.6.3/lto-wrapper
Target: powerpc-apple-darwin8.11.0
Configured with: ../src/configure --prefix=/Users/jdemeyer/sage-5.1.beta5/local --with-local-prefix=/Users/jdemeyer/sage-5.1.beta5/local -
-with-gmp=/Users/jdemeyer/sage-5.1.beta5/local --with-mpfr=/Users/jdemeyer/sage-5.1.beta5/local --with-mpc=/Users/jdemeyer/sage-5.1.beta5/
local --with-system-zlib --disable-multilib
Thread model: posix
gcc version 4.6.3 (GCC)
****************************************************
Patching openssl...
patching file Configure
patching file config

Configuring openssl...
Operating system: ppc-apple-darwinDarwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC
WARNING! If you wish to build 64-bit library, then you have to
         invoke './Configure darwin64-ppc-cc' *manually*.
Configuring for darwin-ppc-cc
Configuring for darwin-ppc-cc
[...]
if [ -n "libcrypto.1.0.0.dylib libssl.1.0.0.dylib" ]; then \
        (cd ..; make -j1 libcrypto.1.0.0.dylib); \
fi
[ -z "" ] || gcc -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -O3 -DB_ENDIAN -Wa,-force_cpusubtype_ALL -DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DAES_ASM -Iinclude \
        -DFINGERPRINT_PREMAIN_DSO_LOAD -o fips_premain_dso  \
        fips_premain.c fipscanister.o \
        libcrypto.a
gcc: error: ppc: No such file or directory
gcc: error: unrecognized option '-arch'
make[4]: *** [link_a.darwin] Error 1
make[3]: *** [do_darwin-shared] Error 2
make[2]: *** [libcrypto.1.0.0.dylib] Error 2
make[1]: *** [shared] Error 2
make: *** [build_crypto] Error 1
Error building openssl.
```



---

archive/issue_comments_152438.json:
```json
{
    "body": "<a id='comment:18'></a>\nI think that my build on my machine is far enough along that I can check this now.  `which gcc` in `sage -sh` returns the correct one there, so now we just have to wait 20 minutes...\n\n```\ngcc: error: unrecognized option '-arch'\n```\nHmm.  I'm not sure where that comes from, after the patch - were there other instances in the configuration?",
    "created_at": "2012-06-27T20:02:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152438",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
I think that my build on my machine is far enough along that I can check this now.  `which gcc` in `sage -sh` returns the correct one there, so now we just have to wait 20 minutes...

```
gcc: error: unrecognized option '-arch'
```
Hmm.  I'm not sure where that comes from, after the patch - were there other instances in the configuration?



---

archive/attachments_018367.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13126-openssl.patch",
    "asset_url": "tarball://root/attachments/ticket13126/trac_13126-openssl.patch",
    "created_at": "2012-06-27T20:07:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13126/trac_13126-openssl.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_152439.json:
```json
{
    "body": "**Attachment:** [trac_13126-openssl.patch](https://github.com/sagemath/sage/files/ticket13126/trac_13126-openssl.patch)\n\npatch for openssl spkg; for review only",
    "created_at": "2012-06-27T20:07:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152439",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_13126-openssl.patch](https://github.com/sagemath/sage/files/ticket13126/trac_13126-openssl.patch)

patch for openssl spkg; for review only



---

archive/issue_comments_152440.json:
```json
{
    "body": "<a id='comment:19'></a>\nPlease try this version, in which I've removed a few more instances of `-arch` from `src/Configure`.",
    "created_at": "2012-06-27T20:08:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152440",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
Please try this version, in which I've removed a few more instances of `-arch` from `src/Configure`.



---

archive/issue_comments_152441.json:
```json
{
    "body": "<a id='comment:20'></a>\n> Please try this version, in which I've removed a few more instances of `-arch` from `src/Configure`.\n\nThis may have to wait a bit for me (my computer is still finishing the previous one, and I have to go home soon), but maybe Jeroen can ask moufang to take a stab at it.  Otherwise I'll try in a day or two.",
    "created_at": "2012-06-27T20:20:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152441",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>
> Please try this version, in which I've removed a few more instances of `-arch` from `src/Configure`.

This may have to wait a bit for me (my computer is still finishing the previous one, and I have to go home soon), but maybe Jeroen can ask moufang to take a stab at it.  Otherwise I'll try in a day or two.



---

archive/issue_comments_152442.json:
```json
{
    "body": "<a id='comment:21'></a>\nOkay, I got the same error, so this is undoubtedly the problem - remember, before you only removed the `fno-common` occurrences on one architecture.  I'm starting it now, but I won't be here to see it finish right away.  But I don't know what else it could be.",
    "created_at": "2012-06-27T20:25:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152442",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
Okay, I got the same error, so this is undoubtedly the problem - remember, before you only removed the `fno-common` occurrences on one architecture.  I'm starting it now, but I won't be here to see it finish right away.  But I don't know what else it could be.



---

archive/issue_comments_152443.json:
```json
{
    "body": "<a id='comment:22'></a>\nLuckily, I had a 5.0.1 release candidate built on a very similar (but faster) computer at home, with the gcc spkg and so forth.  Result of latest spkg posted here...\n\n```\nreal    14m19.061s\nuser    8m29.944s\nsys     2m46.075s\nSuccessfully installed openssl-1.0.1c.p0\nDeleting temporary build directory\n/Users/crisman/Desktop/sage-5.0.1.rc1/spkg/build/openssl-1.0.1c.p0\nMaking Python scripts relocatable...\nFinished installing openssl-1.0.1c.p0.spkg\n```",
    "created_at": "2012-06-28T02:01:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152443",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
Luckily, I had a 5.0.1 release candidate built on a very similar (but faster) computer at home, with the gcc spkg and so forth.  Result of latest spkg posted here...

```
real    14m19.061s
user    8m29.944s
sys     2m46.075s
Successfully installed openssl-1.0.1c.p0
Deleting temporary build directory
/Users/crisman/Desktop/sage-5.0.1.rc1/spkg/build/openssl-1.0.1c.p0
Making Python scripts relocatable...
Finished installing openssl-1.0.1c.p0.spkg
```



---

archive/issue_comments_152444.json:
```json
{
    "body": "<a id='comment:23'></a>\nYep, the latest spkg does compile on OS X 10.4.",
    "created_at": "2012-06-28T07:34:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152444",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Yep, the latest spkg does compile on OS X 10.4.



---

archive/issue_comments_152445.json:
```json
{
    "body": "<a id='comment:24'></a>\nOkay, then it only remains for someone other than John to test this on Lion, I guess - the spkg still looks correct.",
    "created_at": "2012-06-28T13:10:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152445",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'></a>
Okay, then it only remains for someone other than John to test this on Lion, I guess - the spkg still looks correct.



---

archive/issue_comments_152446.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman\" to \"Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman, Benjamin Jones\".",
    "created_at": "2012-06-28T23:57:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152446",
    "user": "https://github.com/benjaminfjones"
}
```

**Changing reviewer** from "Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman" to "Jeroen Demeyer, John Palmieri, Karl-Dieter Crisman, Benjamin Jones".



---

archive/issue_comments_152447.json:
```json
{
    "body": "<a id='comment:25'></a>\nBuilds on Lion (Mac OS X 10.7.4) (Darwin Kernel Version 11.4.0) (sage-5.1.beta6).\n\nHere is the build log: http://sage.math.washington.edu/home/bjones/openssl-1.0.1c.p0.log\n\nSince this is the last issue, I'll give the ticket a positive review.",
    "created_at": "2012-06-28T23:57:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152447",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:25'></a>
Builds on Lion (Mac OS X 10.7.4) (Darwin Kernel Version 11.4.0) (sage-5.1.beta6).

Here is the build log: http://sage.math.washington.edu/home/bjones/openssl-1.0.1c.p0.log

Since this is the last issue, I'll give the ticket a positive review.



---

archive/issue_events_110630.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-06-28T23:57:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110630"
}
```



---

archive/issue_events_110631.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-06-28T23:57:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110631"
}
```



---

archive/issue_events_110632.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-29T06:39:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110632"
}
```



---

archive/issue_events_110633.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-29T06:39:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "milestone": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110633"
}
```



---

archive/issue_comments_152448.json:
```json
{
    "body": "<a id='comment:27'></a>\nmoved spkg to the servers",
    "created_at": "2012-07-02T12:35:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152448",
    "user": "https://github.com/haraldschilly"
}
```

<a id='comment:27'></a>
moved spkg to the servers



---

archive/issue_events_110634.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-02T13:00:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110634"
}
```



---

archive/issue_events_110635.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-02T13:00:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13126#event-110635"
}
```



---

archive/issue_comments_152449.json:
```json
{
    "body": "<a id='comment:29'></a>\nFor the search engines:\n\n```\nIn file included from OpenSSL/crypto/crypto.h:17:0,\n                 from OpenSSL/crypto/crypto.c:16:\nOpenSSL/crypto/x509.h:17:25: fatal error: openssl/ssl.h: No such file or directory\ncompilation terminated.\nerror: Setup script exited with error: command 'gcc' failed with exit status 1\nError installing pyOpenSSL-0.12.tar.gz.\nError installing package sagenb-0.9.0\n```",
    "created_at": "2012-07-16T00:31:58Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152449",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
For the search engines:

```
In file included from OpenSSL/crypto/crypto.h:17:0,
                 from OpenSSL/crypto/crypto.c:16:
OpenSSL/crypto/x509.h:17:25: fatal error: openssl/ssl.h: No such file or directory
compilation terminated.
error: Setup script exited with error: command 'gcc' failed with exit status 1
Error installing pyOpenSSL-0.12.tar.gz.
Error installing package sagenb-0.9.0
```



---

archive/issue_comments_152450.json:
```json
{
    "body": "**Changing keywords** from \"openssl\" to \"openssl PyOpenSSL ssl.h SageNB notebook 0.9.0\".",
    "created_at": "2012-07-16T00:31:58Z",
    "issue": "https://github.com/sagemath/sage/issues/13126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13126#issuecomment-152450",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "openssl" to "openssl PyOpenSSL ssl.h SageNB notebook 0.9.0".
