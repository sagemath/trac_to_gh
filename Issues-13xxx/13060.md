# Issue 13060: Update Valgrind spkg to version 3.8.1

archive/issues_012888.json:
```json
{
    "assignees": [],
    "body": "Valgrind 3.7.0 configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).\n\nThe usual solution is to treat this version as the previous one:\nsee commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.\n\nFurthermore, the autogen.sh scripts fails with recent automake version.\nThis is commit r12396.\n\nAll these fixes are in Valgrind 3.8.1.\n\nTry spkg at\nhttp://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.p0.spkg\n\nSupport is announced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nCC:  @gvol @jpflori @haraldschilly\n\nComponent: **packages: optional**\n\nKeywords: **valgrind spkg**\n\nAuthor: **Jean-Pierre Flori**\n\nReviewer: **Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13060_\n\n",
    "closed_at": "2013-10-09T06:51:47Z",
    "created_at": "2012-05-29T10:37:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update Valgrind spkg to version 3.8.1",
    "type": "issue",
    "updated_at": "2013-10-09T06:51:47Z",
    "url": "https://github.com/sagemath/sage/issues/13060",
    "user": "https://github.com/jpflori"
}
```
Valgrind 3.7.0 configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).

The usual solution is to treat this version as the previous one:
see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.

Furthermore, the autogen.sh scripts fails with recent automake version.
This is commit r12396.

All these fixes are in Valgrind 3.8.1.

Try spkg at
http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.p0.spkg

Support is announced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).

Upstream: **Fixed upstream, but not in a stable release.**

CC:  @gvol @jpflori @haraldschilly

Component: **packages: optional**

Keywords: **valgrind spkg**

Author: **Jean-Pierre Flori**

Reviewer: **Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/13060_





---

archive/issue_events_179263.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T10:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179263"
}
```



---

archive/issue_events_179264.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T10:37:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179264"
}
```



---

archive/issue_events_179265.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T10:37:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179265"
}
```



---

archive/issue_events_179266.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T10:37:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179266"
}
```



---

archive/issue_comments_148756.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAfter applying the diff of the above commit, one has to rebuild the configure scripts with autogen.sh (which is available in the svn, not in the usual tarballs).\nThis basically calls auto* stuff, but the current input *.am files are incompatible with the current automake tool...\nSee r12396 in valgrind svn.",
    "created_at": "2012-05-29T12:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148756",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:1" align="right">comment:1</div>

After applying the diff of the above commit, one has to rebuild the configure scripts with autogen.sh (which is available in the svn, not in the usual tarballs).
This basically calls auto* stuff, but the current input *.am files are incompatible with the current automake tool...
See r12396 in valgrind svn.



---

archive/issue_events_179267.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T12:38:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179267"
}
```



---

archive/issue_comments_148757.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere comes a slightly updated spkg:\nhttp://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg\n\nI've applied the two mentioned patches and rerun autogen.sh to regenerate the build system files.\nThe package installs and seems functional with my Sage installation.\n\nAnother solution whould be to properly package a recent valgrind svn version, although I'd prefer to use this light solution and wait for a proper stable release to make a real update to valgrind.\nFeel free to disagree and rant here.",
    "created_at": "2012-05-29T12:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148757",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:2" align="right">comment:2</div>

Here comes a slightly updated spkg:
http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg

I've applied the two mentioned patches and rerun autogen.sh to regenerate the build system files.
The package installs and seems functional with my Sage installation.

Another solution whould be to properly package a recent valgrind svn version, although I'd prefer to use this light solution and wait for a proper stable release to make a real update to valgrind.
Feel free to disagree and rant here.



---

archive/issue_comments_148758.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,8 @@\n The usual solution is to treat this version as the previous one:\n see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.\n \n+Furthermore, the autogen.sh scripts fails with recent automake version.\n+This is commit r12396.\n+\n+An updated spkg including these two commits on top of 3.7.0 is available at\n+http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg\n``````\n",
    "created_at": "2012-05-29T12:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148758",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,8 @@
 The usual solution is to treat this version as the previous one:
 see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.
 
+Furthermore, the autogen.sh scripts fails with recent automake version.
+This is commit r12396.
+
+An updated spkg including these two commits on top of 3.7.0 is available at
+http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg
``````




---

archive/issue_comments_148759.json:
```json
{
    "body": "Attachment: **[trac_13060-spkg.diff.gz](https://github.com/sagemath/sage/files/ticket13060/trac_13060-spkg.diff.gz)**\n\nSpkg diff, for review only.",
    "created_at": "2012-05-29T12:38:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148759",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_13060-spkg.diff.gz](https://github.com/sagemath/sage/files/ticket13060/trac_13060-spkg.diff.gz)**

Spkg diff, for review only.



---

archive/issue_comments_148760.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThere might be something wrong with valgrind testsuite.\nI'm looking into this right now.",
    "created_at": "2012-05-29T12:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148760",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:3" align="right">comment:3</div>

There might be something wrong with valgrind testsuite.
I'm looking into this right now.



---

archive/issue_comments_148761.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIn fact, the current spkg is not functional at all.\n\nIt builds correctly, but fails to pass its test suite and Sage does not launch with the -valgrind flag.",
    "created_at": "2012-05-29T12:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148761",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:4" align="right">comment:4</div>

In fact, the current spkg is not functional at all.

It builds correctly, but fails to pass its test suite and Sage does not launch with the -valgrind flag.



---

archive/issue_events_179268.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T12:50:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179268"
}
```



---

archive/issue_events_179269.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-29T12:50:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179269"
}
```



---

archive/issue_comments_148762.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe startup problem seem to be caused by strlen being inlined and its symbol not found by valgrind which fails to start.",
    "created_at": "2012-05-29T13:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148762",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:5" align="right">comment:5</div>

The startup problem seem to be caused by strlen being inlined and its symbol not found by valgrind which fails to start.



---

archive/issue_comments_148763.json:
```json
{
    "body": "Work Issues: **testsuite fails**",
    "created_at": "2012-05-29T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148763",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **testsuite fails**



---

archive/issue_comments_148764.json:
```json
{
    "body": "Author: **Jean-Pierre Flori**",
    "created_at": "2012-05-29T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148764",
    "user": "https://github.com/jpflori"
}
```

Author: **Jean-Pierre Flori**



---

archive/issue_comments_148765.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nInstalling the debug version of libc6 (libc6-dbg) on my Ubuntu installation solves both the startup problem.\nNonetheless, it might be useful to actually print something when valgrind fails for this reason.\nCurrently running \"sage -valgrind\" exits without complaining although tunning directly valgrind from the local/bin folder provides some hints.",
    "created_at": "2012-05-29T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148765",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:6" align="right">comment:6</div>

Installing the debug version of libc6 (libc6-dbg) on my Ubuntu installation solves both the startup problem.
Nonetheless, it might be useful to actually print something when valgrind fails for this reason.
Currently running "sage -valgrind" exits without complaining although tunning directly valgrind from the local/bin folder provides some hints.



---

archive/issue_comments_148766.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOn a debian installation on top of recent hardware (corei7-avx) I'm able to install the old spkg (debian currently ships eglibc 2.13), but get a SIGILL when launching sage, which comes as no surprise:\nhttps://bugs.kde.org/show_bug.cgi?id=273475\n\nThe latest svn version is enough to let sage starts.\n\n\nOn the same install, the test suite with the old spkg yields\n\n```\n== 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdoutB failure, 3 post failures ==\n```\nthe one proposed here yields\n\n```\n== 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 3 post failures ==\n```\nwhich was expected.\nWith the latest svn version (you can test it by replace p0 by jp in the above url):\n\n```\n== 545 tests, 4 stderr failures, 0 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 0 post failures ==\n```\n\n\nOn the ubuntu install mentioned above, with the \n\n```\n== 591 tests, 79 stderr failures, 57 stdout failures, 0 stderrB failures, 0 stdo\nutB failure, 3 post failures ==\n```\nand with the latest svn version\n\n```\n== 534 tests, 4 stderr failures, 1 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 0 post failures ==\n```\n\nWhatsoever, I'm not sure that the problem of dealing with avx instructions should be dealt with here.\nWe surely should wait for a proper release by the valgrind team, the tested development version is completely arbitrary.\n\nAbout the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.\nI must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.\n\nIf we expect these failures to be fixed, I can definitely not take care of this with my little knowledge of valgrind.",
    "created_at": "2012-05-29T15:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148766",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:7" align="right">comment:7</div>

On a debian installation on top of recent hardware (corei7-avx) I'm able to install the old spkg (debian currently ships eglibc 2.13), but get a SIGILL when launching sage, which comes as no surprise:
https://bugs.kde.org/show_bug.cgi?id=273475

The latest svn version is enough to let sage starts.


On the same install, the test suite with the old spkg yields

```
== 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdoutB failure, 3 post failures ==
```
the one proposed here yields

```
== 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 3 post failures ==
```
which was expected.
With the latest svn version (you can test it by replace p0 by jp in the above url):

```
== 545 tests, 4 stderr failures, 0 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 0 post failures ==
```


On the ubuntu install mentioned above, with the 

```
== 591 tests, 79 stderr failures, 57 stdout failures, 0 stderrB failures, 0 stdo
utB failure, 3 post failures ==
```
and with the latest svn version

```
== 534 tests, 4 stderr failures, 1 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 0 post failures ==
```

Whatsoever, I'm not sure that the problem of dealing with avx instructions should be dealt with here.
We surely should wait for a proper release by the valgrind team, the tested development version is completely arbitrary.

About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.
I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.

If we expect these failures to be fixed, I can definitely not take care of this with my little knowledge of valgrind.



---

archive/issue_comments_148767.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jpflori](#comment%3A7):\n> About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.\n> I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.\n\nI know I ran the test suite last time at least once, but I think I saw a few failures on my Mac.  Now trying to install it on Sage 5.0 neither will even build.  I should have thought to build it when I was testing the betas.  The old spkg gives \n\n```\n...\nmake  all-recursive\nMaking all in include\nmake[2]: Nothing to be done for `all'.\nMaking all in VEX\nmake  all-am\ngcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -Ipriv   -arch x86_64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wbad-function-cast -Wcast-qual -Wcast-align -fstrict-aliasing -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libvex_amd64_darwin_a-main_globals.o -MD -MP -MF .deps/libvex_amd64_darwin_a-main_globals.Tpo -c -o libvex_amd64_darwin_a-main_globals.o `test -f 'priv/main_globals.c' || echo './'`priv/main_globals.c\ngcc: error: x86_64: No such file or directory\ngcc: error: unrecognized option \u2018-arch\u2019\nmake[3]: *** [libvex_amd64_darwin_a-main_globals.o] Error 1\nmake[2]: *** [all] Error 2\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\nError building Valgrind 3.7.0\n...\n```\n\nSo it looks like the former is a problem with the new gcc package:\n\n```\nsage -sh -c 'which gcc'\n/Users/gvol/SageStuff/sage-5.0.rc0/local/bin/gcc\n```\n\nAnd the spkg for review here gives.\n\n```\n...\nchecking for a sed that does not truncate output... /usr/bin/sed\nchecking for perl... /usr/bin/perl\nchecking for gdb... /usr/bin/gdb\nchecking dependency style of gcc... gcc3\nchecking for diff -u... yes\nchecking for a supported version of gcc... ok (4.6.3)\nconfigure: error: cannot run /bin/sh ./config.sub\nError configuring Valgrind 3.7.0\n...\n```\n\nHere `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \nThis probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.",
    "created_at": "2012-05-30T06:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148767",
    "user": "https://github.com/gvol"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jpflori](#comment%3A7):
> About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.
> I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.

I know I ran the test suite last time at least once, but I think I saw a few failures on my Mac.  Now trying to install it on Sage 5.0 neither will even build.  I should have thought to build it when I was testing the betas.  The old spkg gives 

```
...
make  all-recursive
Making all in include
make[2]: Nothing to be done for `all'.
Making all in VEX
make  all-am
gcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -Ipriv   -arch x86_64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wbad-function-cast -Wcast-qual -Wcast-align -fstrict-aliasing -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libvex_amd64_darwin_a-main_globals.o -MD -MP -MF .deps/libvex_amd64_darwin_a-main_globals.Tpo -c -o libvex_amd64_darwin_a-main_globals.o `test -f 'priv/main_globals.c' || echo './'`priv/main_globals.c
gcc: error: x86_64: No such file or directory
gcc: error: unrecognized option ‘-arch’
make[3]: *** [libvex_amd64_darwin_a-main_globals.o] Error 1
make[2]: *** [all] Error 2
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
Error building Valgrind 3.7.0
...
```

So it looks like the former is a problem with the new gcc package:

```
sage -sh -c 'which gcc'
/Users/gvol/SageStuff/sage-5.0.rc0/local/bin/gcc
```

And the spkg for review here gives.

```
...
checking for a sed that does not truncate output... /usr/bin/sed
checking for perl... /usr/bin/perl
checking for gdb... /usr/bin/gdb
checking dependency style of gcc... gcc3
checking for diff -u... yes
checking for a supported version of gcc... ok (4.6.3)
configure: error: cannot run /bin/sh ./config.sub
Error configuring Valgrind 3.7.0
...
```

Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.



---

archive/issue_comments_148768.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@gvol](#comment%3A8):\n> Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \n> This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  \n\nOh, I didn't realize that...\nI've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.\n\nI'll look into the arch stuff but have no apple stuff to test it.",
    "created_at": "2012-05-30T06:58:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148768",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@gvol](#comment%3A8):
> Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
> This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  

Oh, I didn't realize that...
I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.

I'll look into the arch stuff but have no apple stuff to test it.



---

archive/issue_comments_148769.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nJust a reminder for myself: indeed the apple gcc supports -arch, but the fsf one does not.",
    "created_at": "2012-05-30T07:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148769",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:10" align="right">comment:10</div>

Just a reminder for myself: indeed the apple gcc supports -arch, but the fsf one does not.



---

archive/issue_comments_148770.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jpflori](#comment%3A9):\n> Replying to [@gvol](#comment%3A8):\n> > Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \n> > This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  \n\n> \n> Oh, I didn't realize that...\n> I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.\n\nCool, thanks.  I just tried it (in the same place) and got the same error though.  Perhaps, it's in a different place?\n\n> I'll look into the arch stuff but have no apple stuff to test it.\n\nI think if you can force sage to use the gcc spkg it would exhibit the same problem, unless you are already using it.  What does `sage -sh -c 'which gcc'` return?\n\nIt might be worth asking Jeroen (or on sage-devel) since he knows it a lot better.",
    "created_at": "2012-05-30T07:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148770",
    "user": "https://github.com/gvol"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jpflori](#comment%3A9):
> Replying to [@gvol](#comment%3A8):
> > Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
> > This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  

> 
> Oh, I didn't realize that...
> I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.

Cool, thanks.  I just tried it (in the same place) and got the same error though.  Perhaps, it's in a different place?

> I'll look into the arch stuff but have no apple stuff to test it.

I think if you can force sage to use the gcc spkg it would exhibit the same problem, unless you are already using it.  What does `sage -sh -c 'which gcc'` return?

It might be worth asking Jeroen (or on sage-devel) since he knows it a lot better.



---

archive/issue_comments_148771.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe spkg is up now, I was a little slow to upload it.\n\nAbout the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.\nThat's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.",
    "created_at": "2012-05-30T08:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148771",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:12" align="right">comment:12</div>

The spkg is up now, I was a little slow to upload it.

About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.
That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.



---

archive/issue_comments_148772.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOh and valgrind.org seems down, so I don't have access to their svn anymore to see if anythig was commited about this gcc thingy lately.\n\nWe should maybe look into what Fink does:\nhttp://osdir.com/ml/fink-users-osx-unix/2011-11/msg00168.html\nalthough once more I'm no Apple user so don't have access or am used to such things.",
    "created_at": "2012-05-30T08:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148772",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:13" align="right">comment:13</div>

Oh and valgrind.org seems down, so I don't have access to their svn anymore to see if anythig was commited about this gcc thingy lately.

We should maybe look into what Fink does:
http://osdir.com/ml/fink-users-osx-unix/2011-11/msg00168.html
although once more I'm no Apple user so don't have access or am used to such things.



---

archive/issue_comments_148773.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jpflori](#comment%3A12):\n> The spkg is up now, I was a little slow to upload it.\n\nNo problem.  It works now\u2014except for actually building.  :-)\n\n> About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.\n> That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.\n\nAh, now I see it.  I guess we'll have to patch that, or ask them to do it upstream.  \n\nFink simply disabled mpicc http://fink.cvs.sourceforge.net/fink/dists/10.7/stable/main/finkinfo/devel/valgrind.info?view=markup which was the FSF compiler rather than gcc.",
    "created_at": "2012-05-30T08:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148773",
    "user": "https://github.com/gvol"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jpflori](#comment%3A12):
> The spkg is up now, I was a little slow to upload it.

No problem.  It works now—except for actually building.  :-)

> About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.
> That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.

Ah, now I see it.  I guess we'll have to patch that, or ask them to do it upstream.  

Fink simply disabled mpicc http://fink.cvs.sourceforge.net/fink/dists/10.7/stable/main/finkinfo/devel/valgrind.info?view=markup which was the FSF compiler rather than gcc.



---

archive/issue_comments_148774.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nValgrind website is back up.\nAfter a quick search trhough the svn log and the bug tracker, I found nothing related to the -arch flag.\nI guess we have to report upstream and/or provide a patch to the configure/build system.",
    "created_at": "2012-05-30T09:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148774",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:15" align="right">comment:15</div>

Valgrind website is back up.
After a quick search trhough the svn log and the bug tracker, I found nothing related to the -arch flag.
I guess we have to report upstream and/or provide a patch to the configure/build system.



---

archive/issue_events_179270.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-31T07:56:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179270"
}
```



---

archive/issue_events_179271.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-05-31T07:56:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179271"
}
```



---

archive/issue_comments_148775.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI've included some autotools magic to test if the -arch i386/x86_64 flag is supported and fall back to the -m32/64.\nCould you test the updated spkg at the same address as usual (at least the spkg still build on my linux)?\n\nI've put the diffs into the patches directory (although they are already applied because we have to run autoreconf) and will upload them here for review purpose.",
    "created_at": "2012-05-31T07:56:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148775",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

I've included some autotools magic to test if the -arch i386/x86_64 flag is supported and fall back to the -m32/64.
Could you test the updated spkg at the same address as usual (at least the spkg still build on my linux)?

I've put the diffs into the patches directory (although they are already applied because we have to run autoreconf) and will upload them here for review purpose.



---

archive/issue_comments_148776.json:
```json
{
    "body": "Diff for upstream svn commit r12323; accept glibc 2.15.",
    "created_at": "2012-05-31T08:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148776",
    "user": "https://github.com/jpflori"
}
```

Diff for upstream svn commit r12323; accept glibc 2.15.



---

archive/issue_comments_148777.json:
```json
{
    "body": "Attachment: **[glibc-2.15.diff.gz](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz)**\n\nAttachment: **[automake-1.11.2.diff.gz](https://github.com/sagemath/sage/files/ticket13060/automake-1.11.2.diff.gz)**\n\nDiff for upstream svn commit r12396; accept automake 1.11.2 and later.",
    "created_at": "2012-05-31T08:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148777",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[glibc-2.15.diff.gz](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz)**

Attachment: **[automake-1.11.2.diff.gz](https://github.com/sagemath/sage/files/ticket13060/automake-1.11.2.diff.gz)**

Diff for upstream svn commit r12396; accept automake 1.11.2 and later.



---

archive/issue_comments_148778.json:
```json
{
    "body": "Attachment: **[arch_flag-configure.in.diff.gz](https://github.com/sagemath/sage/files/ticket13060/arch_flag-configure.in.diff.gz)**\n\nDiff for configure.in; test -arch flag.",
    "created_at": "2012-05-31T08:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148778",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[arch_flag-configure.in.diff.gz](https://github.com/sagemath/sage/files/ticket13060/arch_flag-configure.in.diff.gz)**

Diff for configure.in; test -arch flag.



---

archive/issue_comments_148779.json:
```json
{
    "body": "Attachment: **[arch_flag-Makefile.all.am.diff.gz](https://github.com/sagemath/sage/files/ticket13060/arch_flag-Makefile.all.am.diff.gz)**\n\nDiff for Makefile.all.am; test for -arch flag.",
    "created_at": "2012-05-31T08:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148779",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[arch_flag-Makefile.all.am.diff.gz](https://github.com/sagemath/sage/files/ticket13060/arch_flag-Makefile.all.am.diff.gz)**

Diff for Makefile.all.am; test for -arch flag.



---

archive/issue_comments_148780.json:
```json
{
    "body": "Changed work issues from **testsuite fails** to none",
    "created_at": "2012-05-31T08:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148780",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **testsuite fails** to none



---

archive/issue_comments_148781.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,10 @@\n Furthermore, the autogen.sh scripts fails with recent automake version.\n This is commit r12396.\n \n+A further fix has been applied to test if the compiler supports the -arch flag.\n+This is needed to build the spkg on OSX with the FSF gcc provided by Sage which does not support this Apple specific flag.\n+\n+It is known that some tests of the testsuite fail.\n+\n An updated spkg including these two commits on top of 3.7.0 is available at\n http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg\n``````\n",
    "created_at": "2012-05-31T08:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148781",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,10 @@
 Furthermore, the autogen.sh scripts fails with recent automake version.
 This is commit r12396.
 
+A further fix has been applied to test if the compiler supports the -arch flag.
+This is needed to build the spkg on OSX with the FSF gcc provided by Sage which does not support this Apple specific flag.
+
+It is known that some tests of the testsuite fail.
+
 An updated spkg including these two commits on top of 3.7.0 is available at
 http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg
``````




---

archive/issue_comments_148782.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nBy the way, I'm aware that the changes to the spkg files are not commited yet.",
    "created_at": "2012-05-31T09:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148782",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:18" align="right">comment:18</div>

By the way, I'm aware that the changes to the spkg files are not commited yet.



---

archive/issue_comments_148783.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI hate to be the bearer of bad news, but now it fails because `__private_extern__` being used.\n\n```\n...\nMaking all in coregrind\nmake  all-am\ngcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -I../coregrind -DVG_LIBDIR=\"\\\"/Users/gvol/SageStuff/sage-5.0.rc0/local/lib/valgrind\"\\\" -DVG_PLATFORM=\"\\\"amd64-darwin\\\"\"   -m64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libcoregrind_amd64_darwin_a-m_syscall.o -MD -MP -MF .deps/libcoregrind_amd64_darwin_a-m_syscall.Tpo -c -o libcoregrind_amd64_darwin_a-m_syscall.o `test -f 'm_syscall.c' || echo './'`m_syscall.c\nm_syscall.c:504:1: error: unknown type name \u2018__private_extern__\u2019\nm_syscall.c:505:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018do_syscall_unix_WRK\u2019\nm_syscall.c:528:1: error: unknown type name \u2018__private_extern__\u2019\nm_syscall.c:529:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018do_syscall_mach_WRK\u2019\nm_syscall.c: In function \u2018vgPlain_do_syscall\u2019:\nm_syscall.c:648:10: warning: implicit declaration of function \u2018do_syscall_unix_WRK\u2019 [-Wimplicit-function-declaration]\nm_syscall.c:653:10: warning: implicit declaration of function \u2018do_syscall_mach_WRK\u2019 [-Wimplicit-function-declaration]\nmake[3]: *** [libcoregrind_amd64_darwin_a-m_syscall.o] Error 1\nmake[2]: *** [all] Error 2\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\n```\n\nSome information about this can be found [on Apple's website](https://developer.apple.com/library/mac/#documentation/developertools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html).  I think it's a darwin specific feature, but I couldn't find confirmation of that.  A quick check shows they only appear within one of the `ifdef`'s below\n\n```\n#elif defined(VGP_x86_darwin)\n#elif defined(VGP_amd64_darwin)\n#elif defined(VGO_darwin)\n```\nother branches seem to just use `extern`, but I readily admit to not taking the time to figure out what difference it would make.",
    "created_at": "2012-05-31T14:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148783",
    "user": "https://github.com/gvol"
}
```

<div id="comment:19" align="right">comment:19</div>

I hate to be the bearer of bad news, but now it fails because `__private_extern__` being used.

```
...
Making all in coregrind
make  all-am
gcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -I../coregrind -DVG_LIBDIR="\"/Users/gvol/SageStuff/sage-5.0.rc0/local/lib/valgrind"\" -DVG_PLATFORM="\"amd64-darwin\""   -m64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libcoregrind_amd64_darwin_a-m_syscall.o -MD -MP -MF .deps/libcoregrind_amd64_darwin_a-m_syscall.Tpo -c -o libcoregrind_amd64_darwin_a-m_syscall.o `test -f 'm_syscall.c' || echo './'`m_syscall.c
m_syscall.c:504:1: error: unknown type name ‘__private_extern__’
m_syscall.c:505:1: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘do_syscall_unix_WRK’
m_syscall.c:528:1: error: unknown type name ‘__private_extern__’
m_syscall.c:529:1: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘do_syscall_mach_WRK’
m_syscall.c: In function ‘vgPlain_do_syscall’:
m_syscall.c:648:10: warning: implicit declaration of function ‘do_syscall_unix_WRK’ [-Wimplicit-function-declaration]
m_syscall.c:653:10: warning: implicit declaration of function ‘do_syscall_mach_WRK’ [-Wimplicit-function-declaration]
make[3]: *** [libcoregrind_amd64_darwin_a-m_syscall.o] Error 1
make[2]: *** [all] Error 2
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
```

Some information about this can be found [on Apple's website](https://developer.apple.com/library/mac/#documentation/developertools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html).  I think it's a darwin specific feature, but I couldn't find confirmation of that.  A quick check shows they only appear within one of the `ifdef`'s below

```
#elif defined(VGP_x86_darwin)
#elif defined(VGP_amd64_darwin)
#elif defined(VGO_darwin)
```
other branches seem to just use `extern`, but I readily admit to not taking the time to figure out what difference it would make.



---

archive/issue_comments_148784.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nValgrind 3.8.0 was released recently.  I haven't tried it to see if it fixes any build problems, but I can take the time to test a new spkg.",
    "created_at": "2012-08-22T16:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148784",
    "user": "https://github.com/gvol"
}
```

<div id="comment:20" align="right">comment:20</div>

Valgrind 3.8.0 was released recently.  I haven't tried it to see if it fixes any build problems, but I can take the time to test a new spkg.



---

archive/issue_events_179272.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-12-24T21:10:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "title_is": "Update Valgrind spkg to version 3.8.1",
    "title_was": "Valgrind complains about glibc 2.15",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179272"
}
```



---

archive/issue_comments_148785.json:
```json
{
    "body": "Work Issues: **Test on OSX**",
    "created_at": "2012-12-24T21:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148785",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **Test on OSX**



---

archive/issue_comments_148786.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Valgrind configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).\n+Valgrind 3.7.0 configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).\n \n The usual solution is to treat this version as the previous one:\n see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.\n@@ -6,10 +6,9 @@\n Furthermore, the autogen.sh scripts fails with recent automake version.\n This is commit r12396.\n \n-A further fix has been applied to test if the compiler supports the -arch flag.\n-This is needed to build the spkg on OSX with the FSF gcc provided by Sage which does not support this Apple specific flag.\n+All these fixes are in Valgrind 3.8.1.\n \n-It is known that some tests of the testsuite fail.\n+Try spkg at\n+http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg\n \n-An updated spkg including these two commits on top of 3.7.0 is available at\n-http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg\n+Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).\n``````\n",
    "created_at": "2012-12-24T21:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148786",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Valgrind configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).
+Valgrind 3.7.0 configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).
 
 The usual solution is to treat this version as the previous one:
 see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.
@@ -6,10 +6,9 @@
 Furthermore, the autogen.sh scripts fails with recent automake version.
 This is commit r12396.
 
-A further fix has been applied to test if the compiler supports the -arch flag.
-This is needed to build the spkg on OSX with the FSF gcc provided by Sage which does not support this Apple specific flag.
+All these fixes are in Valgrind 3.8.1.
 
-It is known that some tests of the testsuite fail.
+Try spkg at
+http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg
 
-An updated spkg including these two commits on top of 3.7.0 is available at
-http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg
+Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).
``````




---

archive/issue_comments_148787.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNew spkg including 3.8.1 at\nhttp://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg\n\nUpstream claim to support OSX from 10.6.X onward (10.8.x being currently limited).\nWe used to claim from 10.5.x onward.\nCould some Apple user check that?\n\nNot sure if you can now build it with FSF GCC (such as the one shipped by Sage's spkg.\nCould someone test that as well?\n\nAt least this spkg runs correctly on recent Linuxes with GLIBC 2.15 and supports AVX instructions.",
    "created_at": "2012-12-24T21:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148787",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:21" align="right">comment:21</div>

New spkg including 3.8.1 at
http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg

Upstream claim to support OSX from 10.6.X onward (10.8.x being currently limited).
We used to claim from 10.5.x onward.
Could some Apple user check that?

Not sure if you can now build it with FSF GCC (such as the one shipped by Sage's spkg.
Could someone test that as well?

At least this spkg runs correctly on recent Linuxes with GLIBC 2.15 and supports AVX instructions.



---

archive/issue_comments_148788.json:
```json
{
    "body": "Attachment: **[valgrind-3.8.1.diff.gz](https://github.com/sagemath/sage/files/ticket13060/valgrind-3.8.1.diff.gz)**\n\nspkg diff, for review only",
    "created_at": "2012-12-24T21:11:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148788",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[valgrind-3.8.1.diff.gz](https://github.com/sagemath/sage/files/ticket13060/valgrind-3.8.1.diff.gz)**

spkg diff, for review only



---

archive/issue_comments_148789.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIt looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the \"impossible\" happens and it doesn't work:\n\n```\n==415== Memcheck, a memory error detector\n==415== Copyright (C) 2002-2012, and GNU GPL'd, by Julian Seward et al.\n==415== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info\n==415== Command: python -i\n==415== Parent PID: 414\n==415== \n--415-- /Users/gvol/SageStuff/sage-5.4.rc2/local/bin/python:\n--415-- dSYM directory is missing; consider using --dsymutil=yes\neq_SyscallStatus:\n  {78 0 43}\n  {78 0 40}\n\nvalgrind: m_syswrap/syswrap-main.c:380 (eq_SyscallStatus): the 'impossible' happened.\n==415==    at 0x138032720: ???\n==415==    by 0x138032A03: ???\n==415==    by 0x13809A395: ???\n==415==    by 0x13809B5FF: ???\n==415==    by 0x138098D8A: ???\n==415==    by 0x1380B9F21: ???\n\nsched status:\n  running_tid=1\n\nThread 1: status = VgTs_Runnable\n==415==    at 0x7FFF5FC242DA: _kernelrpc_mach_vm_allocate_trap (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC2497C: vm_allocate (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13BF3: ImageLoaderMachO::reserveAnAddressRange(unsigned long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13A54: ImageLoaderMachO::assignSegmentAddresses(ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13C58: ImageLoaderMachO::mapSegments(int, unsigned long long, unsigned long long, unsigned long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC17104: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC10F5A: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC03557: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC08BAE: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0860D: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC084F9: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC07C30: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0319A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC02F07: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0598E: dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC01396: dyldbootstrap::start(macho_header const*, int, char const**, long, macho_header const*, unsigned long*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0105D: _dyld_start (in /usr/lib/dyld)\n==415==    by 0x1: ???\n==415==    by 0x7FFF5FBFEBBA: ???\n==415==    by 0x7FFF5FBFEBC1: ???\n\n\nNote: see also the FAQ in the source distribution.\nIt contains workarounds to several common problems.\nIn particular, if Valgrind aborted or crashed after\nidentifying problems in your program, there's a good chance\nthat fixing those problems will prevent Valgrind aborting or\ncrashing, especially if it happened in m_mallocfree.c.\n\nIf that doesn't help, please report this bug to: www.valgrind.org\n\nIn the bug report, send all the above text, the valgrind\nversion, and what OS and version you are using.  Thanks.\n```\n\nFor the record, the exact way that I made the \"fixes\" was to add \n\n```\nperl -pi.bak -e 's/[-]arch x86_64/\\@FLAG_M64@/;' -e 's/[-]arch i386/\\@FLAG_M32@/' configure.in Makefile.all.am\n./autogen.sh\nexport CFLAGS=\"$CFLAGS -D__private_extern__=extern\"\n```\nto `spkg-install` just before calling configure.  I don't suggest this method of \"fixing\" it.\n\nPerhaps we should ask the maintainers of valgrind the best way to proceed.",
    "created_at": "2012-12-27T20:06:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148789",
    "user": "https://github.com/gvol"
}
```

<div id="comment:22" align="right">comment:22</div>

It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the "impossible" happens and it doesn't work:

```
==415== Memcheck, a memory error detector
==415== Copyright (C) 2002-2012, and GNU GPL'd, by Julian Seward et al.
==415== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info
==415== Command: python -i
==415== Parent PID: 414
==415== 
--415-- /Users/gvol/SageStuff/sage-5.4.rc2/local/bin/python:
--415-- dSYM directory is missing; consider using --dsymutil=yes
eq_SyscallStatus:
  {78 0 43}
  {78 0 40}

valgrind: m_syswrap/syswrap-main.c:380 (eq_SyscallStatus): the 'impossible' happened.
==415==    at 0x138032720: ???
==415==    by 0x138032A03: ???
==415==    by 0x13809A395: ???
==415==    by 0x13809B5FF: ???
==415==    by 0x138098D8A: ???
==415==    by 0x1380B9F21: ???

sched status:
  running_tid=1

Thread 1: status = VgTs_Runnable
==415==    at 0x7FFF5FC242DA: _kernelrpc_mach_vm_allocate_trap (in /usr/lib/dyld)
==415==    by 0x7FFF5FC2497C: vm_allocate (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13BF3: ImageLoaderMachO::reserveAnAddressRange(unsigned long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13A54: ImageLoaderMachO::assignSegmentAddresses(ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13C58: ImageLoaderMachO::mapSegments(int, unsigned long long, unsigned long long, unsigned long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC17104: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC10F5A: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC03557: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC08BAE: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0860D: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC084F9: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC07C30: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0319A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC02F07: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0598E: dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC01396: dyldbootstrap::start(macho_header const*, int, char const**, long, macho_header const*, unsigned long*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0105D: _dyld_start (in /usr/lib/dyld)
==415==    by 0x1: ???
==415==    by 0x7FFF5FBFEBBA: ???
==415==    by 0x7FFF5FBFEBC1: ???


Note: see also the FAQ in the source distribution.
It contains workarounds to several common problems.
In particular, if Valgrind aborted or crashed after
identifying problems in your program, there's a good chance
that fixing those problems will prevent Valgrind aborting or
crashing, especially if it happened in m_mallocfree.c.

If that doesn't help, please report this bug to: www.valgrind.org

In the bug report, send all the above text, the valgrind
version, and what OS and version you are using.  Thanks.
```

For the record, the exact way that I made the "fixes" was to add 

```
perl -pi.bak -e 's/[-]arch x86_64/\@FLAG_M64@/;' -e 's/[-]arch i386/\@FLAG_M32@/' configure.in Makefile.all.am
./autogen.sh
export CFLAGS="$CFLAGS -D__private_extern__=extern"
```
to `spkg-install` just before calling configure.  I don't suggest this method of "fixing" it.

Perhaps we should ask the maintainers of valgrind the best way to proceed.



---

archive/issue_comments_148790.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@gvol](#comment%3A22):\n> It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the \"impossible\" happens and it doesn't work:\n\nYup I did not include the patch we wrote before because it seemed too much of a hassle and did not lead to a successful build of Valgrind.\nSorry about that but I did not have much time to spend on this one.\n> For the record, the exact way that I made the \"fixes\" was to add \n> \n> ```\n> perl -pi.bak -e 's/[-]arch x86_64/\\@FLAG_M64@/;' -e 's/[-]arch i386/\\@FLAG_M32@/' configure.in Makefile.all.am\n> ./autogen.sh\n> export CFLAGS=\"$CFLAGS -D__private_extern__=extern\"\n> ```\n> to `spkg-install` just before calling configure.  I don't suggest this method of \"fixing\" it.\n> \n> Perhaps we should ask the maintainers of valgrind the best way to proceed.\n\nI think the best way to proceed is unfortunately to use Apple's GCC.\nValgrind build system seems completely thought for it...\nThat would mean an additional check in spkg-install and would be much easier than fixing upstream build system to work with an FSF GCC.",
    "created_at": "2012-12-31T14:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148790",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@gvol](#comment%3A22):
> It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the "impossible" happens and it doesn't work:

Yup I did not include the patch we wrote before because it seemed too much of a hassle and did not lead to a successful build of Valgrind.
Sorry about that but I did not have much time to spend on this one.
> For the record, the exact way that I made the "fixes" was to add 
> 
> ```
> perl -pi.bak -e 's/[-]arch x86_64/\@FLAG_M64@/;' -e 's/[-]arch i386/\@FLAG_M32@/' configure.in Makefile.all.am
> ./autogen.sh
> export CFLAGS="$CFLAGS -D__private_extern__=extern"
> ```
> to `spkg-install` just before calling configure.  I don't suggest this method of "fixing" it.
> 
> Perhaps we should ask the maintainers of valgrind the best way to proceed.

I think the best way to proceed is unfortunately to use Apple's GCC.
Valgrind build system seems completely thought for it...
That would mean an additional check in spkg-install and would be much easier than fixing upstream build system to work with an FSF GCC.



---

archive/issue_comments_148791.json:
```json
{
    "body": "Changed work issues from **Test on OSX** to **Use Apple compiler on OS X.**",
    "created_at": "2013-02-06T10:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148791",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **Test on OSX** to **Use Apple compiler on OS X.**



---

archive/issue_events_179273.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-02-06T10:32:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179273"
}
```



---

archive/issue_events_179274.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-02-06T10:32:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179274"
}
```



---

archive/issue_events_179275.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179275"
}
```



---

archive/issue_events_179276.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179276"
}
```



---

archive/issue_comments_148792.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,6 @@\n All these fixes are in Valgrind 3.8.1.\n \n Try spkg at\n-http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg\n+http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.spkg\n \n Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).\n``````\n",
    "created_at": "2013-10-07T14:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148792",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,6 @@
 All these fixes are in Valgrind 3.8.1.
 
 Try spkg at
-http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg
+http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.spkg
 
 Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).
``````




---

archive/issue_comments_148793.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOn Fedora 19, I get:\n\n```\nchecking the GLIBC_VERSION version... unsupported version 2.17\nconfigure: error: Valgrind requires glibc version 2.2 - 2.16\n```",
    "created_at": "2013-10-07T14:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148793",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>

On Fedora 19, I get:

```
checking the GLIBC_VERSION version... unsupported version 2.17
configure: error: Valgrind requires glibc version 2.2 - 2.16
```



---

archive/issue_comments_148794.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI'd say extend the treatment of GLIBC 2.15 in [attachment: glibc-2.15.diff](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz) (i.e. treat it as 2.14) to GLIBC 2.16 and 2.17.\nA quick google search seems to show it is enough and has been adopted by various distribs.\nBut We should surely have a look at valgrind svn first to see if GLIBC > 2.15 needs more specific treatment...",
    "created_at": "2013-10-07T14:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148794",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:28" align="right">comment:28</div>

I'd say extend the treatment of GLIBC 2.15 in [attachment: glibc-2.15.diff](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz) (i.e. treat it as 2.14) to GLIBC 2.16 and 2.17.
A quick google search seems to show it is enough and has been adopted by various distribs.
But We should surely have a look at valgrind svn first to see if GLIBC > 2.15 needs more specific treatment...



---

archive/issue_comments_148795.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThere is even 2.18 now.",
    "created_at": "2013-10-07T14:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148795",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:29" align="right">comment:29</div>

There is even 2.18 now.



---

archive/issue_comments_148796.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nDo you want to update it? I would be fine with the current spkg, too. Its better than what we have and users of cutting-edge distros probably don't need help to install the distro valgrind.",
    "created_at": "2013-10-07T14:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148796",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:30" align="right">comment:30</div>

Do you want to update it? I would be fine with the current spkg, too. Its better than what we have and users of cutting-edge distros probably don't need help to install the distro valgrind.



---

archive/issue_comments_148797.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nSure, I'll try to produce the trivial patch tonight.\n\nNote we should surely take care of #14097 as well if wa want this spkg to be useful.",
    "created_at": "2013-10-07T14:58:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148797",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:31" align="right">comment:31</div>

Sure, I'll try to produce the trivial patch tonight.

Note we should surely take care of #14097 as well if wa want this spkg to be useful.



---

archive/issue_comments_148798.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI just checked Valgrind svn and the fix from [attachment: glibc-2.15.diff](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz) is also used for 2.16-18 so providing a fixed spkg will be easy.\nIn fact, it seems glibc 2.>=12 get the exact same treatment, and the only difference with glibc 2.>=3/<=11 lies in coregrind/m_redir.c (and is indeed needed).",
    "created_at": "2013-10-07T15:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148798",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:32" align="right">comment:32</div>

I just checked Valgrind svn and the fix from [attachment: glibc-2.15.diff](https://github.com/sagemath/sage/files/ticket13060/glibc-2.15.diff.gz) is also used for 2.16-18 so providing a fixed spkg will be easy.
In fact, it seems glibc 2.>=12 get the exact same treatment, and the only difference with glibc 2.>=3/<=11 lies in coregrind/m_redir.c (and is indeed needed).



---

archive/issue_comments_148799.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReferences of the valgrind commits: r12743, r13228, r13504.",
    "created_at": "2013-10-07T15:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148799",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:33" align="right">comment:33</div>

References of the valgrind commits: r12743, r13228, r13504.



---

archive/issue_comments_148800.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-10-07T21:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148800",
    "user": "https://github.com/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_comments_148801.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,6 @@\n All these fixes are in Valgrind 3.8.1.\n \n Try spkg at\n-http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.spkg\n+http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.p0.spkg\n \n-Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).\n+Support is announced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).\n``````\n",
    "created_at": "2013-10-07T21:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148801",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,6 @@
 All these fixes are in Valgrind 3.8.1.
 
 Try spkg at
-http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.spkg
+http://boxen.math.washington.edu/home/jpflori/spkg/valgrind-3.8.1.p0.spkg
 
-Support is annouced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).
+Support is announced upstream for OS X from 10.6.X onward, but building Valgrind might fail if you're using a non Apple gcc (such as the FSF one in Sage's spkg).
``````




---

archive/issue_comments_148802.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAttachment: **[valgrind-3.8.1.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13060/valgrind-3.8.1.p0.diff.gz)**\n\nIf we really want to be able to use Valgrind on OS X when Sage built its own GCC, let's do that on another ticket.",
    "created_at": "2013-10-07T21:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148802",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:34" align="right">comment:34</div>

Attachment: **[valgrind-3.8.1.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13060/valgrind-3.8.1.p0.diff.gz)**

If we really want to be able to use Valgrind on OS X when Sage built its own GCC, let's do that on another ticket.



---

archive/issue_comments_148803.json:
```json
{
    "body": "Changed work issues from **Use Apple compiler on OS X.** to none",
    "created_at": "2013-10-07T21:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148803",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **Use Apple compiler on OS X.** to none



---

archive/issue_events_179277.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-10-07T21:10:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179277"
}
```



---

archive/issue_events_179278.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-10-07T21:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179278"
}
```



---

archive/issue_comments_148804.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nLooks good to me, thanks!\n\nHarald: please update on the mirrors",
    "created_at": "2013-10-07T22:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148804",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:35" align="right">comment:35</div>

Looks good to me, thanks!

Harald: please update on the mirrors



---

archive/issue_comments_148805.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2013-10-07T22:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148805",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_179279.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-10-07T22:24:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179279"
}
```



---

archive/issue_events_179280.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-10-07T22:24:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179280"
}
```



---

archive/issue_comments_148806.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\ndone, file is on the server",
    "created_at": "2013-10-08T10:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13060#issuecomment-148806",
    "user": "https://github.com/haraldschilly"
}
```

<div id="comment:37" align="right">comment:37</div>

done, file is on the server



---

archive/issue_events_179281.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-09T06:51:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179281"
}
```



---

archive/issue_events_179282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-09T06:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13060",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13060#event-179282"
}
```
