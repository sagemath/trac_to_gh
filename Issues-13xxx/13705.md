# Issue 13705: segfault in analytic_rank(algorithm='rubinstein')

archive/issues_013501.json:
```json
{
    "body": "apparently, PARI ungracefully runs out of memory on the following:\n\n```\nsage: e= elliptic_curves.rank(8)[0]\nsage: e.analytic_rank(algorithm='rubinstein')\n  ***   Warning: not enough memory, new stack 18446744073268923520.\n...[lots of similar lines removed]\n  ***   Warning: not enough memory, new stack 17179869183.\n  ***   Warning:   ***   bug in PARI/GP (Segmentation Fault), please report\n  ***   bug in PARI/GP (Segmentation Fault), please report\n...[lots of similar lines removed]\n```\ncertainly, this is a difficult elliptic curve to deal with, but still, segfault is a segfault. See the related\n[sage-devel discussion](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/62488).\n\nAssignee: @JohnCremona\n\nCC:  @JohnCremona\n\nKeywords: lcalc\n\nReviewer: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13705\n\n",
    "closed_at": "2014-01-06T23:20:32Z",
    "created_at": "2012-11-13T07:32:30Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "segfault in analytic_rank(algorithm='rubinstein')",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13705",
    "user": "https://github.com/dimpase"
}
```
apparently, PARI ungracefully runs out of memory on the following:

```
sage: e= elliptic_curves.rank(8)[0]
sage: e.analytic_rank(algorithm='rubinstein')
  ***   Warning: not enough memory, new stack 18446744073268923520.
...[lots of similar lines removed]
  ***   Warning: not enough memory, new stack 17179869183.
  ***   Warning:   ***   bug in PARI/GP (Segmentation Fault), please report
  ***   bug in PARI/GP (Segmentation Fault), please report
...[lots of similar lines removed]
```
certainly, this is a difficult elliptic curve to deal with, but still, segfault is a segfault. See the related
[sage-devel discussion](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/62488).

Assignee: @JohnCremona

CC:  @JohnCremona

Keywords: lcalc

Reviewer: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13705





---

archive/issue_comments_212731.json:
```json
{
    "body": "<a id='comment:2'></a>\nAs I said on sage-devel, this computation will require a very large number of L-series coefficients, so this does not surprise me.  I think that the only sensible way out is for the analytic rank function to quit gracefully for curve like this.",
    "created_at": "2012-11-13T09:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212731",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
As I said on sage-devel, this computation will require a very large number of L-series coefficients, so this does not surprise me.  I think that the only sensible way out is for the analytic rank function to quit gracefully for curve like this.



---

archive/issue_events_044488.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13705#event-44488"
}
```



---

archive/issue_comments_212732.json:
```json
{
    "body": "<a id='comment:4'></a>\nI now get\n\n```\n  ***   Warning: not enough memory, new stack 3854339200.\nterminate called after throwing an instance of 'std::bad_alloc'\n  what():  std::bad_alloc\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-1-d7407b95d583> in <module>()\n----> 1 elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')\n\n/usr/local/src/sage-2217/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in analytic_rank(self, algorithm, leading_coefficient)\n   1353                 return lcalc.analytic_rank(L=self)\n   1354             except TypeError,msg:\n-> 1355                 raise RuntimeError, \"unable to compute analytic rank using rubinstein algorithm ('%s')\"%msg\n   1356         elif algorithm == 'sympow':\n   1357             if leading_coefficient:\n\nRuntimeError: unable to compute analytic rank using rubinstein algorithm ('unable to convert x (=) to an integer')\n```\nwhich is about the best one can hope...\n\nI think this should be closed as \"wontfix\".",
    "created_at": "2014-01-06T14:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212732",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
I now get

```
  ***   Warning: not enough memory, new stack 3854339200.
terminate called after throwing an instance of 'std::bad_alloc'
  what():  std::bad_alloc
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-d7407b95d583> in <module>()
----> 1 elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')

/usr/local/src/sage-2217/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in analytic_rank(self, algorithm, leading_coefficient)
   1353                 return lcalc.analytic_rank(L=self)
   1354             except TypeError,msg:
-> 1355                 raise RuntimeError, "unable to compute analytic rank using rubinstein algorithm ('%s')"%msg
   1356         elif algorithm == 'sympow':
   1357             if leading_coefficient:

RuntimeError: unable to compute analytic rank using rubinstein algorithm ('unable to convert x (=) to an integer')
```
which is about the best one can hope...

I think this should be closed as "wontfix".



---

archive/issue_comments_212733.json:
```json
{
    "body": "Reviewer: Jeroen Demeyer",
    "created_at": "2014-01-06T14:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212733",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: Jeroen Demeyer



---

archive/issue_events_044489.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-06T14:10:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13705#event-44489"
}
```



---

archive/issue_events_044490.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-06T14:10:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13705#event-44490"
}
```



---

archive/issue_comments_212734.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-06T14:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212734",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_212735.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-06T14:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212735",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_212736.json:
```json
{
    "body": "<a id='comment:6'></a>\nNote also that the ticket reports a segmentation fault in `lcalc`, not Sage itself.",
    "created_at": "2014-01-06T14:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212736",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Note also that the ticket reports a segmentation fault in `lcalc`, not Sage itself.



---

archive/issue_comments_212737.json:
```json
{
    "body": "<a id='comment:7'></a>\nI ran the code on 6.0 and it did not crash.\n\n```\nsage: elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')\n  ***   Warning: not enough memory, new stack 18446744073268923520.\n  ***   Warning: not enough memory, new stack 9223372036634461760.\n (similar lines)\n         ***   Warning: not enough memory, new stack 274877906880.\n  ***   Warning: new stack size = 137438953408 (131072.000 Mbytes).\n0\n```\nwhich is not the correct analytic rank, but there is no segfault.",
    "created_at": "2014-01-06T20:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212737",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
I ran the code on 6.0 and it did not crash.

```
sage: elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')
  ***   Warning: not enough memory, new stack 18446744073268923520.
  ***   Warning: not enough memory, new stack 9223372036634461760.
 (similar lines)
         ***   Warning: not enough memory, new stack 274877906880.
  ***   Warning: new stack size = 137438953408 (131072.000 Mbytes).
0
```
which is not the correct analytic rank, but there is no segfault.



---

archive/issue_comments_212738.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-06T23:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13705#issuecomment-212738",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_044491.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-06T23:20:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13705#event-44491"
}
```
