# Issue 13912: Let iconv build on Cygwin without installing Cygwin libiconv package

archive/issues_013708.json:
```json
{
    "assignees": [],
    "body": "Crafting a somehow minimal Cygwin install, I got the libiconv2 package with binaries installed but the libiconv one with dev things is not.\n\nBecause of that building our libiconv spkg fails because it uses the system libintl which points to libiconv files provided in the dev libiconv package (and not the libiconv2).\n\nMaybe the easiest solution is to prereq the installation of the dev libiconv package, but we can also go by passing --disable-nls to configure.\n\nUse spkg at\nhttp://boxen.math.washington.edu/home/jpflori/iconv-1.13.1.p4.spkg\n\n(I'll investigate in a follow-up ticket if building our own libiconv is actually needed on Cygwin nowadays.)\n\n**CC:**  @kcrisman\n\n**Keywords:** cygwin iconv spkg\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Jean-Pierre Flori\n\n**Merged:** sage-5.7.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/13912\n\n",
    "closed_at": "2013-01-21T21:09:15Z",
    "created_at": "2013-01-05T14:22:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let iconv build on Cygwin without installing Cygwin libiconv package",
    "type": "issue",
    "updated_at": "2013-02-04T14:58:20Z",
    "url": "https://github.com/sagemath/sage/issues/13912",
    "user": "https://github.com/sagetrac-jpflori"
}
```
Crafting a somehow minimal Cygwin install, I got the libiconv2 package with binaries installed but the libiconv one with dev things is not.

Because of that building our libiconv spkg fails because it uses the system libintl which points to libiconv files provided in the dev libiconv package (and not the libiconv2).

Maybe the easiest solution is to prereq the installation of the dev libiconv package, but we can also go by passing --disable-nls to configure.

Use spkg at
http://boxen.math.washington.edu/home/jpflori/iconv-1.13.1.p4.spkg

(I'll investigate in a follow-up ticket if building our own libiconv is actually needed on Cygwin nowadays.)

**CC:**  @kcrisman

**Keywords:** cygwin iconv spkg

**Reviewer:** Jeroen Demeyer

**Author:** Jean-Pierre Flori

**Merged:** sage-5.7.beta0

Issue created by migration from https://trac.sagemath.org/ticket/13912





---

archive/issue_events_165577.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-05T14:22:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165577"
}
```



---

archive/issue_events_165578.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-05T14:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "08517b",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165578"
}
```



---

archive/issue_events_165579.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-05T14:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165579"
}
```



---

archive/issue_events_165580.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-05T14:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165580"
}
```



---

archive/issue_comments_166871.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,7 @@\n \n Maybe the easiest solution is to prereq the installation of the dev libiconv package, but we can also go by passing --disable-nls to configure.\n \n+Use spkg at\n+http://boxen.math.washington.edu/home/jpflori/iconv-1.13.1.p4.spkg\n+\n (I'll investigate in a follow-up ticket if building our own libiconv is actually needed on Cygwin nowadays.)\n``````\n",
    "created_at": "2013-01-05T14:26:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166871",
    "user": "https://github.com/sagetrac-jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,7 @@
 
 Maybe the easiest solution is to prereq the installation of the dev libiconv package, but we can also go by passing --disable-nls to configure.
 
+Use spkg at
+http://boxen.math.washington.edu/home/jpflori/iconv-1.13.1.p4.spkg
+
 (I'll investigate in a follow-up ticket if building our own libiconv is actually needed on Cygwin nowadays.)
``````




---

archive/issue_events_165581.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-05T14:26:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165581"
}
```



---

archive/issue_comments_166872.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2013-01-12T22:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166872",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_165582.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165582"
}
```



---

archive/issue_events_165583.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165583"
}
```



---

archive/issue_comments_166873.json:
```json
{
    "body": "<a id='comment:2'></a>\nI cannot test on Cygwin, but I assumes this solves your problem.  Anyway, the patch itself looks good.",
    "created_at": "2013-01-12T22:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166873",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
I cannot test on Cygwin, but I assumes this solves your problem.  Anyway, the patch itself looks good.



---

archive/issue_events_165584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165584"
}
```



---

archive/issue_events_165585.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165585"
}
```



---

archive/issue_comments_166874.json:
```json
{
    "body": "<a id='comment:3'></a>\nHang on, isn't this a typo:\n\n```\nCYGGWIN\n```",
    "created_at": "2013-01-12T22:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166874",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Hang on, isn't this a typo:

```
CYGGWIN
```



---

archive/issue_events_165586.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165586"
}
```



---

archive/issue_events_165587.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T22:03:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165587"
}
```



---

archive/issue_comments_166875.json:
```json
{
    "body": "<a id='comment:4'></a>\nAlso, the URL gives `403 Forbidden`",
    "created_at": "2013-01-12T22:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166875",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Also, the URL gives `403 Forbidden`



---

archive/issue_comments_166876.json:
```json
{
    "body": "<a id='comment:5'></a>\nIndeed, I'll fix both issues.",
    "created_at": "2013-01-13T13:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166876",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:5'></a>
Indeed, I'll fix both issues.



---

archive/issue_comments_166877.json:
```json
{
    "body": "**Attachment:** [iconv-1.13.1.p4.diff.gz](https://github.com/sagemath/sage/files/ticket13912/iconv-1.13.1.p4.diff.gz)\n\nSpkg diff, for review only.",
    "created_at": "2013-01-13T13:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166877",
    "user": "https://github.com/sagetrac-jpflori"
}
```

**Attachment:** [iconv-1.13.1.p4.diff.gz](https://github.com/sagemath/sage/files/ticket13912/iconv-1.13.1.p4.diff.gz)

Spkg diff, for review only.



---

archive/issue_comments_166878.json:
```json
{
    "body": "<a id='comment:6'></a>\nDone, diff and spkg updated.",
    "created_at": "2013-01-13T13:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166878",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:6'></a>
Done, diff and spkg updated.



---

archive/issue_events_165588.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-13T13:37:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165588"
}
```



---

archive/issue_events_165589.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-01-13T13:37:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165589"
}
```



---

archive/issue_comments_166879.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt will take me too long at this point of the semester to be able to check whether this is necessary to review it, but it would be nice if you could post a link to exactly what this change does in the configuration and why it works; otherwise Jeroen's review is fine with me.",
    "created_at": "2013-01-14T14:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166879",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
It will take me too long at this point of the semester to be able to check whether this is necessary to review it, but it would be nice if you could post a link to exactly what this change does in the configuration and why it works; otherwise Jeroen's review is fine with me.



---

archive/issue_comments_166880.json:
```json
{
    "body": "<a id='comment:8'></a>\nBasically this just adds --disable-nls (we don't use nls anyway) to configure so that we don't link against libintl which would imply to install the ... libiconv devel package.\nSo I think disabling nls is more proper.",
    "created_at": "2013-01-14T14:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166880",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:8'></a>
Basically this just adds --disable-nls (we don't use nls anyway) to configure so that we don't link against libintl which would imply to install the ... libiconv devel package.
So I think disabling nls is more proper.



---

archive/issue_events_165590.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-14T16:58:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165590"
}
```



---

archive/issue_events_165591.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-14T16:58:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165591"
}
```



---

archive/issue_comments_166881.json:
```json
{
    "body": "<a id='comment:9'></a>\nOkay, I just don't know what nls is, which is what I was really asking.  After a significant amount of searching, I found [this](https://github.com/pierrezurek/iconv/blob/master/ABOUT-NLS) which explained it, and I definitely agree that we don't need internationalization - well, not at this time, though it would be awesome and amazing if someone somehow internationalized all of Sage.  Which sounds like a **very** large job.",
    "created_at": "2013-01-14T16:58:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166881",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Okay, I just don't know what nls is, which is what I was really asking.  After a significant amount of searching, I found [this](https://github.com/pierrezurek/iconv/blob/master/ABOUT-NLS) which explained it, and I definitely agree that we don't need internationalization - well, not at this time, though it would be awesome and amazing if someone somehow internationalized all of Sage.  Which sounds like a **very** large job.



---

archive/issue_events_165592.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:09:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165592"
}
```



---

archive/issue_events_165593.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:09:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13912#event-165593"
}
```



---

archive/issue_comments_166882.json:
```json
{
    "body": "**Merged:** sage-5.7.beta0",
    "created_at": "2013-01-21T21:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166882",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.7.beta0



---

archive/issue_comments_166883.json:
```json
{
    "body": "<a id='comment:11'></a>\nI don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...",
    "created_at": "2013-01-31T15:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...



---

archive/issue_comments_166884.json:
```json
{
    "body": "<a id='comment:12'></a>\nI'd like to reopen this ticket. The same issue as here applies to the rest of Sage packages that create dlls with names clashing with dlls from Cygwin packages (or perhaps other ones). Creating a dll which has the same name as a Cygwin dll is asking for **big** trouble. \nYou might read on for details [here in this long thread](http://cygwin.com/ml/cygwin/2000-08/msg01128.html). \n\nIn a nutshell, Windows is so dump that an application request to load a dll  with a certain name is handled by searching certain sub-directories, in certain order. (Some of these subdirectories are actually specifies in Windows registry). In some cases the order of sub-directores in the PATH matters. I.e. when you link to a dlls, no full path information on the dll is stored.\nAll you have is the PATH, registry entries, and few other things like current directory, to play with.",
    "created_at": "2013-02-01T12:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166884",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
I'd like to reopen this ticket. The same issue as here applies to the rest of Sage packages that create dlls with names clashing with dlls from Cygwin packages (or perhaps other ones). Creating a dll which has the same name as a Cygwin dll is asking for **big** trouble. 
You might read on for details [here in this long thread](http://cygwin.com/ml/cygwin/2000-08/msg01128.html). 

In a nutshell, Windows is so dump that an application request to load a dll  with a certain name is handled by searching certain sub-directories, in certain order. (Some of these subdirectories are actually specifies in Windows registry). In some cases the order of sub-directores in the PATH matters. I.e. when you link to a dlls, no full path information on the dll is stored.
All you have is the PATH, registry entries, and few other things like current directory, to play with.



---

archive/issue_comments_166885.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@dimpase](#comment%3A12):\n> I'd like to reopen this ticket.\n\nYou mean unmerge it?",
    "created_at": "2013-02-01T13:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166885",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [@dimpase](#comment%3A12):
> I'd like to reopen this ticket.

You mean unmerge it?



---

archive/issue_comments_166886.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@jdemeyer](#comment%3A13):\n> Replying to [@dimpase](#comment%3A12):\n> > I'd like to reopen this ticket.\n\n> You mean unmerge it?\n\nIt probably does not matter too much, whether it is unmerged immediately or not, as there are more tickets like this. It's the whole Cygwin port strategy that needs to be re-evaluated. \n\nBy the way, a typical symptom of this problem, dll name clash, is a Cygwin fork failure...",
    "created_at": "2013-02-01T13:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166886",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [@jdemeyer](#comment%3A13):
> Replying to [@dimpase](#comment%3A12):
> > I'd like to reopen this ticket.

> You mean unmerge it?

It probably does not matter too much, whether it is unmerged immediately or not, as there are more tickets like this. It's the whole Cygwin port strategy that needs to be re-evaluated. 

By the way, a typical symptom of this problem, dll name clash, is a Cygwin fork failure...



---

archive/issue_comments_166887.json:
```json
{
    "body": "<a id='comment:15'></a>\nIn other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?",
    "created_at": "2013-02-01T14:02:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166887",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?



---

archive/issue_comments_166888.json:
```json
{
    "body": "<a id='comment:16'></a>\n> I don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...\n\nThis could also be the problem I start encountering after a while...",
    "created_at": "2013-02-01T14:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166888",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
> I don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...

This could also be the problem I start encountering after a while...



---

archive/issue_comments_166889.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@kcrisman](#comment%3A15):\n> In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?\n\nthis would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. \n\nAnother way is to take more care with PATH contents, although this would require a better understanding of the issue, and in particular how rebaseall affects this (and whether rebaseall can handle this). There is a certain database of Cygwin dlls maintained by rebase/rebaseall (as I gather from e.g. [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html)), and we need to understand what is stored there etc. Our situation reminds me of the one discussed [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html), but I don't understand the details. Note that there are lots of dlls that are produced on the fly when building `Python/Cython` extensions, and these can potentially create dll name conflicts.\n\nWe can also considering a special dll naming scheme. E.g. we can give all the dlls produced by Sage a certain prefix, e.g. \"sagecyg\", just as Cygwin's dlls all get prefix \"cyg\"  (much more work, but it looks like a really watertight way to deal with this). \n\nThe biggest problem now seems that we don't (at least I don't) have a good understanding how Windows loader, Cygwin rebase package (and that mysterios to me database), and Cygwin itself work together with dlls and where exactly the name clashes problem can hit.\n\nA related unanswered question is whether the 32-bit emulation on 64-bit Windows systems in the only environment in which Sage can be made to reliably work with the present Cygwin. (Leaving ancient Windows versions like XP alone).\nMy understanding is that in this case the address space available for Cygwin dlls is much bigger than on \"proper\" 32-bit systems, and this is very important for Sage, which has a huge requirement for such a space, if a static non-overlapping memory layout for dlls is required for proper functioning.",
    "created_at": "2013-02-01T17:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166889",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Replying to [@kcrisman](#comment%3A15):
> In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?

this would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. 

Another way is to take more care with PATH contents, although this would require a better understanding of the issue, and in particular how rebaseall affects this (and whether rebaseall can handle this). There is a certain database of Cygwin dlls maintained by rebase/rebaseall (as I gather from e.g. [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html)), and we need to understand what is stored there etc. Our situation reminds me of the one discussed [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html), but I don't understand the details. Note that there are lots of dlls that are produced on the fly when building `Python/Cython` extensions, and these can potentially create dll name conflicts.

We can also considering a special dll naming scheme. E.g. we can give all the dlls produced by Sage a certain prefix, e.g. "sagecyg", just as Cygwin's dlls all get prefix "cyg"  (much more work, but it looks like a really watertight way to deal with this). 

The biggest problem now seems that we don't (at least I don't) have a good understanding how Windows loader, Cygwin rebase package (and that mysterios to me database), and Cygwin itself work together with dlls and where exactly the name clashes problem can hit.

A related unanswered question is whether the 32-bit emulation on 64-bit Windows systems in the only environment in which Sage can be made to reliably work with the present Cygwin. (Leaving ancient Windows versions like XP alone).
My understanding is that in this case the address space available for Cygwin dlls is much bigger than on "proper" 32-bit systems, and this is very important for Sage, which has a huge requirement for such a space, if a static non-overlapping memory layout for dlls is required for proper functioning.



---

archive/issue_comments_166890.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@dimpase](#comment%3A12):\n> I'd like to reopen this ticket. The same issue as here applies to the rest of Sage packages that create dlls with names clashing with dlls from Cygwin packages (or perhaps other ones). Creating a dll which has the same name as a Cygwin dll is asking for **big** trouble. \n> You might read on for details [here in this long thread](http://cygwin.com/ml/cygwin/2000-08/msg01128.html). \n> \n> In a nutshell, Windows is so dump that an application request to load a dll  with a certain name is handled by searching certain sub-directories, in certain order. (Some of these subdirectories are actually specifies in Windows registry). In some cases the order of sub-directores in the PATH matters. I.e. when you link to a dlls, no full path information on the dll is stored.\n> All you have is the PATH, registry entries, and few other things like current directory, to play with.\n> \n\nI'm aware of this problem, but I think you're being a little dramatic here.\nIn some cases it is indeed really tricky, e.g. the ecl.dll of the Sage library resolved linking to the ecl library (whose dll name was ecl.dll before some ticket here) to ... itself.\nThat's indeed really dumb and in such a case I don't think tweaking PATH can change anything because the current directory will always come first.\n\nAnd I think that on linux we still have libraries without RPATH so that LD_LIBRARY_PATH is used and that's not that worse than the situation on windows.",
    "created_at": "2013-02-04T10:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166890",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:18'></a>
Replying to [@dimpase](#comment%3A12):
> I'd like to reopen this ticket. The same issue as here applies to the rest of Sage packages that create dlls with names clashing with dlls from Cygwin packages (or perhaps other ones). Creating a dll which has the same name as a Cygwin dll is asking for **big** trouble. 
> You might read on for details [here in this long thread](http://cygwin.com/ml/cygwin/2000-08/msg01128.html). 
> 
> In a nutshell, Windows is so dump that an application request to load a dll  with a certain name is handled by searching certain sub-directories, in certain order. (Some of these subdirectories are actually specifies in Windows registry). In some cases the order of sub-directores in the PATH matters. I.e. when you link to a dlls, no full path information on the dll is stored.
> All you have is the PATH, registry entries, and few other things like current directory, to play with.
> 

I'm aware of this problem, but I think you're being a little dramatic here.
In some cases it is indeed really tricky, e.g. the ecl.dll of the Sage library resolved linking to the ecl library (whose dll name was ecl.dll before some ticket here) to ... itself.
That's indeed really dumb and in such a case I don't think tweaking PATH can change anything because the current directory will always come first.

And I think that on linux we still have libraries without RPATH so that LD_LIBRARY_PATH is used and that's not that worse than the situation on windows.



---

archive/issue_comments_166891.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@kcrisman](#comment%3A16):\n> > I don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...\n\n> This could also be the problem I start encountering after a while...\n\nEven on my seemingly lucky install, when I do install and reinstall too much things reabsing can go crazy and everything get useless and mined by fork errors, but I really fear its only a name clash issue, that just the forking hell which is clearly described on Cygwin pages.",
    "created_at": "2013-02-04T10:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166891",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:19'></a>
Replying to [@kcrisman](#comment%3A16):
> > I don't know why it only hit at beta1, not beta0, but rebasing has kind of destroyed my cygwin install, as now even bash breaks with fork errors at libiconv*.dll. My only guess it could be several instances of dlls with the same name...

> This could also be the problem I start encountering after a while...

Even on my seemingly lucky install, when I do install and reinstall too much things reabsing can go crazy and everything get useless and mined by fork errors, but I really fear its only a name clash issue, that just the forking hell which is clearly described on Cygwin pages.



---

archive/issue_comments_166892.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [@dimpase](#comment%3A17):\n> Replying to [@kcrisman](#comment%3A15):\n> > In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?\n\n> \n> this would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. \n> \n\nI don't think name clash is the main issue.\n> Another way is to take more care with PATH contents, although this would require a better understanding of the issue, and in particular how rebaseall affects this (and whether rebaseall can handle this). There is a certain database of Cygwin dlls maintained by rebase/rebaseall (as I gather from e.g. [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html)), and we need to understand what is stored there etc. Our situation reminds me of the one discussed [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html), but I don't understand the details. Note that there are lots of dlls that are produced on the fly when building `Python/Cython` extensions, and these can potentially create dll name conflicts.\n\nOur PATH looks pretty sane now, we look first in the Sage directories where the libraries we linked to are installed.\n\nI think the problem of forking, address clash issues, arises with or without name clashes.\nThe last one I got where caused by libraries with so creepy names (random numbers and strange case) that I doubt we were colliding with the Cygwin namespace.\nIt was rather that the addressing sapce was full and the hackish rebasing process failed.\n\nI also encountered such situations when I was tweaking max heap memory with peflags to let PARI's doctests pass.\nIf I allocated too much memory to the python process, then loading Sage failed with forking errors, and putting it back down to the default value let Sage start again (and the doctests fail :)) without any other intervention.\n> \n> We can also considering a special dll naming scheme. E.g. we can give all the dlls produced by Sage a certain prefix, e.g. \"sagecyg\", just as Cygwin's dlls all get prefix \"cyg\"  (much more work, but it looks like a really watertight way to deal with this). \n> \n> The biggest problem now seems that we don't (at least I don't) have a good understanding how Windows loader, Cygwin rebase package (and that mysterios to me database), and Cygwin itself work together with dlls and where exactly the name clashes problem can hit.\n\nYep, that would make things easier hopefully.\n> \n> A related unanswered question is whether the 32-bit emulation on 64-bit Windows systems in the only environment in which Sage can be made to reliably work with the present Cygwin. (Leaving ancient Windows versions like XP alone).\n\nI don't really get what you're thinking about.\nYou mean running a 32 bits Windows?\nIf you have a virtual machine in mind then a virtual Linux is the way to go.\n> My understanding is that in this case the address space available for Cygwin dlls is much bigger than on \"proper\" 32-bit systems, and this is very important for Sage, which has a huge requirement for such a space, if a static non-overlapping memory layout for dlls is required for proper functioning.",
    "created_at": "2013-02-04T10:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166892",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:20'></a>
Replying to [@dimpase](#comment%3A17):
> Replying to [@kcrisman](#comment%3A15):
> > In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?

> 
> this would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. 
> 

I don't think name clash is the main issue.
> Another way is to take more care with PATH contents, although this would require a better understanding of the issue, and in particular how rebaseall affects this (and whether rebaseall can handle this). There is a certain database of Cygwin dlls maintained by rebase/rebaseall (as I gather from e.g. [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html)), and we need to understand what is stored there etc. Our situation reminds me of the one discussed [here](http://cygwin.com/ml/cygwin-apps/2012-06/msg00062.html), but I don't understand the details. Note that there are lots of dlls that are produced on the fly when building `Python/Cython` extensions, and these can potentially create dll name conflicts.

Our PATH looks pretty sane now, we look first in the Sage directories where the libraries we linked to are installed.

I think the problem of forking, address clash issues, arises with or without name clashes.
The last one I got where caused by libraries with so creepy names (random numbers and strange case) that I doubt we were colliding with the Cygwin namespace.
It was rather that the addressing sapce was full and the hackish rebasing process failed.

I also encountered such situations when I was tweaking max heap memory with peflags to let PARI's doctests pass.
If I allocated too much memory to the python process, then loading Sage failed with forking errors, and putting it back down to the default value let Sage start again (and the doctests fail :)) without any other intervention.
> 
> We can also considering a special dll naming scheme. E.g. we can give all the dlls produced by Sage a certain prefix, e.g. "sagecyg", just as Cygwin's dlls all get prefix "cyg"  (much more work, but it looks like a really watertight way to deal with this). 
> 
> The biggest problem now seems that we don't (at least I don't) have a good understanding how Windows loader, Cygwin rebase package (and that mysterios to me database), and Cygwin itself work together with dlls and where exactly the name clashes problem can hit.

Yep, that would make things easier hopefully.
> 
> A related unanswered question is whether the 32-bit emulation on 64-bit Windows systems in the only environment in which Sage can be made to reliably work with the present Cygwin. (Leaving ancient Windows versions like XP alone).

I don't really get what you're thinking about.
You mean running a 32 bits Windows?
If you have a virtual machine in mind then a virtual Linux is the way to go.
> My understanding is that in this case the address space available for Cygwin dlls is much bigger than on "proper" 32-bit systems, and this is very important for Sage, which has a huge requirement for such a space, if a static non-overlapping memory layout for dlls is required for proper functioning.



---

archive/issue_comments_166893.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jpflori](#comment%3A20):\n> Replying to [@dimpase](#comment%3A17):\n> > Replying to [@kcrisman](#comment%3A15):\n> > > In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?\n\n> > \n> > this would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. \n> > \n\n> I don't think name clash is the main issue.\n\nAn alternative theory is that my Cygwin install got nuked as I did not remove the previously built version of Sage, and the address space for the Cygwin dlls was not able to accommodate that much (my Cygwin install is almost full, I think).\n\nSo  I have removed /etc/rebase* database files and the previous Sage installs, and after re-running cygwin setup I was able to run rebaseall without errors.\nNow buiding the latest beta, will see how far I get this time.",
    "created_at": "2013-02-04T14:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13912#issuecomment-166893",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Replying to [jpflori](#comment%3A20):
> Replying to [@dimpase](#comment%3A17):
> > Replying to [@kcrisman](#comment%3A15):
> > > In other words, we should go for maximal Cygwin packages (more like Sage-on-Gentoo) and not minimal (like the usual Sage Linux Distro)?

> > 
> > this would be the most obvious solution to this, although not the only one possible; and actually it's not quite a solution, as Sage still has to include some dlls which can potentially conflict with ones from Cygwin, e.g. Singular and ECL are available as Cygwin packages, and there could (potentially) be naming clashes. 
> > 

> I don't think name clash is the main issue.

An alternative theory is that my Cygwin install got nuked as I did not remove the previously built version of Sage, and the address space for the Cygwin dlls was not able to accommodate that much (my Cygwin install is almost full, I think).

So  I have removed /etc/rebase* database files and the previous Sage installs, and after re-running cygwin setup I was able to run rebaseall without errors.
Now buiding the latest beta, will see how far I get this time.
