# Issue 13147: Delay the evaluation of SAGE_TMP in order to facilitate forking in doctesting

archive/issues_012975.json:
```json
{
    "assignees": [],
    "body": "In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n\n**Apply** \n* [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).\n\n\nDepends on #13579\n\nDepends on #13681\n\n**Assignee:** mvngu\n\n**CC:**  @mwhansen\n\n**Reviewer:** John Palmieri\n\n**Author:** David Roe, Mike Hansen\n\n**Merged:** sage-5.5.beta1\n\nIssue created by migration from https://trac.sagemath.org/ticket/13147\n\n",
    "closed_at": "2012-11-12T21:57:16Z",
    "created_at": "2012-06-21T05:36:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Delay the evaluation of SAGE_TMP in order to facilitate forking in doctesting",
    "type": "issue",
    "updated_at": "2012-11-12T21:57:16Z",
    "url": "https://github.com/sagemath/sage/issues/13147",
    "user": "https://github.com/roed314"
}
```
In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.

**Apply** 
* [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).


Depends on #13579

Depends on #13681

**Assignee:** mvngu

**CC:**  @mwhansen

**Reviewer:** John Palmieri

**Author:** David Roe, Mike Hansen

**Merged:** sage-5.5.beta1

Issue created by migration from https://trac.sagemath.org/ticket/13147





---

archive/issue_comments_152890.json:
```json
{
    "body": "**Attachment:** [13147_move.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_move.patch.gz)\n\nDavid Roe/Robert Bradshaw's original solution: I don't like it as much as Mike's",
    "created_at": "2012-06-21T05:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152890",
    "user": "https://github.com/roed314"
}
```

**Attachment:** [13147_move.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_move.patch.gz)

David Roe/Robert Bradshaw's original solution: I don't like it as much as Mike's



---

archive/issue_comments_152891.json:
```json
{
    "body": "<a id='comment:1'></a>\nI like Mike's solution a lot more, but it requires speaklater.  I think this is in the new flasque notebook?  Can we use it from there?",
    "created_at": "2012-06-21T05:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152891",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>
I like Mike's solution a lot more, but it requires speaklater.  I think this is in the new flasque notebook?  Can we use it from there?



---

archive/issue_events_110871.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-06-21T05:38:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110871"
}
```



---

archive/issue_comments_152892.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n+\n+Apply [attachment:13147_lazy.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.)\n``````\n",
    "created_at": "2012-06-21T05:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152892",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
+
+Apply [attachment:13147_lazy.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.)
``````




---

archive/issue_comments_152893.json:
```json
{
    "body": "<a id='comment:4'></a>\n+1 for Mike's solution, I know nothing about the flask notebook, but we certainly shouldn't include speaklater in the manner it is done in the patch.\n\nAlso, why are we using temp files and directories in `DOT_SAGE` still, I see no reason to not use the tempfile module with Mike's patch.",
    "created_at": "2012-06-21T06:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152893",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>
+1 for Mike's solution, I know nothing about the flask notebook, but we certainly shouldn't include speaklater in the manner it is done in the patch.

Also, why are we using temp files and directories in `DOT_SAGE` still, I see no reason to not use the tempfile module with Mike's patch.



---

archive/issue_comments_152894.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhile you're rewriting the definition of `SAGE_TMP`, you should change lines like\n\n```\nd = '%s/temp/%s/%s/'%(DOT_SAGE, HOSTNAME, os.getpid()) \n```\nto use `os.path.join`.",
    "created_at": "2012-06-21T14:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152894",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
While you're rewriting the definition of `SAGE_TMP`, you should change lines like

```
d = '%s/temp/%s/%s/'%(DOT_SAGE, HOSTNAME, os.getpid()) 
```
to use `os.path.join`.



---

archive/issue_comments_152895.json:
```json
{
    "body": "**Attachment:** [13147_lazy.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.gz)\n\nMike Hansen's solution",
    "created_at": "2012-06-21T18:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152895",
    "user": "https://github.com/roed314"
}
```

**Attachment:** [13147_lazy.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.gz)

Mike Hansen's solution



---

archive/issue_comments_152896.json:
```json
{
    "body": "<a id='comment:6'></a>\nAndrew, are you referring to the fact that Mike creates speaklater.py in the Sage library?",
    "created_at": "2012-06-22T01:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152896",
    "user": "https://github.com/kini"
}
```

<a id='comment:6'></a>
Andrew, are you referring to the fact that Mike creates speaklater.py in the Sage library?



---

archive/issue_comments_152897.json:
```json
{
    "body": "<a id='comment:7'></a>\nYeah, I think Andrew's referring to the fact that Mike just included speaklater.\n\npatchbot: apply 13147_lazy.patch.",
    "created_at": "2012-06-22T02:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152897",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
Yeah, I think Andrew's referring to the fact that Mike just included speaklater.

patchbot: apply 13147_lazy.patch.



---

archive/issue_comments_152898.json:
```json
{
    "body": "<a id='comment:8'></a>\npatchbot: apply 13147_lazy.patch",
    "created_at": "2012-06-22T02:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152898",
    "user": "https://github.com/kini"
}
```

<a id='comment:8'></a>
patchbot: apply 13147_lazy.patch



---

archive/issue_comments_152899.json:
```json
{
    "body": "<a id='comment:9'></a>\n`sage/misc/speaklater.py` has no documentation *at all*.\n\nWhy the name `speaklater` and not `lazy_string` (or whatever)?",
    "created_at": "2012-06-25T10:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152899",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
`sage/misc/speaklater.py` has no documentation *at all*.

Why the name `speaklater` and not `lazy_string` (or whatever)?



---

archive/issue_events_110872.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-25T10:21:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110872"
}
```



---

archive/issue_events_110873.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-25T10:21:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110873"
}
```



---

archive/issue_comments_152900.json:
```json
{
    "body": "<a id='comment:10'></a>\nBecause it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater). Obviously we should just depend on speaklater and not incorporate it into the Sage library.",
    "created_at": "2012-06-25T10:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152900",
    "user": "https://github.com/kini"
}
```

<a id='comment:10'></a>
Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater). Obviously we should just depend on speaklater and not incorporate it into the Sage library.



---

archive/issue_comments_152901.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [@kini](#comment%3A10):\n> Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater).\n\nAt the very least, document this fact in the file `speaklater.py`.  Also, you should credit the author and specify the license.",
    "created_at": "2012-06-25T11:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152901",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [@kini](#comment%3A10):
> Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater).

At the very least, document this fact in the file `speaklater.py`.  Also, you should credit the author and specify the license.



---

archive/issue_comments_152902.json:
```json
{
    "body": "<a id='comment:12'></a>\nWhen I wrote that patch, including the speaklater code was just something to get things as a proof of concept.  I didn't think that that code would ever try to go in as is.",
    "created_at": "2012-06-25T12:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152902",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:12'></a>
When I wrote that patch, including the speaklater code was just something to get things as a proof of concept.  I didn't think that that code would ever try to go in as is.



---

archive/issue_comments_152903.json:
```json
{
    "body": "<a id='comment:13'></a>\nIsn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.",
    "created_at": "2012-06-25T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152903",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.



---

archive/issue_comments_152904.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@jhpalmieri](#comment%3A13):\n> Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.\n\nI think it's philosophically wrong to make Sage depend on the Sage Notebook.  Since it's a small file, I don't mind the duplication much.",
    "created_at": "2012-06-25T15:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152904",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [@jhpalmieri](#comment%3A13):
> Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.

I think it's philosophically wrong to make Sage depend on the Sage Notebook.  Since it's a small file, I don't mind the duplication much.



---

archive/issue_comments_152905.json:
```json
{
    "body": "<a id='comment:15'></a>\nI think it's philosophically wrong for the Sage notebook to depend on Sage: that's the whole point of the notebook project. But Sage can and should depend on its various component packages, so I don't see anything wrong with Sage depending on files included in the sagenb spkg.  But maybe I'm misunderstanding your point.",
    "created_at": "2012-06-25T16:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152905",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
I think it's philosophically wrong for the Sage notebook to depend on Sage: that's the whole point of the notebook project. But Sage can and should depend on its various component packages, so I don't see anything wrong with Sage depending on files included in the sagenb spkg.  But maybe I'm misunderstanding your point.



---

archive/issue_comments_152906.json:
```json
{
    "body": "<a id='comment:16'></a>\nOkay, I think it's wrong to depend on the Sage Notebook for stuff which isn't notebook-related.\n\nI also don't think that `speaklater` should be included in the `sagenb` spkg.  Technically, it probably should be a separate spkg, but that seems way overkill given that it's essentially one small file.",
    "created_at": "2012-06-25T16:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152906",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Okay, I think it's wrong to depend on the Sage Notebook for stuff which isn't notebook-related.

I also don't think that `speaklater` should be included in the `sagenb` spkg.  Technically, it probably should be a separate spkg, but that seems way overkill given that it's essentially one small file.



---

archive/issue_comments_152907.json:
```json
{
    "body": "<a id='comment:17'></a>\nI don't think the sagenb spkg should contain a bunch of tarballs either. I think we should start using the package management system from lmonade and steal Gentoo's ebuilds for most of our packages, so there will be very minimal effort required to package additional pieces of software (such as speaklater) for Sage. But that is far off, I guess. At least it will need to be after we drop SPKGs and complete #13015.",
    "created_at": "2012-06-25T18:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152907",
    "user": "https://github.com/kini"
}
```

<a id='comment:17'></a>
I don't think the sagenb spkg should contain a bunch of tarballs either. I think we should start using the package management system from lmonade and steal Gentoo's ebuilds for most of our packages, so there will be very minimal effort required to package additional pieces of software (such as speaklater) for Sage. But that is far off, I guess. At least it will need to be after we drop SPKGs and complete #13015.



---

archive/issue_comments_152908.json:
```json
{
    "body": "<a id='comment:18'></a>\nSo what's the plan for this ticket?  The options seem to be:\n\n1. Include speaklater.py with no doctests; include attribution and license.\n2. Include speaklater.py with doctests (I'm not going to write them...); include attribution and license.\n3. Depend on #11080 and import speaklater from sagenb\n4. Make an spkg.\n5. Write a simplified lazy string with doctests.\n\nI think my vote would be for 3.",
    "created_at": "2012-06-28T08:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152908",
    "user": "https://github.com/roed314"
}
```

<a id='comment:18'></a>
So what's the plan for this ticket?  The options seem to be:

1. Include speaklater.py with no doctests; include attribution and license.
2. Include speaklater.py with doctests (I'm not going to write them...); include attribution and license.
3. Depend on #11080 and import speaklater from sagenb
4. Make an spkg.
5. Write a simplified lazy string with doctests.

I think my vote would be for 3.



---

archive/issue_comments_152909.json:
```json
{
    "body": "<a id='comment:19'></a>\nI vote for 1.",
    "created_at": "2012-06-28T08:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152909",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I vote for 1.



---

archive/issue_comments_152910.json:
```json
{
    "body": "<a id='comment:20'></a>\nI vote for 4.",
    "created_at": "2012-06-28T09:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152910",
    "user": "https://github.com/kini"
}
```

<a id='comment:20'></a>
I vote for 4.



---

archive/issue_comments_152911.json:
```json
{
    "body": "<a id='comment:21'></a>\nHere's an SPKG: http://wstein.org/home/keshav/files/speaklater-1.2-fbc7a37.spkg",
    "created_at": "2012-06-28T09:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152911",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'></a>
Here's an SPKG: http://wstein.org/home/keshav/files/speaklater-1.2-fbc7a37.spkg



---

archive/issue_comments_152912.json:
```json
{
    "body": "<a id='comment:22'></a>\nI also vote for the spkg. The one Keshav provided looks fine.",
    "created_at": "2012-06-29T07:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152912",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:22'></a>
I also vote for the spkg. The one Keshav provided looks fine.



---

archive/issue_comments_152913.json:
```json
{
    "body": "**Attachment:** [13147_lazy_spkg.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_lazy_spkg.patch.gz)\n\nLazy string solution for use with spkg",
    "created_at": "2012-06-29T07:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152913",
    "user": "https://github.com/ohanar"
}
```

**Attachment:** [13147_lazy_spkg.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_lazy_spkg.patch.gz)

Lazy string solution for use with spkg



---

archive/issue_comments_152914.json:
```json
{
    "body": "<a id='comment:23'></a>\nWe should also patch deps since this would become a standard SPKG.",
    "created_at": "2012-06-29T08:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152914",
    "user": "https://github.com/kini"
}
```

<a id='comment:23'></a>
We should also patch deps since this would become a standard SPKG.



---

archive/issue_comments_152915.json:
```json
{
    "body": "<a id='comment:24'></a>\nWe also need a vote on sage-devel for the inclusion of speaklater as a standard spkg.  I'm a bit concerned that we'll get objections since\n\n* speaklater has no doctests\n* we haven't made it an optional package first\n* we're adding another dependency of sage\n\nBut I'm happy to be proved wrong.  Keshav and Andrew, do one of you want to write an e-mail to sage-devel or should I?",
    "created_at": "2012-07-03T07:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152915",
    "user": "https://github.com/roed314"
}
```

<a id='comment:24'></a>
We also need a vote on sage-devel for the inclusion of speaklater as a standard spkg.  I'm a bit concerned that we'll get objections since

* speaklater has no doctests
* we haven't made it an optional package first
* we're adding another dependency of sage

But I'm happy to be proved wrong.  Keshav and Andrew, do one of you want to write an e-mail to sage-devel or should I?



---

archive/issue_comments_152916.json:
```json
{
    "body": "<a id='comment:25'></a>\n* Upstream source is not required to have doctests.\n  * speaklater was already included in the flask notebook, so we're really just moving it into its own spkg.\n\nSo I don't think it should be a big deal.",
    "created_at": "2012-07-03T17:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152916",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
* Upstream source is not required to have doctests.
  * speaklater was already included in the flask notebook, so we're really just moving it into its own spkg.

So I don't think it should be a big deal.



---

archive/issue_comments_152917.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@roed314](#comment%3A24):\n> * speaklater has no doctests\n\nNot required, as John said.\n\n> * we haven't made it an optional package first\n\nNot really a big deal I think\n\n> * we're adding another dependency of sage\n\nNo we're not - we're including another package in Sage.\n\nBy the way, I asked the author of speaklater on IRC to release a new version containing the fix for the pickling problem we ran across in sagenb many months ago, and a couple of days ago he seems to have released 1.3, so here's a new SPKG: http://wstein.org/home/keshav/files/speaklater-1.3.spkg",
    "created_at": "2012-07-04T03:12:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152917",
    "user": "https://github.com/kini"
}
```

<a id='comment:26'></a>
Replying to [@roed314](#comment%3A24):
> * speaklater has no doctests

Not required, as John said.

> * we haven't made it an optional package first

Not really a big deal I think

> * we're adding another dependency of sage

No we're not - we're including another package in Sage.

By the way, I asked the author of speaklater on IRC to release a new version containing the fix for the pickling problem we ran across in sagenb many months ago, and a couple of days ago he seems to have released 1.3, so here's a new SPKG: http://wstein.org/home/keshav/files/speaklater-1.3.spkg



---

archive/issue_comments_152918.json:
```json
{
    "body": "<a id='comment:27'></a>\nOops, forgot to update SPKG.txt - done now (same URL).",
    "created_at": "2012-07-04T03:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152918",
    "user": "https://github.com/kini"
}
```

<a id='comment:27'></a>
Oops, forgot to update SPKG.txt - done now (same URL).



---

archive/issue_comments_152919.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n \n-Apply [attachment:13147_lazy.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.)\n+**Apply** [attachment:13147_new.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.)\n``````\n",
    "created_at": "2012-07-12T01:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152919",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
 
-Apply [attachment:13147_lazy.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_lazy.patch.)
+**Apply** [attachment:13147_new.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.)
``````




---

archive/issue_comments_152920.json:
```json
{
    "body": "<a id='comment:28'></a>\nGiven the opposition to speaklater as an spkg on sage-devel, I've added doctests to speaklater.py, make a couple changes and added it as sage.misc.lazy_string.\n\npatchbot: apply 13147_new.patch",
    "created_at": "2012-07-12T01:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152920",
    "user": "https://github.com/roed314"
}
```

<a id='comment:28'></a>
Given the opposition to speaklater as an spkg on sage-devel, I've added doctests to speaklater.py, make a couple changes and added it as sage.misc.lazy_string.

patchbot: apply 13147_new.patch



---

archive/issue_events_110874.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T01:22:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110874"
}
```



---

archive/issue_events_110875.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T01:22:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110875"
}
```



---

archive/issue_comments_152921.json:
```json
{
    "body": "<a id='comment:29'></a>\nMissed something; I'll fix it in a few hours.",
    "created_at": "2012-07-12T03:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152921",
    "user": "https://github.com/roed314"
}
```

<a id='comment:29'></a>
Missed something; I'll fix it in a few hours.



---

archive/issue_events_110876.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T03:40:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110876"
}
```



---

archive/issue_events_110877.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T03:40:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110877"
}
```



---

archive/issue_comments_152922.json:
```json
{
    "body": "<a id='comment:30'></a>\nAlright, fixed.",
    "created_at": "2012-07-12T07:58:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152922",
    "user": "https://github.com/roed314"
}
```

<a id='comment:30'></a>
Alright, fixed.



---

archive/issue_events_110878.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T07:58:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110878"
}
```



---

archive/issue_events_110879.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-07-12T07:58:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110879"
}
```



---

archive/issue_comments_152923.json:
```json
{
    "body": "<a id='comment:31'></a>\nLine 23 of cleaner.py:\n\n```\n    F = os.path.join(misc.SAGE_TMP, 'spawned_processes') \n```\nShould it say `str(SAGE_TMP)`?",
    "created_at": "2012-07-13T16:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152923",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>
Line 23 of cleaner.py:

```
    F = os.path.join(misc.SAGE_TMP, 'spawned_processes') 
```
Should it say `str(SAGE_TMP)`?



---

archive/issue_comments_152924.json:
```json
{
    "body": "<a id='comment:32'></a>\nI think that the file lazy_string.py should have a bit more documentation at the top, for example (from the [speaklater website](https://github.com/mitsuhiko/speaklater):\n\n```\nA module that provides lazy strings for translations. Basically you get an\nobject that appears to be a string but changes the value every time the value\nis evaluated based on a callable you provide.\n```\nA few examples would be nice, too.\n\n(Right now it looks like a typical, underdocumented, Python module (well, it's much better than this because of the doctests you added), whereas it should look like a typical, well-documented, Sage module.)",
    "created_at": "2012-07-13T16:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152924",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
I think that the file lazy_string.py should have a bit more documentation at the top, for example (from the [speaklater website](https://github.com/mitsuhiko/speaklater):

```
A module that provides lazy strings for translations. Basically you get an
object that appears to be a string but changes the value every time the value
is evaluated based on a callable you provide.
```
A few examples would be nice, too.

(Right now it looks like a typical, underdocumented, Python module (well, it's much better than this because of the doctests you added), whereas it should look like a typical, well-documented, Sage module.)



---

archive/issue_comments_152925.json:
```json
{
    "body": "<a id='comment:33'></a>\nAll gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?",
    "created_at": "2012-07-13T16:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152925",
    "user": "https://github.com/kini"
}
```

<a id='comment:33'></a>
All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?



---

archive/issue_comments_152926.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [@jhpalmieri](#comment%3A31):\n> Line 23 of cleaner.py:\n> \n> ```\n>     F = os.path.join(misc.SAGE_TMP, 'spawned_processes') \n> ```\n> Should it say `str(SAGE_TMP)`?\n\nThere was a typo in Mike's version of `speaklater.py` (`__eq__` was broken); os.path.join now works without the explicit string cast.\n\n`os.path.exists` doesn't though (and I'm not sure exactly why, since I can't find the source code of `os.stat`).",
    "created_at": "2012-07-13T18:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152926",
    "user": "https://github.com/roed314"
}
```

<a id='comment:34'></a>
Replying to [@jhpalmieri](#comment%3A31):
> Line 23 of cleaner.py:
> 
> ```
>     F = os.path.join(misc.SAGE_TMP, 'spawned_processes') 
> ```
> Should it say `str(SAGE_TMP)`?

There was a typo in Mike's version of `speaklater.py` (`__eq__` was broken); os.path.join now works without the explicit string cast.

`os.path.exists` doesn't though (and I'm not sure exactly why, since I can't find the source code of `os.stat`).



---

archive/issue_comments_152927.json:
```json
{
    "body": "<a id='comment:35'></a>\nKeshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than \"Creates a lazy string by invoking func with args\". Maybe just one more sentence like: \"A typical usage might be ...\". Maybe another sentence like: \"Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc.\"\n\nAnd this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.",
    "created_at": "2012-07-13T18:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152927",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>
Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than "Creates a lazy string by invoking func with args". Maybe just one more sentence like: "A typical usage might be ...". Maybe another sentence like: "Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc."

And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.



---

archive/issue_comments_152928.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [@kini](#comment%3A33):\n> All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?\n\nI wasn't sure what the `__gettext__` method did; it can be readded if desired.",
    "created_at": "2012-07-13T19:20:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152928",
    "user": "https://github.com/roed314"
}
```

<a id='comment:36'></a>
Replying to [@kini](#comment%3A33):
> All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?

I wasn't sure what the `__gettext__` method did; it can be readded if desired.



---

archive/issue_comments_152929.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [@jhpalmieri](#comment%3A35):\n> Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than \"Creates a lazy string by invoking func with args\". Maybe just one more sentence like: \"A typical usage might be ...\". Maybe another sentence like: \"Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc.\"\n> \n> And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.\n\nMakes sense.  I'm going to be out of communication for a few days but I can add some more documentation when I get back.  Keshav, if you want to do it before then that would be cool too.  ;-)",
    "created_at": "2012-07-13T19:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152929",
    "user": "https://github.com/roed314"
}
```

<a id='comment:37'></a>
Replying to [@jhpalmieri](#comment%3A35):
> Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than "Creates a lazy string by invoking func with args". Maybe just one more sentence like: "A typical usage might be ...". Maybe another sentence like: "Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc."
> 
> And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.

Makes sense.  I'm going to be out of communication for a few days but I can add some more documentation when I get back.  Keshav, if you want to do it before then that would be cool too.  ;-)



---

archive/issue_comments_152930.json:
```json
{
    "body": "<a id='comment:38'></a>\n(never mind)",
    "created_at": "2012-08-02T15:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152930",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
(never mind)



---

archive/issue_events_110880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-02T15:15:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110880"
}
```



---

archive/issue_events_110881.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-02T15:15:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110881"
}
```



---

archive/issue_events_110882.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-02T15:16:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110882"
}
```



---

archive/issue_events_110883.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-02T15:16:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110883"
}
```



---

archive/issue_comments_152931.json:
```json
{
    "body": "<a id='comment:40'></a>\nPing.\n\nI think this just needs a bit of work with the documentation.",
    "created_at": "2012-08-23T18:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152931",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>
Ping.

I think this just needs a bit of work with the documentation.



---

archive/issue_comments_152932.json:
```json
{
    "body": "Adds speaklater.py to sage/misc with doctests.",
    "created_at": "2012-10-17T01:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152932",
    "user": "https://github.com/roed314"
}
```

Adds speaklater.py to sage/misc with doctests.



---

archive/issue_comments_152933.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Attachment:** [13147_new.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.gz)\n\nI've rebased against 5.4.rc1 and addressed John's concerns about documentation by adding to the module's docstring.",
    "created_at": "2012-10-17T01:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152933",
    "user": "https://github.com/roed314"
}
```

<a id='comment:41'></a>
**Attachment:** [13147_new.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.gz)

I've rebased against 5.4.rc1 and addressed John's concerns about documentation by adding to the module's docstring.



---

archive/issue_comments_152934.json:
```json
{
    "body": "<a id='comment:42'></a>\nThis will likely need to be rebased to #13579.",
    "created_at": "2012-10-17T06:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152934",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
This will likely need to be rebased to #13579.



---

archive/issue_comments_152935.json:
```json
{
    "body": "**Attachment:** [13147_over_13579.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.gz)",
    "created_at": "2012-10-17T07:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152935",
    "user": "https://github.com/roed314"
}
```

**Attachment:** [13147_over_13579.patch.gz](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.gz)



---

archive/issue_comments_152936.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n \n-**Apply** [attachment:13147_new.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.)\n+**Apply** [attachment:13147_over_13579.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.)\n``````\n",
    "created_at": "2012-10-17T07:36:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152936",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
 
-**Apply** [attachment:13147_new.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_new.patch.)
+**Apply** [attachment:13147_over_13579.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.)
``````




---

archive/issue_comments_152937.json:
```json
{
    "body": "**Dependencies:** #13579",
    "created_at": "2012-10-17T07:36:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152937",
    "user": "https://github.com/roed314"
}
```

**Dependencies:** #13579



---

archive/issue_comments_152938.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n \n-**Apply** [attachment:13147_over_13579.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.)\n+**Apply** [and [attachment:trac_13147-ref.patch](https://github.com/sagemath/sage/files/ticket13147/9f48582b378b3fc5d66eff71e7312b1d.patch](https://github.com/sagemath/sage/files/ticket13147/c70287ef8bbd3db99b4096874b3365e6.patch)).\n``````\n",
    "created_at": "2012-10-18T18:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152938",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
 
-**Apply** [attachment:13147_over_13579.patch.](https://github.com/sagemath/sage/files/ticket13147/13147_over_13579.patch.)
+**Apply** [and [attachment:trac_13147-ref.patch](https://github.com/sagemath/sage/files/ticket13147/9f48582b378b3fc5d66eff71e7312b1d.patch](https://github.com/sagemath/sage/files/ticket13147/c70287ef8bbd3db99b4096874b3365e6.patch)).
``````




---

archive/issue_comments_152939.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2012-10-18T18:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152939",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_events_110884.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:29:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110884"
}
```



---

archive/issue_events_110885.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:29:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110885"
}
```



---

archive/issue_comments_152940.json:
```json
{
    "body": "<a id='comment:44'></a>\nLooks good to me now. I have attached a very small referee patch.\n\nShould Keshav be listed as an author and/or a reviewer?",
    "created_at": "2012-10-18T18:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152940",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>
Looks good to me now. I have attached a very small referee patch.

Should Keshav be listed as an author and/or a reviewer?



---

archive/issue_events_110886.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:42:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110886"
}
```



---

archive/issue_events_110887.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:42:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110887"
}
```



---

archive/issue_comments_152941.json:
```json
{
    "body": "<a id='comment:45'></a>\nWait, I'm getting some doctest failures. I have to investigate some more.",
    "created_at": "2012-10-18T18:42:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152941",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>
Wait, I'm getting some doctest failures. I have to investigate some more.



---

archive/issue_events_110888.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:42:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110888"
}
```



---

archive/issue_events_110889.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-18T18:42:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110889"
}
```



---

archive/issue_comments_152942.json:
```json
{
    "body": "<a id='comment:47'></a>\nOkay, the problem is the line\n\n```\nreturn os.path.join(SAGE_TMP, 'spyx', os.sep) \n```\nAccording to the documentation for [os.path.join](http://docs.python.org/library/os.path.html#os.path.join):\n\n    If any component is an absolute path, all previous components are thrown away, and joining continues.\n\nSo if you use os.sep (which is '/', an absolute path), everything before that is discarded. I've provided a revised referee's patch to fix this. My changes need review.",
    "created_at": "2012-10-18T20:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152942",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:47'></a>
Okay, the problem is the line

```
return os.path.join(SAGE_TMP, 'spyx', os.sep) 
```
According to the documentation for [os.path.join](http://docs.python.org/library/os.path.html#os.path.join):

    If any component is an absolute path, all previous components are thrown away, and joining continues.

So if you use os.sep (which is '/', an absolute path), everything before that is discarded. I've provided a revised referee's patch to fix this. My changes need review.



---

archive/issue_events_110890.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-10-19T20:57:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110890"
}
```



---

archive/issue_events_110891.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-10-19T20:57:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110891"
}
```



---

archive/issue_comments_152943.json:
```json
{
    "body": "<a id='comment:48'></a>\nJohn, your changes look good to me.",
    "created_at": "2012-10-19T20:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152943",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:48'></a>
John, your changes look good to me.



---

archive/issue_events_110892.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-23T07:23:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110892"
}
```



---

archive/issue_events_110893.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-23T07:23:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110893"
}
```



---

archive/issue_comments_152944.json:
```json
{
    "body": "<a id='comment:50'></a>\nHas it been verified that removing the trailing slash from SPYX_TMP and SAGE_TMP_INTERFACE doesn't change the functionality of the things using those strings?",
    "created_at": "2012-10-23T14:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152944",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>
Has it been verified that removing the trailing slash from SPYX_TMP and SAGE_TMP_INTERFACE doesn't change the functionality of the things using those strings?



---

archive/issue_events_110894.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-23T16:03:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110894"
}
```



---

archive/issue_events_110895.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-23T16:03:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110895"
}
```



---

archive/issue_events_110896.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-23T16:06:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110896"
}
```



---

archive/issue_events_110897.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-10-23T16:06:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110897"
}
```



---

archive/issue_comments_152945.json:
```json
{
    "body": "<a id='comment:52'></a>\nThe previous version passed doctests, but I see that it modified the behavior slightly because of the missing slash at the end of `SAGE_TMP_INTERFACE`. Here's a new patch. The variables `SPYX_TMP` and `SAGE_TMP_INTERFACE` are not used in local/bin or spkg/, so I think this new patch should take care of things.",
    "created_at": "2012-10-23T16:06:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152945",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>
The previous version passed doctests, but I see that it modified the behavior slightly because of the missing slash at the end of `SAGE_TMP_INTERFACE`. Here's a new patch. The variables `SPYX_TMP` and `SAGE_TMP_INTERFACE` are not used in local/bin or spkg/, so I think this new patch should take care of things.



---

archive/issue_comments_152946.json:
```json
{
    "body": "**Attachment:** [trac_13147-ref.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13147-ref.patch.gz)",
    "created_at": "2012-10-23T18:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152946",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_13147-ref.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13147-ref.patch.gz)



---

archive/issue_comments_152947.json:
```json
{
    "body": "<a id='comment:53'></a>\nThese are the only two locations that refer to `SPYX_TMP` and `SAGE_TMP_INTERFACE`.  I'm happy that removing the trailing \"/\" won't cause additional problems, though it would be nice if the patchbot would run the tests....",
    "created_at": "2012-10-24T03:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152947",
    "user": "https://github.com/roed314"
}
```

<a id='comment:53'></a>
These are the only two locations that refer to `SPYX_TMP` and `SAGE_TMP_INTERFACE`.  I'm happy that removing the trailing "/" won't cause additional problems, though it would be nice if the patchbot would run the tests....



---

archive/issue_events_110898.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110898"
}
```



---

archive/issue_events_110899.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110899"
}
```



---

archive/issue_events_110900.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110900"
}
```



---

archive/issue_events_110901.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110901"
}
```



---

archive/issue_events_110902.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T04:22:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110902"
}
```



---

archive/issue_events_110903.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T04:22:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "milestone_number": null,
    "milestone_title": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110903"
}
```



---

archive/issue_comments_152948.json:
```json
{
    "body": "**Merged:** sage-5.5.beta1",
    "created_at": "2012-11-01T12:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152948",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.5.beta1



---

archive/issue_events_110904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T12:01:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110904"
}
```



---

archive/issue_events_110905.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T12:01:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110905"
}
```



---

archive/issue_comments_152949.json:
```json
{
    "body": "**Changing merged** from \"sage-5.5.beta1\" to \"\".",
    "created_at": "2012-11-03T19:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152949",
    "user": "https://github.com/jdemeyer"
}
```

**Changing merged** from "sage-5.5.beta1" to "".



---

archive/issue_comments_152950.json:
```json
{
    "body": "**Changing dependencies** from \"#13579\" to \"#13579, #13681\".",
    "created_at": "2012-11-03T19:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152950",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#13579" to "#13579, #13681".



---

archive/issue_events_110906.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-11-04T18:44:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110906"
}
```



---

archive/issue_comments_152951.json:
```json
{
    "body": "<a id='comment:59'></a>\nRebased to #13681.",
    "created_at": "2012-11-04T18:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152951",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:59'></a>
Rebased to #13681.



---

archive/issue_comments_152952.json:
```json
{
    "body": "**Attachment:** [trac_13147-rebased-to-13681.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch.gz)",
    "created_at": "2012-11-04T18:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152952",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_13147-rebased-to-13681.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch.gz)



---

archive/issue_comments_152953.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n \n-**Apply** [and [attachment:trac_13147-ref.patch](https://github.com/sagemath/sage/files/ticket13147/9f48582b378b3fc5d66eff71e7312b1d.patch](https://github.com/sagemath/sage/files/ticket13147/c70287ef8bbd3db99b4096874b3365e6.patch)).\n+**Apply** [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).\n``````\n",
    "created_at": "2012-11-04T18:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152953",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
 
-**Apply** [and [attachment:trac_13147-ref.patch](https://github.com/sagemath/sage/files/ticket13147/9f48582b378b3fc5d66eff71e7312b1d.patch](https://github.com/sagemath/sage/files/ticket13147/c70287ef8bbd3db99b4096874b3365e6.patch)).
+**Apply** [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).
``````




---

archive/issue_events_110907.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-11-04T18:44:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110907"
}
```



---

archive/issue_events_110908.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-11-04T18:44:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110908"
}
```



---

archive/issue_comments_152954.json:
```json
{
    "body": "**Attachment:** [trac_13681_root.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch.gz)\n\nInitial patch",
    "created_at": "2012-11-05T20:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152954",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_13681_root.patch.gz](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch.gz)

Initial patch



---

archive/issue_comments_152955.json:
```json
{
    "body": "<a id='comment:61'></a>\nDoctesting still litters files around than don't get deleted because SAGE_TESTDIR is not a the expected DOT_SAGE/tmp/hostname/pid/. The trac_13681_root.patch fixes this. Bumped from #13681 so we can finally ship Sage-5.4.",
    "created_at": "2012-11-05T20:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152955",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'></a>
Doctesting still litters files around than don't get deleted because SAGE_TESTDIR is not a the expected DOT_SAGE/tmp/hostname/pid/. The trac_13681_root.patch fixes this. Bumped from #13681 so we can finally ship Sage-5.4.



---

archive/issue_events_110909.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-05T20:09:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110909"
}
```



---

archive/issue_events_110910.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-05T20:09:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110910"
}
```



---

archive/issue_comments_152956.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n \n-**Apply** [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).\n+**Apply** \n+* [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).\n+* [attachment:trac_13681_root.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch) to the root repo\n+\n``````\n",
    "created_at": "2012-11-05T20:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152956",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
 
-**Apply** [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).
+**Apply** 
+* [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).
+* [attachment:trac_13681_root.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch) to the root repo
+
``````




---

archive/issue_events_110911.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-05T20:10:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110911"
}
```



---

archive/issue_events_110912.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-05T20:10:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110912"
}
```



---

archive/issue_comments_152957.json:
```json
{
    "body": "<a id='comment:63'></a>\nVolker, can you describe a situation in which doctesting leaves files lying around?",
    "created_at": "2012-11-06T19:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152957",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>
Volker, can you describe a situation in which doctesting leaves files lying around?



---

archive/issue_comments_152958.json:
```json
{
    "body": "<a id='comment:64'></a>\nPretty much always. Just run `make ptest` and you end up with files in `SAGE_TESTDIR`. Perhaps they have to fail an/or be interrupted? I don't remember having to do anything special. Right now I have, for example,\n\n```\n[vbraun@laptop hg]$ ll ~/.sage/tmp/\n-rw-rw-r--. 1 vbraun vbraun  82814 Nov  6 15:04 ring_3259.py\n```",
    "created_at": "2012-11-06T20:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152958",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:64'></a>
Pretty much always. Just run `make ptest` and you end up with files in `SAGE_TESTDIR`. Perhaps they have to fail an/or be interrupted? I don't remember having to do anything special. Right now I have, for example,

```
[vbraun@laptop hg]$ ll ~/.sage/tmp/
-rw-rw-r--. 1 vbraun vbraun  82814 Nov  6 15:04 ring_3259.py
```



---

archive/issue_comments_152959.json:
```json
{
    "body": "<a id='comment:65'></a>\nFailed doctests are *supposed* to leave files lying around. For example, when I run `sage -tp ...` and there is a failure, I see a message\n\n```\nThe temporary doctesting directory\n   /Users/palmieri/.sage/tmp/jpalmieri538-76123\nwas not removed: it is not empty, presumably because doctests\nfailed or doctesting was interrupted.\n```\nWith your change, the files get left in subdirectories of `tmp/jpalmieri538/` which are then cleaned up the next time Sage runs (or maybe when it exits). Since we have in the past decided to intentionally not delete the failing files, I'm not sure it's appropriate to automatically delete them.\n\nI would suggest moving the Sage root patch and corresponding discussion to #12415, since that ticket modifies the doctesting framework considerably. I think that temporary files are not even created anymore during doctesting with the patches there. (Maybe you can help out with the interrupt issues, too.)",
    "created_at": "2012-11-07T20:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152959",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'></a>
Failed doctests are *supposed* to leave files lying around. For example, when I run `sage -tp ...` and there is a failure, I see a message

```
The temporary doctesting directory
   /Users/palmieri/.sage/tmp/jpalmieri538-76123
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.
```
With your change, the files get left in subdirectories of `tmp/jpalmieri538/` which are then cleaned up the next time Sage runs (or maybe when it exits). Since we have in the past decided to intentionally not delete the failing files, I'm not sure it's appropriate to automatically delete them.

I would suggest moving the Sage root patch and corresponding discussion to #12415, since that ticket modifies the doctesting framework considerably. I think that temporary files are not even created anymore during doctesting with the patches there. (Maybe you can help out with the interrupt issues, too.)



---

archive/issue_comments_152960.json:
```json
{
    "body": "<a id='comment:66'></a>\nI see. I do end up with a lot of cruft in `.sage/tmp` though, and I do think that this needs fixing. But its not urgent. So lets do the new doctesting stuff first and see what happens.",
    "created_at": "2012-11-08T00:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152960",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:66'></a>
I see. I do end up with a lot of cruft in `.sage/tmp` though, and I do think that this needs fixing. But its not urgent. So lets do the new doctesting stuff first and see what happens.



---

archive/issue_events_110913.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-08T00:50:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110913"
}
```



---

archive/issue_events_110914.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-08T00:50:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110914"
}
```



---

archive/issue_comments_152961.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,4 @@\n \n **Apply** \n * [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).\n-* [attachment:trac_13681_root.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch) to the root repo\n \n``````\n",
    "created_at": "2012-11-08T00:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152961",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,4 @@
 
 **Apply** 
 * [attachment:trac_13147-rebased-to-13681.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13147-rebased-to-13681.patch).
-* [attachment:trac_13681_root.patch](https://github.com/sagemath/sage/files/ticket13147/trac_13681_root.patch) to the root repo
 
``````




---

archive/issue_events_110915.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-12T21:57:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110915"
}
```



---

archive/issue_events_110916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-12T21:57:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13147#event-110916"
}
```



---

archive/issue_comments_152962.json:
```json
{
    "body": "**Merged:** sage-5.5.beta1",
    "created_at": "2012-11-12T21:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13147#issuecomment-152962",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.5.beta1
