# Issue 13147: Delay the evaluation of SAGE_TMP in order to facilitate forking in doctesting

archive/issues_012975.json:
```json
{
    "body": "In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n\n**Apply** \n* [attachment:trac_13147-rebased-to-13681.patch].\n\n\nAssignee: mvngu\n\nCC:  @mwhansen\n\nReviewer: John Palmieri\n\nAuthor: David Roe, Mike Hansen\n\nMerged: sage-5.5.beta1\n\nDependencies: #13579, #13681\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13147\n\n",
    "closed_at": "2012-11-12T21:57:16Z",
    "created_at": "2012-06-21T05:36:57Z",
    "labels": [
        "component: doctest coverage"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "Delay the evaluation of SAGE_TMP in order to facilitate forking in doctesting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13147",
    "user": "https://github.com/roed314"
}
```
In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.

**Apply** 
* [attachment:trac_13147-rebased-to-13681.patch].


Assignee: mvngu

CC:  @mwhansen

Reviewer: John Palmieri

Author: David Roe, Mike Hansen

Merged: sage-5.5.beta1

Dependencies: #13579, #13681

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13147





---

archive/issue_comments_166703.json:
```json
{
    "body": "Attachment [13147_move.patch](tarball://root/attachments/some-uuid/ticket13147/13147_move.patch) by @roed314 created at 2012-06-21 05:37:40\n\nDavid Roe/Robert Bradshaw's original solution: I don't like it as much as Mike's",
    "created_at": "2012-06-21T05:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166703",
    "user": "https://github.com/roed314"
}
```

Attachment [13147_move.patch](tarball://root/attachments/some-uuid/ticket13147/13147_move.patch) by @roed314 created at 2012-06-21 05:37:40

David Roe/Robert Bradshaw's original solution: I don't like it as much as Mike's



---

archive/issue_comments_166704.json:
```json
{
    "body": "<a id='comment:1'></a>I like Mike's solution a lot more, but it requires speaklater.  I think this is in the new flasque notebook?  Can we use it from there?",
    "created_at": "2012-06-21T05:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166704",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>I like Mike's solution a lot more, but it requires speaklater.  I think this is in the new flasque notebook?  Can we use it from there?



---

archive/issue_comments_166705.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-21T05:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166705",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_166706.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n+\n+Apply attachment:13147_lazy.patch.\n \n Author: David Roe, Mike Hansen\n \n```\n",
    "created_at": "2012-06-21T05:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166706",
    "user": "https://github.com/roed314"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
-In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
+
+Apply attachment:13147_lazy.patch.
 
 Author: David Roe, Mike Hansen
 
```




---

archive/issue_comments_166707.json:
```json
{
    "body": "<a id='comment:4'></a>+1 for Mike's solution, I know nothing about the flask notebook, but we certainly shouldn't include speaklater in the manner it is done in the patch.\n\nAlso, why are we using temp files and directories in `DOT_SAGE` still, I see no reason to not use the tempfile module with Mike's patch.",
    "created_at": "2012-06-21T06:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166707",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>+1 for Mike's solution, I know nothing about the flask notebook, but we certainly shouldn't include speaklater in the manner it is done in the patch.

Also, why are we using temp files and directories in `DOT_SAGE` still, I see no reason to not use the tempfile module with Mike's patch.



---

archive/issue_comments_166708.json:
```json
{
    "body": "<a id='comment:5'></a>While you're rewriting the definition of `SAGE_TMP`, you should change lines like\n\n```\nd = '%s/temp/%s/%s/'%(DOT_SAGE, HOSTNAME, os.getpid()) \n```\nto use `os.path.join`.",
    "created_at": "2012-06-21T14:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166708",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>While you're rewriting the definition of `SAGE_TMP`, you should change lines like

```
d = '%s/temp/%s/%s/'%(DOT_SAGE, HOSTNAME, os.getpid()) 
```
to use `os.path.join`.



---

archive/issue_comments_166709.json:
```json
{
    "body": "Attachment [13147_lazy.patch](tarball://root/attachments/some-uuid/ticket13147/13147_lazy.patch) by @roed314 created at 2012-06-21 18:56:23\n\nMike Hansen's solution",
    "created_at": "2012-06-21T18:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166709",
    "user": "https://github.com/roed314"
}
```

Attachment [13147_lazy.patch](tarball://root/attachments/some-uuid/ticket13147/13147_lazy.patch) by @roed314 created at 2012-06-21 18:56:23

Mike Hansen's solution



---

archive/issue_comments_166710.json:
```json
{
    "body": "<a id='comment:6'></a>Andrew, are you referring to the fact that Mike creates speaklater.py in the Sage library?",
    "created_at": "2012-06-22T01:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166710",
    "user": "https://github.com/kini"
}
```

<a id='comment:6'></a>Andrew, are you referring to the fact that Mike creates speaklater.py in the Sage library?



---

archive/issue_comments_166711.json:
```json
{
    "body": "<a id='comment:7'></a>Yeah, I think Andrew's referring to the fact that Mike just included speaklater.\n\npatchbot: apply 13147_lazy.patch.",
    "created_at": "2012-06-22T02:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166711",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>Yeah, I think Andrew's referring to the fact that Mike just included speaklater.

patchbot: apply 13147_lazy.patch.



---

archive/issue_comments_166712.json:
```json
{
    "body": "<a id='comment:8'></a>patchbot: apply 13147_lazy.patch",
    "created_at": "2012-06-22T02:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166712",
    "user": "https://github.com/kini"
}
```

<a id='comment:8'></a>patchbot: apply 13147_lazy.patch



---

archive/issue_comments_166713.json:
```json
{
    "body": "<a id='comment:9'></a>`sage/misc/speaklater.py` has no documentation *at all*.\n\nWhy the name `speaklater` and not `lazy_string` (or whatever)?",
    "created_at": "2012-06-25T10:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>`sage/misc/speaklater.py` has no documentation *at all*.

Why the name `speaklater` and not `lazy_string` (or whatever)?



---

archive/issue_comments_166714.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-25T10:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166714",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_166715.json:
```json
{
    "body": "<a id='comment:10'></a>Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater). Obviously we should just depend on speaklater and not incorporate it into the Sage library.",
    "created_at": "2012-06-25T10:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166715",
    "user": "https://github.com/kini"
}
```

<a id='comment:10'></a>Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater). Obviously we should just depend on speaklater and not incorporate it into the Sage library.



---

archive/issue_comments_166716.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 kini]:\n> Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater).\n\n\nAt the very least, document this fact in the file `speaklater.py`.  Also, you should credit the author and specify the license.",
    "created_at": "2012-06-25T11:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166716",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 kini]:
> Because it's a file ripped directly from the package [speaklater](https://github.com/mitsuhiko/speaklater).


At the very least, document this fact in the file `speaklater.py`.  Also, you should credit the author and specify the license.



---

archive/issue_comments_166717.json:
```json
{
    "body": "<a id='comment:12'></a>When I wrote that patch, including the speaklater code was just something to get things as a proof of concept.  I didn't think that that code would ever try to go in as is.",
    "created_at": "2012-06-25T12:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166717",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:12'></a>When I wrote that patch, including the speaklater code was just something to get things as a proof of concept.  I didn't think that that code would ever try to go in as is.



---

archive/issue_comments_166718.json:
```json
{
    "body": "<a id='comment:13'></a>Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.",
    "created_at": "2012-06-25T15:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166718",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.



---

archive/issue_comments_166719.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 jhpalmieri]:\n> Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.\n\nI think it's philosophically wrong to make Sage depend on the Sage Notebook.  Since it's a small file, I don't mind the duplication much.",
    "created_at": "2012-06-25T15:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166719",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:13 jhpalmieri]:
> Isn't speaklater included with the new notebook? So this ticket could depend on #11080 and then it would not include a copy of speaklater.py.

I think it's philosophically wrong to make Sage depend on the Sage Notebook.  Since it's a small file, I don't mind the duplication much.



---

archive/issue_comments_166720.json:
```json
{
    "body": "<a id='comment:15'></a>I think it's philosophically wrong for the Sage notebook to depend on Sage: that's the whole point of the notebook project. But Sage can and should depend on its various component packages, so I don't see anything wrong with Sage depending on files included in the sagenb spkg.  But maybe I'm misunderstanding your point.",
    "created_at": "2012-06-25T16:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166720",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>I think it's philosophically wrong for the Sage notebook to depend on Sage: that's the whole point of the notebook project. But Sage can and should depend on its various component packages, so I don't see anything wrong with Sage depending on files included in the sagenb spkg.  But maybe I'm misunderstanding your point.



---

archive/issue_comments_166721.json:
```json
{
    "body": "<a id='comment:16'></a>Okay, I think it's wrong to depend on the Sage Notebook for stuff which isn't notebook-related.\n\nI also don't think that `speaklater` should be included in the `sagenb` spkg.  Technically, it probably should be a separate spkg, but that seems way overkill given that it's essentially one small file.",
    "created_at": "2012-06-25T16:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Okay, I think it's wrong to depend on the Sage Notebook for stuff which isn't notebook-related.

I also don't think that `speaklater` should be included in the `sagenb` spkg.  Technically, it probably should be a separate spkg, but that seems way overkill given that it's essentially one small file.



---

archive/issue_comments_166722.json:
```json
{
    "body": "<a id='comment:17'></a>I don't think the sagenb spkg should contain a bunch of tarballs either. I think we should start using the package management system from lmonade and steal Gentoo's ebuilds for most of our packages, so there will be very minimal effort required to package additional pieces of software (such as speaklater) for Sage. But that is far off, I guess. At least it will need to be after we drop SPKGs and complete #13015.",
    "created_at": "2012-06-25T18:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166722",
    "user": "https://github.com/kini"
}
```

<a id='comment:17'></a>I don't think the sagenb spkg should contain a bunch of tarballs either. I think we should start using the package management system from lmonade and steal Gentoo's ebuilds for most of our packages, so there will be very minimal effort required to package additional pieces of software (such as speaklater) for Sage. But that is far off, I guess. At least it will need to be after we drop SPKGs and complete #13015.



---

archive/issue_comments_166723.json:
```json
{
    "body": "<a id='comment:18'></a>So what's the plan for this ticket?  The options seem to be:\n\n1. Include speaklater.py with no doctests; include attribution and license.\n2. Include speaklater.py with doctests (I'm not going to write them...); include attribution and license.\n3. Depend on #11080 and import speaklater from sagenb\n4. Make an spkg.\n5. Write a simplified lazy string with doctests.\n\nI think my vote would be for 3.",
    "created_at": "2012-06-28T08:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166723",
    "user": "https://github.com/roed314"
}
```

<a id='comment:18'></a>So what's the plan for this ticket?  The options seem to be:

1. Include speaklater.py with no doctests; include attribution and license.
2. Include speaklater.py with doctests (I'm not going to write them...); include attribution and license.
3. Depend on #11080 and import speaklater from sagenb
4. Make an spkg.
5. Write a simplified lazy string with doctests.

I think my vote would be for 3.



---

archive/issue_comments_166724.json:
```json
{
    "body": "<a id='comment:19'></a>I vote for 1.",
    "created_at": "2012-06-28T08:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166724",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>I vote for 1.



---

archive/issue_comments_166725.json:
```json
{
    "body": "<a id='comment:20'></a>I vote for 4.",
    "created_at": "2012-06-28T09:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166725",
    "user": "https://github.com/kini"
}
```

<a id='comment:20'></a>I vote for 4.



---

archive/issue_comments_166726.json:
```json
{
    "body": "<a id='comment:21'></a>Here's an SPKG: http://wstein.org/home/keshav/files/speaklater-1.2-fbc7a37.spkg",
    "created_at": "2012-06-28T09:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166726",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'></a>Here's an SPKG: http://wstein.org/home/keshav/files/speaklater-1.2-fbc7a37.spkg



---

archive/issue_comments_166727.json:
```json
{
    "body": "<a id='comment:22'></a>I also vote for the spkg. The one Keshav provided looks fine.",
    "created_at": "2012-06-29T07:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166727",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:22'></a>I also vote for the spkg. The one Keshav provided looks fine.



---

archive/issue_comments_166728.json:
```json
{
    "body": "Attachment [13147_lazy_spkg.patch](tarball://root/attachments/some-uuid/ticket13147/13147_lazy_spkg.patch) by @ohanar created at 2012-06-29 07:40:31\n\nLazy string solution for use with spkg",
    "created_at": "2012-06-29T07:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166728",
    "user": "https://github.com/ohanar"
}
```

Attachment [13147_lazy_spkg.patch](tarball://root/attachments/some-uuid/ticket13147/13147_lazy_spkg.patch) by @ohanar created at 2012-06-29 07:40:31

Lazy string solution for use with spkg



---

archive/issue_comments_166729.json:
```json
{
    "body": "<a id='comment:23'></a>We should also patch deps since this would become a standard SPKG.",
    "created_at": "2012-06-29T08:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166729",
    "user": "https://github.com/kini"
}
```

<a id='comment:23'></a>We should also patch deps since this would become a standard SPKG.



---

archive/issue_comments_166730.json:
```json
{
    "body": "<a id='comment:24'></a>We also need a vote on sage-devel for the inclusion of speaklater as a standard spkg.  I'm a bit concerned that we'll get objections since\n\n* speaklater has no doctests\n* we haven't made it an optional package first\n* we're adding another dependency of sage\n\nBut I'm happy to be proved wrong.  Keshav and Andrew, do one of you want to write an e-mail to sage-devel or should I?",
    "created_at": "2012-07-03T07:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166730",
    "user": "https://github.com/roed314"
}
```

<a id='comment:24'></a>We also need a vote on sage-devel for the inclusion of speaklater as a standard spkg.  I'm a bit concerned that we'll get objections since

* speaklater has no doctests
* we haven't made it an optional package first
* we're adding another dependency of sage

But I'm happy to be proved wrong.  Keshav and Andrew, do one of you want to write an e-mail to sage-devel or should I?



---

archive/issue_comments_166731.json:
```json
{
    "body": "<a id='comment:25'></a>* Upstream source is not required to have doctests.\n  * speaklater was already included in the flask notebook, so we're really just moving it into its own spkg.\n\nSo I don't think it should be a big deal.",
    "created_at": "2012-07-03T17:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166731",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>* Upstream source is not required to have doctests.
  * speaklater was already included in the flask notebook, so we're really just moving it into its own spkg.

So I don't think it should be a big deal.



---

archive/issue_comments_166732.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:24 roed]:\n>  * speaklater has no doctests\n\n\nNot required, as John said.\n\n>  * we haven't made it an optional package first\n\n\nNot really a big deal I think\n\n>  * we're adding another dependency of sage\n\n\nNo we're not - we're including another package in Sage.\n\nBy the way, I asked the author of speaklater on IRC to release a new version containing the fix for the pickling problem we ran across in sagenb many months ago, and a couple of days ago he seems to have released 1.3, so here's a new SPKG: http://wstein.org/home/keshav/files/speaklater-1.3.spkg",
    "created_at": "2012-07-04T03:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166732",
    "user": "https://github.com/kini"
}
```

<a id='comment:26'></a>Replying to [comment:24 roed]:
>  * speaklater has no doctests


Not required, as John said.

>  * we haven't made it an optional package first


Not really a big deal I think

>  * we're adding another dependency of sage


No we're not - we're including another package in Sage.

By the way, I asked the author of speaklater on IRC to release a new version containing the fix for the pickling problem we ran across in sagenb many months ago, and a couple of days ago he seems to have released 1.3, so here's a new SPKG: http://wstein.org/home/keshav/files/speaklater-1.3.spkg



---

archive/issue_comments_166733.json:
```json
{
    "body": "<a id='comment:27'></a>Oops, forgot to update SPKG.txt - done now (same URL).",
    "created_at": "2012-07-04T03:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166733",
    "user": "https://github.com/kini"
}
```

<a id='comment:27'></a>Oops, forgot to update SPKG.txt - done now (same URL).



---

archive/issue_comments_166734.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n \n+**Apply** attachment:13147_new.patch.\n \n Author: David Roe, Mike Hansen\n \n```\n",
    "created_at": "2012-07-12T01:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166734",
    "user": "https://github.com/roed314"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
 
+**Apply** attachment:13147_new.patch.
 
 Author: David Roe, Mike Hansen
 
```




---

archive/issue_comments_166735.json:
```json
{
    "body": "<a id='comment:28'></a>Given the opposition to speaklater as an spkg on sage-devel, I've added doctests to speaklater.py, make a couple changes and added it as sage.misc.lazy_string.\n\npatchbot: apply 13147_new.patch",
    "created_at": "2012-07-12T01:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166735",
    "user": "https://github.com/roed314"
}
```

<a id='comment:28'></a>Given the opposition to speaklater as an spkg on sage-devel, I've added doctests to speaklater.py, make a couple changes and added it as sage.misc.lazy_string.

patchbot: apply 13147_new.patch



---

archive/issue_comments_166736.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-12T01:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166736",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166737.json:
```json
{
    "body": "<a id='comment:29'></a>Missed something; I'll fix it in a few hours.",
    "created_at": "2012-07-12T03:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166737",
    "user": "https://github.com/roed314"
}
```

<a id='comment:29'></a>Missed something; I'll fix it in a few hours.



---

archive/issue_comments_166738.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-12T03:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166738",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_166739.json:
```json
{
    "body": "<a id='comment:30'></a>Alright, fixed.",
    "created_at": "2012-07-12T07:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166739",
    "user": "https://github.com/roed314"
}
```

<a id='comment:30'></a>Alright, fixed.



---

archive/issue_comments_166740.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-12T07:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166740",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166741.json:
```json
{
    "body": "<a id='comment:31'></a>Line 23 of cleaner.py:\n\n```\n    F = os.path.join(misc.SAGE_TMP, 'spawned_processes') \n```\nShould it say `str(SAGE_TMP)`?",
    "created_at": "2012-07-13T16:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166741",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>Line 23 of cleaner.py:

```
    F = os.path.join(misc.SAGE_TMP, 'spawned_processes') 
```
Should it say `str(SAGE_TMP)`?



---

archive/issue_comments_166742.json:
```json
{
    "body": "<a id='comment:32'></a>I think that the file lazy_string.py should have a bit more documentation at the top, for example (from the [speaklater website](https://github.com/mitsuhiko/speaklater):\n\n```\nA module that provides lazy strings for translations. Basically you get an\nobject that appears to be a string but changes the value every time the value\nis evaluated based on a callable you provide.\n```\nA few examples would be nice, too.\n\n(Right now it looks like a typical, underdocumented, Python module (well, it's much better than this because of the doctests you added), whereas it should look like a typical, well-documented, Sage module.)",
    "created_at": "2012-07-13T16:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166742",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>I think that the file lazy_string.py should have a bit more documentation at the top, for example (from the [speaklater website](https://github.com/mitsuhiko/speaklater):

```
A module that provides lazy strings for translations. Basically you get an
object that appears to be a string but changes the value every time the value
is evaluated based on a callable you provide.
```
A few examples would be nice, too.

(Right now it looks like a typical, underdocumented, Python module (well, it's much better than this because of the doctests you added), whereas it should look like a typical, well-documented, Sage module.)



---

archive/issue_comments_166743.json:
```json
{
    "body": "<a id='comment:33'></a>All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?",
    "created_at": "2012-07-13T16:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166743",
    "user": "https://github.com/kini"
}
```

<a id='comment:33'></a>All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?



---

archive/issue_comments_166744.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:31 jhpalmieri]:\n> Line 23 of cleaner.py:\n> \n> ```\n>     F = os.path.join(misc.SAGE_TMP, 'spawned_processes') \n> ```\n> Should it say `str(SAGE_TMP)`?\n\n\nThere was a typo in Mike's version of `speaklater.py` (`__eq__` was broken); os.path.join now works without the explicit string cast.\n\n`os.path.exists` doesn't though (and I'm not sure exactly why, since I can't find the source code of `os.stat`).",
    "created_at": "2012-07-13T18:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166744",
    "user": "https://github.com/roed314"
}
```

<a id='comment:34'></a>Replying to [comment:31 jhpalmieri]:
> Line 23 of cleaner.py:
> 
> ```
>     F = os.path.join(misc.SAGE_TMP, 'spawned_processes') 
> ```
> Should it say `str(SAGE_TMP)`?


There was a typo in Mike's version of `speaklater.py` (`__eq__` was broken); os.path.join now works without the explicit string cast.

`os.path.exists` doesn't though (and I'm not sure exactly why, since I can't find the source code of `os.stat`).



---

archive/issue_comments_166745.json:
```json
{
    "body": "<a id='comment:35'></a>Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than \"Creates a lazy string by invoking func with args\". Maybe just one more sentence like: \"A typical usage might be ...\". Maybe another sentence like: \"Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc.\"\n\nAnd this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.",
    "created_at": "2012-07-13T18:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166745",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than "Creates a lazy string by invoking func with args". Maybe just one more sentence like: "A typical usage might be ...". Maybe another sentence like: "Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc."

And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.



---

archive/issue_comments_166746.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:33 kini]:\n> All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?\n\n\nI wasn't sure what the `__gettext__` method did; it can be readded if desired.",
    "created_at": "2012-07-13T19:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166746",
    "user": "https://github.com/roed314"
}
```

<a id='comment:36'></a>Replying to [comment:33 kini]:
> All gettext stuff has been ripped out, so that exact text is no longer appropriate. Also I see several examples in the docstrings. What did you have in mind? Or did you mean a module-level docstring with one large example set walking you how to use all the functionality of the module?


I wasn't sure what the `__gettext__` method did; it can be readded if desired.



---

archive/issue_comments_166747.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:35 jhpalmieri]:\n> Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than \"Creates a lazy string by invoking func with args\". Maybe just one more sentence like: \"A typical usage might be ...\". Maybe another sentence like: \"Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc.\"\n> \n> And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.\n\n\nMakes sense.  I'm going to be out of communication for a few days but I can add some more documentation when I get back.  Keshav, if you want to do it before then that would be cool too.  ;-)",
    "created_at": "2012-07-13T19:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166747",
    "user": "https://github.com/roed314"
}
```

<a id='comment:37'></a>Replying to [comment:35 jhpalmieri]:
> Keshav: I'm thinking that when I read the documentation, either for the whole module or just for `_LazyString` or `lazy_string`, I should see something less terse than "Creates a lazy string by invoking func with args". Maybe just one more sentence like: "A typical usage might be ...". Maybe another sentence like: "Sage uses this code in constructing the path for the directory SAGE_TMP -- see sage.misc.misc."
> 
> And this could either be in the documentation for `lazy_string` or in a module-level docstring. I guess my point is this: I see the docstrings here, and I still have to think for a bit and read the examples to understand what this does and why you might want it. I'd rather not have to think. I also don't know why this is in Sage at all; I certainly think that there is some cruft in the Sage which should be removed, so I'd like to know why this is here. Regarding the existing doctests, they don't quite convince me why I would want to use this instead of just constructing the strings when I need them.


Makes sense.  I'm going to be out of communication for a few days but I can add some more documentation when I get back.  Keshav, if you want to do it before then that would be cool too.  ;-)



---

archive/issue_comments_166748.json:
```json
{
    "body": "<a id='comment:38'></a>(never mind)",
    "created_at": "2012-08-02T15:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166748",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>(never mind)



---

archive/issue_comments_166749.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-02T15:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166749",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_166750.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-02T15:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166750",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166751.json:
```json
{
    "body": "<a id='comment:40'></a>Ping.\n\nI think this just needs a bit of work with the documentation.",
    "created_at": "2012-08-23T18:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166751",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>Ping.

I think this just needs a bit of work with the documentation.



---

archive/issue_comments_166752.json:
```json
{
    "body": "Adds speaklater.py to sage/misc with doctests.",
    "created_at": "2012-10-17T01:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166752",
    "user": "https://github.com/roed314"
}
```

Adds speaklater.py to sage/misc with doctests.



---

archive/issue_comments_166753.json:
```json
{
    "body": "<a id='comment:41'></a>Attachment [13147_new.patch](tarball://root/attachments/some-uuid/ticket13147/13147_new.patch) by @roed314 created at 2012-10-17 01:30:49\n\nI've rebased against 5.4.rc1 and addressed John's concerns about documentation by adding to the module's docstring.",
    "created_at": "2012-10-17T01:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166753",
    "user": "https://github.com/roed314"
}
```

<a id='comment:41'></a>Attachment [13147_new.patch](tarball://root/attachments/some-uuid/ticket13147/13147_new.patch) by @roed314 created at 2012-10-17 01:30:49

I've rebased against 5.4.rc1 and addressed John's concerns about documentation by adding to the module's docstring.



---

archive/issue_comments_166754.json:
```json
{
    "body": "<a id='comment:42'></a>This will likely need to be rebased to #13579.",
    "created_at": "2012-10-17T06:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166754",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>This will likely need to be rebased to #13579.



---

archive/issue_comments_166755.json:
```json
{
    "body": "Attachment [13147_over_13579.patch](tarball://root/attachments/some-uuid/ticket13147/13147_over_13579.patch) by @roed314 created at 2012-10-17 07:35:17",
    "created_at": "2012-10-17T07:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166755",
    "user": "https://github.com/roed314"
}
```

Attachment [13147_over_13579.patch](tarball://root/attachments/some-uuid/ticket13147/13147_over_13579.patch) by @roed314 created at 2012-10-17 07:35:17



---

archive/issue_comments_166756.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.\n \n+**Apply** attachment:13147_over_13579.patch.\n \n Author: David Roe, Mike Hansen\n \n```\n",
    "created_at": "2012-10-17T07:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166756",
    "user": "https://github.com/roed314"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.  Here are two potential solutions.
 
+**Apply** attachment:13147_over_13579.patch.
 
 Author: David Roe, Mike Hansen
 
```




---

archive/issue_comments_166757.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n \n+**Apply** [attachment:13147_over_13579.patch] and [attachment:trac_13147-ref.patch].\n \n Author: David Roe, Mike Hansen\n \n```\n",
    "created_at": "2012-10-18T18:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166757",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
 
+**Apply** [attachment:13147_over_13579.patch] and [attachment:trac_13147-ref.patch].
 
 Author: David Roe, Mike Hansen
 
```




---

archive/issue_comments_166758.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-18T18:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166758",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166759.json:
```json
{
    "body": "<a id='comment:44'></a>Looks good to me now. I have attached a very small referee patch.\n\nShould Keshav be listed as an author and/or a reviewer?",
    "created_at": "2012-10-18T18:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166759",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>Looks good to me now. I have attached a very small referee patch.

Should Keshav be listed as an author and/or a reviewer?



---

archive/issue_comments_166760.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-10-18T18:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166760",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_166761.json:
```json
{
    "body": "<a id='comment:45'></a>Wait, I'm getting some doctest failures. I have to investigate some more.",
    "created_at": "2012-10-18T18:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166761",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>Wait, I'm getting some doctest failures. I have to investigate some more.



---

archive/issue_comments_166762.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-18T18:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166762",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166763.json:
```json
{
    "body": "<a id='comment:47'></a>Okay, the problem is the line\n\n```\nreturn os.path.join(SAGE_TMP, 'spyx', os.sep) \n```\nAccording to the documentation for [os.path.join](http://docs.python.org/library/os.path.html#os.path.join):\n\n    If any component is an absolute path, all previous components are thrown away, and joining continues.\n\nSo if you use os.sep (which is '/', an absolute path), everything before that is discarded. I've provided a revised referee's patch to fix this. My changes need review.",
    "created_at": "2012-10-18T20:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166763",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:47'></a>Okay, the problem is the line

```
return os.path.join(SAGE_TMP, 'spyx', os.sep) 
```
According to the documentation for [os.path.join](http://docs.python.org/library/os.path.html#os.path.join):

    If any component is an absolute path, all previous components are thrown away, and joining continues.

So if you use os.sep (which is '/', an absolute path), everything before that is discarded. I've provided a revised referee's patch to fix this. My changes need review.



---

archive/issue_comments_166764.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-19T20:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166764",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166765.json:
```json
{
    "body": "<a id='comment:48'></a>John, your changes look good to me.",
    "created_at": "2012-10-19T20:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166765",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:48'></a>John, your changes look good to me.



---

archive/issue_events_036219.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-23T07:23:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36219"
}
```



---

archive/issue_comments_166766.json:
```json
{
    "body": "<a id='comment:50'></a>Has it been verified that removing the trailing slash from SPYX_TMP and SAGE_TMP_INTERFACE doesn't change the functionality of the things using those strings?",
    "created_at": "2012-10-23T14:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166766",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>Has it been verified that removing the trailing slash from SPYX_TMP and SAGE_TMP_INTERFACE doesn't change the functionality of the things using those strings?



---

archive/issue_comments_166767.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-10-23T16:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166767",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_166768.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-23T16:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166768",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166769.json:
```json
{
    "body": "<a id='comment:52'></a>The previous version passed doctests, but I see that it modified the behavior slightly because of the missing slash at the end of `SAGE_TMP_INTERFACE`. Here's a new patch. The variables `SPYX_TMP` and `SAGE_TMP_INTERFACE` are not used in local/bin or spkg/, so I think this new patch should take care of things.",
    "created_at": "2012-10-23T16:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166769",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>The previous version passed doctests, but I see that it modified the behavior slightly because of the missing slash at the end of `SAGE_TMP_INTERFACE`. Here's a new patch. The variables `SPYX_TMP` and `SAGE_TMP_INTERFACE` are not used in local/bin or spkg/, so I think this new patch should take care of things.



---

archive/issue_comments_166770.json:
```json
{
    "body": "Attachment [trac_13147-ref.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13147-ref.patch) by @jhpalmieri created at 2012-10-23 18:56:59",
    "created_at": "2012-10-23T18:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166770",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13147-ref.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13147-ref.patch) by @jhpalmieri created at 2012-10-23 18:56:59



---

archive/issue_comments_166771.json:
```json
{
    "body": "<a id='comment:53'></a>These are the only two locations that refer to `SPYX_TMP` and `SAGE_TMP_INTERFACE`.  I'm happy that removing the trailing \"/\" won't cause additional problems, though it would be nice if the patchbot would run the tests....",
    "created_at": "2012-10-24T03:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166771",
    "user": "https://github.com/roed314"
}
```

<a id='comment:53'></a>These are the only two locations that refer to `SPYX_TMP` and `SAGE_TMP_INTERFACE`.  I'm happy that removing the trailing "/" won't cause additional problems, though it would be nice if the patchbot would run the tests....



---

archive/issue_events_036220.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36220"
}
```



---

archive/issue_events_036221.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T03:46:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "milestone": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36221"
}
```



---

archive/issue_comments_166772.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-24T03:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166772",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_036222.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T04:22:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "milestone": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36222"
}
```



---

archive/issue_events_036223.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-10-24T04:22:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36223"
}
```



---

archive/issue_events_036224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T12:01:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36224"
}
```



---

archive/issue_comments_166773.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-01T12:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166773",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_166774.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2012-11-03T19:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166774",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_166775.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2012-11-03T19:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166775",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_036225.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-03T19:50:22Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36225"
}
```



---

archive/issue_comments_166776.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-04T18:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166776",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_166777.json:
```json
{
    "body": "<a id='comment:59'></a>Rebased to #13681.",
    "created_at": "2012-11-04T18:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166777",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:59'></a>Rebased to #13681.



---

archive/issue_comments_166778.json:
```json
{
    "body": "Attachment [trac_13147-rebased-to-13681.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13147-rebased-to-13681.patch) by @jhpalmieri created at 2012-11-04 18:44:34",
    "created_at": "2012-11-04T18:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166778",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13147-rebased-to-13681.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13147-rebased-to-13681.patch) by @jhpalmieri created at 2012-11-04 18:44:34



---

archive/issue_comments_166779.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n \n+**Apply** [attachment:trac_13147-rebased-to-13681.patch].\n \n Author: David Roe, Mike Hansen\n \n```\n",
    "created_at": "2012-11-04T18:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166779",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
 
+**Apply** [attachment:trac_13147-rebased-to-13681.patch].
 
 Author: David Roe, Mike Hansen
 
```




---

archive/issue_comments_166780.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-04T18:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166780",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166781.json:
```json
{
    "body": "Attachment [trac_13681_root.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13681_root.patch) by @vbraun created at 2012-11-05 20:07:51\n\nInitial patch",
    "created_at": "2012-11-05T20:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166781",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13681_root.patch](tarball://root/attachments/some-uuid/ticket13147/trac_13681_root.patch) by @vbraun created at 2012-11-05 20:07:51

Initial patch



---

archive/issue_comments_166782.json:
```json
{
    "body": "<a id='comment:61'></a>Doctesting still litters files around than don't get deleted because SAGE_TESTDIR is not a the expected DOT_SAGE/tmp/hostname/pid/. The trac_13681_root.patch fixes this. Bumped from #13681 so we can finally ship Sage-5.4.",
    "created_at": "2012-11-05T20:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166782",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'></a>Doctesting still litters files around than don't get deleted because SAGE_TESTDIR is not a the expected DOT_SAGE/tmp/hostname/pid/. The trac_13681_root.patch fixes this. Bumped from #13681 so we can finally ship Sage-5.4.



---

archive/issue_comments_166783.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-05T20:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166783",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_166784.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n+\n+**Apply** \n+* [attachment:trac_13147-rebased-to-13681.patch].\n+* [attachment:trac_13681_root.patch] to the root repo\n \n \n Author: David Roe, Mike Hansen\n```\n",
    "created_at": "2012-11-05T20:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166784",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
+
+**Apply** 
+* [attachment:trac_13147-rebased-to-13681.patch].
+* [attachment:trac_13681_root.patch] to the root repo
 
 
 Author: David Roe, Mike Hansen
```




---

archive/issue_comments_166785.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-05T20:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166785",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166786.json:
```json
{
    "body": "<a id='comment:63'></a>Volker, can you describe a situation in which doctesting leaves files lying around?",
    "created_at": "2012-11-06T19:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166786",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>Volker, can you describe a situation in which doctesting leaves files lying around?



---

archive/issue_comments_166787.json:
```json
{
    "body": "<a id='comment:64'></a>Pretty much always. Just run `make ptest` and you end up with files in `SAGE_TESTDIR`. Perhaps they have to fail an/or be interrupted? I don't remember having to do anything special. Right now I have, for example,\n\n```\n[vbraun@laptop hg]$ ll ~/.sage/tmp/\n-rw-rw-r--. 1 vbraun vbraun  82814 Nov  6 15:04 ring_3259.py\n```",
    "created_at": "2012-11-06T20:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166787",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:64'></a>Pretty much always. Just run `make ptest` and you end up with files in `SAGE_TESTDIR`. Perhaps they have to fail an/or be interrupted? I don't remember having to do anything special. Right now I have, for example,

```
[vbraun@laptop hg]$ ll ~/.sage/tmp/
-rw-rw-r--. 1 vbraun vbraun  82814 Nov  6 15:04 ring_3259.py
```



---

archive/issue_comments_166788.json:
```json
{
    "body": "<a id='comment:65'></a>Failed doctests are *supposed* to leave files lying around. For example, when I run `sage -tp ...` and there is a failure, I see a message\n\n```\nThe temporary doctesting directory\n   /Users/palmieri/.sage/tmp/jpalmieri538-76123\nwas not removed: it is not empty, presumably because doctests\nfailed or doctesting was interrupted.\n```\nWith your change, the files get left in subdirectories of `tmp/jpalmieri538/` which are then cleaned up the next time Sage runs (or maybe when it exits). Since we have in the past decided to intentionally not delete the failing files, I'm not sure it's appropriate to automatically delete them.\n\nI would suggest moving the Sage root patch and corresponding discussion to #12415, since that ticket modifies the doctesting framework considerably. I think that temporary files are not even created anymore during doctesting with the patches there. (Maybe you can help out with the interrupt issues, too.)",
    "created_at": "2012-11-07T20:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166788",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'></a>Failed doctests are *supposed* to leave files lying around. For example, when I run `sage -tp ...` and there is a failure, I see a message

```
The temporary doctesting directory
   /Users/palmieri/.sage/tmp/jpalmieri538-76123
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.
```
With your change, the files get left in subdirectories of `tmp/jpalmieri538/` which are then cleaned up the next time Sage runs (or maybe when it exits). Since we have in the past decided to intentionally not delete the failing files, I'm not sure it's appropriate to automatically delete them.

I would suggest moving the Sage root patch and corresponding discussion to #12415, since that ticket modifies the doctesting framework considerably. I think that temporary files are not even created anymore during doctesting with the patches there. (Maybe you can help out with the interrupt issues, too.)



---

archive/issue_comments_166789.json:
```json
{
    "body": "<a id='comment:66'></a>I see. I do end up with a lot of cruft in `.sage/tmp` though, and I do think that this needs fixing. But its not urgent. So lets do the new doctesting stuff first and see what happens.",
    "created_at": "2012-11-08T00:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166789",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:66'></a>I see. I do end up with a lot of cruft in `.sage/tmp` though, and I do think that this needs fixing. But its not urgent. So lets do the new doctesting stuff first and see what happens.



---

archive/issue_comments_166790.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-08T00:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166790",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166791.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.\n+\n+**Apply** \n+* [attachment:trac_13147-rebased-to-13681.patch].\n \n \n Author: David Roe, Mike Hansen\n```\n",
    "created_at": "2012-11-08T00:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166791",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,7 @@
+In order to use multiprocessing in the new doctesting framework (#12415), sage's infrastructure for dealing with temporary files needs to change.
+
+**Apply** 
+* [attachment:trac_13147-rebased-to-13681.patch].
 
 
 Author: David Roe, Mike Hansen
```




---

archive/issue_events_036226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-12T21:57:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13147#event-36226"
}
```



---

archive/issue_comments_166792.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-12T21:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13147#issuecomment-166792",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
