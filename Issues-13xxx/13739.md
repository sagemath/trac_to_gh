# Issue 13739: more informative error message from multiplication of symbolic expressions

archive/issues_013535.json:
```json
{
    "body": "The error returned by multiplication of symbolic expressions is hard coded to `ArithmeticError` in the Cython wrappers (`sage/libs/ginac.pxd`). Since the time that was written, Cython got far better at handling errors, so this is not necessary. Removing this directive actually allows us to return more informative error messages. For example:\n\n```\nsage: t = GF(5)(3)\nsage: u = GF(7)(4)\nsage: var('y')\ny\nsage: e = t*x + u*y\nsage: t*e\nTraceback (most recent call last):\n...\nTypeError: unsupported operand parent(s) for '*': 'Finite Field of size 7' and 'Finite Field of size 5'\n```\n\n**Apply** [attachment:sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch).\n\n**Assignee:** @burcin\n\n**Reviewer:** Nils Bruin, Karl-Dieter Crisman, Michael Orlitzky\n\n**Author:** Burcin Erocal\n\n**Merged:** sage-5.6.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/13739\n\n",
    "closed_at": "2012-12-27T10:23:57Z",
    "created_at": "2012-11-21T17:17:05Z",
    "labels": [
        "component: symbolics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.6",
    "title": "more informative error message from multiplication of symbolic expressions",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13739",
    "user": "https://github.com/burcin"
}
```
The error returned by multiplication of symbolic expressions is hard coded to `ArithmeticError` in the Cython wrappers (`sage/libs/ginac.pxd`). Since the time that was written, Cython got far better at handling errors, so this is not necessary. Removing this directive actually allows us to return more informative error messages. For example:

```
sage: t = GF(5)(3)
sage: u = GF(7)(4)
sage: var('y')
y
sage: e = t*x + u*y
sage: t*e
Traceback (most recent call last):
...
TypeError: unsupported operand parent(s) for '*': 'Finite Field of size 7' and 'Finite Field of size 5'
```

**Apply** [attachment:sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch).

**Assignee:** @burcin

**Reviewer:** Nils Bruin, Karl-Dieter Crisman, Michael Orlitzky

**Author:** Burcin Erocal

**Merged:** sage-5.6.beta2

Issue created by migration from https://trac.sagemath.org/ticket/13739





---

archive/issue_events_117725.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-11-21T17:21:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13739#event-117725"
}
```



---

archive/issue_comments_164052.json:
```json
{
    "body": "**Dependencies:** #13609",
    "created_at": "2012-11-21T17:21:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164052",
    "user": "https://github.com/burcin"
}
```

**Dependencies:** #13609



---

archive/issue_comments_164053.json:
```json
{
    "body": "<a id='comment:2'></a>\nI had to rebase the last hunk to apply on 5.5.rc0, but it looks like it works.\n\nI also noticed that a similar issue (fixed by this patch) was reported as #10960, so I added the test case from that ticket.",
    "created_at": "2012-12-02T01:38:09Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164053",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:2'></a>
I had to rebase the last hunk to apply on 5.5.rc0, but it looks like it works.

I also noticed that a similar issue (fixed by this patch) was reported as #10960, so I added the test case from that ticket.



---

archive/issue_comments_164054.json:
```json
{
    "body": "<a id='comment:3'></a>\n...and I just noticed there's a dependency, crap. Aside from the context lines, this is independent of #13609, so might it make sense to get this reviewed and then refresh that patch instead?",
    "created_at": "2012-12-02T01:43:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164054",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>
...and I just noticed there's a dependency, crap. Aside from the context lines, this is independent of #13609, so might it make sense to get this reviewed and then refresh that patch instead?



---

archive/issue_comments_164055.json:
```json
{
    "body": "<a id='comment:4'></a>\nBecause try/except is a regularly used programming paradigm in python, the expection object generation should be fast. It used to be the case that a lot of things in the coercion framework were simply tried before trying more complicated things. So, making a more informative but slower to produce error message can really slow down operations. Have you checked whether this is the case?\n\nI guess the idea was that after a raised expection, one can examine the traceback with pdb and query the frames for what values led to the error. That won't work so well in cython code of course ...",
    "created_at": "2012-12-02T02:47:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164055",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>
Because try/except is a regularly used programming paradigm in python, the expection object generation should be fast. It used to be the case that a lot of things in the coercion framework were simply tried before trying more complicated things. So, making a more informative but slower to produce error message can really slow down operations. Have you checked whether this is the case?

I guess the idea was that after a raised expection, one can examine the traceback with pdb and query the frames for what values led to the error. That won't work so well in cython code of course ...



---

archive/issue_comments_164056.json:
```json
{
    "body": "<a id='comment:5'></a>\nIn this case the change seems so minimal that I don't see how it can really slow things down. We aren't actually adding any extra checks... this change would only affect the case where an exception was already raised, right?  This may be a dumb question, but hopefully not.  Good catch on #10960, mjo.",
    "created_at": "2012-12-02T02:55:27Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164056",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
In this case the change seems so minimal that I don't see how it can really slow things down. We aren't actually adding any extra checks... this change would only affect the case where an exception was already raised, right?  This may be a dumb question, but hopefully not.  Good catch on #10960, mjo.



---

archive/issue_comments_164057.json:
```json
{
    "body": "<a id='comment:6'></a>\n> ...and I just noticed there's a dependency, crap. Aside from the context lines, this is independent of #13609, so might it make sense to get this reviewed and then refresh that patch instead?\n\nI concur, because there is a lot of stuff with that and it also has dependencies, which might take a while.",
    "created_at": "2012-12-02T02:56:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164057",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
> ...and I just noticed there's a dependency, crap. Aside from the context lines, this is independent of #13609, so might it make sense to get this reviewed and then refresh that patch instead?

I concur, because there is a lot of stuff with that and it also has dependencies, which might take a while.



---

archive/issue_comments_164058.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe test suite passes with just my patch applied, so it is really independent of those other tickets.\n\nNils' question is unfortunately above my pay grade.",
    "created_at": "2012-12-02T04:12:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164058",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>
The test suite passes with just my patch applied, so it is really independent of those other tickets.

Nils' question is unfortunately above my pay grade.



---

archive/issue_comments_164059.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@kcrisman](#comment%3A5):\n>  this change would only affect the case where an exception was already raised, right?\n\nYes, looking at the code I think you're right. The exception object already exists by the time this code comes into play. It's hard to imagine how this code could cause a slowdown.",
    "created_at": "2012-12-02T08:42:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164059",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'></a>
Replying to [@kcrisman](#comment%3A5):
>  this change would only affect the case where an exception was already raised, right?

Yes, looking at the code I think you're right. The exception object already exists by the time this code comes into play. It's hard to imagine how this code could cause a slowdown.



---

archive/issue_comments_164060.json:
```json
{
    "body": "<a id='comment:9'></a>\nGreat!\n\nAny extra review needed, then?  Michael, do you consider your patch to more or less be a rebase with an extra test?  (Assuming you rebased it away from dependency on #13609).\n\nIf so, looks like positive review; if you'd like to add yourself as an author, then presumably someone else (including Burcin) would have to do the final once-over.",
    "created_at": "2012-12-03T16:06:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164060",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Great!

Any extra review needed, then?  Michael, do you consider your patch to more or less be a rebase with an extra test?  (Assuming you rebased it away from dependency on #13609).

If so, looks like positive review; if you'd like to add yourself as an author, then presumably someone else (including Burcin) would have to do the final once-over.



---

archive/issue_comments_164061.json:
```json
{
    "body": "**Reviewer:** Nils Bruin, Karl-Dieter Crisman, Michael Orlitzky",
    "created_at": "2012-12-03T16:06:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164061",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Nils Bruin, Karl-Dieter Crisman, Michael Orlitzky



---

archive/issue_comments_164062.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes, all I did was change the context to get his patch to apply. I assumed Burcin was working from either an old version, or on top of some local patchset. To a smart person, that would have hinted that there might be dependencies. To me, it just meant that I should rebase it on top of a fresh 5.5.rc0.\n\nI did run the full test suite afterwards, and except for the one known failure in 5.5.rc0, it passed. I don't care about the author credit.",
    "created_at": "2012-12-04T01:35:47Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164062",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>
Yes, all I did was change the context to get his patch to apply. I assumed Burcin was working from either an old version, or on top of some local patchset. To a smart person, that would have hinted that there might be dependencies. To me, it just meant that I should rebase it on top of a fresh 5.5.rc0.

I did run the full test suite afterwards, and except for the one known failure in 5.5.rc0, it passed. I don't care about the author credit.



---

archive/issue_comments_164063.json:
```json
{
    "body": "<a id='comment:11'></a>\nOh, and to avoid the appearance of impropriety: I also added a line break in his original TypeError output.",
    "created_at": "2012-12-04T01:37:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164063",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
Oh, and to avoid the appearance of impropriety: I also added a line break in his original TypeError output.



---

archive/issue_comments_164064.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks for rebasing the patch. I was indeed working with the patches required for the pynac update applied to the Sage library as you can see from the dependency. It turns out that the pynac update will not be able to go in as quick as I thought.\n\nReplying to [@orlitzky](#comment%3A10):\n \n> I don't care about the author credit.\n\nYour patch replaces the author line on the patch. I don't think this is appropriate. If we were using mercurial properly, we wouldn't run into such problems. But while we have to struggle with patches exported from queues, you should take care to keep the author credit on the patches.",
    "created_at": "2012-12-04T08:33:49Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164064",
    "user": "https://github.com/burcin"
}
```

<a id='comment:12'></a>
Thanks for rebasing the patch. I was indeed working with the patches required for the pynac update applied to the Sage library as you can see from the dependency. It turns out that the pynac update will not be able to go in as quick as I thought.

Replying to [@orlitzky](#comment%3A10):
 
> I don't care about the author credit.

Your patch replaces the author line on the patch. I don't think this is appropriate. If we were using mercurial properly, we wouldn't run into such problems. But while we have to struggle with patches exported from queues, you should take care to keep the author credit on the patches.



---

archive/issue_comments_164065.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@burcin](#comment%3A12):\n> \n> Replying to [@orlitzky](#comment%3A10):\n>  \n> > I don't care about the author credit.\n\n> \n> Your patch replaces the author line on the patch. I don't think this is appropriate. If we were using mercurial properly, we wouldn't run into such problems. But while we have to struggle with patches exported from queues, you should take care to keep the author credit on the patches.\n> \n\nWhat should I do here? Yours also had a more-informative commit message. To rebase it, I started a new patch on a fresh queue so that I could apply yours with fuzz (hg qimport won't let me do that).\n\nNow when I export it, it has my info/commit message.\n\nShould I just mangle the patch header myself?",
    "created_at": "2012-12-04T14:51:53Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164065",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'></a>
Replying to [@burcin](#comment%3A12):
> 
> Replying to [@orlitzky](#comment%3A10):
>  
> > I don't care about the author credit.

> 
> Your patch replaces the author line on the patch. I don't think this is appropriate. If we were using mercurial properly, we wouldn't run into such problems. But while we have to struggle with patches exported from queues, you should take care to keep the author credit on the patches.
> 

What should I do here? Yours also had a more-informative commit message. To rebase it, I started a new patch on a fresh queue so that I could apply yours with fuzz (hg qimport won't let me do that).

Now when I export it, it has my info/commit message.

Should I just mangle the patch header myself?



---

archive/issue_comments_164066.json:
```json
{
    "body": "<a id='comment:14'></a>\n> Now when I export it, it has my info/commit message.\n> Should I just mangle the patch header myself?\n\nYeah, why not?  If the patch won't import properly, that is probably the best quick solution.  Actually, you can use `hg qrefresh -e` to edit the commit message.  It doesn't look like there is an easy way to change the author, so you can do that by hand, just use the same info as in Burcin's patch.",
    "created_at": "2012-12-04T15:15:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164066",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
> Now when I export it, it has my info/commit message.
> Should I just mangle the patch header myself?

Yeah, why not?  If the patch won't import properly, that is probably the best quick solution.  Actually, you can use `hg qrefresh -e` to edit the commit message.  It doesn't look like there is an easy way to change the author, so you can do that by hand, just use the same info as in Burcin's patch.



---

archive/attachments_019237.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sage-trac_13739-review.patch",
    "asset_url": "tarball://root/attachments/ticket13739/sage-trac_13739-review.patch",
    "created_at": "2012-12-04T15:29:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch",
    "user": "https://github.com/orlitzky"
}
```



---

archive/issue_comments_164067.json:
```json
{
    "body": "**Attachment:** [sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch)\n\nRebase Burcin's patch and add a doctest from #10960",
    "created_at": "2012-12-04T15:29:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164067",
    "user": "https://github.com/orlitzky"
}
```

**Attachment:** [sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch)

Rebase Burcin's patch and add a doctest from #10960



---

archive/issue_comments_164068.json:
```json
{
    "body": "<a id='comment:15'></a>\nOk, patch is updated. I added a line to the original commit message mentioning the new doctest.",
    "created_at": "2012-12-04T15:30:02Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164068",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>
Ok, patch is updated. I added a line to the original commit message mentioning the new doctest.



---

archive/issue_comments_164069.json:
```json
{
    "body": "**Changing dependencies** from \"#13609\" to \"\".",
    "created_at": "2012-12-04T15:35:36Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164069",
    "user": "https://github.com/kcrisman"
}
```

**Changing dependencies** from "#13609" to "".



---

archive/issue_events_117726.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-04T15:47:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13739#event-117726"
}
```



---

archive/issue_events_117727.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-04T15:47:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13739#event-117727"
}
```



---

archive/issue_comments_164070.json:
```json
{
    "body": "<a id='comment:18'></a>\nPatchbot, apply sage-trac_13739-review.patch",
    "created_at": "2012-12-04T15:47:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164070",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
Patchbot, apply sage-trac_13739-review.patch



---

archive/issue_comments_164071.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,3 +12,4 @@\n TypeError: unsupported operand parent(s) for '*': 'Finite Field of size 7' and 'Finite Field of size 5'\n ```\n \n+**Apply** [attachment:sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch).\n``````\n",
    "created_at": "2012-12-04T15:47:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164071",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,3 +12,4 @@
 TypeError: unsupported operand parent(s) for '*': 'Finite Field of size 7' and 'Finite Field of size 5'
 ```
 
+**Apply** [attachment:sage-trac_13739-review.patch](https://github.com/sagemath/sage/files/ticket13739/sage-trac_13739-review.patch).
``````




---

archive/issue_events_117728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:23:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13739#event-117728"
}
```



---

archive/issue_events_117729.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:23:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13739#event-117729"
}
```



---

archive/issue_comments_164072.json:
```json
{
    "body": "**Merged:** sage-5.6.beta2",
    "created_at": "2012-12-27T10:23:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13739#issuecomment-164072",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.6.beta2
