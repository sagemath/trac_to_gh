# Issue 13055: Refactor numerical_approx()

archive/issues_012883.json:
```json
{
    "body": "Drop the `_numerical_approx` method, instead use `numerical_approx`. Move the generic implementation to a new Cython file. Also put the conversion of decimal digits to bits in one place.\n\nFinally, the documentation of `numerical_approx` should be made more clear and consistent.\n\n\n**Assignee:** @burcin\n\n**CC:**  benjaminjones\n\n**Keywords:** numerical_approx, sd40.5, days74\n\n**Branch/Commit:** [fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)\n\n**Reviewer:** Marc Mezzarobba\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/13055\n\n",
    "closed_at": "2016-08-07T20:00:14Z",
    "created_at": "2012-05-29T03:27:40Z",
    "labels": [
        "component: basic arithmetic",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Refactor numerical_approx()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13055",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```
Drop the `_numerical_approx` method, instead use `numerical_approx`. Move the generic implementation to a new Cython file. Also put the conversion of decimal digits to bits in one place.

Finally, the documentation of `numerical_approx` should be made more clear and consistent.


**Assignee:** @burcin

**CC:**  benjaminjones

**Keywords:** numerical_approx, sd40.5, days74

**Branch/Commit:** [fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)

**Reviewer:** Marc Mezzarobba

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/13055





---

archive/issue_comments_152561.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,4 +23,4 @@\n Real Field with 200 bits of precision\n ```\n \n-This might not seem that significant -- we could interpret \"n\" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that f(1.2345678901234567890) give the same answer as f(1.2345678901234567890, hold=True).n(), especially now that we typically get the precision from the parent.\n+This might not seem that significant -- we could interpret \"n\" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that `f(1.2345678901234567890)` give the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.\n``````\n",
    "created_at": "2012-05-29T03:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152561",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,4 +23,4 @@
 Real Field with 200 bits of precision
 ```
 
-This might not seem that significant -- we could interpret "n" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that f(1.2345678901234567890) give the same answer as f(1.2345678901234567890, hold=True).n(), especially now that we typically get the precision from the parent.
+This might not seem that significant -- we could interpret "n" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that `f(1.2345678901234567890)` give the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.
``````




---

archive/issue_comments_152562.json:
```json
{
    "body": "**Changing keywords** from \"numerical_approx\" to \"numerical_approx, sd40.5\".",
    "created_at": "2012-05-29T03:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152562",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Changing keywords** from "numerical_approx" to "numerical_approx, sd40.5".



---

archive/issue_events_112098.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112098"
}
```



---

archive/issue_events_112099.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112099"
}
```



---

archive/issue_events_112100.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112100"
}
```



---

archive/issue_events_112101.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112101"
}
```



---

archive/issue_events_112102.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112102"
}
```



---

archive/issue_events_112103.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112103"
}
```



---

archive/issue_events_112104.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112104"
}
```



---

archive/issue_events_112105.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112105"
}
```



---

archive/issue_comments_152563.json:
```json
{
    "body": "<a id='comment:7'></a>\nI doubt that this is a bug. How would you guess the default precision for the `.n()` method?",
    "created_at": "2014-11-27T19:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152563",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I doubt that this is a bug. How would you guess the default precision for the `.n()` method?



---

archive/issue_events_112106.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T19:03:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "rename": {
        "from": "loss of precision via SR",
        "to": "Better default precision for .n() method"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112106"
}
```



---

archive/issue_comments_152564.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,6 @@\n By going via SR we can lose precision when using numerical_approx:\n \n ```\n-\n sage: p\n 3.1415926535897932384626433832795028841971693993751058209749\n sage: parent(p)\n``````\n",
    "created_at": "2014-11-27T19:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152564",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,6 @@
 By going via SR we can lose precision when using numerical_approx:
 
 ```
-
 sage: p
 3.1415926535897932384626433832795028841971693993751058209749
 sage: parent(p)
``````




---

archive/issue_comments_152565.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,25 +1,13 @@\n-By going via SR we can lose precision when using numerical_approx:\n+We can lose precision when using `numerical_approx`:\n \n ```\n+sage: p = pi.n(200)\n sage: p\n 3.1415926535897932384626433832795028841971693993751058209749\n-sage: parent(p)\n-Real Field with 200 bits of precision\n-sage: SR(p)\n-3.1415926535897932384626433832795028841971693993751058209749\n-sage: SR(p).n()\n+sage: p.numerical_approx()\n 3.14159265358979\n-sage: parent(SR(p).n())\n-Real Field with 53 bits of precision\n ```\n \n-The information is still there, though (as is obvious from the fact the string produced has all those extra digits):\n+This might not seem that significant -- we could interpret `.n()` as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get `hold=True` for symbolics to behave nicely. I'd prefer that `f(1.2345678901234567890)` gives the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.\n \n-```\n-sage: SR(p).pyobject()\n-3.1415926535897932384626433832795028841971693993751058209749\n-sage: parent(SR(p).pyobject())\n-Real Field with 200 bits of precision\n-```\n-\n-This might not seem that significant -- we could interpret \"n\" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that `f(1.2345678901234567890)` give the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.\n+Related: #16025\n``````\n",
    "created_at": "2014-11-27T21:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152565",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,25 +1,13 @@
-By going via SR we can lose precision when using numerical_approx:
+We can lose precision when using `numerical_approx`:
 
 ```
+sage: p = pi.n(200)
 sage: p
 3.1415926535897932384626433832795028841971693993751058209749
-sage: parent(p)
-Real Field with 200 bits of precision
-sage: SR(p)
-3.1415926535897932384626433832795028841971693993751058209749
-sage: SR(p).n()
+sage: p.numerical_approx()
 3.14159265358979
-sage: parent(SR(p).n())
-Real Field with 53 bits of precision
 ```
 
-The information is still there, though (as is obvious from the fact the string produced has all those extra digits):
+This might not seem that significant -- we could interpret `.n()` as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get `hold=True` for symbolics to behave nicely. I'd prefer that `f(1.2345678901234567890)` gives the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.
 
-```
-sage: SR(p).pyobject()
-3.1415926535897932384626433832795028841971693993751058209749
-sage: parent(SR(p).pyobject())
-Real Field with 200 bits of precision
-```
-
-This might not seem that significant -- we could interpret "n" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that `f(1.2345678901234567890)` give the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.
+Related: #16025
``````




---

archive/issue_events_112107.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T21:15:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112107"
}
```



---

archive/issue_events_112108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T21:15:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112108"
}
```



---

archive/issue_events_112109.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T21:15:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112109"
}
```



---

archive/issue_events_112110.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T21:15:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112110"
}
```



---

archive/issue_events_112111.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-11-27T21:15:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112111"
}
```



---

archive/issue_comments_152566.json:
```json
{
    "body": "<a id='comment:11'></a>\nHmm, I'm not sure this is wontfix, though.  I'm sympathetic to your argument, but Doug's point that\n\n```\nsage: sin(1.2345678901234567890)\n0.9440057250452665781\nsage: sin(1.2345678901234567890).n()\n0.944005725045267\n```\nseems good; you shouldn't *lose* precision, should you?  (Forget about hold!)",
    "created_at": "2014-12-04T03:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152566",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
Hmm, I'm not sure this is wontfix, though.  I'm sympathetic to your argument, but Doug's point that

```
sage: sin(1.2345678901234567890)
0.9440057250452665781
sage: sin(1.2345678901234567890).n()
0.944005725045267
```
seems good; you shouldn't *lose* precision, should you?  (Forget about hold!)



---

archive/issue_comments_152567.json:
```json
{
    "body": "<a id='comment:12'></a>\nLosing precision is a *feature* of the `.n()` method, that's what it does. The `x.n()` method asks for a *numerical approximation* of `x` to a precision of 53 bits. This is easily explained. I also like the fact that neither the implementation nor the user should need to worry about what `x` is, the output is a real/complex number with 53 bits of precision.\n\nIf you think that `.n()` is wrong, what should `(2/3).n()` return then? The only possible answer which doesn't lose precision is the rational 2/3.",
    "created_at": "2014-12-04T07:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152567",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Losing precision is a *feature* of the `.n()` method, that's what it does. The `x.n()` method asks for a *numerical approximation* of `x` to a precision of 53 bits. This is easily explained. I also like the fact that neither the implementation nor the user should need to worry about what `x` is, the output is a real/complex number with 53 bits of precision.

If you think that `.n()` is wrong, what should `(2/3).n()` return then? The only possible answer which doesn't lose precision is the rational 2/3.



---

archive/issue_comments_152568.json:
```json
{
    "body": "<a id='comment:13'></a>\nAbout `hold=True`, that even doesn't seem to work with real numbers:\n\n```\nsage: gamma(1.2345678901234567890, hold=True)\n0.9097200568693150729\n```",
    "created_at": "2014-12-04T07:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152568",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
About `hold=True`, that even doesn't seem to work with real numbers:

```
sage: gamma(1.2345678901234567890, hold=True)
0.9097200568693150729
```



---

archive/issue_events_112112.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112112"
}
```



---

archive/issue_events_112113.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112113"
}
```



---

archive/issue_comments_152569.json:
```json
{
    "body": "<a id='comment:14'></a>\n> About `hold=True`, that even doesn't seem to work with real numbers:\n\nExactly, which is why I didn't use that example.\n\nOkay, I don't have that much invested in this.   But then \n\n```\nsage: x = 1.2340000000000000000000001\nsage: x.n?\nDocstring:\n   Return a numerical approximation of x with at least prec bits of\n   precision.\n\n   EXAMPLES:\n\n      sage: (2/3).n()\n      0.666666666666667\n      sage: pi.n(digits=10)\n      3.141592654\n      sage: pi.n(prec=20)   # 20 bits\n      3.1416\n\n   TESTS:\n\n   Check that http://trac.sagemath.org/14778 is fixed:\n\n      sage: (0).n(algorithm='foo')\n      0.000000000000000\n```\nshould really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!",
    "created_at": "2014-12-04T14:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152569",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
> About `hold=True`, that even doesn't seem to work with real numbers:

Exactly, which is why I didn't use that example.

Okay, I don't have that much invested in this.   But then 

```
sage: x = 1.2340000000000000000000001
sage: x.n?
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:

      sage: (2/3).n()
      0.666666666666667
      sage: pi.n(digits=10)
      3.141592654
      sage: pi.n(prec=20)   # 20 bits
      3.1416

   TESTS:

   Check that http://trac.sagemath.org/14778 is fixed:

      sage: (0).n(algorithm='foo')
      0.000000000000000
```
should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!



---

archive/issue_events_112114.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "rename": {
        "from": "Better default precision for .n() method",
        "to": "Document default precision for .n() method"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112114"
}
```



---

archive/issue_events_112115.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112115"
}
```



---

archive/issue_events_112116.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112116"
}
```



---

archive/issue_events_112117.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-04T14:23:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112117"
}
```



---

archive/issue_events_112118.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-25T09:11:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "component: symbolics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112118"
}
```



---

archive/issue_events_112119.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-25T09:11:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112119"
}
```



---

archive/issue_comments_152570.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [kcrisman](#comment%3A14):\n> Okay, I don't have that much invested in this.   But then `x.n?`\n> should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!\n\n\nThis is actually a general problem we have with Sage documentation: often one has similar functions/methods which all do the same thing (on different kinds of objects). In this case, the `numerical_approx` function in `src/sage/misc/functional.py` is much better documented. What's the optimal solution which doesn't simply replicate the documentation from `numerical_approx()`?",
    "created_at": "2015-03-09T10:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152570",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [kcrisman](#comment%3A14):
> Okay, I don't have that much invested in this.   But then `x.n?`
> should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!


This is actually a general problem we have with Sage documentation: often one has similar functions/methods which all do the same thing (on different kinds of objects). In this case, the `numerical_approx` function in `src/sage/misc/functional.py` is much better documented. What's the optimal solution which doesn't simply replicate the documentation from `numerical_approx()`?



---

archive/issue_comments_152571.json:
```json
{
    "body": "<a id='comment:17'></a>\nOne other detail which is wrong in the \"at least\" in \"at least prec bits of precision\". Certainly for the global `numerical_approx()` function, it's **exactly** `prec` bits.",
    "created_at": "2015-03-09T10:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152571",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
One other detail which is wrong in the "at least" in "at least prec bits of precision". Certainly for the global `numerical_approx()` function, it's **exactly** `prec` bits.



---

archive/issue_comments_152572.json:
```json
{
    "body": "**Changing keywords** from \"numerical_approx, sd40.5\" to \"numerical_approx, sd40.5, days74\".",
    "created_at": "2016-06-01T10:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152572",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "numerical_approx, sd40.5" to "numerical_approx, sd40.5, days74".



---

archive/issue_events_112120.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T10:00:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112120"
}
```



---

archive/issue_events_112121.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T10:00:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112121"
}
```



---

archive/issue_comments_152573.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2016-06-01T10:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152573",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_152574.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,13 +1 @@\n-We can lose precision when using `numerical_approx`:\n-\n-```\n-sage: p = pi.n(200)\n-sage: p\n-3.1415926535897932384626433832795028841971693993751058209749\n-sage: p.numerical_approx()\n-3.14159265358979\n-```\n-\n-This might not seem that significant -- we could interpret `.n()` as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get `hold=True` for symbolics to behave nicely. I'd prefer that `f(1.2345678901234567890)` gives the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.\n-\n-Related: #16025\n+The documentation of `numerical_approx` should be made more clear.\n``````\n",
    "created_at": "2016-06-01T10:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152574",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,13 +1 @@
-We can lose precision when using `numerical_approx`:
-
-```
-sage: p = pi.n(200)
-sage: p
-3.1415926535897932384626433832795028841971693993751058209749
-sage: p.numerical_approx()
-3.14159265358979
-```
-
-This might not seem that significant -- we could interpret `.n()` as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get `hold=True` for symbolics to behave nicely. I'd prefer that `f(1.2345678901234567890)` gives the same answer as `f(1.2345678901234567890, hold=True).n()`, especially now that we typically get the precision from the parent.
-
-Related: #16025
+The documentation of `numerical_approx` should be made more clear.
``````




---

archive/issue_comments_152575.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n The documentation of `numerical_approx` should be made more clear.\n+\n+We also refactor the code a bit to make it simpler. In particular, we change `_numerical_approx` by `numerical_approx` everywhere.\n``````\n",
    "created_at": "2016-06-01T10:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152575",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 The documentation of `numerical_approx` should be made more clear.
+
+We also refactor the code a bit to make it simpler. In particular, we change `_numerical_approx` by `numerical_approx` everywhere.
``````




---

archive/issue_events_112122.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T12:42:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112122"
}
```



---

archive/issue_events_112123.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T12:42:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "component: basic arithmetic",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112123"
}
```



---

archive/issue_events_112124.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T12:42:33Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "rename": {
        "from": "Document default precision for .n() method",
        "to": "Refactor numerical_approx()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112124"
}
```



---

archive/issue_comments_152576.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n-The documentation of `numerical_approx` should be made more clear.\n+Drop the `_numerical_approx` method, instead use `numerical_approx`. Move the generic implementation to a new Cython file. Also put the conversion of decimal digits to bits in one place.\n \n-We also refactor the code a bit to make it simpler. In particular, we change `_numerical_approx` by `numerical_approx` everywhere.\n+Finally, the documentation of `numerical_approx` should be made more clear and consistent.\n+\n``````\n",
    "created_at": "2016-06-01T12:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152576",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
-The documentation of `numerical_approx` should be made more clear.
+Drop the `_numerical_approx` method, instead use `numerical_approx`. Move the generic implementation to a new Cython file. Also put the conversion of decimal digits to bits in one place.
 
-We also refactor the code a bit to make it simpler. In particular, we change `_numerical_approx` by `numerical_approx` everywhere.
+Finally, the documentation of `numerical_approx` should be made more clear and consistent.
+
``````




---

archive/issue_comments_152577.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/document_default_precision_for__n___method](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/document_default_precision_for__n___method)",
    "created_at": "2016-06-01T14:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152577",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/document_default_precision_for__n___method](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/document_default_precision_for__n___method)



---

archive/issue_comments_152578.json:
```json
{
    "body": "<a id='comment:23'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68\">fafdb9c</a></td><td><code>Improve numerical_approx</code></td></tr></table>\n",
    "created_at": "2016-06-01T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152578",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68">fafdb9c</a></td><td><code>Improve numerical_approx</code></td></tr></table>




---

archive/issue_events_112125.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T14:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112125"
}
```



---

archive/issue_events_112126.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T14:54:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112126"
}
```



---

archive/issue_comments_152579.json:
```json
{
    "body": "**Commit:** [fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68](https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68)",
    "created_at": "2016-06-01T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152579",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68](https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68)



---

archive/issue_comments_152580.json:
```json
{
    "body": "<a id='comment:24'></a>\nMost of the changes look good to me, but I don't like the new description of `RealLiteral.numerical_approx()`: as far as I understand \u201creal literals\u201d are exact decimal numbers, so converting one to a `RealField` element with d\u00b7log\u2081\u2080\u00a02 bits of precision doesn't really \u201cchange its precision\u201d to d decimal digits.\n\nAnd\u2014just wondering, I have nothing against that choice\u2014is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?",
    "created_at": "2016-06-02T10:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152580",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:24'></a>
Most of the changes look good to me, but I don't like the new description of `RealLiteral.numerical_approx()`: as far as I understand “real literals” are exact decimal numbers, so converting one to a `RealField` element with d·log₁₀ 2 bits of precision doesn't really “change its precision” to d decimal digits.

And—just wondering, I have nothing against that choice—is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?



---

archive/issue_comments_152581.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mmezzarobba](#comment%3A24):\n> is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?\n\n\nBecause of the \"put code to convert non-Elements to Elements before calling it\" part. I don't know how to do that in general.",
    "created_at": "2016-06-02T11:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152581",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [mmezzarobba](#comment%3A24):
> is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?


Because of the "put code to convert non-Elements to Elements before calling it" part. I don't know how to do that in general.



---

archive/issue_comments_152582.json:
```json
{
    "body": "<a id='comment:26'></a>\n**ping**",
    "created_at": "2016-08-01T11:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152582",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
**ping**



---

archive/issue_comments_152583.json:
```json
{
    "body": "**Changing commit** from \"[fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68](https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68)\" to \"[fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)\".",
    "created_at": "2016-08-02T06:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68](https://github.com/sagemath/sagetrac-mirror/commit/fafdb9c02ad5b9d0c7d85fe3cc4468015d08fd68)" to "[fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)".



---

archive/issue_comments_152584.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556\">fd79227</a></td><td><code>Improve numerical_approx</code></td></tr></table>\n",
    "created_at": "2016-08-02T06:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556">fd79227</a></td><td><code>Improve numerical_approx</code></td></tr></table>




---

archive/issue_comments_152585.json:
```json
{
    "body": "<a id='comment:28'></a>\nI still disagree about the docstring of `RealLiteral.numerical_approx()`, but let's not again delay the ticket by two months...",
    "created_at": "2016-08-04T09:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152585",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:28'></a>
I still disagree about the docstring of `RealLiteral.numerical_approx()`, but let's not again delay the ticket by two months...



---

archive/issue_comments_152586.json:
```json
{
    "body": "**Reviewer:** Marc Mezzarobba",
    "created_at": "2016-08-04T09:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152586",
    "user": "https://github.com/mezzarobba"
}
```

**Reviewer:** Marc Mezzarobba



---

archive/issue_events_112127.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-08-04T09:27:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112127"
}
```



---

archive/issue_events_112128.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-08-04T09:27:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112128"
}
```



---

archive/issue_comments_152587.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/document_default_precision_for__n___method](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/document_default_precision_for__n___method)\" to \"[fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)\".",
    "created_at": "2016-08-07T20:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13055#issuecomment-152587",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/document_default_precision_for__n___method](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/document_default_precision_for__n___method)" to "[fd79227f589f50f190066f7e636356007544b556](https://github.com/sagemath/sagetrac-mirror/commit/fd79227f589f50f190066f7e636356007544b556)".



---

archive/issue_events_112129.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:00:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112129"
}
```



---

archive/issue_events_112130.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:00:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13055",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13055#event-112130"
}
```
