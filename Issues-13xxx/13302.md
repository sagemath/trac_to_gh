# Issue 13302: Matrix constructor does not return over padic field

archive/issues_013130.json:
```json
{
    "body": "The following code does not return in sage 5.1.rc1.\n\n```\nsage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) \n```\n\nThe problem is that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.\n\nAnother example where the unpacking does not work is the following:\n\n```\nsage: MatrixSpace(Qp(3),1,1)([Qp(3)(4/3)])\n[1 + O(3^20)]\n```\n\nThe problem here is that the iterator returned for a padic (implicitly defined through `__getitem__`) starts at the term with valuation 0.\n\nAssignee: jason, was\n\nKeywords: matrix space\n\nReviewer: Julian Rueth\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/13302\n\n",
    "closed_at": "2012-10-30T08:13:13Z",
    "created_at": "2012-07-27T00:42:48Z",
    "labels": [
        "component: padics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Matrix constructor does not return over padic field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13302",
    "user": "https://github.com/saraedum"
}
```
The following code does not return in sage 5.1.rc1.

```
sage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) 
```

The problem is that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.

Another example where the unpacking does not work is the following:

```
sage: MatrixSpace(Qp(3),1,1)([Qp(3)(4/3)])
[1 + O(3^20)]
```

The problem here is that the iterator returned for a padic (implicitly defined through `__getitem__`) starts at the term with valuation 0.

Assignee: jason, was

Keywords: matrix space

Reviewer: Julian Rueth

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/13302





---

archive/issue_comments_203847.json:
```json
{
    "body": "<a id='comment:1'></a>\n[not relevant anymore]",
    "created_at": "2012-07-27T01:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203847",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>
[not relevant anymore]



---

archive/issue_comments_203848.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-27T01:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203848",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_events_042859.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "rename": {
        "from": "Vector space homomorphism does not return over padic field",
        "to": "Matrix constructor does not return over padic field"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13302#event-42859"
}
```



---

archive/issue_comments_203849.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,7 @@\n The following code does not return in sage 5.1.rc1.\n \n ```\n-sage: V=Qp(3)^1\n-sage: V.hom([V.zero()])\n+sage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) \n ```\n \n The problem is, that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.\n``````\n",
    "created_at": "2012-07-27T01:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203849",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,7 @@
 The following code does not return in sage 5.1.rc1.
 
 ```
-sage: V=Qp(3)^1
-sage: V.hom([V.zero()])
+sage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) 
 ```
 
 The problem is, that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.
``````




---

archive/issue_comments_203850.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-27T02:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203850",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_203851.json:
```json
{
    "body": "<a id='comment:3'></a>\n[moved to description]",
    "created_at": "2012-07-27T02:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203851",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>
[moved to description]



---

archive/issue_comments_203852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,13 @@\n sage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) \n ```\n \n-The problem is, that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.\n+The problem is that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.\n+\n+Another example where the unpacking does not work is the following:\n+\n+```\n+sage: MatrixSpace(Qp(3),1,1)([Qp(3)(4/3)])\n+[1 + O(3^20)]\n+```\n+\n+The problem here is that the iterator returned for a padic (implicitly defined through `__getitem__`) starts at the term with valuation 0.\n``````\n",
    "created_at": "2012-07-27T03:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203852",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,13 @@
 sage: MatrixSpace(Qp(3),1,1)([Qp(3).zero()]) 
 ```
 
-The problem is, that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.
+The problem is that the matrix constructor tries to unpack a padic zero which is an infinite list of zeros.
+
+Another example where the unpacking does not work is the following:
+
+```
+sage: MatrixSpace(Qp(3),1,1)([Qp(3)(4/3)])
+[1 + O(3^20)]
+```
+
+The problem here is that the iterator returned for a padic (implicitly defined through `__getitem__`) starts at the term with valuation 0.
``````




---

archive/issue_comments_203853.json:
```json
{
    "body": "Changing keywords from \"matrix space, padics\" to \"matrix space\".",
    "created_at": "2012-07-27T03:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203853",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "matrix space, padics" to "matrix space".



---

archive/issue_comments_203854.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think that padics should probably not return iterators at all.\n\nWhat should the iterator for `Qp(3).zero()` be \u2014 should it be infinite or empty? Should the iterator for `Zp(3)(3)` and `Qp(3)(3)` iterate over `[0,1]` or over `[1]`?\n\nI believe that if one wants to iterate over the terms, then one should have to call `.list()` or similar explicitly.",
    "created_at": "2012-07-27T03:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203854",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>
I think that padics should probably not return iterators at all.

What should the iterator for `Qp(3).zero()` be â€” should it be infinite or empty? Should the iterator for `Zp(3)(3)` and `Qp(3)(3)` iterate over `[0,1]` or over `[1]`?

I believe that if one wants to iterate over the terms, then one should have to call `.list()` or similar explicitly.



---

archive/issue_comments_203855.json:
```json
{
    "body": "Attachment [trac_13302.patch](tarball://root/attachments/some-uuid/ticket13302/trac_13302.patch) by @saraedum created at 2012-07-27 03:23:42",
    "created_at": "2012-07-27T03:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203855",
    "user": "https://github.com/saraedum"
}
```

Attachment [trac_13302.patch](tarball://root/attachments/some-uuid/ticket13302/trac_13302.patch) by @saraedum created at 2012-07-27 03:23:42



---

archive/issue_comments_203856.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-27T03:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203856",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_203857.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think the real problem is that your example is missing some parentheses\n\n```\nsage: MatrixSpace(Qp(3),1)([[Qp(3).zero()]])\n[0]\nsage: MatrixSpace(Qp(3),1,1)([[Qp(3)(4/3)]])\n[3^-1 + 1 + O(3^19)]\n```\n\nThis causes the matrix constructor to look if it can unpack the element Qp(3).zero()] in the list [Qp(3).zero()] .\n\nIf you want it also to work with fewer parentheses I'd say that it's the fault of MatrixSpace.__call__ not checking if Qp(3).zero() is a ring element before just trying to unpack it.\n\nNote that it's not only the p-adics that give rise to strange behaviour. You can also use polynomials:\n\n```\nsage: K.<x>=QQ[]\nsage: MatrixSpace(K,2)([x+2,3*x+4])\n[2 1]\n[4 3]\n```",
    "created_at": "2012-08-01T09:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203857",
    "user": "https://github.com/koffie"
}
```

<a id='comment:7'></a>
I think the real problem is that your example is missing some parentheses

```
sage: MatrixSpace(Qp(3),1)([[Qp(3).zero()]])
[0]
sage: MatrixSpace(Qp(3),1,1)([[Qp(3)(4/3)]])
[3^-1 + 1 + O(3^19)]
```

This causes the matrix constructor to look if it can unpack the element Qp(3).zero()] in the list [Qp(3).zero()] .

If you want it also to work with fewer parentheses I'd say that it's the fault of MatrixSpace.__call__ not checking if Qp(3).zero() is a ring element before just trying to unpack it.

Note that it's not only the p-adics that give rise to strange behaviour. You can also use polynomials:

```
sage: K.<x>=QQ[]
sage: MatrixSpace(K,2)([x+2,3*x+4])
[2 1]
[4 3]
```



---

archive/issue_comments_203858.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks for pointing this out Maarten.\n\nI'll have a look if the check you propose can be done easily. Btw, the original problem I had was the following:\n\n```\nsage: K=Qp(3)\nsage: V=K^1\nsage: V.hom([V.zero()])\n```\n\nThis hangs and there don't seem to be any parentheses missing, right?\n\nSo apparently the `hom` does too much unpacking along the way.\n\nAnyway, I'll look into this and most probably split this ticket into two tickets, since I still think that padics should not be iterable.",
    "created_at": "2012-08-01T12:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203858",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>
Thanks for pointing this out Maarten.

I'll have a look if the check you propose can be done easily. Btw, the original problem I had was the following:

```
sage: K=Qp(3)
sage: V=K^1
sage: V.hom([V.zero()])
```

This hangs and there don't seem to be any parentheses missing, right?

So apparently the `hom` does too much unpacking along the way.

Anyway, I'll look into this and most probably split this ticket into two tickets, since I still think that padics should not be iterable.



---

archive/issue_comments_203859.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-01T12:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203859",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_203860.json:
```json
{
    "body": "<a id='comment:9'></a>\nhom is broken in even more ways. see the discussion (maybe monologue is more adequate) https://groups.google.com/forum/?fromgroups#!topic/sage-devel/UdHakJf5A5Q \n\nI created #13321 for this.",
    "created_at": "2012-08-01T13:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203860",
    "user": "https://github.com/koffie"
}
```

<a id='comment:9'></a>
hom is broken in even more ways. see the discussion (maybe monologue is more adequate) https://groups.google.com/forum/?fromgroups#!topic/sage-devel/UdHakJf5A5Q 

I created #13321 for this.



---

archive/issue_comments_203861.json:
```json
{
    "body": "<a id='comment:10'></a>\nI created #13592 for the `__iter__` issue. This fixes the issue described here and #13321 takes care of `hom()`, so I believe this ticket can be closed now.",
    "created_at": "2012-10-11T20:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203861",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
I created #13592 for the `__iter__` issue. This fixes the issue described here and #13321 takes care of `hom()`, so I believe this ticket can be closed now.



---

archive/issue_comments_203862.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-11T20:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203862",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_042860.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2012-10-11T20:11:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13302#event-42860"
}
```



---

archive/issue_comments_203863.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-11T20:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203863",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_042861.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-30T08:13:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13302#event-42861"
}
```



---

archive/issue_comments_203864.json:
```json
{
    "body": "Changing author from \"Julian Rueth\" to \"\"",
    "created_at": "2012-10-30T08:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203864",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Julian Rueth" to ""



---

archive/issue_comments_203865.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-10-30T08:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203865",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_comments_203866.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian Rueth\"",
    "created_at": "2012-10-30T08:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13302#issuecomment-203866",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Julian Rueth"
