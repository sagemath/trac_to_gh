# Issue 13012: MatrixSpace is too eager to construct zero matrices

archive/issues_012840.json:
```json
{
    "body": "This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:\n\n```\nsage: m = zero_matrix(2, 3)\nsage: m\n[0 0 0]\n[0 0 0]\nsage: M = MatrixSpace(ZZ, 3, 5)\nsage: M.zero()\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\nsage: M(m)\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n```\nThe last line should have raised an exception. I'm writing a patch.\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @vbraun @kcrisman @rbeezer\n\n**Keywords:** sd40.5\n\n**Reviewer:** William Stein\n\n**Author:** Andrey Novoseltsev\n\n**Merged:** sage-5.1.beta5\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13012\n\n",
    "closed_at": "2012-06-18T10:25:59Z",
    "created_at": "2012-05-25T17:51:22Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "MatrixSpace is too eager to construct zero matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13012",
    "user": "https://github.com/novoselt"
}
```
This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:

```
sage: m = zero_matrix(2, 3)
sage: m
[0 0 0]
[0 0 0]
sage: M = MatrixSpace(ZZ, 3, 5)
sage: M.zero()
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
sage: M(m)
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
```
The last line should have raised an exception. I'm writing a patch.

**Assignee:** @jasongrout, @williamstein

**CC:**  @vbraun @kcrisman @rbeezer

**Keywords:** sd40.5

**Reviewer:** William Stein

**Author:** Andrey Novoseltsev

**Merged:** sage-5.1.beta5

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/13012





---

archive/issue_comments_196627.json:
```json
{
    "body": "**Author:** Andrey Novoseltsev",
    "created_at": "2012-05-25T19:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196627",
    "user": "https://github.com/novoselt"
}
```

**Author:** Andrey Novoseltsev



---

archive/issue_comments_196628.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-05-25T19:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196628",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_196629.json:
```json
{
    "body": "**Work_Issues:** doctests",
    "created_at": "2012-05-25T19:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196629",
    "user": "https://github.com/novoselt"
}
```

**Work_Issues:** doctests



---

archive/issue_comments_196630.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-05-25T19:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196630",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_196631.json:
```json
{
    "body": "<a id='comment:3'></a>\nNot yet finished, but I am doing the following:\n* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);\n* quit automatic determination of \"data as columns\" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;\n* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on \"corner cases\": those who deliberately want to augment or stack matrices should use corresponding methods.\n\nIf you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).",
    "created_at": "2012-05-26T03:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196631",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>
Not yet finished, but I am doing the following:
* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);
* quit automatic determination of "data as columns" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;
* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on "corner cases": those who deliberately want to augment or stack matrices should use corresponding methods.

If you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).



---

archive/attachments_017575.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13012_bug_with_zero_matrices.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13012/trac_13012_bug_with_zero_matrices.patch",
    "created_at": "2012-05-27T02:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_196632.json:
```json
{
    "body": "",
    "created_at": "2012-05-27T02:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196632",
    "user": "https://github.com/novoselt"
}
```





---

archive/issue_comments_196633.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-05-27T03:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196633",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_196634.json:
```json
{
    "body": "<a id='comment:4'></a>\nSummary of what was done:\n* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.\n* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.\n* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.\n\nTwo files had to be adjusted:\n* `linear_code` had code which was very strange, I have rewritten it.\n* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.",
    "created_at": "2012-05-27T03:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196634",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
Summary of what was done:
* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.
* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.
* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.

Two files had to be adjusted:
* `linear_code` had code which was very strange, I have rewritten it.
* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.



---

archive/issue_comments_196635.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-27T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196635",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_196636.json:
```json
{
    "body": "<a id='comment:5'></a>\nLGTM",
    "created_at": "2012-05-27T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196636",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
LGTM



---

archive/issue_comments_196637.json:
```json
{
    "body": "<a id='comment:6'></a>\nPlease fill in your real name in the Author / Reviewer fields.",
    "created_at": "2012-06-09T19:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196637",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Please fill in your real name in the Author / Reviewer fields.



---

archive/issue_comments_196638.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2012-06-09T19:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196638",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** William Stein



---

archive/issue_comments_196639.json:
```json
{
    "body": "**Changing work_issues** from \"doctests\" to \"\".",
    "created_at": "2012-06-18T08:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196639",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work_issues** from "doctests" to "".



---

archive/issue_events_041579.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:25:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13012#event-41579"
}
```



---

archive/issue_comments_196640.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-06-18T10:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196640",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_196641.json:
```json
{
    "body": "**Merged:** sage-5.1.beta5",
    "created_at": "2012-06-18T10:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-196641",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta5
