# Issue 13012: MatrixSpace is too eager to construct zero matrices

archive/issues_012840.json:
```json
{
    "body": "This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:\n\n```\nsage: m = zero_matrix(2, 3)\nsage: m\n[0 0 0]\n[0 0 0]\nsage: M = MatrixSpace(ZZ, 3, 5)\nsage: M.zero()\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\nsage: M(m)\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n```\nThe last line should have raised an exception. I'm writing a patch.\n\nAssignee: jason, was\n\nCC:  @vbraun @kcrisman @rbeezer\n\nKeywords: sd40.5\n\nReviewer: William Stein\n\nAuthor: Andrey Novoseltsev\n\nMerged: sage-5.1.beta5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13012\n\n",
    "closed_at": "2012-06-18T10:25:59Z",
    "created_at": "2012-05-25T17:51:22Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "MatrixSpace is too eager to construct zero matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13012",
    "user": "https://github.com/novoselt"
}
```
This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:

```
sage: m = zero_matrix(2, 3)
sage: m
[0 0 0]
[0 0 0]
sage: M = MatrixSpace(ZZ, 3, 5)
sage: M.zero()
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
sage: M(m)
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
```
The last line should have raised an exception. I'm writing a patch.

Assignee: jason, was

CC:  @vbraun @kcrisman @rbeezer

Keywords: sd40.5

Reviewer: William Stein

Author: Andrey Novoseltsev

Merged: sage-5.1.beta5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13012





---

archive/issue_comments_163939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-25T19:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163939",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163940.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T19:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163940",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163941.json:
```json
{
    "body": "<a id='comment:3'></a>Not yet finished, but I am doing the following:\n* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);\n* quit automatic determination of \"data as columns\" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;\n* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on \"corner cases\": those who deliberately want to augment or stack matrices should use corresponding methods.\n\nIf you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).",
    "created_at": "2012-05-26T03:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163941",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>Not yet finished, but I am doing the following:
* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);
* quit automatic determination of "data as columns" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;
* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on "corner cases": those who deliberately want to augment or stack matrices should use corresponding methods.

If you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).



---

archive/issue_comments_163942.json:
```json
{
    "body": "Attachment [trac_13012_bug_with_zero_matrices.patch](tarball://root/attachments/some-uuid/ticket13012/trac_13012_bug_with_zero_matrices.patch) by @novoselt created at 2012-05-27 02:58:29",
    "created_at": "2012-05-27T02:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163942",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_13012_bug_with_zero_matrices.patch](tarball://root/attachments/some-uuid/ticket13012/trac_13012_bug_with_zero_matrices.patch) by @novoselt created at 2012-05-27 02:58:29



---

archive/issue_comments_163943.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-27T03:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163943",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_163944.json:
```json
{
    "body": "<a id='comment:4'></a>Summary of what was done:\n* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.\n* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.\n* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.\n\nTwo files had to be adjusted:\n* `linear_code` had code which was very strange, I have rewritten it.\n* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.",
    "created_at": "2012-05-27T03:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163944",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>Summary of what was done:
* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.
* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.
* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.

Two files had to be adjusted:
* `linear_code` had code which was very strange, I have rewritten it.
* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.



---

archive/issue_comments_163945.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-27T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163945",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163946.json:
```json
{
    "body": "<a id='comment:5'></a>LGTM",
    "created_at": "2012-05-27T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163946",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>LGTM



---

archive/issue_comments_163947.json:
```json
{
    "body": "<a id='comment:6'></a>Please fill in your real name in the Author / Reviewer fields.",
    "created_at": "2012-06-09T19:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163947",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Please fill in your real name in the Author / Reviewer fields.



---

archive/issue_events_035632.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:25:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13012#event-35632"
}
```



---

archive/issue_comments_163948.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13012#issuecomment-163948",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
