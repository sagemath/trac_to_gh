# Issue 13012: MatrixSpace is too eager to construct zero matrices

archive/issues_012840.json:
```json
{
    "assignees": [],
    "body": "This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:\n\n```\nsage: m = zero_matrix(2, 3)\nsage: m\n[0 0 0]\n[0 0 0]\nsage: M = MatrixSpace(ZZ, 3, 5)\nsage: M.zero()\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\nsage: M(m)\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n```\nThe last line should have raised an exception. I'm writing a patch.\n\nAssignee: **@jasongrout, @williamstein**\n\nCC:  @vbraun @kcrisman @rbeezer\n\nKeywords: **sd40.5**\n\nReviewer: **William Stein**\n\nAuthor: **Andrey Novoseltsev**\n\nMerged: **sage-5.1.beta5**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13012_\n\n",
    "closed_at": "2012-06-18T10:25:59Z",
    "created_at": "2012-05-25T17:51:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "MatrixSpace is too eager to construct zero matrices",
    "type": "issue",
    "updated_at": "2012-06-18T10:25:59Z",
    "url": "https://github.com/sagemath/sage/issues/13012",
    "user": "https://github.com/novoselt"
}
```
This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:

```
sage: m = zero_matrix(2, 3)
sage: m
[0 0 0]
[0 0 0]
sage: M = MatrixSpace(ZZ, 3, 5)
sage: M.zero()
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
sage: M(m)
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
```
The last line should have raised an exception. I'm writing a patch.

Assignee: **@jasongrout, @williamstein**

CC:  @vbraun @kcrisman @rbeezer

Keywords: **sd40.5**

Reviewer: **William Stein**

Author: **Andrey Novoseltsev**

Merged: **sage-5.1.beta5**

_Issue created by migration from https://trac.sagemath.org/ticket/13012_





---

archive/issue_events_159250.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T17:51:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159250"
}
```



---

archive/issue_events_159251.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T17:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159251"
}
```



---

archive/issue_events_159252.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T17:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159252"
}
```



---

archive/issue_events_159253.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T17:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159253"
}
```



---

archive/issue_comments_150230.json:
```json
{
    "body": "Author: **Andrey Novoseltsev**",
    "created_at": "2012-05-25T19:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150230",
    "user": "https://github.com/novoselt"
}
```

Author: **Andrey Novoseltsev**



---

archive/issue_events_159254.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T19:25:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159254"
}
```



---

archive/issue_comments_150231.json:
```json
{
    "body": "Work Issues: **doctests**",
    "created_at": "2012-05-25T19:46:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150231",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **doctests**



---

archive/issue_events_159255.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T19:46:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159255"
}
```



---

archive/issue_events_159256.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-25T19:46:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159256"
}
```



---

archive/issue_comments_150232.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNot yet finished, but I am doing the following:\n* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);\n* quit automatic determination of \"data as columns\" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;\n* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on \"corner cases\": those who deliberately want to augment or stack matrices should use corresponding methods.\n\nIf you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).",
    "created_at": "2012-05-26T03:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150232",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'>Comment 3:</a>
Not yet finished, but I am doing the following:
* concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);
* quit automatic determination of "data as columns" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;
* drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on "corner cases": those who deliberately want to augment or stack matrices should use corresponding methods.

If you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).



---

archive/issue_comments_150233.json:
```json
{
    "body": "Attachment: **[trac_13012_bug_with_zero_matrices.patch.gz](https://github.com/sagemath/sage/files/ticket13012/trac_13012_bug_with_zero_matrices.patch.gz)**",
    "created_at": "2012-05-27T02:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150233",
    "user": "https://github.com/novoselt"
}
```

Attachment: **[trac_13012_bug_with_zero_matrices.patch.gz](https://github.com/sagemath/sage/files/ticket13012/trac_13012_bug_with_zero_matrices.patch.gz)**



---

archive/issue_events_159257.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-27T03:19:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159257"
}
```



---

archive/issue_events_159258.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-27T03:19:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159258"
}
```



---

archive/issue_comments_150234.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nSummary of what was done:\n* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.\n* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.\n* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.\n\nTwo files had to be adjusted:\n* `linear_code` had code which was very strange, I have rewritten it.\n* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.",
    "created_at": "2012-05-27T03:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150234",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'>Comment 4:</a>
Summary of what was done:
* `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.
* `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.
* Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.

Two files had to be adjusted:
* `linear_code` had code which was very strange, I have rewritten it.
* `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.



---

archive/issue_events_159259.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-27T19:43:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159259"
}
```



---

archive/issue_events_159260.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-27T19:43:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159260"
}
```



---

archive/issue_comments_150235.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nLGTM",
    "created_at": "2012-05-27T19:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150235",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'>Comment 5:</a>
LGTM



---

archive/issue_comments_150236.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nPlease fill in your real name in the Author / Reviewer fields.",
    "created_at": "2012-06-09T19:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150236",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
Please fill in your real name in the Author / Reviewer fields.



---

archive/issue_comments_150237.json:
```json
{
    "body": "Reviewer: **William Stein**",
    "created_at": "2012-06-09T19:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150237",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **William Stein**



---

archive/issue_comments_150238.json:
```json
{
    "body": "Changed work issues from **doctests** to none",
    "created_at": "2012-06-18T08:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150238",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **doctests** to none



---

archive/issue_events_159261.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:25:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159261"
}
```



---

archive/issue_events_159262.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:25:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13012#event-159262"
}
```



---

archive/issue_comments_150239.json:
```json
{
    "body": "Merged: **sage-5.1.beta5**",
    "created_at": "2012-06-18T10:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13012",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13012#issuecomment-150239",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.1.beta5**
