# Issue 13245: sage --clone: do not rebuild the entire Sage library, and do not rebuild the docs

archive/issues_013073.json:
```json
{
    "body": "With the attached patches, `sage --clone`\n\n* does no longer rebuild the reference manual,\n\n* does no longer unnecessarily rebuild the whole Sage library (just because of a missing Cython version file).\n\nIn e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.\n\nThe unintended rebuild of all extension modules upon cloning is a bug introduced by #13031.\n \n---\n\nApply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].\n\n\n**Assignee:** @nexttime\n\n**CC:**  @nthiery @saliola @nexttime @hivert @jdemeyer\n\n**Reviewer:** John Palmieri, Travis Scrimshaw, Leif Leonhardy\n\n**Author:** John Palmieri, Leif Leonhardy\n\n**Merged:** sage-5.10.rc2\n\n**Dependencies:** #14721\n\nIssue created by migration from https://trac.sagemath.org/ticket/13245\n\n",
    "closed_at": "2013-06-13T08:21:11Z",
    "created_at": "2012-07-12T23:38:22Z",
    "labels": [
        "component: scripts",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "title": "sage --clone: do not rebuild the entire Sage library, and do not rebuild the docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13245",
    "user": "https://github.com/jhpalmieri"
}
```
With the attached patches, `sage --clone`

* does no longer rebuild the reference manual,

* does no longer unnecessarily rebuild the whole Sage library (just because of a missing Cython version file).

In e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.

The unintended rebuild of all extension modules upon cloning is a bug introduced by #13031.
 
---

Apply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].


**Assignee:** @nexttime

**CC:**  @nthiery @saliola @nexttime @hivert @jdemeyer

**Reviewer:** John Palmieri, Travis Scrimshaw, Leif Leonhardy

**Author:** John Palmieri, Leif Leonhardy

**Merged:** sage-5.10.rc2

**Dependencies:** #14721

Issue created by migration from https://trac.sagemath.org/ticket/13245





---

archive/issue_comments_154960.json:
```json
{
    "body": "scripts repo",
    "created_at": "2012-07-12T23:39:08Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154960",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/attachments_017927.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13245-clone-docbuild.patch",
    "asset_url": "tarball://root/attachments/ticket13245/trac_13245-clone-docbuild.patch",
    "created_at": "2012-07-12T23:39:54Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-docbuild.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_154961.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_13245-clone-docbuild.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-docbuild.patch) by @jhpalmieri created at 2012-07-12 23:39:54",
    "created_at": "2012-07-12T23:39:54Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154961",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
Attachment [trac_13245-clone-docbuild.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-docbuild.patch) by @jhpalmieri created at 2012-07-12 23:39:54



---

archive/issue_events_112138.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-07-12T23:39:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112138"
}
```



---

archive/attachments_017928.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13245-clone-nodocbuild.patch",
    "asset_url": "tarball://root/attachments/ticket13245/trac_13245-clone-nodocbuild.patch",
    "created_at": "2013-03-11T17:55:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-nodocbuild.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_154962.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [trac_13245-clone-nodocbuild.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-nodocbuild.patch) by @jhpalmieri created at 2013-03-11 17:55:39\n\nHere is a different patch; this one just turns off docbuilding in `sage-clone` altogether.",
    "created_at": "2013-03-11T17:55:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154962",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Attachment [trac_13245-clone-nodocbuild.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-nodocbuild.patch) by @jhpalmieri created at 2013-03-11 17:55:39

Here is a different patch; this one just turns off docbuilding in `sage-clone` altogether.



---

archive/issue_comments_154963.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.\n \n+Apply [attachment:trac_13245-clone-nodocbuild.patch].\n``````\n",
    "created_at": "2013-03-11T17:55:39Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154963",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.
 
+Apply [attachment:trac_13245-clone-nodocbuild.patch].
``````




---

archive/issue_comments_154964.json:
```json
{
    "body": "<a id='comment:3'></a>\nPing.\n\n\n\n\nNot directly related, but meanwhile `sage-clone` also regenerates **all** Cython-generated files, because we don't copy `.cython_version`, which is fixed by:\n\n```patch\ndiff --git a/sage-clone b/sage-clone\n--- a/sage-clone\n+++ b/sage-clone\n@@ -53,6 +53,10 @@\n\n cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))\n\n+if os.path.isfile('sage/.cython_version'):\n+    print \"Copying over hidden Cython version file...\"\n+    os.link('sage/.cython_version', branch+'/.cython_version')\n+\n def copy_dtree(src_dir, dest_dir):\n     src_root = os.path.abspath(src_dir)\n     dest_root = os.path.abspath(dest_dir)\n```\n\n\n\n\nBut there are other issues as well (e.g. rebuilding the `fast_callable` interpreters, which IMHO isn't necessary either).",
    "created_at": "2013-05-15T12:53:27Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154964",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Ping.




Not directly related, but meanwhile `sage-clone` also regenerates **all** Cython-generated files, because we don't copy `.cython_version`, which is fixed by:

```patch
diff --git a/sage-clone b/sage-clone
--- a/sage-clone
+++ b/sage-clone
@@ -53,6 +53,10 @@

 cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))

+if os.path.isfile('sage/.cython_version'):
+    print "Copying over hidden Cython version file..."
+    os.link('sage/.cython_version', branch+'/.cython_version')
+
 def copy_dtree(src_dir, dest_dir):
     src_root = os.path.abspath(src_dir)
     dest_root = os.path.abspath(dest_dir)
```




But there are other issues as well (e.g. rebuilding the `fast_callable` interpreters, which IMHO isn't necessary either).



---

archive/issue_comments_154965.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [leif](#comment%3A3):\n> But there are other issues as well (e.g. rebuilding the `fast_callable` interpreters, which IMHO isn't necessary either).\n\n\nOh, forgot:  Cython-generated header files (`*.h`) don't contain a special comment on that on the first line (which is probably an upstream Cython bug), so the following currently doesn't work as expected either:\n\n```python\n            if ext in ['.h', '.c', '.cpp']:\n                if 'Cython' in open(src + '/' + F).readline():\n                    os.link(src + '/' + F, dest + '/' +F)\n                    os.utime(dest + '/' +F, None)\n```\n\n(For the moment, we could look for `^#ifndef __PYX_HAVE__sage__` in those, probably even without the `sage__`.)",
    "created_at": "2013-05-15T13:08:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154965",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
Replying to [leif](#comment%3A3):
> But there are other issues as well (e.g. rebuilding the `fast_callable` interpreters, which IMHO isn't necessary either).


Oh, forgot:  Cython-generated header files (`*.h`) don't contain a special comment on that on the first line (which is probably an upstream Cython bug), so the following currently doesn't work as expected either:

```python
            if ext in ['.h', '.c', '.cpp']:
                if 'Cython' in open(src + '/' + F).readline():
                    os.link(src + '/' + F, dest + '/' +F)
                    os.utime(dest + '/' +F, None)
```

(For the moment, we could look for `^#ifndef __PYX_HAVE__sage__` in those, probably even without the `sage__`.)



---

archive/issue_comments_154966.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.\n \n-Apply [attachment:trac_13245-clone-nodocbuild.patch].\n+Apply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].\n``````\n",
    "created_at": "2013-05-15T22:10:54Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154966",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.
 
-Apply [attachment:trac_13245-clone-nodocbuild.patch].
+Apply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].
``````




---

archive/issue_comments_154967.json:
```json
{
    "body": "<a id='comment:5'></a>\nOkay, here is a patch to deal with the `.h` files and `.cython_version`. Rebuilding the fast_callable interpreters doesn't take too much time, so I'm not dealing with it right now. Leif, would you like to be listed as an author?",
    "created_at": "2013-05-15T22:10:54Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154967",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Okay, here is a patch to deal with the `.h` files and `.cython_version`. Rebuilding the fast_callable interpreters doesn't take too much time, so I'm not dealing with it right now. Leif, would you like to be listed as an author?



---

archive/attachments_017929.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13245-clone-cython.patch",
    "asset_url": "tarball://root/attachments/ticket13245/trac_13245-clone-cython.patch",
    "created_at": "2013-05-15T22:11:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-cython.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_154968.json:
```json
{
    "body": "Attachment [trac_13245-clone-cython.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-cython.patch) by @jhpalmieri created at 2013-05-15 22:11:12",
    "created_at": "2013-05-15T22:11:12Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154968",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13245-clone-cython.patch](https://github.com/sagemath/sage/files/ticket13245/trac_13245-clone-cython.patch) by @jhpalmieri created at 2013-05-15 22:11:12



---

archive/issue_comments_154969.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> Rebuilding the fast_callable interpreters doesn't take too much time, so I'm not dealing with it right now.\n\n\nYes, but it also triggers the rebuild of (currently) at least one *other* Cython module (besides the newly generated five `sage.ext.interpreters.wrapper_*.pyx`):\n\n```\n...\nBuilding interpreters for fast_callable\nUpdating Cython code....\nCompiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.\n...\nbuilding 'sage.plot.plot3d.parametric_surface' extension\n...\n```\n\n(I think we could just copy over *all* files in `sage/ext/interpreters/`, which is in `.hgignore`.)\n\nNote sure what or whether doc-rebuilding is triggered (upon next `sage --docbuild ...`) by rebuilding the interpreters though.\n\n\n\n\nCould you explain why we \"touch\" almost all manually copied (more precisely, linked) files?\n\n\n\n\n> Leif, would you like to be listed as an author?\n\n\nDoes the patch introduce new environment variables? :P\n\n\n\n\n[Haven't tried the patches here yet.]",
    "created_at": "2013-05-16T13:33:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154969",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A5):
> Rebuilding the fast_callable interpreters doesn't take too much time, so I'm not dealing with it right now.


Yes, but it also triggers the rebuild of (currently) at least one *other* Cython module (besides the newly generated five `sage.ext.interpreters.wrapper_*.pyx`):

```
...
Building interpreters for fast_callable
Updating Cython code....
Compiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.
...
building 'sage.plot.plot3d.parametric_surface' extension
...
```

(I think we could just copy over *all* files in `sage/ext/interpreters/`, which is in `.hgignore`.)

Note sure what or whether doc-rebuilding is triggered (upon next `sage --docbuild ...`) by rebuilding the interpreters though.




Could you explain why we "touch" almost all manually copied (more precisely, linked) files?




> Leif, would you like to be listed as an author?


Does the patch introduce new environment variables? :P




[Haven't tried the patches here yet.]



---

archive/issue_comments_154970.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [leif](#comment%3A6):\n> Could you explain why we \"touch\" almost all manually copied (more precisely, linked) files?\n\n\nOk, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)",
    "created_at": "2013-05-16T13:53:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154970",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Replying to [leif](#comment%3A6):
> Could you explain why we "touch" almost all manually copied (more precisely, linked) files?


Ok, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)



---

archive/issue_comments_154971.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [leif](#comment%3A7):\n> Replying to [leif](#comment%3A6):\n> > Could you explain why we \"touch\" almost all manually copied (more precisely, linked) files?\n\n> \n> Ok, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)\n\n\nOr change back the modification times of the files (of the working copy) Mercurial created... ;-)\n\nOMG.",
    "created_at": "2013-05-16T14:10:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154971",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Replying to [leif](#comment%3A7):
> Replying to [leif](#comment%3A6):
> > Could you explain why we "touch" almost all manually copied (more precisely, linked) files?

> 
> Ok, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)


Or change back the modification times of the files (of the working copy) Mercurial created... ;-)

OMG.



---

archive/issue_comments_154972.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [leif](#comment%3A8):\n> Replying to [leif](#comment%3A7):\n> > Ok, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)\n\n> \n> Or change back the modification times of the files (of the working copy) Mercurial created... ;-)\n> \n> OMG.\n\n\n[Thank you, nanny!](http://mercurial.selenic.com/wiki/FAQ#FAQ.2FCommonProblems.Why_is_the_modification_time_of_files_not_restored_on_checkout.3F)\n\n(How about making this optional?!?)",
    "created_at": "2013-05-16T14:43:56Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154972",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
Replying to [leif](#comment%3A8):
> Replying to [leif](#comment%3A7):
> > Ok, seems like Mercurial is to blame.  We could use `hg clone -U` though instead, and create the working copy by ourselves.  (Not tested.)

> 
> Or change back the modification times of the files (of the working copy) Mercurial created... ;-)
> 
> OMG.


[Thank you, nanny!](http://mercurial.selenic.com/wiki/FAQ#FAQ.2FCommonProblems.Why_is_the_modification_time_of_files_not_restored_on_checkout.3F)

(How about making this optional?!?)



---

archive/issue_comments_154973.json:
```json
{
    "body": "<a id='comment:10'></a>\nSince apparently `hg archive` (meanwhile?) doesn't preserve modification times either, we could use `hg clone -U` and some `cp -pPR` of `hg manifest` magic instead (of plain `hg clone`).",
    "created_at": "2013-05-16T15:44:32Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154973",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Since apparently `hg archive` (meanwhile?) doesn't preserve modification times either, we could use `hg clone -U` and some `cp -pPR` of `hg manifest` magic instead (of plain `hg clone`).



---

archive/issue_comments_154974.json:
```json
{
    "body": "<a id='comment:11'></a>\nGiven the upcoming transition to git, I don't think it's worth trying to wrestle with Mercurial very much. I don't want to spend much more time on it, anyway.",
    "created_at": "2013-05-16T17:29:55Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154974",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Given the upcoming transition to git, I don't think it's worth trying to wrestle with Mercurial very much. I don't want to spend much more time on it, anyway.



---

archive/issue_comments_154975.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jhpalmieri](#comment%3A11):\n> Given the upcoming transition to git, I don't think it's worth trying to wrestle with Mercurial very much. I don't want to spend much more time on it, anyway.\n\n\nYes, hopefully.\n\nAnyway, the title (and parts of the description) still advertise *an option* to disable docbuilding, but the currently listed patch just disables it unconditionally.  Which way do we want to go?",
    "created_at": "2013-05-16T17:33:31Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154975",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Replying to [jhpalmieri](#comment%3A11):
> Given the upcoming transition to git, I don't think it's worth trying to wrestle with Mercurial very much. I don't want to spend much more time on it, anyway.


Yes, hopefully.

Anyway, the title (and parts of the description) still advertise *an option* to disable docbuilding, but the currently listed patch just disables it unconditionally.  Which way do we want to go?



---

archive/issue_comments_154976.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think it makes more sense not to build the docs at all. But I don't use `sage --clone` myself, I only opened this in response to experiences of various sage-combinat users.",
    "created_at": "2013-05-16T19:39:41Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154976",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
I think it makes more sense not to build the docs at all. But I don't use `sage --clone` myself, I only opened this in response to experiences of various sage-combinat users.



---

archive/issue_comments_154977.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2013-05-31T18:55:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154977",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_154978.json:
```json
{
    "body": "<a id='comment:14'></a>\nI think that rebuilding the files in `sage/ext/interpreters/` is because of code in `devel/sage/setup.py`, and any changes to this should be on another ticket.\n\nMeanwhile, the patch [attachment:trac_13245-clone-cython.patch] seems to fix the main cloning problem. I'm happy with that one.",
    "created_at": "2013-05-31T18:55:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154978",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I think that rebuilding the files in `sage/ext/interpreters/` is because of code in `devel/sage/setup.py`, and any changes to this should be on another ticket.

Meanwhile, the patch [attachment:trac_13245-clone-cython.patch] seems to fix the main cloning problem. I'm happy with that one.



---

archive/issue_events_112139.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-31T18:55:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "rename": {
        "from": "sage --clone: give option to not rebuild the docs",
        "to": "sage --clone: do not rebuild the entire Sage library, and do not rebuild the docs"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112139"
}
```



---

archive/issue_comments_154979.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Leif Leonhardy\".",
    "created_at": "2013-05-31T18:55:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154979",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Leif Leonhardy".



---

archive/issue_comments_154980.json:
```json
{
    "body": "<a id='comment:15'></a>\nAdjusting priority to reflect the changed subject.\n\nWill try to finally review this asap...",
    "created_at": "2013-06-06T08:20:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154980",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Adjusting priority to reflect the changed subject.

Will try to finally review this asap...



---

archive/issue_events_112140.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-06T08:20:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112140"
}
```



---

archive/issue_events_112141.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-06T08:20:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112141"
}
```



---

archive/issue_events_112142.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-06T08:21:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112142"
}
```



---

archive/issue_events_112143.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-06T08:21:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112143"
}
```



---

archive/issue_comments_154981.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n-With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.\n+With the attached patches, `sage --clone`\n+\n+* does no longer rebuild the reference manual,\n+\n+* does no longer unnecessarily rebuild the whole Sage library (just because of a missing Cython version file).\n+\n+In e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.\n+\n+The unintended rebuild of all extension modules is a bug introduced by #13031.\n+ \n+---\n \n Apply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].\n+\n``````\n",
    "created_at": "2013-06-06T17:04:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154981",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
-With the attached patch, passing the argument `-N` to `sage -clone` says not to rebuild the reference manual. The patch also uses the option during the clone in the `sage-combinat` script: there are usually so many patches applied in the queue, it would make more sense to build the manual after applying the patches, not before.
+With the attached patches, `sage --clone`
+
+* does no longer rebuild the reference manual,
+
+* does no longer unnecessarily rebuild the whole Sage library (just because of a missing Cython version file).
+
+In e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.
+
+The unintended rebuild of all extension modules is a bug introduced by #13031.
+ 
+---
 
 Apply [attachment:trac_13245-clone-nodocbuild.patch] and [attachment:trac_13245-clone-cython.patch].
+
``````




---

archive/issue_comments_154982.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n \n In e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.\n \n-The unintended rebuild of all extension modules is a bug introduced by #13031.\n+The unintended rebuild of all extension modules upon cloning is a bug introduced by #13031.\n  \n ---\n \n``````\n",
    "created_at": "2013-06-06T17:06:31Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154982",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 
 In e.g. the `sage-combinat` script, there are usually so many patches applied in the queue, it makes more sense to (re)build the manual **after** applying the patches, not before.
 
-The unintended rebuild of all extension modules is a bug introduced by #13031.
+The unintended rebuild of all extension modules upon cloning is a bug introduced by #13031.
  
 ---
 
``````




---

archive/issue_comments_154983.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [leif](#comment%3A4):\n> Oh, forgot:  Cython-generated header files (`*.h`) don't contain a special comment on that on the first line (which is probably an upstream Cython bug), so the following currently doesn't work as expected either:\n> \n> ```python\n>             if ext in ['.h', '.c', '.cpp']:\n>                 if 'Cython' in open(src + '/' + F).readline():\n>                     os.link(src + '/' + F, dest + '/' +F)\n>                     os.utime(dest + '/' +F, None)\n> ```\n> \n> (For the moment, we could look for `^#ifndef __PYX_HAVE__sage__` in those, probably even without the `sage__`.)\n\n\n\n\n \n\nI'm having another header file in the original but not the clone:\n\n`sage/rings/complex_double_api.h`, which starts with\n\n```c\n#ifndef __PYX_HAVE_API__sage__rings__complex_double\n#define __PYX_HAVE_API__sage__rings__complex_double\n#include \"Python.h\"\n#include \"complex_double.h\"\n\nstatic struct __pyx_obj_4sage_5rings_14complex_double_ComplexDoubleElement *(*__pyx_f_4sage_5rings_14complex_double_new_ComplexDoubleElement)(void) = 0;\n#define new_ComplexDoubleElement __pyx_f_4sage_5rings_14complex_double_new_ComplexDoubleElement\n\n#ifndef __PYX_HAVE_RT_ImportModule\n#define __PYX_HAVE_RT_ImportModule\n```\n\n(and is explicitly listed in `.hgignore`).\n\nI couldn't find any places where this is actually used though, nor do I know where it originates from.",
    "created_at": "2013-06-06T17:49:35Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154983",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [leif](#comment%3A4):
> Oh, forgot:  Cython-generated header files (`*.h`) don't contain a special comment on that on the first line (which is probably an upstream Cython bug), so the following currently doesn't work as expected either:
> 
> ```python
>             if ext in ['.h', '.c', '.cpp']:
>                 if 'Cython' in open(src + '/' + F).readline():
>                     os.link(src + '/' + F, dest + '/' +F)
>                     os.utime(dest + '/' +F, None)
> ```
> 
> (For the moment, we could look for `^#ifndef __PYX_HAVE__sage__` in those, probably even without the `sage__`.)




 

I'm having another header file in the original but not the clone:

`sage/rings/complex_double_api.h`, which starts with

```c
#ifndef __PYX_HAVE_API__sage__rings__complex_double
#define __PYX_HAVE_API__sage__rings__complex_double
#include "Python.h"
#include "complex_double.h"

static struct __pyx_obj_4sage_5rings_14complex_double_ComplexDoubleElement *(*__pyx_f_4sage_5rings_14complex_double_new_ComplexDoubleElement)(void) = 0;
#define new_ComplexDoubleElement __pyx_f_4sage_5rings_14complex_double_new_ComplexDoubleElement

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
```

(and is explicitly listed in `.hgignore`).

I couldn't find any places where this is actually used though, nor do I know where it originates from.



---

archive/issue_comments_154984.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [leif](#comment%3A19):\n> I'm having another header file in the original but not the clone:\n> \n> `sage/rings/complex_double_api.h` [...]\n> (and is explicitly listed in `.hgignore`).\n> \n> I couldn't find any places where this is actually used though, nor do I know where it originates from.\n\n\nAlthough it looks Cython-generated, it doesn't get recreated when I touch `complex_double*` sources.\n\nIt *seems*<sup>TM</sup> to be some left-over file we still ship, despite it being in `.hgignore`; the file date is July 9th 2012...\n\nSo it apparently doesn't matter whether we copy / link it or not, but I feel a bit uncomfortable.",
    "created_at": "2013-06-06T18:25:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154984",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Replying to [leif](#comment%3A19):
> I'm having another header file in the original but not the clone:
> 
> `sage/rings/complex_double_api.h` [...]
> (and is explicitly listed in `.hgignore`).
> 
> I couldn't find any places where this is actually used though, nor do I know where it originates from.


Although it looks Cython-generated, it doesn't get recreated when I touch `complex_double*` sources.

It *seems*<sup>TM</sup> to be some left-over file we still ship, despite it being in `.hgignore`; the file date is July 9th 2012...

So it apparently doesn't matter whether we copy / link it or not, but I feel a bit uncomfortable.



---

archive/issue_comments_154985.json:
```json
{
    "body": "<a id='comment:21'></a>\nI think that being in `MANIFEST.in` is more relevant to what we ship than being in `.hgignore`, since as far as I can tell, we're using Python's distutils to produce the Sage library spkg (by calling `python setup.py sdist` in `devel/sage/spkg-dist`). I'll try deleting the file and running the full test suite...",
    "created_at": "2013-06-06T18:46:58Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154985",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
I think that being in `MANIFEST.in` is more relevant to what we ship than being in `.hgignore`, since as far as I can tell, we're using Python's distutils to produce the Sage library spkg (by calling `python setup.py sdist` in `devel/sage/spkg-dist`). I'll try deleting the file and running the full test suite...



---

archive/issue_comments_154986.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [leif](#comment%3A20):\n> Replying to [leif](#comment%3A19):\n> > I'm having another header file in the original but not the clone:\n> > \n> > `sage/rings/complex_double_api.h` [...]\n> > (and is explicitly listed in `.hgignore`).\n> > \n> > I couldn't find any places where this is actually used though, nor do I know where it originates from.\n\n> \n> Although it looks Cython-generated, it doesn't get recreated when I touch `complex_double*` sources.\n> \n> It *seems*<sup>TM</sup> to be some left-over file we still ship, despite it being in `.hgignore`; the file date is July 9th 2012...\n\n\nSee #14700 for removing some (shipped but) unused files.",
    "created_at": "2013-06-07T11:41:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154986",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [leif](#comment%3A20):
> Replying to [leif](#comment%3A19):
> > I'm having another header file in the original but not the clone:
> > 
> > `sage/rings/complex_double_api.h` [...]
> > (and is explicitly listed in `.hgignore`).
> > 
> > I couldn't find any places where this is actually used though, nor do I know where it originates from.

> 
> Although it looks Cython-generated, it doesn't get recreated when I touch `complex_double*` sources.
> 
> It *seems*<sup>TM</sup> to be some left-over file we still ship, despite it being in `.hgignore`; the file date is July 9th 2012...


See #14700 for removing some (shipped but) unused files.



---

archive/issue_comments_154987.json:
```json
{
    "body": "<a id='comment:23'></a>\nHmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).\n\nI've made sure that the documentation (and the Sage library) is up-to-date, but if I run `sage --docbuild reference html` afterwards in a fresh clone, apparently *everything* (of the reference manual) gets rebuilt.\n\nIt says\n\n```\n[foo] building [html]: targets for N source files that are out of date\n[foo] updating environment: 0 added, N changed, 0 removed\n...\n```\nfor all components AFAICS.\n\n(This is with 5.10.rc0.)",
    "created_at": "2013-06-07T15:25:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154987",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Hmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).

I've made sure that the documentation (and the Sage library) is up-to-date, but if I run `sage --docbuild reference html` afterwards in a fresh clone, apparently *everything* (of the reference manual) gets rebuilt.

It says

```
[foo] building [html]: targets for N source files that are out of date
[foo] updating environment: 0 added, N changed, 0 removed
...
```
for all components AFAICS.

(This is with 5.10.rc0.)



---

archive/issue_comments_154988.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [leif](#comment%3A23):\n> [...] if I run `sage --docbuild reference html` afterwards in a fresh clone, apparently *everything* (of the reference manual) gets rebuilt.\n> \n> It says\n> \n> ```\n> [foo] building [html]: targets for N source files that are out of date\n> [foo] updating environment: 0 added, N changed, 0 removed\n> ...\n> ```\n> for all components AFAICS.\n\n\nThe same happens when I switch back to the main branch and (re)run `sage --docbuild reference html`.",
    "created_at": "2013-06-07T15:52:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154988",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Replying to [leif](#comment%3A23):
> [...] if I run `sage --docbuild reference html` afterwards in a fresh clone, apparently *everything* (of the reference manual) gets rebuilt.
> 
> It says
> 
> ```
> [foo] building [html]: targets for N source files that are out of date
> [foo] updating environment: 0 added, N changed, 0 removed
> ...
> ```
> for all components AFAICS.


The same happens when I switch back to the main branch and (re)run `sage --docbuild reference html`.



---

archive/issue_comments_154989.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [leif](#comment%3A23):\n> Hmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).\n\n\nI think that it makes sense, but it doesn't work as expected. That is, if you clone the Sage library, you should still be able to find documentation in the usual place. The fact that it needs to be rebuilt is annoying (although less so, now that the docs don't take as long to rebuild), and a bug with Sphinx or mercurial or something we do, I'm not sure which. It's been an issue with cloning for years, and it's never been resolved satisfactorily.\n\nI don't know if cloning is even going to be part of the new git workflow, whenever that arrives. In any case, I don't feel like spending any energy to try to fix this problem.",
    "created_at": "2013-06-07T17:03:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154989",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
Replying to [leif](#comment%3A23):
> Hmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).


I think that it makes sense, but it doesn't work as expected. That is, if you clone the Sage library, you should still be able to find documentation in the usual place. The fact that it needs to be rebuilt is annoying (although less so, now that the docs don't take as long to rebuild), and a bug with Sphinx or mercurial or something we do, I'm not sure which. It's been an issue with cloning for years, and it's never been resolved satisfactorily.

I don't know if cloning is even going to be part of the new git workflow, whenever that arrives. In any case, I don't feel like spending any energy to try to fix this problem.



---

archive/issue_comments_154990.json:
```json
{
    "body": "<a id='comment:26'></a>\nFWIW,\n\n```diff\n\ndiff --git a/sage-clone b/sage-clone\n--- a/sage-clone\n+++ b/sage-clone\n@@ -90,7 +90,7 @@\n                     fr = os.path.join(ref, f, directory)\n                     if os.path.exists(fr):\n                         to = os.path.join(branch, 'doc', lang, 'reference', f, directory)\n-                        cmd = 'cp -pR %s %s' % (fr, to)\n+                        cmd = 'cp -R %s %s' % (fr, to)\n                         subprocess.call([cmd], shell=True)\n     except:\n         pass\n```\n(alone, at least) doesn't make a difference.",
    "created_at": "2013-06-07T17:20:02Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154990",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
FWIW,

```diff

diff --git a/sage-clone b/sage-clone
--- a/sage-clone
+++ b/sage-clone
@@ -90,7 +90,7 @@
                     fr = os.path.join(ref, f, directory)
                     if os.path.exists(fr):
                         to = os.path.join(branch, 'doc', lang, 'reference', f, directory)
-                        cmd = 'cp -pR %s %s' % (fr, to)
+                        cmd = 'cp -R %s %s' % (fr, to)
                         subprocess.call([cmd], shell=True)
     except:
         pass
```
(alone, at least) doesn't make a difference.



---

archive/issue_comments_154991.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A25):\n> Replying to [leif](#comment%3A23):\n> > Hmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).\n\n> \n> I think that it makes sense, but it doesn't work as expected.\n\n\nI meant that we should either drop copying over any \"pre-built\" documentation (since it doesn't work -- there's apparently no difference to building all from scratch), or fix rebuilding [all of it].\n\nSince we both seem to be unable to do (or don't want to spend time on) the latter, I think we should go with the former.\n\n\n\n\n> That is, if you clone the Sage library, you should still be able to find documentation in the usual place.\n\n\n? I don't understand what you mean by that; `$SAGE_ROOT/devel/sage-main/doc/output/...` at least is always there.\n\n\n\n\n> I don't know if cloning is even going to be part of the new git workflow, whenever that arrives.\n\n\nI don't see why cloning should vanish with the switch to git.\n\n\n\n\n> In any case, I don't feel like spending any energy to try to fix this problem.\n\n\nMe neither.",
    "created_at": "2013-06-07T17:35:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154991",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A25):
> Replying to [leif](#comment%3A23):
> > Hmmm, did some testing, and it seems copying over any already built documentation doesn't make sense (or doesn't work as expected at least).

> 
> I think that it makes sense, but it doesn't work as expected.


I meant that we should either drop copying over any "pre-built" documentation (since it doesn't work -- there's apparently no difference to building all from scratch), or fix rebuilding [all of it].

Since we both seem to be unable to do (or don't want to spend time on) the latter, I think we should go with the former.




> That is, if you clone the Sage library, you should still be able to find documentation in the usual place.


? I don't understand what you mean by that; `$SAGE_ROOT/devel/sage-main/doc/output/...` at least is always there.




> I don't know if cloning is even going to be part of the new git workflow, whenever that arrives.


I don't see why cloning should vanish with the switch to git.




> In any case, I don't feel like spending any energy to try to fix this problem.


Me neither.



---

archive/issue_comments_154992.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [leif](#comment%3A27):\n> Replying to [jhpalmieri](#comment%3A25):\n> > That is, if you clone the Sage library, you should still be able to find documentation in the usual place.\n\n> \n> ? I don't understand what you mean by that; `$SAGE_ROOT/devel/sage-main/doc/output/...` at least is always there.\n\n\nI want it to be available in `$SAGE_ROOT/devel/sage/doc/output/...`. If you run `tutorial()` or `reference()` from within Sage, it should open up documentation, for example.",
    "created_at": "2013-06-07T18:36:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154992",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
Replying to [leif](#comment%3A27):
> Replying to [jhpalmieri](#comment%3A25):
> > That is, if you clone the Sage library, you should still be able to find documentation in the usual place.

> 
> ? I don't understand what you mean by that; `$SAGE_ROOT/devel/sage-main/doc/output/...` at least is always there.


I want it to be available in `$SAGE_ROOT/devel/sage/doc/output/...`. If you run `tutorial()` or `reference()` from within Sage, it should open up documentation, for example.



---

archive/issue_comments_154993.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [leif](#comment%3A27):\n> Replying to [jhpalmieri](#comment%3A25):\n> > I don't know if cloning is even going to be part of the new git workflow, whenever that arrives.\n\n> \n> I don't see why cloning should vanish with the switch to git.\n\n\nOkay, but cloning will have to be rewritten to use git instead of mercurial. I don't know what affect that will have on modification times and other issues relating to rebuilding the documentation.",
    "created_at": "2013-06-07T18:46:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154993",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
Replying to [leif](#comment%3A27):
> Replying to [jhpalmieri](#comment%3A25):
> > I don't know if cloning is even going to be part of the new git workflow, whenever that arrives.

> 
> I don't see why cloning should vanish with the switch to git.


Okay, but cloning will have to be rewritten to use git instead of mercurial. I don't know what affect that will have on modification times and other issues relating to rebuilding the documentation.



---

archive/issue_comments_154994.json:
```json
{
    "body": "<a id='comment:30'></a>\nWhat's most annoying to me is that the whole documentation gets rebuilt (upon `sage --docbuild reference html`) when I switch back to the original branch (which is supposed to be left untouched).\n\n(I can't believe that's always been the case, at least I don't recall having ever experienced that, but perhaps I simply never tried.)\n\nIt seems `python setup.py install` somehow doesn't play well with Sphinx...",
    "created_at": "2013-06-07T18:52:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154994",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
What's most annoying to me is that the whole documentation gets rebuilt (upon `sage --docbuild reference html`) when I switch back to the original branch (which is supposed to be left untouched).

(I can't believe that's always been the case, at least I don't recall having ever experienced that, but perhaps I simply never tried.)

It seems `python setup.py install` somehow doesn't play well with Sphinx...



---

archive/issue_comments_154995.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jhpalmieri](#comment%3A28):\n> If you run `tutorial()` or `reference()` from within Sage, it should open up documentation, for example.\n\n\nI did not even know these commands... :-)\n\nShouldn't they get advertised in the startup banner?",
    "created_at": "2013-06-07T19:03:27Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154995",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>
Replying to [jhpalmieri](#comment%3A28):
> If you run `tutorial()` or `reference()` from within Sage, it should open up documentation, for example.


I did not even know these commands... :-)

Shouldn't they get advertised in the startup banner?



---

archive/issue_comments_154996.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe startup banner says `Type \"help()\" for help.`. If you type `help()`, you get information about these commands.",
    "created_at": "2013-06-07T19:48:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154996",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
The startup banner says `Type "help()" for help.`. If you type `help()`, you get information about these commands.



---

archive/issue_comments_154997.json:
```json
{
    "body": "<a id='comment:33'></a>\nI tried this with `5.10.rc1` by applying the patches to the script repo (`$SAGE_ROOT/local/bin`), then running\n\n```\nsage -combinat install\n```\nand all of the extensions are being rebuilt for me. Did I need to run `sage -b` first? (I did like the fact that I didn't have to wait for the doc to be rebuilt.)",
    "created_at": "2013-06-10T06:10:08Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154997",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>
I tried this with `5.10.rc1` by applying the patches to the script repo (`$SAGE_ROOT/local/bin`), then running

```
sage -combinat install
```
and all of the extensions are being rebuilt for me. Did I need to run `sage -b` first? (I did like the fact that I didn't have to wait for the doc to be rebuilt.)



---

archive/issue_comments_154998.json:
```json
{
    "body": "<a id='comment:34'></a>\nI also just ran\n\n```\nsage -b main\n```\nand this is recompiling all of the extension classes as well.\n\n```\ntravis@travis-virtualbox:~/sage-5.10.rc1/devel/sage-main$ sage -b main\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nFinished compiling Cython code (time = 33.1963000298 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.algebras.quatalg.quaternion_algebra_element' extension\nbuilding 'sage.algebras.letterplace.free_algebra_letterplace' extension\nbuilding 'sage.algebras.letterplace.free_algebra_element_letterplace' extension\nbuilding 'sage.algebras.letterplace.letterplace_ideal' extension\nbuilding 'sage.algebras.quatalg.quaternion_algebra_cython' extension\nbuilding 'sage.calculus.var' extension\nbuilding 'sage.calculus.riemann' extension\nbuilding 'sage.calculus.interpolators' extension\nbuilding 'sage.categories.action' extension\nbuilding 'sage.categories.category_singleton' extension\nbuilding 'sage.categories.functor' extension\nbuilding 'sage.categories.map' extension\nbuilding 'sage.categories.morphism' extension\nbuilding 'sage.categories.examples.semigroups_cython' extension\nbuilding 'sage.coding.binary_code' extension\nbuilding 'sage.combinat.expnums' extension\n...\n```\nCould this be a result of the changes to `sync-build`? (I'd be surprised if it was since this what I got when doing the `-combinat install`.)",
    "created_at": "2013-06-10T11:50:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154998",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>
I also just ran

```
sage -b main
```
and this is recompiling all of the extension classes as well.

```
travis@travis-virtualbox:~/sage-5.10.rc1/devel/sage-main$ sage -b main

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Finished compiling Cython code (time = 33.1963000298 seconds)
running install
running build
running build_py
running build_ext
building 'sage.algebras.quatalg.quaternion_algebra_element' extension
building 'sage.algebras.letterplace.free_algebra_letterplace' extension
building 'sage.algebras.letterplace.free_algebra_element_letterplace' extension
building 'sage.algebras.letterplace.letterplace_ideal' extension
building 'sage.algebras.quatalg.quaternion_algebra_cython' extension
building 'sage.calculus.var' extension
building 'sage.calculus.riemann' extension
building 'sage.calculus.interpolators' extension
building 'sage.categories.action' extension
building 'sage.categories.category_singleton' extension
building 'sage.categories.functor' extension
building 'sage.categories.map' extension
building 'sage.categories.morphism' extension
building 'sage.categories.examples.semigroups_cython' extension
building 'sage.coding.binary_code' extension
building 'sage.combinat.expnums' extension
...
```
Could this be a result of the changes to `sync-build`? (I'd be surprised if it was since this what I got when doing the `-combinat install`.)



---

archive/issue_comments_154999.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [tscrim](#comment%3A33):\n> I tried this with `5.10.rc1` by applying the patches to the script repo (`$SAGE_ROOT/local/bin`), then running\n> \n> ```\n> sage -combinat install\n> ```\n> and all of the extensions are being rebuilt for me. Did I need to run `sage -b` first?\n\n\na) If you had committed changes to the main repo, you should of course run `sage -b` before cloning.  (It would be better to test with a vanilla Sage library.)\n\nb) Are you sure *everything* (= *all* extension modules) got rebuilt, as opposed to just changed modules and those that depend on the changed ones (the latter potentially being many, even if not many got changed)?\n\nc) Is that a regression?\n\n(The current brokenness of `sage -sync-build` *might* be related, although I don't see that `sage -combinat` calls it.)",
    "created_at": "2013-06-10T14:37:05Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-154999",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
Replying to [tscrim](#comment%3A33):
> I tried this with `5.10.rc1` by applying the patches to the script repo (`$SAGE_ROOT/local/bin`), then running
> 
> ```
> sage -combinat install
> ```
> and all of the extensions are being rebuilt for me. Did I need to run `sage -b` first?


a) If you had committed changes to the main repo, you should of course run `sage -b` before cloning.  (It would be better to test with a vanilla Sage library.)

b) Are you sure *everything* (= *all* extension modules) got rebuilt, as opposed to just changed modules and those that depend on the changed ones (the latter potentially being many, even if not many got changed)?

c) Is that a regression?

(The current brokenness of `sage -sync-build` *might* be related, although I don't see that `sage -combinat` calls it.)



---

archive/issue_comments_155000.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [tscrim](#comment%3A34):\n> I also just ran\n> \n> ```\n> sage -b main\n> ```\n> and this is recompiling all of the extension classes as well.\n> \n> ```\n> travis@travis-virtualbox:~/sage-5.10.rc1/devel/sage-main$ sage -b main\n> \n> ----------------------------------------------------------\n> sage: Building and installing modified Sage library files.\n> \n> \n> Installing c_lib\n> scons: `install' is up to date.\n> Updating Cython code....\n> Finished compiling Cython code (time = 33.1963000298 seconds)\n> running install\n> running build\n> running build_py\n> running build_ext\n> building 'sage.algebras.quatalg.quaternion_algebra_element' extension\n> building 'sage.algebras.letterplace.free_algebra_letterplace' extension\n> building 'sage.algebras.letterplace.free_algebra_element_letterplace' extension\n> building 'sage.algebras.letterplace.letterplace_ideal' extension\n> building 'sage.algebras.quatalg.quaternion_algebra_cython' extension\n> building 'sage.calculus.var' extension\n> building 'sage.calculus.riemann' extension\n> building 'sage.calculus.interpolators' extension\n> building 'sage.categories.action' extension\n> building 'sage.categories.category_singleton' extension\n> building 'sage.categories.functor' extension\n> building 'sage.categories.map' extension\n> building 'sage.categories.morphism' extension\n> building 'sage.categories.examples.semigroups_cython' extension\n> building 'sage.coding.binary_code' extension\n> building 'sage.combinat.expnums' extension\n> ...\n> ```\n\n\nThe messages don't seem to be in chronological order (probably `stdout` and `stderr` out of sync); I somehow doubt all extension modules got rebuilt if \"re-cythonizing\" took just 33 seconds...\n\n\n\n\n> Could this be a result of the changes to `sync-build`?\n\n\nThere are no changes to `sage -sync-build` yet.",
    "created_at": "2013-06-10T14:43:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155000",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:36'></a>
Replying to [tscrim](#comment%3A34):
> I also just ran
> 
> ```
> sage -b main
> ```
> and this is recompiling all of the extension classes as well.
> 
> ```
> travis@travis-virtualbox:~/sage-5.10.rc1/devel/sage-main$ sage -b main
> 
> ----------------------------------------------------------
> sage: Building and installing modified Sage library files.
> 
> 
> Installing c_lib
> scons: `install' is up to date.
> Updating Cython code....
> Finished compiling Cython code (time = 33.1963000298 seconds)
> running install
> running build
> running build_py
> running build_ext
> building 'sage.algebras.quatalg.quaternion_algebra_element' extension
> building 'sage.algebras.letterplace.free_algebra_letterplace' extension
> building 'sage.algebras.letterplace.free_algebra_element_letterplace' extension
> building 'sage.algebras.letterplace.letterplace_ideal' extension
> building 'sage.algebras.quatalg.quaternion_algebra_cython' extension
> building 'sage.calculus.var' extension
> building 'sage.calculus.riemann' extension
> building 'sage.calculus.interpolators' extension
> building 'sage.categories.action' extension
> building 'sage.categories.category_singleton' extension
> building 'sage.categories.functor' extension
> building 'sage.categories.map' extension
> building 'sage.categories.morphism' extension
> building 'sage.categories.examples.semigroups_cython' extension
> building 'sage.coding.binary_code' extension
> building 'sage.combinat.expnums' extension
> ...
> ```


The messages don't seem to be in chronological order (probably `stdout` and `stderr` out of sync); I somehow doubt all extension modules got rebuilt if "re-cythonizing" took just 33 seconds...




> Could this be a result of the changes to `sync-build`?


There are no changes to `sage -sync-build` yet.



---

archive/issue_comments_155001.json:
```json
{
    "body": "<a id='comment:37'></a>\nP.S.:\n\n`sage --clone foo; sage -b main` works for me (modulo that the `fast_callable` interpreters [and IIRC six extension modules that depend on them] get rebuilt in both cases, which is a known but in our opinion minor issue we didn't want to address here).",
    "created_at": "2013-06-10T14:48:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155001",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>
P.S.:

`sage --clone foo; sage -b main` works for me (modulo that the `fast_callable` interpreters [and IIRC six extension modules that depend on them] get rebuilt in both cases, which is a known but in our opinion minor issue we didn't want to address here).



---

archive/issue_comments_155002.json:
```json
{
    "body": "<a id='comment:38'></a>\nTravis, the interesting lines should be\n\n```\nExecuting N commands (using M threads)\n...\nTime to execute N commands: n seconds\n...\nTotal time spent compiling C/C++ extensions: m seconds.\n```",
    "created_at": "2013-06-10T14:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155002",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
Travis, the interesting lines should be

```
Executing N commands (using M threads)
...
Time to execute N commands: n seconds
...
Total time spent compiling C/C++ extensions: m seconds.
```



---

archive/issue_comments_155003.json:
```json
{
    "body": "<a id='comment:39'></a>\nFrom a clean `sage-main` repo,\n\n```sh\n$ (./sage --clone foo; ./sage -b main) 2>&1 | egrep '^(building|Cythonizing|Compiling)'\n```\ngives me\n\n```\nCompiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.\nCompiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_rr.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_py.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_el.pyx because it changed.\nbuilding 'sage.plot.plot3d.parametric_surface' extension\nbuilding 'sage.ext.interpreters.wrapper_rdf' extension\nbuilding 'sage.ext.interpreters.wrapper_cdf' extension\nbuilding 'sage.ext.interpreters.wrapper_rr' extension\nbuilding 'sage.ext.interpreters.wrapper_py' extension\nbuilding 'sage.ext.interpreters.wrapper_el' extension\nCythonizing sage/ext/interpreters/wrapper_py.pyx\nCythonizing sage/ext/interpreters/wrapper_rdf.pyx\nCythonizing sage/plot/plot3d/parametric_surface.pyx\nCythonizing sage/ext/interpreters/wrapper_el.pyx\nCythonizing sage/ext/interpreters/wrapper_rr.pyx\nCythonizing sage/ext/interpreters/wrapper_cdf.pyx\n```",
    "created_at": "2013-06-10T15:29:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155003",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:39'></a>
From a clean `sage-main` repo,

```sh
$ (./sage --clone foo; ./sage -b main) 2>&1 | egrep '^(building|Cythonizing|Compiling)'
```
gives me

```
Compiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
building 'sage.plot.plot3d.parametric_surface' extension
building 'sage.ext.interpreters.wrapper_rdf' extension
building 'sage.ext.interpreters.wrapper_cdf' extension
building 'sage.ext.interpreters.wrapper_rr' extension
building 'sage.ext.interpreters.wrapper_py' extension
building 'sage.ext.interpreters.wrapper_el' extension
Cythonizing sage/ext/interpreters/wrapper_py.pyx
Cythonizing sage/ext/interpreters/wrapper_rdf.pyx
Cythonizing sage/plot/plot3d/parametric_surface.pyx
Cythonizing sage/ext/interpreters/wrapper_el.pyx
Cythonizing sage/ext/interpreters/wrapper_rr.pyx
Cythonizing sage/ext/interpreters/wrapper_cdf.pyx
```



---

archive/issue_comments_155004.json:
```json
{
    "body": "<a id='comment:40'></a>\na) I only applied the two patches to the scripts repo, nothing to the main repo (I had just built sage, didn't even start it yet).\n\nb) Not 100% but almost since there are far fewer extensions that get rebuilt after pushing/popping the entire combinat queue, and it seemed like the same number of modules after running `-sync-build` (which currently erases all cython files). I can't tell you the interesting lines because I didn't think I would need it (and I really don't want to go through rebuilding it all again) At least afterwards, switching between branches is fast. Nevertheless I would think changes in one branch's built extensions would not affect another's...\n\nDid you run\n\n```\nsage --clone foo\nsage -b foo\n```\nand then\n\n```\nsage -b main\n```\n?",
    "created_at": "2013-06-10T15:41:41Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155004",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
a) I only applied the two patches to the scripts repo, nothing to the main repo (I had just built sage, didn't even start it yet).

b) Not 100% but almost since there are far fewer extensions that get rebuilt after pushing/popping the entire combinat queue, and it seemed like the same number of modules after running `-sync-build` (which currently erases all cython files). I can't tell you the interesting lines because I didn't think I would need it (and I really don't want to go through rebuilding it all again) At least afterwards, switching between branches is fast. Nevertheless I would think changes in one branch's built extensions would not affect another's...

Did you run

```
sage --clone foo
sage -b foo
```
and then

```
sage -b main
```
?



---

archive/issue_comments_155005.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [tscrim](#comment%3A40):\n> Did you run\n> \n> ```\n> sage --clone foo\n> sage -b foo\n> ```\n> and then\n> \n> ```\n> sage -b main\n> ```\n> ?\n\n\nNot explicitly, since `sage-clone` already runs `sage -b` in the new clone.",
    "created_at": "2013-06-10T16:02:48Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155005",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'></a>
Replying to [tscrim](#comment%3A40):
> Did you run
> 
> ```
> sage --clone foo
> sage -b foo
> ```
> and then
> 
> ```
> sage -b main
> ```
> ?


Not explicitly, since `sage-clone` already runs `sage -b` in the new clone.



---

archive/issue_comments_155006.json:
```json
{
    "body": "<a id='comment:42'></a>\nJust for reference: with Sage 5.10.rc1 (not that the version should matter, as far as I know), I applied the two patches here and did\n\n```\n./sage -b   # to make sure everything was up to date\n./sage --combinat install\n```\nand it only built 6 Cython files before applying the combinat queue:\n\n```\nBuilding interpreters for fast_callable\nUpdating Cython code....\nCompiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.\nCompiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_rr.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_py.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_el.pyx because it changed.\nCythonizing sage/ext/interpreters/wrapper_cdf.pyx\nCythonizing sage/ext/interpreters/wrapper_el.pyx\nCythonizing sage/ext/interpreters/wrapper_py.pyx\nCythonizing sage/ext/interpreters/wrapper_rdf.pyx\nCythonizing sage/ext/interpreters/wrapper_rr.pyx\nCythonizing sage/plot/plot3d/parametric_surface.pyx\nFinished compiling Cython code (time = 17.591463089 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nwarning: Replacing library search directory in linker command:\n  \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-5.10.rc1/local/lib\" -> \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib\"\n\nbuilding 'sage.plot.plot3d.parametric_surface' extension\nbuilding 'sage.ext.interpreters.wrapper_rdf' extension\nbuilding 'sage.ext.interpreters.wrapper_cdf' extension\nbuilding 'sage.ext.interpreters.wrapper_rr' extension\nbuilding 'sage.ext.interpreters.wrapper_py' extension\nbuilding 'sage.ext.interpreters.wrapper_el' extension\nExecuting 6 commands (using 2 threads)\n...\n```",
    "created_at": "2013-06-10T17:51:56Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155006",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>
Just for reference: with Sage 5.10.rc1 (not that the version should matter, as far as I know), I applied the two patches here and did

```
./sage -b   # to make sure everything was up to date
./sage --combinat install
```
and it only built 6 Cython files before applying the combinat queue:

```
Building interpreters for fast_callable
Updating Cython code....
Compiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
Cythonizing sage/ext/interpreters/wrapper_cdf.pyx
Cythonizing sage/ext/interpreters/wrapper_el.pyx
Cythonizing sage/ext/interpreters/wrapper_py.pyx
Cythonizing sage/ext/interpreters/wrapper_rdf.pyx
Cythonizing sage/ext/interpreters/wrapper_rr.pyx
Cythonizing sage/plot/plot3d/parametric_surface.pyx
Finished compiling Cython code (time = 17.591463089 seconds)
running install
running build
running build_py
running build_ext
warning: Replacing library search directory in linker command:
  "/Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-5.10.rc1/local/lib" -> "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib"

building 'sage.plot.plot3d.parametric_surface' extension
building 'sage.ext.interpreters.wrapper_rdf' extension
building 'sage.ext.interpreters.wrapper_cdf' extension
building 'sage.ext.interpreters.wrapper_rr' extension
building 'sage.ext.interpreters.wrapper_py' extension
building 'sage.ext.interpreters.wrapper_el' extension
Executing 6 commands (using 2 threads)
...
```



---

archive/issue_comments_155007.json:
```json
{
    "body": "<a id='comment:43'></a>\nHere's a snippet of what I get -- with no patches applied, double-checking the patches are applied in `local/bin`, and then running `sage -b` -- when I run\n\n```\nsage --clone foo\n...\nBuilding interpreters for fast_callable\nUpdating Cython code....\nCompiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.\nCompiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_rr.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_py.pyx because it changed.\nCompiling sage/ext/interpreters/wrapper_el.pyx because it changed.\nCythonizing sage/ext/interpreters/wrapper_cdf.pyx\nCythonizing sage/ext/interpreters/wrapper_el.pyx\nCythonizing sage/ext/interpreters/wrapper_py.pyx\nCythonizing sage/ext/interpreters/wrapper_rdf.pyx\nCythonizing sage/ext/interpreters/wrapper_rr.pyx\nCythonizing sage/plot/plot3d/parametric_surface.pyx\nFinished compiling Cython code (time = 70.2989528179 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.algebras.quatalg.quaternion_algebra_element' extension\nbuilding 'sage.algebras.letterplace.free_algebra_letterplace' extension\n...\nbuilding 'sage.ext.interpreters.wrapper_py' extension\nbuilding 'sage.ext.interpreters.wrapper_el' extension\nExecuting 343 commands (using 1 thread)\n```\nI'll upload a full log once it's done. Could it be because I didn't run `sage -b` after first installing the patches the first time around? Either that or (more likely) it's something specific to me or my system...",
    "created_at": "2013-06-10T18:01:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155007",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
Here's a snippet of what I get -- with no patches applied, double-checking the patches are applied in `local/bin`, and then running `sage -b` -- when I run

```
sage --clone foo
...
Building interpreters for fast_callable
Updating Cython code....
Compiling sage/plot/plot3d/parametric_surface.pyx because it depends on ./sage/ext/interpreters/wrapper_rdf.pxd.
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
Cythonizing sage/ext/interpreters/wrapper_cdf.pyx
Cythonizing sage/ext/interpreters/wrapper_el.pyx
Cythonizing sage/ext/interpreters/wrapper_py.pyx
Cythonizing sage/ext/interpreters/wrapper_rdf.pyx
Cythonizing sage/ext/interpreters/wrapper_rr.pyx
Cythonizing sage/plot/plot3d/parametric_surface.pyx
Finished compiling Cython code (time = 70.2989528179 seconds)
running install
running build
running build_py
running build_ext
building 'sage.algebras.quatalg.quaternion_algebra_element' extension
building 'sage.algebras.letterplace.free_algebra_letterplace' extension
...
building 'sage.ext.interpreters.wrapper_py' extension
building 'sage.ext.interpreters.wrapper_el' extension
Executing 343 commands (using 1 thread)
```
I'll upload a full log once it's done. Could it be because I didn't run `sage -b` after first installing the patches the first time around? Either that or (more likely) it's something specific to me or my system...



---

archive/attachments_017930.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "build_log.txt",
    "asset_url": "tarball://root/attachments/ticket13245/build_log.txt",
    "created_at": "2013-06-10T19:33:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13245/build_log.txt",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_155008.json:
```json
{
    "body": "<a id='comment:44'></a>\nAttachment [build_log.txt](https://github.com/sagemath/sage/files/ticket13245/build_log.txt) by @tscrim created at 2013-06-10 19:33:07\n\nHere's a log from calling `sage -b main` afterwards (because I stupidly overwrote the first log).",
    "created_at": "2013-06-10T19:33:07Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155008",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>
Attachment [build_log.txt](https://github.com/sagemath/sage/files/ticket13245/build_log.txt) by @tscrim created at 2013-06-10 19:33:07

Here's a log from calling `sage -b main` afterwards (because I stupidly overwrote the first log).



---

archive/issue_comments_155009.json:
```json
{
    "body": "<a id='comment:45'></a>\nWhen I called `sage -b main` afterwards, I got\n\n```\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nFinished compiling Cython code (time = 11.5694179535 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nwarning: Replacing library search directory in linker command:\n  \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-5.10.rc1/local/lib\" -> \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib\"\n\nExecuting 0 commands (using 1 thread)\nTime to execute 0 commands: 0.0257179737091 seconds\nTotal time spent compiling C/C++ extensions:  0.278106927872 seconds.\nrunning install_lib\nrunning install_egg_info\nRemoving /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\nWriting /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\n\nreal\t0m17.365s\nuser\t0m6.021s\nsys\t0m2.604s\n```\nSo it looks like there is something odd with your system.",
    "created_at": "2013-06-10T19:52:17Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155009",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>
When I called `sage -b main` afterwards, I got

```

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Finished compiling Cython code (time = 11.5694179535 seconds)
running install
running build
running build_py
running build_ext
warning: Replacing library search directory in linker command:
  "/Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-5.10.rc1/local/lib" -> "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib"

Executing 0 commands (using 1 thread)
Time to execute 0 commands: 0.0257179737091 seconds
Total time spent compiling C/C++ extensions:  0.278106927872 seconds.
running install_lib
running install_egg_info
Removing /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info
Writing /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.10.rc1/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info

real	0m17.365s
user	0m6.021s
sys	0m2.604s
```
So it looks like there is something odd with your system.



---

archive/issue_comments_155010.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [leif](#comment%3A41):\n> Replying to [tscrim](#comment%3A40):\n> > Did you run\n> > \n> > ```\n> > sage --clone foo\n> > sage -b foo\n> > ```\n> > and then\n> > \n> > ```\n> > sage -b main\n> > ```\n> > ?\n\n> \n> Not explicitly, since `sage-clone` already runs `sage -b` in the new clone.\n\n\nBut even when I do, that doesn't make any difference, as expected.",
    "created_at": "2013-06-10T19:56:33Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155010",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:46'></a>
Replying to [leif](#comment%3A41):
> Replying to [tscrim](#comment%3A40):
> > Did you run
> > 
> > ```
> > sage --clone foo
> > sage -b foo
> > ```
> > and then
> > 
> > ```
> > sage -b main
> > ```
> > ?

> 
> Not explicitly, since `sage-clone` already runs `sage -b` in the new clone.


But even when I do, that doesn't make any difference, as expected.



---

archive/issue_comments_155011.json:
```json
{
    "body": "<a id='comment:47'></a>\nP.S.: I also touched some pyx files in the clone, ran `sage -b`, then `sage -b main`.  Not surprisingly, the latter didn't trigger any rebuilds either.",
    "created_at": "2013-06-10T19:59:57Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155011",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:47'></a>
P.S.: I also touched some pyx files in the clone, ran `sage -b`, then `sage -b main`.  Not surprisingly, the latter didn't trigger any rebuilds either.



---

archive/issue_comments_155012.json:
```json
{
    "body": "<a id='comment:48'></a>\nJust to make sure, when you run `./sage --hg -R local/bin log`, it shows that the two patches have been applied, right?",
    "created_at": "2013-06-10T20:38:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155012",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'></a>
Just to make sure, when you run `./sage --hg -R local/bin log`, it shows that the two patches have been applied, right?



---

archive/issue_comments_155013.json:
```json
{
    "body": "<a id='comment:49'></a>\n\n```\ntravis@travis-virtualbox:~/sage-5.10.rc1$ sage --hg -R local/bin log | head -n 21\nchangeset:   1953:64e1b84c2d39\ntag:         qtip\ntag:         tip\ntag:         trac_13245-clone-nodocbuild.patch\nuser:        J. H. Palmieri <palmieri@math.washington.edu>\ndate:        Mon Mar 11 10:53:04 2013 -0700\nsummary:     Don't rebuild docs after cloning.\n\nchangeset:   1952:148e4ed48517\ntag:         qbase\ntag:         trac_13245-clone-cython.patch\nuser:        J. H. Palmieri <palmieri@math.washington.edu>\ndate:        Mon Mar 11 10:53:04 2013 -0700\nsummary:     sage-clone: copy over autogenerated .h files, and also .cython_version\n\nchangeset:   1951:0eb3c4df6d10\ntag:         qparent\nuser:        Jeroen Demeyer <jdemeyer@cage.ugent.be>\ndate:        Wed Jun 05 22:11:28 2013 +0000\nsummary:     5.10.rc1\n```\nSo it's probably just something I messed up with my install (my guess by applying the patches and then running `-combinat install` before (rebuilding and) starting sage) and/or system.",
    "created_at": "2013-06-10T20:57:08Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155013",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:49'></a>

```
travis@travis-virtualbox:~/sage-5.10.rc1$ sage --hg -R local/bin log | head -n 21
changeset:   1953:64e1b84c2d39
tag:         qtip
tag:         tip
tag:         trac_13245-clone-nodocbuild.patch
user:        J. H. Palmieri <palmieri@math.washington.edu>
date:        Mon Mar 11 10:53:04 2013 -0700
summary:     Don't rebuild docs after cloning.

changeset:   1952:148e4ed48517
tag:         qbase
tag:         trac_13245-clone-cython.patch
user:        J. H. Palmieri <palmieri@math.washington.edu>
date:        Mon Mar 11 10:53:04 2013 -0700
summary:     sage-clone: copy over autogenerated .h files, and also .cython_version

changeset:   1951:0eb3c4df6d10
tag:         qparent
user:        Jeroen Demeyer <jdemeyer@cage.ugent.be>
date:        Wed Jun 05 22:11:28 2013 +0000
summary:     5.10.rc1
```
So it's probably just something I messed up with my install (my guess by applying the patches and then running `-combinat install` before (rebuilding and) starting sage) and/or system.



---

archive/issue_comments_155014.json:
```json
{
    "body": "<a id='comment:50'></a>\nI *think<sup>TM</sup>* I know what the problem might be, namely the *order* in which subdirectories of `devel/sage/build/` are copied.\n\nSince the odd addition of `build_dir` in `setup.py`, which already breaks `sage-sync-build`, the Cython-generated `.c` and `.cpp` files also end up below `build/`.\n\nNow if these get copied (and touched!) **after** their corresponding `.o` and `.so` files, the latter will get rebuilt.\n\n\n\n\nTravis, could you switch back to the main branch, remove the line setting `build_dir` from `setup.py` (or change `build_dir='build/cythonized'` to `build_dir=None`), do `sage -b` to get a clean new main repo, and retry your test? B)",
    "created_at": "2013-06-10T21:03:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155014",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'></a>
I *think<sup>TM</sup>* I know what the problem might be, namely the *order* in which subdirectories of `devel/sage/build/` are copied.

Since the odd addition of `build_dir` in `setup.py`, which already breaks `sage-sync-build`, the Cython-generated `.c` and `.cpp` files also end up below `build/`.

Now if these get copied (and touched!) **after** their corresponding `.o` and `.so` files, the latter will get rebuilt.




Travis, could you switch back to the main branch, remove the line setting `build_dir` from `setup.py` (or change `build_dir='build/cythonized'` to `build_dir=None`), do `sage -b` to get a clean new main repo, and retry your test? B)



---

archive/issue_comments_155015.json:
```json
{
    "body": "<a id='comment:51'></a>\nDoing so right now, although the change seems to have triggered a recompile/recythonizing of the cython files (it might have been a side effect of one of my other tests). However I need to sleep, so I'll finish the test in the morning. Thanks.",
    "created_at": "2013-06-10T21:28:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155015",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:51'></a>
Doing so right now, although the change seems to have triggered a recompile/recythonizing of the cython files (it might have been a side effect of one of my other tests). However I need to sleep, so I'll finish the test in the morning. Thanks.



---

archive/issue_comments_155016.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [leif](#comment%3A50):\n> I *think<sup>TM</sup>* I know what the problem might be, namely the *order* in which subdirectories of `devel/sage/build/` are copied.\n> \n> Since the odd addition of `build_dir` in `setup.py`, which already breaks `sage-sync-build`, the Cython-generated `.c` and `.cpp` files also end up below `build/`.\n> \n> Now if these get copied (and touched!) **after** their corresponding `.o` and `.so` files, the latter will get rebuilt.\n\n\nWith\n\n```python\ndef copy_dtree(src_dir, dest_dir):\n    src_root = os.path.abspath(src_dir)\n    dest_root = os.path.abspath(dest_dir)\n\n    for root, dirs, files in os.walk(src_root):\n        nroot = dest_root + root[len(src_root):]\n        for d in dirs:\n            os.makedirs(nroot+'/'+d)\n        for f in files:\n            if os.path.splitext(f)[1] in [\".c\",\".cpp\",\".o\",\".so\"]: # ADDED\n                print(\"  %s\" % f) # ADDED\n            os.link(root+'/'+f,nroot+'/'+f)\n            os.utime(nroot+'/'+f, None)\n\nsys.stdout.flush(); sys.stderr.flush() # ADDED\nprint \"Copying over build directory...\"\ncopy_dtree('sage/build', branch + '/build')\nsys.stdout.flush(); sys.stderr.flush() # ADDED\n```\nI can at least confirm that *for me* all `.o` and `.so` files get copied *after* all `.c` and `.cpp` files have been copied -- rather incidentally I think.",
    "created_at": "2013-06-10T22:22:28Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155016",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>
Replying to [leif](#comment%3A50):
> I *think<sup>TM</sup>* I know what the problem might be, namely the *order* in which subdirectories of `devel/sage/build/` are copied.
> 
> Since the odd addition of `build_dir` in `setup.py`, which already breaks `sage-sync-build`, the Cython-generated `.c` and `.cpp` files also end up below `build/`.
> 
> Now if these get copied (and touched!) **after** their corresponding `.o` and `.so` files, the latter will get rebuilt.


With

```python
def copy_dtree(src_dir, dest_dir):
    src_root = os.path.abspath(src_dir)
    dest_root = os.path.abspath(dest_dir)

    for root, dirs, files in os.walk(src_root):
        nroot = dest_root + root[len(src_root):]
        for d in dirs:
            os.makedirs(nroot+'/'+d)
        for f in files:
            if os.path.splitext(f)[1] in [".c",".cpp",".o",".so"]: # ADDED
                print("  %s" % f) # ADDED
            os.link(root+'/'+f,nroot+'/'+f)
            os.utime(nroot+'/'+f, None)

sys.stdout.flush(); sys.stderr.flush() # ADDED
print "Copying over build directory..."
copy_dtree('sage/build', branch + '/build')
sys.stdout.flush(); sys.stderr.flush() # ADDED
```
I can at least confirm that *for me* all `.o` and `.so` files get copied *after* all `.c` and `.cpp` files have been copied -- rather incidentally I think.



---

archive/issue_comments_155017.json:
```json
{
    "body": "<a id='comment:53'></a>\nMy `.o` files get copied, then my `.c` and `.cpp`, then my `.so` (with the changes to `setup.py`).",
    "created_at": "2013-06-11T07:25:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155017",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'></a>
My `.o` files get copied, then my `.c` and `.cpp`, then my `.so` (with the changes to `setup.py`).



---

archive/issue_comments_155018.json:
```json
{
    "body": "<a id='comment:54'></a>\nAlso I only get the rebuilding of the 7 extensions and switch back to main is trivial.",
    "created_at": "2013-06-11T07:34:22Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155018",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:54'></a>
Also I only get the rebuilding of the 7 extensions and switch back to main is trivial.



---

archive/issue_comments_155019.json:
```json
{
    "body": "<a id='comment:55'></a>\nAny progress? Does this still deserve to be a Sage 5.10 blocker?",
    "created_at": "2013-06-11T13:51:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155019",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>
Any progress? Does this still deserve to be a Sage 5.10 blocker?



---

archive/issue_comments_155020.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [jdemeyer](#comment%3A55):\n> Any progress? Does this still deserve to be a Sage 5.10 blocker?\n\n\nAt least the `.cython_version` part here.\n\nAnd we should really disable (postpone) Cython-generated files \"out-of-tree\", since this breaks both `sage-clone` and `sage-sync-build`, i.e., set `build_dir` to `None` in `setup.py`.\n\n([Even] with that, upgrading from beta4+ will still trigger the rebuild of the whole Sage library, but only once.)",
    "created_at": "2013-06-11T16:19:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155020",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:56'></a>
Replying to [jdemeyer](#comment%3A55):
> Any progress? Does this still deserve to be a Sage 5.10 blocker?


At least the `.cython_version` part here.

And we should really disable (postpone) Cython-generated files "out-of-tree", since this breaks both `sage-clone` and `sage-sync-build`, i.e., set `build_dir` to `None` in `setup.py`.

([Even] with that, upgrading from beta4+ will still trigger the rebuild of the whole Sage library, but only once.)



---

archive/issue_comments_155021.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [leif](#comment%3A56):\n> And we should really disable (postpone) Cython-generated files \"out-of-tree\", since this breaks both `sage-clone` and `sage-sync-build`, i.e., set `build_dir` to `None` in `setup.py`.\n\n\nInline patch, worth its own (blocker) ticket:\n\n```diff\ndiff --git a/setup.py b/setup.py\n--- a/setup.py\n+++ b/setup.py\n@@ -537,7 +537,8 @@\n     ext_modules = cythonize(\n         ext_modules,\n         nthreads = int(os.environ.get('SAGE_NUM_THREADS', 0)),\n-        build_dir = 'build/cythonized',\n+        build_dir = None, # Don't \"cythonize out-of-tree\" (cf. #14570) until\n+                          # sage-clone and sage-sync-build can deal with that.\n         force=force)\n \n     open(version_file, 'w').write(Cython.__version__)\n```\n\nEDIT:  Added ticket reference to the patch.",
    "created_at": "2013-06-11T16:25:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155021",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:57'></a>
Replying to [leif](#comment%3A56):
> And we should really disable (postpone) Cython-generated files "out-of-tree", since this breaks both `sage-clone` and `sage-sync-build`, i.e., set `build_dir` to `None` in `setup.py`.


Inline patch, worth its own (blocker) ticket:

```diff
diff --git a/setup.py b/setup.py
--- a/setup.py
+++ b/setup.py
@@ -537,7 +537,8 @@
     ext_modules = cythonize(
         ext_modules,
         nthreads = int(os.environ.get('SAGE_NUM_THREADS', 0)),
-        build_dir = 'build/cythonized',
+        build_dir = None, # Don't "cythonize out-of-tree" (cf. #14570) until
+                          # sage-clone and sage-sync-build can deal with that.
         force=force)
 
     open(version_file, 'w').write(Cython.__version__)
```

EDIT:  Added ticket reference to the patch.



---

archive/issue_comments_155022.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [jdemeyer](#comment%3A55):\n> Any progress?\n\n\nI was (more or less reluctantly) going to give this positive review, but then Travis discovered that using `build_dir` can also break `sage-clone`.\n\nSo I'm happy provided we make this ticket depend on the above patch / its ticket.",
    "created_at": "2013-06-11T16:31:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155022",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:58'></a>
Replying to [jdemeyer](#comment%3A55):
> Any progress?


I was (more or less reluctantly) going to give this positive review, but then Travis discovered that using `build_dir` can also break `sage-clone`.

So I'm happy provided we make this ticket depend on the above patch / its ticket.



---

archive/issue_comments_155023.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [jdemeyer](#comment%3A55):\n> Any progress? Does this still deserve to be a Sage 5.10 blocker?\n\n\nIt would be great indeed to have 5.10 ready for the Sage-Combinat days next week! There is a lot of good stuff there.",
    "created_at": "2013-06-11T16:39:24Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155023",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:59'></a>
Replying to [jdemeyer](#comment%3A55):
> Any progress? Does this still deserve to be a Sage 5.10 blocker?


It would be great indeed to have 5.10 ready for the Sage-Combinat days next week! There is a lot of good stuff there.



---

archive/issue_comments_155024.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [leif](#comment%3A58):\n> Replying to [jdemeyer](#comment%3A55):\n> > Any progress?\n\n> \n> I was (more or less reluctantly) going to give this positive review, but then Travis discovered that using `build_dir` can also break `sage-clone`.\n> \n> So I'm happy provided we make this ticket depend on the above patch / its ticket.\n\n\nI've now created #14721.\n\n>\n",
    "created_at": "2013-06-11T16:49:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155024",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:60'></a>
Replying to [leif](#comment%3A58):
> Replying to [jdemeyer](#comment%3A55):
> > Any progress?

> 
> I was (more or less reluctantly) going to give this positive review, but then Travis discovered that using `build_dir` can also break `sage-clone`.
> 
> So I'm happy provided we make this ticket depend on the above patch / its ticket.


I've now created #14721.

>




---

archive/issue_comments_155025.json:
```json
{
    "body": "**Changing reviewer** from \"John Palmieri\" to \"John Palmieri, Travis Scrimshaw, Leif Leonhardy\".",
    "created_at": "2013-06-11T16:49:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155025",
    "user": "https://github.com/nexttime"
}
```

**Changing reviewer** from "John Palmieri" to "John Palmieri, Travis Scrimshaw, Leif Leonhardy".



---

archive/issue_comments_155026.json:
```json
{
    "body": "**Dependencies:** #14721",
    "created_at": "2013-06-11T16:49:04Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155026",
    "user": "https://github.com/nexttime"
}
```

**Dependencies:** #14721



---

archive/issue_events_112144.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-11T16:49:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112144"
}
```



---

archive/issue_events_112145.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-11T16:49:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112145"
}
```



---

archive/issue_comments_155027.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [leif](#comment%3A60):\n> Replying to [leif](#comment%3A58):\n> > So I'm happy provided we make this ticket depend on the above patch / its ticket.\n\n> \n> I've now created #14721.\n\n\nNeeds review... :P",
    "created_at": "2013-06-11T17:12:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155027",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:61'></a>
Replying to [leif](#comment%3A60):
> Replying to [leif](#comment%3A58):
> > So I'm happy provided we make this ticket depend on the above patch / its ticket.

> 
> I've now created #14721.


Needs review... :P



---

archive/issue_events_112146.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:21:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112146"
}
```



---

archive/issue_events_112147.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-13T08:21:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13245#event-112147"
}
```



---

archive/issue_comments_155028.json:
```json
{
    "body": "**Merged:** sage-5.10.rc2",
    "created_at": "2013-06-13T08:21:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13245#issuecomment-155028",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.rc2
