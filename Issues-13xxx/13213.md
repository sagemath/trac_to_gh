# Issue 13213: Comparisons in quadratic number field

archive/issues_013041.json:
```json
{
    "body": "The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have\n\n```\nsage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\nsage: sqrt2 < 100\nFalse\n\nsage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)\nsage: s < 100\nFalse\n```\nwhich is not compatible with the order of RR and\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: i > 1\nTrue\nsage: 1 > i\nTrue\n```\nwhich is not compatible (!) with the order of CC.\n\nThe ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).\n\nNote:\n* this patch is partly a duplicate because of #7160\n* the modifications for quadratic field field modify the behavior of many commands (especially about output order).\n* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)\n\n---\n\nThere is no significant lost of speed as shown on the following timings.\n\n```\nsage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)\nsage: a = (3*sqrt2 + 18)/7\nsage: b = (5*sqrt2 + 14)/5\nsage: %timeit a < b\n1000000 loops, best of 3: 408 ns per loop\n\nsage: K.<s> = QuadraticField(-2)\nsage: a = 3*s + 2/4\nsage: b = 5/7*s + 1/3\nsage: %timeit a < b\n1000000 loops, best of 3: 352 ns per loop\n```\nTimings without the patch\n\n```\nsage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\nsage: a = (3*sqrt2 + 18)/7\nsage: b = (5*sqrt2 + 14)/5\nsage: %timeit a < b\n1000000 loops, best of 3: 393 ns per loop\n\nsage: K.<s> = QuadraticField(-2)\nsage: a = 3*s+2/4\nsage: b = 5/7*s+1/3\nsage: %timeit a < b\n1000000 loops, best of 3: 344 ns per loop\n```\n\nApply:\n\n* [attachment:trac_13213-quadratic_field_comparison.patch]\n\nAssignee: @videlec\n\nKeywords: real number field, comparison\n\nReviewer: Burcin Erocal, Volker Braun\n\nAuthor: Vincent Delecroix\n\nMerged: sage-5.10.beta4\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13213\n\n",
    "closed_at": "2013-05-17T06:32:23Z",
    "created_at": "2012-07-08T18:45:16Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Comparisons in quadratic number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13213",
    "user": "https://github.com/videlec"
}
```
The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have

```
sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
sage: sqrt2 < 100
False

sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)
sage: s < 100
False
```
which is not compatible with the order of RR and

```
sage: K.<i> = QuadraticField(-1)
sage: i > 1
True
sage: 1 > i
True
```
which is not compatible (!) with the order of CC.

The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).

Note:
* this patch is partly a duplicate because of #7160
* the modifications for quadratic field field modify the behavior of many commands (especially about output order).
* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)

---

There is no significant lost of speed as shown on the following timings.

```
sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)
sage: a = (3*sqrt2 + 18)/7
sage: b = (5*sqrt2 + 14)/5
sage: %timeit a < b
1000000 loops, best of 3: 408 ns per loop

sage: K.<s> = QuadraticField(-2)
sage: a = 3*s + 2/4
sage: b = 5/7*s + 1/3
sage: %timeit a < b
1000000 loops, best of 3: 352 ns per loop
```
Timings without the patch

```
sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
sage: a = (3*sqrt2 + 18)/7
sage: b = (5*sqrt2 + 14)/5
sage: %timeit a < b
1000000 loops, best of 3: 393 ns per loop

sage: K.<s> = QuadraticField(-2)
sage: a = 3*s+2/4
sage: b = 5/7*s+1/3
sage: %timeit a < b
1000000 loops, best of 3: 344 ns per loop
```

Apply:

* [attachment:trac_13213-quadratic_field_comparison.patch]

Assignee: @videlec

Keywords: real number field, comparison

Reviewer: Burcin Erocal, Volker Braun

Author: Vincent Delecroix

Merged: sage-5.10.beta4

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13213





---

archive/issue_comments_168096.json:
```json
{
    "body": "<a id='comment:1'></a>I had a short look at your patch.\nCould you use Python 3 compatible syntax to raise errors. E.g.\n\n```\nraise ValueError(\"absolute value not implemented for complex embeddings\")\n```",
    "created_at": "2012-07-08T19:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168096",
    "user": "https://github.com/a-andre"
}
```

<a id='comment:1'></a>I had a short look at your patch.
Could you use Python 3 compatible syntax to raise errors. E.g.

```
raise ValueError("absolute value not implemented for complex embeddings")
```



---

archive/issue_comments_168097.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -10,6 +10,26 @@\n \n There is a patch for quadratic field. Another one is comming for general number fields.\n \n+Timings with the patch\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: b = (5*sqrt2 + 14)/5\n+sage: a = (3*sqrt2 + 18)/7\n+sage: %timeit a < b\n+625 loops, best of 3: 6.68 \u00b5s per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 478 ns per loop\n+\\`\\`\\`\n+}}}\n+\n Author: vdelecroix\n \n Comment: 1\n```\n",
    "created_at": "2012-07-09T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168097",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -10,6 +10,26 @@
 
 There is a patch for quadratic field. Another one is comming for general number fields.
 
+Timings with the patch
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: b = (5*sqrt2 + 14)/5
+sage: a = (3*sqrt2 + 18)/7
+sage: %timeit a < b
+625 loops, best of 3: 6.68 µs per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 478 ns per loop
+\`\`\`
+}}}
+
 Author: vdelecroix
 
 Comment: 1
```




---

archive/issue_comments_168098.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,34 @@\n+Provide the order from RR for number field embedded in RR as in\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 - 1 > 0\n+True\n+sage: sqrt2 < 2\n+True\n+\\`\\`\\`\n+\n+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.\n+\n+\n+Timings with the patch\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: b = (5*sqrt2 + 14)/5\n+sage: a = (3*sqrt2 + 18)/7\n+sage: %timeit a < b\n+625 loops, best of 3: 6.68 \u00b5s per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 478 ns per loop\n+\\`\\`\\`\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2012-07-09T07:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168098",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,34 @@
+Provide the order from RR for number field embedded in RR as in
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 - 1 > 0
+True
+sage: sqrt2 < 2
+True
+\`\`\`
+
+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.
+
+
+Timings with the patch
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: b = (5*sqrt2 + 14)/5
+sage: a = (3*sqrt2 + 18)/7
+sage: %timeit a < b
+625 loops, best of 3: 6.68 µs per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 478 ns per loop
+\`\`\`
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168099.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,36 @@\n+Provide the order from RR for number field embedded in RR as in\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 - 1 > 0\n+True\n+sage: sqrt2 < 2\n+True\n+sage: sqrt2.floor()\n+1\n+\\`\\`\\`\n+\n+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.\n+\n+\n+Timings with the patch\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: b = (5*sqrt2 + 14)/5\n+sage: a = (3*sqrt2 + 18)/7\n+sage: %timeit a < b\n+625 loops, best of 3: 6.68 \u00b5s per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 478 ns per loop\n+\\`\\`\\`\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2012-07-09T08:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168099",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,36 @@
+Provide the order from RR for number field embedded in RR as in
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 - 1 > 0
+True
+sage: sqrt2 < 2
+True
+sage: sqrt2.floor()
+1
+\`\`\`
+
+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.
+
+
+Timings with the patch
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: b = (5*sqrt2 + 14)/5
+sage: a = (3*sqrt2 + 18)/7
+sage: %timeit a < b
+625 loops, best of 3: 6.68 µs per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 478 ns per loop
+\`\`\`
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168100.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks again for the patch. A few comments:\n\n* reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.\n* Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.\n* I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.\n* `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.\n* `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.\n* To avoid code duplication, it might be better change the if statement to:\n\n```\n        if mpz_sgn(i)*mpz_sgn(j) == 1:\n            # both i and j are positive or negative\n            mpz_mul(i, i, i)\n            mpz_mul(j, j, j)\n            mpz_mul_ui(j, j, <unsigned int> left.D)\n\n            test = mpz_cmp(i, j)\n            if mpz_sgn(i) == -1:\n                # both i and j are negative\n                test *= -1\n```",
    "created_at": "2012-07-10T17:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168100",
    "user": "https://github.com/burcin"
}
```

<a id='comment:5'></a>Thanks again for the patch. A few comments:

* reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.
* Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.
* I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.
* `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.
* `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.
* To avoid code duplication, it might be better change the if statement to:

```
        if mpz_sgn(i)*mpz_sgn(j) == 1:
            # both i and j are positive or negative
            mpz_mul(i, i, i)
            mpz_mul(j, j, j)
            mpz_mul_ui(j, j, <unsigned int> left.D)

            test = mpz_cmp(i, j)
            if mpz_sgn(i) == -1:
                # both i and j are negative
                test *= -1
```



---

archive/issue_comments_168101.json:
```json
{
    "body": "<a id='comment:6'></a>> * reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.\n> * `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.\n\n\nDone and done.\n\n> * Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.\n\n\nWe loose speed (~1 micro sec) by doing this. I quickly look at the code of comparison for Integer. The comparison is directly implemented inside __richcmp__ and avoid as much as possible the coercion machinery (ie the type of the input is check with the cython function PY_TYPE_CHECK). Do you think we should proceed that way ?\n\n> * I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.\n\n\nWhat do you mean by too close ? How do I certify that my float comparison is accurate enough ?\nMoreover, if we proceed that way we have to perform conversion from mpz_t to float (or double or real_mpfr). A way it may work is to look first if a,b, D and denom have reasonable values (recall that mpz_t have unlimited precision) and if yes, convert it to double and try to compare the arguments.\nLast, I'm not sure the gain of speed would be terrific. Comparison requires only 7 integer operations.\n\n> * `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.\n\n\nActually there is no problem since we compute the sign of an expression of the form a^2 + b^2 D where a and b are both integers (and one of them is non null) and D is a square free integer. Hence the sign is never 0.\n\n> * To avoid code duplication, it might be better change the if statement to:\n> \n> ```\n>         if mpz_sgn(i)*mpz_sgn(j) == 1:\n>             # both i and j are positive or negative\n>             mpz_mul(i, i, i)\n>             mpz_mul(j, j, j)\n>             mpz_mul_ui(j, j, <unsigned int> left.D)\n> \n>             test = mpz_cmp(i, j)\n>             if mpz_sgn(i) == -1:\n>                 # both i and j are negative\n>                 test *= -1\n> ```\n\n\nSure but that way we call twice mpz_sgn(i)... I may change it if you prefer.\n\n\nActually, the part where a lot of time is lost is the check for embedding\n\n```\nif not RDF.has_coerce_map_from(left._parent):\n    ...\n```\nBy replacing it by\n\n```\nif left.D < 0:\n   ...\n```\nI pass from 4 micro second to 2 micro seconds. That way comparison without embedding for positive discriminant will be equivalent to comparison with the standard embedding. This is in the last version of the patch. What do you think about that ?",
    "created_at": "2012-07-11T07:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168101",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>> * reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.
> * `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.


Done and done.

> * Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.


We loose speed (~1 micro sec) by doing this. I quickly look at the code of comparison for Integer. The comparison is directly implemented inside __richcmp__ and avoid as much as possible the coercion machinery (ie the type of the input is check with the cython function PY_TYPE_CHECK). Do you think we should proceed that way ?

> * I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.


What do you mean by too close ? How do I certify that my float comparison is accurate enough ?
Moreover, if we proceed that way we have to perform conversion from mpz_t to float (or double or real_mpfr). A way it may work is to look first if a,b, D and denom have reasonable values (recall that mpz_t have unlimited precision) and if yes, convert it to double and try to compare the arguments.
Last, I'm not sure the gain of speed would be terrific. Comparison requires only 7 integer operations.

> * `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.


Actually there is no problem since we compute the sign of an expression of the form a^2 + b^2 D where a and b are both integers (and one of them is non null) and D is a square free integer. Hence the sign is never 0.

> * To avoid code duplication, it might be better change the if statement to:
> 
> ```
>         if mpz_sgn(i)*mpz_sgn(j) == 1:
>             # both i and j are positive or negative
>             mpz_mul(i, i, i)
>             mpz_mul(j, j, j)
>             mpz_mul_ui(j, j, <unsigned int> left.D)
> 
>             test = mpz_cmp(i, j)
>             if mpz_sgn(i) == -1:
>                 # both i and j are negative
>                 test *= -1
> ```


Sure but that way we call twice mpz_sgn(i)... I may change it if you prefer.


Actually, the part where a lot of time is lost is the check for embedding

```
if not RDF.has_coerce_map_from(left._parent):
    ...
```
By replacing it by

```
if left.D < 0:
   ...
```
I pass from 4 micro second to 2 micro seconds. That way comparison without embedding for positive discriminant will be equivalent to comparison with the standard embedding. This is in the last version of the patch. What do you think about that ?



---

archive/issue_comments_168102.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,43 @@\n+Provide the order from RR for real quadratic number field. The current implementation does\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 < 100\n+False\n+\\`\\`\\`\n+\n+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.\n+\n+The lost of speed is about x5 for positive discriminant and almost nothing for negative ones\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 2.36 \u00b5s per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a=3*s+2/4\n+sage: b=5/7*s+1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 600 ns per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 491 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a=3*s+2/4\n+sage: b=5/7*s+1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 488 ns per loop\n+\\`\\`\\`\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2012-07-11T07:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168102",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,43 @@
+Provide the order from RR for real quadratic number field. The current implementation does
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 < 100
+False
+\`\`\`
+
+There is a patch for quadratic field. Another one is comming for general number fields. Note that this patch is partly a duplicate because of #7160.
+
+The lost of speed is about x5 for positive discriminant and almost nothing for negative ones
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 2.36 µs per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a=3*s+2/4
+sage: b=5/7*s+1/3
+sage: %timeit a < b
+625 loops, best of 3: 600 ns per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 491 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a=3*s+2/4
+sage: b=5/7*s+1/3
+sage: %timeit a < b
+625 loops, best of 3: 488 ns per loop
+\`\`\`
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168103.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-14T18:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168103",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_168104.json:
```json
{
    "body": "<a id='comment:8'></a>The code for comparison introduces a small bug as it ask to the parent whether the embedding is standard or not (via the boolean attribute _standard_embedding). But the latter was not defined for Cyclotomic field of order 3,4,6 (which are the ones which are quadratic). In that case, the attribute _standard_embedding is created at the initialization of the cyclotomic field.\n\nThe new patch takes care of this.",
    "created_at": "2012-07-18T11:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168104",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>The code for comparison introduces a small bug as it ask to the parent whether the embedding is standard or not (via the boolean attribute _standard_embedding). But the latter was not defined for Cyclotomic field of order 3,4,6 (which are the ones which are quadratic). In that case, the attribute _standard_embedding is created at the initialization of the cyclotomic field.

The new patch takes care of this.



---

archive/issue_comments_168105.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-04T04:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168105",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_168106.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+The order of quadratic field is not induced from the order of RR and CC (when there is an embedding). More precisely we have\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 < 100\n+False\n+\\`\\`\\`\n+which is not compatible with the order of RR and\n+\n+\\`\\`\\`\n+sage: K.<i> = QuadraticField(-1)\n+sage: i > 1\n+True\n+sage: 1 > i\n+True\n+\\`\\`\\`\n+which is not compatible (!) with the order of CC.\n+\n+There is a patch for quadratic field. Another will come for general number fields. Note that this patch is partly a duplicate because of #7160. The modifications for the order on complex number field modify the behavior of many commands (output order).\n+\n+The lost of speed is about x5 for positive discriminant and almost nothing for negative ones\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 2.36 \u00b5s per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a=3*s+2/4\n+sage: b=5/7*s+1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 600 ns per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 491 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a=3*s+2/4\n+sage: b=5/7*s+1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 488 ns per loop\n+\\`\\`\\`\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2012-08-04T04:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168106",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,53 @@
+The order of quadratic field is not induced from the order of RR and CC (when there is an embedding). More precisely we have
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 < 100
+False
+\`\`\`
+which is not compatible with the order of RR and
+
+\`\`\`
+sage: K.<i> = QuadraticField(-1)
+sage: i > 1
+True
+sage: 1 > i
+True
+\`\`\`
+which is not compatible (!) with the order of CC.
+
+There is a patch for quadratic field. Another will come for general number fields. Note that this patch is partly a duplicate because of #7160. The modifications for the order on complex number field modify the behavior of many commands (output order).
+
+The lost of speed is about x5 for positive discriminant and almost nothing for negative ones
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 2.36 µs per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a=3*s+2/4
+sage: b=5/7*s+1/3
+sage: %timeit a < b
+625 loops, best of 3: 600 ns per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 491 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a=3*s+2/4
+sage: b=5/7*s+1/3
+sage: %timeit a < b
+625 loops, best of 3: 488 ns per loop
+\`\`\`
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168107.json:
```json
{
    "body": "<a id='comment:10'></a>Because there are many parents for quadratic elements, I was obliged to test whether the parent has a method '_standard_embedding' or not. I correct all tests (many output have changed) and waiting for patchbot and reviewer!",
    "created_at": "2012-08-04T12:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168107",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Because there are many parents for quadratic elements, I was obliged to test whether the parent has a method '_standard_embedding' or not. I correct all tests (many output have changed) and waiting for patchbot and reviewer!



---

archive/issue_comments_168108.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-04T12:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168108",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_168109.json:
```json
{
    "body": "<a id='comment:12'></a>I corrected the two last tests that have failed...",
    "created_at": "2012-08-08T09:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168109",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>I corrected the two last tests that have failed...



---

archive/issue_comments_168110.json:
```json
{
    "body": "<a id='comment:13'></a>How does this patch here relate to #7160?",
    "created_at": "2012-08-08T12:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168110",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>How does this patch here relate to #7160?



---

archive/issue_comments_168111.json:
```json
{
    "body": "<a id='comment:14'></a>In the ticket title \"real number field\", should it say \"quadratic number field\" instead?",
    "created_at": "2012-08-08T12:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168111",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>In the ticket title "real number field", should it say "quadratic number field" instead?



---

archive/issue_comments_168112.json:
```json
{
    "body": "<a id='comment:15'></a>Hi Jeroen,\n\nFrom the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?",
    "created_at": "2012-08-08T13:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168112",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>Hi Jeroen,

From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?



---

archive/issue_comments_168113.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 vdelecroix]:\n> From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?\n\nI don't care very much, but I think it should be clear how the various tickets relate to eachother.  \n\nAlso #10064 is related, at least it has #7160 as dependency.",
    "created_at": "2012-08-08T13:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168113",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:15 vdelecroix]:
> From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?

I don't care very much, but I think it should be clear how the various tickets relate to eachother.  

Also #10064 is related, at least it has #7160 as dependency.



---

archive/issue_comments_168114.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,75 @@\n+The order of number field with specified embedding is not induced from the order of RR and CC. More precisely we have\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 < 100\n+False\n+\n+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)\n+sage: s < 100\n+False\n+\\`\\`\\`\n+which is not compatible with the order of RR and\n+\n+\\`\\`\\`\n+sage: K.<i> = QuadraticField(-1)\n+sage: i > 1\n+True\n+sage: 1 > i\n+True\n+\\`\\`\\`\n+which is not compatible (!) with the order of CC.\n+\n+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers) and a patch for generic number fields with specified real embedding (for which comparisons are made using successive approximations).\n+\n+Note:\n+* this patch is partly a duplicate because of #7160\n+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).\n+\n+---\n+\n+The lost of speed is about x10 for quadratic field and about x100 for generic real number field.\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 4.32 \u00b5s per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s + 2/4\n+sage: b = 5/7*s + 1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 1.42 \u00b5s per loop\n+\n+sage: K.<s> = NumberField(x^3-3, 's', embedding=1.26)\n+sage: a = 3/15*s**2 - 4/7*s + 2/3\n+sage: b = -1/2*s**2 + s - 13/5\n+sage: %timeit a < b\n+625 loops, best of 3: 49.6 \u00b5s per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+625 loops, best of 3: 491 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s+2/4\n+sage: b = 5/7*s+1/3\n+sage: %timeit a < b\n+625 loops, best of 3: 488 ns per loop\n+\n+sage: K.<s>=NumberField(x^3-3, 's',embedding=1.26)\n+sage: a = 3/15*s**2 - 4/7*s + 2/3\n+sage: b = -1/2*s**2 + s - 13/5\n+sage: %timeit a < b\n+625 loops, best of 3: 845 ns per loop\n+\\`\\`\\`\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2012-08-08T15:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168114",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,75 @@
+The order of number field with specified embedding is not induced from the order of RR and CC. More precisely we have
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 < 100
+False
+
+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)
+sage: s < 100
+False
+\`\`\`
+which is not compatible with the order of RR and
+
+\`\`\`
+sage: K.<i> = QuadraticField(-1)
+sage: i > 1
+True
+sage: 1 > i
+True
+\`\`\`
+which is not compatible (!) with the order of CC.
+
+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers) and a patch for generic number fields with specified real embedding (for which comparisons are made using successive approximations).
+
+Note:
+* this patch is partly a duplicate because of #7160
+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).
+
+---
+
+The lost of speed is about x10 for quadratic field and about x100 for generic real number field.
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 4.32 µs per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s + 2/4
+sage: b = 5/7*s + 1/3
+sage: %timeit a < b
+625 loops, best of 3: 1.42 µs per loop
+
+sage: K.<s> = NumberField(x^3-3, 's', embedding=1.26)
+sage: a = 3/15*s**2 - 4/7*s + 2/3
+sage: b = -1/2*s**2 + s - 13/5
+sage: %timeit a < b
+625 loops, best of 3: 49.6 µs per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+625 loops, best of 3: 491 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s+2/4
+sage: b = 5/7*s+1/3
+sage: %timeit a < b
+625 loops, best of 3: 488 ns per loop
+
+sage: K.<s>=NumberField(x^3-3, 's',embedding=1.26)
+sage: a = 3/15*s**2 - 4/7*s + 2/3
+sage: b = -1/2*s**2 + s - 13/5
+sage: %timeit a < b
+625 loops, best of 3: 845 ns per loop
+\`\`\`
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168115.json:
```json
{
    "body": "<a id='comment:18'></a>Just had a quick look at your patch. How about using ``@`cached_method` as a decorator for `_gen_approx`? Then you don't have to implement caching yourself. It makes the code a little bit easier to read.",
    "created_at": "2012-08-09T15:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168115",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:18'></a>Just had a quick look at your patch. How about using ``@`cached_method` as a decorator for `_gen_approx`? Then you don't have to implement caching yourself. It makes the code a little bit easier to read.



---

archive/issue_comments_168116.json:
```json
{
    "body": "<a id='comment:19'></a>Hello,\n\nActually, a lot of time is lost for asking questions to the parent. For quadratic number field, it is for asking about the attribute _standard_embedding. I build a new patch with a bint attribute added to NumberFieldElement_quadratic and the speed of comparison is divided by 10 (from 4 milliseconds to 400 nanoseconds). It will be updated as soon as possible.\nAs modifying the structure of NumberFieldElement_quadratic is a major change, I will split the patch into two parts : quadratic number fields and general number fields.\n\nVincent",
    "created_at": "2012-08-13T15:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168116",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>Hello,

Actually, a lot of time is lost for asking questions to the parent. For quadratic number field, it is for asking about the attribute _standard_embedding. I build a new patch with a bint attribute added to NumberFieldElement_quadratic and the speed of comparison is divided by 10 (from 4 milliseconds to 400 nanoseconds). It will be updated as soon as possible.
As modifying the structure of NumberFieldElement_quadratic is a major change, I will split the patch into two parts : quadratic number fields and general number fields.

Vincent



---

archive/issue_comments_168117.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,68 @@\n+The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 < 100\n+False\n+\n+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)\n+sage: s < 100\n+False\n+\\`\\`\\`\n+which is not compatible with the order of RR and\n+\n+\\`\\`\\`\n+sage: K.<i> = QuadraticField(-1)\n+sage: i > 1\n+True\n+sage: 1 > i\n+True\n+\\`\\`\\`\n+which is not compatible (!) with the order of CC.\n+\n+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).\n+\n+Note:\n+* this patch is partly a duplicate because of #7160\n+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).\n+* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)\n+\n+---\n+\n+There is no significant lost of speed as shown on the following timings.\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+1000000 loops, best of 3: 408 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s + 2/4\n+sage: b = 5/7*s + 1/3\n+sage: %timeit a < b\n+1000000 loops, best of 3: 352 ns per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+1000000 loops, best of 3: 393 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s+2/4\n+sage: b = 5/7*s+1/3\n+sage: %timeit a < b\n+1000000 loops, best of 3: 344 ns per loop\n+\\`\\`\\`\n+\n+Apply:\n+\n+* trac_13213-quadratic_field_comparison.patch\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2013-05-10T09:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168117",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,68 @@
+The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 < 100
+False
+
+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)
+sage: s < 100
+False
+\`\`\`
+which is not compatible with the order of RR and
+
+\`\`\`
+sage: K.<i> = QuadraticField(-1)
+sage: i > 1
+True
+sage: 1 > i
+True
+\`\`\`
+which is not compatible (!) with the order of CC.
+
+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).
+
+Note:
+* this patch is partly a duplicate because of #7160
+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).
+* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)
+
+---
+
+There is no significant lost of speed as shown on the following timings.
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+1000000 loops, best of 3: 408 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s + 2/4
+sage: b = 5/7*s + 1/3
+sage: %timeit a < b
+1000000 loops, best of 3: 352 ns per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+1000000 loops, best of 3: 393 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s+2/4
+sage: b = 5/7*s+1/3
+sage: %timeit a < b
+1000000 loops, best of 3: 344 ns per loop
+\`\`\`
+
+Apply:
+
+* trac_13213-quadratic_field_comparison.patch
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168118.json:
```json
{
    "body": "<a id='comment:21'></a>apply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T09:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168118",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_168119.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-10T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168119",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_168120.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,68 @@\n+The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have\n \n+\\`\\`\\`\n+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\n+sage: sqrt2 < 100\n+False\n+\n+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)\n+sage: s < 100\n+False\n+\\`\\`\\`\n+which is not compatible with the order of RR and\n+\n+\\`\\`\\`\n+sage: K.<i> = QuadraticField(-1)\n+sage: i > 1\n+True\n+sage: 1 > i\n+True\n+\\`\\`\\`\n+which is not compatible (!) with the order of CC.\n+\n+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).\n+\n+Note:\n+* this patch is partly a duplicate because of #7160\n+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).\n+* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)\n+\n+---\n+\n+There is no significant lost of speed as shown on the following timings.\n+\n+\\`\\`\\`\n+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+1000000 loops, best of 3: 408 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s + 2/4\n+sage: b = 5/7*s + 1/3\n+sage: %timeit a < b\n+1000000 loops, best of 3: 352 ns per loop\n+\\`\\`\\`\n+Timings without the patch\n+\n+\\`\\`\\`\n+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)\n+sage: a = (3*sqrt2 + 18)/7\n+sage: b = (5*sqrt2 + 14)/5\n+sage: %timeit a < b\n+1000000 loops, best of 3: 393 ns per loop\n+\n+sage: K.<s> = QuadraticField(-2)\n+sage: a = 3*s+2/4\n+sage: b = 5/7*s+1/3\n+sage: %timeit a < b\n+1000000 loops, best of 3: 344 ns per loop\n+\\`\\`\\`\n+\n+Apply:\n+\n+* [attachment:trac_13213-quadratic_field_comparison.patch]\n \n Author: vdelecroix\n \n```\n",
    "created_at": "2013-05-10T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168120",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,68 @@
+The order of quadratic field with specified embedding is not induced from the order of RR and CC. More precisely we have
 
+\`\`\`
+sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
+sage: sqrt2 < 100
+False
+
+sage: K.<s> = NumberField(x^3 - 2, 's', embedding=1.26)
+sage: s < 100
+False
+\`\`\`
+which is not compatible with the order of RR and
+
+\`\`\`
+sage: K.<i> = QuadraticField(-1)
+sage: i > 1
+True
+sage: 1 > i
+True
+\`\`\`
+which is not compatible (!) with the order of CC.
+
+The ticket implements the order for quadratic field (for which comparisons are made using only operations on integers).
+
+Note:
+* this patch is partly a duplicate because of #7160
+* the modifications for quadratic field field modify the behavior of many commands (especially about output order).
+* the patch introduces a new attribute to NumberFieldElement_quadratic called standard_embedding (of type bint)
+
+---
+
+There is no significant lost of speed as shown on the following timings.
+
+\`\`\`
+sage: K.<sqrt2> = QuadraticField(2, 'sqrt2', embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+1000000 loops, best of 3: 408 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s + 2/4
+sage: b = 5/7*s + 1/3
+sage: %timeit a < b
+1000000 loops, best of 3: 352 ns per loop
+\`\`\`
+Timings without the patch
+
+\`\`\`
+sage: sage: K.<sqrt2> = QuadraticField(2,'sqrt2',embedding=1.4142)
+sage: a = (3*sqrt2 + 18)/7
+sage: b = (5*sqrt2 + 14)/5
+sage: %timeit a < b
+1000000 loops, best of 3: 393 ns per loop
+
+sage: K.<s> = QuadraticField(-2)
+sage: a = 3*s+2/4
+sage: b = 5/7*s+1/3
+sage: %timeit a < b
+1000000 loops, best of 3: 344 ns per loop
+\`\`\`
+
+Apply:
+
+* [attachment:trac_13213-quadratic_field_comparison.patch]
 
 Author: vdelecroix
 
```




---

archive/issue_comments_168121.json:
```json
{
    "body": "<a id='comment:22'></a>This fails to apply on 5.10.beta2.\nHaving a look right now.",
    "created_at": "2013-05-10T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168121",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>This fails to apply on 5.10.beta2.
Having a look right now.



---

archive/issue_comments_168122.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 jpflori]:\n> This fails to apply on 5.10.beta2.\n\n\nYes, it is a minor rejection on sage/schemes/elliptic_curves/ell_number_field.py and a more serious problem with python_object.pxi that seems to not exist anymore.\n\n> Having a look right now.\n\n\nDoes it mean that I should wait for your modifications ?",
    "created_at": "2013-05-10T14:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168122",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>Replying to [comment:22 jpflori]:
> This fails to apply on 5.10.beta2.


Yes, it is a minor rejection on sage/schemes/elliptic_curves/ell_number_field.py and a more serious problem with python_object.pxi that seems to not exist anymore.

> Having a look right now.


Does it mean that I should wait for your modifications ?



---

archive/issue_comments_168123.json:
```json
{
    "body": "<a id='comment:24'></a>No, if you identified the issues, please go ahead.\nI've just untarred 10.beta2 and are currently on something else, so you will definitely get faster.",
    "created_at": "2013-05-10T15:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168123",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>No, if you identified the issues, please go ahead.
I've just untarred 10.beta2 and are currently on something else, so you will definitely get faster.



---

archive/issue_comments_168124.json:
```json
{
    "body": "<a id='comment:25'></a>For the second problem I simply removed the import of python_object.pxi which was not needed anymore.\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T15:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168124",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>For the second problem I simply removed the import of python_object.pxi which was not needed anymore.

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_168125.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-10T15:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168125",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_168126.json:
```json
{
    "body": "<a id='comment:27'></a>Last minute modification: more tests, more docs.\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T16:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168126",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>Last minute modification: more tests, more docs.

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_168127.json:
```json
{
    "body": "<a id='comment:28'></a>#7545 is possibly a related ticket.",
    "created_at": "2013-05-10T16:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168127",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:28'></a>#7545 is possibly a related ticket.



---

archive/issue_comments_168128.json:
```json
{
    "body": "<a id='comment:29'></a>There is a **strange** problem\n\n```\nsage: K.<sqrt2> = QuadraticField(2)\nsage: 1/2 + sqrt2 > 0\nFalse\n```",
    "created_at": "2013-05-10T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168128",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>There is a **strange** problem

```
sage: K.<sqrt2> = QuadraticField(2)
sage: 1/2 + sqrt2 > 0
False
```



---

archive/issue_comments_168129.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-10T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168129",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_168130.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 vdelecroix]:\n> There is a **strange** problem\n> \n> ```\n> sage: K.<sqrt2> = QuadraticField(2)\n> sage: 1/2 + sqrt2 > 0\n> False\n> ```\n\n\nI got the problem... it was because there is a natural morphism implemented from the rational field to quadratic number field (`sage.rings.number_field.number_field_element_quadratic.Q_to_quadratic_field_element`) which uses a non properly initialized instance of a quadratic element !",
    "created_at": "2013-05-10T19:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168130",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>Replying to [comment:29 vdelecroix]:
> There is a **strange** problem
> 
> ```
> sage: K.<sqrt2> = QuadraticField(2)
> sage: 1/2 + sqrt2 > 0
> False
> ```


I got the problem... it was because there is a natural morphism implemented from the rational field to quadratic number field (`sage.rings.number_field.number_field_element_quadratic.Q_to_quadratic_field_element`) which uses a non properly initialized instance of a quadratic element !



---

archive/issue_comments_168131.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-10T19:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168131",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_168132.json:
```json
{
    "body": "<a id='comment:31'></a>apply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T19:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168132",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_168133.json:
```json
{
    "body": "<a id='comment:32'></a>I get a doctest failure with sage-5.10.beta2:\n\n```\nFile \"devel/sage/doc/de/tutorial/tour_advanced.rst\", line 483, in doc.de.tutorial.tour_advanced\nFailed example:\n    M.T(2).charpoly('x').factor()\nExpected:\n    (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2\nGot:\n    (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2\n**********************************************************************\n1 item had failures:\n   1 of 136 in doc.de.tutorial.tour_advanced\n    [118 tests, 1 failure, 1.44 s]\n```",
    "created_at": "2013-05-14T11:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168133",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>I get a doctest failure with sage-5.10.beta2:

```
File "devel/sage/doc/de/tutorial/tour_advanced.rst", line 483, in doc.de.tutorial.tour_advanced
Failed example:
    M.T(2).charpoly('x').factor()
Expected:
    (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2
Got:
    (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2
**********************************************************************
1 item had failures:
   1 of 136 in doc.de.tutorial.tour_advanced
    [118 tests, 1 failure, 1.44 s]
```



---

archive/issue_comments_168134.json:
```json
{
    "body": "Attachment [trac_13213-quadratic_field_comparison.patch](tarball://root/attachments/some-uuid/ticket13213/trac_13213-quadratic_field_comparison.patch) by @videlec created at 2013-05-15 14:31:02",
    "created_at": "2013-05-15T14:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168134",
    "user": "https://github.com/videlec"
}
```

Attachment [trac_13213-quadratic_field_comparison.patch](tarball://root/attachments/some-uuid/ticket13213/trac_13213-quadratic_field_comparison.patch) by @videlec created at 2013-05-15 14:31:02



---

archive/issue_comments_168135.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 vbraun]:\n> I get a doctest failure with sage-5.10.beta2:\n> \n> ```\n> File \"devel/sage/doc/de/tutorial/tour_advanced.rst\", line 483, in doc.de.tutorial.tour_advanced\n> Failed example:\n>     M.T(2).charpoly('x').factor()\n> Expected:\n>     (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2\n> Got:\n>     (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2\n> **********************************************************************\n> 1 item had failures:\n>    1 of 136 in doc.de.tutorial.tour_advanced\n>     [118 tests, 1 failure, 1.44 s]\n> ```\n\n\nThanks for that. I got the same error on my computer and change the patch accordingly. Why was patchbot happy with the former patch ?\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-15T14:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168135",
    "user": "https://github.com/videlec"
}
```

<a id='comment:33'></a>Replying to [comment:32 vbraun]:
> I get a doctest failure with sage-5.10.beta2:
> 
> ```
> File "devel/sage/doc/de/tutorial/tour_advanced.rst", line 483, in doc.de.tutorial.tour_advanced
> Failed example:
>     M.T(2).charpoly('x').factor()
> Expected:
>     (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2
> Got:
>     (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2
> **********************************************************************
> 1 item had failures:
>    1 of 136 in doc.de.tutorial.tour_advanced
>     [118 tests, 1 failure, 1.44 s]
> ```


Thanks for that. I got the same error on my computer and change the patch accordingly. Why was patchbot happy with the former patch ?

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_168136.json:
```json
{
    "body": "<a id='comment:34'></a>The patchbot apparently doesn't check German docs. Entt\u00e4uschend! ;-)",
    "created_at": "2013-05-15T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168136",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>The patchbot apparently doesn't check German docs. Enttäuschend! ;-)



---

archive/issue_comments_168137.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-15T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168137",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_168138.json:
```json
{
    "body": "<a id='comment:35'></a>All tests pass.",
    "created_at": "2013-05-15T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168138",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>All tests pass.



---

archive/issue_events_036429.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-17T06:32:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13213#event-36429"
}
```



---

archive/issue_comments_168139.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-17T06:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-168139",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
