# Issue 13300: Fix __getitem__ and slicing for p-adics

archive/issues_013128.json:
```json
{
    "body": "This is a meta-ticket to track progress on fixing `__getitem__` and slicing of p-adic elements and their .expansion().\n\n**Assignee:** @roed314\n\n**Author:** Julian Rueth\n\n**Status:** needs_info\n\n**Dependencies:** #13299, #14304, #26406, #26407, #26408\n\nIssue created by migration from https://trac.sagemath.org/ticket/13300\n\n",
    "created_at": "2012-07-26T17:10:11Z",
    "labels": [
        "component: padics",
        "trivial",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix __getitem__ and slicing for p-adics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13300",
    "user": "https://github.com/saraedum"
}
```
This is a meta-ticket to track progress on fixing `__getitem__` and slicing of p-adic elements and their .expansion().

**Assignee:** @roed314

**Author:** Julian Rueth

**Status:** needs_info

**Dependencies:** #13299, #14304, #26406, #26407, #26408

Issue created by migration from https://trac.sagemath.org/ticket/13300





---

archive/issue_comments_191402.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe attached file (which has an extra 3 in the filename, sorry) fixes this.\n\nTo be consistent, indexing gives elements in the residue field. Mathematically, this seems to make sense, but is this really what one wants?\n\nI'm running all doctests now to see if this breaks anything.",
    "created_at": "2012-07-26T17:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191402",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>
The attached file (which has an extra 3 in the filename, sorry) fixes this.

To be consistent, indexing gives elements in the residue field. Mathematically, this seems to make sense, but is this really what one wants?

I'm running all doctests now to see if this breaks anything.



---

archive/issue_comments_191403.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe doctests worked, so I'm setting this to needs review.",
    "created_at": "2012-07-26T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191403",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>
The doctests worked, so I'm setting this to needs review.



---

archive/issue_comments_191404.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-07-26T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191404",
    "user": "https://github.com/saraedum"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_191405.json:
```json
{
    "body": "**Author:** Julian Rueth",
    "created_at": "2012-07-26T18:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191405",
    "user": "https://github.com/saraedum"
}
```

**Author:** Julian Rueth



---

archive/issue_comments_191406.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2012-10-24T06:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191406",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to needs_info.



---

archive/attachments_018007.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13330.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13300/trac_13330.patch",
    "created_at": "2012-10-24T06:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_191407.json:
```json
{
    "body": "<a id='comment:4'></a>\nI don't think that giving elements of the residue field is what we want, though I agree that the current behavior for unramified extensions is silly.  I would like to be able to have \n\n```\nsage: K.<a> = Qq(7^2, 20)\nsage: z = K.random_element()\nsage: z == sum([z[i] * 7^i for i in range(20)])\nTrue\n```\nwithout having to lift from the residue field.\n\nOf course, sometimes you want to get at the coefficient of `a` in `z`, or the coefficient of `a` in `z[0]`.  Here's an idea.  For matrices, we have the following::\n\n```\nsage: M = matrix(ZZ,4,4,range(16))\nsage: M[0]\n(0, 1, 2, 3)\nsage: M[0,0]\n0\nsage: M[0,:]\n[0 1 2 3]\nsage: M[:,0]\n[ 0]\n[ 4]\n[ 8]\n[12]\nsage: M[1:3,1:4]\n[ 5  6  7]\n[ 9 10 11]\n```\n\nWhat if we used a similar tuple indexing scheme for p-adic elements?  For example:\n\n```\nsage: K.<a> = Qq(5^4,5)\nsage: z = K.random_element(); z\na^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + 4*a^3*5 + (4*a + 2)*5^2 + O(5^3)\nsage: z[0]\n3*a^3 + a^2 + 3*a + O(5^3)\nsage: z[2]\n4*a + 2 + O(5)\nsage: z[2].parent()\nUnramified Extension of 5-adic Field with capped relative precision 5 in a defined by (1 + O(5^5))*x^4 + (O(5^5))*x^3 + (4 + O(5^5))*x^2 + (4 + O(5^5))*x + (2 + O(5^5))\nsage: z[0,0]\nO(5^3)\nsage: z[0,0].parent()\n5-adic Field with capped relative precision 5\nsage: z[2,0]\n2 + O(5)\nsage: z[2,1]\n4 + O(5)\nsage: z[:-1]\na^3*5^-2 + O(5^-1)\nsage: z[:1]\na^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + O(5)\nsage: z[:] == z[:,:] == z\nTrue\nsage: all([z[i,:] == z[i] for i in range(-3,2)])\nTrue\nsage: z[:,0]\n2*5^2 + O(5^3)\nsage: z[:,0].parent()\n5-adic Field with capped relative precision 5\nsage: z[:,1]\n3 + 4*5^2 + O(5^3)\nsage: z[:,2]\n3*5^-1 + 1 + O(5^3)\nsage: z[:,3]\n5^-2 + 3*5^-1 + 3 + 4*5 + O(5^3)\nsage: sum([a^j * z[:,j] for j in range(4)]) == z\nTrue\nsage: z[-1:2,1:3]\n3*a^2*5^-1 + (a^2 + 3*a) + O(5^2)\n```\nThe parent of z[i], z[i,T] and z[S,T] (for integer i and slices S,T) would be the unramified extension; the parent of z[i,j] and z[S,j] would be the ground field (or ring).  Negative indices would never be considered as counting backward from a length, even for ring elements.\n\nWhat do you think?",
    "created_at": "2012-10-24T06:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191407",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>
I don't think that giving elements of the residue field is what we want, though I agree that the current behavior for unramified extensions is silly.  I would like to be able to have 

```
sage: K.<a> = Qq(7^2, 20)
sage: z = K.random_element()
sage: z == sum([z[i] * 7^i for i in range(20)])
True
```
without having to lift from the residue field.

Of course, sometimes you want to get at the coefficient of `a` in `z`, or the coefficient of `a` in `z[0]`.  Here's an idea.  For matrices, we have the following::

```
sage: M = matrix(ZZ,4,4,range(16))
sage: M[0]
(0, 1, 2, 3)
sage: M[0,0]
0
sage: M[0,:]
[0 1 2 3]
sage: M[:,0]
[ 0]
[ 4]
[ 8]
[12]
sage: M[1:3,1:4]
[ 5  6  7]
[ 9 10 11]
```

What if we used a similar tuple indexing scheme for p-adic elements?  For example:

```
sage: K.<a> = Qq(5^4,5)
sage: z = K.random_element(); z
a^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + 4*a^3*5 + (4*a + 2)*5^2 + O(5^3)
sage: z[0]
3*a^3 + a^2 + 3*a + O(5^3)
sage: z[2]
4*a + 2 + O(5)
sage: z[2].parent()
Unramified Extension of 5-adic Field with capped relative precision 5 in a defined by (1 + O(5^5))*x^4 + (O(5^5))*x^3 + (4 + O(5^5))*x^2 + (4 + O(5^5))*x + (2 + O(5^5))
sage: z[0,0]
O(5^3)
sage: z[0,0].parent()
5-adic Field with capped relative precision 5
sage: z[2,0]
2 + O(5)
sage: z[2,1]
4 + O(5)
sage: z[:-1]
a^3*5^-2 + O(5^-1)
sage: z[:1]
a^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + O(5)
sage: z[:] == z[:,:] == z
True
sage: all([z[i,:] == z[i] for i in range(-3,2)])
True
sage: z[:,0]
2*5^2 + O(5^3)
sage: z[:,0].parent()
5-adic Field with capped relative precision 5
sage: z[:,1]
3 + 4*5^2 + O(5^3)
sage: z[:,2]
3*5^-1 + 1 + O(5^3)
sage: z[:,3]
5^-2 + 3*5^-1 + 3 + 4*5 + O(5^3)
sage: sum([a^j * z[:,j] for j in range(4)]) == z
True
sage: z[-1:2,1:3]
3*a^2*5^-1 + (a^2 + 3*a) + O(5^2)
```
The parent of z[i], z[i,T] and z[S,T] (for integer i and slices S,T) would be the unramified extension; the parent of z[i,j] and z[S,j] would be the ground field (or ring).  Negative indices would never be considered as counting backward from a length, even for ring elements.

What do you think?



---

archive/issue_events_042421.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42421"
}
```



---

archive/issue_events_042422.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42422"
}
```



---

archive/issue_events_042423.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42423"
}
```



---

archive/issue_events_042424.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42424"
}
```



---

archive/issue_events_042425.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42425"
}
```



---

archive/issue_comments_191408.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2014-06-25T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191408",
    "user": "https://github.com/saraedum"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_191409.json:
```json
{
    "body": "**Changing dependencies** from \"#13299\" to \"#13299, #14304\".",
    "created_at": "2014-06-25T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191409",
    "user": "https://github.com/saraedum"
}
```

**Changing dependencies** from "#13299" to "#13299, #14304".



---

archive/issue_comments_191410.json:
```json
{
    "body": "<a id='comment:8'></a>\nLet's think about this again once #14304 has been merged.",
    "created_at": "2014-06-25T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191410",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>
Let's think about this again once #14304 has been merged.



---

archive/issue_events_042426.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42426"
}
```



---

archive/issue_events_042427.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42427"
}
```



---

archive/issue_comments_191411.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2016-11-29T07:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191411",
    "user": "https://github.com/saraedum"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_191412.json:
```json
{
    "body": "<a id='comment:10'></a>\nI like your proposal. Let's discuss this at one of the IRC sessions.",
    "created_at": "2016-11-29T07:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191412",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
I like your proposal. Let's discuss this at one of the IRC sessions.



---

archive/issue_comments_191413.json:
```json
{
    "body": "**Changing dependencies** from \"#13299, #14304\" to \"#13299, #14304, #26406, 26407\".",
    "created_at": "2018-10-04T23:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191413",
    "user": "https://github.com/saraedum"
}
```

**Changing dependencies** from "#13299, #14304" to "#13299, #14304, #26406, 26407".



---

archive/issue_comments_191414.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,3 +16,9 @@\n sage: a[0:2]\n TypeError\n ```\n+\n+These should behave like in number fields, see #26406.\n+\n+At the same time, `.expansion` should behave as outlined in https://trac.sagemath.org/timeline?from=2012-10-24T06%3A53%3A31Z&precision=second, see #\n+\n+This is a meta-ticket to keep track of efforts to improve indexing and slicing in p-adics and their `.expansion()`.\n``````\n",
    "created_at": "2018-10-04T23:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191414",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,3 +16,9 @@
 sage: a[0:2]
 TypeError
 ```
+
+These should behave like in number fields, see #26406.
+
+At the same time, `.expansion` should behave as outlined in https://trac.sagemath.org/timeline?from=2012-10-24T06%3A53%3A31Z&precision=second, see #
+
+This is a meta-ticket to keep track of efforts to improve indexing and slicing in p-adics and their `.expansion()`.
``````




---

archive/issue_comments_191415.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,24 +1 @@\n-There are some strange results when indexing into an element of an unramified extension.\n-\n-In the following example, I think it would make more sense to return an element in the residue field:\n-\n-```\n-sage: K=Qp(3,5)\n-sage: R.<a> = K[]\n-sage: L.<a> = K.extension(a^2+a-1)\n-sage: a[0]\n-[0, 1]\n-```\n-\n-Slices do not work at all currently:\n-\n-```\n-sage: a[0:2]\n-TypeError\n-```\n-\n-These should behave like in number fields, see #26406.\n-\n-At the same time, `.expansion` should behave as outlined in https://trac.sagemath.org/timeline?from=2012-10-24T06%3A53%3A31Z&precision=second, see #\n-\n-This is a meta-ticket to keep track of efforts to improve indexing and slicing in p-adics and their `.expansion()`.\n+This is a meta-ticket to track progress on fixing `__getitem__` and slicing of p-adic elements and their .expansion().\n``````\n",
    "created_at": "2018-10-04T23:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191415",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,24 +1 @@
-There are some strange results when indexing into an element of an unramified extension.
-
-In the following example, I think it would make more sense to return an element in the residue field:
-
-```
-sage: K=Qp(3,5)
-sage: R.<a> = K[]
-sage: L.<a> = K.extension(a^2+a-1)
-sage: a[0]
-[0, 1]
-```
-
-Slices do not work at all currently:
-
-```
-sage: a[0:2]
-TypeError
-```
-
-These should behave like in number fields, see #26406.
-
-At the same time, `.expansion` should behave as outlined in https://trac.sagemath.org/timeline?from=2012-10-24T06%3A53%3A31Z&precision=second, see #
-
-This is a meta-ticket to keep track of efforts to improve indexing and slicing in p-adics and their `.expansion()`.
+This is a meta-ticket to track progress on fixing `__getitem__` and slicing of p-adic elements and their .expansion().
``````




---

archive/issue_events_042428.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "rename": {
        "from": "slice and __getitem__ do not work over unramified extensions of padics",
        "to": "Fix __getitem__ and slicing for p-adics"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13300#event-42428"
}
```



---

archive/issue_comments_191416.json:
```json
{
    "body": "**Changing dependencies** from \"#13299, #14304, #26406, 26407\" to \"#13299, #14304, #26406, #26407, #26408\".",
    "created_at": "2018-10-04T23:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-191416",
    "user": "https://github.com/saraedum"
}
```

**Changing dependencies** from "#13299, #14304, #26406, 26407" to "#13299, #14304, #26406, #26407, #26408".
