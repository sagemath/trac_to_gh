# Issue 13781: Fix doctests that want write access to $HOME

archive/issues_013781.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @kiwifb\n\nIn order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).\n\nIn #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.\n\n**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)\n\nIssue created by migration from https://trac.sagemath.org/ticket/13985\n\n",
    "closed_at": "2013-01-25T21:20:14Z",
    "created_at": "2013-01-22T14:05:23Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Fix doctests that want write access to $HOME",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13781",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: tbd

CC:  @kiwifb

In order to make Sage as self-contained as possible, it would be good if Sage would run assuming write access only to $TMPDIR (`/tmp` by default) and $DOT_SAGE (`~/.sage` by default).

In #5155 we already fixed write access to `$SAGE_ROOT`, the only remaining problem is SciPy which wants to write to `$HOME/.python27_compiled`.

**upstream**: [http://projects.scipy.org/scipy/ticket/1821](http://projects.scipy.org/scipy/ticket/1821)

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/scipy-0.11.0.p0.spkg)

Issue created by migration from https://trac.sagemath.org/ticket/13985





---

archive/issue_comments_170828.json:
```json
{
    "body": "Diff for the SciPy spkg, for review only",
    "created_at": "2013-01-22T14:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170828",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the SciPy spkg, for review only



---

archive/issue_comments_170829.json:
```json
{
    "body": "Attachment [scipy-0.11.0.p0.diff](tarball://root/attachments/some-uuid/ticket13985/scipy-0.11.0.p0.diff) by @jdemeyer created at 2013-01-22 14:12:15",
    "created_at": "2013-01-22T14:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170829",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [scipy-0.11.0.p0.diff](tarball://root/attachments/some-uuid/ticket13985/scipy-0.11.0.p0.diff) by @jdemeyer created at 2013-01-22 14:12:15



---

archive/issue_comments_170830.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-22T19:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170830",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_170831.json:
```json
{
    "body": "Not using sage_fortran anymore is good. i am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct? This is very important for scipy (which will test for any fortran compiler that it knows off including the ones broken because they don't have a license).  Is weave the only file to want access to .pythonxx_compiled? Sounds like an upstream bug to me in any case. I'll give this a closer look from something else than an iPad before approving.",
    "created_at": "2013-01-22T20:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170831",
    "user": "https://github.com/kiwifb"
}
```

Not using sage_fortran anymore is good. i am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct? This is very important for scipy (which will test for any fortran compiler that it knows off including the ones broken because they don't have a license).  Is weave the only file to want access to .pythonxx_compiled? Sounds like an upstream bug to me in any case. I'll give this a closer look from something else than an iPad before approving.



---

archive/issue_comments_170832.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> Is weave the only file to want access to .pythonxx_compiled?\n\nYes.\n\n> Sounds like an upstream bug to me in any case.\n\nAgreed.",
    "created_at": "2013-01-22T20:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170832",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 fbissey]:
> Is weave the only file to want access to .pythonxx_compiled?

Yes.

> Sounds like an upstream bug to me in any case.

Agreed.



---

archive/issue_comments_170833.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> I am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct?\n\nNot quite.  If the GCC spkg is installed, then yes, we force the use of Sage's `gfortran`.  If it's not installed, we don't set any variables and let `scipy` figure it out.  That sounds reasonable and in any case seems to work fine for the `R` spkg.",
    "created_at": "2013-01-22T20:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170833",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 fbissey]:
> I am asuming that we have set all the fortran variables either in prereq or the gcc spkg, correct?

Not quite.  If the GCC spkg is installed, then yes, we force the use of Sage's `gfortran`.  If it's not installed, we don't set any variables and let `scipy` figure it out.  That sounds reasonable and in any case seems to work fine for the `R` spkg.



---

archive/issue_comments_170834.json:
```json
{
    "body": "The Fortran stuff has problems indeed, it seems that SCons does The Wrong Thing on OpenSolaris (which just proves my point again that SCons is utter crap compared to an autotools-based system, R for example compiles Fortran code just fine).",
    "created_at": "2013-01-23T07:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170834",
    "user": "https://github.com/jdemeyer"
}
```

The Fortran stuff has problems indeed, it seems that SCons does The Wrong Thing on OpenSolaris (which just proves my point again that SCons is utter crap compared to an autotools-based system, R for example compiles Fortran code just fine).



---

archive/issue_comments_170835.json:
```json
{
    "body": "It would be easy to make this ticket  a !SCons bashing exercise (I am sure your expressed opinion is watered down compared to your real one and I would be agreeing to the non-watered down too).",
    "created_at": "2013-01-23T08:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170835",
    "user": "https://github.com/kiwifb"
}
```

It would be easy to make this ticket  a !SCons bashing exercise (I am sure your expressed opinion is watered down compared to your real one and I would be agreeing to the non-watered down too).



---

archive/issue_comments_170836.json:
```json
{
    "body": "Fran\u00e7ois: any chance you can review this, now that the Fortran problem is solved?",
    "created_at": "2013-01-25T15:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170836",
    "user": "https://github.com/jdemeyer"
}
```

Fran√ßois: any chance you can review this, now that the Fortran problem is solved?



---

archive/issue_comments_170837.json:
```json
{
    "body": "Since upstream has approved the patch and all the other issues have been dealt with, I am reviewing this positive. I was going to do test builds but you do more of these than me :)",
    "created_at": "2013-01-25T19:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170837",
    "user": "https://github.com/kiwifb"
}
```

Since upstream has approved the patch and all the other issues have been dealt with, I am reviewing this positive. I was going to do test builds but you do more of these than me :)



---

archive/issue_comments_170838.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-25T19:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170838",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_039294.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-25T21:20:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13781#event-39294"
}
```



---

archive/issue_comments_170839.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-25T21:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13781#issuecomment-170839",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
