# Issue 13196: GL(n, GF(q)).random_element() is way too slow for what it does

archive/issues_013024.json:
```json
{
    "assignees": [],
    "body": "GL(32, GF(2)).random_element() takes more than 10s, which is ridiculous.\n\nProposed solution : use simple rejection sampling (i.e. generate a random matrix, check if it invertible, if not try again). The result is uniformly distributed amongst invertible matrices.\n\nBefore patch:\n\n```\nsage: %time GL(64, GF(2)).random_element() \n5 loops, best of 3: 15.5 s per loop\n```\n\nAfter patch :\n\n```\nsage: %timeit GL(64, GF(2)).random_element()\n625 loops, best of 3: 2ms per loop\n```\n\nApply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)\n\nAssignee: **@wdjoyner**\n\nCC:  @malb @dimpase\n\nKeywords: **matrix group, finite field, random element**\n\nReviewer: **Dima Pasechnik, Charles Bouillaguet**\n\nAuthor: **Charles Bouillaguet, Javier L\u00f3pez Pe\u00f1a**\n\nMerged: **sage-5.2.beta1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13196_\n\n",
    "closed_at": "2012-07-07T22:31:54Z",
    "created_at": "2012-07-03T15:31:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GL(n, GF(q)).random_element() is way too slow for what it does",
    "type": "issue",
    "updated_at": "2012-07-07T22:31:54Z",
    "url": "https://github.com/sagemath/sage/issues/13196",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```
GL(32, GF(2)).random_element() takes more than 10s, which is ridiculous.

Proposed solution : use simple rejection sampling (i.e. generate a random matrix, check if it invertible, if not try again). The result is uniformly distributed amongst invertible matrices.

Before patch:

```
sage: %time GL(64, GF(2)).random_element() 
5 loops, best of 3: 15.5 s per loop
```

After patch :

```
sage: %timeit GL(64, GF(2)).random_element()
625 loops, best of 3: 2ms per loop
```

Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)

Assignee: **@wdjoyner**

CC:  @malb @dimpase

Keywords: **matrix group, finite field, random element**

Reviewer: **Dima Pasechnik, Charles Bouillaguet**

Author: **Charles Bouillaguet, Javier López Peña**

Merged: **sage-5.2.beta1**

_Issue created by migration from https://trac.sagemath.org/ticket/13196_





---

archive/issue_events_168087.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168087"
}
```



---

archive/issue_events_168088.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "component: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168088"
}
```



---

archive/issue_events_168089.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168089"
}
```



---

archive/issue_events_168090.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168090"
}
```



---

archive/issue_comments_153675.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nOK, cool, where is the patch? \n:)",
    "created_at": "2012-07-03T15:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153675",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">Comment 1</div>

OK, cool, where is the patch? 
:)



---

archive/issue_comments_153676.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nReplying to [@dimpase](#comment%3A1):\n> OK, cool, where is the patch? \n> :)\n\nSorry, it took me a while as I made a mistake (patched sage/groups/matrix_gps/matrix_group.py first instead of sage/groups/matrix_gps/general_linear.py, which is very wrong. The doctest caught it though....)",
    "created_at": "2012-07-03T15:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153676",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:2" align="right">Comment 2</div>

Replying to [@dimpase](#comment%3A1):
> OK, cool, where is the patch? 
> :)

Sorry, it took me a while as I made a mistake (patched sage/groups/matrix_gps/matrix_group.py first instead of sage/groups/matrix_gps/general_linear.py, which is very wrong. The doctest caught it though....)



---

archive/issue_events_168091.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:56:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168091"
}
```



---

archive/issue_events_168092.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T16:01:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168092"
}
```



---

archive/issue_events_168093.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T16:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168093"
}
```



---

archive/issue_comments_153677.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nCould you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\nanswer in about 3 iterations ?",
    "created_at": "2012-07-03T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153677",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">Comment 4</div>

Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
answer in about 3 iterations ?



---

archive/issue_comments_153678.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@dimpase](#comment%3A4):\n> Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\n> answer in about 3 iterations ?\n\nThis is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` \n\nFor `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.\n\nIs that OK with you ?",
    "created_at": "2012-07-03T17:03:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153678",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@dimpase](#comment%3A4):
> Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
> answer in about 3 iterations ?

This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` 

For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.

Is that OK with you ?



---

archive/issue_comments_153679.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A5):\n> Replying to [@dimpase](#comment%3A4):\n> > Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\n> > answer in about 3 iterations ?\n\n> \n> This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` \n> \n> For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.\n> \n> Is that OK with you ?\n\nsure. I meant to say \"at most 3 iterations\".",
    "created_at": "2012-07-03T17:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153679",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A5):
> Replying to [@dimpase](#comment%3A4):
> > Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
> > answer in about 3 iterations ?

> 
> This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` 
> 
> For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.
> 
> Is that OK with you ?

sure. I meant to say "at most 3 iterations".



---

archive/issue_comments_153680.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI corrected the docstring :)",
    "created_at": "2012-07-03T17:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153680",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:7" align="right">Comment 7</div>

I corrected the docstring :)



---

archive/issue_events_168094.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T17:25:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168094"
}
```



---

archive/issue_events_168095.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T17:25:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168095"
}
```



---

archive/issue_comments_153681.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nGood, positive review.",
    "created_at": "2012-07-03T17:25:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153681",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">Comment 8</div>

Good, positive review.



---

archive/issue_comments_153682.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nModified patch to correct my own stupidity and improve performance a bit\n\n```\nsage: %timeit GL(64, GF(2)).random_element()\n625 loops, best of 3: 752 \u00b5s per loop\n```\n\n@dimpase: staying positively reviewed?",
    "created_at": "2012-07-03T21:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153682",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:9" align="right">Comment 9</div>

Modified patch to correct my own stupidity and improve performance a bit

```
sage: %timeit GL(64, GF(2)).random_element()
625 loops, best of 3: 752 µs per loop
```

@dimpase: staying positively reviewed?



---

archive/issue_comments_153683.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\npatchbot says (and I checked that manually) that the patch (the latest, or previous version, does not matter) causes doctest failures in `sage/algebras/group_algebra_new.py` and in `sage/algebras/group_algebra.py`. You can find the log by clicking on the patchbot icon (the, currently, yellow) disc near the top.",
    "created_at": "2012-07-04T03:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153683",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">Comment 10</div>

patchbot says (and I checked that manually) that the patch (the latest, or previous version, does not matter) causes doctest failures in `sage/algebras/group_algebra_new.py` and in `sage/algebras/group_algebra.py`. You can find the log by clicking on the patchbot icon (the, currently, yellow) disc near the top.



---

archive/issue_events_168096.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T03:41:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168096"
}
```



---

archive/issue_events_168097.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T03:41:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168097"
}
```



---

archive/issue_comments_153684.json:
```json
{
    "body": "Attachment: **[gln_gfq_random.patch.gz](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz)**",
    "created_at": "2012-07-04T08:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153684",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Attachment: **[gln_gfq_random.patch.gz](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz)**



---

archive/issue_events_168098.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T08:46:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168098"
}
```



---

archive/issue_events_168099.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T08:46:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168099"
}
```



---

archive/issue_comments_153685.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nPatch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.",
    "created_at": "2012-07-04T08:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153685",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:11" align="right">Comment 11</div>

Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.



---

archive/issue_comments_153686.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,5 @@\n \n ```\n sage: %timeit GL(64, GF(2)).random_element()\n-625 loops, best of 3: 929 \u00b5s per loop\n+625 loops, best of 3: 2ms per loop\n ```\n``````\n",
    "created_at": "2012-07-04T08:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153686",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,5 @@
 
 ```
 sage: %timeit GL(64, GF(2)).random_element()
-625 loops, best of 3: 929 µs per loop
+625 loops, best of 3: 2ms per loop
 ```
``````




---

archive/issue_events_168100.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T08:53:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168100"
}
```



---

archive/issue_events_168101.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T08:53:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168101"
}
```



---

archive/issue_comments_153687.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A11):\n> Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.\n\nOK!",
    "created_at": "2012-07-04T08:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153687",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A11):
> Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.

OK!



---

archive/issue_comments_153688.json:
```json
{
    "body": "Attachment: **[trac_13196.improvement.patch.gz](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)**\n\nSlight improvement",
    "created_at": "2012-07-04T10:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153688",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Attachment: **[trac_13196.improvement.patch.gz](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)**

Slight improvement



---

archive/issue_comments_153689.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nI know this is positively reviewed already, but may I suggest a small improvement? The `MatrixSpace.random_element()` method creates a zero matrix and then randomizes every entry by calling the `M.randomize()` method. We can avoid recreating the zero matrix in every iteration by calling directly the `randomize()` method. For large matrices this gives me a 5-10% speed improvement over your current patch. I don't think the improvement is worth opening a whole new ticket, so can we just apply this on top of the current patch?",
    "created_at": "2012-07-04T10:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153689",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:13" align="right">Comment 13</div>

I know this is positively reviewed already, but may I suggest a small improvement? The `MatrixSpace.random_element()` method creates a zero matrix and then randomizes every entry by calling the `M.randomize()` method. We can avoid recreating the zero matrix in every iteration by calling directly the `randomize()` method. For large matrices this gives me a 5-10% speed improvement over your current patch. I don't think the improvement is worth opening a whole new ticket, so can we just apply this on top of the current patch?



---

archive/issue_comments_153690.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nReplying to [@sagetrac-jlopez](#comment%3A13):\n\n+1",
    "created_at": "2012-07-04T14:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153690",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:14" align="right">Comment 14</div>

Replying to [@sagetrac-jlopez](#comment%3A13):

+1



---

archive/issue_comments_153691.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nIf you add a patch, it obviously must be reviewed again.",
    "created_at": "2012-07-04T15:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153691",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

If you add a patch, it obviously must be reviewed again.



---

archive/issue_events_168102.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:11:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168102"
}
```



---

archive/issue_events_168103.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:11:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168103"
}
```



---

archive/issue_events_168104.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168104"
}
```



---

archive/issue_events_168105.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168105"
}
```



---

archive/issue_events_168106.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168106"
}
```



---

archive/issue_events_168107.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168107"
}
```



---

archive/issue_events_168108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "component: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168108"
}
```



---

archive/issue_events_168109.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168109"
}
```



---

archive/issue_comments_153692.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nAlso, specify which patch(es) should be applied and fill in the Reviewer.",
    "created_at": "2012-07-04T15:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153692",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">Comment 17</div>

Also, specify which patch(es) should be applied and fill in the Reviewer.



---

archive/issue_comments_153693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,5 @@\n sage: %timeit GL(64, GF(2)).random_element()\n 625 loops, best of 3: 2ms per loop\n ```\n+\n+Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]\n``````\n",
    "created_at": "2012-07-04T15:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153693",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,5 @@
 sage: %timeit GL(64, GF(2)).random_element()
 625 loops, best of 3: 2ms per loop
 ```
+
+Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]
``````




---

archive/issue_comments_153694.json:
```json
{
    "body": "Changed author from **Charles Bouillaguet** to **Charles Bouillaguet, Javier L\u00f3pez Pe\u00f1a**",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153694",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Changed author from **Charles Bouillaguet** to **Charles Bouillaguet, Javier López Peña**



---

archive/issue_comments_153695.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153695",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_153696.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nModified the description and author/reviewer. Since Dima already reviewed Charles' patch, I guess only the improvement patch would need to be reviewed.\n\npatchbot: apply gln_gfq_random.patch trac_13196.improvement.patch",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153696",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:19" align="right">Comment 19</div>

Modified the description and author/reviewer. Since Dima already reviewed Charles' patch, I guess only the improvement patch would need to be reviewed.

patchbot: apply gln_gfq_random.patch trac_13196.improvement.patch



---

archive/issue_comments_153697.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nCharles, perhaps you can review my patch yourself?",
    "created_at": "2012-07-04T15:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153697",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:20" align="right">Comment 20</div>

Charles, perhaps you can review my patch yourself?



---

archive/issue_comments_153698.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\n`@`jlopze: sure, give me a couple minutes",
    "created_at": "2012-07-04T15:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153698",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:21" align="right">Comment 21</div>

`@`jlopze: sure, give me a couple minutes



---

archive/issue_comments_153699.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nGood to go !",
    "created_at": "2012-07-04T15:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153699",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:22" align="right">Comment 22</div>

Good to go !



---

archive/issue_events_168110.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T15:43:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168110"
}
```



---

archive/issue_events_168111.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T15:43:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168111"
}
```



---

archive/issue_comments_153700.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Charles Bouillaguet**",
    "created_at": "2012-07-04T15:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153700",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Charles Bouillaguet**



---

archive/issue_comments_153701.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,4 +16,4 @@\n 625 loops, best of 3: 2ms per loop\n ```\n \n-Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]\n+Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)\n``````\n",
    "created_at": "2012-07-04T18:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153701",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,4 +16,4 @@
 625 loops, best of 3: 2ms per loop
 ```
 
-Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]
+Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)
``````




---

archive/issue_events_168112.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168112"
}
```



---

archive/issue_events_168113.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-168113"
}
```



---

archive/issue_comments_153702.json:
```json
{
    "body": "Merged: **sage-5.2.beta1**",
    "created_at": "2012-07-07T22:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-153702",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.2.beta1**
