# Issue 13196: GL(n, GF(q)).random_element() is way too slow for what it does

archive/issues_013024.json:
```json
{
    "assignees": [
        "https://github.com/wdjoyner"
    ],
    "body": "GL(32, GF(2)).random_element() takes more than 10s, which is ridiculous.\n\nProposed solution : use simple rejection sampling (i.e. generate a random matrix, check if it invertible, if not try again). The result is uniformly distributed amongst invertible matrices.\n\nBefore patch:\n\n```\nsage: %time GL(64, GF(2)).random_element() \n5 loops, best of 3: 15.5 s per loop\n```\n\nAfter patch :\n\n```\nsage: %timeit GL(64, GF(2)).random_element()\n625 loops, best of 3: 2ms per loop\n```\n\nApply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)\n\nCC:  @malb @dimpase\n\nComponent: **performance**\n\nKeywords: **matrix group, finite field, random element**\n\nAuthor: **Charles Bouillaguet, Javier L\u00f3pez Pe\u00f1a**\n\nReviewer: **Dima Pasechnik, Charles Bouillaguet**\n\nMerged: **sage-5.2.beta1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13196_\n\n",
    "closed_at": "2012-07-07T22:31:54Z",
    "created_at": "2012-07-03T15:31:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GL(n, GF(q)).random_element() is way too slow for what it does",
    "type": "issue",
    "updated_at": "2012-07-07T22:31:54Z",
    "url": "https://github.com/sagemath/sage/issues/13196",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```
GL(32, GF(2)).random_element() takes more than 10s, which is ridiculous.

Proposed solution : use simple rejection sampling (i.e. generate a random matrix, check if it invertible, if not try again). The result is uniformly distributed amongst invertible matrices.

Before patch:

```
sage: %time GL(64, GF(2)).random_element() 
5 loops, best of 3: 15.5 s per loop
```

After patch :

```
sage: %timeit GL(64, GF(2)).random_element()
625 loops, best of 3: 2ms per loop
```

Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)

CC:  @malb @dimpase

Component: **performance**

Keywords: **matrix group, finite field, random element**

Author: **Charles Bouillaguet, Javier López Peña**

Reviewer: **Dima Pasechnik, Charles Bouillaguet**

Merged: **sage-5.2.beta1**

_Issue created by migration from https://trac.sagemath.org/ticket/13196_





---

archive/issue_events_181711.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181711"
}
```



---

archive/issue_events_181712.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181712"
}
```



---

archive/issue_events_181713.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181713"
}
```



---

archive/issue_events_181714.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181714"
}
```



---

archive/issue_events_181715.json:
```json
{
    "actor": "https://github.com/wdjoyner",
    "created_at": "2012-07-03T15:31:17Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "subject": "https://github.com/sagetrac-Bouillaguet",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181715"
}
```



---

archive/issue_comments_151325.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nOK, cool, where is the patch? \n:)",
    "created_at": "2012-07-03T15:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151325",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

OK, cool, where is the patch? 
:)



---

archive/issue_comments_151326.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@dimpase](#comment%3A1):\n> OK, cool, where is the patch? \n> :)\n\nSorry, it took me a while as I made a mistake (patched sage/groups/matrix_gps/matrix_group.py first instead of sage/groups/matrix_gps/general_linear.py, which is very wrong. The doctest caught it though....)",
    "created_at": "2012-07-03T15:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151326",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@dimpase](#comment%3A1):
> OK, cool, where is the patch? 
> :)

Sorry, it took me a while as I made a mistake (patched sage/groups/matrix_gps/matrix_group.py first instead of sage/groups/matrix_gps/general_linear.py, which is very wrong. The doctest caught it though....)



---

archive/issue_events_181716.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-03T15:56:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181716"
}
```



---

archive/issue_events_181717.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T16:01:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181717"
}
```



---

archive/issue_events_181718.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T16:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181718"
}
```



---

archive/issue_comments_151327.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nCould you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\nanswer in about 3 iterations ?",
    "created_at": "2012-07-03T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151327",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
answer in about 3 iterations ?



---

archive/issue_comments_151328.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@dimpase](#comment%3A4):\n> Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\n> answer in about 3 iterations ?\n\nThis is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` \n\nFor `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.\n\nIs that OK with you ?",
    "created_at": "2012-07-03T17:03:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151328",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@dimpase](#comment%3A4):
> Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
> answer in about 3 iterations ?

This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` 

For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.

Is that OK with you ?



---

archive/issue_comments_151329.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A5):\n> Replying to [@dimpase](#comment%3A4):\n> > Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the\n> > answer in about 3 iterations ?\n\n> \n> This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` \n> \n> For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.\n> \n> Is that OK with you ?\n\nsure. I meant to say \"at most 3 iterations\".",
    "created_at": "2012-07-03T17:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151329",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A5):
> Replying to [@dimpase](#comment%3A4):
> > Could you add in the docstring that the probaility to get an invertible element is about 1/3, and so we expect to get the
> > answer in about 3 iterations ?

> 
> This is not true. The expected number of iterations is asymptotically `1 + 1/q + 2/q^2 + 3/q^3 + 5/q^4 + 7/q^5 + ....` 
> 
> For `GF(2)` you have 3.5 expected iterations, but for GF(127) you have 1.008 iterations..... So that asymptotically, the number of iterations is O(1), and the complexity of the procedure is `O(n^3)`, regardless of the size of the field.
> 
> Is that OK with you ?

sure. I meant to say "at most 3 iterations".



---

archive/issue_comments_151330.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI corrected the docstring :)",
    "created_at": "2012-07-03T17:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151330",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:7" align="right">comment:7</div>

I corrected the docstring :)



---

archive/issue_events_181719.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T17:25:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181719"
}
```



---

archive/issue_events_181720.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-03T17:25:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181720"
}
```



---

archive/issue_comments_151331.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGood, positive review.",
    "created_at": "2012-07-03T17:25:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151331",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

Good, positive review.



---

archive/issue_comments_151332.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nModified patch to correct my own stupidity and improve performance a bit\n\n```\nsage: %timeit GL(64, GF(2)).random_element()\n625 loops, best of 3: 752 \u00b5s per loop\n```\n\n@dimpase: staying positively reviewed?",
    "created_at": "2012-07-03T21:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151332",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:9" align="right">comment:9</div>

Modified patch to correct my own stupidity and improve performance a bit

```
sage: %timeit GL(64, GF(2)).random_element()
625 loops, best of 3: 752 µs per loop
```

@dimpase: staying positively reviewed?



---

archive/issue_comments_151333.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\npatchbot says (and I checked that manually) that the patch (the latest, or previous version, does not matter) causes doctest failures in `sage/algebras/group_algebra_new.py` and in `sage/algebras/group_algebra.py`. You can find the log by clicking on the patchbot icon (the, currently, yellow) disc near the top.",
    "created_at": "2012-07-04T03:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151333",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

patchbot says (and I checked that manually) that the patch (the latest, or previous version, does not matter) causes doctest failures in `sage/algebras/group_algebra_new.py` and in `sage/algebras/group_algebra.py`. You can find the log by clicking on the patchbot icon (the, currently, yellow) disc near the top.



---

archive/issue_events_181721.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T03:41:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181721"
}
```



---

archive/issue_events_181722.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T03:41:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181722"
}
```



---

archive/issue_comments_151334.json:
```json
{
    "body": "Attachment: **[gln_gfq_random.patch.gz](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz)**",
    "created_at": "2012-07-04T08:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151334",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Attachment: **[gln_gfq_random.patch.gz](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz)**



---

archive/issue_events_181723.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T08:46:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181723"
}
```



---

archive/issue_events_181724.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T08:46:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181724"
}
```



---

archive/issue_comments_151335.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPatch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.",
    "created_at": "2012-07-04T08:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151335",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:11" align="right">comment:11</div>

Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.



---

archive/issue_comments_151336.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,5 @@\n \n ```\n sage: %timeit GL(64, GF(2)).random_element()\n-625 loops, best of 3: 929 \u00b5s per loop\n+625 loops, best of 3: 2ms per loop\n ```\n``````\n",
    "created_at": "2012-07-04T08:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151336",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,5 @@
 
 ```
 sage: %timeit GL(64, GF(2)).random_element()
-625 loops, best of 3: 929 µs per loop
+625 loops, best of 3: 2ms per loop
 ```
``````




---

archive/issue_events_181725.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T08:53:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181725"
}
```



---

archive/issue_events_181726.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-07-04T08:53:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181726"
}
```



---

archive/issue_comments_151337.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@sagetrac-Bouillaguet](#comment%3A11):\n> Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.\n\nOK!",
    "created_at": "2012-07-04T08:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151337",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@sagetrac-Bouillaguet](#comment%3A11):
> Patch updated. The bug was that my function returned a matrix, instead of returning an element of the group (basically, it returned g.matrix() instead of returning g). Fix: coerce the result into the group again. It takes a bit of time, and there is likely a workaround, but this is better than nothing.

OK!



---

archive/issue_comments_151338.json:
```json
{
    "body": "Attachment: **[trac_13196.improvement.patch.gz](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)**\n\nSlight improvement",
    "created_at": "2012-07-04T10:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151338",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Attachment: **[trac_13196.improvement.patch.gz](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)**

Slight improvement



---

archive/issue_comments_151339.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI know this is positively reviewed already, but may I suggest a small improvement? The `MatrixSpace.random_element()` method creates a zero matrix and then randomizes every entry by calling the `M.randomize()` method. We can avoid recreating the zero matrix in every iteration by calling directly the `randomize()` method. For large matrices this gives me a 5-10% speed improvement over your current patch. I don't think the improvement is worth opening a whole new ticket, so can we just apply this on top of the current patch?",
    "created_at": "2012-07-04T10:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151339",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:13" align="right">comment:13</div>

I know this is positively reviewed already, but may I suggest a small improvement? The `MatrixSpace.random_element()` method creates a zero matrix and then randomizes every entry by calling the `M.randomize()` method. We can avoid recreating the zero matrix in every iteration by calling directly the `randomize()` method. For large matrices this gives me a 5-10% speed improvement over your current patch. I don't think the improvement is worth opening a whole new ticket, so can we just apply this on top of the current patch?



---

archive/issue_comments_151340.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@sagetrac-jlopez](#comment%3A13):\n\n+1",
    "created_at": "2012-07-04T14:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151340",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@sagetrac-jlopez](#comment%3A13):

+1



---

archive/issue_comments_151341.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIf you add a patch, it obviously must be reviewed again.",
    "created_at": "2012-07-04T15:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151341",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

If you add a patch, it obviously must be reviewed again.



---

archive/issue_events_181727.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:11:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181727"
}
```



---

archive/issue_events_181728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:11:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181728"
}
```



---

archive/issue_events_181729.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181729"
}
```



---

archive/issue_events_181730.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181730"
}
```



---

archive/issue_events_181731.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181731"
}
```



---

archive/issue_events_181732.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181732"
}
```



---

archive/issue_events_181733.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181733"
}
```



---

archive/issue_events_181734.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T15:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181734"
}
```



---

archive/issue_comments_151342.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAlso, specify which patch(es) should be applied and fill in the Reviewer.",
    "created_at": "2012-07-04T15:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Also, specify which patch(es) should be applied and fill in the Reviewer.



---

archive/issue_comments_151343.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,5 @@\n sage: %timeit GL(64, GF(2)).random_element()\n 625 loops, best of 3: 2ms per loop\n ```\n+\n+Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]\n``````\n",
    "created_at": "2012-07-04T15:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151343",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,5 @@
 sage: %timeit GL(64, GF(2)).random_element()
 625 loops, best of 3: 2ms per loop
 ```
+
+Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]
``````




---

archive/issue_comments_151344.json:
```json
{
    "body": "Changed author from **Charles Bouillaguet** to **Charles Bouillaguet, Javier L\u00f3pez Pe\u00f1a**",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151344",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Changed author from **Charles Bouillaguet** to **Charles Bouillaguet, Javier López Peña**



---

archive/issue_comments_151345.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151345",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_151346.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nModified the description and author/reviewer. Since Dima already reviewed Charles' patch, I guess only the improvement patch would need to be reviewed.\n\npatchbot: apply gln_gfq_random.patch trac_13196.improvement.patch",
    "created_at": "2012-07-04T15:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151346",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:19" align="right">comment:19</div>

Modified the description and author/reviewer. Since Dima already reviewed Charles' patch, I guess only the improvement patch would need to be reviewed.

patchbot: apply gln_gfq_random.patch trac_13196.improvement.patch



---

archive/issue_comments_151347.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nCharles, perhaps you can review my patch yourself?",
    "created_at": "2012-07-04T15:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151347",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:20" align="right">comment:20</div>

Charles, perhaps you can review my patch yourself?



---

archive/issue_comments_151348.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n`@`jlopze: sure, give me a couple minutes",
    "created_at": "2012-07-04T15:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151348",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:21" align="right">comment:21</div>

`@`jlopze: sure, give me a couple minutes



---

archive/issue_comments_151349.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nGood to go !",
    "created_at": "2012-07-04T15:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151349",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:22" align="right">comment:22</div>

Good to go !



---

archive/issue_events_181735.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T15:43:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181735"
}
```



---

archive/issue_events_181736.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2012-07-04T15:43:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181736"
}
```



---

archive/issue_comments_151350.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Charles Bouillaguet**",
    "created_at": "2012-07-04T15:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151350",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Charles Bouillaguet**



---

archive/issue_comments_151351.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,4 +16,4 @@\n 625 loops, best of 3: 2ms per loop\n ```\n \n-Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]\n+Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)\n``````\n",
    "created_at": "2012-07-04T18:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151351",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,4 +16,4 @@
 625 loops, best of 3: 2ms per loop
 ```
 
-Apply [attachment: gln_gfq_random.patch] and [attachment: trac_13196.improvement.patch]
+Apply [attachment: gln_gfq_random.patch](https://github.com/sagemath/sage/files/ticket13196/gln_gfq_random.patch.gz) and [attachment: trac_13196.improvement.patch](https://github.com/sagemath/sage/files/ticket13196/trac_13196.improvement.patch.gz)
``````




---

archive/issue_events_181737.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181737"
}
```



---

archive/issue_events_181738.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13196#event-181738"
}
```



---

archive/issue_comments_151352.json:
```json
{
    "body": "Merged: **sage-5.2.beta1**",
    "created_at": "2012-07-07T22:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13196#issuecomment-151352",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.2.beta1**
