# Issue 13031: Use cythonize() from cython for Sage module building.

archive/issues_012859.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n\nApply to the Sage library:\n* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n* [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n* [attachment: 13031-doctest-fix-rebased.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)\n* [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)\n\nDepends on #13029\nDepends on #13432\n\nCC:  @jdemeyer @roed314 @ohanar @ppurka @kini @mwhansen\n\nKeywords: **sd40.5**\n\nReviewer: **Jeroen Demeyer, R. Andrew Ohana**\n\nAuthor: **Robert Bradshaw, R. Andrew Ohana**\n\nMerged: **sage-5.9.beta4**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13031_\n\n",
    "closed_at": "2013-04-01T10:39:45Z",
    "created_at": "2012-05-27T12:02:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use cythonize() from cython for Sage module building.",
    "type": "issue",
    "updated_at": "2013-05-11T20:54:10Z",
    "url": "https://github.com/sagemath/sage/issues/13031",
    "user": "https://github.com/robertwb"
}
```
Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).

Apply to the Sage library:
* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
* [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
* [attachment: 13031-doctest-fix-rebased.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)
* [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)

Depends on #13029
Depends on #13432

CC:  @jdemeyer @roed314 @ohanar @ppurka @kini @mwhansen

Keywords: **sd40.5**

Reviewer: **Jeroen Demeyer, R. Andrew Ohana**

Author: **Robert Bradshaw, R. Andrew Ohana**

Merged: **sage-5.9.beta4**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/13031_





---

archive/issue_events_180500.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-27T12:02:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180500"
}
```



---

archive/issue_events_180501.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-27T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180501"
}
```



---

archive/issue_events_180502.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-27T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180502"
}
```



---

archive/issue_events_180503.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-27T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180503"
}
```



---

archive/issue_events_180504.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-05-27T12:02:04Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180504"
}
```



---

archive/issue_comments_148304.json:
```json
{
    "body": "Attachment: **[13031-cythonize.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize.patch.gz)**",
    "created_at": "2012-05-27T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148304",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[13031-cythonize.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize.patch.gz)**



---

archive/issue_events_180505.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-27T12:03:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180505"
}
```



---

archive/issue_comments_148305.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIs the patch based against sage-5.1beta0? I upgraded a sage installation from sage-5.0rc0 to sage-5.1beta0 and it fails to apply there. I will try a sage-5.1beta0 tarball sometime later.",
    "created_at": "2012-05-27T14:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148305",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:2" align="right">comment:2</div>

Is the patch based against sage-5.1beta0? I upgraded a sage installation from sage-5.0rc0 to sage-5.1beta0 and it fails to apply there. I will try a sage-5.1beta0 tarball sometime later.



---

archive/issue_comments_148306.json:
```json
{
    "body": "Changed keywords from none to **sd40.5**",
    "created_at": "2012-05-27T23:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148306",
    "user": "https://github.com/mwhansen"
}
```

Changed keywords from none to **sd40.5**



---

archive/issue_events_180506.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-27T23:35:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180506"
}
```



---

archive/issue_events_180507.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-27T23:35:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180507"
}
```



---

archive/issue_comments_148307.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nChanging to needs work since -- as mentioned above -- this doesn't apply to sage-5.1.beta0:\n\n```\n\nadding 13031-cythonize.patch to series file\napplying 13031-cythonize.patch\npatching file module_list.py\nHunk #1 FAILED at 144\nHunk #3 FAILED at 223\nHunk #13 FAILED at 834\nHunk #16 FAILED at 1475\nHunk #20 succeeded at 1698 with fuzz 2 (offset 75 lines).\nHunk #21 succeeded at 1712 with fuzz 2 (offset 79 lines).\n4 out of 22 hunks FAILED -- saving rejects to file module_list.py.rej\npatching file setup.py\nHunk #1 succeeded at 17 with fuzz 2 (offset 0 lines).\nHunk #3 FAILED at 513\n1 out of 3 hunks FAILED -- saving rejects to file setup.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh 13031-cythonize.patch\nwstein@sage:/tmp/wstein/sage-5.1.beta0-boxen-x86_64-Linux/devel/sage/sage$ \n```",
    "created_at": "2012-05-27T23:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148307",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">comment:5</div>

Changing to needs work since -- as mentioned above -- this doesn't apply to sage-5.1.beta0:

```

adding 13031-cythonize.patch to series file
applying 13031-cythonize.patch
patching file module_list.py
Hunk #1 FAILED at 144
Hunk #3 FAILED at 223
Hunk #13 FAILED at 834
Hunk #16 FAILED at 1475
Hunk #20 succeeded at 1698 with fuzz 2 (offset 75 lines).
Hunk #21 succeeded at 1712 with fuzz 2 (offset 79 lines).
4 out of 22 hunks FAILED -- saving rejects to file module_list.py.rej
patching file setup.py
Hunk #1 succeeded at 17 with fuzz 2 (offset 0 lines).
Hunk #3 FAILED at 513
1 out of 3 hunks FAILED -- saving rejects to file setup.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 13031-cythonize.patch
wstein@sage:/tmp/wstein/sage-5.1.beta0-boxen-x86_64-Linux/devel/sage/sage$ 
```



---

archive/issue_comments_148308.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWould you please make the following change:\n\n```diff\n--- a\n+++ b\n@@ -1,1 +1,5 @@\n-ext_modules = cythonize(ext_modules, exclude=exclude_modules, nthreads=nthreads, cache=os.path.join(DOT_SAGE, 'cythoncache')))\n+if 'CYCACHE_DIR' in os.environ:\n+    CYCACHE_DIR = os.environ['CYCACHE_DIR']\n+else:\n+    CYCACHE_DIR = os.path.join(DOT_SAGE,'cycache')\n+ext_modules = cythonize(ext_modules, exclude=exclude_modules, nthreads=nthreads, cache=CYCACHE_DIR))\n```\nThis way we can easily specify the cache directory separately from `DOT_SAGE`.",
    "created_at": "2012-05-28T02:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148308",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:6" align="right">comment:6</div>

Would you please make the following change:

```diff
--- a
+++ b
@@ -1,1 +1,5 @@
-ext_modules = cythonize(ext_modules, exclude=exclude_modules, nthreads=nthreads, cache=os.path.join(DOT_SAGE, 'cythoncache')))
+if 'CYCACHE_DIR' in os.environ:
+    CYCACHE_DIR = os.environ['CYCACHE_DIR']
+else:
+    CYCACHE_DIR = os.path.join(DOT_SAGE,'cycache')
+ext_modules = cythonize(ext_modules, exclude=exclude_modules, nthreads=nthreads, cache=CYCACHE_DIR))
```
This way we can easily specify the cache directory separately from `DOT_SAGE`.



---

archive/issue_events_180508.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-29T06:49:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180508"
}
```



---

archive/issue_events_180509.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-05-29T06:49:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180509"
}
```



---

archive/issue_comments_148309.json:
```json
{
    "body": "Attachment: **[13031-cythonize-5.1.beta1.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-5.1.beta1.patch.gz)**",
    "created_at": "2012-05-29T09:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148309",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[13031-cythonize-5.1.beta1.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-5.1.beta1.patch.gz)**



---

archive/issue_comments_148310.json:
```json
{
    "body": "Author: **Robert Bradshaw, R. Andrew Ohana**",
    "created_at": "2012-06-07T11:18:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148310",
    "user": "https://github.com/ohanar"
}
```

Author: **Robert Bradshaw, R. Andrew Ohana**



---

archive/issue_events_180510.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-06-07T11:18:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180510"
}
```



---

archive/issue_events_180511.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-06-07T11:18:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180511"
}
```



---

archive/issue_comments_148311.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[13031-cythonize-5.1.beta2.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-5.1.beta2.patch.gz)**\n\nI attached an updated patch that\n* is rebased on the final 5.1.beta2\n* fixes a `ZeroDivisionError` that was preventing documentation from building\n* more throughly cleans up `module_list.py` with the use of *s\n* does other clean up with `module_list.py` since this patch will constantly need to be rebased with each development release (may as well clean up everything while we are at it)\n\nThat said, there is still some issue with Cython's cythonize, even using the old `module_list.py` you encounter the issue:\n\n```\nsage: cython('a = 5')\nsage: a\nTraceback (most recent call last):\n...\nNameError: name 'a' is not defined\n```\n\nYou'll find that tons of doctests fail, and frequently they are having `NameError`s like this (although they aren't necessarily calling Sage's cython function).",
    "created_at": "2012-06-07T11:18:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148311",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[13031-cythonize-5.1.beta2.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-5.1.beta2.patch.gz)**

I attached an updated patch that
* is rebased on the final 5.1.beta2
* fixes a `ZeroDivisionError` that was preventing documentation from building
* more throughly cleans up `module_list.py` with the use of *s
* does other clean up with `module_list.py` since this patch will constantly need to be rebased with each development release (may as well clean up everything while we are at it)

That said, there is still some issue with Cython's cythonize, even using the old `module_list.py` you encounter the issue:

```
sage: cython('a = 5')
sage: a
Traceback (most recent call last):
...
NameError: name 'a' is not defined
```

You'll find that tons of doctests fail, and frequently they are having `NameError`s like this (although they aren't necessarily calling Sage's cython function).



---

archive/issue_comments_148312.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for looking at this. I fixed the patch, Sage relies on a deprecated \"feature\" of globals(). Running all tests...",
    "created_at": "2012-06-23T09:24:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148312",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for looking at this. I fixed the patch, Sage relies on a deprecated "feature" of globals(). Running all tests...



---

archive/issue_comments_148313.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFYI, all tests passed for me.",
    "created_at": "2012-06-23T17:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148313",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:10" align="right">comment:10</div>

FYI, all tests passed for me.



---

archive/issue_events_180512.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-06-25T03:17:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180512"
}
```



---

archive/issue_events_180513.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-06-25T03:17:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180513"
}
```



---

archive/issue_comments_148314.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOk, looks good to me and works well with 5.1.beta2, so I'm going to mark this back as needing review.\n\nAs expected, it needs to be rebased again on more recent betas, but since the changes to `module_list.py` is so massive, I'm not going to bother with rebasing until Jeroen decides which beta he would like to merge it in.\n\nFor whoever reviews this, please use 5.1.beta2 as a basis.",
    "created_at": "2012-06-25T03:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148314",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:11" align="right">comment:11</div>

Ok, looks good to me and works well with 5.1.beta2, so I'm going to mark this back as needing review.

As expected, it needs to be rebased again on more recent betas, but since the changes to `module_list.py` is so massive, I'm not going to bother with rebasing until Jeroen decides which beta he would like to merge it in.

For whoever reviews this, please use 5.1.beta2 as a basis.



---

archive/issue_comments_148315.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe new patch fixes an issue with `DOT_SAGE` not being defined in `setup.py`.",
    "created_at": "2012-07-01T10:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148315",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:12" align="right">comment:12</div>

The new patch fixes an issue with `DOT_SAGE` not being defined in `setup.py`.



---

archive/issue_comments_148316.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRather than code like this:\n\n```\nif not os.path.exists(cache_dir): \n   os.mkdir(cache_dir) \n```\nyou should use `sage.misc.misc.sage_makedirs` (or copy-paste the code from there). A try-except block is safer than testing whether than the directory exists first.",
    "created_at": "2012-07-01T15:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148316",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

Rather than code like this:

```
if not os.path.exists(cache_dir): 
   os.mkdir(cache_dir) 
```
you should use `sage.misc.misc.sage_makedirs` (or copy-paste the code from there). A try-except block is safer than testing whether than the directory exists first.



---

archive/issue_comments_148317.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n+Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n \n+Apply:\n+* [attachment: trac13031.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)\n``````\n",
    "created_at": "2012-07-14T05:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148317",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
+Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).
 
+Apply:
+* [attachment: trac13031.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)
``````




---

archive/issue_comments_148318.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI just rebased on 5.2.beta1 since the dependency was merged into that release. However, in the process I discovered that cycache is not ready for primetime yet:\n\n```\n$ grep 'cdef class MonoDict:' sage -R\nsage/sets/disjoint_set.c: * cdef class MonoDict:             # <<<<<<<<<<<<<<\nsage/matrix/matrix_modn_dense_float.cpp: * cdef class MonoDict:             # <<<<<<<<<<<<<<\n```\nNeither of these modules changed between 5.1.beta2 and 5.2.beta1, but their dependencies changed, so there is some issue with the hashing that needs to be resolved.\n\nFor now I've disabled cycache, since it will be trivial to re-add once this ticket gets merged.",
    "created_at": "2012-07-14T05:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148318",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:14" align="right">comment:14</div>

I just rebased on 5.2.beta1 since the dependency was merged into that release. However, in the process I discovered that cycache is not ready for primetime yet:

```
$ grep 'cdef class MonoDict:' sage -R
sage/sets/disjoint_set.c: * cdef class MonoDict:             # <<<<<<<<<<<<<<
sage/matrix/matrix_modn_dense_float.cpp: * cdef class MonoDict:             # <<<<<<<<<<<<<<
```
Neither of these modules changed between 5.1.beta2 and 5.2.beta1, but their dependencies changed, so there is some issue with the hashing that needs to be resolved.

For now I've disabled cycache, since it will be trivial to re-add once this ticket gets merged.



---

archive/issue_comments_148319.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYes, I think it's perfectly fine to disable cycache for now to get this in (as it will then be much easier to work on). Could you expound on what the issue was though? I'm not quite following your grep is trying to show...",
    "created_at": "2012-07-14T08:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148319",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:15" align="right">comment:15</div>

Yes, I think it's perfectly fine to disable cycache for now to get this in (as it will then be much easier to work on). Could you expound on what the issue was though? I'm not quite following your grep is trying to show...



---

archive/issue_comments_148320.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@robertwb](#comment:15):\n> Yes, I think it's perfectly fine to disable cycache for now to get this in (as it will then be much easier to work on). Could you expound on what the issue was though? I'm not quite following your grep is trying to show...\n\nThe grep is of some cython code that existed in 5.1.beta2 in `sage/structure/coerce_dict.pxd`, that is no longer present in 5.2.beta1. However, cython detected that I had a cached version of the `disjoint_set` module (which didn't change between versions, but imports the `coerce_dict` module) and incorrectly pulls the the cached version of `disjoint_set.c` when it actually needs to rebuild it since `coerce_dict.pxd` changed (same situation for the other module in the grep).",
    "created_at": "2012-07-14T08:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148320",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@robertwb](#comment:15):
> Yes, I think it's perfectly fine to disable cycache for now to get this in (as it will then be much easier to work on). Could you expound on what the issue was though? I'm not quite following your grep is trying to show...

The grep is of some cython code that existed in 5.1.beta2 in `sage/structure/coerce_dict.pxd`, that is no longer present in 5.2.beta1. However, cython detected that I had a cached version of the `disjoint_set` module (which didn't change between versions, but imports the `coerce_dict` module) and incorrectly pulls the the cached version of `disjoint_set.c` when it actually needs to rebuild it since `coerce_dict.pxd` changed (same situation for the other module in the grep).



---

archive/issue_comments_148321.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOK, rebased. Be nice if someone reviewed this soon.",
    "created_at": "2012-09-05T22:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148321",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:17" align="right">comment:17</div>

OK, rebased. Be nice if someone reviewed this soon.



---

archive/issue_comments_148322.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis probably should be rebased to #13164 and #12883.",
    "created_at": "2012-09-06T05:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148322",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

This probably should be rebased to #13164 and #12883.



---

archive/issue_comments_148323.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:18):\n> This probably should be rebased to #13164 and #12883.\n\nI'll do that once they are merged. This ticket so heavily affects `module_list.py` that I would rather get this reviewed on some clean development build, and then try to figure out with you what tickets I'll need to rebase against to merge this into whatever beta you feel is appropriate. Since this has been waiting review for a bit, I rather not jump the gun and start rebasing against things that haven't been merged yet.",
    "created_at": "2012-09-06T09:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148323",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:18):
> This probably should be rebased to #13164 and #12883.

I'll do that once they are merged. This ticket so heavily affects `module_list.py` that I would rather get this reviewed on some clean development build, and then try to figure out with you what tickets I'll need to rebase against to merge this into whatever beta you feel is appropriate. Since this has been waiting review for a bit, I rather not jump the gun and start rebasing against things that haven't been merged yet.



---

archive/issue_comments_148324.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis seems to cause Sphinx problems:\n\n```\n/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.clear_mpz_globals: Could not parse cython argspec\n/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.gmp_randrange: Could not parse cython argspec\n/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.init_mpz_globals: Could not parse cython argspec\n```",
    "created_at": "2012-09-06T12:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148324",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

This seems to cause Sphinx problems:

```
/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.clear_mpz_globals: Could not parse cython argspec
/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.gmp_randrange: Could not parse cython argspec
/release/merger/sage-5.4.beta1/devel/sage/doc/en/reference/sage/modular/modform/eis_series_cython.rst:11: WARNING: error while formatting signature for sage.modular.modform.eis_series_cython.init_mpz_globals: Could not parse cython argspec
```



---

archive/issue_comments_148325.json:
```json
{
    "body": "Work Issues: **Sphinx**",
    "created_at": "2012-09-06T12:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148325",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **Sphinx**



---

archive/issue_events_180514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-06T12:47:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180514"
}
```



---

archive/issue_events_180515.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-06T12:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180515"
}
```



---

archive/issue_comments_148326.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nCan you please clarify what command you ran?",
    "created_at": "2012-09-10T21:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148326",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:21" align="right">comment:21</div>

Can you please clarify what command you ran?



---

archive/issue_comments_148327.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@ohanar](#comment:21):\n> Can you please clarify what command you ran?\n\nThis is build from scratch, so it's just `make doc`.  This is probably equivalent to removing the `doc/output` directory and then doing `make doc`.",
    "created_at": "2012-09-11T06:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148327",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@ohanar](#comment:21):
> Can you please clarify what command you ran?

This is build from scratch, so it's just `make doc`.  This is probably equivalent to removing the `doc/output` directory and then doing `make doc`.



---

archive/issue_comments_148328.json:
```json
{
    "body": "apply to sage library",
    "created_at": "2012-09-12T21:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148328",
    "user": "https://github.com/ohanar"
}
```

apply to sage library



---

archive/issue_events_180516.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-12T21:44:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180516"
}
```



---

archive/issue_events_180517.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-12T21:44:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180517"
}
```



---

archive/issue_comments_148329.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAttachment: **[trac13031.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)**\n\nOk, rebased on 5.4.beta1.\n\nThe issue with sphinx seems to be because of the python functions defined in `sage/ext/gmp.pxi`. We probably shouldn't have any python function defined in pxi files anyway (since we currently aren't checking them for coverage or anything). There are python functions in other pxi files, but they aren't causing any issues for some reason (Robert, maybe you could explain why?).\n\nAnyway, for right now I removed one of them (that wasn't being used anywhere), and I moved the other two to `sage/rings/integer.pyx` since that is where the sage library looks for them.",
    "created_at": "2012-09-12T21:44:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148329",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:23" align="right">comment:23</div>

Attachment: **[trac13031.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)**

Ok, rebased on 5.4.beta1.

The issue with sphinx seems to be because of the python functions defined in `sage/ext/gmp.pxi`. We probably shouldn't have any python function defined in pxi files anyway (since we currently aren't checking them for coverage or anything). There are python functions in other pxi files, but they aren't causing any issues for some reason (Robert, maybe you could explain why?).

Anyway, for right now I removed one of them (that wasn't being used anywhere), and I moved the other two to `sage/rings/integer.pyx` since that is where the sage library looks for them.



---

archive/issue_comments_148330.json:
```json
{
    "body": "Attachment: **[13031-cythonize-simple.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)**\n\napply only this patch",
    "created_at": "2013-01-28T22:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148330",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[13031-cythonize-simple.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)**

apply only this patch



---

archive/issue_comments_148331.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n \n Apply:\n-* [attachment: trac13031.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)\n+* [attachment: 13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)\n``````\n",
    "created_at": "2013-01-28T22:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148331",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).
 
 Apply:
-* [attachment: trac13031.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031.patch.gz)
+* [attachment: 13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)
``````




---

archive/issue_comments_148332.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOK, I've changed this to **only** switch to use cythonize and get rid of the sphinx errors. All the other changes make this fail to apply with each new Sage release, and it's a pain to constantly re-base. Once this is in, we can fix up the module list piecemeal and do other cleanup (though I'm unconvinced writing `os.path.join('sage','rings','padics','*.pyx')` is really preferable to `\"sage/rings/padics/*.pyx\"`) as was introduced in the latest rebase.",
    "created_at": "2013-01-28T22:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148332",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:24" align="right">comment:24</div>

OK, I've changed this to **only** switch to use cythonize and get rid of the sphinx errors. All the other changes make this fail to apply with each new Sage release, and it's a pain to constantly re-base. Once this is in, we can fix up the module list piecemeal and do other cleanup (though I'm unconvinced writing `os.path.join('sage','rings','padics','*.pyx')` is really preferable to `"sage/rings/padics/*.pyx"`) as was introduced in the latest rebase.



---

archive/issue_comments_148333.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, R. Andrew Ohana**",
    "created_at": "2013-01-29T22:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148333",
    "user": "https://github.com/ohanar"
}
```

Reviewer: **Jeroen Demeyer, R. Andrew Ohana**



---

archive/issue_comments_148334.json:
```json
{
    "body": "Changed work issues from **Sphinx** to none",
    "created_at": "2013-01-29T22:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148334",
    "user": "https://github.com/ohanar"
}
```

Changed work issues from **Sphinx** to none



---

archive/issue_events_180518.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-01-29T22:47:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180518"
}
```



---

archive/issue_events_180519.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-01-29T22:47:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180519"
}
```



---

archive/issue_comments_148335.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nEverything looks good and works well.",
    "created_at": "2013-01-29T22:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148335",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:25" align="right">comment:25</div>

Everything looks good and works well.



---

archive/issue_comments_148336.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThere is trouble with upgrading:\n\nOn rosemary (Linux RHEL 5.6 x86_64), after upgrading from sage-4.5.2, I get a failure during the installation of the Conway spkg:\n\n```\nTraceback (most recent call last):\n  File \"./spkg-install\", line 4, in <module>\n    from sage.all import save\n  File \"/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/all.py\", line 74, in <module>\n    from sage.matrix.all     import *\n  File \"/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/matrix/all.py\", line 1, in <module>\n    from matrix_space import MatrixSpace, is_MatrixSpace\n  File \"/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 33, in <module>\n    import matrix\n  File \"matrix.pyx\", line 1, in init sage.matrix.matrix (sage/matrix/matrix.c:2043)\n  File \"matrix2.pyx\", line 1, in init sage.matrix.matrix2 (sage/matrix/matrix2.c:71233)\n  File \"matrix1.pyx\", line 1, in init sage.matrix.matrix1 (sage/matrix/matrix1.c:13429)\n  File \"mutability.pxd\", line 15, in init sage.matrix.matrix0 (sage/matrix/matrix0.c:29523)\nValueError: PyCapsule_GetPointer called with invalid PyCapsule object\n```\n\nRunning `./sage -ba-force` fixes this.",
    "created_at": "2013-02-04T10:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148336",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

There is trouble with upgrading:

On rosemary (Linux RHEL 5.6 x86_64), after upgrading from sage-4.5.2, I get a failure during the installation of the Conway spkg:

```
Traceback (most recent call last):
  File "./spkg-install", line 4, in <module>
    from sage.all import save
  File "/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/all.py", line 74, in <module>
    from sage.matrix.all     import *
  File "/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/matrix/all.py", line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/home/buildbot/build/sage/rosemary-1/rosemary_upgrade_4.5.2/build/sage-5.7.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 33, in <module>
    import matrix
  File "matrix.pyx", line 1, in init sage.matrix.matrix (sage/matrix/matrix.c:2043)
  File "matrix2.pyx", line 1, in init sage.matrix.matrix2 (sage/matrix/matrix2.c:71233)
  File "matrix1.pyx", line 1, in init sage.matrix.matrix1 (sage/matrix/matrix1.c:13429)
  File "mutability.pxd", line 15, in init sage.matrix.matrix0 (sage/matrix/matrix0.c:29523)
ValueError: PyCapsule_GetPointer called with invalid PyCapsule object
```

Running `./sage -ba-force` fixes this.



---

archive/issue_events_180520.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-04T10:07:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180520"
}
```



---

archive/issue_events_180521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-04T10:07:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180521"
}
```



---

archive/issue_comments_148337.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAre old-style Cython modules and new-style Cython modules (made with `cythonize()`) compatible?  If yes, the problem is probably with dependency checking (some modules should be rebuilt but aren't).",
    "created_at": "2013-02-04T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148337",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Are old-style Cython modules and new-style Cython modules (made with `cythonize()`) compatible?  If yes, the problem is probably with dependency checking (some modules should be rebuilt but aren't).



---

archive/issue_comments_148338.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThanks to some sed magic, this is a list of modules rebuilt in sage-5.7.beta2 but which were not rebuilt with this ticket:\n\n```\nsage/combinat/words/word_datatypes.pyx\nsage/ext/interactive_constructors_c.pyx\nsage/games/sudoku_backtrack.pyx\nsage/media/channels.pyx\nsage/misc/refcount.pyx\nsage/misc/search.pyx\nsage/quadratic_forms/quadratic_form__evaluate.pyx\nsage/rings/polynomial/symmetric_reduction.pyx\nsage/structure/mutability.pyx\n```\n\nIn the sage-5.7.beta2 log file, there is\n\n```\nBuilding modified file sage/combinat/words/word_datatypes.pyx.\nBuilding modified file sage/ext/interactive_constructors_c.pyx.\nBuilding modified file sage/games/sudoku_backtrack.pyx.\nBuilding modified file sage/media/channels.pyx.\nBuilding modified file sage/misc/refcount.pyx.\nBuilding modified file sage/misc/search.pyx.\nBuilding modified file sage/quadratic_forms/quadratic_form__evaluate.pyx.\nBuilding modified file sage/rings/polynomial/symmetric_reduction.pyx.\nBuilding modified file sage/structure/mutability.pyx.\n```\n\nIn the log file with #13031, there is no mention of any of these files.",
    "created_at": "2013-02-04T11:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148338",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Thanks to some sed magic, this is a list of modules rebuilt in sage-5.7.beta2 but which were not rebuilt with this ticket:

```
sage/combinat/words/word_datatypes.pyx
sage/ext/interactive_constructors_c.pyx
sage/games/sudoku_backtrack.pyx
sage/media/channels.pyx
sage/misc/refcount.pyx
sage/misc/search.pyx
sage/quadratic_forms/quadratic_form__evaluate.pyx
sage/rings/polynomial/symmetric_reduction.pyx
sage/structure/mutability.pyx
```

In the sage-5.7.beta2 log file, there is

```
Building modified file sage/combinat/words/word_datatypes.pyx.
Building modified file sage/ext/interactive_constructors_c.pyx.
Building modified file sage/games/sudoku_backtrack.pyx.
Building modified file sage/media/channels.pyx.
Building modified file sage/misc/refcount.pyx.
Building modified file sage/misc/search.pyx.
Building modified file sage/quadratic_forms/quadratic_form__evaluate.pyx.
Building modified file sage/rings/polynomial/symmetric_reduction.pyx.
Building modified file sage/structure/mutability.pyx.
```

In the log file with #13031, there is no mention of any of these files.



---

archive/issue_comments_148339.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nFiles related to `mutability.pyx` after building Sage with #13031:\n\n```\n-rwxr-xr-x 1 buildbot buildbot 52116 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/lib.linux-x86_64-2.7/sage/structure/mutability.so\n-rwxr-xr-x 1 buildbot buildbot 52116 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/sage/structure/mutability.so\n-rw-r--r-- 1 buildbot buildbot 68728 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/temp.linux-x86_64-2.7/sage/structure/mutability.o\n-rw-r--r-- 1 buildbot buildbot   207 2012-08-23 12:00:08.000000000 -0400 ./devel/sage-main/doc/en/reference/sage/structure/mutability.rst\n-rw-r--r-- 1 buildbot buildbot 71416 2012-08-23 11:33:21.000000000 -0400 ./devel/sage-main/sage/structure/mutability.c\n-rw-r--r-- 1 buildbot buildbot   529 2010-06-28 12:37:01.000000000 -0400 ./devel/sage-main/sage/structure/mutability.pxd\n-rw-r--r-- 1 buildbot buildbot  2062 2012-08-23 11:22:27.000000000 -0400 ./devel/sage-main/sage/structure/mutability.pyx\n```",
    "created_at": "2013-02-04T11:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148339",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Files related to `mutability.pyx` after building Sage with #13031:

```
-rwxr-xr-x 1 buildbot buildbot 52116 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/lib.linux-x86_64-2.7/sage/structure/mutability.so
-rwxr-xr-x 1 buildbot buildbot 52116 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/sage/structure/mutability.so
-rw-r--r-- 1 buildbot buildbot 68728 2013-02-04 04:32:19.000000000 -0500 ./devel/sage-main/build/temp.linux-x86_64-2.7/sage/structure/mutability.o
-rw-r--r-- 1 buildbot buildbot   207 2012-08-23 12:00:08.000000000 -0400 ./devel/sage-main/doc/en/reference/sage/structure/mutability.rst
-rw-r--r-- 1 buildbot buildbot 71416 2012-08-23 11:33:21.000000000 -0400 ./devel/sage-main/sage/structure/mutability.c
-rw-r--r-- 1 buildbot buildbot   529 2010-06-28 12:37:01.000000000 -0400 ./devel/sage-main/sage/structure/mutability.pxd
-rw-r--r-- 1 buildbot buildbot  2062 2012-08-23 11:22:27.000000000 -0400 ./devel/sage-main/sage/structure/mutability.pyx
```



---

archive/issue_comments_148340.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThe `.so` is recompiled from an old Cython C file which was\n\n```\n/* Generated by Cython 0.12.1 on Thu Aug 23 11:33:21 2012 */\n```\nwhile the old code would always run `cython` to re-generate the `.c` file.\n\nSounds like #4797...",
    "created_at": "2013-02-04T11:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148340",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

The `.so` is recompiled from an old Cython C file which was

```
/* Generated by Cython 0.12.1 on Thu Aug 23 11:33:21 2012 */
```
while the old code would always run `cython` to re-generate the `.c` file.

Sounds like #4797...



---

archive/issue_comments_148341.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAlternatively, we could also disallow upgrades from versions older than sage-4.6.  On the other hand, that would probably not be sufficient as some `.c` files generated by newer versions of Cython would need to be recreated to account for #13896 for example.",
    "created_at": "2013-02-04T12:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148341",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Alternatively, we could also disallow upgrades from versions older than sage-4.6.  On the other hand, that would probably not be sufficient as some `.c` files generated by newer versions of Cython would need to be recreated to account for #13896 for example.



---

archive/issue_comments_148342.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSo from what I can tell cythonize is in the right -- these files don't need to be rebuilt (they nor any of their dependencies have been changed). So it looks like it is an issue of using old cython generated code with new cython generated code.\n\nThe other potential fix for this particular issue is to remove `sage.structure.mutablity`, since nothing actually uses it (despite getting imported in a few places).",
    "created_at": "2013-03-08T23:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148342",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:32" align="right">comment:32</div>

So from what I can tell cythonize is in the right -- these files don't need to be rebuilt (they nor any of their dependencies have been changed). So it looks like it is an issue of using old cython generated code with new cython generated code.

The other potential fix for this particular issue is to remove `sage.structure.mutablity`, since nothing actually uses it (despite getting imported in a few places).



---

archive/issue_events_180522.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-08T23:26:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180522"
}
```



---

archive/issue_events_180523.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-08T23:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180523"
}
```



---

archive/issue_comments_148343.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n \n Apply:\n-* [attachment: 13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)\n+* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n+* [attachment: trac13031-mutability.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutability.patch.gz)\n``````\n",
    "created_at": "2013-03-08T23:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148343",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
 Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).
 
 Apply:
-* [attachment: 13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/13031-cythonize-simple.patch.gz)
+* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
+* [attachment: trac13031-mutability.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutability.patch.gz)
``````




---

archive/issue_comments_148344.json:
```json
{
    "body": "remove unused mutablity code",
    "created_at": "2013-03-08T23:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148344",
    "user": "https://github.com/ohanar"
}
```

remove unused mutablity code



---

archive/issue_comments_148345.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAttachment: **[trac13031-mutablity.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)**",
    "created_at": "2013-03-08T23:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148345",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:34" align="right">comment:34</div>

Attachment: **[trac13031-mutablity.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)**



---

archive/issue_comments_148346.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n Apply:\n * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n-* [attachment: trac13031-mutability.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutability.patch.gz)\n+* [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)\n``````\n",
    "created_at": "2013-03-08T23:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148346",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 Apply:
 * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
-* [attachment: trac13031-mutability.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutability.patch.gz)
+* [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)
``````




---

archive/issue_comments_148347.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@ohanar](#comment:32):\n> So from what I can tell cythonize is in the right -- these files don't need to be rebuilt (they nor any of their dependencies have been changed).\n\nIt depends what you mean. One could argue that all Cython files should implicitly depend on the Cython program. Similar how, in an autotools build system, everything depends on `config.status` (the output of `./configure`) or similar how `SCons` and `ccache` use the compiler executable as extra dependency of all C files.",
    "created_at": "2013-03-09T09:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148347",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@ohanar](#comment:32):
> So from what I can tell cythonize is in the right -- these files don't need to be rebuilt (they nor any of their dependencies have been changed).

It depends what you mean. One could argue that all Cython files should implicitly depend on the Cython program. Similar how, in an autotools build system, everything depends on `config.status` (the output of `./configure`) or similar how `SCons` and `ccache` use the compiler executable as extra dependency of all C files.



---

archive/issue_events_180524.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-09T09:58:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180524"
}
```



---

archive/issue_events_180525.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-09T09:58:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180525"
}
```



---

archive/issue_comments_148348.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nDid you fix the issue of C files not being regenerated by a Cython upgrade? Because whether it's the \"fault\" of Cython or not, it needs to be fixed.",
    "created_at": "2013-03-09T09:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148348",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Did you fix the issue of C files not being regenerated by a Cython upgrade? Because whether it's the "fault" of Cython or not, it needs to be fixed.



---

archive/issue_comments_148349.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment:36):\n> Did you fix the issue of C files not being regenerated by a Cython upgrade?\n\nNo, I removed the single offending orphaned code, all the other code that is not regenerated causes no issues (since they are they are isolated from all of the modified files). The proper way to have this resolved is to have Cython's dependency checking not just check the timestamp of a file but also what version of Cython was used to generate the C file -- but I would rather not have this ticket held up on a future version of Cython.\n\nFrom what I can tell, the current `DependancyTree` only works because it is finding false positives, not because it is checking the Cython version of generated files. So until I find the time to look at fixing this in Cython, I think the correct resolution is to implement #4797.",
    "created_at": "2013-03-10T01:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148349",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment:36):
> Did you fix the issue of C files not being regenerated by a Cython upgrade?

No, I removed the single offending orphaned code, all the other code that is not regenerated causes no issues (since they are they are isolated from all of the modified files). The proper way to have this resolved is to have Cython's dependency checking not just check the timestamp of a file but also what version of Cython was used to generate the C file -- but I would rather not have this ticket held up on a future version of Cython.

From what I can tell, the current `DependancyTree` only works because it is finding false positives, not because it is checking the Cython version of generated files. So until I find the time to look at fixing this in Cython, I think the correct resolution is to implement #4797.



---

archive/issue_comments_148350.json:
```json
{
    "body": "Attachment: **[trac13031-cythonize-simple-5.8.beta4.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)**",
    "created_at": "2013-03-10T07:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148350",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[trac13031-cythonize-simple-5.8.beta4.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)**



---

archive/issue_comments_148351.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n \n Apply:\n-* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n+* [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)\n * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)\n+* [attachment: trac13031-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-version.patch.gz)\n``````\n",
    "created_at": "2013-03-10T07:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148351",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).
 
 Apply:
-* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
+* [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)
 * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)
+* [attachment: trac13031-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-version.patch.gz)
``````




---

archive/issue_events_180526.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-10T07:58:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180526"
}
```



---

archive/issue_events_180527.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-10T07:58:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180527"
}
```



---

archive/issue_comments_148352.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAttachment: **[trac13031-cythonize-version.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)**\n\nOK, I've added a bit of code to cache and check the version.",
    "created_at": "2013-03-10T07:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148352",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:38" align="right">comment:38</div>

Attachment: **[trac13031-cythonize-version.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)**

OK, I've added a bit of code to cache and check the version.



---

archive/issue_comments_148353.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nApply only trac13031-cythonize-simple-5.8.beta4.patch trac13031-mutablity.patch trac13031-cythonize-version.patch",
    "created_at": "2013-03-10T07:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148353",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:39" align="right">comment:39</div>

Apply only trac13031-cythonize-simple-5.8.beta4.patch trac13031-mutablity.patch trac13031-cythonize-version.patch



---

archive/issue_comments_148354.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n Apply:\n * [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)\n * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)\n-* [attachment: trac13031-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-version.patch.gz)\n+* [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n``````\n",
    "created_at": "2013-03-10T07:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148354",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 Apply:
 * [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)
 * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)
-* [attachment: trac13031-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-version.patch.gz)
+* [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
``````




---

archive/issue_comments_148355.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@ohanar](#comment:37):\n> all the other code that is not regenerated causes no issues\n\nReally???????????????????????????????? What about the bug that Cython-0.17.4 fixed?",
    "created_at": "2013-03-10T10:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148355",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@ohanar](#comment:37):
> all the other code that is not regenerated causes no issues

Really???????????????????????????????? What about the bug that Cython-0.17.4 fixed?



---

archive/issue_comments_148356.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@ohanar](#comment:37):\n> From what I can tell, the current `DependancyTree` only works because it is finding false positives, not because it is checking the Cython version of generated files.\n\nTrue, but at least it works.",
    "created_at": "2013-03-10T10:01:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148356",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@ohanar](#comment:37):
> From what I can tell, the current `DependancyTree` only works because it is finding false positives, not because it is checking the Cython version of generated files.

True, but at least it works.



---

archive/issue_comments_148357.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOk, Robert's patch looks good to me.",
    "created_at": "2013-03-12T20:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148357",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:42" align="right">comment:42</div>

Ok, Robert's patch looks good to me.



---

archive/issue_events_180528.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-12T20:33:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180528"
}
```



---

archive/issue_events_180529.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-12T20:33:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180529"
}
```



---

archive/issue_events_180530.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T10:50:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180530"
}
```



---

archive/issue_events_180531.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T10:50:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180531"
}
```



---

archive/issue_events_180532.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:28:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180532"
}
```



---

archive/issue_events_180533.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:28:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180533"
}
```



---

archive/issue_comments_148358.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThis needs to be rebased to #13432.",
    "created_at": "2013-03-13T11:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148358",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

This needs to be rebased to #13432.



---

archive/issue_comments_148359.json:
```json
{
    "body": "Changed dependencies from **#13029** to **#13029, #13432**",
    "created_at": "2013-03-13T11:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148359",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#13029** to **#13029, #13432**



---

archive/issue_comments_148360.json:
```json
{
    "body": "Attachment: **[trac13031-cythonize-simple.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)**\n\napply to sage library",
    "created_at": "2013-03-13T19:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148360",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[trac13031-cythonize-simple.patch.gz](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)**

apply to sage library



---

archive/issue_comments_148361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).\n \n-Apply:\n-* [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)\n+Apply to the Sage library:\n+* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)\n * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n``````\n",
    "created_at": "2013-03-13T19:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148361",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Cython's cythonize is now robust enough to replace our custom dependency logic, with a few extra features such as * syntax for cython extensions and cycache (still needs work).
 
-Apply:
-* [attachment: trac13031-cythonize-simple-5.8.beta4.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple-5.8.beta4.patch.gz)
+Apply to the Sage library:
+* [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
 * [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)
 * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
``````




---

archive/issue_comments_148362.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI thought I had rebased this, oh well, it should now apply cleanly on top of #13432.",
    "created_at": "2013-03-13T19:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148362",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:45" align="right">comment:45</div>

I thought I had rebased this, oh well, it should now apply cleanly on top of #13432.



---

archive/issue_events_180534.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-13T19:44:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180534"
}
```



---

archive/issue_events_180535.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-13T19:44:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180535"
}
```



---

archive/issue_comments_148363.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n\n```\nTraceback (most recent call last):\n  File \"./spkg-install\", line 4, in <module>\n    from sage.all import save\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/all.py\", line 80, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/misc/all.py\", line 83, in <module>\n    from functional import (additive_order,\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 36, in <module>\n    from sage.rings.complex_double import CDF\n  File \"complex_double.pyx\", line 91, in init sage.rings.complex_double (sage/rings/complex_double.c:16796)\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/complex_field.py\", line 110, in ComplexField\n    C = ComplexField_class(prec)\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/complex_field.py\", line 204, in __init__\n    self._populate_coercion_lists_(coerce_list=[complex_number.RRtoCC(self._real_field(), self)])\n  File \"complex_number.pyx\", line 2431, in sage.rings.complex_number.RRtoCC.__init__ (sage/rings/complex_number.c:15890)\n  File \"map.pyx\", line 125, in sage.categories.map.Map.__init__ (sage/categories/map.c:2478)\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/categories/homset.py\", line 263, in Hom\n    H = category.hom_category().parent_class(X, Y, category = category)\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/categories/rings.py\", line 636, in __new__\n    from sage.rings.homset import RingHomset\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/homset.py\", line 17, in <module>\n    import morphism\n  File \"morphism.pyx\", line 985, in init sage.rings.morphism (sage/rings/morphism.c:12304)\n  File \"/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/structure/all.py\", line 49, in <module>\n    from mutability  import Mutability\nImportError: No module named mutability\n```",
    "created_at": "2013-03-15T12:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148363",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>


```
Traceback (most recent call last):
  File "./spkg-install", line 4, in <module>
    from sage.all import save
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/all.py", line 80, in <module>
    from sage.misc.all       import *         # takes a while
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/misc/all.py", line 83, in <module>
    from functional import (additive_order,
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py", line 36, in <module>
    from sage.rings.complex_double import CDF
  File "complex_double.pyx", line 91, in init sage.rings.complex_double (sage/rings/complex_double.c:16796)
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/complex_field.py", line 110, in ComplexField
    C = ComplexField_class(prec)
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/complex_field.py", line 204, in __init__
    self._populate_coercion_lists_(coerce_list=[complex_number.RRtoCC(self._real_field(), self)])
  File "complex_number.pyx", line 2431, in sage.rings.complex_number.RRtoCC.__init__ (sage/rings/complex_number.c:15890)
  File "map.pyx", line 125, in sage.categories.map.Map.__init__ (sage/categories/map.c:2478)
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/categories/homset.py", line 263, in Hom
    H = category.hom_category().parent_class(X, Y, category = category)
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/categories/rings.py", line 636, in __new__
    from sage.rings.homset import RingHomset
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/rings/homset.py", line 17, in <module>
    import morphism
  File "morphism.pyx", line 985, in init sage.rings.morphism (sage/rings/morphism.c:12304)
  File "/release/merger/sage-5.9.beta1/local/lib/python2.7/site-packages/sage/structure/all.py", line 49, in <module>
    from mutability  import Mutability
ImportError: No module named mutability
```



---

archive/issue_events_180536.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-15T12:58:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180536"
}
```



---

archive/issue_events_180537.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-15T12:58:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180537"
}
```



---

archive/issue_events_180538.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-15T17:22:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180538"
}
```



---

archive/issue_events_180539.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-15T17:22:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180539"
}
```



---

archive/issue_comments_148364.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,4 @@\n \n Apply to the Sage library:\n * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n-* [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)\n * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n``````\n",
    "created_at": "2013-03-15T17:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148364",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,4 @@
 
 Apply to the Sage library:
 * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
-* [attachment: trac13031-mutablity.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-mutablity.patch.gz)
 * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
``````




---

archive/issue_comments_148365.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nApply only trac13031-cythonize-simple.patch and trac13031-cythonize-version.patch \n\nWe can delete mutability in a separate CL, now that we have Cython version tracking.",
    "created_at": "2013-03-15T17:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148365",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:47" align="right">comment:47</div>

Apply only trac13031-cythonize-simple.patch and trac13031-cythonize-version.patch 

We can delete mutability in a separate CL, now that we have Cython version tracking.



---

archive/issue_events_180540.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-16T20:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180540"
}
```



---

archive/issue_events_180541.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-16T20:38:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180541"
}
```



---

archive/issue_comments_148366.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n\n```\nsage -t devel/sage/sage/misc/dev_tools.py\n**********************************************************************\nFile \"devel/sage/sage/misc/dev_tools.py\", line 145, in sage.misc.dev_tools.import_statements\nFailed example:\n    import_statements(ZZ)\nExpected:\n      ** Warning **: several names for that object: ZZ, Z\n    from sage.rings.integer_ring import ZZ\nGot:\n      ** Warning **: several names for that object: Z, ZZ\n    from sage.rings.integer_ring import Z\n**********************************************************************\nFile \"devel/sage/sage/misc/dev_tools.py\", line 158, in sage.misc.dev_tools.import_statements\nFailed example:\n    import_statements(ZZ, verbose=False)\nExpected:\n    from sage.rings.integer_ring import ZZ\nGot:\n    from sage.rings.integer_ring import Z\n**********************************************************************\n```",
    "created_at": "2013-03-16T20:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148366",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>


```
sage -t devel/sage/sage/misc/dev_tools.py
**********************************************************************
File "devel/sage/sage/misc/dev_tools.py", line 145, in sage.misc.dev_tools.import_statements
Failed example:
    import_statements(ZZ)
Expected:
      ** Warning **: several names for that object: ZZ, Z
    from sage.rings.integer_ring import ZZ
Got:
      ** Warning **: several names for that object: Z, ZZ
    from sage.rings.integer_ring import Z
**********************************************************************
File "devel/sage/sage/misc/dev_tools.py", line 158, in sage.misc.dev_tools.import_statements
Failed example:
    import_statements(ZZ, verbose=False)
Expected:
    from sage.rings.integer_ring import ZZ
Got:
    from sage.rings.integer_ring import Z
**********************************************************************
```



---

archive/issue_comments_148367.json:
```json
{
    "body": "Attachment: **[13031-doctest-fix.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)**",
    "created_at": "2013-03-17T06:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148367",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[13031-doctest-fix.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)**



---

archive/issue_events_180542.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-17T06:33:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180542"
}
```



---

archive/issue_events_180543.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-17T06:33:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180543"
}
```



---

archive/issue_comments_148368.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,4 @@\n Apply to the Sage library:\n * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n+* [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)\n``````\n",
    "created_at": "2013-03-17T06:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148368",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,4 @@
 Apply to the Sage library:
 * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
 * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
+* [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)
``````




---

archive/issue_comments_148369.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI think you are missing some `sys.stdout.flush()` statements in `cythonize()`, as the message\n\n```\nCythonizing sage/categories/category_singleton.pyx\n```\nmight come *after*\n\n```\ngcc -fno-strict-aliasing -std=gnu99 -D_XPG6 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include/csage -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/devel/sage/sage/ext -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include/python2.7 -c sage/categories/category_singleton.c -o build/temp.solaris-2.11-i86pc.32bit-2.7/sage/categories/category_singleton.o -w\n```\nwhich is very confusing, especially when errors occur.\n\n(there is nothing special about this file, it's just an example)",
    "created_at": "2013-03-19T09:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148369",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

I think you are missing some `sys.stdout.flush()` statements in `cythonize()`, as the message

```
Cythonizing sage/categories/category_singleton.pyx
```
might come *after*

```
gcc -fno-strict-aliasing -std=gnu99 -D_XPG6 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include/csage -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/devel/sage/sage/ext -I/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta1/local/include/python2.7 -c sage/categories/category_singleton.c -o build/temp.solaris-2.11-i86pc.32bit-2.7/sage/categories/category_singleton.o -w
```
which is very confusing, especially when errors occur.

(there is nothing special about this file, it's just an example)



---

archive/issue_events_180544.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-19T09:24:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180544"
}
```



---

archive/issue_events_180545.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-19T09:24:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180545"
}
```



---

archive/issue_comments_148370.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nhttps://github.com/cython/cython/commit/aeb34fe0046522bad68205129b7a5a0f6a56f0ab",
    "created_at": "2013-03-19T17:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148370",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:52" align="right">comment:52</div>

https://github.com/cython/cython/commit/aeb34fe0046522bad68205129b7a5a0f6a56f0ab



---

archive/issue_comments_148371.json:
```json
{
    "body": "Attachment: **[13031-flush.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)**",
    "created_at": "2013-03-19T17:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148371",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[13031-flush.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)**



---

archive/issue_comments_148372.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nGranted, there's no reason (other than luck) that we couldn't have hit this before just as well.",
    "created_at": "2013-03-19T17:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148372",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:53" align="right">comment:53</div>

Granted, there's no reason (other than luck) that we couldn't have hit this before just as well.



---

archive/issue_comments_148373.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,4 @@\n * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n * [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)\n+* [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)\n``````\n",
    "created_at": "2013-03-19T17:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148373",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,4 @@
 * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
 * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
 * [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)
+* [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)
``````




---

archive/issue_events_180546.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-19T17:40:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180546"
}
```



---

archive/issue_events_180547.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-03-19T17:40:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180547"
}
```



---

archive/issue_events_180548.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-28T04:14:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180548"
}
```



---

archive/issue_events_180549.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-28T04:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180549"
}
```



---

archive/issue_comments_148374.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThe file `sage/schemes/generic/notes/divisor_stein-joyner.txt` is removed in #13062, so [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz) needs to be rebased.",
    "created_at": "2013-03-28T19:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148374",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

The file `sage/schemes/generic/notes/divisor_stein-joyner.txt` is removed in #13062, so [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz) needs to be rebased.



---

archive/issue_comments_148375.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,5 +3,5 @@\n Apply to the Sage library:\n * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)\n * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)\n-* [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)\n+* [attachment: 13031-doctest-fix-rebased.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)\n * [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)\n``````\n",
    "created_at": "2013-03-28T19:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148375",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,5 +3,5 @@
 Apply to the Sage library:
 * [attachment: trac13031-cythonize-simple.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-simple.patch.gz)
 * [attachment: trac13031-cythonize-version.patch](https://github.com/sagemath/sage/files/ticket13031/trac13031-cythonize-version.patch.gz)
-* [attachment: 13031-doctest-fix.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix.patch.gz)
+* [attachment: 13031-doctest-fix-rebased.patch](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)
 * [attachment: 13031-flush.patch](https://github.com/sagemath/sage/files/ticket13031/13031-flush.patch.gz)
``````




---

archive/issue_comments_148376.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nAttachment: **[13031-doctest-fix-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)**",
    "created_at": "2013-03-28T19:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148376",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:56" align="right">comment:56</div>

Attachment: **[13031-doctest-fix-rebased.patch.gz](https://github.com/sagemath/sage/files/ticket13031/13031-doctest-fix-rebased.patch.gz)**



---

archive/issue_events_180550.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-01T10:39:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180550"
}
```



---

archive/issue_events_180551.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-01T10:39:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13031#event-180551"
}
```



---

archive/issue_comments_148377.json:
```json
{
    "body": "Merged: **sage-5.9.beta3**",
    "created_at": "2013-04-01T10:39:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148377",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.beta3**



---

archive/issue_comments_148378.json:
```json
{
    "body": "Changed merged from **sage-5.9.beta3** to **sage-5.9.beta4**",
    "created_at": "2013-04-02T12:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148378",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-5.9.beta3** to **sage-5.9.beta4**



---

archive/issue_comments_148379.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nRobert: any plans to add the version checking upstream to `cythonize()`?",
    "created_at": "2013-04-05T10:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148379",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

Robert: any plans to add the version checking upstream to `cythonize()`?



---

archive/issue_comments_148380.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nI just found some important bug: it seems the dependencies on the files in `c_lib/` are no longer correctly handled.\n\n```\n$ touch devel/sage/c_lib/include/interrupt.h && ./sage -b\n```\nshould rebuild all files depending on `interrupt.h` but this doesn't work anymore.\n\nIn sage-5.9.beta3, one gets instead lots of lines like\n\n```\nBuilding sage/libs/ecl.pyx because it depends on /mazur/release/merger/sage-5.9.beta3/local/include/csage/interrupt.h.\n```",
    "created_at": "2013-04-15T14:34:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148380",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:60" align="right">comment:60</div>

I just found some important bug: it seems the dependencies on the files in `c_lib/` are no longer correctly handled.

```
$ touch devel/sage/c_lib/include/interrupt.h && ./sage -b
```
should rebuild all files depending on `interrupt.h` but this doesn't work anymore.

In sage-5.9.beta3, one gets instead lots of lines like

```
Building sage/libs/ecl.pyx because it depends on /mazur/release/merger/sage-5.9.beta3/local/include/csage/interrupt.h.
```



---

archive/issue_comments_148381.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI'm on it.",
    "created_at": "2013-04-16T03:51:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148381",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:61" align="right">comment:61</div>

I'm on it.



---

archive/issue_comments_148382.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nAny progress?",
    "created_at": "2013-04-19T08:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148382",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

Any progress?



---

archive/issue_comments_148383.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nThe fix will be in Cython 0.19.",
    "created_at": "2013-04-19T09:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148383",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:63" align="right">comment:63</div>

The fix will be in Cython 0.19.



---

archive/issue_comments_148384.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\n(We could backport it if that takes too long.)",
    "created_at": "2013-04-19T09:29:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148384",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:64" align="right">comment:64</div>

(We could backport it if that takes too long.)



---

archive/issue_comments_148385.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nThanks. Anyway, good to know it's a Cython bug, not Sage bug.",
    "created_at": "2013-04-19T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148385",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:65" align="right">comment:65</div>

Thanks. Anyway, good to know it's a Cython bug, not Sage bug.



---

archive/issue_comments_148386.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nProposal: unmerge this for sage-5.9, merge in again in sage-5.10 together with #14452.",
    "created_at": "2013-04-19T14:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148386",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:66" align="right">comment:66</div>

Proposal: unmerge this for sage-5.9, merge in again in sage-5.10 together with #14452.



---

archive/issue_comments_148387.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\n(or possibly merge #14452 in sage-5.9.rc0)",
    "created_at": "2013-04-19T14:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148387",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">comment:67</div>

(or possibly merge #14452 in sage-5.9.rc0)



---

archive/issue_comments_148388.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nAlternative proposal: cython-0.18.p1. I really would not like to see this unmerged after it finally got in.",
    "created_at": "2013-04-19T17:23:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148388",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:68" align="right">comment:68</div>

Alternative proposal: cython-0.18.p1. I really would not like to see this unmerged after it finally got in.



---

archive/issue_comments_148389.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nGiven that cython-0.19 is released today and we have a workaround for the docbuilder crash at #14452, why not cython-0.19?",
    "created_at": "2013-04-19T18:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148389",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:69" align="right">comment:69</div>

Given that cython-0.19 is released today and we have a workaround for the docbuilder crash at #14452, why not cython-0.19?



---

archive/issue_comments_148390.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThere are still serious problems with dependency checking: #14544",
    "created_at": "2013-05-07T12:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148390",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">comment:70</div>

There are still serious problems with dependency checking: #14544



---

archive/issue_comments_148391.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@jdemeyer](#comment:70):\n> There are still serious problems with dependency checking: #14544\n\nThere are also reports on sage-devel that `sage -clone` was broken in 5.9 (and later), now rebuilding the whole Sage library.  Not sure what exactly introduced that though.",
    "created_at": "2013-05-11T17:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148391",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@jdemeyer](#comment:70):
> There are still serious problems with dependency checking: #14544

There are also reports on sage-devel that `sage -clone` was broken in 5.9 (and later), now rebuilding the whole Sage library.  Not sure what exactly introduced that though.



---

archive/issue_comments_148392.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@nexttime](#comment:71):\n> There are also reports on sage-devel that `sage -clone` was broken in 5.9 (and later), now rebuilding the whole Sage library.  Not sure what exactly introduced that though.\n\nLooks like just the fact that `sage-clone` doesn't copy `$SAGE_SRC/.cython_version` causes this...\n\n(where `$SAGE_SRC` is [meanwhile] `$SAGE_ROOT/devel/sage`)\n\n\n\n\nAlso (but this doesn't seem to be the cause), `sage-clone` does not (or no longer, presumably at least since a while) copy Cython-generated *header files* (`*.h`), as these do **not** contain a comment on the first line stating that they were generated by Cython, so the following doesn't work for them:\n\n```python\nprint \"Copying over all Cython auto-generated .c, .cpp and .h files...\"\ndef cpdir(src, dest):\n    if not os.path.isdir(dest):\n        return\n    for F in os.listdir(src):\n        if os.path.isdir(src + '/' + F):\n            cpdir(src + '/' + F, dest + '/' + F)\n        else:\n            ext = os.path.splitext(F)[-1]\n            if ext in ['.h', '.c', '.cpp']:\n                if 'Cython' in open(src + '/' + F).readline():\n                    os.link(src + '/' + F, dest + '/' +F)\n                    os.utime(dest + '/' +F, None)\n\ncpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))\n```",
    "created_at": "2013-05-11T19:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148392",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@nexttime](#comment:71):
> There are also reports on sage-devel that `sage -clone` was broken in 5.9 (and later), now rebuilding the whole Sage library.  Not sure what exactly introduced that though.

Looks like just the fact that `sage-clone` doesn't copy `$SAGE_SRC/.cython_version` causes this...

(where `$SAGE_SRC` is [meanwhile] `$SAGE_ROOT/devel/sage`)




Also (but this doesn't seem to be the cause), `sage-clone` does not (or no longer, presumably at least since a while) copy Cython-generated *header files* (`*.h`), as these do **not** contain a comment on the first line stating that they were generated by Cython, so the following doesn't work for them:

```python
print "Copying over all Cython auto-generated .c, .cpp and .h files..."
def cpdir(src, dest):
    if not os.path.isdir(dest):
        return
    for F in os.listdir(src):
        if os.path.isdir(src + '/' + F):
            cpdir(src + '/' + F, dest + '/' + F)
        else:
            ext = os.path.splitext(F)[-1]
            if ext in ['.h', '.c', '.cpp']:
                if 'Cython' in open(src + '/' + F).readline():
                    os.link(src + '/' + F, dest + '/' +F)
                    os.utime(dest + '/' +F, None)

cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))
```



---

archive/issue_comments_148393.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@nexttime](#comment:72):\n> Also (but this doesn't seem to be the cause), `sage-clone` does not (or no longer, presumably at least since a while) copy Cython-generated *header files* (`*.h`), as these do **not** contain a comment on the first line stating that they were generated by Cython, so the following doesn't work for them:\n> \n> ```python\n> print \"Copying over all Cython auto-generated .c, .cpp and .h files...\"\n> def cpdir(src, dest):\n>     if not os.path.isdir(dest):\n>         return\n>     for F in os.listdir(src):\n>         if os.path.isdir(src + '/' + F):\n>             cpdir(src + '/' + F, dest + '/' + F)\n>         else:\n>             ext = os.path.splitext(F)[-1]\n>             if ext in ['.h', '.c', '.cpp']:\n>                 if 'Cython' in open(src + '/' + F).readline():\n>                     os.link(src + '/' + F, dest + '/' +F)\n>                     os.utime(dest + '/' +F, None)\n> \n> cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))\n> ```\n\nFurthermore, the above code doesn't copy the Cython-generated files from `devel/sage/ext/interpreters/`, so these also get rebuilt, but that goes back to at least Sage 5.8 (unless I'm missing something).\n\n\n\n\nIf I add copying `.cython_version` to `sage-clone`, besides the above-mentioned re-\"cythonizing\"[sic!], many (if not all?) Python modules get re-byte-compiled, too, for whatever reason... (This doesn't seem to be related to Cython, but maybe I'm just missing something here as well.)",
    "created_at": "2013-05-11T20:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148393",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@nexttime](#comment:72):
> Also (but this doesn't seem to be the cause), `sage-clone` does not (or no longer, presumably at least since a while) copy Cython-generated *header files* (`*.h`), as these do **not** contain a comment on the first line stating that they were generated by Cython, so the following doesn't work for them:
> 
> ```python
> print "Copying over all Cython auto-generated .c, .cpp and .h files..."
> def cpdir(src, dest):
>     if not os.path.isdir(dest):
>         return
>     for F in os.listdir(src):
>         if os.path.isdir(src + '/' + F):
>             cpdir(src + '/' + F, dest + '/' + F)
>         else:
>             ext = os.path.splitext(F)[-1]
>             if ext in ['.h', '.c', '.cpp']:
>                 if 'Cython' in open(src + '/' + F).readline():
>                     os.link(src + '/' + F, dest + '/' +F)
>                     os.utime(dest + '/' +F, None)
> 
> cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))
> ```

Furthermore, the above code doesn't copy the Cython-generated files from `devel/sage/ext/interpreters/`, so these also get rebuilt, but that goes back to at least Sage 5.8 (unless I'm missing something).




If I add copying `.cython_version` to `sage-clone`, besides the above-mentioned re-"cythonizing"[sic!], many (if not all?) Python modules get re-byte-compiled, too, for whatever reason... (This doesn't seem to be related to Cython, but maybe I'm just missing something here as well.)



---

archive/issue_comments_148394.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@nexttime](#comment:73):\n> If I add copying `.cython_version` to `sage-clone` ...\n\n\n```patch\ndiff --git a/sage-clone b/sage-clone\n--- a/sage-clone\n+++ b/sage-clone\n@@ -53,6 +53,10 @@\n \n cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))\n \n+if os.path.isfile('sage/.cython_version'):\n+    print \"Copying over hidden Cython version file...\"\n+    os.link('sage/.cython_version', branch+'/.cython_version')\n+\n def copy_dtree(src_dir, dest_dir):\n     src_root = os.path.abspath(src_dir)\n     dest_root = os.path.abspath(dest_dir)\n```",
    "created_at": "2013-05-11T20:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13031#issuecomment-148394",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@nexttime](#comment:73):
> If I add copying `.cython_version` to `sage-clone` ...


```patch
diff --git a/sage-clone b/sage-clone
--- a/sage-clone
+++ b/sage-clone
@@ -53,6 +53,10 @@
 
 cpdir(os.path.abspath('sage/sage'), os.path.abspath(branch + '/sage'))
 
+if os.path.isfile('sage/.cython_version'):
+    print "Copying over hidden Cython version file..."
+    os.link('sage/.cython_version', branch+'/.cython_version')
+
 def copy_dtree(src_dir, dest_dir):
     src_root = os.path.abspath(src_dir)
     dest_root = os.path.abspath(dest_dir)
```
