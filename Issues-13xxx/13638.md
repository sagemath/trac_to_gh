# Issue 13638: fix adjacency of rays

archive/issues_013434.json:
```json
{
    "body": "The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes:\n\n```\nsage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)]).plot()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/vbraun/opt/sage-5.4.rc1/devel/sage-main/<ipython console> in <module>()\n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, **kwds)\n    516             render = render_method[self.ambient_dim()]\n    517             if render != None:\n--> 518                 return render(self,**kwds)\n    519         raise NotImplementedError('Plotting of '+str(self.ambient_dim())+\n    520                                   '-dimensional polyhedra not implemented')\n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in render_2d(projection, **kwds)\n     54     \"\"\"\n     55     if is_Polyhedron(projection):\n---> 56         projection = Projection(projection)\n     57     return \\\n     58         projection.render_points_2d(zorder=2, pointsize=10, **kwds) + \\\n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in __init__(self, polyhedron, proj)\n    411 \n    412         if polyhedron.ambient_dim() == 2:\n--> 413             self._init_from_2d(polyhedron)\n    414         elif polyhedron.ambient_dim() == 3:\n    415             self._init_from_3d(polyhedron)\n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_from_2d(self, polyhedron)\n    630         self._init_points(polyhedron)\n    631         self._init_lines_arrows(polyhedron)\n--> 632         self._init_area_2d(polyhedron)\n    633 \n    634 \n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_area_2d(self, polyhedron)\n    727         assert polyhedron.ambient_dim() == 2, \"Requires polyhedron in 2d\"\n    728         vertices = [v for v in polyhedron.Vrep_generator()]\n--> 729         vertices = cyclic_sort_vertices_2d(vertices)\n    730         coords = []\n    731         \n\n/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in cyclic_sort_vertices_2d(Vlist)\n    188                 break;\n    189         else:\n--> 190             raise ValueError\n    191     return result\n    192         \n\nValueError: \n```\n\nAttach [attachment:trac_13638_ray_adjacency_fix.patch]\n\n\n\nAssignee: mhampton\n\nReviewer: Dmitrii Pasechnik\n\nAuthor: Volker Braun\n\nMerged: sage-5.6.beta2\n\nDependencies: #11763\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13638\n\n",
    "closed_at": "2012-12-27T10:23:32Z",
    "created_at": "2012-10-22T11:28:40Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "fix adjacency of rays",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13638",
    "user": "https://github.com/vbraun"
}
```
The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes:

```
sage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)]).plot()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/vbraun/opt/sage-5.4.rc1/devel/sage-main/<ipython console> in <module>()

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, **kwds)
    516             render = render_method[self.ambient_dim()]
    517             if render != None:
--> 518                 return render(self,**kwds)
    519         raise NotImplementedError('Plotting of '+str(self.ambient_dim())+
    520                                   '-dimensional polyhedra not implemented')

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in render_2d(projection, **kwds)
     54     """
     55     if is_Polyhedron(projection):
---> 56         projection = Projection(projection)
     57     return \
     58         projection.render_points_2d(zorder=2, pointsize=10, **kwds) + \

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in __init__(self, polyhedron, proj)
    411 
    412         if polyhedron.ambient_dim() == 2:
--> 413             self._init_from_2d(polyhedron)
    414         elif polyhedron.ambient_dim() == 3:
    415             self._init_from_3d(polyhedron)

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_from_2d(self, polyhedron)
    630         self._init_points(polyhedron)
    631         self._init_lines_arrows(polyhedron)
--> 632         self._init_area_2d(polyhedron)
    633 
    634 

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_area_2d(self, polyhedron)
    727         assert polyhedron.ambient_dim() == 2, "Requires polyhedron in 2d"
    728         vertices = [v for v in polyhedron.Vrep_generator()]
--> 729         vertices = cyclic_sort_vertices_2d(vertices)
    730         coords = []
    731         

/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in cyclic_sort_vertices_2d(Vlist)
    188                 break;
    189         else:
--> 190             raise ValueError
    191     return result
    192         

ValueError: 
```

Attach [attachment:trac_13638_ray_adjacency_fix.patch]



Assignee: mhampton

Reviewer: Dmitrii Pasechnik

Author: Volker Braun

Merged: sage-5.6.beta2

Dependencies: #11763

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13638





---

archive/issue_comments_176309.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-22T11:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176309",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_176310.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,60 @@\n-The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes.\n+The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes:\n+\n+```\n+sage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)]).plot()\n+---------------------------------------------------------------------------\n+ValueError                                Traceback (most recent call last)\n+\n+/home/vbraun/opt/sage-5.4.rc1/devel/sage-main/<ipython console> in <module>()\n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, **kwds)\n+    516             render = render_method[self.ambient_dim()]\n+    517             if render != None:\n+--> 518                 return render(self,**kwds)\n+    519         raise NotImplementedError('Plotting of '+str(self.ambient_dim())+\n+    520                                   '-dimensional polyhedra not implemented')\n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in render_2d(projection, **kwds)\n+     54     \"\"\"\n+     55     if is_Polyhedron(projection):\n+---> 56         projection = Projection(projection)\n+     57     return \\\n+     58         projection.render_points_2d(zorder=2, pointsize=10, **kwds) + \\\n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in __init__(self, polyhedron, proj)\n+    411 \n+    412         if polyhedron.ambient_dim() == 2:\n+--> 413             self._init_from_2d(polyhedron)\n+    414         elif polyhedron.ambient_dim() == 3:\n+    415             self._init_from_3d(polyhedron)\n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_from_2d(self, polyhedron)\n+    630         self._init_points(polyhedron)\n+    631         self._init_lines_arrows(polyhedron)\n+--> 632         self._init_area_2d(polyhedron)\n+    633 \n+    634 \n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_area_2d(self, polyhedron)\n+    727         assert polyhedron.ambient_dim() == 2, \"Requires polyhedron in 2d\"\n+    728         vertices = [v for v in polyhedron.Vrep_generator()]\n+--> 729         vertices = cyclic_sort_vertices_2d(vertices)\n+    730         coords = []\n+    731         \n+\n+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in cyclic_sort_vertices_2d(Vlist)\n+    188                 break;\n+    189         else:\n+--> 190             raise ValueError\n+    191     return result\n+    192         \n+\n+ValueError: \n+```\n+\n+Attach [attachment:trac_13638_ray_adjacency_fix.patch]\n+\n+\n \n Author: Volker Braun\n \n``````\n",
    "created_at": "2012-10-22T11:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176310",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,60 @@
-The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes.
+The adjacency of rays in polyhedra isn't right. This impacts some corner cases in plotting 2-d non-compact polytopes:
+
+```
+sage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)]).plot()
+---------------------------------------------------------------------------
+ValueError                                Traceback (most recent call last)
+
+/home/vbraun/opt/sage-5.4.rc1/devel/sage-main/<ipython console> in <module>()
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, **kwds)
+    516             render = render_method[self.ambient_dim()]
+    517             if render != None:
+--> 518                 return render(self,**kwds)
+    519         raise NotImplementedError('Plotting of '+str(self.ambient_dim())+
+    520                                   '-dimensional polyhedra not implemented')
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in render_2d(projection, **kwds)
+     54     """
+     55     if is_Polyhedron(projection):
+---> 56         projection = Projection(projection)
+     57     return \
+     58         projection.render_points_2d(zorder=2, pointsize=10, **kwds) + \
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in __init__(self, polyhedron, proj)
+    411 
+    412         if polyhedron.ambient_dim() == 2:
+--> 413             self._init_from_2d(polyhedron)
+    414         elif polyhedron.ambient_dim() == 3:
+    415             self._init_from_3d(polyhedron)
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_from_2d(self, polyhedron)
+    630         self._init_points(polyhedron)
+    631         self._init_lines_arrows(polyhedron)
+--> 632         self._init_area_2d(polyhedron)
+    633 
+    634 
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in _init_area_2d(self, polyhedron)
+    727         assert polyhedron.ambient_dim() == 2, "Requires polyhedron in 2d"
+    728         vertices = [v for v in polyhedron.Vrep_generator()]
+--> 729         vertices = cyclic_sort_vertices_2d(vertices)
+    730         coords = []
+    731         
+
+/home/vbraun/opt/sage-5.4.rc1/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.pyc in cyclic_sort_vertices_2d(Vlist)
+    188                 break;
+    189         else:
+--> 190             raise ValueError
+    191     return result
+    192         
+
+ValueError: 
+```
+
+Attach [attachment:trac_13638_ray_adjacency_fix.patch]
+
+
 
 Author: Volker Braun
 
``````




---

archive/issue_comments_176311.json:
```json
{
    "body": "<a id='comment:2'></a>line 279 in geometry/polyhedron/base.py says:\n\n```\n\t        Note that parallel rays are adjacent to each other\n```\nThis is bizzarre. Are you saying that if you, say, have a 3-D cube \"with the lid removed\", i.e. extended infinitely into direction z, say, then all the 4 rays present will be adjacent?  This seems to contradict what the lines 995-999 of the same file say, too.",
    "created_at": "2012-10-23T17:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176311",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>line 279 in geometry/polyhedron/base.py says:

```
	        Note that parallel rays are adjacent to each other
```
This is bizzarre. Are you saying that if you, say, have a 3-D cube "with the lid removed", i.e. extended infinitely into direction z, say, then all the 4 rays present will be adjacent?  This seems to contradict what the lines 995-999 of the same file say, too.



---

archive/issue_comments_176312.json:
```json
{
    "body": "<a id='comment:3'></a>In this case there is only one ray in the V-representation. I see that its tricky, but I'm unsure how to phrase it clearer.",
    "created_at": "2012-10-23T17:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176312",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>In this case there is only one ray in the V-representation. I see that its tricky, but I'm unsure how to phrase it clearer.



---

archive/issue_comments_176313.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 vbraun]:\n> In this case there is only one ray in the V-representation. I see that its tricky, but I'm unsure how to phrase it clearer. \n\n\nI'd assume that you have the usual decomposition of a polyhedron into the sum of a subspace,  a pointed cone,  and a polytope, right? But all the rays then come from a pointed cone, and there is no way to get TWO parallel rays then...",
    "created_at": "2012-10-23T17:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176313",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Replying to [comment:3 vbraun]:
> In this case there is only one ray in the V-representation. I see that its tricky, but I'm unsure how to phrase it clearer. 


I'd assume that you have the usual decomposition of a polyhedron into the sum of a subspace,  a pointed cone,  and a polytope, right? But all the rays then come from a pointed cone, and there is no way to get TWO parallel rays then...



---

archive/issue_comments_176314.json:
```json
{
    "body": "<a id='comment:5'></a>How about:\n\nIf the V-representation of the polygon contains only vertices and a single ray, then every V-representation object has exact two adjacent ones. The cyclic order is unique up to reversal of direction and choice of starting point. \n\nIf the V-representation of the polygon contains vertices and two rays, then the two rays are not adjacent to each other. The cyclic order then starts with one of the rays and ends with the other ray.",
    "created_at": "2012-10-23T18:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176314",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>How about:

If the V-representation of the polygon contains only vertices and a single ray, then every V-representation object has exact two adjacent ones. The cyclic order is unique up to reversal of direction and choice of starting point. 

If the V-representation of the polygon contains vertices and two rays, then the two rays are not adjacent to each other. The cyclic order then starts with one of the rays and ends with the other ray.



---

archive/issue_comments_176315.json:
```json
{
    "body": "<a id='comment:6'></a>I've clarified the docstring in question.",
    "created_at": "2012-10-23T20:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176315",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>I've clarified the docstring in question.



---

archive/issue_comments_176316.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 vbraun]:\n> How about:\n> \n> If the V-representation of the polygon contains only vertices and a single ray, then every V-representation object has exact two adjacent ones. The cyclic order is unique up to reversal of direction and choice of starting point. \n> \n> If the V-representation of the polygon contains vertices and two rays, then the two rays are not adjacent to each other. The cyclic order then starts with one of the rays and ends with the other ray.\n\n\nThis implies that the two extreme rays of a pointed cone in `R^2` non-adjacent. Which is obviously wrong: these rays have a common vertex, which is an element of the polyhedron of dimension one less, and due to this they are adjacent, just as two facets of a polytope in `R^3` would be adjacent if they had a common edge (or two edges would be adjacent if they had a common vertex).\n\nDid you mean to say *more than 1 vertex*, rather than *vertices*?\n\n \nWhy does it only talk about polygons? What about bigger dimensions?\n\nThere is a typo on line 261 of `geometry/polyhedron/base.py`: exact->exactly",
    "created_at": "2012-10-24T03:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176316",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Replying to [comment:5 vbraun]:
> How about:
> 
> If the V-representation of the polygon contains only vertices and a single ray, then every V-representation object has exact two adjacent ones. The cyclic order is unique up to reversal of direction and choice of starting point. 
> 
> If the V-representation of the polygon contains vertices and two rays, then the two rays are not adjacent to each other. The cyclic order then starts with one of the rays and ends with the other ray.


This implies that the two extreme rays of a pointed cone in `R^2` non-adjacent. Which is obviously wrong: these rays have a common vertex, which is an element of the polyhedron of dimension one less, and due to this they are adjacent, just as two facets of a polytope in `R^3` would be adjacent if they had a common edge (or two edges would be adjacent if they had a common vertex).

Did you mean to say *more than 1 vertex*, rather than *vertices*?

 
Why does it only talk about polygons? What about bigger dimensions?

There is a typo on line 261 of `geometry/polyhedron/base.py`: exact->exactly



---

archive/issue_comments_176317.json:
```json
{
    "body": "<a id='comment:8'></a>Yes, I was thinking about more than one vertex (and thats what the doctest is doing). I've fixed the wording and the typo.\n\nI was taking polygons as an example, since its easier to visualize. In higher dimension there is of course no cyclic ordering of adjacent vertices. Apart from that it works the same.",
    "created_at": "2012-10-24T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176317",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Yes, I was thinking about more than one vertex (and thats what the doctest is doing). I've fixed the wording and the typo.

I was taking polygons as an example, since its easier to visualize. In higher dimension there is of course no cyclic ordering of adjacent vertices. Apart from that it works the same.



---

archive/issue_comments_176318.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 vbraun]:\n> Yes, I was thinking about more than one vertex (and thats what the doctest is doing). I've fixed the wording and the typo.\n> \n> I was taking polygons as an example, since its easier to visualize. In higher dimension there is of course no cyclic ordering of adjacent vertices. Apart from that it works the same.\n\n\nIn fact, now I think the setup is mathematically not quite sound. Sorry for not noticing this straight away.\nIn my book, rays and edges are of the same dimension. One cannot normally even talk about adjacency between rays and vertices, yet you do (lines 974-9 of `geometry/polyhedron/base.py`).\nAlthough you can certainly talk about incidence between them, by inclusion, as usual.\n\nYou can have adjacency graphs between faces of the same dimension (bounded or not, does not matter). \nIt would simplify things if one knows what exactly is behind the error message in the description.",
    "created_at": "2012-10-24T10:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176318",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 vbraun]:
> Yes, I was thinking about more than one vertex (and thats what the doctest is doing). I've fixed the wording and the typo.
> 
> I was taking polygons as an example, since its easier to visualize. In higher dimension there is of course no cyclic ordering of adjacent vertices. Apart from that it works the same.


In fact, now I think the setup is mathematically not quite sound. Sorry for not noticing this straight away.
In my book, rays and edges are of the same dimension. One cannot normally even talk about adjacency between rays and vertices, yet you do (lines 974-9 of `geometry/polyhedron/base.py`).
Although you can certainly talk about incidence between them, by inclusion, as usual.

You can have adjacency graphs between faces of the same dimension (bounded or not, does not matter). 
It would simplify things if one knows what exactly is behind the error message in the description.



---

archive/issue_comments_176319.json:
```json
{
    "body": "<a id='comment:10'></a>A ray by itself does not define an edge, so you can't identify these two concepts. I claim that it does make sense to treat V-representation objects (vertices, rays, lines) on the same footing when talking about vertex-adjacencies. To span an edge you need two vertices, a vertex and a ray, or a vertex and a line.\n\nAlternatively, you can understand this by going to projective space. Now rays are just points at infinity...\n\nThe original error message in the ticket description is a bug in my code for plotting where I didn't handle some special case with rays correctly.",
    "created_at": "2012-10-24T10:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176319",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>A ray by itself does not define an edge, so you can't identify these two concepts. I claim that it does make sense to treat V-representation objects (vertices, rays, lines) on the same footing when talking about vertex-adjacencies. To span an edge you need two vertices, a vertex and a ray, or a vertex and a line.

Alternatively, you can understand this by going to projective space. Now rays are just points at infinity...

The original error message in the ticket description is a bug in my code for plotting where I didn't handle some special case with rays correctly.



---

archive/issue_comments_176320.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 vbraun]:\n> A ray by itself does not define an edge, so you can't identify these two concepts. I claim that it does make sense to treat V-representation objects (vertices, rays, lines) on the same footing when talking about vertex-adjacencies. \n\n\nIt might make sense for the purpose of drawing things, perhaps. I don't mind this being implemented in a way you see fit, I'm just objecting to the names used to describe the objects, as they are hugely misleading.\n\nBy they way, it would be great to know what exactly you (and Sage :-)) mean by the V-representation. Is it always reduced?\nDoes it always distinguish between vertices, rays, and lines? A reference?\n\n> To span an edge you need two vertices, a vertex and a ray, or a vertex and a line.\n\n\nthe classical definition of a face of a convex set B is that it is the intersection of a supporting hyperplane with B.\nAnd the dimension of the face is the topological dimension of the intersection. This way it certainly does not make sense to talk about adjacency beween vertices and rays, as they are objects of different *type* (i.e., dimension).\n\n> \n> Alternatively, you can understand this by going to projective space. Now rays are just points at infinity...\n\n\nNo, you certainly do not want to squash your affine space. You want to add the hyperplane at infinity. Then the rays  have two vertices, one of which at infinity. (And parallel rays intersect at infinity, which might make sense for your purposes, or not...)\n\nRegarding lines, there are two schools, one of which just forbids full lines in convex sets in `RP^n` all together.",
    "created_at": "2012-10-24T11:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176320",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:10 vbraun]:
> A ray by itself does not define an edge, so you can't identify these two concepts. I claim that it does make sense to treat V-representation objects (vertices, rays, lines) on the same footing when talking about vertex-adjacencies. 


It might make sense for the purpose of drawing things, perhaps. I don't mind this being implemented in a way you see fit, I'm just objecting to the names used to describe the objects, as they are hugely misleading.

By they way, it would be great to know what exactly you (and Sage :-)) mean by the V-representation. Is it always reduced?
Does it always distinguish between vertices, rays, and lines? A reference?

> To span an edge you need two vertices, a vertex and a ray, or a vertex and a line.


the classical definition of a face of a convex set B is that it is the intersection of a supporting hyperplane with B.
And the dimension of the face is the topological dimension of the intersection. This way it certainly does not make sense to talk about adjacency beween vertices and rays, as they are objects of different *type* (i.e., dimension).

> 
> Alternatively, you can understand this by going to projective space. Now rays are just points at infinity...


No, you certainly do not want to squash your affine space. You want to add the hyperplane at infinity. Then the rays  have two vertices, one of which at infinity. (And parallel rays intersect at infinity, which might make sense for your purposes, or not...)

Regarding lines, there are two schools, one of which just forbids full lines in convex sets in `RP^n` all together.



---

archive/issue_comments_176321.json:
```json
{
    "body": "<a id='comment:12'></a>I'm basing the nomenclature on \"Representations of Convex Polyhedra\" in the PPL docs [http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html](http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html), if you want a reference. The representation is always reduced.\n\nWith regard to the projective space, I guess it would be best to compactify by adding rays as extra \"points\". Instead of lines, which would give you the usual real projective space. Note that you don't have to say rays/lines modulo parallel transport since the rays/lines don't have a base point in my notation. \n\nSo there is no such thing as parallel rays, only parallel edges. Two parallel half-infinite edges intersect at infinity. \n\nThe `Polyhedron` class doesn't keep track of extra generators at infinity. So two half-infinite edges that are not parallel can be thought of as closed up by a edge that is at infinity, but that is not part of the data we track.",
    "created_at": "2012-10-24T12:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176321",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>I'm basing the nomenclature on "Representations of Convex Polyhedra" in the PPL docs [http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html](http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html), if you want a reference. The representation is always reduced.

With regard to the projective space, I guess it would be best to compactify by adding rays as extra "points". Instead of lines, which would give you the usual real projective space. Note that you don't have to say rays/lines modulo parallel transport since the rays/lines don't have a base point in my notation. 

So there is no such thing as parallel rays, only parallel edges. Two parallel half-infinite edges intersect at infinity. 

The `Polyhedron` class doesn't keep track of extra generators at infinity. So two half-infinite edges that are not parallel can be thought of as closed up by a edge that is at infinity, but that is not part of the data we track.



---

archive/issue_comments_176322.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 vbraun]:\n> I'm basing the nomenclature on \"Representations of Convex Polyhedra\" in the PPL docs [ppl](http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html), if you want a reference. The representation is always reduced.\n\n\nDo I understand you right that you're \"unrolling\" a minimal V-representation when building up your adjacencies? E.g. if your polyhedron is a polytope plus a ray then you have to \"paste\" a ray into each vertex, and this gives you your parallel \"half-infinite edges\"?\n\nHmm, and what do you do if your polyhedron has no vertices at all? (E.g. it's a half-plane?)",
    "created_at": "2012-10-24T16:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176322",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Replying to [comment:12 vbraun]:
> I'm basing the nomenclature on "Representations of Convex Polyhedra" in the PPL docs [ppl](http://bugseng.com/products/ppl/documentation#%2Fproducts%2Fppl%2Fdocumentation%2F%2Fdevref%2Fppl-devref-1.0-html%2Findex.html), if you want a reference. The representation is always reduced.


Do I understand you right that you're "unrolling" a minimal V-representation when building up your adjacencies? E.g. if your polyhedron is a polytope plus a ray then you have to "paste" a ray into each vertex, and this gives you your parallel "half-infinite edges"?

Hmm, and what do you do if your polyhedron has no vertices at all? (E.g. it's a half-plane?)



---

archive/issue_comments_176323.json:
```json
{
    "body": "<a id='comment:14'></a>A polyhedron has at least one vertex, except when it is empty:\n\n```\nsage: Polyhedron(lines=[(1,0),(0,1)])\nA 2-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 2 lines\nsage: _.Vrepresentation()\n(A line in the direction (0, 1), A line in the direction (1, 0), A vertex at (0, 0))\nsage: Polyhedron()\nThe empty polyhedron in QQ^0\nsage: _.Vrepresentation()\n()\n```\nThe representation of polyhedra containing whole lines is not unique.",
    "created_at": "2012-10-24T16:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176323",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>A polyhedron has at least one vertex, except when it is empty:

```
sage: Polyhedron(lines=[(1,0),(0,1)])
A 2-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 2 lines
sage: _.Vrepresentation()
(A line in the direction (0, 1), A line in the direction (1, 0), A vertex at (0, 0))
sage: Polyhedron()
The empty polyhedron in QQ^0
sage: _.Vrepresentation()
()
```
The representation of polyhedra containing whole lines is not unique.



---

archive/issue_comments_176324.json:
```json
{
    "body": "<a id='comment:15'></a>PS: Its a non-trivial step to compute the adjacencies, I agree. All edges are constructed in that step. Right now actually the whole face lattice is computed, though that could be done faster with linear programming. In any case, we first need to get it right before we can make it fast ;-)",
    "created_at": "2012-10-24T17:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176324",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>PS: Its a non-trivial step to compute the adjacencies, I agree. All edges are constructed in that step. Right now actually the whole face lattice is computed, though that could be done faster with linear programming. In any case, we first need to get it right before we can make it fast ;-)



---

archive/issue_comments_176325.json:
```json
{
    "body": "<a id='comment:16'></a>please remove all trailing whitespaces",
    "created_at": "2012-10-26T13:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176325",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>please remove all trailing whitespaces



---

archive/issue_comments_176326.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-26T13:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176326",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176327.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-26T14:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176327",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176328.json:
```json
{
    "body": "<a id='comment:17'></a>The only trailing whitespace policy that we have in effect is to not care about trailing whitespace. In particular, this might break my other patches on top of this one for no good reason.",
    "created_at": "2012-10-26T14:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176328",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>The only trailing whitespace policy that we have in effect is to not care about trailing whitespace. In particular, this might break my other patches on top of this one for no good reason.



---

archive/issue_comments_176329.json:
```json
{
    "body": "<a id='comment:18'></a>When you say \"we have\", do you mean \"I have\" ?\n\nWell, please do as you want. But I will not be happy with any ticket if the bot is not fully green.",
    "created_at": "2012-10-26T14:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176329",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>When you say "we have", do you mean "I have" ?

Well, please do as you want. But I will not be happy with any ticket if the bot is not fully green.



---

archive/issue_comments_176330.json:
```json
{
    "body": "<a id='comment:19'></a>This was discussed on sage-devel not so long ago, see https://groups.google.com/d/msg/sage-devel/dQENkqZ3uWI/q-jU2S952LsJ",
    "created_at": "2012-10-26T14:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176330",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>This was discussed on sage-devel not so long ago, see https://groups.google.com/d/msg/sage-devel/dQENkqZ3uWI/q-jU2S952LsJ



---

archive/issue_comments_176331.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 vbraun]:\n\n```\nsage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)])\nsage: P.adjacency_matrix?\n...\nDefinition:\tP.adjacency_matrix(self)\nDocstring:\n       This is an alias for \"vertex_adjacency_matrix()\"\n...\n```\n\nthis seems to indicate that only vertices can be adjacent, no?\nAnother very confusing thing is\n\n```\nTwo V-representation objects are adjacent if they generate a \n \t975\t        (1-dimensional) face of the polyhedron. Examples are two \n \t976\t        vertices of a polytope that bound an edge, or a vertex and a \n \t977\t        ray of a polyhedron that generate a bounding half-line of the \n \t978\t        polyhedron. \n```\nin `geometry/polyhedron/base.py`. \n\n\nIMHO the whole documentation for the adjacency is a mess. I am unable to make sense out of it, and the link to PPL docs (which aren't clear to me at all) is not helping much, either.  Please, please, define what is meant by \"ray\" somewhere. I just don't get it...",
    "created_at": "2012-11-06T16:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176331",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>Replying to [comment:17 vbraun]:

```
sage: P = Polyhedron(vertices=[(0, 1), (1, 0), (2, 0), (3, 0), (4, 1)], rays=[(0,1)])
sage: P.adjacency_matrix?
...
Definition:	P.adjacency_matrix(self)
Docstring:
       This is an alias for "vertex_adjacency_matrix()"
...
```

this seems to indicate that only vertices can be adjacent, no?
Another very confusing thing is

```
Two V-representation objects are adjacent if they generate a 
 	975	        (1-dimensional) face of the polyhedron. Examples are two 
 	976	        vertices of a polytope that bound an edge, or a vertex and a 
 	977	        ray of a polyhedron that generate a bounding half-line of the 
 	978	        polyhedron. 
```
in `geometry/polyhedron/base.py`. 


IMHO the whole documentation for the adjacency is a mess. I am unable to make sense out of it, and the link to PPL docs (which aren't clear to me at all) is not helping much, either.  Please, please, define what is meant by "ray" somewhere. I just don't get it...



---

archive/issue_comments_176332.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 dimpase]:\n\nIn short, in order to be able to review this ticket, I'd like to see what are V-objects (they are vertices and rays, as far as I can see, but I don't get what is done with polyhedra containing lines), what are 1-dimensional objects, and a full list of adjacency rules, not \"Examples are...\". Without this I don't see what this ticket is supposed to fix.",
    "created_at": "2012-11-06T16:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176332",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Replying to [comment:20 dimpase]:

In short, in order to be able to review this ticket, I'd like to see what are V-objects (they are vertices and rays, as far as I can see, but I don't get what is done with polyhedra containing lines), what are 1-dimensional objects, and a full list of adjacency rules, not "Examples are...". Without this I don't see what this ticket is supposed to fix.



---

archive/issue_comments_176333.json:
```json
{
    "body": "<a id='comment:22'></a>Historically there was a `vertex_adjacency_matrix` first. Though it would have been more appropriate to call it `Vrepresentation_adjacency_matrix`. I agree that the docs could be better. I'll try to write a concise definition...",
    "created_at": "2012-11-06T17:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176333",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Historically there was a `vertex_adjacency_matrix` first. Though it would have been more appropriate to call it `Vrepresentation_adjacency_matrix`. I agree that the docs could be better. I'll try to write a concise definition...



---

archive/issue_comments_176334.json:
```json
{
    "body": "Attachment [trac_13638_ray_adjacency_fix.patch](tarball://root/attachments/some-uuid/ticket13638/trac_13638_ray_adjacency_fix.patch) by @vbraun created at 2012-11-26 15:44:57\n\nUpdated patch",
    "created_at": "2012-11-26T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176334",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13638_ray_adjacency_fix.patch](tarball://root/attachments/some-uuid/ticket13638/trac_13638_ray_adjacency_fix.patch) by @vbraun created at 2012-11-26 15:44:57

Updated patch



---

archive/issue_comments_176335.json:
```json
{
    "body": "<a id='comment:24'></a>I've expanded the documentation for V-representation objects and for the adjacency rules. Please let me know if anything is still unclear.\n\nIn order to have clearer examples I added #11763 to the dependencies, this ticket improves output and introduces the `polyhedron.faces(dim)` method which is useful if you have to talk about one-dimensional faces.",
    "created_at": "2012-11-26T15:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176335",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>I've expanded the documentation for V-representation objects and for the adjacency rules. Please let me know if anything is still unclear.

In order to have clearer examples I added #11763 to the dependencies, this ticket improves output and introduces the `polyhedron.faces(dim)` method which is useful if you have to talk about one-dimensional faces.



---

archive/issue_comments_176336.json:
```json
{
    "body": "<a id='comment:25'></a>hopefully the patchbot faults is just a setup problem. At least I have it all running on my machine (macosx 10.6.8).",
    "created_at": "2012-11-27T04:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176336",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>hopefully the patchbot faults is just a setup problem. At least I have it all running on my machine (macosx 10.6.8).



---

archive/issue_comments_176337.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-27T04:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176337",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_176338.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks!\n\nThe patchbot has the wrong order of patches for #11763 for some reason, which is why it fails. I think it fails to parse the formatting in the description.",
    "created_at": "2012-11-27T10:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176338",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>Thanks!

The patchbot has the wrong order of patches for #11763 for some reason, which is why it fails. I think it fails to parse the formatting in the description.



---

archive/issue_events_038064.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-03T13:53:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "milestone": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13638#event-38064"
}
```



---

archive/issue_comments_176339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-27T10:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13638#issuecomment-176339",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_038065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:23:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13638",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13638#event-38065"
}
```
