# Issue 13145: Sage's noncommutative rings don't always increment a refcount

archive/issues_012973.json:
```json
{
    "body": "Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.\n\n**Assignee:** @malb\n\n**CC:**  simonking @malb\n\n**Reviewer:** Martin Albrecht\n\n**Author:** David Roe\n\n**Merged:** sage-5.4.beta1\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13145\n\n",
    "closed_at": "2012-09-04T17:15:42Z",
    "created_at": "2012-06-21T05:12:48Z",
    "labels": [
        "component: commutative algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Sage's noncommutative rings don't always increment a refcount",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13145",
    "user": "https://github.com/roed314"
}
```
Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.

**Assignee:** @malb

**CC:**  simonking @malb

**Reviewer:** Martin Albrecht

**Author:** David Roe

**Merged:** sage-5.4.beta1

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/13145





---

archive/issue_comments_199867.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Running doctests with the new doctest framework revealed that KeyErrors were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.\n+Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.\n``````\n",
    "created_at": "2012-06-21T05:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199867",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Running doctests with the new doctest framework revealed that KeyErrors were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.
+Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.
``````




---

archive/attachments_017768.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13145.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13145/13145.patch",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_199868.json:
```json
{
    "body": "<a id='comment:2'></a>\n",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199868",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>




---

archive/issue_comments_199869.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199869",
    "user": "https://github.com/roed314"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_199870.json:
```json
{
    "body": "<a id='comment:3'></a>\nMy fixes apparently aren't enough: I'm picking up more failures now.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199870",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>
My fixes apparently aren't enough: I'm picking up more failures now.



---

archive/issue_comments_199871.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199871",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_199872.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.\n+Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.\n``````\n",
    "created_at": "2012-06-25T18:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199872",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.
+Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.
``````




---

archive/issue_events_042212.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "rename": {
        "from": "Sage's noncommutive rings don't always increment a refcount",
        "to": "Sage's noncommutative rings don't always increment a refcount"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13145#event-42212"
}
```



---

archive/issue_comments_199873.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199873",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_199874.json:
```json
{
    "body": "<a id='comment:6'></a>\nSomehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to \"Needs review\" for now.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199874",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>
Somehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to "Needs review" for now.



---

archive/issue_comments_199875.json:
```json
{
    "body": "<a id='comment:7'></a>\nSimon: any opinions?",
    "created_at": "2012-08-23T21:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199875",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Simon: any opinions?



---

archive/issue_comments_199876.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.",
    "created_at": "2012-09-01T03:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199876",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>
I'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.



---

archive/issue_comments_199877.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199877",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_199878.json:
```json
{
    "body": "<a id='comment:9'></a>\nPatch looks good to me.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199878",
    "user": "https://github.com/malb"
}
```

<a id='comment:9'></a>
Patch looks good to me.



---

archive/issue_comments_199879.json:
```json
{
    "body": "**Reviewer:** Martin Albrecht",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199879",
    "user": "https://github.com/malb"
}
```

**Reviewer:** Martin Albrecht



---

archive/issue_events_042213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-02T21:28:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "milestone": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13145#event-42213"
}
```



---

archive/issue_comments_199880.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks!",
    "created_at": "2012-09-02T21:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199880",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Thanks!



---

archive/issue_events_042214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T17:15:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13145#event-42214"
}
```



---

archive/issue_comments_199881.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-09-04T17:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199881",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_199882.json:
```json
{
    "body": "**Merged:** sage-5.4.beta1",
    "created_at": "2012-09-04T17:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199882",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.4.beta1



---

archive/issue_comments_199883.json:
```json
{
    "body": "<a id='comment:13'></a>\nQuestion: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?",
    "created_at": "2012-09-15T18:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199883",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>
Question: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?



---

archive/issue_comments_199884.json:
```json
{
    "body": "<a id='comment:14'></a>\nFor the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.",
    "created_at": "2012-09-17T17:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-199884",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
For the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.
