# Issue 13145: Sage's noncommutative rings don't always increment a refcount

archive/issues_012973.json:
```json
{
    "body": "Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.\n\nAssignee: @malb\n\nCC:  simonking @malb\n\nReviewer: Martin Albrecht\n\nAuthor: David Roe\n\nMerged: sage-5.4.beta1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13145\n\n",
    "closed_at": "2012-09-04T17:15:42Z",
    "created_at": "2012-06-21T05:12:48Z",
    "labels": [
        "component: commutative algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Sage's noncommutative rings don't always increment a refcount",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13145",
    "user": "https://github.com/roed314"
}
```
Running doctests with the new doctest framework revealed that `KeyErrors` were being ignored in `sage.lib.singular.ring.singular_ring_delete`.

Assignee: @malb

CC:  simonking @malb

Reviewer: Martin Albrecht

Author: David Roe

Merged: sage-5.4.beta1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13145





---

archive/issue_comments_156499.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [13145.patch](tarball://root/attachments/some-uuid/ticket13145/13145.patch) by @roed314 created at 2012-06-21 18:35:19",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156499",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>Attachment [13145.patch](tarball://root/attachments/some-uuid/ticket13145/13145.patch) by @roed314 created at 2012-06-21 18:35:19



---

archive/issue_comments_156500.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156500",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156501.json:
```json
{
    "body": "<a id='comment:3'></a>My fixes apparently aren't enough: I'm picking up more failures now.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156501",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>My fixes apparently aren't enough: I'm picking up more failures now.



---

archive/issue_comments_156502.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156502",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156503.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156503",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156504.json:
```json
{
    "body": "<a id='comment:6'></a>Somehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to \"Needs review\" for now.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156504",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>Somehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to "Needs review" for now.



---

archive/issue_comments_156505.json:
```json
{
    "body": "<a id='comment:7'></a>Simon: any opinions?",
    "created_at": "2012-08-23T21:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156505",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>Simon: any opinions?



---

archive/issue_comments_156506.json:
```json
{
    "body": "<a id='comment:8'></a>I'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.",
    "created_at": "2012-09-01T03:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156506",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>I'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.



---

archive/issue_comments_156507.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156507",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156508.json:
```json
{
    "body": "<a id='comment:9'></a>Patch looks good to me.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156508",
    "user": "https://github.com/malb"
}
```

<a id='comment:9'></a>Patch looks good to me.



---

archive/issue_events_036213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-02T21:28:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "milestone": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13145#event-36213"
}
```



---

archive/issue_comments_156509.json:
```json
{
    "body": "Changing priority from minor to critical.",
    "created_at": "2012-09-02T21:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156509",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from minor to critical.



---

archive/issue_comments_156510.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks!",
    "created_at": "2012-09-02T21:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156510",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Thanks!



---

archive/issue_events_036214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T17:15:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13145#event-36214"
}
```



---

archive/issue_comments_156511.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-04T17:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156511",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_156512.json:
```json
{
    "body": "<a id='comment:13'></a>Question: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?",
    "created_at": "2012-09-15T18:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156512",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>Question: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?



---

archive/issue_comments_156513.json:
```json
{
    "body": "<a id='comment:14'></a>For the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.",
    "created_at": "2012-09-17T17:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13145#issuecomment-156513",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>For the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.
