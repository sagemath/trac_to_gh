# Issue 13884: Fix optional internet tests.

archive/issues_013680.json:
```json
{
    "body": "Untested = broken.\n\n```\nsage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed\nsage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed\nsage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed\nsage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed\nsage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed\nsage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed\n```\n\n\nThe files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.\n\nThe file `sage/interfaces/r.py` is a situation needing clarification at #7771.\n\nThis ticket is to fix the minor issues in the integral, preparer, and stock files.\n\n**Apply**:\n* [attachment:trac_13884.patch]\n* [attachment:trac_13884_addon1.patch]\n\n**Assignee:** mvngu\n\n**Branch:** [90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)\n\n**Reviewer:** Ralf Stephan, Volker Braun\n\n**Author:** Karl-Dieter Crisman\n\nIssue created by migration from https://trac.sagemath.org/ticket/13884\n\n",
    "closed_at": "2014-04-06T20:49:06Z",
    "created_at": "2012-12-29T23:03:34Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "title": "Fix optional internet tests.",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13884",
    "user": "https://github.com/robertwb"
}
```
Untested = broken.

```
sage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed
sage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed
sage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed
sage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed
sage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed
sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed
```


The files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.

The file `sage/interfaces/r.py` is a situation needing clarification at #7771.

This ticket is to fix the minor issues in the integral, preparer, and stock files.

**Apply**:
* [attachment:trac_13884.patch]
* [attachment:trac_13884_addon1.patch]

**Assignee:** mvngu

**Branch:** [90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)

**Reviewer:** Ralf Stephan, Volker Braun

**Author:** Karl-Dieter Crisman

Issue created by migration from https://trac.sagemath.org/ticket/13884





---

archive/issue_comments_166340.json:
```json
{
    "body": "<a id='comment:1'></a>\nSo this doesn't happen again, re-enable these via #13540.",
    "created_at": "2012-12-30T00:29:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166340",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>
So this doesn't happen again, re-enable these via #13540.



---

archive/issue_comments_166341.json:
```json
{
    "body": "<a id='comment:2'></a>\n\n```\nsage -t --only_optional=internet devel/sage/sage/interfaces/r.py\n```\nJust for clarification, this one is broken, but not because of the internet, and has been for a while.  This was originally noticed (and fixed) by Minh while reviewing #7771 in [attachment:trac_7771-reviewer.patch:ticket:7771 this patch].  It wasn't clear how to proceed, as you can see by reading the comments there.",
    "created_at": "2013-01-03T17:49:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166341",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>

```
sage -t --only_optional=internet devel/sage/sage/interfaces/r.py
```
Just for clarification, this one is broken, but not because of the internet, and has been for a while.  This was originally noticed (and fixed) by Minh while reviewing #7771 in [attachment:trac_7771-reviewer.patch:ticket:7771 this patch].  It wasn't clear how to proceed, as you can see by reading the comments there.



---

archive/issue_comments_166342.json:
```json
{
    "body": "<a id='comment:3'></a>\nHaha!  And the first one is not really a problem, just a logic issue.\n\n```\nsage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py\n    sage: f.integrate(algorithm=\"mathematica_free\")       # optional -- requires internet\nExpected:\n    sqrt(pi)*sqrt(1/2)*fresnels(sqrt(2)*x/sqrt(pi)) + y^z*x\nGot:\n    doctest:674: DeprecationWarning: Variable of integration should be specified explicitly.\n    See http://trac.sagemath.org/12438 for details.\n    sqrt(pi)*sqrt(1/2)*fresnels(sqrt(2)*x/sqrt(pi)) + y^z*x\n**********************************************************************\nExpected:\n    doctest:...: DeprecationWarning:\n    Variable of integration should be specified explicitly.\n    See http://trac.sagemath.org/12438 for details.\n    1/2*x^2\nGot:\n    1/2*x^2\n```\nWhat happens is that when the test is done, the deprecation warning, which **only occurs once**, occurs with the internet test.  This is a two-character fix.  I'll try to see if I can fix any others along with it.",
    "created_at": "2013-01-03T17:54:09Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166342",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Haha!  And the first one is not really a problem, just a logic issue.

```
sage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py
    sage: f.integrate(algorithm="mathematica_free")       # optional -- requires internet
Expected:
    sqrt(pi)*sqrt(1/2)*fresnels(sqrt(2)*x/sqrt(pi)) + y^z*x
Got:
    doctest:674: DeprecationWarning: Variable of integration should be specified explicitly.
    See http://trac.sagemath.org/12438 for details.
    sqrt(pi)*sqrt(1/2)*fresnels(sqrt(2)*x/sqrt(pi)) + y^z*x
**********************************************************************
Expected:
    doctest:...: DeprecationWarning:
    Variable of integration should be specified explicitly.
    See http://trac.sagemath.org/12438 for details.
    1/2*x^2
Got:
    1/2*x^2
```
What happens is that when the test is done, the deprecation warning, which **only occurs once**, occurs with the internet test.  This is a two-character fix.  I'll try to see if I can fix any others along with it.



---

archive/issue_comments_166343.json:
```json
{
    "body": "<a id='comment:4'></a>\nNext:  Considering that William at some point changed the file in this test\n\n```\n    sage: sage.misc.preparser.load('http://wstein.org/loadtest.py', globals())  # optional - internet\nExpected:\n    hi from the net\nGot:\n    hi from the net\n    5\n```\nto\n\n```\nprint \"hi from the net\"\n\nprint 2+3      \n```\nI think we'll be okay just changing this one too.",
    "created_at": "2013-01-03T17:56:35Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166343",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
Next:  Considering that William at some point changed the file in this test

```
    sage: sage.misc.preparser.load('http://wstein.org/loadtest.py', globals())  # optional - internet
Expected:
    hi from the net
Got:
    hi from the net
    5
```
to

```
print "hi from the net"

print 2+3      
```
I think we'll be okay just changing this one too.



---

archive/issue_comments_166344.json:
```json
{
    "body": "<a id='comment:5'></a>\nJust for reference, in general this file (sloane.py) is almost completely undocumented and #10358 is supposed to update with respect to this.  So this is fully known.",
    "created_at": "2013-01-03T18:05:41Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166344",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
Just for reference, in general this file (sloane.py) is almost completely undocumented and #10358 is supposed to update with respect to this.  So this is fully known.



---

archive/issue_comments_166345.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe finance errors seem mostly due to a change in how Google uses `startdate`, though at least one of them shouldn't have even worked the first time!\n\n```\n\n    sage: finance.Stock('vmw').google()[:5]   # optional -- internet\nExpected:\n    [\n     28-Nov-07 80.57 88.49 80.57 87.69    7496000,\n     29-Nov-07 90.91 93.20 89.50 90.85    5497600,\n     30-Nov-07 95.39 95.60 89.85 91.37    4750200,\n      3-Dec-07 89.87 96.00 88.70 94.97    4401100,\n      4-Dec-07 92.26 97.10 92.05 95.08    2896600\n    ]\nGot:\n    [\n      5-Jan-12 81.76 82.84 81.52 82.31    2888520,\n      6-Jan-12 82.96 84.33 82.47 83.31    1922781,\n      9-Jan-12 83.45 85.17 82.94 84.95    1841373,\n     10-Jan-12 86.01 86.80 85.10 85.30    1762911,\n     11-Jan-12 85.42 88.20 85.30 87.92    2192664\n    ]\n```\nAt least this tells us when William added the finance stuff!",
    "created_at": "2013-01-03T18:10:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166345",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
The finance errors seem mostly due to a change in how Google uses `startdate`, though at least one of them shouldn't have even worked the first time!

```

    sage: finance.Stock('vmw').google()[:5]   # optional -- internet
Expected:
    [
     28-Nov-07 80.57 88.49 80.57 87.69    7496000,
     29-Nov-07 90.91 93.20 89.50 90.85    5497600,
     30-Nov-07 95.39 95.60 89.85 91.37    4750200,
      3-Dec-07 89.87 96.00 88.70 94.97    4401100,
      4-Dec-07 92.26 97.10 92.05 95.08    2896600
    ]
Got:
    [
      5-Jan-12 81.76 82.84 81.52 82.31    2888520,
      6-Jan-12 82.96 84.33 82.47 83.31    1922781,
      9-Jan-12 83.45 85.17 82.94 84.95    1841373,
     10-Jan-12 86.01 86.80 85.10 85.30    1762911,
     11-Jan-12 85.42 88.20 85.30 87.92    2192664
    ]
```
At least this tells us when William added the finance stuff!



---

archive/issue_comments_166346.json:
```json
{
    "body": "<a id='comment:7'></a>\nAnd finally, the combinat error is due to the broken `sloane_find` issue.  So this ticket should be quite fixable - hope to have a patch up soon.",
    "created_at": "2013-01-03T18:12:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166346",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
And finally, the combinat error is due to the broken `sloane_find` issue.  So this ticket should be quite fixable - hope to have a patch up soon.



---

archive/issue_comments_166347.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n \tsage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed\n \tsage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed\n ```\n+\n+Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.\n``````\n",
    "created_at": "2013-01-03T18:16:00Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166347",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 	sage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed
 	sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed
 ```
+
+Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.
``````




---

archive/issue_comments_166348.json:
```json
{
    "body": "<a id='comment:9'></a>\nGoogle now apparently does not return data that is more than a certain number of years old - or at least the interface must have changed?\n\n```\n\nsage: finance.Stock('F').google('Jan+3,+1978', 'Jul+7,+2008')[:1]\n[\n 20-Aug-92 0.00 2.26 2.21 2.24   19202479\n]\nsage: finance.Stock('F').google('Jan+3,+1982', 'Jul+7,+2008')[:1]\n[\n 20-Aug-92 0.00 2.26 2.21 2.24   19202479\n]\n```\n\nIn fact, according to [this blog post](http://googlecode.blogspot.com/2011/05/spring-cleaning-for-some-of-our-apis.html), \n> These APIs are now deprecated but have no scheduled shutdown date: ... Finance API ...\n\nAnd although the data is still there if one uses e.g. a URL [like this](http://www.google.com/finance/historical?q=AAPL&startdate=Jan%201%2C%201990&enddate=Jan%2003%2C%202013&histperiod=daily&start=5790&num=30&ei=Xs_lULgX56nQAe0t) downloading the CSV only gives you so much.  \n\nWhat should we do, oh many Sage devels who are Google employees?  ;-)  I can fix some stuff but don't want to fix more of this if it's going to be gone eventually anyway.",
    "created_at": "2013-01-03T18:42:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166348",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Google now apparently does not return data that is more than a certain number of years old - or at least the interface must have changed?

```

sage: finance.Stock('F').google('Jan+3,+1978', 'Jul+7,+2008')[:1]
[
 20-Aug-92 0.00 2.26 2.21 2.24   19202479
]
sage: finance.Stock('F').google('Jan+3,+1982', 'Jul+7,+2008')[:1]
[
 20-Aug-92 0.00 2.26 2.21 2.24   19202479
]
```

In fact, according to [this blog post](http://googlecode.blogspot.com/2011/05/spring-cleaning-for-some-of-our-apis.html), 
> These APIs are now deprecated but have no scheduled shutdown date: ... Finance API ...

And although the data is still there if one uses e.g. a URL [like this](http://www.google.com/finance/historical?q=AAPL&startdate=Jan%201%2C%201990&enddate=Jan%2003%2C%202013&histperiod=daily&start=5790&num=30&ei=Xs_lULgX56nQAe0t) downloading the CSV only gives you so much.  

What should we do, oh many Sage devels who are Google employees?  ;-)  I can fix some stuff but don't want to fix more of this if it's going to be gone eventually anyway.



---

archive/issue_comments_166349.json:
```json
{
    "body": "<a id='comment:10'></a>\nOkay, the following patch fixes everything not from #10358, #7771, and the change in the CSV files that the Google Finance API produces.  (Note that Apple must have had a 4-1 stock split at some point as well.) In some cases I could circumvent the latter when the point wasn't testing historical data, but there are still two failures.\n\n```\n\nsage -t --only_optional=internet \"devel/sage/sage/finance/stock.py\"\n**********************************************************************\n    sage: finance.Stock('F').google('Jan+3,+1978', 'Jul+7,+2008')[:5] # optional -- internet\nExpected:\n    [\n      3-Jan-78 0.00 1.93 1.89 1.89    1618200,\n      4-Jan-78 0.00 1.89 1.87 1.88    2482700,\n      5-Jan-78 0.00 1.89 1.84 1.84    2994900,\n      6-Jan-78 0.00 1.84 1.82 1.83    3042500,\n      9-Jan-78 0.00 1.81 1.79 1.81    3916400\n    ]\nGot:\n    [\n     20-Aug-92 0.00 2.26 2.21 2.24   19202479,\n     21-Aug-92 0.00 2.27 2.19 2.20   18689616,\n     24-Aug-92 0.00 2.17 2.10 2.10   38652825,\n     25-Aug-92 0.00 2.19 2.11 2.18   31028049,\n     26-Aug-92 0.00 2.21 2.18 2.20   22539411\n    ]\n**********************************************************************\n    sage: sage.finance.stock.Stock(\"AAPL\", 22144).google(startdate='Jan+1,+1990')[:5] #optional -- internet\nExpected:\n    [\n      2-Jan-90 0.00 9.38 8.75 9.31    6542800,\n      3-Jan-90 0.00 9.50 9.38 9.38    7428400,\n      4-Jan-90 0.00 9.69 9.31 9.41    7911200,\n      5-Jan-90 0.00 9.56 9.25 9.44    4404000,\n      8-Jan-90 0.00 9.50 9.25 9.50    3627600\n    ]\nGot:\n    [\n     28-Feb-97 0.00 1.05 1.02 1.02   17411200,\n      3-Mar-97 0.00 1.03 1.00 1.01   18636800,\n      4-Mar-97 0.00 1.03 1.00 1.03   14745600,\n      5-Mar-97 0.00 1.06 1.03 1.06   13737600,\n      6-Mar-97 0.00 1.06 1.03 1.04   16612800\n    ]\n**********************************************************************\n```\nI don't know if these are fixable.",
    "created_at": "2013-01-03T19:16:22Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166349",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>
Okay, the following patch fixes everything not from #10358, #7771, and the change in the CSV files that the Google Finance API produces.  (Note that Apple must have had a 4-1 stock split at some point as well.) In some cases I could circumvent the latter when the point wasn't testing historical data, but there are still two failures.

```

sage -t --only_optional=internet "devel/sage/sage/finance/stock.py"
**********************************************************************
    sage: finance.Stock('F').google('Jan+3,+1978', 'Jul+7,+2008')[:5] # optional -- internet
Expected:
    [
      3-Jan-78 0.00 1.93 1.89 1.89    1618200,
      4-Jan-78 0.00 1.89 1.87 1.88    2482700,
      5-Jan-78 0.00 1.89 1.84 1.84    2994900,
      6-Jan-78 0.00 1.84 1.82 1.83    3042500,
      9-Jan-78 0.00 1.81 1.79 1.81    3916400
    ]
Got:
    [
     20-Aug-92 0.00 2.26 2.21 2.24   19202479,
     21-Aug-92 0.00 2.27 2.19 2.20   18689616,
     24-Aug-92 0.00 2.17 2.10 2.10   38652825,
     25-Aug-92 0.00 2.19 2.11 2.18   31028049,
     26-Aug-92 0.00 2.21 2.18 2.20   22539411
    ]
**********************************************************************
    sage: sage.finance.stock.Stock("AAPL", 22144).google(startdate='Jan+1,+1990')[:5] #optional -- internet
Expected:
    [
      2-Jan-90 0.00 9.38 8.75 9.31    6542800,
      3-Jan-90 0.00 9.50 9.38 9.38    7428400,
      4-Jan-90 0.00 9.69 9.31 9.41    7911200,
      5-Jan-90 0.00 9.56 9.25 9.44    4404000,
      8-Jan-90 0.00 9.50 9.25 9.50    3627600
    ]
Got:
    [
     28-Feb-97 0.00 1.05 1.02 1.02   17411200,
      3-Mar-97 0.00 1.03 1.00 1.01   18636800,
      4-Mar-97 0.00 1.03 1.00 1.03   14745600,
      5-Mar-97 0.00 1.06 1.03 1.06   13737600,
      6-Mar-97 0.00 1.06 1.03 1.04   16612800
    ]
**********************************************************************
```
I don't know if these are fixable.



---

archive/attachments_018755.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13884.patch",
    "asset_url": "tarball://root/attachments/ticket13884/trac_13884.patch",
    "created_at": "2013-01-03T19:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13884/trac_13884.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_166350.json:
```json
{
    "body": "<a id='comment:11'></a>\nAttachment [trac_13884.patch](https://github.com/sagemath/sage/files/ticket13884/trac_13884.patch) by @kcrisman created at 2013-01-03 19:20:30\n\nPatchbot, apply trac_13884.patch\n\nI'd appreciate feedback; however, the easiest to me seems to be to review this and then open a new ticket to fix the Google finance interface csv download issue - if that is even possible.",
    "created_at": "2013-01-03T19:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166350",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
Attachment [trac_13884.patch](https://github.com/sagemath/sage/files/ticket13884/trac_13884.patch) by @kcrisman created at 2013-01-03 19:20:30

Patchbot, apply trac_13884.patch

I'd appreciate feedback; however, the easiest to me seems to be to review this and then open a new ticket to fix the Google finance interface csv download issue - if that is even possible.



---

archive/issue_events_119190.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-03T19:20:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119190"
}
```



---

archive/issue_comments_166351.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,3 +10,5 @@\n ```\n \n Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.\n+\n+**Apply** [attachment:trac_13884.patch].\n``````\n",
    "created_at": "2013-01-03T19:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166351",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,3 +10,5 @@
 ```
 
 Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.
+
+**Apply** [attachment:trac_13884.patch].
``````




---

archive/issue_comments_166352.json:
```json
{
    "body": "**Author:** Karl-Dieter Crisman",
    "created_at": "2013-01-03T19:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166352",
    "user": "https://github.com/kcrisman"
}
```

**Author:** Karl-Dieter Crisman



---

archive/issue_comments_166353.json:
```json
{
    "body": "<a id='comment:12'></a>\nOkay, in the meantime the Google stuff has changed yet again (???), and we get the following bizarre error:\n\n```\nFile \"sage/symbolic/integration/integral.py\", line 466, in sage.symbolic.integration.integral.integrate\nFailed example:\n    f.integrate(algorithm=\"mathematica_free\")       # optional - internet\n    NameError: name 'f' is not defined\n**********************************************************************\n```\nThis one baffles me; even doing `f.integrate(x)` with no algorithm or anything still fails.  Doing this by hand usually works - I think there is some potential for timeouts.  But it consistently fails with this in doctesting.  So I'm giving up on this patch for now, unless someone has some other bright ideas.",
    "created_at": "2013-06-14T15:30:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166353",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
Okay, in the meantime the Google stuff has changed yet again (???), and we get the following bizarre error:

```
File "sage/symbolic/integration/integral.py", line 466, in sage.symbolic.integration.integral.integrate
Failed example:
    f.integrate(algorithm="mathematica_free")       # optional - internet
    NameError: name 'f' is not defined
**********************************************************************
```
This one baffles me; even doing `f.integrate(x)` with no algorithm or anything still fails.  Doing this by hand usually works - I think there is some potential for timeouts.  But it consistently fails with this in doctesting.  So I'm giving up on this patch for now, unless someone has some other bright ideas.



---

archive/issue_events_119191.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-06-14T15:30:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119191"
}
```



---

archive/issue_events_119192.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-06-14T15:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119192"
}
```



---

archive/issue_events_119193.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119193"
}
```



---

archive/issue_events_119194.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119194"
}
```



---

archive/issue_comments_166354.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,13 @@\n \tsage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed\n ```\n \n-Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.\n+\n+\n+\n+The files `sage/databases/sloane.py` and another one (?) are really covered by #10358.\n+\n+The file `sage/interfaces/r.py` is a situation needing clarification at #7771.\n+\n+This ticket is to fix the minor issues in the integral, preparer, and stock files.\n \n **Apply** [attachment:trac_13884.patch].\n``````\n",
    "created_at": "2013-09-01T15:32:11Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166354",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,13 @@
 	sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed
 ```
 
-Of these, two are really covered by #10358, and another is a situation needing clarification at #7771.   This ticket is to fix the minor issues in the integral, preparer, and stock files.
+
+
+
+The files `sage/databases/sloane.py` and another one (?) are really covered by #10358.
+
+The file `sage/interfaces/r.py` is a situation needing clarification at #7771.
+
+This ticket is to fix the minor issues in the integral, preparer, and stock files.
 
 **Apply** [attachment:trac_13884.patch].
``````




---

archive/issue_comments_166355.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,10 +12,12 @@\n \n \n \n-The files `sage/databases/sloane.py` and another one (?) are really covered by #10358.\n+The files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.\n \n The file `sage/interfaces/r.py` is a situation needing clarification at #7771.\n \n This ticket is to fix the minor issues in the integral, preparer, and stock files.\n \n-**Apply** [attachment:trac_13884.patch].\n+**Apply**:\n+* [attachment:trac_13884.patch]\n+* [attachment:trac_13884_addon1.patch]\n``````\n",
    "created_at": "2013-09-01T15:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166355",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,10 +12,12 @@
 
 
 
-The files `sage/databases/sloane.py` and another one (?) are really covered by #10358.
+The files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.
 
 The file `sage/interfaces/r.py` is a situation needing clarification at #7771.
 
 This ticket is to fix the minor issues in the integral, preparer, and stock files.
 
-**Apply** [attachment:trac_13884.patch].
+**Apply**:
+* [attachment:trac_13884.patch]
+* [attachment:trac_13884_addon1.patch]
``````




---

archive/attachments_018756.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13884_addon1.patch",
    "asset_url": "tarball://root/attachments/ticket13884/trac_13884_addon1.patch",
    "created_at": "2013-09-01T15:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13884/trac_13884_addon1.patch",
    "user": "https://github.com/fchapoton"
}
```



---

archive/issue_comments_166356.json:
```json
{
    "body": "<a id='comment:15'></a>\nAttachment [trac_13884_addon1.patch](https://github.com/sagemath/sage/files/ticket13884/trac_13884_addon1.patch) by @fchapoton created at 2013-09-01 15:40:59\n\nI think this solves the problem in the integral file.",
    "created_at": "2013-09-01T15:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166356",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
Attachment [trac_13884_addon1.patch](https://github.com/sagemath/sage/files/ticket13884/trac_13884_addon1.patch) by @fchapoton created at 2013-09-01 15:40:59

I think this solves the problem in the integral file.



---

archive/issue_comments_166357.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe add-on patch is good. I'm not sure why that should make a difference, but it did.\n\nI'm tempted to have us just add the preparser test to the integral one and then open a new ticket for stock.py, which clearly isn't functioning properly in any case (not just a problem of changed values any more).  Frederic, do you want to create a patch like that?",
    "created_at": "2013-09-02T13:14:18Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166357",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
The add-on patch is good. I'm not sure why that should make a difference, but it did.

I'm tempted to have us just add the preparser test to the integral one and then open a new ticket for stock.py, which clearly isn't functioning properly in any case (not just a problem of changed values any more).  Frederic, do you want to create a patch like that?



---

archive/issue_comments_166358.json:
```json
{
    "body": "<a id='comment:17'></a>\nA partial fix is better than no fix at all, IMHO.",
    "created_at": "2014-01-04T04:24:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166358",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
A partial fix is better than no fix at all, IMHO.



---

archive/issue_comments_166359.json:
```json
{
    "body": "<a id='comment:18'></a>\nI agree, no need to fix all of them before any of them go in.",
    "created_at": "2014-01-04T05:14:52Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166359",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:18'></a>
I agree, no need to fix all of them before any of them go in.



---

archive/issue_comments_166360.json:
```json
{
    "body": "**Commit:** [90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)",
    "created_at": "2014-01-04T10:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166360",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)



---

archive/issue_comments_166361.json:
```json
{
    "body": "**Branch:** [u/chapoton/13884](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/13884)",
    "created_at": "2014-01-04T10:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166361",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/13884](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/13884)



---

archive/issue_comments_166362.json:
```json
{
    "body": "<a id='comment:19'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90a4128\">90a4128</a></td><td><code>Trac #13884 - fix most broken internet optional doctests</code></td></tr></table>\n",
    "created_at": "2014-01-04T10:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166362",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90a4128">90a4128</a></td><td><code>Trac #13884 - fix most broken internet optional doctests</code></td></tr></table>




---

archive/issue_events_119195.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-01-04T10:26:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119195"
}
```



---

archive/issue_events_119196.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-01-04T10:26:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119196"
}
```



---

archive/issue_events_119197.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119197"
}
```



---

archive/issue_events_119198.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119198"
}
```



---

archive/issue_comments_166363.json:
```json
{
    "body": "<a id='comment:21'></a>\nWhat test command do you use? With `--optional=internet` I get:\n\n```\nsage -t src/sage/finance/stock.py  # 11 doctests failed\nsage -t src/sage/symbolic/integration/external.py  # 1 doctest failed\n```",
    "created_at": "2014-04-05T08:48:56Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166363",
    "user": "https://github.com/rwst"
}
```

<a id='comment:21'></a>
What test command do you use? With `--optional=internet` I get:

```
sage -t src/sage/finance/stock.py  # 11 doctests failed
sage -t src/sage/symbolic/integration/external.py  # 1 doctest failed
```



---

archive/issue_comments_166364.json:
```json
{
    "body": "**Reviewer:** Ralf Stephan, Volker Braun",
    "created_at": "2014-04-05T10:47:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166364",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Ralf Stephan, Volker Braun



---

archive/issue_comments_166365.json:
```json
{
    "body": "<a id='comment:22'></a>\nSounds good to me; somebody interested in finance can take up the stock.py failures.",
    "created_at": "2014-04-05T10:47:40Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166365",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
Sounds good to me; somebody interested in finance can take up the stock.py failures.



---

archive/issue_events_119199.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:47:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119199"
}
```



---

archive/issue_events_119200.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:47:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119200"
}
```



---

archive/issue_events_119201.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-06T20:49:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119201"
}
```



---

archive/issue_events_119202.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-06T20:49:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13884#event-119202"
}
```



---

archive/issue_comments_166366.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/13884](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/13884)\" to \"[90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)\".",
    "created_at": "2014-04-06T20:49:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166366",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/13884](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/13884)" to "[90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)".



---

archive/issue_comments_166367.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,13 @@\n Untested = broken.\n \n ```\n-\tsage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed\n-\tsage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed\n-\tsage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed\n-\tsage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed\n-\tsage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed\n-\tsage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed\n+sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed\n ```\n-\n-\n \n \n The files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.\n``````\n",
    "created_at": "2015-09-06T13:37:27Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166367",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,13 @@
 Untested = broken.
 
 ```
-	sage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed
-	sage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed
-	sage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed
-	sage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed
-	sage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed
-	sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed
+sage -t --only_optional=internet devel/sage/sage/symbolic/integration/integral.py # 2 doctests failed
+sage -t --only_optional=internet devel/sage/sage/combinat/words/paths.py # 1 doctests failed
+sage -t --only_optional=internet devel/sage/sage/misc/preparser.py # 1 doctests failed
+sage -t --only_optional=internet devel/sage/sage/interfaces/r.py # 1 doctests failed
+sage -t --only_optional=internet devel/sage/sage/finance/stock.py # 11 doctests failed
+sage -t --only_optional=internet devel/sage/sage/databases/sloane.py # 8 doctests failed
 ```
-
-
 
 
 The files `sage/databases/sloane.py` and `sage/combinat/words/paths.py` are really covered by #10358.
``````




---

archive/issue_comments_166368.json:
```json
{
    "body": "**Changing commit** from \"[90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)\" to \"\".",
    "created_at": "2015-09-06T13:37:27Z",
    "issue": "https://github.com/sagemath/sage/issues/13884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13884#issuecomment-166368",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[90a4128e8e2eebf6f79511d684b56c1c710464dd](https://github.com/sagemath/sagetrac-mirror/commit/90a4128e8e2eebf6f79511d684b56c1c710464dd)" to "".
