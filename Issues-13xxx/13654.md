# Issue 13654: A normalized quadratic form for quaternion algebras.

archive/issues_013450.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "This algorithm follows John Voight's Algorithm 3.12 in Identifying the Matrix Ring.\n\nCC:  @adeines\n\nKeywords: **Normalized Quadratic Form**\n\nReviewer: **tkluck**\n\nAuthor: **Sarah Chisholm**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13654_\n\n",
    "created_at": "2012-10-25T20:56:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "A normalized quadratic form for quaternion algebras.",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/13654",
    "user": "https://github.com/sagetrac-schisholm"
}
```
This algorithm follows John Voight's Algorithm 3.12 in Identifying the Matrix Ring.

CC:  @adeines

Keywords: **Normalized Quadratic Form**

Reviewer: **tkluck**

Author: **Sarah Chisholm**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/13654_





---

archive/issue_events_191882.json:
```json
{
    "actor": "https://github.com/sagetrac-schisholm",
    "created_at": "2012-10-25T20:56:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191882"
}
```



---

archive/issue_events_191883.json:
```json
{
    "actor": "https://github.com/sagetrac-schisholm",
    "created_at": "2012-10-25T20:56:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191883"
}
```



---

archive/issue_events_191884.json:
```json
{
    "actor": "https://github.com/sagetrac-schisholm",
    "created_at": "2012-10-25T20:56:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191884"
}
```



---

archive/issue_events_191885.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-10-25T20:56:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "subject": "https://github.com/sagetrac-schisholm",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191885"
}
```



---

archive/issue_comments_160211.json:
```json
{
    "body": "Attachment: **[normalized_quadratic_form.patch.gz](https://github.com/sagemath/sage/files/ticket13654/normalized_quadratic_form.patch.gz)**",
    "created_at": "2012-10-25T20:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160211",
    "user": "https://github.com/sagetrac-schisholm"
}
```

Attachment: **[normalized_quadratic_form.patch.gz](https://github.com/sagemath/sage/files/ticket13654/normalized_quadratic_form.patch.gz)**



---

archive/issue_events_191886.json:
```json
{
    "actor": "https://github.com/sagetrac-schisholm",
    "created_at": "2012-10-25T20:58:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191886"
}
```



---

archive/issue_events_191887.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-10-29T21:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191887"
}
```



---

archive/issue_comments_160212.json:
```json
{
    "body": "Reviewer: **tkluck**",
    "created_at": "2012-10-29T21:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160212",
    "user": "https://github.com/tkluck"
}
```

Reviewer: **tkluck**



---

archive/issue_events_191888.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-10-29T21:06:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191888"
}
```



---

archive/issue_events_191889.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-10-29T21:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191889"
}
```



---

archive/issue_comments_160213.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThanks for contributing! I've had a look at your code. It looks like a good implementation of the algorithm in the article. I don't know much about quadratic forms, so I can't really say much about the math.\n\nMy most important review point is that your doctests don't cover all your code paths. The examples you give already have a diagonal inner product matrix, so all but the first step are not being tested.\n\nIn fact, the other code paths contain `1/2 in R` which I'm not sure will work as you seem to expect. I think it will just throw a `ZeroDivisionError` if 2 is not a unit. You could replace it by `R(2).is_unit()`.\n\nI'll set this ticket's status to needs_work.\n\nHere's a few additional suggestions to make your code more concise by using a few Python gimmicks:\n\n* Instead of\n\n```\nE = self.basis()\nf = []\nfor i in range(len(E)):\n    f.append(E[i])\n```\n for copying a list, you can write\n\n```\nf = self.basis()[:]\n```\n* You could implement a function `T(x,y)` because you use that expression a lot. It makes the code a lot more readable.\n\n* Usually, you shouldn't need to have loops like\n\n```\nfor i in xrange(len(f)):\n    # do something with f[i]\n```\n   because you can write\n\n```\nfor f_i in f:\n    # do something with f_i\n```\n\n* One hard part is the sorting prescribed by\n> Otherwise, let (i, j) with 1 \u2264 i \u2264 j \u2264 n be such that ord T(e_i, e_j) is minimal, taking i = j if possible and if not taking i minimal.\n\n I've found a way to implement that using the builtin `sort`. Namely, this is equivalent to sorting the tuples `(valuation, int(i != j), i)` lexicographically.\n\nI've attached a patch including these comments.",
    "created_at": "2012-10-29T21:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160213",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:2" align="right">comment:2</div>

Thanks for contributing! I've had a look at your code. It looks like a good implementation of the algorithm in the article. I don't know much about quadratic forms, so I can't really say much about the math.

My most important review point is that your doctests don't cover all your code paths. The examples you give already have a diagonal inner product matrix, so all but the first step are not being tested.

In fact, the other code paths contain `1/2 in R` which I'm not sure will work as you seem to expect. I think it will just throw a `ZeroDivisionError` if 2 is not a unit. You could replace it by `R(2).is_unit()`.

I'll set this ticket's status to needs_work.

Here's a few additional suggestions to make your code more concise by using a few Python gimmicks:

* Instead of

```
E = self.basis()
f = []
for i in range(len(E)):
    f.append(E[i])
```
 for copying a list, you can write

```
f = self.basis()[:]
```
* You could implement a function `T(x,y)` because you use that expression a lot. It makes the code a lot more readable.

* Usually, you shouldn't need to have loops like

```
for i in xrange(len(f)):
    # do something with f[i]
```
   because you can write

```
for f_i in f:
    # do something with f_i
```

* One hard part is the sorting prescribed by
> Otherwise, let (i, j) with 1 ≤ i ≤ j ≤ n be such that ord T(e_i, e_j) is minimal, taking i = j if possible and if not taking i minimal.

 I've found a way to implement that using the builtin `sort`. Namely, this is equivalent to sorting the tuples `(valuation, int(i != j), i)` lexicographically.

I've attached a patch including these comments.



---

archive/issue_comments_160214.json:
```json
{
    "body": "Attachment: **[trac_13654_suggested_code_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket13654/trac_13654_suggested_code_cleanup.patch.gz)**\n\nAttachment: **[normalized_quadratic_form_v2.patch.gz](https://github.com/sagemath/sage/files/ticket13654/normalized_quadratic_form_v2.patch.gz)**",
    "created_at": "2012-11-09T00:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160214",
    "user": "https://github.com/sagetrac-schisholm"
}
```

Attachment: **[trac_13654_suggested_code_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket13654/trac_13654_suggested_code_cleanup.patch.gz)**

Attachment: **[normalized_quadratic_form_v2.patch.gz](https://github.com/sagemath/sage/files/ticket13654/normalized_quadratic_form_v2.patch.gz)**



---

archive/issue_comments_160215.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks so much for sharing your savvy techniques!",
    "created_at": "2012-11-09T00:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160215",
    "user": "https://github.com/sagetrac-schisholm"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks so much for sharing your savvy techniques!



---

archive/issue_comments_160216.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNo problem! :-)\n\nHave you also given some thought about extra doctests to make sure the rest of the code works well? Once you've updated that, you can set the status back to needs_review.",
    "created_at": "2012-11-09T11:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13654#issuecomment-160216",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:4" align="right">comment:4</div>

No problem! :-)

Have you also given some thought about extra doctests to make sure the rest of the code works well? Once you've updated that, you can set the status back to needs_review.



---

archive/issue_events_191890.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191890"
}
```



---

archive/issue_events_191891.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191891"
}
```



---

archive/issue_events_191892.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191892"
}
```



---

archive/issue_events_191893.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191893"
}
```



---

archive/issue_events_191894.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191894"
}
```



---

archive/issue_events_191895.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191895"
}
```



---

archive/issue_events_191896.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191896"
}
```



---

archive/issue_events_191897.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191897"
}
```



---

archive/issue_events_191898.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13654",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13654#event-191898"
}
```
