# Issue 13689: Fix upgrading from relocated Sage with GCC

archive/issues_013485.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3 if GCC was installed and Sage was relocated after building GCC but before upgrading. The problem shows up during the build of LinBox from #12883:\n\n```\nmake[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\n/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o error.lo error.C\n/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o debug.lo debug.C\nlibtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c debug.C  -fPIC -DPIC -o .libs/debug.o\nlibtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c error.C  -fPIC -DPIC -o .libs/error.o\n/bin/bash ../../libtool --tag=CXX   --mode=link g++ -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -o libutil.la  error.lo debug.lo  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro\n/bin/grep: /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory\n/bin/sed: can't read /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory\nlibtool: link: `/home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la' is not a valid libtool archive\nmake[6]: *** [libutil.la] Error 1\nmake[6]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\nmake[5]: *** [all-recursive] Error 1\nmake[5]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\nmake[4]: *** [all-recursive] Error 1\nmake[4]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox'\nmake[3]: *** [all-recursive] Error 1\nmake[3]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'\n```\n\nBlocker because it breaks upgrading from sage-5.3.\n\nCC:  @nexttime\n\nReviewer: **John Palmieri**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.4.1.rc1**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13689_\n\n",
    "closed_at": "2012-11-14T08:30:32Z",
    "created_at": "2012-11-06T21:52:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix upgrading from relocated Sage with GCC",
    "type": "issue",
    "updated_at": "2012-11-14T08:30:32Z",
    "url": "https://github.com/sagemath/sage/issues/13689",
    "user": "https://github.com/jdemeyer"
}
```
Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3 if GCC was installed and Sage was relocated after building GCC but before upgrading. The problem shows up during the build of LinBox from #12883:

```
make[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o error.lo error.C
/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o debug.lo debug.C
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c debug.C  -fPIC -DPIC -o .libs/debug.o
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c error.C  -fPIC -DPIC -o .libs/error.o
/bin/bash ../../libtool --tag=CXX   --mode=link g++ -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -o libutil.la  error.lo debug.lo  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro
/bin/grep: /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory
/bin/sed: can't read /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory
libtool: link: `/home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la' is not a valid libtool archive
make[6]: *** [libutil.la] Error 1
make[6]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
make[5]: *** [all-recursive] Error 1
make[5]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
make[4]: *** [all-recursive] Error 1
make[4]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox'
make[3]: *** [all-recursive] Error 1
make[3]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'
make[2]: *** [all] Error 2
make[2]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'
```

Blocker because it breaks upgrading from sage-5.3.

CC:  @nexttime

Reviewer: **John Palmieri**

Author: **Jeroen Demeyer**

Merged: **sage-5.4.1.rc1**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/13689_





---

archive/issue_events_189853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-06T21:52:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "milestone_number": null,
    "milestone_title": "sage-5.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189853"
}
```



---

archive/issue_events_189854.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-06T21:52:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189854"
}
```



---

archive/issue_events_189855.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-06T21:52:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189855"
}
```



---

archive/issue_events_189856.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-06T21:52:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189856"
}
```



---

archive/issue_events_189857.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-11-06T21:52:58Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189857"
}
```



---

archive/issue_comments_160663.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2012-11-07T16:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160663",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff

``````




---

archive/issue_comments_160664.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,7 @@\n-It seems `sage-location` does not properly fix GCC.  In particular, the output of `gcc -print-search-dirs` (which is used by `libtool` for example) is wrong after relocating Sage.\n-\n-This can give problems in the following scenario:\n-1. install Sage from source, including Sage's GCC\n+It seems the old version of `sage-location` does not properly fix GCC, leading to problems with upgrading in the following scenario:\n+1. install sage-5.3 from source, including Sage's GCC\n 2. relocate Sage\n 3. rebuild PPL\n 4. rebuild LinBox\n \n-The obvious solution is to rebuild GCC when needed.\n-\n-Blocker because it breaks upgrading in certain cases.\n+The `sage-location` in `sage-5.4.1.rc0` does things properly, but that's not sufficient for upgrading.\n``````\n",
    "created_at": "2012-11-07T22:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160664",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,7 @@
-It seems `sage-location` does not properly fix GCC.  In particular, the output of `gcc -print-search-dirs` (which is used by `libtool` for example) is wrong after relocating Sage.
-
-This can give problems in the following scenario:
-1. install Sage from source, including Sage's GCC
+It seems the old version of `sage-location` does not properly fix GCC, leading to problems with upgrading in the following scenario:
+1. install sage-5.3 from source, including Sage's GCC
 2. relocate Sage
 3. rebuild PPL
 4. rebuild LinBox
 
-The obvious solution is to rebuild GCC when needed.
-
-Blocker because it breaks upgrading in certain cases.
+The `sage-location` in `sage-5.4.1.rc0` does things properly, but that's not sufficient for upgrading.
``````




---

archive/issue_events_189858.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-07T22:10:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "title_is": "Fix upgrading from relocated Sage with GCC",
    "title_was": "Rebuild GCC when Sage has been moved",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189858"
}
```



---

archive/issue_comments_160665.json:
```json
{
    "body": "Attachment: **[13689_relocate_gcc.patch.gz](https://github.com/sagemath/sage/files/ticket13689/13689_relocate_gcc.patch.gz)**",
    "created_at": "2012-11-08T13:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160665",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[13689_relocate_gcc.patch.gz](https://github.com/sagemath/sage/files/ticket13689/13689_relocate_gcc.patch.gz)**



---

archive/issue_events_189859.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-09T11:00:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189859"
}
```



---

archive/issue_comments_160666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-It seems the old version of `sage-location` does not properly fix GCC, leading to problems with upgrading in the following scenario:\n+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:\n 1. install sage-5.3 from source, including Sage's GCC\n 2. relocate Sage\n 3. rebuild PPL\n``````\n",
    "created_at": "2012-11-09T11:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160666",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-It seems the old version of `sage-location` does not properly fix GCC, leading to problems with upgrading in the following scenario:
+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:
 1. install sage-5.3 from source, including Sage's GCC
 2. relocate Sage
 3. rebuild PPL
``````




---

archive/issue_comments_160667.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:\n-1. install sage-5.3 from source, including Sage's GCC\n-2. relocate Sage\n+1. install sage <= 5.3 from source, including Sage's GCC\n+2. relocate Sage (using the old `sage-location`)\n 3. rebuild PPL\n 4. rebuild LinBox\n \n-The `sage-location` in `sage-5.4.1.rc0` does things properly, but that's not sufficient for upgrading.\n+Blocker because it potentially breaks upgrading from sage-5.3.\n``````\n",
    "created_at": "2012-11-09T11:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160667",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:
-1. install sage-5.3 from source, including Sage's GCC
-2. relocate Sage
+1. install sage <= 5.3 from source, including Sage's GCC
+2. relocate Sage (using the old `sage-location`)
 3. rebuild PPL
 4. rebuild LinBox
 
-The `sage-location` in `sage-5.4.1.rc0` does things properly, but that's not sufficient for upgrading.
+Blocker because it potentially breaks upgrading from sage-5.3.
``````




---

archive/issue_comments_160668.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI haven't been able to reproduce a problem by following the directions, but I can see that some paths are wrong in `local/lib64/*.la` files, and they're fixed after upgrading from a version of Sage which includes this patch. For `libgfortran.la`, the path for `dependency_libs` is still wrong, but all of the `libdir` paths are okay. Does the wrong path for `dependency_libs` actually matter?",
    "created_at": "2012-11-10T19:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160668",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

I haven't been able to reproduce a problem by following the directions, but I can see that some paths are wrong in `local/lib64/*.la` files, and they're fixed after upgrading from a version of Sage which includes this patch. For `libgfortran.la`, the path for `dependency_libs` is still wrong, but all of the `libdir` paths are okay. Does the wrong path for `dependency_libs` actually matter?



---

archive/issue_comments_160669.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jhpalmieri](#comment%3A7):\n> I haven't been able to reproduce a problem by following the directions\n\nWhich exact version of Sage did you try?\n\n> Does the wrong path for `dependency_libs` actually matter?\n\nNot sure.  The main point is that this patch makes upgrading work.",
    "created_at": "2012-11-11T09:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160669",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jhpalmieri](#comment%3A7):
> I haven't been able to reproduce a problem by following the directions

Which exact version of Sage did you try?

> Does the wrong path for `dependency_libs` actually matter?

Not sure.  The main point is that this patch makes upgrading work.



---

archive/issue_comments_160670.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAlso: with #13452 and #13407, all paths would be fixed at least *after* the build.",
    "created_at": "2012-11-11T09:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160670",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Also: with #13452 and #13407, all paths would be fixed at least *after* the build.



---

archive/issue_comments_160671.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment%3A8):\n> Replying to [@jhpalmieri](#comment%3A7):\n> > I haven't been able to reproduce a problem by following the directions\n\n> Which exact version of Sage did you try?\n\nI built Sage 5.3 from scratch, moved the build directory, did `./sage -f spkg/standard/ppl-...` and `./sage -f spkg/standard/linbox-...`. No obvious errors. I also tried doing `./sage -upgrade ...`, upgrading from 5.4-rc4. This was all on sage.math.\n\n> Also: with #13452 and #13407, all paths would be fixed at least after the build.\n\nI'm not sure about that. When you upgrade, the old sage-location script is run so sage-current-location.txt is changed but a few paths aren't, so how can those old paths ever be fixed?",
    "created_at": "2012-11-11T16:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160671",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment%3A8):
> Replying to [@jhpalmieri](#comment%3A7):
> > I haven't been able to reproduce a problem by following the directions

> Which exact version of Sage did you try?

I built Sage 5.3 from scratch, moved the build directory, did `./sage -f spkg/standard/ppl-...` and `./sage -f spkg/standard/linbox-...`. No obvious errors. I also tried doing `./sage -upgrade ...`, upgrading from 5.4-rc4. This was all on sage.math.

> Also: with #13452 and #13407, all paths would be fixed at least after the build.

I'm not sure about that. When you upgrade, the old sage-location script is run so sage-current-location.txt is changed but a few paths aren't, so how can those old paths ever be fixed?



---

archive/issue_comments_160672.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,25 @@\n-Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:\n-1. install sage <= 5.3 from source, including Sage's GCC\n-2. relocate Sage (using the old `sage-location`)\n-3. rebuild PPL\n-4. rebuild LinBox\n+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3, during the build of LinBox from #12883:\n \n-Blocker because it potentially breaks upgrading from sage-5.3.\n+```\n+make[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\n+/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o error.lo error.C\n+/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o debug.lo debug.C\n+libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c debug.C  -fPIC -DPIC -o .libs/debug.o\n+libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c error.C  -fPIC -DPIC -o .libs/error.o\n+/bin/bash ../../libtool --tag=CXX   --mode=link g++ -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -o libutil.la  error.lo debug.lo  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro\n+/bin/grep: /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory\n+/bin/sed: can't read /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory\n+libtool: link: `/home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la' is not a valid libtool archive\n+make[6]: *** [libutil.la] Error 1\n+make[6]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\n+make[5]: *** [all-recursive] Error 1\n+make[5]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\n+make[4]: *** [all-recursive] Error 1\n+make[4]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox'\n+make[3]: *** [all-recursive] Error 1\n+make[3]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'\n+make[2]: *** [all] Error 2\n+make[2]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'\n+```\n+\n+Blocker because it breaks upgrading from sage-5.3.\n``````\n",
    "created_at": "2012-11-12T07:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160672",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,25 @@
-Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading in the following scenario:
-1. install sage <= 5.3 from source, including Sage's GCC
-2. relocate Sage (using the old `sage-location`)
-3. rebuild PPL
-4. rebuild LinBox
+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3, during the build of LinBox from #12883:
 
-Blocker because it potentially breaks upgrading from sage-5.3.
+```
+make[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
+/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o error.lo error.C
+/bin/bash ../../libtool --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -c -o debug.lo debug.C
+libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c debug.C  -fPIC -DPIC -o .libs/debug.o
+libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../../linbox -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -DDISABLE_COMMENTATOR -O2 -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include -g -fPIC -c error.C  -fPIC -DPIC -o .libs/error.o
+/bin/bash ../../libtool --tag=CXX   --mode=link g++ -O2    -g -DNDEBUG -U_LB_DEBUG -I/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/include  -g -fPIC -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lcblas -latlas -o libutil.la  error.lo debug.lo  -L/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/local/lib -lgivaro
+/bin/grep: /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory
+/bin/sed: can't read /home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la: No such file or directory
+libtool: link: `/home/buildbot/sage-5.3/local/lib/../lib64/libstdc++.la' is not a valid libtool archive
+make[6]: *** [libutil.la] Error 1
+make[6]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
+make[5]: *** [all-recursive] Error 1
+make[5]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
+make[4]: *** [all-recursive] Error 1
+make[4]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox'
+make[3]: *** [all-recursive] Error 1
+make[3]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'
+make[2]: *** [all] Error 2
+make[2]: Leaving directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src'
+```
+
+Blocker because it breaks upgrading from sage-5.3.
``````




---

archive/issue_comments_160673.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3, during the build of LinBox from #12883:\n+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3 if GCC was installed and Sage was relocated after building GCC but before upgrading. The problem shows up during the build of LinBox from #12883:\n \n ```\n make[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'\n``````\n",
    "created_at": "2012-11-12T07:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160673",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3, during the build of LinBox from #12883:
+Older versions of `sage-location` (before #13397) do not properly fix GCC, leading to problems with upgrading from sage-5.3 if GCC was installed and Sage was relocated after building GCC but before upgrading. The problem shows up during the build of LinBox from #12883:
 
 ```
 make[6]: Entering directory `/release/buildbot/sage/sage-1/sage_upgrade_5.3/build/sage-5.4.1.rc0/spkg/build/linbox-1.3.2/src/linbox/util'
``````




---

archive/issue_comments_160674.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jhpalmieri](#comment%3A10):\n> I'm not sure about that. When you upgrade, the old sage-location script is run so sage-current-location.txt is changed but a few paths aren't, so how can those old paths ever be fixed?\n\nBecause I changed `sage-location` in #13407 to always relocate after the build is finished, even if no paths have changed.",
    "created_at": "2012-11-12T07:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160674",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jhpalmieri](#comment%3A10):
> I'm not sure about that. When you upgrade, the old sage-location script is run so sage-current-location.txt is changed but a few paths aren't, so how can those old paths ever be fixed?

Because I changed `sage-location` in #13407 to always relocate after the build is finished, even if no paths have changed.



---

archive/issue_comments_160675.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2012-11-12T17:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160675",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_189860.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-11-12T17:26:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189860"
}
```



---

archive/issue_events_189861.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-11-12T17:26:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189861"
}
```



---

archive/issue_comments_160676.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI guess I don't see anything which changes the `dependency_libs` path, before or after #13407. But that's not new to this ticket, so we won't worry about it.\n\nThe patch does fix upgrading, though, at least on sage.math. (At first I didn't see the problem because I built Sage 5.3, then *copied* the installation elsewhere, so the hard-coded path referred to a still-existing file. When I moved the installation instead, upgrading failed unless I upgraded from a copy of 5.4.rc4 with this patch applied.)",
    "created_at": "2012-11-12T17:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160676",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

I guess I don't see anything which changes the `dependency_libs` path, before or after #13407. But that's not new to this ticket, so we won't worry about it.

The patch does fix upgrading, though, at least on sage.math. (At first I didn't see the problem because I built Sage 5.3, then *copied* the installation elsewhere, so the hard-coded path referred to a still-existing file. When I moved the installation instead, upgrading failed unless I upgraded from a copy of 5.4.rc4 with this patch applied.)



---

archive/issue_comments_160677.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jhpalmieri](#comment%3A13):\n> I guess I don't see anything which changes the `dependency_libs` path, before or after #13407.\n\n`sage-location` doesn't specifically change `dependency_libs`, it changes the `.la` file as a whole.",
    "created_at": "2012-11-12T21:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160677",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jhpalmieri](#comment%3A13):
> I guess I don't see anything which changes the `dependency_libs` path, before or after #13407.

`sage-location` doesn't specifically change `dependency_libs`, it changes the `.la` file as a whole.



---

archive/issue_comments_160678.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIf you build sage 5.3, then move the installation, then upgrade, then dependency_libs is not fixed. The reason is that files in lib64 aren't touched by the old version of sage-location, just spkg/install, and spkg/install only fixes libdir. Then later, when sage-location is run, it looks for the path in libdir, then changes other paths in that file to match them. But once the path for dependency_libs is not in SAGE_ROOT and is not related to the path for libdir, sage-location can't fix that path.\n\nIn practice, I applied the patches here, #13407, and #13452, to sage-5.4.rc4, built a copy of sage 5.3, moved it, and upgraded it from the patched 5.4.rc4. The path for dependency_libs was not fixed.",
    "created_at": "2012-11-12T23:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160678",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

If you build sage 5.3, then move the installation, then upgrade, then dependency_libs is not fixed. The reason is that files in lib64 aren't touched by the old version of sage-location, just spkg/install, and spkg/install only fixes libdir. Then later, when sage-location is run, it looks for the path in libdir, then changes other paths in that file to match them. But once the path for dependency_libs is not in SAGE_ROOT and is not related to the path for libdir, sage-location can't fix that path.

In practice, I applied the patches here, #13407, and #13452, to sage-5.4.rc4, built a copy of sage 5.3, moved it, and upgraded it from the patched 5.4.rc4. The path for dependency_libs was not fixed.



---

archive/issue_comments_160679.json:
```json
{
    "body": "Merged: **sage-5.4.1.rc1**",
    "created_at": "2012-11-14T08:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13689#issuecomment-160679",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.4.1.rc1**



---

archive/issue_events_189862.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-14T08:30:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189862"
}
```



---

archive/issue_events_189863.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-14T08:30:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13689",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13689#event-189863"
}
```
