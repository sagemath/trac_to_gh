# Issue 13077: generalised Tamari lattices

archive/issues_012905.json:
```json
{
    "body": "The Tamari lattice is a partial order on planar binary trees or Dyck paths.\n\n(see [Tamari Lattice](http://en.wikipedia.org/wiki/Tamari_lattice) in Wikipedia)\n\nIt has been generalized recently by F. Bergeron and his collaborators.\n\nThe patch below implements these lattices, and even more general versions.\n\napply trac_13077_tamari_posets-fc.patch\n\nAssignee: sage-combinat\n\nCC:  stumpc5\n\nKeywords: poset\n\nReviewer: Christian Stump, Hugh Thomas\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nMerged: sage-5.7.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13077\n\n",
    "closed_at": "2013-01-30T07:33:55Z",
    "created_at": "2012-06-01T15:54:54Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "generalised Tamari lattices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13077",
    "user": "https://github.com/fchapoton"
}
```
The Tamari lattice is a partial order on planar binary trees or Dyck paths.

(see [Tamari Lattice](http://en.wikipedia.org/wiki/Tamari_lattice) in Wikipedia)

It has been generalized recently by F. Bergeron and his collaborators.

The patch below implements these lattices, and even more general versions.

apply trac_13077_tamari_posets-fc.patch

Assignee: sage-combinat

CC:  stumpc5

Keywords: poset

Reviewer: Christian Stump, Hugh Thomas

Author: Frédéric Chapoton

Merged: sage-5.7.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13077





---

archive/issue_comments_155154.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-02T12:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155154",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_035921.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T08:03:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "milestone": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35921"
}
```



---

archive/issue_comments_155155.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2012-07-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155155",
    "user": "https://github.com/fchapoton"
}
```

Changing priority from major to minor.



---

archive/issue_events_035922.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-16T18:33:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "milestone": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35922"
}
```



---

archive/issue_events_035923.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-16T18:33:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35923"
}
```



---

archive/issue_comments_155156.json:
```json
{
    "body": "<a id='comment:7'></a>Salut Fr\u00e9d\u00e9ric--\n\nA couple of thoughts.  Maybe paths_in_triangle should take a parameter \"slope\" instead of a,b?  Alternatively, I think the code should check that (i,j) is actually in the rectangle between (0,0) and (a,b).  \n\nIn the definition of \"swap\", the code as written requires m to be an integer, but why do it like that?  For arbitrary relatively prime a,b, I think a/b is a natural choice of parameter.  This matches the \"rational Catalan combinatorics\" (see the two sets of Rational Catalan Combinatorics slides at Drew Armstrong's website http://www.math.miami.edu/~armstrong/research.html).  One downside to the further generality is that I don't know whether or not it's a lattice.  But I don't think that's really an argument against implementing it.  Maybe an appropriate analogue of Bousquet-M\u00e9lou--Fusy--Pr\u00e9ville-Ratelle, arXiv:1106.1498, Proposition 4 holds?  But a glance, it wasn't obvious to me that it would.  \n\nI also think it would be good to include a reference for the generalized Tamari lattice in the documentation (and/or a more complete definition).\n\ncheers,\n\nHugh",
    "created_at": "2012-11-11T03:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155156",
    "user": "https://github.com/hughrthomas"
}
```

<a id='comment:7'></a>Salut Frédéric--

A couple of thoughts.  Maybe paths_in_triangle should take a parameter "slope" instead of a,b?  Alternatively, I think the code should check that (i,j) is actually in the rectangle between (0,0) and (a,b).  

In the definition of "swap", the code as written requires m to be an integer, but why do it like that?  For arbitrary relatively prime a,b, I think a/b is a natural choice of parameter.  This matches the "rational Catalan combinatorics" (see the two sets of Rational Catalan Combinatorics slides at Drew Armstrong's website http://www.math.miami.edu/~armstrong/research.html).  One downside to the further generality is that I don't know whether or not it's a lattice.  But I don't think that's really an argument against implementing it.  Maybe an appropriate analogue of Bousquet-Mélou--Fusy--Préville-Ratelle, arXiv:1106.1498, Proposition 4 holds?  But a glance, it wasn't obvious to me that it would.  

I also think it would be good to include a reference for the generalized Tamari lattice in the documentation (and/or a more complete definition).

cheers,

Hugh



---

archive/issue_comments_155157.json:
```json
{
    "body": "<a id='comment:8'></a>Hello Hugh,\n\nthanks for having a look at that.\n\nI have added a few tests in the new version of the patch. In particular, one checks that (i,j) is in the correct half-rectangle.\n\nIn these lattices, m is really another independant parameter, having nothing to do with a/b. It would not make sense here to make m a rational number. Morally, m is the quotient of the lengths of vertical and horizontal steps, which defines a hidden notion of diagonal, which is used in \"swap\" to define the coverings.\n\nI understand that I would be much better if these lattices are described somewhere. So far, they do not appear in print.\n\nDo you think it is neccessary to explain in the patch why they are indeed lattices ?",
    "created_at": "2012-11-12T13:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155157",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Hello Hugh,

thanks for having a look at that.

I have added a few tests in the new version of the patch. In particular, one checks that (i,j) is in the correct half-rectangle.

In these lattices, m is really another independant parameter, having nothing to do with a/b. It would not make sense here to make m a rational number. Morally, m is the quotient of the lengths of vertical and horizontal steps, which defines a hidden notion of diagonal, which is used in "swap" to define the coverings.

I understand that I would be much better if these lattices are described somewhere. So far, they do not appear in print.

Do you think it is neccessary to explain in the patch why they are indeed lattices ?



---

archive/issue_comments_155158.json:
```json
{
    "body": "<a id='comment:9'></a>Salut Fr\u00e9d\u00e9ric--\n\nOn the contrary, I think it does make sense to have m be rational (independent of a and b), not just integral.  But, fine, that can be a discussion for another time (or another ticket).  \n\nI think the patch should include some mathematical reference.  Maybe the paper I mentioned above by Bousquet-M\u00e9lou--Fusy--Pr\u00e9ville-Ratelle.  That shows the m-Tamari poset is a lattice, and it's not very far from that to the general (a,b) case, right? (Since the (a,b,m) case occurs as an interval in the m-Tamari.)  I don't think it's necessary to include a reference for every relevant mathematical fact, of course, but I think it could be helpful for someone who stumbles across this code to be able to find some further information and context.  \n\nSpeaking of which, I'm wondering how a user is supposed to find this code.  (I guess this is a perennial problem with Sage.)  I suppose a user can always search the manual (or the code).  I wish there was some alternative that would make it slightly easier to find things.  Do you have any idea?  Is there somewhere in the posets documentation that lists implemented posets?  This seems like something which it might be worthwhile to have.  \n\nI'm a bit surprised about the way \"swap\" reacts if it is given a legal string, and a position within the string, at which it is not possible to do a swap (namely: return the same string as the answer).  To me, it seems natural to raise an error.  If you like it better not to do so, though, I think that behaviour should be documented.  \n\ncheers,\n\nHugh",
    "created_at": "2012-11-13T06:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155158",
    "user": "https://github.com/hughrthomas"
}
```

<a id='comment:9'></a>Salut Frédéric--

On the contrary, I think it does make sense to have m be rational (independent of a and b), not just integral.  But, fine, that can be a discussion for another time (or another ticket).  

I think the patch should include some mathematical reference.  Maybe the paper I mentioned above by Bousquet-Mélou--Fusy--Préville-Ratelle.  That shows the m-Tamari poset is a lattice, and it's not very far from that to the general (a,b) case, right? (Since the (a,b,m) case occurs as an interval in the m-Tamari.)  I don't think it's necessary to include a reference for every relevant mathematical fact, of course, but I think it could be helpful for someone who stumbles across this code to be able to find some further information and context.  

Speaking of which, I'm wondering how a user is supposed to find this code.  (I guess this is a perennial problem with Sage.)  I suppose a user can always search the manual (or the code).  I wish there was some alternative that would make it slightly easier to find things.  Do you have any idea?  Is there somewhere in the posets documentation that lists implemented posets?  This seems like something which it might be worthwhile to have.  

I'm a bit surprised about the way "swap" reacts if it is given a legal string, and a position within the string, at which it is not possible to do a swap (namely: return the same string as the answer).  To me, it seems natural to raise an error.  If you like it better not to do so, though, I think that behaviour should be documented.  

cheers,

Hugh



---

archive/issue_comments_155159.json:
```json
{
    "body": "<a id='comment:10'></a>Here is a new patch\n\n- I have added the reference to BMFPR\n\n- I have changed the behaviour of swap, now raising an error when no move is possible\n\n- I have added a link to wikipedia article on Tamari lattice\n\nFred",
    "created_at": "2012-11-13T20:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155159",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Here is a new patch

- I have added the reference to BMFPR

- I have changed the behaviour of swap, now raising an error when no move is possible

- I have added a link to wikipedia article on Tamari lattice

Fred



---

archive/issue_comments_155160.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 chapoton]:\n\nHi Fred,\n\nI attached a review patch containing several improvements (hopefully) for the doc strings. Beside that, I think the patch is ready to go. I though have two remaining questions:\n\n- I think you should mention that the generalised Tamari lattice is only conjectured to be a lattice (there is at least no publicly available source of a proof).\n\n- You are mixing British English (\"nonnegative\") and American English (\"generalised\"): I think it would be nice to make this consistent, and to actually check if \"generalised/generalized\" is already used in other placed in Sage to keep consistency here.\n\nCheers, Christian",
    "created_at": "2013-01-23T10:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155160",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:12'></a>Replying to [comment:11 chapoton]:

Hi Fred,

I attached a review patch containing several improvements (hopefully) for the doc strings. Beside that, I think the patch is ready to go. I though have two remaining questions:

- I think you should mention that the generalised Tamari lattice is only conjectured to be a lattice (there is at least no publicly available source of a proof).

- You are mixing British English ("nonnegative") and American English ("generalised"): I think it would be nice to make this consistent, and to actually check if "generalised/generalized" is already used in other placed in Sage to keep consistency here.

Cheers, Christian



---

archive/issue_comments_155161.json:
```json
{
    "body": "Attachment [trac_13077_tamari_posets-fc.patch](tarball://root/attachments/some-uuid/ticket13077/trac_13077_tamari_posets-fc.patch) by @fchapoton created at 2013-01-23 11:40:26",
    "created_at": "2013-01-23T11:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155161",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_13077_tamari_posets-fc.patch](tarball://root/attachments/some-uuid/ticket13077/trac_13077_tamari_posets-fc.patch) by @fchapoton created at 2013-01-23 11:40:26



---

archive/issue_comments_155162.json:
```json
{
    "body": "<a id='comment:13'></a>I have replaced generalised by generalized\n\nI have added a note on the conjectural status of lattice property\n\napply trac_13077_tamari_posets-fc.patch",
    "created_at": "2013-01-23T11:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155162",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>I have replaced generalised by generalized

I have added a note on the conjectural status of lattice property

apply trac_13077_tamari_posets-fc.patch



---

archive/issue_comments_155163.json:
```json
{
    "body": "<a id='comment:14'></a>Hi Fr\u00e9d\u00e9ric and Christian--\n\nSorry not to have got around to finishing refereeing this, and I'm glad Christian has instead.  \n\nChristian, these (a,b,m) lattices are clearly intervals inside the m-Tamari.  So they are lattices.  For that reason I wouldn't say that the lattice property is conjectural, and I'm happy with what Fr\u00e9d\u00e9ric wrote originally.  (But I don't mean to delay a positive review over this.)\n\ncheers,\n\nHugh",
    "created_at": "2013-01-23T13:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155163",
    "user": "https://github.com/hughrthomas"
}
```

<a id='comment:14'></a>Hi Frédéric and Christian--

Sorry not to have got around to finishing refereeing this, and I'm glad Christian has instead.  

Christian, these (a,b,m) lattices are clearly intervals inside the m-Tamari.  So they are lattices.  For that reason I wouldn't say that the lattice property is conjectural, and I'm happy with what Frédéric wrote originally.  (But I don't mean to delay a positive review over this.)

cheers,

Hugh



---

archive/issue_comments_155164.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-23T14:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155164",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_035924.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-23T15:46:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35924"
}
```



---

archive/issue_events_035925.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-23T15:46:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35925"
}
```



---

archive/issue_comments_155165.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-30T07:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13077#issuecomment-155165",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_035926.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-30T07:33:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13077",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13077#event-35926"
}
```
