# Issue 13723: Moving hamming_weight from sage.coding to sage.modules

archive/issues_013519.json:
```json
{
    "body": "Hamming weights are defined in sage.coding.linear_codes for vectors. This is the wrong place, since we can not use the implementation specific structure of a vector, for example in the binary case.\n\nThis patch adds a function hamming_weight to the class sage.modules.free_module_element.FreeModuleElement and deprecates  sage.coding.linear_codes.hamming_weight.\n\n---\nApply only: trac_13723-hamming_weight.patch\n\n**Assignee:** @wdjoyner\n\n**Keywords:** Hamming weight, coding theory\n\n**Reviewer:** Punarbasu Purkayastha, Travis Scrimshaw\n\n**Author:** Thomas Feulner\n\n**Merged:** sage-5.6.beta0\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13723\n\n",
    "closed_at": "2012-12-18T11:15:09Z",
    "created_at": "2012-11-19T14:21:22Z",
    "labels": [
        "component: coding theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Moving hamming_weight from sage.coding to sage.modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13723",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```
Hamming weights are defined in sage.coding.linear_codes for vectors. This is the wrong place, since we can not use the implementation specific structure of a vector, for example in the binary case.

This patch adds a function hamming_weight to the class sage.modules.free_module_element.FreeModuleElement and deprecates  sage.coding.linear_codes.hamming_weight.

---
Apply only: trac_13723-hamming_weight.patch

**Assignee:** @wdjoyner

**Keywords:** Hamming weight, coding theory

**Reviewer:** Punarbasu Purkayastha, Travis Scrimshaw

**Author:** Thomas Feulner

**Merged:** sage-5.6.beta0

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/13723





---

archive/issue_comments_213092.json:
```json
{
    "body": "<a id='comment:1'></a>\nYou need to deprecate the top level function (which you have already done) and not remove it entirely. The removal can happen after the deprecation period is over (typically 1 year).\n\nAnyway, the question is whether it should be deprecated. There is nothing wrong with having it both as `v.hamming_weight()` and as a global function `hamming_weight(v)`. In the latter case, you could modify the function to use the attribute if it is available:\n\n```python\ndef hamming_weight(v): # the function in sage/coding/\n    try:\n        return v.hamming_weight()\n    except AttributeError:\n        # the old code comes here\n```",
    "created_at": "2012-11-19T16:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213092",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:1'></a>
You need to deprecate the top level function (which you have already done) and not remove it entirely. The removal can happen after the deprecation period is over (typically 1 year).

Anyway, the question is whether it should be deprecated. There is nothing wrong with having it both as `v.hamming_weight()` and as a global function `hamming_weight(v)`. In the latter case, you could modify the function to use the attribute if it is available:

```python
def hamming_weight(v): # the function in sage/coding/
    try:
        return v.hamming_weight()
    except AttributeError:
        # the old code comes here
```



---

archive/issue_comments_213093.json:
```json
{
    "body": "<a id='comment:2'></a>\nIn my opinion, we should deprecate the function hamming_weight() in sage/coding/. Why should we have a global function in an object oriented language as Python is? In my experience as a new developer, this is one of the main problems of Sage that you have several functions doing the same... The same is true for some user who shouldn`t be forced to have a look into the source code to decide which function he/she should use.\n\nFinally, the docstring tells us that ``v`` has to be a vector, so the old code will only work in those cases which are catched by the new patch so I guess that we will only catch an `AttributeError` which we will produce in the following 'old code`.",
    "created_at": "2012-11-20T07:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213093",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:2'></a>
In my opinion, we should deprecate the function hamming_weight() in sage/coding/. Why should we have a global function in an object oriented language as Python is? In my experience as a new developer, this is one of the main problems of Sage that you have several functions doing the same... The same is true for some user who shouldn`t be forced to have a look into the source code to decide which function he/she should use.

Finally, the docstring tells us that ``v`` has to be a vector, so the old code will only work in those cases which are catched by the new patch so I guess that we will only catch an `AttributeError` which we will produce in the following 'old code`.



---

archive/issue_comments_213094.json:
```json
{
    "body": "<a id='comment:3'></a>\nOk. I missed the fact that you haven't removed it from global scope.\n\nThere are three comments I have about the patch (sorry for nitpicking :)):\n1. It is missing the hg headers containing your name and other information. Maybe you don't have a hgrc? Also, the patch should have the ticket number in its name (like `trac_13723-hamming_weight.patch` or `13273-hamming_weight.patch`). If I am not mistaken Jeroen has some script which parses the patch name to get the ticket number. Since you have already made this patch, you can simply rename it using hg like\n\n```\n$ cd <sage_root>/devel/sage\n$ hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch\n-- OR if you don't have hg installed in your system --\n$ sage -hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch\n```\n2. In the example in `vector_mod2_dense.pyx` file, the answer should be 2.\n3. Can you fix the `type(v) == list` statements with `isinstance(v, list)`? It is not your mistake, but it would be nice to have them fixed.\n\nOtherwise the patch looks fine to me.",
    "created_at": "2012-11-20T08:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213094",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:3'></a>
Ok. I missed the fact that you haven't removed it from global scope.

There are three comments I have about the patch (sorry for nitpicking :)):
1. It is missing the hg headers containing your name and other information. Maybe you don't have a hgrc? Also, the patch should have the ticket number in its name (like `trac_13723-hamming_weight.patch` or `13273-hamming_weight.patch`). If I am not mistaken Jeroen has some script which parses the patch name to get the ticket number. Since you have already made this patch, you can simply rename it using hg like

```
$ cd <sage_root>/devel/sage
$ hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch
-- OR if you don't have hg installed in your system --
$ sage -hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch
```
2. In the example in `vector_mod2_dense.pyx` file, the answer should be 2.
3. Can you fix the `type(v) == list` statements with `isinstance(v, list)`? It is not your mistake, but it would be nice to have them fixed.

Otherwise the patch looks fine to me.



---

archive/issue_comments_213095.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n Hamming weights are defined in sage.coding.linear_codes for vectors. This is the wrong place, since we can not use the implementation specific structure of a vector, for example in the binary case.\n \n This patch adds a function hamming_weight to the class sage.modules.free_module_element.FreeModuleElement and deprecates  sage.coding.linear_codes.hamming_weight.\n+\n+---\n+Apply only: trac_13723-hamming_weight.patch\n``````\n",
    "created_at": "2012-11-20T10:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213095",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 Hamming weights are defined in sage.coding.linear_codes for vectors. This is the wrong place, since we can not use the implementation specific structure of a vector, for example in the binary case.
 
 This patch adds a function hamming_weight to the class sage.modules.free_module_element.FreeModuleElement and deprecates  sage.coding.linear_codes.hamming_weight.
+
+---
+Apply only: trac_13723-hamming_weight.patch
``````




---

archive/issue_comments_213096.json:
```json
{
    "body": "**Author:** Thomas Feulner",
    "created_at": "2012-11-20T10:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213096",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

**Author:** Thomas Feulner



---

archive/issue_comments_213097.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-11-20T10:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213097",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_213098.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [ppurka](#comment%3A3):\n> Ok. I missed the fact that you haven't removed it from global scope.\n> \n> There are three comments I have about the patch (sorry for nitpicking :)):\n\nIt is ok, I learned a lot from those comments.\n> 1. It is missing the hg headers containing your name and other information. Maybe you don't have a hgrc? Also, the patch should have the ticket number in its name (like `trac_13723-hamming_weight.patch` or `13273-hamming_weight.patch`). If I am not mistaken Jeroen has some script which parses the patch name to get the ticket number. Since you have already made this patch, you can simply rename it using hg like\n> \n> ```\n> $ cd <sage_root>/devel/sage\n> $ hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch\n> -- OR if you don't have hg installed in your system --\n> $ sage -hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch\n> ```\n\nI think it contains all the information now, I worked with hg_sage and for some reason this information was not added.\n> 2. In the example in `vector_mod2_dense.pyx` file, the answer should be 2.\n  \nOf course, thanks.\n> 3. Can you fix the `type(v) == list` statements with `isinstance(v, list)`? It is not your mistake, but it would be nice to have them fixed.\n  \nDone.\n> \n> Otherwise the patch looks fine to me.\n\nThanks again, are there other comments?",
    "created_at": "2012-11-20T10:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213098",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:5'></a>
Replying to [ppurka](#comment%3A3):
> Ok. I missed the fact that you haven't removed it from global scope.
> 
> There are three comments I have about the patch (sorry for nitpicking :)):

It is ok, I learned a lot from those comments.
> 1. It is missing the hg headers containing your name and other information. Maybe you don't have a hgrc? Also, the patch should have the ticket number in its name (like `trac_13723-hamming_weight.patch` or `13273-hamming_weight.patch`). If I am not mistaken Jeroen has some script which parses the patch name to get the ticket number. Since you have already made this patch, you can simply rename it using hg like
> 
> ```
> $ cd <sage_root>/devel/sage
> $ hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch
> -- OR if you don't have hg installed in your system --
> $ sage -hg qmv hamming_weight_simplex_code.patch trac_13723-hamming_weight.patch
> ```

I think it contains all the information now, I worked with hg_sage and for some reason this information was not added.
> 2. In the example in `vector_mod2_dense.pyx` file, the answer should be 2.
  
Of course, thanks.
> 3. Can you fix the `type(v) == list` statements with `isinstance(v, list)`? It is not your mistake, but it would be nice to have them fixed.
  
Done.
> 
> Otherwise the patch looks fine to me.

Thanks again, are there other comments?



---

archive/issue_comments_213099.json:
```json
{
    "body": "<a id='comment:6'></a>\nPatchbot: apply trac_13723-hamming_weight.patch",
    "created_at": "2012-11-20T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213099",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:6'></a>
Patchbot: apply trac_13723-hamming_weight.patch



---

archive/issue_comments_213100.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-11-20T12:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213100",
    "user": "https://github.com/ppurka"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_213101.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good to me, though I am not particularly fond of using \"self\" in documentation. Anyway, positive review from my side. Everything seems to work here.",
    "created_at": "2012-11-20T12:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213101",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:7'></a>
Looks good to me, though I am not particularly fond of using "self" in documentation. Anyway, positive review from my side. Everything seems to work here.



---

archive/issue_events_044583.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tfeulner",
    "created_at": "2012-11-20T14:02:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13723#event-44583"
}
```



---

archive/issue_comments_213102.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2012-11-24T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213102",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_213103.json:
```json
{
    "body": "**Reviewer:** Punarbasu Purkayastha",
    "created_at": "2012-11-24T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213103",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Punarbasu Purkayastha



---

archive/issue_comments_213104.json:
```json
{
    "body": "<a id='comment:9'></a>\nSorry but it's my turn to be nitpicking. There's some documentation things I would like to see addressed:\n\n- It should be <code>:trac:`13723`</code>, the `#` is added automatically and as you have it written, the link is incorrect as it includes the `#`.\n- I prefer to see everything set it code format/linked as much as possible:\n  - In the authors section: <code>Added :meth:`CLASSNAME.hamming_weight`</code> or <code>Added ``hamming_weight()``</code>\n  - Change all appropriate lines:\n\n  ```\n  Return the number of positions ``i`` such that ``self[i] != 0``.\n  ```\n- I don't like the deprecation message. Perhaps something like\n\n```\nThe global function hamming_weight(v) is deprecated, instead use v.hamming_weight().\n```\n\nThanks,\n\nTravis",
    "created_at": "2012-11-24T21:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213104",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Sorry but it's my turn to be nitpicking. There's some documentation things I would like to see addressed:

- It should be <code>:trac:`13723`</code>, the `#` is added automatically and as you have it written, the link is incorrect as it includes the `#`.
- I prefer to see everything set it code format/linked as much as possible:
  - In the authors section: <code>Added :meth:`CLASSNAME.hamming_weight`</code> or <code>Added ``hamming_weight()``</code>
  - Change all appropriate lines:

  ```
  Return the number of positions ``i`` such that ``self[i] != 0``.
  ```
- I don't like the deprecation message. Perhaps something like

```
The global function hamming_weight(v) is deprecated, instead use v.hamming_weight().
```

Thanks,

Travis



---

archive/attachments_018563.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_13723-hamming_weight.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket13723/trac_13723-hamming_weight.patch",
    "created_at": "2012-11-26T08:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```



---

archive/issue_comments_213105.json:
```json
{
    "body": "",
    "created_at": "2012-11-26T08:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213105",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```





---

archive/issue_comments_213106.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [tscrim](#comment%3A9):\n\nOk, done. Thanks for your help.\n\nThomas",
    "created_at": "2012-11-26T08:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213106",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

<a id='comment:10'></a>
Replying to [tscrim](#comment%3A9):

Ok, done. Thanks for your help.

Thomas



---

archive/issue_comments_213107.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-11-26T08:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213107",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_044584.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2012-11-27T19:03:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13723#event-44584"
}
```



---

archive/issue_events_044585.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2012-11-27T19:03:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "milestone": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13723#event-44585"
}
```



---

archive/issue_comments_213108.json:
```json
{
    "body": "**Changing reviewer** from \"Punarbasu Purkayastha\" to \"Punarbasu Purkayastha, Travis Scrimshaw\".",
    "created_at": "2012-11-27T19:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213108",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Punarbasu Purkayastha" to "Punarbasu Purkayastha, Travis Scrimshaw".



---

archive/issue_comments_213109.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-11-27T19:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213109",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_213110.json:
```json
{
    "body": "<a id='comment:11'></a>\nLooks good to me.",
    "created_at": "2012-11-27T19:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213110",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Looks good to me.



---

archive/issue_comments_213111.json:
```json
{
    "body": "**Merged:** sage-5.6.beta0",
    "created_at": "2012-12-18T11:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213111",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.6.beta0



---

archive/issue_events_044586.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-18T11:15:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13723#event-44586"
}
```



---

archive/issue_comments_213112.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-12-18T11:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13723#issuecomment-213112",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed
