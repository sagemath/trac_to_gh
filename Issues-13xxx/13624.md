# Issue 13624: KeyError raised by GraphLatex.dot2tex_picture when edge_labels=True

archive/issues_013420.json:
```json
{
    "assignees": [],
    "body": "The following is ok :\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(3333, 88, 'my_label')\nsage: G.set_latex_options(format='dot2tex')\nsage: view(G)\n```\n\nbut with `edges_labels=True` a KeyError is raised :\n\n```\nsage: G.set_latex_options(edge_labels=True)\nsage: view(G)\nERROR    Failed to process input\nTraceback (most recent call last):\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n    s =  conv.convert(dotdata)\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n    return self.do_preview_preproc()\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n    hp,dp,wt = pp.texdims[name]\nKeyError: '3333880'\n```\n\nThe error is also raised by `dot2tex_picture` method:\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(0, 1, 'p0')\nsage: G.latex_options().dot2tex_picture()\n'\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n.dot2tex_picture()\nsage: G.set_latex_options(edge_labels=True)\nsage: G.latex_options().dot2tex_picture()\nERROR    Failed to process input\nTraceback (most recent call last):\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n    s =  conv.convert(dotdata)\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n    return self.do_preview_preproc()\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n    hp,dp,wt = pp.texdims[name]\nKeyError: '010'\n''\n```\n\nThis is due to dot2tex currently not supporting '\\verb' properly. \n\nThe attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like `^` and `_`.\n\nCC:  @stumpc5 @nathanncohen\n\nKeywords: **dot2tex, graph drawing**\n\nBranch/Commit: **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**\n\nReviewer: **Christian Stump**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13624_\n\n",
    "closed_at": "2014-05-01T10:18:33Z",
    "created_at": "2012-10-19T09:03:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "KeyError raised by GraphLatex.dot2tex_picture when edge_labels=True",
    "type": "issue",
    "updated_at": "2014-05-01T10:18:33Z",
    "url": "https://github.com/sagemath/sage/issues/13624",
    "user": "https://github.com/seblabbe"
}
```
The following is ok :

```
sage: G = DiGraph()
sage: G.add_edge(3333, 88, 'my_label')
sage: G.set_latex_options(format='dot2tex')
sage: view(G)
```

but with `edges_labels=True` a KeyError is raised :

```
sage: G.set_latex_options(edge_labels=True)
sage: view(G)
ERROR    Failed to process input
Traceback (most recent call last):
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
    s =  conv.convert(dotdata)
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
    return self.do_preview_preproc()
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
    hp,dp,wt = pp.texdims[name]
KeyError: '3333880'
```

The error is also raised by `dot2tex_picture` method:

```
sage: G = DiGraph()
sage: G.add_edge(0, 1, 'p0')
sage: G.latex_options().dot2tex_picture()
'\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
.dot2tex_picture()
sage: G.set_latex_options(edge_labels=True)
sage: G.latex_options().dot2tex_picture()
ERROR    Failed to process input
Traceback (most recent call last):
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
    s =  conv.convert(dotdata)
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
    return self.do_preview_preproc()
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
    hp,dp,wt = pp.texdims[name]
KeyError: '010'
''
```

This is due to dot2tex currently not supporting '\verb' properly. 

The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like `^` and `_`.

CC:  @stumpc5 @nathanncohen

Keywords: **dot2tex, graph drawing**

Branch/Commit: **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**

Reviewer: **Christian Stump**

Author: **Sébastien Labbé**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/13624_





---

archive/issue_events_190537.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2012-10-19T09:03:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190537"
}
```



---

archive/issue_events_190538.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2012-10-19T09:03:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190538"
}
```



---

archive/issue_events_190539.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2012-10-19T09:03:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190539"
}
```



---

archive/issue_events_190540.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2012-10-19T09:03:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190540"
}
```



---

archive/issue_comments_159712.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,15 +3,14 @@\n ```\n sage: G = DiGraph()\n sage: G.add_edge(3333, 88, 'my_label')\n-sage: opts = G.latex_options()\n-sage: opts.set_options(format='dot2tex')\n+sage: G.set_latex_options(format='dot2tex')\n sage: view(G)\n ```\n \n but with `edges_labels=True` a KeyError is raised :\n \n ```\n-sage: opts.set_options(edge_labels=True)\n+sage: G.set_latex_options(edge_labels=True)\n sage: view(G)\n ERROR    Failed to process input\n Traceback (most recent call last):\n@@ -29,11 +28,11 @@\n ```\n sage: G = DiGraph()\n sage: G.add_edge(0, 1, 'p0')\n-sage: opts = G.latex_options()\n-sage: opts.dot2tex_picture()\n+sage: G.latex_options().dot2tex_picture()\n '\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n-sage: opts.set_options(edge_labels=True)\n-sage: opts.dot2tex_picture()\n+.dot2tex_picture()\n+sage: G.set_latex_options(edge_labels=True)\n+sage: G.latex_options().dot2tex_picture()\n ERROR    Failed to process input\n Traceback (most recent call last):\n   File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n``````\n",
    "created_at": "2012-11-13T01:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159712",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,15 +3,14 @@
 ```
 sage: G = DiGraph()
 sage: G.add_edge(3333, 88, 'my_label')
-sage: opts = G.latex_options()
-sage: opts.set_options(format='dot2tex')
+sage: G.set_latex_options(format='dot2tex')
 sage: view(G)
 ```
 
 but with `edges_labels=True` a KeyError is raised :
 
 ```
-sage: opts.set_options(edge_labels=True)
+sage: G.set_latex_options(edge_labels=True)
 sage: view(G)
 ERROR    Failed to process input
 Traceback (most recent call last):
@@ -29,11 +28,11 @@
 ```
 sage: G = DiGraph()
 sage: G.add_edge(0, 1, 'p0')
-sage: opts = G.latex_options()
-sage: opts.dot2tex_picture()
+sage: G.latex_options().dot2tex_picture()
 '\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
-sage: opts.set_options(edge_labels=True)
-sage: opts.dot2tex_picture()
+.dot2tex_picture()
+sage: G.set_latex_options(edge_labels=True)
+sage: G.latex_options().dot2tex_picture()
 ERROR    Failed to process input
 Traceback (most recent call last):
   File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
``````




---

archive/issue_comments_159713.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI managed to fix the bug with the following hack :\n\n```diff\ndiff --git a/src/dot2tex/dot2tex.py b/src/dot2tex/dot2tex.py\n--- a/src/dot2tex/dot2tex.py\n+++ b/src/dot2tex/dot2tex.py\n@@ -1153,6 +1153,20 @@ To see what happened, run dot2tex with t\n         for name,item in usededges.items():\n \n             edge = item\n+            break\n             hp,dp,wt = pp.texdims[name]\n             xmargin, ymargin = self.get_margins(edge)\n             labelcode = '<<<table border=\"0\" cellborder=\"0\" cellpadding=\"0\">'\\\n```\n\nbut I still don't know what was this loop for... because the output is OK (with edge labels).",
    "created_at": "2012-11-13T01:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159713",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:2" align="right">comment:2</div>

I managed to fix the bug with the following hack :

```diff
diff --git a/src/dot2tex/dot2tex.py b/src/dot2tex/dot2tex.py
--- a/src/dot2tex/dot2tex.py
+++ b/src/dot2tex/dot2tex.py
@@ -1153,6 +1153,20 @@ To see what happened, run dot2tex with t
         for name,item in usededges.items():
 
             edge = item
+            break
             hp,dp,wt = pp.texdims[name]
             xmargin, ymargin = self.get_margins(edge)
             labelcode = '<<<table border="0" cellborder="0" cellpadding="0">'\
```

but I still don't know what was this loop for... because the output is OK (with edge labels).



---

archive/issue_comments_159714.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI just created an issue on the dot2tex google code project :\n\nhttp://code.google.com/p/dot2tex/issues/detail?id=32",
    "created_at": "2012-11-16T18:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159714",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:3" align="right">comment:3</div>

I just created an issue on the dot2tex google code project :

http://code.google.com/p/dot2tex/issues/detail?id=32



---

archive/issue_comments_159715.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -45,3 +45,8 @@\n ''\n ```\n \n+This is due to dot2tex currently not supporting '\\verb' properly. \n+\n+The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like ^ and _.\n+\n+By the way, this patch also makes ``latex`` use ``\\text`` natively instead of ``\\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.\n``````\n",
    "created_at": "2013-03-11T18:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159715",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -45,3 +45,8 @@
 ''
 ```
 
+This is due to dot2tex currently not supporting '\verb' properly. 
+
+The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like ^ and _.
+
+By the way, this patch also makes ``latex`` use ``\text`` natively instead of ``\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.
``````




---

archive/issue_events_190541.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-03-11T18:09:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190541"
}
```



---

archive/issue_comments_159716.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHi S\u00e9bastien,\n\nI had not noticed this ticket. A quick and dirty workaround has been in the Sage-Combinat queue for some time. I did some further cleanup, but it's still nothing but a workaround. Shall we get it into Sage? If you think the patch could use more work, do you mind taking it over?\n\nCheers,\n                                        Nicolas",
    "created_at": "2013-03-11T18:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159716",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:5" align="right">comment:5</div>

Hi Sébastien,

I had not noticed this ticket. A quick and dirty workaround has been in the Sage-Combinat queue for some time. I did some further cleanup, but it's still nothing but a workaround. Shall we get it into Sage? If you think the patch could use more work, do you mind taking it over?

Cheers,
                                        Nicolas



---

archive/issue_comments_159717.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhile I was at it, I folded in a couple tests I had put in a later patch in the Sage-Combinat queue.",
    "created_at": "2013-03-11T18:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159717",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:6" align="right">comment:6</div>

While I was at it, I folded in a couple tests I had put in a later patch in the Sage-Combinat queue.



---

archive/issue_comments_159718.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -48,5 +48,3 @@\n This is due to dot2tex currently not supporting '\\verb' properly. \n \n The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like ^ and _.\n-\n-By the way, this patch also makes ``latex`` use ``\\text`` natively instead of ``\\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.\n``````\n",
    "created_at": "2013-03-11T19:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159718",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -48,5 +48,3 @@
 This is due to dot2tex currently not supporting '\verb' properly. 
 
 The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like ^ and _.
-
-By the way, this patch also makes ``latex`` use ``\text`` natively instead of ``\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.
``````




---

archive/issue_comments_159719.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe change verb -> text in sage.misc.latex was breaking quite a few doctests. I made it a separate ticket: #14256. This one should not depend on it.\n\nOn the other hand, I added three tiny things that were in a later patch in the queue:\n- shape=plain text whenever there are labels on the vertices (latex or not)\n- trim \".\" from keys (I guess I must have had a problem with them at some point)\n- a doctest fix.",
    "created_at": "2013-03-11T19:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159719",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

The change verb -> text in sage.misc.latex was breaking quite a few doctests. I made it a separate ticket: #14256. This one should not depend on it.

On the other hand, I added three tiny things that were in a later patch in the queue:
- shape=plain text whenever there are labels on the vertices (latex or not)
- trim "." from keys (I guess I must have had a problem with them at some point)
- a doctest fix.



---

archive/issue_comments_159720.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nPlease add your name as Author.",
    "created_at": "2013-03-13T14:38:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159720",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Please add your name as Author.



---

archive/issue_comments_159721.json:
```json
{
    "body": "Author: **Nicolas M. Thi\u00e9ry**",
    "created_at": "2013-03-13T14:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159721",
    "user": "https://github.com/nthiery"
}
```

Author: **Nicolas M. Thiéry**



---

archive/issue_comments_159722.json:
```json
{
    "body": "Changed keywords from **dot2tex** to **dot2tex, graph drawing**",
    "created_at": "2013-03-13T14:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159722",
    "user": "https://github.com/nthiery"
}
```

Changed keywords from **dot2tex** to **dot2tex, graph drawing**



---

archive/issue_comments_159723.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHi Nathann!\n\nWould you have time to review this one?\n\nThanks!\n                      Nicolas",
    "created_at": "2013-04-02T02:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159723",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:12" align="right">comment:12</div>

Hi Nathann!

Would you have time to review this one?

Thanks!
                      Nicolas



---

archive/issue_comments_159724.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis is what happens when I install graphviz \n\n```\n[...]\nmake[3]: *** No rule to make target `../../plugin/pango/libgvplugin_pango.la', needed by `dot_builtins'.  Stop.\nmake[3]: *** Waiting for unfinished jobs....\nmv -f .deps/no_demand_loading.Tpo .deps/no_demand_loading.Po\nmv -f .deps/dot_builtins.Tpo .deps/dot_builtins.Po\nmv -f .deps/dot.Tpo .deps/dot.Po\nmake[3]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd/dot'\nmake[2]: *** [all-recursive] Error 1\nmake[2]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src'\nmake: *** [all] Error 2\nError building Graphviz\n\nreal\t0m53.650s\nuser\t0m45.475s\nsys\t0m8.313s\n************************************************************************\nError installing package graphviz-2.16.1.p0\n************************************************************************\nPlease email sage-devel (http://groups.google.com/group/sage-devel)\nexplaining the problem and including the relevant part of the log file\n  /home/ncohen/.Sage/spkg/logs/graphviz-2.16.1.p0.log\nDescribe your computer, operating system, etc.\nIf you want to try to fix the problem yourself, *don't* just cd to\n/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0 and type 'make' or whatever is appropriate.\nInstead, the following commands setup all environment variables\ncorrectly and load a subshell for you to debug the error:\n  (cd '/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0' && '/home/ncohen/.Sage/sage' -sh)\nWhen you are done debugging, you can type \"exit\" to leave the subshell.\n************************************************************************\n```\n\nNathann",
    "created_at": "2013-04-02T08:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159724",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

This is what happens when I install graphviz 

```
[...]
make[3]: *** No rule to make target `../../plugin/pango/libgvplugin_pango.la', needed by `dot_builtins'.  Stop.
make[3]: *** Waiting for unfinished jobs....
mv -f .deps/no_demand_loading.Tpo .deps/no_demand_loading.Po
mv -f .deps/dot_builtins.Tpo .deps/dot_builtins.Po
mv -f .deps/dot.Tpo .deps/dot.Po
make[3]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd/dot'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src'
make: *** [all] Error 2
Error building Graphviz

real	0m53.650s
user	0m45.475s
sys	0m8.313s
************************************************************************
Error installing package graphviz-2.16.1.p0
************************************************************************
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and including the relevant part of the log file
  /home/ncohen/.Sage/spkg/logs/graphviz-2.16.1.p0.log
Describe your computer, operating system, etc.
If you want to try to fix the problem yourself, *don't* just cd to
/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0 and type 'make' or whatever is appropriate.
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0' && '/home/ncohen/.Sage/sage' -sh)
When you are done debugging, you can type "exit" to leave the subshell.
************************************************************************
```

Nathann



---

archive/issue_comments_159725.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHi!\n\nYes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.\n\nWe should probably remove this broken spkg from \"experimental\" ...\n\nCheers,\n                        Nicolas",
    "created_at": "2013-04-02T12:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159725",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:14" align="right">comment:14</div>

Hi!

Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.

We should probably remove this broken spkg from "experimental" ...

Cheers,
                        Nicolas



---

archive/issue_comments_159726.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n> Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.\n\n......\n\nwho the hell put that in the doc without removing the package ?...\n\nNathann",
    "created_at": "2013-04-02T12:07:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159726",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

> Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.

......

who the hell put that in the doc without removing the package ?...

Nathann



---

archive/issue_comments_159727.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> We should probably remove this broken spkg from \"experimental\" ...\n\nIndeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.\n\nAnd it will be quickly reviewed, I swear.\n\nNathann",
    "created_at": "2013-04-02T12:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159727",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

> We should probably remove this broken spkg from "experimental" ...

Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.

And it will be quickly reviewed, I swear.

Nathann



---

archive/issue_comments_159728.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@nathanncohen](#comment:16):\n> > We should probably remove this broken spkg from \"experimental\" ...\n\n> \n> Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.\n\nI was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\nAs for removing the spkg, this is now: #14398.",
    "created_at": "2013-04-02T13:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159728",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@nathanncohen](#comment:16):
> > We should probably remove this broken spkg from "experimental" ...

> 
> Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.

I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).

As for removing the spkg, this is now: #14398.



---

archive/issue_comments_159729.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\nIs written explicitly anywhere that there is no spkg and that the users should install it by themselves ?\n\nNathann",
    "created_at": "2013-04-02T13:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159729",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:18" align="right">comment:18</div>

> I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).

Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?

Nathann



---

archive/issue_events_190542.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-02T13:31:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190542"
}
```



---

archive/issue_events_190543.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-02T13:31:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190543"
}
```



---

archive/issue_comments_159730.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n\n```\n# optional - requires dot2tex and graphviz\n```\nshould be\n\n```\n# optional - dot2tex graphviz\n```",
    "created_at": "2013-04-02T13:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159730",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>


```
# optional - requires dot2tex and graphviz
```
should be

```
# optional - dot2tex graphviz
```



---

archive/issue_comments_159731.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n(and while you're editing the patch, you included a http link which Sphinx does not understand as one)\n\nNathann",
    "created_at": "2013-04-02T13:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159731",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:20" align="right">comment:20</div>

(and while you're editing the patch, you included a http link which Sphinx does not understand as one)

Nathann



---

archive/issue_comments_159732.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).\n\n```\nsage -t --long dot2tex_utils.py\n**********************************************************************\nFile \"dot2tex_utils.py\", line 11, in sage.graphs.dot2tex_utils\nFailed example:\n    output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - requires dot2tex and graphviz\nExpected nothing\nGot:\n    ERROR    Failed to process input\n    Traceback (most recent call last):\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2928, in main\n        s =  conv.convert(dotdata)\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 848, in convert\n        return self.output()\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2566, in output\n        positions[node.name] = map(int, pos.split(','))\n    ValueError: invalid literal for int() with base 10: '87.137'\n**********************************************************************\n```\n\nNathann",
    "created_at": "2013-04-02T13:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159732",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).

```
sage -t --long dot2tex_utils.py
**********************************************************************
File "dot2tex_utils.py", line 11, in sage.graphs.dot2tex_utils
Failed example:
    output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - requires dot2tex and graphviz
Expected nothing
Got:
    ERROR    Failed to process input
    Traceback (most recent call last):
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2928, in main
        s =  conv.convert(dotdata)
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 848, in convert
        return self.output()
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2566, in output
        positions[node.name] = map(int, pos.split(','))
    ValueError: invalid literal for int() with base 10: '87.137'
**********************************************************************
```

Nathann



---

archive/issue_comments_159733.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@nathanncohen](#comment:18):\n> > I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\n> \n> Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?\n\nIt's written that the soft can be downloaded from the graphviz website. This seems explicit enough to me, but if you want to improve that, go ahead (but I would not speak of spkg at all).",
    "created_at": "2013-04-02T13:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159733",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@nathanncohen](#comment:18):
> > I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).

> 
> Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?

It's written that the soft can be downloaded from the graphviz website. This seems explicit enough to me, but if you want to improve that, go ahead (but I would not speak of spkg at all).



---

archive/issue_comments_159734.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> It's written that the soft can be downloaded from the graphviz website.\n\nWhere ?\n\nNathann",
    "created_at": "2013-04-02T13:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159734",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:23" align="right">comment:23</div>

> It's written that the soft can be downloaded from the graphviz website.

Where ?

Nathann



---

archive/issue_comments_159735.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nathanncohen](#comment:23):\n> > It's written that the soft can be downloaded from the graphviz website.\n\n> \n> Where ?\n> \n> Nathann\n\ngrep is your friend :-)\n\nSee the method layout_graphviz in generic_graph.",
    "created_at": "2013-04-02T13:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159735",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nathanncohen](#comment:23):
> > It's written that the soft can be downloaded from the graphviz website.

> 
> Where ?
> 
> Nathann

grep is your friend :-)

See the method layout_graphviz in generic_graph.



---

archive/issue_comments_159736.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAttachment: **[trac_13624-dot2tex-verb_workaround-nt.patch.gz](https://github.com/sagemath/sage/files/ticket13624/trac_13624-dot2tex-verb_workaround-nt.patch.gz)**\n\nReplying to [@nathanncohen](#comment:20):\n> (and while you're editing the patch, you included a http link which Sphinx does not understand as one)\n\nDone. And added the file to the index.rst. And misc cleanup of the docstrings.",
    "created_at": "2013-04-02T13:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159736",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:25" align="right">comment:25</div>

Attachment: **[trac_13624-dot2tex-verb_workaround-nt.patch.gz](https://github.com/sagemath/sage/files/ticket13624/trac_13624-dot2tex-verb_workaround-nt.patch.gz)**

Replying to [@nathanncohen](#comment:20):
> (and while you're editing the patch, you included a http link which Sphinx does not understand as one)

Done. And added the file to the index.rst. And misc cleanup of the docstrings.



---

archive/issue_events_190544.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-02T13:57:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190544"
}
```



---

archive/issue_events_190545.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-02T13:57:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190545"
}
```



---

archive/issue_events_190546.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-04-02T14:07:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190546"
}
```



---

archive/issue_events_190547.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-04-02T14:07:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190547"
}
```



---

archive/issue_comments_159737.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n> grep is your friend :-)\n\nCool.\n\n> See the method layout_graphviz in generic_graph.\n\nDo we both agree that this is nowhere sufficient ?\n\nHere is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed \n\n```\nsage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##\nsage: sage: output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - dot2tex graphviz ## line 11 ##\nERROR    Could not locate Graphviz binaries\nERROR    Failed to create xdotdata. Is Graphviz installed?\nERROR    Failed to parse the input data. Is it a valid dot file?\nTry to input xdot data directly. Example:\n    dot -Txdot file.dot | dot2tex > file.tex\n\nIf this does not work, check that you have an updated version of PyParsing and\nGraphviz. Users have reported problems with old versions. You can also run\ndot2tex in debug mode using the --debug option:\n    dot2tex --debug file.dot\nA file dot2tex.log will be written to the current directory with detailed\ninformation useful for debugging.\nAn exception has occurred, use %tb to see the full traceback.\n\nSystemExit: 1\n\nTo exit: use 'exit', 'quit', or Ctrl-D\n```\n\nThe error message should redirect the user toward a way to install graphviz I guess. And I have never met \"`SystemExit`\"\nBy the way, do we really need pyparsing ? I thought this did not belong to Sage, and I needed it a couple of days ago.\n\nI reset this ticket to `needs_work` because the doctests from two messages above still do not pass, even with graphviz installed.\n\nNathann",
    "created_at": "2013-04-02T14:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159737",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:27" align="right">comment:27</div>

> grep is your friend :-)

Cool.

> See the method layout_graphviz in generic_graph.

Do we both agree that this is nowhere sufficient ?

Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed 

```
sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##
sage: sage: output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - dot2tex graphviz ## line 11 ##
ERROR    Could not locate Graphviz binaries
ERROR    Failed to create xdotdata. Is Graphviz installed?
ERROR    Failed to parse the input data. Is it a valid dot file?
Try to input xdot data directly. Example:
    dot -Txdot file.dot | dot2tex > file.tex

If this does not work, check that you have an updated version of PyParsing and
Graphviz. Users have reported problems with old versions. You can also run
dot2tex in debug mode using the --debug option:
    dot2tex --debug file.dot
A file dot2tex.log will be written to the current directory with detailed
information useful for debugging.
An exception has occurred, use %tb to see the full traceback.

SystemExit: 1

To exit: use 'exit', 'quit', or Ctrl-D
```

The error message should redirect the user toward a way to install graphviz I guess. And I have never met "`SystemExit`"
By the way, do we really need pyparsing ? I thought this did not belong to Sage, and I needed it a couple of days ago.

I reset this ticket to `needs_work` because the doctests from two messages above still do not pass, even with graphviz installed.

Nathann



---

archive/issue_comments_159738.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@nathanncohen](#comment:21):\n> 5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).\n\nThis is a bug in dot2tex. It's fixed in the dev branch since two years. I was waiting the official release to make a new spkg, but it seems to be taking some time ...\n\nOh well, I uploaded my dev spkg and updated the instructions in #7004. And updated a bit the docstring in the patch as well.\n\nNote: I had to wipe by hand the dot2tex directory before reinstalling dot2tex for things to work:\n\n```\nrm -rf /opt/sage-5.9.beta2/local/lib/python2.7/site-packages/dot2tex\n```",
    "created_at": "2013-04-02T14:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159738",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@nathanncohen](#comment:21):
> 5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).

This is a bug in dot2tex. It's fixed in the dev branch since two years. I was waiting the official release to make a new spkg, but it seems to be taking some time ...

Oh well, I uploaded my dev spkg and updated the instructions in #7004. And updated a bit the docstring in the patch as well.

Note: I had to wipe by hand the dot2tex directory before reinstalling dot2tex for things to work:

```
rm -rf /opt/sage-5.9.beta2/local/lib/python2.7/site-packages/dot2tex
```



---

archive/issue_comments_159739.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@nathanncohen](#comment:27):\n> > See the method layout_graphviz in generic_graph.\n\n> \n> Do we both agree that this is nowhere sufficient ?\n> \n> Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed \n> \n> ```\n> sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##\n> sage: sage: output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - dot2tex graphviz ## line 11 ##\n> ERROR    Could not locate Graphviz binaries\n> ERROR    Failed to create xdotdata. Is Graphviz installed?\n> ERROR    Failed to parse the input data. Is it a valid dot file?\n> Try to input xdot data directly. Example:\n>     dot -Txdot file.dot | dot2tex > file.tex\n> \n> If this does not work, check that you have an updated version of PyParsing and\n> Graphviz. Users have reported problems with old versions. You can also run\n> dot2tex in debug mode using the --debug option:\n>     dot2tex --debug file.dot\n> A file dot2tex.log will be written to the current directory with detailed\n> information useful for debugging.\n> An exception has occurred, use %tb to see the full traceback.\n> \n> SystemExit: 1\n> \n> To exit: use 'exit', 'quit', or Ctrl-D\n> ```\n> \n> The error message should redirect the user toward a way to install graphviz I guess. And I have never met \"`SystemExit`\"\n\nI agree this is ugly, but that's a problem with dot2tex, not with Sage\n(feel free to report!). Any Sage code using dot2tex should call\nassert_have_doc2tex.\n\n> By the way, do we really need pyparsing ? I thought this did not\n> belong to Sage, and I needed it a couple of days ago.\n\nNo clue.",
    "created_at": "2013-04-02T14:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159739",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@nathanncohen](#comment:27):
> > See the method layout_graphviz in generic_graph.

> 
> Do we both agree that this is nowhere sufficient ?
> 
> Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed 
> 
> ```
> sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##
> sage: sage: output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - dot2tex graphviz ## line 11 ##
> ERROR    Could not locate Graphviz binaries
> ERROR    Failed to create xdotdata. Is Graphviz installed?
> ERROR    Failed to parse the input data. Is it a valid dot file?
> Try to input xdot data directly. Example:
>     dot -Txdot file.dot | dot2tex > file.tex
> 
> If this does not work, check that you have an updated version of PyParsing and
> Graphviz. Users have reported problems with old versions. You can also run
> dot2tex in debug mode using the --debug option:
>     dot2tex --debug file.dot
> A file dot2tex.log will be written to the current directory with detailed
> information useful for debugging.
> An exception has occurred, use %tb to see the full traceback.
> 
> SystemExit: 1
> 
> To exit: use 'exit', 'quit', or Ctrl-D
> ```
> 
> The error message should redirect the user toward a way to install graphviz I guess. And I have never met "`SystemExit`"

I agree this is ugly, but that's a problem with dot2tex, not with Sage
(feel free to report!). Any Sage code using dot2tex should call
assert_have_doc2tex.

> By the way, do we really need pyparsing ? I thought this did not
> belong to Sage, and I needed it a couple of days ago.

No clue.



---

archive/issue_events_190548.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-02T14:31:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190548"
}
```



---

archive/issue_events_190549.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-02T14:31:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190549"
}
```



---

archive/issue_comments_159740.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n> I agree this is ugly, but that's a problem with dot2tex, not with Sage\n> (feel free to report!). Any Sage code using dot2tex should call\n> assert_have_doc2tex.\n\nThis one doesn't ?\n\nNathann",
    "created_at": "2013-04-02T14:34:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159740",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:31" align="right">comment:31</div>

> I agree this is ugly, but that's a problem with dot2tex, not with Sage
> (feel free to report!). Any Sage code using dot2tex should call
> assert_have_doc2tex.

This one doesn't ?

Nathann



---

archive/issue_comments_159741.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nOh. dot2tex is a Python spkg. Explains a lot, sorry `:-P`\n\nNathann",
    "created_at": "2013-04-02T14:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159741",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:32" align="right">comment:32</div>

Oh. dot2tex is a Python spkg. Explains a lot, sorry `:-P`

Nathann



---

archive/issue_comments_159742.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nAnyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.\n\nNathann",
    "created_at": "2013-04-02T14:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159742",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:33" align="right">comment:33</div>

Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.

Nathann



---

archive/issue_comments_159743.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -47,4 +47,4 @@\n \n This is due to dot2tex currently not supporting '\\verb' properly. \n \n-The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like ^ and _.\n+The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like `^` and `_`.\n``````\n",
    "created_at": "2013-04-02T14:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159743",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -47,4 +47,4 @@
 
 This is due to dot2tex currently not supporting '\verb' properly. 
 
-The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like ^ and _.
+The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like `^` and `_`.
``````




---

archive/issue_events_190550.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-04-02T14:41:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190550"
}
```



---

archive/issue_events_190551.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-04-02T14:41:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190551"
}
```



---

archive/issue_comments_159744.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAnd I had not noticed that you had not answered my rethorical question :\n\n>> See the method layout_graphviz in generic_graph.\n\n> Do we both agree that this is nowhere sufficient ?\n\nNathann",
    "created_at": "2013-04-02T14:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159744",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:35" align="right">comment:35</div>

And I had not noticed that you had not answered my rethorical question :

>> See the method layout_graphviz in generic_graph.

> Do we both agree that this is nowhere sufficient ?

Nathann



---

archive/issue_comments_159745.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nNicolas, could you add the following doctest to your patch to make sure the issue do not come up again in the future?\n\n```\nWe make sure :trac:`13624` is fixed::\n\n    sage: G = DiGraph()\n    sage: G.add_edge(3333, 88, 'my_label')\n    sage: G.set_latex_options(format='dot2tex')\n    sage: G.set_latex_options(edge_labels=True)\n    sage: G.latex_options().dot2tex_picture()  # optional - dot2tex graphviz\n    \\begin{tikzpicture}\n    first_line?\n    ...\n    last_line?\n    \\end{tikzpicture}\n```\n\nI don't really know where to put the information about where and how to download graphviz and dot2tex. In fact, there are many entry points for the user:\n\n- `G.set_latex_options`\n- `G.latex_options`\n- `G.latex_options().dot2tex_picture`\n- `G.latex_options().set_option`    <- it might be strange, but a lot of doc is in here\n- `G.latex_options().set_options`\n- `G.latex_options().latex`\n\nIt is hard to know where the user will first have the idea that installing graphviz + dot2tex could be nice. Personnaly, I found once that information here :\n\n- `G.layout_graphviz?`\n\nHere is what it says :\n\n```\nThis requires \"graphviz\" and the \"dot2tex\" spkg. Here are some    \ninstallation tips:                                                \n                                                                  \n   * Install graphviz >= 2.14 so that the programs dot, neato, ...\n     are in your path. The graphviz suite can be download from    \n     http://graphviz.org.                                         \n                                                                  \n   * Download dot2tex-2.8.?.spkg from                             \n     https://github.com/sagemath/sage/issues/7004 and install it\n     with \"sage -i dot2tex-2.8.?.spkg\"                            \n```\n\nThis does not speak about any graphviz spkg. In fact, I did not know there was one. When I saw that doc in the past, I was then able to install graphviz properly.\n\nThe information about the dot2tex spgk is obsolete. I suggest to replace it by :\n\n```\n   * Get the name of the most recent version of dot2tex from\n     the sage command ``optional_packages()``. Then,\n     install it with ``sage -i dot2tex-2.8.?.spkg``. \n```",
    "created_at": "2013-04-02T16:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159745",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:36" align="right">comment:36</div>

Nicolas, could you add the following doctest to your patch to make sure the issue do not come up again in the future?

```
We make sure :trac:`13624` is fixed::

    sage: G = DiGraph()
    sage: G.add_edge(3333, 88, 'my_label')
    sage: G.set_latex_options(format='dot2tex')
    sage: G.set_latex_options(edge_labels=True)
    sage: G.latex_options().dot2tex_picture()  # optional - dot2tex graphviz
    \begin{tikzpicture}
    first_line?
    ...
    last_line?
    \end{tikzpicture}
```

I don't really know where to put the information about where and how to download graphviz and dot2tex. In fact, there are many entry points for the user:

- `G.set_latex_options`
- `G.latex_options`
- `G.latex_options().dot2tex_picture`
- `G.latex_options().set_option`    <- it might be strange, but a lot of doc is in here
- `G.latex_options().set_options`
- `G.latex_options().latex`

It is hard to know where the user will first have the idea that installing graphviz + dot2tex could be nice. Personnaly, I found once that information here :

- `G.layout_graphviz?`

Here is what it says :

```
This requires "graphviz" and the "dot2tex" spkg. Here are some    
installation tips:                                                
                                                                  
   * Install graphviz >= 2.14 so that the programs dot, neato, ...
     are in your path. The graphviz suite can be download from    
     http://graphviz.org.                                         
                                                                  
   * Download dot2tex-2.8.?.spkg from                             
     https://github.com/sagemath/sage/issues/7004 and install it
     with "sage -i dot2tex-2.8.?.spkg"                            
```

This does not speak about any graphviz spkg. In fact, I did not know there was one. When I saw that doc in the past, I was then able to install graphviz properly.

The information about the dot2tex spgk is obsolete. I suggest to replace it by :

```
   * Get the name of the most recent version of dot2tex from
     the sage command ``optional_packages()``. Then,
     install it with ``sage -i dot2tex-2.8.?.spkg``. 
```



---

archive/issue_comments_159746.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@nathanncohen](#comment:33):\n> Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.\n\nHave you installed the new spkg as I pointed out in my previous comment?",
    "created_at": "2013-04-02T16:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159746",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@nathanncohen](#comment:33):
> Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.

Have you installed the new spkg as I pointed out in my previous comment?



---

archive/issue_comments_159747.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOk guys, I have used up my time on this patch. I need to move on. Feel free to takeover.\n\nNathann: if you want patches to get in Sage quickly, don't keep expanding tickets beyond their original scope.",
    "created_at": "2013-04-02T16:56:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159747",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:38" align="right">comment:38</div>

Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.

Nathann: if you want patches to get in Sage quickly, don't keep expanding tickets beyond their original scope.



---

archive/issue_comments_159748.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@nathanncohen](#comment:35):\n> And I had not noticed that you had not answered my rethorical question :\n> \n> >> See the method layout_graphviz in generic_graph.\n\n> > Do we both agree that this is nowhere sufficient ?\n\nCertainly not great. Certainly out of scope for this ticket.",
    "created_at": "2013-04-02T17:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159748",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@nathanncohen](#comment:35):
> And I had not noticed that you had not answered my rethorical question :
> 
> >> See the method layout_graphviz in generic_graph.

> > Do we both agree that this is nowhere sufficient ?

Certainly not great. Certainly out of scope for this ticket.



---

archive/issue_comments_159749.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@nthiery](#comment:38):\n> Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.\n\nSorry, I will propose a patch soon which apply on yours that will implement what I suggested. I can't do it now as the version of Sage I have now (sage-5.7.beta4) is too old: I get a conflict with the patch.\n\nS\u00e9bastien",
    "created_at": "2013-04-02T17:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159749",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@nthiery](#comment:38):
> Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.

Sorry, I will propose a patch soon which apply on yours that will implement what I suggested. I can't do it now as the version of Sage I have now (sage-5.7.beta4) is too old: I get a conflict with the patch.

Sébastien



---

archive/issue_comments_159750.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\n> > > Do we both agree that this is nowhere sufficient ?\n\n> \n> Certainly not great. Certainly out of scope for this ticket.\n\nThen find somebody else to review it. I refuse to be part of this mess.\n\nNathann",
    "created_at": "2013-04-02T20:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159750",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:41" align="right">comment:41</div>

> > > Do we both agree that this is nowhere sufficient ?

> 
> Certainly not great. Certainly out of scope for this ticket.

Then find somebody else to review it. I refuse to be part of this mess.

Nathann



---

archive/issue_comments_159751.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nIls sont fous ces romains...\n\nReplying to [@nthiery](#comment:37):\n> Have you installed the new spkg as I pointed out in my previous comment?\n\nI think it is better not to update the old ticket #7004. Here is the link to the new spkg:\n\n```\nsage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-dev.spkg\n```",
    "created_at": "2013-04-02T22:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159751",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:42" align="right">comment:42</div>

Ils sont fous ces romains...

Replying to [@nthiery](#comment:37):
> Have you installed the new spkg as I pointed out in my previous comment?

I think it is better not to update the old ticket #7004. Here is the link to the new spkg:

```
sage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-dev.spkg
```



---

archive/issue_comments_159752.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.\n\nFinally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.\n\n```\nsage: g = digraphs.ButterflyGraph(2)\nsage: g.plot(layout = \"graphviz\", prog = \"neato\") # optional - dot2tex, graphviz\nTraceback (most recent call last): \n...\nValueError: invalid literal for int() with base 10: '67.297'\n```",
    "created_at": "2013-04-03T14:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159752",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:43" align="right">comment:43</div>

I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.

Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.

```
sage: g = digraphs.ButterflyGraph(2)
sage: g.plot(layout = "graphviz", prog = "neato") # optional - dot2tex, graphviz
Traceback (most recent call last): 
...
ValueError: invalid literal for int() with base 10: '67.297'
```



---

archive/issue_comments_159753.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@seblabbe](#comment:43):\n> I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.\n\nThanks S\u00e9bastien! I looked at your reviewer patch, and it looks good to me. Let's see what the patchbot says. Back to needs review for the first patch.\n\n> Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.\n> \n> ```\n> sage: g = digraphs.ButterflyGraph(2)\n> sage: g.plot(layout = \"graphviz\", prog = \"neato\") # optional - dot2tex, graphviz\n> Traceback (most recent call last): \n> ...\n> ValueError: invalid literal for int() with base 10: '67.297'\n> ```\n\n+1 since the tests were already failing before this ticket. This is\nnow #14408 which is about updating the dot2tex spkg.",
    "created_at": "2013-04-03T15:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159753",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@seblabbe](#comment:43):
> I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.

Thanks Sébastien! I looked at your reviewer patch, and it looks good to me. Let's see what the patchbot says. Back to needs review for the first patch.

> Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.
> 
> ```
> sage: g = digraphs.ButterflyGraph(2)
> sage: g.plot(layout = "graphviz", prog = "neato") # optional - dot2tex, graphviz
> Traceback (most recent call last): 
> ...
> ValueError: invalid literal for int() with base 10: '67.297'
> ```

+1 since the tests were already failing before this ticket. This is
now #14408 which is about updating the dot2tex spkg.



---

archive/issue_events_190552.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-03T15:01:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190552"
}
```



---

archive/issue_events_190553.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-04-03T15:01:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190553"
}
```



---

archive/issue_comments_159754.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nFor the record, current installation instructions for dot2tex are outdated (I tried the example from the description and it failed at first).\n\nWith the current patch at #14382, the example from the description does not give errors.",
    "created_at": "2013-04-17T20:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159754",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:45" align="right">comment:45</div>

For the record, current installation instructions for dot2tex are outdated (I tried the example from the description and it failed at first).

With the current patch at #14382, the example from the description does not give errors.



---

archive/issue_comments_159755.json:
```json
{
    "body": "Adding a doctest to make sure the initial issue is fixed",
    "created_at": "2013-06-03T08:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159755",
    "user": "https://github.com/seblabbe"
}
```

Adding a doctest to make sure the initial issue is fixed



---

archive/issue_comments_159756.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nAttachment: **[trac_13624-review-sl.patch.gz](https://github.com/sagemath/sage/files/ticket13624/trac_13624-review-sl.patch.gz)**\n\nI just updated my patch which adds a doctest. Even if #14382 finally fix the problem, I think it could be merged anyway.\n\nI removed the part that was fixing dot2tex optional doctests errors. I will move this part in another patch that I am going to post on #14408 where similar issues were discussed.",
    "created_at": "2013-06-03T08:34:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159756",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:46" align="right">comment:46</div>

Attachment: **[trac_13624-review-sl.patch.gz](https://github.com/sagemath/sage/files/ticket13624/trac_13624-review-sl.patch.gz)**

I just updated my patch which adds a doctest. Even if #14382 finally fix the problem, I think it could be merged anyway.

I removed the part that was fixing dot2tex optional doctests errors. I will move this part in another patch that I am going to post on #14408 where similar issues were discussed.



---

archive/issue_comments_159757.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@seblabbe](#comment:46):\n> Even if #14382 finally fix the problem,\n\nFeel free to give it a try and set to positive review - it is not big ;-)",
    "created_at": "2013-06-03T14:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159757",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@seblabbe](#comment:46):
> Even if #14382 finally fix the problem,

Feel free to give it a try and set to positive review - it is not big ;-)



---

archive/issue_events_190554.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190554"
}
```



---

archive/issue_events_190555.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190555"
}
```



---

archive/issue_events_190556.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190556"
}
```



---

archive/issue_events_190557.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190557"
}
```



---

archive/issue_comments_159758.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nCurrently in `6.2.rc0`, the example given in the description works (probably from #14382):\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(333, 88, \"my_label\")\nsage: G.set_latex_options(format=\"dot2tex\", edge_labels=True)\nsage: latex(G)\n\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (node_1) at (11.000000bp,79.000000bp) [draw,draw=none] {$333$};\n  \\node (node_0) at (11.000000bp,7.000000bp) [draw,draw=none] {$88$};\n  \\draw [black,->] (node_1) ..controls (11.000000bp,61.481000bp) and (11.000000bp,39.548000bp)  .. (node_0);\n  \\definecolor{strokecol}{rgb}{0.0,0.0,0.0};\n  \\pgfsetstrokecolor{strokecol}\n  \\draw (38.000000bp,43.000000bp) node {$\\text{\\texttt{my{\\char`\\_}label}}$};\n%\n\\end{tikzpicture}\n```\nSo how much of this ticket should we keep or should we just close as a \"works-for-me\"?",
    "created_at": "2014-04-26T12:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159758",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:50" align="right">comment:50</div>

Currently in `6.2.rc0`, the example given in the description works (probably from #14382):

```
sage: G = DiGraph()
sage: G.add_edge(333, 88, "my_label")
sage: G.set_latex_options(format="dot2tex", edge_labels=True)
sage: latex(G)

\begin{tikzpicture}[>=latex,line join=bevel,]
%%
\node (node_1) at (11.000000bp,79.000000bp) [draw,draw=none] {$333$};
  \node (node_0) at (11.000000bp,7.000000bp) [draw,draw=none] {$88$};
  \draw [black,->] (node_1) ..controls (11.000000bp,61.481000bp) and (11.000000bp,39.548000bp)  .. (node_0);
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (38.000000bp,43.000000bp) node {$\text{\texttt{my{\char`\_}label}}$};
%
\end{tikzpicture}
```
So how much of this ticket should we keep or should we just close as a "works-for-me"?



---

archive/issue_events_190558.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-04-26T12:28:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190558"
}
```



---

archive/issue_events_190559.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-04-26T12:28:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190559"
}
```



---

archive/issue_comments_159759.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\n> So how much of this ticket should we keep or should we just close as a \"works-for-me\"?\n\nAs I suggested in a previous comment, I think we could merge the patch `trac_13624-review-sl.patch` which simply adds a doctest.\n\nS\u00e9bastien",
    "created_at": "2014-04-27T21:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159759",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:51" align="right">comment:51</div>

> So how much of this ticket should we keep or should we just close as a "works-for-me"?

As I suggested in a previous comment, I think we could merge the patch `trac_13624-review-sl.patch` which simply adds a doctest.

Sébastien



---

archive/issue_comments_159760.json:
```json
{
    "body": "Commit: **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**",
    "created_at": "2014-04-30T09:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159760",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**



---

archive/issue_comments_159761.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI just converted my old hg patch to a git branch. It should be easy to review as it only adds a doctest since the problem was fixed by #14382.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb\"><code>2634500</code></a></td><td><code>adding a doctest to make sure 13624 is fixed</code></td></tr></table>\n",
    "created_at": "2014-04-30T09:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159761",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:52" align="right">comment:52</div>

I just converted my old hg patch to a git branch. It should be easy to review as it only adds a doctest since the problem was fixed by #14382.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb"><code>2634500</code></a></td><td><code>adding a doctest to make sure 13624 is fixed</code></td></tr></table>




---

archive/issue_comments_159762.json:
```json
{
    "body": "Branch: **[u/slabbe/13624](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/13624)**",
    "created_at": "2014-04-30T09:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159762",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[u/slabbe/13624](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/13624)**



---

archive/issue_events_190560.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-04-30T09:46:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190560"
}
```



---

archive/issue_events_190561.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2014-04-30T09:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190561"
}
```



---

archive/issue_comments_159763.json:
```json
{
    "body": "Changed author from **Nicolas M. Thi\u00e9ry** to **S\u00e9bastien Labb\u00e9**",
    "created_at": "2014-04-30T09:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159763",
    "user": "https://github.com/seblabbe"
}
```

Changed author from **Nicolas M. Thiéry** to **Sébastien Labbé**



---

archive/issue_comments_159764.json:
```json
{
    "body": "Reviewer: **Christian Stump**",
    "created_at": "2014-04-30T09:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159764",
    "user": "https://github.com/stumpc5"
}
```

Reviewer: **Christian Stump**



---

archive/issue_events_190562.json:
```json
{
    "actor": "https://github.com/stumpc5",
    "created_at": "2014-04-30T09:50:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190562"
}
```



---

archive/issue_events_190563.json:
```json
{
    "actor": "https://github.com/stumpc5",
    "created_at": "2014-04-30T09:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190563"
}
```



---

archive/issue_events_190564.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-01T10:18:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190564"
}
```



---

archive/issue_events_190565.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ca10fd508b12b97a5c6b2d0a32686780a6b495de",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-01T10:18:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13624#event-190565"
}
```



---

archive/issue_comments_159765.json:
```json
{
    "body": "Changed branch from **[u/slabbe/13624](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/13624)** to **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**",
    "created_at": "2014-05-01T10:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13624#issuecomment-159765",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/13624](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/13624)** to **[`2634500`](https://github.com/sagemath/sagetrac-mirror/commit/26345009b7d0063c3cbb24b5cbf54f8a911b28fb)**
