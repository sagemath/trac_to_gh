# Issue 13624: KeyError raised by GraphLatex.dot2tex_picture when edge_labels=True

archive/issues_013420.json:
```json
{
    "body": "The following is ok :\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(3333, 88, 'my_label')\nsage: G.set_latex_options(format='dot2tex')\nsage: view(G)\n```\n\nbut with `edges_labels=True` a KeyError is raised :\n\n```\nsage: G.set_latex_options(edge_labels=True)\nsage: view(G)\nERROR    Failed to process input\nTraceback (most recent call last):\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n    s =  conv.convert(dotdata)\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n    return self.do_preview_preproc()\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n    hp,dp,wt = pp.texdims[name]\nKeyError: '3333880'\n```\n\nThe error is also raised by `dot2tex_picture` method:\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(0, 1, 'p0')\nsage: G.latex_options().dot2tex_picture()\n'\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n.dot2tex_picture()\nsage: G.set_latex_options(edge_labels=True)\nsage: G.latex_options().dot2tex_picture()\nERROR    Failed to process input\nTraceback (most recent call last):\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n    s =  conv.convert(dotdata)\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n    return self.do_preview_preproc()\n  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n    hp,dp,wt = pp.texdims[name]\nKeyError: '010'\n''\n```\n\nThis is due to dot2tex currently not supporting '\\verb' properly. \n\nThe attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like `^` and `_`.\n\nAssignee: tbd\n\nCC:  stumpc5 @nathanncohen\n\nKeywords: dot2tex, graph drawing\n\nBranch/Commit: 26345009b7d0063c3cbb24b5cbf54f8a911b28fb\n\nReviewer: Christian Stump\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13624\n\n",
    "closed_at": "2014-05-01T10:18:33Z",
    "created_at": "2012-10-19T09:03:36Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "KeyError raised by GraphLatex.dot2tex_picture when edge_labels=True",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13624",
    "user": "https://github.com/seblabbe"
}
```
The following is ok :

```
sage: G = DiGraph()
sage: G.add_edge(3333, 88, 'my_label')
sage: G.set_latex_options(format='dot2tex')
sage: view(G)
```

but with `edges_labels=True` a KeyError is raised :

```
sage: G.set_latex_options(edge_labels=True)
sage: view(G)
ERROR    Failed to process input
Traceback (most recent call last):
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
    s =  conv.convert(dotdata)
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
    return self.do_preview_preproc()
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
    hp,dp,wt = pp.texdims[name]
KeyError: '3333880'
```

The error is also raised by `dot2tex_picture` method:

```
sage: G = DiGraph()
sage: G.add_edge(0, 1, 'p0')
sage: G.latex_options().dot2tex_picture()
'\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
.dot2tex_picture()
sage: G.set_latex_options(edge_labels=True)
sage: G.latex_options().dot2tex_picture()
ERROR    Failed to process input
Traceback (most recent call last):
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
    s =  conv.convert(dotdata)
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
    return self.do_preview_preproc()
  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
    hp,dp,wt = pp.texdims[name]
KeyError: '010'
''
```

This is due to dot2tex currently not supporting '\verb' properly. 

The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like `^` and `_`.

Assignee: tbd

CC:  stumpc5 @nathanncohen

Keywords: dot2tex, graph drawing

Branch/Commit: 26345009b7d0063c3cbb24b5cbf54f8a911b28fb

Reviewer: Christian Stump

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13624





---

archive/issue_comments_205792.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,15 +3,14 @@\n ```\n sage: G = DiGraph()\n sage: G.add_edge(3333, 88, 'my_label')\n-sage: opts = G.latex_options()\n-sage: opts.set_options(format='dot2tex')\n+sage: G.set_latex_options(format='dot2tex')\n sage: view(G)\n ```\n \n but with `edges_labels=True` a KeyError is raised :\n \n ```\n-sage: opts.set_options(edge_labels=True)\n+sage: G.set_latex_options(edge_labels=True)\n sage: view(G)\n ERROR    Failed to process input\n Traceback (most recent call last):\n@@ -29,11 +28,11 @@\n ```\n sage: G = DiGraph()\n sage: G.add_edge(0, 1, 'p0')\n-sage: opts = G.latex_options()\n-sage: opts.dot2tex_picture()\n+sage: G.latex_options().dot2tex_picture()\n '\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n-sage: opts.set_options(edge_labels=True)\n-sage: opts.dot2tex_picture()\n+.dot2tex_picture()\n+sage: G.set_latex_options(edge_labels=True)\n+sage: G.latex_options().dot2tex_picture()\n ERROR    Failed to process input\n Traceback (most recent call last):\n   File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n@@ -46,7 +45,6 @@\n ''\n ```\n \n-Keywords: dot2tex\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-11-13T01:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205792",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,15 +3,14 @@
 ```
 sage: G = DiGraph()
 sage: G.add_edge(3333, 88, 'my_label')
-sage: opts = G.latex_options()
-sage: opts.set_options(format='dot2tex')
+sage: G.set_latex_options(format='dot2tex')
 sage: view(G)
 ```
 
 but with `edges_labels=True` a KeyError is raised :
 
 ```
-sage: opts.set_options(edge_labels=True)
+sage: G.set_latex_options(edge_labels=True)
 sage: view(G)
 ERROR    Failed to process input
 Traceback (most recent call last):
@@ -29,11 +28,11 @@
 ```
 sage: G = DiGraph()
 sage: G.add_edge(0, 1, 'p0')
-sage: opts = G.latex_options()
-sage: opts.dot2tex_picture()
+sage: G.latex_options().dot2tex_picture()
 '\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
-sage: opts.set_options(edge_labels=True)
-sage: opts.dot2tex_picture()
+.dot2tex_picture()
+sage: G.set_latex_options(edge_labels=True)
+sage: G.latex_options().dot2tex_picture()
 ERROR    Failed to process input
 Traceback (most recent call last):
   File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
@@ -46,7 +45,6 @@
 ''
 ```
 
-Keywords: dot2tex
 
 Comment: 1
 
``````




---

archive/issue_comments_205793.json:
```json
{
    "body": "<a id='comment:2'></a>I managed to fix the bug with the following hack :\n\n```diff\ndiff --git a/src/dot2tex/dot2tex.py b/src/dot2tex/dot2tex.py\n--- a/src/dot2tex/dot2tex.py\n+++ b/src/dot2tex/dot2tex.py\n@@ -1153,6 +1153,20 @@ To see what happened, run dot2tex with t\n         for name,item in usededges.items():\n \n             edge = item\n+            break\n             hp,dp,wt = pp.texdims[name]\n             xmargin, ymargin = self.get_margins(edge)\n             labelcode = '<<<table border=\"0\" cellborder=\"0\" cellpadding=\"0\">'\\\n```\n\nbut I still don't know what was this loop for... because the output is OK (with edge labels).",
    "created_at": "2012-11-13T01:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205793",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>I managed to fix the bug with the following hack :

```diff
diff --git a/src/dot2tex/dot2tex.py b/src/dot2tex/dot2tex.py
--- a/src/dot2tex/dot2tex.py
+++ b/src/dot2tex/dot2tex.py
@@ -1153,6 +1153,20 @@ To see what happened, run dot2tex with t
         for name,item in usededges.items():
 
             edge = item
+            break
             hp,dp,wt = pp.texdims[name]
             xmargin, ymargin = self.get_margins(edge)
             labelcode = '<<<table border="0" cellborder="0" cellpadding="0">'\
```

but I still don't know what was this loop for... because the output is OK (with edge labels).



---

archive/issue_comments_205794.json:
```json
{
    "body": "<a id='comment:3'></a>I just created an issue on the dot2tex google code project :\n\nhttp://code.google.com/p/dot2tex/issues/detail?id=32",
    "created_at": "2012-11-16T18:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205794",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>I just created an issue on the dot2tex google code project :

http://code.google.com/p/dot2tex/issues/detail?id=32



---

archive/issue_comments_205795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,55 @@\n+The following is ok :\n \n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(3333, 88, 'my_label')\n+sage: G.set_latex_options(format='dot2tex')\n+sage: view(G)\n+```\n+\n+but with `edges_labels=True` a KeyError is raised :\n+\n+```\n+sage: G.set_latex_options(edge_labels=True)\n+sage: view(G)\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '3333880'\n+```\n+\n+The error is also raised by `dot2tex_picture` method:\n+\n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(0, 1, 'p0')\n+sage: G.latex_options().dot2tex_picture()\n+'\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n+.dot2tex_picture()\n+sage: G.set_latex_options(edge_labels=True)\n+sage: G.latex_options().dot2tex_picture()\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '010'\n+''\n+```\n+\n+This is due to dot2tex currently not supporting '\\verb' properly. \n+\n+The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like ^ and _.\n+\n+By the way, this patch also makes ``latex`` use ``\\text`` natively instead of ``\\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-03-11T18:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205795",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,55 @@
+The following is ok :
 
+```
+sage: G = DiGraph()
+sage: G.add_edge(3333, 88, 'my_label')
+sage: G.set_latex_options(format='dot2tex')
+sage: view(G)
+```
+
+but with `edges_labels=True` a KeyError is raised :
+
+```
+sage: G.set_latex_options(edge_labels=True)
+sage: view(G)
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '3333880'
+```
+
+The error is also raised by `dot2tex_picture` method:
+
+```
+sage: G = DiGraph()
+sage: G.add_edge(0, 1, 'p0')
+sage: G.latex_options().dot2tex_picture()
+'\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
+.dot2tex_picture()
+sage: G.set_latex_options(edge_labels=True)
+sage: G.latex_options().dot2tex_picture()
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '010'
+''
+```
+
+This is due to dot2tex currently not supporting '\verb' properly. 
+
+The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like ^ and _.
+
+By the way, this patch also makes ``latex`` use ``\text`` natively instead of ``\verb`` in the easy situations as this gives more readable latex code. But maybe this should be moved to another ticket.
 
 Comment: 1
 
``````




---

archive/issue_comments_205796.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-11T18:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205796",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_205797.json:
```json
{
    "body": "<a id='comment:5'></a>Hi S\u00e9bastien,\n\nI had not noticed this ticket. A quick and dirty workaround has been in the Sage-Combinat queue for some time. I did some further cleanup, but it's still nothing but a workaround. Shall we get it into Sage? If you think the patch could use more work, do you mind taking it over?\n\nCheers,\n                                        Nicolas",
    "created_at": "2013-03-11T18:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205797",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>Hi Sébastien,

I had not noticed this ticket. A quick and dirty workaround has been in the Sage-Combinat queue for some time. I did some further cleanup, but it's still nothing but a workaround. Shall we get it into Sage? If you think the patch could use more work, do you mind taking it over?

Cheers,
                                        Nicolas



---

archive/issue_comments_205798.json:
```json
{
    "body": "<a id='comment:6'></a>While I was at it, I folded in a couple tests I had put in a later patch in the Sage-Combinat queue.",
    "created_at": "2013-03-11T18:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205798",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>While I was at it, I folded in a couple tests I had put in a later patch in the Sage-Combinat queue.



---

archive/issue_comments_205799.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+The following is ok :\n \n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(3333, 88, 'my_label')\n+sage: G.set_latex_options(format='dot2tex')\n+sage: view(G)\n+```\n+\n+but with `edges_labels=True` a KeyError is raised :\n+\n+```\n+sage: G.set_latex_options(edge_labels=True)\n+sage: view(G)\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '3333880'\n+```\n+\n+The error is also raised by `dot2tex_picture` method:\n+\n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(0, 1, 'p0')\n+sage: G.latex_options().dot2tex_picture()\n+'\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n+.dot2tex_picture()\n+sage: G.set_latex_options(edge_labels=True)\n+sage: G.latex_options().dot2tex_picture()\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '010'\n+''\n+```\n+\n+This is due to dot2tex currently not supporting '\\verb' properly. \n+\n+The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like ^ and _.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-03-11T19:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205799",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,53 @@
+The following is ok :
 
+```
+sage: G = DiGraph()
+sage: G.add_edge(3333, 88, 'my_label')
+sage: G.set_latex_options(format='dot2tex')
+sage: view(G)
+```
+
+but with `edges_labels=True` a KeyError is raised :
+
+```
+sage: G.set_latex_options(edge_labels=True)
+sage: view(G)
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '3333880'
+```
+
+The error is also raised by `dot2tex_picture` method:
+
+```
+sage: G = DiGraph()
+sage: G.add_edge(0, 1, 'p0')
+sage: G.latex_options().dot2tex_picture()
+'\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
+.dot2tex_picture()
+sage: G.set_latex_options(edge_labels=True)
+sage: G.latex_options().dot2tex_picture()
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '010'
+''
+```
+
+This is due to dot2tex currently not supporting '\verb' properly. 
+
+The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like ^ and _.
 
 Comment: 1
 
``````




---

archive/issue_comments_205800.json:
```json
{
    "body": "<a id='comment:9'></a>The change verb -> text in sage.misc.latex was breaking quite a few doctests. I made it a separate ticket: #14256. This one should not depend on it.\n\nOn the other hand, I added three tiny things that were in a later patch in the queue:\n- shape=plain text whenever there are labels on the vertices (latex or not)\n- trim \".\" from keys (I guess I must have had a problem with them at some point)\n- a doctest fix.",
    "created_at": "2013-03-11T19:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205800",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>The change verb -> text in sage.misc.latex was breaking quite a few doctests. I made it a separate ticket: #14256. This one should not depend on it.

On the other hand, I added three tiny things that were in a later patch in the queue:
- shape=plain text whenever there are labels on the vertices (latex or not)
- trim "." from keys (I guess I must have had a problem with them at some point)
- a doctest fix.



---

archive/issue_comments_205801.json:
```json
{
    "body": "<a id='comment:10'></a>Please add your name as Author.",
    "created_at": "2013-03-13T14:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205801",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Please add your name as Author.



---

archive/issue_comments_205802.json:
```json
{
    "body": "Changing author from \"\" to \"Nicolas M. Thi\u00e9ry\"",
    "created_at": "2013-03-13T14:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205802",
    "user": "https://github.com/nthiery"
}
```

Changing author from "" to "Nicolas M. Thiéry"



---

archive/issue_comments_205803.json:
```json
{
    "body": "Changing keywords from \"dot2tex\" to \"dot2tex, graph drawing\".",
    "created_at": "2013-03-13T14:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205803",
    "user": "https://github.com/nthiery"
}
```

Changing keywords from "dot2tex" to "dot2tex, graph drawing".



---

archive/issue_comments_205804.json:
```json
{
    "body": "<a id='comment:12'></a>Hi Nathann!\n\nWould you have time to review this one?\n\nThanks!\n                      Nicolas",
    "created_at": "2013-04-02T02:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205804",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:12'></a>Hi Nathann!

Would you have time to review this one?

Thanks!
                      Nicolas



---

archive/issue_comments_205805.json:
```json
{
    "body": "<a id='comment:13'></a>This is what happens when I install graphviz \n\n```\n[...]\nmake[3]: *** No rule to make target `../../plugin/pango/libgvplugin_pango.la', needed by `dot_builtins'.  Stop.\nmake[3]: *** Waiting for unfinished jobs....\nmv -f .deps/no_demand_loading.Tpo .deps/no_demand_loading.Po\nmv -f .deps/dot_builtins.Tpo .deps/dot_builtins.Po\nmv -f .deps/dot.Tpo .deps/dot.Po\nmake[3]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd/dot'\nmake[2]: *** [all-recursive] Error 1\nmake[2]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src'\nmake: *** [all] Error 2\nError building Graphviz\n\nreal\t0m53.650s\nuser\t0m45.475s\nsys\t0m8.313s\n************************************************************************\nError installing package graphviz-2.16.1.p0\n************************************************************************\nPlease email sage-devel (http://groups.google.com/group/sage-devel)\nexplaining the problem and including the relevant part of the log file\n  /home/ncohen/.Sage/spkg/logs/graphviz-2.16.1.p0.log\nDescribe your computer, operating system, etc.\nIf you want to try to fix the problem yourself, *don't* just cd to\n/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0 and type 'make' or whatever is appropriate.\nInstead, the following commands setup all environment variables\ncorrectly and load a subshell for you to debug the error:\n  (cd '/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0' && '/home/ncohen/.Sage/sage' -sh)\nWhen you are done debugging, you can type \"exit\" to leave the subshell.\n************************************************************************\n```\n\nNathann",
    "created_at": "2013-04-02T08:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205805",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>This is what happens when I install graphviz 

```
[...]
make[3]: *** No rule to make target `../../plugin/pango/libgvplugin_pango.la', needed by `dot_builtins'.  Stop.
make[3]: *** Waiting for unfinished jobs....
mv -f .deps/no_demand_loading.Tpo .deps/no_demand_loading.Po
mv -f .deps/dot_builtins.Tpo .deps/dot_builtins.Po
mv -f .deps/dot.Tpo .deps/dot.Po
make[3]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd/dot'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src/cmd'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0/src'
make: *** [all] Error 2
Error building Graphviz

real	0m53.650s
user	0m45.475s
sys	0m8.313s
************************************************************************
Error installing package graphviz-2.16.1.p0
************************************************************************
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and including the relevant part of the log file
  /home/ncohen/.Sage/spkg/logs/graphviz-2.16.1.p0.log
Describe your computer, operating system, etc.
If you want to try to fix the problem yourself, *don't* just cd to
/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0 and type 'make' or whatever is appropriate.
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '/home/ncohen/.Sage/spkg/build/graphviz-2.16.1.p0' && '/home/ncohen/.Sage/sage' -sh)
When you are done debugging, you can type "exit" to leave the subshell.
************************************************************************
```

Nathann



---

archive/issue_comments_205806.json:
```json
{
    "body": "<a id='comment:14'></a>Hi!\n\nYes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.\n\nWe should probably remove this broken spkg from \"experimental\" ...\n\nCheers,\n                        Nicolas",
    "created_at": "2013-04-02T12:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205806",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>Hi!

Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.

We should probably remove this broken spkg from "experimental" ...

Cheers,
                        Nicolas



---

archive/issue_comments_205807.json:
```json
{
    "body": "<a id='comment:15'></a>> Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.\n\n\n......\n\nwho the hell put that in the doc without removing the package ?...\n\nNathann",
    "created_at": "2013-04-02T12:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205807",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'></a>> Yes, the graphviz spkg is broken (and as far as I can remember has always been). But most linux distro have a graphviz package, so that's not too bad. The doc already says to install graphviz out of Sage.


......

who the hell put that in the doc without removing the package ?...

Nathann



---

archive/issue_comments_205808.json:
```json
{
    "body": "<a id='comment:16'></a>> We should probably remove this broken spkg from \"experimental\" ...\n\n\nIndeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.\n\nAnd it will be quickly reviewed, I swear.\n\nNathann",
    "created_at": "2013-04-02T12:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205808",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>> We should probably remove this broken spkg from "experimental" ...


Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.

And it will be quickly reviewed, I swear.

Nathann



---

archive/issue_comments_205809.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 ncohen]:\n> > We should probably remove this broken spkg from \"experimental\" ...\n\n> \n> Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.\n\n\nI was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\nAs for removing the spkg, this is now: #14398.",
    "created_at": "2013-04-02T13:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205809",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:17'></a>Replying to [comment:16 ncohen]:
> > We should probably remove this broken spkg from "experimental" ...

> 
> Indeed. The only thing to do is update the doc to remove any mention of this graphviz package, and ask Jeroen in a ticket to remove it from experimental.


I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).

As for removing the spkg, this is now: #14398.



---

archive/issue_comments_205810.json:
```json
{
    "body": "<a id='comment:18'></a>> I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\n\nIs written explicitly anywhere that there is no spkg and that the users should install it by themselves ?\n\nNathann",
    "created_at": "2013-04-02T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205810",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>> I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).


Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?

Nathann



---

archive/issue_comments_205811.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-02T13:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205811",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205812.json:
```json
{
    "body": "<a id='comment:19'></a>\n```\n# optional - requires dot2tex and graphviz\n```\nshould be\n\n```\n# optional - dot2tex graphviz\n```",
    "created_at": "2013-04-02T13:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205812",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
```
# optional - requires dot2tex and graphviz
```
should be

```
# optional - dot2tex graphviz
```



---

archive/issue_comments_205813.json:
```json
{
    "body": "<a id='comment:20'></a>(and while you're editing the patch, you included a http link which Sphinx does not understand as one)\n\nNathann",
    "created_at": "2013-04-02T13:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205813",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:20'></a>(and while you're editing the patch, you included a http link which Sphinx does not understand as one)

Nathann



---

archive/issue_comments_205814.json:
```json
{
    "body": "<a id='comment:21'></a>5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).\n\n```\nsage -t --long dot2tex_utils.py\n**********************************************************************\nFile \"dot2tex_utils.py\", line 11, in sage.graphs.dot2tex_utils\nFailed example:\n    output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - requires dot2tex and graphviz\nExpected nothing\nGot:\n    ERROR    Failed to process input\n    Traceback (most recent call last):\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2928, in main\n        s =  conv.convert(dotdata)\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 848, in convert\n        return self.output()\n      File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2566, in output\n        positions[node.name] = map(int, pos.split(','))\n    ValueError: invalid literal for int() with base 10: '87.137'\n**********************************************************************\n```\n\nNathann",
    "created_at": "2013-04-02T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205814",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).

```
sage -t --long dot2tex_utils.py
**********************************************************************
File "dot2tex_utils.py", line 11, in sage.graphs.dot2tex_utils
Failed example:
    output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - requires dot2tex and graphviz
Expected nothing
Got:
    ERROR    Failed to process input
    Traceback (most recent call last):
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2928, in main
        s =  conv.convert(dotdata)
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 848, in convert
        return self.output()
      File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2566, in output
        positions[node.name] = map(int, pos.split(','))
    ValueError: invalid literal for int() with base 10: '87.137'
**********************************************************************
```

Nathann



---

archive/issue_comments_205815.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:18 ncohen]:\n> > I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).\n\n> \n> Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?\n\n\nIt's written that the soft can be downloaded from the graphviz website. This seems explicit enough to me, but if you want to improve that, go ahead (but I would not speak of spkg at all).",
    "created_at": "2013-04-02T13:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205815",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:22'></a>Replying to [comment:18 ncohen]:
> > I was already careful *not* to mention the spkg in the doc (but if you see how to improve the graphviz installation instructions, please go ahead in a separate ticket; I'll review it).

> 
> Is written explicitly anywhere that there is no spkg and that the users should install it by themselves ?


It's written that the soft can be downloaded from the graphviz website. This seems explicit enough to me, but if you want to improve that, go ahead (but I would not speak of spkg at all).



---

archive/issue_comments_205816.json:
```json
{
    "body": "<a id='comment:23'></a>> It's written that the soft can be downloaded from the graphviz website.\n\n\nWhere ?\n\nNathann",
    "created_at": "2013-04-02T13:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205816",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:23'></a>> It's written that the soft can be downloaded from the graphviz website.


Where ?

Nathann



---

archive/issue_comments_205817.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 ncohen]:\n> > It's written that the soft can be downloaded from the graphviz website.\n\n> \n> Where ?\n> \n> Nathann\n\n\ngrep is your friend :-)\n\nSee the method layout_graphviz in generic_graph.",
    "created_at": "2013-04-02T13:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205817",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:24'></a>Replying to [comment:23 ncohen]:
> > It's written that the soft can be downloaded from the graphviz website.

> 
> Where ?
> 
> Nathann


grep is your friend :-)

See the method layout_graphviz in generic_graph.



---

archive/issue_comments_205818.json:
```json
{
    "body": "<a id='comment:25'></a>Attachment [trac_13624-dot2tex-verb_workaround-nt.patch](tarball://root/attachments/some-uuid/ticket13624/trac_13624-dot2tex-verb_workaround-nt.patch) by @nthiery created at 2013-04-02 13:57:48\n\nReplying to [comment:20 ncohen]:\n> (and while you're editing the patch, you included a http link which Sphinx does not understand as one)\n\n\nDone. And added the file to the index.rst. And misc cleanup of the docstrings.",
    "created_at": "2013-04-02T13:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205818",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:25'></a>Attachment [trac_13624-dot2tex-verb_workaround-nt.patch](tarball://root/attachments/some-uuid/ticket13624/trac_13624-dot2tex-verb_workaround-nt.patch) by @nthiery created at 2013-04-02 13:57:48

Replying to [comment:20 ncohen]:
> (and while you're editing the patch, you included a http link which Sphinx does not understand as one)


Done. And added the file to the index.rst. And misc cleanup of the docstrings.



---

archive/issue_comments_205819.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-02T13:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205819",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205820.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-02T14:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205820",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205821.json:
```json
{
    "body": "<a id='comment:27'></a>> grep is your friend :-)\n\n\nCool.\n\n> See the method layout_graphviz in generic_graph.\n\n\nDo we both agree that this is nowhere sufficient ?\n\nHere is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed \n\n```\nsage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##\nsage: sage: output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - dot2tex graphviz ## line 11 ##\nERROR    Could not locate Graphviz binaries\nERROR    Failed to create xdotdata. Is Graphviz installed?\nERROR    Failed to parse the input data. Is it a valid dot file?\nTry to input xdot data directly. Example:\n    dot -Txdot file.dot | dot2tex > file.tex\n\nIf this does not work, check that you have an updated version of PyParsing and\nGraphviz. Users have reported problems with old versions. You can also run\ndot2tex in debug mode using the --debug option:\n    dot2tex --debug file.dot\nA file dot2tex.log will be written to the current directory with detailed\ninformation useful for debugging.\nAn exception has occurred, use %tb to see the full traceback.\n\nSystemExit: 1\n\nTo exit: use 'exit', 'quit', or Ctrl-D\n```\n\nThe error message should redirect the user toward a way to install graphviz I guess. And I have never met \"`SystemExit`\"\nBy the way, do we really need pyparsing ? I thought this did not belong to Sage, and I needed it a couple of days ago.\n\nI reset this ticket to `needs_work` because the doctests from two messages above still do not pass, even with graphviz installed.\n\nNathann",
    "created_at": "2013-04-02T14:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205821",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:27'></a>> grep is your friend :-)


Cool.

> See the method layout_graphviz in generic_graph.


Do we both agree that this is nowhere sufficient ?

Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed 

```
sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##
sage: sage: output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - dot2tex graphviz ## line 11 ##
ERROR    Could not locate Graphviz binaries
ERROR    Failed to create xdotdata. Is Graphviz installed?
ERROR    Failed to parse the input data. Is it a valid dot file?
Try to input xdot data directly. Example:
    dot -Txdot file.dot | dot2tex > file.tex

If this does not work, check that you have an updated version of PyParsing and
Graphviz. Users have reported problems with old versions. You can also run
dot2tex in debug mode using the --debug option:
    dot2tex --debug file.dot
A file dot2tex.log will be written to the current directory with detailed
information useful for debugging.
An exception has occurred, use %tb to see the full traceback.

SystemExit: 1

To exit: use 'exit', 'quit', or Ctrl-D
```

The error message should redirect the user toward a way to install graphviz I guess. And I have never met "`SystemExit`"
By the way, do we really need pyparsing ? I thought this did not belong to Sage, and I needed it a couple of days ago.

I reset this ticket to `needs_work` because the doctests from two messages above still do not pass, even with graphviz installed.

Nathann



---

archive/issue_comments_205822.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:21 ncohen]:\n> 5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).\n\n\nThis is a bug in dot2tex. It's fixed in the dev branch since two years. I was waiting the official release to make a new spkg, but it seems to be taking some time ...\n\nOh well, I uploaded my dev spkg and updated the instructions in #7004. And updated a bit the docstring in the patch as well.\n\nNote: I had to wipe by hand the dot2tex directory before reinstalling dot2tex for things to work:\n\n```\nrm -rf /opt/sage-5.9.beta2/local/lib/python2.7/site-packages/dot2tex\n```",
    "created_at": "2013-04-02T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205822",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:28'></a>Replying to [comment:21 ncohen]:
> 5 doctests fail on my machine. The error message do not seem to say that there is something wrong with my install (dot or graphviz which I installed through my distro).


This is a bug in dot2tex. It's fixed in the dev branch since two years. I was waiting the official release to make a new spkg, but it seems to be taking some time ...

Oh well, I uploaded my dev spkg and updated the instructions in #7004. And updated a bit the docstring in the patch as well.

Note: I had to wipe by hand the dot2tex directory before reinstalling dot2tex for things to work:

```
rm -rf /opt/sage-5.9.beta2/local/lib/python2.7/site-packages/dot2tex
```



---

archive/issue_comments_205823.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 ncohen]:\n> > See the method layout_graphviz in generic_graph.\n\n> \n> Do we both agree that this is nowhere sufficient ?\n> \n> Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed \n> \n> \n> ```\n> sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##\n> sage: sage: output = dot2tex.dot2tex(graph, format=\"positions\", prog=\"neato\") # optional - dot2tex graphviz ## line 11 ##\n> ERROR    Could not locate Graphviz binaries\n> ERROR    Failed to create xdotdata. Is Graphviz installed?\n> ERROR    Failed to parse the input data. Is it a valid dot file?\n> Try to input xdot data directly. Example:\n>     dot -Txdot file.dot | dot2tex > file.tex\n> \n> If this does not work, check that you have an updated version of PyParsing and\n> Graphviz. Users have reported problems with old versions. You can also run\n> dot2tex in debug mode using the --debug option:\n>     dot2tex --debug file.dot\n> A file dot2tex.log will be written to the current directory with detailed\n> information useful for debugging.\n> An exception has occurred, use %tb to see the full traceback.\n> \n> SystemExit: 1\n> \n> To exit: use 'exit', 'quit', or Ctrl-D\n> ```\n> \n> The error message should redirect the user toward a way to install graphviz I guess. And I have never met \"`SystemExit`\"\n\n\nI agree this is ugly, but that's a problem with dot2tex, not with Sage\n(feel free to report!). Any Sage code using dot2tex should call\nassert_have_doc2tex.\n\n> By the way, do we really need pyparsing ? I thought this did not\n> belong to Sage, and I needed it a couple of days ago.\n\n\nNo clue.",
    "created_at": "2013-04-02T14:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205823",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:29'></a>Replying to [comment:27 ncohen]:
> > See the method layout_graphviz in generic_graph.

> 
> Do we both agree that this is nowhere sufficient ?
> 
> Here is what happens when some code that requires graphviz (and which does not use layout_graphviz) is executed wihout graphviz installed 
> 
> 
> ```
> sage: sage: import dot2tex                                                    # optional - dot2tex graphviz ## line 10 ##
> sage: sage: output = dot2tex.dot2tex(graph, format="positions", prog="neato") # optional - dot2tex graphviz ## line 11 ##
> ERROR    Could not locate Graphviz binaries
> ERROR    Failed to create xdotdata. Is Graphviz installed?
> ERROR    Failed to parse the input data. Is it a valid dot file?
> Try to input xdot data directly. Example:
>     dot -Txdot file.dot | dot2tex > file.tex
> 
> If this does not work, check that you have an updated version of PyParsing and
> Graphviz. Users have reported problems with old versions. You can also run
> dot2tex in debug mode using the --debug option:
>     dot2tex --debug file.dot
> A file dot2tex.log will be written to the current directory with detailed
> information useful for debugging.
> An exception has occurred, use %tb to see the full traceback.
> 
> SystemExit: 1
> 
> To exit: use 'exit', 'quit', or Ctrl-D
> ```
> 
> The error message should redirect the user toward a way to install graphviz I guess. And I have never met "`SystemExit`"


I agree this is ugly, but that's a problem with dot2tex, not with Sage
(feel free to report!). Any Sage code using dot2tex should call
assert_have_doc2tex.

> By the way, do we really need pyparsing ? I thought this did not
> belong to Sage, and I needed it a couple of days ago.


No clue.



---

archive/issue_comments_205824.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-02T14:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205824",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205825.json:
```json
{
    "body": "<a id='comment:31'></a>> I agree this is ugly, but that's a problem with dot2tex, not with Sage\n> (feel free to report!). Any Sage code using dot2tex should call\n> assert_have_doc2tex.\n\n\nThis one doesn't ?\n\nNathann",
    "created_at": "2013-04-02T14:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205825",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:31'></a>> I agree this is ugly, but that's a problem with dot2tex, not with Sage
> (feel free to report!). Any Sage code using dot2tex should call
> assert_have_doc2tex.


This one doesn't ?

Nathann



---

archive/issue_comments_205826.json:
```json
{
    "body": "<a id='comment:32'></a>Oh. dot2tex is a Python spkg. Explains a lot, sorry `:-P`\n\nNathann",
    "created_at": "2013-04-02T14:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205826",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:32'></a>Oh. dot2tex is a Python spkg. Explains a lot, sorry `:-P`

Nathann



---

archive/issue_comments_205827.json:
```json
{
    "body": "<a id='comment:33'></a>Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.\n\nNathann",
    "created_at": "2013-04-02T14:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205827",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:33'></a>Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.

Nathann



---

archive/issue_comments_205828.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+The following is ok :\n \n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(3333, 88, 'my_label')\n+sage: G.set_latex_options(format='dot2tex')\n+sage: view(G)\n+```\n+\n+but with `edges_labels=True` a KeyError is raised :\n+\n+```\n+sage: G.set_latex_options(edge_labels=True)\n+sage: view(G)\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '3333880'\n+```\n+\n+The error is also raised by `dot2tex_picture` method:\n+\n+```\n+sage: G = DiGraph()\n+sage: G.add_edge(0, 1, 'p0')\n+sage: G.latex_options().dot2tex_picture()\n+'\\n\\\\begin{tikzpicture}[>=latex,line join=bevel,]\\n%%\\n\\\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\\n  \\\\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\\n  \\\\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\\n%\\n\\\\end{tikzpicture}\\n'\n+.dot2tex_picture()\n+sage: G.set_latex_options(edge_labels=True)\n+sage: G.latex_options().dot2tex_picture()\n+ERROR    Failed to process input\n+Traceback (most recent call last):\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 2939, in main\n+    s =  conv.convert(dotdata)\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 794, in convert\n+    return self.do_preview_preproc()\n+  File \"/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py\", line 1167, in do_preview_preproc\n+    hp,dp,wt = pp.texdims[name]\n+KeyError: '010'\n+''\n+```\n+\n+This is due to dot2tex currently not supporting '\\verb' properly. \n+\n+The attached patch works around this by replacing \\verb by \\text, and stripping out tricky characters like `^` and `_`.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-04-02T14:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205828",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,53 @@
+The following is ok :
 
+```
+sage: G = DiGraph()
+sage: G.add_edge(3333, 88, 'my_label')
+sage: G.set_latex_options(format='dot2tex')
+sage: view(G)
+```
+
+but with `edges_labels=True` a KeyError is raised :
+
+```
+sage: G.set_latex_options(edge_labels=True)
+sage: view(G)
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '3333880'
+```
+
+The error is also raised by `dot2tex_picture` method:
+
+```
+sage: G = DiGraph()
+sage: G.add_edge(0, 1, 'p0')
+sage: G.latex_options().dot2tex_picture()
+'\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (1) at (6bp,7bp) [draw,draw=none] {$1$};\n  \\node (0) at (6bp,57bp) [draw,draw=none] {$0$};\n  \\draw [black,->] (0) ..controls (6bp,44.053bp) and (6bp,33.103bp)  .. (1);\n%\n\\end{tikzpicture}\n'
+.dot2tex_picture()
+sage: G.set_latex_options(edge_labels=True)
+sage: G.latex_options().dot2tex_picture()
+ERROR    Failed to process input
+Traceback (most recent call last):
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 2939, in main
+    s =  conv.convert(dotdata)
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 794, in convert
+    return self.do_preview_preproc()
+  File "/Users/slabbe/Applications/sage-5.2/local/lib/python2.7/site-packages/dot2tex/dot2tex.py", line 1167, in do_preview_preproc
+    hp,dp,wt = pp.texdims[name]
+KeyError: '010'
+''
+```
+
+This is due to dot2tex currently not supporting '\verb' properly. 
+
+The attached patch works around this by replacing \verb by \text, and stripping out tricky characters like `^` and `_`.
 
 Comment: 1
 
``````




---

archive/issue_comments_205829.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-02T14:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205829",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_205830.json:
```json
{
    "body": "<a id='comment:35'></a>And I had not noticed that you had not answered my rethorical question :\n\n>> See the method layout_graphviz in generic_graph.\n\n> Do we both agree that this is nowhere sufficient ?\n\nNathann",
    "created_at": "2013-04-02T14:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205830",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:35'></a>And I had not noticed that you had not answered my rethorical question :

>> See the method layout_graphviz in generic_graph.

> Do we both agree that this is nowhere sufficient ?

Nathann



---

archive/issue_comments_205831.json:
```json
{
    "body": "<a id='comment:36'></a>Nicolas, could you add the following doctest to your patch to make sure the issue do not come up again in the future?\n\n```\nWe make sure :trac:`13624` is fixed::\n\n    sage: G = DiGraph()\n    sage: G.add_edge(3333, 88, 'my_label')\n    sage: G.set_latex_options(format='dot2tex')\n    sage: G.set_latex_options(edge_labels=True)\n    sage: G.latex_options().dot2tex_picture()  # optional - dot2tex graphviz\n    \\begin{tikzpicture}\n    first_line?\n    ...\n    last_line?\n    \\end{tikzpicture}\n```\n\nI don't really know where to put the information about where and how to download graphviz and dot2tex. In fact, there are many entry points for the user:\n\n- `G.set_latex_options`\n- `G.latex_options`\n- `G.latex_options().dot2tex_picture`\n- `G.latex_options().set_option`    <- it might be strange, but a lot of doc is in here\n- `G.latex_options().set_options`\n- `G.latex_options().latex`\n\nIt is hard to know where the user will first have the idea that installing graphviz + dot2tex could be nice. Personnaly, I found once that information here :\n\n- `G.layout_graphviz?`\n\nHere is what it says :\n\n```\nThis requires \"graphviz\" and the \"dot2tex\" spkg. Here are some    \ninstallation tips:                                                \n                                                                  \n   * Install graphviz >= 2.14 so that the programs dot, neato, ...\n     are in your path. The graphviz suite can be download from    \n     http://graphviz.org.                                         \n                                                                  \n   * Download dot2tex-2.8.?.spkg from                             \n     http://trac.sagemath.org/sage_trac/ticket/7004 and install it\n     with \"sage -i dot2tex-2.8.?.spkg\"                            \n```\n\nThis does not speak about any graphviz spkg. In fact, I did not know there was one. When I saw that doc in the past, I was then able to install graphviz properly.\n\nThe information about the dot2tex spgk is obsolete. I suggest to replace it by :\n\n```\n   * Get the name of the most recent version of dot2tex from\n     the sage command ``optional_packages()``. Then,\n     install it with ``sage -i dot2tex-2.8.?.spkg``. \n```",
    "created_at": "2013-04-02T16:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205831",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:36'></a>Nicolas, could you add the following doctest to your patch to make sure the issue do not come up again in the future?

```
We make sure :trac:`13624` is fixed::

    sage: G = DiGraph()
    sage: G.add_edge(3333, 88, 'my_label')
    sage: G.set_latex_options(format='dot2tex')
    sage: G.set_latex_options(edge_labels=True)
    sage: G.latex_options().dot2tex_picture()  # optional - dot2tex graphviz
    \begin{tikzpicture}
    first_line?
    ...
    last_line?
    \end{tikzpicture}
```

I don't really know where to put the information about where and how to download graphviz and dot2tex. In fact, there are many entry points for the user:

- `G.set_latex_options`
- `G.latex_options`
- `G.latex_options().dot2tex_picture`
- `G.latex_options().set_option`    <- it might be strange, but a lot of doc is in here
- `G.latex_options().set_options`
- `G.latex_options().latex`

It is hard to know where the user will first have the idea that installing graphviz + dot2tex could be nice. Personnaly, I found once that information here :

- `G.layout_graphviz?`

Here is what it says :

```
This requires "graphviz" and the "dot2tex" spkg. Here are some    
installation tips:                                                
                                                                  
   * Install graphviz >= 2.14 so that the programs dot, neato, ...
     are in your path. The graphviz suite can be download from    
     http://graphviz.org.                                         
                                                                  
   * Download dot2tex-2.8.?.spkg from                             
     http://trac.sagemath.org/sage_trac/ticket/7004 and install it
     with "sage -i dot2tex-2.8.?.spkg"                            
```

This does not speak about any graphviz spkg. In fact, I did not know there was one. When I saw that doc in the past, I was then able to install graphviz properly.

The information about the dot2tex spgk is obsolete. I suggest to replace it by :

```
   * Get the name of the most recent version of dot2tex from
     the sage command ``optional_packages()``. Then,
     install it with ``sage -i dot2tex-2.8.?.spkg``. 
```



---

archive/issue_comments_205832.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:33 ncohen]:\n> Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.\n\n\nHave you installed the new spkg as I pointed out in my previous comment?",
    "created_at": "2013-04-02T16:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205832",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:37'></a>Replying to [comment:33 ncohen]:
> Anyway why do you set this ticket to `needs_review`. I said twice that the doctests do not pass even with graphviz installed.


Have you installed the new spkg as I pointed out in my previous comment?



---

archive/issue_comments_205833.json:
```json
{
    "body": "<a id='comment:38'></a>Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.\n\nNathann: if you want patches to get in Sage quickly, don't keep expanding tickets beyond their original scope.",
    "created_at": "2013-04-02T16:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205833",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:38'></a>Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.

Nathann: if you want patches to get in Sage quickly, don't keep expanding tickets beyond their original scope.



---

archive/issue_comments_205834.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:35 ncohen]:\n> And I had not noticed that you had not answered my rethorical question :\n> \n> >> See the method layout_graphviz in generic_graph.\n\n> > Do we both agree that this is nowhere sufficient ?\n\nCertainly not great. Certainly out of scope for this ticket.",
    "created_at": "2013-04-02T17:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205834",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:39'></a>Replying to [comment:35 ncohen]:
> And I had not noticed that you had not answered my rethorical question :
> 
> >> See the method layout_graphviz in generic_graph.

> > Do we both agree that this is nowhere sufficient ?

Certainly not great. Certainly out of scope for this ticket.



---

archive/issue_comments_205835.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:38 nthiery]:\n> Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.\n\n\nSorry, I will propose a patch soon which apply on yours that will implement what I suggested. I can't do it now as the version of Sage I have now (sage-5.7.beta4) is too old: I get a conflict with the patch.\n\nS\u00e9bastien",
    "created_at": "2013-04-02T17:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205835",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:40'></a>Replying to [comment:38 nthiery]:
> Ok guys, I have used up my time on this patch. I need to move on. Feel free to takeover.


Sorry, I will propose a patch soon which apply on yours that will implement what I suggested. I can't do it now as the version of Sage I have now (sage-5.7.beta4) is too old: I get a conflict with the patch.

Sébastien



---

archive/issue_comments_205836.json:
```json
{
    "body": "<a id='comment:41'></a>> > > Do we both agree that this is nowhere sufficient ?\n\n> \n> Certainly not great. Certainly out of scope for this ticket.\n\n\nThen find somebody else to review it. I refuse to be part of this mess.\n\nNathann",
    "created_at": "2013-04-02T20:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205836",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:41'></a>> > > Do we both agree that this is nowhere sufficient ?

> 
> Certainly not great. Certainly out of scope for this ticket.


Then find somebody else to review it. I refuse to be part of this mess.

Nathann



---

archive/issue_comments_205837.json:
```json
{
    "body": "<a id='comment:42'></a>Ils sont fous ces romains...\n\nReplying to [comment:37 nthiery]:\n> Have you installed the new spkg as I pointed out in my previous comment?\n\n\nI think it is better not to update the old ticket #7004. Here is the link to the new spkg:\n\n```\nsage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-dev.spkg\n```",
    "created_at": "2013-04-02T22:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205837",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:42'></a>Ils sont fous ces romains...

Replying to [comment:37 nthiery]:
> Have you installed the new spkg as I pointed out in my previous comment?


I think it is better not to update the old ticket #7004. Here is the link to the new spkg:

```
sage -f http://sage.math.washington.edu/home/nthiery/dot2tex-2.8.7-dev.spkg
```



---

archive/issue_comments_205838.json:
```json
{
    "body": "<a id='comment:43'></a>I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.\n\nFinally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.\n\n```\nsage: g = digraphs.ButterflyGraph(2)\nsage: g.plot(layout = \"graphviz\", prog = \"neato\") # optional - dot2tex, graphviz\nTraceback (most recent call last): \n...\nValueError: invalid literal for int() with base 10: '67.297'\n```",
    "created_at": "2013-04-03T14:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205838",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:43'></a>I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.

Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.

```
sage: g = digraphs.ButterflyGraph(2)
sage: g.plot(layout = "graphviz", prog = "neato") # optional - dot2tex, graphviz
Traceback (most recent call last): 
...
ValueError: invalid literal for int() with base 10: '67.297'
```



---

archive/issue_comments_205839.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 slabbe]:\n> I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.\n\n\nThanks S\u00e9bastien! I looked at your reviewer patch, and it looks good to me. Let's see what the patchbot says. Back to needs review for the first patch.\n\n> Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.\n> \n> \n> ```\n> sage: g = digraphs.ButterflyGraph(2)\n> sage: g.plot(layout = \"graphviz\", prog = \"neato\") # optional - dot2tex, graphviz\n> Traceback (most recent call last): \n> ...\n> ValueError: invalid literal for int() with base 10: '67.297'\n> ```\n\n\n+1 since the tests were already failing before this ticket. This is\nnow #14408 which is about updating the dot2tex spkg.",
    "created_at": "2013-04-03T15:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205839",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:44'></a>Replying to [comment:43 slabbe]:
> I just added a patch which fixes the broken doctests seen by the patchbot. I also added a doctest that make sure the issue of this ticket is solved. I also fixed an # optional - dot2tex, graphviz which was not up to date.


Thanks Sébastien! I looked at your reviewer patch, and it looks good to me. Let's see what the patchbot says. Back to needs review for the first patch.

> Finally I realize that some optional test are broken. Like this one that we can see in the doc of `layout_graphviz`. This may be considered in another ticket.
> 
> 
> ```
> sage: g = digraphs.ButterflyGraph(2)
> sage: g.plot(layout = "graphviz", prog = "neato") # optional - dot2tex, graphviz
> Traceback (most recent call last): 
> ...
> ValueError: invalid literal for int() with base 10: '67.297'
> ```


+1 since the tests were already failing before this ticket. This is
now #14408 which is about updating the dot2tex spkg.



---

archive/issue_comments_205840.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-03T15:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205840",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_205841.json:
```json
{
    "body": "<a id='comment:45'></a>For the record, current installation instructions for dot2tex are outdated (I tried the example from the description and it failed at first).\n\nWith the current patch at #14382, the example from the description does not give errors.",
    "created_at": "2013-04-17T20:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205841",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:45'></a>For the record, current installation instructions for dot2tex are outdated (I tried the example from the description and it failed at first).

With the current patch at #14382, the example from the description does not give errors.



---

archive/issue_comments_205842.json:
```json
{
    "body": "Adding a doctest to make sure the initial issue is fixed",
    "created_at": "2013-06-03T08:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205842",
    "user": "https://github.com/seblabbe"
}
```

Adding a doctest to make sure the initial issue is fixed



---

archive/issue_comments_205843.json:
```json
{
    "body": "<a id='comment:46'></a>Attachment [trac_13624-review-sl.patch](tarball://root/attachments/some-uuid/ticket13624/trac_13624-review-sl.patch) by @seblabbe created at 2013-06-03 08:34:29\n\nI just updated my patch which adds a doctest. Even if #14382 finally fix the problem, I think it could be merged anyway.\n\nI removed the part that was fixing dot2tex optional doctests errors. I will move this part in another patch that I am going to post on #14408 where similar issues were discussed.",
    "created_at": "2013-06-03T08:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205843",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:46'></a>Attachment [trac_13624-review-sl.patch](tarball://root/attachments/some-uuid/ticket13624/trac_13624-review-sl.patch) by @seblabbe created at 2013-06-03 08:34:29

I just updated my patch which adds a doctest. Even if #14382 finally fix the problem, I think it could be merged anyway.

I removed the part that was fixing dot2tex optional doctests errors. I will move this part in another patch that I am going to post on #14408 where similar issues were discussed.



---

archive/issue_comments_205844.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 slabbe]:\n> Even if #14382 finally fix the problem,\n\n\nFeel free to give it a try and set to positive review - it is not big ;-)",
    "created_at": "2013-06-03T14:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205844",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:47'></a>Replying to [comment:46 slabbe]:
> Even if #14382 finally fix the problem,


Feel free to give it a try and set to positive review - it is not big ;-)



---

archive/issue_events_037997.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13624#event-37997"
}
```



---

archive/issue_events_037998.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13624#event-37998"
}
```



---

archive/issue_events_037999.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13624#event-37999"
}
```



---

archive/issue_comments_205845.json:
```json
{
    "body": "<a id='comment:50'></a>Currently in `6.2.rc0`, the example given in the description works (probably from #14382):\n\n```\nsage: G = DiGraph()\nsage: G.add_edge(333, 88, \"my_label\")\nsage: G.set_latex_options(format=\"dot2tex\", edge_labels=True)\nsage: latex(G)\n\n\\begin{tikzpicture}[>=latex,line join=bevel,]\n%%\n\\node (node_1) at (11.000000bp,79.000000bp) [draw,draw=none] {$333$};\n  \\node (node_0) at (11.000000bp,7.000000bp) [draw,draw=none] {$88$};\n  \\draw [black,->] (node_1) ..controls (11.000000bp,61.481000bp) and (11.000000bp,39.548000bp)  .. (node_0);\n  \\definecolor{strokecol}{rgb}{0.0,0.0,0.0};\n  \\pgfsetstrokecolor{strokecol}\n  \\draw (38.000000bp,43.000000bp) node {$\\text{\\texttt{my{\\char`\\_}label}}$};\n%\n\\end{tikzpicture}\n```\nSo how much of this ticket should we keep or should we just close as a \"works-for-me\"?",
    "created_at": "2014-04-26T12:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205845",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>Currently in `6.2.rc0`, the example given in the description works (probably from #14382):

```
sage: G = DiGraph()
sage: G.add_edge(333, 88, "my_label")
sage: G.set_latex_options(format="dot2tex", edge_labels=True)
sage: latex(G)

\begin{tikzpicture}[>=latex,line join=bevel,]
%%
\node (node_1) at (11.000000bp,79.000000bp) [draw,draw=none] {$333$};
  \node (node_0) at (11.000000bp,7.000000bp) [draw,draw=none] {$88$};
  \draw [black,->] (node_1) ..controls (11.000000bp,61.481000bp) and (11.000000bp,39.548000bp)  .. (node_0);
  \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
  \pgfsetstrokecolor{strokecol}
  \draw (38.000000bp,43.000000bp) node {$\text{\texttt{my{\char`\_}label}}$};
%
\end{tikzpicture}
```
So how much of this ticket should we keep or should we just close as a "works-for-me"?



---

archive/issue_comments_205846.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-04-26T12:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205846",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_205847.json:
```json
{
    "body": "<a id='comment:51'></a>> So how much of this ticket should we keep or should we just close as a \"works-for-me\"?\n\n\nAs I suggested in a previous comment, I think we could merge the patch `trac_13624-review-sl.patch` which simply adds a doctest.\n\nS\u00e9bastien",
    "created_at": "2014-04-27T21:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205847",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:51'></a>> So how much of this ticket should we keep or should we just close as a "works-for-me"?


As I suggested in a previous comment, I think we could merge the patch `trac_13624-review-sl.patch` which simply adds a doctest.

Sébastien



---

archive/issue_comments_205848.json:
```json
{
    "body": "Changing commit from \"\" to \"26345009b7d0063c3cbb24b5cbf54f8a911b28fb\"",
    "created_at": "2014-04-30T09:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205848",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "26345009b7d0063c3cbb24b5cbf54f8a911b28fb"



---

archive/issue_comments_205849.json:
```json
{
    "body": "<a id='comment:52'></a>I just converted my old hg patch to a git branch. It should be easy to review as it only adds a doctest since the problem was fixed by #14382.\n\n---\nNew commits:",
    "created_at": "2014-04-30T09:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205849",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:52'></a>I just converted my old hg patch to a git branch. It should be easy to review as it only adds a doctest since the problem was fixed by #14382.

---
New commits:



---

archive/issue_comments_205850.json:
```json
{
    "body": "Changing branch from \"\" to \"u/slabbe/13624\"",
    "created_at": "2014-04-30T09:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205850",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "" to "u/slabbe/13624"



---

archive/issue_comments_205851.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-04-30T09:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205851",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_205852.json:
```json
{
    "body": "Changing author from \"Nicolas M. Thi\u00e9ry\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2014-04-30T09:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205852",
    "user": "https://github.com/seblabbe"
}
```

Changing author from "Nicolas M. Thiéry" to "Sébastien Labbé"



---

archive/issue_comments_205853.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Christian Stump\"",
    "created_at": "2014-04-30T09:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205853",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing reviewer from "" to "Christian Stump"



---

archive/issue_comments_205854.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-30T09:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205854",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_205855.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-01T10:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205855",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_038000.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-01T10:18:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13624#event-38000"
}
```



---

archive/issue_comments_205856.json:
```json
{
    "body": "Changing branch from \"u/slabbe/13624\" to \"26345009b7d0063c3cbb24b5cbf54f8a911b28fb\"",
    "created_at": "2014-05-01T10:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13624#issuecomment-205856",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slabbe/13624" to "26345009b7d0063c3cbb24b5cbf54f8a911b28fb"
