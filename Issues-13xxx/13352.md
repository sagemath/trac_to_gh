# Issue 13352: Running time improvement of the bitset_len method

archive/issues_013180.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout"
    ],
    "body": "This patch improves the running time of the `bitset_len` method by using `mpn_popcount()`.\n\nBefore:\n\n```\nsage: B = Bitset('10'*10000)\nsage: len(B)\n10000\nsage: %timeit len(B)\n1000 loops, best of 3: 245 us per loop\n```\n\nAfter:\n\n```\nsage: B = Bitset('10'*10000)\nsage: len(B)\n10000\nsage: %timeit len(B)\n100000 loops, best of 3: 2.52 us per loop\n```\n\nThis patch also reorganizes the bitset files, including deleting the `sage/misc/bitset_pxd.pxi` file.\n\nAPPLY:\n\n* [attachment: trac_13352_bitset_len_v4.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)\n\nCC:  @nathanncohen @nexttime\n\nReviewer: **David Coudert**\n\nAuthor: **David Coudert, Jeroen Demeyer**\n\nMerged: **sage-5.13.rc0**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13352_\n\n",
    "closed_at": "2013-12-11T11:02:53Z",
    "created_at": "2012-08-08T23:19:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Running time improvement of the bitset_len method",
    "type": "issue",
    "updated_at": "2014-09-05T13:37:22Z",
    "url": "https://github.com/sagemath/sage/issues/13352",
    "user": "https://github.com/dcoudert"
}
```
This patch improves the running time of the `bitset_len` method by using `mpn_popcount()`.

Before:

```
sage: B = Bitset('10'*10000)
sage: len(B)
10000
sage: %timeit len(B)
1000 loops, best of 3: 245 us per loop
```

After:

```
sage: B = Bitset('10'*10000)
sage: len(B)
10000
sage: %timeit len(B)
100000 loops, best of 3: 2.52 us per loop
```

This patch also reorganizes the bitset files, including deleting the `sage/misc/bitset_pxd.pxi` file.

APPLY:

* [attachment: trac_13352_bitset_len_v4.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)

CC:  @nathanncohen @nexttime

Reviewer: **David Coudert**

Author: **David Coudert, Jeroen Demeyer**

Merged: **sage-5.13.rc0**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/13352_





---

archive/issue_events_187141.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:19:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187141"
}
```



---

archive/issue_events_187142.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:19:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187142"
}
```



---

archive/issue_events_187143.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:19:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187143"
}
```



---

archive/issue_events_187144.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-08-08T23:19:17Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "subject": "https://github.com/dcoudert",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187144"
}
```



---

archive/issue_events_187145.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:56:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187145"
}
```



---

archive/issue_comments_154840.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'd rather \"implement\" the functions in C (where you can use the C preprocessor and `__builtin_popcount()` if available) and write a thin Cython wrapper.\n\nGCC e.g. chooses efficient machine implementations (probably a single instruction), depending on the (configured or specified) target and perhaps also further compiler flags.\n\nNote that GMP has functions like `mpz_popcount()` for `mpz_t`s as well.\n\n\n---\n\nNot sure what the `parallel` refers to ... ;-)",
    "created_at": "2012-08-09T14:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154840",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

I'd rather "implement" the functions in C (where you can use the C preprocessor and `__builtin_popcount()` if available) and write a thin Cython wrapper.

GCC e.g. chooses efficient machine implementations (probably a single instruction), depending on the (configured or specified) target and perhaps also further compiler flags.

Note that GMP has functions like `mpz_popcount()` for `mpz_t`s as well.


---

Not sure what the `parallel` refers to ... ;-)



---

archive/issue_comments_154841.json:
```json
{
    "body": "trials not working",
    "created_at": "2012-08-09T14:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154841",
    "user": "https://github.com/dcoudert"
}
```

trials not working



---

archive/issue_comments_154842.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -33,3 +33,9 @@\n \n The alternative would be to use functions `__builtin_popcount()` and `__builtin_popcountll()`. They are extremely fast but they required to add flag ``-mpopcnt`` or ``-msse4.2`` to the gcc compiler. Can we do that? how? \n \n+\n+APPLY:\n+\n+* trac_13352_bitset_len.patch\n+\n+\n``````\n",
    "created_at": "2012-08-09T15:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154842",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -33,3 +33,9 @@
 
 The alternative would be to use functions `__builtin_popcount()` and `__builtin_popcountll()`. They are extremely fast but they required to add flag ``-mpopcnt`` or ``-msse4.2`` to the gcc compiler. Can we do that? how? 
 
+
+APPLY:
+
+* trac_13352_bitset_len.patch
+
+
``````




---

archive/issue_comments_154843.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_13352-bitcount-in-c.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352-bitcount-in-c.patch.gz)**\n\nReplying to [@nexttime](#comment:2):\n> I'd rather \"implement\" the functions in C (where you can use the C preprocessor and `__builtin_popcount()` if available) and write a thin Cython wrapper.\n> \n> GCC e.g. chooses efficient machine implementations (probably a single instruction), depending on the (configured or specified) target and perhaps also further compiler flags.\n\nAs reported in https://groups.google.com/forum/#!topic/sage-devel/GnudTUwbGG4, I tried to implement the function in C with `__builtin_popcount()`. I was able to compile successfully, but then sage was not working anymore.\nSee attached patch [attachment: trac_13352-bitcount-in-c.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352-bitcount-in-c.patch.gz).\n\n\n> Note that GMP has functions like `mpz_popcount()` for `mpz_t`s as well.\n\nIt could be another solution, but I have not been able yet to find how to access the functions used for int behind? \n\n\n> Not sure what the `parallel` refers to ... ;-)\n\nIn fact, the 4 lines ` n = __COUNT32__(n, 0) ` can be executed in parallel and gcc is sometimes able to optimize the sequence of instructions. For instance, all methods have similar running times on my macbook air, but parallel methods are slower on my old PC (system still in 32-bits...).",
    "created_at": "2012-08-09T15:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154843",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_13352-bitcount-in-c.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352-bitcount-in-c.patch.gz)**

Replying to [@nexttime](#comment:2):
> I'd rather "implement" the functions in C (where you can use the C preprocessor and `__builtin_popcount()` if available) and write a thin Cython wrapper.
> 
> GCC e.g. chooses efficient machine implementations (probably a single instruction), depending on the (configured or specified) target and perhaps also further compiler flags.

As reported in https://groups.google.com/forum/#!topic/sage-devel/GnudTUwbGG4, I tried to implement the function in C with `__builtin_popcount()`. I was able to compile successfully, but then sage was not working anymore.
See attached patch [attachment: trac_13352-bitcount-in-c.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352-bitcount-in-c.patch.gz).


> Note that GMP has functions like `mpz_popcount()` for `mpz_t`s as well.

It could be another solution, but I have not been able yet to find how to access the functions used for int behind? 


> Not sure what the `parallel` refers to ... ;-)

In fact, the 4 lines ` n = __COUNT32__(n, 0) ` can be executed in parallel and gcc is sometimes able to optimize the sequence of instructions. For instance, all methods have similar running times on my macbook air, but parallel methods are slower on my old PC (system still in 32-bits...).



---

archive/issue_comments_154844.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -36,6 +36,6 @@\n \n APPLY:\n \n-* trac_13352_bitset_len.patch\n+* [attachment: trac_13352_bitset_len.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)\n \n \n``````\n",
    "created_at": "2012-08-09T15:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154844",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -36,6 +36,6 @@
 
 APPLY:
 
-* trac_13352_bitset_len.patch
+* [attachment: trac_13352_bitset_len.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)
 
 
``````




---

archive/issue_comments_154845.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@dcoudert](#comment:3):\n> Replying to [@nexttime](#comment:2):\n> > Not sure what the `parallel` refers to ... ;-)\n\n> In fact, the 4 lines ` n = __COUNT32__(n, 0) ` can be executed in parallel\n\nWell, obviously not, since you have the data dependence on `n`. ;-)\n\n\n\n\n\nBtw., you should use `UINT32_C(1)` instead of `0x1u` etc., and e.g. `UINT32_MAX` instead of `(<uint32_t>-1)` (Cython code) etc.\n\nThe types of the shift parameters (of `__TWO??__()`) are slightly overdim'ed...",
    "created_at": "2012-08-09T18:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154845",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@dcoudert](#comment:3):
> Replying to [@nexttime](#comment:2):
> > Not sure what the `parallel` refers to ... ;-)

> In fact, the 4 lines ` n = __COUNT32__(n, 0) ` can be executed in parallel

Well, obviously not, since you have the data dependence on `n`. ;-)





Btw., you should use `UINT32_C(1)` instead of `0x1u` etc., and e.g. `UINT32_MAX` instead of `(<uint32_t>-1)` (Cython code) etc.

The types of the shift parameters (of `__TWO??__()`) are slightly overdim'ed...



---

archive/issue_comments_154846.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI'm able to import UINT32_MAX, but not UINT32_C.\n- with `from libc.stdint cimport UINT32_C`: it is apparently not imported\n- with `from libc.stdint import UINT32_C`: it compiles, but sage crashes with weird messages\n\nAny special trick?",
    "created_at": "2012-08-09T20:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154846",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

I'm able to import UINT32_MAX, but not UINT32_C.
- with `from libc.stdint cimport UINT32_C`: it is apparently not imported
- with `from libc.stdint import UINT32_C`: it compiles, but sage crashes with weird messages

Any special trick?



---

archive/issue_events_187146.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187146"
}
```



---

archive/issue_events_187147.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187147"
}
```



---

archive/issue_comments_154847.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_13352_bitset_len.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)**",
    "created_at": "2013-08-13T15:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154847",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_13352_bitset_len.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)**



---

archive/issue_comments_154848.json:
```json
{
    "body": "Attachment: **[trac_13352_bitset_len_v2.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)**",
    "created_at": "2013-08-18T14:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154848",
    "user": "https://github.com/dcoudert"
}
```

Attachment: **[trac_13352_bitset_len_v2.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)**



---

archive/issue_comments_154849.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHello,\n\nSince I have now understood how to use `__builtin_popcountl` (not obvious when you don't know), I have uploaded a new version of the patch.\n\nbefore:\n\n```\nsage: B = Bitset('00'*10000+'1')\nsage: len(B)\n1\nsage: %timeit len(B)\n1000000 loops, best of 3: 268 ns per loop\nsage: B = Bitset('10'*10000)\nsage: len(B)\n10000\nsage: %timeit len(B)\n1000 loops, best of 3: 245 us per loop\nsage: B = Bitset('10'*1000000)\nsage: len(B)\n1000000\nsage: %timeit len(B)\n10 loops, best of 3: 24.1 ms per loop\n```\n\nafter:\n\n```\nsage: B = Bitset('00'*10000+'1')\nsage: len(B)\n1\nsage: %timeit len(B)\n1000000 loops, best of 3: 275 ns per loop\nsage: B = Bitset('10'*10000)\nsage: len(B)\n10000\nsage: %timeit len(B)\n100000 loops, best of 3: 2.52 us per loop\nsage: B = Bitset('10'*1000000)\nsage: len(B)\n1000000\nsage: %timeit len(B)\n1000 loops, best of 3: 236 us per loop\n```\n\n\nI'm wondering if I should add a wrapper in case the `__builtin_popcountl` method is not available. This is not difficult, but I don't know which environnement variables should be tested.\n\nThanks.",
    "created_at": "2013-08-18T15:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154849",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:8" align="right">comment:8</div>

Hello,

Since I have now understood how to use `__builtin_popcountl` (not obvious when you don't know), I have uploaded a new version of the patch.

before:

```
sage: B = Bitset('00'*10000+'1')
sage: len(B)
1
sage: %timeit len(B)
1000000 loops, best of 3: 268 ns per loop
sage: B = Bitset('10'*10000)
sage: len(B)
10000
sage: %timeit len(B)
1000 loops, best of 3: 245 us per loop
sage: B = Bitset('10'*1000000)
sage: len(B)
1000000
sage: %timeit len(B)
10 loops, best of 3: 24.1 ms per loop
```

after:

```
sage: B = Bitset('00'*10000+'1')
sage: len(B)
1
sage: %timeit len(B)
1000000 loops, best of 3: 275 ns per loop
sage: B = Bitset('10'*10000)
sage: len(B)
10000
sage: %timeit len(B)
100000 loops, best of 3: 2.52 us per loop
sage: B = Bitset('10'*1000000)
sage: len(B)
1000000
sage: %timeit len(B)
1000 loops, best of 3: 236 us per loop
```


I'm wondering if I should add a wrapper in case the `__builtin_popcountl` method is not available. This is not difficult, but I don't know which environnement variables should be tested.

Thanks.



---

archive/issue_comments_154850.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,41 +1,28 @@\n-This patch improves the running time of the `bitset_len` method by using fast methods for counting bits in 32 and 64 bits integers (popcount). It\n-- adds file `bitcount.pxi` to `sage/misc/`. This file contains the functions for counting bits in 32 or 64 bits integers\n-- adds corresponding tests to file `misc_c.pyx`\n-- modifies the `bitset_len` function accordingly\n+This patch improves the running time of the `bitset_len` method by using `__builtin_popcount()`.\n \n Before:\n \n ```\n-sage: x = FrozenBitset('10'*1003002); len(x)\n-1003002\n-sage: %timeit len(x)\n-125 loops, best of 3: 5.27 ms per loop\n-sage: x = FrozenBitset('10'*10705); len(x)\n-10705\n-sage: %timeit len(x)\n-625 loops, best of 3: 56.3 \u00b5s per loop\n+sage: B = Bitset('10'*10000)\n+sage: len(B)\n+10000\n+sage: %timeit len(B)\n+1000 loops, best of 3: 245 us per loop\n ```\n \n After:\n \n ```\n-sage: x = FrozenBitset('10'*1003002); len(x)\n-1003002\n-sage: %timeit len(x)\n-625 loops, best of 3: 865 \u00b5s per loop\n-sage: x = FrozenBitset('10'*10705); len(x)\n-10705\n-sage: %timeit len(x)\n-625 loops, best of 3: 9.39 \u00b5s per loop\n+sage: B = Bitset('10'*10000)\n+sage: len(B)\n+10000\n+sage: %timeit len(B)\n+100000 loops, best of 3: 2.52 us per loop\n ```\n-\n-The ``popcount_32`` method is the same than the function used in patch #12371. \n-\n-The alternative would be to use functions `__builtin_popcount()` and `__builtin_popcountll()`. They are extremely fast but they required to add flag ``-mpopcnt`` or ``-msse4.2`` to the gcc compiler. Can we do that? how? \n \n \n APPLY:\n \n-* [attachment: trac_13352_bitset_len.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)\n+* [attachment: trac_13352_bitset_len_v2.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)\n \n \n``````\n",
    "created_at": "2013-08-18T15:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154850",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,41 +1,28 @@
-This patch improves the running time of the `bitset_len` method by using fast methods for counting bits in 32 and 64 bits integers (popcount). It
-- adds file `bitcount.pxi` to `sage/misc/`. This file contains the functions for counting bits in 32 or 64 bits integers
-- adds corresponding tests to file `misc_c.pyx`
-- modifies the `bitset_len` function accordingly
+This patch improves the running time of the `bitset_len` method by using `__builtin_popcount()`.
 
 Before:
 
 ```
-sage: x = FrozenBitset('10'*1003002); len(x)
-1003002
-sage: %timeit len(x)
-125 loops, best of 3: 5.27 ms per loop
-sage: x = FrozenBitset('10'*10705); len(x)
-10705
-sage: %timeit len(x)
-625 loops, best of 3: 56.3 µs per loop
+sage: B = Bitset('10'*10000)
+sage: len(B)
+10000
+sage: %timeit len(B)
+1000 loops, best of 3: 245 us per loop
 ```
 
 After:
 
 ```
-sage: x = FrozenBitset('10'*1003002); len(x)
-1003002
-sage: %timeit len(x)
-625 loops, best of 3: 865 µs per loop
-sage: x = FrozenBitset('10'*10705); len(x)
-10705
-sage: %timeit len(x)
-625 loops, best of 3: 9.39 µs per loop
+sage: B = Bitset('10'*10000)
+sage: len(B)
+10000
+sage: %timeit len(B)
+100000 loops, best of 3: 2.52 us per loop
 ```
-
-The ``popcount_32`` method is the same than the function used in patch #12371. 
-
-The alternative would be to use functions `__builtin_popcount()` and `__builtin_popcountll()`. They are extremely fast but they required to add flag ``-mpopcnt`` or ``-msse4.2`` to the gcc compiler. Can we do that? how? 
 
 
 APPLY:
 
-* [attachment: trac_13352_bitset_len.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len.patch.gz)
+* [attachment: trac_13352_bitset_len_v2.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)
 
 
``````




---

archive/issue_comments_154851.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,6 +23,6 @@\n \n APPLY:\n \n-* [attachment: trac_13352_bitset_len_v2.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)\n+* [attachment: trac_13352_bitset_len_v3.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)\n \n \n``````\n",
    "created_at": "2013-08-26T13:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154851",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,6 +23,6 @@
 
 APPLY:
 
-* [attachment: trac_13352_bitset_len_v2.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v2.patch.gz)
+* [attachment: trac_13352_bitset_len_v3.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)
 
 
``````




---

archive/issue_comments_154852.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI have now implemented the function in C in file `popcount.h` with a small wrapper. The result is a bit slower than without wrapper, but still way faster than previous method.\n\n```\nsage: B = Bitset('00'*10000+'1')\nsage: len(B)\n1\nsage: %timeit len(B)\n1000000 loops, best of 3: 361 ns per loop\nsage: B = Bitset('10'*10000)\nsage: %timeit len(B)\n100000 loops, best of 3: 3.03 us per loop\nsage: B = Bitset('10'*1000000)\nsage: len(B)\n1000000\nsage: %timeit len(B)\n1000 loops, best of 3: 287 us per loop\n```\n\nI have used the `_WIN32` flag, but I'm not sure it's the good one. So if one knows the best flag to use to detect when the `__builtin_popcount` method is not available, please let me know.",
    "created_at": "2013-08-26T13:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154852",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:9" align="right">comment:9</div>

I have now implemented the function in C in file `popcount.h` with a small wrapper. The result is a bit slower than without wrapper, but still way faster than previous method.

```
sage: B = Bitset('00'*10000+'1')
sage: len(B)
1
sage: %timeit len(B)
1000000 loops, best of 3: 361 ns per loop
sage: B = Bitset('10'*10000)
sage: %timeit len(B)
100000 loops, best of 3: 3.03 us per loop
sage: B = Bitset('10'*1000000)
sage: len(B)
1000000
sage: %timeit len(B)
1000 loops, best of 3: 287 us per loop
```

I have used the `_WIN32` flag, but I'm not sure it's the good one. So if one knows the best flag to use to detect when the `__builtin_popcount` method is not available, please let me know.



---

archive/issue_comments_154853.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHello,\n\nafter browsing the web, I came up with this new version. The current version tests is the cpu has builtin support. If yes, we use builtin version. Else, we use hakmem methods.\n* http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html\n* http://gcc.gnu.org/gcc-4.8/changes.html\n* http://www.spinics.net/lists/linux-ext4/msg35827.html\n\nWe don't need all the methods for `bitset_len` but it could be useful for other usage.\n\nLet me know if it is OK.",
    "created_at": "2013-09-16T21:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154853",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Hello,

after browsing the web, I came up with this new version. The current version tests is the cpu has builtin support. If yes, we use builtin version. Else, we use hakmem methods.
* http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html
* http://gcc.gnu.org/gcc-4.8/changes.html
* http://www.spinics.net/lists/linux-ext4/msg35827.html

We don't need all the methods for `bitset_len` but it could be useful for other usage.

Let me know if it is OK.



---

archive/issue_comments_154854.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHMmmmmmmmm.... I'm trying to understand the code and it's much more complicated than what I actually read. Funny, looks like you can have as much fun with GCC than with Python, and decide how stuff is to be run at run time instead of compile time `:-P`\n\nThis being said, if I understand well what \"ifunc\" does I do not see how the popcount instruction will be used when available. To me it looks like you should make sure that the file is compiled with the `-mpopcnt` GCC flag (so that `__builtin_popcnt` is always replaced by the popcount instruction even if it does not exist), and that this ifunc trick means to avoid using this instruction if it is detected that, at runtime, it is not available.\n\nThis being said, it is a very nice trick `O_o`\n\nNathann",
    "created_at": "2013-09-17T09:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154854",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:11" align="right">comment:11</div>

HMmmmmmmmm.... I'm trying to understand the code and it's much more complicated than what I actually read. Funny, looks like you can have as much fun with GCC than with Python, and decide how stuff is to be run at run time instead of compile time `:-P`

This being said, if I understand well what "ifunc" does I do not see how the popcount instruction will be used when available. To me it looks like you should make sure that the file is compiled with the `-mpopcnt` GCC flag (so that `__builtin_popcnt` is always replaced by the popcount instruction even if it does not exist), and that this ifunc trick means to avoid using this instruction if it is detected that, at runtime, it is not available.

This being said, it is a very nice trick `O_o`

Nathann



---

archive/issue_comments_154855.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI would also say that those 2 blocks \n\n```\n__attribute__ ((__target__ (\"popcnt\"))) \n static unsigned int builtin_popcount(unsigned int w){ \n return (sizeof(unsigned int)==4? __builtin_popcount(w) : __builtin_popcountl(w)); \n } \n```\n\nare mistakes. Whatever happens, regardless of the architecture, `__builtin_popcount` works on int type, and `__builtin_popcountl` works on long types.\n\nAlso, perhaps you should credit Cristian Rodr\u00edguez somewhere `:-P`\n\nNathann",
    "created_at": "2013-09-17T09:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154855",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

I would also say that those 2 blocks 

```
__attribute__ ((__target__ ("popcnt"))) 
 static unsigned int builtin_popcount(unsigned int w){ 
 return (sizeof(unsigned int)==4? __builtin_popcount(w) : __builtin_popcountl(w)); 
 } 
```

are mistakes. Whatever happens, regardless of the architecture, `__builtin_popcount` works on int type, and `__builtin_popcountl` works on long types.

Also, perhaps you should credit Cristian Rodríguez somewhere `:-P`

Nathann



---

archive/issue_comments_154856.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[trac_13352_bitset_len_v3.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)**\n\nRight. I have simplified the code and add credits to Cristian Rodriguez.",
    "created_at": "2013-09-17T15:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154856",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[trac_13352_bitset_len_v3.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)**

Right. I have simplified the code and add credits to Cristian Rodriguez.



---

archive/issue_comments_154857.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHere's a slightly cleaner version which does not use ifunc but only G++'s multiversionning. C's looking very much like Python these days `:-PPPP`\n\nNice links :\n* http://gcc.gnu.org/wiki/FunctionMultiVersioning\n* http://gcc.gnu.org/onlinedocs/gcc/Function-Multiversioning.html\n\nNathann",
    "created_at": "2013-09-19T15:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154857",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:14" align="right">comment:14</div>

Here's a slightly cleaner version which does not use ifunc but only G++'s multiversionning. C's looking very much like Python these days `:-PPPP`

Nice links :
* http://gcc.gnu.org/wiki/FunctionMultiVersioning
* http://gcc.gnu.org/onlinedocs/gcc/Function-Multiversioning.html

Nathann



---

archive/issue_comments_154858.json:
```json
{
    "body": "Attachment: **[a.c.gz](https://github.com/sagemath/sage/files/ticket13352/a.c.gz)**",
    "created_at": "2013-09-19T15:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154858",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[a.c.gz](https://github.com/sagemath/sage/files/ticket13352/a.c.gz)**



---

archive/issue_comments_154859.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nUnfortunately, I'm unable to use this for the patch because the \"default\" keyword is not recognized.",
    "created_at": "2013-09-19T21:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154859",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

Unfortunately, I'm unable to use this for the patch because the "default" keyword is not recognized.



---

archive/issue_comments_154860.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHmmmmmm... Well, it seems that this feature is only available in gcc 4.8+. I asked Volker for his advice on this ticket (or rather on the .c file I uploaded), and he told me that we should check for both gcc 4.8+ and x86 (ifdef `__i386__`).\n\nBesides, he saw on that link (http://gcc.gnu.org/bugzilla/show_bug.cgi?id=36041, though I can't find out where on the page) that GCC was about to patch that, and improve the generic version of `__builtin_gcc`. If that's the case, perhaps we should just use theirs, waiting for the patch to be merged with a future gcc release. Otherwise we can use the MIT HAKMEM version indeed.\n\nI'll try to send a version with both codes today. And we'll remove the old one in a couple of years `:-P`\n\nNathann",
    "created_at": "2013-09-20T07:35:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154860",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

Hmmmmmm... Well, it seems that this feature is only available in gcc 4.8+. I asked Volker for his advice on this ticket (or rather on the .c file I uploaded), and he told me that we should check for both gcc 4.8+ and x86 (ifdef `__i386__`).

Besides, he saw on that link (http://gcc.gnu.org/bugzilla/show_bug.cgi?id=36041, though I can't find out where on the page) that GCC was about to patch that, and improve the generic version of `__builtin_gcc`. If that's the case, perhaps we should just use theirs, waiting for the patch to be merged with a future gcc release. Otherwise we can use the MIT HAKMEM version indeed.

I'll try to send a version with both codes today. And we'll remove the old one in a couple of years `:-P`

Nathann



---

archive/issue_comments_154861.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHey I don't get it... In your patch you also use a attribute/target with popcount. You can't compile my code yet you can compile yours ? And that means that they added this attribute/target feature before adding the \"default\" keyword ? `O_o`\n\nNathann",
    "created_at": "2013-09-20T07:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154861",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

Hey I don't get it... In your patch you also use a attribute/target with popcount. You can't compile my code yet you can compile yours ? And that means that they added this attribute/target feature before adding the "default" keyword ? `O_o`

Nathann



---

archive/issue_comments_154862.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nApparently yes. Have you tried to modify the patch and compile on your own computer?",
    "created_at": "2013-09-20T07:51:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154862",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:18" align="right">comment:18</div>

Apparently yes. Have you tried to modify the patch and compile on your own computer?



---

archive/issue_comments_154863.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'm trying, but it takes forever to compile. What happens if you replace \"default\" with \"\"  in the .c file ?\n\nNathann",
    "created_at": "2013-09-20T07:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154863",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:19" align="right">comment:19</div>

I'm trying, but it takes forever to compile. What happens if you replace "default" with ""  in the .c file ?

Nathann



---

archive/issue_comments_154864.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nArg. This \"\" fails `:-/`\n\nNathann",
    "created_at": "2013-09-20T07:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154864",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:20" align="right">comment:20</div>

Arg. This "" fails `:-/`

Nathann



---

archive/issue_comments_154865.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHMmmmmmm `O_o`\n\nWhat I get when running tests is :\n\n```\nTraceback (most recent call last):\n  File \"/home/ncohen/.Sage/local/bin/sage-runtests\", line 79, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 27, in <module>\n    from sources import FileDocTestSource, DictAsObject\n  File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/sources.py\", line 27, in <module>\n    from util import NestedName\n  File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/util.py\", line 23, in <module>\n    from sage.misc.misc import walltime, cputime\n  File \"/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/misc/misc.py\", line 565, in <module>\n    from sage.misc.misc_c import prod, running_total, balanced_sum, is_64_bit, is_32_bit\nImportError: /home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/misc/misc_c.so: undefined symbol: __builtin_popcount\n```\n\nNathann",
    "created_at": "2013-09-20T08:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154865",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

HMmmmmmm `O_o`

What I get when running tests is :

```
Traceback (most recent call last):
  File "/home/ncohen/.Sage/local/bin/sage-runtests", line 79, in <module>
    from sage.doctest.control import DocTestController
  File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 27, in <module>
    from sources import FileDocTestSource, DictAsObject
  File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 27, in <module>
    from util import NestedName
  File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/doctest/util.py", line 23, in <module>
    from sage.misc.misc import walltime, cputime
  File "/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/misc/misc.py", line 565, in <module>
    from sage.misc.misc_c import prod, running_total, balanced_sum, is_64_bit, is_32_bit
ImportError: /home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/misc/misc_c.so: undefined symbol: __builtin_popcount
```

Nathann



---

archive/issue_comments_154866.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n(that was with your patch applied)",
    "created_at": "2013-09-20T09:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154866",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">comment:22</div>

(that was with your patch applied)



---

archive/issue_comments_154867.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nso you mean with patch http://trac.sagemath.org/raw-attachment/ticket/13352/trac_13352_bitset_len_v3.patch as it is or a modified version ?\n\n\nWhen I try to replace my patch with what you have put in a.c file, I get:\n\n```\nIn file included from sage/coding/binary_code.c:319:0:\n./sage/misc/popcount.h:107:3: error: attribute(target(\"default\")) is unknown\n./sage/misc/popcount.h:123:3: error: attribute(target(\"default\")) is unknown\n./sage/misc/popcount.h:128:14: error: redefinition of \u2018popcount\u2019\n./sage/misc/popcount.h:123:14: note: previous definition of \u2018popcount\u2019 was here\n./sage/misc/popcount.h:132:14: error: redefinition of \u2018popcountl\u2019\n./sage/misc/popcount.h:107:14: note: previous definition of \u2018popcountl\u2019 was here\nerror: command 'gcc' failed with exit status 1\nError installing modified sage library code.\n```",
    "created_at": "2013-09-20T09:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154867",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:23" align="right">comment:23</div>

so you mean with patch http://trac.sagemath.org/raw-attachment/ticket/13352/trac_13352_bitset_len_v3.patch as it is or a modified version ?


When I try to replace my patch with what you have put in a.c file, I get:

```
In file included from sage/coding/binary_code.c:319:0:
./sage/misc/popcount.h:107:3: error: attribute(target("default")) is unknown
./sage/misc/popcount.h:123:3: error: attribute(target("default")) is unknown
./sage/misc/popcount.h:128:14: error: redefinition of ‘popcount’
./sage/misc/popcount.h:123:14: note: previous definition of ‘popcount’ was here
./sage/misc/popcount.h:132:14: error: redefinition of ‘popcountl’
./sage/misc/popcount.h:107:14: note: previous definition of ‘popcountl’ was here
error: command 'gcc' failed with exit status 1
Error installing modified sage library code.
```



---

archive/issue_comments_154868.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI meant your patch, without modifications. As for the errors you get, I think it's because the file gets compiled with gcc instead of g++. Volker said that it should be sufficient to make it a .cc file, and that GCC would take the hint and use the right compiler instead. It does work when outside of Sage :\n\n```\n~$ cp a.cc a.c\n~$ gcc a.c -o a\na.c:31:12: error: redefinition of \u2018popcount\u2019\n inline int popcount(unsigned int i){\n            ^\na.c:26:12: note: previous definition of \u2018popcount\u2019 was here\n inline int popcount(unsigned int i){\n            ^\na.c:35:12: error: redefinition of \u2018popcountl\u2019\n inline int popcountl(unsigned long i){\n            ^\na.c:10:12: note: previous definition of \u2018popcountl\u2019 was here\n inline int popcountl(unsigned long i){\n            ^\n~$ gcc a.cc -o a\n~$ \n```\n\nThough there does not seem to be anything wrong with \"default\" on my computer. Which version of gcc are you using ? It's probably < 4.8.\n\nNathann",
    "created_at": "2013-09-20T09:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154868",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">comment:24</div>

I meant your patch, without modifications. As for the errors you get, I think it's because the file gets compiled with gcc instead of g++. Volker said that it should be sufficient to make it a .cc file, and that GCC would take the hint and use the right compiler instead. It does work when outside of Sage :

```
~$ cp a.cc a.c
~$ gcc a.c -o a
a.c:31:12: error: redefinition of ‘popcount’
 inline int popcount(unsigned int i){
            ^
a.c:26:12: note: previous definition of ‘popcount’ was here
 inline int popcount(unsigned int i){
            ^
a.c:35:12: error: redefinition of ‘popcountl’
 inline int popcountl(unsigned long i){
            ^
a.c:10:12: note: previous definition of ‘popcountl’ was here
 inline int popcountl(unsigned long i){
            ^
~$ gcc a.cc -o a
~$ 
```

Though there does not seem to be anything wrong with "default" on my computer. Which version of gcc are you using ? It's probably < 4.8.

Nathann



---

archive/issue_comments_154869.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\ngcc (GCC) 4.6.3 20120306.",
    "created_at": "2013-09-20T09:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154869",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

gcc (GCC) 4.6.3 20120306.



---

archive/issue_comments_154870.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHelloooooooo ! Just to mention that I have been fighting with multiversionning in Sage+GCC for two days now, and that I can't seem to make it work. It works outside of Sage, it segfaults inside of Sage and I have no idea why.\n\nOh, and there is a `#DEFINE NO_INLINE` among the default preprocessor variables for anything that gets compiled by Sage it seems.\n\nNathann",
    "created_at": "2013-09-21T08:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154870",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">comment:26</div>

Helloooooooo ! Just to mention that I have been fighting with multiversionning in Sage+GCC for two days now, and that I can't seem to make it work. It works outside of Sage, it segfaults inside of Sage and I have no idea why.

Oh, and there is a `#DEFINE NO_INLINE` among the default preprocessor variables for anything that gets compiled by Sage it seems.

Nathann



---

archive/issue_comments_154871.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSo unless someone has a good solution, we can make a patch containing only the hakmem methods, and if one is later able to make `__builtin_popcount` running, then we may switch to it.\nDo you agree?",
    "created_at": "2013-09-21T15:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154871",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:27" align="right">comment:27</div>

So unless someone has a good solution, we can make a patch containing only the hakmem methods, and if one is later able to make `__builtin_popcount` running, then we may switch to it.
Do you agree?



---

archive/issue_comments_154872.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nYep, it makes sense but it is a pity `:-/`\n\nI wrote to sage-devel, just in case ... \n\nhttps://groups.google.com/d/topic/sage-devel/FIxzZv0L_lo/discussion\n\nNathann",
    "created_at": "2013-09-22T08:38:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154872",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:28" align="right">comment:28</div>

Yep, it makes sense but it is a pity `:-/`

I wrote to sage-devel, just in case ... 

https://groups.google.com/d/topic/sage-devel/FIxzZv0L_lo/discussion

Nathann



---

archive/issue_comments_154873.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI think a great suggestion implied by #14704 is to use `mpn_popcount()` for this. That's essentially one line of code to call that function :-)",
    "created_at": "2013-12-10T09:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154873",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

I think a great suggestion implied by #14704 is to use `mpn_popcount()` for this. That's essentially one line of code to call that function :-)



---

archive/issue_comments_154874.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI'm working on a patch which does this...",
    "created_at": "2013-12-10T09:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154874",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

I'm working on a patch which does this...



---

archive/issue_comments_154875.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThat would be great if you have the good trick to use that method. I tried some time ago to use `mpz_popcount` and failed.",
    "created_at": "2013-12-10T10:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154875",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:31" align="right">comment:31</div>

That would be great if you have the good trick to use that method. I tried some time ago to use `mpz_popcount` and failed.



---

archive/issue_comments_154876.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI'm also merging `bitset_pxd.pxi` and `bitset.pxd` (I see no reason why these would be two separate files) and moving the doctests to `bitset.pyx`.",
    "created_at": "2013-12-10T10:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154876",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

I'm also merging `bitset_pxd.pxi` and `bitset.pxd` (I see no reason why these would be two separate files) and moving the doctests to `bitset.pyx`.



---

archive/issue_comments_154877.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nHmmmmmmmmmm `O_O`\n\nYou are on a dangerous road, Jeroen. The road to many broken dependencies in the graph/ folder `:-PPPPPP`\n\nNathann",
    "created_at": "2013-12-10T10:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154877",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:33" align="right">comment:33</div>

Hmmmmmmmmmm `O_O`

You are on a dangerous road, Jeroen. The road to many broken dependencies in the graph/ folder `:-PPPPPP`

Nathann



---

archive/issue_comments_154878.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@nathanncohen](#comment:33):\n> Hmmmmmmmmmm `O_O`\n> \n> You are on a dangerous road, Jeroen. The road to many broken dependencies in the graph/ folder `:-PPPPPP`\n\nYou mean because of `bitset_pxd.pxi`? I could simply leave that file with a one-liner\n\n```\nfrom sage.misc.bitset cimport *\n```\nif you prefer.",
    "created_at": "2013-12-10T10:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154878",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@nathanncohen](#comment:33):
> Hmmmmmmmmmm `O_O`
> 
> You are on a dangerous road, Jeroen. The road to many broken dependencies in the graph/ folder `:-PPPPPP`

You mean because of `bitset_pxd.pxi`? I could simply leave that file with a one-liner

```
from sage.misc.bitset cimport *
```
if you prefer.



---

archive/issue_comments_154879.json:
```json
{
    "body": "Changed author from **David Coudert** to **David Coudert, Jeroen Demeyer**",
    "created_at": "2013-12-10T10:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154879",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **David Coudert** to **David Coudert, Jeroen Demeyer**



---

archive/issue_comments_154880.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,6 +23,4 @@\n \n APPLY:\n \n-* [attachment: trac_13352_bitset_len_v3.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)\n-\n-\n+* [attachment: trac_13352_bitset_len_v4.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)\n``````\n",
    "created_at": "2013-12-10T10:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154880",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,6 +23,4 @@
 
 APPLY:
 
-* [attachment: trac_13352_bitset_len_v3.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v3.patch.gz)
-
-
+* [attachment: trac_13352_bitset_len_v4.patch](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)
``````




---

archive/issue_comments_154881.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@dcoudert](#comment:31):\n> That would be great if you have the good trick to use that method. I tried some time ago to use `mpz_popcount` and failed. \n\nThe trick is to use `mpn_popcount` instead of `mpz_popcount`.",
    "created_at": "2013-12-10T11:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154881",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@dcoudert](#comment:31):
> That would be great if you have the good trick to use that method. I tried some time ago to use `mpz_popcount` and failed. 

The trick is to use `mpn_popcount` instead of `mpz_popcount`.



---

archive/issue_comments_154882.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nSpeed is much better too.\n\nWith [attachment: trac_13352_bitset_len_v3.patch\u200b](https://github.com/sagemath/sage/files/ticket13352/0234840801c46216bcf80f1a11c17fdc.gz):\n\n```\nsage: B = Bitset('10'*10000)\nsage: timeit('len(B)',repeat=100,number=10000)\n10000 loops, best of 100: 1.24 \u00b5s per loop\nsage: B = Bitset('00'*10000)\nsage: timeit('len(B)',repeat=100,number=10000)\n10000 loops, best of 100: 254 ns per loop\n```\n\nWith [attachment: trac_13352_bitset_len_v4.patch\u200b](https://github.com/sagemath/sage/files/ticket13352/ebe2d44e9312f4f19c2ba82bb2b34192.gz):\n\n```\nsage: B = Bitset('10'*10000)\nsage: timeit('len(B)',repeat=100,number=10000)\n10000 loops, best of 100: 168 ns per loop\nsage: B = Bitset('00'*10000)\nsage:  timeit('len(B)',repeat=100,number=10000)\n10000 loops, best of 100: 168 ns per loop\n```",
    "created_at": "2013-12-10T11:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154882",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Speed is much better too.

With [attachment: trac_13352_bitset_len_v3.patch​](https://github.com/sagemath/sage/files/ticket13352/0234840801c46216bcf80f1a11c17fdc.gz):

```
sage: B = Bitset('10'*10000)
sage: timeit('len(B)',repeat=100,number=10000)
10000 loops, best of 100: 1.24 µs per loop
sage: B = Bitset('00'*10000)
sage: timeit('len(B)',repeat=100,number=10000)
10000 loops, best of 100: 254 ns per loop
```

With [attachment: trac_13352_bitset_len_v4.patch​](https://github.com/sagemath/sage/files/ticket13352/ebe2d44e9312f4f19c2ba82bb2b34192.gz):

```
sage: B = Bitset('10'*10000)
sage: timeit('len(B)',repeat=100,number=10000)
10000 loops, best of 100: 168 ns per loop
sage: B = Bitset('00'*10000)
sage:  timeit('len(B)',repeat=100,number=10000)
10000 loops, best of 100: 168 ns per loop
```



---

archive/issue_comments_154883.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nSimilar improvements could be made to other bitset functions (in particular to `bitset_next()` and the like). But that would be for a new ticket...",
    "created_at": "2013-12-10T12:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154883",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Similar improvements could be made to other bitset functions (in particular to `bitset_next()` and the like). But that would be for a new ticket...



---

archive/issue_comments_154884.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nStrangely, many places were importing `bitset` without actually using bitsets... so I removed those redundant imports.\n\nEven stranger were two files `sage/combinat/debruijn_sequence.pxd` and `sage/matroids/unpickling.pxd` containing just one line\n\n```\ninclude 'sage/misc/bitset_pxd.pxi' \n```\nwhich was in both cases unused.",
    "created_at": "2013-12-10T12:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154884",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Strangely, many places were importing `bitset` without actually using bitsets... so I removed those redundant imports.

Even stranger were two files `sage/combinat/debruijn_sequence.pxd` and `sage/matroids/unpickling.pxd` containing just one line

```
include 'sage/misc/bitset_pxd.pxi' 
```
which was in both cases unused.



---

archive/issue_comments_154885.json:
```json
{
    "body": "Attachment: **[trac_13352_bitset_len_v4.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)**",
    "created_at": "2013-12-10T12:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154885",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac_13352_bitset_len_v4.patch.gz](https://github.com/sagemath/sage/files/ticket13352/trac_13352_bitset_len_v4.patch.gz)**



---

archive/issue_comments_154886.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nExcellent! The patch is working perfectly (install, doctests on sage/ , etc.). The simplification of the hamming weight method is also very good.\n\nThank you very much.\n\nShould we let Nathann conclude on the status of this ticket?",
    "created_at": "2013-12-10T13:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154886",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:40" align="right">comment:40</div>

Excellent! The patch is working perfectly (install, doctests on sage/ , etc.). The simplification of the hamming weight method is also very good.

Thank you very much.

Should we let Nathann conclude on the status of this ticket?



---

archive/issue_comments_154887.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nSee also #10093 for another bitset-related ticket ready for review.",
    "created_at": "2013-12-10T14:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154887",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

See also #10093 for another bitset-related ticket ready for review.



---

archive/issue_comments_154888.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\n> Should we let Nathann conclude on the status of this ticket?\n\nNo sorry, please deal with this without me, I'm already juggling with 1000 patches right now `O_o`\n\nNathann",
    "created_at": "2013-12-10T14:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154888",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:42" align="right">comment:42</div>

> Should we let Nathann conclude on the status of this ticket?

No sorry, please deal with this without me, I'm already juggling with 1000 patches right now `O_o`

Nathann



---

archive/issue_comments_154889.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nFor me the patch proposed by Jeroen is OK (and I can install #10093 on top of it), so I set its status to positive.",
    "created_at": "2013-12-10T14:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154889",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:43" align="right">comment:43</div>

For me the patch proposed by Jeroen is OK (and I can install #10093 on top of it), so I set its status to positive.



---

archive/issue_events_187148.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2013-12-10T14:33:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187148"
}
```



---

archive/issue_events_187149.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2013-12-10T14:33:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187149"
}
```



---

archive/issue_comments_154890.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2013-12-10T15:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154890",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_154891.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThis is ridiculous and shows how fast `mpn_popcount()` is:\n\n```\nsage: B = FrozenBitset(capacity=10^5)\nsage: timeit('B.isempty()', repeat=100, number=10000)\n10000 loops, best of 100: 980 ns per loop\nsage: timeit('len(B)', repeat=100, number=10000)\n10000 loops, best of 100: 573 ns per loop\n```",
    "created_at": "2013-12-10T17:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154891",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

This is ridiculous and shows how fast `mpn_popcount()` is:

```
sage: B = FrozenBitset(capacity=10^5)
sage: timeit('B.isempty()', repeat=100, number=10000)
10000 loops, best of 100: 980 ns per loop
sage: timeit('len(B)', repeat=100, number=10000)
10000 loops, best of 100: 573 ns per loop
```



---

archive/issue_comments_154892.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nHmmmmmm... Would you happen to have the popcount instruction on the computer on which you try this ?\n\nNathann",
    "created_at": "2013-12-10T20:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154892",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:46" align="right">comment:46</div>

Hmmmmmm... Would you happen to have the popcount instruction on the computer on which you try this ?

Nathann



---

archive/issue_comments_154893.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@nathanncohen](#comment:46):\n> Hmmmmmm... Would you happen to have the popcount instruction on the computer on which you try this ?\n\nI think so, yes.",
    "created_at": "2013-12-10T20:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154893",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@nathanncohen](#comment:46):
> Hmmmmmm... Would you happen to have the popcount instruction on the computer on which you try this ?

I think so, yes.



---

archive/issue_events_187150.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187150"
}
```



---

archive/issue_events_187151.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13352#event-187151"
}
```



---

archive/issue_comments_154894.json:
```json
{
    "body": "Merged: **sage-5.13.rc0**",
    "created_at": "2013-12-11T11:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154894",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.rc0**



---

archive/issue_comments_154895.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,6 +20,7 @@\n 100000 loops, best of 3: 2.52 us per loop\n ```\n \n+This patch also reorganizes the bitset files, including deleting the `sage/misc/bitset_pxd.pxi` file.\n \n APPLY:\n \n``````\n",
    "created_at": "2014-01-20T14:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154895",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,6 +20,7 @@
 100000 loops, best of 3: 2.52 us per loop
 ```
 
+This patch also reorganizes the bitset files, including deleting the `sage/misc/bitset_pxd.pxi` file.
 
 APPLY:
 
``````




---

archive/issue_comments_154896.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This patch improves the running time of the `bitset_len` method by using `__builtin_popcount()`.\n+This patch improves the running time of the `bitset_len` method by using `mpn_popcount()`.\n \n Before:\n \n``````\n",
    "created_at": "2014-01-20T14:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154896",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This patch improves the running time of the `bitset_len` method by using `__builtin_popcount()`.
+This patch improves the running time of the `bitset_len` method by using `mpn_popcount()`.
 
 Before:
 
``````




---

archive/issue_comments_154897.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI changed the description since we use `mpn_popcount` and not `___builtin_popcount`",
    "created_at": "2014-01-20T14:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154897",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:50" align="right">comment:50</div>

I changed the description since we use `mpn_popcount` and not `___builtin_popcount`



---

archive/issue_comments_154898.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nFollow-up: #16937",
    "created_at": "2014-09-05T13:37:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13352#issuecomment-154898",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Follow-up: #16937
