# Issue 13662: matrix() fails for polynomial quotient rings over inexact rings

archive/issues_013458.json:
```json
{
    "body": "Currently, the following code fails:\n\n```\nsage: R.<x> = Zp(3,2)[]\nsage: S.<xbar> = R.quo(x^2+1)\nsage: xbar.matrix()\nTypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 2 + 2*3 + O(3^2), 0, O(3^2)]!\n```\n\nThe problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore `p%f` might have (inexact zero) coefficients beyond its degree:\n\n```\nsage: R.<x> = Qp(3,5)[]\nsage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\nsage: xbar^3\n(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar\n```\n\nJust throwing away such coefficients would be wrong however. In the above example this would give `(2*3 + O(3^2))*xbar` with an *exact* constant coefficient `0` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:\n\n```\nsage: R.<x> = Qp(3,5)[]\nsage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\nsage: xbar^3\n(2*3 + O(3^2))*xbar + (O(3^3))\n```\n\nAssignee: @roed314\n\nCC:  boerner\n\nKeywords: sd59, days71\n\nAuthor: Julian Rueth\n\nBranch: u/saraedum/ticket/13662\n\nStatus: needs_work\n\nDependencies: #14482\n\nCommit: f6a90b0d5b3f800d3a4e6cdcc4c60f42f9f49599\n\nIssue created by migration from https://trac.sagemath.org/ticket/13662\n\n",
    "created_at": "2012-10-27T20:43:04Z",
    "labels": [
        "component: padics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "matrix() fails for polynomial quotient rings over inexact rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13662",
    "user": "https://github.com/saraedum"
}
```
Currently, the following code fails:

```
sage: R.<x> = Zp(3,2)[]
sage: S.<xbar> = R.quo(x^2+1)
sage: xbar.matrix()
TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 2 + 2*3 + O(3^2), 0, O(3^2)]!
```

The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore `p%f` might have (inexact zero) coefficients beyond its degree:

```
sage: R.<x> = Qp(3,5)[]
sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
sage: xbar^3
(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar
```

Just throwing away such coefficients would be wrong however. In the above example this would give `(2*3 + O(3^2))*xbar` with an *exact* constant coefficient `0` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:

```
sage: R.<x> = Qp(3,5)[]
sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
sage: xbar^3
(2*3 + O(3^2))*xbar + (O(3^3))
```

Assignee: @roed314

CC:  boerner

Keywords: sd59, days71

Author: Julian Rueth

Branch: u/saraedum/ticket/13662

Status: needs_work

Dependencies: #14482

Commit: f6a90b0d5b3f800d3a4e6cdcc4c60f42f9f49599

Issue created by migration from https://trac.sagemath.org/ticket/13662





---

archive/issue_comments_176669.json:
```json
{
    "body": "Attachment [trac_13662.patch](tarball://root/attachments/some-uuid/ticket13662/trac_13662.patch) by @saraedum created at 2012-10-27 20:46:46",
    "created_at": "2012-10-27T20:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176669",
    "user": "https://github.com/saraedum"
}
```

Attachment [trac_13662.patch](tarball://root/attachments/some-uuid/ticket13662/trac_13662.patch) by @saraedum created at 2012-10-27 20:46:46



---

archive/issue_comments_176670.json:
```json
{
    "body": "<a id='comment:1'></a>I think this patch is dangerous. Just truncating the list of coefficients without checking will make this code very prone to producing erroneous results silently.\n\nIn this case there is another solution anyway: The present code computes the coefficients of `[self,x*self,x<sup>2*self,...,x</sup>(d-1)*self]` and puts that into a matrix. If your arithmetic is to be trusted, that's probably the more efficient way of doing it. However, the alternative is to create the companion matrix of the generator (that's just a matter of putting coefficients into a matrix; no arithmetic required), take its powers, and take the appropriate linear combination of that. The big advantage there is that you completely avoid doing polynomial divisions/remainders with inexact coefficients, so the numerical stability of your computations is much easier to analyse/guarantee.\n\nThere may be other, better solutions too and perhaps the current approach (if equipped with reasonable checks) turns out to be good/better/more efficient and acceptable, but in its current form it seems to me it is masking the underlying problem rather than resolving it.",
    "created_at": "2012-10-29T17:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176670",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:1'></a>I think this patch is dangerous. Just truncating the list of coefficients without checking will make this code very prone to producing erroneous results silently.

In this case there is another solution anyway: The present code computes the coefficients of `[self,x*self,x<sup>2*self,...,x</sup>(d-1)*self]` and puts that into a matrix. If your arithmetic is to be trusted, that's probably the more efficient way of doing it. However, the alternative is to create the companion matrix of the generator (that's just a matter of putting coefficients into a matrix; no arithmetic required), take its powers, and take the appropriate linear combination of that. The big advantage there is that you completely avoid doing polynomial divisions/remainders with inexact coefficients, so the numerical stability of your computations is much easier to analyse/guarantee.

There may be other, better solutions too and perhaps the current approach (if equipped with reasonable checks) turns out to be good/better/more efficient and acceptable, but in its current form it seems to me it is masking the underlying problem rather than resolving it.



---

archive/issue_comments_176671.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-14T13:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176671",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_176672.json:
```json
{
    "body": "<a id='comment:2'></a>I believe this is a duplicate of #13263, however given Nils comment here, I suggest we close #13263.",
    "created_at": "2013-04-14T13:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176672",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>I believe this is a duplicate of #13263, however given Nils comment here, I suggest we close #13263.



---

archive/issue_events_038168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38168"
}
```



---

archive/issue_events_038169.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2013-09-12T15:49:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38169"
}
```



---

archive/issue_events_038170.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2013-09-12T15:49:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38170"
}
```



---

archive/issue_comments_176673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-09-12T15:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176673",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176674.json:
```json
{
    "body": "<a id='comment:7'></a>The comments are correct. This patch is dangerous. I'm fixing this now.",
    "created_at": "2013-09-12T15:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176674",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>The comments are correct. This patch is dangerous. I'm fixing this now.



---

archive/issue_events_038171.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38171"
}
```



---

archive/issue_events_038172.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38172"
}
```



---

archive/issue_events_038173.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38173"
}
```



---

archive/issue_events_038174.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38174"
}
```



---

archive/issue_events_038175.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38175"
}
```



---

archive/issue_events_038176.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38176"
}
```



---

archive/issue_comments_176675.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-25T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176676.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd59\".",
    "created_at": "2014-06-25T21:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176676",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "sd59".



---

archive/issue_comments_176677.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-25T21:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176677",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176678.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:1 nbruin]:\n> However, the alternative is to create the companion matrix of the generator (that's just a matter of putting coefficients into a matrix; no arithmetic required), take its powers, and take the appropriate linear combination of that. The big advantage there is that you completely avoid doing polynomial divisions/remainders with inexact coefficients, so the numerical stability of your computations is much easier to analyse/guarantee.\n\nI decided to just reduce leading zero coefficients mod `f` explicitly when creating the quotient ring elements. This appears to be the right thing to do to me. A different algorithm to compute the matrix would be an alternative of course. I just did what appeared to be easier to implement.",
    "created_at": "2014-06-25T21:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176678",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'></a>Replying to [comment:1 nbruin]:
> However, the alternative is to create the companion matrix of the generator (that's just a matter of putting coefficients into a matrix; no arithmetic required), take its powers, and take the appropriate linear combination of that. The big advantage there is that you completely avoid doing polynomial divisions/remainders with inexact coefficients, so the numerical stability of your computations is much easier to analyse/guarantee.

I decided to just reduce leading zero coefficients mod `f` explicitly when creating the quotient ring elements. This appears to be the right thing to do to me. A different algorithm to compute the matrix would be an alternative of course. I just did what appeared to be easier to implement.



---

archive/issue_comments_176679.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-29T08:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176679",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176680.json:
```json
{
    "body": "<a id='comment:15'></a>This failing doctest is a problem:\n\n```\n             sage: L.series(4)         # takes a long time (several seconds)\n-            (O(3))*alpha + (O(3^2)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)\n+            (O(3^2))*alpha + (O(3^3)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)\n```\nThe precision should only go down by this change.",
    "created_at": "2014-06-29T08:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176680",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>This failing doctest is a problem:

```
             sage: L.series(4)         # takes a long time (several seconds)
-            (O(3))*alpha + (O(3^2)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)
+            (O(3^2))*alpha + (O(3^3)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)
```
The precision should only go down by this change.



---

archive/issue_comments_176681.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -7,7 +7,23 @@\n TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 0, 0, O(3^2)]\n \\`\\`\\`\n \n-The attached patch fixes this.\n+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \\`p%f\\` might have (inexact zero) coefficients beyond its degree:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar\n+\\`\\`\\`\n+\n+Just throwing away such coefficients would be wrong however. In the above example this would give \\`(2*3 + O(3^2))*xbar\\` with an *exact* constant coefficient \\`0\\` which is incorrect. The correct thing to do is to reduce any inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(2*3 + O(3^2))*xbar + (O(3^3))\n+\\`\\`\\`\n \n Author: Julian Rueth\n \n```\n",
    "created_at": "2014-06-29T20:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176681",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -7,7 +7,23 @@
 TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 0, 0, O(3^2)]
 \`\`\`
 
-The attached patch fixes this.
+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \`p%f\` might have (inexact zero) coefficients beyond its degree:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar
+\`\`\`
+
+Just throwing away such coefficients would be wrong however. In the above example this would give \`(2*3 + O(3^2))*xbar\` with an *exact* constant coefficient \`0\` which is incorrect. The correct thing to do is to reduce any inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(2*3 + O(3^2))*xbar + (O(3^3))
+\`\`\`
 
 Author: Julian Rueth
 
```




---

archive/issue_comments_176682.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Currently, the following code fails:\n \n+\\`\\`\\`\n+sage: R.<x> = Zp(3,2)[]\n+sage: S.<xbar> = R.quo(x^2)\n+sage: xbar.matrix()\n+TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 0, 0, O(3^2)]\n+\\`\\`\\`\n+\n+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \\`p%f\\` might have (inexact zero) coefficients beyond its degree:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar\n+\\`\\`\\`\n+\n+Just throwing away such coefficients would be wrong however. In the above example this would give \\`(2*3 + O(3^2))*xbar\\` with an *exact* constant coefficient \\`0\\` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(2*3 + O(3^2))*xbar + (O(3^3))\n+\\`\\`\\`\n \n Author: Julian Rueth\n \n```\n",
    "created_at": "2014-06-29T20:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176682",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Currently, the following code fails:
 
+\`\`\`
+sage: R.<x> = Zp(3,2)[]
+sage: S.<xbar> = R.quo(x^2)
+sage: xbar.matrix()
+TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 0, 0, O(3^2)]
+\`\`\`
+
+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \`p%f\` might have (inexact zero) coefficients beyond its degree:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar
+\`\`\`
+
+Just throwing away such coefficients would be wrong however. In the above example this would give \`(2*3 + O(3^2))*xbar\` with an *exact* constant coefficient \`0\` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(2*3 + O(3^2))*xbar + (O(3^3))
+\`\`\`
 
 Author: Julian Rueth
 
```




---

archive/issue_comments_176683.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+Currently, the following code fails:\n \n+\\`\\`\\`\n+sage: R.<x> = Zp(3,2)[]\n+sage: S.<xbar> = R.quo(x^2+1)\n+sage: xbar.matrix()\n+TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 2 + 2*3 + O(3^2), 0, O(3^2)]!\n+\\`\\`\\`\n+\n+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \\`p%f\\` might have (inexact zero) coefficients beyond its degree:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar\n+\\`\\`\\`\n+\n+Just throwing away such coefficients would be wrong however. In the above example this would give \\`(2*3 + O(3^2))*xbar\\` with an *exact* constant coefficient \\`0\\` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:\n+\n+\\`\\`\\`\n+sage: R.<x> = Qp(3,5)[]\n+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))\n+sage: xbar^3\n+(2*3 + O(3^2))*xbar + (O(3^3))\n+\\`\\`\\`\n \n Author: Julian Rueth\n \n```\n",
    "created_at": "2014-06-29T20:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176683",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,29 @@
+Currently, the following code fails:
 
+\`\`\`
+sage: R.<x> = Zp(3,2)[]
+sage: S.<xbar> = R.quo(x^2+1)
+sage: xbar.matrix()
+TypeError: cannot construct an element of Full MatrixSpace of 2 by 2 dense matrices over 3-adic Ring with capped relative precision 2 from [0, 1 + O(3^2), 2 + 2*3 + O(3^2), 0, O(3^2)]!
+\`\`\`
+
+The problem is that the p-adic quotient with remainder does not determine the degree of the result and therefore \`p%f\` might have (inexact zero) coefficients beyond its degree:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(O(3^5))*xbar^3 + (O(3^2))*xbar^2 + (2*3 + O(3^2))*xbar
+\`\`\`
+
+Just throwing away such coefficients would be wrong however. In the above example this would give \`(2*3 + O(3^2))*xbar\` with an *exact* constant coefficient \`0\` which is incorrect. The correct thing to do is to reduce any leading inexact zero coefficients with the defining equation of the quotient. This is done in this ticket and gives the correct result:
+
+\`\`\`
+sage: R.<x> = Qp(3,5)[]
+sage: S.<xbar> = R.quo(x^2 + (O(3^2)*x) + (3+O(3^2)))
+sage: xbar^3
+(2*3 + O(3^2))*xbar + (O(3^3))
+\`\`\`
 
 Author: Julian Rueth
 
```




---

archive/issue_comments_176684.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:15 saraedum]:\n> This failing doctest is a problem:\n> \n> ```\n>              sage: L.series(4)         # takes a long time (several seconds)\n> -            (O(3))*alpha + (O(3^2)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)\n> +            (O(3^2))*alpha + (O(3^3)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)\n> ```\n> The precision should only go down by this change.\n\nI put a comment in the last commit which clarifies what is happening here.",
    "created_at": "2014-06-29T21:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176684",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>Replying to [comment:15 saraedum]:
> This failing doctest is a problem:
> 
> ```
>              sage: L.series(4)         # takes a long time (several seconds)
> -            (O(3))*alpha + (O(3^2)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)
> +            (O(3^2))*alpha + (O(3^3)) + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T + ((O(3^-1))*alpha + (2*3^-1 + O(3^0)))*T^2 + O(T^5)
> ```
> The precision should only go down by this change.

I put a comment in the last commit which clarifies what is happening here.



---

archive/issue_comments_176685.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-29T21:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_176686.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-29T21:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176686",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_038177.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38177"
}
```



---

archive/issue_events_038178.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13662#event-38178"
}
```



---

archive/issue_comments_176687.json:
```json
{
    "body": "<a id='comment:24'></a>Michel, I imagine you know how to do the L-series computations, so you can probably even verify that the added precision did not produce incorrect coefficients.",
    "created_at": "2015-02-02T22:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176687",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:24'></a>Michel, I imagine you know how to do the L-series computations, so you can probably even verify that the added precision did not produce incorrect coefficients.



---

archive/issue_comments_176688.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-16T20:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176689.json:
```json
{
    "body": "<a id='comment:26'></a>Quick question about formatting, why when you are looking at examples like:\n\n```\nsage: E = EllipticCurve('37a1')\nsage: E.is_ordinary(3)\nFalse\nsage: E.is_ordinary(5)\nTrue\nsage: L = E.padic_lseries(3)\nsage: alpha = L.alpha(10)\nsage: alpha^2 - E.ap(3)*alpha + 3\n(O(3^11))*alpha + (O(3^11))\nsage: L = E.padic_lseries(5)\nsage: alpha = L.alpha(10)\nsage: alpha^2 - E.ap(5)*alpha + 5\nO(5^10)\n```\nWhat's going on in the ordinary versus supersingular case?",
    "created_at": "2016-03-24T00:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176689",
    "user": "https://github.com/adeines"
}
```

<a id='comment:26'></a>Quick question about formatting, why when you are looking at examples like:

```
sage: E = EllipticCurve('37a1')
sage: E.is_ordinary(3)
False
sage: E.is_ordinary(5)
True
sage: L = E.padic_lseries(3)
sage: alpha = L.alpha(10)
sage: alpha^2 - E.ap(3)*alpha + 3
(O(3^11))*alpha + (O(3^11))
sage: L = E.padic_lseries(5)
sage: alpha = L.alpha(10)
sage: alpha^2 - E.ap(5)*alpha + 5
O(5^10)
```
What's going on in the ordinary versus supersingular case?



---

archive/issue_comments_176690.json:
```json
{
    "body": "Changing keywords from \"sd59\" to \"sd59, days71\".",
    "created_at": "2016-03-31T16:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176690",
    "user": "https://github.com/jbalakrishnan"
}
```

Changing keywords from "sd59" to "sd59, days71".



---

archive/issue_comments_176691.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-08T11:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13662#issuecomment-176691",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.
