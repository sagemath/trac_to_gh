# Issue 13760: Wrong basic interval arithmetic in PolynomialRing

archive/issues_013556.json:
```json
{
    "body": "Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n\n```\nsage: R.<x,y> = PolynomialRing(RIF,2)\nsage: RIF(-2,1)*x\n0\n```\n## More tests\n\n```\nsage: R.<x,y> = PolynomialRing(RIF,2)\nsage: RIF(-2,1)          # OK\n0.?e1\nsage: RIF(-2,1)*x        # Wrong\n0\nsage: RIF(-2,1)*x == 0   # Wrong\nTrue\nsage: cmp(RIF(-2,1)*x,0) # Wrong\n0\nsage: RIF(2,5)*x         # OK\n1.?e1*x\nsage: RIF(2,5)*x == 0    # OK\nFalse\n```\n## Code digging\nThe problem comes from the coercion:\n\n```\nsage: R(RIF(-2,1))\n0\nsage: R(RIF(-2,1)) == 0\nTrue\n```\nThis in turn comes from the creation (in `__init__` of class `MPolynomial_polydict` in `sage.rings.polynomial.multi_polynomial_element`) of a PolyDict object (defined in `sage.rings.polynomial.polydict`) with the option `remove_zero == True`.\n\n```\nfrom sage.rings.polynomial.polydict import PolyDict\nsage: PolyDict({(0,0):1}, remove_zero=True) # OK\nPolyDict with representation {(0, 0): 1}\nsage: PolyDict({(0,0):0}, remove_zero=True) # OK\nPolyDict with representation {}\nsage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\nPolyDict with representation {}\n```\nTo check if x is different from 0, PolyDict uses the test `x != 0`, which actually checks for disjointness in interval field:\n\n```\nsage: RIF(-2,1) != 0\nFalse\n```\n## Possible correction\nThis bug might be corrected by replacing in PolyDict the tests `x != zero` by one of:\n\n* `cmp(x,zero) != 0`\n* `not x.is_zero()`\n* `not x == zero`\n\nApply:\n\n- [attachment:trac_13760_interval_polynomial_fix.patch]\n- [attachment:trac_13760_regression_tests.patch]\n- [attachment:trac_7712_regression_tests_for_13760_fix.patch]\n- [attachment:trac_13760_documentation_fix.patch]\n\nAssignee: @aghitza\n\nCC:  @burcin @mwhansen @malb @zimmermann6\n\nKeywords: interval, polynomial, multivariate\n\nReviewer: Paul Zimmermann\n\nAuthor: Guillaume Moroz\n\nMerged: sage-5.6.beta1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13760\n\n",
    "closed_at": "2012-12-21T09:33:23Z",
    "created_at": "2012-11-26T13:20:10Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Wrong basic interval arithmetic in PolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13760",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```
Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:

```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)*x
0
```
## More tests

```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)          # OK
0.?e1
sage: RIF(-2,1)*x        # Wrong
0
sage: RIF(-2,1)*x == 0   # Wrong
True
sage: cmp(RIF(-2,1)*x,0) # Wrong
0
sage: RIF(2,5)*x         # OK
1.?e1*x
sage: RIF(2,5)*x == 0    # OK
False
```
## Code digging
The problem comes from the coercion:

```
sage: R(RIF(-2,1))
0
sage: R(RIF(-2,1)) == 0
True
```
This in turn comes from the creation (in `__init__` of class `MPolynomial_polydict` in `sage.rings.polynomial.multi_polynomial_element`) of a PolyDict object (defined in `sage.rings.polynomial.polydict`) with the option `remove_zero == True`.

```
from sage.rings.polynomial.polydict import PolyDict
sage: PolyDict({(0,0):1}, remove_zero=True) # OK
PolyDict with representation {(0, 0): 1}
sage: PolyDict({(0,0):0}, remove_zero=True) # OK
PolyDict with representation {}
sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
PolyDict with representation {}
```
To check if x is different from 0, PolyDict uses the test `x != 0`, which actually checks for disjointness in interval field:

```
sage: RIF(-2,1) != 0
False
```
## Possible correction
This bug might be corrected by replacing in PolyDict the tests `x != zero` by one of:

* `cmp(x,zero) != 0`
* `not x.is_zero()`
* `not x == zero`

Apply:

- [attachment:trac_13760_interval_polynomial_fix.patch]
- [attachment:trac_13760_regression_tests.patch]
- [attachment:trac_7712_regression_tests_for_13760_fix.patch]
- [attachment:trac_13760_documentation_fix.patch]

Assignee: @aghitza

CC:  @burcin @mwhansen @malb @zimmermann6

Keywords: interval, polynomial, multivariate

Reviewer: Paul Zimmermann

Author: Guillaume Moroz

Merged: sage-5.6.beta1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13760





---

archive/issue_comments_178463.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -48,7 +48,7 @@\n PolyDict with representation {}\n \\`\\`\\`\n \n-To check if x is 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n+To check if x is different from 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n \n \\`\\`\\`\n sage: RIF(-2,1) != 0\n@@ -59,9 +59,10 @@\n ## Possible correction\n \n This bug might be corrected by replacing in PolyDict the tests \\`x != zero\\` by one of:\n-- \\`cmp(x,0) != zero\\`\n+- \\`cmp(x,zero) != 0\\`\n - \\`not x.is_zero()\\`\n - \\`not x == zero\\`\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-26T13:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178463",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Description changed:
```diff
--- 
+++ 
@@ -48,7 +48,7 @@
 PolyDict with representation {}
 \`\`\`
 
-To check if x is 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
+To check if x is different from 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
 
 \`\`\`
 sage: RIF(-2,1) != 0
@@ -59,9 +59,10 @@
 ## Possible correction
 
 This bug might be corrected by replacing in PolyDict the tests \`x != zero\` by one of:
-- \`cmp(x,0) != zero\`
+- \`cmp(x,zero) != 0\`
 - \`not x.is_zero()\`
 - \`not x == zero\`
+
 
 Comment: 1
 
```




---

archive/issue_comments_178464.json:
```json
{
    "body": "A patch changing `x != zero` by `not x == zero`.",
    "created_at": "2012-11-26T15:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178464",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

A patch changing `x != zero` by `not x == zero`.



---

archive/issue_comments_178465.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,59 @@\n+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n \n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)*x\n+0\n+\\`\\`\\`\n+## More tests\n+\n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)          # OK\n+0.?e1\n+sage: RIF(-2,1)*x        # Wrong\n+0\n+sage: RIF(-2,1)*x == 0   # Wrong\n+True\n+sage: cmp(RIF(-2,1)*x,0) # Wrong\n+0\n+sage: RIF(2,5)*x         # OK\n+1.?e1*x\n+sage: RIF(2,5)*x == 0    # OK\n+False\n+\\`\\`\\`\n+## Code digging\n+The problem comes from the coercion:\n+\n+\\`\\`\\`\n+sage: R(RIF(-2,1))\n+0\n+sage: R(RIF(-2,1)) == 0\n+True\n+\\`\\`\\`\n+This in turn comes from the creation (in \\`__init__\\` of class \\`MPolynomial_polydict\\` in \\`sage.rings.polynomial.multi_polynomial_element\\`) of a PolyDict object (defined in \\`sage.rings.polynomial.polydict\\`) with the option \\`remove_zero == True\\`.\n+\n+\\`\\`\\`\n+from sage.rings.polynomial.polydict import PolyDict\n+sage: PolyDict({(0,0):1}, remove_zero=True) # OK\n+PolyDict with representation {(0, 0): 1}\n+sage: PolyDict({(0,0):0}, remove_zero=True) # OK\n+PolyDict with representation {}\n+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\n+PolyDict with representation {}\n+\\`\\`\\`\n+To check if x is different from 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n+\n+\\`\\`\\`\n+sage: RIF(-2,1) != 0\n+False\n+\\`\\`\\`\n+## Possible correction\n+This bug might be corrected by replacing in PolyDict the tests \\`x != zero\\` by one of:\n+\n+* \\`cmp(x,zero) != 0\\`\n+* \\`not x.is_zero()\\`\n+* \\`not x == zero\\`\n \n Comment: 1\n \n```\n",
    "created_at": "2012-11-26T15:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178465",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,59 @@
+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:
 
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)*x
+0
+\`\`\`
+## More tests
+
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)          # OK
+0.?e1
+sage: RIF(-2,1)*x        # Wrong
+0
+sage: RIF(-2,1)*x == 0   # Wrong
+True
+sage: cmp(RIF(-2,1)*x,0) # Wrong
+0
+sage: RIF(2,5)*x         # OK
+1.?e1*x
+sage: RIF(2,5)*x == 0    # OK
+False
+\`\`\`
+## Code digging
+The problem comes from the coercion:
+
+\`\`\`
+sage: R(RIF(-2,1))
+0
+sage: R(RIF(-2,1)) == 0
+True
+\`\`\`
+This in turn comes from the creation (in \`__init__\` of class \`MPolynomial_polydict\` in \`sage.rings.polynomial.multi_polynomial_element\`) of a PolyDict object (defined in \`sage.rings.polynomial.polydict\`) with the option \`remove_zero == True\`.
+
+\`\`\`
+from sage.rings.polynomial.polydict import PolyDict
+sage: PolyDict({(0,0):1}, remove_zero=True) # OK
+PolyDict with representation {(0, 0): 1}
+sage: PolyDict({(0,0):0}, remove_zero=True) # OK
+PolyDict with representation {}
+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
+PolyDict with representation {}
+\`\`\`
+To check if x is different from 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
+
+\`\`\`
+sage: RIF(-2,1) != 0
+False
+\`\`\`
+## Possible correction
+This bug might be corrected by replacing in PolyDict the tests \`x != zero\` by one of:
+
+* \`cmp(x,zero) != 0\`
+* \`not x.is_zero()\`
+* \`not x == zero\`
 
 Comment: 1
 
```




---

archive/issue_comments_178466.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_13760_interval_polynomial_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_interval_polynomial_fix.patch) by gmoroz created at 2012-11-26 15:25:39",
    "created_at": "2012-11-26T15:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178466",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

<a id='comment:2'></a>Attachment [trac_13760_interval_polynomial_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_interval_polynomial_fix.patch) by gmoroz created at 2012-11-26 15:25:39



---

archive/issue_comments_178467.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-27T13:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178467",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178468.json:
```json
{
    "body": "<a id='comment:5'></a>Guillaume, a non-regression test is missing (also for #7712).\n\nPaul",
    "created_at": "2012-12-07T17:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178468",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>Guillaume, a non-regression test is missing (also for #7712).

Paul



---

archive/issue_comments_178469.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-07T17:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178469",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_178470.json:
```json
{
    "body": "<a id='comment:7'></a>all tests pass on top of 5.4.1, just waiting for a non-regression test.\n\nPaul",
    "created_at": "2012-12-13T09:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178470",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'></a>all tests pass on top of 5.4.1, just waiting for a non-regression test.

Paul



---

archive/issue_comments_178471.json:
```json
{
    "body": "add regression tests (to be applied after the fix patch)",
    "created_at": "2012-12-13T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178471",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

add regression tests (to be applied after the fix patch)



---

archive/issue_comments_178472.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [trac_13760_regression_tests.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_regression_tests.patch) by @zimmermann6 created at 2012-12-14 08:11:50\n\nGuillaume, why didn't you add as regression tests the examples in the description of #7712 and this ticket?\n\nPaul",
    "created_at": "2012-12-14T08:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178472",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:8'></a>Attachment [trac_13760_regression_tests.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_regression_tests.patch) by @zimmermann6 created at 2012-12-14 08:11:50

Guillaume, why didn't you add as regression tests the examples in the description of #7712 and this ticket?

Paul



---

archive/issue_comments_178473.json:
```json
{
    "body": "<a id='comment:9'></a>all tests pass with the regression tests.\n\nPaul",
    "created_at": "2012-12-14T08:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178473",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:9'></a>all tests pass with the regression tests.

Paul



---

archive/issue_comments_178474.json:
```json
{
    "body": "<a id='comment:10'></a>I attached the patch with regression tests with user level examples on #7712 (this choice was quite random).",
    "created_at": "2012-12-14T09:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178474",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

<a id='comment:10'></a>I attached the patch with regression tests with user level examples on #7712 (this choice was quite random).



---

archive/issue_comments_178475.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-14T09:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178475",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178476.json:
```json
{
    "body": "Includes regression tests for #7712 and #13760 (same patch as in #7712, moved here for convenience)",
    "created_at": "2012-12-14T10:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178476",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Includes regression tests for #7712 and #13760 (same patch as in #7712, moved here for convenience)



---

archive/issue_comments_178477.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-14T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178477",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178478.json:
```json
{
    "body": "<a id='comment:12'></a>Attachment [trac_7712_regression_tests_for_13760_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_7712_regression_tests_for_13760_fix.patch) by @zimmermann6 created at 2012-12-14 17:15:07",
    "created_at": "2012-12-14T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178478",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>Attachment [trac_7712_regression_tests_for_13760_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_7712_regression_tests_for_13760_fix.patch) by @zimmermann6 created at 2012-12-14 17:15:07



---

archive/issue_events_038565.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-15T02:28:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "milestone": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13760#event-38565"
}
```



---

archive/issue_comments_178479.json:
```json
{
    "body": "<a id='comment:13'></a>Please indicate which patch(es) need to be applied.",
    "created_at": "2012-12-15T02:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178479",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Please indicate which patch(es) need to be applied.



---

archive/issue_comments_178480.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,61 @@\n+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n \n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)*x\n+0\n+\\`\\`\\`\n+## More tests\n+\n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)          # OK\n+0.?e1\n+sage: RIF(-2,1)*x        # Wrong\n+0\n+sage: RIF(-2,1)*x == 0   # Wrong\n+True\n+sage: cmp(RIF(-2,1)*x,0) # Wrong\n+0\n+sage: RIF(2,5)*x         # OK\n+1.?e1*x\n+sage: RIF(2,5)*x == 0    # OK\n+False\n+\\`\\`\\`\n+## Code digging\n+The problem comes from the coercion:\n+\n+\\`\\`\\`\n+sage: R(RIF(-2,1))\n+0\n+sage: R(RIF(-2,1)) == 0\n+True\n+\\`\\`\\`\n+This in turn comes from the creation (in \\`__init__\\` of class \\`MPolynomial_polydict\\` in \\`sage.rings.polynomial.multi_polynomial_element\\`) of a PolyDict object (defined in \\`sage.rings.polynomial.polydict\\`) with the option \\`remove_zero == True\\`.\n+\n+\\`\\`\\`\n+from sage.rings.polynomial.polydict import PolyDict\n+sage: PolyDict({(0,0):1}, remove_zero=True) # OK\n+PolyDict with representation {(0, 0): 1}\n+sage: PolyDict({(0,0):0}, remove_zero=True) # OK\n+PolyDict with representation {}\n+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\n+PolyDict with representation {}\n+\\`\\`\\`\n+To check if x is different from 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n+\n+\\`\\`\\`\n+sage: RIF(-2,1) != 0\n+False\n+\\`\\`\\`\n+## Possible correction\n+This bug might be corrected by replacing in PolyDict the tests \\`x != zero\\` by one of:\n+\n+* \\`cmp(x,zero) != 0\\`\n+* \\`not x.is_zero()\\`\n+* \\`not x == zero\\`\n+\n+Apply trac_13760_interval_polynomial_fix.patch, then trac_13760_regression_tests.patch, and finally trac_7712_regression_tests_for_13760_fix.patch.\n \n Comment: 1\n \n```\n",
    "created_at": "2012-12-15T07:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178480",
    "user": "https://github.com/zimmermann6"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,61 @@
+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:
 
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)*x
+0
+\`\`\`
+## More tests
+
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)          # OK
+0.?e1
+sage: RIF(-2,1)*x        # Wrong
+0
+sage: RIF(-2,1)*x == 0   # Wrong
+True
+sage: cmp(RIF(-2,1)*x,0) # Wrong
+0
+sage: RIF(2,5)*x         # OK
+1.?e1*x
+sage: RIF(2,5)*x == 0    # OK
+False
+\`\`\`
+## Code digging
+The problem comes from the coercion:
+
+\`\`\`
+sage: R(RIF(-2,1))
+0
+sage: R(RIF(-2,1)) == 0
+True
+\`\`\`
+This in turn comes from the creation (in \`__init__\` of class \`MPolynomial_polydict\` in \`sage.rings.polynomial.multi_polynomial_element\`) of a PolyDict object (defined in \`sage.rings.polynomial.polydict\`) with the option \`remove_zero == True\`.
+
+\`\`\`
+from sage.rings.polynomial.polydict import PolyDict
+sage: PolyDict({(0,0):1}, remove_zero=True) # OK
+PolyDict with representation {(0, 0): 1}
+sage: PolyDict({(0,0):0}, remove_zero=True) # OK
+PolyDict with representation {}
+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
+PolyDict with representation {}
+\`\`\`
+To check if x is different from 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
+
+\`\`\`
+sage: RIF(-2,1) != 0
+False
+\`\`\`
+## Possible correction
+This bug might be corrected by replacing in PolyDict the tests \`x != zero\` by one of:
+
+* \`cmp(x,zero) != 0\`
+* \`not x.is_zero()\`
+* \`not x == zero\`
+
+Apply trac_13760_interval_polynomial_fix.patch, then trac_13760_regression_tests.patch, and finally trac_7712_regression_tests_for_13760_fix.patch.
 
 Comment: 1
 
```




---

archive/issue_comments_178481.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 jdemeyer]:\n> Please indicate which patch(es) need to be applied.\n\n\nDone.\nPaul",
    "created_at": "2012-12-15T07:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178481",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:15'></a>Replying to [comment:13 jdemeyer]:
> Please indicate which patch(es) need to be applied.


Done.
Paul



---

archive/issue_comments_178482.json:
```json
{
    "body": "<a id='comment:16'></a>One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.",
    "created_at": "2012-12-15T16:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178482",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.



---

archive/issue_comments_178483.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 tscrim]:\n> One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.\n\n\nIt seems that I cannot attach a new patch for that. Is it because of the positive review status?",
    "created_at": "2012-12-19T15:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178483",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

<a id='comment:17'></a>Replying to [comment:16 tscrim]:
> One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.


It seems that I cannot attach a new patch for that. Is it because of the positive review status?



---

archive/issue_comments_178484.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 gmoroz]:\n> It seems that I cannot attach a new patch for that. Is it because of the positive review status?\n\n\nStrange...I don't think so, but I'll set this to needs work and try it then.",
    "created_at": "2012-12-19T17:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178484",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Replying to [comment:17 gmoroz]:
> It seems that I cannot attach a new patch for that. Is it because of the positive review status?


Strange...I don't think so, but I'll set this to needs work and try it then.



---

archive/issue_comments_178485.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-19T17:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178485",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178486.json:
```json
{
    "body": "Attachment [trac_13760_documentation_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_documentation_fix.patch) by gmoroz created at 2012-12-19 18:06:25",
    "created_at": "2012-12-19T18:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178486",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Attachment [trac_13760_documentation_fix.patch](tarball://root/attachments/some-uuid/ticket13760/trac_13760_documentation_fix.patch) by gmoroz created at 2012-12-19 18:06:25



---

archive/issue_comments_178487.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,61 @@\n+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n \n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)*x\n+0\n+\\`\\`\\`\n+## More tests\n+\n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)          # OK\n+0.?e1\n+sage: RIF(-2,1)*x        # Wrong\n+0\n+sage: RIF(-2,1)*x == 0   # Wrong\n+True\n+sage: cmp(RIF(-2,1)*x,0) # Wrong\n+0\n+sage: RIF(2,5)*x         # OK\n+1.?e1*x\n+sage: RIF(2,5)*x == 0    # OK\n+False\n+\\`\\`\\`\n+## Code digging\n+The problem comes from the coercion:\n+\n+\\`\\`\\`\n+sage: R(RIF(-2,1))\n+0\n+sage: R(RIF(-2,1)) == 0\n+True\n+\\`\\`\\`\n+This in turn comes from the creation (in \\`__init__\\` of class \\`MPolynomial_polydict\\` in \\`sage.rings.polynomial.multi_polynomial_element\\`) of a PolyDict object (defined in \\`sage.rings.polynomial.polydict\\`) with the option \\`remove_zero == True\\`.\n+\n+\\`\\`\\`\n+from sage.rings.polynomial.polydict import PolyDict\n+sage: PolyDict({(0,0):1}, remove_zero=True) # OK\n+PolyDict with representation {(0, 0): 1}\n+sage: PolyDict({(0,0):0}, remove_zero=True) # OK\n+PolyDict with representation {}\n+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\n+PolyDict with representation {}\n+\\`\\`\\`\n+To check if x is different from 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n+\n+\\`\\`\\`\n+sage: RIF(-2,1) != 0\n+False\n+\\`\\`\\`\n+## Possible correction\n+This bug might be corrected by replacing in PolyDict the tests \\`x != zero\\` by one of:\n+\n+* \\`cmp(x,zero) != 0\\`\n+* \\`not x.is_zero()\\`\n+* \\`not x == zero\\`\n+\n+Apply trac_13760_interval_polynomial_fix.patch, then trac_13760_regression_tests.patch, then trac_7712_regression_tests_for_13760_fix.patch, and finally trac_13760_documentation_fix.patch.\n \n Comment: 1\n \n```\n",
    "created_at": "2012-12-19T18:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178487",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,61 @@
+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:
 
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)*x
+0
+\`\`\`
+## More tests
+
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)          # OK
+0.?e1
+sage: RIF(-2,1)*x        # Wrong
+0
+sage: RIF(-2,1)*x == 0   # Wrong
+True
+sage: cmp(RIF(-2,1)*x,0) # Wrong
+0
+sage: RIF(2,5)*x         # OK
+1.?e1*x
+sage: RIF(2,5)*x == 0    # OK
+False
+\`\`\`
+## Code digging
+The problem comes from the coercion:
+
+\`\`\`
+sage: R(RIF(-2,1))
+0
+sage: R(RIF(-2,1)) == 0
+True
+\`\`\`
+This in turn comes from the creation (in \`__init__\` of class \`MPolynomial_polydict\` in \`sage.rings.polynomial.multi_polynomial_element\`) of a PolyDict object (defined in \`sage.rings.polynomial.polydict\`) with the option \`remove_zero == True\`.
+
+\`\`\`
+from sage.rings.polynomial.polydict import PolyDict
+sage: PolyDict({(0,0):1}, remove_zero=True) # OK
+PolyDict with representation {(0, 0): 1}
+sage: PolyDict({(0,0):0}, remove_zero=True) # OK
+PolyDict with representation {}
+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
+PolyDict with representation {}
+\`\`\`
+To check if x is different from 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
+
+\`\`\`
+sage: RIF(-2,1) != 0
+False
+\`\`\`
+## Possible correction
+This bug might be corrected by replacing in PolyDict the tests \`x != zero\` by one of:
+
+* \`cmp(x,zero) != 0\`
+* \`not x.is_zero()\`
+* \`not x == zero\`
+
+Apply trac_13760_interval_polynomial_fix.patch, then trac_13760_regression_tests.patch, then trac_7712_regression_tests_for_13760_fix.patch, and finally trac_13760_documentation_fix.patch.
 
 Comment: 1
 
```




---

archive/issue_comments_178488.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 tscrim]:\n> Strange...I don't think so, but I'll set this to needs work and try it then.\n\nMy bad, it appears that my file didn't have permissions to be read.",
    "created_at": "2012-12-19T18:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178488",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmoroz"
}
```

<a id='comment:20'></a>Replying to [comment:18 tscrim]:
> Strange...I don't think so, but I'll set this to needs work and try it then.

My bad, it appears that my file didn't have permissions to be read.



---

archive/issue_comments_178489.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-19T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178489",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_178490.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,66 @@\n+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n \n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)*x\n+0\n+\\`\\`\\`\n+## More tests\n+\n+\\`\\`\\`\n+sage: R.<x,y> = PolynomialRing(RIF,2)\n+sage: RIF(-2,1)          # OK\n+0.?e1\n+sage: RIF(-2,1)*x        # Wrong\n+0\n+sage: RIF(-2,1)*x == 0   # Wrong\n+True\n+sage: cmp(RIF(-2,1)*x,0) # Wrong\n+0\n+sage: RIF(2,5)*x         # OK\n+1.?e1*x\n+sage: RIF(2,5)*x == 0    # OK\n+False\n+\\`\\`\\`\n+## Code digging\n+The problem comes from the coercion:\n+\n+\\`\\`\\`\n+sage: R(RIF(-2,1))\n+0\n+sage: R(RIF(-2,1)) == 0\n+True\n+\\`\\`\\`\n+This in turn comes from the creation (in \\`__init__\\` of class \\`MPolynomial_polydict\\` in \\`sage.rings.polynomial.multi_polynomial_element\\`) of a PolyDict object (defined in \\`sage.rings.polynomial.polydict\\`) with the option \\`remove_zero == True\\`.\n+\n+\\`\\`\\`\n+from sage.rings.polynomial.polydict import PolyDict\n+sage: PolyDict({(0,0):1}, remove_zero=True) # OK\n+PolyDict with representation {(0, 0): 1}\n+sage: PolyDict({(0,0):0}, remove_zero=True) # OK\n+PolyDict with representation {}\n+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\n+PolyDict with representation {}\n+\\`\\`\\`\n+To check if x is different from 0, PolyDict uses the test \\`x != 0\\`, which actually checks for disjointness in interval field:\n+\n+\\`\\`\\`\n+sage: RIF(-2,1) != 0\n+False\n+\\`\\`\\`\n+## Possible correction\n+This bug might be corrected by replacing in PolyDict the tests \\`x != zero\\` by one of:\n+\n+* \\`cmp(x,zero) != 0\\`\n+* \\`not x.is_zero()\\`\n+* \\`not x == zero\\`\n+\n+Apply:\n+\n+- [attachment:trac_13760_interval_polynomial_fix.patch]\n+- [attachment:trac_13760_regression_tests.patch]\n+- [attachment:trac_7712_regression_tests_for_13760_fix.patch]\n+- [attachment:trac_13760_documentation_fix.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2012-12-19T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178490",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,66 @@
+Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:
 
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)*x
+0
+\`\`\`
+## More tests
+
+\`\`\`
+sage: R.<x,y> = PolynomialRing(RIF,2)
+sage: RIF(-2,1)          # OK
+0.?e1
+sage: RIF(-2,1)*x        # Wrong
+0
+sage: RIF(-2,1)*x == 0   # Wrong
+True
+sage: cmp(RIF(-2,1)*x,0) # Wrong
+0
+sage: RIF(2,5)*x         # OK
+1.?e1*x
+sage: RIF(2,5)*x == 0    # OK
+False
+\`\`\`
+## Code digging
+The problem comes from the coercion:
+
+\`\`\`
+sage: R(RIF(-2,1))
+0
+sage: R(RIF(-2,1)) == 0
+True
+\`\`\`
+This in turn comes from the creation (in \`__init__\` of class \`MPolynomial_polydict\` in \`sage.rings.polynomial.multi_polynomial_element\`) of a PolyDict object (defined in \`sage.rings.polynomial.polydict\`) with the option \`remove_zero == True\`.
+
+\`\`\`
+from sage.rings.polynomial.polydict import PolyDict
+sage: PolyDict({(0,0):1}, remove_zero=True) # OK
+PolyDict with representation {(0, 0): 1}
+sage: PolyDict({(0,0):0}, remove_zero=True) # OK
+PolyDict with representation {}
+sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
+PolyDict with representation {}
+\`\`\`
+To check if x is different from 0, PolyDict uses the test \`x != 0\`, which actually checks for disjointness in interval field:
+
+\`\`\`
+sage: RIF(-2,1) != 0
+False
+\`\`\`
+## Possible correction
+This bug might be corrected by replacing in PolyDict the tests \`x != zero\` by one of:
+
+* \`cmp(x,zero) != 0\`
+* \`not x.is_zero()\`
+* \`not x == zero\`
+
+Apply:
+
+- [attachment:trac_13760_interval_polynomial_fix.patch]
+- [attachment:trac_13760_regression_tests.patch]
+- [attachment:trac_7712_regression_tests_for_13760_fix.patch]
+- [attachment:trac_13760_documentation_fix.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_178491.json:
```json
{
    "body": "<a id='comment:21'></a>Thanks for fixing this.",
    "created_at": "2012-12-19T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178491",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>Thanks for fixing this.



---

archive/issue_events_038566.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-21T09:33:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13760#event-38566"
}
```



---

archive/issue_comments_178492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-21T09:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13760#issuecomment-178492",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
