# Issue 13432: add sage/env.py and fix many inappropriate references to SAGE_ROOT

archive/issues_013260.json:
```json
{
    "assignees": [],
    "body": "There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.\n\nThis ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n\nFollowup: #14226.\n\n**Installation Instructions**:\n* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n* apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n\nDepends on #13123\nDepends on #13348\n\nAssignee: **@jasongrout**\n\nCC:  @jdemeyer @kiwifb @burcin\n\nKeywords: **build warnings**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **R. Andrew Ohana**\n\nMerged: **sage-5.9.beta0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13432_\n\n",
    "closed_at": "2013-03-13T11:05:30Z",
    "created_at": "2012-09-06T08:57:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "add sage/env.py and fix many inappropriate references to SAGE_ROOT",
    "type": "issue",
    "updated_at": "2017-08-31T22:19:02Z",
    "url": "https://github.com/sagemath/sage/issues/13432",
    "user": "https://github.com/ohanar"
}
```
There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.

This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).

Followup: #14226.

**Installation Instructions**:
* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
* apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library

Depends on #13123
Depends on #13348

Assignee: **@jasongrout**

CC:  @jdemeyer @kiwifb @burcin

Keywords: **build warnings**

Reviewer: **Fran√ßois Bissey**

Author: **R. Andrew Ohana**

Merged: **sage-5.9.beta0**

_Issue created by migration from https://trac.sagemath.org/ticket/13432_





---

archive/issue_events_172018.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T08:57:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172018"
}
```



---

archive/issue_events_172019.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T08:57:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172019"
}
```



---

archive/issue_comments_159034.json:
```json
{
    "body": "Dependencies: **#13123**",
    "created_at": "2012-09-06T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159034",
    "user": "https://github.com/ohanar"
}
```

Dependencies: **#13123**



---

archive/issue_comments_159035.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\n+1 to the idea.",
    "created_at": "2012-09-06T09:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159035",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'>Comment 2:</a>
+1 to the idea.



---

archive/issue_comments_159036.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env. How is the sage \"executable\" supposed to know about SAGE_ROOT/SAGE_LOCAL from the new env.py?",
    "created_at": "2012-09-06T09:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159036",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>Comment 3:</a>
I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env. How is the sage "executable" supposed to know about SAGE_ROOT/SAGE_LOCAL from the new env.py?



---

archive/issue_comments_159037.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@kiwifb](#comment%3A3):\n> I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env.\n\nI don't think there is duplication if `sage/env.py` simply reads the environment variables set by `sage-env`.  I see it as a library interface to the `sage-env` script.",
    "created_at": "2012-09-06T09:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159037",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@kiwifb](#comment%3A3):
> I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env.

I don't think there is duplication if `sage/env.py` simply reads the environment variables set by `sage-env`.  I see it as a library interface to the `sage-env` script.



---

archive/issue_comments_159038.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nEventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).",
    "created_at": "2012-09-06T09:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159038",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:5'>Comment 5:</a>
Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).



---

archive/issue_events_172020.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T09:29:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage.env and fix inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix a inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172020"
}
```



---

archive/issue_comments_159039.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nOK I read it a bit more carefully and I see it is sourced from the environment. I guess sage in its current state can work like that without problem.\n\nAnd yes from my sage-on-gentoo point of view where sage is part of the system I would need it to be independent. There are issues in s-o-g when you import thing like sympy in python because it will pull sage if installed. If the variables are not in the environment things break in sageinspect. \n\nWe used to define SAGE variable in the global environment but that had its issue and the lmnd people (should copy burcin on this) didn't like it. At the moment I have pushed things in misc/misc.py to make things work in most cases.",
    "created_at": "2012-09-06T09:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159039",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'>Comment 6:</a>
OK I read it a bit more carefully and I see it is sourced from the environment. I guess sage in its current state can work like that without problem.

And yes from my sage-on-gentoo point of view where sage is part of the system I would need it to be independent. There are issues in s-o-g when you import thing like sympy in python because it will pull sage if installed. If the variables are not in the environment things break in sageinspect. 

We used to define SAGE variable in the global environment but that had its issue and the lmnd people (should copy burcin on this) didn't like it. At the moment I have pushed things in misc/misc.py to make things work in most cases.



---

archive/issue_comments_159040.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@ohanar](#comment%3A5):\n> Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).\n\nI'm not sure whether I like that, but since it's in the distant future, I don't have to worry about it.",
    "created_at": "2012-09-06T09:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159040",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@ohanar](#comment%3A5):
> Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).

I'm not sure whether I like that, but since it's in the distant future, I don't have to worry about it.



---

archive/issue_comments_159041.json:
```json
{
    "body": "Changed dependencies from **#13123** to **#13123, #13348**",
    "created_at": "2012-09-12T21:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159041",
    "user": "https://github.com/ohanar"
}
```

Changed dependencies from **#13123** to **#13123, #13348**



---

archive/issue_comments_159042.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.\n \n This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n+\n+**Installation Instructions**:\n+* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]\n``````\n",
    "created_at": "2012-09-12T21:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159042",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.
 
 This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
+
+**Installation Instructions**:
+* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]
``````




---

archive/issue_events_172021.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-05T06:42:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage.env and fix many inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172021"
}
```



---

archive/issue_events_172022.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-05T06:42:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172022"
}
```



---

archive/issue_comments_159043.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nOk, this has been fixed up and should be ready to go now.",
    "created_at": "2013-03-05T06:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159043",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:10'>Comment 10:</a>
Ok, this has been fixed up and should be ready to go now.



---

archive/issue_comments_159044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.\n+There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.\n \n-This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n+This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n \n **Installation Instructions**:\n-* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]\n+* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n``````\n",
    "created_at": "2013-03-05T06:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159044",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.
+There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.
 
-This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
+This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
 
 **Installation Instructions**:
-* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]
+* apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
``````




---

archive/issue_events_172023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T06:47:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage/env.py and fix many inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix many inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172023"
}
```



---

archive/issue_comments_159045.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,7 @@\n \n This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n \n+Followup: #14226.\n+\n **Installation Instructions**:\n * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n``````\n",
    "created_at": "2013-03-05T07:55:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159045",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,7 @@
 
 This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
 
+Followup: #14226.
+
 **Installation Instructions**:
 * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
``````




---

archive/issue_comments_159046.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThat looks so much like the mega patch that I apply to sage-on-gentoo. OK my equivalent of env.py is not nearly as sophisticated and I don't have some of these new variables. But otherwise that's scary and this will simplify my life a great deal.\n\nI am going through comparing with my own stuff.",
    "created_at": "2013-03-05T08:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159046",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'>Comment 13:</a>
That looks so much like the mega patch that I apply to sage-on-gentoo. OK my equivalent of env.py is not nearly as sophisticated and I don't have some of these new variables. But otherwise that's scary and this will simplify my life a great deal.

I am going through comparing with my own stuff.



---

archive/issue_comments_159047.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nOK so far the main differences with my own stuff is that I have gone on a hunt on a wider ranger of variables. SAGE_ROOT is the lead bad guy but I also went for most instances of os.environ['SAGE_LOCAL'] and others that made sense to me. This ticket is just for SAGE_ROOT and that's already a big chunk.",
    "created_at": "2013-03-05T08:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159047",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'>Comment 14:</a>
OK so far the main differences with my own stuff is that I have gone on a hunt on a wider ranger of variables. SAGE_ROOT is the lead bad guy but I also went for most instances of os.environ['SAGE_LOCAL'] and others that made sense to me. This ticket is just for SAGE_ROOT and that's already a big chunk.



---

archive/issue_comments_159048.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n`SAGE_ROOT` is the main bad guy for my purposes (which is the transition to git). I haven't completely fixed every single usage of it in the library, because some bits required a good amount of logic to rework, so if your patch has fixes for the bits that I omitted that would be appreciated.\n\nI think that a follow up ticket for the `SAGE_LOCAL` instances would be a good idea. You should check my usage's of `SAGE_SRC` and see if your patch gets away something more or less equivalent to my `SAGE_LIB` in any of those places.",
    "created_at": "2013-03-05T08:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159048",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:15'>Comment 15:</a>
`SAGE_ROOT` is the main bad guy for my purposes (which is the transition to git). I haven't completely fixed every single usage of it in the library, because some bits required a good amount of logic to rework, so if your patch has fixes for the bits that I omitted that would be appreciated.

I think that a follow up ticket for the `SAGE_LOCAL` instances would be a good idea. You should check my usage's of `SAGE_SRC` and see if your patch gets away something more or less equivalent to my `SAGE_LIB` in any of those places.



---

archive/issue_comments_159049.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nIn one of my first attempt I ended up with an unbuildable sage :( but getting all the variables in an independent file is the big cure for that. I understand the problem with the logic. I still have one doctest failure in lazy_import_cache in sage-on-gentoo and I am not sure why.\n\nI didn't create any new variables like SAGE_SRC and SAGE_LIB, that was a lot of work as it is.\n\nI believe the other instances of SAGE_ROOT in sage/misc/cython.py can go.\n\n```\n@@ -335,10 +336,10 @@\n     Before :trac:`12975`, it would have beeen needed to write ``#clang c++``,\n     but upper case ``C++`` has resulted in an error::\n\n-        sage: from sage.all import SAGE_ROOT\n+        sage: from sage.env import SAGE_LOCAL\n         sage: code = [\n         ... \"#clang C++\",\n-        ... \"#cinclude %s/local/include/singular %s/local/include/factory\"%(SAGE_ROOT,SAGE_ROOT),\n+        ... \"#cinclude %s/include/singular %s/include/singular\"%(SAGE_LOCAL,SAGE_LOCAL),\n         ... \"#clib m readline singular givaro ntl gmpxx gmp\",\n         ... \"from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsin$\n         ... \"from sage.libs.singular.polynomial cimport singular_polynomial_pow\",\n@@ -449,12 +450,7 @@\n import distutils.sysconfig, os, sys\n from distutils.core import setup, Extension\n\n-if not os.environ.has_key('SAGE_ROOT'):\n-    print \"    ERROR: The environment variable SAGE_ROOT must be defined.\"\n-    sys.exit(1)\n-else:\n-    SAGE_ROOT  = os.environ['SAGE_ROOT']\n-    SAGE_LOCAL = SAGE_ROOT + '/local/'\n+from sage.env import SAGE_ROOT, SAGE_LOCAL\n\n extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']\n extra_compile_args = %s\n```\nI edited it so it is closer to your style.",
    "created_at": "2013-03-05T08:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159049",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'>Comment 16:</a>
In one of my first attempt I ended up with an unbuildable sage :( but getting all the variables in an independent file is the big cure for that. I understand the problem with the logic. I still have one doctest failure in lazy_import_cache in sage-on-gentoo and I am not sure why.

I didn't create any new variables like SAGE_SRC and SAGE_LIB, that was a lot of work as it is.

I believe the other instances of SAGE_ROOT in sage/misc/cython.py can go.

```
@@ -335,10 +336,10 @@
     Before :trac:`12975`, it would have beeen needed to write ``#clang c++``,
     but upper case ``C++`` has resulted in an error::

-        sage: from sage.all import SAGE_ROOT
+        sage: from sage.env import SAGE_LOCAL
         sage: code = [
         ... "#clang C++",
-        ... "#cinclude %s/local/include/singular %s/local/include/factory"%(SAGE_ROOT,SAGE_ROOT),
+        ... "#cinclude %s/include/singular %s/include/singular"%(SAGE_LOCAL,SAGE_LOCAL),
         ... "#clib m readline singular givaro ntl gmpxx gmp",
         ... "from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsin$
         ... "from sage.libs.singular.polynomial cimport singular_polynomial_pow",
@@ -449,12 +450,7 @@
 import distutils.sysconfig, os, sys
 from distutils.core import setup, Extension

-if not os.environ.has_key('SAGE_ROOT'):
-    print "    ERROR: The environment variable SAGE_ROOT must be defined."
-    sys.exit(1)
-else:
-    SAGE_ROOT  = os.environ['SAGE_ROOT']
-    SAGE_LOCAL = SAGE_ROOT + '/local/'
+from sage.env import SAGE_ROOT, SAGE_LOCAL

 extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']
 extra_compile_args = %s
```
I edited it so it is closer to your style.



---

archive/issue_comments_159050.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nsage/sandpiles/sandpile.py you have \n\n```\nSAGE_ROOT = os.environ['SAGE_ROOT'] \npath_to_zsolve = SAGE_ROOT+'/local/bin/' \n```\nbecoming \n\n```\npath_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n```\nIs it correcting a bug as well?",
    "created_at": "2013-03-05T08:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159050",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'>Comment 17:</a>
sage/sandpiles/sandpile.py you have 

```
SAGE_ROOT = os.environ['SAGE_ROOT'] 
path_to_zsolve = SAGE_ROOT+'/local/bin/' 
```
becoming 

```
path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
```
Is it correcting a bug as well?



---

archive/issue_comments_159051.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@kiwifb](#comment%3A17):\n> sage/sandpiles/sandpile.py you have \n> \n> ```\n> SAGE_ROOT = os.environ['SAGE_ROOT'] \n> path_to_zsolve = SAGE_ROOT+'/local/bin/' \n> ```\n> becoming \n> \n> ```\n> path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n> ```\n> Is it correcting a bug as well?\n\nNo, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.",
    "created_at": "2013-03-05T08:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159051",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@kiwifb](#comment%3A17):
> sage/sandpiles/sandpile.py you have 
> 
> ```
> SAGE_ROOT = os.environ['SAGE_ROOT'] 
> path_to_zsolve = SAGE_ROOT+'/local/bin/' 
> ```
> becoming 
> 
> ```
> path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
> ```
> Is it correcting a bug as well?

No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.



---

archive/issue_comments_159052.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@ohanar](#comment%3A18):\n> Replying to [@kiwifb](#comment%3A17):\n> > sage/sandpiles/sandpile.py you have \n> > \n> > ```\n> > SAGE_ROOT = os.environ['SAGE_ROOT'] \n> > path_to_zsolve = SAGE_ROOT+'/local/bin/' \n> > ```\n> > becoming \n> > \n> > ```\n> > path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n> > ```\n> > Is it correcting a bug as well?\n\n> \n> No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.\n\n\nI missed that line.\n\nIs the replacement of SAGE_INC in setup.py (well spotted the one where it is still SAGE_LOCAL/include) by CPATH really necessary? That's the only place CPATH is used and you don't use it in module_list.py anyway.\n\nApart from this I am positive that it should go in while it is easy to apply. We may do some more work on this later.",
    "created_at": "2013-03-05T09:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159052",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@ohanar](#comment%3A18):
> Replying to [@kiwifb](#comment%3A17):
> > sage/sandpiles/sandpile.py you have 
> > 
> > ```
> > SAGE_ROOT = os.environ['SAGE_ROOT'] 
> > path_to_zsolve = SAGE_ROOT+'/local/bin/' 
> > ```
> > becoming 
> > 
> > ```
> > path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
> > ```
> > Is it correcting a bug as well?

> 
> No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.


I missed that line.

Is the replacement of SAGE_INC in setup.py (well spotted the one where it is still SAGE_LOCAL/include) by CPATH really necessary? That's the only place CPATH is used and you don't use it in module_list.py anyway.

Apart from this I am positive that it should go in while it is easy to apply. We may do some more work on this later.



---

archive/issue_comments_159053.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nDon't use `CPATH` the way you are using it. Invent a new variable `SAGE_INCLUDE` or whatever.\n\n`CPATH` is a colon-separated list of directories searched by GCC for include files.",
    "created_at": "2013-03-05T09:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159053",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
Don't use `CPATH` the way you are using it. Invent a new variable `SAGE_INCLUDE` or whatever.

`CPATH` is a colon-separated list of directories searched by GCC for include files.



---

archive/issue_comments_159054.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI think CPATH (and its idea) should be dropped from sage.env altogether and setup.py only be touched to normalize its use of SAGE_INC.",
    "created_at": "2013-03-05T09:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159054",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'>Comment 21:</a>
I think CPATH (and its idea) should be dropped from sage.env altogether and setup.py only be touched to normalize its use of SAGE_INC.



---

archive/issue_comments_159055.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@kiwifb](#comment%3A21):\n> I think CPATH (and its idea) should be dropped from sage.env altogether.\n\nYes exactly.",
    "created_at": "2013-03-05T09:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159055",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@kiwifb](#comment%3A21):
> I think CPATH (and its idea) should be dropped from sage.env altogether.

Yes exactly.



---

archive/issue_events_172024.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T09:26:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172024"
}
```



---

archive/issue_events_172025.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T09:26:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172025"
}
```



---

archive/issue_comments_159056.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nOk, updated the patch. Added the fix for `cython.py` suggested and reverted `CPATH` to `SAGE_INC` and it is no longer defined in `env.py`. I also modified `module_list.py` to use the new module as well.",
    "created_at": "2013-03-05T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159056",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:24'>Comment 24:</a>
Ok, updated the patch. Added the fix for `cython.py` suggested and reverted `CPATH` to `SAGE_INC` and it is no longer defined in `env.py`. I also modified `module_list.py` to use the new module as well.



---

archive/issue_comments_159057.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nThank you for the new patch. I will still whine a bit about setup.py. In the definition of \"include_dirs\" on line 54 (after patch) you didn't put SAGE_INC itself. I think the list should be\n\n```\ninclude_dirs = [SAGE_INC,\n                os.path.join(SAGE_INC, 'csage'), \n \t              os.path.join(SAGE_SRC, 'sage', 'ext')]\n```\nI don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.",
    "created_at": "2013-03-06T09:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159057",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'>Comment 25:</a>
Thank you for the new patch. I will still whine a bit about setup.py. In the definition of "include_dirs" on line 54 (after patch) you didn't put SAGE_INC itself. I think the list should be

```
include_dirs = [SAGE_INC,
                os.path.join(SAGE_INC, 'csage'), 
 	              os.path.join(SAGE_SRC, 'sage', 'ext')]
```
I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.



---

archive/issue_comments_159058.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@kiwifb](#comment%3A25):\n> I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.\n\nI thought the point of #13348 was so that we didn't have to add `SAGE_LOCAL/include` to spkgs anymore. Truthfully, I would also like to replace `os.path.join(SAGE_INC, 'csage')` with `os.path.join(SAGE_SRC, 'c_lib', 'include')`, since in some distant future, I would like the sage python library, c library, extcode, and scripts to be a single \"sage\" package (but obviously this conflicts with both the setup of sage and sage-on-gentoo presently).",
    "created_at": "2013-03-06T21:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159058",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@kiwifb](#comment%3A25):
> I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.

I thought the point of #13348 was so that we didn't have to add `SAGE_LOCAL/include` to spkgs anymore. Truthfully, I would also like to replace `os.path.join(SAGE_INC, 'csage')` with `os.path.join(SAGE_SRC, 'c_lib', 'include')`, since in some distant future, I would like the sage python library, c library, extcode, and scripts to be a single "sage" package (but obviously this conflicts with both the setup of sage and sage-on-gentoo presently).



---

archive/issue_comments_159059.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nAnd truthfully I would like the c_lib to be handled differently, not completely sure how but differently. I was concerned that not putting SAGE_INC would break some upgrades. But upgrade from very old versions of sage is not recommended or guaranteed to work in any case. CPATH has been included in sage 5.4 that should be old enough.\n\nPositive review then.",
    "created_at": "2013-03-06T21:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159059",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'>Comment 27:</a>
And truthfully I would like the c_lib to be handled differently, not completely sure how but differently. I was concerned that not putting SAGE_INC would break some upgrades. But upgrade from very old versions of sage is not recommended or guaranteed to work in any case. CPATH has been included in sage 5.4 that should be old enough.

Positive review then.



---

archive/issue_events_172026.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-06T21:55:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172026"
}
```



---

archive/issue_events_172027.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-06T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172027"
}
```



---

archive/issue_comments_159060.json:
```json
{
    "body": "apply to root repository",
    "created_at": "2013-03-06T23:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159060",
    "user": "https://github.com/ohanar"
}
```

apply to root repository



---

archive/issue_comments_159061.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159061",
    "user": "https://github.com/ohanar"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_comments_159062.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,4 @@\n \n **Installation Instructions**:\n * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n+* apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159062",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,4 @@
 
 **Installation Instructions**:
 * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
+* apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_comments_159063.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nAttachment: **[trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz)**\n\nReplying to [@kiwifb](#comment%3A27):\n> I was concerned that not putting SAGE_INC would break some upgrades.\n\nGood point, I think Jeroen tries to make sure that all versions back to 4.8 can still upgrade. This should still work even for those versions since the sage library implicitly depends on SAGE_ROOT_REPO, but just to be sure, I've added a tiny patch to the root repository to make this dependency explicit.",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159063",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:28'>Comment 28:</a>
Attachment: **[trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz)**

Replying to [@kiwifb](#comment%3A27):
> I was concerned that not putting SAGE_INC would break some upgrades.

Good point, I think Jeroen tries to make sure that all versions back to 4.8 can still upgrade. This should still work even for those versions since the sage library implicitly depends on SAGE_ROOT_REPO, but just to be sure, I've added a tiny patch to the root repository to make this dependency explicit.



---

archive/issue_comments_159064.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nI test upgrades starting from sage-4.5 (older versions don't work because they lack the `pipestatus` script).",
    "created_at": "2013-03-07T07:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159064",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
I test upgrades starting from sage-4.5 (older versions don't work because they lack the `pipestatus` script).



---

archive/issue_comments_159065.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nIn `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:\n\n```\n        #If the 'SAGE_PEXPECT_LOG' environment variable is set and\n        #the current logfile is None, then set the logfile to be one\n        #in .sage/pexpect_logs/\n        if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:\n            from sage.misc.all import DOT_SAGE\n            logs = '%s/pexpect_logs'%DOT_SAGE\n            sage_makedirs(logs)\n\n            filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)\n            self.__logfile = open(filename, 'w')\n```",
    "created_at": "2013-03-07T10:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159065",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:

```
        #If the 'SAGE_PEXPECT_LOG' environment variable is set and
        #the current logfile is None, then set the logfile to be one
        #in .sage/pexpect_logs/
        if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:
            from sage.misc.all import DOT_SAGE
            logs = '%s/pexpect_logs'%DOT_SAGE
            sage_makedirs(logs)

            filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)
            self.__logfile = open(filename, 'w')
```



---

archive/issue_events_172028.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T10:09:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172028"
}
```



---

archive/issue_events_172029.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T10:09:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172029"
}
```



---

archive/issue_comments_159066.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@jdemeyer](#comment%3A30):\n> In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:\n> \n> ```\n>         #If the 'SAGE_PEXPECT_LOG' environment variable is set and\n>         #the current logfile is None, then set the logfile to be one\n>         #in .sage/pexpect_logs/\n>         if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:\n>             from sage.misc.all import DOT_SAGE\n>             logs = '%s/pexpect_logs'%DOT_SAGE\n>             sage_makedirs(logs)\n> \n>             filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)\n>             self.__logfile = open(filename, 'w')\n> ```\n\nThat shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py but OK will fix it.",
    "created_at": "2013-03-07T19:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159066",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@jdemeyer](#comment%3A30):
> In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:
> 
> ```
>         #If the 'SAGE_PEXPECT_LOG' environment variable is set and
>         #the current logfile is None, then set the logfile to be one
>         #in .sage/pexpect_logs/
>         if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:
>             from sage.misc.all import DOT_SAGE
>             logs = '%s/pexpect_logs'%DOT_SAGE
>             sage_makedirs(logs)
> 
>             filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)
>             self.__logfile = open(filename, 'w')
> ```

That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py but OK will fix it.



---

archive/issue_comments_159067.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nActually why this particular file even after the big patch there are several instances of sage variables imported from misc/misc.py. Do you want them all switched to env.py?",
    "created_at": "2013-03-07T20:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159067",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'>Comment 32:</a>
Actually why this particular file even after the big patch there are several instances of sage variables imported from misc/misc.py. Do you want them all switched to env.py?



---

archive/issue_comments_159068.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@kiwifb](#comment%3A31):\n> That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py\n\nNo, it's not covered since this one imports from sage.misc.**all**. And yes, it leads to failures (in an unrelated doctest in #12415).",
    "created_at": "2013-03-07T22:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159068",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@kiwifb](#comment%3A31):
> That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py

No, it's not covered since this one imports from sage.misc.**all**. And yes, it leads to failures (in an unrelated doctest in #12415).



---

archive/issue_comments_159069.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nHa. I missed that. In my version of this for sage-on-gentoo I made sage.misc.all backward compatible, ohanar didn't. I will check what other places rely on misc.all.",
    "created_at": "2013-03-07T22:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159069",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'>Comment 34:</a>
Ha. I missed that. In my version of this for sage-on-gentoo I made sage.misc.all backward compatible, ohanar didn't. I will check what other places rely on misc.all.



---

archive/issue_comments_159070.json:
```json
{
    "body": "Attachment: **[trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz)**\n\nFix DOT_SAGE in expect.py",
    "created_at": "2013-03-07T22:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159070",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz)**

Fix DOT_SAGE in expect.py



---

archive/issue_events_172030.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-07T22:28:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172030"
}
```



---

archive/issue_events_172031.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-07T22:28:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172031"
}
```



---

archive/issue_comments_159071.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,5 @@\n \n **Installation Instructions**:\n * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n+* apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n * apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-07T22:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159071",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,5 @@
 
 **Installation Instructions**:
 * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
+* apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library
 * apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_comments_159072.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nThat was the last spot. I added a trivial patch to take care of it.",
    "created_at": "2013-03-07T22:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159072",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'>Comment 35:</a>
That was the last spot. I added a trivial patch to take care of it.



---

archive/issue_comments_159073.json:
```json
{
    "body": "Changed keywords from **** to **build warnings**",
    "created_at": "2013-03-08T22:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159073",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **** to **build warnings**



---

archive/issue_comments_159074.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nWhen building Sage, there are lots of warnings of the form\n\n```\n  warnings.warn(msg+' I will assume it is a system C/C++ header.')\nsetup.py:637: UserWarning: could not find dependency linbox/algorithms/echelon-form.h included in sage/libs/linbox/echelonform.pxd. I will assume it is a system C/C++ header.\n```\nThis is a problem, those headers are **not** system headers, which might break dependency checking.",
    "created_at": "2013-03-08T22:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159074",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'>Comment 36:</a>
When building Sage, there are lots of warnings of the form

```
  warnings.warn(msg+' I will assume it is a system C/C++ header.')
setup.py:637: UserWarning: could not find dependency linbox/algorithms/echelon-form.h included in sage/libs/linbox/echelonform.pxd. I will assume it is a system C/C++ header.
```
This is a problem, those headers are **not** system headers, which might break dependency checking.



---

archive/issue_events_172032.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-08T22:32:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172032"
}
```



---

archive/issue_events_172033.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-08T22:32:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172033"
}
```



---

archive/issue_comments_159075.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\n#13031 would resolve this issue.",
    "created_at": "2013-03-08T23:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159075",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:37'>Comment 37:</a>
#13031 would resolve this issue.



---

archive/issue_comments_159076.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nWhile that ticket may really fix the problem, now I wish I hadn't said yes to your removal of SAGE_INC on the basis of CPATH. It obviously doesn't work here.\n\nAdmittely that probably means there is a bug somewhere as you would expect it to work.",
    "created_at": "2013-03-09T08:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159076",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'>Comment 38:</a>
While that ticket may really fix the problem, now I wish I hadn't said yes to your removal of SAGE_INC on the basis of CPATH. It obviously doesn't work here.

Admittely that probably means there is a bug somewhere as you would expect it to work.



---

archive/issue_comments_159077.json:
```json
{
    "body": "Attachment: **[trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz)**\n\napply to sage library",
    "created_at": "2013-03-10T01:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159077",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz)**

apply to sage library



---

archive/issue_comments_159078.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,4 +7,3 @@\n **Installation Instructions**:\n * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n * apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n-* apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-10T03:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159078",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,4 +7,3 @@
 **Installation Instructions**:
 * apply [attachment: trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
 * apply [attachment: trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library
-* apply [attachment: trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_events_172034.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-10T03:05:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172034"
}
```



---

archive/issue_events_172035.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-10T03:05:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172035"
}
```



---

archive/issue_comments_159079.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nOk, threw `SAGE_INC` back in, so those errors don't come up anymore.",
    "created_at": "2013-03-10T03:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159079",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:39'>Comment 39:</a>
Ok, threw `SAGE_INC` back in, so those errors don't come up anymore.



---

archive/issue_events_172036.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-10T03:16:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172036"
}
```



---

archive/issue_events_172037.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-10T03:16:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172037"
}
```



---

archive/issue_comments_159080.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nThanks. I don't think that's essential to your git migration. More a question of minimal\"beauty\". We can always remove it with #13031 if it really negates the need for it.",
    "created_at": "2013-03-10T03:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159080",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'>Comment 40:</a>
Thanks. I don't think that's essential to your git migration. More a question of minimal"beauty". We can always remove it with #13031 if it really negates the need for it.



---

archive/issue_events_172038.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:05:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172038"
}
```



---

archive/issue_events_172039.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:05:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-172039"
}
```



---

archive/issue_comments_159081.json:
```json
{
    "body": "Merged: **sage-5.9.beta0**",
    "created_at": "2013-03-13T11:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159081",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.beta0**



---

archive/issue_comments_159082.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nIf you want people to use these variables \"correctly\", you'd better document them somewhere. I hope you're working on a follow-up ticket for this...",
    "created_at": "2013-03-20T01:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159082",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'>Comment 42:</a>
If you want people to use these variables "correctly", you'd better document them somewhere. I hope you're working on a follow-up ticket for this...



---

archive/issue_comments_159083.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nI made a ticket for documenting development environment variables at #14262 -- I probably won't get around to it for another week/week and a half, as I'm mainly prepping for Sage Days 47 (and then might not get a chance to work on it at the Sage Days).",
    "created_at": "2013-03-20T01:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159083",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:43'>Comment 43:</a>
I made a ticket for documenting development environment variables at #14262 -- I probably won't get around to it for another week/week and a half, as I'm mainly prepping for Sage Days 47 (and then might not get a chance to work on it at the Sage Days).



---

archive/issue_comments_159084.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nRelated: #15005.",
    "created_at": "2013-09-23T14:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159084",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:44'>Comment 44:</a>
Related: #15005.



---

archive/issue_comments_159085.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nSorry to revive an old ticket, but the people involved here might be able to answer the best: what is the rationale behind the variable substitution used in `sage/env.py`? That is, what is the advantage to doing the string substitution `\"$SAGE_LOCAL\" --> SAGE_ENV['SAGE_LOCAL']`, rather than just using the (already defined) variable `SAGE_LOCAL`? Using an example from the file, why use\n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))\n```\ninstead of\n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))\n```\n\nI am asking because there is a bug in the variable substitution (which I attempted to address in #23758): the variable substitution is done by iterating over `SAGE_ENV.items()`, which I think has no well-defined order, yet the order in which the substitution is done can matter, for example if you have variables `SAGE_LOCAL` and `SAGE_LOCAL_OTHER`, \"$SAGE_LOCAL_OTHER\" matches both as a string. In #23762, the possibility has been raised of removing the variable substitution altogether, so I want to know what we would be losing if we do this.",
    "created_at": "2017-08-31T22:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-159085",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'>Comment 45:</a>
Sorry to revive an old ticket, but the people involved here might be able to answer the best: what is the rationale behind the variable substitution used in `sage/env.py`? That is, what is the advantage to doing the string substitution `"$SAGE_LOCAL" --> SAGE_ENV['SAGE_LOCAL']`, rather than just using the (already defined) variable `SAGE_LOCAL`? Using an example from the file, why use

```
_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))
```
instead of

```
_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))
```

I am asking because there is a bug in the variable substitution (which I attempted to address in #23758): the variable substitution is done by iterating over `SAGE_ENV.items()`, which I think has no well-defined order, yet the order in which the substitution is done can matter, for example if you have variables `SAGE_LOCAL` and `SAGE_LOCAL_OTHER`, "$SAGE_LOCAL_OTHER" matches both as a string. In #23762, the possibility has been raised of removing the variable substitution altogether, so I want to know what we would be losing if we do this.
