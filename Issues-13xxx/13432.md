# Issue 13432: add sage/env.py and fix many inappropriate references to SAGE_ROOT

archive/issues_013260.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout"
    ],
    "body": "There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.\n\nThis ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n\nFollowup: #14226.\n\n**Installation Instructions**:\n* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n* apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n\nDepends on #13123\nDepends on #13348\n\nCC:  @jdemeyer @kiwifb @burcin\n\nKeywords: **build warnings**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **R. Andrew Ohana**\n\nMerged: **sage-5.9.beta0**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13432_\n\n",
    "closed_at": "2013-03-13T11:05:30Z",
    "created_at": "2012-09-06T08:57:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/c%3A%20build"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "add sage/env.py and fix many inappropriate references to SAGE_ROOT",
    "type": "issue",
    "updated_at": "2017-08-31T22:19:02Z",
    "url": "https://github.com/sagemath/sage/issues/13432",
    "user": "https://github.com/ohanar"
}
```
There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.

This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).

Followup: #14226.

**Installation Instructions**:
* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
* apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library

Depends on #13123
Depends on #13348

CC:  @jdemeyer @kiwifb @burcin

Keywords: **build warnings**

Reviewer: **François Bissey**

Author: **R. Andrew Ohana**

Merged: **sage-5.9.beta0**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/13432_





---

archive/issue_events_185884.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T08:57:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185884"
}
```



---

archive/issue_events_185885.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T08:57:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185885"
}
```



---

archive/issue_events_185886.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-09-06T08:57:40Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "subject": "https://github.com/ohanar",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185886"
}
```



---

archive/issue_comments_156661.json:
```json
{
    "body": "Dependencies: **#13123**",
    "created_at": "2012-09-06T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156661",
    "user": "https://github.com/ohanar"
}
```

Dependencies: **#13123**



---

archive/issue_comments_156662.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n+1 to the idea.",
    "created_at": "2012-09-06T09:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156662",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

+1 to the idea.



---

archive/issue_comments_156663.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env. How is the sage \"executable\" supposed to know about SAGE_ROOT/SAGE_LOCAL from the new env.py?",
    "created_at": "2012-09-06T09:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156663",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">comment:3</div>

I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env. How is the sage "executable" supposed to know about SAGE_ROOT/SAGE_LOCAL from the new env.py?



---

archive/issue_comments_156664.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@kiwifb](#comment%3A3):\n> I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env.\n\nI don't think there is duplication if `sage/env.py` simply reads the environment variables set by `sage-env`.  I see it as a library interface to the `sage-env` script.",
    "created_at": "2012-09-06T09:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156664",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@kiwifb](#comment%3A3):
> I am very supportive as well as some people would know. The main challenge is to avoid duplication with sage-env.

I don't think there is duplication if `sage/env.py` simply reads the environment variables set by `sage-env`.  I see it as a library interface to the `sage-env` script.



---

archive/issue_comments_156665.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nEventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).",
    "created_at": "2012-09-06T09:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156665",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:5" align="right">comment:5</div>

Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).



---

archive/issue_events_185887.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-09-06T09:29:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage.env and fix inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix a inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185887"
}
```



---

archive/issue_comments_156666.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOK I read it a bit more carefully and I see it is sourced from the environment. I guess sage in its current state can work like that without problem.\n\nAnd yes from my sage-on-gentoo point of view where sage is part of the system I would need it to be independent. There are issues in s-o-g when you import thing like sympy in python because it will pull sage if installed. If the variables are not in the environment things break in sageinspect. \n\nWe used to define SAGE variable in the global environment but that had its issue and the lmnd people (should copy burcin on this) didn't like it. At the moment I have pushed things in misc/misc.py to make things work in most cases.",
    "created_at": "2012-09-06T09:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156666",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

OK I read it a bit more carefully and I see it is sourced from the environment. I guess sage in its current state can work like that without problem.

And yes from my sage-on-gentoo point of view where sage is part of the system I would need it to be independent. There are issues in s-o-g when you import thing like sympy in python because it will pull sage if installed. If the variables are not in the environment things break in sageinspect. 

We used to define SAGE variable in the global environment but that had its issue and the lmnd people (should copy burcin on this) didn't like it. At the moment I have pushed things in misc/misc.py to make things work in most cases.



---

archive/issue_comments_156667.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@ohanar](#comment%3A5):\n> Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).\n\nI'm not sure whether I like that, but since it's in the distant future, I don't have to worry about it.",
    "created_at": "2012-09-06T09:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156667",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@ohanar](#comment%3A5):
> Eventually I would like `sage.env` to be independent of `sage-env`, so that our executable can be pure python (using argparse), but that is probably in distant future :).

I'm not sure whether I like that, but since it's in the distant future, I don't have to worry about it.



---

archive/issue_comments_156668.json:
```json
{
    "body": "Changed dependencies from **#13123** to **#13123, #13348**",
    "created_at": "2012-09-12T21:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156668",
    "user": "https://github.com/ohanar"
}
```

Changed dependencies from **#13123** to **#13123, #13348**



---

archive/issue_comments_156669.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.\n \n This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n+\n+**Installation Instructions**:\n+* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]\n``````\n",
    "created_at": "2012-09-12T21:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156669",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.
 
 This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
+
+**Installation Instructions**:
+* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]
``````




---

archive/issue_events_185888.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-05T06:42:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage.env and fix many inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185888"
}
```



---

archive/issue_events_185889.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-05T06:42:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185889"
}
```



---

archive/issue_comments_156670.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOk, this has been fixed up and should be ready to go now.",
    "created_at": "2013-03-05T06:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156670",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:10" align="right">comment:10</div>

Ok, this has been fixed up and should be ready to go now.



---

archive/issue_comments_156671.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.\n+There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.\n \n-This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n+This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n \n **Installation Instructions**:\n-* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]\n+* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n``````\n",
    "created_at": "2013-03-05T06:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156671",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct most of these references.
+There are many places within the Sage library that make explicit references to `SAGE_ROOT`, when `SAGE_LOCAL`, `SAGE_DATA`, etc. are more appropriate. These references assume a particular directory structure which unnecessarily break various components when using a different directory structure (i.e. transitioning to git or sage-on-gentoo). This ticket aims to correct many of these references.
 
-This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
+This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
 
 **Installation Instructions**:
-* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library [WIP]
+* apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
``````




---

archive/issue_events_185890.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T06:47:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "title_is": "add sage/env.py and fix many inappropriate references to SAGE_ROOT",
    "title_was": "add sage.env and fix many inappropriate references to SAGE_ROOT",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185890"
}
```



---

archive/issue_comments_156672.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,7 @@\n \n This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).\n \n+Followup: #14226.\n+\n **Installation Instructions**:\n * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n``````\n",
    "created_at": "2013-03-05T07:55:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156672",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,7 @@
 
 This ticket also adds `sage.env` as a place to keep global used Sage variables (these currently live in `sage.misc.misc`). Currently this file does little more than separate out some of these variables, but the intent is to provide a dedicated place in python for determining the environment for the Sage library (this will eventually need to be independent of `sage-env` if we are ever to truly transition to argparse).
 
+Followup: #14226.
+
 **Installation Instructions**:
 * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
``````




---

archive/issue_comments_156673.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThat looks so much like the mega patch that I apply to sage-on-gentoo. OK my equivalent of env.py is not nearly as sophisticated and I don't have some of these new variables. But otherwise that's scary and this will simplify my life a great deal.\n\nI am going through comparing with my own stuff.",
    "created_at": "2013-03-05T08:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156673",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

That looks so much like the mega patch that I apply to sage-on-gentoo. OK my equivalent of env.py is not nearly as sophisticated and I don't have some of these new variables. But otherwise that's scary and this will simplify my life a great deal.

I am going through comparing with my own stuff.



---

archive/issue_comments_156674.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOK so far the main differences with my own stuff is that I have gone on a hunt on a wider ranger of variables. SAGE_ROOT is the lead bad guy but I also went for most instances of os.environ['SAGE_LOCAL'] and others that made sense to me. This ticket is just for SAGE_ROOT and that's already a big chunk.",
    "created_at": "2013-03-05T08:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156674",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">comment:14</div>

OK so far the main differences with my own stuff is that I have gone on a hunt on a wider ranger of variables. SAGE_ROOT is the lead bad guy but I also went for most instances of os.environ['SAGE_LOCAL'] and others that made sense to me. This ticket is just for SAGE_ROOT and that's already a big chunk.



---

archive/issue_comments_156675.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n`SAGE_ROOT` is the main bad guy for my purposes (which is the transition to git). I haven't completely fixed every single usage of it in the library, because some bits required a good amount of logic to rework, so if your patch has fixes for the bits that I omitted that would be appreciated.\n\nI think that a follow up ticket for the `SAGE_LOCAL` instances would be a good idea. You should check my usage's of `SAGE_SRC` and see if your patch gets away something more or less equivalent to my `SAGE_LIB` in any of those places.",
    "created_at": "2013-03-05T08:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156675",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:15" align="right">comment:15</div>

`SAGE_ROOT` is the main bad guy for my purposes (which is the transition to git). I haven't completely fixed every single usage of it in the library, because some bits required a good amount of logic to rework, so if your patch has fixes for the bits that I omitted that would be appreciated.

I think that a follow up ticket for the `SAGE_LOCAL` instances would be a good idea. You should check my usage's of `SAGE_SRC` and see if your patch gets away something more or less equivalent to my `SAGE_LIB` in any of those places.



---

archive/issue_comments_156676.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIn one of my first attempt I ended up with an unbuildable sage :( but getting all the variables in an independent file is the big cure for that. I understand the problem with the logic. I still have one doctest failure in lazy_import_cache in sage-on-gentoo and I am not sure why.\n\nI didn't create any new variables like SAGE_SRC and SAGE_LIB, that was a lot of work as it is.\n\nI believe the other instances of SAGE_ROOT in sage/misc/cython.py can go.\n\n```\n@@ -335,10 +336,10 @@\n     Before :trac:`12975`, it would have beeen needed to write ``#clang c++``,\n     but upper case ``C++`` has resulted in an error::\n\n-        sage: from sage.all import SAGE_ROOT\n+        sage: from sage.env import SAGE_LOCAL\n         sage: code = [\n         ... \"#clang C++\",\n-        ... \"#cinclude %s/local/include/singular %s/local/include/factory\"%(SAGE_ROOT,SAGE_ROOT),\n+        ... \"#cinclude %s/include/singular %s/include/singular\"%(SAGE_LOCAL,SAGE_LOCAL),\n         ... \"#clib m readline singular givaro ntl gmpxx gmp\",\n         ... \"from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsin$\n         ... \"from sage.libs.singular.polynomial cimport singular_polynomial_pow\",\n@@ -449,12 +450,7 @@\n import distutils.sysconfig, os, sys\n from distutils.core import setup, Extension\n\n-if not os.environ.has_key('SAGE_ROOT'):\n-    print \"    ERROR: The environment variable SAGE_ROOT must be defined.\"\n-    sys.exit(1)\n-else:\n-    SAGE_ROOT  = os.environ['SAGE_ROOT']\n-    SAGE_LOCAL = SAGE_ROOT + '/local/'\n+from sage.env import SAGE_ROOT, SAGE_LOCAL\n\n extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']\n extra_compile_args = %s\n```\nI edited it so it is closer to your style.",
    "created_at": "2013-03-05T08:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156676",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">comment:16</div>

In one of my first attempt I ended up with an unbuildable sage :( but getting all the variables in an independent file is the big cure for that. I understand the problem with the logic. I still have one doctest failure in lazy_import_cache in sage-on-gentoo and I am not sure why.

I didn't create any new variables like SAGE_SRC and SAGE_LIB, that was a lot of work as it is.

I believe the other instances of SAGE_ROOT in sage/misc/cython.py can go.

```
@@ -335,10 +336,10 @@
     Before :trac:`12975`, it would have beeen needed to write ``#clang c++``,
     but upper case ``C++`` has resulted in an error::

-        sage: from sage.all import SAGE_ROOT
+        sage: from sage.env import SAGE_LOCAL
         sage: code = [
         ... "#clang C++",
-        ... "#cinclude %s/local/include/singular %s/local/include/factory"%(SAGE_ROOT,SAGE_ROOT),
+        ... "#cinclude %s/include/singular %s/include/singular"%(SAGE_LOCAL,SAGE_LOCAL),
         ... "#clib m readline singular givaro ntl gmpxx gmp",
         ... "from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomial_libsin$
         ... "from sage.libs.singular.polynomial cimport singular_polynomial_pow",
@@ -449,12 +450,7 @@
 import distutils.sysconfig, os, sys
 from distutils.core import setup, Extension

-if not os.environ.has_key('SAGE_ROOT'):
-    print "    ERROR: The environment variable SAGE_ROOT must be defined."
-    sys.exit(1)
-else:
-    SAGE_ROOT  = os.environ['SAGE_ROOT']
-    SAGE_LOCAL = SAGE_ROOT + '/local/'
+from sage.env import SAGE_ROOT, SAGE_LOCAL

 extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']
 extra_compile_args = %s
```
I edited it so it is closer to your style.



---

archive/issue_comments_156677.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nsage/sandpiles/sandpile.py you have \n\n```\nSAGE_ROOT = os.environ['SAGE_ROOT'] \npath_to_zsolve = SAGE_ROOT+'/local/bin/' \n```\nbecoming \n\n```\npath_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n```\nIs it correcting a bug as well?",
    "created_at": "2013-03-05T08:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156677",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">comment:17</div>

sage/sandpiles/sandpile.py you have 

```
SAGE_ROOT = os.environ['SAGE_ROOT'] 
path_to_zsolve = SAGE_ROOT+'/local/bin/' 
```
becoming 

```
path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
```
Is it correcting a bug as well?



---

archive/issue_comments_156678.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@kiwifb](#comment%3A17):\n> sage/sandpiles/sandpile.py you have \n> \n> ```\n> SAGE_ROOT = os.environ['SAGE_ROOT'] \n> path_to_zsolve = SAGE_ROOT+'/local/bin/' \n> ```\n> becoming \n> \n> ```\n> path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n> ```\n> Is it correcting a bug as well?\n\nNo, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.",
    "created_at": "2013-03-05T08:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156678",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@kiwifb](#comment%3A17):
> sage/sandpiles/sandpile.py you have 
> 
> ```
> SAGE_ROOT = os.environ['SAGE_ROOT'] 
> path_to_zsolve = SAGE_ROOT+'/local/bin/' 
> ```
> becoming 
> 
> ```
> path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
> ```
> Is it correcting a bug as well?

No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.



---

archive/issue_comments_156679.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@ohanar](#comment%3A18):\n> Replying to [@kiwifb](#comment%3A17):\n> > sage/sandpiles/sandpile.py you have \n> > \n> > ```\n> > SAGE_ROOT = os.environ['SAGE_ROOT'] \n> > path_to_zsolve = SAGE_ROOT+'/local/bin/' \n> > ```\n> > becoming \n> > \n> > ```\n> > path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')\n> > ```\n> > Is it correcting a bug as well?\n\n> \n> No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.\n\n\nI missed that line.\n\nIs the replacement of SAGE_INC in setup.py (well spotted the one where it is still SAGE_LOCAL/include) by CPATH really necessary? That's the only place CPATH is used and you don't use it in module_list.py anyway.\n\nApart from this I am positive that it should go in while it is easy to apply. We may do some more work on this later.",
    "created_at": "2013-03-05T09:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156679",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@ohanar](#comment%3A18):
> Replying to [@kiwifb](#comment%3A17):
> > sage/sandpiles/sandpile.py you have 
> > 
> > ```
> > SAGE_ROOT = os.environ['SAGE_ROOT'] 
> > path_to_zsolve = SAGE_ROOT+'/local/bin/' 
> > ```
> > becoming 
> > 
> > ```
> > path_to_zsolve = os.path.join(SAGE_LOCAL,'bin','zsolve')
> > ```
> > Is it correcting a bug as well?

> 
> No, if you look a little further down, I change a `path_to_zsolve+'zsolve'` to just `path_to_zsolve` -- this is a little cleaner, and it removes the string arithmetic that should be `os.path.join`'s.


I missed that line.

Is the replacement of SAGE_INC in setup.py (well spotted the one where it is still SAGE_LOCAL/include) by CPATH really necessary? That's the only place CPATH is used and you don't use it in module_list.py anyway.

Apart from this I am positive that it should go in while it is easy to apply. We may do some more work on this later.



---

archive/issue_comments_156680.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDon't use `CPATH` the way you are using it. Invent a new variable `SAGE_INCLUDE` or whatever.\n\n`CPATH` is a colon-separated list of directories searched by GCC for include files.",
    "created_at": "2013-03-05T09:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156680",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Don't use `CPATH` the way you are using it. Invent a new variable `SAGE_INCLUDE` or whatever.

`CPATH` is a colon-separated list of directories searched by GCC for include files.



---

archive/issue_comments_156681.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think CPATH (and its idea) should be dropped from sage.env altogether and setup.py only be touched to normalize its use of SAGE_INC.",
    "created_at": "2013-03-05T09:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156681",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

I think CPATH (and its idea) should be dropped from sage.env altogether and setup.py only be touched to normalize its use of SAGE_INC.



---

archive/issue_comments_156682.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@kiwifb](#comment%3A21):\n> I think CPATH (and its idea) should be dropped from sage.env altogether.\n\nYes exactly.",
    "created_at": "2013-03-05T09:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156682",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@kiwifb](#comment%3A21):
> I think CPATH (and its idea) should be dropped from sage.env altogether.

Yes exactly.



---

archive/issue_events_185891.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T09:26:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185891"
}
```



---

archive/issue_events_185892.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-05T09:26:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185892"
}
```



---

archive/issue_comments_156683.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOk, updated the patch. Added the fix for `cython.py` suggested and reverted `CPATH` to `SAGE_INC` and it is no longer defined in `env.py`. I also modified `module_list.py` to use the new module as well.",
    "created_at": "2013-03-05T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156683",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:24" align="right">comment:24</div>

Ok, updated the patch. Added the fix for `cython.py` suggested and reverted `CPATH` to `SAGE_INC` and it is no longer defined in `env.py`. I also modified `module_list.py` to use the new module as well.



---

archive/issue_comments_156684.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThank you for the new patch. I will still whine a bit about setup.py. In the definition of \"include_dirs\" on line 54 (after patch) you didn't put SAGE_INC itself. I think the list should be\n\n```\ninclude_dirs = [SAGE_INC,\n                os.path.join(SAGE_INC, 'csage'), \n \t              os.path.join(SAGE_SRC, 'sage', 'ext')]\n```\nI don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.",
    "created_at": "2013-03-06T09:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156684",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Thank you for the new patch. I will still whine a bit about setup.py. In the definition of "include_dirs" on line 54 (after patch) you didn't put SAGE_INC itself. I think the list should be

```
include_dirs = [SAGE_INC,
                os.path.join(SAGE_INC, 'csage'), 
 	              os.path.join(SAGE_SRC, 'sage', 'ext')]
```
I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.



---

archive/issue_comments_156685.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kiwifb](#comment%3A25):\n> I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.\n\nI thought the point of #13348 was so that we didn't have to add `SAGE_LOCAL/include` to spkgs anymore. Truthfully, I would also like to replace `os.path.join(SAGE_INC, 'csage')` with `os.path.join(SAGE_SRC, 'c_lib', 'include')`, since in some distant future, I would like the sage python library, c library, extcode, and scripts to be a single \"sage\" package (but obviously this conflicts with both the setup of sage and sage-on-gentoo presently).",
    "created_at": "2013-03-06T21:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156685",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kiwifb](#comment%3A25):
> I don't think we can count on CPATH being defined and providing SAGE_INC in all cases so I think it needs to be included here.

I thought the point of #13348 was so that we didn't have to add `SAGE_LOCAL/include` to spkgs anymore. Truthfully, I would also like to replace `os.path.join(SAGE_INC, 'csage')` with `os.path.join(SAGE_SRC, 'c_lib', 'include')`, since in some distant future, I would like the sage python library, c library, extcode, and scripts to be a single "sage" package (but obviously this conflicts with both the setup of sage and sage-on-gentoo presently).



---

archive/issue_comments_156686.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAnd truthfully I would like the c_lib to be handled differently, not completely sure how but differently. I was concerned that not putting SAGE_INC would break some upgrades. But upgrade from very old versions of sage is not recommended or guaranteed to work in any case. CPATH has been included in sage 5.4 that should be old enough.\n\nPositive review then.",
    "created_at": "2013-03-06T21:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156686",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">comment:27</div>

And truthfully I would like the c_lib to be handled differently, not completely sure how but differently. I was concerned that not putting SAGE_INC would break some upgrades. But upgrade from very old versions of sage is not recommended or guaranteed to work in any case. CPATH has been included in sage 5.4 that should be old enough.

Positive review then.



---

archive/issue_events_185893.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-06T21:55:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185893"
}
```



---

archive/issue_events_185894.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-06T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185894"
}
```



---

archive/issue_comments_156687.json:
```json
{
    "body": "apply to root repository",
    "created_at": "2013-03-06T23:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156687",
    "user": "https://github.com/ohanar"
}
```

apply to root repository



---

archive/issue_comments_156688.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156688",
    "user": "https://github.com/ohanar"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_156689.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,4 @@\n \n **Installation Instructions**:\n * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n+* apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156689",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,4 @@
 
 **Installation Instructions**:
 * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
+* apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_comments_156690.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAttachment: **[trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz)**\n\nReplying to [@kiwifb](#comment%3A27):\n> I was concerned that not putting SAGE_INC would break some upgrades.\n\nGood point, I think Jeroen tries to make sure that all versions back to 4.8 can still upgrade. This should still work even for those versions since the sage library implicitly depends on SAGE_ROOT_REPO, but just to be sure, I've added a tiny patch to the root repository to make this dependency explicit.",
    "created_at": "2013-03-06T23:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156690",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:28" align="right">comment:28</div>

Attachment: **[trac13432_root.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz)**

Replying to [@kiwifb](#comment%3A27):
> I was concerned that not putting SAGE_INC would break some upgrades.

Good point, I think Jeroen tries to make sure that all versions back to 4.8 can still upgrade. This should still work even for those versions since the sage library implicitly depends on SAGE_ROOT_REPO, but just to be sure, I've added a tiny patch to the root repository to make this dependency explicit.



---

archive/issue_comments_156691.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI test upgrades starting from sage-4.5 (older versions don't work because they lack the `pipestatus` script).",
    "created_at": "2013-03-07T07:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156691",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

I test upgrades starting from sage-4.5 (older versions don't work because they lack the `pipestatus` script).



---

archive/issue_comments_156692.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIn `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:\n\n```\n        #If the 'SAGE_PEXPECT_LOG' environment variable is set and\n        #the current logfile is None, then set the logfile to be one\n        #in .sage/pexpect_logs/\n        if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:\n            from sage.misc.all import DOT_SAGE\n            logs = '%s/pexpect_logs'%DOT_SAGE\n            sage_makedirs(logs)\n\n            filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)\n            self.__logfile = open(filename, 'w')\n```",
    "created_at": "2013-03-07T10:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156692",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:

```
        #If the 'SAGE_PEXPECT_LOG' environment variable is set and
        #the current logfile is None, then set the logfile to be one
        #in .sage/pexpect_logs/
        if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:
            from sage.misc.all import DOT_SAGE
            logs = '%s/pexpect_logs'%DOT_SAGE
            sage_makedirs(logs)

            filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)
            self.__logfile = open(filename, 'w')
```



---

archive/issue_events_185895.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T10:09:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185895"
}
```



---

archive/issue_events_185896.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T10:09:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185896"
}
```



---

archive/issue_comments_156693.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jdemeyer](#comment%3A30):\n> In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:\n> \n> ```\n>         #If the 'SAGE_PEXPECT_LOG' environment variable is set and\n>         #the current logfile is None, then set the logfile to be one\n>         #in .sage/pexpect_logs/\n>         if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:\n>             from sage.misc.all import DOT_SAGE\n>             logs = '%s/pexpect_logs'%DOT_SAGE\n>             sage_makedirs(logs)\n> \n>             filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)\n>             self.__logfile = open(filename, 'w')\n> ```\n\nThat shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py but OK will fix it.",
    "created_at": "2013-03-07T19:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156693",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jdemeyer](#comment%3A30):
> In `sage/interfaces/expect.py`, this usage of `DOT_SAGE` needs to be fixed:
> 
> ```
>         #If the 'SAGE_PEXPECT_LOG' environment variable is set and
>         #the current logfile is None, then set the logfile to be one
>         #in .sage/pexpect_logs/
>         if self.__logfile is None and 'SAGE_PEXPECT_LOG' in os.environ:
>             from sage.misc.all import DOT_SAGE
>             logs = '%s/pexpect_logs'%DOT_SAGE
>             sage_makedirs(logs)
> 
>             filename = '%s/%s-%s-%s-%s.log'%(logs, self.name(), os.getpid(), id(self), self._session_number)
>             self.__logfile = open(filename, 'w')
> ```

That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py but OK will fix it.



---

archive/issue_comments_156694.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nActually why this particular file even after the big patch there are several instances of sage variables imported from misc/misc.py. Do you want them all switched to env.py?",
    "created_at": "2013-03-07T20:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156694",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

Actually why this particular file even after the big patch there are several instances of sage variables imported from misc/misc.py. Do you want them all switched to env.py?



---

archive/issue_comments_156695.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@kiwifb](#comment%3A31):\n> That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py\n\nNo, it's not covered since this one imports from sage.misc.**all**. And yes, it leads to failures (in an unrelated doctest in #12415).",
    "created_at": "2013-03-07T22:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156695",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@kiwifb](#comment%3A31):
> That shouldn't be necessary to build or run sage and is covered by backward compatibility in sage/misc/misc.py

No, it's not covered since this one imports from sage.misc.**all**. And yes, it leads to failures (in an unrelated doctest in #12415).



---

archive/issue_comments_156696.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nHa. I missed that. In my version of this for sage-on-gentoo I made sage.misc.all backward compatible, ohanar didn't. I will check what other places rely on misc.all.",
    "created_at": "2013-03-07T22:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156696",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">comment:34</div>

Ha. I missed that. In my version of this for sage-on-gentoo I made sage.misc.all backward compatible, ohanar didn't. I will check what other places rely on misc.all.



---

archive/issue_comments_156697.json:
```json
{
    "body": "Attachment: **[trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz)**\n\nFix DOT_SAGE in expect.py",
    "created_at": "2013-03-07T22:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156697",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[trac_13432-fix_expect.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz)**

Fix DOT_SAGE in expect.py



---

archive/issue_events_185897.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-07T22:28:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185897"
}
```



---

archive/issue_events_185898.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-07T22:28:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185898"
}
```



---

archive/issue_comments_156698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,5 @@\n \n **Installation Instructions**:\n * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n+* apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n * apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-07T22:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156698",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,5 @@
 
 **Installation Instructions**:
 * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
+* apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library
 * apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_comments_156699.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThat was the last spot. I added a trivial patch to take care of it.",
    "created_at": "2013-03-07T22:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156699",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">comment:35</div>

That was the last spot. I added a trivial patch to take care of it.



---

archive/issue_comments_156700.json:
```json
{
    "body": "Changed keywords from none to **build warnings**",
    "created_at": "2013-03-08T22:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156700",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from none to **build warnings**



---

archive/issue_events_185899.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-08T22:32:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185899"
}
```



---

archive/issue_comments_156701.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nWhen building Sage, there are lots of warnings of the form\n\n```\n  warnings.warn(msg+' I will assume it is a system C/C++ header.')\nsetup.py:637: UserWarning: could not find dependency linbox/algorithms/echelon-form.h included in sage/libs/linbox/echelonform.pxd. I will assume it is a system C/C++ header.\n```\nThis is a problem, those headers are **not** system headers, which might break dependency checking.",
    "created_at": "2013-03-08T22:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156701",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

When building Sage, there are lots of warnings of the form

```
  warnings.warn(msg+' I will assume it is a system C/C++ header.')
setup.py:637: UserWarning: could not find dependency linbox/algorithms/echelon-form.h included in sage/libs/linbox/echelonform.pxd. I will assume it is a system C/C++ header.
```
This is a problem, those headers are **not** system headers, which might break dependency checking.



---

archive/issue_events_185900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-08T22:32:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185900"
}
```



---

archive/issue_events_185901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-08T22:32:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185901"
}
```



---

archive/issue_comments_156702.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n#13031 would resolve this issue.",
    "created_at": "2013-03-08T23:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156702",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:37" align="right">comment:37</div>

#13031 would resolve this issue.



---

archive/issue_comments_156703.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nWhile that ticket may really fix the problem, now I wish I hadn't said yes to your removal of SAGE_INC on the basis of CPATH. It obviously doesn't work here.\n\nAdmittely that probably means there is a bug somewhere as you would expect it to work.",
    "created_at": "2013-03-09T08:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156703",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">comment:38</div>

While that ticket may really fix the problem, now I wish I hadn't said yes to your removal of SAGE_INC on the basis of CPATH. It obviously doesn't work here.

Admittely that probably means there is a bug somewhere as you would expect it to work.



---

archive/issue_comments_156704.json:
```json
{
    "body": "Attachment: **[trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz)**\n\napply to sage library",
    "created_at": "2013-03-10T01:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156704",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[trac13432.patch.gz](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz)**

apply to sage library



---

archive/issue_comments_156705.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,4 +7,3 @@\n **Installation Instructions**:\n * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library\n * apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library\n-* apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository\n``````\n",
    "created_at": "2013-03-10T03:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156705",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,4 +7,3 @@
 **Installation Instructions**:
 * apply [attachment: trac13432.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432.patch.gz) to the sage library
 * apply [attachment: trac_13432-fix_expect.patch](https://github.com/sagemath/sage/files/ticket13432/trac_13432-fix_expect.patch.gz) to the sage library
-* apply [attachment: trac13432_root.patch](https://github.com/sagemath/sage/files/ticket13432/trac13432_root.patch.gz) to the root repository
``````




---

archive/issue_events_185902.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-10T03:05:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185902"
}
```



---

archive/issue_events_185903.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-03-10T03:05:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185903"
}
```



---

archive/issue_comments_156706.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOk, threw `SAGE_INC` back in, so those errors don't come up anymore.",
    "created_at": "2013-03-10T03:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156706",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:39" align="right">comment:39</div>

Ok, threw `SAGE_INC` back in, so those errors don't come up anymore.



---

archive/issue_events_185904.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-10T03:16:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185904"
}
```



---

archive/issue_events_185905.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-10T03:16:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185905"
}
```



---

archive/issue_comments_156707.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThanks. I don't think that's essential to your git migration. More a question of minimal\"beauty\". We can always remove it with #13031 if it really negates the need for it.",
    "created_at": "2013-03-10T03:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156707",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">comment:40</div>

Thanks. I don't think that's essential to your git migration. More a question of minimal"beauty". We can always remove it with #13031 if it really negates the need for it.



---

archive/issue_events_185906.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:05:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185906"
}
```



---

archive/issue_events_185907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T11:05:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13432#event-185907"
}
```



---

archive/issue_comments_156708.json:
```json
{
    "body": "Merged: **sage-5.9.beta0**",
    "created_at": "2013-03-13T11:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156708",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.beta0**



---

archive/issue_comments_156709.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nIf you want people to use these variables \"correctly\", you'd better document them somewhere. I hope you're working on a follow-up ticket for this...",
    "created_at": "2013-03-20T01:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156709",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

If you want people to use these variables "correctly", you'd better document them somewhere. I hope you're working on a follow-up ticket for this...



---

archive/issue_comments_156710.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI made a ticket for documenting development environment variables at #14262 -- I probably won't get around to it for another week/week and a half, as I'm mainly prepping for Sage Days 47 (and then might not get a chance to work on it at the Sage Days).",
    "created_at": "2013-03-20T01:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156710",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:43" align="right">comment:43</div>

I made a ticket for documenting development environment variables at #14262 -- I probably won't get around to it for another week/week and a half, as I'm mainly prepping for Sage Days 47 (and then might not get a chance to work on it at the Sage Days).



---

archive/issue_comments_156711.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nRelated: #15005.",
    "created_at": "2013-09-23T14:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156711",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:44" align="right">comment:44</div>

Related: #15005.



---

archive/issue_comments_156712.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nSorry to revive an old ticket, but the people involved here might be able to answer the best: what is the rationale behind the variable substitution used in `sage/env.py`? That is, what is the advantage to doing the string substitution `\"$SAGE_LOCAL\" --> SAGE_ENV['SAGE_LOCAL']`, rather than just using the (already defined) variable `SAGE_LOCAL`? Using an example from the file, why use\n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))\n```\ninstead of\n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))\n```\n\nI am asking because there is a bug in the variable substitution (which I attempted to address in #23758): the variable substitution is done by iterating over `SAGE_ENV.items()`, which I think has no well-defined order, yet the order in which the substitution is done can matter, for example if you have variables `SAGE_LOCAL` and `SAGE_LOCAL_OTHER`, \"$SAGE_LOCAL_OTHER\" matches both as a string. In #23762, the possibility has been raised of removing the variable substitution altogether, so I want to know what we would be losing if we do this.",
    "created_at": "2017-08-31T22:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13432#issuecomment-156712",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">comment:45</div>

Sorry to revive an old ticket, but the people involved here might be able to answer the best: what is the rationale behind the variable substitution used in `sage/env.py`? That is, what is the advantage to doing the string substitution `"$SAGE_LOCAL" --> SAGE_ENV['SAGE_LOCAL']`, rather than just using the (already defined) variable `SAGE_LOCAL`? Using an example from the file, why use

```
_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))
```
instead of

```
_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))
```

I am asking because there is a bug in the variable substitution (which I attempted to address in #23758): the variable substitution is done by iterating over `SAGE_ENV.items()`, which I think has no well-defined order, yet the order in which the substitution is done can matter, for example if you have variables `SAGE_LOCAL` and `SAGE_LOCAL_OTHER`, "$SAGE_LOCAL_OTHER" matches both as a string. In #23762, the possibility has been raised of removing the variable substitution altogether, so I want to know what we would be losing if we do this.
