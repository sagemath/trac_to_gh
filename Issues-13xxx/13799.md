# Issue 13799: cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin

archive/issues_013595.json:
```json
{
    "assignees": [],
    "body": "As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.\n\nUse spkg at\nhttp://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n\nIt adds back the glpk needed dependencies removed at #13160.\n\nCC:  @jpflori\n\nReviewer: **Karl-Dieter Crisman**\n\nAuthor: **Jean-Pierre Flori**\n\nMerged: **sage-5.6.beta2**\n\nComponent: **porting: Cygwin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13799_\n\n",
    "closed_at": "2012-12-27T10:24:09Z",
    "created_at": "2012-12-05T13:16:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin",
    "type": "issue",
    "updated_at": "2012-12-27T10:24:09Z",
    "url": "https://github.com/sagemath/sage/issues/13799",
    "user": "https://github.com/kcrisman"
}
```
As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.

Use spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.

CC:  @jpflori

Reviewer: **Karl-Dieter Crisman**

Author: **Jean-Pierre Flori**

Merged: **sage-5.6.beta2**

Component: **porting: Cygwin**

_Issue created by migration from https://trac.sagemath.org/ticket/13799_





---

archive/issue_events_193573.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-05T13:16:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193573"
}
```



---

archive/issue_events_193574.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-05T13:16:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193574"
}
```



---

archive/issue_events_193575.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-05T13:16:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193575"
}
```



---

archive/issue_events_193576.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-05T13:16:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193576"
}
```



---

archive/issue_comments_162580.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI guess overlinking was so muchfixed in #13160 it became underlinking.",
    "created_at": "2012-12-05T15:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162580",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:1" align="right">comment:1</div>

I guess overlinking was so muchfixed in #13160 it became underlinking.



---

archive/issue_comments_162581.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMaybe.  We do \n\n```\n # Set to 1 if you are installing the glpk module.\n-BUILD_GLPK = 0 \n+BUILD_GLPK = 1 \n```\nin setup.py.patch, and got rid of \n\n```\n- if BUILD_GLPK:\n--    glpk = Extension('glpk', libraries = ['glpk'],\n-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n-         include_dirs = [ GLPK_INC_DIR ],\n--        library_dirs = [ GLPK_LIB_DIR ],\n-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n-         sources = ['C/glpk.c'] )\n-     extmods += [glpk];\n- \n```\nbut Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe \n\n```\n\n # Directory containing libglpk (used only when BUILD_GLPK = 1).\n-GLPK_LIB_DIR = '/usr/lib'\n+GLPK_LIB_DIR = SAGE_LIB\n \n # Directory containing glpk.h (used only when BUILD_GLPK = 1).\n-GLPK_INC_DIR = '/usr/include'\n+GLPK_INC_DIR = SAGE_INCLUDE\n```\nis sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).",
    "created_at": "2012-12-05T18:29:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162581",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

Maybe.  We do 

```
 # Set to 1 if you are installing the glpk module.
-BUILD_GLPK = 0 
+BUILD_GLPK = 1 
```
in setup.py.patch, and got rid of 

```
- if BUILD_GLPK:
--    glpk = Extension('glpk', libraries = ['glpk'],
-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
-         include_dirs = [ GLPK_INC_DIR ],
--        library_dirs = [ GLPK_LIB_DIR ],
-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],
-         sources = ['C/glpk.c'] )
-     extmods += [glpk];
- 
```
but Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe 

```

 # Directory containing libglpk (used only when BUILD_GLPK = 1).
-GLPK_LIB_DIR = '/usr/lib'
+GLPK_LIB_DIR = SAGE_LIB
 
 # Directory containing glpk.h (used only when BUILD_GLPK = 1).
-GLPK_INC_DIR = '/usr/include'
+GLPK_INC_DIR = SAGE_INCLUDE
```
is sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).



---

archive/issue_comments_162582.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.\nYour second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).\nI've got a quite working spkg, but will only post it tomorrow, too late for today.",
    "created_at": "2012-12-05T22:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162582",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:3" align="right">comment:3</div>

The fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.
Your second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).
I've got a quite working spkg, but will only post it tomorrow, too late for today.



---

archive/issue_comments_162583.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSorry, the \"second\" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add\n\n```diff\n+ if BUILD_GLPK:\n+-    glpk = Extension('glpk', libraries = ['glpk'],\n++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n+         include_dirs = [ GLPK_INC_DIR ],\n+-        library_dirs = [ GLPK_LIB_DIR ],\n++        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n+         sources = ['C/glpk.c'] )\n+     extmods += [glpk];\n+ \n```\nback in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.",
    "created_at": "2012-12-06T01:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162583",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">comment:4</div>

Sorry, the "second" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add

```diff
+ if BUILD_GLPK:
+-    glpk = Extension('glpk', libraries = ['glpk'],
++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
+         include_dirs = [ GLPK_INC_DIR ],
+-        library_dirs = [ GLPK_LIB_DIR ],
++        library_dirs = libdirs + [ GLPK_LIB_DIR ],
+         sources = ['C/glpk.c'] )
+     extmods += [glpk];
+ 
```
back in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.



---

archive/issue_comments_162584.json:
```json
{
    "body": "Author: **Jean-Pierre Flori**",
    "created_at": "2012-12-06T09:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162584",
    "user": "https://github.com/jpflori"
}
```

Author: **Jean-Pierre Flori**



---

archive/issue_events_193577.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-12-06T09:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193577"
}
```



---

archive/issue_comments_162585.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.\n+\n+Use spkg at\n+http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n+\n+It adds back the glpk needed dependencies removed at #13160.\n``````\n",
    "created_at": "2012-12-06T09:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162585",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
 As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.
+
+Use spkg at
+http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg
+
+It adds back the glpk needed dependencies removed at #13160.
``````




---

archive/issue_comments_162586.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI've uploaded a working spkg at\nhttp://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n\nIt adds back the glpk needed dependencies removed at #13160.",
    "created_at": "2012-12-06T09:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162586",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:5" align="right">comment:5</div>

I've uploaded a working spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.



---

archive/issue_comments_162587.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nJust FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.\n\nBy the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.",
    "created_at": "2012-12-06T15:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162587",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

Just FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.

By the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.



---

archive/issue_events_193578.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-06T15:47:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193578"
}
```



---

archive/issue_events_193579.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-06T15:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193579"
}
```



---

archive/issue_comments_162588.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2012-12-06T15:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162588",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_events_193580.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-16T15:17:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193580"
}
```



---

archive/issue_events_193581.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-16T15:17:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193581"
}
```



---

archive/issue_comments_162589.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after\n\n```\n== Changelog ==\n```",
    "created_at": "2012-12-16T15:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162589",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after

```
== Changelog ==
```



---

archive/issue_comments_162590.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2012-12-17T09:37:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162590",
    "user": "https://github.com/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_comments_162591.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[cvxopt-1.1.5.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13799/cvxopt-1.1.5.p0.diff.gz)**\n\nThe newly uploaded spkg should be fine.",
    "created_at": "2012-12-17T09:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162591",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[cvxopt-1.1.5.p0.diff.gz](https://github.com/sagemath/sage/files/ticket13799/cvxopt-1.1.5.p0.diff.gz)**

The newly uploaded spkg should be fine.



---

archive/issue_events_193582.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-12-17T09:52:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193582"
}
```



---

archive/issue_events_193583.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-12-17T09:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193583"
}
```



---

archive/issue_events_193584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-17T10:00:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193584"
}
```



---

archive/issue_events_193585.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-17T10:00:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193585"
}
```



---

archive/issue_comments_162592.json:
```json
{
    "body": "Merged: **sage-5.6.beta2**",
    "created_at": "2012-12-27T10:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13799#issuecomment-162592",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.6.beta2**



---

archive/issue_events_193586.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:24:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193586"
}
```



---

archive/issue_events_193587.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:24:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13799",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13799#event-193587"
}
```
