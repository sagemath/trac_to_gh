# Issue 13753: logged out when running two notebooks

archive/issues_013549.json:
```json
{
    "assignees": [],
    "body": "When I run two notebooks (different directories) at the same time, then I am logged out of one, when doing something in the other. More precisely:\n\n- run notebook 1, open worksheet A\n- run notebook 2, open worksheet B\n- now click 'Home' in worksheet A, and you will be asked to log in again\n\nThis happens since 5.2. \n\nAssignee: **@jasongrout, @qed777, @williamstein**\n\nCC:  @jasongrout @kcrisman\n\nKeywords: **notebook logged out**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13753_\n\n",
    "closed_at": "2020-04-24T13:45:42Z",
    "created_at": "2012-11-25T09:26:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20notebook",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "logged out when running two notebooks",
    "type": "issue",
    "updated_at": "2020-04-24T13:45:42Z",
    "url": "https://github.com/sagemath/sage/issues/13753",
    "user": "https://github.com/dkrenn"
}
```
When I run two notebooks (different directories) at the same time, then I am logged out of one, when doing something in the other. More precisely:

- run notebook 1, open worksheet A
- run notebook 2, open worksheet B
- now click 'Home' in worksheet A, and you will be asked to log in again

This happens since 5.2. 

Assignee: **@jasongrout, @qed777, @williamstein**

CC:  @jasongrout @kcrisman

Keywords: **notebook logged out**

_Issue created by migration from https://trac.sagemath.org/ticket/13753_





---

archive/issue_events_176825.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2012-11-25T09:26:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176825"
}
```



---

archive/issue_events_176826.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2012-11-25T09:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20notebook",
    "label_color": "000080",
    "label_name": "component: notebook",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176826"
}
```



---

archive/issue_events_176827.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2012-11-25T09:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176827"
}
```



---

archive/issue_events_176828.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2012-11-25T09:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176828"
}
```



---

archive/issue_comments_164303.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nYeap, I've reported it before as well, although without opening a ticket. Still present with 5.6.rc0.",
    "created_at": "2013-01-19T00:10:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164303",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:1" align="right">Comment 1</div>

Yeap, I've reported it before as well, although without opening a ticket. Still present with 5.6.rc0.



---

archive/issue_comments_164304.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nSame with 5.6.rc0+#13717",
    "created_at": "2013-01-19T00:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164304",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:3" align="right">Comment 3</div>

Same with 5.6.rc0+#13717



---

archive/issue_comments_164305.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nMy guess is that this is an issue with the cookies for the servers being confused somehow.",
    "created_at": "2013-01-19T02:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164305",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">Comment 4</div>

My guess is that this is an issue with the cookies for the servers being confused somehow.



---

archive/issue_comments_164306.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nI think the problem is that the port number is not taking into account: I am running several servers for different purposes on the same machine and so they have the same domain name - the difference is only in the port.",
    "created_at": "2013-01-19T03:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164306",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:5" align="right">Comment 5</div>

I think the problem is that the port number is not taking into account: I am running several servers for different purposes on the same machine and so they have the same domain name - the difference is only in the port.



---

archive/issue_comments_164307.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nA long time ago we also had problems with the cookie and I thought Tim Dumol added the port number to the cookie.  But you're right that it should be checked.",
    "created_at": "2013-01-19T04:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164307",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:6" align="right">Comment 6</div>

A long time ago we also had problems with the cookie and I thought Tim Dumol added the port number to the cookie.  But you're right that it should be checked.



---

archive/issue_comments_164308.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nSee #8249 and #6353 for previous cookie-related work.  In particular, it looks like #6353 was the ticket I was mentioning above.",
    "created_at": "2013-01-19T04:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164308",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:7" align="right">Comment 7</div>

See #8249 and #6353 for previous cookie-related work.  In particular, it looks like #6353 was the ticket I was mentioning above.



---

archive/issue_comments_164309.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nAt first glance, it appears that the cookie should have the port name: https://github.com/sagemath/sagenb/blob/master/flask_version/base.py#L101",
    "created_at": "2013-01-19T04:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164309",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:8" align="right">Comment 8</div>

At first glance, it appears that the cookie should have the port name: https://github.com/sagemath/sagenb/blob/master/flask_version/base.py#L101



---

archive/issue_comments_164310.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI can see `nb_session_<port_numer>` cookie mentioned in the code above, but there is also a cookie named just `session` and once I deleted it, I got logged out. I suppose it is created/overwritten by each notebook server and then it works only for the one that was singed into last.",
    "created_at": "2013-01-20T20:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164310",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:9" align="right">Comment 9</div>

I can see `nb_session_<port_numer>` cookie mentioned in the code above, but there is also a cookie named just `session` and once I deleted it, I got logged out. I suppose it is created/overwritten by each notebook server and then it works only for the one that was singed into last.



---

archive/issue_comments_164311.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nAh, very interesting.  I spent a few minutes looking at this, and it looks like we may also be using the built-in flask session management (http://flask.pocoo.org/docs/api/#sessions).  I think the default cookie name there is 'session', but it is configurable.  So:\n\n1. Is that right?\n2. Do we need both the custom cookie we set in the code above as well as the flask session cookie?\n3. How do we set the flask session cookie to include the port? (search for \"default_config\" at http://flask.pocoo.org/docs/api/ -- it appears we just pass that in to the flask app)",
    "created_at": "2013-01-21T19:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164311",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">Comment 10</div>

Ah, very interesting.  I spent a few minutes looking at this, and it looks like we may also be using the built-in flask session management (http://flask.pocoo.org/docs/api/#sessions).  I think the default cookie name there is 'session', but it is configurable.  So:

1. Is that right?
2. Do we need both the custom cookie we set in the code above as well as the flask session cookie?
3. How do we set the flask session cookie to include the port? (search for "default_config" at http://flask.pocoo.org/docs/api/ -- it appears we just pass that in to the flask app)



---

archive/issue_comments_164312.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\n(keep in mind the docs I reference above are for flask 0.9, which might be later than the version we are running, so different info might apply to the version of flask we are running)",
    "created_at": "2013-01-21T19:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164312",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:11" align="right">Comment 11</div>

(keep in mind the docs I reference above are for flask 0.9, which might be later than the version we are running, so different info might apply to the version of flask we are running)



---

archive/issue_comments_164313.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nStill present with 5.10.",
    "created_at": "2013-08-05T08:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164313",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:12" align="right">Comment 12</div>

Still present with 5.10.



---

archive/issue_events_176829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176829"
}
```



---

archive/issue_events_176830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176830"
}
```



---

archive/issue_events_176831.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176831"
}
```



---

archive/issue_events_176832.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176832"
}
```



---

archive/issue_events_176833.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176833"
}
```



---

archive/issue_events_176834.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176834"
}
```



---

archive/issue_events_176835.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176835"
}
```



---

archive/issue_events_176836.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176836"
}
```



---

archive/issue_events_176837.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-21T19:14:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176837"
}
```



---

archive/issue_comments_164314.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nCan we close this ancient ticket about sagenb ?",
    "created_at": "2020-04-21T19:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164314",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">Comment 17</div>

Can we close this ancient ticket about sagenb ?



---

archive/issue_events_176838.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-21T19:14:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176838"
}
```



---

archive/issue_events_176839.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-21T19:14:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176839"
}
```



---

archive/issue_events_176840.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-21T19:14:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176840"
}
```



---

archive/issue_comments_164315.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI think we'll have to.",
    "created_at": "2020-04-22T02:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164315",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">Comment 18</div>

I think we'll have to.



---

archive/issue_events_176841.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-24T13:45:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176841"
}
```



---

archive/issue_events_176842.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-04-24T13:45:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13753#event-176842"
}
```



---

archive/issue_comments_164316.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nok",
    "created_at": "2020-04-24T13:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13753#issuecomment-164316",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">Comment 19</div>

ok
