# Issue 13190: make sagelib use setuptools instead of distutils

archive/issues_013018.json:
```json
{
    "body": "Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.\n\nSee also:\n#29845 - PEP 517 buildapi for sage_setup\n\n\n---\n\nReferences:\n\nhttps://stackoverflow.com/questions/3779915/why-does-python-setup-py-sdist-create-unwanted-project-egg-info-in-project-r\n\n\n\nDepends on #29702\n\nDepends on #29803\n\n**Assignee:** GeorgSWeber\n\n**CC:**  @kini @jdemeyer @robertwb @kcrisman @mwhansen @jhpalmieri @embray @dimpase @kiwifb\n\n**Branch:** [u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils)\n\n**Commit:** [93bbbfe75f162368247a04d0023e95628ef8ec13](https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13)\n\n**Reviewer:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/13190\n\n",
    "closed_at": "2020-08-15T10:23:09Z",
    "created_at": "2012-07-01T10:06:03Z",
    "labels": [
        "component: build",
        "enhancement",
        "invalid"
    ],
    "title": "make sagelib use setuptools instead of distutils",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/13190",
    "user": "https://github.com/ohanar"
}
```
Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.

See also:
#29845 - PEP 517 buildapi for sage_setup


---

References:

https://stackoverflow.com/questions/3779915/why-does-python-setup-py-sdist-create-unwanted-project-egg-info-in-project-r



Depends on #29702

Depends on #29803

**Assignee:** GeorgSWeber

**CC:**  @kini @jdemeyer @robertwb @kcrisman @mwhansen @jhpalmieri @embray @dimpase @kiwifb

**Branch:** [u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils)

**Commit:** [93bbbfe75f162368247a04d0023e95628ef8ec13](https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13)

**Reviewer:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/13190





---

archive/issue_comments_153505.json:
```json
{
    "body": "**Dependencies:** #13031",
    "created_at": "2012-07-01T10:13:31Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153505",
    "user": "https://github.com/ohanar"
}
```

**Dependencies:** #13031



---

archive/issue_events_111341.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-07-01T10:13:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111341"
}
```



---

archive/issue_comments_153506.json:
```json
{
    "body": "<a id='comment:3'></a>\nI would imagine that you get problems similar to #12659 .   Have you tried this out?",
    "created_at": "2012-07-01T10:44:06Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153506",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
I would imagine that you get problems similar to #12659 .   Have you tried this out?



---

archive/issue_comments_153507.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [@mwhansen](#comment%3A3):\n> I would imagine that you get problems similar to #12659 .   Have you tried this out?\n\nDo you mean the sdist issues? No, I have not tried them yet, but I wouldn't doubt that there may be issues with them. Also, as noted in deps, there is an issue with parallel instances of setuptools, so either deps has to be hacked to force sage into the serial build, or we depend on #12994 (my vote is the later, since it is cleaner).",
    "created_at": "2012-07-01T19:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153507",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>
Replying to [@mwhansen](#comment%3A3):
> I would imagine that you get problems similar to #12659 .   Have you tried this out?

Do you mean the sdist issues? No, I have not tried them yet, but I wouldn't doubt that there may be issues with them. Also, as noted in deps, there is an issue with parallel instances of setuptools, so either deps has to be hacked to force sage into the serial build, or we depend on #12994 (my vote is the later, since it is cleaner).



---

archive/issue_comments_153508.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've decided to make #12994 a dependency -- makes it much easier to add setuptool packages to the build system.",
    "created_at": "2012-07-03T21:56:15Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153508",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:5'></a>
I've decided to make #12994 a dependency -- makes it much easier to add setuptool packages to the build system.



---

archive/issue_comments_153509.json:
```json
{
    "body": "**Changing dependencies** from \"#13031\" to \"#12994, #13031\".",
    "created_at": "2012-07-03T21:57:34Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153509",
    "user": "https://github.com/ohanar"
}
```

**Changing dependencies** from "#13031" to "#12994, #13031".



---

archive/issue_comments_153510.json:
```json
{
    "body": "**Changing dependencies** from \"#12994, #13031\" to \"#12994, #13031, #13197\".",
    "created_at": "2012-07-03T22:47:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153510",
    "user": "https://github.com/ohanar"
}
```

**Changing dependencies** from "#12994, #13031" to "#12994, #13031, #13197".



---

archive/issue_comments_153511.json:
```json
{
    "body": "<a id='comment:7'></a>\nThere are some issues with using relative paths with setuptools (which we want for relocation purposes). #13197 fixes these issues.",
    "created_at": "2012-07-03T22:47:45Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153511",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:7'></a>
There are some issues with using relative paths with setuptools (which we want for relocation purposes). #13197 fixes these issues.



---

archive/issue_comments_153512.json:
```json
{
    "body": "**Changing dependencies** from \"#12994, #13031, #13197\" to \"#11874, #12994, #13031, #13197\".",
    "created_at": "2012-07-03T23:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153512",
    "user": "https://github.com/ohanar"
}
```

**Changing dependencies** from "#12994, #13031, #13197" to "#11874, #12994, #13031, #13197".



---

archive/issue_comments_153513.json:
```json
{
    "body": "<a id='comment:9'></a>\nI am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?\n\nAlso, I personally think it would be better to split this in two tickets:\nA. Use setuptools\nB. Use setup.py develop",
    "created_at": "2012-08-31T08:17:19Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153513",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?

Also, I personally think it would be better to split this in two tickets:
A. Use setuptools
B. Use setup.py develop



---

archive/issue_comments_153514.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@jdemeyer](#comment%3A9):\n> I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?\n> \n> Also, I personally think it would be better to split this in two tickets:\n> A. Use setuptools\n\nThis should only require #13031.\n> B. Use setup.py develop\n\nThis is more or less #12659 after switching to setuptools, and is where the other dependencies creep up (they aren't strictly necessary, but the alternative is to hack around setuptools, which is less preferable than patching it IMO).\n\nI'll rework the patch to only do A once we have a 5.4 beta (mainly because #13031 more or less needs to be rebased with every development release).",
    "created_at": "2012-09-04T20:43:50Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153514",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:10'></a>
Replying to [@jdemeyer](#comment%3A9):
> I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?
> 
> Also, I personally think it would be better to split this in two tickets:
> A. Use setuptools

This should only require #13031.
> B. Use setup.py develop

This is more or less #12659 after switching to setuptools, and is where the other dependencies creep up (they aren't strictly necessary, but the alternative is to hack around setuptools, which is less preferable than patching it IMO).

I'll rework the patch to only do A once we have a 5.4 beta (mainly because #13031 more or less needs to be rebased with every development release).



---

archive/issue_comments_153515.json:
```json
{
    "body": "apply to root repo",
    "created_at": "2012-09-05T22:34:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153515",
    "user": "https://github.com/ohanar"
}
```

apply to root repo



---

archive/attachments_018444.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac13190_root.patch",
    "asset_url": "tarball://root/attachments/ticket13190/trac13190_root.patch",
    "created_at": "2012-09-05T22:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13190/trac13190_root.patch",
    "user": "https://github.com/ohanar"
}
```



---

archive/attachments_018445.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac13190_scripts.patch",
    "asset_url": "tarball://root/attachments/ticket13190/trac13190_scripts.patch",
    "created_at": "2012-09-05T22:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13190/trac13190_scripts.patch",
    "user": "https://github.com/ohanar"
}
```



---

archive/issue_comments_153516.json:
```json
{
    "body": "**Attachment:** [trac13190_root.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_root.patch)\n\n**Attachment:** [trac13190_scripts.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_scripts.patch)\n\napply to scripts repo",
    "created_at": "2012-09-05T22:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153516",
    "user": "https://github.com/ohanar"
}
```

**Attachment:** [trac13190_root.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_root.patch)

**Attachment:** [trac13190_scripts.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_scripts.patch)

apply to scripts repo



---

archive/issue_comments_153517.json:
```json
{
    "body": "**Changing dependencies** from \"#11874, #12994, #13031, #13197\" to \"#11874, #12994, #13031\".",
    "created_at": "2012-09-05T22:36:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153517",
    "user": "https://github.com/ohanar"
}
```

**Changing dependencies** from "#11874, #12994, #13031, #13197" to "#11874, #12994, #13031".



---

archive/issue_comments_153518.json:
```json
{
    "body": "<a id='comment:11'></a>\nok, rebased and only does the switch to setuptools (doesn't switch to `setup.py develop` anymore). Dependencies are now accurate.",
    "created_at": "2012-09-05T22:36:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153518",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:11'></a>
ok, rebased and only does the switch to setuptools (doesn't switch to `setup.py develop` anymore). Dependencies are now accurate.



---

archive/attachments_018446.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac13190_library.patch",
    "asset_url": "tarball://root/attachments/ticket13190/trac13190_library.patch",
    "created_at": "2012-09-06T00:05:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket13190/trac13190_library.patch",
    "user": "https://github.com/ohanar"
}
```



---

archive/issue_comments_153519.json:
```json
{
    "body": "**Attachment:** [trac13190_library.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_library.patch)\n\napply to sage library",
    "created_at": "2012-09-06T00:05:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153519",
    "user": "https://github.com/ohanar"
}
```

**Attachment:** [trac13190_library.patch](https://github.com/sagemath/sage/files/ticket13190/trac13190_library.patch)

apply to sage library



---

archive/issue_events_111342.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111342"
}
```



---

archive/issue_events_111343.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111343"
}
```



---

archive/issue_comments_153520.json:
```json
{
    "body": "<a id='comment:13'></a>\nAre we trying to make this happen before the git transition or afterward?",
    "created_at": "2013-09-06T16:09:56Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153520",
    "user": "https://github.com/roed314"
}
```

<a id='comment:13'></a>
Are we trying to make this happen before the git transition or afterward?



---

archive/issue_events_111344.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-09-06T16:09:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111344"
}
```



---

archive/issue_events_111345.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-09-06T16:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111345"
}
```



---

archive/issue_comments_153521.json:
```json
{
    "body": "<a id='comment:14'></a>\nCertainly after, although I'm not currently convinced that we should proceed in this direction.",
    "created_at": "2013-09-06T16:49:25Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153521",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:14'></a>
Certainly after, although I'm not currently convinced that we should proceed in this direction.



---

archive/issue_events_111346.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111346"
}
```



---

archive/issue_events_111347.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111347"
}
```



---

archive/issue_events_111348.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111348"
}
```



---

archive/issue_events_111349.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111349"
}
```



---

archive/issue_events_111350.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111350"
}
```



---

archive/issue_events_111351.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111351"
}
```



---

archive/issue_comments_153522.json:
```json
{
    "body": "<a id='comment:18'></a>\nAny thoughts on this?  It hasn't been touched in quite some time despite there being (a likely outdated by now) patch. I can take this issue over and see it to completion if desired.",
    "created_at": "2016-02-24T10:29:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153522",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Any thoughts on this?  It hasn't been touched in quite some time despite there being (a likely outdated by now) patch. I can take this issue over and see it to completion if desired.



---

archive/issue_comments_153523.json:
```json
{
    "body": "<a id='comment:19'></a>\nThere is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.\n\nI'm not sure that we need `data_files` for the Sage library though. Maybe we could use `package_data` instead. But then that is something which should be investigated.",
    "created_at": "2016-02-24T10:38:32Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153523",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.

I'm not sure that we need `data_files` for the Sage library though. Maybe we could use `package_data` instead. But then that is something which should be investigated.



---

archive/issue_comments_153524.json:
```json
{
    "body": "**Changing dependencies** from \"#11874, #12994, #13031\" to \"\".",
    "created_at": "2016-02-24T10:40:41Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153524",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#11874, #12994, #13031" to "".



---

archive/issue_comments_153525.json:
```json
{
    "body": "<a id='comment:21'></a>\nI don't know what files need to be installed with the `sage` package.  For the majority of Python-based projects `package_data` is preferred, but of course Sage is 'special'.\n\nLet me look into what files are installed with the sage package, and I can worry about the details.",
    "created_at": "2016-02-24T10:46:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153525",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
I don't know what files need to be installed with the `sage` package.  For the majority of Python-based projects `package_data` is preferred, but of course Sage is 'special'.

Let me look into what files are installed with the sage package, and I can worry about the details.



---

archive/issue_comments_153526.json:
```json
{
    "body": "<a id='comment:22'></a>\nHang on, I'm looking at it.",
    "created_at": "2016-02-24T10:48:01Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153526",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Hang on, I'm looking at it.



---

archive/issue_comments_153527.json:
```json
{
    "body": "<a id='comment:23'></a>\nI created a new ticket for using `package_data`.",
    "created_at": "2016-02-24T10:49:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
I created a new ticket for using `package_data`.



---

archive/issue_events_111352.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-24T10:49:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111352"
}
```



---

archive/issue_events_111353.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-24T10:49:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111353"
}
```



---

archive/issue_comments_153528.json:
```json
{
    "body": "**Dependencies:** #20108",
    "created_at": "2016-02-24T10:49:37Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153528",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #20108



---

archive/issue_comments_153529.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@jdemeyer](#comment%3A19):\n> There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.\n\nI recently learned about the (almost undocumented) setuptools options `--old-and-unmanageable`. It forces a non-egg build which is exactly what we want. So that would make this ticket possible again.",
    "created_at": "2018-06-08T15:05:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153529",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [@jdemeyer](#comment%3A19):
> There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.

I recently learned about the (almost undocumented) setuptools options `--old-and-unmanageable`. It forces a non-egg build which is exactly what we want. So that would make this ticket possible again.



---

archive/issue_comments_153530.json:
```json
{
    "body": "**Changing dependencies** from \"#20108\" to \"\".",
    "created_at": "2018-06-08T18:39:13Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153530",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#20108" to "".



---

archive/issue_comments_153531.json:
```json
{
    "body": "<a id='comment:26'></a>\nAlso, it seems that Sage is no longer using either `data_files` or `package_data`. So that discussion has also disappeared.",
    "created_at": "2018-06-08T18:40:26Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Also, it seems that Sage is no longer using either `data_files` or `package_data`. So that discussion has also disappeared.



---

archive/issue_comments_153532.json:
```json
{
    "body": "<a id='comment:27'></a>\nI forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`, where I thought the latter should be sufficient...\n\nAlso I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.",
    "created_at": "2018-06-27T14:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153532",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`, where I thought the latter should be sufficient...

Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.



---

archive/issue_comments_153533.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [@embray](#comment%3A27):\n> Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.\n\nThere is no problem with `package_data` if you want to use it in the way that it was intended to be used (which may not align with actual use cases).\n\nThere **is** a problem with `data_files`: setuptools still doesn't really support that. One of the reasons that this ticket stalled was because Sage was using `data_files` at the time to install Cython-related files. You suggested that it would be easy to use `package_data` instead (#20108). That didn't actually work, but now we are using custom code (neither `data_files` not `package_data`, see #21600) to install those files.",
    "created_at": "2018-06-27T15:03:10Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153533",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [@embray](#comment%3A27):
> Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.

There is no problem with `package_data` if you want to use it in the way that it was intended to be used (which may not align with actual use cases).

There **is** a problem with `data_files`: setuptools still doesn't really support that. One of the reasons that this ticket stalled was because Sage was using `data_files` at the time to install Cython-related files. You suggested that it would be easy to use `package_data` instead (#20108). That didn't actually work, but now we are using custom code (neither `data_files` not `package_data`, see #21600) to install those files.



---

archive/issue_comments_153534.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@embray](#comment%3A27):\n> I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`\n\nMainly that the latter requires a `--record` argument also.",
    "created_at": "2018-06-27T15:05:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153534",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [@embray](#comment%3A27):
> I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`

Mainly that the latter requires a `--record` argument also.



---

archive/issue_comments_153535.json:
```json
{
    "body": "**Changing author** from \"R. Andrew Ohana\" to \"\".",
    "created_at": "2020-06-04T17:59:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153535",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "R. Andrew Ohana" to "".



---

archive/issue_events_111354.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T17:59:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "rename": {
        "from": "make sage use setuptools instead of distutils",
        "to": "make sagelib use setuptools instead of distutils"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111354"
}
```



---

archive/issue_events_111355.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T17:59:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111355"
}
```



---

archive/issue_events_111356.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T17:59:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111356"
}
```



---

archive/issue_comments_153536.json:
```json
{
    "body": "<a id='comment:30'></a>\nTime to revive this ancient ticket.",
    "created_at": "2020-06-04T17:59:14Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153536",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Time to revive this ancient ticket.



---

archive/issue_events_111357.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T17:59:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111357"
}
```



---

archive/issue_events_111358.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-04T17:59:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111358"
}
```



---

archive/issue_comments_153537.json:
```json
{
    "body": "**Dependencies:** #29702",
    "created_at": "2020-06-05T02:48:16Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153537",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #29702



---

archive/issue_comments_153538.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils)",
    "created_at": "2020-06-05T04:37:43Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153538",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_sagelib_use_setuptools_instead_of_distutils)



---

archive/issue_comments_153539.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a617950488b3945fb6f494cec8b50e8486bd9dd\">0a61795</a></td><td><code>Trac #29345: don't force SHELL=bash any longer.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5db53186b9ae9a546bc78fc9107cc1af713b7e24\">5db5318</a></td><td><code>Trac #29345: remove \"break\" statements from AC_SEARCH_LIBS.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e810ad1596d527c832bf43d3aac745407c9ba98d\">e810ad1</a></td><td><code>Trac #29345: don't use sage's config.status for the lrcalc build.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93c9921cc5ff461cd1f02f441b46cea4400dcd85\">93c9921</a></td><td><code>Trac #29345: replace the function that populates the CVXOPT_* variables.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e66a0abc00d5bf5ac1496e13f4d2f4ef7fe29dc\">0e66a0a</a></td><td><code>Trac #29345: add Dima's SPKG patches for ksh compatibility.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df3f05e03ba671dd6be502ccae96d2a6162d29d4\">df3f05e</a></td><td><code>build/make/Makefile.in [SCRIPT_PACKAGE_templ]: cd into the SPKG directory; adjust spkg-install scripts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5372065710668ae1b36d059c2cbf9b6f325239c7\">5372065</a></td><td><code>Merge branch 't/29793/script_packages_should_cd_into_the_spkg_directory' into t/29411/make_sagelib_a_script_package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c166b976775cdcd61e2b5c52a6585426f47646db\">c166b97</a></td><td><code>Merge branch 't/29411/make_sagelib_a_script_package' into t/29702/move_all_code_from_src_setup_py__src_fpickle_setup_py_to_sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f33436229fd87b47aa0dc255d475f92f7d88ac2\">5f33436</a></td><td><code>src/setup.py: from setuptools import setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13\">93bbbfe</a></td><td><code>Add src/setup.cfg</code></td></tr></table>\n",
    "created_at": "2020-06-05T04:39:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153539",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a617950488b3945fb6f494cec8b50e8486bd9dd">0a61795</a></td><td><code>Trac #29345: don't force SHELL=bash any longer.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5db53186b9ae9a546bc78fc9107cc1af713b7e24">5db5318</a></td><td><code>Trac #29345: remove "break" statements from AC_SEARCH_LIBS.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e810ad1596d527c832bf43d3aac745407c9ba98d">e810ad1</a></td><td><code>Trac #29345: don't use sage's config.status for the lrcalc build.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93c9921cc5ff461cd1f02f441b46cea4400dcd85">93c9921</a></td><td><code>Trac #29345: replace the function that populates the CVXOPT_* variables.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e66a0abc00d5bf5ac1496e13f4d2f4ef7fe29dc">0e66a0a</a></td><td><code>Trac #29345: add Dima's SPKG patches for ksh compatibility.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df3f05e03ba671dd6be502ccae96d2a6162d29d4">df3f05e</a></td><td><code>build/make/Makefile.in [SCRIPT_PACKAGE_templ]: cd into the SPKG directory; adjust spkg-install scripts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5372065710668ae1b36d059c2cbf9b6f325239c7">5372065</a></td><td><code>Merge branch 't/29793/script_packages_should_cd_into_the_spkg_directory' into t/29411/make_sagelib_a_script_package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c166b976775cdcd61e2b5c52a6585426f47646db">c166b97</a></td><td><code>Merge branch 't/29411/make_sagelib_a_script_package' into t/29702/move_all_code_from_src_setup_py__src_fpickle_setup_py_to_sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f33436229fd87b47aa0dc255d475f92f7d88ac2">5f33436</a></td><td><code>src/setup.py: from setuptools import setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13">93bbbfe</a></td><td><code>Add src/setup.cfg</code></td></tr></table>




---

archive/issue_comments_153540.json:
```json
{
    "body": "**Commit:** [93bbbfe75f162368247a04d0023e95628ef8ec13](https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13)",
    "created_at": "2020-06-05T04:39:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153540",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [93bbbfe75f162368247a04d0023e95628ef8ec13](https://github.com/sagemath/sagetrac-mirror/commit/93bbbfe75f162368247a04d0023e95628ef8ec13)



---

archive/issue_comments_153541.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.\n+\n+---\n+\n+References:\n+\n+https://stackoverflow.com/questions/3779915/why-does-python-setup-py-sdist-create-unwanted-project-egg-info-in-project-r\n+\n+\n``````\n",
    "created_at": "2020-06-05T04:39:21Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153541",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,9 @@
 Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.
+
+---
+
+References:
+
+https://stackoverflow.com/questions/3779915/why-does-python-setup-py-sdist-create-unwanted-project-egg-info-in-project-r
+
+
``````




---

archive/issue_comments_153542.json:
```json
{
    "body": "**Changing dependencies** from \"#29702\" to \"#29702, #29803\".",
    "created_at": "2020-06-05T05:14:20Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153542",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29702" to "#29702, #29803".



---

archive/issue_comments_153543.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.\n+\n+See also:\n+#29845 - PEP 517 buildapi for sage_setup\n+\n \n ---\n \n``````\n",
    "created_at": "2020-06-11T02:26:51Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153543",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
 Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.
+
+See also:
+#29845 - PEP 517 buildapi for sage_setup
+
 
 ---
 
``````




---

archive/issue_events_111359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-28T19:17:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111359"
}
```



---

archive/issue_events_111360.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-28T19:17:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111360"
}
```



---

archive/issue_comments_153544.json:
```json
{
    "body": "<a id='comment:37'></a>\nThis ticket is superseded by #29950 and can be closed.",
    "created_at": "2020-06-28T19:17:59Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153544",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
This ticket is superseded by #29950 and can be closed.



---

archive/issue_events_111361.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-28T19:17:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111361"
}
```



---

archive/issue_events_111362.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-29T14:39:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111362"
}
```



---

archive/issue_events_111363.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-29T14:39:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111363"
}
```



---

archive/issue_comments_153545.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-06-29T14:39:26Z",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13190#issuecomment-153545",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_111364.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-15T10:23:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111364"
}
```



---

archive/issue_events_111365.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-15T10:23:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13190",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13190#event-111365"
}
```
