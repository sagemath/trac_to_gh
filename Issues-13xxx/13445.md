# Issue 13445: Cuspidal subspace of modular forms over finite field contains forms that are not cuspidal

archive/issues_013273.json:
```json
{
    "body": "Executing:\n\n```\nM=ModularForms(Gamma1(29),base_ring=GF(29))\nS=M.cuspidal_subspace()\nS.basis()\n```\ngives:\n\n```\n[\n1 + O(q^6),\nq + O(q^6),\nq^2 + O(q^6),\nq^3 + O(q^6),\nq^4 + O(q^6),\nq^5 + O(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6),\nO(q^6)\n]\n```\n\nThe first element is clearly not cuspidal\n\n\nAssignee: @craigcitro\n\nBranch/Commit: cf1c1bf671fc4789308500c4805a81a35f016436\n\nReviewer: Peter Bruin\n\nAuthor: Alex Ghitza\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13445\n\n",
    "closed_at": "2014-05-12T11:34:48Z",
    "created_at": "2012-09-11T08:45:36Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Cuspidal subspace of modular forms over finite field contains forms that are not cuspidal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13445",
    "user": "https://github.com/koffie"
}
```
Executing:

```
M=ModularForms(Gamma1(29),base_ring=GF(29))
S=M.cuspidal_subspace()
S.basis()
```
gives:

```
[
1 + O(q^6),
q + O(q^6),
q^2 + O(q^6),
q^3 + O(q^6),
q^4 + O(q^6),
q^5 + O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6),
O(q^6)
]
```

The first element is clearly not cuspidal


Assignee: @craigcitro

Branch/Commit: cf1c1bf671fc4789308500c4805a81a35f016436

Reviewer: Peter Bruin

Author: Alex Ghitza

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13445





---

archive/issue_comments_202392.json:
```json
{
    "body": "<a id='comment:1'></a>Looking at sage/modular/modform/cuspidal_submodule.py, it seems that the cuspidal submodule is just defined by\n\n* computing its dimension d\n* taken the first d vectors of the basis of modular forms\n\nSo it implicitly assumes that the cusp forms come first in the listing of the basis.\n\nOn the other hand, the \"is_cuspidal\" method just checks that the element is in the cuspidal submodule. Is there a way to really check if something is cuspidal ?",
    "created_at": "2013-08-08T08:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202392",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>Looking at sage/modular/modform/cuspidal_submodule.py, it seems that the cuspidal submodule is just defined by

* computing its dimension d
* taken the first d vectors of the basis of modular forms

So it implicitly assumes that the cusp forms come first in the listing of the basis.

On the other hand, the "is_cuspidal" method just checks that the element is in the cuspidal submodule. Is there a way to really check if something is cuspidal ?



---

archive/issue_events_037352.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37352"
}
```



---

archive/issue_events_037353.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37353"
}
```



---

archive/issue_events_037354.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37354"
}
```



---

archive/issue_comments_202393.json:
```json
{
    "body": "<a id='comment:4'></a>Smaller example:\n\n```\nsage: M = ModularForms(Gamma1(11), base_ring=GF(11))\nsage: S = M.cuspidal_subspace()\nsage: S.basis()\n[\n1 + O(q^6)\n]\n```",
    "created_at": "2014-04-18T23:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202393",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:4'></a>Smaller example:

```
sage: M = ModularForms(Gamma1(11), base_ring=GF(11))
sage: S = M.cuspidal_subspace()
sage: S.basis()
[
1 + O(q^6)
]
```



---

archive/issue_comments_202394.json:
```json
{
    "body": "<a id='comment:5'></a>Even smaller example:\n\n```\nsage: M = ModularForms(Gamma0(11), base_ring=GF(11)); M\nModular Forms space of dimension 2 for Congruence Subgroup Gamma0(11) of weight 2 over Finite Field of size 11\nsage: M.basis()\n[\n1 + q^2 + q^3 + q^4 + q^5 + O(q^6),\nq + 9*q^2 + 10*q^3 + 2*q^4 + q^5 + O(q^6)\n]\nsage: S = M.cuspidal_subspace()\nsage: S.basis()\n[\n1 + q^2 + q^3 + q^4 + q^5 + O(q^6)\n]\n```",
    "created_at": "2014-04-18T23:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202394",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:5'></a>Even smaller example:

```
sage: M = ModularForms(Gamma0(11), base_ring=GF(11)); M
Modular Forms space of dimension 2 for Congruence Subgroup Gamma0(11) of weight 2 over Finite Field of size 11
sage: M.basis()
[
1 + q^2 + q^3 + q^4 + q^5 + O(q^6),
q + 9*q^2 + 10*q^3 + 2*q^4 + q^5 + O(q^6)
]
sage: S = M.cuspidal_subspace()
sage: S.basis()
[
1 + q^2 + q^3 + q^4 + q^5 + O(q^6)
]
```



---

archive/issue_comments_202395.json:
```json
{
    "body": "Changing branch from \"\" to \"u/AlexGhitza/ticket/13445\"",
    "created_at": "2014-04-24T06:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202395",
    "user": "https://github.com/aghitza"
}
```

Changing branch from "" to "u/AlexGhitza/ticket/13445"



---

archive/issue_comments_202396.json:
```json
{
    "body": "Changing commit from \"\" to \"cf1c1bf671fc4789308500c4805a81a35f016436\"",
    "created_at": "2014-04-24T06:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202396",
    "user": "https://github.com/aghitza"
}
```

Changing commit from "" to "cf1c1bf671fc4789308500c4805a81a35f016436"



---

archive/issue_comments_202397.json:
```json
{
    "body": "<a id='comment:7'></a>The issue was in `sage.modular.modform.ambient_R.py`, where `q_integral_basis` was used for positive characteristic base rings.  However, `q_integral_basis` does not guarantee that its output is in the format exhibited by `q_expansion_basis`, i.e. starting with a basis for the cuspidal subspace and completed to a basis of the entire space.\n\nThe modified code now computes an integral basis for the cuspidal subspace and then completes it to an integral basis of the whole space.  This strategy works for rings of prime power characteristic (e.g. finite fields or integers modulo a prime power, the two main use cases currently in Sage).\n\n---\nNew commits:",
    "created_at": "2014-04-24T06:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202397",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:7'></a>The issue was in `sage.modular.modform.ambient_R.py`, where `q_integral_basis` was used for positive characteristic base rings.  However, `q_integral_basis` does not guarantee that its output is in the format exhibited by `q_expansion_basis`, i.e. starting with a basis for the cuspidal subspace and completed to a basis of the entire space.

The modified code now computes an integral basis for the cuspidal subspace and then completes it to an integral basis of the whole space.  This strategy works for rings of prime power characteristic (e.g. finite fields or integers modulo a prime power, the two main use cases currently in Sage).

---
New commits:



---

archive/issue_comments_202398.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-24T06:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202398",
    "user": "https://github.com/aghitza"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202399.json:
```json
{
    "body": "Changing author from \"\" to \"Alex Ghitza\"",
    "created_at": "2014-04-24T06:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202399",
    "user": "https://github.com/aghitza"
}
```

Changing author from "" to "Alex Ghitza"



---

archive/issue_events_037355.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37355"
}
```



---

archive/issue_events_037356.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37356"
}
```



---

archive/issue_comments_202400.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-09T11:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202400",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202401.json:
```json
{
    "body": "<a id='comment:9'></a>The code looks good and the patchbot is happy.",
    "created_at": "2014-05-09T11:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202401",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>The code looks good and the patchbot is happy.



---

archive/issue_comments_202402.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2014-05-09T11:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202402",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_202403.json:
```json
{
    "body": "Changing branch from \"u/AlexGhitza/ticket/13445\" to \"cf1c1bf671fc4789308500c4805a81a35f016436\"",
    "created_at": "2014-05-12T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202403",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/AlexGhitza/ticket/13445" to "cf1c1bf671fc4789308500c4805a81a35f016436"



---

archive/issue_events_037357.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-12T11:34:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13445#event-37357"
}
```



---

archive/issue_comments_202404.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-12T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13445#issuecomment-202404",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
