# Issue 13166: Compute q-binomial coefficients more efficiently

archive/issues_012994.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.\n\nBefore:\n\n```\nsage: from sage.combinat.q_analogues import *\nsage: %timeit q_binomial(18,7)\n125 loops, best of 3: 1.89 ms per loop\nsage: %timeit q_binomial(180,70)\n5 loops, best of 3: 1.4 s per loop\n```\n\nAfter:\n\n```\nsage: from sage.combinat.q_analogues import *\nsage: %timeit q_binomial(18,7)\n125 loops, best of 3: 2.01 ms per loop\nsage: %timeit q_binomial2(180,70)\n25 loops, best of 3: 34.7 ms per loop\n```\n\nApply [attachment: trac_13166_q_binomials.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz) and [attachment: trac_13166_q_binomials_reference.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)\n\nReviewer: **Javier L\u00f3pez Pe\u00f1a**\n\nAuthor: **Armin Straub**\n\nMerged: **sage-5.2.beta1**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/13166_\n\n",
    "closed_at": "2012-07-07T22:31:22Z",
    "created_at": "2012-06-26T12:24:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Compute q-binomial coefficients more efficiently",
    "type": "issue",
    "updated_at": "2012-07-07T22:31:22Z",
    "url": "https://github.com/sagemath/sage/issues/13166",
    "user": "https://github.com/arminstraub"
}
```
Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.

Before:

```
sage: from sage.combinat.q_analogues import *
sage: %timeit q_binomial(18,7)
125 loops, best of 3: 1.89 ms per loop
sage: %timeit q_binomial(180,70)
5 loops, best of 3: 1.4 s per loop
```

After:

```
sage: from sage.combinat.q_analogues import *
sage: %timeit q_binomial(18,7)
125 loops, best of 3: 2.01 ms per loop
sage: %timeit q_binomial2(180,70)
25 loops, best of 3: 34.7 ms per loop
```

Apply [attachment: trac_13166_q_binomials.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz) and [attachment: trac_13166_q_binomials_reference.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)

Reviewer: **Javier L칩pez Pe침a**

Author: **Armin Straub**

Merged: **sage-5.2.beta1**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/13166_





---

archive/issue_events_183042.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2012-06-26T12:24:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183042"
}
```



---

archive/issue_events_183043.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2012-06-26T12:24:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183043"
}
```



---

archive/issue_events_183044.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2012-06-26T12:24:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183044"
}
```



---

archive/issue_events_183045.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2012-06-26T12:24:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183045"
}
```



---

archive/issue_events_183046.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2012-06-26T12:24:33Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "subject": "https://github.com/arminstraub",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183046"
}
```



---

archive/issue_comments_150994.json:
```json
{
    "body": "Attachment: **[trac_13166_q_binomials.patch.gz](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz)**",
    "created_at": "2012-06-26T12:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150994",
    "user": "https://github.com/arminstraub"
}
```

Attachment: **[trac_13166_q_binomials.patch.gz](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz)**



---

archive/issue_comments_150995.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,7 @@\n Before:\n \n ```\n+sage: from sage.combinat.q_analogues import *\n sage: %timeit q_binomial(18,7)\n 125 loops, best of 3: 1.89 ms per loop\n sage: %timeit q_binomial(180,70)\n@@ -12,6 +13,7 @@\n After:\n \n ```\n+sage: from sage.combinat.q_analogues import *\n sage: %timeit q_binomial(18,7)\n 125 loops, best of 3: 2.01 ms per loop\n sage: %timeit q_binomial2(180,70)\n``````\n",
    "created_at": "2012-06-26T12:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150995",
    "user": "https://github.com/arminstraub"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,7 @@
 Before:
 
 ```
+sage: from sage.combinat.q_analogues import *
 sage: %timeit q_binomial(18,7)
 125 loops, best of 3: 1.89 ms per loop
 sage: %timeit q_binomial(180,70)
@@ -12,6 +13,7 @@
 After:
 
 ```
+sage: from sage.combinat.q_analogues import *
 sage: %timeit q_binomial(18,7)
 125 loops, best of 3: 2.01 ms per loop
 sage: %timeit q_binomial2(180,70)
``````




---

archive/issue_events_183047.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2012-06-26T12:58:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183047"
}
```



---

archive/issue_comments_150996.json:
```json
{
    "body": "Reviewer: **Javier L\u00f3pez Pe\u00f1a**",
    "created_at": "2012-07-03T16:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150996",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Reviewer: **Javier L칩pez Pe침a**



---

archive/issue_comments_150997.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNice! Code looks good, all tests pass. I have added a reference for the new method in the documentation, if you agree with my reviewer patch you can give this a positive review.",
    "created_at": "2012-07-03T16:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150997",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:3" align="right">comment:3</div>

Nice! Code looks good, all tests pass. I have added a reference for the new method in the documentation, if you agree with my reviewer patch you can give this a positive review.



---

archive/issue_comments_150998.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\npatchbot: apply trac_13166_q_binomials.patch trac_13166.reviewer.patch",
    "created_at": "2012-07-03T16:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150998",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:4" align="right">comment:4</div>

patchbot: apply trac_13166_q_binomials.patch trac_13166.reviewer.patch



---

archive/issue_comments_150999.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_13166_q_binomials_reference.patch.gz](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)**\n\nThank you for adding a reference!\n\nI was trying to understand how docstrings in general are working... based on what I saw in other files, I have slightly modified your documentation (for instance, no double colon after REFERENCES and an underscore when citing the reference).  Please correct me if this is wrong.\n\nOther than this nitpicking, I am happy with your addition.",
    "created_at": "2012-07-05T16:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-150999",
    "user": "https://github.com/arminstraub"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_13166_q_binomials_reference.patch.gz](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)**

Thank you for adding a reference!

I was trying to understand how docstrings in general are working... based on what I saw in other files, I have slightly modified your documentation (for instance, no double colon after REFERENCES and an underscore when citing the reference).  Please correct me if this is wrong.

Other than this nitpicking, I am happy with your addition.



---

archive/issue_comments_151000.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\npatchbot: apply trac_13166_q_binomials.patch trac_13166_q_binomials_reference.patch",
    "created_at": "2012-07-05T16:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-151000",
    "user": "https://github.com/arminstraub"
}
```

<div id="comment:6" align="right">comment:6</div>

patchbot: apply trac_13166_q_binomials.patch trac_13166_q_binomials_reference.patch



---

archive/issue_comments_151001.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,5 @@\n sage: %timeit q_binomial2(180,70)\n 25 loops, best of 3: 34.7 ms per loop\n ```\n+\n+Apply [attachment: trac_13166_q_binomials.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz) and [attachment: trac_13166_q_binomials_reference.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)\n``````\n",
    "created_at": "2012-07-06T11:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-151001",
    "user": "https://github.com/sagetrac-jlopez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,5 @@
 sage: %timeit q_binomial2(180,70)
 25 loops, best of 3: 34.7 ms per loop
 ```
+
+Apply [attachment: trac_13166_q_binomials.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials.patch.gz) and [attachment: trac_13166_q_binomials_reference.patch](https://github.com/sagemath/sage/files/ticket13166/trac_13166_q_binomials_reference.patch.gz)
``````




---

archive/issue_events_183048.json:
```json
{
    "actor": "https://github.com/sagetrac-jlopez",
    "created_at": "2012-07-06T11:31:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183048"
}
```



---

archive/issue_events_183049.json:
```json
{
    "actor": "https://github.com/sagetrac-jlopez",
    "created_at": "2012-07-06T11:31:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183049"
}
```



---

archive/issue_comments_151002.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYou are correct, I tend to mess up the markup every now and then... ;-)\nCode still looks good, test still pass, and patchbot seems happy, so positive review!",
    "created_at": "2012-07-06T11:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-151002",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:7" align="right">comment:7</div>

You are correct, I tend to mess up the markup every now and then... ;-)
Code still looks good, test still pass, and patchbot seems happy, so positive review!



---

archive/issue_comments_151003.json:
```json
{
    "body": "Merged: **sage-5.2.beta1**",
    "created_at": "2012-07-07T22:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/13166#issuecomment-151003",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.2.beta1**



---

archive/issue_events_183050.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183050"
}
```



---

archive/issue_events_183051.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/13166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/13166#event-183051"
}
```
