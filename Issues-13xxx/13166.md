# Issue 13166: Compute q-binomial coefficients more efficiently

archive/issues_012994.json:
```json
{
    "body": "Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.\n\nBefore:\n\n```\nsage: from sage.combinat.q_analogues import *\nsage: %timeit q_binomial(18,7)\n125 loops, best of 3: 1.89 ms per loop\nsage: %timeit q_binomial(180,70)\n5 loops, best of 3: 1.4 s per loop\n```\n\nAfter:\n\n```\nsage: from sage.combinat.q_analogues import *\nsage: %timeit q_binomial(18,7)\n125 loops, best of 3: 2.01 ms per loop\nsage: %timeit q_binomial2(180,70)\n25 loops, best of 3: 34.7 ms per loop\n```\n\nApply [attachment:trac_13166_q_binomials.patch] and [attachment:trac_13166_q_binomials_reference.patch]\n\nAssignee: sage-combinat\n\nReviewer: Javier L\u00f3pez Pe\u00f1a\n\nAuthor: Armin Straub\n\nMerged: sage-5.2.beta1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/13166\n\n",
    "closed_at": "2012-07-07T22:31:22Z",
    "created_at": "2012-06-26T12:24:33Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.2",
    "title": "Compute q-binomial coefficients more efficiently",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13166",
    "user": "https://github.com/arminstraub"
}
```
Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.

Before:

```
sage: from sage.combinat.q_analogues import *
sage: %timeit q_binomial(18,7)
125 loops, best of 3: 1.89 ms per loop
sage: %timeit q_binomial(180,70)
5 loops, best of 3: 1.4 s per loop
```

After:

```
sage: from sage.combinat.q_analogues import *
sage: %timeit q_binomial(18,7)
125 loops, best of 3: 2.01 ms per loop
sage: %timeit q_binomial2(180,70)
25 loops, best of 3: 34.7 ms per loop
```

Apply [attachment:trac_13166_q_binomials.patch] and [attachment:trac_13166_q_binomials_reference.patch]

Assignee: sage-combinat

Reviewer: Javier López Peña

Author: Armin Straub

Merged: sage-5.2.beta1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/13166





---

archive/issue_comments_167109.json:
```json
{
    "body": "Attachment [trac_13166_q_binomials.patch](tarball://root/attachments/some-uuid/ticket13166/trac_13166_q_binomials.patch) by @arminstraub created at 2012-06-26 12:49:18",
    "created_at": "2012-06-26T12:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167109",
    "user": "https://github.com/arminstraub"
}
```

Attachment [trac_13166_q_binomials.patch](tarball://root/attachments/some-uuid/ticket13166/trac_13166_q_binomials.patch) by @arminstraub created at 2012-06-26 12:49:18



---

archive/issue_comments_167110.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,7 @@\n Before:\n \n ```\n+sage: from sage.combinat.q_analogues import *\n sage: %timeit q_binomial(18,7)\n 125 loops, best of 3: 1.89 ms per loop\n sage: %timeit q_binomial(180,70)\n@@ -12,6 +13,7 @@\n After:\n \n ```\n+sage: from sage.combinat.q_analogues import *\n sage: %timeit q_binomial(18,7)\n 125 loops, best of 3: 2.01 ms per loop\n sage: %timeit q_binomial2(180,70)\n``````\n",
    "created_at": "2012-06-26T12:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167110",
    "user": "https://github.com/arminstraub"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,7 @@
 Before:
 
 ```
+sage: from sage.combinat.q_analogues import *
 sage: %timeit q_binomial(18,7)
 125 loops, best of 3: 1.89 ms per loop
 sage: %timeit q_binomial(180,70)
@@ -12,6 +13,7 @@
 After:
 
 ```
+sage: from sage.combinat.q_analogues import *
 sage: %timeit q_binomial(18,7)
 125 loops, best of 3: 2.01 ms per loop
 sage: %timeit q_binomial2(180,70)
``````




---

archive/issue_comments_167111.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-26T12:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167111",
    "user": "https://github.com/arminstraub"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167112.json:
```json
{
    "body": "<a id='comment:3'></a>Nice! Code looks good, all tests pass. I have added a reference for the new method in the documentation, if you agree with my reviewer patch you can give this a positive review.",
    "created_at": "2012-07-03T16:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167112",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:3'></a>Nice! Code looks good, all tests pass. I have added a reference for the new method in the documentation, if you agree with my reviewer patch you can give this a positive review.



---

archive/issue_comments_167113.json:
```json
{
    "body": "<a id='comment:4'></a>patchbot: apply trac_13166_q_binomials.patch trac_13166.reviewer.patch",
    "created_at": "2012-07-03T16:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167113",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:4'></a>patchbot: apply trac_13166_q_binomials.patch trac_13166.reviewer.patch



---

archive/issue_comments_167114.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [trac_13166_q_binomials_reference.patch](tarball://root/attachments/some-uuid/ticket13166/trac_13166_q_binomials_reference.patch) by @arminstraub created at 2012-07-05 16:33:58\n\nThank you for adding a reference!\n\nI was trying to understand how docstrings in general are working... based on what I saw in other files, I have slightly modified your documentation (for instance, no double colon after REFERENCES and an underscore when citing the reference).  Please correct me if this is wrong.\n\nOther than this nitpicking, I am happy with your addition.",
    "created_at": "2012-07-05T16:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167114",
    "user": "https://github.com/arminstraub"
}
```

<a id='comment:5'></a>Attachment [trac_13166_q_binomials_reference.patch](tarball://root/attachments/some-uuid/ticket13166/trac_13166_q_binomials_reference.patch) by @arminstraub created at 2012-07-05 16:33:58

Thank you for adding a reference!

I was trying to understand how docstrings in general are working... based on what I saw in other files, I have slightly modified your documentation (for instance, no double colon after REFERENCES and an underscore when citing the reference).  Please correct me if this is wrong.

Other than this nitpicking, I am happy with your addition.



---

archive/issue_comments_167115.json:
```json
{
    "body": "<a id='comment:6'></a>patchbot: apply trac_13166_q_binomials.patch trac_13166_q_binomials_reference.patch",
    "created_at": "2012-07-05T16:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167115",
    "user": "https://github.com/arminstraub"
}
```

<a id='comment:6'></a>patchbot: apply trac_13166_q_binomials.patch trac_13166_q_binomials_reference.patch



---

archive/issue_comments_167116.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.\n \n+Before:\n+\n+```\n+sage: from sage.combinat.q_analogues import *\n+sage: %timeit q_binomial(18,7)\n+125 loops, best of 3: 1.89 ms per loop\n+sage: %timeit q_binomial(180,70)\n+5 loops, best of 3: 1.4 s per loop\n+```\n+\n+After:\n+\n+```\n+sage: from sage.combinat.q_analogues import *\n+sage: %timeit q_binomial(18,7)\n+125 loops, best of 3: 2.01 ms per loop\n+sage: %timeit q_binomial2(180,70)\n+25 loops, best of 3: 34.7 ms per loop\n+```\n+\n+Apply [attachment:trac_13166_q_binomials.patch] and [attachment:trac_13166_q_binomials_reference.patch]\n \n Author: Armin Straub\n \n``````\n",
    "created_at": "2012-07-06T11:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167116",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,26 @@
+Currently, q-binomials are calculated as a fraction of products of q-integers.  With the attached patch, q-binomials are computed as a product of cyclotomic polynomials.  This avoids reducing a fraction of polynomials and is significantly faster for larger q-binomial coefficients.
 
+Before:
+
+```
+sage: from sage.combinat.q_analogues import *
+sage: %timeit q_binomial(18,7)
+125 loops, best of 3: 1.89 ms per loop
+sage: %timeit q_binomial(180,70)
+5 loops, best of 3: 1.4 s per loop
+```
+
+After:
+
+```
+sage: from sage.combinat.q_analogues import *
+sage: %timeit q_binomial(18,7)
+125 loops, best of 3: 2.01 ms per loop
+sage: %timeit q_binomial2(180,70)
+25 loops, best of 3: 34.7 ms per loop
+```
+
+Apply [attachment:trac_13166_q_binomials.patch] and [attachment:trac_13166_q_binomials_reference.patch]
 
 Author: Armin Straub
 
``````




---

archive/issue_comments_167117.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-06T11:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167117",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167118.json:
```json
{
    "body": "<a id='comment:7'></a>You are correct, I tend to mess up the markup every now and then... ;-)\nCode still looks good, test still pass, and patchbot seems happy, so positive review!",
    "created_at": "2012-07-06T11:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167118",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:7'></a>You are correct, I tend to mess up the markup every now and then... ;-)
Code still looks good, test still pass, and patchbot seems happy, so positive review!



---

archive/issue_comments_167119.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-07-07T22:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13166#issuecomment-167119",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_036279.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-07T22:31:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13166#event-36279"
}
```
