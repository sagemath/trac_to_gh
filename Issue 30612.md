# Issue 30612: Make gcd/lcm interact nicely with pari

Issue created by migration from https://trac.sagemath.org/ticket/30849

Original creator: vdelecroix

Original creation time: 2020-11-02 08:54:29

Pari integers are not accepted in `gcd`/`lcm` method of `Integer`

```
sage: 4.lcm(pari(5))
Traceback (most recent call last):
...
TypeError: unsupported operand parent(s) for lcm: 'Integer Ring' and '<class 'cypari2.gen.Gen'>'
```


The `gcd`/`lcm` functions are non-commutative

```
sage: type(lcm(2, pari(3)))
<class 'sage.rings.integer.Integer'>
sage: type(lcm(pari(3), 2))
<class 'cypari2.gen.Gen'>
```



---

Comment by vdelecroix created at 2020-11-02 10:09:35

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2020-11-02 10:09:35

New commits:


---

Comment by vdelecroix created at 2020-11-02 10:09:35

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by vdelecroix created at 2020-11-02 10:14:51

Changing component from packages: standard to basic arithmetic.


---

Comment by mmezzarobba created at 2020-11-05 09:16:22

LGTM. Some remarks though:
* I wonder if `py_scalar_to_element()` should not handle `cypari2` objects, or even try calling the `sage()` method of its argument before giving up.
* I am not convinced that it is worth doing a type test before calling `py_scalar_to_element()`.
* After your changes, `gcd()` is defined at the level of PID elements, but PID elements other than integers still override it with their own `gcd()` method instead of implementing `_gcd()`. Should more of the existing `gcd()` be changed to `_gcd()`?


---

Comment by mmezzarobba created at 2020-11-05 09:16:22

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2020-11-05 09:47:18

Replying to [comment:7 mmezzarobba]:
> LGTM.

Thanks

> Some remarks though:
> * I wonder if `py_scalar_to_element()` should not handle `cypari2` objects, or even try calling the `sage()` method of its argument before giving up.

Yep, I also hesitated. The reason why I did not do it because coercion works with types (all pari objects are `class Gen`) and the friend `py_scalar_parent` has input is a type. This might create confusion. To my mind, `py_scalar_to_element` is not specified enough on what it tries to achieve.

> * I am not convinced that it is worth doing a type test before calling `py_scalar_to_element()`.
> * After your changes, `gcd()` is defined at the level of PID elements, but PID elements other than integers still override it with their own `gcd()` method instead of implementing `_gcd()`. Should more of the existing `gcd()` be changed to `_gcd()`?

I believe so. But this project needs more care than what I wanted to fix.


---

Comment by chapoton created at 2020-11-05 12:45:43

reviewer name missing


---

Comment by vbraun created at 2020-11-22 15:06:20

Resolution: fixed
