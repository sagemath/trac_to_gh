# Issue 16322: Brouwer-Van Rees version of Wilson's decomposition

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2014-06-26 20:29:51

CC:  vdelecroix knsam dimpase brett

Heeeeeere it is !

What we need now is something to use it with `:-P`

Nathann


---

Comment by ncohen created at 2014-06-26 20:30:05

Changing status from new to needs_review.


---

Comment by git created at 2014-06-26 20:30:33

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by vdelecroix created at 2014-06-28 14:42:28

Hi Nathann,

- Could we get rid of `simple_wilson_construction` from #16535 in this ticket or should I open a new one?

- You should provide at least a possibly stupid but non-trivial example of the new construction.

Vincent


---

Comment by vdelecroix created at 2014-06-28 14:42:28

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-06-28 15:20:22

Yo !

> - Could we get rid of `simple_wilson_construction` from #16535 in this ticket or should I open a new one?

Be careful, this ticket only depends on #16500 as it was meant to be very local. If you want to touch other parts of the file you should base the changes higher in the patch stack.

> - You should provide at least a possibly stupid but non-trivial example of the new construction.

Are all applications of Wilson's theorem that we have in Sage at the moment "trivial" ? Because that function handles them all `:-P`

The thing is that it is not possible to use this construction for as long as `incomplete_orthogonal_arrays` does not handle holes of size >1.

Nathann


---

Comment by ncohen created at 2014-06-28 15:23:32

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2014-06-28 15:28:26

Replying to [comment:4 ncohen]:
> > - You should provide at least a possibly stupid but non-trivial example of the new construction.
> 
> Are all applications of Wilson's theorem that we have in Sage at the moment "trivial" ? Because that function handles them all `:-P`
> 
> The thing is that it is not possible to use this construction for as long as `incomplete_orthogonal_arrays` does not handle holes of size >1.

You can provide the OA explicitly. I mean: as it is, the function gives nothing new! Or more precisely, it does but only in principle... the only current positive effect is to slow down the Wilson construction!

I really think that it is a good thing to have. But with no application in mind it is a bit premature. I will try to build a non-already existing example from the Brouwer-Van Rees paper.

Vincent


---

Comment by ncohen created at 2014-06-28 15:39:59

> You can provide the OA explicitly.

I can provide the `OA` to `wilson_decomposition`, but it will require a OA with holes of size >1 and for this the code will call `incomplete_orthogonal_array`.

> I mean: as it is, the function gives nothing new! Or more precisely, it does but only in principle... the only current positive effect is to slow down the Wilson construction!

Right now it cannot help us compute new designs, indeed. Later, when we will have ways to compute holes of size `>1`, we will be able to use it. I don't work miracles, man. I can just implement constructions. And you can help me by making the `incomplete_orthogonal_arrays` function return OA with bigger holes.

> I really think that it is a good thing to have. But with no application in mind it is a bit premature.

And so what ?... You refuse the patch because of that ?... What do we earn by doing that ?..

Nathann


---

Comment by vdelecroix created at 2014-06-28 16:24:18

You do not need a function to build an incomplete array. Here is the `OA(4,6)-OA(4,2)` from Horton

```
OA = [
[1,1,5,1],[1,2,6,2],[1,3,3,5],[1,4,4,6],[1,5,1,3],[1,6,2,4],
[2,1,2,6],[2,2,1,5],[2,3,6,1],[2,4,5,2],[2,5,3,4],[2,6,4,3],
[3,1,6,4],[3,2,5,3],[3,3,1,6],[3,4,2,5],[3,5,4,1],[3,6,3,2],
[4,1,4,5],[4,2,3,6],[4,3,5,4],[4,4,6,3],[4,5,2,2],[4,6,1,1],
[5,1,1,2],[5,2,4,4],[5,3,2,3],[5,4,3,1],
[6,1,3,3],[6,2,2,1],[6,3,4,2],[6,4,1,4]]
```



---

Comment by ncohen created at 2014-06-28 16:27:52

This is not sufficient, the holed OA must be returned by the `incomplete_orthogonal_array` function.

Nathann


---

Comment by vdelecroix created at 2014-06-29 11:01:47

Hi Nathann,

The feature is cool, the doc is especially nice but I am not comfortable by letting it goes before having more IOA. Could we try adding few examples of IOA and put this one on top?

Vincent


---

Comment by ncohen created at 2014-06-29 17:39:44

Let's do that, then ...

Nathann


---

Comment by ncohen created at 2014-08-29 07:27:29

And noooooowwwwwww that's hell to rebase `-_-`


---

Comment by git created at 2014-08-29 07:37:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by ncohen created at 2014-08-29 11:06:47

Now with a real example. It is an OA that Sage cannot build yet, but I will need to do a couple of things before it is made automatic. And I am a bit scared of the performances of the future `find_wilson` function that will also handle the Brouwer-van Rees generalization.

Nathann


---

Comment by git created at 2014-08-29 11:11:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-09-02 12:01:13

Here is an additional commit that gives a correct error message when `incomplete_orthogonal_array` cannot build what we need.

I also changed the example for the Brouwer-van Rees construction. While it works, it is a bit sad that it only gives an `OA(5,256)` `:-PPPP`

Anyway...

Nathann


---

Comment by git created at 2014-09-02 12:01:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-09-02 17:20:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-17 18:12:37

I got doctest failure with the development version

```
File "orthogonal_arrays.py", line 565, in sage.combinat.designs.orthogonal_arrays.wilson_construction
Failed example:
    OA = designs.orthogonal_array(6,11)
Expected nothing
Got:
    doctest:1: DeprecationWarning: This function will soon be removed. Use the designs.orthogonal_arrays.* functions instead
    See http://trac.sagemath.org/17034 for details.
```

and

```
File "orthogonal_arrays.py", line 567, in sage.combinat.designs.orthogonal_arrays.wilson_construction
Failed example:
    OAb = wilson_construction(OA,5,11,21,[This is the Trac macro ** that was inherited from the migration called with arguments (5,5))](https://trac.sagemath.org/wiki/WikiMacros#-macro))
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.orthogonal_arrays.wilson_construction[10]>", line 1, in <module>
        OAb = wilson_construction(OA,Integer(5),Integer(11),Integer(21),[This is the Trac macro ** that was inherited from the migration called with arguments (Integer)](https://trac.sagemath.org/wiki/WikiMacros#-macro))
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py", line 615, in wilson_construction
        profile) for profile in block_profiles}
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py", line 615, in <dictcomp>
        profile) for profile in block_profiles}
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py", line 1240, in incomplete_orthogonal_array
        elif x==1 and any(uu==y and mu<=1 and lmbda==1 and k<=kk+1 for (nn,kk,lmbda,mu,uu) in QDM.get((n,1),[])):
      File "/opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py", line 1240, in <genexpr>
        elif x==1 and any(uu==y and mu<=1 and lmbda==1 and k<=kk+1 for (nn,kk,lmbda,mu,uu) in QDM.get((n,1),[])):
    ValueError: need more than 4 values to unpack
```


Vincent


---

Comment by vdelecroix created at 2014-10-17 18:12:37

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-10-18 14:38:23

Sorry about that. I just fixed it.

Nathann


---

Comment by ncohen created at 2014-10-18 14:38:23

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-10-18 14:39:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-18 16:37:28

Hi Nathann,

Stupid bugfix for the doc in my commit.

Do you mind if I allow to have `OA=None` in wilson construction and move the code from `simple_wilson_construction` (in `find_orthogonal_array_build.py`) to `wilson_construction` (in `orthogonal_array.py`). It should be fine with your next tickets, but in the future we should get rid of `simple_wilson_construction`.

Vincent
----
New commits:


---

Comment by vdelecroix created at 2014-10-18 16:37:28

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-10-18 19:57:45

Yo !

> Do you mind if I allow to have `OA=None` in wilson construction and move the code from `simple_wilson_construction` (in `find_orthogonal_array_build.py`) to `wilson_construction` (in `orthogonal_array.py`). It should be fine with your next tickets, but in the future we should get rid of `simple_wilson_construction`.

No problem, this function is not very complicated at the moment anyway !

Nathann


---

Comment by git created at 2014-10-20 16:43:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-20 16:58:52

Hi Nathann,

I moved the code of `simple_wilson_construction` to `wilson_construction`. I had not enough energy to make the explanations for the Brouwer van Rees construction... so it is currently a `NotImplementedError`.

I am happy with the current version, but it would be better to add one line for the explanations.

Vincent


---

Comment by vdelecroix created at 2014-10-20 17:00:51

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2014-10-21 14:16:16

Hello,

You do not have to deprecate this function, it can be removed. It is only internal stuff, not really meant to be called directly.

Nathann


---

Comment by git created at 2014-10-21 16:45:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-10-21 17:44:59

I merged your two commits into one and added one with the description. If that's okay for you, ...

Nathann


---

Comment by git created at 2014-10-21 17:45:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-21 18:29:31

Good to go!

Vincent


---

Comment by vdelecroix created at 2014-10-21 18:29:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-23 11:19:56

Resolution: fixed
