# Issue 17946: Implement two matroid polytopes

archive/issues_017946.json:
```json
{
    "body": "Keywords: matroid polytope\n\nTo a matroid one can associate two polytopes.\n\n- one with bases as vertices\n- one with indep. sets as vertices\nThe former is a facet of the latter.\n\nHere is an implementation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18183\n\n",
    "created_at": "2015-04-14T08:16:40Z",
    "labels": [
        "component: matroid theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Implement two matroid polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17946",
    "user": "https://github.com/fchapoton"
}
```
Keywords: matroid polytope

To a matroid one can associate two polytopes.

- one with bases as vertices
- one with indep. sets as vertices
The former is a facet of the latter.

Here is an implementation.

Issue created by migration from https://trac.sagemath.org/ticket/18183





---

archive/issue_comments_240811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-14T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240811",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_240812.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-14T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240812",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_240813.json:
```json
{
    "body": "Nice commit message ;-) You know that you can modify it afterwards by doing\n\n```\ngit commit --amend\n```\n",
    "created_at": "2015-04-14T09:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240813",
    "user": "https://github.com/videlec"
}
```

Nice commit message ;-) You know that you can modify it afterwards by doing

```
git commit --amend
```




---

archive/issue_comments_240814.json:
```json
{
    "body": "Could you add a link to the published version of the article http://link.springer.com/article/10.1007%2Fs00454-008-9080-z (and keep the arXiv one)?\n\nIsn't there any interesting feature of these polytopes that would be cool to have in the documentation? Right now you only show that you can construct them... not very fancy.\n\nCode looks good otherwise.\n\nVincent",
    "created_at": "2015-04-14T09:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240814",
    "user": "https://github.com/videlec"
}
```

Could you add a link to the published version of the article http://link.springer.com/article/10.1007%2Fs00454-008-9080-z (and keep the arXiv one)?

Isn't there any interesting feature of these polytopes that would be cool to have in the documentation? Right now you only show that you can construct them... not very fancy.

Code looks good otherwise.

Vincent



---

archive/issue_comments_240815.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-14T09:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240815",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-14T09:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240817.json:
```json
{
    "body": "Thanks for having a look.\n\nI have added the publication data, and the doi\n\nI have nothing fancy to add in the doctest, sorry.\n\nIf we had the Ehrhart polynomial, we could check that their coeffs are positive..",
    "created_at": "2015-04-14T10:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240817",
    "user": "https://github.com/fchapoton"
}
```

Thanks for having a look.

I have added the publication data, and the doi

I have nothing fancy to add in the doctest, sorry.

If we had the Ehrhart polynomial, we could check that their coeffs are positive..



---

archive/issue_comments_240818.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-14T10:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240818",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240819.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> Thanks for having a look.\n> \n> I have added the publication data, and the doi\n> \n> I have nothing fancy to add in the doctest, sorry.\n> \n> If we had the Ehrhart polynomial, we could check that their coeffs are positive..\n\nWe do! This is in Latte (see #15180).\n\n1. do `sage -i latte_int`\n\n2. \n\n```\ndef latte_input_file(P, filename='/tmp/latte.in'):\n    assert P.n_equations() == 0\n    f = open(filename, 'w')\n    f.write(\"{} {}\\n\".format(P.n_inequalities(), P.ambient_dim()+1))\n    for l in P.inequality_generator():\n        f.write(' '.join(map(str,l)))\n        f.write('\\n')\n    f.close()\n```\n\n\n3. Then generate the file with the above code and run\n\n```\n $ sage -sh\n $ count --ehrhart-polynomial /tmp/latte.in\n ...\n Ehrhart polynomial:  + 1 * t^0 + 3 * t^1 + 3 * t^2 + 1 * t^3\n $ exit\n```\n\n\nWould be really cool to have that properly interfaced within Sage!\n\nVincent",
    "created_at": "2015-04-14T10:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240819",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:6 chapoton]:
> Thanks for having a look.
> 
> I have added the publication data, and the doi
> 
> I have nothing fancy to add in the doctest, sorry.
> 
> If we had the Ehrhart polynomial, we could check that their coeffs are positive..

We do! This is in Latte (see #15180).

1. do `sage -i latte_int`

2. 

```
def latte_input_file(P, filename='/tmp/latte.in'):
    assert P.n_equations() == 0
    f = open(filename, 'w')
    f.write("{} {}\n".format(P.n_inequalities(), P.ambient_dim()+1))
    for l in P.inequality_generator():
        f.write(' '.join(map(str,l)))
        f.write('\n')
    f.close()
```


3. Then generate the file with the above code and run

```
 $ sage -sh
 $ count --ehrhart-polynomial /tmp/latte.in
 ...
 Ehrhart polynomial:  + 1 * t^0 + 3 * t^1 + 3 * t^2 + 1 * t^3
 $ exit
```


Would be really cool to have that properly interfaced within Sage!

Vincent



---

archive/issue_comments_240820.json:
```json
{
    "body": "Algorithmicaly it looks a bit weird to do something like that:\n\n\n```\nvertices = [ambient.sum(vector_e[convert[i]] for i in IS)\n            for r in range(self.full_rank() + 1)\n            for IS in self.independent_r_sets(r)]\n```\n\n\nYou enumerate the 'r+1' independent sets without using the information you got from the sets of order 'r'.\n\nI don't know if it can be useful here, but there is something *very* related in Sage:\n\nhttp://www.sagemath.org/doc/reference/combinat/sage/combinat/subsets_hereditary.html\n\nNathann\n\nP.S.:\n\n\n```\n+        REFERENCE:\n+\n+        [DLHK2007]_\n```\n",
    "created_at": "2015-04-14T12:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240820",
    "user": "https://github.com/nathanncohen"
}
```

Algorithmicaly it looks a bit weird to do something like that:


```
vertices = [ambient.sum(vector_e[convert[i]] for i in IS)
            for r in range(self.full_rank() + 1)
            for IS in self.independent_r_sets(r)]
```


You enumerate the 'r+1' independent sets without using the information you got from the sets of order 'r'.

I don't know if it can be useful here, but there is something *very* related in Sage:

http://www.sagemath.org/doc/reference/combinat/sage/combinat/subsets_hereditary.html

Nathann

P.S.:


```
+        REFERENCE:
+
+        [DLHK2007]_
```




---

archive/issue_comments_240821.json:
```json
{
    "body": "Well, I see your point. The true problem is that there is no `independent_sets` method for matroids.\n\nwhat do you mean about the ref ?",
    "created_at": "2015-04-14T12:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240821",
    "user": "https://github.com/fchapoton"
}
```

Well, I see your point. The true problem is that there is no `independent_sets` method for matroids.

what do you mean about the ref ?



---

archive/issue_comments_240822.json:
```json
{
    "body": "Hellooooooooo,\n\n> Well, I see your point. The true problem is that there is no `independent_sets` method for matroids.\n\nYou can get one like that:\n\n\n```\ndef independent_sets_iterator(M):\n    from sage.combinat.subsets_hereditary import subsets_with_hereditary_property\n    for x in subsets_with_hereditary_property(M.is_independent,M.groundset()):\n        yield x\n```\n\n\nDisclaimers:\n\n- It is a 'fake' iterator, i.e. the amount of memory it requires is far from\n  constant. It does not store all bases at once, but you will store at some\n  point the 'independent sets of size r or r+1' for every r\n\n- I have no idea if the method is optimal algorithmically. It is meant to work\n  for any 'hereditary' function (a property verified by\n  `Matroid.is_independent`), and in particular does not use any property of\n  matroids\n\n- I suspect that it is asymptotically faster than what you do right now. The\n  matroid algorithm to enumerate all independent sets of size 'r' is to try all\n  'r'-subset and run a `is_independent` test.\n\n- This implementation is at a much higher level than the Matroid\n  implementation: the matroid code works on bitsets, while\n  `subsets_with_hereditary_property` works on lists of arbitrary objects. There\n  is a (possibly big) loss of time there.\n\n- There is a nice customization inside of `subsets_with_hereditary_property`,\n  which is why I implemented this function: if it detects that `{a,b,c}` is not\n  an independent set it will never try a superset of `{a,b,c}` again (this is\n  achieved through some caching of the answers of the test function.\n\n> what do you mean about the ref ?\n\nOh sorry. I thought that it was a half-finishef entry, I had not noticed that\nyou were only refering to another one (which is properly written).\n\nNathann",
    "created_at": "2015-04-14T12:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240822",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooooo,

> Well, I see your point. The true problem is that there is no `independent_sets` method for matroids.

You can get one like that:


```
def independent_sets_iterator(M):
    from sage.combinat.subsets_hereditary import subsets_with_hereditary_property
    for x in subsets_with_hereditary_property(M.is_independent,M.groundset()):
        yield x
```


Disclaimers:

- It is a 'fake' iterator, i.e. the amount of memory it requires is far from
  constant. It does not store all bases at once, but you will store at some
  point the 'independent sets of size r or r+1' for every r

- I have no idea if the method is optimal algorithmically. It is meant to work
  for any 'hereditary' function (a property verified by
  `Matroid.is_independent`), and in particular does not use any property of
  matroids

- I suspect that it is asymptotically faster than what you do right now. The
  matroid algorithm to enumerate all independent sets of size 'r' is to try all
  'r'-subset and run a `is_independent` test.

- This implementation is at a much higher level than the Matroid
  implementation: the matroid code works on bitsets, while
  `subsets_with_hereditary_property` works on lists of arbitrary objects. There
  is a (possibly big) loss of time there.

- There is a nice customization inside of `subsets_with_hereditary_property`,
  which is why I implemented this function: if it detects that `{a,b,c}` is not
  an independent set it will never try a superset of `{a,b,c}` again (this is
  achieved through some caching of the answers of the test function.

> what do you mean about the ref ?

Oh sorry. I thought that it was a half-finishef entry, I had not noticed that
you were only refering to another one (which is properly written).

Nathann



---

archive/issue_comments_240823.json:
```json
{
    "body": "It seems that the current branch is slightly faster.. \n\n```\nsage: M=matroids.named_matroids.Q10()\nsage: %timeit  P = M.independence_matroid_polytope()\n10 loops, best of 3: 135 ms per loop\n```\n\ncompared to the one using your iterator:\n\n```\nsage: M=matroids.named_matroids.Q10()\nsage: %timeit  P = M.independence_matroid_polytope()\n10 loops, best of 3: 143 ms per loop\n```\n\nSo I propose to let to another ticket the work to have a proper independent_sets method.",
    "created_at": "2015-04-14T12:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240823",
    "user": "https://github.com/fchapoton"
}
```

It seems that the current branch is slightly faster.. 

```
sage: M=matroids.named_matroids.Q10()
sage: %timeit  P = M.independence_matroid_polytope()
10 loops, best of 3: 135 ms per loop
```

compared to the one using your iterator:

```
sage: M=matroids.named_matroids.Q10()
sage: %timeit  P = M.independence_matroid_polytope()
10 loops, best of 3: 143 ms per loop
```

So I propose to let to another ticket the work to have a proper independent_sets method.



---

archive/issue_events_051433.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-15T06:38:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17946#event-51433"
}
```



---

archive/issue_comments_240824.json:
```json
{
    "body": "Hum. I did have a look at matroids `independent_r_sets` method. And the way to generate all independent set is to generate all sets and filter those which are independent... really!\n\n```\nres = []\nfor X in combinations(self.groundset(), r):\n    X = frozenset(X)\n    if self._rank(X) == len(X):\n        res.append(X)\n    return res\n```\n",
    "created_at": "2015-04-15T08:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240824",
    "user": "https://github.com/videlec"
}
```

Hum. I did have a look at matroids `independent_r_sets` method. And the way to generate all independent set is to generate all sets and filter those which are independent... really!

```
res = []
for X in combinations(self.groundset(), r):
    X = frozenset(X)
    if self._rank(X) == len(X):
        res.append(X)
    return res
```




---

archive/issue_comments_240825.json:
```json
{
    "body": "This is the reason why I believe that the `independent_sets_iterator` I mentionned above will be asymptotically faster.",
    "created_at": "2015-04-15T08:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240825",
    "user": "https://github.com/nathanncohen"
}
```

This is the reason why I believe that the `independent_sets_iterator` I mentionned above will be asymptotically faster.



---

archive/issue_comments_240826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-15T09:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240826",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240827.json:
```json
{
    "body": "This ticket is good to go!\n\nI will try to implement something more serious for independent sets in matroids. The proposition of Nathann is not ideal since we do not want to store the \"no sets\" in the iteration. The boolean function is cheap in the present case.",
    "created_at": "2015-04-15T09:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240827",
    "user": "https://github.com/videlec"
}
```

This ticket is good to go!

I will try to implement something more serious for independent sets in matroids. The proposition of Nathann is not ideal since we do not want to store the "no sets" in the iteration. The boolean function is cheap in the present case.



---

archive/issue_comments_240828.json:
```json
{
    "body": "> I will try to implement something more serious for independent sets in matroids. The proposition of Nathann is not ideal since we do not want to store the \"no sets\" in the iteration. The boolean function is cheap in the present case.\n\nYou do store them, but you store one bit for each of them. So it is not terribly large either. Why are you sure that the function is cheap in this case by the way?\n\nNathann",
    "created_at": "2015-04-15T09:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240828",
    "user": "https://github.com/nathanncohen"
}
```

> I will try to implement something more serious for independent sets in matroids. The proposition of Nathann is not ideal since we do not want to store the "no sets" in the iteration. The boolean function is cheap in the present case.

You do store them, but you store one bit for each of them. So it is not terribly large either. Why are you sure that the function is cheap in this case by the way?

Nathann



---

archive/issue_comments_240829.json:
```json
{
    "body": "err. Not 'one bit for each of them'. One bit for all inclusionwise minimal no-sets. Actually, I'd be ready to bet that storing all independent sets of size r is more expensive that that already.",
    "created_at": "2015-04-15T09:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240829",
    "user": "https://github.com/nathanncohen"
}
```

err. Not 'one bit for each of them'. One bit for all inclusionwise minimal no-sets. Actually, I'd be ready to bet that storing all independent sets of size r is more expensive that that already.



---

archive/issue_events_051434.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-15T13:58:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17946#event-51434"
}
```



---

archive/issue_comments_240830.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-15T13:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17946#issuecomment-240830",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
