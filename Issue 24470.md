# Issue 24470: fpylll ignores --stdlib directive

archive/issues_024470.json:
```json
{
    "body": "CC:  @malb\n\nIf \"`--stdlib=libc++`\" is given in the CXX environment var, fpylll will add it only with C compilations not C++. This leads to libstdc++ being linked and import errors with fpylll.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24707\n\n",
    "created_at": "2018-02-11T08:18:47Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "fpylll ignores --stdlib directive",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24470",
    "user": "https://github.com/rwst"
}
```
CC:  @malb

If "`--stdlib=libc++`" is given in the CXX environment var, fpylll will add it only with C compilations not C++. This leads to libstdc++ being linked and import errors with fpylll.

Issue created by migration from https://trac.sagemath.org/ticket/24707





---

archive/issue_comments_342950.json:
```json
{
    "body": "Can you provide a build log please.",
    "created_at": "2018-02-11T08:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342950",
    "user": "https://github.com/kiwifb"
}
```

Can you provide a build log please.



---

archive/issue_comments_342951.json:
```json
{
    "body": "Is it fplll-5.2.0.p1.log? In other words, is fpylll a typo, or a different package?\n\nAnyway, I posted a fplll log resulting from building Sage with clange [here](http://users.minet.uni-jena.de/cohomology/logs/fplll-5.2.0.p1.log).",
    "created_at": "2018-02-11T08:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342951",
    "user": "https://github.com/simon-king-jena"
}
```

Is it fplll-5.2.0.p1.log? In other words, is fpylll a typo, or a different package?

Anyway, I posted a fplll log resulting from building Sage with clange [here](http://users.minet.uni-jena.de/cohomology/logs/fplll-5.2.0.p1.log).



---

archive/issue_comments_342952.json:
```json
{
    "body": "Attachment [fpylll-0.3.0dev.p0.log](tarball://root/attachments/some-uuid/ticket24707/fpylll-0.3.0dev.p0.log) by @dimpase created at 2018-02-11 09:46:48",
    "created_at": "2018-02-11T09:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342952",
    "user": "https://github.com/dimpase"
}
```

Attachment [fpylll-0.3.0dev.p0.log](tarball://root/attachments/some-uuid/ticket24707/fpylll-0.3.0dev.p0.log) by @dimpase created at 2018-02-11 09:46:48



---

archive/issue_comments_342953.json:
```json
{
    "body": "reported upstream: https://github.com/fplll/fpylll/issues/115",
    "created_at": "2018-02-11T10:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342953",
    "user": "https://github.com/dimpase"
}
```

reported upstream: https://github.com/fplll/fpylll/issues/115



---

archive/issue_comments_342954.json:
```json
{
    "body": "While fpylll seems to build (on my machine, with `CC=clang CXX=\"clang++ -I/usr/include/libcxxabi/ --stdlib=libc++\" make`), I got a build error in ratpoints and opened #24708 for it.",
    "created_at": "2018-02-11T10:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342954",
    "user": "https://github.com/simon-king-jena"
}
```

While fpylll seems to build (on my machine, with `CC=clang CXX="clang++ -I/usr/include/libcxxabi/ --stdlib=libc++" make`), I got a build error in ratpoints and opened #24708 for it.



---

archive/issue_comments_342955.json:
```json
{
    "body": "Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?",
    "created_at": "2018-02-11T12:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342955",
    "user": "https://github.com/malb"
}
```

Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?



---

archive/issue_comments_342956.json:
```json
{
    "body": "Replying to [comment:8 malb]:\n> Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?\n\nI think so, yes. At least that is their usage, as I see it now---`stdlib=libc++` as compile flag to get the right include files, and `-lc++ --stdlib=libc++` to get the file to link and prevent libstdc++ from being linked.",
    "created_at": "2018-02-11T13:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342956",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:8 malb]:
> Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?

I think so, yes. At least that is their usage, as I see it now---`stdlib=libc++` as compile flag to get the right include files, and `-lc++ --stdlib=libc++` to get the file to link and prevent libstdc++ from being linked.



---

archive/issue_comments_342957.json:
```json
{
    "body": "However CXX may need to be set to `clang++ --stdlib=libc++` as well. I see a lot of compile commands in the logs ignoring CXXFLAGS (ppl, gfan...)",
    "created_at": "2018-02-11T14:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342957",
    "user": "https://github.com/rwst"
}
```

However CXX may need to be set to `clang++ --stdlib=libc++` as well. I see a lot of compile commands in the logs ignoring CXXFLAGS (ppl, gfan...)



---

archive/issue_comments_342958.json:
```json
{
    "body": "Thanks, does fpylll also fail to pass through `CXXFLAGS` and `LDFLAGS`?",
    "created_at": "2018-02-11T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342958",
    "user": "https://github.com/malb"
}
```

Thanks, does fpylll also fail to pass through `CXXFLAGS` and `LDFLAGS`?



---

archive/issue_comments_342959.json:
```json
{
    "body": "See also #24710. We need `--stdlib=libc++` in the CXXFLAGS but this makes gfortran fail.",
    "created_at": "2018-02-11T15:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342959",
    "user": "https://github.com/rwst"
}
```

See also #24710. We need `--stdlib=libc++` in the CXXFLAGS but this makes gfortran fail.



---

archive/issue_comments_342960.json:
```json
{
    "body": "Correction, we need it in LDFLAGS. I'm a bit frustrated.",
    "created_at": "2018-02-11T15:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342960",
    "user": "https://github.com/rwst"
}
```

Correction, we need it in LDFLAGS. I'm a bit frustrated.



---

archive/issue_comments_342961.json:
```json
{
    "body": "Replying to [comment:6 dimpase]:\n> reported upstream: https://github.com/fplll/fpylll/issues/115\n\nThanks. I explained there that there is now a solution, i.e. to put the string in LDFLAGS.",
    "created_at": "2018-02-11T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342961",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:6 dimpase]:
> reported upstream: https://github.com/fplll/fpylll/issues/115

Thanks. I explained there that there is now a solution, i.e. to put the string in LDFLAGS.



---

archive/issue_comments_342962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-11T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342962",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342963.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-11T16:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342963",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342964.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2018-02-12T09:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-342964",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: invalid
