# Issue 24470: fpylll ignores --stdlib directive

archive/issues_024470.json:
```json
{
    "body": "CC:  malb\n\nIf \"`--stdlib=libc++`\" is given in the CXX environment var, fpylll will add it only with C compilations not C++. This leads to libstdc++ being linked and import errors with fpylll.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24707\n\n",
    "created_at": "2018-02-11T08:18:47Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "fpylll ignores --stdlib directive",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24470",
    "user": "rws"
}
```
CC:  malb

If "`--stdlib=libc++`" is given in the CXX environment var, fpylll will add it only with C compilations not C++. This leads to libstdc++ being linked and import errors with fpylll.

Issue created by migration from https://trac.sagemath.org/ticket/24707





---

archive/issue_comments_343332.json:
```json
{
    "body": "Can you provide a build log please.",
    "created_at": "2018-02-11T08:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343332",
    "user": "fbissey"
}
```

Can you provide a build log please.



---

archive/issue_comments_343333.json:
```json
{
    "body": "Is it fplll-5.2.0.p1.log? In other words, is fpylll a typo, or a different package?\n\nAnyway, I posted a fplll log resulting from building Sage with clange [here](http://users.minet.uni-jena.de/cohomology/logs/fplll-5.2.0.p1.log).",
    "created_at": "2018-02-11T08:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343333",
    "user": "SimonKing"
}
```

Is it fplll-5.2.0.p1.log? In other words, is fpylll a typo, or a different package?

Anyway, I posted a fplll log resulting from building Sage with clange [here](http://users.minet.uni-jena.de/cohomology/logs/fplll-5.2.0.p1.log).



---

archive/issue_comments_343334.json:
```json
{
    "body": "Attachment [fpylll-0.3.0dev.p0.log](tarball://root/attachments/some-uuid/ticket24707/fpylll-0.3.0dev.p0.log) by dimpase created at 2018-02-11 09:46:48",
    "created_at": "2018-02-11T09:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343334",
    "user": "dimpase"
}
```

Attachment [fpylll-0.3.0dev.p0.log](tarball://root/attachments/some-uuid/ticket24707/fpylll-0.3.0dev.p0.log) by dimpase created at 2018-02-11 09:46:48



---

archive/issue_comments_343335.json:
```json
{
    "body": "reported upstream: https://github.com/fplll/fpylll/issues/115",
    "created_at": "2018-02-11T10:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343335",
    "user": "dimpase"
}
```

reported upstream: https://github.com/fplll/fpylll/issues/115



---

archive/issue_comments_343336.json:
```json
{
    "body": "While fpylll seems to build (on my machine, with `CC=clang CXX=\"clang++ -I/usr/include/libcxxabi/ --stdlib=libc++\" make`), I got a build error in ratpoints and opened #24708 for it.",
    "created_at": "2018-02-11T10:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343336",
    "user": "SimonKing"
}
```

While fpylll seems to build (on my machine, with `CC=clang CXX="clang++ -I/usr/include/libcxxabi/ --stdlib=libc++" make`), I got a build error in ratpoints and opened #24708 for it.



---

archive/issue_comments_343337.json:
```json
{
    "body": "Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?",
    "created_at": "2018-02-11T12:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343337",
    "user": "malb"
}
```

Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?



---

archive/issue_comments_343338.json:
```json
{
    "body": "Replying to [comment:8 malb]:\n> Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?\n\nI think so, yes. At least that is their usage, as I see it now---`stdlib=libc++` as compile flag to get the right include files, and `-lc++ --stdlib=libc++` to get the file to link and prevent libstdc++ from being linked.",
    "created_at": "2018-02-11T13:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343338",
    "user": "rws"
}
```

Replying to [comment:8 malb]:
> Shouldn't those parameters be passed as `CXXFLAGS`/`LDFLAGS`?

I think so, yes. At least that is their usage, as I see it now---`stdlib=libc++` as compile flag to get the right include files, and `-lc++ --stdlib=libc++` to get the file to link and prevent libstdc++ from being linked.



---

archive/issue_comments_343339.json:
```json
{
    "body": "However CXX may need to be set to `clang++ --stdlib=libc++` as well. I see a lot of compile commands in the logs ignoring CXXFLAGS (ppl, gfan...)",
    "created_at": "2018-02-11T14:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343339",
    "user": "rws"
}
```

However CXX may need to be set to `clang++ --stdlib=libc++` as well. I see a lot of compile commands in the logs ignoring CXXFLAGS (ppl, gfan...)



---

archive/issue_comments_343340.json:
```json
{
    "body": "Thanks, does fpylll also fail to pass through `CXXFLAGS` and `LDFLAGS`?",
    "created_at": "2018-02-11T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343340",
    "user": "malb"
}
```

Thanks, does fpylll also fail to pass through `CXXFLAGS` and `LDFLAGS`?



---

archive/issue_comments_343341.json:
```json
{
    "body": "See also #24710. We need `--stdlib=libc++` in the CXXFLAGS but this makes gfortran fail.",
    "created_at": "2018-02-11T15:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343341",
    "user": "rws"
}
```

See also #24710. We need `--stdlib=libc++` in the CXXFLAGS but this makes gfortran fail.



---

archive/issue_comments_343342.json:
```json
{
    "body": "Correction, we need it in LDFLAGS. I'm a bit frustrated.",
    "created_at": "2018-02-11T15:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343342",
    "user": "rws"
}
```

Correction, we need it in LDFLAGS. I'm a bit frustrated.



---

archive/issue_comments_343343.json:
```json
{
    "body": "Replying to [comment:6 dimpase]:\n> reported upstream: https://github.com/fplll/fpylll/issues/115\n\nThanks. I explained there that there is now a solution, i.e. to put the string in LDFLAGS.",
    "created_at": "2018-02-11T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343343",
    "user": "rws"
}
```

Replying to [comment:6 dimpase]:
> reported upstream: https://github.com/fplll/fpylll/issues/115

Thanks. I explained there that there is now a solution, i.e. to put the string in LDFLAGS.



---

archive/issue_comments_343344.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-11T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343344",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343345.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-11T16:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343345",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343346.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2018-02-12T09:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24470#issuecomment-343346",
    "user": "jdemeyer"
}
```

Resolution: invalid
