# Issue 15209: GP interface confused by stack overflow when enlarging results vector

archive/issues_015209.json:
```json
{
    "body": "Keywords: gp stack overflow\n\nFrom Georgi Guninski on sage-support (https://groups.google.com/forum/#!topic/sage-support/A_GilhiUAwM):\n\n```\nsage: gp(\"{T(n)=n+1}\")\nsage: for n in [ 1 .. 2**20]:\n    a=gp.T(n)\n    print n\n\n#wait some time..\n...\n65535\n65536\n---------------------------------------------------------------------------\nTypeError\n\nTypeError: Error executing code in GP:\nCODE:\n        sage[131074]=65537;\nPARI/GP ERROR:\n  ***   at top-level: sage[131074]=65537\n  ***                     ^--------------\n  ***   array index (131074) out of allowed range [1-131073].\n```\n\nafter this trying:\n\n```\nsage: gp.T(1)\n```\n\nagain raises exception.\n\nAfter the above computation, the log file `.sage/gp-expect.log` ends with\n\n```\n? sage[131070]=65535;\nsage[131070]=65535;\n? sage[131071]=T(sage[131070]);\nsage[131071]=T(sage[131070]);\n? sage=concat(sage, vector(131072,k,0));\nsage=concat(sage, vector(131072,k,0));\n  ***   at top-level: sage=concat(sage,vec\n  ***                 ^--------------------\n  ***   the PARI stack overflows !\n  current stack size: 10000000 (9.537 Mbytes)\n  [hint] you can increase GP stack with allocatemem()\n\n? allocatemem()\nallocatemem()\n  ***   Warning: new stack size = 20000000 (19.073 Mbytes).\n? sage=concat(sage, vector(131072,k,0));\nsage=concat(sage, vector(131072,k,0));\n? sage[131072]=65536;\nsage[131072]=65536;\n? sage[131073]=T(sage[131072]);\nsage[131073]=T(sage[131072]);\n? sage[131074]=65537;\nsage[131074]=65537;\n  ***   at top-level: sage[131074]=65537\n  ***                     ^--------------\n  ***   array index (131074) out of allowed range [1-131073].\n?\n```\n\nIt appears that the vector `sage` wasn't doubled correctly; probably it got messed up by the failed `concat()`.\n\nThis could be related to #11017/#11018.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15446\n\n",
    "created_at": "2013-11-22T18:49:31Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "title": "GP interface confused by stack overflow when enlarging results vector",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15209",
    "user": "pbruin"
}
```
Keywords: gp stack overflow

From Georgi Guninski on sage-support (https://groups.google.com/forum/#!topic/sage-support/A_GilhiUAwM):

```
sage: gp("{T(n)=n+1}")
sage: for n in [ 1 .. 2**20]:
    a=gp.T(n)
    print n

#wait some time..
...
65535
65536
---------------------------------------------------------------------------
TypeError

TypeError: Error executing code in GP:
CODE:
        sage[131074]=65537;
PARI/GP ERROR:
  ***   at top-level: sage[131074]=65537
  ***                     ^--------------
  ***   array index (131074) out of allowed range [1-131073].
```

after this trying:

```
sage: gp.T(1)
```

again raises exception.

After the above computation, the log file `.sage/gp-expect.log` ends with

```
? sage[131070]=65535;
sage[131070]=65535;
? sage[131071]=T(sage[131070]);
sage[131071]=T(sage[131070]);
? sage=concat(sage, vector(131072,k,0));
sage=concat(sage, vector(131072,k,0));
  ***   at top-level: sage=concat(sage,vec
  ***                 ^--------------------
  ***   the PARI stack overflows !
  current stack size: 10000000 (9.537 Mbytes)
  [hint] you can increase GP stack with allocatemem()

? allocatemem()
allocatemem()
  ***   Warning: new stack size = 20000000 (19.073 Mbytes).
? sage=concat(sage, vector(131072,k,0));
sage=concat(sage, vector(131072,k,0));
? sage[131072]=65536;
sage[131072]=65536;
? sage[131073]=T(sage[131072]);
sage[131073]=T(sage[131072]);
? sage[131074]=65537;
sage[131074]=65537;
  ***   at top-level: sage[131074]=65537
  ***                     ^--------------
  ***   array index (131074) out of allowed range [1-131073].
?
```

It appears that the vector `sage` wasn't doubled correctly; probably it got messed up by the failed `concat()`.

This could be related to #11017/#11018.

Issue created by migration from https://trac.sagemath.org/ticket/15446





---

archive/issue_comments_195425.json:
```json
{
    "body": "The problem appears to be fixed by introducing a temporary variable to hold the result of `concat()` instead of directly assigning it to `sage`.",
    "created_at": "2014-02-18T14:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195425",
    "user": "pbruin"
}
```

The problem appears to be fixed by introducing a temporary variable to hold the result of `concat()` instead of directly assigning it to `sage`.



---

archive/issue_comments_195426.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-18T14:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195426",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195427.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-02-20T00:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195427",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_195428.json:
```json
{
    "body": "Never mind the commit in comment:3, this breaks when there are more than 65535 variables.",
    "created_at": "2014-02-20T00:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195428",
    "user": "pbruin"
}
```

Never mind the commit in comment:3, this breaks when there are more than 65535 variables.



---

archive/issue_comments_195429.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-02-20T00:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195429",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_195430.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-21T18:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195430",
    "user": "ArgaezG"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195431.json:
```json
{
    "body": "Alejandro, could you fill in your name (more precisely your real name, not Trac username) in the \"Reviewer\" field?",
    "created_at": "2014-02-21T20:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195431",
    "user": "pbruin"
}
```

Alejandro, could you fill in your name (more precisely your real name, not Trac username) in the "Reviewer" field?



---

archive/issue_comments_195432.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-22T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15209#issuecomment-195432",
    "user": "vbraun"
}
```

Resolution: fixed
