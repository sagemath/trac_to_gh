# Issue 20587: Expression.coefficient() should expand beforehand

Issue created by migration from https://trac.sagemath.org/ticket/20824

Original creator: rws

Original creation time: 2016-06-14 07:58:33

There is no reason why there should be different results:

```
sage: (x*(x*y+y^2)).coefficient(x)
y
sage: (x*(x*y+y^2)).coefficient(x,2)
0
sage: (x*(x*y+y^2)).expand().coefficient(x)
y^2
sage: (x*(x*y+y^2)).expand().coefficient(x,2)
y
```

This would also be unsurprising for Mma users, see http://trac.sagemath.org/ticket/9505#comment:6


---

Comment by rws created at 2016-08-17 13:02:13

Changing status from new to needs_review.


---

Comment by rws created at 2016-08-17 13:02:13

Changing type from defect to enhancement.


---

Comment by rws created at 2016-08-17 13:02:13

New commits:


---

Comment by mmezzarobba created at 2016-09-16 13:42:35

Hmm, I don't really see the benefit compared to `expr.expand().coefficient(...)`...


---

Comment by git created at 2017-11-09 07:19:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-03-03 16:37:22

New commits:


---

Comment by @bryangingechen created at 2018-07-28 14:17:18

I had a look at the patch:

- It looks like `r` is assigned in the `try` block but then not returned or called afterwards. Is this necessary? (I haven't completely digested the pynac interface so I may be missing something, but this looks strange...)
- Should this be added to `coefficients` as well?
- The indentation to `TESTS:` in the docstring was changed accidentally.
