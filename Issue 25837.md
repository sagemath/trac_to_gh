# Issue 25837: Subcategories and base class for nilpotent Lie algebras

Issue created by migration from Trac.

Original creator: @ehaka

Original creation time: 2018-08-16 16:05:22

CC:  tscrim

Keywords: Lie algebras, nilpotent, graded, stratified

Implementation of subcategories for nilpotent, graded and stratified Lie algebras, and a base class and constructor for nilpotent Lie algebras mimicking `LieAlgebraWithStructureCoefficients`.


---

Comment by @ehaka created at 2018-08-16 16:42:45

Changing status from new to needs_info.


---

Comment by @ehaka created at 2018-08-16 16:42:45

An initial working copy of the implementation is in the commits. Whether the category framework was used correctly I do not know. In particular the distinction between axioms like `.Finite()` and covariant functorial constructions as in `sage.categories.graded_modules` to implement `.Graded()` was not clear to me.

Currently, based on my understanding of http://doc.sagemath.org/html/en/reference/categories/sage/categories/primer.html#difference-between-axioms-and-regressive-covariant-functorial-constructions, I added `Nilpotent` as an axiom and `Graded` and `Stratified` as covariant constructions. Comments on these choices or correction suggestions about how to use the category framework correctly are very welcome. As it is now, all the implemented methods seem to work as they should, but I do not know if some kind of mistake is lurking beneath the surface.

Moreover, the examples are currently slightly hand-built (e.g. by forcing an extra category on a nilpotent Lie algebra constructor). The main issue that I do not how to solve is that even in the case when the e.g. the natural stratification can be deduced (as in the implementation of the `degree_on_basis` method in `sage.categories.graded_lie_algebras.FiniteDimensionalStratifiedLieAlgebrasWithBasis`) the easy construction to verify the extra properties uses the constructed object itself. That is, the correct category is very difficult to deduce until after the parent has been initialized, and computation with its elements is possible. How would one approach this kind of problem?

Additionally, as a minor tweak I added an extra parameter `submodule` to the `lower_central_series` method in `sage.categories.finite_dimensional_lie_algebras_with_basis` to compute the lower central series purely in terms of submodules as was already done in the `product_space` method. Otherwise the nilpotency testing would require implementing ideals or writing the already existing code again somewhere else.


---

Comment by tscrim created at 2018-08-17 10:43:34

So `Nilpotent` is definitely an axiom and `Graded` is definitely a functorial construction. Now for `Stratified`, I am not certain it is not an axiom. It is somewhat like `Connected` for Hopf algebras, an axiom that only makes sense in the `Graded` category. I think if we have a Lie algebra that is some axiom X and stratified, then it is an X stratified Lie algebra.

Most of your implementation of the categories is good on a quick look-over. There are a few things that could be simplified that I can work on tomorrow to make the structures a little cleaner given the code that is currently in the categories. We can easily expand things out later if there is a use for them. I think the easiest way to explain things will be me making some commits with the changes with some comments here, but if you would rather me just give comments, then let me know.

As to realizing the correct category, there is a `_refine_category` method that you can call later once you have computed some properties. This is what `Zmod(p)` does:

```
sage: P = Zmod(5)
sage: P.category()
Join of Category of finite commutative rings and Category of subquotients of monoids and Category of quotients of semigroups and Category of finite enumerated sets
sage: P in Fields()
True
sage: P.category()
Join of Category of finite enumerated fields and Category of subquotients of monoids and Category of quotients of semigroups
```

I should caution that this has been known to cause issues in the past, but mostly because these get used as the base ring (and hence, parameterize the category) for other objects. Although for general purpose classes, I am inclined to force the user to ask for such a property (such as in the example above), which can include calling particular methods.

+1 for the added option to `lower_central_series`. That is good for optimization purposes (e.g., if you only need the length of the central series).

As previously mentioned, I will take a detailed look tomorrow. I am assuming I can otherwise treat the code as needs review.


---

Comment by @ehaka created at 2018-08-17 13:08:24

Feel free to make any changes, I agree that it is much easier to understand things with something concrete to look at. The `Zmod` example is also very good to know, I did not know that categories do not necessarily have to be 'stable' post-initialization.

Your final assumption is correct, other than my confusion about the categories, I would have classified the code as 'needs review'.


---

Comment by tscrim created at 2018-08-21 00:41:43

I have made it through and reworked the categories around a bit, but it is more in line with what should be done (at least as I have learned it). As some extra test cases, I made the Heisenberg Lie algebra(s) in the nilpotent category.

I have done a few other tweaks to the doc and code, including fixing some other cases for `product_space(submodule=True)` exposed by the matrix Heisenberg Lie algebra. I am not sure about the separate `NilpotentLieAlgebra` constructor as I feel like we should have a way to connect it with the general `LieAlgebra` constructor, perhaps via a `nilpotent=True` argument. That way we have fewer top-level entry points and gives better exposure to the user. I am also okay pushing that off to a later ticket, but I'd like to hear your thoughts on the matter.

Hopefully these changes (currently) will not cause you too many refactoring problems with later tickets.
----
New commits:


---

Comment by tscrim created at 2018-08-21 00:41:43

Changing status from needs_info to needs_review.


---

Comment by @ehaka created at 2018-08-21 09:45:29

Thanks for the improvements, looks quite good to me. Probably you are right about the `NilpotentLieAlgebra` constructor that the logic would be better inside `LieAlgebra` instead. It would also make sense to include in this ticket I think.

I noticed in the edits the `extra_super_categories` of finite dimensional stratified Lie algebras with basis got dropped. Currently we have for example

```
sage: C = LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified()
sage: C is C.Nilpotent()
False
```

whereas mathematically this should be True. Then again this does not really depend on the basis, so if I understand correctly, the right place to add the `extra_super_categories` would be in `GradedLieAlgebras.Stratified` with an 'if finite dimensional' clause.
I will add this and move the `NilpotentLieAlgebra` constructor inside `LieAlgebra` later today.

Regarding the text presentation of the categories, the automatic printing is a bit cumbersome:

```
sage: LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified().Nilpotent()
Category of finite dimensional stratified nilpotent graded lie algebras with basis over Rational Field
```

It makes sense to have `Stratified` as an axiom under `Graded`, but the automatic terminology 'stratified graded' or 'stratified X graded' sounds clunky. Would it be valid to replace 'stratified graded' with just 'stratified'? If so, what would be the most convenient way to systematically make this change for all axiom permutations?


---

Comment by git created at 2018-08-21 15:29:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ehaka created at 2018-08-21 15:47:45

I removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.

I added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works

```
sage: C = LieAlgebras(QQ).FiniteDimensional().Graded().Stratified()
sage: C is C.Nilpotent()
True
```

and it didn't break the existing deduction

```
sage: C = LieAlgebras(GF(5)).Graded().Stratified().FiniteDimensional()
sage: C.is_subcategory(Sets().Finite())
True
```

so I assume adding the `FiniteDimensional` subclass didn't break anything.

I also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.


---

Comment by git created at 2018-08-22 03:39:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-22 03:46:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-22 03:51:49

Replying to [comment:7 gh-ehaka]:
> I removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.

Thank you. Looks good. I added an extra option so that when given `NilpotentLieAlgebras` as a category, then it automatically considers `nilpotent=True`.

> I added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works

Sorry about loosing that. Yes, this is the correct way to do it.

> I also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.

I fixed two others that were coming back from the patchbot.

I know the text representation of the category is not very good. I will see if I can make it better (I think you can, but I need to dig around a little and experiment), but beyond that, I am happy with things here.


---

Comment by @ehaka created at 2018-08-22 04:38:31

The edits all look good to me. I would be ok with marking this as positive review and handling the category repr improvements eventually in a later ticket as it is only a cosmetic fix.


---

Comment by git created at 2018-08-22 05:24:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-22 05:28:32

Here is the improvements to the category repr. The "stratified graded" -> "stratified" was a standard(ish) workaround. Removing the "nilpotent" was a bit more work, but mainly because we do not want to say "nilpotent finite dimensional Lie algebras". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.


---

Comment by @ehaka created at 2018-08-22 05:46:52

Replying to [comment:13 tscrim]:
> Here is the improvements to the category repr. The "stratified graded" -> "stratified" was a standard(ish) workaround. Removing the "nilpotent" was a bit more work, but mainly because we do not want to say "nilpotent finite dimensional Lie algebras". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.

Very nice! The various combinations of finite dimensional, graded, stratified and nilpotent all printed quite well now in my opinion.


---

Comment by @ehaka created at 2018-08-22 05:46:52

Changing status from needs_review to positive_review.


---

Comment by git created at 2018-08-22 19:05:23

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-08-22 19:05:23

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by @ehaka created at 2018-08-22 19:10:29

Docbuild was failing because of the non-existent module `sage/categories/examples/finite_dimensional_nilpotent_lie_algebras_with_basis` which I assume was meant to be `sage/categories/finite...` as that link was missing. Also added the `nilpotent_lie_algebra` link to the Lie algebra index and corrected a typo that was causing the documentation to display strangely.

I'll leave the ticket as needs review until it is verified that the doc changes were correct as I have not tried to modify the automatic html reference before.


---

Comment by git created at 2018-08-22 22:56:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-08-22 22:58:15

Yep, LGTM. Thank you for catching and fixing that. I made some trivial changes and am allowing myself to set this to a positive review (I changed the V<sub>k</sub> to L<sub>k</sub> to be consistent notationally; feel free to revert the positive review if you disagree).


---

Comment by tscrim created at 2018-08-22 22:58:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-26 09:37:43

Resolution: fixed
