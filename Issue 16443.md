# Issue 16443: Use a different curve to test an error message in EllipticCurve_finite_field.cardinality()

Issue created by migration from https://trac.sagemath.org/ticket/16680

Original creator: pbruin

Original creation time: 2014-07-18 20:55:19

CC:  vbraun

The following doctest in `ell_finite_field.py` can fail (by returning a cached result) because the same curve is used in an earlier doctest and may be cached by the `UniqueFactory` from #11474:

```
sage: EllipticCurve(GF(10007),[1,2,3,4,5]).cardinality(algorithm='foobar')
Traceback (most recent call last):
...
ValueError: Algorithm is not known
```

A trivial solution is to use a different curve for this test.


---

Comment by pbruin created at 2014-07-18 20:57:36

Changing status from new to needs_review.


---

Comment by tscrim created at 2014-07-19 00:05:49

Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.

I'm somewhat inclined to go with what you say, ignore the `algorithm` keyword _always_ once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)

However I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)


---

Comment by pbruin created at 2014-07-19 00:35:26

Replying to [comment:3 tscrim]:
> Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.
If all the algorithms are correct, then I see no reason why we should ever recompute the order once it has been computed in any way; it is only useful for debugging purposes.
> I'm somewhat inclined to go with what you say, ignore the `algorithm` keyword _always_ once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)
> 
> However I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)
I don't have a strong opinion on this, although using ``@`cached_method` would have the advantage that we can get rid of manual caching.


---

Comment by tscrim created at 2014-07-19 00:55:15

Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).

I've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).
----
New commits:


---

Comment by pbruin created at 2014-07-19 10:05:24

Replying to [comment:5 tscrim]:
> Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).
I agree; this would be something for another ticket.
> I've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).
Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.


---

Comment by pbruin created at 2014-07-19 11:21:39

Changing type from task to enhancement.


---

Comment by pbruin created at 2014-07-19 11:21:39

Replying to [comment:6 pbruin]:
> Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.
Fixed this, also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and "heuristic" may also be misinterpreted as saying that the result is not guaranteed to be correct.)


---

Comment by pbruin created at 2014-07-19 11:21:39

Changing priority from trivial to minor.


---

Comment by pbruin created at 2014-07-19 11:21:39

Changing keywords from "" to "elliptic curve cardinality".


---

Comment by tscrim created at 2014-07-19 14:49:56

Replying to [comment:7 pbruin]:
> Replying to [comment:6 pbruin]:
> > Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.
> Fixed this,

Good point.

> also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and "heuristic" may also be misinterpreted as saying that the result is not guaranteed to be correct.)

I agree since it always went to `pari`. This also leaves the door open for someone to re-implement this if someone comes up with a proper heuristic. So positive review. Thanks Peter.


---

Comment by tscrim created at 2014-07-19 14:49:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-07-20 03:18:45

Resolution: fixed
