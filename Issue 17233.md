# Issue 17233: Let exponentiation of polynomial using FLINT nmod type be interrupted

archive/issues_017233.json:
```json
{
    "body": "CC:  vbraun jdemeyer\n\n\n```\nsage: k = GF(next_prime(2**30))\nsage: x = polygen(k)\nsage: x**p\nCTRL+C....\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17470\n\n",
    "created_at": "2014-12-08T18:12:41Z",
    "labels": [
        "finite rings",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Let exponentiation of polynomial using FLINT nmod type be interrupted",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17233",
    "user": "jpflori"
}
```
CC:  vbraun jdemeyer


```
sage: k = GF(next_prime(2**30))
sage: x = polygen(k)
sage: x**p
CTRL+C....
```


Issue created by migration from https://trac.sagemath.org/ticket/17470





---

archive/issue_comments_229340.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-09T11:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229340",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_229341.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-12-09T11:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229341",
    "user": "jpflori"
}
```

New commits:



---

archive/issue_comments_229342.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-09T12:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229342",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_229343.json:
```json
{
    "body": "`cdefs.pxi` should be `interrupt.pxi`",
    "created_at": "2014-12-09T12:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229343",
    "user": "jdemeyer"
}
```

`cdefs.pxi` should be `interrupt.pxi`



---

archive/issue_comments_229344.json:
```json
{
    "body": "I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?",
    "created_at": "2014-12-09T12:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229344",
    "user": "jdemeyer"
}
```

I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?



---

archive/issue_comments_229345.json:
```json
{
    "body": "Also, `celement_pow` doesn't seem to be documented anywhere...\n\nI do give positive_review to the addition of `sig_on()` and `sig_off()` and the doctest changes.",
    "created_at": "2014-12-09T12:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229345",
    "user": "jdemeyer"
}
```

Also, `celement_pow` doesn't seem to be documented anywhere...

I do give positive_review to the addition of `sig_on()` and `sig_off()` and the doctest changes.



---

archive/issue_comments_229346.json:
```json
{
    "body": "Actually,\n\n```\nsage: alarm(1)\nsage: x^n\n```\n\nshould be\n\n```\nsage: alarm(1); x^n\n```\n",
    "created_at": "2014-12-09T12:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229346",
    "user": "jdemeyer"
}
```

Actually,

```
sage: alarm(1)
sage: x^n
```

should be

```
sage: alarm(1); x^n
```




---

archive/issue_comments_229347.json:
```json
{
    "body": "I created #17476 as possible \"meta-ticket\".",
    "created_at": "2014-12-09T13:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229347",
    "user": "jdemeyer"
}
```

I created #17476 as possible "meta-ticket".



---

archive/issue_comments_229348.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?\nMaybe because the file was written 6 years ago on top of FLINT 1.x :)",
    "created_at": "2014-12-09T13:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229348",
    "user": "jpflori"
}
```

Replying to [comment:3 jdemeyer]:
> I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?
Maybe because the file was written 6 years ago on top of FLINT 1.x :)



---

archive/issue_comments_229349.json:
```json
{
    "body": "As far as old stuff which needs update is concerned, we should also rewrite the NTL wrapping code now that Cython understands C++.",
    "created_at": "2014-12-09T13:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229349",
    "user": "jpflori"
}
```

As far as old stuff which needs update is concerned, we should also rewrite the NTL wrapping code now that Cython understands C++.



---

archive/issue_comments_229350.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-09T17:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229350",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_229351.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-09T17:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229351",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_229352.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-15T07:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229352",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_229353.json:
```json
{
    "body": "I get\n\n```\nsage -t --long src/sage/libs/flint/nmod_poly_linkage.pxi\n**********************************************************************\nFile \"src/sage/libs/flint/nmod_poly_linkage.pxi\", line 498, in sage.libs.flint.nmod_poly_linkage.celement_pow\nFailed example:\n    alarm(1); x^n\nExpected:\n    Traceback (most recent call last):\n    ...\n    AlarmInterrupt\nGot:\n    Exception (FLINT memory_manager). Unable to allocate memory.\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 851, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.flint.nmod_poly_linkage.celement_pow[20]>\", line 1, in <module>\n        alarm(Integer(1)); x**n\n      File \"sage/rings/polynomial/polynomial_template.pxi\", line 625, in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__pow__ (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:10790)\n      File \"sage/libs/flint/nmod_poly_linkage.pxi\", line 508, in sage.rings.polynomial.polynomial_zmod_flint.celement_pow (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:4815)\n      File \"sage/ext/c_lib.pyx\", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:971)\n    RuntimeError: Aborted\n**********************************************************************\n```\n",
    "created_at": "2014-12-15T07:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229353",
    "user": "jdemeyer"
}
```

I get

```
sage -t --long src/sage/libs/flint/nmod_poly_linkage.pxi
**********************************************************************
File "src/sage/libs/flint/nmod_poly_linkage.pxi", line 498, in sage.libs.flint.nmod_poly_linkage.celement_pow
Failed example:
    alarm(1); x^n
Expected:
    Traceback (most recent call last):
    ...
    AlarmInterrupt
Got:
    Exception (FLINT memory_manager). Unable to allocate memory.
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.flint.nmod_poly_linkage.celement_pow[20]>", line 1, in <module>
        alarm(Integer(1)); x**n
      File "sage/rings/polynomial/polynomial_template.pxi", line 625, in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__pow__ (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:10790)
      File "sage/libs/flint/nmod_poly_linkage.pxi", line 508, in sage.rings.polynomial.polynomial_zmod_flint.celement_pow (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:4815)
      File "sage/ext/c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:971)
    RuntimeError: Aborted
**********************************************************************
```




---

archive/issue_comments_229354.json:
```json
{
    "body": "Indeed...\nActually I think it will be quite hard to find a test that won't spuriously cause memory errors.\n\nExponentiation without modular reduction will be either too fast or eat up all the memory.\nAnd modular exponentiation is just fast as well and we can only use `long`s as exponents right now.",
    "created_at": "2014-12-16T09:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229354",
    "user": "jpflori"
}
```

Indeed...
Actually I think it will be quite hard to find a test that won't spuriously cause memory errors.

Exponentiation without modular reduction will be either too fast or eat up all the memory.
And modular exponentiation is just fast as well and we can only use `long`s as exponents right now.



---

archive/issue_comments_229355.json:
```json
{
    "body": "Proposal: choose `n` such that the test passes with 2GB of virtual memory (use `ulimit -v 2000000` to test this). If needed, make the alarm time shorter.",
    "created_at": "2014-12-16T10:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229355",
    "user": "jdemeyer"
}
```

Proposal: choose `n` such that the test passes with 2GB of virtual memory (use `ulimit -v 2000000` to test this). If needed, make the alarm time shorter.



---

archive/issue_comments_229356.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-17T11:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229356",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_229357.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-17T11:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229357",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_229358.json:
```json
{
    "body": "I modified the test slightly. Other than that, the patch looks good.\n----\nNew commits:",
    "created_at": "2014-12-19T16:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229358",
    "user": "jdemeyer"
}
```

I modified the test slightly. Other than that, the patch looks good.
----
New commits:



---

archive/issue_comments_229359.json:
```json
{
    "body": "I assume this means positive review...",
    "created_at": "2014-12-19T17:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229359",
    "user": "jpflori"
}
```

I assume this means positive review...



---

archive/issue_comments_229360.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-19T17:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229360",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_229361.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-21T21:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17233#issuecomment-229361",
    "user": "vbraun"
}
```

Resolution: fixed
