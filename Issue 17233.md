# Issue 17233: Let exponentiation of polynomial using FLINT nmod type be interrupted

Issue created by migration from https://trac.sagemath.org/ticket/17470

Original creator: jpflori

Original creation time: 2014-12-08 18:12:41

CC:  vbraun jdemeyer


```
sage: k = GF(next_prime(2**30))
sage: x = polygen(k)
sage: x**p
CTRL+C....
```



---

Comment by jpflori created at 2014-12-09 11:10:47

Changing status from new to needs_review.


---

Comment by jpflori created at 2014-12-09 11:10:47

New commits:


---

Comment by jdemeyer created at 2014-12-09 12:42:11

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-12-09 12:42:11

`cdefs.pxi` should be `interrupt.pxi`


---

Comment by jdemeyer created at 2014-12-09 12:49:23

I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?


---

Comment by jdemeyer created at 2014-12-09 12:57:48

Also, `celement_pow` doesn't seem to be documented anywhere...

I do give positive_review to the addition of `sig_on()` and `sig_off()` and the doctest changes.


---

Comment by jdemeyer created at 2014-12-09 12:58:54

Actually,

```
sage: alarm(1)
sage: x^n
```

should be

```
sage: alarm(1); x^n
```



---

Comment by jdemeyer created at 2014-12-09 13:12:46

I created #17476 as possible "meta-ticket".


---

Comment by jpflori created at 2014-12-09 13:55:35

Replying to [comment:3 jdemeyer]:
> I know it's not the topic of this ticket, but why is this code not implemented as direct calls to either `nmod_poly_pow()` or `nmod_poly_powmod_mpz_binexp()`?
Maybe because the file was written 6 years ago on top of FLINT 1.x :)


---

Comment by jpflori created at 2014-12-09 13:56:20

As far as old stuff which needs update is concerned, we should also rewrite the NTL wrapping code now that Cython understands C++.


---

Comment by git created at 2014-12-09 17:15:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-12-09 17:16:33

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-12-15 07:18:01

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-12-15 07:18:01

I get

```
sage -t --long src/sage/libs/flint/nmod_poly_linkage.pxi
**********************************************************************
File "src/sage/libs/flint/nmod_poly_linkage.pxi", line 498, in sage.libs.flint.nmod_poly_linkage.celement_pow
Failed example:
    alarm(1); x^n
Expected:
    Traceback (most recent call last):
    ...
    AlarmInterrupt
Got:
    Exception (FLINT memory_manager). Unable to allocate memory.
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.flint.nmod_poly_linkage.celement_pow[20]>", line 1, in <module>
        alarm(Integer(1)); x**n
      File "sage/rings/polynomial/polynomial_template.pxi", line 625, in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__pow__ (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:10790)
      File "sage/libs/flint/nmod_poly_linkage.pxi", line 508, in sage.rings.polynomial.polynomial_zmod_flint.celement_pow (build/cythonized/sage/rings/polynomial/polynomial_zmod_flint.cpp:4815)
      File "sage/ext/c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:971)
    RuntimeError: Aborted
**********************************************************************
```



---

Comment by jpflori created at 2014-12-16 09:38:41

Indeed...
Actually I think it will be quite hard to find a test that won't spuriously cause memory errors.

Exponentiation without modular reduction will be either too fast or eat up all the memory.
And modular exponentiation is just fast as well and we can only use `long`s as exponents right now.


---

Comment by jdemeyer created at 2014-12-16 10:13:17

Proposal: choose `n` such that the test passes with 2GB of virtual memory (use `ulimit -v 2000000` to test this). If needed, make the alarm time shorter.


---

Comment by git created at 2014-12-17 11:09:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-12-17 11:11:23

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-12-19 16:41:40

I modified the test slightly. Other than that, the patch looks good.
----
New commits:


---

Comment by jpflori created at 2014-12-19 17:11:12

I assume this means positive review...


---

Comment by jpflori created at 2014-12-19 17:11:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-21 21:45:16

Resolution: fixed
