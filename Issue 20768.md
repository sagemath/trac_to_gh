# Issue 20768: update pari to new upstream snapshot

Issue created by migration from https://trac.sagemath.org/ticket/21005

Original creator: vdelecroix

Original creation time: 2016-07-11 21:11:03

CC:  jdemeyer vbraun defeo fbissey jpflori

There is a critical bug in the current snapshot of pari (see #21000).


---

Comment by vdelecroix created at 2016-07-11 21:28:43

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-07-11 21:28:43

New commits:


---

Comment by vdelecroix created at 2016-07-11 21:28:43

Changing component from interfaces to packages: standard.


---

Comment by git created at 2016-07-11 21:29:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-07-11 22:12:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-07-11 22:35:51

Positive review if you fill in your name...


---

Comment by vdelecroix created at 2016-07-11 23:23:57

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-07-11 23:23:57

I have some trouble with auto generated functions. Some of them disappeared and break doctests (like `padicprec`).


---

Comment by git created at 2016-07-12 04:02:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-12 04:02:43

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-07-13 18:24:04

positive_review from my part if this passes `make ptestlong`.


---

Comment by vbraun created at 2016-07-13 22:44:52

PDF build fails because of pound sign

```
src/sage/libs/pari/auto_gen.pxi:        defined by the equation :math:`\#E(\mathbb{F}_q) = q+1 - t`.
```

then

```
[docpdf] Overfull \hbox (623.6548pt too wide) in paragraph at lines 21949--21949
[docpdf] [] 
[docpdf] [278] [279] [280] [281]
[docpdf] ! You can't use `macro parameter character #' in math mode.
[docpdf] l.22319 dividing \(#
[docpdf]                     E(\mathbb{F}_q)\).
[docpdf] ? 
[docpdf] ! Emergency stop.
[docpdf] l.22319 dividing \(#
[docpdf]                     E(\mathbb{F}_q)\).
[docpdf] !  ==> Fatal error occurred, no output PDF file produced!
[docpdf] Transcript written on libs.log.
[docpdf] Makefile:68: recipe for target 'libs.pdf' failed
[docpdf] make[2]: *** [libs.pdf] Error 1
[docpdf] make[2]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/share/doc/sage/latex/en/reference/libs'
```



---

Comment by vbraun created at 2016-07-13 22:44:52

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-07-14 14:49:29

Too bad... everything is fine from the `sage_setup.autogen.pari` side. It generates the perfectly valid formula `:math:`\#E(\mathbb{F}_q)``. But then from the log message above it seems that sphinx (?) convert it to `(\(#E(\mathbb{F}_q\)` which is indeed wrong.


---

Comment by vbraun created at 2016-07-23 23:32:29

No, wrong line. The generated formula is 

```
          dividing :math:`#E(\mathbb{F}_q)`.        
```

which is invalid TeX.


---

Comment by git created at 2016-07-24 21:02:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-07-24 21:03:35

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-07-25 09:17:35

There must have been a reason for the `\S` in the regular expression... I will check if I can find it.


---

Comment by jdemeyer created at 2016-07-25 09:20:45

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-07-25 12:36:21

Fixing this...


---

Comment by git created at 2016-07-25 13:47:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-07-25 13:47:51

This version gives better results, needs_review.

Why is this a blocker by the way?


---

Comment by jdemeyer created at 2016-07-25 13:47:51

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-07-25 16:26:22

Replying to [comment:20 jdemeyer]:
> Why is this a blocker by the way?

#21000 is a major bug to be fixed.


---

Comment by vdelecroix created at 2016-07-25 18:02:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-07-26 07:02:29

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-07-26 07:02:29

There are a bunch of failures of the form

```
File "src/sage/rings/qqbar.py", line 4536, in sage.rings.qqbar.AlgebraicReal._floor_ceil
Failed example:
    [one_half.round(), (-one_half).round()] # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 499, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 862, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.qqbar.AlgebraicReal._floor_ceil[7]>", line 1, in <module>
        [one_half.round(), (-one_half).round()] # long time
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 4602, in round
        return self._floor_ceil(lambda x: x.round())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 4547, in _floor_ceil
        return method(self._rational_())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 4640, in _rational_
        self.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7063, in exactify
        right.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7062, in exactify
        left.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7062, in exactify
        left.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7062, in exactify
        left.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7062, in exactify
        left.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7062, in exactify
        left.exactify()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 3270, in exactify
        self._set_descr(self._descr.exactify())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 7064, in exactify
        gen = left._exact_field().union(right._exact_field())
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 2409, in union
        red_elt, red_back, red_pol = do_polred(newpol_sage_y)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 1712, in do_polred
        new_poly, elt_back = poly._pari_().polredbest(flag=1)
      File "sage/libs/pari/auto_gen.pxi", line 15978, in sage.libs.pari.gen.gen_auto.polredbest (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/libs/pari/gen.c:82406)
        sig_on()
      File "sage/libs/pari/handle_error.pyx", line 181, in sage.libs.pari.handle_error._pari_err_handle (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/libs/pari/handle_error.c:3102)
        raise PariError(errnum, pari_error_string, pari_instance.new_gen_noclear(E))
    PariError: impossible inverse in Fl_inv: Mod(2120213466, 2148532227)
**********************************************************************
1 item had failures:
   2 of   9 in sage.rings.qqbar.AlgebraicReal._floor_ceil
    [1333 tests, 2 failures, 172.84 s]
```



---

Comment by jdemeyer created at 2016-07-26 07:25:23

Replying to [comment:21 vdelecroix]:
> Replying to [comment:20 jdemeyer]:
> > Why is this a blocker by the way?
> 
> #21000 is a major bug to be fixed.

Ordinary bugs usually are not blockers. Anyway, I let the release manager decide...


---

Comment by vbraun created at 2016-07-26 11:55:02

Obviously depends on the severity of the bug ;-)

In any case, as long as no working upstream Pari release surfaces we don't have a choice.


---

Comment by jdemeyer created at 2016-07-26 12:02:58

I am now trying the current PARI master.


---

Comment by git created at 2016-07-26 12:22:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-07-26 12:25:37

Note to the reviewer: the changed output from `elllocalred()` is harmless: the old transformations were invertible over `ZZ`, so they didn't really change the model of the curve. PARI now gives the trivial transformation `[1,0,0,0]` in these cases.


---

Comment by jdemeyer created at 2016-07-26 12:25:37

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-07-26 19:40:38

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-07-26 19:40:38

I got timeout in qqbar.py

Namely, on the current beta

```
sage: x = polygen(QQ)
sage: a = AA.polynomial_root(x^5 - (1-2^(-80)), RIF((0,2)))
sage: b = AA.polynomial_root(x^5 - (1+2^(-80)), RIF((0,2)))
sage: two = (a+b)^5 - 5*(a^4*b+a*b^4) - 10*(a^3*b^2+a^2*b^3) 
sage: one_half = 1/two
sage: %time one_half.round()
CPU times: user 4.08 s, sys: 8 ms, total: 4.08 s
Wall time: 4.08 s
1
```

and with the updated pari release

```
sage: %time one_half.round()  # hangs forever...
```



---

Comment by vdelecroix created at 2016-07-26 19:45:39

Relevant part of the traceback after Ctrl-C

```
.../sage/rings/qqbar.pyc in union(self, other)
   2408 
-> 2409         red_elt, red_back, red_pol = do_polred(newpol_sage_y)
   2410 
.../sage/rings/qqbar.pyc in do_polred(poly)
   1711     """
-> 1712     new_poly, elt_back = poly._pari_().polredbest(flag=1)
   1713 
.../sage/libs/pari/auto_gen.pxi in sage.libs.pari.gen.gen_auto.polredbest (build/cythonized/sage/libs/pari/gen.c:82406)()
  15975         cdef GEN _T = T.g
> 15976         sig_on()
  15977         cdef GEN _ret = polredbest(_T, flag)
  15978         return pari_instance.new_gen(_ret)
src/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1125)()
```



---

Comment by jdemeyer created at 2016-07-27 07:57:08

You're sure that you updated to my branch, right?


---

Comment by jdemeyer created at 2016-07-27 09:06:09

Replying to [comment:31 vdelecroix]:
> I got timeout in qqbar.py

Confirmed...

I guess I only ran non-long doctests, that's why I didn't see this.


---

Comment by jdemeyer created at 2016-07-27 09:10:08

In `gp`:

Without this ticket:

```
gp> polredbest(y^25 - 10*y^20 + 913438523331814323877303020447676887284957839359415*y^15 + 5480631139990885943263818122686061323709747036156170*y^10 + 6674959487252844007484442831779850358133451632359059274944514138501172824941815657498046774640640705*y^5 - 32)
time = 10,360 ms.
%1 = y^25 - 10*y^20 + 913438523331814323877303020447676887284957839359415*y^15 + 5480631139990885943263818122686061323709747036156170*y^10 + 6674959487252844007484442831779850358133451632359059274944514138501172824941815657498046774640640705*y^5 - 32
```


With this ticket, it seems to hang.


---

Comment by jdemeyer created at 2016-07-27 09:21:35

I submitted an upstream bug for this.


---

Comment by jdemeyer created at 2016-07-27 12:31:49

I'll prepare a new tarball...


---

Comment by git created at 2016-07-27 12:37:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-07-27 12:38:03

Here it is, totally untested though...


---

Comment by jdemeyer created at 2016-07-27 12:38:03

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-07-27 12:55:56

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-07-27 12:55:56


```
[pari-2.8-2971-gccd5bdf.p0] PROBLEMS WERE NOTED. The following files list them in diff format: 
[pari-2.8-2971-gccd5bdf.p0] Directory: /usr/local/src/sage-config/local/var/tmp/sage/build/pari-2.8-2971-gccd5bdf.p0/src/Olinux-x86_64
[pari-2.8-2971-gccd5bdf.p0]     ell-sta.dif
[pari-2.8-2971-gccd5bdf.p0]     ell-dyn.dif
[pari-2.8-2971-gccd5bdf.p0] Makefile:353: recipe for target 'test-all' failed
```



---

Comment by git created at 2016-07-27 15:38:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-07-27 15:38:46

Updated again, untested.


---

Comment by jdemeyer created at 2016-07-27 15:38:46

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-07-27 15:40:04

I am launching test on librae...


---

Comment by vdelecroix created at 2016-07-27 16:01:48

not able to build

```
[sagelib-7.3.beta9] [  1/232] Cythonizing sage/libs/pari/gen.pyx
[sagelib-7.3.beta9] 
[sagelib-7.3.beta9] Error compiling Cython file:
[sagelib-7.3.beta9] ------------------------------------------------------------
[sagelib-7.3.beta9] ...
[sagelib-7.3.beta9]         """
[sagelib-7.3.beta9]         cdef GEN _L = L.g
[sagelib-7.3.beta9]         if not precision:
[sagelib-7.3.beta9]             precision = default_bitprec()
[sagelib-7.3.beta9]         sig_on()
[sagelib-7.3.beta9]         cdef long _ret = lfunorderzero(_L, m, precision)
[sagelib-7.3.beta9]                                      ^
[sagelib-7.3.beta9] ------------------------------------------------------------
[sagelib-7.3.beta9] 
[sagelib-7.3.beta9] sage/libs/pari/auto_gen.pxi:11107:38: Call with wrong number of arguments (expected 2, got 3)
[sagelib-7.3.beta9] Traceback (most recent call last):
[sagelib-7.3.beta9]   File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/Cython-0.24.1-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py", line 1055, in cythonize_one_helper
[sagelib-7.3.beta9]     return cythonize_one(*m)
[sagelib-7.3.beta9]   File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/Cython-0.24.1-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py", line 1037, in cythonize_one
[sagelib-7.3.beta9]     raise CompileError(None, pyx_file)
[sagelib-7.3.beta9] CompileError: sage/libs/pari/gen.pyx
```



---

Comment by git created at 2016-07-27 16:43:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-27 20:32:38

Not so bad ;-)

```
**********************************************************************
File "src/sage/rings/number_field/number_field_element.pyx", line 2306, in sage.rings.number_field.number_field_element.NumberFieldElement.__invert__
Warning, slow doctest:
    beta = ~alpha # long time (about 1:45min on a 2014 MacBook Pro, this used to cause a crash in Sage 7.2)
Test ran for 111.36 s
    [1038 tests, 130.77 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2016-07-27 20:36:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-07-27 22:40:52

PDF docs still fail


---

Comment by vbraun created at 2016-07-27 22:40:52

Changing status from positive_review to needs_work.


---

Comment by vdelecroix created at 2016-07-28 13:43:39

Indeed

```
[docpdf] ! Undefined control sequence.
[docpdf] l.27579 of \(\Hom
[docpdf]                  _G(\Delta, V)\), and let \(p = [a,b] \in \Delta\) be a path...
[docpdf] 

[docpdf] ? ! Undefined control sequence.
[docpdf] l.27586 the fixed basis of \(\Hom
[docpdf]                                  _G(\Delta,V)\) chosen in \(M\); if \(M\) was

[docpdf] ? [338]
[docpdf] Overfull \vbox (1.36996pt too high) detected at line 27680
[docpdf] [339]
[docpdf] ! Undefined control sequence.
[docpdf] l.27726 of the fixed basis of \(\Hom
[docpdf]                                     _G(\Delta,\mathbb{Q})\) chosen in \(M\)).

[docpdf] ? [340] [341]
[docpdf] ! Undefined control sequence.
[docpdf] l.27871 ...odular symbols, the \(G\)-module \(\Hom
[docpdf]                                                   _G(Div^0(\mathbb{P}^1
```



---

Comment by git created at 2016-07-28 16:23:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-28 16:26:43

The four last commits make available a `\Hom` macro that is reasonable to have in Sage. I was able to compile the pdf documentation by adding a `\Frob` macro. But I do not like it so much having it has a globally defined macro: the name "Frob" is ambiguous.


---

Comment by vdelecroix created at 2016-07-28 16:28:53

Changing priority from blocker to major.


---

Comment by vdelecroix created at 2016-07-28 16:28:53

Since this is postponed to sage-7.4 it makes sense to let it as major. However, the bug from #21000 is pretty annoying.


---

Comment by vdelecroix created at 2016-08-01 22:22:03

Note that pari announced a stable release for soon:

```
We have made available a prerelease of PARI 2.8.0 (alpha).

Please test the prerelease tarball:
<http://pari.math.u-bordeaux.fr/pub/pari/snapshots/pari-2.8.0-pre1.alpha.tar.gz>

The expected release date is set to the 12/08/2016.
```

Isn't it worth it to wait the stable pari release for Sage (with moreover contains bug fixes compared to what we ship)?


---

Comment by fbissey created at 2016-08-01 22:40:49

Well this ticket is now marked for sage 7.4 so the stable release will happen before we get to 7.4 if I am reading the date correctly as 12th of Aug 2016.

But seriously, I doubt a stable release will satisfy sage's pari usage for very long. I am expecting Jeroen to move to the next pari development branch not long after the release unless something spectacular happens :)


---

Comment by vdelecroix created at 2016-08-01 22:49:00

I meant getting back the milestone to `7.3` (Volker did the change, see [comment:52]).

I hope `12/08/2016` is the 12-th of august and not the 8-th of december ;-) If we do ship pari-2.8, at least Sage-7.4 would match a stable pari release.


---

Comment by vdelecroix created at 2016-08-01 22:59:21

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-08-01 22:59:21

I am currently testing the branch at 512df36


---

Comment by git created at 2016-08-01 22:59:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-08-01 23:30:32

Ok. For the pdfdoc a naive substitution `"`@`[startlword]Hom`@`[endlword]" -> "\\text{Hom}"` and `"`@`[startlword]Frob`@`[endlword]" -> "\text{Frob}"` was enough. I guess it is better that way than the approach from my previous commits (​1ef03c4, ​b7a9144, ​5b88019, ​4a866cc).


---

Comment by vdelecroix created at 2016-08-01 23:31:23

At least the html doc and the pdf doc build and tests pass in `sage/libs/pari/`!


---

Comment by jdemeyer created at 2016-08-02 07:54:55

Upstream is preparing a release(!) of PARI version 2.8.0.

Given that this ticket is no longer a blocker, I would actually suggest to wait for that release and package that.

Edit: never mind, I see you already posted this above


---

Comment by jdemeyer created at 2016-08-02 12:56:19

Replying to [comment:59 fbissey]:
> I am expecting Jeroen to move to the next pari development branch not long after the release unless something spectacular happens :)

Exactly. The last non-bugfix release of PARI (version 2.7.0) was 21 march 2014. More than 2 years between releases is a really long time, especially because PARI is quite actively developed.


---

Comment by jdemeyer created at 2016-08-03 10:43:05

Did anybody run full doctests already with this new PARI? I did not do that yet.


---

Comment by jdemeyer created at 2016-08-03 12:30:03

OK. I will run `make ptestlong`.


---

Comment by jdemeyer created at 2016-08-03 19:54:17

Works fine for me. Let's wait until 2.8.0 is really released and then this is good to go I hope...


---

Comment by jdemeyer created at 2016-08-14 18:05:44

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-08-14 19:15:50

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-08-14 19:15:50

New commits:


---

Comment by jdemeyer created at 2016-08-14 20:30:40

Passes all tests.


---

Comment by fbissey created at 2016-08-14 21:31:22

Does it pass `make bench` properly for you? I have annoying formatting issues like

```
*** ../src/test/32/polyser      2016-04-09 02:36:45.000000000 +1200
--- gp.out      2016-08-15 09:17:49.995201272 +1200
***************
*** 19,25 ****
  xx
  ? factorpadic(apol,7,8)
  
! [(1 + O(7^8))*y + (6 + 2*7^2 + 2*7^3 + 3*7^4 + 2*7^5 + 6*7^6 + O(7^8)) 1]
  
  [(1 + O(7^8))*y^2 + (1 + 6*7 + 4*7^2 + 4*7^3 + 3*7^4 + 4*7^5 + 6*7^7 + O(7^8
  ))*y + (6 + 5*7 + 3*7^2 + 6*7^3 + 7^4 + 3*7^5 + 2*7^6 + 5*7^7 + O(7^8)) 1]
--- 19,26 ----
  xx
  ? factorpadic(apol,7,8)
  
! [                                                                           
!   (1 + O(7^8))*y + (6 + 2*7^2 + 2*7^3 + 3*7^4 + 2*7^5 + 6*7^6 + O(7^8)) 1]
  
  [(1 + O(7^8))*y^2 + (1 + 6*7 + 4*7^2 + 4*7^3 + 3*7^4 + 4*7^5 + 6*7^7 + O(7^8
  ))*y + (6 + 5*7 + 3*7^2 + 6*7^3 + 7^4 + 3*7^5 + 2*7^6 + 5*7^7 + O(7^8)) 1]
***************
*** 150,153 ****
  name
  ? if(getheap()!=HEAP,getheap())
  ? print("Total time spent: ",gettime);
! Total time spent: 0
--- 151,154 ----
  name
  ? if(getheap()!=HEAP,getheap())
  ? print("Total time spent: ",gettime);
! Total time spent: 10
```



---

Comment by jdemeyer created at 2016-08-15 07:14:27

I tested in Sage with `SAGE_CHECK=yes` which runs the full testsuite and it passed.


---

Comment by jdemeyer created at 2016-08-15 07:30:32

Apart from that, it also passes `make bench` outside of Sage.

Maybe report your problem upstream?


---

Comment by jdemeyer created at 2016-08-15 07:31:09

For me, this ticket is good. If Vincent (or anybody else) agrees, we can set this ticket to positive_review.


---

Comment by fbissey created at 2016-08-15 07:45:41

I always have problems of formatting with the tests in sage-on-gentoo. But `make bench` has been ok before, The full testsuite usually reports failure because my output is formatted in 132 columns (guess) while pari seems to expect it to be formatted in 80 columns.
Those bizarre line jump in `make bench` are new.

Otherwise I am ok with the ticket, but I thought we were waiting for 2.8.0 final.


---

Comment by vdelecroix created at 2016-08-19 19:22:28

the doc building is slightly worse... (but at least it fixes some bug)


---

Comment by vdelecroix created at 2016-08-19 19:22:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-21 13:13:57

Resolution: fixed
