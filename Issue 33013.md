# Issue 33013: Finite-dimensional algebras with basis: add __invert__ method

archive/issues_033013.json:
```json
{
    "body": "CC:  @tscrim @fchapoton @mkoeppe @jhpalmieri\n\nKeywords: algebras, algebras with bases, inverses\n\nLet's try to invert an element of a finite-dimensional algebra over a field:\n\n```\n                sage: QS3 = SymmetricGroupAlgebra(QQ, 3)\n                sage: P = Permutation\n                sage: a = 3 * QS3(P([1,2,3])) + QS3(P([1,3,2])) + QS3(P([2,1,3]))\n                sage: b = ~a; b\n```\n\nAt the moment, this is not implemented. The branch attached provides a naive implementation.\n\nIt does overshadow the ``__invert__`` method on ``AlgebrasWithBasis``, which however is unable to invert anything but a scalar multiple of the unity (and that only in the case when the unity is a basis element). In theory, this could be a problem, but I don't expect it to be.\n\nI hope it doesn't overshadow any more efficient ``__invert__`` methods on other classes of algebras via diamond inheritance. Anyone who knows the hierarchy?\n\nIssue created by migration from https://trac.sagemath.org/ticket/33250\n\n",
    "created_at": "2022-01-30T19:35:35Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Finite-dimensional algebras with basis: add __invert__ method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33013",
    "user": "https://github.com/darijgr"
}
```
CC:  @tscrim @fchapoton @mkoeppe @jhpalmieri

Keywords: algebras, algebras with bases, inverses

Let's try to invert an element of a finite-dimensional algebra over a field:

```
                sage: QS3 = SymmetricGroupAlgebra(QQ, 3)
                sage: P = Permutation
                sage: a = 3 * QS3(P([1,2,3])) + QS3(P([1,3,2])) + QS3(P([2,1,3]))
                sage: b = ~a; b
```

At the moment, this is not implemented. The branch attached provides a naive implementation.

It does overshadow the ``__invert__`` method on ``AlgebrasWithBasis``, which however is unable to invert anything but a scalar multiple of the unity (and that only in the case when the unity is a basis element). In theory, this could be a problem, but I don't expect it to be.

I hope it doesn't overshadow any more efficient ``__invert__`` methods on other classes of algebras via diamond inheritance. Anyone who knows the hierarchy?

Issue created by migration from https://trac.sagemath.org/ticket/33250





---

archive/issue_comments_470182.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-30T19:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470182",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_470183.json:
```json
{
    "body": "This is good to add. I think we should have a shortcut for scalars of the identity when `1` is a basis element (via `one_basis()`).\n\nSince from-category methods are low in the MRO, there shouldn't be any danger of overshadowing more specific implementations.\n\nHow could this fail to find an inverse when one did exist? I imagine there has to be some condition on the ground ring.\n\nWe probably should also force the coefficients into the base ring (which will fail when it has say 1/2 when over **Z** as it should). I would add a `coerce=False` (to keep the current optimized behavior in the code elsewhere) to `from_vector` that passes that off to `_from_dict`.\n\nFor pushing to trac, perhaps check that your public key on trac? Perhaps something got changed on your computer too?",
    "created_at": "2022-01-31T00:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470183",
    "user": "https://github.com/tscrim"
}
```

This is good to add. I think we should have a shortcut for scalars of the identity when `1` is a basis element (via `one_basis()`).

Since from-category methods are low in the MRO, there shouldn't be any danger of overshadowing more specific implementations.

How could this fail to find an inverse when one did exist? I imagine there has to be some condition on the ground ring.

We probably should also force the coefficients into the base ring (which will fail when it has say 1/2 when over **Z** as it should). I would add a `coerce=False` (to keep the current optimized behavior in the code elsewhere) to `from_vector` that passes that off to `_from_dict`.

For pushing to trac, perhaps check that your public key on trac? Perhaps something got changed on your computer too?



---

archive/issue_comments_470184.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> This is good to add. I think we should have a shortcut for scalars of the identity when `1` is a basis element (via `one_basis()`).\n\nThanks. Should we just check for the case when both `self` and `alg.one()` have length 1 (I assume we can use `len()` to get the number of nonzero coefficients, right?) and divide the coefficients?\n\n> Since from-category methods are low in the MRO, there shouldn't be any danger of overshadowing more specific implementations.\n\nI hope so, but I'm worried that some categories themselves might be specific (e.g., what if we have some kind of, say, \"division rings\" category that has its own implementation of inverses?).\n\n> How could this fail to find an inverse when one did exist? I imagine there has to be some condition on the ground ring.\n\nThat would happen if the ground ring doesn't know enough linear algebra to support `solve_right`. I'm not sure what a good example would be.\n\n> We probably should also force the coefficients into the base ring (which will fail when it has say 1/2 when over **Z** as it should). I would add a `coerce=False` (to keep the current optimized behavior in the code elsewhere) to `from_vector` that passes that off to `_from_dict`.\n\nYeah, that sounds reasonable.\n\n> For pushing to trac, perhaps check that your public key on trac? Perhaps something got changed on your computer too?\n\nMy key is on trac, but yes, something changed on my computer (recent reinstall), and something seems to have changed on the server as well (the change from git:// to https://). I'd be happy to discuss this over zoom.",
    "created_at": "2022-01-31T09:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470184",
    "user": "https://github.com/darijgr"
}
```

Replying to [comment:4 tscrim]:
> This is good to add. I think we should have a shortcut for scalars of the identity when `1` is a basis element (via `one_basis()`).

Thanks. Should we just check for the case when both `self` and `alg.one()` have length 1 (I assume we can use `len()` to get the number of nonzero coefficients, right?) and divide the coefficients?

> Since from-category methods are low in the MRO, there shouldn't be any danger of overshadowing more specific implementations.

I hope so, but I'm worried that some categories themselves might be specific (e.g., what if we have some kind of, say, "division rings" category that has its own implementation of inverses?).

> How could this fail to find an inverse when one did exist? I imagine there has to be some condition on the ground ring.

That would happen if the ground ring doesn't know enough linear algebra to support `solve_right`. I'm not sure what a good example would be.

> We probably should also force the coefficients into the base ring (which will fail when it has say 1/2 when over **Z** as it should). I would add a `coerce=False` (to keep the current optimized behavior in the code elsewhere) to `from_vector` that passes that off to `_from_dict`.

Yeah, that sounds reasonable.

> For pushing to trac, perhaps check that your public key on trac? Perhaps something got changed on your computer too?

My key is on trac, but yes, something changed on my computer (recent reinstall), and something seems to have changed on the server as well (the change from git:// to https://). I'd be happy to discuss this over zoom.



---

archive/issue_comments_470185.json:
```json
{
    "body": "Here is a trac pushed version of the branch. I made some additional changes, including what I mentioned in comment:4. I also took the opportunity to make sure all implementations of `from_vector()` have the same signature.\n----\nNew commits:",
    "created_at": "2022-02-01T06:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470185",
    "user": "https://github.com/tscrim"
}
```

Here is a trac pushed version of the branch. I made some additional changes, including what I mentioned in comment:4. I also took the opportunity to make sure all implementations of `from_vector()` have the same signature.
----
New commits:



---

archive/issue_comments_470186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-08T00:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470187.json:
```json
{
    "body": "LGTM! If doctests pass, this should be merged.\n\n(To clarify, Travis has reviewed my part of this ticket and I have now reviewed his.)",
    "created_at": "2022-02-08T00:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470187",
    "user": "https://github.com/darijgr"
}
```

LGTM! If doctests pass, this should be merged.

(To clarify, Travis has reviewed my part of this ticket and I have now reviewed his.)



---

archive/issue_comments_470188.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-08T00:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470188",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_470189.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-13T10:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33013#issuecomment-470189",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
