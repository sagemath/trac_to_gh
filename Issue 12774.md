# Issue 12774: Bug in Compositions

Issue created by migration from Trac.

Original creator: chrisjamesberg

Original creation time: 2012-05-13 20:28:59

Assignee: tbd

Keywords: Compositions

When using the optional 'outer' argument, Compositions gives a bug if 'outer' is itself a composition (as opposed to a list). Also needs to be fixed for 'inner'.

For instance:

sage: c = Compositions(3, outer = Composition([3,2]))

sage: for x in c:
....:     print x
....:     
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Applications/sage/devel/sage-combinat/.hg/patches/<ipython console> in <module>()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in __iter__(self)
   1023         args = self.build_args()
   1024         for n in self.n_range:
-> 1025             l =  first(n, *args)
   1026             while l is not None:
   1027                 yield self._element_constructor_(l)

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in first(n, min_length, max_length, floor, ceiling, min_slope, max_slope)
     72             return None
     73 
---> 74         if ceiling(min_length) == 0 and max_slope <= 0:
     75             return None
     76 

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in <lambda>(i)
    994         """
    995         return [self.min_length, self.max_length,
--> 996                 lambda i: self.floor(i-1), lambda i: self.ceiling(i-1),
    997                 self.min_slope, self.max_slope]
    998 

TypeError: 'Composition_class' object is not callable



---

Comment by mhansen created at 2012-05-14 23:33:19

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by mhansen created at 2012-05-14 23:33:19

Changing status from new to needs_review.


---

Comment by andrew.mathas created at 2012-08-22 07:23:23

The documentation on what outer and inner do is not particularly clear to me, so so I think that it would not hurt to explain this better, but I'll leave that decision up to you. 

More importantly, the patch doesn't work when inner is a composition, so I am marking the patch as `needs work`:


```

sage: Compositions(4, inner=Composition([3,1,2])).list()
Traceback (most recent call last):
...
TypeError: 'Composition_class' object is not callable


```


Of course, the fix is trivial: as you did with outer you need to replace line 984 with:

```
inner = list(kwargs['inner'])
```


Cheers,
Andrew


---

Comment by andrew.mathas created at 2012-08-22 07:23:35

Changing status from needs_review to needs_work.


---

Comment by andrew.mathas created at 2012-08-22 07:49:30

Hi Mike,

To save time I just uploaded a reviewer patch which fixes the inner problem above and adds a test for it. If you are happy with this, and if the tests all pass, then I'm happy to give it a positive review.

Andrew

--

For the patchbot:

Apply trac_12946.patch trac_12946-review.patch


---

Comment by andrew.mathas created at 2012-08-22 23:41:02

All of the tests passed so if you are happy with the review patch I'll give this a positive review.

Andrew

Apply trac_12946.patch trac_12946-review.patch


---

Comment by mhansen created at 2012-08-23 04:00:55

Looks good to me.


---

Comment by mhansen created at 2012-08-23 04:00:55

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-08-23 15:07:21

Please add a more proper commit message ("Update of #12946" is quite meaningless).


---

Attachment


---

Attachment

Removing some garbage from the top of the file


---

Comment by mhansen created at 2012-08-23 20:07:19

I've fixed the commit message in  trac_12946-review.patch.


---

Comment by jdemeyer created at 2012-08-27 10:37:12

Resolution: fixed
