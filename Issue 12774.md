# Issue 12774: Bug in Compositions

archive/issues_012774.json:
```json
{
    "body": "Assignee: tbd\n\nKeywords: Compositions\n\nWhen using the optional 'outer' argument, Compositions gives a bug if 'outer' is itself a composition (as opposed to a list). Also needs to be fixed for 'inner'.\n\nFor instance:\n\nsage: c = Compositions(3, outer = Composition([3,2]))\n\nsage: for x in c:\n....:     print x\n....:     \n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Applications/sage/devel/sage-combinat/.hg/patches/<ipython console> in <module>()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in __iter__(self)\n   1023         args = self.build_args()\n   1024         for n in self.n_range:\n-> 1025             l =  first(n, *args)\n   1026             while l is not None:\n   1027                 yield self._element_constructor_(l)\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in first(n, min_length, max_length, floor, ceiling, min_slope, max_slope)\n     72             return None\n     73 \n---> 74         if ceiling(min_length) == 0 and max_slope <= 0:\n     75             return None\n     76 \n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in <lambda>(i)\n    994         \"\"\"\n    995         return [self.min_length, self.max_length,\n--> 996                 lambda i: self.floor(i-1), lambda i: self.ceiling(i-1),\n    997                 self.min_slope, self.max_slope]\n    998 \n\nTypeError: 'Composition_class' object is not callable\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12946\n\n",
    "created_at": "2012-05-13T20:28:59Z",
    "labels": [
        "PLEASE CHANGE",
        "minor",
        "bug"
    ],
    "title": "Bug in Compositions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12774",
    "user": "chrisjamesberg"
}
```
Assignee: tbd

Keywords: Compositions

When using the optional 'outer' argument, Compositions gives a bug if 'outer' is itself a composition (as opposed to a list). Also needs to be fixed for 'inner'.

For instance:

sage: c = Compositions(3, outer = Composition([3,2]))

sage: for x in c:
....:     print x
....:     
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Applications/sage/devel/sage-combinat/.hg/patches/<ipython console> in <module>()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in __iter__(self)
   1023         args = self.build_args()
   1024         for n in self.n_range:
-> 1025             l =  first(n, *args)
   1026             while l is not None:
   1027                 yield self._element_constructor_(l)

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in first(n, min_length, max_length, floor, ceiling, min_slope, max_slope)
     72             return None
     73 
---> 74         if ceiling(min_length) == 0 and max_slope <= 0:
     75             return None
     76 

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in <lambda>(i)
    994         """
    995         return [self.min_length, self.max_length,
--> 996                 lambda i: self.floor(i-1), lambda i: self.ceiling(i-1),
    997                 self.min_slope, self.max_slope]
    998 

TypeError: 'Composition_class' object is not callable


Issue created by migration from https://trac.sagemath.org/ticket/12946





---

archive/issue_comments_153168.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2012-05-14T23:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153168",
    "user": "mhansen"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_153169.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-14T23:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153169",
    "user": "mhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153170.json:
```json
{
    "body": "The documentation on what outer and inner do is not particularly clear to me, so so I think that it would not hurt to explain this better, but I'll leave that decision up to you. \n\nMore importantly, the patch doesn't work when inner is a composition, so I am marking the patch as `needs work`:\n\n\n```\n\nsage: Compositions(4, inner=Composition([3,1,2])).list()\nTraceback (most recent call last):\n...\nTypeError: 'Composition_class' object is not callable\n\n\n```\n\n\nOf course, the fix is trivial: as you did with outer you need to replace line 984 with:\n\n```\ninner = list(kwargs['inner'])\n```\n\n\nCheers,\nAndrew",
    "created_at": "2012-08-22T07:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153170",
    "user": "andrew.mathas"
}
```

The documentation on what outer and inner do is not particularly clear to me, so so I think that it would not hurt to explain this better, but I'll leave that decision up to you. 

More importantly, the patch doesn't work when inner is a composition, so I am marking the patch as `needs work`:


```

sage: Compositions(4, inner=Composition([3,1,2])).list()
Traceback (most recent call last):
...
TypeError: 'Composition_class' object is not callable


```


Of course, the fix is trivial: as you did with outer you need to replace line 984 with:

```
inner = list(kwargs['inner'])
```


Cheers,
Andrew



---

archive/issue_comments_153171.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-22T07:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153171",
    "user": "andrew.mathas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153172.json:
```json
{
    "body": "Hi Mike,\n\nTo save time I just uploaded a reviewer patch which fixes the inner problem above and adds a test for it. If you are happy with this, and if the tests all pass, then I'm happy to give it a positive review.\n\nAndrew\n\n--\n\nFor the patchbot:\n\nApply trac_12946.patch trac_12946-review.patch",
    "created_at": "2012-08-22T07:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153172",
    "user": "andrew.mathas"
}
```

Hi Mike,

To save time I just uploaded a reviewer patch which fixes the inner problem above and adds a test for it. If you are happy with this, and if the tests all pass, then I'm happy to give it a positive review.

Andrew

--

For the patchbot:

Apply trac_12946.patch trac_12946-review.patch



---

archive/issue_comments_153173.json:
```json
{
    "body": "All of the tests passed so if you are happy with the review patch I'll give this a positive review.\n\nAndrew\n\nApply trac_12946.patch trac_12946-review.patch",
    "created_at": "2012-08-22T23:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153173",
    "user": "andrew.mathas"
}
```

All of the tests passed so if you are happy with the review patch I'll give this a positive review.

Andrew

Apply trac_12946.patch trac_12946-review.patch



---

archive/issue_comments_153174.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2012-08-23T04:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153174",
    "user": "mhansen"
}
```

Looks good to me.



---

archive/issue_comments_153175.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-08-23T04:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153175",
    "user": "mhansen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_153176.json:
```json
{
    "body": "Please add a more proper commit message (\"Update of #12946\" is quite meaningless).",
    "created_at": "2012-08-23T15:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153176",
    "user": "jdemeyer"
}
```

Please add a more proper commit message ("Update of #12946" is quite meaningless).



---

archive/issue_comments_153177.json:
```json
{
    "body": "Attachment [trac_12946.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946.patch) by mhansen created at 2012-08-23 20:05:23",
    "created_at": "2012-08-23T20:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153177",
    "user": "mhansen"
}
```

Attachment [trac_12946.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946.patch) by mhansen created at 2012-08-23 20:05:23



---

archive/issue_comments_153178.json:
```json
{
    "body": "Attachment [trac_12946-review.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946-review.patch) by mhansen created at 2012-08-23 20:06:24\n\nRemoving some garbage from the top of the file",
    "created_at": "2012-08-23T20:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153178",
    "user": "mhansen"
}
```

Attachment [trac_12946-review.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946-review.patch) by mhansen created at 2012-08-23 20:06:24

Removing some garbage from the top of the file



---

archive/issue_comments_153179.json:
```json
{
    "body": "I've fixed the commit message in  trac_12946-review.patch.",
    "created_at": "2012-08-23T20:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153179",
    "user": "mhansen"
}
```

I've fixed the commit message in  trac_12946-review.patch.



---

archive/issue_comments_153180.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-27T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12774#issuecomment-153180",
    "user": "jdemeyer"
}
```

Resolution: fixed
