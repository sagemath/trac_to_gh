# Issue 20893: Cleaning fileserver.sagemath.org for optional packages

archive/issues_020893.json:
```json
{
    "body": "CC:  jdemeyer schilly jhpalmieri\n\nThe pages http://files.sagemath.org/spkg/optional/list and http://files.sagemath.org/spkg/optional/ contain outdated information. The following are now new style packages\n- coxeter3-1.1 (in #19178)\n- database_jones_numfield-v4 (in #19174)\n- database_kohel-20060803 (in #21086)\n- lie-2.2.2.p5 (? moved in experimental in #19781)\n- ore_algebra-0.2 (#19175)\n- pyx-0.10 (#21076)\n- TOPCOM-0.17.4 (now lower case topcom)\n\nI am not sure about what should be done with pip packages\n- beautifulsoup-3.2.1\n- biopython-1.61\n- brian-1.4.1.p0\n- guppy-0.1.8\n- mpi4py-1.2.2\n- pybtex-20120618\n- trac-0.11.5.p0\n\nIssue created by migration from https://trac.sagemath.org/ticket/21130\n\n",
    "created_at": "2016-07-29T15:41:19Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Cleaning fileserver.sagemath.org for optional packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20893",
    "user": "vdelecroix"
}
```
CC:  jdemeyer schilly jhpalmieri

The pages http://files.sagemath.org/spkg/optional/list and http://files.sagemath.org/spkg/optional/ contain outdated information. The following are now new style packages
- coxeter3-1.1 (in #19178)
- database_jones_numfield-v4 (in #19174)
- database_kohel-20060803 (in #21086)
- lie-2.2.2.p5 (? moved in experimental in #19781)
- ore_algebra-0.2 (#19175)
- pyx-0.10 (#21076)
- TOPCOM-0.17.4 (now lower case topcom)

I am not sure about what should be done with pip packages
- beautifulsoup-3.2.1
- biopython-1.61
- brian-1.4.1.p0
- guppy-0.1.8
- mpi4py-1.2.2
- pybtex-20120618
- trac-0.11.5.p0

Issue created by migration from https://trac.sagemath.org/ticket/21130





---

archive/issue_comments_288896.json:
```json
{
    "body": "I think the pip packages can be removed from the server: users can download and install them using `sage -i ...`, which should use pip.",
    "created_at": "2016-07-29T17:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288896",
    "user": "jhpalmieri"
}
```

I think the pip packages can be removed from the server: users can download and install them using `sage -i ...`, which should use pip.



---

archive/issue_comments_288897.json:
```json
{
    "body": "I think so. One difference will be that the package names will not appear anymore with `$ sage -optional`. However, that script that list packages would be easily changed. But since pip type is transitional I am not sure it is what we want.",
    "created_at": "2016-07-29T18:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288897",
    "user": "dmuthiah"
}
```

I think so. One difference will be that the package names will not appear anymore with `$ sage -optional`. However, that script that list packages would be easily changed. But since pip type is transitional I am not sure it is what we want.



---

archive/issue_comments_288898.json:
```json
{
    "body": "See #19213.",
    "created_at": "2016-07-29T18:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288898",
    "user": "jhpalmieri"
}
```

See #19213.



---

archive/issue_comments_288899.json:
```json
{
    "body": "Replying to [ticket:21130 vdelecroix (ticket description)]:\n> See also #21130\n\n???\n\n----\n\nYou (or we) shouldn't search for optional packages in `spkg/optional/` **unless** there's no new-style version of a package.\n\nAll packages below `spkg/` are for \"backwards-compatibility\", i.e., older versions of Sage.\n\nAt some point, all old-style packages should be converted, such that we can (in principle) disable the installation of legacy spkgs into newer versions of Sage.\n\n----\n\nAs you may know, I've always been against the \"unified repo\" as is (tying any spkg to specific Sage versions and vice versa, and offering only a single version of each at the same time), which is completely against the original philosophy (that anybody could offer *his/her* spkg, most being self-contained, some needing Sage library support of course).\n\nBecause of this, it's difficult to generally disallow the installation of \"old-style\" spkgs, unless or until we have a new format and mechanism for truly \"external\" packages.  (I suggested to split spkgs into two parts, the **S**age **pa**ckage **m**etadata, `.spam`, and an upstream tarball, years ago.  We could still do the same for at least \"external\" packages, namely create/use a tarball with just what is now in `build/pkgs/<pkgname>/`, although a single plain text file \u00e0 la Arch Linux or !Gentoo/Funtoo would be better.)\n\nA related problem is that our build / package system lacks any notion of version requirements, it always [en]forces to use exactly a single specific version of a package, no matter whether that's necessary or not, and true requirements are hardly documented.",
    "created_at": "2016-07-29T18:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288899",
    "user": "leif"
}
```

Replying to [ticket:21130 vdelecroix (ticket description)]:
> See also #21130

???

----

You (or we) shouldn't search for optional packages in `spkg/optional/` **unless** there's no new-style version of a package.

All packages below `spkg/` are for "backwards-compatibility", i.e., older versions of Sage.

At some point, all old-style packages should be converted, such that we can (in principle) disable the installation of legacy spkgs into newer versions of Sage.

----

As you may know, I've always been against the "unified repo" as is (tying any spkg to specific Sage versions and vice versa, and offering only a single version of each at the same time), which is completely against the original philosophy (that anybody could offer *his/her* spkg, most being self-contained, some needing Sage library support of course).

Because of this, it's difficult to generally disallow the installation of "old-style" spkgs, unless or until we have a new format and mechanism for truly "external" packages.  (I suggested to split spkgs into two parts, the **S**age **pa**ckage **m**etadata, `.spam`, and an upstream tarball, years ago.  We could still do the same for at least "external" packages, namely create/use a tarball with just what is now in `build/pkgs/<pkgname>/`, although a single plain text file Ã  la Arch Linux or !Gentoo/Funtoo would be better.)

A related problem is that our build / package system lacks any notion of version requirements, it always [en]forces to use exactly a single specific version of a package, no matter whether that's necessary or not, and true requirements are hardly documented.



---

archive/issue_comments_288900.json:
```json
{
    "body": "Replying to [comment:6 leif]:\n> Replying to [ticket:21130 vdelecroix (ticket description)]:\n> > See also #21130\n> \n> ???\n\nAh ok, fixed now.",
    "created_at": "2016-07-29T18:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288900",
    "user": "leif"
}
```

Replying to [comment:6 leif]:
> Replying to [ticket:21130 vdelecroix (ticket description)]:
> > See also #21130
> 
> ???

Ah ok, fixed now.



---

archive/issue_comments_288901.json:
```json
{
    "body": "Replying to [comment:6 leif]:\n> Replying to [ticket:21130 vdelecroix (ticket description)]:\n\nI did no try to look at `spkg/optional`. I just did `sage -optional` that shows wrong information (e.g. lie being optional but `sage -i lie` install a different experimental package). I want to be able to install all optional packages using `sage -optional` and this is badly broken.\n\nI also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.",
    "created_at": "2016-07-29T18:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288901",
    "user": "dmuthiah"
}
```

Replying to [comment:6 leif]:
> Replying to [ticket:21130 vdelecroix (ticket description)]:

I did no try to look at `spkg/optional`. I just did `sage -optional` that shows wrong information (e.g. lie being optional but `sage -i lie` install a different experimental package). I want to be able to install all optional packages using `sage -optional` and this is badly broken.

I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.



---

archive/issue_comments_288902.json:
```json
{
    "body": "Another consequence of this\n\n```\n$ sage -i brian\n... #snip \n$ sage -optional|grep brian -C1\nboost................................... 1_61_0 (not_installed)\nbrian................................... 1.4.1.p0 (not_installed)\nbuckygen................................ 1.0 (not_installed)\n```\n\nSo +1 from removing pip packages as well...",
    "created_at": "2016-07-29T18:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288902",
    "user": "dmuthiah"
}
```

Another consequence of this

```
$ sage -i brian
... #snip 
$ sage -optional|grep brian -C1
boost................................... 1_61_0 (not_installed)
brian................................... 1.4.1.p0 (not_installed)
buckygen................................ 1.0 (not_installed)
```

So +1 from removing pip packages as well...



---

archive/issue_comments_288903.json:
```json
{
    "body": "Replying to [comment:8 dmuthiah]:\n> Replying to [comment:6 leif]:\n> > Replying to [ticket:21130 vdelecroix (ticket description)]:\n> \n> I did no try to look at `spkg/optional`. I just did `sage -optional` that shows wrong information (e.g. lie being optional but `sage -i lie` install a different experimental package).\n\nThat's because the \"new-style\" package is now categorized \"experimental\".\n\n\\\\\n\n> I want to be able to install all optional packages using `sage -optional` and this is badly broken.\n\nYes, it is.  Not long ago, it kept showing *only* legacy spkgs, now it gives an inconsistent mixture instead of what I mentioned above (namely legacy spkgs iff there's no \"new-style\" version at all).\n\n> I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.\n\nIt's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.",
    "created_at": "2016-07-29T18:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288903",
    "user": "leif"
}
```

Replying to [comment:8 dmuthiah]:
> Replying to [comment:6 leif]:
> > Replying to [ticket:21130 vdelecroix (ticket description)]:
> 
> I did no try to look at `spkg/optional`. I just did `sage -optional` that shows wrong information (e.g. lie being optional but `sage -i lie` install a different experimental package).

That's because the "new-style" package is now categorized "experimental".

\\

> I want to be able to install all optional packages using `sage -optional` and this is badly broken.

Yes, it is.  Not long ago, it kept showing *only* legacy spkgs, now it gives an inconsistent mixture instead of what I mentioned above (namely legacy spkgs iff there's no "new-style" version at all).

> I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.

It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.



---

archive/issue_comments_288904.json:
```json
{
    "body": "Replying to [comment:10 leif]:\n> Replying to [comment:8 dmuthiah]:\n> > Replying to [comment:6 leif]:\n> > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.\n> \n> It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.\n\nWhat do you suggest to fix them?",
    "created_at": "2016-07-29T18:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288904",
    "user": "vdelecroix"
}
```

Replying to [comment:10 leif]:
> Replying to [comment:8 dmuthiah]:
> > Replying to [comment:6 leif]:
> > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.
> 
> It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.

What do you suggest to fix them?



---

archive/issue_comments_288905.json:
```json
{
    "body": "Replying to [comment:11 vdelecroix]:\n> Replying to [comment:10 leif]:\n> > Replying to [comment:8 dmuthiah]:\n> > > Replying to [comment:6 leif]:\n> > > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.\n> > \n> > It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.\n> \n> What do you suggest to fix them?\n\nWhat I said, fix the function showing optional/experimental packages.\n\nStart with `build/pkgs/*` (as we do in `configure`), and if we at all still want to list legacy spkgs as well, only show those from `spkg/*` on files.sagemath.org that are *not* in the local repo (`build/pkgs/`).",
    "created_at": "2016-07-29T18:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288905",
    "user": "leif"
}
```

Replying to [comment:11 vdelecroix]:
> Replying to [comment:10 leif]:
> > Replying to [comment:8 dmuthiah]:
> > > Replying to [comment:6 leif]:
> > > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.
> > 
> > It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.
> 
> What do you suggest to fix them?

What I said, fix the function showing optional/experimental packages.

Start with `build/pkgs/*` (as we do in `configure`), and if we at all still want to list legacy spkgs as well, only show those from `spkg/*` on files.sagemath.org that are *not* in the local repo (`build/pkgs/`).



---

archive/issue_comments_288906.json:
```json
{
    "body": "Replying to [comment:12 leif]:\n> Replying to [comment:11 vdelecroix]:\n> > Replying to [comment:10 leif]:\n> > > Replying to [comment:8 dmuthiah]:\n> > > > Replying to [comment:6 leif]:\n> > > > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.\n> > > \n> > > It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.\n> > \n> > What do you suggest to fix them?\n> \n> What I said, fix the function showing optional/experimental packages.\n> \n> Start with `build/pkgs/*` (as we do in `configure`), and if we at all still want to list legacy spkgs as well, only show those from `spkg/*` on files.sagemath.org that are *not* in the local repo (`build/pkgs/`).\n\nWhat about `TOPCOM` versus `topcom`?",
    "created_at": "2016-07-29T18:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288906",
    "user": "vdelecroix"
}
```

Replying to [comment:12 leif]:
> Replying to [comment:11 vdelecroix]:
> > Replying to [comment:10 leif]:
> > > Replying to [comment:8 dmuthiah]:
> > > > Replying to [comment:6 leif]:
> > > > I also consider the current packaging system as very bad. But this ticket is about cleaning the websites mentioned in the description. And I think cleaning is a good step forward.
> > > 
> > > It's not the *website* that's broken, it's `sage --optional`, `sage --experimental` etc.  We should fix **that**, and not just try to hide the problem by more or less randomly deleting or moving some stuff.
> > 
> > What do you suggest to fix them?
> 
> What I said, fix the function showing optional/experimental packages.
> 
> Start with `build/pkgs/*` (as we do in `configure`), and if we at all still want to list legacy spkgs as well, only show those from `spkg/*` on files.sagemath.org that are *not* in the local repo (`build/pkgs/`).

What about `TOPCOM` versus `topcom`?



---

archive/issue_comments_288907.json:
```json
{
    "body": "TOPCOM is old-style, all new-style packages have all-lowercase.",
    "created_at": "2016-07-29T18:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288907",
    "user": "leif"
}
```

TOPCOM is old-style, all new-style packages have all-lowercase.



---

archive/issue_comments_288908.json:
```json
{
    "body": "(There are probably other packages that got renamed, also by adding or deleting some dashes or underscores, so we perhaps need a short alias list, but in general comparing tolower(name) should suffice.)",
    "created_at": "2016-07-29T18:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288908",
    "user": "leif"
}
```

(There are probably other packages that got renamed, also by adding or deleting some dashes or underscores, so we perhaps need a short alias list, but in general comparing tolower(name) should suffice.)



---

archive/issue_comments_288909.json:
```json
{
    "body": "P.P.S.:  The \"name\" of a new-style package is its folder name in `build/pkgs/` (these contain only `[a-zA-Z0-9_]`), while that of the (upstream) tarball, encrypted in `checksums.ini` -- by the way a wonderful choice, might differ.\n\nOld-style package names are in constrast everything up to the first dash of the filename of the spkg/tarball, more likely to match what is now in `checksums.ini`.",
    "created_at": "2016-07-29T19:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288909",
    "user": "leif"
}
```

P.P.S.:  The "name" of a new-style package is its folder name in `build/pkgs/` (these contain only `[a-zA-Z0-9_]`), while that of the (upstream) tarball, encrypted in `checksums.ini` -- by the way a wonderful choice, might differ.

Old-style package names are in constrast everything up to the first dash of the filename of the spkg/tarball, more likely to match what is now in `checksums.ini`.



---

archive/issue_comments_288910.json:
```json
{
    "body": "And old-style packages usually have a *Sage* patchlevel in addition, `.pN`, right before the `.spkg`, so that should get removed before trying to match names as well.",
    "created_at": "2016-07-29T19:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288910",
    "user": "leif"
}
```

And old-style packages usually have a *Sage* patchlevel in addition, `.pN`, right before the `.spkg`, so that should get removed before trying to match names as well.



---

archive/issue_comments_288911.json:
```json
{
    "body": "It's not just `sage --optional` etc. that may need fixing, it's also `sage -i ...`, which looks at the website for matches. As long as there are valid old-style packages on the website, we should search for them, so we should also clean out the crap on the website so that we don't get incorrect matches. So cleaning the website is a good idea.\n\nBy the way, although the name of each new-style spkg is lowercase, its tarball need not be. Relying on cases to determine whether a package is old or new seems like a dangerous idea.",
    "created_at": "2016-07-29T19:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288911",
    "user": "jhpalmieri"
}
```

It's not just `sage --optional` etc. that may need fixing, it's also `sage -i ...`, which looks at the website for matches. As long as there are valid old-style packages on the website, we should search for them, so we should also clean out the crap on the website so that we don't get incorrect matches. So cleaning the website is a good idea.

By the way, although the name of each new-style spkg is lowercase, its tarball need not be. Relying on cases to determine whether a package is old or new seems like a dangerous idea.



---

archive/issue_comments_288912.json:
```json
{
    "body": "I am cleaning the sage-list-packages script in #19213. Once this is done, the website could be cleaned as well.",
    "created_at": "2016-07-29T20:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288912",
    "user": "vdelecroix"
}
```

I am cleaning the sage-list-packages script in #19213. Once this is done, the website could be cleaned as well.



---

archive/issue_comments_288913.json:
```json
{
    "body": "Replying to [comment:18 jhpalmieri]:\n> It's not just `sage --optional` etc. that may need fixing, it's also `sage -i ...`, which looks at the website for matches.\n\nYes, see below.  We shouldn't have two implementations of the same thing (in addition not acting in the same manner).\n\n\\\\\n\n> As long as there are valid old-style packages on the website, we should search for them, so we should also clean out the crap on the website so that we don't get incorrect matches. So cleaning the website is a good idea.\n\nWhile the last version of Sage without \"new-style\" packages was released quite a while ago, removing anything from `spkg/` breaks all the old versions.  I'm not aware of any announcement regarding that (although it's not unlikely I missed it), but I'm not aware of any \"static\" statement anywhere either.\n\nIf we *do* no longer support older versions, then **wipe out everything** below `spkg/`.\n\nIf there are still valuable optional/experimental packages which (after years?) haven't been converted, that's a bug, and there should be tickets for each.\n\n\\\\\n \n> By the way, although the name of each new-style spkg is lowercase, its tarball need not be. Relying on cases to determine whether a package is old or new seems like a dangerous idea.\n\nI didn't say that.  I meant if you encounter an old-style package (from the file server), strip the version, including the Sage patch level, and of course the extension, convert it to lowercase, and see if that matches any of the folder names in `build/pkgs/`, or everything after the equals sign up to the first dash from the first line (or the line containing `tarball=`) of each `build/pkgs/*/checksum.ini`, again converted to lowercase. [Not *my* design.]  It's presumably sufficient to also simply remove any special characters including underscores; I doubt there will be any name clash of actually *different* packages.\n\nWhat happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...\n\nAnother thing we have to solve is of course any discrepancy between `sage-list-packages` or whatever its name is, and (the behavior of) `sage-spkg`.  Again, the easiest solution is to disable downloading old-style packages (automatically).  That's orthogonal to disallowing *installing* such (`sage -i /path/to/spkg`).",
    "created_at": "2016-07-29T20:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288913",
    "user": "leif"
}
```

Replying to [comment:18 jhpalmieri]:
> It's not just `sage --optional` etc. that may need fixing, it's also `sage -i ...`, which looks at the website for matches.

Yes, see below.  We shouldn't have two implementations of the same thing (in addition not acting in the same manner).

\\

> As long as there are valid old-style packages on the website, we should search for them, so we should also clean out the crap on the website so that we don't get incorrect matches. So cleaning the website is a good idea.

While the last version of Sage without "new-style" packages was released quite a while ago, removing anything from `spkg/` breaks all the old versions.  I'm not aware of any announcement regarding that (although it's not unlikely I missed it), but I'm not aware of any "static" statement anywhere either.

If we *do* no longer support older versions, then **wipe out everything** below `spkg/`.

If there are still valuable optional/experimental packages which (after years?) haven't been converted, that's a bug, and there should be tickets for each.

\\
 
> By the way, although the name of each new-style spkg is lowercase, its tarball need not be. Relying on cases to determine whether a package is old or new seems like a dangerous idea.

I didn't say that.  I meant if you encounter an old-style package (from the file server), strip the version, including the Sage patch level, and of course the extension, convert it to lowercase, and see if that matches any of the folder names in `build/pkgs/`, or everything after the equals sign up to the first dash from the first line (or the line containing `tarball=`) of each `build/pkgs/*/checksum.ini`, again converted to lowercase. [Not *my* design.]  It's presumably sufficient to also simply remove any special characters including underscores; I doubt there will be any name clash of actually *different* packages.

What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...

Another thing we have to solve is of course any discrepancy between `sage-list-packages` or whatever its name is, and (the behavior of) `sage-spkg`.  Again, the easiest solution is to disable downloading old-style packages (automatically).  That's orthogonal to disallowing *installing* such (`sage -i /path/to/spkg`).



---

archive/issue_comments_288914.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> Replying to [comment:18 jhpalmieri]:\n> What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...\n\nStill there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.",
    "created_at": "2016-07-29T21:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288914",
    "user": "vdelecroix"
}
```

Replying to [comment:20 leif]:
> Replying to [comment:18 jhpalmieri]:
> What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...

Still there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.



---

archive/issue_comments_288915.json:
```json
{
    "body": "Replying to [comment:21 vdelecroix]:\n> Replying to [comment:20 leif]:\n> > Replying to [comment:18 jhpalmieri]:\n> > What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...\n> \n> Still there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.\n\nSince we meanwhile (rather \"by accident\") require a *system python* (>=2.6) anyway, if the python files there are stand-alone (i.e., do not need the Sage *library*), you could use them from `sage-spkg` as well.",
    "created_at": "2016-07-29T22:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288915",
    "user": "leif"
}
```

Replying to [comment:21 vdelecroix]:
> Replying to [comment:20 leif]:
> > Replying to [comment:18 jhpalmieri]:
> > What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...
> 
> Still there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.

Since we meanwhile (rather "by accident") require a *system python* (>=2.6) anyway, if the python files there are stand-alone (i.e., do not need the Sage *library*), you could use them from `sage-spkg` as well.



---

archive/issue_comments_288916.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> Replying to [comment:21 vdelecroix]:\n> > Replying to [comment:20 leif]:\n> > > Replying to [comment:18 jhpalmieri]:\n> > > What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...\n> > \n> > Still there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.\n> \n> Since we meanwhile (rather \"by accident\") require a *system python* (>=2.6) anyway, if the python files there are stand-alone (i.e., do not need the Sage *library*), you could use them from `sage-spkg` as well.\n\nIt is more or less standalone: only needs various variables from `sage.env`.",
    "created_at": "2016-07-29T22:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288916",
    "user": "vdelecroix"
}
```

Replying to [comment:22 leif]:
> Replying to [comment:21 vdelecroix]:
> > Replying to [comment:20 leif]:
> > > Replying to [comment:18 jhpalmieri]:
> > > What happened to the work of Nathann and others (about a year ago IIRC)?  We have been dealing with this a couple of times in the past...
> > 
> > Still there and useful `sage.misc.package`. I am cleaning, updating this file in #19213.
> 
> Since we meanwhile (rather "by accident") require a *system python* (>=2.6) anyway, if the python files there are stand-alone (i.e., do not need the Sage *library*), you could use them from `sage-spkg` as well.

It is more or less standalone: only needs various variables from `sage.env`.



---

archive/issue_comments_288917.json:
```json
{
    "body": "But since we won't upload any new old-style packages (I guess), we could use a *static* list of everything what's currently there (or worth to be kept / installed) anyway.  Never ever looking at `spkg/{optional,experimental,huge}/list` again.",
    "created_at": "2016-07-29T22:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288917",
    "user": "leif"
}
```

But since we won't upload any new old-style packages (I guess), we could use a *static* list of everything what's currently there (or worth to be kept / installed) anyway.  Never ever looking at `spkg/{optional,experimental,huge}/list` again.



---

archive/issue_comments_288918.json:
```json
{
    "body": "This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.",
    "created_at": "2016-07-29T22:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288918",
    "user": "vdelecroix"
}
```

This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.



---

archive/issue_comments_288919.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.\n\nWhy not directly move them into `build/pkgs/` (with their \"simplified\" names), putting `legacy` into `type`, `tarball=...` (and checksums) into `checksums.ini`, what we consider the version into `package-version.txt`, and if one downloads them, into `upstream/` as usual.  (You could even already extract `spkg-{install,check}` and `SPKG.txt`.)\n\nThen conversion will probably happen sooner...",
    "created_at": "2016-07-29T22:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288919",
    "user": "leif"
}
```

Replying to [comment:25 vdelecroix]:
> This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.

Why not directly move them into `build/pkgs/` (with their "simplified" names), putting `legacy` into `type`, `tarball=...` (and checksums) into `checksums.ini`, what we consider the version into `package-version.txt`, and if one downloads them, into `upstream/` as usual.  (You could even already extract `spkg-{install,check}` and `SPKG.txt`.)

Then conversion will probably happen sooner...



---

archive/issue_comments_288920.json:
```json
{
    "body": "Replying to [comment:26 leif]:\n> Replying to [comment:25 vdelecroix]:\n> > This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.\n> \n> Why not directly move them into `build/pkgs/` (with their \"simplified\" names), putting `legacy` into `type`, `tarball=...` (and checksums) into `checksums.ini`, what we consider the version into `package-version.txt`, and if one downloads them, into `upstream/` as usual.  (You could even already extract `spkg-{install,check}` and `SPKG.txt`.)\n> \n> Then conversion will probably happen sooner...\n\nI like very much the idea. But out of scope of #19213... I am opening a ticket for this which will be a dependency of #19213.",
    "created_at": "2016-07-29T22:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288920",
    "user": "vdelecroix"
}
```

Replying to [comment:26 leif]:
> Replying to [comment:25 vdelecroix]:
> > This is exactly what I proposed in #19213: two files `build/old_style_packages_optional` and `build/old_style_packages_experimental`. And I would actually be happier if we move all old style optional to experimental.
> 
> Why not directly move them into `build/pkgs/` (with their "simplified" names), putting `legacy` into `type`, `tarball=...` (and checksums) into `checksums.ini`, what we consider the version into `package-version.txt`, and if one downloads them, into `upstream/` as usual.  (You could even already extract `spkg-{install,check}` and `SPKG.txt`.)
> 
> Then conversion will probably happen sooner...

I like very much the idea. But out of scope of #19213... I am opening a ticket for this which will be a dependency of #19213.



---

archive/issue_comments_288921.json:
```json
{
    "body": "Why is this not a duplicate of #19220?",
    "created_at": "2016-07-30T07:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288921",
    "user": "jdemeyer"
}
```

Why is this not a duplicate of #19220?



---

archive/issue_comments_288922.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> Why is this not a duplicate of #19220?\n\nI guess because #19220 deals with throwing some away, while we here (or on #19213) try to keep the valuable ones, but presumably not by leaving them a) there b) as they are, which may also involve changes to the build system (perhaps on follow-ups though)...",
    "created_at": "2016-07-30T17:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288922",
    "user": "leif"
}
```

Replying to [comment:28 jdemeyer]:
> Why is this not a duplicate of #19220?

I guess because #19220 deals with throwing some away, while we here (or on #19213) try to keep the valuable ones, but presumably not by leaving them a) there b) as they are, which may also involve changes to the build system (perhaps on follow-ups though)...



---

archive/issue_comments_288923.json:
```json
{
    "body": "Or maybe not...  I actually missed the ticket references in the description, but for a couple it's not obvious what the tickets actually achieve, i.e., whether a closed ticket there really means *\"we can safely delete that package\"* (for newer versions of Sage at least), or whether when all tickets referenced in the description are merged, *\"stop looking for packages in `spkg/`\"* in `sage-spkg` as well as the scripts / code listing packages.",
    "created_at": "2016-07-30T17:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288923",
    "user": "leif"
}
```

Or maybe not...  I actually missed the ticket references in the description, but for a couple it's not obvious what the tickets actually achieve, i.e., whether a closed ticket there really means *"we can safely delete that package"* (for newer versions of Sage at least), or whether when all tickets referenced in the description are merged, *"stop looking for packages in `spkg/`"* in `sage-spkg` as well as the scripts / code listing packages.



---

archive/issue_comments_288924.json:
```json
{
    "body": "P.S.:  There's no point in moving packages when we simply stop looking there, which doesn't require completely converting all of them to (fully) new-style packages, and that's the subject here, not on #19220 I'd say.",
    "created_at": "2016-07-30T17:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288924",
    "user": "leif"
}
```

P.S.:  There's no point in moving packages when we simply stop looking there, which doesn't require completely converting all of them to (fully) new-style packages, and that's the subject here, not on #19220 I'd say.



---

archive/issue_comments_288925.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-01T06:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288925",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288926.json:
```json
{
    "body": "The list of packages here is a subset of #19220, so this is just a duplicate of #19220.",
    "created_at": "2016-08-01T06:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288926",
    "user": "jdemeyer"
}
```

The list of packages here is a subset of #19220, so this is just a duplicate of #19220.



---

archive/issue_comments_288927.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-01T06:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288927",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288928.json:
```json
{
    "body": "Determined to be invalid/duplicate/wontfix (closing as \"wontfix\" as a catch-all resolution).",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288928",
    "user": "embray"
}
```

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).



---

archive/issue_comments_288929.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-288929",
    "user": "embray"
}
```

Resolution: wontfix
