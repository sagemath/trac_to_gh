# Issue 18187: The ntl-interface test for flint 2.4.5 is broken

archive/issues_018187.json:
```json
{
    "body": "flint 2.4.5 (and 2.4.4 at least) fail its test suite when building the ntl-interface test\n\n```\n/make[4]: Entering directory\n'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'\n   CXX   build/interfaces/test/t-NTL-interface\ng++: error: build/interfaces/NTL-interface.o: No such file or directory\nMakefile:248: recipe for target 'build/interfaces/test/t-NTL-interface'\nfailed\nmake[4]: *** [build/interfaces/test/t-NTL-interface] Error 1\nmake[4]: Leaving directory\n'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'\n/bin/sh: 3: build/interfaces/test/t-NTL-interface: not found\nMakefile:182: recipe for target 'check' failed\nmake[3]: *** [check] Error 127\nmake[3]: Leaving directory\n'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'\nError: FLINT failed to pass its test suite.\n```\n\nsage-on-gentoo and now Gentoo proper have carried a patch for the issue for some time now. See\nhttps://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sci-mathematics/flint/files/flint-2.4.4-test.patch?view=markup\n\nIssue created by migration from https://trac.sagemath.org/ticket/18424\n\n",
    "created_at": "2015-05-15T06:52:17Z",
    "labels": [
        "spkg-check",
        "major",
        "bug"
    ],
    "title": "The ntl-interface test for flint 2.4.5 is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18187",
    "user": "fbissey"
}
```
flint 2.4.5 (and 2.4.4 at least) fail its test suite when building the ntl-interface test

```
/make[4]: Entering directory
'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'
   CXX   build/interfaces/test/t-NTL-interface
g++: error: build/interfaces/NTL-interface.o: No such file or directory
Makefile:248: recipe for target 'build/interfaces/test/t-NTL-interface'
failed
make[4]: *** [build/interfaces/test/t-NTL-interface] Error 1
make[4]: Leaving directory
'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'
/bin/sh: 3: build/interfaces/test/t-NTL-interface: not found
Makefile:182: recipe for target 'check' failed
make[3]: *** [check] Error 127
make[3]: Leaving directory
'/home/laurent/sage-6.6-src/sage-6.6/local/var/tmp/sage/build/flint-2.4.5/src'
Error: FLINT failed to pass its test suite.
```

sage-on-gentoo and now Gentoo proper have carried a patch for the issue for some time now. See
https://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sci-mathematics/flint/files/flint-2.4.4-test.patch?view=markup

Issue created by migration from https://trac.sagemath.org/ticket/18424





---

archive/issue_comments_245369.json:
```json
{
    "body": "I will create a branch with the appropriate patch in a couple of hours.",
    "created_at": "2015-05-15T06:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245369",
    "user": "fbissey"
}
```

I will create a branch with the appropriate patch in a couple of hours.



---

archive/issue_comments_245370.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-15T07:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245370",
    "user": "fbissey"
}
```

New commits:



---

archive/issue_comments_245371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-15T07:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245371",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245372.json:
```json
{
    "body": "The proper fix is IMHO not to rename the file, but to add a dependency:\n\n```patch\n--- flint-2.4.5/Makefile.in\t2015-02-17 15:56:55.000000000 +0100\n+++ flint-2.4.5/Makefile.in\t2015-05-15 15:41:47.203690000 +0200\n@@ -211,7 +211,7 @@\n build/interfaces/NTL-interface.o: interfaces/NTL-interface.cpp NTL-interface.h\n \t$(QUIET_CXX) $(CXX) $(CFLAGS) $(INCS) -c $< -o $@;\n \n-build/interfaces/test/t-NTL-interface$(EXEEXT): interfaces/test/t-NTL-interface.cpp\n+build/interfaces/test/t-NTL-interface$(EXEEXT): interfaces/test/t-NTL-interface.cpp build/interfaces/NTL-interface.o\n \t$(QUIET_CXX) $(CXX) $(CFLAGS) $(INCS) $< build/interfaces/NTL-interface.o -o $@ $(LIBS);\n \n print-%:\n```\n\n\nNice Makefile btw. ... B-)",
    "created_at": "2015-05-15T14:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245372",
    "user": "leif"
}
```

The proper fix is IMHO not to rename the file, but to add a dependency:

```patch
--- flint-2.4.5/Makefile.in	2015-02-17 15:56:55.000000000 +0100
+++ flint-2.4.5/Makefile.in	2015-05-15 15:41:47.203690000 +0200
@@ -211,7 +211,7 @@
 build/interfaces/NTL-interface.o: interfaces/NTL-interface.cpp NTL-interface.h
 	$(QUIET_CXX) $(CXX) $(CFLAGS) $(INCS) -c $< -o $@;
 
-build/interfaces/test/t-NTL-interface$(EXEEXT): interfaces/test/t-NTL-interface.cpp
+build/interfaces/test/t-NTL-interface$(EXEEXT): interfaces/test/t-NTL-interface.cpp build/interfaces/NTL-interface.o
 	$(QUIET_CXX) $(CXX) $(CFLAGS) $(INCS) $< build/interfaces/NTL-interface.o -o $@ $(LIBS);
 
 print-%:
```


Nice Makefile btw. ... B-)



---

archive/issue_comments_245373.json:
```json
{
    "body": "Pretty embarrassing this already went into a stable Sage release, apparently without anybody even noticing.",
    "created_at": "2015-05-15T14:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245373",
    "user": "leif"
}
```

Pretty embarrassing this already went into a stable Sage release, apparently without anybody even noticing.



---

archive/issue_comments_245374.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-05-15T14:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245374",
    "user": "leif"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_245375.json:
```json
{
    "body": "Changing keywords from \"\" to \"NTL-interface.o check\".",
    "created_at": "2015-05-15T14:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245375",
    "user": "leif"
}
```

Changing keywords from "" to "NTL-interface.o check".



---

archive/issue_comments_245376.json:
```json
{
    "body": "Changing component from spkg-check to packages: standard.",
    "created_at": "2015-05-15T14:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245376",
    "user": "leif"
}
```

Changing component from spkg-check to packages: standard.



---

archive/issue_comments_245377.json:
```json
{
    "body": "Reported upstream yet?",
    "created_at": "2015-05-15T15:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245377",
    "user": "cremona"
}
```

Reported upstream yet?



---

archive/issue_comments_245378.json:
```json
{
    "body": "Replying to [comment:7 cremona]:\n> Reported upstream yet?\n\nNo idea; I can't imagine they haven't meanwhile noticed themselves...  (although not everybody builds the NTL interface)",
    "created_at": "2015-05-15T15:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245378",
    "user": "leif"
}
```

Replying to [comment:7 cremona]:
> Reported upstream yet?

No idea; I can't imagine they haven't meanwhile noticed themselves...  (although not everybody builds the NTL interface)



---

archive/issue_comments_245379.json:
```json
{
    "body": "Looks like the bug was still there:\n\n[https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234](https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234)",
    "created_at": "2015-05-15T15:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245379",
    "user": "leif"
}
```

Looks like the bug was still there:

[https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234](https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234)



---

archive/issue_comments_245380.json:
```json
{
    "body": "Replying to [comment:9 leif]:\n> Looks like the bug was still there:\n> \n> [https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234](https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234)\n\nSorry, misread that.  They just renamed the file, but didn't add a dependency, so it's half-fixed upstream.",
    "created_at": "2015-05-15T15:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245380",
    "user": "leif"
}
```

Replying to [comment:9 leif]:
> Looks like the bug was still there:
> 
> [https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234](https://github.com/wbhart/flint2/blob/trunk/Makefile.in#L234)

Sorry, misread that.  They just renamed the file, but didn't add a dependency, so it's half-fixed upstream.



---

archive/issue_comments_245381.json:
```json
{
    "body": "There's no corresponding issue on github I could comment on, just the commit by the author of the Gentoo patch.",
    "created_at": "2015-05-15T16:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245381",
    "user": "leif"
}
```

There's no corresponding issue on github I could comment on, just the commit by the author of the Gentoo patch.



---

archive/issue_comments_245382.json:
```json
{
    "body": "Actually the patch is originally mine. The name on the patch is the guy who committed it to the main tree. I found my original bug report for it with some explanations.\nhttps://bugs.gentoo.org/show_bug.cgi?id=516028\n\nI didn't report it upstream because I couldn't reproduce it from a plain upstream tarball. By default upstream builds static stuff and if you do that there is no problem. Originally it wasn't present in sage either, I'd have to check but at some point we must have stopped building static libraries or objects in flint. It only happens when you build shared libraries exclusively.",
    "created_at": "2015-05-15T19:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245382",
    "user": "fbissey"
}
```

Actually the patch is originally mine. The name on the patch is the guy who committed it to the main tree. I found my original bug report for it with some explanations.
https://bugs.gentoo.org/show_bug.cgi?id=516028

I didn't report it upstream because I couldn't reproduce it from a plain upstream tarball. By default upstream builds static stuff and if you do that there is no problem. Originally it wasn't present in sage either, I'd have to check but at some point we must have stopped building static libraries or objects in flint. It only happens when you build shared libraries exclusively.



---

archive/issue_comments_245383.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> I didn't report it upstream because I couldn't reproduce it from a plain upstream tarball. By default upstream builds static stuff and if you do that there is no problem. Originally it wasn't present in sage either, I'd have to check but at some point we must have stopped building static libraries or objects in flint. It only happens when you build shared libraries exclusively.\n\n```\ncommit 6f2750ed7bfb5caf1be3b47ead442e402b667db4\nAuthor: Volker Braun <vbraun.name@gmail.com>\nDate:   Thu Oct 2 15:18:09 2014 +0100\n\n    Never build static library\n\n```\n\nWho else...\n\n\n\n\nI'll polish my patch a bit since `t-NTL-interface$(EXEEXT)` should also depend on `$(LIBS)` (and the trailing semicolon doesn't make sense either), then submit it upstream I think.",
    "created_at": "2015-05-15T19:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245383",
    "user": "leif"
}
```

Replying to [comment:12 fbissey]:
> I didn't report it upstream because I couldn't reproduce it from a plain upstream tarball. By default upstream builds static stuff and if you do that there is no problem. Originally it wasn't present in sage either, I'd have to check but at some point we must have stopped building static libraries or objects in flint. It only happens when you build shared libraries exclusively.

```
commit 6f2750ed7bfb5caf1be3b47ead442e402b667db4
Author: Volker Braun <vbraun.name@gmail.com>
Date:   Thu Oct 2 15:18:09 2014 +0100

    Never build static library

```

Who else...




I'll polish my patch a bit since `t-NTL-interface$(EXEEXT)` should also depend on `$(LIBS)` (and the trailing semicolon doesn't make sense either), then submit it upstream I think.



---

archive/issue_comments_245384.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> I'll polish my patch a bit since `t-NTL-interface$(EXEEXT)` should also depend on `$(LIBS)` (and the trailing semicolon doesn't make sense either), then submit it upstream I think.\n\nAh, no, `$(LIBS)` contains chains of `-L/path/to/foo -lfoo`, so it should -- if at all explicitly -- depend on `library`.  (But `t-NTL-interface` is made in a rule which in turn already depends on `library`, namely `check`, so we don't really have to add it.)",
    "created_at": "2015-05-16T12:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245384",
    "user": "leif"
}
```

Replying to [comment:13 leif]:
> I'll polish my patch a bit since `t-NTL-interface$(EXEEXT)` should also depend on `$(LIBS)` (and the trailing semicolon doesn't make sense either), then submit it upstream I think.

Ah, no, `$(LIBS)` contains chains of `-L/path/to/foo -lfoo`, so it should -- if at all explicitly -- depend on `library`.  (But `t-NTL-interface` is made in a rule which in turn already depends on `library`, namely `check`, so we don't really have to add it.)



---

archive/issue_comments_245385.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-17T10:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245385",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245386.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-17T10:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245386",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_245387.json:
```json
{
    "body": "FWIW, a proper fix is now in trunk, so we can remove the patch on the next upgrade.",
    "created_at": "2015-05-20T12:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18187#issuecomment-245387",
    "user": "leif"
}
```

FWIW, a proper fix is now in trunk, so we can remove the patch on the next upgrade.
