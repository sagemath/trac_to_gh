# Issue 21272: Install cython_debug somewhere in SAGE_LOCAL

Issue created by migration from https://trac.sagemath.org/ticket/21509

Original creator: mkoeppe

Original creation time: 2016-09-16 22:17:37

CC:  fbissey

fbissey [proposes](https://trac.sagemath.org/ticket/21480#comment:88) to install cython_debug somewhere in SAGE_LOCAL because it is needed for debugging.


---

Comment by mkoeppe created at 2016-09-17 05:13:52

Can you explain what 'cython_debug' is used for precisely, in the description? (Or point to a reference?)


---

Comment by jdemeyer created at 2016-09-29 15:16:18

Replying to [comment:3 mkoeppe]:
> Can you explain what 'cython_debug' is used for precisely, in the description? (Or point to a reference?)

It is used by https://github.com/sagemath/cysignals/blob/master/src/scripts/cysignals-CSI-helper.py#L43


---

Comment by jdemeyer created at 2016-09-29 15:33:54

Replying to [ticket:21509 mkoeppe]:
> fbissey [proposes](https://trac.sagemath.org/ticket/21480#comment:88) to install cython_debug somewhere in SAGE_LOCAL because it is needed for debugging at runtime.

See #21480#comment:127 where I question this proposal.


---

Comment by jdemeyer created at 2018-02-10 11:44:51

New commits:


---

Comment by git created at 2018-02-10 12:00:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-02-10 12:28:40

Changing status from new to needs_review.


---

Comment by fbissey created at 2018-02-18 22:56:41

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2018-02-18 22:56:41

Let's make some progress here. It needs to go to the bots now.


---

Comment by vbraun created at 2018-02-20 23:07:25

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-02-20 23:07:25

Tests fail on OSX

```
[cysignals-1.6.7] Successfully installed cysignals-1.6.7
[cysignals-1.6.7] Cleaning up...
[cysignals-1.6.7] python -B rundoctests.py src/cysignals/*.pyx
[cysignals-1.6.7] cd example && python setup.py clean build
[cysignals-1.6.7] sigaltstack: Cannot allocate memory
[cysignals-1.6.7] Doctesting 5 files.
[cysignals-1.6.7] make[3]: *** [check-doctest] Error 1
[cysignals-1.6.7] Compiling cysignals_example.pyx because it changed.
[cysignals-1.6.7] [1/1] Cythonizing cysignals_example.pyx
[cysignals-1.6.7] running clean
[cysignals-1.6.7] running build
[cysignals-1.6.7] running build_ext
[cysignals-1.6.7] building 'cysignals_example' extension
[cysignals-1.6.7] creating build
[cysignals-1.6.7] creating build/temp.macosx-10.9-x86_64-2.7
[cysignals-1.6.7] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.cpp -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o
[cysignals-1.6.7] creating build/lib.macosx-10.9-x86_64-2.7
[cysignals-1.6.7] g++ -bundle -undefined dynamic_lookup -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib -L/Users/buildslave-sage/slave/sage_git/build/local/lib -Wl,-rpath,/Users/buildslave-sage/slave/sage_git/build/local/lib build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o -L/Users/buildslave-sage/slave/sage_git/build/local/lib -o build/lib.macosx-10.9-x86_64-2.7/cysignals_example.so -lpari
[cysignals-1.6.7] make[3]: Target `check-install' not remade because of errors.
[cysignals-1.6.7] 
[cysignals-1.6.7] real	0m9.707s
[cysignals-1.6.7] user	0m8.247s
[cysignals-1.6.7] sys	0m1.497s
[cysignals-1.6.7] ************************************************************************
[cysignals-1.6.7] Error testing package cysignals-1.6.7
[cysignals-1.6.7] ************************************************************************
```



---

Comment by jdemeyer created at 2018-02-21 06:24:29

Replying to [comment:16 vbraun]:
> Tests fail on OSX
> {{{
> [cysignals-1.6.7] sigaltstack: Cannot allocate memory
> }}}

That's really strange...


---

Comment by jdemeyer created at 2018-02-21 06:28:07

I see, OS X requires a minimum stack size of 2<sup>15</sup> bytes compared to 2<sup>11</sup> on Linux and I'm using a hardcoded value of 2<sup>14</sup>.


---

Comment by jdemeyer created at 2018-02-22 13:51:45

Fixing the stack size is easy but it's not the only problem. The stack overflow test raises `SIGILL` for some reason...


---

Comment by jdemeyer created at 2018-02-22 14:05:36

Strange... it seems that `test_stack_overflow()` works in the main process but not in a forked child process. Why should that even matter?


---

Comment by jdemeyer created at 2018-02-22 14:24:56

As far as I can tell, this is an OS X bug... `sigaltstack` doesn't survive after a `fork`. It's as if `sigaltstack` was never run.


---

Comment by jdemeyer created at 2018-02-22 15:48:34

Ugh... even after working around that, there are still problems with `sigaltstack`. Once it's on the alt stack, it is stuck running there somehow.


---

Comment by jdemeyer created at 2018-02-22 16:24:08

Why is OS X implementing `sigaltstack` so differently? This even works on Solaris...


---

Comment by git created at 2018-03-08 11:39:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-03-08 11:40:11

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2018-03-08 11:40:11

Fixed cysignals on OS X.


---

Comment by jdemeyer created at 2018-03-13 14:03:19

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-03-13 14:06:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-03-13 14:07:17

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2018-03-13 14:07:17

New release of cysignals.


---

Comment by vbraun created at 2018-03-19 22:01:19

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-03-19 22:01:19

See #21509


---

Comment by vbraun created at 2018-03-19 22:02:02

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-03-21 06:19:06

Resolution: fixed
