# Issue 17945: pushout construction and finding common parents for/including cartesian products

archive/issues_017945.json:
```json
{
    "body": "CC:  @roed314 @behackl\n\nKeywords: sd67, coercion, categories\n\n\n```\nsage: cartesian_product([ZZ]).construction() is None\nTrue\n```\n\nand the coercion model (in partiuclar, the `pushout` function) does not take care of cartesian products. The aim of this ticket is to add functionality for doing so.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18182\n\n",
    "created_at": "2015-04-13T21:34:15Z",
    "labels": [
        "coercion",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "pushout construction and finding common parents for/including cartesian products",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17945",
    "user": "@dkrenn"
}
```
CC:  @roed314 @behackl

Keywords: sd67, coercion, categories


```
sage: cartesian_product([ZZ]).construction() is None
True
```

and the coercion model (in partiuclar, the `pushout` function) does not take care of cartesian products. The aim of this ticket is to add functionality for doing so.

Issue created by migration from https://trac.sagemath.org/ticket/18182





---

archive/issue_comments_241083.json:
```json
{
    "body": "(see also #15425)",
    "created_at": "2015-04-14T08:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241083",
    "user": "@nathanncohen"
}
```

(see also #15425)



---

archive/issue_comments_241084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-20T12:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241084",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241085.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-08-20T12:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241085",
    "user": "@dkrenn"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_241086.json:
```json
{
    "body": "I've reviewed David's part, but I am also an author of this ticket; thus I request an additional reviewer.\n\nNote that there is still one failing doctest, where I don't have any glue why (it is the bug at the very top of the file). Who knows what is going on there?",
    "created_at": "2015-08-20T12:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241086",
    "user": "@dkrenn"
}
```

I've reviewed David's part, but I am also an author of this ticket; thus I request an additional reviewer.

Note that there is still one failing doctest, where I don't have any glue why (it is the bug at the very top of the file). Who knows what is going on there?



---

archive/issue_comments_241087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-20T12:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241087",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-20T12:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241088",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-20T12:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241089",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_241090.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-08-20T12:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241090",
    "user": "@dkrenn"
}
```

New commits:



---

archive/issue_comments_241091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-23T09:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241092.json:
```json
{
    "body": "Replying to [comment:5 dkrenn]:\n> Note that there is still one failing doctest, where I don't have any glue why (it is the bug at the very top of the file). Who knows what is going on there?\n\nKind of fixed; now calling the cartesian product by `cartesian_product`, which produces the correct result.\n\nThere are still two failing doctests.",
    "created_at": "2015-08-23T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241092",
    "user": "@dkrenn"
}
```

Replying to [comment:5 dkrenn]:
> Note that there is still one failing doctest, where I don't have any glue why (it is the bug at the very top of the file). Who knows what is going on there?

Kind of fixed; now calling the cartesian product by `cartesian_product`, which produces the correct result.

There are still two failing doctests.



---

archive/issue_comments_241093.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-08-23T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241093",
    "user": "@dkrenn"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_241094.json:
```json
{
    "body": "Replying to [comment:13 dkrenn]:\n> There are still two failing doctests.\n\n\n```\nFile \"src/sage/categories/homset.py\", line 596, in sage.categories.homset.Homset.__init__\nFailed example:\n    MyHomset(ZZ^3, ZZ^3, base = QQ).base_ring()\nExpected:\n    Rational Field\nGot:\n    Integer Ring\n```\n\n\n\n```\nFile \"src/sage/categories/modules.py\", line 519, in sage.categories.modules.Modules.Homsets.ParentMethods.base_ring\nFailed example:\n    H.base_ring.__module__\nExpected nothing\nGot:\n    'sage.categories.modules'\n```\n\n\nDoes someone have an idea? (I have no glue)",
    "created_at": "2015-08-23T09:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241094",
    "user": "@dkrenn"
}
```

Replying to [comment:13 dkrenn]:
> There are still two failing doctests.


```
File "src/sage/categories/homset.py", line 596, in sage.categories.homset.Homset.__init__
Failed example:
    MyHomset(ZZ^3, ZZ^3, base = QQ).base_ring()
Expected:
    Rational Field
Got:
    Integer Ring
```



```
File "src/sage/categories/modules.py", line 519, in sage.categories.modules.Modules.Homsets.ParentMethods.base_ring
Failed example:
    H.base_ring.__module__
Expected nothing
Got:
    'sage.categories.modules'
```


Does someone have an idea? (I have no glue)



---

archive/issue_comments_241095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-16T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241095",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241096.json:
```json
{
    "body": "reverted the change in base_ring of category_object (this will be a separate ticket (#19225))",
    "created_at": "2015-09-16T15:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241096",
    "user": "@dkrenn"
}
```

reverted the change in base_ring of category_object (this will be a separate ticket (#19225))



---

archive/issue_comments_241097.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-16T15:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241097",
    "user": "@dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_241098.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-16T17:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241098",
    "user": "@dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_241099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-16T17:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241099",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241100.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-16T17:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241100",
    "user": "@dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_241101.json:
```json
{
    "body": "Bug fixed...let's see what the patchbot does...",
    "created_at": "2015-09-16T17:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241101",
    "user": "@dkrenn"
}
```

Bug fixed...let's see what the patchbot does...



---

archive/issue_comments_241102.json:
```json
{
    "body": "Hello!\n\nI had a look at the changes on this ticket, made a few reviewer commits, and I have the following comments:\n\n1. `categories.modules.CartesianProducts`: I'm not entirely sure about how everything is handled here:\n   - `ParentMethods.base_ring`: It seems as if the base ring of the cartesian product of some modules is considered to be the base ring of the first module in the list. Is this intended?\n   - Should different base rings of the modules in a cartesian product be allowed? If so, this has to be fixed:\n    {{{\n      sage: E = CombinatorialFreeModule(ZZ, [1,2])\n      sage: F = CombinatorialFreeModule(QQ, ['a', 'b'])\n      sage: cartesian_product([E, F])\n      Traceback (most recent call last):\n      ...\n      AttributeError: 'CommutativeAdditiveGroups.CartesianProducts_with_c' object has no attribute 'FiniteDimensional'\n    }}}\n   - Otherwise, if this should not be supported, the error message should be replaced by something more meaningful.\n\nNote that fixing these things would be suitable for a follow-up ticket, as the current behavior is (as far as I can tell) correct: if the base rings of the modules coincide, the cartesian product can be built (at least in the examples I tried). Otherwise, a (unfortunately rather strange) exception is raised. And in the case where all base rings coincide, `base_ring` can of course return the base ring of any of the passed modules.\n\n2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.\n\n3. `categories.pushout.MultivariateConstructionFunctor`: Is there a reason for the import of `CartesianProduct` in the `TESTS`-block? (I've removed the import in one of my commits.)\n\n4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?\n\n5. `pushout`: Is there a reason for using\n   {{{\n    sage: from sage.sets.cartesian_product import CartesianProduct\n    sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())\n   }}}\n   over\n   {{{\n    sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))\n   }}}\n   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.\n\n6. `pushout`: Am I right in the assumption that the reason for the check `.. and R_tower[-1][0] is not None` is that when considering, for example\n   {{{\n    sage: from sage.categories.pushout import pushout\n    sage: pushout(ZZ, cartesian_product([ZZ, QQ]))\n    Traceback (most recent call last):\n    ...\n    CoercionException: 'NoneType' object is not iterable\n   }}}\n   that a `CoercionException` is thrown (instead of an `AttributeError` for the failed call to `R_tower[-1][0].common_base(...)` in the line after the check)? Or is there more to it? Would it make sense to add a doctest for this exact case? (I've included one in my reviewer commits; proceed with it as you like.)\n\n7. `pushout`: `CartesianProductPolys` vs. `CartesianProductPoly`? (cf. #18223 `;-)`).\n\nBenjamin\n----\nNew commits:",
    "created_at": "2015-10-04T23:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241102",
    "user": "@behackl"
}
```

Hello!

I had a look at the changes on this ticket, made a few reviewer commits, and I have the following comments:

1. `categories.modules.CartesianProducts`: I'm not entirely sure about how everything is handled here:
   - `ParentMethods.base_ring`: It seems as if the base ring of the cartesian product of some modules is considered to be the base ring of the first module in the list. Is this intended?
   - Should different base rings of the modules in a cartesian product be allowed? If so, this has to be fixed:
    {{{
      sage: E = CombinatorialFreeModule(ZZ, [1,2])
      sage: F = CombinatorialFreeModule(QQ, ['a', 'b'])
      sage: cartesian_product([E, F])
      Traceback (most recent call last):
      ...
      AttributeError: 'CommutativeAdditiveGroups.CartesianProducts_with_c' object has no attribute 'FiniteDimensional'
    }}}
   - Otherwise, if this should not be supported, the error message should be replaced by something more meaningful.

Note that fixing these things would be suitable for a follow-up ticket, as the current behavior is (as far as I can tell) correct: if the base rings of the modules coincide, the cartesian product can be built (at least in the examples I tried). Otherwise, a (unfortunately rather strange) exception is raised. And in the case where all base rings coincide, `base_ring` can of course return the base ring of any of the passed modules.

2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.

3. `categories.pushout.MultivariateConstructionFunctor`: Is there a reason for the import of `CartesianProduct` in the `TESTS`-block? (I've removed the import in one of my commits.)

4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?

5. `pushout`: Is there a reason for using
   {{{
    sage: from sage.sets.cartesian_product import CartesianProduct
    sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())
   }}}
   over
   {{{
    sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))
   }}}
   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.

6. `pushout`: Am I right in the assumption that the reason for the check `.. and R_tower[-1][0] is not None` is that when considering, for example
   {{{
    sage: from sage.categories.pushout import pushout
    sage: pushout(ZZ, cartesian_product([ZZ, QQ]))
    Traceback (most recent call last):
    ...
    CoercionException: 'NoneType' object is not iterable
   }}}
   that a `CoercionException` is thrown (instead of an `AttributeError` for the failed call to `R_tower[-1][0].common_base(...)` in the line after the check)? Or is there more to it? Would it make sense to add a doctest for this exact case? (I've included one in my reviewer commits; proceed with it as you like.)

7. `pushout`: `CartesianProductPolys` vs. `CartesianProductPoly`? (cf. #18223 `;-)`).

Benjamin
----
New commits:



---

archive/issue_comments_241103.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-04T23:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241103",
    "user": "@behackl"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_241104.json:
```json
{
    "body": "Replying to [comment:20 behackl]:\n> 1. `categories.modules.CartesianProducts`: I'm not entirely sure about how everything is handled here:\n>   - `ParentMethods.base_ring`: It seems as if the base ring of the cartesian product of some modules is considered to be the base ring of the first module in the list. Is this intended?\n>   - Should different base rings of the modules in a cartesian product be allowed? If so, this has to be fixed:\n>     {{{\n>       sage: E = CombinatorialFreeModule(ZZ, [1,2])\n>       sage: F = CombinatorialFreeModule(QQ, ['a', 'b'])\n>       sage: cartesian_product([E, F])\n>       Traceback (most recent call last):\n>       ...\n>       AttributeError: 'CommutativeAdditiveGroups.CartesianProducts_with_c' object has no attribute 'FiniteDimensional'\n>     }}}\n>   - Otherwise, if this should not be supported, the error message should be replaced by something more meaningful.\n> \n> Note that fixing these things would be suitable for a follow-up ticket, as the current behavior is (as far as I can tell) correct: if the base rings of the modules coincide, the cartesian product can be built (at least in the examples I tried). Otherwise, a (unfortunately rather strange) exception is raised. And in the case where all base rings coincide, `base_ring` can of course return the base ring of any of the passed modules.\n\nThis is now #19375.\n\n> 2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.\n\nRewritten (but I am open to suggestions if you want something different)\n\n> 3. `categories.pushout.MultivariateConstructionFunctor`: Is there a reason for the import of `CartesianProduct` in the `TESTS`-block? (I've removed the import in one of my commits.)\n\nThanks.\n\n> 4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?\n\nWe need a common parent, thus `common_parent` is the correct method to call. A pushout is one possible way to construct a common parent, but there are other ways; e.g. one could coerce into the other, or there is a scalar multiplication or action available.\n\n> 5. `pushout`: Is there a reason for using\n>   {{{\n>     sage: from sage.sets.cartesian_product import CartesianProduct\n>     sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())\n>   }}}\n>   over\n>   {{{\n>     sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))\n>   }}}\n>   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.\n\nThis is to check that it works as well (there was once a bug with this kind of construction, thus a doctest was added).\n\n> 6. `pushout`: Am I right in the assumption that the reason for the check `.. and R_tower[-1][0] is not None` is that when considering, for example\n>   {{{\n>     sage: from sage.categories.pushout import pushout\n>     sage: pushout(ZZ, cartesian_product([ZZ, QQ]))\n>     Traceback (most recent call last):\n>     ...\n>     CoercionException: 'NoneType' object is not iterable\n>   }}}\n>   that a `CoercionException` is thrown (instead of an `AttributeError` for the failed call to `R_tower[-1][0].common_base(...)` in the line after the check)?\n\nYes, this is the reason. An `AttributeError does not work with some of the calling functions; they need a `CoercionException`.\n\n> Or is there more to it? \n\nNo.\n\n> Would it make sense to add a doctest for this exact case? (I've included one in my reviewer commits; proceed with it as you like.)\n\nThanks.\n\n> 7. `pushout`: `CartesianProductPolys` vs. `CartesianProductPoly`? (cf. #18223 `;-)`).\n\nDone.\n\nCross-reviewed your changes...seem to be fine.",
    "created_at": "2015-10-08T11:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241104",
    "user": "@dkrenn"
}
```

Replying to [comment:20 behackl]:
> 1. `categories.modules.CartesianProducts`: I'm not entirely sure about how everything is handled here:
>   - `ParentMethods.base_ring`: It seems as if the base ring of the cartesian product of some modules is considered to be the base ring of the first module in the list. Is this intended?
>   - Should different base rings of the modules in a cartesian product be allowed? If so, this has to be fixed:
>     {{{
>       sage: E = CombinatorialFreeModule(ZZ, [1,2])
>       sage: F = CombinatorialFreeModule(QQ, ['a', 'b'])
>       sage: cartesian_product([E, F])
>       Traceback (most recent call last):
>       ...
>       AttributeError: 'CommutativeAdditiveGroups.CartesianProducts_with_c' object has no attribute 'FiniteDimensional'
>     }}}
>   - Otherwise, if this should not be supported, the error message should be replaced by something more meaningful.
> 
> Note that fixing these things would be suitable for a follow-up ticket, as the current behavior is (as far as I can tell) correct: if the base rings of the modules coincide, the cartesian product can be built (at least in the examples I tried). Otherwise, a (unfortunately rather strange) exception is raised. And in the case where all base rings coincide, `base_ring` can of course return the base ring of any of the passed modules.

This is now #19375.

> 2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.

Rewritten (but I am open to suggestions if you want something different)

> 3. `categories.pushout.MultivariateConstructionFunctor`: Is there a reason for the import of `CartesianProduct` in the `TESTS`-block? (I've removed the import in one of my commits.)

Thanks.

> 4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?

We need a common parent, thus `common_parent` is the correct method to call. A pushout is one possible way to construct a common parent, but there are other ways; e.g. one could coerce into the other, or there is a scalar multiplication or action available.

> 5. `pushout`: Is there a reason for using
>   {{{
>     sage: from sage.sets.cartesian_product import CartesianProduct
>     sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())
>   }}}
>   over
>   {{{
>     sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))
>   }}}
>   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.

This is to check that it works as well (there was once a bug with this kind of construction, thus a doctest was added).

> 6. `pushout`: Am I right in the assumption that the reason for the check `.. and R_tower[-1][0] is not None` is that when considering, for example
>   {{{
>     sage: from sage.categories.pushout import pushout
>     sage: pushout(ZZ, cartesian_product([ZZ, QQ]))
>     Traceback (most recent call last):
>     ...
>     CoercionException: 'NoneType' object is not iterable
>   }}}
>   that a `CoercionException` is thrown (instead of an `AttributeError` for the failed call to `R_tower[-1][0].common_base(...)` in the line after the check)?

Yes, this is the reason. An `AttributeError does not work with some of the calling functions; they need a `CoercionException`.

> Or is there more to it? 

No.

> Would it make sense to add a doctest for this exact case? (I've included one in my reviewer commits; proceed with it as you like.)

Thanks.

> 7. `pushout`: `CartesianProductPolys` vs. `CartesianProductPoly`? (cf. #18223 `;-)`).

Done.

Cross-reviewed your changes...seem to be fine.



---

archive/issue_comments_241105.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-08T11:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241105",
    "user": "@dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_241106.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-08T11:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241106",
    "user": "@dkrenn"
}
```

New commits:



---

archive/issue_comments_241107.json:
```json
{
    "body": "Replying to [comment:21 dkrenn]:\n> > 1. `categories.modules.CartesianProducts`: I'm not entirely sure [...] \n> \n> This is now #19375.\n\nPerfect.\n\n> \n> > 2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.\n> \n> Rewritten (but I am open to suggestions if you want something different)\n\nNo, the way you've rewritten it is fine.\n\n> > 4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?\n> \n> We need a common parent, thus `common_parent` is the correct method to call. A pushout is one possible way to construct a common parent, but there are other ways; e.g. one could coerce into the other, or there is a scalar multiplication or action available.\n\nI understand.\n\n> \n> > 5. `pushout`: Is there a reason for using\n> >   {{{\n> >     sage: from sage.sets.cartesian_product import CartesianProduct\n> >     sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())\n> >   }}}\n> >   over\n> >   {{{\n> >     sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))\n> >   }}}\n> >   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.\n> \n> This is to check that it works as well (there was once a bug with this kind of construction, thus a doctest was added).\n\nAlright.\n\nI cross-checked your changes, everything seems to work now, and I have no more comments.\n\nThe documentation builds and `make ptestlong` passes. --> `positive_review`.",
    "created_at": "2015-10-13T16:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241107",
    "user": "@behackl"
}
```

Replying to [comment:21 dkrenn]:
> > 1. `categories.modules.CartesianProducts`: I'm not entirely sure [...] 
> 
> This is now #19375.

Perfect.

> 
> > 2. `categories.pushout.ConstructionFunctor.common_base`: I think that `Raise a CoercionException` does not fit in a `OUTPUT`-block from a semantic point of view.
> 
> Rewritten (but I am open to suggestions if you want something different)

No, the way you've rewritten it is fine.

> > 4. `MultivariateConstructionFunctor.common_base`: Could you explain why you use `get_coercion_model().common_parent(...)` instead of `pushout(...)`?
> 
> We need a common parent, thus `common_parent` is the correct method to call. A pushout is one possible way to construct a common parent, but there are other ways; e.g. one could coerce into the other, or there is a scalar multiplication or action available.

I understand.

> 
> > 5. `pushout`: Is there a reason for using
> >   {{{
> >     sage: from sage.sets.cartesian_product import CartesianProduct
> >     sage: A = CartesianProduct((ZZ['x'], QQ['y'], QQ['z']), Sets().CartesianProducts())
> >   }}}
> >   over
> >   {{{
> >     sage: A = cartesian_product((ZZ['x'], QQ['y'], QQ['z']))
> >   }}}
> >   As far as I can tell, the only difference is in the categories -- but they aren't used in these doctests.
> 
> This is to check that it works as well (there was once a bug with this kind of construction, thus a doctest was added).

Alright.

I cross-checked your changes, everything seems to work now, and I have no more comments.

The documentation builds and `make ptestlong` passes. --> `positive_review`.



---

archive/issue_comments_241108.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-13T16:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241108",
    "user": "@behackl"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_241109.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-14T17:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17945#issuecomment-241109",
    "user": "@vbraun"
}
```

Resolution: fixed
