# Issue 31835: trace of zero fails in padic extensions

Issue created by migration from https://trac.sagemath.org/ticket/32072

Original creator: @oriparzan

Original creation time: 2021-06-28 06:17:20

Keywords: padic, extension, trace

Taking trace of O(p^prec) in p-adic extensions fails:

Eisenstein extension:


```
sage: F=Qp(2)                                                                                                                                                                                                       
sage: L.<p> = F.ext(x^2-2)                                                                                                                                                                                          
sage: (L(p)-L(p)).trace()                                                                                                                                                                                           
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-19-0d3ea34b54ef> in <module>
----> 1 (L(p)-L(p)).trace()

~/sage-9.3/local/lib/python3.8/site-packages/sage/rings/padics/padic_ZZ_pX_element.pyx in sage.rings.padics.padic_ZZ_pX_element.pAdicZZpXElement.trace (build/cythonized/sage/rings/padics/padic_ZZ_pX_element.cpp:7016)()
    487             return self.parent().ground_ring()(0)
    488         elif self._is_inexact_zero():
--> 489             return self.ground_ring(0, (self.valuation() - 1) // self.parent().e() + 1)
    490         if self.valuation() >= 0:
    491             return self.parent().ground_ring()(self.matrix_mod_pn().trace())

~/sage-9.3/local/lib/python3.8/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4709)()
    491             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'
    492         """
--> 493         return self.getattr_from_category(name)
    494 
    495     cdef getattr_from_category(self, name):

~/sage-9.3/local/lib/python3.8/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4821)()
    504         else:
    505             cls = P._abstract_element_class
--> 506         return getattr_from_other_class(self, cls, name)
    507 
    508     def __dir__(self):

~/sage-9.3/local/lib/python3.8/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2619)()
    370         dummy_error_message.cls = type(self)
    371         dummy_error_message.name = name
--> 372         raise AttributeError(dummy_error_message)
    373     attribute = <object>attr
    374     # Check for a descriptor (__get__ in Python)

AttributeError: 'sage.rings.padics.padic_ZZ_pX_CR_element.pAdicZZpXCRElement' object has no attribute 'ground_ring'
```


Unramified extension:


```
sage: L.<p> = F.ext(x^2+x-1)                                                                                                                                                                                        
sage: (L(p)-L(p)).trace()                                                                                                                                                                                           
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-21-0d3ea34b54ef> in <module>
----> 1 (L(p)-L(p)).trace()

~/sage-9.3/local/lib/python3.8/site-packages/sage/libs/linkages/padics/unram_shared.pxi in sage.rings.padics.qadic_flint_CR.trace_unram (build/cythonized/sage/rings/padics/qadic_flint_CR.c:11572)()
    212         return self.parent().ground_ring()(0)
    213     elif self._is_inexact_zero():
--> 214         return self.ground_ring(0, self.precision_absolute())
    215     if self.valuation() >= 0:
    216         return self.parent().ground_ring()(self.matrix_mod_pn().trace())

~/sage-9.3/local/lib/python3.8/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4709)()
    491             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'
    492         """
--> 493         return self.getattr_from_category(name)
    494 
    495     cdef getattr_from_category(self, name):

~/sage-9.3/local/lib/python3.8/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4821)()
    504         else:
    505             cls = P._abstract_element_class
--> 506         return getattr_from_other_class(self, cls, name)
    507 
    508     def __dir__(self):

~/sage-9.3/local/lib/python3.8/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2619)()
    370         dummy_error_message.cls = type(self)
    371         dummy_error_message.name = name
--> 372         raise AttributeError(dummy_error_message)
    373     attribute = <object>attr
    374     # Check for a descriptor (__get__ in Python)

AttributeError: 'sage.rings.padics.qadic_flint_CR.qAdicCappedRelativeElement' object has no attribute 'ground_ring'

```




---

Comment by git created at 2022-06-02 12:02:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2022-06-02 12:03:03

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-06-02 19:33:07

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2022-06-02 19:33:07

ok pour moi, mais faut changer la rubrique "Author" stp


---

Comment by chapoton created at 2022-06-02 19:34:12

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2022-06-02 19:34:12

ah, en plsu if faut ecrire `TESTS:`


---

Comment by git created at 2022-06-02 20:06:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2022-06-02 20:07:30

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2022-06-03 05:54:25

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2022-06-03 05:54:25

ok


---

Comment by vbraun created at 2022-06-12 12:17:14

Resolution: fixed
