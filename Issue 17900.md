# Issue 17900: Centrality betweenness in Sage

archive/issues_017900.json:
```json
{
    "body": "CC:  dcoudert borassi\n\nI hate it that we do not appear in comparisons like the following, just because we are slower than the worst library `:-P`\n\nhttp://graph-tool.skewed.de/performance\n\nWith this branch we can compute the betweenness centrality in Sage with a decent speed.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/18137\n\n",
    "created_at": "2015-04-07T19:39:44Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Centrality betweenness in Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17900",
    "user": "ncohen"
}
```
CC:  dcoudert borassi

I hate it that we do not appear in comparisons like the following, just because we are slower than the worst library `:-P`

http://graph-tool.skewed.de/performance

With this branch we can compute the betweenness centrality in Sage with a decent speed.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/18137





---

archive/issue_comments_240290.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-07T19:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240290",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_240291.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-07T19:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240291",
    "user": "ncohen"
}
```

New commits:



---

archive/issue_comments_240292.json:
```json
{
    "body": "Hello,\n\nI have only small remarks:\n- Wouldn't it be slightly faster to use arrays of bint rather than bitsets ? It would use more memory, but since you want to be fast, any saving is important.\n- You could add a doctest to compare the result of your implementation with networkx\n- You could pre-compute the `((n-1)*(n-2))`, although its minor improvement.\n- You could add `cdef double x`\n- Variables `k` and `d` are not used.\n- You wrote `from centrality import centrality_betweenness`. Shouldn't it be `from sage.graphs.centrality import centrality_betweenness` ?",
    "created_at": "2015-04-07T20:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240292",
    "user": "dcoudert"
}
```

Hello,

I have only small remarks:
- Wouldn't it be slightly faster to use arrays of bint rather than bitsets ? It would use more memory, but since you want to be fast, any saving is important.
- You could add a doctest to compare the result of your implementation with networkx
- You could pre-compute the `((n-1)*(n-2))`, although its minor improvement.
- You could add `cdef double x`
- Variables `k` and `d` are not used.
- You wrote `from centrality import centrality_betweenness`. Shouldn't it be `from sage.graphs.centrality import centrality_betweenness` ?



---

archive/issue_comments_240293.json:
```json
{
    "body": "Hello,\n\n> - Wouldn't it be slightly faster to use arrays of bint rather than bitsets ? It would use more memory, but since you want to be fast, any saving is important.\n\nIt would not be much faster, because most of what this array would contain is zeroes (bint is an int in memory). Plus the bottleneck is float computation in this case `:-/`\n\n> - You could add a doctest to compare the result of your implementation with networkx\n\nThere is one, isn't there? In `centrality.pyx`. The one with a \"tolerance\" flag.\n\n> - You could pre-compute the `((n-1)*(n-2))`, although its minor improvement.\n\nI don't think that it is worth it. Save a linear number of multiplications after all this work, really?.. `:-P`\n\n> - You could add `cdef double x`\n\nDone.\n\n> - Variables `k` and `d` are not used.\n\nDone.\n\n> - You wrote `from centrality import centrality_betweenness`. Shouldn't it be `from sage.graphs.centrality import centrality_betweenness` ?\n\nThey are in the same folder, so it works. It is even more robust as a result, as we can move them wherever we want and the path does not change.\n\nI also changed a Cython flag which checks for exceptions when doing float divisions.\n\nNathann",
    "created_at": "2015-04-07T20:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240293",
    "user": "ncohen"
}
```

Hello,

> - Wouldn't it be slightly faster to use arrays of bint rather than bitsets ? It would use more memory, but since you want to be fast, any saving is important.

It would not be much faster, because most of what this array would contain is zeroes (bint is an int in memory). Plus the bottleneck is float computation in this case `:-/`

> - You could add a doctest to compare the result of your implementation with networkx

There is one, isn't there? In `centrality.pyx`. The one with a "tolerance" flag.

> - You could pre-compute the `((n-1)*(n-2))`, although its minor improvement.

I don't think that it is worth it. Save a linear number of multiplications after all this work, really?.. `:-P`

> - You could add `cdef double x`

Done.

> - Variables `k` and `d` are not used.

Done.

> - You wrote `from centrality import centrality_betweenness`. Shouldn't it be `from sage.graphs.centrality import centrality_betweenness` ?

They are in the same folder, so it works. It is even more robust as a result, as we can move them wherever we want and the path does not change.

I also changed a Cython flag which checks for exceptions when doing float divisions.

Nathann



---

archive/issue_comments_240294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-07T20:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240294",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240295.json:
```json
{
    "body": "there is numerical noise, add tolerance, see patchbot report.",
    "created_at": "2015-04-08T06:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240295",
    "user": "chapoton"
}
```

there is numerical noise, add tolerance, see patchbot report.



---

archive/issue_comments_240296.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-08T06:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240296",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240297.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T07:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240297",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240298.json:
```json
{
    "body": "Another thing for which pathbot save us `:-P`\n\nThanks,\n\nNathann",
    "created_at": "2015-04-08T07:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240298",
    "user": "ncohen"
}
```

Another thing for which pathbot save us `:-P`

Thanks,

Nathann



---

archive/issue_comments_240299.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-08T07:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240299",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_240300.json:
```json
{
    "body": "The advantage of using rationals is that it was exact! Here you are using floats but without any guarantee on the result. Aren't you? Do you have an estimate on the error depending on the number of vertices/edges? One solution solution would be to use ball arithmetic that also produce a bound on the error (see the recently added arb package). Or interval arithmetic (but that is slower).\n\nVincent",
    "created_at": "2015-04-08T11:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240300",
    "user": "vdelecroix"
}
```

The advantage of using rationals is that it was exact! Here you are using floats but without any guarantee on the result. Aren't you? Do you have an estimate on the error depending on the number of vertices/edges? One solution solution would be to use ball arithmetic that also produce a bound on the error (see the recently added arb package). Or interval arithmetic (but that is slower).

Vincent



---

archive/issue_comments_240301.json:
```json
{
    "body": "Although Nathann would prefer not to, we could have 2 versions of the code, the fast one as default, and a slower exact one.\nDavid.",
    "created_at": "2015-04-08T12:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240301",
    "user": "dcoudert"
}
```

Although Nathann would prefer not to, we could have 2 versions of the code, the fast one as default, and a slower exact one.
David.



---

archive/issue_comments_240302.json:
```json
{
    "body": "Hello,\n\n> The advantage of using rationals is that it was exact!\n\nAnd this is the very reason why I wrote both implementations.\n\nI am not so sure that it is a very big problem, however, as the algorithm will not add noise to noise like it can happen for PDE computations.\n\nThe current version of `centrality_betweenness`, from **NetworkX** shipped with Sage, also computes on floats (in Python):\n\n\n```\n    sage: import networkx\n    sage: networkx.algorithms.centrality.betweenness._accumulate_basic??\n```\n\n\nI wanted to check how **Boost** does it, but I was not able to locate the source code (God, how can anyone read those files???). \n\n(15 minutes later)\n\nHere it is! Line 338 of:\n\nhttp://boost.cvs.sourceforge.net/viewvc/boost/boost/boost/graph/betweenness_centrality.hpp?annotate=1.2.6.1\n\nSo the answer is that \"it depends of dependency_type\", which is.. A template.\n\nFor **igraph** it is apparently a double too:\nhttps://github.com/igraph/igraph/blob/master/src/centrality.c#L1685\nhttps://github.com/igraph/igraph/blob/master/src/centrality.c#L1804\n\nFor **graph-tools** (last of the libraries compared on the link in the ticket's description) it is apparently a double too, though I can't make sure for I do not find the `get_betweenness` function\n\nhttps://git.skewed.de/count0/graph-tool/blob/master/src/graph_tool/centrality/__init__.py#L326\n\nSooooooo please don't just limit your argumentation to \"not exact=BAD\". I care about this, and for this reason I implemented both (which definitely took more than a couple of minutes as you can imagine), but I do believe that for this kind of computations working on floats is not that bad, for I know when the divisions occur and, well, we do not mind much.\n\nI would personally be very happy to have both in Sage, with an easy flag to switch from one implementation to the other. If you just checkout the first of my commits you will see that only one variable need to be changed so that double become rationals. My trouble is that using Cython's preprocessor instructions requires to run `sage -b`, and we do not want that.\n\nI would also like to NOT have the same code copy/pasted twice, and to not pay for the 'if' inside of the loops.\n\nI would be happy to have both if there is a free (in terms of computations) way to handle both at once, and a cheap (in term of lines of code) way to have both.\n\nSo far I did not find any way out, and I thought that the best was to have what everybody seemds interested in: computations on double (we can also turn them into 'long double' if necessary).\n\nNathann\n\nP.S.: I uploaded a commit with both versions so that it will be available somewhere (and not on my computer only) if we ever need that implementation. I did that on purpose, to have it archived somewhere.",
    "created_at": "2015-04-08T12:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240302",
    "user": "ncohen"
}
```

Hello,

> The advantage of using rationals is that it was exact!

And this is the very reason why I wrote both implementations.

I am not so sure that it is a very big problem, however, as the algorithm will not add noise to noise like it can happen for PDE computations.

The current version of `centrality_betweenness`, from **NetworkX** shipped with Sage, also computes on floats (in Python):


```
    sage: import networkx
    sage: networkx.algorithms.centrality.betweenness._accumulate_basic??
```


I wanted to check how **Boost** does it, but I was not able to locate the source code (God, how can anyone read those files???). 

(15 minutes later)

Here it is! Line 338 of:

http://boost.cvs.sourceforge.net/viewvc/boost/boost/boost/graph/betweenness_centrality.hpp?annotate=1.2.6.1

So the answer is that "it depends of dependency_type", which is.. A template.

For **igraph** it is apparently a double too:
https://github.com/igraph/igraph/blob/master/src/centrality.c#L1685
https://github.com/igraph/igraph/blob/master/src/centrality.c#L1804

For **graph-tools** (last of the libraries compared on the link in the ticket's description) it is apparently a double too, though I can't make sure for I do not find the `get_betweenness` function

https://git.skewed.de/count0/graph-tool/blob/master/src/graph_tool/centrality/__init__.py#L326

Sooooooo please don't just limit your argumentation to "not exact=BAD". I care about this, and for this reason I implemented both (which definitely took more than a couple of minutes as you can imagine), but I do believe that for this kind of computations working on floats is not that bad, for I know when the divisions occur and, well, we do not mind much.

I would personally be very happy to have both in Sage, with an easy flag to switch from one implementation to the other. If you just checkout the first of my commits you will see that only one variable need to be changed so that double become rationals. My trouble is that using Cython's preprocessor instructions requires to run `sage -b`, and we do not want that.

I would also like to NOT have the same code copy/pasted twice, and to not pay for the 'if' inside of the loops.

I would be happy to have both if there is a free (in terms of computations) way to handle both at once, and a cheap (in term of lines of code) way to have both.

So far I did not find any way out, and I thought that the best was to have what everybody seemds interested in: computations on double (we can also turn them into 'long double' if necessary).

Nathann

P.S.: I uploaded a commit with both versions so that it will be available somewhere (and not on my computer only) if we ever need that implementation. I did that on purpose, to have it archived somewhere.



---

archive/issue_comments_240303.json:
```json
{
    "body": "Replying to [comment:12 ncohen]:\n\n> Sooooooo please don't just limit your argumentation to \"not exact=BAD\".\n\nDo not oversimplify. My argumentation was \"not exact => extra care needed\". Floats are wonderful because they are very fast.\n\n> And this is the very reason why I wrote both implementations.\n\nWould be interesting to investigate (experimentally) the error propagation.\n\n> I am not so sure that it is a very big problem, however, as the algorithm will not add noise to noise like it can happen for PDE computations.\n\nAlready summing (a lot of) floating point numbers create problems. Simple (not so dramatic) example\n\n```\nsage: sum(1.r/n for n in range(1,10000000))\n16.69531126585727\nsage: sum(1.r/n for n in range(9999999,0,-1))\n16.695311265859964\n```\n\nIf you mix that with division, it is of course even worse.\n\n> I care about this, and for this reason I implemented both (which definitely took more than a couple of minutes as you can imagine), but I do believe that for this kind of computations working on floats is not that bad, for I know when the divisions occur and, well, we do not mind much.\n\nI also believe so, but it would be better if we were sure and the documentation mentioned it. Something like: if you do have a graph with `m` vertices and `n` edges than the worst case is an error of `function(m,n)`.\n\nVincent",
    "created_at": "2015-04-08T13:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240303",
    "user": "vdelecroix"
}
```

Replying to [comment:12 ncohen]:

> Sooooooo please don't just limit your argumentation to "not exact=BAD".

Do not oversimplify. My argumentation was "not exact => extra care needed". Floats are wonderful because they are very fast.

> And this is the very reason why I wrote both implementations.

Would be interesting to investigate (experimentally) the error propagation.

> I am not so sure that it is a very big problem, however, as the algorithm will not add noise to noise like it can happen for PDE computations.

Already summing (a lot of) floating point numbers create problems. Simple (not so dramatic) example

```
sage: sum(1.r/n for n in range(1,10000000))
16.69531126585727
sage: sum(1.r/n for n in range(9999999,0,-1))
16.695311265859964
```

If you mix that with division, it is of course even worse.

> I care about this, and for this reason I implemented both (which definitely took more than a couple of minutes as you can imagine), but I do believe that for this kind of computations working on floats is not that bad, for I know when the divisions occur and, well, we do not mind much.

I also believe so, but it would be better if we were sure and the documentation mentioned it. Something like: if you do have a graph with `m` vertices and `n` edges than the worst case is an error of `function(m,n)`.

Vincent



---

archive/issue_comments_240304.json:
```json
{
    "body": "Hello !\n\nI agree that float operations make errors, but I do not know how to evaluate it. I expect the relative error to stay very very small in those cases, and in the graphs that are of interest for the networks community.\n\nWould you know a trick to have both implementations available in the code (without recompilation)? I do not think that we can have 'real templates' in Cython, can we?\n\nNathann",
    "created_at": "2015-04-08T13:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240304",
    "user": "ncohen"
}
```

Hello !

I agree that float operations make errors, but I do not know how to evaluate it. I expect the relative error to stay very very small in those cases, and in the graphs that are of interest for the networks community.

Would you know a trick to have both implementations available in the code (without recompilation)? I do not think that we can have 'real templates' in Cython, can we?

Nathann



---

archive/issue_comments_240305.json:
```json
{
    "body": "Okay. Here it is. It cost me the last four hours.\n\nNathann",
    "created_at": "2015-04-08T15:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240305",
    "user": "ncohen"
}
```

Okay. Here it is. It cost me the last four hours.

Nathann



---

archive/issue_comments_240306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-08T15:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240306",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_240307.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> Okay. Here it is. It cost me the last four hours.\n\nYouhou! You initiated me to the world of Cython templating!\n\nI am having a careful look right now.",
    "created_at": "2015-04-08T15:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240307",
    "user": "vdelecroix"
}
```

Replying to [comment:15 ncohen]:
> Okay. Here it is. It cost me the last four hours.

Youhou! You initiated me to the world of Cython templating!

I am having a careful look right now.



---

archive/issue_comments_240308.json:
```json
{
    "body": "> Youhou! You initiated me to the world of Cython templating!\n> \n> I am having a careful look right now.\n\nIt is cool without being great. There are several limitations that you will only notice if you write some code yourself. In particular, the templating forced me to introduce a pure C function.\n\nNathann",
    "created_at": "2015-04-08T15:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240308",
    "user": "ncohen"
}
```

> Youhou! You initiated me to the world of Cython templating!
> 
> I am having a careful look right now.

It is cool without being great. There are several limitations that you will only notice if you write some code yourself. In particular, the templating forced me to introduce a pure C function.

Nathann



---

archive/issue_comments_240309.json:
```json
{
    "body": "At least from the following example, the computation with double is perfectly valid\n\n```\nsage: g = graphs.RandomGNP(100,.2)\nsage: cb0 = g.centrality_betweenness(exact=0)\nsage: cb1 = g.centrality_betweenness(exact=1)\nsage: max(cb0[i]-cb1[i] for i in cb0)\n6.938893903907228e-18\n```\n\nThe mantissa of the double is `2^(-53) ~ 10^(-16)` and the numbers are about `0.01` which makes the error affect only the one or two last bits.",
    "created_at": "2015-04-08T16:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240309",
    "user": "vdelecroix"
}
```

At least from the following example, the computation with double is perfectly valid

```
sage: g = graphs.RandomGNP(100,.2)
sage: cb0 = g.centrality_betweenness(exact=0)
sage: cb1 = g.centrality_betweenness(exact=1)
sage: max(cb0[i]-cb1[i] for i in cb0)
6.938893903907228e-18
```

The mantissa of the double is `2^(-53) ~ 10^(-16)` and the numbers are about `0.01` which makes the error affect only the one or two last bits.



---

archive/issue_comments_240310.json:
```json
{
    "body": "All right. I did not check what the algorithm does, but at least I can propose a simplification in the Cython fused business. Have a look at `public/18137`.\n\nVincent",
    "created_at": "2015-04-08T16:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240310",
    "user": "vdelecroix"
}
```

All right. I did not check what the algorithm does, but at least I can propose a simplification in the Cython fused business. Have a look at `public/18137`.

Vincent



---

archive/issue_comments_240311.json:
```json
{
    "body": "Hello,\n\nyou should add the description of parameter `exact` in the cython `centrality_betweenness` method.\n\nIt does matter much, but you could specify the return type of the C method (dict).\n\notherwise, the method is working perfectly on my mac ;)\n\nDavid.",
    "created_at": "2015-04-08T17:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240311",
    "user": "dcoudert"
}
```

Hello,

you should add the description of parameter `exact` in the cython `centrality_betweenness` method.

It does matter much, but you could specify the return type of the C method (dict).

otherwise, the method is working perfectly on my mac ;)

David.



---

archive/issue_comments_240312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T19:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240312",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240313.json:
```json
{
    "body": "FYI: https://groups.google.com/forum/#!topic/cython-users/xOw-LWUb7aY",
    "created_at": "2015-04-09T07:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240313",
    "user": "ncohen"
}
```

FYI: https://groups.google.com/forum/#!topic/cython-users/xOw-LWUb7aY



---

archive/issue_comments_240314.json:
```json
{
    "body": "still not passing the tests\n\nand please use `....:` newstyle doctest continuation",
    "created_at": "2015-04-09T11:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240314",
    "user": "chapoton"
}
```

still not passing the tests

and please use `....:` newstyle doctest continuation



---

archive/issue_comments_240315.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T11:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240315",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240316.json:
```json
{
    "body": "Done. Not that I did not introduce any '...'. I only added a \"# tol\" flag on an existing one.\n\nNathann",
    "created_at": "2015-04-09T11:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240316",
    "user": "ncohen"
}
```

Done. Not that I did not introduce any '...'. I only added a "# tol" flag on an existing one.

Nathann



---

archive/issue_comments_240317.json:
```json
{
    "body": "Hello,\nthis is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.\nFirst of all, congrats for the excellent running time!  Some comments follow (I think the first is important, while the others  are only \"style\" comments):\n\n1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).\n2. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?\n3. In the comment part, Section \"ALGORITHM\", I would add something to explain what happens if k=0.\n\nHope it is useful!\n\nMichele",
    "created_at": "2015-04-09T13:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240317",
    "user": "borassi"
}
```

Hello,
this is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.
First of all, congrats for the excellent running time!  Some comments follow (I think the first is important, while the others  are only "style" comments):

1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).
2. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?
3. In the comment part, Section "ALGORITHM", I would add something to explain what happens if k=0.

Hope it is useful!

Michele



---

archive/issue_comments_240318.json:
```json
{
    "body": "Hello,\n\n> this is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.\n\nYour comments are rather good, actually.\n\n>  1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).\n\nHMmm.. Well, indeed when thinking of a long path this may actually make a big difference. Do you feel like giving it a try and telling us about the difference?\n\nI believe that it may make performances worse in some case, though I do not know by how much. Storing everything as a bitset (instead of storing distances) also makes things more compact in memory, and the cpu cache works better. Though again, I have no idea how much time that represents.\n\n>  1. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?\n\nI do not understand your question. What do you mean by \"a variable for the start of the que and another for the end of the queue\"? This is precisely what `layer_current_beginning` and  `layer_current_end` do, in my understanding.\n\n>  1. In the comment part, Section \"ALGORITHM\", I would add something to explain what happens if k=0.\n\nIn this case the sum is empty, and thus equal to 0. Do you think that it should be emphasized?\n\nNathann",
    "created_at": "2015-04-09T13:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240318",
    "user": "ncohen"
}
```

Hello,

> this is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.

Your comments are rather good, actually.

>  1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).

HMmm.. Well, indeed when thinking of a long path this may actually make a big difference. Do you feel like giving it a try and telling us about the difference?

I believe that it may make performances worse in some case, though I do not know by how much. Storing everything as a bitset (instead of storing distances) also makes things more compact in memory, and the cpu cache works better. Though again, I have no idea how much time that represents.

>  1. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?

I do not understand your question. What do you mean by "a variable for the start of the que and another for the end of the queue"? This is precisely what `layer_current_beginning` and  `layer_current_end` do, in my understanding.

>  1. In the comment part, Section "ALGORITHM", I would add something to explain what happens if k=0.

In this case the sum is empty, and thus equal to 0. Do you think that it should be emphasized?

Nathann



---

archive/issue_comments_240319.json:
```json
{
    "body": "Okay, two news:\n\n1) You are right, when profiling the code on a long path the bottleneck is this 'or'\n\n2) We can have everything at the same time. Instead of clearing the new layer bitset and running this big 'or', we can keep adding stuff to it without ever clearing it, AND only adding the new elements to the 'seen' bitset at the end of the loop (using the content of the queue). 100% win. I will upload a commit in a second.\n\nNathann",
    "created_at": "2015-04-09T13:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240319",
    "user": "ncohen"
}
```

Okay, two news:

1) You are right, when profiling the code on a long path the bottleneck is this 'or'

2) We can have everything at the same time. Instead of clearing the new layer bitset and running this big 'or', we can keep adding stuff to it without ever clearing it, AND only adding the new elements to the 'seen' bitset at the end of the loop (using the content of the queue). 100% win. I will upload a commit in a second.

Nathann



---

archive/issue_comments_240320.json:
```json
{
    "body": "FYI, before the optimization\n\n\n```\nsage: g = graphs.PathGraph(10000)\nsage: %time _=g.centrality_betweenness()\nCPU times: user 10 s, sys: 0 ns, total: 10 s\nWall time: 10 s\n```\n",
    "created_at": "2015-04-09T13:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240320",
    "user": "ncohen"
}
```

FYI, before the optimization


```
sage: g = graphs.PathGraph(10000)
sage: %time _=g.centrality_betweenness()
CPU times: user 10 s, sys: 0 ns, total: 10 s
Wall time: 10 s
```




---

archive/issue_comments_240321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T13:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240321",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240322.json:
```json
{
    "body": "Here is is `:-)`\n\n```\nsage: g = graphs.PathGraph(10000)\nsage: %time _=g.centrality_betweenness()\nCPU times: user 1.76 s, sys: 8 ms, total: 1.77 s\nWall time: 1.75 s\n```\n\n\nThanks,\n\nNathann",
    "created_at": "2015-04-09T13:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240322",
    "user": "ncohen"
}
```

Here is is `:-)`

```
sage: g = graphs.PathGraph(10000)
sage: %time _=g.centrality_betweenness()
CPU times: user 1.76 s, sys: 8 ms, total: 1.77 s
Wall time: 1.75 s
```


Thanks,

Nathann



---

archive/issue_comments_240323.json:
```json
{
    "body": "Replying to [comment:30 ncohen]:\n\n> Hello,\n> \n> \n> \n> \n> > this is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.\n> > \n> > \n> > \n> \n> Your comments are rather good, actually.\n> \n> \n> \n> \n> > 1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).\n> > \n> > \n> > \n> \n> HMmm.. Well, indeed when thinking of a long path this may actually make a big difference. Do you feel like giving it a try and telling us about the difference?\n> \n> I believe that it may make performances worse in some case, though I do not know by how much. Storing everything as a bitset (instead of storing distances) also makes things more compact in memory, and the cpu cache works better. Though again, I have no idea how much time that represents.\n\nWell, it seems you have already done it! :-)\n\n> > 1. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?\n> > \n> > \n> > \n> \n> I do not understand your question. What do you mean by \"a variable for the start of the que and another for the end of the queue\"? This is precisely what `layer_current_beginning` and  `layer_current_end` do, in my understanding.\n\nMy point is that I do not like the nested loops:\n\n\n```\nwhile layer_current_beginning<layer_current_end:\n    for j in range(layer_current_beginning,layer_current_end):\n```\n\nI would rather use only the `while` loop, by replacing `j` with `layer_current_beginning`, and adding `layer_current_beginning++` at the end of the `while`. However, I realize now that, if you do not want to store distances, this is probably not possible, because you have two `for` loops. So, maybe the best is to leave it as it is.\n\n> > 1. In the comment part, Section \"ALGORITHM\", I would add something to explain what happens if k=0.\n> > \n> > \n> > \n> \n> In this case the sum is empty, and thus equal to 0. Do you think that it should be emphasized?\n\nThat's what I meant, but if you think it's not worth doing it, no problem!\n\n> Nathann",
    "created_at": "2015-04-09T14:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240323",
    "user": "borassi"
}
```

Replying to [comment:30 ncohen]:

> Hello,
> 
> 
> 
> 
> > this is my first comment: please, forgive me if I make  mistakes due to my lack of experience, and I am willing to receive  suggestions.
> > 
> > 
> > 
> 
> Your comments are rather good, actually.
> 
> 
> 
> 
> > 1. bitset_union(seen,seen,next_layer):  this operation takes time O(n), and it is performed at each layer. This  means that, if there are many layers, then the running time might be  O(n<sup>2</sup>) to perform a BFS, and O(mn<sup>2</sup>) overall (for  instance, if the input is a path). I would change the code by memorizing  the distances from the source, and making tests with distances.  Example: it takes more time to analyze a path of length 10,000 than a  G(N,p) random graph with N=10,000 and p=0.001 (with about 100,000  edges).
> > 
> > 
> > 
> 
> HMmm.. Well, indeed when thinking of a long path this may actually make a big difference. Do you feel like giving it a try and telling us about the difference?
> 
> I believe that it may make performances worse in some case, though I do not know by how much. Storing everything as a bitset (instead of storing distances) also makes things more compact in memory, and the cpu cache works better. Though again, I have no idea how much time that represents.

Well, it seems you have already done it! :-)

> > 1. Only to improve readability of the code: why do  you use layer_current_beginning, layer_current_end, and layer_next_end? I  would rather use a variable for the start of the queue and another for  the end of the queue, as in a standard BFS. Is there any particular  reason why you do not do it?
> > 
> > 
> > 
> 
> I do not understand your question. What do you mean by "a variable for the start of the que and another for the end of the queue"? This is precisely what `layer_current_beginning` and  `layer_current_end` do, in my understanding.

My point is that I do not like the nested loops:


```
while layer_current_beginning<layer_current_end:
    for j in range(layer_current_beginning,layer_current_end):
```

I would rather use only the `while` loop, by replacing `j` with `layer_current_beginning`, and adding `layer_current_beginning++` at the end of the `while`. However, I realize now that, if you do not want to store distances, this is probably not possible, because you have two `for` loops. So, maybe the best is to leave it as it is.

> > 1. In the comment part, Section "ALGORITHM", I would add something to explain what happens if k=0.
> > 
> > 
> > 
> 
> In this case the sum is empty, and thus equal to 0. Do you think that it should be emphasized?

That's what I meant, but if you think it's not worth doing it, no problem!

> Nathann



---

archive/issue_comments_240324.json:
```json
{
    "body": "Hello,\n\n> Well, it seems you have already done it! :-)\n\nWell.. Three lines of code for an \"all-cases improvement\" and an order of magnitude for the worst case... Of course `:-P`\n\n> My point is that I do not like the nested loops:\n\n> I would rather use only the `while` loop, by replacing `j` with `layer_current_beginning`, and adding `layer_current_beginning++` at the end of the `while`. However, I realize now that, if you do not want to store distances, this is probably not possible, because you have two `for` loops. So, maybe the best is to leave it as it is.\n\nYep yep, I am forced to do that if I want to know where exactly I am without storing distances `^^;`\n\n> That's what I meant, but if you think it's not worth doing it, no problem!\n\nI just looked at this explanation, and I do not see any way to hint at it (without saying the obvious 'if the sum is empty, well, it's zero'). SOooooo I will pass.\n\nThanks again for the speedup,\n\nNathann",
    "created_at": "2015-04-09T14:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240324",
    "user": "ncohen"
}
```

Hello,

> Well, it seems you have already done it! :-)

Well.. Three lines of code for an "all-cases improvement" and an order of magnitude for the worst case... Of course `:-P`

> My point is that I do not like the nested loops:

> I would rather use only the `while` loop, by replacing `j` with `layer_current_beginning`, and adding `layer_current_beginning++` at the end of the `while`. However, I realize now that, if you do not want to store distances, this is probably not possible, because you have two `for` loops. So, maybe the best is to leave it as it is.

Yep yep, I am forced to do that if I want to know where exactly I am without storing distances `^^;`

> That's what I meant, but if you think it's not worth doing it, no problem!

I just looked at this explanation, and I do not see any way to hint at it (without saying the obvious 'if the sum is empty, well, it's zero'). SOooooo I will pass.

Thanks again for the speedup,

Nathann



---

archive/issue_comments_240325.json:
```json
{
    "body": "One possible extra speedup: decompose the graph into biconnected components ;)\nthe centrality of cut vertices is obvious to compute. For other vertices it might be more difficult to gather every parts.\n\nDavid.",
    "created_at": "2015-04-09T14:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240325",
    "user": "dcoudert"
}
```

One possible extra speedup: decompose the graph into biconnected components ;)
the centrality of cut vertices is obvious to compute. For other vertices it might be more difficult to gather every parts.

David.



---

archive/issue_comments_240326.json:
```json
{
    "body": "Ahahah. Well, honestly I don't mind much. I am only implementing this to be able to say 6 months from now (future stable release) to anybody that compares graph libraries that they should also include Sage, and that we are faster than everybody else. Boost included `:-P`\n\nNathann",
    "created_at": "2015-04-09T14:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240326",
    "user": "ncohen"
}
```

Ahahah. Well, honestly I don't mind much. I am only implementing this to be able to say 6 months from now (future stable release) to anybody that compares graph libraries that they should also include Sage, and that we are faster than everybody else. Boost included `:-P`

Nathann



---

archive/issue_comments_240327.json:
```json
{
    "body": "That's fair enough ;)\n\nWe will certainly have future patches for other stuff.\n\nOne point: apparently boost computes simultaneously the vertex and the edge betweenness. This may explain some slow-down.\n\nDavid.",
    "created_at": "2015-04-09T14:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240327",
    "user": "dcoudert"
}
```

That's fair enough ;)

We will certainly have future patches for other stuff.

One point: apparently boost computes simultaneously the vertex and the edge betweenness. This may explain some slow-down.

David.



---

archive/issue_comments_240328.json:
```json
{
    "body": "Well. We can have it for free too if we care. Instead of \n\n```\nbetweenness_source[v] += (betweenness_source[u]+1)*(n_paths_from_source[v]/n_paths_from_source[u])\n```\n\n\nyou must save the right value somewhere (that's your edge betweenness). It may induce a small loss in speed, but certainly not an integer factor.\n\nNathann\n\nP.S.: Okay, now that I implemented so many cool things would anybody feel like ending the review? `:-P`",
    "created_at": "2015-04-09T14:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240328",
    "user": "ncohen"
}
```

Well. We can have it for free too if we care. Instead of 

```
betweenness_source[v] += (betweenness_source[u]+1)*(n_paths_from_source[v]/n_paths_from_source[u])
```


you must save the right value somewhere (that's your edge betweenness). It may induce a small loss in speed, but certainly not an integer factor.

Nathann

P.S.: Okay, now that I implemented so many cool things would anybody feel like ending the review? `:-P`



---

archive/issue_comments_240329.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-09T14:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240329",
    "user": "borassi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240330.json:
```json
{
    "body": "HMmmmmmmmmmm `O_o`\n\nWell, I don't mind much your setting my ticket to positive review, but given that you are new here... Have you looked at this page?\n\nhttp://www.sagemath.org/doc/developer/reviewer_checklist.html\n\nI am not saying that newcomers are not allowed to change the status -- everybody is, and everybody can review anything here -- it is just that I want to make sure that you know what reviewing a ticket involves (running the tests, wondering if they are sufficient, building the doc). \n\nThanks anyway,\n\nNathann",
    "created_at": "2015-04-09T14:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240330",
    "user": "ncohen"
}
```

HMmmmmmmmmmm `O_o`

Well, I don't mind much your setting my ticket to positive review, but given that you are new here... Have you looked at this page?

http://www.sagemath.org/doc/developer/reviewer_checklist.html

I am not saying that newcomers are not allowed to change the status -- everybody is, and everybody can review anything here -- it is just that I want to make sure that you know what reviewing a ticket involves (running the tests, wondering if they are sufficient, building the doc). 

Thanks anyway,

Nathann



---

archive/issue_comments_240331.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-04-09T14:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240331",
    "user": "borassi"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_240332.json:
```json
{
    "body": "Sorry, this is the \"mistake due to lack of experience\". I thought \"positive review\" meant that I was happy with the code, but now I understand it is much more. I think it's better to leave this issue to more experienced people.",
    "created_at": "2015-04-09T14:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240332",
    "user": "borassi"
}
```

Sorry, this is the "mistake due to lack of experience". I thought "positive review" meant that I was happy with the code, but now I understand it is much more. I think it's better to leave this issue to more experienced people.



---

archive/issue_comments_240333.json:
```json
{
    "body": "No proooooob!!! If you have some spare time you can read our manual a bit. Reviewing a ticket is not very complicated and the 'technical checks' do not take more than a couple of minutes once you get used to them. And of course you can ask us any question if the manual isn't clear `;-)`\n\nNathann",
    "created_at": "2015-04-09T14:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240333",
    "user": "ncohen"
}
```

No proooooob!!! If you have some spare time you can read our manual a bit. Reviewing a ticket is not very complicated and the 'technical checks' do not take more than a couple of minutes once you get used to them. And of course you can ask us any question if the manual isn't clear `;-)`

Nathann



---

archive/issue_comments_240334.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-09T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240334",
    "user": "dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_240335.json:
```json
{
    "body": "One issue:\n\n```\nsage: G = Graph()\nsage: G.centrality_betweenness()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: bitset capacity must be greater than 0\n```\n\n\nDid you know that your code is also working for multi-graphs?\n\n```\nsage: G = Graph(multiedges=True)\nsage: G.add_edge(0,1)\nsage: G.add_edge(0,1)\nsage: G.add_edge(1,2)\nsage: G.add_edge(2,3)\nsage: G.add_edge(0,3)\nsage: G.centrality_betweenness(exact=1)\n{0: 2/9, 1: 2/9, 2: 1/9, 3: 1/9}\n```\n",
    "created_at": "2015-04-09T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240335",
    "user": "dcoudert"
}
```

One issue:

```
sage: G = Graph()
sage: G.centrality_betweenness()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: bitset capacity must be greater than 0
```


Did you know that your code is also working for multi-graphs?

```
sage: G = Graph(multiedges=True)
sage: G.add_edge(0,1)
sage: G.add_edge(0,1)
sage: G.add_edge(1,2)
sage: G.add_edge(2,3)
sage: G.add_edge(0,3)
sage: G.centrality_betweenness(exact=1)
{0: 2/9, 1: 2/9, 2: 1/9, 3: 1/9}
```




---

archive/issue_comments_240336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-10T06:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240336",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240337.json:
```json
{
    "body": "> One issue:\nRight. Fixed.\n\n> Did you know that your code is also working for multi-graphs?\n\nYeah, that was a good news! At some point I wondered whether I should add a 'scream if not simple' somewhere, then figured out that it worked fine. It also extends the definition in the most natural way, i.e. by considering a path as a set of edges instead of a set of vertices.\n\nAnd it also works for loops `:-PPPP`\n\nNathann",
    "created_at": "2015-04-10T06:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240337",
    "user": "ncohen"
}
```

> One issue:
Right. Fixed.

> Did you know that your code is also working for multi-graphs?

Yeah, that was a good news! At some point I wondered whether I should add a 'scream if not simple' somewhere, then figured out that it worked fine. It also extends the definition in the most natural way, i.e. by considering a path as a set of edges instead of a set of vertices.

And it also works for loops `:-PPPP`

Nathann



---

archive/issue_comments_240338.json:
```json
{
    "body": "Good.",
    "created_at": "2015-04-10T15:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240338",
    "user": "dcoudert"
}
```

Good.



---

archive/issue_comments_240339.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-10T15:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240339",
    "user": "dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_240340.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-12T11:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240340",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_240341.json:
```json
{
    "body": "I'm getting this on 32-bit. You should probably add an `# abs tol`\n\n```\nsage -t --long src/sage/graphs/graph.py\n**********************************************************************\nFile \"src/sage/graphs/graph.py\", line 4662, in sage.graphs.graph.Graph.?\nFailed example:\n    (graphs.ChvatalGraph()).centrality_betweenness(\n      normalized=False) # abs tol abs 1e10\nExpected:\n    {0: 3.833333333333333, 1: 3.833333333333333, 2: 3.333333333333333,\n     3: 3.333333333333333, 4: 3.833333333333333, 5: 3.833333333333333,\n     6: 3.333333333333333, 7: 3.333333333333333, 8: 3.333333333333333,\n     9: 3.333333333333333, 10: 3.333333333333333,\n     11: 3.333333333333333}\nGot:\n    {0: 3.833333333333333,\n     1: 3.833333333333333,\n     2: 3.333333333333333,\n     3: 3.333333333333333,\n     4: 3.833333333333333,\n     5: 3.833333333333333,\n     6: 3.333333333333333,\n     7: 3.3333333333333335,\n     8: 3.333333333333333,\n     9: 3.333333333333333,\n     10: 3.333333333333333,\n     11: 3.333333333333333}\n**********************************************************************\n1 item had failures:\n   1 of  66 in sage.graphs.graph.Graph.?\n    [652 tests, 1 failure, 15.40 s]\n```\n",
    "created_at": "2015-04-12T11:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240341",
    "user": "vbraun"
}
```

I'm getting this on 32-bit. You should probably add an `# abs tol`

```
sage -t --long src/sage/graphs/graph.py
**********************************************************************
File "src/sage/graphs/graph.py", line 4662, in sage.graphs.graph.Graph.?
Failed example:
    (graphs.ChvatalGraph()).centrality_betweenness(
      normalized=False) # abs tol abs 1e10
Expected:
    {0: 3.833333333333333, 1: 3.833333333333333, 2: 3.333333333333333,
     3: 3.333333333333333, 4: 3.833333333333333, 5: 3.833333333333333,
     6: 3.333333333333333, 7: 3.333333333333333, 8: 3.333333333333333,
     9: 3.333333333333333, 10: 3.333333333333333,
     11: 3.333333333333333}
Got:
    {0: 3.833333333333333,
     1: 3.833333333333333,
     2: 3.333333333333333,
     3: 3.333333333333333,
     4: 3.833333333333333,
     5: 3.833333333333333,
     6: 3.333333333333333,
     7: 3.3333333333333335,
     8: 3.333333333333333,
     9: 3.333333333333333,
     10: 3.333333333333333,
     11: 3.333333333333333}
**********************************************************************
1 item had failures:
   1 of  66 in sage.graphs.graph.Graph.?
    [652 tests, 1 failure, 15.40 s]
```




---

archive/issue_comments_240342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-12T12:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240342",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_240343.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-12T12:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240343",
    "user": "ncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_240344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2015-04-12T13:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240344",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_240345.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-04-12T13:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240345",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_240346.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-12T13:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240346",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_240347.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17900",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17900#issuecomment-240347",
    "user": "vbraun"
}
```

Resolution: fixed
