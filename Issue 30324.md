# Issue 30324: Use sys.setdlopenflags while loading libgap, libSingular - eliminate _get_shared_lib_filename

Issue created by migration from https://trac.sagemath.org/ticket/30561

Original creator: mkoeppe

Original creation time: 2020-09-12 02:54:42

CC:  dimpase mjo

(from #29024)




---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by embray created at 2021-02-16 12:53:48

In the case of libgap this is made moot by #31297.

It also might be worth a look at how this is handled in gappy: https://github.com/embray/gappy/blob/13e2a1bdc10c343071e1e2dbb23a5156e78e3102/gappy/utils.pyx#L83

AFAICT on most platforms simply passing the filename without the full path is good-enough since it will search for the library in the same manner that the linker would have anyways.

But using `sys.setdlopenflags` is also certainly an option if all we care about is the dlopen flags, as seems to be the case with Singular.

In gappy I still wanted the full path to libgap, since it be helpful to find the location of the GAP root, but for that I use `dlsym()`+`dladdr()` as demonstrated [here](https://github.com/embray/gappy/blob/13e2a1bdc10c343071e1e2dbb23a5156e78e3102/gappy/utils.pyx#L109) and which appears to be reasonably portable.


---

Comment by mkoeppe created at 2021-02-16 16:32:02

I think it would be good if you could make the .so filename statically configurable in gappy. We may want to link to a specific library known at build time; rather than relying on whatever is found in the runtime library paths.


---

Comment by embray created at 2021-02-17 10:04:07

Replying to [comment:5 mkoeppe]:
> I think it would be good if you could make the .so filename statically configurable in gappy. We may want to link to a specific library known at build time; rather than relying on whatever is found in the runtime library paths.

In fact it used to have that but I removed it because it didn't seem useful.
