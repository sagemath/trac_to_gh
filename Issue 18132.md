# Issue 18132: upgrade eclib to version 20150423

Issue created by migration from https://trac.sagemath.org/ticket/18369

Original creator: cremona

Original creation time: 2015-05-05 20:15:58

Keywords: eclib

eclib version 20150423 contains some efficiency enhancements and also now compiles OK with C++-11.

New upstream source at 
http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/progs/eclib-20150423.tar.bz2


---

Comment by cremona created at 2015-05-06 12:55:09

New commits:


---

Comment by cremona created at 2015-05-06 12:55:09

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-05-07 19:24:56

not working for me

```
checking for boostlib >= 1.35.0... yes
checking whether the Boost::System library is available... yes
checking for exit in -lboost_system... no
configure: error: Could not link against boost_system !
Error configuring eclib.

real	0m9.419s
user	0m1.373s
sys	0m1.608s
************************************************************************
Error installing package eclib-20150423
```



---

Comment by cremona created at 2015-05-07 19:43:43

Frederic, I have had real trouble with the boost configuration since I upgraded the version of the libtool boost config scripts.  I thought I had solved it, but apparently not (except on my machine).  Any chance you could help me diagnose and fix that?  It is suppose to be that if you do not put --with-boost (or --with-boost=<path>) on the configure line, that no boost is used, but now it defaults the other way and whether or not it passes depends on the locally installed boost.  (boost is only needed for running with a multithreaded, i.e. parallel, option, which I do not think is appropriate for Sage).

I have tried explicitly putting --with-boost=no on the command line but that does not work either, though I do not know why.

Thanks for testing.


---

Comment by jdemeyer created at 2015-05-07 20:10:01

Did you try `--with-boost-system=no`?


---

Comment by jdemeyer created at 2015-05-07 20:11:45

It seems that every piece of boost has its own independent(?) `--with` flag:

```
  --with-boost[=ARG]      use Boost library from a standard location
                          (ARG=yes), from the specified location (ARG=<path>),
                          or disable it (ARG=no) [ARG=yes]
  --with-boost-libdir=LIB_DIR
                          Force given directory for boost libraries. Note that
                          this will override library path detection, so use
                          this parameter only if default library detection
                          fails and you know exactly where your boost
                          libraries are located.
  --with-boost-system[=special-lib]
                          use the System library from boost - it is possible
                          to specify a certain library for the linker e.g.
                          --with-boost-system=boost_system-gcc-mt
  --with-boost-asio[=special-lib]
                          use the ASIO library from boost - it is possible to
                          specify a certain library for the linker e.g.
                          --with-boost-asio=boost_system-gcc41-mt-1_34
  --with-boost-thread[=special-lib]
                          use the Thread library from boost - it is possible
                          to specify a certain library for the linker e.g.
                          --with-boost-thread=boost_thread-gcc-mt
```



---

Comment by jdemeyer created at 2015-05-07 20:18:23

I recommend this fix:

```sh
# Boost 1.35.0+ required for Asio (1.25.0 for Thread)
AX_BOOST_BASE([1.35.0], [
AX_BOOST_SYSTEM
AX_BOOST_ASIO
AX_BOOST_THREAD
])
```



---

Comment by jdemeyer created at 2015-05-07 20:19:48

With this, the checks `AX_BOOST_SYSTEM`, `AX_BOOST_ASIO` and `AX_BOOST_THREAD` will only be done if `AX_BOOST_BASE` succeeded. Therefore, `--with-boost=no` will skip all 4.


---

Comment by jdemeyer created at 2015-05-07 20:32:12

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2015-05-07 21:10:08

That all sounds very good, I will test soon.  Feel free to make a pull request at https://github.com/JohnCremona/eclib meanwhile


---

Comment by fbissey created at 2015-05-08 01:25:08

Jeroen's solution sounds good. I am guessing the reason you are seeing this now is because the detection default has changed. All those `--with-xxx` switch usually comes with a default state and now it is set to yes. For example in https://github.com/JohnCremona/eclib/blob/master/m4/ax_boost_system.m4 at line 53 you have

```
        [want_boost="yes"]
```

this means that if you don't pass anything it will assume you want it. If you want the old behaviour of "not on" unless I say so, you want to change that line to

```
        [want_boost="no"]
```

and similarly in all the other `ax_boost_*.m4` files.


---

Comment by cremona created at 2015-05-08 08:28:41

You are right, the default changed in those m4 files.  I think that the masters student who first put the boost support (for multithreading) into eclib manually edited the m4 files.  With this release I upgraded the m4 files to the most recent ones I found online (I cannot remember why, certainly not all was working well before I did that), and this is the effect.

I think that Jeroen's solution is better than to edit the m4 files anyway.  I have not had time to try it out or test it yet.


---

Comment by git created at 2015-05-10 16:59:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2015-05-10 17:02:58

Changing status from needs_work to needs_review.


---

Comment by cremona created at 2015-05-10 17:02:58

Please try this.  Note that the upstream source is now 20150510 instead of 20150423.  The only change is in the boost detection where I use Jeroen's suggested change.  In the Sage commit I updated the package version and checksum and added a line to the install script saying --with-boost="no".  It works for me...


---

Comment by fbissey created at 2015-05-11 01:57:38

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-05-11 01:57:38

Works for me, without or with boost (in sage-on-gentoo). It all behaves as expected as far as I can see.


---

Comment by vbraun created at 2015-05-14 22:40:10

Resolution: fixed
