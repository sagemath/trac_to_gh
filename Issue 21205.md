# Issue 21205: Add a function to check if a given subset is convex in a poset

Issue created by migration from https://trac.sagemath.org/ticket/21442

Original creator: jmantysalo

Original creation time: 2016-09-07 07:23:24

CC:  tscrim

This patch will add a helper function to `hasse_diagram.py` to check that a subset of elements is convex in a poset.

Will be needed to check user input for Alan Day's doubling construction.



---

Comment by jmantysalo created at 2016-09-07 07:24:29

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2016-09-07 07:24:29

New commits:


---

Comment by tscrim created at 2016-09-07 14:01:21

What is `x` here:

```python
lambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]
```

I don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.


---

Comment by git created at 2016-09-07 17:01:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-07 17:08:15

Changing status from needs_review to needs_work.


---

Comment by jmantysalo created at 2016-09-07 17:08:15

Replying to [comment:3 tscrim]:
> What is `x` here:
> {{{#!python
> lambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]
> }}}

What the hell I did? Should be `b`, but I do not know how this happened and was not catch by doctest. Now compiling and re-checking.

> I don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.

I don't understand. The idea is to (try to) found an element `a` in S covered by element `b` not in S and then check if some directed path from `b` goes to some element `c` in S.


---

Comment by tscrim created at 2016-09-07 21:11:26

Well, since there is a dependence on `b`, my second sentence is moot/invalid. I would just like to see the following to get it ~80 chars per line:

```diff
--- a/src/sage/combinat/posets/hasse_diagram.py
+++ b/src/sage/combinat/posets/hasse_diagram.py
@@ -2100,7 +2100,7 @@ class HasseDiagram(DiGraph):
                 if b >= s_max or b in S:
                     continue
                 # Now b not in S, b > a and a in S.
-                for c in self.depth_first_search(a, neighbors=lambda v: [v for v in self.neighbor_out_iterator(b) if v < s_max and s not in ok]):
+                neighbors = lambda v: [v for v in self.neighbor_out_iterator(b)
+                                       if v < s_max and s not in ok]
+                for c in self.depth_first_search(a, neighbors=neighbors):
                     if c in S:  # Now c in S, b not in S, a in S, a < b < c.
                         return False
                     ok.add(c)  # Do not re-check this for being our b.
```

Then if all tests pass, positive review.


---

Comment by jmantysalo created at 2016-09-08 05:49:59

This was an interesting case. Basic "bug" is just a feature, and can be seen with


```
sage: g = Graph(42)
sage: for x in g.depth_first_search(0, neighbors=lambda v: junk(v)):
....:     print(x)
```


which will output `0` and only after that gives error message. So I really must re-check my code and make a doctest that will catch error like this one.


---

Comment by git created at 2016-09-08 15:10:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-08 15:14:45

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2016-09-08 15:14:45

Now at last. Coded when sick, hope that works still...


---

Comment by jmantysalo created at 2016-09-17 10:12:48

Just pinging.


---

Comment by tscrim created at 2016-09-17 15:41:21

Looks good. Two trivial things:

- I'm paranoid, but anytime there is latex, I like to use raw strings: `r"""`
- Could you break this line:
  {{{#!diff
-neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_) if v <= s_max and v not in ok]
+neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_)
+if v <= s_max and v not in ok]
  }}}

You can set a positive review on my behalf.


---

Comment by git created at 2016-09-18 08:12:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-18 08:25:25

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2016-09-18 08:25:25

Suggested minor changes done.


---

Comment by vbraun created at 2016-09-19 23:12:13

Resolution: fixed
