# Issue 22549: cephes' complex.h conflicts with a numpy header on FreeBSD

Issue created by migration from https://trac.sagemath.org/ticket/22786

Original creator: dimpase

Original creation time: 2017-04-08 21:02:22

CC:  fbissey

numpy now has its own `complex.h` header, which conflics with cephes' one on FreeBSD. So we should not include it on FreeBSD. 


---

Comment by dimpase created at 2017-04-08 21:03:34

Changing status from new to needs_review.


---

Comment by dimpase created at 2017-04-08 21:03:34

This is quite harmless and easy to review.


---

Comment by jdemeyer created at 2017-04-09 08:56:34

Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.

And for consistency use 4 spaces for indentation, also in shell scripts.


---

Comment by jdemeyer created at 2017-04-09 08:56:34

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-04-09 08:57:34

I also find it dubious that you change `$CC`. Usually, `$CFLAGS` is the variable where you add compiler flags.


---

Comment by dimpase created at 2017-04-09 09:33:38

Replying to [comment:2 jdemeyer]:
> Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.

No, this is the cephes header, only installed on FreeBSD.

> 
> And for consistency use 4 spaces for indentation, also in shell scripts.
I'll fix this, sure, no problem.

> I also find it dubious that you change $CC. Usually, $CFLAGS is the variable where you add compiler flags.

But numpy's spkg-install unsets CFLAGS, cf lines 55-56:

```
# Program around a bug in SciPY's distutils.
unset CFLAGS
```

Thus I modify CC.


---

Comment by git created at 2017-04-09 09:36:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2017-04-09 09:37:27

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-04-09 16:18:21

Replying to [comment:4 dimpase]:
> Replying to [comment:2 jdemeyer]:
> > Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.
> 
> No, this is the cephes header, only installed on FreeBSD.

I don't think you should _assume_ that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?


---

Comment by jdemeyer created at 2017-04-09 16:18:49

Replying to [comment:4 dimpase]:
> {{{
> # Program around a bug in SciPY's distutils.
> unset CFLAGS
> }}}

Is this still relevant? Maybe you should check if you can use `CFLAGS` anyway.


---

Comment by jdemeyer created at 2017-04-09 16:24:10

Replying to [comment:7 jdemeyer]:
> I don't think you should _assume_ that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?

I would like to add: I always try to do things as simple as possible. Doing the same thing for all systems is simpler than special-casing one particular system. So, if both work, go for the simpler solution.


---

Comment by jdemeyer created at 2017-04-09 16:25:35

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-04-09 16:25:35

And don't forget to bump the numpy package version.


---

Comment by git created at 2017-04-09 20:47:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-04-09 20:51:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2017-04-09 20:56:32

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2017-04-09 20:56:32

I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.

There are more places in the spkg-install that add stuff to `CC`, so cleaning this up is beyond the modest scope of this ticket.


---

Comment by jdemeyer created at 2017-04-10 07:52:41

Replying to [comment:13 dimpase]:
> I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.
> 
> There are more places in the spkg-install that add stuff to `CC`

You mean the `SAGE64` stuff? First of all, for `-m64` it actually does make sense to add it to `CC` (as it applies to the all of the toolchain, from compiler to linker). Second, nobody uses `SAGE64`, so it's not really relevant anyway.

The `unset CFLAGS` dates from 2008, so it's likely no longer relevant.


---

Comment by dimpase created at 2017-04-10 12:16:16

Replying to [comment:14 jdemeyer]:

> The `unset CFLAGS` dates from 2008, so it's likely no longer relevant.
I've opened  #22791 to deal with this.


---

Comment by git created at 2017-04-11 11:10:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-04-11 11:20:18

OK, done, and checked to work on Linux and FreeBSD.


---

Comment by jdemeyer created at 2017-04-11 12:05:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-04-11 12:05:41

I find it more readable to write `export CFLAGS="...."` instead of doing it on two separate lines. But that's a detail.


---

Comment by vbraun created at 2017-04-13 22:36:46

Resolution: fixed
