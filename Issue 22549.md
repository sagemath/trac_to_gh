# Issue 22549: cephes' complex.h conflicts with a numpy header on FreeBSD

archive/issues_022549.json:
```json
{
    "body": "CC:  @kiwifb\n\nnumpy now has its own `complex.h` header, which conflics with cephes' one on FreeBSD. So we should not include it on FreeBSD. \n\nIssue created by migration from https://trac.sagemath.org/ticket/22786\n\n",
    "closed_at": "2017-04-13T22:36:46Z",
    "created_at": "2017-04-08T21:02:22Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "cephes' complex.h conflicts with a numpy header on FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22549",
    "user": "https://github.com/dimpase"
}
```
CC:  @kiwifb

numpy now has its own `complex.h` header, which conflics with cephes' one on FreeBSD. So we should not include it on FreeBSD. 

Issue created by migration from https://trac.sagemath.org/ticket/22786





---

archive/issue_comments_313944.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-08T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313944",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313945.json:
```json
{
    "body": "This is quite harmless and easy to review.",
    "created_at": "2017-04-08T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313945",
    "user": "https://github.com/dimpase"
}
```

This is quite harmless and easy to review.



---

archive/issue_comments_313946.json:
```json
{
    "body": "Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.\n\nAnd for consistency use 4 spaces for indentation, also in shell scripts.",
    "created_at": "2017-04-09T08:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313946",
    "user": "https://github.com/jdemeyer"
}
```

Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.

And for consistency use 4 spaces for indentation, also in shell scripts.



---

archive/issue_comments_313947.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-09T08:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313947",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313948.json:
```json
{
    "body": "I also find it dubious that you change `$CC`. Usually, `$CFLAGS` is the variable where you add compiler flags.",
    "created_at": "2017-04-09T08:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313948",
    "user": "https://github.com/jdemeyer"
}
```

I also find it dubious that you change `$CC`. Usually, `$CFLAGS` is the variable where you add compiler flags.



---

archive/issue_comments_313949.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.\n\n\nNo, this is the cephes header, only installed on FreeBSD.\n\n> \n> And for consistency use 4 spaces for indentation, also in shell scripts.\n\nI'll fix this, sure, no problem.\n\n> I also find it dubious that you change $CC. Usually, $CFLAGS is the variable where you add compiler flags.\n\n\nBut numpy's spkg-install unsets CFLAGS, cf lines 55-56:\n\n```\n# Program around a bug in SciPY's distutils.\nunset CFLAGS\n```\nThus I modify CC.",
    "created_at": "2017-04-09T09:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313949",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:2 jdemeyer]:
> Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.


No, this is the cephes header, only installed on FreeBSD.

> 
> And for consistency use 4 spaces for indentation, also in shell scripts.

I'll fix this, sure, no problem.

> I also find it dubious that you change $CC. Usually, $CFLAGS is the variable where you add compiler flags.


But numpy's spkg-install unsets CFLAGS, cf lines 55-56:

```
# Program around a bug in SciPY's distutils.
unset CFLAGS
```
Thus I modify CC.



---

archive/issue_comments_313950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-09T09:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313951.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-09T09:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313951",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313952.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> Replying to [comment:2 jdemeyer]:\n> > Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.\n\n> \n> No, this is the cephes header, only installed on FreeBSD.\n\n\nI don't think you should *assume* that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?",
    "created_at": "2017-04-09T16:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313952",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 dimpase]:
> Replying to [comment:2 jdemeyer]:
> > Why only on freeBSD? If there is a conflicting header, it will exist on other OSes too.

> 
> No, this is the cephes header, only installed on FreeBSD.


I don't think you should *assume* that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?



---

archive/issue_comments_313953.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> {{{\n> # Program around a bug in SciPY's distutils.\n> unset CFLAGS\n> }}}\n\n\nIs this still relevant? Maybe you should check if you can use `CFLAGS` anyway.",
    "created_at": "2017-04-09T16:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313953",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 dimpase]:
> {{{
> # Program around a bug in SciPY's distutils.
> unset CFLAGS
> }}}


Is this still relevant? Maybe you should check if you can use `CFLAGS` anyway.



---

archive/issue_comments_313954.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> I don't think you should *assume* that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?\n\n\nI would like to add: I always try to do things as simple as possible. Doing the same thing for all systems is simpler than special-casing one particular system. So, if both work, go for the simpler solution.",
    "created_at": "2017-04-09T16:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313954",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 jdemeyer]:
> I don't think you should *assume* that cephes is only installed on FreeBSD. Adding the macro doesn't hurt if cephes is not installed, so why not play it safe?


I would like to add: I always try to do things as simple as possible. Doing the same thing for all systems is simpler than special-casing one particular system. So, if both work, go for the simpler solution.



---

archive/issue_comments_313955.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-09T16:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313955",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313956.json:
```json
{
    "body": "And don't forget to bump the numpy package version.",
    "created_at": "2017-04-09T16:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313956",
    "user": "https://github.com/jdemeyer"
}
```

And don't forget to bump the numpy package version.



---

archive/issue_comments_313957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-09T20:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-09T20:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313959.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-09T20:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313959",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313960.json:
```json
{
    "body": "I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.\n\nThere are more places in the spkg-install that add stuff to `CC`, so cleaning this up is beyond the modest scope of this ticket.",
    "created_at": "2017-04-09T20:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313960",
    "user": "https://github.com/dimpase"
}
```

I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.

There are more places in the spkg-install that add stuff to `CC`, so cleaning this up is beyond the modest scope of this ticket.



---

archive/issue_comments_313961.json:
```json
{
    "body": "Replying to [comment:13 dimpase]:\n> I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.\n> \n> There are more places in the spkg-install that add stuff to `CC`\n\n\nYou mean the `SAGE64` stuff? First of all, for `-m64` it actually does make sense to add it to `CC` (as it applies to the all of the toolchain, from compiler to linker). Second, nobody uses `SAGE64`, so it's not really relevant anyway.\n\nThe `unset CFLAGS` dates from 2008, so it's likely no longer relevant.",
    "created_at": "2017-04-10T07:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313961",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 dimpase]:
> I've made adding this flag unconditional, as you suggest, and bumped up the version to p1.
> 
> There are more places in the spkg-install that add stuff to `CC`


You mean the `SAGE64` stuff? First of all, for `-m64` it actually does make sense to add it to `CC` (as it applies to the all of the toolchain, from compiler to linker). Second, nobody uses `SAGE64`, so it's not really relevant anyway.

The `unset CFLAGS` dates from 2008, so it's likely no longer relevant.



---

archive/issue_comments_313962.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n\n> The `unset CFLAGS` dates from 2008, so it's likely no longer relevant.\n\nI've opened  #22791 to deal with this.",
    "created_at": "2017-04-10T12:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313962",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:14 jdemeyer]:

> The `unset CFLAGS` dates from 2008, so it's likely no longer relevant.

I've opened  #22791 to deal with this.



---

archive/issue_comments_313963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-11T11:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313964.json:
```json
{
    "body": "OK, done, and checked to work on Linux and FreeBSD.",
    "created_at": "2017-04-11T11:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313964",
    "user": "https://github.com/dimpase"
}
```

OK, done, and checked to work on Linux and FreeBSD.



---

archive/issue_comments_313965.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-11T12:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313965",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313966.json:
```json
{
    "body": "I find it more readable to write `export CFLAGS=\"....\"` instead of doing it on two separate lines. But that's a detail.",
    "created_at": "2017-04-11T12:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313966",
    "user": "https://github.com/jdemeyer"
}
```

I find it more readable to write `export CFLAGS="...."` instead of doing it on two separate lines. But that's a detail.



---

archive/issue_events_059284.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-13T22:36:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22549#event-59284"
}
```



---

archive/issue_comments_313967.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-13T22:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22549#issuecomment-313967",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
