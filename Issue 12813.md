# Issue 12813: Possible future issues with ECL build with unicode enabled

archive/issues_012813.json:
```json
{
    "body": "Assignee: was\n\nCC:  jpflori snark\n\necl 12.2.1 has unicode support enabled by default, what creates two string types, t_base_string and t_string. The problem is that sage does not properly handle those, as described in https://sourceforge.net/tracker/?func=detail&aid=3526370&group_id=30035&atid=398053\n\nAFAIK it can be built with unicode disabled, just that it will fail make check at least.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12985\n\n",
    "created_at": "2012-05-20T18:46:44Z",
    "labels": [
        "interfaces",
        "minor",
        "enhancement"
    ],
    "title": "Possible future issues with ECL build with unicode enabled",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12813",
    "user": "pcpa"
}
```
Assignee: was

CC:  jpflori snark

ecl 12.2.1 has unicode support enabled by default, what creates two string types, t_base_string and t_string. The problem is that sage does not properly handle those, as described in https://sourceforge.net/tracker/?func=detail&aid=3526370&group_id=30035&atid=398053

AFAIK it can be built with unicode disabled, just that it will fail make check at least.

Issue created by migration from https://trac.sagemath.org/ticket/12985





---

archive/issue_comments_153905.json:
```json
{
    "body": "Attachment [sage-5.0-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/sage-5.0-ecl-unicode.patch) by pcpa created at 2012-05-20 18:47:22\n\nsage-5.0-ecl-unicode.patch",
    "created_at": "2012-05-20T18:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153905",
    "user": "pcpa"
}
```

Attachment [sage-5.0-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/sage-5.0-ecl-unicode.patch) by pcpa created at 2012-05-20 18:47:22

sage-5.0-ecl-unicode.patch



---

archive/issue_comments_153906.json:
```json
{
    "body": "Thanks Paulo, we had identified that problem in sage-on-gentoo a long time ago but since we can just ask for ecl to be build without unicode support for sage we just did that. If we apply your patch does sage work just as well if ecl is compiled without unicode support or does that become a requirement?",
    "created_at": "2012-06-29T11:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153906",
    "user": "fbissey"
}
```

Thanks Paulo, we had identified that problem in sage-on-gentoo a long time ago but since we can just ask for ecl to be build without unicode support for sage we just did that. If we apply your patch does sage work just as well if ecl is compiled without unicode support or does that become a requirement?



---

archive/issue_comments_153907.json:
```json
{
    "body": "Actually just looking at the patch, you are just adding a conversion layer, right?",
    "created_at": "2012-06-29T11:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153907",
    "user": "fbissey"
}
```

Actually just looking at the patch, you are just adding a conversion layer, right?



---

archive/issue_comments_153908.json:
```json
{
    "body": "Replying to [comment:2 fbissey]:\n> Actually just looking at the patch, you are just adding a conversion layer, right?\nYes, and if the ecl is built without unicode support, it should be a minor overhead noop, as it would attempt to convert a base string to a base string :-)\nThere are some comments from Juan at http://sourceforge.net/tracker/?func=detail&aid=3526370&group_id=30035&atid=398053 that may be of interest, about possible issues with unprotected lisp objects.",
    "created_at": "2012-07-01T10:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153908",
    "user": "pcpa"
}
```

Replying to [comment:2 fbissey]:
> Actually just looking at the patch, you are just adding a conversion layer, right?
Yes, and if the ecl is built without unicode support, it should be a minor overhead noop, as it would attempt to convert a base string to a base string :-)
There are some comments from Juan at http://sourceforge.net/tracker/?func=detail&aid=3526370&group_id=30035&atid=398053 that may be of interest, about possible issues with unprotected lisp objects.



---

archive/issue_comments_153909.json:
```json
{
    "body": "Juan's of course right in being concerned that objects are protected against garbage collection while alive. As far as I know, Boehm does watch the C stack for pointers, so a local variable pointing to the string should protect it against garbage collection while in scope.\n\nI'm pretty sure that every `ecl_base_string_pointer_safe` occurs in a context where a python string object is required. Cython injects a `PyBytes_FromString` for that, which copies the content into a Python allocated object. The ECL-managed object is thus extremely short lived and during its life, is referenced by a local C variable (i.e., is referenced on the C stack). Boehm is supposed to watch the C stack for references, so it is protected against GC during its life.\n\nIf the reference returned by `ecl_base_string_pointer_safe` were to be stored in, say, a malloc'd location (or Python managed memory) such protection is no longer guaranteed. This is why `EclObject.set_obj` makes the little `remove_node`/`insert_node_after` dance, which ensures that a reference to the underlying ecl-object is stored within memory watched by Boehm-GC.\n\n**EDIT**: Actually, I see what Juan is worried about: `ecl_base_string_pointer_safe` is a pointer to the string *content*, not the ecl string object. So yes, explicitly assigning the result of `cl_write_to_string` to a local variable, as he suggests, is probably a good idea.\n\nThe whole unicode problem would of course be much more elegantly solved by directly converting ecl unicode strings to python unicode strings and back. Given our use of ecl (maxima), there would be very little actual gain from doing so.",
    "created_at": "2012-07-04T06:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153909",
    "user": "nbruin"
}
```

Juan's of course right in being concerned that objects are protected against garbage collection while alive. As far as I know, Boehm does watch the C stack for pointers, so a local variable pointing to the string should protect it against garbage collection while in scope.

I'm pretty sure that every `ecl_base_string_pointer_safe` occurs in a context where a python string object is required. Cython injects a `PyBytes_FromString` for that, which copies the content into a Python allocated object. The ECL-managed object is thus extremely short lived and during its life, is referenced by a local C variable (i.e., is referenced on the C stack). Boehm is supposed to watch the C stack for references, so it is protected against GC during its life.

If the reference returned by `ecl_base_string_pointer_safe` were to be stored in, say, a malloc'd location (or Python managed memory) such protection is no longer guaranteed. This is why `EclObject.set_obj` makes the little `remove_node`/`insert_node_after` dance, which ensures that a reference to the underlying ecl-object is stored within memory watched by Boehm-GC.

**EDIT**: Actually, I see what Juan is worried about: `ecl_base_string_pointer_safe` is a pointer to the string *content*, not the ecl string object. So yes, explicitly assigning the result of `cl_write_to_string` to a local variable, as he suggests, is probably a good idea.

The whole unicode problem would of course be much more elegantly solved by directly converting ecl unicode strings to python unicode strings and back. Given our use of ecl (maxima), there would be very little actual gain from doing so.



---

archive/issue_comments_153910.json:
```json
{
    "body": "patch to wrap ecl potential unicode output",
    "created_at": "2012-07-06T01:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153910",
    "user": "fbissey"
}
```

patch to wrap ecl potential unicode output



---

archive/issue_comments_153911.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-06T01:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153911",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153912.json:
```json
{
    "body": "Attachment [trac12985-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/trac12985-ecl-unicode.patch) by fbissey created at 2012-07-06 01:40:33\n\nI have put the patch in a better shape and checked it applied correctly on a recent 5.2beta0. I'd very much like this to go in 5.2. It doesn't really benefit sage at the present time but makes the works from people like me and Paulo on getting sage to run natively on linux distros much easier. I am doing a few tests and then I'll give it the thumbs up.",
    "created_at": "2012-07-06T01:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153912",
    "user": "fbissey"
}
```

Attachment [trac12985-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/trac12985-ecl-unicode.patch) by fbissey created at 2012-07-06 01:40:33

I have put the patch in a better shape and checked it applied correctly on a recent 5.2beta0. I'd very much like this to go in 5.2. It doesn't really benefit sage at the present time but makes the works from people like me and Paulo on getting sage to run natively on linux distros much easier. I am doing a few tests and then I'll give it the thumbs up.



---

archive/issue_comments_153913.json:
```json
{
    "body": "Paulo I tried the patch with 5.1.beta6 and ecl-12.2.1 with unicode enabled and the sage/libs/ecl.pyx doctest stops waiting for input (with -verbose I get):\n\n```\nTrying:\n    interrupt_after_delay(Integer(1000))###line 246:_sage_    >>> interrupt_after_delay(1000)\nExpecting nothing\nok\nTrying:\n    inf_loop()###line 247:_sage_    >>> inf_loop()\nExpecting:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: ECL says: Console interrupt\n\nCondition of type: SIMPLE-TYPE-ERROR\nIn function MAKE-FOREIGN-DATA-FROM-ARRAY, the value of argument is\n        \"Console interrupt.\"\nwhich is not of expected type BASE-STRING\nAvailable restarts:\n\n1. (USE-VALUE) Supply a new value of type BASE-STRING.\n\nTop level.\n> \n```\n\nand it stays at that prompt until I interrupt it.",
    "created_at": "2012-07-06T02:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153913",
    "user": "fbissey"
}
```

Paulo I tried the patch with 5.1.beta6 and ecl-12.2.1 with unicode enabled and the sage/libs/ecl.pyx doctest stops waiting for input (with -verbose I get):

```
Trying:
    interrupt_after_delay(Integer(1000))###line 246:_sage_    >>> interrupt_after_delay(1000)
Expecting nothing
ok
Trying:
    inf_loop()###line 247:_sage_    >>> inf_loop()
Expecting:
    Traceback (most recent call last):
    ...
    RuntimeError: ECL says: Console interrupt

Condition of type: SIMPLE-TYPE-ERROR
In function MAKE-FOREIGN-DATA-FROM-ARRAY, the value of argument is
        "Console interrupt."
which is not of expected type BASE-STRING
Available restarts:

1. (USE-VALUE) Supply a new value of type BASE-STRING.

Top level.
> 
```

and it stays at that prompt until I interrupt it.



---

archive/issue_comments_153914.json:
```json
{
    "body": "I cannot test it right now as I am still fighting to get a lot of packages updated in fedora, but will try to switch from sage-5.0.1 to 5.1.beta as soon as possible. The failure could be the requirement of some extra patch, or, the \"interrupt after delay\" may need some kind of \"non interrruptible\" code block when making the conversion.\n\nBut the error message appears to tell it somehow got a t_string where a t_base_string was expected, so, probably the ecl-unicode patch needs to be extended for 5.1.beta6.\n\nHopefully, `sage/libs/ecl.pxd` diff from 5.1.beta6 to 5.0.1 will show where the probem is, or, a new test case is triggering some unexpected condition.",
    "created_at": "2012-07-06T14:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153914",
    "user": "pcpa"
}
```

I cannot test it right now as I am still fighting to get a lot of packages updated in fedora, but will try to switch from sage-5.0.1 to 5.1.beta as soon as possible. The failure could be the requirement of some extra patch, or, the "interrupt after delay" may need some kind of "non interrruptible" code block when making the conversion.

But the error message appears to tell it somehow got a t_string where a t_base_string was expected, so, probably the ecl-unicode patch needs to be extended for 5.1.beta6.

Hopefully, `sage/libs/ecl.pxd` diff from 5.1.beta6 to 5.0.1 will show where the probem is, or, a new test case is triggering some unexpected condition.



---

archive/issue_comments_153915.json:
```json
{
    "body": "Isn't this just a case of missed conversions? On line 256 we have\n\n```\n    if ecl_nvalues > 1:\n        raise RuntimeError, \"ECL says: \"+ecl_base_string_pointer_safe(ecl_values(1))\n    else:\n        return ecl_values(0)\n```\n\n(this occurs in `ecl_safe_eval`, `ecl_safe_funcall`, `ecl_safe_apply`) and none of the patches here seem to touch that line. The second value will be ECL's error string, which is probably a unicode string if ECL uses unicode. Two solutions:\n\n* Change the definitions of the LISP routines `sage-safe-eval` and friend (line 212 and further) to already convert the error message to base_string, e.g.:\n\n\n```\n        (defun sage-safe-eval (form)\n            (handler-case\n                (values (eval form))\n                (serious-condition (cnd)\n                    (values nil (si:coerce-to-base-string (princ-to-string cnd))))))\n```\n\nI don't think in this case we need to store the reference to `ecl_values(1)`, because the value itself is in a \"last value returned\" buffer by ecl and all we're doing is reaching into it to get a string pointer and copy it into a python string. No opportunity for ecl to invalidate the `values` buffer.\n\n* do the conversion in the python routines:\n\n\n```\ncdef cl_object ecl_safe_eval(cl_object form) except NULL:\n    cdef cl_object s \n    ecl_sig_on()\n    cl_funcall(2,safe_eval_clobj,form)\n    ecl_sig_off()\n\n    if ecl_nvalues > 1:\n        s = si_coerce_to_base_string(ecl_values(1))\n        raise RuntimeError, \"ECL says: \"+ecl_base_string_pointer_safe(s)\n    else:\n        return ecl_values(0)\n```\n",
    "created_at": "2012-07-06T15:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153915",
    "user": "nbruin"
}
```

Isn't this just a case of missed conversions? On line 256 we have

```
    if ecl_nvalues > 1:
        raise RuntimeError, "ECL says: "+ecl_base_string_pointer_safe(ecl_values(1))
    else:
        return ecl_values(0)
```

(this occurs in `ecl_safe_eval`, `ecl_safe_funcall`, `ecl_safe_apply`) and none of the patches here seem to touch that line. The second value will be ECL's error string, which is probably a unicode string if ECL uses unicode. Two solutions:

* Change the definitions of the LISP routines `sage-safe-eval` and friend (line 212 and further) to already convert the error message to base_string, e.g.:


```
        (defun sage-safe-eval (form)
            (handler-case
                (values (eval form))
                (serious-condition (cnd)
                    (values nil (si:coerce-to-base-string (princ-to-string cnd))))))
```

I don't think in this case we need to store the reference to `ecl_values(1)`, because the value itself is in a "last value returned" buffer by ecl and all we're doing is reaching into it to get a string pointer and copy it into a python string. No opportunity for ecl to invalidate the `values` buffer.

* do the conversion in the python routines:


```
cdef cl_object ecl_safe_eval(cl_object form) except NULL:
    cdef cl_object s 
    ecl_sig_on()
    cl_funcall(2,safe_eval_clobj,form)
    ecl_sig_off()

    if ecl_nvalues > 1:
        s = si_coerce_to_base_string(ecl_values(1))
        raise RuntimeError, "ECL says: "+ecl_base_string_pointer_safe(s)
    else:
        return ecl_values(0)
```




---

archive/issue_comments_153916.json:
```json
{
    "body": "Rediff of patch and applying changes in nbruin comment",
    "created_at": "2012-07-10T17:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153916",
    "user": "pcpa"
}
```

Rediff of patch and applying changes in nbruin comment



---

archive/issue_comments_153917.json:
```json
{
    "body": "Attachment [sage-5.2-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/sage-5.2-ecl-unicode.patch) by jpflori created at 2012-07-11 17:30:44",
    "created_at": "2012-07-11T17:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153917",
    "user": "jpflori"
}
```

Attachment [sage-5.2-ecl-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/sage-5.2-ecl-unicode.patch) by jpflori created at 2012-07-11 17:30:44



---

archive/issue_comments_153918.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> Paulo I tried the patch with 5.1.beta6 and ecl-12.2.1 with unicode enabled and the sage/libs/ecl.pyx doctest stops waiting for input (with -verbose I get):\n> {{{\n> Trying:\n>     interrupt_after_delay(Integer(1000))###line 246:_sage_    >>> interrupt_after_delay(1000)\n> Expecting nothing\n> ok\n> Trying:\n>     inf_loop()###line 247:_sage_    >>> inf_loop()\n> Expecting:\n>     Traceback (most recent call last):\n>     ...\n>     RuntimeError: ECL says: Console interrupt\n> \n> Condition of type: SIMPLE-TYPE-ERROR\n> In function MAKE-FOREIGN-DATA-FROM-ARRAY, the value of argument is\n>         \"Console interrupt.\"\n> which is not of expected type BASE-STRING\n> Available restarts:\n> \n> 1. (USE-VALUE) Supply a new value of type BASE-STRING.\n> \n> Top level.\n> > \n> }}}\n> and it stays at that prompt until I interrupt it.\n\nWith ecl-12.7.1 it just hangs at the same spot even without unicode so there may be something deeper going on there. Haven't tried the new patch it did go under my radar unnoticed so I don't know if it will solve the problem yet.",
    "created_at": "2012-08-05T11:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153918",
    "user": "fbissey"
}
```

Replying to [comment:6 fbissey]:
> Paulo I tried the patch with 5.1.beta6 and ecl-12.2.1 with unicode enabled and the sage/libs/ecl.pyx doctest stops waiting for input (with -verbose I get):
> {{{
> Trying:
>     interrupt_after_delay(Integer(1000))###line 246:_sage_    >>> interrupt_after_delay(1000)
> Expecting nothing
> ok
> Trying:
>     inf_loop()###line 247:_sage_    >>> inf_loop()
> Expecting:
>     Traceback (most recent call last):
>     ...
>     RuntimeError: ECL says: Console interrupt
> 
> Condition of type: SIMPLE-TYPE-ERROR
> In function MAKE-FOREIGN-DATA-FROM-ARRAY, the value of argument is
>         "Console interrupt."
> which is not of expected type BASE-STRING
> Available restarts:
> 
> 1. (USE-VALUE) Supply a new value of type BASE-STRING.
> 
> Top level.
> > 
> }}}
> and it stays at that prompt until I interrupt it.

With ecl-12.7.1 it just hangs at the same spot even without unicode so there may be something deeper going on there. Haven't tried the new patch it did go under my radar unnoticed so I don't know if it will solve the problem yet.



---

archive/issue_comments_153919.json:
```json
{
    "body": "I will have to reformat your patch a little bit Paulo. Not only it wasn't produced by hg my cython didn't like the result very much\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\n    ecl_sig_on()\n    cl_funcall(2,safe_eval_clobj,form)\n    ecl_sig_off()\n\n    if ecl_nvalues > 1:\n        s = si_coerce_to_base_string(ecl_values(1))\n^\n------------------------------------------------------------\n\nsage/libs/ecl.pyx:258:0: Mixed use of tabs and spaces\n```\n",
    "created_at": "2012-08-06T10:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153919",
    "user": "fbissey"
}
```

I will have to reformat your patch a little bit Paulo. Not only it wasn't produced by hg my cython didn't like the result very much

```
Error compiling Cython file:
------------------------------------------------------------
...
    ecl_sig_on()
    cl_funcall(2,safe_eval_clobj,form)
    ecl_sig_off()

    if ecl_nvalues > 1:
        s = si_coerce_to_base_string(ecl_values(1))
^
------------------------------------------------------------

sage/libs/ecl.pyx:258:0: Mixed use of tabs and spaces
```




---

archive/issue_comments_153920.json:
```json
{
    "body": "I have a riddle. With the patch and ecl 12.7.1\n\n```\nsage -t -long -force_lib \"devel/sage/sage/libs/ecl.pyx\" -verbose\n```\n\ntake 2.9s and is successful if you exclude [this little problem](https://github.com/cschwan/sage-on-gentoo/issues/123) but if I run it without \"-verbose\" it times out - presumably at the same spot. And I haven't tried unicode yet.",
    "created_at": "2012-08-06T11:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153920",
    "user": "fbissey"
}
```

I have a riddle. With the patch and ecl 12.7.1

```
sage -t -long -force_lib "devel/sage/sage/libs/ecl.pyx" -verbose
```

take 2.9s and is successful if you exclude [this little problem](https://github.com/cschwan/sage-on-gentoo/issues/123) but if I run it without "-verbose" it times out - presumably at the same spot. And I haven't tried unicode yet.



---

archive/issue_comments_153921.json:
```json
{
    "body": "I noticed later I submitted a patch with tabs instead of spaces in a few places but left it as an exercise for the reader to correct :-)\n\nIt appears to work in my current Fedora build\n\n\n```\n$ rpm -q sagemath ecl\nsagemath-5.2-1.fc18.x86_64\necl-12.2.1-4.fc18.x86_64\n```\n\nRunning it I see:\n\n\n```\n$ sage -t -long -force_lib \"devel/sage/sage/libs/ecl.pyx\"\nsage -t -long -force_lib \"devel/sage/sage/libs/ecl.pyx\"\u00a0\u00a0\u00a0\u00a0 \n**********************************************************************\nFile \"/usr/share/sagemath/devel/sage/sage/libs/ecl.pyx\", line 247:\n\u00a0\u00a0\u00a0 sage: inf_loop()\nExpected:\n\u00a0\u00a0\u00a0 Traceback (most recent call last):\n\u00a0\u00a0\u00a0 ...\n\u00a0\u00a0\u00a0 RuntimeError: ECL says: Console interrupt\nGot:\n\u00a0\u00a0\u00a0 Traceback (most recent call last):\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/usr/share/sagemath/local/bin/ncadoctest.py\", line 1231, in run_one_test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 self.run_one_example(test, example, filename, compileflags)\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/usr/share/sagemath/local/bin/sagedoctest.py\", line 38, in run_one_example\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/usr/share/sagemath/local/bin/ncadoctest.py\", line 1172, in run_one_example\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 compileflags, 1) in test.globs\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"<doctest __main__.example_6[7]>\", line 1, in <module>\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 inf_loop()###line 247:\n\u00a0\u00a0\u00a0 sage: inf_loop()\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"ecl.pyx\", line 712, in sage.libs.ecl.EclObject.__call__ (sage/libs/ecl.c:5042)\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"ecl.pyx\", line 285, in sage.libs.ecl.ecl_safe_apply (sage/libs/ecl.c:3047)\n\u00a0\u00a0\u00a0 RuntimeError: ECL says: Console interrupt.\n**********************************************************************\n1 items had failures:\n\u00a0\u00a0 1 of\u00a0\u00a0 9 in __main__.example_6\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/pcpa/.sage/tmp/ecl_1962.py\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [7.1 s]\n\u00a0\n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 sage -t -long -force_lib \"devel/sage/sage/libs/ecl.pyx\"\nTotal time for all tests: 7.2 seconds\n```\n\nAlso takes 2.8s in the second run...\n\nI suspect it should be ecl-2.7.1, but there may be a few other variables involving gc and glibc version.\n\nI did not look at ecl-2.7.1 yet, but maybe need a patch equivalent to\n\nhttp://pkgs.fedoraproject.org/cgit/ecl.git/tree/ecl-12.2.1-signal_handling_thread.patch\n\nShould not be required as sagemath should already have an equivalent patch, and the above patch was required to make maxima ecl backend not hang.",
    "created_at": "2012-08-06T23:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153921",
    "user": "pcpa"
}
```

I noticed later I submitted a patch with tabs instead of spaces in a few places but left it as an exercise for the reader to correct :-)

It appears to work in my current Fedora build


```
$ rpm -q sagemath ecl
sagemath-5.2-1.fc18.x86_64
ecl-12.2.1-4.fc18.x86_64
```

Running it I see:


```
$ sage -t -long -force_lib "devel/sage/sage/libs/ecl.pyx"
sage -t -long -force_lib "devel/sage/sage/libs/ecl.pyx"     
**********************************************************************
File "/usr/share/sagemath/devel/sage/sage/libs/ecl.pyx", line 247:
    sage: inf_loop()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: ECL says: Console interrupt
Got:
    Traceback (most recent call last):
      File "/usr/share/sagemath/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/share/sagemath/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/share/sagemath/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[7]>", line 1, in <module>
        inf_loop()###line 247:
    sage: inf_loop()
      File "ecl.pyx", line 712, in sage.libs.ecl.EclObject.__call__ (sage/libs/ecl.c:5042)
      File "ecl.pyx", line 285, in sage.libs.ecl.ecl_safe_apply (sage/libs/ecl.c:3047)
    RuntimeError: ECL says: Console interrupt.
**********************************************************************
1 items had failures:
   1 of   9 in __main__.example_6
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/pcpa/.sage/tmp/ecl_1962.py
         [7.1 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -long -force_lib "devel/sage/sage/libs/ecl.pyx"
Total time for all tests: 7.2 seconds
```

Also takes 2.8s in the second run...

I suspect it should be ecl-2.7.1, but there may be a few other variables involving gc and glibc version.

I did not look at ecl-2.7.1 yet, but maybe need a patch equivalent to

http://pkgs.fedoraproject.org/cgit/ecl.git/tree/ecl-12.2.1-signal_handling_thread.patch

Should not be required as sagemath should already have an equivalent patch, and the above patch was required to make maxima ecl backend not hang.



---

archive/issue_comments_153922.json:
```json
{
    "body": "We don't that patch in Gentoo at all. Never noticed a problem with maxima so far. It is just curious that with 12.7.1 I get a different behavior between a verbose and non-verbose test. No that's a puzzler to me. There must be a variable affecting ecl or something.",
    "created_at": "2012-08-06T23:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153922",
    "user": "fbissey"
}
```

We don't that patch in Gentoo at all. Never noticed a problem with maxima so far. It is just curious that with 12.7.1 I get a different behavior between a verbose and non-verbose test. No that's a puzzler to me. There must be a variable affecting ecl or something.



---

archive/issue_comments_153923.json:
```json
{
    "body": "OK your patch now works as expected without fuss with ecl-12.2.1. I'll reformat the patch for inclusion in sage and save the weird behavior in 12.7.1 for another day. Sounds OK?",
    "created_at": "2012-08-07T22:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153923",
    "user": "fbissey"
}
```

OK your patch now works as expected without fuss with ecl-12.2.1. I'll reformat the patch for inclusion in sage and save the weird behavior in 12.7.1 for another day. Sounds OK?



---

archive/issue_comments_153924.json:
```json
{
    "body": "Attachment [trac12985-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/trac12985-unicode.patch) by fbissey created at 2012-08-07 23:54:59\n\nlatest version of Paulo",
    "created_at": "2012-08-07T23:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153924",
    "user": "fbissey"
}
```

Attachment [trac12985-unicode.patch](tarball://root/attachments/some-uuid/ticket12985/trac12985-unicode.patch) by fbissey created at 2012-08-07 23:54:59

latest version of Paulo



---

archive/issue_comments_153925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-07T23:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153925",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153926.json:
```json
{
    "body": "Re-generated the patch against sage-5.3.beta0. Pushing the positive review button.",
    "created_at": "2012-08-07T23:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153926",
    "user": "fbissey"
}
```

Re-generated the patch against sage-5.3.beta0. Pushing the positive review button.



---

archive/issue_comments_153927.json:
```json
{
    "body": "Replying to [comment:15 fbissey]:\n\n> OK your patch now works as expected without fuss with ecl-12.2.1. I'll reformat the patch for inclusion in sage and save the weird behavior in 12.7.1 for another day. Sounds OK?\n\nIt is ok with me. I should test latest upstream ecl at some point also. BTW, the `ecl-12.2.1-signal_handling_thread.patch` in Fedora was my solution to allow maxima's `make check` to work with the ecl backend, when I made patches and requested support for the ecl backend; most tests would work, I think it was that it would fail somewhere in the tests, probably due to triggering gc in some specific time window.",
    "created_at": "2012-08-08T00:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153927",
    "user": "pcpa"
}
```

Replying to [comment:15 fbissey]:

> OK your patch now works as expected without fuss with ecl-12.2.1. I'll reformat the patch for inclusion in sage and save the weird behavior in 12.7.1 for another day. Sounds OK?

It is ok with me. I should test latest upstream ecl at some point also. BTW, the `ecl-12.2.1-signal_handling_thread.patch` in Fedora was my solution to allow maxima's `make check` to work with the ecl backend, when I made patches and requested support for the ecl backend; most tests would work, I think it was that it would fail somewhere in the tests, probably due to triggering gc in some specific time window.



---

archive/issue_comments_153928.json:
```json
{
    "body": "Wait a minute we cannot merge this if we don't have ecl compiled with unicode.",
    "created_at": "2012-08-08T01:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153928",
    "user": "fbissey"
}
```

Wait a minute we cannot merge this if we don't have ecl compiled with unicode.



---

archive/issue_comments_153929.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2012-08-08T01:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153929",
    "user": "fbissey"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_153930.json:
```json
{
    "body": "Replying to [comment:18 fbissey]:\n\n> Wait a minute we cannot merge this if we don't have ecl compiled with unicode.\nIt is supposed to be a noop if ecl is built without unicode support.\nAFAIR I made tests with unicode disabled and applying the propsed patch, but it should be wise to test it again.",
    "created_at": "2012-08-08T01:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153930",
    "user": "pcpa"
}
```

Replying to [comment:18 fbissey]:

> Wait a minute we cannot merge this if we don't have ecl compiled with unicode.
It is supposed to be a noop if ecl is built without unicode support.
AFAIR I made tests with unicode disabled and applying the propsed patch, but it should be wise to test it again.



---

archive/issue_comments_153931.json:
```json
{
    "body": "It causes problem for me with\n\n```\nsage -t -long  -force_lib devel/sage-main/sage/calculus/calculus.py\n\n\ufffd[?1034h#0: solve_rat_ineq(ineq=x # 5)\n#0: simplify_sum(expr='sum(q^k,k,0,inf))\n#1: simplify_sum(expr=a*'sum(q^k,k,0,inf))\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/calculus.py\", line 677:\n    sage: f.nintegral(x,0,1,1e-14)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[3]>\", line 1, in <module>\n        f.nintegral(x,Integer(0),Integer(1),RealNumber('1e-14'))###line 677:\n    sage: f.nintegral(x,0,1,1e-14)\n      File \"expression.pyx\", line 9073, in sage.symbolic.expression.Expression.nintegral (sage/symbolic/expression.cpp:38115)\n      File \"/usr/lib64/python2.7/site-packages/sage/calculus/calculus.py\", line 752, in nintegral\n        raise ValueError, \"Maxima (via quadpack) cannot compute the integral\"\n    ValueError: Maxima (via quadpack) cannot compute the integral\n**********************************************************************\n1 items had failures:\n   1 of  17 in __main__.example_3\n***Test Failed*** 1 failures.\n```\n\nMay be your maxima patch deals with that.\nIf I use an ecl compiled without unicode and this patch at the same time we there are unresolved symbol because of the declaration\n\n```\ncl_object si_coerce_to_base_string(cl_object x) \n```\n\nin ecl.pxd. It won't be there if ecl is compiled without unicode. I may have to crosscheck that if that particular bit is nasty or not.",
    "created_at": "2012-08-08T01:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153931",
    "user": "fbissey"
}
```

It causes problem for me with

```
sage -t -long  -force_lib devel/sage-main/sage/calculus/calculus.py

�[?1034h#0: solve_rat_ineq(ineq=x # 5)
#0: simplify_sum(expr='sum(q^k,k,0,inf))
#1: simplify_sum(expr=a*'sum(q^k,k,0,inf))
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/calculus.py", line 677:
    sage: f.nintegral(x,0,1,1e-14)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[3]>", line 1, in <module>
        f.nintegral(x,Integer(0),Integer(1),RealNumber('1e-14'))###line 677:
    sage: f.nintegral(x,0,1,1e-14)
      File "expression.pyx", line 9073, in sage.symbolic.expression.Expression.nintegral (sage/symbolic/expression.cpp:38115)
      File "/usr/lib64/python2.7/site-packages/sage/calculus/calculus.py", line 752, in nintegral
        raise ValueError, "Maxima (via quadpack) cannot compute the integral"
    ValueError: Maxima (via quadpack) cannot compute the integral
**********************************************************************
1 items had failures:
   1 of  17 in __main__.example_3
***Test Failed*** 1 failures.
```

May be your maxima patch deals with that.
If I use an ecl compiled without unicode and this patch at the same time we there are unresolved symbol because of the declaration

```
cl_object si_coerce_to_base_string(cl_object x) 
```

in ecl.pxd. It won't be there if ecl is compiled without unicode. I may have to crosscheck that if that particular bit is nasty or not.



---

archive/issue_comments_153932.json:
```json
{
    "body": "Sage and maxima must link to an ecl with the same build options. From `/usr/include/ecl/external.h`\n\n\n```\n#ifdef ECL_UNICODE\nextern ECL_API cl_object si_base_char_p(cl_object x);\nextern ECL_API cl_object si_base_string_p(cl_object x);\nextern ECL_API cl_object si_coerce_to_base_string(cl_object x);\nextern ECL_API cl_object si_coerce_to_extended_string(cl_object x);\n#define ecl_alloc_simple_extended_string(l) ecl_alloc_simple_vector((l),aet_ch)\nextern ECL_API cl_object ecl_alloc_adjustable_extended_string(cl_index l);\n#else\n#define si_base_char_p cl_characterp\n#define si_base_string_p cl_stringp\n#define si_coerce_to_base_string cl_string\n#define si_coerce_to_extended_string cl_string\n#endif\n```\n",
    "created_at": "2012-08-08T02:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153932",
    "user": "pcpa"
}
```

Sage and maxima must link to an ecl with the same build options. From `/usr/include/ecl/external.h`


```
#ifdef ECL_UNICODE
extern ECL_API cl_object si_base_char_p(cl_object x);
extern ECL_API cl_object si_base_string_p(cl_object x);
extern ECL_API cl_object si_coerce_to_base_string(cl_object x);
extern ECL_API cl_object si_coerce_to_extended_string(cl_object x);
#define ecl_alloc_simple_extended_string(l) ecl_alloc_simple_vector((l),aet_ch)
extern ECL_API cl_object ecl_alloc_adjustable_extended_string(cl_index l);
#else
#define si_base_char_p cl_characterp
#define si_base_string_p cl_stringp
#define si_coerce_to_base_string cl_string
#define si_coerce_to_extended_string cl_string
#endif
```




---

archive/issue_comments_153933.json:
```json
{
    "body": "That would be why I got bad stuff about unresolved symbols with ecl.pyx but for the calculus.py doctest I had something consistent: ecl with unicode and maxima and sage rebuilt against it.",
    "created_at": "2012-08-08T02:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153933",
    "user": "fbissey"
}
```

That would be why I got bad stuff about unresolved symbols with ecl.pyx but for the calculus.py doctest I had something consistent: ecl with unicode and maxima and sage rebuilt against it.



---

archive/issue_comments_153934.json:
```json
{
    "body": "The current packages at #13324 have\n\n```\n--enable-unicode=no\n```\n\nWould that be an acceptable resolution to this ticket, or should we re-enable it with this fix eventually?  (Currently I'd say #13324 is higher-priority so that we might actually have a chance at getting Cygwin up to speed...)",
    "created_at": "2012-12-14T18:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153934",
    "user": "kcrisman"
}
```

The current packages at #13324 have

```
--enable-unicode=no
```

Would that be an acceptable resolution to this ticket, or should we re-enable it with this fix eventually?  (Currently I'd say #13324 is higher-priority so that we might actually have a chance at getting Cygwin up to speed...)



---

archive/issue_comments_153935.json:
```json
{
    "body": "Replying to [comment:24 kcrisman]:\n\n> The current packages at #13324  have ` --enable-unicode=no `\n\n  The fedora package has an explicit `--enable-unicode`. The fact that ecl was failing `make check` if using `--disable-unicode` was an ecl bug.\n\n> Would that be an acceptable resolution to this ticket, or should we re-enable it with this fix eventually?  (Currently I'd say #13324  is higher-priority so that we might actually have a chance at getting Cygwin up to speed...)\n\nThe patch must work with ecl compiled with or without unicode (the patch reason is to not break sagemath if ecl was built with unicode enabled), but the patch was causing a link failure if using an ecl older than 12.2.",
    "created_at": "2012-12-14T23:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153935",
    "user": "pcpa"
}
```

Replying to [comment:24 kcrisman]:

> The current packages at #13324  have ` --enable-unicode=no `

  The fedora package has an explicit `--enable-unicode`. The fact that ecl was failing `make check` if using `--disable-unicode` was an ecl bug.

> Would that be an acceptable resolution to this ticket, or should we re-enable it with this fix eventually?  (Currently I'd say #13324  is higher-priority so that we might actually have a chance at getting Cygwin up to speed...)

The patch must work with ecl compiled with or without unicode (the patch reason is to not break sagemath if ecl was built with unicode enabled), but the patch was causing a link failure if using an ecl older than 12.2.



---

archive/issue_comments_153936.json:
```json
{
    "body": "I'll have to check if I still have a couple of weird issues stemming from Unicode and this patch. Haven't touched it in  while. I have been more focused on upgrading numpy in #11334 of late.",
    "created_at": "2012-12-14T23:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153936",
    "user": "fbissey"
}
```

I'll have to check if I still have a couple of weird issues stemming from Unicode and this patch. Haven't touched it in  while. I have been more focused on upgrading numpy in #11334 of late.



---

archive/issue_comments_153937.json:
```json
{
    "body": "Attachment [trac_12985_ecl_unicode_5.10.beta4.patch](tarball://root/attachments/some-uuid/ticket12985/trac_12985_ecl_unicode_5.10.beta4.patch) by Snark created at 2013-05-25 15:25:02\n\nPatch rebased for 5.10.beta4",
    "created_at": "2013-05-25T15:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153937",
    "user": "Snark"
}
```

Attachment [trac_12985_ecl_unicode_5.10.beta4.patch](tarball://root/attachments/some-uuid/ticket12985/trac_12985_ecl_unicode_5.10.beta4.patch) by Snark created at 2013-05-25 15:25:02

Patch rebased for 5.10.beta4



---

archive/issue_comments_153938.json:
```json
{
    "body": "I checked that the rebased patch used with the current ECL spkg which disables unicode, works: everything compiles and doctests.",
    "created_at": "2013-05-26T07:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153938",
    "user": "Snark"
}
```

I checked that the rebased patch used with the current ECL spkg which disables unicode, works: everything compiles and doctests.



---

archive/issue_comments_153939.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-26T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153939",
    "user": "Snark"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_153940.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-27T13:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153940",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153941.json:
```json
{
    "body": "- does not merge with 6.3.beta2\n- probably needs a new tarball\n----\nNew commits:",
    "created_at": "2014-05-27T13:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153941",
    "user": "pbruin"
}
```

- does not merge with 6.3.beta2
- probably needs a new tarball
----
New commits:



---

archive/issue_comments_153942.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-17T11:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153942",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153943.json:
```json
{
    "body": "Merged with 6.4.beta3, updated tarball, minor changes to files in `build/pkgs/ecl/`.",
    "created_at": "2014-09-17T11:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153943",
    "user": "pbruin"
}
```

Merged with 6.4.beta3, updated tarball, minor changes to files in `build/pkgs/ecl/`.



---

archive/issue_comments_153944.json:
```json
{
    "body": "Is there any chance to update to the latest (and final?) ECL?\nWasn't the main blocker the previous versions of Maxima?",
    "created_at": "2014-09-17T12:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153944",
    "user": "jpflori"
}
```

Is there any chance to update to the latest (and final?) ECL?
Wasn't the main blocker the previous versions of Maxima?



---

archive/issue_comments_153945.json:
```json
{
    "body": "Replying to [comment:38 jpflori]:\n> Is there any chance to update to the latest (and final?) ECL?\n> Wasn't the main blocker the previous versions of Maxima?\nI think we should give it a try, but on a separate ticket...",
    "created_at": "2014-09-17T13:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153945",
    "user": "pbruin"
}
```

Replying to [comment:38 jpflori]:
> Is there any chance to update to the latest (and final?) ECL?
> Wasn't the main blocker the previous versions of Maxima?
I think we should give it a try, but on a separate ticket...



---

archive/issue_comments_153946.json:
```json
{
    "body": "Sure, on another ticket :)",
    "created_at": "2014-09-17T13:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153946",
    "user": "jpflori"
}
```

Sure, on another ticket :)



---

archive/issue_comments_153947.json:
```json
{
    "body": "Do we have one? We are now fully using ecl 13.5.1 and there are no problems with it.\nSo this will really be the last ecl for potentially a long time?\nOne of the reason we switched to ecl was the \"maxima as a library\" thing. Now that particular extension has been included in asdf 3+ so we could potentially build it with another lisp.",
    "created_at": "2014-09-17T21:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153947",
    "user": "fbissey"
}
```

Do we have one? We are now fully using ecl 13.5.1 and there are no problems with it.
So this will really be the last ecl for potentially a long time?
One of the reason we switched to ecl was the "maxima as a library" thing. Now that particular extension has been included in asdf 3+ so we could potentially build it with another lisp.



---

archive/issue_comments_153948.json:
```json
{
    "body": "I meant do we have a ticket and sage-on-gentoo is using 13.5.1.",
    "created_at": "2014-09-17T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153948",
    "user": "fbissey"
}
```

I meant do we have a ticket and sage-on-gentoo is using 13.5.1.



---

archive/issue_comments_153949.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> I meant do we have a ticket and sage-on-gentoo is using 13.5.1.\nWe don't seem to have a ticket yet; I'll open one.",
    "created_at": "2014-09-18T07:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153949",
    "user": "pbruin"
}
```

Replying to [comment:42 fbissey]:
> I meant do we have a ticket and sage-on-gentoo is using 13.5.1.
We don't seem to have a ticket yet; I'll open one.



---

archive/issue_comments_153950.json:
```json
{
    "body": "Replying to [comment:43 pbruin]:\n> Replying to [comment:42 fbissey]:\n> > I meant do we have a ticket and sage-on-gentoo is using 13.5.1.\n> We don't seem to have a ticket yet; I'll open one.\nThis is now #17003.",
    "created_at": "2014-09-18T07:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153950",
    "user": "pbruin"
}
```

Replying to [comment:43 pbruin]:
> Replying to [comment:42 fbissey]:
> > I meant do we have a ticket and sage-on-gentoo is using 13.5.1.
> We don't seem to have a ticket yet; I'll open one.
This is now #17003.



---

archive/issue_comments_153951.json:
```json
{
    "body": "Replying to [comment:41 fbissey]:\n> One of the reason we switched to ecl was the \"maxima as a library\" thing. Now that particular extension has been included in asdf 3+ so we could potentially build it with another lisp.\n\nBefore you can use \"maxima as a library\" from sage, you first need \"lisp as a library\" and I think ECL is still the only player in that arena. I'm sure you can get \"maxima as a lisp library\" in pretty much any lisp implementation, but we need to be able to call into that lisp implementation from C code.",
    "created_at": "2014-09-18T19:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153951",
    "user": "nbruin"
}
```

Replying to [comment:41 fbissey]:
> One of the reason we switched to ecl was the "maxima as a library" thing. Now that particular extension has been included in asdf 3+ so we could potentially build it with another lisp.

Before you can use "maxima as a library" from sage, you first need "lisp as a library" and I think ECL is still the only player in that arena. I'm sure you can get "maxima as a lisp library" in pretty much any lisp implementation, but we need to be able to call into that lisp implementation from C code.



---

archive/issue_comments_153952.json:
```json
{
    "body": "OK, it passes basic review here but maxima and sage need rebuilding. I assume that will be automagic with #17072.",
    "created_at": "2014-09-30T11:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153952",
    "user": "fbissey"
}
```

OK, it passes basic review here but maxima and sage need rebuilding. I assume that will be automagic with #17072.



---

archive/issue_comments_153953.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-30T11:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153953",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153954.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-02T16:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12813#issuecomment-153954",
    "user": "vbraun"
}
```

Resolution: fixed
