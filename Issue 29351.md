# Issue 29351: cysignals-1.10.2 compilation error / non-TLS reference since Sage 9.1.rc1

archive/issues_029351.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: cysignals; pari; TLS; FreeBSD\n\n I was working on FreeBSD with 9.1.beta9 and pari as a system package without any problem related to gp / pari.\n\nYesterday I switched to 9.1.rc1, with the same external package, and now the compilation of cysignals aborts with this message:\n\n\n\n```\n[cysignals-1.10.2]     cc -pthread -shared -L/usr/local/lib -fstack-protector-strong -L/usr/ports/math/sage/work/stage/usr/local/lib -Wl,-rpath,/usr/ports/math/sage/work/stage/usr/local/lib -L/usr/local/llvm90/lib -L/usr/local/lib -Wl,-rpath=/usr/local/lib/gcc9 -L/usr/local/lib/gcc9 -B/usr/local/bin -L/usr/local/lib -fstack-protector-strong -O2 -pipe -DLIBICONV_PLUG -fstack-protector-strong -isystem /usr/local/include -fno-strict-aliasing -DLIBICONV_PLUG -I/usr/local/include -isystem /usr/local/include -Wp,-U_FORTIFY_SOURCE build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o -L/usr/local/lib -lpython3.7m -o build/lib.freebsd-12.1-STABLE-amd64-3.7/cysignals/signals.so -lpari -lomp -pthread -L/usr/local/lib\n[cysignals-1.10.2]     /usr/local/bin/ld: PARI_SIGINT_block: TLS definition in /usr/local/lib/libpari.so section .tbss mismatches non-TLS reference in build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o\n[cysignals-1.10.2]     /usr/local/bin/ld: /usr/local/lib/libpari.so: error adding symbols: bad value\n```\n\n\nAnyone with the same problem on other OS, or is it specific to FreeBSD?\n\n(Already reported in #28242#comment:48 but should be more visible here)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29588\n\n",
    "created_at": "2020-04-26T09:15:18Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "cysignals-1.10.2 compilation error / non-TLS reference since Sage 9.1.rc1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29351",
    "user": "https://github.com/thierry-FreeBSD"
}
```
CC:  @slel

Keywords: cysignals; pari; TLS; FreeBSD

 I was working on FreeBSD with 9.1.beta9 and pari as a system package without any problem related to gp / pari.

Yesterday I switched to 9.1.rc1, with the same external package, and now the compilation of cysignals aborts with this message:



```
[cysignals-1.10.2]     cc -pthread -shared -L/usr/local/lib -fstack-protector-strong -L/usr/ports/math/sage/work/stage/usr/local/lib -Wl,-rpath,/usr/ports/math/sage/work/stage/usr/local/lib -L/usr/local/llvm90/lib -L/usr/local/lib -Wl,-rpath=/usr/local/lib/gcc9 -L/usr/local/lib/gcc9 -B/usr/local/bin -L/usr/local/lib -fstack-protector-strong -O2 -pipe -DLIBICONV_PLUG -fstack-protector-strong -isystem /usr/local/include -fno-strict-aliasing -DLIBICONV_PLUG -I/usr/local/include -isystem /usr/local/include -Wp,-U_FORTIFY_SOURCE build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o -L/usr/local/lib -lpython3.7m -o build/lib.freebsd-12.1-STABLE-amd64-3.7/cysignals/signals.so -lpari -lomp -pthread -L/usr/local/lib
[cysignals-1.10.2]     /usr/local/bin/ld: PARI_SIGINT_block: TLS definition in /usr/local/lib/libpari.so section .tbss mismatches non-TLS reference in build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o
[cysignals-1.10.2]     /usr/local/bin/ld: /usr/local/lib/libpari.so: error adding symbols: bad value
```


Anyone with the same problem on other OS, or is it specific to FreeBSD?

(Already reported in #28242#comment:48 but should be more visible here)


Issue created by migration from https://trac.sagemath.org/ticket/29588





---

archive/issue_comments_415822.json:
```json
{
    "body": "Changing component from build to porting: BSD.",
    "created_at": "2020-04-26T16:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415822",
    "user": "https://github.com/mkoeppe"
}
```

Changing component from build to porting: BSD.



---

archive/issue_comments_415823.json:
```json
{
    "body": "Actually, this problem was caused by a mix between pari being built by Sage, and a linkage with libpari.so provided by the system package.\n\nThe root cause of this error is a bug in pari's spkg-configure.m4: see #28242#comment:53",
    "created_at": "2020-04-27T20:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415823",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Actually, this problem was caused by a mix between pari being built by Sage, and a linkage with libpari.so provided by the system package.

The root cause of this error is a bug in pari's spkg-configure.m4: see #28242#comment:53



---

archive/issue_comments_415824.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-29T19:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415824",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_415825.json:
```json
{
    "body": "Possibly relevant:\n\n- #31474: Upgrade: cysignals 1.10.3",
    "created_at": "2021-03-22T03:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415825",
    "user": "https://github.com/slel"
}
```

Possibly relevant:

- #31474: Upgrade: cysignals 1.10.3



---

archive/issue_comments_415826.json:
```json
{
    "body": "If solved elsewhere please give positive review\nso this can be closed.",
    "created_at": "2021-03-22T03:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415826",
    "user": "https://github.com/slel"
}
```

If solved elsewhere please give positive review
so this can be closed.



---

archive/issue_comments_415827.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-19T22:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415827",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_415828.json:
```json
{
    "body": "Changing keywords from \"cysignals; pari; TLS; FreeBSD\" to \"cysignals, pari, TLS, FreeBSD\".",
    "created_at": "2021-08-19T22:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415828",
    "user": "https://github.com/slel"
}
```

Changing keywords from "cysignals; pari; TLS; FreeBSD" to "cysignals, pari, TLS, FreeBSD".



---

archive/issue_comments_415829.json:
```json
{
    "body": "Let us close this if no longer an issue.",
    "created_at": "2021-08-19T22:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415829",
    "user": "https://github.com/slel"
}
```

Let us close this if no longer an issue.



---

archive/issue_events_027118.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:08:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29351#event-27118"
}
```



---

archive/issue_comments_415830.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-08-26T02:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29351#issuecomment-415830",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
