# Issue 29351: cysignals-1.10.2 compilation error / non-TLS reference since Sage 9.1.rc1

Issue created by migration from https://trac.sagemath.org/ticket/29588

Original creator: @thierry-FreeBSD

Original creation time: 2020-04-26 09:15:18

CC:  slelievre

Keywords: cysignals; pari; TLS; FreeBSD

*I was working on FreeBSD with 9.1.beta9 and pari as a system package without any problem related to gp / pari.

Yesterday I switched to 9.1.rc1, with the same external package, and now the compilation of cysignals aborts with this message:



```
[cysignals-1.10.2]     cc -pthread -shared -L/usr/local/lib -fstack-protector-strong -L/usr/ports/math/sage/work/stage/usr/local/lib -Wl,-rpath,/usr/ports/math/sage/work/stage/usr/local/lib -L/usr/local/llvm90/lib -L/usr/local/lib -Wl,-rpath=/usr/local/lib/gcc9 -L/usr/local/lib/gcc9 -B/usr/local/bin -L/usr/local/lib -fstack-protector-strong -O2 -pipe -DLIBICONV_PLUG -fstack-protector-strong -isystem /usr/local/include -fno-strict-aliasing -DLIBICONV_PLUG -I/usr/local/include -isystem /usr/local/include -Wp,-U_FORTIFY_SOURCE build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o -L/usr/local/lib -lpython3.7m -o build/lib.freebsd-12.1-STABLE-amd64-3.7/cysignals/signals.so -lpari -lomp -pthread -L/usr/local/lib
[cysignals-1.10.2]     /usr/local/bin/ld: PARI_SIGINT_block: TLS definition in /usr/local/lib/libpari.so section .tbss mismatches non-TLS reference in build/temp.freebsd-12.1-STABLE-amd64-3.7/build/src/cysignals/signals.o
[cysignals-1.10.2]     /usr/local/bin/ld: /usr/local/lib/libpari.so: error adding symbols: bad value
```


Anyone with the same problem on other OS, or is it specific to FreeBSD?

(Already reported in #28242#comment:48 but should be more visible here)



---

Comment by mkoeppe created at 2020-04-26 16:08:30

Changing component from build to porting: BSD.


---

Comment by @thierry-FreeBSD created at 2020-04-27 20:56:05

Actually, this problem was caused by a mix between pari being built by Sage, and a linkage with libpari.so provided by the system package.

The root cause of this error is a bug in pari's spkg-configure.m4: see #28242#comment:53


---

Comment by mkoeppe created at 2020-04-29 19:33:28

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-03-22 03:03:49

Possibly relevant:

- #31474: Upgrade: cysignals 1.10.3


---

Comment by slelievre created at 2021-03-22 03:05:23

If solved elsewhere please give positive review
so this can be closed.


---

Comment by slelievre created at 2021-08-19 22:32:35

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-08-19 22:32:35

Changing keywords from "cysignals; pari; TLS; FreeBSD" to "cysignals, pari, TLS, FreeBSD".


---

Comment by slelievre created at 2021-08-19 22:32:35

Let us close this if no longer an issue.


---

Comment by mkoeppe created at 2021-08-26 02:08:43

Resolution: invalid
