# Issue 15210: implement evaluation of PARI closures

archive/issues_015210.json:
```json
{
    "body": "Keywords: pari closure\n\nIt would be nice to be able to call PARI closures from Sage.  Currently, calling a PARI object assumes that it is a polynomial:\n\n```\nsage: T = pari('n->n+1')\nsage: T.type()\n't_CLOSURE'\nsage: T(3)\nTraceback (most recent call last):\n...\nPariError: incorrect type in poleval\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15447\n\n",
    "created_at": "2013-11-22T19:06:56Z",
    "labels": [
        "packages: standard",
        "minor",
        "enhancement"
    ],
    "title": "implement evaluation of PARI closures",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15210",
    "user": "pbruin"
}
```
Keywords: pari closure

It would be nice to be able to call PARI closures from Sage.  Currently, calling a PARI object assumes that it is a polynomial:

```
sage: T = pari('n->n+1')
sage: T.type()
't_CLOSURE'
sage: T(3)
Traceback (most recent call last):
...
PariError: incorrect type in poleval
```


Issue created by migration from https://trac.sagemath.org/ticket/15447





---

archive/issue_comments_195433.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2013-11-22T22:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195433",
    "user": "jdemeyer"
}
```

Last 10 new commits:



---

archive/issue_comments_195434.json:
```json
{
    "body": "Changing component from packages: standard to interfaces.",
    "created_at": "2013-11-22T22:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195434",
    "user": "jdemeyer"
}
```

Changing component from packages: standard to interfaces.



---

archive/issue_comments_195435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-11-22T22:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195435",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195436.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-22T22:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195436",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195437.json:
```json
{
    "body": "I think you should also implement `getattr()` using closures, see [http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html](http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html)`",
    "created_at": "2013-11-27T07:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195437",
    "user": "jdemeyer"
}
```

I think you should also implement `getattr()` using closures, see [http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html](http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html)`



---

archive/issue_comments_195438.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2013-12-13T22:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195438",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_195439.json:
```json
{
    "body": "Now that the `t0GEN` stuff is done, this does not depend on #15185 anymore.",
    "created_at": "2013-12-13T22:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195439",
    "user": "pbruin"
}
```

Now that the `t0GEN` stuff is done, this does not depend on #15185 anymore.



---

archive/issue_comments_195440.json:
```json
{
    "body": "New commit needs review. I merged in #15461 since that has positive_review anyway and I didn't want to risk merge conflicts.\n----\nLast 10 new commits:",
    "created_at": "2013-12-17T13:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195440",
    "user": "jdemeyer"
}
```

New commit needs review. I merged in #15461 since that has positive_review anyway and I didn't want to risk merge conflicts.
----
Last 10 new commits:



---

archive/issue_comments_195441.json:
```json
{
    "body": "PARI allows default values for arguments; without the arity check one can do\n\n```\nsage: f = pari('(x, y=3) -> x/y')\nsage: f(2)\n2/3\n```\n\nOn the other hand, omitting the arity check altogether is not an option since passing too many arguments gives unexpected results (and moreover a look at the source code of `closure_callgenvec` suggests that this could lead to memory corruption):\n\n```\nsage: f(1,2,3,4,5)\n4/5\n```\n\nFiguring out the default values from the `t_CLOSURE` doesn't seem worth the trouble, leaving two reasonable options:\n- either don't bother supporting PARI default values\n- or check for `nargs <= arity` and allow PARI to substitute default values, including its convention to set any unspecified arguments to 0\nI don't have a strong preference.",
    "created_at": "2013-12-18T16:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195441",
    "user": "pbruin"
}
```

PARI allows default values for arguments; without the arity check one can do

```
sage: f = pari('(x, y=3) -> x/y')
sage: f(2)
2/3
```

On the other hand, omitting the arity check altogether is not an option since passing too many arguments gives unexpected results (and moreover a look at the source code of `closure_callgenvec` suggests that this could lead to memory corruption):

```
sage: f(1,2,3,4,5)
4/5
```

Figuring out the default values from the `t_CLOSURE` doesn't seem worth the trouble, leaving two reasonable options:
- either don't bother supporting PARI default values
- or check for `nargs <= arity` and allow PARI to substitute default values, including its convention to set any unspecified arguments to 0
I don't have a strong preference.



---

archive/issue_comments_195442.json:
```json
{
    "body": "Replying to [comment:13 pbruin]:\n> check for `nargs <= arity` and allow PARI to substitute default values, including its convention to set any unspecified arguments to 0\n\nThis is actually what GP does, so I'll go with that.",
    "created_at": "2013-12-18T16:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195442",
    "user": "jdemeyer"
}
```

Replying to [comment:13 pbruin]:
> check for `nargs <= arity` and allow PARI to substitute default values, including its convention to set any unspecified arguments to 0

This is actually what GP does, so I'll go with that.



---

archive/issue_comments_195443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-18T17:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195444.json:
```json
{
    "body": "The last commit makes a small addition to the documentation: mention in the documentation of `eval()` that `f(x) == f.eval(x)`, before the examples that use this.\n----\nNew commits:",
    "created_at": "2013-12-18T22:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195444",
    "user": "pbruin"
}
```

The last commit makes a small addition to the documentation: mention in the documentation of `eval()` that `f(x) == f.eval(x)`, before the examples that use this.
----
New commits:



---

archive/issue_comments_195445.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> I think you should also implement `getattr()` using closures, see [http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html](http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html)`\nI forgot to say here that this is now #15518.",
    "created_at": "2013-12-18T22:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195445",
    "user": "pbruin"
}
```

Replying to [comment:6 jdemeyer]:
> I think you should also implement `getattr()` using closures, see [http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html](http://pari.math.u-bordeaux1.fr/archives/pari-dev-1311/msg00015.html)`
I forgot to say here that this is now #15518.



---

archive/issue_comments_195446.json:
```json
{
    "body": "positive_review from me. If you agree, you can set the ticket to positive_review.",
    "created_at": "2013-12-19T08:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195446",
    "user": "jdemeyer"
}
```

positive_review from me. If you agree, you can set the ticket to positive_review.



---

archive/issue_comments_195447.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-19T12:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195447",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195448.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-21T12:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15210#issuecomment-195448",
    "user": "vbraun"
}
```

Resolution: fixed
