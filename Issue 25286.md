# Issue 25286: Raise Exception if DynamicalSystem initialized with coeffs not in given domain

Issue created by migration from https://trac.sagemath.org/ticket/25523

Original creator: @Loops7

Original creation time: 2018-06-07 03:57:45

CC:  bhutz

Currently, code such as  

```
P.<x,y>=ProjectiveSpace(QQ,1) 
f=DynamicalSystem([CC.0*x^2+2*y^2,1*y^2], domain=P)
```


does not raise an error as it should. We address this by raising a TypeError if the coefficients are not elements of the given domain.


---

Comment by @Loops7 created at 2018-06-08 05:25:31

Changing status from new to needs_review.


---

Comment by git created at 2018-06-08 05:26:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Loops7 created at 2018-06-08 06:54:19

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-06-15 19:42:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-18 06:04:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-18 06:09:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Loops7 created at 2018-06-18 06:11:01

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-06-20 04:48:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2018-06-21 01:08:15

A couple minor things first

- extra blank lines added in affine_ds are not needed

- is_Quotient import is not used

Now for some still weird functionality

- The following gets a typeerror

```
P.<x,y>=ProjectiveSpace(ZZ,1)
f=DynamicalSystem([3*x^2, 1/5*y^2], domain=P)
```


but this gives back a dynamical system over integer ring

```
P.<x,y>=ProjectiveSpace(ZZ,1)
f=DynamicalSystem([3*x^2, 1/5*y^2])
```



- when you pass in an endomorphism the domain isn't used. This may be ok if it is documented this way or maybe we should try to coerce to domain.

```
P.<x,y>=ProjectiveSpace(QQ,1)
P2.<x,y>=ProjectiveSpace(CC,1)
H = End(P2)
f=H([CC.0*x^2,y^2])
g=DynamicalSystem(f, domain=P)
```


- When you don't give it a domain, you can get some very weird behavior

```
P.<x,y>=ProjectiveSpace(ZZ,1)
f=DynamicalSystem([GF(5)(3)*x^2, CC.0*y^2])
```

notice the two coordinate polynomials don't even have the same parent!

```
f[0].parent(),f[1].parent()
```



---

Comment by bhutz created at 2018-06-21 01:08:15

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-06-27 03:11:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Loops7 created at 2018-06-27 03:16:28

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2018-06-27 19:39:31

A couple issues here.

In projective.ds


```
R.<x>=QQ[]
DynamicalSystem_projective([x, x+1])
```

This is a weird error. I think you should do a little sanity checking before creating the domain.

In this one, it is functioning correctly, but I think you should add what domain you are attempting to use to the error message since it is not passed in by the user

```
R.<x,y,z>=QQ[]
f=DynamicalSystem_projective([x+y+z,y*z])
```


you need to add a couple doc tests showing the behavior you are correcting, especially an example, where the domain is created based off of the parent of the first coordinate function


----

in affine.ds

definitely missing some checks somewhere in here


```
R.<x>=QQ[]
DynamicalSystem_affine([x, x+1,2*x])
```


and


```
R.<x,y,z>=QQ[]
f=DynamicalSystem_affine([x+y+z,y*z])
```


notice the dimension of the affine space these are creating as a domain. Need to sanity check the number of polys matches the dimension


affine also needs some doc tests showing the behavior.


---

Comment by bhutz created at 2018-06-27 19:39:31

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-07-10 05:56:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-13 08:33:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-13 08:44:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Loops7 created at 2018-07-13 08:55:59

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-07-13 10:47:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2018-07-14 15:38:58

everything seems to be working well here. I made some minor doc updates, added a couple examples, and made one code change. When the domain is not given, you already have the common parent, so it was just a minor optimization.

If you're fine with these changes, we'll go ahead and mark it positive.
----
New commits:


---

Comment by @Loops7 created at 2018-07-17 16:04:42

This all looks good to me- good to go.


---

Comment by bhutz created at 2018-07-17 16:05:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-11 16:54:47

Resolution: fixed
