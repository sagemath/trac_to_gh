# Issue 24273: Function field factorization does not pass on proof parameter

archive/issues_024273.json:
```json
{
    "body": "CC:  swewers\n\n\n```\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-6-327b611cc15f> in <module>()\n----> 1 Y.compute_semistable_reduction()\n\n/home/user/MCLF/mclf/semistable_reduction/superell.pyc in\ncompute_semistable_reduction(self)\n    229             print \"into %s lower\ncomponents.\"%len(Z.lower_components())\n    230             print \"The upper components are: \"\n--> 231             for W in Z.upper_components():\n    232                 print W                   \n    233                 if W.field_of_constants_degree() > 1:\n\n/home/user/MCLF/mclf/semistable_reduction/reduction_trees.pyc in\nupper_components(self, u)\n    549         upper_components = []\n    550         for Z in lower_components:\n--> 551             upper_components += Z.upper_components()\n    552         self._upper_components[u] = upper_components\n    553         return upper_components                     \n\n/home/user/MCLF/mclf/semistable_reduction/reduction_trees.pyc in\nupper_components(self)\n    868         FY = self.reduction_tree().curve().function_field()\n    869         FYL = base_change_of_function_field(FY, self.base_field())\n--> 870         upper_valuations = [FYL.valuation(w) for w in\nv.mac_lane_approximants(FYL.polynomial())]\n    871         return [UpperComponent(self, w) for w in upper_valuations]\n    872                                                                   \n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/valuation.pyc\nin mac_lane_approximants(self, G, assume_squarefree, require_final_EF, re\nquired_precision, require_incomparability, require_maximal_degree, algorithm)\n    772                    forest = tree,                                    \n    773                    map_function = lambda x: [x],\n--> 774                    reduce_init = []).run_serial()\n    775         else:                                    \n    776             raise NotImplementedError(algorithm)\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/parallel/map_reduce.pyc\nin run_serial(self)\n   1495         return functools.reduce(self.reduce_function,\n   1496                                 (self.map_function(x) for x in\nself._forest),\n-> 1497                                 self.reduce_init())\n   1498\n   1499\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/parallel/map_reduce.pyc\nin <genexpr>((x,))\n   1494         import functools\n   1495         return functools.reduce(self.reduce_function,\n-> 1496                                 (self.map_function(x) for x in\nself._forest),\n   1497                                 self.reduce_init())\n   1498\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/combinat/backtrack.pyc\nin search_forest_iterator(roots, children, algorithm)\n    240\n    241         yield node\n--> 242         stack.append( iter(children(node)) )\n    243                                             \n    244 class SearchForest(Parent):\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/valuation.pyc\nin create_children(node)\n    745                              valuations=node.valuations,\n    746                              check=False,\n--> 747\nprincipal_part_bound=node.principal_part_bound)\n    748             for w, bound, principal_part_bound, coefficients,\nvaluations in augmentations:\n    749                 ef = bound == w.E()*w.F()\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/inductive_valuation.pyc\nin mac_lane_step(self, G, principal_part_bound, assume_squarefr\nee, assume_equivalence_irreducible, report_degree_bounds_and_caches,\ncoefficients, valuations, check)\n    748         ret = []\n    749\n--> 750         F = self.equivalence_decomposition(G,\nassume_not_equivalence_unit=True, coefficients=coefficients,\nvaluations=valuations, compute_unit=False, degree_b\nound=principal_part_bound)\n    751         assert len(F), \"%s equivalence-decomposes as an\nequivalence-unit %s\"%(G, F)\n    752         if len(F) == 1 and F[0][1] == 1 and F[0][0].degree() ==\nG.degree():\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/inductive_valuation.pyc\nin equivalence_decomposition(self, f, assume_not_equivalence_un\nit, coefficients, valuations, compute_unit, degree_bound)   \n   1210\n   1211         valuation, phi_divides, F = self._equivalence_reduction(f,\ncoefficients=coefficients, valuations=valuations, degree_bound=degree_bound)\n-> 1212         F = F.factor()\n   1213         from sage.misc.misc import verbose\n   1214         verbose(\"%s factors as %s = %s in reduction\"%(f, F.prod(), F),\nlevel=20)\n\n/home/user/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx in\nsage.rings.polynomial.polynomial_element.Polynomial.factor\n(build/cythonized/sage/rings/po\nlynomial/polynomial_element.c:37439)()\n   4088         R = self._parent.base_ring()\n   4089         if hasattr(R, '_factor_univariate_polynomial'):              \n-> 4090             return R._factor_univariate_polynomial(self, **kwargs)\n   4091\n   4092         G = None                                 \n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/fraction_field.pyc\nin _factor_univariate_polynomial(self, f)\n    870         # This fails silently over some base fields, see #23642, so we\nconvert\n    871         # to the function field and factor there.\n--> 872         return\nf.change_ring(self.function_field()).factor().base_change(f.parent())\n    873\n    874     def function_field(self):\n\n/home/user/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx in\nsage.rings.polynomial.polynomial_element.Polynomial.factor\n(build/cythonized/sage/rings/po\nlynomial/polynomial_element.c:37439)()\n   4088         R = self._parent.base_ring()\n   4089         if hasattr(R, '_factor_univariate_polynomial'):\n-> 4090             return R._factor_univariate_polynomial(self, **kwargs)\n   4091\n   4092         G = None\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/function_field/function_field.pyc\nin _factor_univariate_polynomial(self, f, proof)\n   2396\n   2397         F, d = self._to_bivariate_polynomial(f)\n-> 2398         fac = F.factor()                    \n   2399         x = f.parent().gen()\n   2400         t = f.parent().base_ring().gen()\n\n/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_element.pyc\nin factor(self, proof)\n   1729                 raise NotImplementedError(\"Factorization of\nmultivariate polynomials over prime fields with characteristic > 2^29 is not\nimplemented.\")\n   1730         if proof:\n-> 1731             raise NotImplementedError(\"proof = True factorization not\nimplemented.  Call factor with proof=False.\")\n   1732\n   1733         R._singular_().set_ring()\n\nNotImplementedError: proof = True factorization not implemented.  Call factor\nwith proof=False.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24510\n\n",
    "created_at": "2018-01-10T23:32:57Z",
    "labels": [
        "component: commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Function field factorization does not pass on proof parameter",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24273",
    "user": "https://github.com/saraedum"
}
```
CC:  swewers


```
NotImplementedError                       Traceback (most recent call last)
<ipython-input-6-327b611cc15f> in <module>()
----> 1 Y.compute_semistable_reduction()

/home/user/MCLF/mclf/semistable_reduction/superell.pyc in
compute_semistable_reduction(self)
    229             print "into %s lower
components."%len(Z.lower_components())
    230             print "The upper components are: "
--> 231             for W in Z.upper_components():
    232                 print W                   
    233                 if W.field_of_constants_degree() > 1:

/home/user/MCLF/mclf/semistable_reduction/reduction_trees.pyc in
upper_components(self, u)
    549         upper_components = []
    550         for Z in lower_components:
--> 551             upper_components += Z.upper_components()
    552         self._upper_components[u] = upper_components
    553         return upper_components                     

/home/user/MCLF/mclf/semistable_reduction/reduction_trees.pyc in
upper_components(self)
    868         FY = self.reduction_tree().curve().function_field()
    869         FYL = base_change_of_function_field(FY, self.base_field())
--> 870         upper_valuations = [FYL.valuation(w) for w in
v.mac_lane_approximants(FYL.polynomial())]
    871         return [UpperComponent(self, w) for w in upper_valuations]
    872                                                                   

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/valuation.pyc
in mac_lane_approximants(self, G, assume_squarefree, require_final_EF, re
quired_precision, require_incomparability, require_maximal_degree, algorithm)
    772                    forest = tree,                                    
    773                    map_function = lambda x: [x],
--> 774                    reduce_init = []).run_serial()
    775         else:                                    
    776             raise NotImplementedError(algorithm)

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/parallel/map_reduce.pyc
in run_serial(self)
   1495         return functools.reduce(self.reduce_function,
   1496                                 (self.map_function(x) for x in
self._forest),
-> 1497                                 self.reduce_init())
   1498
   1499

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/parallel/map_reduce.pyc
in <genexpr>((x,))
   1494         import functools
   1495         return functools.reduce(self.reduce_function,
-> 1496                                 (self.map_function(x) for x in
self._forest),
   1497                                 self.reduce_init())
   1498
/home/user/sage-develop/local/lib/python2.7/site-packages/sage/combinat/backtrack.pyc
in search_forest_iterator(roots, children, algorithm)
    240
    241         yield node
--> 242         stack.append( iter(children(node)) )
    243                                             
    244 class SearchForest(Parent):

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/valuation.pyc
in create_children(node)
    745                              valuations=node.valuations,
    746                              check=False,
--> 747
principal_part_bound=node.principal_part_bound)
    748             for w, bound, principal_part_bound, coefficients,
valuations in augmentations:
    749                 ef = bound == w.E()*w.F()

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/inductive_valuation.pyc
in mac_lane_step(self, G, principal_part_bound, assume_squarefr
ee, assume_equivalence_irreducible, report_degree_bounds_and_caches,
coefficients, valuations, check)
    748         ret = []
    749
--> 750         F = self.equivalence_decomposition(G,
assume_not_equivalence_unit=True, coefficients=coefficients,
valuations=valuations, compute_unit=False, degree_b
ound=principal_part_bound)
    751         assert len(F), "%s equivalence-decomposes as an
equivalence-unit %s"%(G, F)
    752         if len(F) == 1 and F[0][1] == 1 and F[0][0].degree() ==
G.degree():

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/valuation/inductive_valuation.pyc
in equivalence_decomposition(self, f, assume_not_equivalence_un
it, coefficients, valuations, compute_unit, degree_bound)   
   1210
   1211         valuation, phi_divides, F = self._equivalence_reduction(f,
coefficients=coefficients, valuations=valuations, degree_bound=degree_bound)
-> 1212         F = F.factor()
   1213         from sage.misc.misc import verbose
   1214         verbose("%s factors as %s = %s in reduction"%(f, F.prod(), F),
level=20)

/home/user/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx in
sage.rings.polynomial.polynomial_element.Polynomial.factor
(build/cythonized/sage/rings/po
lynomial/polynomial_element.c:37439)()
   4088         R = self._parent.base_ring()
   4089         if hasattr(R, '_factor_univariate_polynomial'):              
-> 4090             return R._factor_univariate_polynomial(self, **kwargs)
   4091
   4092         G = None                                 

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/fraction_field.pyc
in _factor_univariate_polynomial(self, f)
    870         # This fails silently over some base fields, see #23642, so we
convert
    871         # to the function field and factor there.
--> 872         return
f.change_ring(self.function_field()).factor().base_change(f.parent())
    873
    874     def function_field(self):

/home/user/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx in
sage.rings.polynomial.polynomial_element.Polynomial.factor
(build/cythonized/sage/rings/po
lynomial/polynomial_element.c:37439)()
   4088         R = self._parent.base_ring()
   4089         if hasattr(R, '_factor_univariate_polynomial'):
-> 4090             return R._factor_univariate_polynomial(self, **kwargs)
   4091
   4092         G = None
/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/function_field/function_field.pyc
in _factor_univariate_polynomial(self, f, proof)
   2396
   2397         F, d = self._to_bivariate_polynomial(f)
-> 2398         fac = F.factor()                    
   2399         x = f.parent().gen()
   2400         t = f.parent().base_ring().gen()

/home/user/sage-develop/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_element.pyc
in factor(self, proof)
   1729                 raise NotImplementedError("Factorization of
multivariate polynomials over prime fields with characteristic > 2^29 is not
implemented.")
   1730         if proof:
-> 1731             raise NotImplementedError("proof = True factorization not
implemented.  Call factor with proof=False.")
   1732
   1733         R._singular_().set_ring()

NotImplementedError: proof = True factorization not implemented.  Call factor
with proof=False.

Issue created by migration from https://trac.sagemath.org/ticket/24510





---

archive/issue_comments_339463.json:
```json
{
    "body": "There is a followup ticket to fix the resulting error, #24533.",
    "created_at": "2018-01-12T15:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339463",
    "user": "https://github.com/saraedum"
}
```

There is a followup ticket to fix the resulting error, #24533.



---

archive/issue_comments_339464.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-12T15:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339464",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_339465.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-01-12T17:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339465",
    "user": "https://github.com/tscrim"
}
```

New commits:



---

archive/issue_comments_339466.json:
```json
{
    "body": "The docstring for the test makes it seem like you added a test showing that something does not work. You should also add something referencing this ticket saying what is being tested.",
    "created_at": "2018-01-12T17:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339466",
    "user": "https://github.com/tscrim"
}
```

The docstring for the test makes it seem like you added a test showing that something does not work. You should also add something referencing this ticket saying what is being tested.



---

archive/issue_comments_339467.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-12T17:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339467",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339468.json:
```json
{
    "body": "I sort of see your point but I don't think it's worth it here. How would I do that? By putting a `proof=True` and `proof=False` there and showing that they are different? I don't think that this makes any sense for a future reader of the code. If this test ever breaks whoever breaks it will just say that \"one exception got replaced by another\".\n\nI don't want to doctest a non-helpful exception message but I just want to track somewhere that this does still not work.",
    "created_at": "2018-01-12T18:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339468",
    "user": "https://github.com/saraedum"
}
```

I sort of see your point but I don't think it's worth it here. How would I do that? By putting a `proof=True` and `proof=False` there and showing that they are different? I don't think that this makes any sense for a future reader of the code. If this test ever breaks whoever breaks it will just say that "one exception got replaced by another".

I don't want to doctest a non-helpful exception message but I just want to track somewhere that this does still not work.



---

archive/issue_comments_339469.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-12T18:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339469",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339470.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-12T18:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339470",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339471.json:
```json
{
    "body": "I said doc*string*, not doctest. Without this ticket, I would not understand the point of that test from your current docstring and test. So perhaps something like\n\n```\nWe check that ``proof`` parameter is passed to the underlying polynomial\n(see :trac:`24510`). However, factoring over a function field over a tower\nof finite fields does not work yet (see :trac:`24533`)::\n```\n",
    "created_at": "2018-01-12T18:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339471",
    "user": "https://github.com/tscrim"
}
```

I said doc*string*, not doctest. Without this ticket, I would not understand the point of that test from your current docstring and test. So perhaps something like

```
We check that ``proof`` parameter is passed to the underlying polynomial
(see :trac:`24510`). However, factoring over a function field over a tower
of finite fields does not work yet (see :trac:`24533`)::
```




---

archive/issue_comments_339472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-12T23:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339473.json:
```json
{
    "body": "Ok. Fixed now.\n----\nNew commits:",
    "created_at": "2018-01-12T23:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339473",
    "user": "https://github.com/saraedum"
}
```

Ok. Fixed now.
----
New commits:



---

archive/issue_comments_339474.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-12T23:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339474",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339475.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-01-13T16:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339475",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_comments_339476.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-13T16:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339476",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022672.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2018-01-15T22:28:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24273#event-22672"
}
```



---

archive/issue_comments_339477.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-15T22:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24273#issuecomment-339477",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
