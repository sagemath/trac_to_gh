# Issue 33226: Fix some corner and special cases concerning localization of integral domains

archive/issues_033226.json:
```json
{
    "body": "CC:  tscrim\n\nKeywords: integral domain localization\n\nThe aime of this ticket is to fix the following issues:\n\n\n```sage\nsage: L = ZZ.localization(5)\nsage: o = L(0)\nsage: o.is_unit()\nTraceback (most recent call last)\n...\nRecursionError: maximum recursion depth exceeded while calling a Python object\n```\n\n\n\n\n```sage\nsage: R = ZZ.localization(5)\nsage: S = R.localization(~5)\nTraceback (most recent call last)\n...\nTypeError: no conversion of this rational to integer\n```\n\n\n\n```sage\nsage: Lau.<u, v> = LaurentPolynomialRing(ZZ)\nsage: LauL = Lau.localization(u+1)\nsage: LauL(~u)\nTraceback (most recent call last)\n...\nNotImplementedError:\n```\n\n\nIn addition a method `factor` is added.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33463\n\n",
    "created_at": "2022-03-05T14:39:27Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Fix some corner and special cases concerning localization of integral domains",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33226",
    "user": "soehms"
}
```
CC:  tscrim

Keywords: integral domain localization

The aime of this ticket is to fix the following issues:


```sage
sage: L = ZZ.localization(5)
sage: o = L(0)
sage: o.is_unit()
Traceback (most recent call last)
...
RecursionError: maximum recursion depth exceeded while calling a Python object
```




```sage
sage: R = ZZ.localization(5)
sage: S = R.localization(~5)
Traceback (most recent call last)
...
TypeError: no conversion of this rational to integer
```



```sage
sage: Lau.<u, v> = LaurentPolynomialRing(ZZ)
sage: LauL = Lau.localization(u+1)
sage: LauL(~u)
Traceback (most recent call last)
...
NotImplementedError:
```


In addition a method `factor` is added.


Issue created by migration from https://trac.sagemath.org/ticket/33463





---

archive/issue_comments_473147.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-03-05T14:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473147",
    "user": "soehms"
}
```

New commits:



---

archive/issue_comments_473148.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-05T14:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473148",
    "user": "soehms"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_473149.json:
```json
{
    "body": "Can you also add this to the docstring (copied from the polynomial factorization):\n\n```\n   Return the factorization of this polynomial.\n\n   INPUT:\n\n   - ``proof`` -- ignored\n```\n\nand a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?\n\nAddendum: You can also leave off the `INPUT:` too if you want since it is ignored.",
    "created_at": "2022-03-05T23:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473149",
    "user": "tscrim"
}
```

Can you also add this to the docstring (copied from the polynomial factorization):

```
   Return the factorization of this polynomial.

   INPUT:

   - ``proof`` -- ignored
```

and a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?

Addendum: You can also leave off the `INPUT:` too if you want since it is ignored.



---

archive/issue_comments_473150.json:
```json
{
    "body": "Please capitalise and use double colon here:\n\n```diff\n-        check that :trac:`33463` is fixed:\n+        Check that :trac:`33463` is fixed::\n```\n",
    "created_at": "2022-03-06T14:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473150",
    "user": "slelievre"
}
```

Please capitalise and use double colon here:

```diff
-        check that :trac:`33463` is fixed:
+        Check that :trac:`33463` is fixed::
```




---

archive/issue_comments_473151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-06T22:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473151",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473152.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> Can you also add this to the docstring (copied from the polynomial factorization):\n> {{{\n>    Return the factorization of this polynomial.\n> \n>    INPUT:\n> \n>    - ``proof`` -- ignored\n> }}}\n> and a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?\n> \n> Addendum: You can also leave off the `INPUT:` too if you want since it is ignored.\n\nYes, you are right, Travis! But, I think instead of ignoring it it could by useful to pass the keyword to the `factor` method over the base ring in case it is given explicitely.",
    "created_at": "2022-03-06T22:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473152",
    "user": "soehms"
}
```

Replying to [comment:3 tscrim]:
> Can you also add this to the docstring (copied from the polynomial factorization):
> {{{
>    Return the factorization of this polynomial.
> 
>    INPUT:
> 
>    - ``proof`` -- ignored
> }}}
> and a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?
> 
> Addendum: You can also leave off the `INPUT:` too if you want since it is ignored.

Yes, you are right, Travis! But, I think instead of ignoring it it could by useful to pass the keyword to the `factor` method over the base ring in case it is given explicitely.



---

archive/issue_comments_473153.json:
```json
{
    "body": "Replying to [comment:4 slelievre]:\n> Please capitalise and use double colon here:\n> {{{#!diff\n> -        check that :trac:`33463` is fixed:\n> +        Check that :trac:`33463` is fixed::\n> }}}\n\nThanks for this hint, as well, Samuel!",
    "created_at": "2022-03-06T22:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473153",
    "user": "soehms"
}
```

Replying to [comment:4 slelievre]:
> Please capitalise and use double colon here:
> {{{#!diff
> -        check that :trac:`33463` is fixed:
> +        Check that :trac:`33463` is fixed::
> }}}

Thanks for this hint, as well, Samuel!



---

archive/issue_comments_473154.json:
```json
{
    "body": "That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:\n\n```diff\n-        - ``proof`` -- optional (default ``None``). If given it is passed\n-          to the corresponding method of the numerator of ``self``.\n+        - ``proof`` -- (optional) if given it is passed to the\n+          corresponding method of the numerator of ``self``\n```\n",
    "created_at": "2022-03-07T03:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473154",
    "user": "tscrim"
}
```

That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:

```diff
-        - ``proof`` -- optional (default ``None``). If given it is passed
-          to the corresponding method of the numerator of ``self``.
+        - ``proof`` -- (optional) if given it is passed to the
+          corresponding method of the numerator of ``self``
```




---

archive/issue_comments_473155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-07T07:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473155",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-07T07:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473156",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473157.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:\n\nSorry!",
    "created_at": "2022-03-07T07:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473157",
    "user": "soehms"
}
```

Replying to [comment:8 tscrim]:
> That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:

Sorry!



---

archive/issue_comments_473158.json:
```json
{
    "body": "Thanks (although I would normally put the optional in parentheses). I am okay with the current branch. Samuel?",
    "created_at": "2022-03-07T11:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473158",
    "user": "tscrim"
}
```

Thanks (although I would normally put the optional in parentheses). I am okay with the current branch. Samuel?



---

archive/issue_comments_473159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-07T17:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473159",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473160.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> although I would normally put the optional in parentheses\n\nOf course! Sorry again (that was not a good day).",
    "created_at": "2022-03-07T17:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473160",
    "user": "soehms"
}
```

Replying to [comment:12 tscrim]:
> although I would normally put the optional in parentheses

Of course! Sorry again (that was not a good day).



---

archive/issue_comments_473161.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-08T01:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473161",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_473162.json:
```json
{
    "body": "No problem. Thank you for the fixes.\n\nI am going to set this to a positive review since the patchbot is (morally) green. Samuel, if you have other changes you want, feel free to revert.",
    "created_at": "2022-03-08T01:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473162",
    "user": "tscrim"
}
```

No problem. Thank you for the fixes.

I am going to set this to a positive review since the patchbot is (morally) green. Samuel, if you have other changes you want, feel free to revert.



---

archive/issue_comments_473163.json:
```json
{
    "body": "I wish one could change the display of the variables in the localisation.\n\nSomething like:\n\n```\nsage: P.<X, Y> = QQ[]\nsage: L.<x, y> = P.localization(X - Y)\n```\n\nwhere the generators would display as `X`, `Y` in `P`\nand as `x`, `y` in `L`.\n\nThat could be another ticket.\n\nOne could remove a pair of parentheses here:\n\n```diff\n-        fac = [(P(f), e) for (f, e) in F]\n+        fac = [(P(f), e) for f, e in F]\n```\n\nbut leaving them is fine too and even emphasizes\nthe transformation.\n\nThe shorter name `extra_units` might shorten\nsome lines with respect to `additional_units`.\n\nOne could split this line:\n\n```diff\n-            additional_units = [au for au in additional_units if ~au not in base_ring._additional_units]  # :trac:`33463`\n+            additional_units = [u for u in additional_units\n+                                if ~u not in base_ring._additional_units]\n```\n\n\nThese are all minor points. No need to revert positive review.",
    "created_at": "2022-03-08T11:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473163",
    "user": "slelievre"
}
```

I wish one could change the display of the variables in the localisation.

Something like:

```
sage: P.<X, Y> = QQ[]
sage: L.<x, y> = P.localization(X - Y)
```

where the generators would display as `X`, `Y` in `P`
and as `x`, `y` in `L`.

That could be another ticket.

One could remove a pair of parentheses here:

```diff
-        fac = [(P(f), e) for (f, e) in F]
+        fac = [(P(f), e) for f, e in F]
```

but leaving them is fine too and even emphasizes
the transformation.

The shorter name `extra_units` might shorten
some lines with respect to `additional_units`.

One could split this line:

```diff
-            additional_units = [au for au in additional_units if ~au not in base_ring._additional_units]  # :trac:`33463`
+            additional_units = [u for u in additional_units
+                                if ~u not in base_ring._additional_units]
```


These are all minor points. No need to revert positive review.



---

archive/issue_comments_473164.json:
```json
{
    "body": "> That could be another ticket. \n\nI have opened #33482",
    "created_at": "2022-03-08T19:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473164",
    "user": "soehms"
}
```

> That could be another ticket. 

I have opened #33482



---

archive/issue_comments_473165.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-09T23:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33226#issuecomment-473165",
    "user": "vbraun"
}
```

Resolution: fixed
