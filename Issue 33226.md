# Issue 33226: Fix some corner and special cases concerning localization of integral domains

Issue created by migration from https://trac.sagemath.org/ticket/33463

Original creator: soehms

Original creation time: 2022-03-05 14:39:27

CC:  tscrim

Keywords: integral domain localization

The aime of this ticket is to fix the following issues:


```sage
sage: L = ZZ.localization(5)
sage: o = L(0)
sage: o.is_unit()
Traceback (most recent call last)
...
RecursionError: maximum recursion depth exceeded while calling a Python object
```




```sage
sage: R = ZZ.localization(5)
sage: S = R.localization(~5)
Traceback (most recent call last)
...
TypeError: no conversion of this rational to integer
```



```sage
sage: Lau.<u, v> = LaurentPolynomialRing(ZZ)
sage: LauL = Lau.localization(u+1)
sage: LauL(~u)
Traceback (most recent call last)
...
NotImplementedError:
```


In addition a method `factor` is added.



---

Comment by soehms created at 2022-03-05 14:48:39

New commits:


---

Comment by soehms created at 2022-03-05 14:48:39

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-03-05 23:04:39

Can you also add this to the docstring (copied from the polynomial factorization):

```
   Return the factorization of this polynomial.

   INPUT:

   - ``proof`` -- ignored
```

and a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?

Addendum: You can also leave off the `INPUT:` too if you want since it is ignored.


---

Comment by slelievre created at 2022-03-06 14:33:18

Please capitalise and use double colon here:

```diff
-        check that :trac:`33463` is fixed:
+        Check that :trac:`33463` is fixed::
```



---

Comment by git created at 2022-03-06 22:26:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2022-03-06 22:28:37

Replying to [comment:3 tscrim]:
> Can you also add this to the docstring (copied from the polynomial factorization):
> {{{
>    Return the factorization of this polynomial.
> 
>    INPUT:
> 
>    - ``proof`` -- ignored
> }}}
> and a `proof=None` default argument (for compatibility, although not every `factor()` implementation seems to support it)?
> 
> Addendum: You can also leave off the `INPUT:` too if you want since it is ignored.

Yes, you are right, Travis! But, I think instead of ignoring it it could by useful to pass the keyword to the `factor` method over the base ring in case it is given explicitely.


---

Comment by soehms created at 2022-03-06 22:29:21

Replying to [comment:4 slelievre]:
> Please capitalise and use double colon here:
> {{{#!diff
> -        check that :trac:`33463` is fixed:
> +        Check that :trac:`33463` is fixed::
> }}}

Thanks for this hint, as well, Samuel!


---

Comment by tscrim created at 2022-03-07 03:30:59

That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:

```diff
-        - ``proof`` -- optional (default ``None``). If given it is passed
-          to the corresponding method of the numerator of ``self``.
+        - ``proof`` -- (optional) if given it is passed to the
+          corresponding method of the numerator of ``self``
```



---

Comment by git created at 2022-03-07 07:04:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-07 07:13:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2022-03-07 07:14:35

Replying to [comment:8 tscrim]:
> That is fine with me, but `factor()` still needs a one-line description. Also, one other tweak:

Sorry!


---

Comment by tscrim created at 2022-03-07 11:08:12

Thanks (although I would normally put the optional in parentheses). I am okay with the current branch. Samuel?


---

Comment by git created at 2022-03-07 17:39:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2022-03-07 17:40:32

Replying to [comment:12 tscrim]:
> although I would normally put the optional in parentheses

Of course! Sorry again (that was not a good day).


---

Comment by tscrim created at 2022-03-08 01:08:51

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-03-08 01:08:51

No problem. Thank you for the fixes.

I am going to set this to a positive review since the patchbot is (morally) green. Samuel, if you have other changes you want, feel free to revert.


---

Comment by slelievre created at 2022-03-08 11:21:30

I wish one could change the display of the variables in the localisation.

Something like:

```
sage: P.<X, Y> = QQ[]
sage: L.<x, y> = P.localization(X - Y)
```

where the generators would display as `X`, `Y` in `P`
and as `x`, `y` in `L`.

That could be another ticket.

One could remove a pair of parentheses here:

```diff
-        fac = [(P(f), e) for (f, e) in F]
+        fac = [(P(f), e) for f, e in F]
```

but leaving them is fine too and even emphasizes
the transformation.

The shorter name `extra_units` might shorten
some lines with respect to `additional_units`.

One could split this line:

```diff
-            additional_units = [au for au in additional_units if ~au not in base_ring._additional_units]  # :trac:`33463`
+            additional_units = [u for u in additional_units
+                                if ~u not in base_ring._additional_units]
```


These are all minor points. No need to revert positive review.


---

Comment by soehms created at 2022-03-08 19:09:54

> That could be another ticket. 

I have opened #33482


---

Comment by vbraun created at 2022-03-09 23:37:58

Resolution: fixed
