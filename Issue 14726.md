# Issue 14726: Create a new class for S-units

archive/issues_014726.json:
```json
{
    "body": "CC:  mkosters akoutsianas\n\nKeywords: units, S-units, number fields\n\nIn Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no class for these which generalises the UnitGroup class in sage/rings/number_field/unit_group.py.   This ticket will create such a class, also adding a wrapper for the pari function bnfissunit.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14963\n\n",
    "created_at": "2013-07-24T13:44:22Z",
    "labels": [
        "number fields",
        "major",
        "enhancement"
    ],
    "title": "Create a new class for S-units",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14726",
    "user": "cremona"
}
```
CC:  mkosters akoutsianas

Keywords: units, S-units, number fields

In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no class for these which generalises the UnitGroup class in sage/rings/number_field/unit_group.py.   This ticket will create such a class, also adding a wrapper for the pari function bnfissunit.

Issue created by migration from https://trac.sagemath.org/ticket/14963





---

archive/issue_comments_187696.json:
```json
{
    "body": "Changing keywords from \"units, S-units, number fields\" to \"sd51, units, S-units, number fields\".",
    "created_at": "2013-07-25T07:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187696",
    "user": "cremona"
}
```

Changing keywords from "units, S-units, number fields" to "sd51, units, S-units, number fields".



---

archive/issue_comments_187697.json:
```json
{
    "body": "Set assignee to cremona.",
    "created_at": "2013-07-25T07:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187697",
    "user": "cremona"
}
```

Set assignee to cremona.



---

archive/issue_comments_187698.json:
```json
{
    "body": "I started to work on this at sd51 and hope to finish it soon.",
    "created_at": "2013-07-27T13:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187698",
    "user": "cremona"
}
```

I started to work on this at sd51 and hope to finish it soon.



---

archive/issue_comments_187699.json:
```json
{
    "body": "It was quite easy to extend the functionality of the UnitGroup class to include S-units, thanks to the pari function bnfsunit (which was already wrapped) and bnfissunit (which was not).  The class constructor requires that S not be a list, but it can be a tuple or something from which an element of the number field can be constructed.  Note that the pari function bnfsunit only returns the S-unit generators which are not global units, and the bnfissunit returns the exponents in the order (1) global units of infinite order, (2) torsion, (3) other S-units; so some permutation is required.  The new method for number fields is S_unit_group and is simiar to unit_group:  it caches S-unit groups using the tuple S as key, with separate caches for proof and non-proof options.\n\nThe old number field method S_units is probably now redundant; I added a note there directing users to S_unit_group for great functionality, as we do for units.",
    "created_at": "2013-07-28T16:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187699",
    "user": "cremona"
}
```

It was quite easy to extend the functionality of the UnitGroup class to include S-units, thanks to the pari function bnfsunit (which was already wrapped) and bnfissunit (which was not).  The class constructor requires that S not be a list, but it can be a tuple or something from which an element of the number field can be constructed.  Note that the pari function bnfsunit only returns the S-unit generators which are not global units, and the bnfissunit returns the exponents in the order (1) global units of infinite order, (2) torsion, (3) other S-units; so some permutation is required.  The new method for number fields is S_unit_group and is simiar to unit_group:  it caches S-unit groups using the tuple S as key, with separate caches for proof and non-proof options.

The old number field method S_units is probably now redundant; I added a note there directing users to S_unit_group for great functionality, as we do for units.



---

archive/issue_comments_187700.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-28T16:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187700",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187701.json:
```json
{
    "body": "update summary and description",
    "created_at": "2013-07-29T08:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187701",
    "user": "pbruin"
}
```

update summary and description



---

archive/issue_comments_187702.json:
```json
{
    "body": "This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.\n\nDid you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).\n\nApart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.",
    "created_at": "2013-08-06T21:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187702",
    "user": "pbruin"
}
```

This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.

Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).

Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.



---

archive/issue_comments_187703.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-07T07:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187703",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187704.json:
```json
{
    "body": "Replying to [comment:10 pbruin]:\n> This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.\n> \n> Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).\n\nYes, I did this on my laptop at the Leiden Sage Days and that's 32-bit.  Sorry for not testing on 64-bit too, and thanks for makinf the necessary fixes.  Sorry too for the trailing whitspace in my cut-and-paste doctests, I usually remember to get rid of it.\n\nAnd thanks for the positive review!\n\n> \n> Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.",
    "created_at": "2013-08-07T10:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187704",
    "user": "cremona"
}
```

Replying to [comment:10 pbruin]:
> This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.
> 
> Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).

Yes, I did this on my laptop at the Leiden Sage Days and that's 32-bit.  Sorry for not testing on 64-bit too, and thanks for makinf the necessary fixes.  Sorry too for the trailing whitspace in my cut-and-paste doctests, I usually remember to get rid of it.

And thanks for the positive review!

> 
> Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.



---

archive/issue_comments_187705.json:
```json
{
    "body": "This needs to be rebased to #14519.",
    "created_at": "2013-08-17T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187705",
    "user": "jdemeyer"
}
```

This needs to be rebased to #14519.



---

archive/issue_comments_187706.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-17T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187706",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_187707.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n> This needs to be rebased to #14519.\n\nI will do that, though it is exceedingly annoying to have to do so in order to satisfy some third party whose patch touched hundreds of files and therefore causes many other people such an inconvenience.  There should be a fine for that!",
    "created_at": "2013-08-17T16:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187707",
    "user": "cremona"
}
```

Replying to [comment:14 jdemeyer]:
> This needs to be rebased to #14519.

I will do that, though it is exceedingly annoying to have to do so in order to satisfy some third party whose patch touched hundreds of files and therefore causes many other people such an inconvenience.  There should be a fine for that!



---

archive/issue_comments_187708.json:
```json
{
    "body": "Attachment\n\napplies to 5.12.beta1 + #14519 + #14746",
    "created_at": "2013-08-19T13:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187708",
    "user": "cremona"
}
```

Attachment

applies to 5.12.beta1 + #14519 + #14746



---

archive/issue_comments_187709.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-19T13:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187709",
    "user": "cremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_187710.json:
```json
{
    "body": "Rebasing done, first patch replaced.",
    "created_at": "2013-08-19T13:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187710",
    "user": "cremona"
}
```

Rebasing done, first patch replaced.



---

archive/issue_comments_187711.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-09-04T15:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187711",
    "user": "pbruin"
}
```

Attachment



---

archive/issue_comments_187712.json:
```json
{
    "body": "Reviewer patch updated to make the `bnfissunit()` wrapper use `pari_catch_sig_on()` (the new name of the PARI version of `sig_on()`, see #15124).\n\nTests pass on my 64-bit system, but there might possibly be some doctest failures on 32-bit systems due to different PARI behaviour for 32/64 bits.",
    "created_at": "2013-09-04T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187712",
    "user": "pbruin"
}
```

Reviewer patch updated to make the `bnfissunit()` wrapper use `pari_catch_sig_on()` (the new name of the PARI version of `sig_on()`, see #15124).

Tests pass on my 64-bit system, but there might possibly be some doctest failures on 32-bit systems due to different PARI behaviour for 32/64 bits.



---

archive/issue_comments_187713.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-04T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187713",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187714.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-02T06:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14726#issuecomment-187714",
    "user": "jdemeyer"
}
```

Resolution: fixed
