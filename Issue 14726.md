# Issue 14726: Create a new class for S-units

Issue created by migration from https://trac.sagemath.org/ticket/14963

Original creator: cremona

Original creation time: 2013-07-24 13:44:22

CC:  mkosters akoutsianas

Keywords: units, S-units, number fields

In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no class for these which generalises the UnitGroup class in sage/rings/number_field/unit_group.py.   This ticket will create such a class, also adding a wrapper for the pari function bnfissunit.


---

Comment by cremona created at 2013-07-25 07:49:55

Changing keywords from "units, S-units, number fields" to "sd51, units, S-units, number fields".


---

Comment by cremona created at 2013-07-25 07:56:53

Set assignee to cremona.


---

Comment by cremona created at 2013-07-27 13:13:14

I started to work on this at sd51 and hope to finish it soon.


---

Comment by cremona created at 2013-07-28 16:03:36

It was quite easy to extend the functionality of the UnitGroup class to include S-units, thanks to the pari function bnfsunit (which was already wrapped) and bnfissunit (which was not).  The class constructor requires that S not be a list, but it can be a tuple or something from which an element of the number field can be constructed.  Note that the pari function bnfsunit only returns the S-unit generators which are not global units, and the bnfissunit returns the exponents in the order (1) global units of infinite order, (2) torsion, (3) other S-units; so some permutation is required.  The new method for number fields is S_unit_group and is simiar to unit_group:  it caches S-unit groups using the tuple S as key, with separate caches for proof and non-proof options.

The old number field method S_units is probably now redundant; I added a note there directing users to S_unit_group for great functionality, as we do for units.


---

Comment by cremona created at 2013-07-28 16:06:09

Changing status from new to needs_review.


---

Comment by pbruin created at 2013-07-29 08:36:42

update summary and description


---

Comment by pbruin created at 2013-08-06 21:40:33

This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.

Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).

Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.


---

Comment by pbruin created at 2013-08-07 07:01:16

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2013-08-07 10:41:38

Replying to [comment:10 pbruin]:
> This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.
> 
> Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).

Yes, I did this on my laptop at the Leiden Sage Days and that's 32-bit.  Sorry for not testing on 64-bit too, and thanks for makinf the necessary fixes.  Sorry too for the trailing whitspace in my cut-and-paste doctests, I usually remember to get rid of it.

And thanks for the positive review!

> 
> Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.


---

Comment by jdemeyer created at 2013-08-17 08:00:53

This needs to be rebased to #14519.


---

Comment by jdemeyer created at 2013-08-17 08:00:53

Changing status from positive_review to needs_work.


---

Comment by cremona created at 2013-08-17 16:52:27

Replying to [comment:14 jdemeyer]:
> This needs to be rebased to #14519.

I will do that, though it is exceedingly annoying to have to do so in order to satisfy some third party whose patch touched hundreds of files and therefore causes many other people such an inconvenience.  There should be a fine for that!


---

Attachment

applies to 5.12.beta1 + #14519 + #14746


---

Comment by cremona created at 2013-08-19 13:57:50

Changing status from needs_work to needs_review.


---

Comment by cremona created at 2013-08-19 13:57:50

Rebasing done, first patch replaced.


---

Attachment


---

Comment by pbruin created at 2013-09-04 15:59:04

Reviewer patch updated to make the `bnfissunit()` wrapper use `pari_catch_sig_on()` (the new name of the PARI version of `sig_on()`, see #15124).

Tests pass on my 64-bit system, but there might possibly be some doctest failures on 32-bit systems due to different PARI behaviour for 32/64 bits.


---

Comment by pbruin created at 2013-09-04 15:59:04

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-10-02 06:36:24

Resolution: fixed
