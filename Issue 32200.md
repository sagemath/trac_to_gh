# Issue 32200: composition of Laurent series can be wrong due to missing PARI conversion

Issue created by migration from https://trac.sagemath.org/ticket/32437

Original creator: lorenz

Original creation time: 2021-08-30 11:20:13

Keywords: laurent series, composition, pari interface

This is wrong:


```sage
sage: F.<u> = GF(257^2)
sage: R.<t> = LaurentSeriesRing(F)
sage: g = t + O(t^99)
sage: a = u*t + O(t^99)
sage: g(a)
O(t^3)
```


The correct result would be `u*t + O(t^99)`.

**Cause:** The `LaurentSeries` ring in this case is backed by `PowerSeries_pari`, which implements `__call__` by evaluating the PARI series `self.g` at the argument `a`. In the example above, `self.g` is a PARI `t_SER`, but `a` is still a `LaurentSeries`, which must therefore be converted to a PARI object first. However, `LaurentSeries` does not have a `__pari__` method, hence a generic fallback is used, which results in a `t_POL` object with variables `[u,t]`. This causes the confused behaviour from the example.

**Fix:** Implement `LaurentSeries.__pari__`. (On a deeper level, it might not be such a good idea to resort to guessing PARI conversions when `__pari__` is missing.)


---

Comment by lorenz created at 2021-08-30 11:22:28

New commits:


---

Comment by lorenz created at 2021-08-30 11:22:28

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-08-30 16:17:14

looks good. Let us wait for the patchbot. Does the back conversion from pari to sage works ?


---

Comment by lorenz created at 2021-08-31 02:00:07

The reverse direction is implemented here:

https://github.com/sagemath/sage/blob/9.4/src/sage/rings/laurent_series_ring.py#L488

It seems to be working for the cases I tried.


---

Comment by chapoton created at 2021-08-31 06:09:42

ok, let's go. thanks


---

Comment by chapoton created at 2021-08-31 06:09:42

Changing status from needs_review to positive_review.


---

Comment by lorenz created at 2021-08-31 06:14:24

Thank you!


---

Comment by vbraun created at 2021-09-19 09:58:54

Resolution: fixed
