# Issue 11632: delta_qexp() fails in large characteristic

Issue created by migration from https://trac.sagemath.org/ticket/11804

Original creator: jdemeyer

Original creation time: 2011-09-16 07:24:54

Assignee: AlexGhitza

CC:  spancratz lauder@maths.ox.ac.uk

Keywords: FLINT NTL polynomial _mul_short _mul_trunc delta_qexp _delta_poly_modulo

Sage fails to compute the q-expansion of the Delta modular form in large (>= machine word) characteristic:

```
sage: R = IntegerModRing(5^100)
sage: delta_qexp(200, 'q', R)
Exception OverflowError: 'long int too large to convert' in  ignored
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)

/home/jdemeyer/<ipython console> in <module>()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in delta_qexp(prec, var, K)
    389     ch = K.characteristic()
    390     if ch > 0 and prec > 150:
--> 391         return R(_delta_poly_modulo(ch, prec), prec, check=False)
    392     else:
    393         # compute over ZZ and coerce

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in _delta_poly_modulo(N, prec)
    307
    308     P = PolynomialRing(Integers(N), 'q')
--> 309     f = Polynomial_zmod_flint(P, x=v, check=False)
    310     t = verbose('made series')
    311     # fast way of computing f*f truncated at prec

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:11069)()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:5301)()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.get_cparent (sage/rings/polynomial/polynomial_zmod_flint.c:2599)()

OverflowError: long int too large to convert
```



---

Comment by jdemeyer created at 2011-09-16 07:26:10

Changing status from new to needs_review.


---

Comment by robertwb created at 2011-09-25 05:30:35

Changing status from needs_review to needs_work.


---

Comment by robertwb created at 2011-09-25 05:30:35

I would like to see some documentation as well as examples in the new _mul_trunc functions. Also, something like

sage: f = ...
sage: g = ...
sage: f*g
...
sage: f._mul_trunc(g, 2)
...

would be illustrative of what goes on as well as being a good test. 

The function as written will crash horribly if one does

sage: f._mul_trunc(2, 2)

it should probably be declared as

cpdef Polynomial_dense_modn_ntl_zz _mul_trunc(self, Polynomial_dense_modn_ntl_zz _right, long n)

Otherwise, the patch looks good. I am slightly concerned about performance degradation, but fixing this bug is more important.


---

Attachment


---

Comment by jdemeyer created at 2011-09-25 20:09:54

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2011-10-04 04:18:17

Changing status from needs_review to positive_review.


---

Comment by robertwb created at 2011-10-04 04:18:17

Excellent, thanks.


---

Comment by jdemeyer created at 2011-10-05 07:47:08

Resolution: fixed
