# Issue 22226: Skip sage_setup tests when not running in a git repository

archive/issues_022226.json:
```json
{
    "body": "Two tests that always fail for in the Docker container for Sage are the ones in `src/sage_setup/clean.py` and `src/sage_setup/find.py`.  This is in part because as designed, these tests don't make sense outside of a Sage development environment. \n\nBut in the Docker container (as well as the Windows installer) most build artifacts get cleaned up, so these tests no longer make sense.\n\nI feel like the easiest workaround is to just exclude the `sage_setup` tests entirely when running `sage -t -a` outside of a source repository.  These tests are important for testing the build tools themselves, but once Sage is built it's more important to focus on running tests of runtime behavior.\n\nI'm open to other suggestions, but it would be nice to get this fixed so as to have reliable tests in the Docker container builds.\n\n(For a little additional context: There are two build modes for the Docker container, one for 'develop' and one for 'releases'.  The 'develop' mode doesn't do as much cleanup, and so these tests in fact will work.  But then when making a 'release' image and subsequently running the tests, these tests fail since more cleanup is done for the 'release' images.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/22463\n\n",
    "created_at": "2017-02-27T16:36:51Z",
    "labels": [
        "doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Skip sage_setup tests when not running in a git repository",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22226",
    "user": "@embray"
}
```
Two tests that always fail for in the Docker container for Sage are the ones in `src/sage_setup/clean.py` and `src/sage_setup/find.py`.  This is in part because as designed, these tests don't make sense outside of a Sage development environment. 

But in the Docker container (as well as the Windows installer) most build artifacts get cleaned up, so these tests no longer make sense.

I feel like the easiest workaround is to just exclude the `sage_setup` tests entirely when running `sage -t -a` outside of a source repository.  These tests are important for testing the build tools themselves, but once Sage is built it's more important to focus on running tests of runtime behavior.

I'm open to other suggestions, but it would be nice to get this fixed so as to have reliable tests in the Docker container builds.

(For a little additional context: There are two build modes for the Docker container, one for 'develop' and one for 'releases'.  The 'develop' mode doesn't do as much cleanup, and so these tests in fact will work.  But then when making a 'release' image and subsequently running the tests, these tests fail since more cleanup is done for the 'release' images.)

Issue created by migration from https://trac.sagemath.org/ticket/22463





---

archive/issue_comments_308911.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-27T16:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308911",
    "user": "@embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308912.json:
```json
{
    "body": "Doesn't seem to actually be skipping the tests.",
    "created_at": "2017-02-27T16:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308912",
    "user": "@embray"
}
```

Doesn't seem to actually be skipping the tests.



---

archive/issue_comments_308913.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-27T16:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308913",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_308914.json:
```json
{
    "body": "Scratch that--I just forgot to reinstall.",
    "created_at": "2017-02-27T17:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308914",
    "user": "@embray"
}
```

Scratch that--I just forgot to reinstall.



---

archive/issue_comments_308915.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-27T17:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308915",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_308916.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-28T09:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308916",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_308917.json:
```json
{
    "body": "Thanks--it would be good to have this in 7.6.",
    "created_at": "2017-02-28T13:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308917",
    "user": "@embray"
}
```

Thanks--it would be good to have this in 7.6.



---

archive/issue_comments_308918.json:
```json
{
    "body": "Thank you, thank you Erik for this. This will reduce my patching.",
    "created_at": "2017-03-01T04:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308918",
    "user": "@kiwifb"
}
```

Thank you, thank you Erik for this. This will reduce my patching.



---

archive/issue_comments_308919.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> Thank you, thank you Erik for this. This will reduce my patching.\n\nI have another suite of patches I've been working on that I think you'll like (I started months ago before Christmas vacation but have just been bogged down with other things).  The purpose is to get Sage working better at runtime (including the test suite) when not running out of a source tree. So it will work much better when \"installed\" in a distro.",
    "created_at": "2017-03-01T08:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308919",
    "user": "@embray"
}
```

Replying to [comment:6 fbissey]:
> Thank you, thank you Erik for this. This will reduce my patching.

I have another suite of patches I've been working on that I think you'll like (I started months ago before Christmas vacation but have just been bogged down with other things).  The purpose is to get Sage working better at runtime (including the test suite) when not running out of a source tree. So it will work much better when "installed" in a distro.



---

archive/issue_comments_308920.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-01T18:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22226#issuecomment-308920",
    "user": "@vbraun"
}
```

Resolution: fixed
