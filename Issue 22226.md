# Issue 22226: Skip sage_setup tests when not running in a git repository

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2017-02-27 16:36:51

Two tests that always fail for in the Docker container for Sage are the ones in `src/sage_setup/clean.py` and `src/sage_setup/find.py`.  This is in part because as designed, these tests don't make sense outside of a Sage development environment. 

But in the Docker container (as well as the Windows installer) most build artifacts get cleaned up, so these tests no longer make sense.

I feel like the easiest workaround is to just exclude the `sage_setup` tests entirely when running `sage -t -a` outside of a source repository.  These tests are important for testing the build tools themselves, but once Sage is built it's more important to focus on running tests of runtime behavior.

I'm open to other suggestions, but it would be nice to get this fixed so as to have reliable tests in the Docker container builds.

(For a little additional context: There are two build modes for the Docker container, one for 'develop' and one for 'releases'.  The 'develop' mode doesn't do as much cleanup, and so these tests in fact will work.  But then when making a 'release' image and subsequently running the tests, these tests fail since more cleanup is done for the 'release' images.)


---

Comment by embray created at 2017-02-27 16:36:59

Changing status from new to needs_review.


---

Comment by embray created at 2017-02-27 16:56:06

Doesn't seem to actually be skipping the tests.


---

Comment by embray created at 2017-02-27 16:56:06

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-02-27 17:00:28

Scratch that--I just forgot to reinstall.


---

Comment by embray created at 2017-02-27 17:00:28

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-02-28 09:32:49

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-02-28 13:18:13

Thanks--it would be good to have this in 7.6.


---

Comment by fbissey created at 2017-03-01 04:00:14

Thank you, thank you Erik for this. This will reduce my patching.


---

Comment by embray created at 2017-03-01 08:37:26

Replying to [comment:6 fbissey]:
> Thank you, thank you Erik for this. This will reduce my patching.

I have another suite of patches I've been working on that I think you'll like (I started months ago before Christmas vacation but have just been bogged down with other things).  The purpose is to get Sage working better at runtime (including the test suite) when not running out of a source tree. So it will work much better when "installed" in a distro.


---

Comment by vbraun created at 2017-03-01 18:50:32

Resolution: fixed
