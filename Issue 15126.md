# Issue 15126: Segfault in exact_rational for RR

archive/issues_015126.json:
```json
{
    "body": "CC:  zimmerma\n\n\n```\nsage: RR(0).nextabove().exact_rational()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-4-15f1a6720d58> in <module>()\n----> 1 RR(Integer(0)).nextabove().exact_rational()\n\n/scratch/release/merger/sage-5.12/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so in sage.rings.real_mpfr.RealNumber.exact_rational (sage/rings/real_mpfr.c:18768)()\n\n/scratch/release/merger/sage-5.12/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__pow__ (sage/rings/integer.c:14022)()\n\nRuntimeError: Segmentation fault\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15363\n\n",
    "created_at": "2013-11-06T17:01:28Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "title": "Segfault in exact_rational for RR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15126",
    "user": "jdemeyer"
}
```
CC:  zimmerma


```
sage: RR(0).nextabove().exact_rational()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-4-15f1a6720d58> in <module>()
----> 1 RR(Integer(0)).nextabove().exact_rational()

/scratch/release/merger/sage-5.12/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so in sage.rings.real_mpfr.RealNumber.exact_rational (sage/rings/real_mpfr.c:18768)()

/scratch/release/merger/sage-5.12/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__pow__ (sage/rings/integer.c:14022)()

RuntimeError: Segmentation fault
```


Issue created by migration from https://trac.sagemath.org/ticket/15363





---

archive/issue_comments_193915.json:
```json
{
    "body": "Changing component from basic arithmetic to c_lib.",
    "created_at": "2013-11-06T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193915",
    "user": "jdemeyer"
}
```

Changing component from basic arithmetic to c_lib.



---

archive/issue_comments_193916.json:
```json
{
    "body": "Attachment [15363_mpir_malloc.patch](tarball://root/attachments/some-uuid/ticket15363/15363_mpir_malloc.patch) by jdemeyer created at 2013-11-08 10:02:43",
    "created_at": "2013-11-08T10:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193916",
    "user": "jdemeyer"
}
```

Attachment [15363_mpir_malloc.patch](tarball://root/attachments/some-uuid/ticket15363/15363_mpir_malloc.patch) by jdemeyer created at 2013-11-08 10:02:43



---

archive/issue_comments_193917.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-08T10:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193917",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_193918.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-08T14:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193918",
    "user": "zimmerma"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_193919.json:
```json
{
    "body": "after importing the patch in Sage 5.12, I get with `sage -br`:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 5.12, Release Date: 2013-10-07                        \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTraceback (most recent call last):\n  File \"/localdisk/tmp/sage-5.12/local/bin/sage-ipython\", line 6, in <module>\n    from sage.misc.interpreter import SageTerminalApp\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/interpreter.py\", line 67, in <module>\n    import os, log, re, new, sys\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/log.py\", line 66, in <module>\n    import misc\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py\", line 39, in <module>\n    import sage.misc.prandom as random\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py\", line 58, in <module>\n    from sage.misc.randstate import current_randstate\nImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error\nError in atexit._run_exitfuncs:\nTraceback (most recent call last):\n  File \"/localdisk/tmp/sage-5.12/local/lib/python/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/temporary_file.py\", line 51, in delete_tmpfiles\n    from sage.misc.misc import SAGE_TMP\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py\", line 39, in <module>\n    import sage.misc.prandom as random\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py\", line 58, in <module>\n    from sage.misc.randstate import current_randstate\nImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error\nError in sys.exitfunc:\nTraceback (most recent call last):\n  File \"/localdisk/tmp/sage-5.12/local/lib/python/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/temporary_file.py\", line 51, in delete_tmpfiles\n    from sage.misc.misc import SAGE_TMP\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py\", line 39, in <module>\n    import sage.misc.prandom as random\n  File \"/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py\", line 58, in <module>\n    from sage.misc.randstate import current_randstate\nImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error\n```\n\nPaul",
    "created_at": "2013-11-08T14:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193919",
    "user": "zimmerma"
}
```

after importing the patch in Sage 5.12, I get with `sage -br`:

```
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 5.12, Release Date: 2013-10-07                        │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
Traceback (most recent call last):
  File "/localdisk/tmp/sage-5.12/local/bin/sage-ipython", line 6, in <module>
    from sage.misc.interpreter import SageTerminalApp
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/interpreter.py", line 67, in <module>
    import os, log, re, new, sys
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/log.py", line 66, in <module>
    import misc
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py", line 39, in <module>
    import sage.misc.prandom as random
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py", line 58, in <module>
    from sage.misc.randstate import current_randstate
ImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error
Error in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/localdisk/tmp/sage-5.12/local/lib/python/atexit.py", line 24, in _run_exitfuncs
    func(*targs, **kargs)
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/temporary_file.py", line 51, in delete_tmpfiles
    from sage.misc.misc import SAGE_TMP
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py", line 39, in <module>
    import sage.misc.prandom as random
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py", line 58, in <module>
    from sage.misc.randstate import current_randstate
ImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error
Error in sys.exitfunc:
Traceback (most recent call last):
  File "/localdisk/tmp/sage-5.12/local/lib/python/atexit.py", line 24, in _run_exitfuncs
    func(*targs, **kargs)
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/temporary_file.py", line 51, in delete_tmpfiles
    from sage.misc.misc import SAGE_TMP
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/misc.py", line 39, in <module>
    import sage.misc.prandom as random
  File "/localdisk/tmp/sage-5.12/local/lib/python2.7/site-packages/sage/misc/prandom.py", line 58, in <module>
    from sage.misc.randstate import current_randstate
ImportError: /localdisk/tmp/sage-5.12/local/lib/libcsage.so: undefined symbol: sig_error
```

Paul



---

archive/issue_comments_193920.json:
```json
{
    "body": "Did you apply the dependency #9640?",
    "created_at": "2013-11-09T08:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193920",
    "user": "jdemeyer"
}
```

Did you apply the dependency #9640?



---

archive/issue_comments_193921.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-09T12:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193921",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_193922.json:
```json
{
    "body": "> Did you apply the dependency #9640?\n\nobviously not...\n\nPaul",
    "created_at": "2013-11-12T09:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193922",
    "user": "zimmerma"
}
```

> Did you apply the dependency #9640?

obviously not...

Paul



---

archive/issue_comments_193923.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-12T15:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193923",
    "user": "zimmerma"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_193924.json:
```json
{
    "body": "the example in the description no longer gives a Seg. fault, all doctests still pass,\nI'm not an expert of the Python-C interface but nevertheless the patch looks fine to me,\nthus I give a positive review.\n\nPaul",
    "created_at": "2013-11-12T15:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193924",
    "user": "zimmerma"
}
```

the example in the description no longer gives a Seg. fault, all doctests still pass,
I'm not an expert of the Python-C interface but nevertheless the patch looks fine to me,
thus I give a positive review.

Paul



---

archive/issue_comments_193925.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-11-12T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15126",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15126#issuecomment-193925",
    "user": "jdemeyer"
}
```

Resolution: fixed
