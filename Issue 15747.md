# Issue 15747: Python 3 preparation: Change some code to use more modern Python idioms

Issue created by migration from https://trac.sagemath.org/ticket/15984

Original creator: wluebbe

Original creation time: 2014-03-20 15:18:38

Keywords: python3

This fixer changes code like `type(x) == T)` and `while 1:` and it introduces the `sorted()` function where appropriate.

These changes are optional, but they improve style and may provide a small performance gain.

Changes according to `lib2to3/fixes/fix_idioms.py`:

```
* Change some type comparisons to isinstance() calls:
    type(x) == T -> isinstance(x, T)
    type(x) is T -> isinstance(x, T)
    type(x) != T -> not isinstance(x, T)
    type(x) is not T -> not isinstance(x, T)

* Change "while 1:" into "while True:".

* Change both
    v = list(EXPR)
    v.sort()
    foo(v)

and the more general
    v = EXPR
    v.sort()
    foo(v)

into
    v = sorted(EXPR)
    foo(v)
```




---

Comment by wluebbe created at 2014-03-28 18:42:04

Changing status from new to needs_review.


---

Comment by wluebbe created at 2014-03-28 18:42:04

* At first I applied the 2to3 tool (idioms) -> first commit  
* Fixing the doctests failures of the first commit -> second commit. All tests passed.
* Changed `while 1:` into `while True:` for cython modules -> third commit.
----
New commits:


---

Comment by git created at 2014-04-03 08:45:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by wluebbe created at 2014-04-03 08:46:15

Rebased on 6.2.beta6 and resolved merge conflicts.


---

Comment by wluebbe created at 2014-04-04 17:07:05

And the test report:

```
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 3214.7 seconds
```



---

Comment by tscrim created at 2014-04-06 03:46:33

I think it would also be good to change `x == None` to `x is None` while we're at it.


---

Comment by wluebbe created at 2014-04-06 12:34:01

There are 151 modules (py and pyx combined) which have at least one of `== None` or `!= None`. 


The change makes sense as (by far) most modules use `is None` or `is not None`.

But as this change is already pretty large I would prefer to see this change in a separate ticket/branch.


---

Comment by tscrim created at 2014-04-07 19:54:21

I think it fits well with this ticket (plus how many of those modules overlap with this one?). Also one large sweeping change is the same to me as two large sweeping changes (especially with different commits), but with the added benefit of an only one time potential rebase. If you still disagree and want it in a separate ticket, then you can set this to positive review.


---

Comment by wluebbe created at 2014-04-08 08:52:38

Changing status from needs_review to positive_review.


---

Comment by wluebbe created at 2014-04-08 08:52:38

I generated 151 patched py and pyx files. 3 pyx files gave doctest failures. And I got merge conflicts with this branch.

Therefor I set this ticket to "positive review" (as suggested above).

I will open a separate ticket for `== None` and generate fresh patches when this ticket is merged in a beta or release.


---

Comment by vbraun created at 2014-04-08 12:41:27

Resolution: fixed
