# Issue 10804: Bug in integer_mod powering non-invertible base and negative exponents

archive/issues_010804.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  @kcrisman\n\n\n```\nsage: mod(2, 990)^-1\n------------------------------------------------------------\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\nRuntimeError\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10873\n\n",
    "created_at": "2011-03-04T08:34:08Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "Bug in integer_mod powering non-invertible base and negative exponents",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10804",
    "user": "https://github.com/robertwb"
}
```
Assignee: @aghitza

CC:  @kcrisman


```
sage: mod(2, 990)^-1
------------------------------------------------------------
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
RuntimeError
```


Issue created by migration from https://trac.sagemath.org/ticket/10873





---

archive/issue_comments_114189.json:
```json
{
    "body": "Attachment [10873-mod-pow.patch](tarball://root/attachments/some-uuid/ticket10873/10873-mod-pow.patch) by @robertwb created at 2011-03-04 08:35:12",
    "created_at": "2011-03-04T08:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114189",
    "user": "https://github.com/robertwb"
}
```

Attachment [10873-mod-pow.patch](tarball://root/attachments/some-uuid/ticket10873/10873-mod-pow.patch) by @robertwb created at 2011-03-04 08:35:12



---

archive/issue_comments_114190.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-04T08:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114190",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_114191.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-17T13:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114191",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_114192.json:
```json
{
    "body": "The patch fails to apply to sage-4.7.rc2:\n\n\n```\nsage: hg_sage.apply(\"/home/mariah/10873-mod-pow.patch\")\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage\" && hg import   \"/home/mariah/10873-mod-pow.patch\"\napplying /home/mariah/10873-mod-pow.patch\npatching file sage/rings/finite_rings/integer_mod.pyx\nHunk #2 FAILED at 1637\nHunk #5 FAILED at 2131\nHunk #7 FAILED at 2933\n3 out of 8 hunks FAILED -- saving rejects to file sage/rings/finite_rings/integer_mod.pyx.rej\nabort: patch failed to apply\nsage:\n```\n",
    "created_at": "2011-05-17T13:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114192",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

The patch fails to apply to sage-4.7.rc2:


```
sage: hg_sage.apply("/home/mariah/10873-mod-pow.patch")
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc-review-10873/devel/sage" && hg import   "/home/mariah/10873-mod-pow.patch"
applying /home/mariah/10873-mod-pow.patch
patching file sage/rings/finite_rings/integer_mod.pyx
Hunk #2 FAILED at 1637
Hunk #5 FAILED at 2131
Hunk #7 FAILED at 2933
3 out of 8 hunks FAILED -- saving rejects to file sage/rings/finite_rings/integer_mod.pyx.rej
abort: patch failed to apply
sage:
```




---

archive/issue_comments_114193.json:
```json
{
    "body": "FIxed _sig_on -> sig_on() conflict.",
    "created_at": "2011-05-31T07:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114193",
    "user": "https://github.com/robertwb"
}
```

FIxed _sig_on -> sig_on() conflict.



---

archive/issue_comments_114194.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-31T07:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114194",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_114195.json:
```json
{
    "body": "apply only this patch",
    "created_at": "2011-06-01T04:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114195",
    "user": "https://github.com/robertwb"
}
```

apply only this patch



---

archive/issue_comments_114196.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-01T13:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114196",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_114197.json:
```json
{
    "body": "Attachment [10873-mod-pow-rebased.patch](tarball://root/attachments/some-uuid/ticket10873/10873-mod-pow-rebased.patch) by mariah created at 2011-06-01 13:39:38\n\npatch [attachment:10873-mod-pow-rebased.patch] applied to sage-4.7.1.alpha1, then did 'make testlong'.  Got the following error:\n\n\n```\nsage -t -long -force_lib \"devel/sage/sage/rings/finite_rings/integer_mod.pyx\"\nESC[?1034h**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx\", iled example:\n    sig_on_count()\nExpected:\n    0\nGot:\n    1\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx\", iled example:\n    sig_on_count()\nExpected:\n    0\nGot:\n    1\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx\", iled example:\n    sig_on_count()\nExpected:\n    0\nGot:\n    1\n**********************************************************************\n```\n\n\netc.",
    "created_at": "2011-06-01T13:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114197",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Attachment [10873-mod-pow-rebased.patch](tarball://root/attachments/some-uuid/ticket10873/10873-mod-pow-rebased.patch) by mariah created at 2011-06-01 13:39:38

patch [attachment:10873-mod-pow-rebased.patch] applied to sage-4.7.1.alpha1, then did 'make testlong'.  Got the following error:


```
sage -t -long -force_lib "devel/sage/sage/rings/finite_rings/integer_mod.pyx"
ESC[?1034h**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx", iled example:
    sig_on_count()
Expected:
    0
Got:
    1
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx", iled example:
    sig_on_count()
Expected:
    0
Got:
    1
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha1-x86_64-Linux-core2-fc-review-10873/devel/sage/sage/rings/finite_rings/integer_mod.pyx", iled example:
    sig_on_count()
Expected:
    0
Got:
    1
**********************************************************************
```


etc.



---

archive/issue_comments_114198.json:
```json
{
    "body": "How long ago was this? (I posted an updated version of the patch when I saw these errors on the patchbot, maybe you grabbed the old one?)",
    "created_at": "2011-06-01T16:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114198",
    "user": "https://github.com/robertwb"
}
```

How long ago was this? (I posted an updated version of the patch when I saw these errors on the patchbot, maybe you grabbed the old one?)



---

archive/issue_comments_114199.json:
```json
{
    "body": "Replying to [comment:6 robertwb]:\n> How long ago was this? (I posted an updated version of the patch when I saw these errors on the patchbot, maybe you grabbed the old one?)\n\nI now believe that what I am seeing is not due to your patch but to a relocation bug in sage-4.7.1-alpha1.  See #11419.  Apologies.",
    "created_at": "2011-06-01T19:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114199",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Replying to [comment:6 robertwb]:
> How long ago was this? (I posted an updated version of the patch when I saw these errors on the patchbot, maybe you grabbed the old one?)

I now believe that what I am seeing is not due to your patch but to a relocation bug in sage-4.7.1-alpha1.  See #11419.  Apologies.



---

archive/issue_comments_114200.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-01T20:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114200",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_114201.json:
```json
{
    "body": "No problem, I'm just glad you're taking the time to look at my tickets :).",
    "created_at": "2011-06-01T20:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114201",
    "user": "https://github.com/robertwb"
}
```

No problem, I'm just glad you're taking the time to look at my tickets :).



---

archive/issue_comments_114202.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-02T17:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114202",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_114203.json:
```json
{
    "body": "Applied patch, did 'sage -b', then 'make testlong'.  All tests passed.  Positive review!",
    "created_at": "2011-06-02T17:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114203",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Applied patch, did 'sage -b', then 'make testlong'.  All tests passed.  Positive review!



---

archive/issue_comments_114204.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-06-14T19:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10804#issuecomment-114204",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
