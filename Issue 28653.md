# Issue 28653: Install fewer static libraries

archive/issues_028653.json:
```json
{
    "body": "CC:  @mezzarobba @dimpase @orlitzky @jhpalmieri @videlec\n\nKeywords: static\n\nAs pointed out [on sage-devel](https://groups.google.com/d/msg/sage-devel/ON2MC0n2iUE/Qt4axoa0AQAJ), by default many SPKGs install static libraries in addition to their associated dynamic libs.\n\nI usually ignored this as harmless, but as Marc pointed out, some of them are quite large, especially libgiac.a.  Almost none of these are actually needed either at build or runtime and do not need to be installed by default in SAGE_LOCAL.\n\nI think by default we should configure the relevant packages to *not* install static libs, or remove them manually if the packages' build system installs them forcibly.  This could be overridden with `<PKGNAME>_CONFIGURE` variables if someone needs the static lib for some reason.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28890\n\n",
    "created_at": "2019-12-16T13:44:32Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Install fewer static libraries",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28653",
    "user": "https://github.com/embray"
}
```
CC:  @mezzarobba @dimpase @orlitzky @jhpalmieri @videlec

Keywords: static

As pointed out [on sage-devel](https://groups.google.com/d/msg/sage-devel/ON2MC0n2iUE/Qt4axoa0AQAJ), by default many SPKGs install static libraries in addition to their associated dynamic libs.

I usually ignored this as harmless, but as Marc pointed out, some of them are quite large, especially libgiac.a.  Almost none of these are actually needed either at build or runtime and do not need to be installed by default in SAGE_LOCAL.

I think by default we should configure the relevant packages to *not* install static libs, or remove them manually if the packages' build system installs them forcibly.  This could be overridden with `<PKGNAME>_CONFIGURE` variables if someone needs the static lib for some reason.

Issue created by migration from https://trac.sagemath.org/ticket/28890





---

archive/issue_comments_404211.json:
```json
{
    "body": "Passing `--disable-static` to all autoconf-compatible packages by default takes care of most of them, narrowing the list down to:\n\n\n```\necl-16.1.2.p5\necm-7.0.4.p1\nlibatomic_ops-7.6.2\nmpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.p0\nntl-11.3.2\nnumpy-1.16.1\npari-2.11.1.p2\npython2-2.7.15.p1\npython3-3.7.3.p1\nratpoints-2.1.3.p5\nsymmetrica-2.0.p11\nyasm-1.3.0.p0\n```\n\n\nLeft libatomic_ops static since I think gc likes to link to it statically for performance reasons, but I need to double-check that it's actually doing that.\n\nThe rest I'm not sure about yet.  \n----\nNew commits:",
    "created_at": "2019-12-16T17:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404211",
    "user": "https://github.com/embray"
}
```

Passing `--disable-static` to all autoconf-compatible packages by default takes care of most of them, narrowing the list down to:


```
ecl-16.1.2.p5
ecm-7.0.4.p1
libatomic_ops-7.6.2
mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.p0
ntl-11.3.2
numpy-1.16.1
pari-2.11.1.p2
python2-2.7.15.p1
python3-3.7.3.p1
ratpoints-2.1.3.p5
symmetrica-2.0.p11
yasm-1.3.0.p0
```


Left libatomic_ops static since I think gc likes to link to it statically for performance reasons, but I need to double-check that it's actually doing that.

The rest I'm not sure about yet.  
----
New commits:



---

archive/issue_comments_404212.json:
```json
{
    "body": "OK, let me run tests...",
    "created_at": "2019-12-16T17:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404212",
    "user": "https://github.com/dimpase"
}
```

OK, let me run tests...



---

archive/issue_comments_404213.json:
```json
{
    "body": "the branch looks good, do you want it to be reviewed?",
    "created_at": "2019-12-16T23:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404213",
    "user": "https://github.com/dimpase"
}
```

the branch looks good, do you want it to be reviewed?



---

archive/issue_comments_404214.json:
```json
{
    "body": "Thanks a lot for taking care of that. (You are crossing an item off the depths of my todo-list!)\n\nI just rebuilt sage from scratch with this branch. With standard packages only and using system packages when possible, the remaining static libraries are\n\n```\n107M    ./local/lib/libpari.a\n48M     ./local/lib/libsymmetrica.a\n31M     ./local/lib/python3.7/config-3.7m-x86_64-linux-gnu/libpython3.7m.a\n7,7M    ./local/lib/ecl-16.1.2/libcmp.a\n7,5M    ./local/lib/libbraiding.a\n5,4M    ./local/lib/libyasm.a\n4,5M    ./local/lib/ecl-16.1.2/libasdf.a\n3,1M    ./local/lib/libecm.a\n880K    ./local/lib/ecl-16.1.2/libdefsystem.a\n564K    ./local/lib/ecl-16.1.2/libdeflate.a\n448K    ./local/lib/ecl-16.1.2/libsockets.a\n372K    ./local/lib/python3.7/site-packages/numpy/core/lib/libnpymath.a\n232K    ./local/lib/ecl-16.1.2/libecl-help.a\n200K    ./local/lib/ecl-16.1.2/libprofile.a\n184K    ./local/lib/ecl-16.1.2/librt.a\n176K    ./local/lib/libratpoints.a\n172K    ./local/lib/libhomfly.a\n172K    ./local/lib/ecl-16.1.2/libecl-cdb.a\n140K    ./local/lib/ecl-16.1.2/libecl-curl.a\n132K    ./local/lib/ecl-16.1.2/libserve-event.a\n132K    ./local/lib/ecl-16.1.2/libql-minitar.a\n96K     ./local/lib/ecl-16.1.2/libecl-quicklisp.a\n72K     ./local/lib/ecl-16.1.2/libsb-bsd-sockets.a\n32K     ./local/lib/libatomic_ops_gpl.a\n24K     ./local/lib/libatomic_ops.a\n```\n\nSo most of the large ones are gone, and those that remain may have a good reason to be there. Like Dima, I'm ready to give this branch positive review if you want.",
    "created_at": "2019-12-17T09:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404214",
    "user": "https://github.com/mezzarobba"
}
```

Thanks a lot for taking care of that. (You are crossing an item off the depths of my todo-list!)

I just rebuilt sage from scratch with this branch. With standard packages only and using system packages when possible, the remaining static libraries are

```
107M    ./local/lib/libpari.a
48M     ./local/lib/libsymmetrica.a
31M     ./local/lib/python3.7/config-3.7m-x86_64-linux-gnu/libpython3.7m.a
7,7M    ./local/lib/ecl-16.1.2/libcmp.a
7,5M    ./local/lib/libbraiding.a
5,4M    ./local/lib/libyasm.a
4,5M    ./local/lib/ecl-16.1.2/libasdf.a
3,1M    ./local/lib/libecm.a
880K    ./local/lib/ecl-16.1.2/libdefsystem.a
564K    ./local/lib/ecl-16.1.2/libdeflate.a
448K    ./local/lib/ecl-16.1.2/libsockets.a
372K    ./local/lib/python3.7/site-packages/numpy/core/lib/libnpymath.a
232K    ./local/lib/ecl-16.1.2/libecl-help.a
200K    ./local/lib/ecl-16.1.2/libprofile.a
184K    ./local/lib/ecl-16.1.2/librt.a
176K    ./local/lib/libratpoints.a
172K    ./local/lib/libhomfly.a
172K    ./local/lib/ecl-16.1.2/libecl-cdb.a
140K    ./local/lib/ecl-16.1.2/libecl-curl.a
132K    ./local/lib/ecl-16.1.2/libserve-event.a
132K    ./local/lib/ecl-16.1.2/libql-minitar.a
96K     ./local/lib/ecl-16.1.2/libecl-quicklisp.a
72K     ./local/lib/ecl-16.1.2/libsb-bsd-sockets.a
32K     ./local/lib/libatomic_ops_gpl.a
24K     ./local/lib/libatomic_ops.a
```

So most of the large ones are gone, and those that remain may have a good reason to be there. Like Dima, I'm ready to give this branch positive review if you want.



---

archive/issue_comments_404215.json:
```json
{
    "body": "I want to have a look at a few of the remaining libs.  Also, I got a few test failures with this branch, but I don't know if they're at all related (shouldn't be...)",
    "created_at": "2019-12-17T12:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404215",
    "user": "https://github.com/embray"
}
```

I want to have a look at a few of the remaining libs.  Also, I got a few test failures with this branch, but I don't know if they're at all related (shouldn't be...)



---

archive/issue_comments_404216.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> Also, I got a few test failures with this branch, but I don't know if they're at all related (shouldn't be...)\n\nThey weren't related.  It was the problem that #28289 is intended to fix.  Turns out my develop branch was a little behind.",
    "created_at": "2019-12-17T12:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404216",
    "user": "https://github.com/embray"
}
```

Replying to [comment:7 embray]:
> Also, I got a few test failures with this branch, but I don't know if they're at all related (shouldn't be...)

They weren't related.  It was the problem that #28289 is intended to fix.  Turns out my develop branch was a little behind.



---

archive/issue_comments_404217.json:
```json
{
    "body": "Since we are apparently already moving 9.0 towards a release candidate, this will probably have to wait a bit.",
    "created_at": "2019-12-30T14:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404217",
    "user": "https://github.com/embray"
}
```

Since we are apparently already moving 9.0 towards a release candidate, this will probably have to wait a bit.



---

archive/issue_comments_404218.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-12-30T15:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404219.json:
```json
{
    "body": "Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.\n\nMy only concern here is there no easy way (since it is not a flag that can be passed to PARI_CONFIGURE) to force installation of the static lib.  But if someone asks for it for some reason it can be added later.",
    "created_at": "2019-12-30T15:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404219",
    "user": "https://github.com/embray"
}
```

Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.

My only concern here is there no easy way (since it is not a flag that can be passed to PARI_CONFIGURE) to force installation of the static lib.  But if someone asks for it for some reason it can be added later.



---

archive/issue_comments_404220.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.\n> \n\npari/gp upstream claims that statically linked gp is faster than dynamically linked one.",
    "created_at": "2019-12-30T15:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404220",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 embray]:
> Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.
> 

pari/gp upstream claims that statically linked gp is faster than dynamically linked one.



---

archive/issue_comments_404221.json:
```json
{
    "body": "Replying to [comment:12 dimpase]:\n> Replying to [comment:11 embray]:\n> > Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.\n> > \n> \n> pari/gp upstream claims that statically linked gp is faster than dynamically linked one.\n\nIf so, it appears we are already *not* doing this, though we could.  Regardless, this can be done during PARI/GP build: there is no need to install the static lib after the fact.",
    "created_at": "2019-12-30T15:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404221",
    "user": "https://github.com/embray"
}
```

Replying to [comment:12 dimpase]:
> Replying to [comment:11 embray]:
> > Updated to remove libpari.a.  Apparently we had been explicitly installing it pretty much forever, so I couldn't find a clear record of *why*, but I don't think there's any need for it currently.
> > 
> 
> pari/gp upstream claims that statically linked gp is faster than dynamically linked one.

If so, it appears we are already *not* doing this, though we could.  Regardless, this can be done during PARI/GP build: there is no need to install the static lib after the fact.



---

archive/issue_comments_404222.json:
```json
{
    "body": "libbraiding and libhomfly will be handled by this as well once #28927 is in.",
    "created_at": "2019-12-30T16:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404222",
    "user": "https://github.com/embray"
}
```

libbraiding and libhomfly will be handled by this as well once #28927 is in.



---

archive/issue_comments_404223.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-30T17:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404223",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404224.json:
```json
{
    "body": "I think that with the last commit this pretty much covers everything.  I looked into all the other packages that are installing static libs, and determined that it's either on purpose, or too much trouble to mess with as part of this ticket.",
    "created_at": "2019-12-30T17:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404224",
    "user": "https://github.com/embray"
}
```

I think that with the last commit this pretty much covers everything.  I looked into all the other packages that are installing static libs, and determined that it's either on purpose, or too much trouble to mess with as part of this ticket.



---

archive/issue_comments_404225.json:
```json
{
    "body": "Thank you again!",
    "created_at": "2020-01-09T10:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404225",
    "user": "https://github.com/mezzarobba"
}
```

Thank you again!



---

archive/issue_comments_404226.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-09T10:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404226",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404227.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-11T17:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404227",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026509.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-01-11T17:45:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28653#event-26509"
}
```



---

archive/issue_comments_404228.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-01-15T23:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404228",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_404229.json:
```json
{
    "body": "\n```\n****************************************************\nConfiguring zlib-1.2.11.p0\nunknown option: --disable-static\n./configure --help for help\n** ./configure aborting.\nunknown option: --disable-static\n./configure --help for help\n** ./configure aborting.\n********************************************************************************\nError configuring zlib-1.2.11.p0\n********************************************************************************\n```\n",
    "created_at": "2020-01-15T23:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404229",
    "user": "https://github.com/vbraun"
}
```


```
****************************************************
Configuring zlib-1.2.11.p0
unknown option: --disable-static
./configure --help for help
** ./configure aborting.
unknown option: --disable-static
./configure --help for help
** ./configure aborting.
********************************************************************************
Error configuring zlib-1.2.11.p0
********************************************************************************
```




---

archive/issue_comments_404230.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-01-15T23:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404230",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_026510.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-01-15T23:58:29Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28653#event-26510"
}
```



---

archive/issue_comments_404231.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-16T14:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404231",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_404232.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2020-01-16T14:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404232",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_404233.json:
```json
{
    "body": "Hrm, that's annoying.  Thanks, zlib...",
    "created_at": "2020-01-16T14:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404233",
    "user": "https://github.com/embray"
}
```

Hrm, that's annoying.  Thanks, zlib...



---

archive/issue_comments_404234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-16T14:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404235.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-16T14:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404235",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_404236.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-16T14:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404236",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404237.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-16T14:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404237",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404238.json:
```json
{
    "body": "I'm getting libpng build errors on KuCalc (Debian 9 x86_64) because something is wrong with zlib dynamic linking:\n\n```\nlibtool: link: gcc -fPIC -g -Wl,-rpath -Wl,/var/lib/buildbot/slave/sage_git/build/local/lib -o .libs/pngunknown contrib/libtests/pngunknown.o  -L/var/lib/buildbot/slave/sage_git/build/local/lib ./.libs/libpng16.so -lz -lm -Wl,-rpath -Wl,/var/lib/buildbot/slave/sage_git/build/local/lib\ncollect2: error: ld returned 1 exit status\nMakefile:1026: recipe for target 'pngtest' failed\nmake[5]: *** [pngtest] Error 1\n./.libs/libpng16.so: undefined reference to `inflateValidate'\n```\n",
    "created_at": "2020-01-19T10:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404238",
    "user": "https://github.com/vbraun"
}
```

I'm getting libpng build errors on KuCalc (Debian 9 x86_64) because something is wrong with zlib dynamic linking:

```
libtool: link: gcc -fPIC -g -Wl,-rpath -Wl,/var/lib/buildbot/slave/sage_git/build/local/lib -o .libs/pngunknown contrib/libtests/pngunknown.o  -L/var/lib/buildbot/slave/sage_git/build/local/lib ./.libs/libpng16.so -lz -lm -Wl,-rpath -Wl,/var/lib/buildbot/slave/sage_git/build/local/lib
collect2: error: ld returned 1 exit status
Makefile:1026: recipe for target 'pngtest' failed
make[5]: *** [pngtest] Error 1
./.libs/libpng16.so: undefined reference to `inflateValidate'
```




---

archive/issue_comments_404239.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-19T10:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404239",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_404240.json:
```json
{
    "body": "I presume build/pkgs/libpng/spkg-install needs LDFLAGS set to point at $SAGE_LOCAL/lib/\nin the case of zlib not coming from the system.\n(and the same for the other zlib deps, I guess)",
    "created_at": "2020-01-19T11:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404240",
    "user": "https://github.com/dimpase"
}
```

I presume build/pkgs/libpng/spkg-install needs LDFLAGS set to point at $SAGE_LOCAL/lib/
in the case of zlib not coming from the system.
(and the same for the other zlib deps, I guess)



---

archive/issue_comments_404241.json:
```json
{
    "body": "Replying to [comment:30 dimpase]:\n> I presume build/pkgs/libpng/spkg-install needs LDFLAGS set to point at $SAGE_LOCAL/lib/\n> in the case of zlib not coming from the system.\n> (and the same for the other zlib deps, I guess)\n\nDon't we already do that for all packages?  The failing command Volker posted already had `-L/var/lib/buildbot/slave/sage_git/build/local/lib` as well as `-lz`.",
    "created_at": "2020-01-22T12:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404241",
    "user": "https://github.com/embray"
}
```

Replying to [comment:30 dimpase]:
> I presume build/pkgs/libpng/spkg-install needs LDFLAGS set to point at $SAGE_LOCAL/lib/
> in the case of zlib not coming from the system.
> (and the same for the other zlib deps, I guess)

Don't we already do that for all packages?  The failing command Volker posted already had `-L/var/lib/buildbot/slave/sage_git/build/local/lib` as well as `-lz`.



---

archive/issue_comments_404242.json:
```json
{
    "body": "could it be the order of libs issue?\n\nOr something to do with libpng using to carry its own zlib...",
    "created_at": "2020-01-22T12:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404242",
    "user": "https://github.com/dimpase"
}
```

could it be the order of libs issue?

Or something to do with libpng using to carry its own zlib...



---

archive/issue_comments_404243.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404243",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_404244.json:
```json
{
    "body": "See also: #23519 - SAGE_FAT_BINARY fails on Debian 9 64-bit",
    "created_at": "2020-05-13T21:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404244",
    "user": "https://github.com/mkoeppe"
}
```

See also: #23519 - SAGE_FAT_BINARY fails on Debian 9 64-bit



---

archive/issue_comments_404245.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-12T19:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404245",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_404246.json:
```json
{
    "body": "Replying to [comment:36 mkoeppe]:\n> New commits:\n> ...\n\nShould this be Needs Review now?",
    "created_at": "2020-09-13T12:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404246",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:36 mkoeppe]:
> New commits:
> ...

Should this be Needs Review now?



---

archive/issue_comments_404247.json:
```json
{
    "body": "I've removed the note about symmetrica from the description, since we took over maintenance and added an autotools build system.",
    "created_at": "2020-09-13T12:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404247",
    "user": "https://github.com/orlitzky"
}
```

I've removed the note about symmetrica from the description, since we took over maintenance and added an autotools build system.



---

archive/issue_comments_404248.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404248",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_404249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-04-09T05:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404250.json:
```json
{
    "body": "Dusted off this ticket. It will be helpful to reduce the size of wheels in #31396",
    "created_at": "2021-04-09T05:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404250",
    "user": "https://github.com/mkoeppe"
}
```

Dusted off this ticket. It will be helpful to reduce the size of wheels in #31396



---

archive/issue_comments_404251.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-09T05:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404251",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404252.json:
```json
{
    "body": "Tests running at https://github.com/mkoeppe/sage/actions/runs/732049335",
    "created_at": "2021-04-09T06:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404252",
    "user": "https://github.com/mkoeppe"
}
```

Tests running at https://github.com/mkoeppe/sage/actions/runs/732049335



---

archive/issue_comments_404253.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-09T17:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404253",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_404254.json:
```json
{
    "body": "A typo in the change to zlib broke lots of platforms",
    "created_at": "2021-04-09T17:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404254",
    "user": "https://github.com/mkoeppe"
}
```

A typo in the change to zlib broke lots of platforms



---

archive/issue_comments_404255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-09T17:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-09T17:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404257.json:
```json
{
    "body": "Now testing at https://github.com/mkoeppe/sage/actions/runs/733869032",
    "created_at": "2021-04-09T17:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404257",
    "user": "https://github.com/mkoeppe"
}
```

Now testing at https://github.com/mkoeppe/sage/actions/runs/733869032



---

archive/issue_comments_404258.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-09T17:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404258",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404259.json:
```json
{
    "body": "On OS X (with a bunch of homebrew packages), this prevents building of the following:\n\n```\nlibbraiding.a\nlibcdd.a\nlibcddgmp.a\nlibec.a\nlibecm.a\nlibfplll.a\nlibgf2x.a\nlibgivaro.a\nlibhomfly.a\nlibiml.a\nliblrcalc.a\nlibpari.a\nlibplanarity.a\nlibratpoints.a\nlibrw.a\nlibsymmetrica.a\n```\n\n`libecm.a` and `libratpoints.a` are still built, as it says in the ticket description.\n\nWe should probably build without as many homebrew packages, to make sure things still work.",
    "created_at": "2021-04-11T03:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404259",
    "user": "https://github.com/jhpalmieri"
}
```

On OS X (with a bunch of homebrew packages), this prevents building of the following:

```
libbraiding.a
libcdd.a
libcddgmp.a
libec.a
libecm.a
libfplll.a
libgf2x.a
libgivaro.a
libhomfly.a
libiml.a
liblrcalc.a
libpari.a
libplanarity.a
libratpoints.a
librw.a
libsymmetrica.a
```

`libecm.a` and `libratpoints.a` are still built, as it says in the ticket description.

We should probably build without as many homebrew packages, to make sure things still work.



---

archive/issue_comments_404260.json:
```json
{
    "body": "With `./configure --with-system-python3=no --with-system-ntl=no --with-system-gmp=no`, I see `libgmp.a`, `libgmpxx.a`, and `libntl.a` still present. I think this is still consistent with the ticket description.",
    "created_at": "2021-04-11T06:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404260",
    "user": "https://github.com/jhpalmieri"
}
```

With `./configure --with-system-python3=no --with-system-ntl=no --with-system-gmp=no`, I see `libgmp.a`, `libgmpxx.a`, and `libntl.a` still present. I think this is still consistent with the ticket description.



---

archive/issue_comments_404261.json:
```json
{
    "body": "The runs at https://github.com/mkoeppe/sage/actions/runs/733869032 (linux/macos), https://github.com/mkoeppe/sage/actions/runs/732049334 (optional packages), were also successful.\n\nOn `cygwin-standard` (https://github.com/mkoeppe/sage/runs/2309214385), there is an issue with the standard package `libbraiding` - for which building shared libraries is broken (#30814)",
    "created_at": "2021-04-11T16:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404261",
    "user": "https://github.com/mkoeppe"
}
```

The runs at https://github.com/mkoeppe/sage/actions/runs/733869032 (linux/macos), https://github.com/mkoeppe/sage/actions/runs/732049334 (optional packages), were also successful.

On `cygwin-standard` (https://github.com/mkoeppe/sage/runs/2309214385), there is an issue with the standard package `libbraiding` - for which building shared libraries is broken (#30814)



---

archive/issue_comments_404262.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-11T16:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404262",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_404263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-11T16:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404264.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-11T16:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404264",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404265.json:
```json
{
    "body": "New test on cygwin at https://github.com/mkoeppe/sage/actions/runs/738661838",
    "created_at": "2021-04-11T17:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404265",
    "user": "https://github.com/mkoeppe"
}
```

New test on cygwin at https://github.com/mkoeppe/sage/actions/runs/738661838



---

archive/issue_comments_404266.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-11T17:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404267.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-21T20:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404267",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404268.json:
```json
{
    "body": "I'm not sure why I can't view the branch attached to this ticket, but it merges cleanly with Sage 9.3. I think we should add this to an early beta of 9.4 (or 9.5 if 9.4 is a bug-fix release) to make sure it gets tested thoroughly.",
    "created_at": "2021-05-21T20:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404268",
    "user": "https://github.com/jhpalmieri"
}
```

I'm not sure why I can't view the branch attached to this ticket, but it merges cleanly with Sage 9.3. I think we should add this to an early beta of 9.4 (or 9.5 if 9.4 is a bug-fix release) to make sure it gets tested thoroughly.



---

archive/issue_comments_404269.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-05-21T20:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404269",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_026511.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-06-06T13:19:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28653#event-26511"
}
```



---

archive/issue_comments_404270.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-06T13:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28653#issuecomment-404270",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
