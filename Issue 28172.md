# Issue 28172: Flint configure fails when using system GMP in certain cases

Issue created by migration from https://trac.sagemath.org/ticket/28409

Original creator: embray

Original creation time: 2019-08-26 21:55:59

CC:  dimpase slelievre wbhart zerline

Keywords: flint

The hand-written configure script for flint has a clause like this:


```
if [ -d "${GMP_DIR}/lib" ]; then
   GMP_LIB_DIR="${GMP_DIR}/lib"
   GMP_INC_DIR="${GMP_DIR}/include"
elif [ -d "${GMP_DIR}/lib64" ]; then
   GMP_LIB_DIR="${GMP_DIR}/lib64"
   GMP_INC_DIR="${GMP_DIR}/include"
elif [ -d "${GMP_DIR}/.libs" ]; then
   GMP_LIB_DIR="${GMP_DIR}/.libs"
   GMP_INC_DIR="${GMP_DIR}"
else
   echo "Invalid GMP directory"
   exit 1
fi
```


By default, if `--with-gmp` is not given, it just arbitrarily defaults to `GMP_DIR=/usr/local`.  This means that if none of the directories `/usr/local/lib`, `/usr/local/lib64`, or `/usr/local/.libs` exist (note: this has nothing directly to do with detecting GMP), the script will exit with an error code.

It does something similar with MPFR and NTL.

I don't have a strong opinion on how to deal with this.  We could either patch it out.  Or we could point it to a directory that does exist (e.g. `$SAGE_LOCAL/lib`, even if GMP is not actually installed there).  Or write some more sophisticated detection code for GMP, though I feel that such efforts are often overkill: The way autoconf works w.r.t. system packages is if the headers and libraries are in the default paths searched by the compiler/linker then it shouldn't be necessary to provide additional flags. 

In other words, flint's configure, without an explicit `--with-gmp`, shouldn't and needn't do _anything_ to try to provide an otherwise bogus path for GMP...


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-03-20 03:07:23

Possible dup: #27708


---

Comment by mkoeppe created at 2020-03-20 03:12:11

Proposing to close this one as a duplicate


---

Comment by mkoeppe created at 2020-03-20 03:12:11

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-03-20 03:47:30

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-03-31 18:04:16

Resolution: duplicate
