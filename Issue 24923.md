# Issue 24923: Do not mangle Python stack traces in sphinx-build

Issue created by migration from https://trac.sagemath.org/ticket/25160

Original creator: saraedum

Original creation time: 2018-04-13 11:49:21

CC:  infinity0

This upstreams part of Debian's `u2-better-sphinx-failure-modes.patch` by Ximin Luo: we should not `.strip()` the lines that come out of Sphinx because this breaks indent in stack traces. Instead we should only `rstrip()` to remove the trailing newline.

After this one line change, I also wanted to make this doctestable, so I had to remove the global variable (which at least to me feels like a hack anyway.)

Finally, I added a copyright header sourced from the git log.


---

Comment by saraedum created at 2018-04-13 11:58:37

Changing status from new to needs_review.


---

Comment by saraedum created at 2018-04-13 11:58:37

New commits:


---

Comment by git created at 2018-04-13 18:52:00

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2018-04-13 18:52:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-04-13 18:58:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-13 20:56:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-14 00:47:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-04-16 08:39:08

I think it would be better to write `if self._error is not None` instead of `if self._error`


---

Comment by git created at 2018-04-21 19:02:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-21 19:02:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-04-23 13:34:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-19 15:56:37

Resolution: fixed


---

Comment by jdemeyer created at 2019-01-17 22:13:45

Breakage at #27073.


---

Comment by jdemeyer created at 2019-01-18 13:18:30

NOTE: doctests ignore whitespace, so this test doesn't actually test the indentation anyway.
