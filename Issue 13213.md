# Issue 13213: Remove TLS/SSL-related packages

archive/issues_013213.json:
```json
{
    "body": "Assignee: tbd\n\nSee [this sage-devel post by William](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/54802/).\n\n## Task\n\nRemove the following SPKGs:\n\n* python_gnutls\n* gnutls\n* opencdk\n* libgcrypt\n* libgpg_error\n\nAlso:\n\n* no longer ship pyOpenSSL with sagenb (this will be taken care of in #13121)\n* no longer require OpenSSL dev headers in prereq\n\n## Rationale\n\nRead the above linked thread, but basically, `notebook(secure=True)` is rarely used, and is not even really that desirable to use, except for people setting up multiuser Sage servers, which is a small percentage of Sage users. Therefore we will require users who want to use `notebook(secure=True)` to perform the additional step of installing pyOpenSSL into Sage's Python. This allows us to get rid of our sort of problematic dependencies on OpenSSL.\n\nFurthermore, as I understand it, our switching to OpenSSL had already made GNUTLS useless in Sage when we started shipping the Flask notebook (Sage 5.2), so we can get rid of GNUTLS and related SPKGs at the same time.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13385\n\n",
    "created_at": "2012-08-21T07:03:26Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Remove TLS/SSL-related packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13213",
    "user": "@kini"
}
```
Assignee: tbd

See [this sage-devel post by William](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/54802/).

## Task

Remove the following SPKGs:

* python_gnutls
* gnutls
* opencdk
* libgcrypt
* libgpg_error

Also:

* no longer ship pyOpenSSL with sagenb (this will be taken care of in #13121)
* no longer require OpenSSL dev headers in prereq

## Rationale

Read the above linked thread, but basically, `notebook(secure=True)` is rarely used, and is not even really that desirable to use, except for people setting up multiuser Sage servers, which is a small percentage of Sage users. Therefore we will require users who want to use `notebook(secure=True)` to perform the additional step of installing pyOpenSSL into Sage's Python. This allows us to get rid of our sort of problematic dependencies on OpenSSL.

Furthermore, as I understand it, our switching to OpenSSL had already made GNUTLS useless in Sage when we started shipping the Flask notebook (Sage 5.2), so we can get rid of GNUTLS and related SPKGs at the same time.

Issue created by migration from https://trac.sagemath.org/ticket/13385





---

archive/issue_comments_161593.json:
```json
{
    "body": "It would be nice to have a clear description of what someone has to do to make `secure=True` work and if someone has not done it - there should be a clear error message directing to these instructions...",
    "created_at": "2012-08-21T13:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161593",
    "user": "@novoselt"
}
```

It would be nice to have a clear description of what someone has to do to make `secure=True` work and if someone has not done it - there should be a clear error message directing to these instructions...



---

archive/issue_comments_161594.json:
```json
{
    "body": "It also would be a bit annoying to perform some extra installation on every newly built version of Sage. Is it possible to have instead some system dependencies and an environment variable that will force Sage to add pyOpenSSL automatically during build?",
    "created_at": "2012-08-21T13:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161594",
    "user": "@novoselt"
}
```

It also would be a bit annoying to perform some extra installation on every newly built version of Sage. Is it possible to have instead some system dependencies and an environment variable that will force Sage to add pyOpenSSL automatically during build?



---

archive/issue_comments_161595.json:
```json
{
    "body": "You can just install the SPKG from #11384 after building Sage. Is that sufficient?",
    "created_at": "2012-08-21T13:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161595",
    "user": "@kini"
}
```

You can just install the SPKG from #11384 after building Sage. Is that sufficient?



---

archive/issue_comments_161596.json:
```json
{
    "body": "Sorry, I mean #13384. Also you'd need to have OpenSSL and its dev headers installed on the system if you wanted to use `notebook(secure=True)`.",
    "created_at": "2012-08-21T13:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161596",
    "user": "@kini"
}
```

Sorry, I mean #13384. Also you'd need to have OpenSSL and its dev headers installed on the system if you wanted to use `notebook(secure=True)`.



---

archive/issue_comments_161597.json:
```json
{
    "body": "Replying to [comment:3 kini]:\n> You can just install the SPKG from #11384 after building Sage. Is that sufficient?\n\nSo far\n\n```\nsage -i openssl\n```\n\nwas sufficient (in 5.2 and later), but if this could be done automatically during build, it would be awesome.",
    "created_at": "2012-08-21T13:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161597",
    "user": "@novoselt"
}
```

Replying to [comment:3 kini]:
> You can just install the SPKG from #11384 after building Sage. Is that sufficient?

So far

```
sage -i openssl
```

was sufficient (in 5.2 and later), but if this could be done automatically during build, it would be awesome.



---

archive/issue_comments_161598.json:
```json
{
    "body": "Personally I don't think it's worth adding another environment variable to the long list we already have, just to avoid a small percentage of users having to run `sage -i openssl` and `sage -i pyopenssl` after `make`. Furthermore this will set a new precedent. Currently we have no environment variables which control whether a certain package is installed or not, except `SAGE_INSTALL_GCC` which is kind of a special case because we use GCC in Sage regardless of whether it's installed via SPKG or used from the system. Also, no environment variable causes the Sage build process to need network connectivity, as this suggestion would (unless you also want to make pyOpenSSL a standard shipped package).\n\nIMHO installing an SPKG is not a big deal, it's one line and the average user doesn't need to know about it because they are not running a multi-user notebook server.",
    "created_at": "2012-08-21T13:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161598",
    "user": "@kini"
}
```

Personally I don't think it's worth adding another environment variable to the long list we already have, just to avoid a small percentage of users having to run `sage -i openssl` and `sage -i pyopenssl` after `make`. Furthermore this will set a new precedent. Currently we have no environment variables which control whether a certain package is installed or not, except `SAGE_INSTALL_GCC` which is kind of a special case because we use GCC in Sage regardless of whether it's installed via SPKG or used from the system. Also, no environment variable causes the Sage build process to need network connectivity, as this suggestion would (unless you also want to make pyOpenSSL a standard shipped package).

IMHO installing an SPKG is not a big deal, it's one line and the average user doesn't need to know about it because they are not running a multi-user notebook server.



---

archive/issue_comments_161599.json:
```json
{
    "body": "Please no new environment variables. We could have an extra makefile target \n\n```\nssl: all\n    ./sage -i openssl\n    ./sage -i pyOpenSSL\n```\n",
    "created_at": "2012-08-21T14:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161599",
    "user": "@vbraun"
}
```

Please no new environment variables. We could have an extra makefile target 

```
ssl: all
    ./sage -i openssl
    ./sage -i pyOpenSSL
```




---

archive/issue_comments_161600.json:
```json
{
    "body": "So what needs doing here?\n\nRoot repo:\n- remove the spkgs, modify `deps` and `spkg/install` accordingly\n- modify prereq so it no longer checks for openssl (i.e., undo some of the changes at #13329)\n- in README.txt, document what needs to be done to use the secure notebook\n- possibly add a new target to the Makefile\n\nSage library:\n- in the installation guide, document what needs to be done to use the secure notebook\n\nSagenb:\n- make it work without openssl\n\nAnything else?",
    "created_at": "2012-08-21T15:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161600",
    "user": "@jhpalmieri"
}
```

So what needs doing here?

Root repo:
- remove the spkgs, modify `deps` and `spkg/install` accordingly
- modify prereq so it no longer checks for openssl (i.e., undo some of the changes at #13329)
- in README.txt, document what needs to be done to use the secure notebook
- possibly add a new target to the Makefile

Sage library:
- in the installation guide, document what needs to be done to use the secure notebook

Sagenb:
- make it work without openssl

Anything else?



---

archive/issue_comments_161601.json:
```json
{
    "body": "In the sage library there is some code that does something with GNUTLS. It appears to be legacy code in devel/sage/sage/server/notebook . So I guess one more task is to see if anything breaks after removing the SPKGs.",
    "created_at": "2012-08-21T15:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161601",
    "user": "@kini"
}
```

In the sage library there is some code that does something with GNUTLS. It appears to be legacy code in devel/sage/sage/server/notebook . So I guess one more task is to see if anything breaks after removing the SPKGs.



---

archive/issue_comments_161602.json:
```json
{
    "body": "(That includes upgrading extremely old notebook data, I guess.)",
    "created_at": "2012-08-21T16:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161602",
    "user": "@kini"
}
```

(That includes upgrading extremely old notebook data, I guess.)



---

archive/issue_comments_161603.json:
```json
{
    "body": "Here's a patch for the root repo. Did I miss anything in `deps` or `install`?",
    "created_at": "2012-08-21T16:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161603",
    "user": "@kini"
}
```

Here's a patch for the root repo. Did I miss anything in `deps` or `install`?



---

archive/issue_comments_161604.json:
```json
{
    "body": "The changes look okay at first glance. I'll try a build (on a system with openssl headers) to see how it goes. Perhaps you should mention `make ssl` in your changes to README.txt? And add a comment to the Makefile briefly describing the purpose of that target?",
    "created_at": "2012-08-21T18:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161604",
    "user": "@jhpalmieri"
}
```

The changes look okay at first glance. I'll try a build (on a system with openssl headers) to see how it goes. Perhaps you should mention `make ssl` in your changes to README.txt? And add a comment to the Makefile briefly describing the purpose of that target?



---

archive/issue_comments_161605.json:
```json
{
    "body": "Oh, and in `README.txt` and `Makefile`, you should point out that `sage -i openssl`, `make ssl`, etc., require internet access.",
    "created_at": "2012-08-21T21:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161605",
    "user": "@jhpalmieri"
}
```

Oh, and in `README.txt` and `Makefile`, you should point out that `sage -i openssl`, `make ssl`, etc., require internet access.



---

archive/issue_comments_161606.json:
```json
{
    "body": "When I built with the root repo patch, all tests passed, because the old notebook directory has a file `nodoctest.py`. The appropriate files (like `server/notebook/gnutls_socket_ssl.py`) say things like\n\n```\n# This file is part of the OLD Sage notebook and is NOT actively developed,\n# maintained, or supported.  As of Sage v4.1.2, all notebook development has\n# moved to the separate Sage Notebook project\n```\n\nat the top, so I think it's okay to completely break this by removing gnutls.",
    "created_at": "2012-08-22T01:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161606",
    "user": "@jhpalmieri"
}
```

When I built with the root repo patch, all tests passed, because the old notebook directory has a file `nodoctest.py`. The appropriate files (like `server/notebook/gnutls_socket_ssl.py`) say things like

```
# This file is part of the OLD Sage notebook and is NOT actively developed,
# maintained, or supported.  As of Sage v4.1.2, all notebook development has
# moved to the separate Sage Notebook project
```

at the top, so I think it's okay to completely break this by removing gnutls.



---

archive/issue_comments_161607.json:
```json
{
    "body": "Attachment [trac_13385-sage-library.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-sage-library.patch) by @jhpalmieri created at 2012-08-22 01:53:46",
    "created_at": "2012-08-22T01:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161607",
    "user": "@jhpalmieri"
}
```

Attachment [trac_13385-sage-library.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-sage-library.patch) by @jhpalmieri created at 2012-08-22 01:53:46



---

archive/issue_comments_161608.json:
```json
{
    "body": "Here are some documentation patches, one for the root repo, one for the Sage library.",
    "created_at": "2012-08-22T01:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161608",
    "user": "@jhpalmieri"
}
```

Here are some documentation patches, one for the root repo, one for the Sage library.



---

archive/issue_comments_161609.json:
```json
{
    "body": "Here's a patch for the prereq tarball, and here's a new [prereq tarball](http://sage.math.washington.edu/home/palmieri/SPKG/prereq-1.1.tar.gz).",
    "created_at": "2012-08-22T03:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161609",
    "user": "@jhpalmieri"
}
```

Here's a patch for the prereq tarball, and here's a new [prereq tarball](http://sage.math.washington.edu/home/palmieri/SPKG/prereq-1.1.tar.gz).



---

archive/issue_comments_161610.json:
```json
{
    "body": "Attachment [trac_13385-prereq.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-prereq.patch) by @jhpalmieri created at 2012-08-22 03:32:32\n\nfor prereq package; for review only",
    "created_at": "2012-08-22T03:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161610",
    "user": "@jhpalmieri"
}
```

Attachment [trac_13385-prereq.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-prereq.patch) by @jhpalmieri created at 2012-08-22 03:32:32

for prereq package; for review only



---

archive/issue_comments_161611.json:
```json
{
    "body": "Attachment [trac_13385-root-doc.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-root-doc.patch) by @kini created at 2012-08-22 05:19:47\n\napply to $SAGE_ROOT",
    "created_at": "2012-08-22T05:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161611",
    "user": "@kini"
}
```

Attachment [trac_13385-root-doc.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-root-doc.patch) by @kini created at 2012-08-22 05:19:47

apply to $SAGE_ROOT



---

archive/issue_comments_161612.json:
```json
{
    "body": "Updated the root patches to account for the decapitalization of the pyOpenSSL SPKG name (see comments on #13384).",
    "created_at": "2012-08-22T05:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161612",
    "user": "@kini"
}
```

Updated the root patches to account for the decapitalization of the pyOpenSSL SPKG name (see comments on #13384).



---

archive/issue_comments_161613.json:
```json
{
    "body": "sagenb fix is at https://github.com/sagemath/sagenb/pull/95 if someone wants to review it.",
    "created_at": "2012-08-22T07:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161613",
    "user": "@kini"
}
```

sagenb fix is at https://github.com/sagemath/sagenb/pull/95 if someone wants to review it.



---

archive/issue_comments_161614.json:
```json
{
    "body": "Looking at sagenb's README.rst, I notice that besides HTTPS notebook login, OpenSSL is also used by OpenID authentication, this time through Python's bundled ssl module rather than through pyOpenSSL.\n\nThis means that if a user wanted to use OpenID authentication on their server, they'd have to install OpenSSL dev headers on their system (or install the optional openssl SPKG) and then rebuild Python, which is a bit involved. This should also be included in the \"ssl\" makefile target, I guess. Preferably the \"ssl\" makefile target shouldn't build Python twice.",
    "created_at": "2012-08-23T01:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161614",
    "user": "@kini"
}
```

Looking at sagenb's README.rst, I notice that besides HTTPS notebook login, OpenSSL is also used by OpenID authentication, this time through Python's bundled ssl module rather than through pyOpenSSL.

This means that if a user wanted to use OpenID authentication on their server, they'd have to install OpenSSL dev headers on their system (or install the optional openssl SPKG) and then rebuild Python, which is a bit involved. This should also be included in the "ssl" makefile target, I guess. Preferably the "ssl" makefile target shouldn't build Python twice.



---

archive/issue_comments_161615.json:
```json
{
    "body": "So the \"ssl\" target should install openssl, then build Sage, then install pyopenssl. Fortunately, the openssl spkg has very few requirements: patch should be enough, I think (and patch is necessary on Solaris, at least: the system's patch is brain-dead).\n\nSo if the ssl makefile target should include openssl, perhaps it should run a script to download the spkg and then maybe modify spkg/standard/deps, adding openssl in the appropriate place (after patch). Or maybe, given the change at #13373, you could add three (?) new targets:\n\n- \"patch\", which does `./sage -i patch`\n- \"openssl\", which has patch as a prerequisite and does `./sage -i openssl`\n- \"sslbuild\", which has openssl as a prerequisite and just builds Sage.\n\nThen \"ssl\" would have \"sslbuild\" as a dependency and would do `./sage -i pyopenssl`. This all seems kind of clunky, especially since we should only install openssl if necessary.\n\nOther ideas: \n- force the user to read README.txt and install openssl manually (`./sage -i patch; ./sage -i openssl`), and then `make ssl` will take care of everything else, by building Sage and installing pyopenssl.\n- include a script to check whether openssl is present, and run it as part of `make ssl`. If openssl is not present, exit and tell the user to install it.\n\n(Wouldn't it be nice if Sage used configure? Then the user could do `./configure --ssl=True; make` and the script would figure out whether openssl was necessary, and also install pyopenssl at the end.)",
    "created_at": "2012-08-23T02:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161615",
    "user": "@jhpalmieri"
}
```

So the "ssl" target should install openssl, then build Sage, then install pyopenssl. Fortunately, the openssl spkg has very few requirements: patch should be enough, I think (and patch is necessary on Solaris, at least: the system's patch is brain-dead).

So if the ssl makefile target should include openssl, perhaps it should run a script to download the spkg and then maybe modify spkg/standard/deps, adding openssl in the appropriate place (after patch). Or maybe, given the change at #13373, you could add three (?) new targets:

- "patch", which does `./sage -i patch`
- "openssl", which has patch as a prerequisite and does `./sage -i openssl`
- "sslbuild", which has openssl as a prerequisite and just builds Sage.

Then "ssl" would have "sslbuild" as a dependency and would do `./sage -i pyopenssl`. This all seems kind of clunky, especially since we should only install openssl if necessary.

Other ideas: 
- force the user to read README.txt and install openssl manually (`./sage -i patch; ./sage -i openssl`), and then `make ssl` will take care of everything else, by building Sage and installing pyopenssl.
- include a script to check whether openssl is present, and run it as part of `make ssl`. If openssl is not present, exit and tell the user to install it.

(Wouldn't it be nice if Sage used configure? Then the user could do `./configure --ssl=True; make` and the script would figure out whether openssl was necessary, and also install pyopenssl at the end.)



---

archive/issue_comments_161616.json:
```json
{
    "body": "Another complication is that `make ssl` (or whatever it's called) *should* rebuild Python if it has already been built but without an ssl module.\n\nI'm inclined to just make the user do this stuff and detail what needs to be done in the README. I'm also a bit wary of automating the installation of OpenSSL because that seems dangerously close to \"bundling\" it (though IANAL of course).",
    "created_at": "2012-08-23T02:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161616",
    "user": "@kini"
}
```

Another complication is that `make ssl` (or whatever it's called) *should* rebuild Python if it has already been built but without an ssl module.

I'm inclined to just make the user do this stuff and detail what needs to be done in the README. I'm also a bit wary of automating the installation of OpenSSL because that seems dangerously close to "bundling" it (though IANAL of course).



---

archive/issue_comments_161617.json:
```json
{
    "body": "Note the variable `SAGE_UPGRADING`. You should be able to rebuild Python (./sage -f python), and set this variable to \"yes\" and rebuild Python's dependencies by doing `make build` (is the syntax `SAGE_UPGRADING=yes make build`?). This will take a while, of course.\n\nBy they way, how should users tell if they have openssl installed? Can we put some helpful information about this in the documentation?",
    "created_at": "2012-08-23T03:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161617",
    "user": "@jhpalmieri"
}
```

Note the variable `SAGE_UPGRADING`. You should be able to rebuild Python (./sage -f python), and set this variable to "yes" and rebuild Python's dependencies by doing `make build` (is the syntax `SAGE_UPGRADING=yes make build`?). This will take a while, of course.

By they way, how should users tell if they have openssl installed? Can we put some helpful information about this in the documentation?



---

archive/issue_comments_161618.json:
```json
{
    "body": "Here's some documentation for README.txt (the \"v2\" patch). If it's okay, we can add something similar to the installation guide.",
    "created_at": "2012-08-23T03:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161618",
    "user": "@jhpalmieri"
}
```

Here's some documentation for README.txt (the "v2" patch). If it's okay, we can add something similar to the installation guide.



---

archive/issue_comments_161619.json:
```json
{
    "body": "Attachment [trac_13385-prereq.2.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-prereq.2.patch) by @jhpalmieri created at 2012-08-23 05:18:33\n\nfor prereq package; for review only",
    "created_at": "2012-08-23T05:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161619",
    "user": "@jhpalmieri"
}
```

Attachment [trac_13385-prereq.2.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-prereq.2.patch) by @jhpalmieri created at 2012-08-23 05:18:33

for prereq package; for review only



---

archive/issue_comments_161620.json:
```json
{
    "body": "Yup, that looks fine to me!",
    "created_at": "2012-08-23T05:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161620",
    "user": "@kini"
}
```

Yup, that looks fine to me!



---

archive/issue_comments_161621.json:
```json
{
    "body": "It seems to me that \"remove GNUTLS-related packages\" and \"make sagenb work without OpenSSL\" are two independent things.  So I think we should have two tickets, unless there is a good reason to connect these two issues.",
    "created_at": "2012-08-23T13:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161621",
    "user": "@jdemeyer"
}
```

It seems to me that "remove GNUTLS-related packages" and "make sagenb work without OpenSSL" are two independent things.  So I think we should have two tickets, unless there is a good reason to connect these two issues.



---

archive/issue_comments_161622.json:
```json
{
    "body": "Just FYI, the following is supported:\n\n```\n./sage -i openssl pyopenssl\n```\n",
    "created_at": "2012-08-23T13:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161622",
    "user": "@jdemeyer"
}
```

Just FYI, the following is supported:

```
./sage -i openssl pyopenssl
```




---

archive/issue_comments_161623.json:
```json
{
    "body": "New documentation for the Sage library.",
    "created_at": "2012-08-23T15:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161623",
    "user": "@jhpalmieri"
}
```

New documentation for the Sage library.



---

archive/issue_comments_161624.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-08-23T15:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161624",
    "user": "@jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_161625.json:
```json
{
    "body": "Attachment [trac_13385-sage-library.v2.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-sage-library.v2.patch) by @jhpalmieri created at 2012-08-23 15:13:00",
    "created_at": "2012-08-23T15:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161625",
    "user": "@jhpalmieri"
}
```

Attachment [trac_13385-sage-library.v2.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-sage-library.v2.patch) by @jhpalmieri created at 2012-08-23 15:13:00



---

archive/issue_comments_161626.json:
```json
{
    "body": "Update on what's left to do: I need to build Sage and test sagenb on it in an environment where SSL doesn't exist at all, on the system or in the Sage directory (because the ssl module, on which OpenID support relies, is built or not built based on whether the system has OpenSSL dev headers, and is different from the OpenSSL module, which is provided or not provided by pyOpenSSL being installed or not installed).\n\nDepending on what happens, I might need to add a bit more to [the pull request](https://github.com/sagemath/sagenb/pull/95). Once the pull request is merged, I'll cut a 0.10.2 and put it up on #13121.",
    "created_at": "2012-08-24T06:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161626",
    "user": "@kini"
}
```

Update on what's left to do: I need to build Sage and test sagenb on it in an environment where SSL doesn't exist at all, on the system or in the Sage directory (because the ssl module, on which OpenID support relies, is built or not built based on whether the system has OpenSSL dev headers, and is different from the OpenSSL module, which is provided or not provided by pyOpenSSL being installed or not installed).

Depending on what happens, I might need to add a bit more to [the pull request](https://github.com/sagemath/sagenb/pull/95). Once the pull request is merged, I'll cut a 0.10.2 and put it up on #13121.



---

archive/issue_comments_161627.json:
```json
{
    "body": "I am reading the documentation and from what I understand of it, shouldn't this line be part of the ssl section of the `Makefile`?\n\n```\n./sage -f python # after ./sage -i openssl\n```\n\n\nThen the documentation can be simplified to:\n\n```\n1. If you don't have OpenSSL development headers installed, then run\nmake ssl\nto get a local copy of OpenSSL and pyOpenSSL within your Sage installation.\n\n2. If you have OpenSSL development headers installed, but pyOpenSSL is not installed,\nthen you can run\n./sage -i pyopenssl\nto install it.\n```\n",
    "created_at": "2012-08-24T07:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161627",
    "user": "@ppurka"
}
```

I am reading the documentation and from what I understand of it, shouldn't this line be part of the ssl section of the `Makefile`?

```
./sage -f python # after ./sage -i openssl
```


Then the documentation can be simplified to:

```
1. If you don't have OpenSSL development headers installed, then run
make ssl
to get a local copy of OpenSSL and pyOpenSSL within your Sage installation.

2. If you have OpenSSL development headers installed, but pyOpenSSL is not installed,
then you can run
./sage -i pyopenssl
to install it.
```




---

archive/issue_comments_161628.json:
```json
{
    "body": "AFAIK It's generally considered bad form to write make targets that are not idempotent or close to idempotent. Also you forgot the part about `SAGE_UPGRADING`, if I understand correctly. Finally, as I said earlier, maybe it's not such a great idea to even have OpenSSL pulled into a make target as that seems dangerously close to \"bundling OpenSSL with GPL software\". I like the way the patches are right now.",
    "created_at": "2012-08-24T07:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161628",
    "user": "@kini"
}
```

AFAIK It's generally considered bad form to write make targets that are not idempotent or close to idempotent. Also you forgot the part about `SAGE_UPGRADING`, if I understand correctly. Finally, as I said earlier, maybe it's not such a great idea to even have OpenSSL pulled into a make target as that seems dangerously close to "bundling OpenSSL with GPL software". I like the way the patches are right now.



---

archive/issue_comments_161629.json:
```json
{
    "body": "The license issue is that Sage hosts the openssl spkg, not whether or not there is a make target. I can see three options here:\n* get rid of the openssl spkg.\n* add a openssl license exception to the notebook.\n* modify the openssl spkg to only install if the openssl library is installed on the system.\nWhile quirky, the last option might be the easiest way out. Gnome links to openssl, so unless you really know what you are doing the openssl library is installed. The problem for Sage is that the development headers are generally not installed in a end-user setup. So as long as we intend the openssl spkg to simply be a way to get the devel headers without administrative privileges then we could still claim the system library exception.",
    "created_at": "2012-08-24T10:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161629",
    "user": "@vbraun"
}
```

The license issue is that Sage hosts the openssl spkg, not whether or not there is a make target. I can see three options here:
* get rid of the openssl spkg.
* add a openssl license exception to the notebook.
* modify the openssl spkg to only install if the openssl library is installed on the system.
While quirky, the last option might be the easiest way out. Gnome links to openssl, so unless you really know what you are doing the openssl library is installed. The problem for Sage is that the development headers are generally not installed in a end-user setup. So as long as we intend the openssl spkg to simply be a way to get the devel headers without administrative privileges then we could still claim the system library exception.



---

archive/issue_comments_161630.json:
```json
{
    "body": "About OpenID sans ssl module: looks like it just silently breaks, i.e. clicking on certain providers in the OpenID login box just... doesn't do anything. On the other hand it's pretty clearly marked in the options that turning on OpenID requires the ssl module to be available in Python, so a little detail about this in the Sage and sagenb READMEs should be enough, IMO.\n\nVolker, does your third option involve gutting the upstream source and only shipping the header files, or can we also build and install the actual libraries if OpenSSL exists on the system? If the latter, then even if OpenSSL doesn't exist on the system, aren't we, by hosting the SPKG, still \"distributing OpenSSL\", since the user could just untar the SPKG and run `make && sudo make install` in the src directory?",
    "created_at": "2012-08-25T09:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161630",
    "user": "@kini"
}
```

About OpenID sans ssl module: looks like it just silently breaks, i.e. clicking on certain providers in the OpenID login box just... doesn't do anything. On the other hand it's pretty clearly marked in the options that turning on OpenID requires the ssl module to be available in Python, so a little detail about this in the Sage and sagenb READMEs should be enough, IMO.

Volker, does your third option involve gutting the upstream source and only shipping the header files, or can we also build and install the actual libraries if OpenSSL exists on the system? If the latter, then even if OpenSSL doesn't exist on the system, aren't we, by hosting the SPKG, still "distributing OpenSSL", since the user could just untar the SPKG and run `make && sudo make install` in the src directory?



---

archive/issue_comments_161631.json:
```json
{
    "body": "Replying to [comment:38 kini]:\n> even if OpenSSL doesn't exist on the system, aren't we, by hosting the SPKG, still \"distributing OpenSSL\", since the user could just untar the SPKG and run `make && sudo make install` in the src directory?\nIt could be that we're violating the GPL, yes.  But it's not really clear to me, who knows?\n\nI do think that adding the `ssl` make target doesn't change much, since it just automates something which is already possible anyway.",
    "created_at": "2012-08-27T07:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161631",
    "user": "@jdemeyer"
}
```

Replying to [comment:38 kini]:
> even if OpenSSL doesn't exist on the system, aren't we, by hosting the SPKG, still "distributing OpenSSL", since the user could just untar the SPKG and run `make && sudo make install` in the src directory?
It could be that we're violating the GPL, yes.  But it's not really clear to me, who knows?

I do think that adding the `ssl` make target doesn't change much, since it just automates something which is already possible anyway.



---

archive/issue_comments_161632.json:
```json
{
    "body": "Well, packaging OpenSSL directly into the Sage tarball just automates something which is already possible anyway, too (downloading OpenSSL sources and compiling/installing it into $SAGE_LOCAL).",
    "created_at": "2012-08-27T07:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161632",
    "user": "@kini"
}
```

Well, packaging OpenSSL directly into the Sage tarball just automates something which is already possible anyway, too (downloading OpenSSL sources and compiling/installing it into $SAGE_LOCAL).



---

archive/issue_comments_161633.json:
```json
{
    "body": "The new SPKG on #13121 is ready for review, and doesn't require OpenSSL or pyOpenSSL. If someone could also review the optional pyOpenSSL SPKG at #13384, that would great.",
    "created_at": "2012-09-02T07:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161633",
    "user": "@kini"
}
```

The new SPKG on #13121 is ready for review, and doesn't require OpenSSL or pyOpenSSL. If someone could also review the optional pyOpenSSL SPKG at #13384, that would great.



---

archive/issue_comments_161634.json:
```json
{
    "body": "Re [comment:34 the above comment]: is this ready to go? I'm happy with your changes, for what that's worth.\n\nRe the licensing issues: this ticket doesn't make things worse, does it? It seems like it should actually improve them, since OpenSSL will no longer be required to build Sage. So I don't think these issues should hold up this ticket. The license discussion should continue on sage-devel.",
    "created_at": "2012-09-02T16:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161634",
    "user": "@jhpalmieri"
}
```

Re [comment:34 the above comment]: is this ready to go? I'm happy with your changes, for what that's worth.

Re the licensing issues: this ticket doesn't make things worse, does it? It seems like it should actually improve them, since OpenSSL will no longer be required to build Sage. So I don't think these issues should hold up this ticket. The license discussion should continue on sage-devel.



---

archive/issue_comments_161635.json:
```json
{
    "body": "Re licensing: note by the way that running `make ssl` does not install OpenSSL, just pyOpenSSL.",
    "created_at": "2012-09-02T16:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161635",
    "user": "@jhpalmieri"
}
```

Re licensing: note by the way that running `make ssl` does not install OpenSSL, just pyOpenSSL.



---

archive/issue_comments_161636.json:
```json
{
    "body": "Yeah, I'm fine with what's on this ticket at the moment. Especially after you removed the line `./sage -i openssl` from the `ssl` make target.",
    "created_at": "2012-09-02T17:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161636",
    "user": "@kini"
}
```

Yeah, I'm fine with what's on this ticket at the moment. Especially after you removed the line `./sage -i openssl` from the `ssl` make target.



---

archive/issue_comments_161637.json:
```json
{
    "body": "apply to $SAGE_ROOT",
    "created_at": "2012-09-03T13:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161637",
    "user": "@jdemeyer"
}
```

apply to $SAGE_ROOT



---

archive/issue_comments_161638.json:
```json
{
    "body": "Attachment [trac_13385-root.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-root.patch) by @jdemeyer created at 2012-09-03 13:35:59\n\nMerged both `SAGE_ROOT` patches for easier reviewing.",
    "created_at": "2012-09-03T13:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161638",
    "user": "@jdemeyer"
}
```

Attachment [trac_13385-root.patch](tarball://root/attachments/some-uuid/ticket13385/trac_13385-root.patch) by @jdemeyer created at 2012-09-03 13:35:59

Merged both `SAGE_ROOT` patches for easier reviewing.



---

archive/issue_comments_161639.json:
```json
{
    "body": "Since John has already reviewed this, I find that pretty unnecessary. Note that you also merged two patches with different authors.",
    "created_at": "2012-09-03T13:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161639",
    "user": "@kini"
}
```

Since John has already reviewed this, I find that pretty unnecessary. Note that you also merged two patches with different authors.



---

archive/issue_comments_161640.json:
```json
{
    "body": "Replying to [comment:36 kini]:\n> AFAIK It's generally considered bad form to write make targets that are not idempotent or close to idempotent.\n\nI think that\n\n```\n./sage -i foo\n```\n\nis pretty-much idempotent, what's the concern?",
    "created_at": "2012-09-03T13:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161640",
    "user": "@jdemeyer"
}
```

Replying to [comment:36 kini]:
> AFAIK It's generally considered bad form to write make targets that are not idempotent or close to idempotent.

I think that

```
./sage -i foo
```

is pretty-much idempotent, what's the concern?



---

archive/issue_comments_161641.json:
```json
{
    "body": "I was referring to [comment:35 ppurka's comment] about putting `./sage -f python` in the makefile target.",
    "created_at": "2012-09-03T13:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161641",
    "user": "@kini"
}
```

I was referring to [comment:35 ppurka's comment] about putting `./sage -f python` in the makefile target.



---

archive/issue_comments_161642.json:
```json
{
    "body": "Replying to [comment:46 kini]:\n> Since John has already reviewed this, I find that pretty unnecessary.\nWell, I found it confusing to look at the second patch which almost replaced the first patch completely.  I was unaware that those patches were already reviewed.  What's left to review?",
    "created_at": "2012-09-03T13:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161642",
    "user": "@jdemeyer"
}
```

Replying to [comment:46 kini]:
> Since John has already reviewed this, I find that pretty unnecessary.
Well, I found it confusing to look at the second patch which almost replaced the first patch completely.  I was unaware that those patches were already reviewed.  What's left to review?



---

archive/issue_comments_161643.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-03T14:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161643",
    "user": "@kini"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_161644.json:
```json
{
    "body": "Nothing, afaik. John said he's happy with my changes, and I said I'm happy with his changes. I guess neither of us considered that sufficient to set it to positive review, but now that I say it, I guess I should have...",
    "created_at": "2012-09-03T14:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161644",
    "user": "@kini"
}
```

Nothing, afaik. John said he's happy with my changes, and I said I'm happy with his changes. I guess neither of us considered that sufficient to set it to positive review, but now that I say it, I guess I should have...



---

archive/issue_comments_161645.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-05T18:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13213#issuecomment-161645",
    "user": "@jdemeyer"
}
```

Resolution: fixed
