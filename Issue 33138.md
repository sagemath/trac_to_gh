# Issue 33138: make DOT_SAGE a pathlib.Path object

Issue created by migration from https://trac.sagemath.org/ticket/33375

Original creator: chapoton

Original creation time: 2022-02-18 19:11:09

This simplifies the code, no more "os.path.join" everywhere.


---

Comment by chapoton created at 2022-02-18 19:12:08

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-02-18 19:12:08

New commits:


---

Comment by mkoeppe created at 2022-02-18 19:17:15

-1; capitalized variables in `sage.env` are strings, not typed


---

Comment by chapoton created at 2022-02-18 19:26:09

By the word of god almighty ?


---

Comment by mkoeppe created at 2022-02-18 19:30:40

For uniformity?


---

Comment by mkoeppe created at 2022-02-18 19:33:26

Previous discussion in the same direction in #30855


---

Comment by git created at 2022-02-18 19:35:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-18 19:41:42

Specifically on `DOT_SAGE`, I think that providing a function `dot_sage` would be better. We should no longer operate in a model in which library code can assume that "startup code" has been run and created this directory.


---

Comment by mkoeppe created at 2022-02-18 19:44:04

Currently this directory is created at import-time in `src/sage/misc/misc.py` and also in `src/bin/sage`. This really needs to be cleaned up so that the Sage library becomes a more well-behaved Python library.


---

Comment by mkoeppe created at 2022-02-18 19:49:43

The function `dot_sage` could have the return type that you like and would create the directory if it does not exist yet.


---

Comment by mkoeppe created at 2022-02-18 23:22:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-02-19 10:07:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-19 12:28:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-19 16:16:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-02-19 19:08:39

huge +1, the changes show how advantageous and more readable it is to have path variables really as `Paths` instead of strings.


---

Comment by git created at 2022-02-20 07:43:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-20 13:22:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-02-20 13:30:33

hmm, qepcad is using "sys.stdout" as a logfile, which does not look quite right. I removed that possibility.

About the proposed function "dot_sage", where should it go ? I made a first sketch in misc/misc.py


---

Comment by git created at 2022-02-20 13:53:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-20 14:00:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-20 18:38:47

Note `sage_makedirs` is going away in #32987


---

Comment by mkoeppe created at 2022-02-20 18:44:54

Replying to [comment:17 chapoton]:
> About the proposed function "dot_sage", where should it go ? I made a first sketch in misc/misc.py

Best not to put more into `sage.misc.misc` - I'm in the process of removing environment bits from it (see for example #32986). I would suggest to just put it in a separate module `sage.misc.dot_sage`. For modularization context: #29941 puts things like this in a distribution *sagemath-environment* - which does not have any dependencies


---

Comment by git created at 2022-02-21 09:04:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-21 09:10:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-02-21 09:20:09

maybe the `dot_sage()` path should be cached in some way ? how ?


---

Comment by git created at 2022-02-21 11:05:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-21 12:05:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-21 13:33:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-21 13:42:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-21 14:00:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-21 19:35:48

Looking good but I'd say `DOT_SAGE` shouldn't just be removed from sage.env; user code may depend on it


---

Comment by git created at 2022-02-22 07:59:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-22 13:40:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-23 13:37:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-02-23 13:39:02

Doctests do pass, so back to needs review


---

Comment by chapoton created at 2022-02-23 13:39:02

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-02-23 17:27:17

Still comment:2, and moreover I think `sage.misc.dot_sage` should use `sage.env`, not the other way around. Note that `var` defined in `sage.env` not only gets values from environment variables but also from `sage_conf`.

I think we can change the location of `DOT_SAGE` on Cygwin to be unconditionally `/home/.sage` to disentangle it from the "space in directory name" warning.


---

Comment by git created at 2022-02-23 18:52:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-02-23 18:54:43

If "dot_sage" uses "DOT_SAGE" from "sage.env", then once again we are doing twice the job of deciding which folder to use as ".sage". The logic is rather unclear to me.


---

Comment by @tobiasdiez created at 2022-02-23 22:03:41

Shouldn't "DOT_SAGE" in `env` be deprecated, or at least have a comment explaining that `dot_sage` should be used whenever possible?

I'm also not sure if the misc package is the right place, since similar refactorings could (and should) be done for all path-variables in `env` so one would end-up with quite a few helper modules in `misc`.


---

Comment by mkoeppe created at 2022-02-23 22:13:16

Replying to [comment:38 gh-tobiasdiez]:
> similar refactorings could (and should) be done for all path-variables in `env`

Not really. Most of these paths are low-level information for which we already have a high-level interface in `sage.features`. For example `CONWAY_POLYNOMIALS_DATA_DIR` is exposed via `src/sage/features/databases.py`.


---

Comment by git created at 2022-02-28 15:11:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-04 09:24:11

please help me with comment:37


---

Comment by chapoton created at 2022-03-27 18:54:44

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-04-02 16:18:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-05-03 17:47:54

Resolution: invalid


---

Comment by chapoton created at 2022-05-03 17:47:54

dropping this one into firebin
