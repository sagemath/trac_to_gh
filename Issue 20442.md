# Issue 20442: matrix vector product for generic sparse matrices

Issue created by migration from Trac.

Original creator: orkolorko

Original creation time: 2016-05-25 14:00:45

Keywords: sparse, product

It seems like this simple cython code is faster 30% faster than the implemented matrix vector product for generic sparse matrices.
I run some tests with matrices with RIF coefficients and all seem to point in this direction.

%cython file
import cython

from sage.matrix.matrix_generic_sparse cimport *
from sage.modules.free_module_element cimport *

# this is a generic sparse_mat_vec, hoping to get some speedup from the fact that it is compiled
def cython_sparse_matvec(Matrix_generic_sparse P, FreeModuleElement_generic_dense v, FreeModuleElement_generic_dense w):

  for (ij, val) in P.dict().iteritems():
    w[ij[0]] += val*v[ij[1]]

def cython_sparse_vecmat(Matrix_generic_sparse P, FreeModuleElement_generic_dense v, FreeModuleElement_generic_dense w):

  for (ij, val) in P.dict().iteritems():
    w[ij[1]] += val*v[ij[0]]

%python module
def sparse_matvec(P,v):

  """Compute Sage sparse matrix * vector product.

  Apparently, M*v fills the matrix in Sage, so this should be quicker"""

  w = VectorSpace(P.base_ring(),P.nrows())(0)
  cython_sparse_matvec(P,v,w)
  return w


def sparse_vecmat(v,P):

  """Compute Sage sparse vector * matrix product.

  Apparently, v*M fills the matrix in Sage, so this should be quicker"""
  w = VectorSpace(P.base_ring(),P.ncols())(0)
  cython_sparse_vecmat(P,v,w)
  return w


---

Comment by tscrim created at 2017-10-24 02:34:51

This is how the matrix action on vectors is currently (8.1.beta9) implemented. So either this ticket description is out of date or the speedup is due to skipping safety checks. Without timings and an example, it is hard to determine. I propose to close since the proposal is functionally no change.


---

Comment by tscrim created at 2017-10-24 02:34:51

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-12-21 16:58:49

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2018-05-18 17:16:26

Resolution: wontfix


---

Comment by vdelecroix created at 2018-05-18 17:16:26

closing positively reviewed duplicates
