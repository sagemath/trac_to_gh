# Issue 17840: fix log2 help

Issue created by migration from https://trac.sagemath.org/ticket/18077

Original creator: rws

Original creation time: 2015-03-28 16:43:34

Other constants give more or less specific help but

```
sage: log2?

Type:           Expression
String form:    log2
Length:         0
File:           /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so
Docstring:
   Nearly all expressions are created by calling
   new_Expression_from_*, but we need to make sure this at least does
```

This confused me because I first thought I had found the Sage binary log function.


---

Comment by kcrisman created at 2015-04-02 15:08:52

That's interesting, because [here](http://www.sagemath.org/doc/tutorial/tour_help.html) exactly this constant is used to show how awesome the interactive help is!  So something is messed up.


---

Comment by deinst created at 2015-06-03 18:21:44

This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. 

I would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.

On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.


---

Comment by kcrisman created at 2015-06-03 18:26:55

> On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.

Can you be more specific?


---

Comment by deinst created at 2015-06-12 02:29:37

Replying to [comment:3 kcrisman]:
> > On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.
> 
> Can you be more specific?
I thought I had answered this a while ago.  Obviously I got distracted.

The tutorial help for tan (gotten locally from `file:///Users/davideinstein/projects/sage/src/doc/output/html/en/tutorial/tour_help.html` looks like:

```
sage: tan?
Type:        <class 'sage.calculus.calculus.Function_tan'>
Definition:  tan( [noargspec] )
Docstring:

    The tangent function

    EXAMPLES:
        sage: tan(pi)
        0
        sage: tan(3.1415)
        -0.0000926535900581913
        sage: tan(3.1415/4)
        0.999953674278156
        sage: tan(pi/4)
        1
        sage: tan(1/2)
        tan(1/2)
        sage: RR(tan(1/2))
        0.546302489843790
```


If I run `tan?` in sage 6.7 I get


```
Type:           Function_tan
String form:    tan
File:           ~/projects/sage/local/lib/python2.7/site-packages/sage/functions/trig.py
Docstring:
   The tangent function.

   EXAMPLES:

      sage: tan(pi)
      0
      sage: tan(3.1415)
      -0.0000926535900581913
      sage: tan(3.1415/4)
      0.999953674278156
      sage: tan(pi/4)
      1
      sage: tan(1/2)
      tan(1/2)
      sage: RR(tan(1/2))
      0.546302489843790

   We can prevent evaluation using the "hold" parameter:

      sage: tan(pi/4,hold=True)
      tan(1/4*pi)

   To then evaluate again, we currently must use Maxima via
   "sage.symbolic.expression.Expression.simplify()":

      sage: a = tan(pi/4,hold=True); a.simplify()
      1

   TESTS:

      sage: conjugate(tan(x))
      tan(conjugate(x))
      sage: tan(complex(1,1))     # rel tol 1e-15
      (0.2717525853195118+1.0839233273386946j)

Init docstring:
   The tangent function.

   EXAMPLES:

      sage: tan(pi)
      0
      sage: tan(3.1415)
      -0.0000926535900581913
      sage: tan(3.1415/4)
      0.999953674278156
      sage: tan(pi/4)
      1
      sage: tan(1/2)
      tan(1/2)
      sage: RR(tan(1/2))
      0.546302489843790

   We can prevent evaluation using the "hold" parameter:

      sage: tan(pi/4,hold=True)
      tan(1/4*pi)

   To then evaluate again, we currently must use Maxima via
   "sage.symbolic.expression.Expression.simplify()":

      sage: a = tan(pi/4,hold=True); a.simplify()
      1

   TESTS:

      sage: conjugate(tan(x))
      tan(conjugate(x))
      sage: tan(complex(1,1))     # rel tol 1e-15
      (0.2717525853195118+1.0839233273386946j)
Call docstring:
   Wrapper around "BuiltinFunction.__call__()" which converts Python
   >>``<<int``s which are returned by Ginac to Sage Integers.

   This is needed to fix http://trac.sagemath.org/10133, where Ginac
   evaluates "sin(0)" to the Python int "0":

      sage: from sage.symbolic.function import BuiltinFunction
      sage: out = BuiltinFunction.__call__(sin, 0)
      sage: out, parent(out)
      (0, <type 'int'>)

   With this wrapper we have:

      sage: out = sin(0)
      sage: out, parent(out)
      (0, Integer Ring)

   However, if all inputs are Python types, we do not convert:

      sage: out = sin(int(0))
      sage: (out, parent(out))
      (0, <type 'int'>)
      sage: out = arctan2(int(0), float(1))
      sage: (out, parent(out))
      (0, <type 'int'>)
      sage: out = arctan2(int(0), RR(1))
      sage: (out, parent(out))
      (0, Integer Ring)
```


The `Type:` is shorter.  The module information is now in the new `File:` line.
The `Definition:` has been kidnapped by aliens, possibly replaced by the less informative `String Form:`.
The `Init Docstring` and `Call Docstring` have been added.


---

Comment by rws created at 2018-03-02 08:05:31

Replying to [comment:2 deinst]:
> This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. 

This works because `e` is not a `PyObject` embedded in an `Expression` like `pi` (where `pi.pyobject()` returns that object). `e` has its own class, and so its own docstring. `e.is_constant()` returns `True` because `is_constant()` just checks that there are no variables present.

> I would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.

Well, `_sage_doc()_` apparently(?) has nothing to do with what IPython prints when appending `?` to an object (same as giving the `%pdoc` magic). This is some other help mechanism.


---

Comment by rws created at 2018-03-02 09:41:00

Okay, there is now `sage.docs.instancedoc`. This will work.


---

Comment by rws created at 2018-03-02 14:03:14

The uninformative docstring from the `Expression` class that follows the constant docstring will be improved in another ticket.

Please review.
----
New commits:


---

Comment by rws created at 2018-03-02 14:03:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-03-02 19:45:00

What does the following sentence mean:

```
Instances of constants are usually embedded as ``PyObject`` in
a symbolic expression.
```



---

Comment by jdemeyer created at 2018-03-02 19:50:23

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-03-02 19:50:23

Can you move the doctest to the `_instancedoc_` method? It seems like it would best fit there. I would also want to see a doctest for the `__doc__` of an `Expression` which is not a constant, something like `(sin(x) + 1).__doc__`


---

Comment by jdemeyer created at 2018-03-02 20:26:56

I'm not convinced by the `except AttributeError`. It seems that every object has a `__doc__`, but it could be empty. So instead of the `AttributeError`, it would be better to do something like:

```python
doc = self.pyobject().__doc__
if doc:
    return doc
return type(self).__doc__   # Isn't self.__doc__ an infinite recursion?
```



---

Comment by rws created at 2018-03-03 07:20:01

Replying to [comment:9 jdemeyer]:
> What does the following sentence mean:
> {{{
> Instances of constants are usually embedded as ``PyObject`` in
> a symbolic expression.
> }}}

Does this make more sense? `Instances of constants are usually embedded in a symbolic expression.`


---

Comment by rws created at 2018-03-03 07:53:55

I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.


---

Comment by rws created at 2018-03-03 08:37:39

Note that I also improved docstrings for the class, init, and call slots. Suggestions welcome.
----
New commits:


---

Comment by rws created at 2018-03-03 08:37:39

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-03-03 08:51:04

Replying to [comment:14 rws]:
> I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.

You can just remove that docstring. For some reason, it is an identical copy of a docstring in `init_pynac_I()`.


---

Comment by rws created at 2018-03-03 09:47:47

Improved branch uploaded.


---

Comment by git created at 2018-03-03 09:49:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2019-01-11 14:35:36

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2019-01-11 14:35:36

Please rebase to latest master.


---

Comment by jdemeyer created at 2019-01-11 14:39:13

I'm also wondering whether this could help with #26492 and/or #26297
