# Issue 17840: fix log2 help

archive/issues_017840.json:
```json
{
    "body": "Other constants give more or less specific help but\n\n```\nsage: log2?\n\nType:           Expression\nString form:    log2\nLength:         0\nFile:           /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so\nDocstring:\n   Nearly all expressions are created by calling\n   new_Expression_from_*, but we need to make sure this at least does\n```\n\nThis confused me because I first thought I had found the Sage binary log function.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18077\n\n",
    "created_at": "2015-03-28T16:43:34Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "fix log2 help",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17840",
    "user": "@rwst"
}
```
Other constants give more or less specific help but

```
sage: log2?

Type:           Expression
String form:    log2
Length:         0
File:           /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so
Docstring:
   Nearly all expressions are created by calling
   new_Expression_from_*, but we need to make sure this at least does
```

This confused me because I first thought I had found the Sage binary log function.

Issue created by migration from https://trac.sagemath.org/ticket/18077





---

archive/issue_comments_239216.json:
```json
{
    "body": "That's interesting, because [here](http://www.sagemath.org/doc/tutorial/tour_help.html) exactly this constant is used to show how awesome the interactive help is!  So something is messed up.",
    "created_at": "2015-04-02T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239216",
    "user": "@kcrisman"
}
```

That's interesting, because [here](http://www.sagemath.org/doc/tutorial/tour_help.html) exactly this constant is used to show how awesome the interactive help is!  So something is messed up.



---

archive/issue_comments_239217.json:
```json
{
    "body": "This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. \n\nI would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.\n\nOn a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.",
    "created_at": "2015-06-03T18:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239217",
    "user": "@deinst"
}
```

This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. 

I would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.

On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.



---

archive/issue_comments_239218.json:
```json
{
    "body": "> On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.\n\nCan you be more specific?",
    "created_at": "2015-06-03T18:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239218",
    "user": "@kcrisman"
}
```

> On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.

Can you be more specific?



---

archive/issue_comments_239219.json:
```json
{
    "body": "Replying to [comment:3 kcrisman]:\n> > On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.\n> \n> Can you be more specific?\nI thought I had answered this a while ago.  Obviously I got distracted.\n\nThe tutorial help for tan (gotten locally from `file:///Users/davideinstein/projects/sage/src/doc/output/html/en/tutorial/tour_help.html` looks like:\n\n```\nsage: tan?\nType:        <class 'sage.calculus.calculus.Function_tan'>\nDefinition:  tan( [noargspec] )\nDocstring:\n\n    The tangent function\n\n    EXAMPLES:\n        sage: tan(pi)\n        0\n        sage: tan(3.1415)\n        -0.0000926535900581913\n        sage: tan(3.1415/4)\n        0.999953674278156\n        sage: tan(pi/4)\n        1\n        sage: tan(1/2)\n        tan(1/2)\n        sage: RR(tan(1/2))\n        0.546302489843790\n```\n\n\nIf I run `tan?` in sage 6.7 I get\n\n\n```\nType:           Function_tan\nString form:    tan\nFile:           ~/projects/sage/local/lib/python2.7/site-packages/sage/functions/trig.py\nDocstring:\n   The tangent function.\n\n   EXAMPLES:\n\n      sage: tan(pi)\n      0\n      sage: tan(3.1415)\n      -0.0000926535900581913\n      sage: tan(3.1415/4)\n      0.999953674278156\n      sage: tan(pi/4)\n      1\n      sage: tan(1/2)\n      tan(1/2)\n      sage: RR(tan(1/2))\n      0.546302489843790\n\n   We can prevent evaluation using the \"hold\" parameter:\n\n      sage: tan(pi/4,hold=True)\n      tan(1/4*pi)\n\n   To then evaluate again, we currently must use Maxima via\n   \"sage.symbolic.expression.Expression.simplify()\":\n\n      sage: a = tan(pi/4,hold=True); a.simplify()\n      1\n\n   TESTS:\n\n      sage: conjugate(tan(x))\n      tan(conjugate(x))\n      sage: tan(complex(1,1))     # rel tol 1e-15\n      (0.2717525853195118+1.0839233273386946j)\n\nInit docstring:\n   The tangent function.\n\n   EXAMPLES:\n\n      sage: tan(pi)\n      0\n      sage: tan(3.1415)\n      -0.0000926535900581913\n      sage: tan(3.1415/4)\n      0.999953674278156\n      sage: tan(pi/4)\n      1\n      sage: tan(1/2)\n      tan(1/2)\n      sage: RR(tan(1/2))\n      0.546302489843790\n\n   We can prevent evaluation using the \"hold\" parameter:\n\n      sage: tan(pi/4,hold=True)\n      tan(1/4*pi)\n\n   To then evaluate again, we currently must use Maxima via\n   \"sage.symbolic.expression.Expression.simplify()\":\n\n      sage: a = tan(pi/4,hold=True); a.simplify()\n      1\n\n   TESTS:\n\n      sage: conjugate(tan(x))\n      tan(conjugate(x))\n      sage: tan(complex(1,1))     # rel tol 1e-15\n      (0.2717525853195118+1.0839233273386946j)\nCall docstring:\n   Wrapper around \"BuiltinFunction.__call__()\" which converts Python\n   >>``<<int``s which are returned by Ginac to Sage Integers.\n\n   This is needed to fix http://trac.sagemath.org/10133, where Ginac\n   evaluates \"sin(0)\" to the Python int \"0\":\n\n      sage: from sage.symbolic.function import BuiltinFunction\n      sage: out = BuiltinFunction.__call__(sin, 0)\n      sage: out, parent(out)\n      (0, <type 'int'>)\n\n   With this wrapper we have:\n\n      sage: out = sin(0)\n      sage: out, parent(out)\n      (0, Integer Ring)\n\n   However, if all inputs are Python types, we do not convert:\n\n      sage: out = sin(int(0))\n      sage: (out, parent(out))\n      (0, <type 'int'>)\n      sage: out = arctan2(int(0), float(1))\n      sage: (out, parent(out))\n      (0, <type 'int'>)\n      sage: out = arctan2(int(0), RR(1))\n      sage: (out, parent(out))\n      (0, Integer Ring)\n```\n\n\nThe `Type:` is shorter.  The module information is now in the new `File:` line.\nThe `Definition:` has been kidnapped by aliens, possibly replaced by the less informative `String Form:`.\nThe `Init Docstring` and `Call Docstring` have been added.",
    "created_at": "2015-06-12T02:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239219",
    "user": "@deinst"
}
```

Replying to [comment:3 kcrisman]:
> > On a not entirely unrelated note:  The format of the help has changed somewhat from what is written in the tutorial.
> 
> Can you be more specific?
I thought I had answered this a while ago.  Obviously I got distracted.

The tutorial help for tan (gotten locally from `file:///Users/davideinstein/projects/sage/src/doc/output/html/en/tutorial/tour_help.html` looks like:

```
sage: tan?
Type:        <class 'sage.calculus.calculus.Function_tan'>
Definition:  tan( [noargspec] )
Docstring:

    The tangent function

    EXAMPLES:
        sage: tan(pi)
        0
        sage: tan(3.1415)
        -0.0000926535900581913
        sage: tan(3.1415/4)
        0.999953674278156
        sage: tan(pi/4)
        1
        sage: tan(1/2)
        tan(1/2)
        sage: RR(tan(1/2))
        0.546302489843790
```


If I run `tan?` in sage 6.7 I get


```
Type:           Function_tan
String form:    tan
File:           ~/projects/sage/local/lib/python2.7/site-packages/sage/functions/trig.py
Docstring:
   The tangent function.

   EXAMPLES:

      sage: tan(pi)
      0
      sage: tan(3.1415)
      -0.0000926535900581913
      sage: tan(3.1415/4)
      0.999953674278156
      sage: tan(pi/4)
      1
      sage: tan(1/2)
      tan(1/2)
      sage: RR(tan(1/2))
      0.546302489843790

   We can prevent evaluation using the "hold" parameter:

      sage: tan(pi/4,hold=True)
      tan(1/4*pi)

   To then evaluate again, we currently must use Maxima via
   "sage.symbolic.expression.Expression.simplify()":

      sage: a = tan(pi/4,hold=True); a.simplify()
      1

   TESTS:

      sage: conjugate(tan(x))
      tan(conjugate(x))
      sage: tan(complex(1,1))     # rel tol 1e-15
      (0.2717525853195118+1.0839233273386946j)

Init docstring:
   The tangent function.

   EXAMPLES:

      sage: tan(pi)
      0
      sage: tan(3.1415)
      -0.0000926535900581913
      sage: tan(3.1415/4)
      0.999953674278156
      sage: tan(pi/4)
      1
      sage: tan(1/2)
      tan(1/2)
      sage: RR(tan(1/2))
      0.546302489843790

   We can prevent evaluation using the "hold" parameter:

      sage: tan(pi/4,hold=True)
      tan(1/4*pi)

   To then evaluate again, we currently must use Maxima via
   "sage.symbolic.expression.Expression.simplify()":

      sage: a = tan(pi/4,hold=True); a.simplify()
      1

   TESTS:

      sage: conjugate(tan(x))
      tan(conjugate(x))
      sage: tan(complex(1,1))     # rel tol 1e-15
      (0.2717525853195118+1.0839233273386946j)
Call docstring:
   Wrapper around "BuiltinFunction.__call__()" which converts Python
   >>``<<int``s which are returned by Ginac to Sage Integers.

   This is needed to fix http://trac.sagemath.org/10133, where Ginac
   evaluates "sin(0)" to the Python int "0":

      sage: from sage.symbolic.function import BuiltinFunction
      sage: out = BuiltinFunction.__call__(sin, 0)
      sage: out, parent(out)
      (0, <type 'int'>)

   With this wrapper we have:

      sage: out = sin(0)
      sage: out, parent(out)
      (0, Integer Ring)

   However, if all inputs are Python types, we do not convert:

      sage: out = sin(int(0))
      sage: (out, parent(out))
      (0, <type 'int'>)
      sage: out = arctan2(int(0), float(1))
      sage: (out, parent(out))
      (0, <type 'int'>)
      sage: out = arctan2(int(0), RR(1))
      sage: (out, parent(out))
      (0, Integer Ring)
```


The `Type:` is shorter.  The module information is now in the new `File:` line.
The `Definition:` has been kidnapped by aliens, possibly replaced by the less informative `String Form:`.
The `Init Docstring` and `Call Docstring` have been added.



---

archive/issue_comments_239220.json:
```json
{
    "body": "Replying to [comment:2 deinst]:\n> This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. \n\nThis works because `e` is not a `PyObject` embedded in an `Expression` like `pi` (where `pi.pyobject()` returns that object). `e` has its own class, and so its own docstring. `e.is_constant()` returns `True` because `is_constant()` just checks that there are no variables present.\n\n> I would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.\n\nWell, `_sage_doc()_` apparently(?) has nothing to do with what IPython prints when appending `?` to an object (same as giving the `%pdoc` magic). This is some other help mechanism.",
    "created_at": "2018-03-02T08:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239220",
    "user": "@rwst"
}
```

Replying to [comment:2 deinst]:
> This appears to be broken for most constants declared in `sage/symbolic/constants.py` with the exception of `e`. 

This works because `e` is not a `PyObject` embedded in an `Expression` like `pi` (where `pi.pyobject()` returns that object). `e` has its own class, and so its own docstring. `e.is_constant()` returns `True` because `is_constant()` just checks that there are no variables present.

> I would expect that `Expression` would have a custom `_sage_doc` function that would reroute the help request to the appropriate class, but no such function seems to exist, or to ever have existed.  If someone indicates how this should work, I'll be glad to try to fix it.

Well, `_sage_doc()_` apparently(?) has nothing to do with what IPython prints when appending `?` to an object (same as giving the `%pdoc` magic). This is some other help mechanism.



---

archive/issue_comments_239221.json:
```json
{
    "body": "Okay, there is now `sage.docs.instancedoc`. This will work.",
    "created_at": "2018-03-02T09:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239221",
    "user": "@rwst"
}
```

Okay, there is now `sage.docs.instancedoc`. This will work.



---

archive/issue_comments_239222.json:
```json
{
    "body": "The uninformative docstring from the `Expression` class that follows the constant docstring will be improved in another ticket.\n\nPlease review.\n----\nNew commits:",
    "created_at": "2018-03-02T14:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239222",
    "user": "@rwst"
}
```

The uninformative docstring from the `Expression` class that follows the constant docstring will be improved in another ticket.

Please review.
----
New commits:



---

archive/issue_comments_239223.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-02T14:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239223",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_239224.json:
```json
{
    "body": "What does the following sentence mean:\n\n```\nInstances of constants are usually embedded as ``PyObject`` in\na symbolic expression.\n```\n",
    "created_at": "2018-03-02T19:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239224",
    "user": "@jdemeyer"
}
```

What does the following sentence mean:

```
Instances of constants are usually embedded as ``PyObject`` in
a symbolic expression.
```




---

archive/issue_comments_239225.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-02T19:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239225",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_239226.json:
```json
{
    "body": "Can you move the doctest to the `_instancedoc_` method? It seems like it would best fit there. I would also want to see a doctest for the `__doc__` of an `Expression` which is not a constant, something like `(sin(x) + 1).__doc__`",
    "created_at": "2018-03-02T19:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239226",
    "user": "@jdemeyer"
}
```

Can you move the doctest to the `_instancedoc_` method? It seems like it would best fit there. I would also want to see a doctest for the `__doc__` of an `Expression` which is not a constant, something like `(sin(x) + 1).__doc__`



---

archive/issue_comments_239227.json:
```json
{
    "body": "I'm not convinced by the `except AttributeError`. It seems that every object has a `__doc__`, but it could be empty. So instead of the `AttributeError`, it would be better to do something like:\n\n```python\ndoc = self.pyobject().__doc__\nif doc:\n    return doc\nreturn type(self).__doc__   # Isn't self.__doc__ an infinite recursion?\n```\n",
    "created_at": "2018-03-02T20:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239227",
    "user": "@jdemeyer"
}
```

I'm not convinced by the `except AttributeError`. It seems that every object has a `__doc__`, but it could be empty. So instead of the `AttributeError`, it would be better to do something like:

```python
doc = self.pyobject().__doc__
if doc:
    return doc
return type(self).__doc__   # Isn't self.__doc__ an infinite recursion?
```




---

archive/issue_comments_239228.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> What does the following sentence mean:\n> {{{\n> Instances of constants are usually embedded as ``PyObject`` in\n> a symbolic expression.\n> }}}\n\nDoes this make more sense? `Instances of constants are usually embedded in a symbolic expression.`",
    "created_at": "2018-03-03T07:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239228",
    "user": "@rwst"
}
```

Replying to [comment:9 jdemeyer]:
> What does the following sentence mean:
> {{{
> Instances of constants are usually embedded as ``PyObject`` in
> a symbolic expression.
> }}}

Does this make more sense? `Instances of constants are usually embedded in a symbolic expression.`



---

archive/issue_comments_239229.json:
```json
{
    "body": "I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.",
    "created_at": "2018-03-03T07:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239229",
    "user": "@rwst"
}
```

I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.



---

archive/issue_comments_239230.json:
```json
{
    "body": "Note that I also improved docstrings for the class, init, and call slots. Suggestions welcome.\n----\nNew commits:",
    "created_at": "2018-03-03T08:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239230",
    "user": "@rwst"
}
```

Note that I also improved docstrings for the class, init, and call slots. Suggestions welcome.
----
New commits:



---

archive/issue_comments_239231.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-03T08:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239231",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_239232.json:
```json
{
    "body": "Replying to [comment:14 rws]:\n> I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.\n\nYou can just remove that docstring. For some reason, it is an identical copy of a docstring in `init_pynac_I()`.",
    "created_at": "2018-03-03T08:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239232",
    "user": "@jdemeyer"
}
```

Replying to [comment:14 rws]:
> I'll also move the orphaned docstring for `I` to the file where it is defined, because at the moment the reference manual associates it with the wrong object.

You can just remove that docstring. For some reason, it is an identical copy of a docstring in `init_pynac_I()`.



---

archive/issue_comments_239233.json:
```json
{
    "body": "Improved branch uploaded.",
    "created_at": "2018-03-03T09:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239233",
    "user": "@rwst"
}
```

Improved branch uploaded.



---

archive/issue_comments_239234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-03T09:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239234",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239235.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-11T14:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239235",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_239236.json:
```json
{
    "body": "Please rebase to latest master.",
    "created_at": "2019-01-11T14:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239236",
    "user": "@jdemeyer"
}
```

Please rebase to latest master.



---

archive/issue_comments_239237.json:
```json
{
    "body": "I'm also wondering whether this could help with #26492 and/or #26297",
    "created_at": "2019-01-11T14:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17840#issuecomment-239237",
    "user": "@jdemeyer"
}
```

I'm also wondering whether this could help with #26492 and/or #26297
