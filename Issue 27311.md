# Issue 27311: Introduce periodic coordinates on manifolds

Issue created by migration from https://trac.sagemath.org/ticket/27548

Original creator: egourgoulhon

Original creation time: 2019-03-25 20:32:34

CC:  tscrim

Keywords: coordinate chart, manifold

This ticket introduces periodic coordinates on manifolds for more flexibility. 
In particular, this fixes an issue with the azimuthal angle phi being limited limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:

```
sage: M = Manifold(4, 'M', structure='Lorentzian')
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):\phi')
sage: g = M.metric()
sage: g[0,0], g[1,1] = -(1-2/r), 1/(1-2/r)
sage: g[2,2], g[3,3] = r^2, (r*sin(th))^2
sage: p0 = M((0, 8, pi/2, pi))  # initial point
sage: v0 = M.tangent_space(p0)((1.297, 0, 0, 0.064))  # initial tangent vector
sage: s = var('s')
sage: geod = M.integrated_geodesic(g, (s, 0, 1500), v0)
sage: geod.solve() # numerical integration
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: the 7th point (initial point being the '0th' point) of the 
numerical solution (obtained for a curve parameter equal to 105.0) is 
out of the chart domain
```

This is because phi reaches 2*pi at some point in the integration.

With the branch in this ticket, it suffices to declare phi to be a periodic coordinate, by adding the keyword `periodic` in the chart definition

```
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):periodic:\phi')
```

to allow for the full integration of the geodesic.

The periodicity of the coordinate is taken into account in the point comparison:

```
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))
True
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, -pi))
True
```



---

Comment by egourgoulhon created at 2019-03-25 20:33:46

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2019-03-25 20:33:46

New commits:


---

Comment by git created at 2019-03-26 12:29:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-03-26 22:36:30

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-03-26 22:36:30

LGTM.


---

Comment by egourgoulhon created at 2019-03-27 09:04:02

Thanks for the review!


---

Comment by vbraun created at 2019-03-30 20:37:59

Resolution: fixed
