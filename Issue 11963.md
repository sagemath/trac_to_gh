# Issue 11963: Multiple loops handling in c_graph

archive/issues_011963.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nSage handles multiple loops on one vertex inconsistently.\n\n\n```\nsage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\nsage:g.edges()\n[(0, 0, None), (0, 0, None)]\nsage:g.delete_edge(0,0)\nsage:g.edges()\n[]\n```\n\n\nCompare with\n\n\n```\nsage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation=\"networkx\")\nsage:g.edges()\n[(0, 0, None), (0, 0, None)]\nsage:g.delete_edge(0,0)\nsage:g.edges()\n[(0, 0, None)]\n```\n\n\nand\n\n\n```\nsage:g=Graph({0:[1,1]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\nsage:g.edges()\n[(0, 1, None), (0, 1, None)]\nsage:g.delete_edge(0,1)\nsage:g.edges()\n[(0, 1, None)]\n```\n\n\nAnother c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:\n\n\n```\nsage:g=Graph({0: [0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\nsage:g.add_edges([(0,0), (0,0)])\nsage:g.edges()\n[(0, 0, None)]\nsage:h=Graph({0: [0,0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\nsage:h.add_edges([(0,0), (0,0)])\nsage:h.edges()\n[(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]\n```\n\n\nI guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options \"allow loops\" and \"allow multiple edges\" -- it would be weird if \"allow multiple edges\" stopped work in the previously allowed case of (v,v) edge.\n\nBut I'm not very experiences mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)\n\nIssue created by migration from https://trac.sagemath.org/ticket/12135\n\n",
    "created_at": "2011-12-09T19:46:27Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "Multiple loops handling in c_graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11963",
    "user": "brunellus"
}
```
Assignee: jason, ncohen, rlm

Sage handles multiple loops on one vertex inconsistently.


```
sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation="c_graph")
sage:g.edges()
[(0, 0, None), (0, 0, None)]
sage:g.delete_edge(0,0)
sage:g.edges()
[]
```


Compare with


```
sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation="networkx")
sage:g.edges()
[(0, 0, None), (0, 0, None)]
sage:g.delete_edge(0,0)
sage:g.edges()
[(0, 0, None)]
```


and


```
sage:g=Graph({0:[1,1]}, loops=True, multiple_edges=True, implementation="c_graph")
sage:g.edges()
[(0, 1, None), (0, 1, None)]
sage:g.delete_edge(0,1)
sage:g.edges()
[(0, 1, None)]
```


Another c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:


```
sage:g=Graph({0: [0]}, loops=True, multiple_edges=True, implementation="c_graph")
sage:g.add_edges([(0,0), (0,0)])
sage:g.edges()
[(0, 0, None)]
sage:h=Graph({0: [0,0]}, loops=True, multiple_edges=True, implementation="c_graph")
sage:h.add_edges([(0,0), (0,0)])
sage:h.edges()
[(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]
```


I guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options "allow loops" and "allow multiple edges" -- it would be weird if "allow multiple edges" stopped work in the previously allowed case of (v,v) edge.

But I'm not very experiences mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)

Issue created by migration from https://trac.sagemath.org/ticket/12135





---

archive/issue_comments_137618.json:
```json
{
    "body": "A loop is stored as a single arc, but del_edge removes both ends:\n\n\n```\nself._cg.del_arc_label(u_int, v_int, l_int)\nself._cg.del_arc_label(v_int, u_int, l_int)\n```\n\n\nSo...\n\n\n```\nsage: g=Graph({0:[0]*11}); len(g.edges())\n11\nsage: g.delete_edge(0,0); len(g.edges())\n9\nsage: g.delete_edge(0,0); len(g.edges())\n7\nsage: g.delete_edge(0,0); len(g.edges())\n5\n```\n",
    "created_at": "2012-02-06T12:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137618",
    "user": "brunellus"
}
```

A loop is stored as a single arc, but del_edge removes both ends:


```
self._cg.del_arc_label(u_int, v_int, l_int)
self._cg.del_arc_label(v_int, u_int, l_int)
```


So...


```
sage: g=Graph({0:[0]*11}); len(g.edges())
11
sage: g.delete_edge(0,0); len(g.edges())
9
sage: g.delete_edge(0,0); len(g.edges())
7
sage: g.delete_edge(0,0); len(g.edges())
5
```




---

archive/issue_comments_137619.json:
```json
{
    "body": "OK, this was rather easy.",
    "created_at": "2012-02-06T12:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137619",
    "user": "brunellus"
}
```

OK, this was rather easy.



---

archive/issue_comments_137620.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-06T12:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137620",
    "user": "brunellus"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_137621.json:
```json
{
    "body": "Attachment\n\nHelloooooooo !!!\n\nHere is a one-line patch to add the \"::\" at the end of the line before the tests. If if it ok with you, the patch can be set to \"positive_review\". `:-)`\n\nNathann\n\n(and I changed the subject because I am at Cernay with the combinat team, and that is how they want to remember which patches we worked on... Sorry about that `^^;`)",
    "created_at": "2012-02-06T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137621",
    "user": "ncohen"
}
```

Attachment

Helloooooooo !!!

Here is a one-line patch to add the "::" at the end of the line before the tests. If if it ok with you, the patch can be set to "positive_review". `:-)`

Nathann

(and I changed the subject because I am at Cernay with the combinat team, and that is how they want to remember which patches we worked on... Sorry about that `^^;`)



---

archive/issue_comments_137622.json:
```json
{
    "body": "Attachment\n\nSorry, I keep forgetting about that. :-/ Thanks for the review. :-)",
    "created_at": "2012-02-06T15:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137622",
    "user": "brunellus"
}
```

Attachment

Sorry, I keep forgetting about that. :-/ Thanks for the review. :-)



---

archive/issue_comments_137623.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-06T15:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137623",
    "user": "brunellus"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_137624.json:
```json
{
    "body": "Looks like it shouldn't be in the topic but in the keywords... `^^;`\n\nThank you for the patches and the names `:-)`\n\nNathann",
    "created_at": "2012-02-06T15:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137624",
    "user": "ncohen"
}
```

Looks like it shouldn't be in the topic but in the keywords... `^^;`

Thank you for the patches and the names `:-)`

Nathann



---

archive/issue_comments_137625.json:
```json
{
    "body": "Changing keywords from \"\" to \"Cernay2012\".",
    "created_at": "2012-02-06T15:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137625",
    "user": "ncohen"
}
```

Changing keywords from "" to "Cernay2012".



---

archive/issue_comments_137626.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11963#issuecomment-137626",
    "user": "jdemeyer"
}
```

Resolution: fixed
