# Issue 31783: Multivariate Generating Functions: critical cone cannot be described for non-rational critical point

archive/issues_031783.json:
```json
{
    "body": "CC:  @markcwilson @kliem\n\n`FractionWithFactoredDenominator.critical_cone` returns `None` when the corresponding critical point has non-rational coordinates. Consider the following example:\n\n\n```\nsage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing\nsage: R.<x, y> = QQ[]\nsage: FFPD = FractionWithFactoredDenominatorRing(R)\nsage: G = 1; H = 1 - x - y - x*y\nsage: Hfac = H.factor()\nsage: G = G / Hfac.unit()\nsage: F = FFPD(G, Hfac)\n```\n\n\nFor a point with rational coordinates, everything works as expected:\n\n```\nsage: I = F.smooth_critical_ideal(alpha=(1, 1))\nsage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)\nsage: F.critical_cone(points[1])\n([(1, 1)], 1-d cone in 2-d lattice N)\n```\n\n\nFor non-rational coordinates, the critical cone returns `None`:\n\n```\nsage: I = F.smooth_critical_ideal(alpha=(2, 1))\nsage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)\nsage: F.critical_cone(points[1])\n([(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),\n   1)],\n None)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32020\n\n",
    "created_at": "2021-06-21T11:36:27Z",
    "labels": [
        "asymptotic expansions",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Multivariate Generating Functions: critical cone cannot be described for non-rational critical point",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31783",
    "user": "@behackl"
}
```
CC:  @markcwilson @kliem

`FractionWithFactoredDenominator.critical_cone` returns `None` when the corresponding critical point has non-rational coordinates. Consider the following example:


```
sage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing
sage: R.<x, y> = QQ[]
sage: FFPD = FractionWithFactoredDenominatorRing(R)
sage: G = 1; H = 1 - x - y - x*y
sage: Hfac = H.factor()
sage: G = G / Hfac.unit()
sage: F = FFPD(G, Hfac)
```


For a point with rational coordinates, everything works as expected:

```
sage: I = F.smooth_critical_ideal(alpha=(1, 1))
sage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)
sage: F.critical_cone(points[1])
([(1, 1)], 1-d cone in 2-d lattice N)
```


For non-rational coordinates, the critical cone returns `None`:

```
sage: I = F.smooth_critical_ideal(alpha=(2, 1))
sage: points = solve([SR(z) for z in I.gens()], [SR(z) for z in R.gens()], solution_dict=true)
sage: F.critical_cone(points[1])
([(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),
   1)],
 None)
```


Issue created by migration from https://trac.sagemath.org/ticket/32020





---

archive/issue_comments_454148.json:
```json
{
    "body": "Using `Polyhedron` instead of `Cone` in this case would be an option.",
    "created_at": "2021-06-21T15:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454148",
    "user": "@mkoeppe"
}
```

Using `Polyhedron` instead of `Cone` in this case would be an option.



---

archive/issue_comments_454149.json:
```json
{
    "body": "See also #30172, where an ABC for convex cones (not necessarily rational polyhedral) is in the works",
    "created_at": "2021-06-21T15:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454149",
    "user": "@mkoeppe"
}
```

See also #30172, where an ABC for convex cones (not necessarily rational polyhedral) is in the works



---

archive/issue_comments_454150.json:
```json
{
    "body": "Replying to [comment:1 mkoeppe]:\n> Using `Polyhedron` instead of `Cone` in this case would be an option. \n\nIn this particular example, simplifying the ray directions would actually suffice. The ray list passed to `Cone` is\n\n```\n[(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),\n  1)]\n```\n\nwhich actually is just\n\n```\n[(2, 1)]\n```\n\n\nBut that doesn't change the fact that if the rays actually have non-rational components, `Cone` isn't suitable.\n\nWhen I try to use `Polyhedron` with non-rational ray directions, I also get an error, e.g.,\n\n```\nsage: Polyhedron(rays=[(sqrt(2), 1)])\nTraceback (most recent call last):\n...\nValueError: no default backend for computations with Symbolic Ring\n```\n\n\nDid you mean that `Polyhedron` could be used after moving the rays to some more appropriate base ring? Or am I missing something else?\n\nAlso, thanks for the reference to #30172!",
    "created_at": "2021-06-21T17:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454150",
    "user": "@behackl"
}
```

Replying to [comment:1 mkoeppe]:
> Using `Polyhedron` instead of `Cone` in this case would be an option. 

In this particular example, simplifying the ray directions would actually suffice. The ray list passed to `Cone` is

```
[(((sqrt(5) - 1)*(sqrt(5) - 2) + sqrt(5) - 1)/((sqrt(5) - 1)*(sqrt(5) - 2) + 2*sqrt(5) - 4),
  1)]
```

which actually is just

```
[(2, 1)]
```


But that doesn't change the fact that if the rays actually have non-rational components, `Cone` isn't suitable.

When I try to use `Polyhedron` with non-rational ray directions, I also get an error, e.g.,

```
sage: Polyhedron(rays=[(sqrt(2), 1)])
Traceback (most recent call last):
...
ValueError: no default backend for computations with Symbolic Ring
```


Did you mean that `Polyhedron` could be used after moving the rays to some more appropriate base ring? Or am I missing something else?

Also, thanks for the reference to #30172!



---

archive/issue_comments_454151.json:
```json
{
    "body": "You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.",
    "created_at": "2021-06-21T17:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454151",
    "user": "@mkoeppe"
}
```

You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.



---

archive/issue_comments_454152.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.\n\nMakes sense, thanks.",
    "created_at": "2021-06-21T17:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454152",
    "user": "@behackl"
}
```

Replying to [comment:5 mkoeppe]:
> You would need to pass `base_ring=AA`. Polyhedron refuses to compute with `SR`.

Makes sense, thanks.



---

archive/issue_comments_454153.json:
```json
{
    "body": "If you need cones with transcendental data, #30234 would be an approach.",
    "created_at": "2021-06-21T17:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31783#issuecomment-454153",
    "user": "@mkoeppe"
}
```

If you need cones with transcendental data, #30234 would be an approach.
