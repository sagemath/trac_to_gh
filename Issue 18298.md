# Issue 18298: Fix Python tarball names

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-05-28 10:34:58

CC:  ohanar vbraun wluebbe ncohen schilly zimmerma

The Python packages can no longer be downloaded since #17607:

```
Found local metadata for python2-2.7.9
Attempting to download package python2-2.7.9
Traceback (most recent call last):
  File "/home/wluebbe/sage-6.8.beta1/src/bin/sage-download-file", line 423, in <module>
    tarball = Tarball(url)
  File "/home/wluebbe/sage-6.8.beta1/src/bin/sage-download-file", line 272, in __init__
    self._init_checksum()
  File "/home/wluebbe/sage-6.8.beta1/src/bin/sage-download-file", line 308, in _init_checksum
    with open(checksums_ini, 'rt') as f:
IOError: [Errno 2] No such file or directory: '/home/wluebbe/sage-6.8.beta1/build/pkgs/python/checksums.ini'
Error: spkg file '/home/wluebbe/sage-6.8.beta1/upstream/python-2.7.9.tar.gz' not found.
This shouldn't happen, it is a bug in the sage-spkg script.
```



---

Comment by vbraun created at 2015-05-28 22:14:50

I've copied python -> python2 and renamed Python -> python3 on the website (to be propagated to the mirrors)


---

Comment by vbraun created at 2015-05-28 22:19:44

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-05-28 22:19:44

Now the sage-download-file script no longer assumes that package name = tarball name - version
----
New commits:


---

Comment by git created at 2015-05-28 22:23:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2015-05-29 06:27:41

After pulling u/vbraun/fix_python_tarball_names I have

```
Successfully installed python2-2.7.9
Deleting temporary build directory
/home/wluebbe/sage-6.8.beta1/local/var/tmp/sage/build/python2-2.7.9
Finished installing python2-2.7.9.spkg
```

but then

```
make[2]: Leaving directory '/home/wluebbe/sage-6.8.beta1/build'
Makefile:565: recipe for target 'all' failed
make[1]: *** [all] Error 2
make[1]: Leaving directory '/home/wluebbe/sage-6.8.beta1/build'

real	2m9.439s
user	5m11.672s
sys	0m24.208s
***************************************************************
Error building Sage.

The following package(s) may have failed to build:

package: lcalc-1.23.p14
log file: /home/wluebbe/sage-6.8.beta1/logs/pkgs/lcalc-1.23.p14.log
build directory: /home/wluebbe/sage-6.8.beta1/local/var/tmp/sage/build/lcalc-1.23.p14
```



---

Comment by jdemeyer created at 2015-05-29 07:31:32

I would be very surprised if this ticket would break building `lcalc`. Most likely the problem with `lcalc` is a different issue. Can you upload the log file?


---

Comment by wluebbe created at 2015-05-29 07:51:27

Here it is

```
Found local metadata for lcalc-1.23.p14
Attempting to download package lcalc-1.23.p14
Traceback (most recent call last):
  File "/home/wluebbe/sage-6.8.beta1/src/bin/sage-download-file", line 436, in <module>
    tarball = Tarball(url)
  File "/home/wluebbe/sage-6.8.beta1/src/bin/sage-download-file", line 324, in __init__
    .format(tarball_name))
ValueError: tarball lcalc-1.23.tar.bz2 is not referenced by any Sage package
Error: spkg file '/home/wluebbe/sage-6.8.beta1/upstream/lcalc-1.23.tar.bz2' not found.
This shouldn't happen, it is a bug in the sage-spkg script.
```



---

Comment by git created at 2015-05-29 08:33:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-05-29 08:46:22

Forgot to strip off the patchlevel, fixed now. "make download" works.


---

Comment by wluebbe created at 2015-05-29 09:27:41

With the latest fix the build succeeded - now testing long ... 

What about going with Python 2.7.10 soon? It is available since 6 days. [https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tgz](https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tgz)


---

Comment by vbraun created at 2015-05-29 09:43:54

Replying to [comment:13 wluebbe]:
> What about going with Python 2.7.10 soon? It is available since 6 days. 

Please do work on it, but on a separate ticket.


---

Comment by lftabera created at 2015-05-29 10:39:52

I have encontered no problems building sage with this patch. I have tried both upgrading from 6.7 and a fresh install.


---

Comment by wluebbe created at 2015-05-29 10:50:06

... and tests passed. Together with comment:15 I guess it's a positive review.

But I had chosen the name of the class method different from the Python standard function `all()`  ;-)


---

Comment by wluebbe created at 2015-05-29 10:50:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-29 19:09:37

Resolution: fixed
