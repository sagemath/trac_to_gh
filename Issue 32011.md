# Issue 32011: Fix use of MixedIntegerLinearProgram in sage.graphs.generic_graph - part 3

Issue created by migration from https://trac.sagemath.org/ticket/32248

Original creator: dcoudert

Original creation time: 2021-07-20 09:44:19

CC:  mkoeppe tscrim dimpase

Part of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in `sage.combinat`, `sage.graphs`).

We update the following in `generic_graph.py`
- `flow`
- ...


---

Comment by dcoudert created at 2021-07-20 12:56:58

I'm not sure what to do with method `_build_flow_graph`. We could improve it in the future, in particular when the flow is integral.
----
Last 10 new commits:


---

Comment by dcoudert created at 2021-07-20 12:56:58

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-07-20 17:46:48

In this change to `flow` and `multicommodity_flow`:

```
-        flow = p.get_values(flow)
+        if integer:
+            flow = p.get_values(flow, convert=True, tolerance=integrality_tolerance)
+        else:
+            flow = p.get_values(flow)
+
```

I think it would be better to use `convert=True` for the case `integer=False` so that `float` values are converted to `RDF`.

Also it could be added in the docstring of `flow` that integrality is automatic with all our solvers (because they use simplex) if all capacities are integers.


---

Comment by mkoeppe created at 2021-07-20 17:59:20

Replying to [comment:1 dcoudert]:
> I'm not sure what to do with method `_build_flow_graph`. 

Indeed... this looks like a strange workaround altogether.

For now, I would say:

```
         # add significant edges
         for (u,v),l in flow.items():
-            if l > 0 and not (integer and l < .5):
+            if l:
                 g.add_edge(u, v, l)
```

(because integrality has already been taken care of)

And this part:

```
        # if integer is set, round values and deletes zeroes
        if integer:
            for u,v,l in g.edges(sort=False):
                if l < .5:
                    g.delete_edge(u, v)
                else:
                    g.set_edge_label(u, v, int(round(l)))
```

can just be removed because also the cycle canceling in the loop before it keeps integral flows integral.


---

Comment by mkoeppe created at 2021-07-20 17:59:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-07-20 19:05:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-20 19:16:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-07-20 19:17:18

Should be better now.


---

Comment by dcoudert created at 2021-07-20 19:17:18

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2021-07-20 19:32:54

Changing status from positive_review to needs_review.


---

Comment by mkoeppe created at 2021-07-20 20:02:45

Browsing through the changes I came across `vertex_disjoint_paths` and `edge_disjoint_paths` - I don't think the implementations of these methods are correct


---

Comment by dcoudert created at 2021-07-20 20:24:03

If you take a max st-flow in a network with edges of capacity 1, you get edge-disjoint paths from s to t, and if furthermore you ensure that only one unit of flow can go through a vertex, you get vertex disjoint paths.
I don't see what could be wrong here.


---

Comment by mkoeppe created at 2021-07-20 20:29:59

Thanks, I missed that `vertex_bound=True` does that


---

Comment by mkoeppe created at 2021-07-20 20:33:01

LGTM. Green patchbot => positive review


---

Comment by mkoeppe created at 2021-07-21 03:43:24

I've tested it locally


---

Comment by mkoeppe created at 2021-07-21 03:43:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-25 13:26:01

Resolution: fixed
