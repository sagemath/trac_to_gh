# Issue 32011: Fix use of MixedIntegerLinearProgram in sage.graphs.generic_graph - part 3

archive/issues_032011.json:
```json
{
    "body": "CC:  @mkoeppe @tscrim @dimpase\n\nPart of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in `sage.combinat`, `sage.graphs`).\n\nWe update the following in `generic_graph.py`\n- `flow`\n- ...\n\nIssue created by migration from https://trac.sagemath.org/ticket/32248\n\n",
    "created_at": "2021-07-20T09:44:19Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Fix use of MixedIntegerLinearProgram in sage.graphs.generic_graph - part 3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32011",
    "user": "https://github.com/dcoudert"
}
```
CC:  @mkoeppe @tscrim @dimpase

Part of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in `sage.combinat`, `sage.graphs`).

We update the following in `generic_graph.py`
- `flow`
- ...

Issue created by migration from https://trac.sagemath.org/ticket/32248





---

archive/issue_comments_456747.json:
```json
{
    "body": "I'm not sure what to do with method `_build_flow_graph`. We could improve it in the future, in particular when the flow is integral.\n----\nLast 10 new commits:",
    "created_at": "2021-07-20T12:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456747",
    "user": "https://github.com/dcoudert"
}
```

I'm not sure what to do with method `_build_flow_graph`. We could improve it in the future, in particular when the flow is integral.
----
Last 10 new commits:



---

archive/issue_comments_456748.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-20T12:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456748",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456749.json:
```json
{
    "body": "In this change to `flow` and `multicommodity_flow`:\n\n```\n-        flow = p.get_values(flow)\n+        if integer:\n+            flow = p.get_values(flow, convert=True, tolerance=integrality_tolerance)\n+        else:\n+            flow = p.get_values(flow)\n+\n```\n\nI think it would be better to use `convert=True` for the case `integer=False` so that `float` values are converted to `RDF`.\n\nAlso it could be added in the docstring of `flow` that integrality is automatic with all our solvers (because they use simplex) if all capacities are integers.",
    "created_at": "2021-07-20T17:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456749",
    "user": "https://github.com/mkoeppe"
}
```

In this change to `flow` and `multicommodity_flow`:

```
-        flow = p.get_values(flow)
+        if integer:
+            flow = p.get_values(flow, convert=True, tolerance=integrality_tolerance)
+        else:
+            flow = p.get_values(flow)
+
```

I think it would be better to use `convert=True` for the case `integer=False` so that `float` values are converted to `RDF`.

Also it could be added in the docstring of `flow` that integrality is automatic with all our solvers (because they use simplex) if all capacities are integers.



---

archive/issue_comments_456750.json:
```json
{
    "body": "Replying to [comment:1 dcoudert]:\n> I'm not sure what to do with method `_build_flow_graph`. \n\nIndeed... this looks like a strange workaround altogether.\n\nFor now, I would say:\n\n```\n         # add significant edges\n         for (u,v),l in flow.items():\n-            if l > 0 and not (integer and l < .5):\n+            if l:\n                 g.add_edge(u, v, l)\n```\n\n(because integrality has already been taken care of)\n\nAnd this part:\n\n```\n        # if integer is set, round values and deletes zeroes\n        if integer:\n            for u,v,l in g.edges(sort=False):\n                if l < .5:\n                    g.delete_edge(u, v)\n                else:\n                    g.set_edge_label(u, v, int(round(l)))\n```\n\ncan just be removed because also the cycle canceling in the loop before it keeps integral flows integral.",
    "created_at": "2021-07-20T17:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456750",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:1 dcoudert]:
> I'm not sure what to do with method `_build_flow_graph`. 

Indeed... this looks like a strange workaround altogether.

For now, I would say:

```
         # add significant edges
         for (u,v),l in flow.items():
-            if l > 0 and not (integer and l < .5):
+            if l:
                 g.add_edge(u, v, l)
```

(because integrality has already been taken care of)

And this part:

```
        # if integer is set, round values and deletes zeroes
        if integer:
            for u,v,l in g.edges(sort=False):
                if l < .5:
                    g.delete_edge(u, v)
                else:
                    g.set_edge_label(u, v, int(round(l)))
```

can just be removed because also the cycle canceling in the loop before it keeps integral flows integral.



---

archive/issue_comments_456751.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-20T17:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456751",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_456752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-20T19:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-20T19:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456754.json:
```json
{
    "body": "Should be better now.",
    "created_at": "2021-07-20T19:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456754",
    "user": "https://github.com/dcoudert"
}
```

Should be better now.



---

archive/issue_comments_456755.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-20T19:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456755",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_456756.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-07-20T19:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456756",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_456757.json:
```json
{
    "body": "Browsing through the changes I came across `vertex_disjoint_paths` and `edge_disjoint_paths` - I don't think the implementations of these methods are correct",
    "created_at": "2021-07-20T20:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456757",
    "user": "https://github.com/mkoeppe"
}
```

Browsing through the changes I came across `vertex_disjoint_paths` and `edge_disjoint_paths` - I don't think the implementations of these methods are correct



---

archive/issue_comments_456758.json:
```json
{
    "body": "If you take a max st-flow in a network with edges of capacity 1, you get edge-disjoint paths from s to t, and if furthermore you ensure that only one unit of flow can go through a vertex, you get vertex disjoint paths.\nI don't see what could be wrong here.",
    "created_at": "2021-07-20T20:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456758",
    "user": "https://github.com/dcoudert"
}
```

If you take a max st-flow in a network with edges of capacity 1, you get edge-disjoint paths from s to t, and if furthermore you ensure that only one unit of flow can go through a vertex, you get vertex disjoint paths.
I don't see what could be wrong here.



---

archive/issue_comments_456759.json:
```json
{
    "body": "Thanks, I missed that `vertex_bound=True` does that",
    "created_at": "2021-07-20T20:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456759",
    "user": "https://github.com/mkoeppe"
}
```

Thanks, I missed that `vertex_bound=True` does that



---

archive/issue_comments_456760.json:
```json
{
    "body": "LGTM. Green patchbot => positive review",
    "created_at": "2021-07-20T20:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456760",
    "user": "https://github.com/mkoeppe"
}
```

LGTM. Green patchbot => positive review



---

archive/issue_comments_456761.json:
```json
{
    "body": "I've tested it locally",
    "created_at": "2021-07-21T03:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456761",
    "user": "https://github.com/mkoeppe"
}
```

I've tested it locally



---

archive/issue_comments_456762.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-21T03:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456762",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_029104.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T13:26:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32011#event-29104"
}
```



---

archive/issue_comments_456763.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32011#issuecomment-456763",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
