# Issue 23604: MPIR-3.0.0 does not build on i7-6700

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2017-09-12 13:53:57

The current MPIR used by Sage (3.0.0) does not build on a i7-6700.

```
/bin/yasm -I .. -f elf64  -o sub_err1_n.lo `test -f 'sub_err1_n.as' || echo './'`sub_err1_n.as
[mpir-3.0.0.p0] add_err1_n.as:77: error: undefined symbol `mpn_add_err1_n.testrest' (first use)
```

The reason is detailed in https://github.com/wbhart/mpir/issues/196
and fixed in MPIR trunk. A workaround is to add ` --with-system-yasm` to the MPIR configure command.

So, the solution is to either upgrade MPIR or to change our spkg-install.


---

Comment by rws created at 2017-09-12 14:01:30

Hmmm, the command above is `/bin/yasm` and adding the configure option results in the same error, only that the command is now `/usr/bin/yasm`. That is yasm-1.2.0 on OpenSuSE.


---

Comment by rws created at 2017-09-12 14:08:08

I deinstalled system yasm-1.2.0 so Sage builds yasm-1.3.0 and now MPIR builds fine. So Sage should install yasm-1.3.0 if the system version is less.


---

Comment by jdemeyer created at 2017-09-12 15:01:16

Full log of MPIR build please.


---

Comment by rws created at 2017-09-12 15:08:21

mpir install log


---

Attachment


---

Comment by jdemeyer created at 2017-09-19 08:34:36

Confirmed with `MPIR_CONFIGURE="--host=skylakeavx-unknown-linux-gnu" ./sage -f mpir`


---

Comment by jdemeyer created at 2017-09-19 09:20:50

New commits:


---

Comment by jdemeyer created at 2017-09-19 09:20:50

Changing status from new to needs_review.


---

Comment by rws created at 2017-09-20 06:38:35

I verified that, on a yasm-1.2.0 installation and after `make distclean`, while develop fails to build, this branch installs yasm-1.3.0 before succesfully building MPIR. So, I think we're good to go.


---

Comment by rws created at 2017-09-20 06:38:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-22 20:26:42

Resolution: fixed
