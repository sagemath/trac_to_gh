# Issue 34126: Installation guide: Document Sage installation on Windows via VS Code devcontainers

Issue created by migration from https://trac.sagemath.org/ticket/34363

Original creator: mkoeppe

Original creation time: 2022-08-14 15:13:31

CC:  tscrim klee slelievre @darijgr @tobiasdiez saraedum was @davidayotte




---

Comment by mkoeppe created at 2022-08-14 16:09:48

Last 10 new commits:


---

Comment by mkoeppe created at 2022-08-14 16:09:48

Changing status from new to needs_review.


---

Comment by git created at 2022-08-15 15:22:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2022-08-16 14:17:30

Suggestion: in the alternative installation, I think I would mention that you can also use vscode, but now with extension [Remote - WSL](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl) which lets you use vscode inside your WSL environment (but this is not mandatory, as someone might want to use an other code editor).

Next, I have a question: is there any performance advantages in using docker containers instead of directly running it inside WSL?

Thank you very much for simplifying the installation tutorial!


---

Comment by git created at 2022-08-16 15:37:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-16 15:38:10

Replying to [comment:8 gh-DavidAyotte]:
> Suggestion: in the alternative installation, I think I would mention that you can also use vscode, but now with extension [Remote - WSL](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl) which lets you use vscode inside your WSL environment (but this is not mandatory, as someone might want to use an other code editor).

Thanks for the feedback!

We already have a section in the manual that explains this. I've linked it.


---

Comment by mkoeppe created at 2022-08-16 15:40:30

Replying to [comment:8 gh-DavidAyotte]:
> is there any performance advantages in using docker containers instead of directly running it inside WSL?

I would think it's the same as running WSL 2 directly


---

Comment by git created at 2022-08-17 05:56:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-08-17 08:35:21

Replying to [comment:12 mkoeppe]:
> Replying to [comment:8 gh-DavidAyotte]:
> > is there any performance advantages in using docker containers instead of directly running it inside WSL?
> 
> I would think it's the same as running WSL 2 directly

In general, Docker is slower (for both io and cpu) then WSL2. How much depends on the particular use case and the setup (e.g. whether the files are located in the windows or linux env).


---

Comment by @tobiasdiez created at 2022-08-17 08:50:06

In general, I'm skeptical if the devcontainer env should be indeed the recommended installation and development method on windows.

For installation, it is not clear to me how you would use the "installed" devcontainer in your own projects (i.e. outside of the vscode instance that hosts the sage source tree). For this, wouldn't it make more sense to recommend that people create a devcontainer file in their own project folder, that references a prebuild sage devcontainer?

For development, I would still favor wsl over docker for the performance. Moreover, I don't see why this should be a windows-specific recommendation in either case.


---

Comment by mkoeppe created at 2022-08-17 14:28:46

Replying to [comment:14 gh-tobiasdiez]:
> Replying to [comment:12 mkoeppe]:
> > Replying to [comment:8 gh-DavidAyotte]:
> > > is there any performance advantages in using docker containers instead of directly running it inside WSL?
> > 
> > I would think it's the same as running WSL 2 directly
> 
> In general, Docker is slower (for both io and cpu) then WSL2. How much depends on the particular use case and the setup (e.g. whether the files are located in the windows or linux env).

Even when using Docker's WSL2 backend?


---

Comment by mkoeppe created at 2022-08-17 14:31:56

Replying to [comment:15 gh-tobiasdiez]:
> I don't see why this should be a windows-specific recommendation in either case. 

Because on macOS and Linux, it is better to run it natively


---

Comment by mkoeppe created at 2022-08-17 14:35:44

Replying to [comment:15 gh-tobiasdiez]:
> For installation, it is not clear to me how you would use the "installed" devcontainer in your own projects (i.e. outside of the vscode instance that hosts the sage source tree). For this, wouldn't it make more sense to recommend that people create a devcontainer file in their own project folder, that references a prebuild sage devcontainer?

Yes, it would also make sense to do that (not instead, but in addition to what is done here). We have a bit of this already in the "portability testing" section added in #33671; see also #34286 (Cookiecutter for Sage user projects with devcontainer).


---

Comment by git created at 2022-08-17 17:20:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-17 17:21:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @tobiasdiez created at 2022-08-17 19:01:19

Replying to [comment:18 mkoeppe]:
> Replying to [comment:15 gh-tobiasdiez]:
> > For installation, it is not clear to me how you would use the "installed" devcontainer in your own projects (i.e. outside of the vscode instance that hosts the sage source tree). For this, wouldn't it make more sense to recommend that people create a devcontainer file in their own project folder, that references a prebuild sage devcontainer?
> 
> Yes, it would also make sense to do that (not instead, but in addition to what is done here). We have a bit of this already in the "portability testing" section added in #33671; see also #34286 (Cookiecutter for Sage user projects with devcontainer).

Can you then please explain and document how to use the sage installation (in the devcontainer) in one's own projects. For example, it is not clear to me how to select the sage python interpreter or juptyer kernel in another instance of vscode.


---

Comment by @tobiasdiez created at 2022-08-17 19:07:04

Replying to [comment:17 mkoeppe]:
> Replying to [comment:15 gh-tobiasdiez]:
> > I don't see why this should be a windows-specific recommendation in either case. 
> 
> Because on macOS and Linux, it is better to run it natively

Why? The current windows installation is wsl + as you normally install in linux. The thing that you replace now is "normally install in linux" by "use a docker container", while keeping the wsl part. So I don't see why we shouldn't recommend using a docker container also for normal linux dev/install then.


---

Comment by @tobiasdiez created at 2022-08-17 19:08:04

Replying to [comment:16 mkoeppe]:
> Replying to [comment:14 gh-tobiasdiez]:
> > Replying to [comment:12 mkoeppe]:
> > > Replying to [comment:8 gh-DavidAyotte]:
> > > > is there any performance advantages in using docker containers instead of directly running it inside WSL?
> > > 
> > > I would think it's the same as running WSL 2 directly
> > 
> > In general, Docker is slower (for both io and cpu) then WSL2. How much depends on the particular use case and the setup (e.g. whether the files are located in the windows or linux env).
> 
> Even when using Docker's WSL2 backend?

Yes, although the overhead is smaller then with the old legacy hyperv backend.


---

Comment by mkoeppe created at 2022-08-17 19:10:28

Replying to [comment:23 gh-tobiasdiez]:
> > Even when using Docker's WSL2 backend?
> 
> Yes, although the overhead is smaller then with the old legacy hyperv backend.

Do you have a reference for this at hand so we can add it to the installation guide?


---

Comment by mkoeppe created at 2022-08-17 19:12:54

Replying to [comment:22 gh-tobiasdiez]:
> Replying to [comment:17 mkoeppe]:
> > Replying to [comment:15 gh-tobiasdiez]:
> > > I don't see why this should be a windows-specific recommendation in either case. 
> > 
> > Because on macOS and Linux, it is better to run it natively
> 
> Why? The current windows installation is wsl + as you normally install in linux. The thing that you replace now is "normally install in linux" by "use a docker container", while keeping the wsl part. So I don't see why we shouldn't recommend using a docker container also for normal linux dev/install then.

The difference is that neither WSL nor Docker-in-WSL are native Windows.


---

Comment by @tobiasdiez created at 2022-08-17 20:04:58

Replying to [comment:25 mkoeppe]:
> Replying to [comment:22 gh-tobiasdiez]:
> > Replying to [comment:17 mkoeppe]:
> > > Replying to [comment:15 gh-tobiasdiez]:
> > > > I don't see why this should be a windows-specific recommendation in either case. 
> > > 
> > > Because on macOS and Linux, it is better to run it natively
> > 
> > Why? The current windows installation is wsl + as you normally install in linux. The thing that you replace now is "normally install in linux" by "use a docker container", while keeping the wsl part. So I don't see why we shouldn't recommend using a docker container also for normal linux dev/install then.
> 
> The difference is that neither WSL nor Docker-in-WSL are native Windows.

But that should be pretty irrelevant from a users/devs perspective. You will get the same advantages (and disadvantages) from the Docker-in-WSL solution over pure WSL, as you would get Docker in Linux over pure Linux, or not?


---

Comment by mkoeppe created at 2022-08-17 20:12:26

I see the key benefit of the devcontainer solution for Windows that it isolates the Windows user from having to learn about WSL, Linux distributions etc. So it reduces the learning curve for people who want to get started with Sage.

Of course, devcontainers also have general benefits that make them a good option for consideration on other platforms. But I don't see a reason why we would recommend it to users over what we recommend now - the build from source.


---

Comment by git created at 2022-08-17 20:43:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-08-18 20:51:37

I would say that reproducibility, not changing the developers system, ease of setting up as well as your point that potential users and devs don't need to learn how to manage packages using the cli are sufficiently convincing to make the devcontainer the recommended installation method on all systems. If they are not sufficient, then it shouldn't be the default recommendation (on neither system).

In either case, comment:21 is still not addressed.


---

Comment by @tobiasdiez created at 2022-08-18 20:51:37

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-08-18 20:57:23

Replying to [comment:29 gh-tobiasdiez]:
> I would say that [...] are sufficiently convincing to make the devcontainer the recommended installation method on all systems.

I get that you are convinced by it, but it's a long stretch to assume that the users would like that.


---

Comment by mkoeppe created at 2022-08-18 20:59:13

Replying to [comment:29 gh-tobiasdiez]:
> If they are not sufficient, then it shouldn't be the default recommendation (on neither system).

No, this does not follow because of what I have explained in comment:27.


---

Comment by mkoeppe created at 2022-08-18 21:10:24

Replying to [comment:21 gh-tobiasdiez]:
> Replying to [comment:18 mkoeppe]:
> > Replying to [comment:15 gh-tobiasdiez]:
> > > For installation, it is not clear to me how you would use the "installed" devcontainer in your own projects (i.e. outside of the vscode instance that hosts the sage source tree). For this, wouldn't it make more sense to recommend that people create a devcontainer file in their own project folder, that references a prebuild sage devcontainer?
> > 
> > Yes, it would also make sense to do that (not instead, but in addition to what is done here). We have a bit of this already in the "portability testing" section added in #33671; see also #34286 (Cookiecutter for Sage user projects with devcontainer).
> 
> Can you then please explain and document how to use the sage installation (in the devcontainer) in one's own projects. For example, it is not clear to me how to select the sage python interpreter or juptyer kernel in another instance of vscode.

Users who just start with Sage do not need any of this. 
They can just run Sage in the devcontainer of SAGE_ROOT and save their Jupyter notebooks  somewhere, maybe in a subdirectory.

Of course, we know that for running the `downstream-...` devcontainer, one does not really need the whole source tree of Sage. But it gives a convenient transition: If it turns out they do have to make changes to Sage, they can just switch from a `downstream-...` devcontainer to a `develop-...` devcontainer without having to change the rest of their workflow.

Creating a "project" using Sage is far beyond what most Sage users do: Note that there are only a few dozens of published user packages ("projects") out there. #34286 is about making this easier.


---

Comment by git created at 2022-08-18 21:20:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-18 21:20:58

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-08-18 21:20:58

How about this?


---

Comment by git created at 2022-08-18 21:31:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-08-18 21:45:55

The doc structure could be, as for other platforms,

```
   No development:

       Alternative 1:

       Alternative 2:

   Development:

       Alternative 1:

       Alternative 2:
```

We may put the recommended in alternative 1."No development alternative 1" would be the recommended approach for most users.

I would put "VS Code + downstream-devcontainer" approach to "No development alternative 1".

I would put "VS Code + WSL" approach to "Development alternative 1". Docker is really not necessary in sage development and conceptually more difficult than WSL, I think.

For "VS Code + downstream-devcontainer" approach, could we remove the git clone part (which is just to get `devcontainer.json`)?


---

Comment by klee created at 2022-08-18 23:41:06

Replying to [comment:36 klee]:
> For "VS Code + downstream-devcontainer" approach, could we remove the git clone part (which is just to get `devcontainer.json`)?

Providing a zipped folder with `./devcontainer/devcontainer.json` for download?


---

Comment by mkoeppe created at 2022-08-18 23:45:17

Replying to [comment:37 klee]:
> Replying to [comment:36 klee]:
> > For "VS Code + downstream-devcontainer" approach, could we remove the git clone part (which is just to get `devcontainer.json`)?
> 
> Providing a zipped folder with `./devcontainer/devcontainer.json` for download?

I would like to keep such things for a follow-up ticket (#34286)


---

Comment by @tobiasdiez created at 2022-08-19 20:47:43

Replying to [comment:32 mkoeppe]:
> Replying to [comment:21 gh-tobiasdiez]:
> > Replying to [comment:18 mkoeppe]:
> > > Replying to [comment:15 gh-tobiasdiez]:
> > > > For installation, it is not clear to me how you would use the "installed" devcontainer in your own projects (i.e. outside of the vscode instance that hosts the sage source tree). For this, wouldn't it make more sense to recommend that people create a devcontainer file in their own project folder, that references a prebuild sage devcontainer?
> > > 
> > > Yes, it would also make sense to do that (not instead, but in addition to what is done here). We have a bit of this already in the "portability testing" section added in #33671; see also #34286 (Cookiecutter for Sage user projects with devcontainer).
> > 
> > Can you then please explain and document how to use the sage installation (in the devcontainer) in one's own projects. For example, it is not clear to me how to select the sage python interpreter or juptyer kernel in another instance of vscode.
> 
> Users who just start with Sage do not need any of this. 
> They can just run Sage in the devcontainer of SAGE_ROOT and save their Jupyter notebooks  somewhere, maybe in a subdirectory.
> 
> Of course, we know that for running the `downstream-...` devcontainer, one does not really need the whole source tree of Sage. But it gives a convenient transition: If it turns out they do have to make changes to Sage, they can just switch from a `downstream-...` devcontainer to a `develop-...` devcontainer without having to change the rest of their workflow.
> 
> Creating a "project" using Sage is far beyond what most Sage users do: Note that there are only a few dozens of published user packages ("projects") out there. #34286 is about making this easier.

Sorry for being imprecise. I meant "project" in the sense of "anything that lives outside of the sagemath folder", e.g. ones own jupyter notebooks or similar stuff. To make it precise: how do I contribute to https://github.com/sagemanifolds/SageManifolds using the devcontainer approach?


---

Comment by @tobiasdiez created at 2022-08-19 20:57:48

Replying to [comment:36 klee]:
> The doc structure could be, as for other platforms,
> {{{
>    No development:
> 
>        Alternative 1:
> 
>        Alternative 2:
> 
>    Development:
> 
>        Alternative 1:
> 
>        Alternative 2:
> }}}
> We may put the recommended in alternative 1."No development alternative 1" would be the recommended approach for most users.
> 
> I would put "VS Code + downstream-devcontainer" approach to "No development alternative 1".
> 
> I would put "VS Code + WSL" approach to "Development alternative 1". Docker is really not necessary in sage development and conceptually more difficult than WSL, I think.
> 
> For "VS Code + downstream-devcontainer" approach, could we remove the git clone part (which is just to get `devcontainer.json`)?

In general, I like the idea. Maybe we can go even one step further and remove the numbering completely, as there is no clear general hierarchy between the options, but the preferred one depends on the situation. So simply something like "Option: Devcontainer" and "Option: Manual compilation from source in WSL".

I would also move the good clarifications by Matthias on when to use which option to the beginning of the decision tree, not after the steps.


---

Comment by mkoeppe created at 2022-08-19 21:07:00

No objections if you want to make these edits to the structure.

Important point to keep: The devcontainer approach also works on machines where you can run Docker but not WSL. (I do not know how common this scenario is.)


---

Comment by mkoeppe created at 2022-08-19 21:07:28

Replying to [comment:39 gh-tobiasdiez]:
> how do I contribute to https://github.com/sagemanifolds/SageManifolds using the devcontainer approach? 

Just clone it into a subfolder.


---

Comment by git created at 2022-08-21 18:59:18

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-08-21 19:10:24

Merged latest version of #33671.


---

Comment by git created at 2022-08-23 23:34:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-08-31 01:54:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ebriand created at 2022-09-10 17:42:25

For Windows using VS Code,  I would find useful to mention also 

* to install git, 
* and that if the `Git: Clone` command is not recognized, it is because git is not installed.


---

Comment by mkoeppe created at 2022-09-10 18:01:16

Do you have a VS Code documentation link that explains this well?
