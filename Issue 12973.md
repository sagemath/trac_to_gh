# Issue 12973: Sage's noncommutive rings don't always increment a refcount

archive/issues_012973.json:
```json
{
    "body": "Assignee: malb\n\nCC:  simonking malb\n\nRunning doctests with the new doctest framework revealed that KeyErrors were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13145\n\n",
    "created_at": "2012-06-21T05:12:48Z",
    "labels": [
        "commutative algebra",
        "minor",
        "bug"
    ],
    "title": "Sage's noncommutive rings don't always increment a refcount",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12973",
    "user": "roed"
}
```
Assignee: malb

CC:  simonking malb

Running doctests with the new doctest framework revealed that KeyErrors were being ignored in `sage.lib.singular.ring.singular_ring_delete`.  The included patch fixes the problem, but I need to add doctests.

Issue created by migration from https://trac.sagemath.org/ticket/13145





---

archive/issue_comments_156738.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156738",
    "user": "roed"
}
```

Attachment



---

archive/issue_comments_156739.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-21T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156739",
    "user": "roed"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156740.json:
```json
{
    "body": "My fixes apparently aren't enough: I'm picking up more failures now.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156740",
    "user": "roed"
}
```

My fixes apparently aren't enough: I'm picking up more failures now.



---

archive/issue_comments_156741.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-25T18:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156741",
    "user": "roed"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156742.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156742",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156743.json:
```json
{
    "body": "Somehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to \"Needs review\" for now.",
    "created_at": "2012-07-07T07:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156743",
    "user": "roed"
}
```

Somehow the problems went away with further changes in the doctest framework.  I'm not convinced that no problems remain in this area, but I'm going to return this to "Needs review" for now.



---

archive/issue_comments_156744.json:
```json
{
    "body": "Simon: any opinions?",
    "created_at": "2012-08-23T21:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156744",
    "user": "jhpalmieri"
}
```

Simon: any opinions?



---

archive/issue_comments_156745.json:
```json
{
    "body": "I'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.",
    "created_at": "2012-09-01T03:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156745",
    "user": "roed"
}
```

I'm going to make another push to finish #12415.  If this could get reviewed sometime in the next week that would be great.  I'm not sure if the changes here address all of the issues in deallocating singular objects, but I think it's an improvement and can go in.



---

archive/issue_comments_156746.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156746",
    "user": "malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156747.json:
```json
{
    "body": "Patch looks good to me.",
    "created_at": "2012-09-01T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156747",
    "user": "malb"
}
```

Patch looks good to me.



---

archive/issue_comments_156748.json:
```json
{
    "body": "Changing priority from minor to critical.",
    "created_at": "2012-09-02T21:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156748",
    "user": "jdemeyer"
}
```

Changing priority from minor to critical.



---

archive/issue_comments_156749.json:
```json
{
    "body": "Thanks!",
    "created_at": "2012-09-02T21:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156749",
    "user": "jdemeyer"
}
```

Thanks!



---

archive/issue_comments_156750.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-04T17:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156750",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_156751.json:
```json
{
    "body": "Question: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?",
    "created_at": "2012-09-15T18:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156751",
    "user": "SimonKing"
}
```

Question: Wouldn't it be better to follow the approach in #13447? Hence, drop the ring_refcount_dict altogether?



---

archive/issue_comments_156752.json:
```json
{
    "body": "For the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.",
    "created_at": "2012-09-17T17:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12973#issuecomment-156752",
    "user": "SimonKing"
}
```

For the record: Since this ticket is already merged, I made it an indirect dependency of #13447, which is now ready for review. #13447 removes the ring_refcount_dict.
