# Issue 15076: is_linear_extension on posets is rather liberal

archive/issues_015076.json:
```json
{
    "body": "CC:  @nathanncohen sage-combinat\n\nKeywords: posets, combinat\n\n\n```\nsage: P = Poset((divisors(12), attrcall(\"divides\")), facade=True, linear_extension=True)\nsage: list(P)\n[1, 2, 3, 4, 6, 12]\nsage: P.is_linear_extension([1,2,4,3,6,12,1337])\nTrue\nsage: P.is_linear_extension([1,2,4,3,6,666,12,1337])\nTrue\n```\n\n\nAt the moment I am not planning to do anything about it, since it would probably involving seeing what other parts of the code using `is_linear_extension` and how they are using (my bets that this error doesn't cause any other problems in the code, and fixing it would likely incur some speed penalty so one should keep the old functionality accessible).\n\nIssue created by migration from https://trac.sagemath.org/ticket/15313\n\n",
    "created_at": "2013-10-21T00:50:25Z",
    "labels": [
        "combinatorics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "is_linear_extension on posets is rather liberal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15076",
    "user": "@darijgr"
}
```
CC:  @nathanncohen sage-combinat

Keywords: posets, combinat


```
sage: P = Poset((divisors(12), attrcall("divides")), facade=True, linear_extension=True)
sage: list(P)
[1, 2, 3, 4, 6, 12]
sage: P.is_linear_extension([1,2,4,3,6,12,1337])
True
sage: P.is_linear_extension([1,2,4,3,6,666,12,1337])
True
```


At the moment I am not planning to do anything about it, since it would probably involving seeing what other parts of the code using `is_linear_extension` and how they are using (my bets that this error doesn't cause any other problems in the code, and fixing it would likely incur some speed penalty so one should keep the old functionality accessible).

Issue created by migration from https://trac.sagemath.org/ticket/15313





---

archive/issue_comments_193180.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-21T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193180",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_193181.json:
```json
{
    "body": "I think that's enough... And not too bad from the complexity point of view `:-)`\n\nNathann",
    "created_at": "2013-10-21T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193181",
    "user": "@nathanncohen"
}
```

I think that's enough... And not too bad from the complexity point of view `:-)`

Nathann



---

archive/issue_comments_193182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-21T13:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193182",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193183.json:
```json
{
    "body": "Good fix, but sage/combinat/posets/linear_extension.py still is trying to work around this bug:\n\n\n```\n    def __contains__(self, obj):\n        \"\"\"\n        Membership testing\n\n        EXAMPLES::\n\n            sage: P = Poset((divisors(12), attrcall(\"divides\")), facade=True, linear_extension=True)\n            sage: P.list()\n            [1, 2, 3, 4, 6, 12]\n            sage: L = P.linear_extensions()\n            sage: L([1, 2, 4, 3, 6, 12]) in L\n            True\n            sage: [1, 2, 4, 3, 6, 12] in L\n            False\n\n            sage: L = P.linear_extensions(facade=True)\n            sage: [1, 2, 4, 3, 6, 12] in L\n            True\n            sage: [1, 3, 2, 6, 4, 12] in L\n            True\n            sage: [1, 3, 6, 2, 4, 12] in L\n            False\n\n            sage: [p for p in Permutations(list(P)) if list(p) in L]\n            [[1, 2, 3, 4, 6, 12], [1, 2, 3, 6, 4, 12], [1, 2, 4, 3, 6, 12], [1, 3, 2, 4, 6, 12], [1, 3, 2, 6, 4, 12]]\n\n        \"\"\"\n        if not self._is_facade:\n            return super(LinearExtensionsOfPoset, self).__contains__(obj)\n        return \\\n            isinstance(obj, (list, tuple)) and \\\n            len(obj) == len(self.poset())  and \\\n            set(obj) == set(self.poset())  and \\\n            self.poset().is_linear_extension(obj)\n```\n\n\nThis could be now optimized.",
    "created_at": "2013-10-21T15:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193183",
    "user": "@darijgr"
}
```

Good fix, but sage/combinat/posets/linear_extension.py still is trying to work around this bug:


```
    def __contains__(self, obj):
        """
        Membership testing

        EXAMPLES::

            sage: P = Poset((divisors(12), attrcall("divides")), facade=True, linear_extension=True)
            sage: P.list()
            [1, 2, 3, 4, 6, 12]
            sage: L = P.linear_extensions()
            sage: L([1, 2, 4, 3, 6, 12]) in L
            True
            sage: [1, 2, 4, 3, 6, 12] in L
            False

            sage: L = P.linear_extensions(facade=True)
            sage: [1, 2, 4, 3, 6, 12] in L
            True
            sage: [1, 3, 2, 6, 4, 12] in L
            True
            sage: [1, 3, 6, 2, 4, 12] in L
            False

            sage: [p for p in Permutations(list(P)) if list(p) in L]
            [[1, 2, 3, 4, 6, 12], [1, 2, 3, 6, 4, 12], [1, 2, 4, 3, 6, 12], [1, 3, 2, 4, 6, 12], [1, 3, 2, 6, 4, 12]]

        """
        if not self._is_facade:
            return super(LinearExtensionsOfPoset, self).__contains__(obj)
        return \
            isinstance(obj, (list, tuple)) and \
            len(obj) == len(self.poset())  and \
            set(obj) == set(self.poset())  and \
            self.poset().is_linear_extension(obj)
```


This could be now optimized.



---

archive/issue_comments_193184.json:
```json
{
    "body": "Love those guys who fix a bug somewhere knowing the other function stays wrong....\n\nNathann",
    "created_at": "2013-10-21T16:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193184",
    "user": "@nathanncohen"
}
```

Love those guys who fix a bug somewhere knowing the other function stays wrong....

Nathann



---

archive/issue_comments_193185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-21T16:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193185",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193186.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-21T16:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193186",
    "user": "@darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_193187.json:
```json
{
    "body": "Supposing that you have run the doctests, setting this to positive review. Thanks for fixing!",
    "created_at": "2013-10-21T16:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193187",
    "user": "@darijgr"
}
```

Supposing that you have run the doctests, setting this to positive review. Thanks for fixing!



---

archive/issue_comments_193188.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-17T22:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15076#issuecomment-193188",
    "user": "@vbraun"
}
```

Resolution: fixed
