# Issue 24627: bug in TorsionQuadraticForm.normal_form()

Issue created by migration from Trac.

Original creator: sbrandhorst

Original creation time: 2018-02-28 09:24:13


```
sage: L1=IntegralLattice(matrix([[-4,0,0],[0,4,0],[0,0,-2]]))
sage: AL1=L1.discriminant_group()
sage: L2=IntegralLattice(matrix([[-4,0,0],[0,-4,0],[0,0,2]]))
sage: AL2=L2.discriminant_group()
sage: AL1.normal_form()
Finite quadratic module over Integer Ring with invariants (2, 4, 4)
Gram matrix of the quadratic form with values in Q/2Z:
[1/4   0   0]
[  0 5/4   0]
[  0   0 1/2]
sage: AL2.normal_form()
Finite quadratic module over Integer Ring with invariants (2, 4, 4)
Gram matrix of the quadratic form with values in Q/2Z:
[7/4   0   0]
[  0 7/4   0]
[  0   0 1/2]
```

but:

```
sage: [x,y,z]=AL2.smith_form_gens()
sage: AL2.submodule_with_gens([x+z,y+x-2*z,x-2*z-2*y])
Finite quadratic module over Integer Ring with invariants (2, 4, 4)
Gram matrix of the quadratic form with values in Q/2Z:
[1/4   0   0]
[  0 5/4   0]
[  0   0 1/2]
```



---

Comment by sbrandhorst created at 2018-02-28 09:24:33

Changing component from PLEASE CHANGE to quadratic forms.


---

Comment by sbrandhorst created at 2018-02-28 09:24:33

Changing type from PLEASE CHANGE to defect.


---

Comment by sbrandhorst created at 2018-02-28 16:06:33

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2018-02-28 16:06:33

New commits:


---

Comment by git created at 2018-02-28 17:09:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pmenegat created at 2018-03-01 08:03:52

I've done some tests and it seems ok to me


---

Comment by pmenegat created at 2018-03-01 08:04:27

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-03-01 09:01:34

Thank you for the review. If you review something, please remember to put your name in the reviewers field. :)


---

Comment by pmenegat created at 2018-03-01 10:22:01

I will remember for the next time


---

Comment by vbraun created at 2018-03-04 23:31:38

Merge conflict


---

Comment by vbraun created at 2018-03-04 23:31:38

Changing status from positive_review to needs_work.


---

Comment by sbrandhorst created at 2018-03-05 16:02:44

I will merge in the next beta as soon as it is available.


---

Comment by sbrandhorst created at 2018-03-05 16:02:44

Changing priority from major to critical.


---

Comment by git created at 2018-03-13 21:56:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-03-13 21:56:44

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-03-21 06:19:08

Resolution: fixed
