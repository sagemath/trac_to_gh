# Issue 24389: More substantial implementation of matrices over complex ball fields

Issue created by migration from https://trac.sagemath.org/ticket/24626

Original creator: mmezzarobba

Original creation time: 2018-01-31 18:29:40

CC:  fredrik.johansson vdelecroix cheuberg




---

Comment by mmezzarobba created at 2018-01-31 18:30:46

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-02-15 18:24:20

Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following

```
+        if op == Py_EQ:
+            return lt is rt or acb_mat_eq(lt.value, rt.value)
```



---

Comment by vdelecroix created at 2018-02-15 18:27:59

What should be the output of the two things below?

```
sage: a = matrix(CBF, [1/3])
sage: b = matrix(CBF, [1/3])
sage: (a == a) == (a[0,0] == a[0,0])
sage: (a == b) == (a[0,0] == b[0,0])
```

(such kind of tests would be good as doctests)


---

Comment by vdelecroix created at 2018-02-15 18:29:04

Instead of

```
elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
```

you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)


---

Comment by vdelecroix created at 2018-02-15 18:30:42

You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...


---

Comment by vdelecroix created at 2018-02-15 18:31:36

(BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))


---

Comment by mmezzarobba created at 2018-02-16 09:04:00

Thanks for you comments!

Replying to [comment:3 vdelecroix]:
> Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following
> {{{
> +        if op == Py_EQ:
> +            return lt is rt or acb_mat_eq(lt.value, rt.value)
> }}}

Good catch. The explanation is simply that this ticket is older than #24627.

Replying to [comment:5 vdelecroix]:
> Instead of
> {{{
> elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
> }}}
> you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)

Yes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)

Replying to [comment:6 vdelecroix]:
> You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...

Why? What I want in this case in really to test the implementation for this specific parent, not the dispatch done by the coercion framework.

Replying to [comment:7 vdelecroix]:
> (BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))

`Element` implements `__neg__()` and not `__invert__()`, probably because abusing `__invert__()` to mean `1/x` like most Sage `Element`s do may not be such a good idea. But I don't think there is any reason to implement `_neg_()` rather than `__neg__()` in the present case, and the latter should be slightly faster.


---

Comment by vdelecroix created at 2018-02-18 20:20:26

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-02-19 09:06:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-19 09:07:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2018-02-19 09:08:28

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-04-03 07:34:46

docstring in charpoly? The rest looks good.


---

Comment by git created at 2018-04-03 11:07:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-04-03 11:09:17

Replying to [comment:13 vdelecroix]:
> docstring in charpoly?

Fixed, thanks!

I also rebased the branch on top of fac3f5e (#24742) to avoid a merge conflict.


---

Comment by vdelecroix created at 2018-04-07 09:51:14

merge conflicts with #24742 that has changed from `fac3f5e` to `â€‹bf9cefd`. I did the rebase.
----
New commits:


---

Comment by vdelecroix created at 2018-04-07 09:55:27

Replying to [comment:8 mmezzarobba]:
> Replying to [comment:3 vdelecroix]:
> Replying to [comment:5 vdelecroix]:
> > Instead of
> > {{{
> > elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
> > }}}
> > you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)
> 
> Yes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)

I don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?


---

Comment by git created at 2018-04-07 10:01:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-04-07 10:02:14

waiting for more info on [comment:18]. The rest is ok.


---

Comment by vdelecroix created at 2018-04-07 10:02:14

Changing status from needs_review to needs_info.


---

Comment by mmezzarobba created at 2018-04-07 10:37:00

Thanks for the rebase.

Replying to [comment:18 vdelecroix]:
> I don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?

Yes, probably. Go ahead and change it if you want--I find the version I wrote slightly clearer and I don't see the point of this discussion, but I don't really care.


---

Comment by git created at 2018-04-07 10:55:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-04-07 10:56:43

if you are ok with the current state please set to positive review. I would like to move forward with #24927.


---

Comment by mmezzarobba created at 2018-04-07 12:32:26

Changing status from needs_info to positive_review.


---

Comment by mmezzarobba created at 2018-04-07 12:32:26

The failure reported by the patchbot is genuine, but not due to this ticket.


---

Comment by vbraun created at 2018-05-09 09:49:42

Resolution: fixed
