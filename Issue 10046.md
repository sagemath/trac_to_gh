# Issue 10046: ZeroDivisionError in crt method of IntegerMod

Issue created by migration from Trac.

Original creator: roed

Original creation time: 2010-10-01 16:03:26

Assignee: AlexGhitza

CC:  robertwb

`mod(0,1).crt(mod(a, n))` raises a `ZeroDivisionError` if and only if `n >= 2^31-1`.


```
sage: mod(0,1).crt(mod(4,2^31-2)) 
4
sage: mod(0,1).crt(mod(4,2^31-1)) 
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
```



---

Comment by roed created at 2010-10-01 16:04:17

Changing status from new to needs_review.


---

Comment by zimmerma created at 2010-10-03 09:20:06

David, I'm not sure the proposed patch is optimal. Indeed, the problem only occurs when self
is a small integer and other is a GMP integer. Since the small integer code seems to deal
correctly with mod(0,1), a fix is only needed is the case self=mod(0,1) and other is a GMP
integer, for example after the line

```
        if other.modulus() == 1:
            return self
```

Robert, since you wrote this code, can you comment on this?

Paul


---

Comment by zimmerma created at 2010-10-03 14:54:10

Changing status from needs_review to needs_work.


---

Comment by zimmerma created at 2010-10-03 14:54:10

by the way, the following doctest fails with this patch (with Sage 4.5.3):

```
The following tests failed:


        sage -t  "devel/sage-10047/sage/misc/trace.py"
```

The detailed error is:

```
[zimmerma`@`coing sage-4.5.3]$ sage -t  devel/sage-10047/sage/misc/trace.py 
sage -t  "devel/sage-10047/sage/misc/trace.py"              
**********************************************************************
File "/usr/local/sage-4.5.3/sage/devel/sage-10047/sage/misc/trace.py", line 61:
    sage: print s.before[s.before.find('-'):]
Expected:
    ---...
    ipdb> c
    2 * 5
Got:
    ----------------------------------------------------------------------
    | Sage Version 4.5.3, Release Date: 2010-09-04                       |
    | Type notebook() for the GUI, and license() for information.        |
    ----------------------------------------------------------------------
    trace('print factor(10)'); print 3+97
    s
    c
    Loading Sage library. Current Mercurial branch is: 
**********************************************************************
1 items had failures:
   1 of  10 in __main__.example_1
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/zimmerma/.sage//tmp/.doctest_trace.py
         [4.5 s]
```

It works ok with vanilla 4.5.3.

Paul


---

Comment by mhansen created at 2010-10-11 03:58:29

Note that the above error is #9446.


---

Comment by zimmerma created at 2010-10-11 06:51:45

> Note that the above error is #9446. 

thus maybe we should wait that #9446 is fixed.

Paul


---

Comment by mhansen created at 2010-10-11 06:55:32

That issue is independent of this one.


---

Comment by zimmerma created at 2010-10-11 06:58:33

> That issue is independent of this one. 

anyway, the issue raised in comment 2 still holds. Robert, are you out there?

Paul


---

Comment by roed created at 2010-10-15 04:33:26

Changing status from needs_work to needs_review.


---

Attachment

I've changed it so that it only tests for self==mod(0,1) when needed.


---

Comment by zimmerma created at 2010-10-18 09:21:39

> I've changed it so that it only tests for self==mod(0,1) when needed. 

thanks, I am now satisfied with the patch.

Paul


---

Comment by zimmerma created at 2010-10-18 09:21:39

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2010-10-28 15:01:19

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2010-10-28 15:01:19

Please change the commit message of the patch (use `hg qrefresh -e` for that) such that it contains a description of the patch and also the correct ticket number.


---

Comment by jdemeyer created at 2010-11-01 11:33:52

Fixed commit message


---

Comment by jdemeyer created at 2010-11-01 11:35:29

Resolution: fixed


---

Attachment
