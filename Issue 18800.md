# Issue 18800: Cplex backend: allow to set logfile

Issue created by migration from https://trac.sagemath.org/ticket/19037

Original creator: dcoudert

Original creation time: 2015-08-15 13:14:24

CC:  ncohen

With this patch it is now possible to set a logfile for `Cplex`. This is useful for instance when you want to remember the logs or when you want to have access to them but don't want to see them on screen.

I don't know how to do the same for other backends, in particular `GLPK`.


---

Comment by git created at 2015-08-15 13:16:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2015-08-15 13:30:47

Changing status from new to needs_review.


---

Comment by dcoudert created at 2015-08-15 13:30:47

The proposed implementation might certainly be improved. 
Also, I'm not sure that the `CPXsetlogfile` method returns something else than 0, which means successful according the documentation http://www-01.ibm.com/support/knowledgecenter/SSSA5P_12.6.2/ilog.odms.cplex.help/refcallablelibrary/cpxapi/setlogfile.html?cp=SSSA5P_12.6.2%2F2-8-1-256. I did some unsuccessful trials...


---

Comment by ncohen created at 2015-08-15 15:39:26

> The proposed implementation might certainly be improved.

Mostly up to you. The only way I see to see things differently is this: given that this is not a 'solver parameter' in the same sense than others, it could be worth creating an individual function to do that -- as it exposes a specific CPLEX API function.

Either way it must appear in the documentation somewhere.

> Also, I'm not sure that the `CPXsetlogfile` method returns something else than 0, which means successful according the documentation http://www-01.ibm.com/support/knowledgecenter/SSSA5P_12.6.2/ilog.odms.cplex.help/refcallablelibrary/cpxapi/setlogfile.html?cp=SSSA5P_12.6.2%2F2-8-1-256. I did some unsuccessful trials...

They say in the doc that it returns an 'error code' when somethings goes wrong. You should probably call the 'check' function defined in the cplex backend file, just in case. It is done almost everywhere in the file.

Nathann


---

Comment by git created at 2015-08-16 11:13:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2015-08-16 11:31:56

Hello,

since `LogFile` is a solver parameter for `Gurobi`, I prefer to have similar access method for `Cplex`.
I have added the parameter to the documentation and I'm now using the `check` method.

Also, I had to
- modify all doctests of the `cplex_backend.pyx` file for the following reason: a call to `./sage -t -l --optional=CPLEX src/sage/numerical/backends/cplex_backend.pyx`  was reporting 149 doctests failures!

```
**********************************************************************
File "src/sage/numerical/backends/cplex_backend.pyx", line 78, in sage.numerical.backends.cplex_backend.CPLEXBackend.add_variable
Failed example:
    p = get_solver(solver = "CPLEX")                  # optional - CPLEX
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.cplex_backend.CPLEXBackend.add_variable[0]>", line 1, in <module>
        p = get_solver(solver = "CPLEX")                  # optional - CPLEX
    NameError: name 'get_solver' is not defined
**********************************************************************
File "src/sage/numerical/backends/cplex_backend.pyx", line 79, in sage.numerical.backends.cplex_backend.CPLEXBackend.add_variable
Failed example:
    p.ncols()                                         # optional - CPLEX
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.cplex_backend.CPLEXBackend.add_variable[1]>", line 1, in <module>
        p.ncols()                                         # optional - CPLEX
    NameError: name 'p' is not defined
...
...
...
**********************************************************************
29 items had failures:
   6 of   7 in sage.numerical.backends.cplex_backend.CPLEXBackend.add_col
   7 of   8 in sage.numerical.backends.cplex_backend.CPLEXBackend.add_linear_constraint
   6 of   7 in sage.numerical.backends.cplex_backend.CPLEXBackend.add_linear_constraints
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.add_variables
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.col_bounds
   3 of   4 in sage.numerical.backends.cplex_backend.CPLEXBackend.col_name
   8 of   9 in sage.numerical.backends.cplex_backend.CPLEXBackend.get_objective_value
   8 of   9 in sage.numerical.backends.cplex_backend.CPLEXBackend.get_variable_value
   4 of   5 in sage.numerical.backends.cplex_backend.CPLEXBackend.is_maximization
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.is_variable_binary
   6 of   7 in sage.numerical.backends.cplex_backend.CPLEXBackend.is_variable_continuous
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.is_variable_integer
   4 of   5 in sage.numerical.backends.cplex_backend.CPLEXBackend.ncols
   4 of   5 in sage.numerical.backends.cplex_backend.CPLEXBackend.nrows
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.objective_coefficient
   3 of   4 in sage.numerical.backends.cplex_backend.CPLEXBackend.problem_name
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.row
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.row_bounds
   3 of   4 in sage.numerical.backends.cplex_backend.CPLEXBackend.row_name
   5 of  12 in sage.numerical.backends.cplex_backend.CPLEXBackend.set_objective
   4 of   5 in sage.numerical.backends.cplex_backend.CPLEXBackend.set_sense
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.set_variable_type
   2 of   3 in sage.numerical.backends.cplex_backend.CPLEXBackend.set_verbosity
   6 of   7 in sage.numerical.backends.cplex_backend.CPLEXBackend.solve
  10 of  11 in sage.numerical.backends.cplex_backend.CPLEXBackend.solver_parameter
   5 of  11 in sage.numerical.backends.cplex_backend.CPLEXBackend.variable_lower_bound
   5 of  10 in sage.numerical.backends.cplex_backend.CPLEXBackend.variable_upper_bound
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.write_lp
   5 of   6 in sage.numerical.backends.cplex_backend.CPLEXBackend.write_mps
    [191 tests, 149 failures, 0.11 s]
----------------------------------------------------------------------
sage -t --long src/sage/numerical/backends/cplex_backend.pyx  # 149 doctests failed
```

   Adding `# optional - CPLEX` to all the lines `from sage.numerical.backends.generic_backend import get_solver` solve the problem. Don't know why.

- change some doctests to get rid of deprecation warnings. E.g.,

```
    doctest:858: DeprecationWarning: The default value of 'nonnegative' will change, to False instead of True. You should add the explicit 'nonnegative=True'.
    See http://trac.sagemath.org/15521 for details.
```


I have a remaining doctest error for method `solve`

```
File "src/sage/numerical/backends/cplex_backend.pyx", line 852, in sage.numerical.backends.cplex_backend.CPLEXBackend.solve
Failed example:
    p.solve()                                       # optional - CPLEX
Expected:
    Traceback (most recent call last):
    ...
    MIPSolverException: ...
Got:
    0
```

   I don't know how to fix the example. I can off course change it to something more understandable. Let me know what you prefer.

David.


---

Comment by ncohen created at 2015-08-16 11:49:15

Hello,

> since `LogFile` is a solver parameter for `Gurobi`, I prefer to have similar access method for `Cplex`.
> I have added the parameter to the documentation and I'm now using the `check` method.

Okayokay. Could you write it in the doc somewhere? It only appears as examples so far.

> Also, I had to
> - modify all doctests of the `cplex_backend.pyx` file for the following reason: a call to `./sage -t -l --optional=CPLEX src/sage/numerical/backends/cplex_backend.pyx`  was reporting 149 doctests failures!

That's because you are meant to run optional=sage,cplex.

But people here let things like #18904 to die, so whatever...

> - change some doctests to get rid of deprecation warnings. E.g.,
> {{{
>     doctest:858: DeprecationWarning: The default value of 'nonnegative' will change, to False instead of True. You should add the explicit 'nonnegative=True'.
>     See http://trac.sagemath.org/15521 for details.
> }}}

Okayokay. We should have detected this earlier, but then again, #18904...

> I have a remaining doctest error for method `solve`
>    I don't know how to fix the example. I can off course change it to something more understandable. Let me know what you prefer.

It's something weird. I played with it a bit, and it looks like you should remove the first 'p.solve'. Afterwards it works. Looks like CPLEX does not like to see a change in the objective function between successive calls to solve.

Nathann


---

Comment by git created at 2015-08-16 12:33:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2015-08-16 12:34:24

I tried to address all your comments.
David.


---

Comment by git created at 2015-08-16 13:04:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-08-16 13:04:59

> I tried to address all your comments.

Thank you. I added a commit that reads/write the logfile. If you agree with it, this branch can go.

Nathann


---

Comment by dcoudert created at 2015-08-16 13:59:18

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-08-16 13:59:18

Excellent. I was thinking of adding such a test but did not know how to deal with the print part.
Thank you.

David.


---

Comment by vbraun created at 2015-08-19 01:19:25

Resolution: fixed
