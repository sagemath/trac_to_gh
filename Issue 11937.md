# Issue 11937: Function for faster evaluation of cyclotomic polynomials

Issue created by migration from https://trac.sagemath.org/ticket/12109

Original creator: roed

Original creation time: 2011-12-03 04:49:50

Assignee: was

CC:  jpflori

I've implemented a function for evaluating cyclotomic polynomials without having to explicitly create the polynomial: this gives both memory and speed savings for large n.


---

Comment by roed created at 2011-12-03 04:52:27

Changing status from new to needs_review.


---

Comment by aapitzsch created at 2011-12-10 17:11:09

Changing status from needs_review to needs_work.


---

Comment by aapitzsch created at 2011-12-10 17:11:09

Some lines are to long. Maximum line length should be 79 characters.

``n`th` creates a bad rendered reference manual (HTML), ``n`-th` should work.

`\divides` seems to be an unknown command. Reference manual (HTML) shows

```
System Message: WARNING/2 (\Phi_n(x) = \prod_{d \divides n} (x^d - 1)^{\mu(n / d)})
```

use `\mid` instead.

There is a double "that" in `parity_divisors()`.

Please add an example for `_x = Integer(x)` fails.

Not necessary for positive review but could you also change

```
raise *Error, "..."
```

to

```
raise *Error("...")
```

http://www.python.org/dev/peps/pep-3109/#compatibility-issues


---

Comment by roed created at 2011-12-12 14:09:31

Changing status from needs_work to needs_review.


---

Comment by roed created at 2011-12-12 14:09:31

I changed comments and documentation to less than 79 characters, but left a couple of code snippets longer than that since they were less than 85 and I thought that introducing a line break would make it less clear.  Let me know if you want me to change it.

Apply 12109.2.patch only.


---

Comment by aapitzsch created at 2011-12-12 17:19:38

I attached a patch to add a colon and to replace TAB characters.
Everything else looks fine, so I give it a positive review.


---

Comment by aapitzsch created at 2011-12-12 17:19:38

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-12-13 09:36:53

Please state clearly which patches have to be applied.


---

Comment by aapitzsch created at 2011-12-13 10:23:08

Apply
 1. [attachment:12109.2.patch]
 2. [attachment:trac_12109_reviewer.patch].


---

Comment by jdemeyer created at 2011-12-15 22:46:33

You really should add more tests: real numbers, complex numbers, finite field elements, number field elements...


---

Comment by jdemeyer created at 2011-12-15 22:46:33

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-12-15 22:50:51

This is obviously wrong:

```
sage: cyclotomic_value(11, GF(5)(2))
2047
```



---

Comment by jdemeyer created at 2011-12-15 22:53:02

You have a big Cython loop without any interrupt checks, you should implement [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling) (and add a test for it for good measure).


---

Comment by jdemeyer created at 2011-12-15 23:03:34

Instead of doing many divisions, it would be more efficient to simply compute numerator and denominator and divide once.


---

Comment by jdemeyer created at 2011-12-15 23:07:27

This new code is actually quite a bit slower than PARI:

```
sage: timeit("cyclotomic_value(2*3*5*7*11*13*17, 10)")
5 loops, best of 3: 740 ms per loop
sage: timeit("pari('polcyclo(2*3*5*7*11*13*17, 10)')")
5 loops, best of 3: 199 ms per loop
```



---

Comment by roed created at 2012-01-03 13:55:29

Changing status from needs_work to needs_review.


---

Comment by roed created at 2012-01-03 13:55:29

Thanks for catching those.  I couldn't beat Pari, so the new patch uses pari for integers, rationals, and pari elements.  I also incorporated the code for roots of unity and the tests from http://permalink.gmane.org/gmane.comp.mathematics.pari.devel/2930

Apply only 12109.3.patch.


---

Comment by davidloeffler created at 2012-03-12 11:11:02

Apply 12109.3.patch

(for patchbot)


---

Comment by davidloeffler created at 2012-03-12 12:34:40

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2012-03-12 12:34:40

This patch seems to cause an infinite loop: both recent patchbot runs ended in timeout errors, including one with the timeout set to 1 hour:

```
sage -t  -force_lib devel/sage-12109/sage/rings/polynomial/cyclotomic.pyx
*** *** Error: TIMED OUT! PROCESS KILLED! *** ***

         [3600.2 s]
```



---

Comment by jdemeyer created at 2012-03-12 12:54:03

Probably this whole patch would better be replaced anyway by a call to PARI.


---

Comment by roed created at 2013-02-27 10:40:39

Changing status from needs_work to needs_review.


---

Comment by roed created at 2013-02-27 10:40:39

Replying to [comment:15 jdemeyer]:
> Probably this whole patch would better be replaced anyway by a call to PARI.

I've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.

I don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....


---

Comment by jpflori created at 2013-02-27 10:43:21

Replying to [comment:17 roed]:
> Replying to [comment:15 jdemeyer]:
> > Probably this whole patch would better be replaced anyway by a call to PARI.
> 
> I've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.
> 
> I don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....
I'd prefer to keep your generic code in if it really handles some corner cases better than going through `cyclotomic_polynomial`.
Could provide an example of a ring where this additional code would be of interest?


---

Comment by jpflori created at 2013-02-27 10:49:32

Hum, I just saw you did not remove your additional code, so disregard my previous comment.


---

Comment by roed created at 2013-02-27 10:54:48

Replying to [comment:19 jpflori]:
> Hum, I just saw you did not remove your additional code, so disregard my previous comment.

It's still interesting to figure out when it's being used.  Adding a print statement in the `except StandardError` clause, I'm finding that most of the examples in the `TESTS` block are using my implementation.  I'm not sure why PARI is failing in these cases though.


---

Comment by roed created at 2013-02-27 10:57:06

Just fixed a small problem in the TESTS (used `x` as the variable in the for loop).


---

Comment by spice created at 2013-03-02 03:18:30

Minor documentation fixes in cyclotomic_value()


---

Attachment

Can't see any issues. Patch applies, tests work, code checks out with changes mentioned above added, values agree with evaluation of ``cyclotomic_polynomial()`` for every test case I tried.

Fixed minor formatting errors in the documentation for ``cyclotomic_value()``. Added one or two lines too for further clarification of the algorithm.


---

Comment by spice created at 2013-03-02 03:19:36

Changing status from needs_review to positive_review.


---

Comment by spice created at 2013-03-02 03:21:01

Apply 12109.4.patch

(for patchbot)


---

Comment by jdemeyer created at 2013-03-03 13:20:05

I assume the "work issue" is no longer relevant?...


---

Comment by roed created at 2013-03-03 20:43:40

Yeah, that's correct.


---

Comment by jdemeyer created at 2013-03-04 07:35:41

Resolution: fixed
