# Issue 11937: Function for faster evaluation of cyclotomic polynomials

archive/issues_011937.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  jpflori\n\nI've implemented a function for evaluating cyclotomic polynomials without having to explicitly create the polynomial: this gives both memory and speed savings for large n.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12109\n\n",
    "created_at": "2011-12-03T04:49:50Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Function for faster evaluation of cyclotomic polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11937",
    "user": "https://github.com/roed314"
}
```
Assignee: @williamstein

CC:  jpflori

I've implemented a function for evaluating cyclotomic polynomials without having to explicitly create the polynomial: this gives both memory and speed savings for large n.

Issue created by migration from https://trac.sagemath.org/ticket/12109





---

archive/issue_comments_136884.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-03T04:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136884",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136885.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-10T17:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136885",
    "user": "https://github.com/a-andre"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136886.json:
```json
{
    "body": "Some lines are to long. Maximum line length should be 79 characters.\n\n``n`th` creates a bad rendered reference manual (HTML), ``n`-th` should work.\n\n`\\divides` seems to be an unknown command. Reference manual (HTML) shows\n\n```\nSystem Message: WARNING/2 (\\Phi_n(x) = \\prod_{d \\divides n} (x^d - 1)^{\\mu(n / d)})\n```\n\nuse `\\mid` instead.\n\nThere is a double \"that\" in `parity_divisors()`.\n\nPlease add an example for `_x = Integer(x)` fails.\n\nNot necessary for positive review but could you also change\n\n```\nraise *Error, \"...\"\n```\n\nto\n\n```\nraise *Error(\"...\")\n```\n\nhttp://www.python.org/dev/peps/pep-3109/#compatibility-issues",
    "created_at": "2011-12-10T17:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136886",
    "user": "https://github.com/a-andre"
}
```

Some lines are to long. Maximum line length should be 79 characters.

``n`th` creates a bad rendered reference manual (HTML), ``n`-th` should work.

`\divides` seems to be an unknown command. Reference manual (HTML) shows

```
System Message: WARNING/2 (\Phi_n(x) = \prod_{d \divides n} (x^d - 1)^{\mu(n / d)})
```

use `\mid` instead.

There is a double "that" in `parity_divisors()`.

Please add an example for `_x = Integer(x)` fails.

Not necessary for positive review but could you also change

```
raise *Error, "..."
```

to

```
raise *Error("...")
```

http://www.python.org/dev/peps/pep-3109/#compatibility-issues



---

archive/issue_comments_136887.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-12T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136887",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136888.json:
```json
{
    "body": "I changed comments and documentation to less than 79 characters, but left a couple of code snippets longer than that since they were less than 85 and I thought that introducing a line break would make it less clear.  Let me know if you want me to change it.\n\nApply 12109.2.patch only.",
    "created_at": "2011-12-12T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136888",
    "user": "https://github.com/roed314"
}
```

I changed comments and documentation to less than 79 characters, but left a couple of code snippets longer than that since they were less than 85 and I thought that introducing a line break would make it less clear.  Let me know if you want me to change it.

Apply 12109.2.patch only.



---

archive/issue_comments_136889.json:
```json
{
    "body": "I attached a patch to add a colon and to replace TAB characters.\nEverything else looks fine, so I give it a positive review.",
    "created_at": "2011-12-12T17:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136889",
    "user": "https://github.com/a-andre"
}
```

I attached a patch to add a colon and to replace TAB characters.
Everything else looks fine, so I give it a positive review.



---

archive/issue_comments_136890.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-12T17:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136890",
    "user": "https://github.com/a-andre"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136891.json:
```json
{
    "body": "Please state clearly which patches have to be applied.",
    "created_at": "2011-12-13T09:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136891",
    "user": "https://github.com/jdemeyer"
}
```

Please state clearly which patches have to be applied.



---

archive/issue_comments_136892.json:
```json
{
    "body": "Apply\n1. [attachment:12109.2.patch]\n2. [attachment:trac_12109_reviewer.patch].",
    "created_at": "2011-12-13T10:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136892",
    "user": "https://github.com/a-andre"
}
```

Apply
1. [attachment:12109.2.patch]
2. [attachment:trac_12109_reviewer.patch].



---

archive/issue_comments_136893.json:
```json
{
    "body": "You really should add more tests: real numbers, complex numbers, finite field elements, number field elements...",
    "created_at": "2011-12-15T22:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136893",
    "user": "https://github.com/jdemeyer"
}
```

You really should add more tests: real numbers, complex numbers, finite field elements, number field elements...



---

archive/issue_comments_136894.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-12-15T22:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136894",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_136895.json:
```json
{
    "body": "This is obviously wrong:\n\n```\nsage: cyclotomic_value(11, GF(5)(2))\n2047\n```\n",
    "created_at": "2011-12-15T22:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136895",
    "user": "https://github.com/jdemeyer"
}
```

This is obviously wrong:

```
sage: cyclotomic_value(11, GF(5)(2))
2047
```




---

archive/issue_comments_136896.json:
```json
{
    "body": "You have a big Cython loop without any interrupt checks, you should implement [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling) (and add a test for it for good measure).",
    "created_at": "2011-12-15T22:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136896",
    "user": "https://github.com/jdemeyer"
}
```

You have a big Cython loop without any interrupt checks, you should implement [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling) (and add a test for it for good measure).



---

archive/issue_comments_136897.json:
```json
{
    "body": "Instead of doing many divisions, it would be more efficient to simply compute numerator and denominator and divide once.",
    "created_at": "2011-12-15T23:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136897",
    "user": "https://github.com/jdemeyer"
}
```

Instead of doing many divisions, it would be more efficient to simply compute numerator and denominator and divide once.



---

archive/issue_comments_136898.json:
```json
{
    "body": "This new code is actually quite a bit slower than PARI:\n\n```\nsage: timeit(\"cyclotomic_value(2*3*5*7*11*13*17, 10)\")\n5 loops, best of 3: 740 ms per loop\nsage: timeit(\"pari('polcyclo(2*3*5*7*11*13*17, 10)')\")\n5 loops, best of 3: 199 ms per loop\n```\n",
    "created_at": "2011-12-15T23:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136898",
    "user": "https://github.com/jdemeyer"
}
```

This new code is actually quite a bit slower than PARI:

```
sage: timeit("cyclotomic_value(2*3*5*7*11*13*17, 10)")
5 loops, best of 3: 740 ms per loop
sage: timeit("pari('polcyclo(2*3*5*7*11*13*17, 10)')")
5 loops, best of 3: 199 ms per loop
```




---

archive/issue_comments_136899.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-03T13:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136899",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136900.json:
```json
{
    "body": "Thanks for catching those.  I couldn't beat Pari, so the new patch uses pari for integers, rationals, and pari elements.  I also incorporated the code for roots of unity and the tests from http://permalink.gmane.org/gmane.comp.mathematics.pari.devel/2930\n\nApply only 12109.3.patch.",
    "created_at": "2012-01-03T13:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136900",
    "user": "https://github.com/roed314"
}
```

Thanks for catching those.  I couldn't beat Pari, so the new patch uses pari for integers, rationals, and pari elements.  I also incorporated the code for roots of unity and the tests from http://permalink.gmane.org/gmane.comp.mathematics.pari.devel/2930

Apply only 12109.3.patch.



---

archive/issue_comments_136901.json:
```json
{
    "body": "Apply 12109.3.patch\n\n(for patchbot)",
    "created_at": "2012-03-12T11:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136901",
    "user": "https://github.com/loefflerd"
}
```

Apply 12109.3.patch

(for patchbot)



---

archive/issue_comments_136902.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-12T12:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136902",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136903.json:
```json
{
    "body": "This patch seems to cause an infinite loop: both recent patchbot runs ended in timeout errors, including one with the timeout set to 1 hour:\n\n```\nsage -t  -force_lib devel/sage-12109/sage/rings/polynomial/cyclotomic.pyx\n*** *** Error: TIMED OUT! PROCESS KILLED! *** ***\n\n         [3600.2 s]\n```\n",
    "created_at": "2012-03-12T12:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136903",
    "user": "https://github.com/loefflerd"
}
```

This patch seems to cause an infinite loop: both recent patchbot runs ended in timeout errors, including one with the timeout set to 1 hour:

```
sage -t  -force_lib devel/sage-12109/sage/rings/polynomial/cyclotomic.pyx
*** *** Error: TIMED OUT! PROCESS KILLED! *** ***

         [3600.2 s]
```




---

archive/issue_comments_136904.json:
```json
{
    "body": "Probably this whole patch would better be replaced anyway by a call to PARI.",
    "created_at": "2012-03-12T12:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136904",
    "user": "https://github.com/jdemeyer"
}
```

Probably this whole patch would better be replaced anyway by a call to PARI.



---

archive/issue_comments_136905.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-27T10:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136905",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136906.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Probably this whole patch would better be replaced anyway by a call to PARI.\n\nI've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.\n\nI don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....",
    "created_at": "2013-02-27T10:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136906",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:15 jdemeyer]:
> Probably this whole patch would better be replaced anyway by a call to PARI.

I've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.

I don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....



---

archive/issue_comments_136907.json:
```json
{
    "body": "Replying to [comment:17 roed]:\n> Replying to [comment:15 jdemeyer]:\n> > Probably this whole patch would better be replaced anyway by a call to PARI.\n> \n> I've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.\n> \n> I don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....\nI'd prefer to keep your generic code in if it really handles some corner cases better than going through `cyclotomic_polynomial`.\nCould provide an example of a ring where this additional code would be of interest?",
    "created_at": "2013-02-27T10:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136907",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:17 roed]:
> Replying to [comment:15 jdemeyer]:
> > Probably this whole patch would better be replaced anyway by a call to PARI.
> 
> I've changed it so that it tries to just call PARI (and fixed the timeout problem).  But that won't always work, since not every ring in Sage can convert to PARI.
> 
> I don't strongly object to just falling back on `cyclotomic_polynomial` in this case, but the current code will provide a speedup in some cases.  Of course those cases are probably rarely of interest....
I'd prefer to keep your generic code in if it really handles some corner cases better than going through `cyclotomic_polynomial`.
Could provide an example of a ring where this additional code would be of interest?



---

archive/issue_comments_136908.json:
```json
{
    "body": "Hum, I just saw you did not remove your additional code, so disregard my previous comment.",
    "created_at": "2013-02-27T10:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136908",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Hum, I just saw you did not remove your additional code, so disregard my previous comment.



---

archive/issue_comments_136909.json:
```json
{
    "body": "Replying to [comment:19 jpflori]:\n> Hum, I just saw you did not remove your additional code, so disregard my previous comment.\n\nIt's still interesting to figure out when it's being used.  Adding a print statement in the `except StandardError` clause, I'm finding that most of the examples in the `TESTS` block are using my implementation.  I'm not sure why PARI is failing in these cases though.",
    "created_at": "2013-02-27T10:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136909",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:19 jpflori]:
> Hum, I just saw you did not remove your additional code, so disregard my previous comment.

It's still interesting to figure out when it's being used.  Adding a print statement in the `except StandardError` clause, I'm finding that most of the examples in the `TESTS` block are using my implementation.  I'm not sure why PARI is failing in these cases though.



---

archive/issue_comments_136910.json:
```json
{
    "body": "Just fixed a small problem in the TESTS (used `x` as the variable in the for loop).",
    "created_at": "2013-02-27T10:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136910",
    "user": "https://github.com/roed314"
}
```

Just fixed a small problem in the TESTS (used `x` as the variable in the for loop).



---

archive/issue_comments_136911.json:
```json
{
    "body": "Minor documentation fixes in cyclotomic_value()",
    "created_at": "2013-03-02T03:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136911",
    "user": "https://github.com/haikona"
}
```

Minor documentation fixes in cyclotomic_value()



---

archive/issue_comments_136912.json:
```json
{
    "body": "Attachment [12109.4.patch](tarball://root/attachments/some-uuid/ticket12109/12109.4.patch) by @haikona created at 2013-03-02 03:19:36\n\nCan't see any issues. Patch applies, tests work, code checks out with changes mentioned above added, values agree with evaluation of ``cyclotomic_polynomial()`` for every test case I tried.\n\nFixed minor formatting errors in the documentation for ``cyclotomic_value()``. Added one or two lines too for further clarification of the algorithm.",
    "created_at": "2013-03-02T03:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136912",
    "user": "https://github.com/haikona"
}
```

Attachment [12109.4.patch](tarball://root/attachments/some-uuid/ticket12109/12109.4.patch) by @haikona created at 2013-03-02 03:19:36

Can't see any issues. Patch applies, tests work, code checks out with changes mentioned above added, values agree with evaluation of ``cyclotomic_polynomial()`` for every test case I tried.

Fixed minor formatting errors in the documentation for ``cyclotomic_value()``. Added one or two lines too for further clarification of the algorithm.



---

archive/issue_comments_136913.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-02T03:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136913",
    "user": "https://github.com/haikona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136914.json:
```json
{
    "body": "Apply 12109.4.patch\n\n(for patchbot)",
    "created_at": "2013-03-02T03:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136914",
    "user": "https://github.com/haikona"
}
```

Apply 12109.4.patch

(for patchbot)



---

archive/issue_comments_136915.json:
```json
{
    "body": "I assume the \"work issue\" is no longer relevant?...",
    "created_at": "2013-03-03T13:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136915",
    "user": "https://github.com/jdemeyer"
}
```

I assume the "work issue" is no longer relevant?...



---

archive/issue_comments_136916.json:
```json
{
    "body": "Yeah, that's correct.",
    "created_at": "2013-03-03T20:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136916",
    "user": "https://github.com/roed314"
}
```

Yeah, that's correct.



---

archive/issue_events_032170.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-04T07:35:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11937#event-32170"
}
```



---

archive/issue_comments_136917.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-04T07:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11937",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11937#issuecomment-136917",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
