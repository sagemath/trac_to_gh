# Issue 21086: Configure OpenBLAS to be single threaded

Issue created by migration from https://trac.sagemath.org/ticket/21323

Original creator: cpernet

Original creation time: 2016-08-23 23:06:24

Keywords: BLAS, sd75

OpenBLAS is currently configured to run in multithreaded mode.
This prevents a user to have control over the number of threads of his sage computation (in case he wants to split it in several processes).
Instead, I suggest to configure it with the `USE_THREAD=0` option which makes it a sequential BLAS.
Note that LinBox parallel routines (not yet exposed in SageMath) required a sequential BLAS. In turn they offer parallel speed-up of the same order, but with the option to set the number of threads as a parameters to the function called.


---

Comment by cpernet created at 2016-08-23 23:07:03

Changing type from PLEASE CHANGE to defect.


---

Comment by cpernet created at 2016-08-24 08:57:11

New commits:


---

Comment by git created at 2016-08-24 09:55:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cpernet created at 2016-08-24 09:56:45

Changing status from new to needs_review.


---

Comment by jpflori created at 2016-08-24 14:26:49

I see in OpenBLAS doc (https://github.com/xianyi/OpenBLAS/wiki/faq):

```
    How can I use OpenBLAS in multi-threaded applications?

If your application is already multi-threaded, it will conflict with OpenBLAS multi-threading. Thus, you must set OpenBLAS to use single thread as following.
*    export OPENBLAS_NUM_THREADS=1 in the environment variables. Or
*    Call openblas_set_num_threads(1) in the application on runtime. Or
*    Build OpenBLAS single thread version, e.g. make USE_THREAD=0
```

So it seems we could disable mt at runtime.
Any thought abour this?


---

Comment by jpflori created at 2016-08-24 14:26:49

Changing status from needs_review to needs_info.


---

Comment by cpernet created at 2016-08-24 15:16:55

Right. After thinking this through, we figured that the best option is to have fflas-ffpack call the `openblas_set_num_threads(1)` before each call to OpenBLAS.

This ticket therefore becomes [https://github.com/linbox-team/fflas-ffpack/issues/42](https://github.com/linbox-team/fflas-ffpack/issues/42)


---

Comment by cpernet created at 2016-08-24 15:16:55

Changing status from needs_info to positive_review.


---

Comment by embray created at 2016-08-30 13:32:25

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).


---

Comment by embray created at 2016-08-30 13:32:25

Resolution: wontfix


---

Comment by saraedum created at 2018-08-24 03:07:34

See #26118 for a related issue.
