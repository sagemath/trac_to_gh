# Issue 14028: Update PPL to v1.0

Issue created by migration from https://trac.sagemath.org/ticket/14232

Original creator: vbraun

Original creation time: 2013-03-05 18:06:29

Assignee: tbd

CC:  novoselt dimpase

http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg

Apply trac_14201_ppl_doctest_fixes.patch


---

Comment by jdemeyer created at 2013-03-06 10:44:50

How about

```
sage: C_Polyhedron(1, 'empty').max_space_dimension()
357913940            # 32-bit
1152921504606846974  # 64-bit
```


I believe that's the standard way.


---

Comment by vbraun created at 2013-05-05 16:07:11

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-05-05 16:07:51

Done!


---

Comment by vbraun created at 2013-05-05 18:54:11

Updated patch


---

Attachment

Fixed the `# long` doctests, too


---

Comment by vbraun created at 2013-06-01 13:46:44

Straightforward version bump, still needs review


---

Comment by dimpase created at 2013-06-03 08:56:38

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2013-06-03 08:56:38

looks good.


---

Comment by jdemeyer created at 2013-06-04 14:01:12

This exposes #11391 on Ubuntu 13.04.


---

Comment by jdemeyer created at 2013-06-04 14:10:52

Working on a solution, hang on...


---

Comment by jdemeyer created at 2013-06-04 15:05:07

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-06-04 15:05:19

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-06-04 15:07:05

Added fix for #11391 and #12672, needs review.

spkg diff: [attachment:ppl-1.0.p0.diff]


---

Comment by vbraun created at 2013-06-04 16:06:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-06-04 16:06:40

Looks good to me.

I've updated the compilerwrapper to revert `LD_LIBRARY_PATH` to `SAGE_ORIG_LD_LIBRARY_PATH`, see #10572. This would be a generic way to avoid similar headache in the future, and slowly work towards getting rid of the whole `LD_LIBRARY_PATH` hack.


---

Attachment


---

Comment by jdemeyer created at 2013-06-06 19:37:24

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-06-06 19:37:37

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-06-06 20:21:52

looks good to me


---

Comment by vbraun created at 2013-06-06 20:21:52

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-06-08 19:52:39

Why do we configure PPL with `--disable-fpmath`? This was already present in the initial PPL spkg:

```
 * configure --disable-fpmath works now (since we don't use the
  floating point math stuff).
```



---

Attachment


---

Comment by jdemeyer created at 2013-06-10 11:40:06

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-06-10 11:41:35

In order to avoid race conditions which happen when GCC is ran while installing PPL, we need [attachment:14232_ppl_deps.patch]. This needs review.

I also made a further small change to the spkg to support the `PPL_CONFIGURE` environment variable, this also needs review.


---

Comment by jdemeyer created at 2013-06-10 11:41:35

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-06-10 11:56:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-06-10 11:56:33

The floating-point stuff in PPL needs a funky rounding mode set, so its not going to work as expected in Sage. Which is why I disabled it in the configure. 

This ticket is just a textbook case of the perils of abusing `LD_LIBRARY_PATH`.


---

Comment by jdemeyer created at 2013-06-11 15:01:24

Resolution: fixed


---

Comment by jdemeyer created at 2013-06-14 11:46:07

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2013-06-14 11:46:07

Changing status from closed to new.


---

Attachment


---

Comment by jdemeyer created at 2013-06-14 11:47:18

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-06-14 11:47:18

Added `GLPK` to `PPL` dependencies since PPL seems to use GLPK.

[attachment:14232_ppl_deps.patch] needs review.


---

Comment by jdemeyer created at 2013-06-14 11:54:07

It seems that there was a patch on #10039 to add the GLPK dependency, but by mistake, this patch wasn't merged.


---

Comment by dimpase created at 2013-06-14 12:44:40

Replying to [comment:24 jdemeyer]:
> It seems that there was a patch on #10039 to add the GLPK dependency, but by mistake, this patch wasn't merged.

indeed. See https://www.cs.unipr.it/mantis/view.php?id=500 which seems to say that the dependency on GLPK will eventually be gone, but not yet...


---

Comment by dimpase created at 2013-06-14 12:44:40

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-06-16 09:17:24

Resolution: fixed


---

Comment by leif created at 2015-05-03 00:28:09

Meanwhile at PPL 1.1, we have:

```
-rw-r--r-- 1 leif leif 57351174 2015-04-29 16:21 local/lib/libppl.a
-rw-r--r-- 1 leif leif 83958276 2015-04-29 16:21 local/lib/libppl_c.a
-rwxr-xr-x 1 leif leif     1236 2015-05-02 18:29 local/lib/libppl_c.la
lrwxrwxrwx 1 leif leif       17 2015-04-29 16:21 local/lib/libppl_c.so -> libppl_c.so.4.0.0
lrwxrwxrwx 1 leif leif       17 2015-04-29 16:21 local/lib/libppl_c.so.4 -> libppl_c.so.4.0.0
-rwxr-xr-x 1 leif leif 29967312 2015-04-29 16:21 local/lib/libppl_c.so.4.0.0
-rwxr-xr-x 1 leif leif     1156 2015-05-02 18:29 local/lib/libppl.la
lrwxrwxrwx 1 leif leif       16 2015-04-29 16:21 local/lib/libppl.so -> libppl.so.13.0.0
lrwxrwxrwx 1 leif leif       16 2015-04-29 16:21 local/lib/libppl.so.13 -> libppl.so.13.0.0
-rwxr-xr-x 1 leif leif 19604376 2015-04-29 16:21 local/lib/libppl.so.13.0.0
```


I.e., while the library version of libppl got bumped, libppl_c is still at 4 (the same version as in PPL 0.x!).

So we still have to build PPL "serially" (not in parallel with _other_ packages) to avoid potential race conditions with _old_ system GCCs linked against that version;  GCC 4.8 and any later version use ISL instead of PPL.  (And PPL was optionally used since GCC 4.4 IIRC, so the "critical" versions are 4.4.x to 4.7.x.)


---

Comment by leif created at 2015-05-03 00:31:48

(Once we require full C++11 support / GCC >= 4.8.1, we can change that.)


---

Comment by vbraun created at 2015-05-03 00:36:17

The real issue is a) abuse of `LD_LIBRARY_PATH` and b) necroposting on long-closed tickets ;-)


---

Comment by leif created at 2015-05-03 01:29:14

Replying to [comment:29 vbraun]:
> necroposting on long-closed tickets ;-)

ROFL.  I was just wondering whether it's still an issue (i.e., whether we could remove PPL from the sequential toolchain build) -- it is, so I didn't open a ticket for changing that; and as of Sage 6.7.beta3, `build/Makefile` still refers to this ticket:

```
# TOOLCHAIN consists of dependencies determined by build/install,
# including for example the GCC package.
toolchain: $(TOOLCHAIN)

# Build all packages that GCC links against serially, otherwise this
# leads to race conditions where some library which is used by GCC gets
# reinstalled. Since system GCCs might use Sage's libraries, we do this
# unconditionally. We still use the dependency checking from $(MAKE),
# so this will not trigger useless rebuilds.
# See #14168 and #14232.
toolchain-deps:
        $(MAKE) $(INST)/$(ZLIB)
        $(MAKE) $(INST)/$(SAGE_MP_LIBRARY)
        $(MAKE) $(INST)/$(MPFR)
        $(MAKE) $(INST)/$(MPC)
        $(MAKE) $(INST)/$(PPL)
```


You can open a new ticket for letting `build/Makefile` refer to some further new ticket of course.
