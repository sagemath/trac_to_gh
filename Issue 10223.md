# Issue 10223: upgrading qepcad-1.50.spkg to 1.54

Issue created by migration from Trac.

Original creator: bgoodri

Original creation time: 2010-11-05 16:30:35

Assignee: tbd

CC:  jason cwitty jondo

There exists a new upstream version of saclib (and qepcad) that compiles on 64 bit machines at

!http://www.usna.edu/Users/cs/qepcad/INSTALL/IQ.html

Chris Brown says "Version 1.54 adds portability to 64-bit systems.  Right now, I 	can only verify that it compiles and runs properly on 64-bit 	Ubuntu ... hopefully it's also OK on other 64-bit linux distros." I have built it outside of sage on 64 bit and 32 bit Debian without major difficulty.

Also, I think there could be some improvements to the QEPCAD interface, but it would probably be better for me to open separate tickets and base them on the updated spkg.


---

Comment by bgoodri created at 2010-11-24 04:42:47

Changing component from optional packages to experimental package.


---

Comment by bgoodri created at 2010-11-24 04:42:47

Changing status from new to needs_info.


---

Comment by maldun created at 2011-02-16 17:18:06

Works fine for me. (Ubuntu 10.10)

But did you make a Mercurial update of your changes?
If I build your package I get:

Created package qepcad-1.54.p0.spkg.

    NAME: qepcad
 VERSION: 1.54.p0
    SIZE: 4.0M
 HG REPO: Unchecked in changes
SPKG.txt: Good

Btw: Version 1.55 is out, perhaps try to use the new source.

Regards,
Stefan


---

Comment by kcrisman created at 2013-03-08 12:38:42

If this ever wants to leave experimental, it will need some changes.  See for instance [this sage-support thread](https://groups.google.com/forum/?fromgroups=#!topic/sage-support/-sdlVA8LCR0), where it seems some of the install scripts are tcsh (?!?), and #11933 confirms it doesn't build everywhere.  The spkg-install will need work, too - there is no checking whether saclib even builds correctly before going on!

This [spkg link](http://www.columbia.edu/~bg2382/sage/qepcad-1.54.p0.spkg) does still work for now, though, which is good!


---

Comment by jondo created at 2014-07-10 10:25:31

Updated the links in the description.


---

Comment by chapoton created at 2014-07-21 09:40:27

Changing keywords from "" to "qepcad".


---

Comment by kcrisman created at 2014-10-09 09:45:09

Note that http://trac.sagemath.org/ticket/16642 and https://groups.google.com/forum/#!topic/sage-support/X6U8FxnNuzU continue to confirm this optional package does not compile everywhere...


---

Comment by jondo created at 2014-12-05 08:37:44

I again updated the links to the QEPCAD pages.


---

Comment by mkoeppe created at 2015-04-16 03:06:16

There's a fork of qepcad with a CMake-based build system here: [https://github.com/PetterS/qepcad](https://github.com/PetterS/qepcad)

Still does not compile on Mac OS X because of gnu-libc-isms such as using "ieee754.h"



```
(sage-sh) mkoeppe`@`d245:qepcad$ cmake .
-- The C compiler identification is GNU 4.9.2
-- The CXX compiler identification is GNU 4.9.2
-- Checking whether C compiler has -isysroot
-- Checking whether C compiler has -isysroot - yes
-- Checking whether C compiler supports OSX deployment target flag
-- Checking whether C compiler supports OSX deployment target flag - yes
-- Check for working C compiler: /Users/mkoeppe/s/sage/sage-6.5/local/bin/gcc
-- Check for working C compiler: /Users/mkoeppe/s/sage/sage-6.5/local/bin/gcc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Checking whether CXX compiler has -isysroot
-- Checking whether CXX compiler has -isysroot - yes
-- Checking whether CXX compiler supports OSX deployment target flag
-- Checking whether CXX compiler supports OSX deployment target flag - yes
-- Check for working CXX compiler: /Users/mkoeppe/s/sage/sage-6.5/local/bin/g++
-- Check for working CXX compiler: /Users/mkoeppe/s/sage/sage-6.5/local/bin/g++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- No build type specified; defaulting to CMAKE_BUILD_TYPE=Release.
-- Configuring done
-- Generating done
-- Build files have been written to: /Users/mkoeppe/s/qepcad
(sage-sh) mkoeppe`@`d245:qepcad$ make
Scanning dependencies of target saclib
[  0%] Building C object CMakeFiles/saclib.dir/saclib/src/AADV.c.o
In file included from /Users/mkoeppe/s/qepcad/saclib/include/saclib.h:11:0,
                 from /Users/mkoeppe/s/qepcad/saclib/src/AADV.c:13:
/Users/mkoeppe/s/qepcad/saclib/include/hfloats.h:23:21: fatal error: ieee754.h: No such file or directory
 #include <ieee754.h>
                     ^
compilation terminated.
make[2]: *** [CMakeFiles/saclib.dir/saclib/src/AADV.c.o] Error 1
make[1]: *** [CMakeFiles/saclib.dir/all] Error 2
make: *** [all] Error 2
```



---

Comment by mkoeppe created at 2015-04-28 17:08:43

Changing status from needs_info to needs_work.


---

Comment by tmonteil created at 2015-06-25 23:03:21

Changing component from packages: experimental to packages: optional.


---

Comment by tmonteil created at 2015-06-25 23:03:21

Changing status from needs_work to needs_review.


---

Comment by tmonteil created at 2015-06-25 23:03:21

Changing type from task to enhancement.


---

Comment by tmonteil created at 2015-06-25 23:03:21

Changing priority from minor to major.


---

Comment by tmonteil created at 2015-06-25 23:03:21

I made two (new-style) packages for latest saclib and qepcad, see the branch. According to `saclib2.2.6/sysdep`, this should build on `linuxX86`, `linuxX86_64`, `macosX86`, `macosX86_64`, `solarisSparc`. The packages work well on my Debian/jessie/65bits. Let's see if you can let it work on mac (i cannot test myself). I updated instructions on the ticket description.
----
New commits:


---

Comment by mkoeppe created at 2015-06-25 23:49:38

Quick fix for non-GNU find on Mac OS X:


```
diff --git a/build/pkgs/qepcad/spkg-install b/build/pkgs/qepcad/spkg-install
index 01f850e..1f7566b 100755
--- a/build/pkgs/qepcad/spkg-install
+++ b/build/pkgs/qepcad/spkg-install
`@``@` -42,7 +42,7 `@``@` fi
 
 
 # install binaries to the Sage tree
-find -name *.a -exec cp {} $SAGE_LOCAL/lib/
+find . -name *.a -exec cp {} $SAGE_LOCAL/lib/ \;
 cp source/qepcad $SAGE_LOCAL/bin/
 cp bin/qepcad.help $SAGE_LOCAL/bin/
 cp ../sage-qepcad $SAGE_LOCAL/bin/

```


Unfortunately it segfaults:


```
(sage-sh) mkoeppe`@`d100:sage-develop$ qepcad
Segmentation fault: 11
```


Only the help screen works:

```
(sage-sh) mkoeppe`@`d100:sage-develop$ qepcad -h
usage: qepcad [-h] [-noecho] [+N<numcells>]

QEPCAD B v1.69 is a program for studying Cylindrical Algebraic Decomposition (CAD). It constructs CADs from an input formula and 
variable order, and provides many commands for getting info out of the CAD, including construction of simple equivalent Tarski 
formulas.

Options
-h      : Help information
-noecho : Turns off echoing of input

Saclib options
+N<numcells> : Sets garbage collected space to <numcells>.  Default is 2000000.
```



---

Comment by git created at 2015-06-26 00:00:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-26 00:06:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-06-26 00:08:33

Replying to [comment:16 mkoeppe]:
> Quick fix for non-GNU find on Mac OS X:

Done.

> Unfortunately it segfaults:

Could you try again with the new branch and the `sage-qepcad` command instead of `qepcad` ?


---

Comment by tmonteil created at 2015-06-26 00:10:57

Could you also try from Sage if you get the following behaviour:


```
sage: var('a,b,c,d,x,y,z')
(a, b, c, d, x, y, z)
sage: qf = qepcad_formula
sage: ellipse = 3*x^2 + 2*x*y + y^2 - x + y - 7
sage: F = qf.exists(y, ellipse == 0); F
(E y)[3 x^2 + 2 x y + y^2 - x + y - 7 = 0]
sage: qepcad(F)
8 x^2 - 8 x - 29 <= 0
```



---

Comment by tmonteil created at 2015-06-26 00:13:49

There are also some failed (but correct) doctests to fix.


---

Comment by tmonteil created at 2015-06-26 00:13:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-06-26 00:21:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-06-26 00:23:27

The following should also work:


```
sage -t --optional=sage,qepcad $SAGE_ROOT/src/sage/interfaces/qepcad.py
```



---

Comment by tmonteil created at 2015-06-26 00:23:27

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-06-26 00:28:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2015-06-26 00:30:04

Works for me now! Thanks very much for working on this!


```
sage -t --optional=sage,qepcad $SAGE_ROOT/src/sage/interfaces/qepcad.py
too few successful tests, not using stored timings

Running doctests with ID 2015-06-25-17-27-17-09f49200.
Git branch: t/10224/saclib_2_2_6_qepcad_B_1_69
Using --optional=qepcad,sage
Doctesting 1 file.
sage -t src/sage/interfaces/qepcad.py
    [317 tests, 4.58 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by tmonteil created at 2015-06-26 01:24:25

Great!


---

Comment by ncohen created at 2015-06-26 14:33:59

Helloooooooooooo,

Just leaving a note here that if you create a new-style package that replaces an old-style package (it seems to be the case for qepcad?) then somebody should ask Harald to remove the old-style package from the "optional/" folder on the mirrors, and move it to the "archive/" folder instead.

Otherwise we will be having consistency problems at some point.

Thanks,

Nathann


---

Comment by dimpase created at 2015-06-30 10:46:19

on a 32-bit machine I get:

```
./sage -tp --long --optional=gcc,lidia,mpir,normaliz,python2,sage,scons,qepcad src/sage/interfaces/qepcad.py 
Running doctests with ID 2015-06-30-11-43-27-4a2e1119.
Git branch: qep
Using --optional=gcc,lidia,mpir,normaliz,python2,qepcad,sage,scons
Doctesting 1 file using 4 threads.
sage -t --long --warn-long 73.3 src/sage/interfaces/qepcad.py
**********************************************************************
File "src/sage/interfaces/qepcad.py", line 98, in sage.interfaces.qepcad
Failed example:
    qepcad(F)                                         # optional - qepcad
Expected:
    x^2 - 3 <= 0 /\ 8 x^2 - 8 x - 29 <= 0 /\ 8 x^4 - 26 x^2 - 4 x + 13 >= 0 /\ [ 8 x^4 - 26 x^2 - 4 x + 13 = 0 \/ x^2 - 3 = 0 \/ 8 x^2 - 8 x - 29 = 0 ]
Got:
    8 x^2 - 8 x - 29 <= 0 /\ x^2 - 3 <= 0 /\ 8 x^4 - 26 x^2 - 4 x + 13 >= 0 /\ [ 8 x^4 - 26 x^2 - 4 x + 13 = 0 \/ x^2 - 3 = 0 \/ 8 x^2 - 8 x - 29 = 0 ]
**********************************************************************
1 item had failures:
   1 of  60 in sage.interfaces.qepcad
    [317 tests, 1 failure, 3.25 s]
----------------------------------------------------------------------
sage -t --long --warn-long 73.3 src/sage/interfaces/qepcad.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 23.2 seconds
    cpu time: 1.5 seconds
    cumulative wall time: 3.2 seconds
```


i.e. the inequalities might come up in a different order.


---

Comment by tmonteil created at 2015-07-08 17:24:53

Replying to [comment:28 dimpase]:
> on a 32-bit machine I get:
> {{{
> [...]
> }}}
> 
> i.e. the inequalities might come up in a different order.

I propose to add a "not tested" flag to those examples in order not to pollute the tutorial, and then add tests that transforms the string to a set of substrings so that we can test equality. Does it makes sense ?


---

Comment by git created at 2015-07-11 20:27:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-07-11 20:36:18

Replying to [comment:28 dimpase]:
> i.e. the inequalities might come up in a different order.

I did the changes i proposed in [comment:29]. Does the doctests now work with your 32-bit machine ?


---

Comment by dimpase created at 2015-07-11 21:46:48

Replying to [comment:30 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[1fa7536](http://git.sagemath.org/sage.git/commit/?id=1fa75365546630b87a40559723c7b7515110410c)||`#10224 : add a _qepcad_atoms() function to deal with the nondeterministic order of formulas in doctests.`||
> ||[0535b3a](http://git.sagemath.org/sage.git/commit/?id=0535b3a228e65609f6ecd85837af2eb999b73280)||`#10224 : remove useless "# optional - qepcad".`||

why are `# optional - qepcad` useless?


---

Comment by tmonteil created at 2015-07-12 11:16:03

Replying to [comment:32 dimpase]:
> why are `# optional - qepcad` useless?

I meant: among the occurrences of `# optional - qepcad` i removed the uselesses, that is the one for which the tests can be run without `qepcad` installed.

Typically, the calls to `qepcad_formula` do only create some srtings, they not require `qepcad` to be installed. Only the calls to the `qepcad` command require `qepcad` to be installed.


---

Comment by tmonteil created at 2015-07-12 11:16:58

To get convinced that they were not needed, just run the doctests without `qepcad` installed.


---

Comment by dimpase created at 2015-07-12 13:52:09

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2015-07-12 13:52:09

LGTM


---

Comment by jdemeyer created at 2015-07-12 16:22:42

Replying to [comment:29 tmonteil]:
> I propose to add a "not tested" flag to those examples in order not to pollute the tutorial, and then add tests that transforms the string to a set of substrings so that we can test equality. Does it makes sense ?

Better use `# random` instead of `# not tested` if you want to run the tests but not check the output.


---

Comment by jdemeyer created at 2015-07-12 16:23:19

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2015-07-12 16:23:19

Also reviewer name is missing...


---

Comment by dimpase created at 2015-07-12 20:25:47

OK, I'd be happy to give a positive review once the  change proposed by Jeroen is done.


---

Comment by tmonteil created at 2015-07-12 21:01:58

Replying to [comment:36 jdemeyer]:
> Better use `# random` instead of `# not tested` if you want to run the tests but not check the output.

Actually, the tests tagged `# not tested` are run in the `TESTS:` section that follows the `EXAMPLE:` section where it appears, but there, the output is sent to a function that makes a set of atoms so that the difference of ordering (that seems arch dependent) is taken into account. So, be both have meaningful user-friendly examples and the doctest are still executed and partially checked. Hence, if i replace `# not tested` with `# random` in the `EXAMPLE:` section, those tests will be run twice and take longer. I do not mind doing this, but i do not see the point since any test is already run at least once. Tell me.


---

Comment by jdemeyer created at 2015-07-12 21:20:15

OK, I see your point.

One reason to still have `# random` is to make it more explicit that the output of the test is random. When a test says "not tested", it is not clear why it is not tested. At the very least, write something like `# not tested (random order)`.

How much time do those tests take? If we're talking about a few seconds, then I would just use `# random`.

And the reviewer name is still missing.


---

Comment by git created at 2015-07-14 11:09:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-07-14 11:11:32

Changing status from needs_work to needs_review.


---

Comment by tmonteil created at 2015-07-14 11:11:32

Replying to [comment:40 jdemeyer]:
> At the very least, write something like `# not tested (random order)`.

I like this alternative, both explicit and not redundant.


---

Comment by novoselt created at 2015-08-12 20:35:55

Replying to [comment:38 dimpase]:
> OK, I'd be happy to give a positive review once the  change proposed by Jeroen is done.

So - it is done and can be positive reviewed? (I don't really follow what is going on here, but I will add these packages to SageMathCell when they are ready.)


---

Comment by dimpase created at 2015-08-12 22:45:33

trying this with the latest beta, and seeing that one needs to set "make -j1" in order to build qepcad successfully. At least for me...


---

Comment by dimpase created at 2015-08-12 22:57:03

added one more commit to indicate the latter issue in SPKG.txt


---

Comment by dimpase created at 2015-08-12 22:57:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-08-13 20:21:19

Resolution: fixed


---

Comment by novoselt created at 2015-08-26 17:42:10

Given that it fails consistently with "make -j2" and most likely parallel building is enabled, shouldn't the build script enforce "make -j1" rather than mention it somewhere?..


---

Comment by rws created at 2015-10-24 14:27:29

Replying to [comment:48 novoselt]:
> Given that it fails consistently with "make -j2" and most likely parallel building is enabled, shouldn't the build script enforce "make -j1" rather than mention it somewhere?..
Exactly, please review #19450.


---

Comment by jondo created at 2015-10-30 07:58:16

This issue's component is `packages: optional`. Currently the package is 'experimental'.
In order to promote it to 'optional', it needs to [build on all supported systems](http://doc.sagemath.org/html/en/developer/packaging.html#inclusion-procedure-for-new-and-updated-packages). Is this already the case?
