# Issue 29256: Failing tests when using system glpk

archive/issues_029256.json:
```json
{
    "body": "CC:  @jdemeyer @mkoeppe @orlitzky jpflori @embray gouezel @kiwifb @dcoudert @dimpase\n\nKeywords: glpk, patches\n\nAt the moment there are two failing doctests, when using the glpk from the system, e.g. on ubuntu eoan [https://github.com/mkoeppe/sage/runs/542655821](https://github.com/mkoeppe/sage/runs/542655821)\n\n\n```\nsage -t src/sage/numerical/backends/glpk_backend.pyx\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 2287, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\nFailed example:\n    p.print_ranges()\nExpected:\n    glp_print_ranges: optimal basic solution required\n    1\nGot:\n    1\n```\n\n\nThis doctest was mentioned before in #29317 with a suggestion for a fix.\n\n\n```\n sage -t src/sage/libs/glpk/error.pyx\n**********************************************************************\nFile \"src/sage/libs/glpk/error.pyx\", line 100, in sage.libs.glpk.error.setup_glpk_error_handler\nFailed example:\n    res = p.solve()\nExpected:\n          0: obj = ...\nGot:\n    <BLANKLINE>\n```\n\n\nThe problem seems to be that we have a custom patch [https://trac.sagemath.org/ticket/20710#comment:18](https://trac.sagemath.org/ticket/20710#comment:18),\nwhich wasn't accepted by upstream. The doctest was added in #20832.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29493\n\n",
    "created_at": "2020-04-10T14:31:15Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Failing tests when using system glpk",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29256",
    "user": "https://github.com/kliem"
}
```
CC:  @jdemeyer @mkoeppe @orlitzky jpflori @embray gouezel @kiwifb @dcoudert @dimpase

Keywords: glpk, patches

At the moment there are two failing doctests, when using the glpk from the system, e.g. on ubuntu eoan [https://github.com/mkoeppe/sage/runs/542655821](https://github.com/mkoeppe/sage/runs/542655821)


```
sage -t src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 2287, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
Failed example:
    p.print_ranges()
Expected:
    glp_print_ranges: optimal basic solution required
    1
Got:
    1
```


This doctest was mentioned before in #29317 with a suggestion for a fix.


```
 sage -t src/sage/libs/glpk/error.pyx
**********************************************************************
File "src/sage/libs/glpk/error.pyx", line 100, in sage.libs.glpk.error.setup_glpk_error_handler
Failed example:
    res = p.solve()
Expected:
          0: obj = ...
Got:
    <BLANKLINE>
```


The problem seems to be that we have a custom patch [https://trac.sagemath.org/ticket/20710#comment:18](https://trac.sagemath.org/ticket/20710#comment:18),
which wasn't accepted by upstream. The doctest was added in #20832.

Issue created by migration from https://trac.sagemath.org/ticket/29493





---

archive/issue_comments_414123.json:
```json
{
    "body": "What we could do is add a new testing flag style `# optional - sage-glpk` (and for any other package).\nThis would than only be tested when sage build it's own version of the package.\n\nThis could also be used for #29092 and make the tests nicer for #29417.",
    "created_at": "2020-04-10T19:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414123",
    "user": "https://github.com/kliem"
}
```

What we could do is add a new testing flag style `# optional - sage-glpk` (and for any other package).
This would than only be tested when sage build it's own version of the package.

This could also be used for #29092 and make the tests nicer for #29417.



---

archive/issue_events_075189.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-14T10:08:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29256#event-75189"
}
```



---

archive/issue_comments_414124.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2020-04-14T10:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414124",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_414125.json:
```json
{
    "body": "We should/will have a general discussion about things like this on sage-devel after 9.1 is released.",
    "created_at": "2020-04-14T10:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414125",
    "user": "https://github.com/kliem"
}
```

We should/will have a general discussion about things like this on sage-devel after 9.1 is released.



---

archive/issue_comments_414126.json:
```json
{
    "body": "How about a patch like this? Simpler than adding a new tag.\n\n```diff\ndiff --git a/src/sage/doctest/parsing.py b/src/sage/doctest/parsing.py\nindex ebf7555106..503ad17e6f 100644\n--- a/src/sage/doctest/parsing.py\n+++ b/src/sage/doctest/parsing.py\n@@ -44,6 +44,7 @@ optional_regex = re.compile(r'(py2|py3|long time|not implemented|not tested|know\n # which has not been patched, we need to ignore that message.\n # See :trac:`29317`.\n glpk_simplex_warning_regex = re.compile(r'(Long-step dual simplex will be used)')\n+glpk_print_ranges_regex = re.compile(r'(glp_print_ranges: optimal basic solution required)')\n find_sage_prompt = re.compile(r\"^(\\s*)sage: \", re.M)\n find_sage_continuation = re.compile(r\"^(\\s*)\\.\\.\\.\\.:\", re.M)\n find_python_continuation = re.compile(r\"^(\\s*)\\.\\.\\.([^\\.])\", re.M)\n@@ -1077,6 +1078,7 @@ class SageOutputChecker(doctest.OutputChecker):\n         \"\"\"\n         got = self.human_readable_escape_sequences(got)\n         got = glpk_simplex_warning_regex.sub('', got)\n+        got = glpk_print_ranges_regex.sub('', got)\n         if isinstance(want, MarkedOutput):\n             if want.random:\n                 return True\ndiff --git a/src/sage/libs/glpk/error.pyx b/src/sage/libs/glpk/error.pyx\nindex f7046b3ec4..26faf1e8d9 100644\n--- a/src/sage/libs/glpk/error.pyx\n+++ b/src/sage/libs/glpk/error.pyx\n@@ -98,7 +98,7 @@ def setup_glpk_error_handler():\n         sage: p.add_constraint(x >= 0)\n         sage: p.set_objective(x + y)\n         sage: res = p.solve()\n-              0: obj = ...\n+        ...\n         sage: res  # rel tol 1e-15\n         2.4\n     \"\"\"\ndiff --git a/src/sage/numerical/backends/glpk_backend.pyx b/src/sage/numerical/backends/glpk_backend.pyx\nindex b1acf12a28..4b2d12eddc 100644\n--- a/src/sage/numerical/backends/glpk_backend.pyx\n+++ b/src/sage/numerical/backends/glpk_backend.pyx\n@@ -2285,7 +2285,6 @@ cdef class GLPKBackend(GenericBackend):\n             sage: import sage.numerical.backends.glpk_backend as backend\n             sage: p.solver_parameter(backend.glp_simplex_or_intopt, backend.glp_simplex_only)\n             sage: p.print_ranges()\n-            glp_print_ranges: optimal basic solution required\n             1\n             sage: p.solve()\n             0\n```\n",
    "created_at": "2020-04-29T18:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414126",
    "user": "https://github.com/jhpalmieri"
}
```

How about a patch like this? Simpler than adding a new tag.

```diff
diff --git a/src/sage/doctest/parsing.py b/src/sage/doctest/parsing.py
index ebf7555106..503ad17e6f 100644
--- a/src/sage/doctest/parsing.py
+++ b/src/sage/doctest/parsing.py
@@ -44,6 +44,7 @@ optional_regex = re.compile(r'(py2|py3|long time|not implemented|not tested|know
 # which has not been patched, we need to ignore that message.
 # See :trac:`29317`.
 glpk_simplex_warning_regex = re.compile(r'(Long-step dual simplex will be used)')
+glpk_print_ranges_regex = re.compile(r'(glp_print_ranges: optimal basic solution required)')
 find_sage_prompt = re.compile(r"^(\s*)sage: ", re.M)
 find_sage_continuation = re.compile(r"^(\s*)\.\.\.\.:", re.M)
 find_python_continuation = re.compile(r"^(\s*)\.\.\.([^\.])", re.M)
@@ -1077,6 +1078,7 @@ class SageOutputChecker(doctest.OutputChecker):
         """
         got = self.human_readable_escape_sequences(got)
         got = glpk_simplex_warning_regex.sub('', got)
+        got = glpk_print_ranges_regex.sub('', got)
         if isinstance(want, MarkedOutput):
             if want.random:
                 return True
diff --git a/src/sage/libs/glpk/error.pyx b/src/sage/libs/glpk/error.pyx
index f7046b3ec4..26faf1e8d9 100644
--- a/src/sage/libs/glpk/error.pyx
+++ b/src/sage/libs/glpk/error.pyx
@@ -98,7 +98,7 @@ def setup_glpk_error_handler():
         sage: p.add_constraint(x >= 0)
         sage: p.set_objective(x + y)
         sage: res = p.solve()
-              0: obj = ...
+        ...
         sage: res  # rel tol 1e-15
         2.4
     """
diff --git a/src/sage/numerical/backends/glpk_backend.pyx b/src/sage/numerical/backends/glpk_backend.pyx
index b1acf12a28..4b2d12eddc 100644
--- a/src/sage/numerical/backends/glpk_backend.pyx
+++ b/src/sage/numerical/backends/glpk_backend.pyx
@@ -2285,7 +2285,6 @@ cdef class GLPKBackend(GenericBackend):
             sage: import sage.numerical.backends.glpk_backend as backend
             sage: p.solver_parameter(backend.glp_simplex_or_intopt, backend.glp_simplex_only)
             sage: p.print_ranges()
-            glp_print_ranges: optimal basic solution required
             1
             sage: p.solve()
             0
```




---

archive/issue_comments_414127.json:
```json
{
    "body": "It's certainly simpler than adding the tag. However there are two problems:\n\n- In #20710 people agreed that this patch is necessary. Is it ok to ignore it, if the system package is present? Do we warn the user that this package has some API problems with sage? (This is a more general issue, as there should be some agreement on how much failure do we accept when a system package is used.)\n- Isn't your approach the same as removing those tests. That would lead to us never noticing when #20710 breaks (unless the patch causes build failure of course).\n\nThe idea of the tag is that there might be tests that only pass when the sage-build package is used, e.g. #29092. With the tag we would properly document that this works with sage install of the package, but it might not otherwise. But there are probably better ideas out there.",
    "created_at": "2020-04-29T20:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414127",
    "user": "https://github.com/kliem"
}
```

It's certainly simpler than adding the tag. However there are two problems:

- In #20710 people agreed that this patch is necessary. Is it ok to ignore it, if the system package is present? Do we warn the user that this package has some API problems with sage? (This is a more general issue, as there should be some agreement on how much failure do we accept when a system package is used.)
- Isn't your approach the same as removing those tests. That would lead to us never noticing when #20710 breaks (unless the patch causes build failure of course).

The idea of the tag is that there might be tests that only pass when the sage-build package is used, e.g. #29092. With the tag we would properly document that this works with sage install of the package, but it might not otherwise. But there are probably better ideas out there.



---

archive/issue_comments_414128.json:
```json
{
    "body": "To me there are two issues:\n- what are these doctests trying to test? For the one in `glpk_backend.pyx`, is the extra message useful or can it be ignored? I don't know the answers, by the way.\n- re whether the patch is necessary: that should have been a discussion in the ticket which set up the spkg-configure.m4 file for glpk, which allows users to use the system version instead of Sage's. Should build/pkgs/glpk/spkg-configure.m4 somehow test this feature of Sage's glpk and not allow others?\n\nAdding a tag to the doctest so it is only run when Sage's glpk is used also ignores whether the patch is necessary, so it doesn't really solve the problem, except to test whether Sage's glpk built correctly. Since the momentum is toward using more system packages, people who know about glpk (i.e., not me) need to decide whether to continue allowing use of unpatched system versions. If so, then in my opinion we should test Sage's modifications to glpk in its own test suite (spkg-check) and fix the doctests so they work with all versions.",
    "created_at": "2020-04-29T21:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414128",
    "user": "https://github.com/jhpalmieri"
}
```

To me there are two issues:
- what are these doctests trying to test? For the one in `glpk_backend.pyx`, is the extra message useful or can it be ignored? I don't know the answers, by the way.
- re whether the patch is necessary: that should have been a discussion in the ticket which set up the spkg-configure.m4 file for glpk, which allows users to use the system version instead of Sage's. Should build/pkgs/glpk/spkg-configure.m4 somehow test this feature of Sage's glpk and not allow others?

Adding a tag to the doctest so it is only run when Sage's glpk is used also ignores whether the patch is necessary, so it doesn't really solve the problem, except to test whether Sage's glpk built correctly. Since the momentum is toward using more system packages, people who know about glpk (i.e., not me) need to decide whether to continue allowing use of unpatched system versions. If so, then in my opinion we should test Sage's modifications to glpk in its own test suite (spkg-check) and fix the doctests so they work with all versions.



---

archive/issue_comments_414129.json:
```json
{
    "body": "I agree that moving the second test makes more sense than an extra flag. (Unless of course people decide that this is unacceptable.)\n\nThe first tests should stay there though, as I don't think it is there to test the warning message. So your fix would be just fine.",
    "created_at": "2020-04-29T21:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414129",
    "user": "https://github.com/kliem"
}
```

I agree that moving the second test makes more sense than an extra flag. (Unless of course people decide that this is unacceptable.)

The first tests should stay there though, as I don't think it is there to test the warning message. So your fix would be just fine.



---

archive/issue_comments_414130.json:
```json
{
    "body": "What problem was this patch trying to solve? The GLPK documentation states,\n\n> If some GLPK API routine detects erroneous or incorrect data passed by the application program,\n> it writes appropriate diagnostic messages to the terminal and then abnormally terminates\n> the application program. In most practical cases this allows to simplify programming by avoiding\n> numerous checks of return codes. Thus, in order to prevent crashing the application program should\n> check all data, which are suspected to be incorrect, before calling GLPK API routines.\n>\n> Should note that this kind of error handling is used only in cases of incorrect data passed by\n> the application program. If, for example, the application program calls some GLPK API routine\n> to read data from an input file and these data are incorrect, the GLPK API routine reports about\n> error in the usual way by means of the return code.\n\nGiven that the doctest in `sage/libs/glpk/error.pyx` has to go to great lengths to crash glpk...\n\n\n```\nsage: cython('''\n....: # distutils: libraries = glpk z gmp\n....: from cysignals.signals cimport sig_on, sig_off\n....: from sage.libs.glpk.env cimport glp_term_out\n....:\n....: sig_on()\n....: glp_term_out(12345)  # invalid value\n....: sig_off()\n....: ''')\nTraceback (most recent call last):\n```\n\n\nwhat sort of real problems are we expecting this to catch during normal sage usage? Is there any place that a user passes data directly to glpk that we can't inspect/preprocess first, to ensure that it's correct? If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.",
    "created_at": "2020-05-30T02:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414130",
    "user": "https://github.com/orlitzky"
}
```

What problem was this patch trying to solve? The GLPK documentation states,

> If some GLPK API routine detects erroneous or incorrect data passed by the application program,
> it writes appropriate diagnostic messages to the terminal and then abnormally terminates
> the application program. In most practical cases this allows to simplify programming by avoiding
> numerous checks of return codes. Thus, in order to prevent crashing the application program should
> check all data, which are suspected to be incorrect, before calling GLPK API routines.
>
> Should note that this kind of error handling is used only in cases of incorrect data passed by
> the application program. If, for example, the application program calls some GLPK API routine
> to read data from an input file and these data are incorrect, the GLPK API routine reports about
> error in the usual way by means of the return code.

Given that the doctest in `sage/libs/glpk/error.pyx` has to go to great lengths to crash glpk...


```
sage: cython('''
....: # distutils: libraries = glpk z gmp
....: from cysignals.signals cimport sig_on, sig_off
....: from sage.libs.glpk.env cimport glp_term_out
....:
....: sig_on()
....: glp_term_out(12345)  # invalid value
....: sig_off()
....: ''')
Traceback (most recent call last):
```


what sort of real problems are we expecting this to catch during normal sage usage? Is there any place that a user passes data directly to glpk that we can't inspect/preprocess first, to ensure that it's correct? If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.



---

archive/issue_comments_414131.json:
```json
{
    "body": "For example, one of the GLPK crashes that we catch and throw is,\n\n\n```\nsage: from sage.numerical.backends.generic_backend import get_solver\nsage: p = get_solver(solver=\"GLPK\")\nsage: p.variable_upper_bound(2)\n...\nGLPKError: glp_get_col_ub: j = 3; column number out of range\n```\n\n\nThe problem? We assume that the index `2` was valid, and use GLPK crashing as an indication that it isn't. Instead, we should just check that the index is valid (i.e. use the API correctly):\n\n\n```\nsage: from sage.numerical.backends.generic_backend import get_solver\nsage: p = get_solver(solver=\"GLPK\")\nsage: p.ncols()\n0\nsage: p.add_variable()\n0\nsage: p.add_variable()\n1\nsage: p.add_variable()\n2\nsage: p.ncols()\n3\nsage: p.variable_upper_bound(2)\n<no crash>\n```\n\n\nTada, one down.",
    "created_at": "2020-05-30T03:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414131",
    "user": "https://github.com/orlitzky"
}
```

For example, one of the GLPK crashes that we catch and throw is,


```
sage: from sage.numerical.backends.generic_backend import get_solver
sage: p = get_solver(solver="GLPK")
sage: p.variable_upper_bound(2)
...
GLPKError: glp_get_col_ub: j = 3; column number out of range
```


The problem? We assume that the index `2` was valid, and use GLPK crashing as an indication that it isn't. Instead, we should just check that the index is valid (i.e. use the API correctly):


```
sage: from sage.numerical.backends.generic_backend import get_solver
sage: p = get_solver(solver="GLPK")
sage: p.ncols()
0
sage: p.add_variable()
0
sage: p.add_variable()
1
sage: p.add_variable()
2
sage: p.ncols()
3
sage: p.variable_upper_bound(2)
<no crash>
```


Tada, one down.



---

archive/issue_comments_414132.json:
```json
{
    "body": "Maybe someone involved #20710 can help us figure out, if we can drop this patch.",
    "created_at": "2020-05-30T08:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414132",
    "user": "https://github.com/kliem"
}
```

Maybe someone involved #20710 can help us figure out, if we can drop this patch.



---

archive/issue_comments_414133.json:
```json
{
    "body": "Running `git grep GLPKError` shows all of the instances that we need to worry about. And all except two look like missing bounds checks that can be turned into a`ValueError`.\n\nThat leaves:\n\n\n```\n.. WARNING::\n\n    Sage uses GLPK's ``glp_intopt`` to find solutions.\n    This routine sometimes FAILS CATASTROPHICALLY\n    when given a system it cannot solve. (:trac:`12309`.)\n    Here, \"catastrophic\" can mean either \"infinite loop\" or\n    segmentation fault. Upstream considers this behavior\n    \"essentially innate\" to their design, and suggests\n    preprocessing it with ``glp_simplex`` first.\n    Thus, if you suspect that your system is infeasible,\n    set the ``preprocessing`` option first.\n\nEXAMPLES::\n\n    sage: lp = MixedIntegerLinearProgram(solver = \"GLPK\")\n    sage: v = lp.new_variable(nonnegative=True)\n    sage: lp.add_constraint(v[1] +v[2] -2.0 *v[3], max=-1.0)\n    sage: lp.add_constraint(v[0] -4.0/3 *v[1] +1.0/3 *v[2], max=-1.0/3)\n    sage: lp.add_constraint(v[0] +0.5 *v[1] -0.5 *v[2] +0.25 *v[3], max=-0.25)\n    sage: lp.solve()\n    0.0\n    sage: lp.add_constraint(v[0] +4.0 *v[1] -v[2] +v[3], max=-1.0)\n    sage: lp.solve()\n    Traceback (most recent call last):\n    ...\n    GLPKError: Assertion failed: ...\n    sage: lp.solver_parameter(\"simplex_or_intopt\", \"simplex_then_intopt\")\n    sage: lp.solve()\n    Traceback (most recent call last):\n    ...\n    MIPSolverException: GLPK: Problem has no feasible solution\n```\n\n\nI've included the **WARNING** block from just prior to the doctest, because it tells us how to fix this problem. Instead of an unsafe default, we should enable preprocessing but let the user disable it if he thinks he knows what he's doing (and is willing to crash sage if he's wrong).\n\nAnd the other instance:\n\n\n```\ncpdef eval_tab_row(self, int k):\n    r\"\"\"\n    Computes a row of the current simplex tableau.\n    ...\n    try:\n        sig_on()            # to catch GLPKError\n        i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)\n        sig_off()\n    except GLPKError:\n        raise MIPSolverException('GLPK: basis factorization does not exist; or variable must be basic')\n```\n\n\nI haven't computed a tableau in about a decade. Is that something we can check before we call `glp_eval_tab_row()`?",
    "created_at": "2020-05-30T12:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414133",
    "user": "https://github.com/orlitzky"
}
```

Running `git grep GLPKError` shows all of the instances that we need to worry about. And all except two look like missing bounds checks that can be turned into a`ValueError`.

That leaves:


```
.. WARNING::

    Sage uses GLPK's ``glp_intopt`` to find solutions.
    This routine sometimes FAILS CATASTROPHICALLY
    when given a system it cannot solve. (:trac:`12309`.)
    Here, "catastrophic" can mean either "infinite loop" or
    segmentation fault. Upstream considers this behavior
    "essentially innate" to their design, and suggests
    preprocessing it with ``glp_simplex`` first.
    Thus, if you suspect that your system is infeasible,
    set the ``preprocessing`` option first.

EXAMPLES::

    sage: lp = MixedIntegerLinearProgram(solver = "GLPK")
    sage: v = lp.new_variable(nonnegative=True)
    sage: lp.add_constraint(v[1] +v[2] -2.0 *v[3], max=-1.0)
    sage: lp.add_constraint(v[0] -4.0/3 *v[1] +1.0/3 *v[2], max=-1.0/3)
    sage: lp.add_constraint(v[0] +0.5 *v[1] -0.5 *v[2] +0.25 *v[3], max=-0.25)
    sage: lp.solve()
    0.0
    sage: lp.add_constraint(v[0] +4.0 *v[1] -v[2] +v[3], max=-1.0)
    sage: lp.solve()
    Traceback (most recent call last):
    ...
    GLPKError: Assertion failed: ...
    sage: lp.solver_parameter("simplex_or_intopt", "simplex_then_intopt")
    sage: lp.solve()
    Traceback (most recent call last):
    ...
    MIPSolverException: GLPK: Problem has no feasible solution
```


I've included the **WARNING** block from just prior to the doctest, because it tells us how to fix this problem. Instead of an unsafe default, we should enable preprocessing but let the user disable it if he thinks he knows what he's doing (and is willing to crash sage if he's wrong).

And the other instance:


```
cpdef eval_tab_row(self, int k):
    r"""
    Computes a row of the current simplex tableau.
    ...
    try:
        sig_on()            # to catch GLPKError
        i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)
        sig_off()
    except GLPKError:
        raise MIPSolverException('GLPK: basis factorization does not exist; or variable must be basic')
```


I haven't computed a tableau in about a decade. Is that something we can check before we call `glp_eval_tab_row()`?



---

archive/issue_comments_414134.json:
```json
{
    "body": "Replying to [comment:10 mjo]:\n> \n> I haven't computed a tableau in about a decade. Is that something we can check before we call `glp_eval_tab_row()`?\n\nYup. I'm in the process of fixing all of these. From the GLPK docs:\n\n**Synopsis**:\n  int glp_bf_exists(glp_prob *P);\n**Comments**:\n... So before calling any API routine, which uses the basis factorization, the application program must make sure (using the routine `glp_bf_exists`) that the factorization exists and therefore available for computations.",
    "created_at": "2020-05-31T20:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414134",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:10 mjo]:
> 
> I haven't computed a tableau in about a decade. Is that something we can check before we call `glp_eval_tab_row()`?

Yup. I'm in the process of fixing all of these. From the GLPK docs:

**Synopsis**:
  int glp_bf_exists(glp_prob *P);
**Comments**:
... So before calling any API routine, which uses the basis factorization, the application program must make sure (using the routine `glp_bf_exists`) that the factorization exists and therefore available for computations.



---

archive/issue_comments_414135.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2020-06-01T00:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414135",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_414136.json:
```json
{
    "body": "Here's a preliminary branch. I haven't run a ptestlong yet, and you can definitely crash sage if you ignore the warnings and disable the safety net. But I've basically eliminated the need for our custom GLPK error handling, and thus the need for the rejected patch to reset the error state.\n----\nNew commits:",
    "created_at": "2020-06-01T00:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414136",
    "user": "https://github.com/orlitzky"
}
```

Here's a preliminary branch. I haven't run a ptestlong yet, and you can definitely crash sage if you ignore the warnings and disable the safety net. But I've basically eliminated the need for our custom GLPK error handling, and thus the need for the rejected patch to reset the error state.
----
New commits:



---

archive/issue_comments_414137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-02T12:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414138.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-02T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414138",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_414139.json:
```json
{
    "body": "A ptestlong passes now, and I've cleaned up the commit messages. This is the only pseudo-regression introduced, if you ignore the warning about changing the default solver to intopt only:\n\n\n```\nsage: lp = MixedIntegerLinearProgram(solver = \"GLPK\")\nsage: v = lp.new_variable(nonnegative=True)\nsage: lp.add_constraint(v[1] +v[2] -2.0 *v[3], max=-1.0)\nsage: lp.add_constraint(v[0] -4.0/3 *v[1] +1.0/3 *v[2], max=-1.0/3)\nsage: lp.add_constraint(v[0] +0.5 *v[1] -0.5 *v[2] +0.25 *v[3], max=-0.25)\nsage: lp.add_constraint(v[0] +4.0 *v[1] -v[2] +v[3], max=-1.0)\nsage: lp.solver_parameter(\"simplex_or_intopt\", \"intopt_only\")\nsage: lp.solve()\nAssertion failed: col->lb < col->ub\nError detected in file npp/npp5.c at line 528\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-8-34bddfdcab75> in <module>()\n----> 1 lp.solve()\n\n/home/mjo/src/sage.git/local/lib/python3.7/site-packages/sage/numerical/mip.pyx in sage.numerical.mip.MixedIntegerLinearProgram.solve (build/cythonized/sage/numerical/mip.c:15418)()\n   2249         \"\"\"\n   2250         if log is not None: self._backend.set_verbosity(log)\n-> 2251         self._backend.solve()\n   2252         return self._backend.get_objective_value()\n   2253 \n\n/home/mjo/src/sage.git/local/lib/python3.7/site-packages/sage/numerical/backends/glpk_backend.pyx in sage.numerical.backends.glpk_backend.GLPKBackend.solve (build/cythonized/sage/numerical/backends/glpk_backend.c:9837)()\n   1136         if ((self.simplex_or_intopt == glp_intopt_only)\n   1137             or (self.simplex_or_intopt == glp_simplex_then_intopt) and (solution_status != GLP_UNDEF) and (solution_status != GLP_NOFEAS)):\n-> 1138             sig_on()\n   1139             solve_status = glp_intopt(self.lp, self.iocp)\n   1140             solution_status = glp_mip_status(self.lp)\n\nRuntimeError: Aborted\n```\n",
    "created_at": "2020-06-02T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414139",
    "user": "https://github.com/orlitzky"
}
```

A ptestlong passes now, and I've cleaned up the commit messages. This is the only pseudo-regression introduced, if you ignore the warning about changing the default solver to intopt only:


```
sage: lp = MixedIntegerLinearProgram(solver = "GLPK")
sage: v = lp.new_variable(nonnegative=True)
sage: lp.add_constraint(v[1] +v[2] -2.0 *v[3], max=-1.0)
sage: lp.add_constraint(v[0] -4.0/3 *v[1] +1.0/3 *v[2], max=-1.0/3)
sage: lp.add_constraint(v[0] +0.5 *v[1] -0.5 *v[2] +0.25 *v[3], max=-0.25)
sage: lp.add_constraint(v[0] +4.0 *v[1] -v[2] +v[3], max=-1.0)
sage: lp.solver_parameter("simplex_or_intopt", "intopt_only")
sage: lp.solve()
Assertion failed: col->lb < col->ub
Error detected in file npp/npp5.c at line 528
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-8-34bddfdcab75> in <module>()
----> 1 lp.solve()

/home/mjo/src/sage.git/local/lib/python3.7/site-packages/sage/numerical/mip.pyx in sage.numerical.mip.MixedIntegerLinearProgram.solve (build/cythonized/sage/numerical/mip.c:15418)()
   2249         """
   2250         if log is not None: self._backend.set_verbosity(log)
-> 2251         self._backend.solve()
   2252         return self._backend.get_objective_value()
   2253 

/home/mjo/src/sage.git/local/lib/python3.7/site-packages/sage/numerical/backends/glpk_backend.pyx in sage.numerical.backends.glpk_backend.GLPKBackend.solve (build/cythonized/sage/numerical/backends/glpk_backend.c:9837)()
   1136         if ((self.simplex_or_intopt == glp_intopt_only)
   1137             or (self.simplex_or_intopt == glp_simplex_then_intopt) and (solution_status != GLP_UNDEF) and (solution_status != GLP_NOFEAS)):
-> 1138             sig_on()
   1139             solve_status = glp_intopt(self.lp, self.iocp)
   1140             solution_status = glp_mip_status(self.lp)

RuntimeError: Aborted
```




---

archive/issue_comments_414140.json:
```json
{
    "body": "I'm running tests here:\n\nhttps://github.com/kliem/sage-test-27122/actions\n\ne.g. the ubuntu eoan test will be here https://github.com/kliem/sage-test-27122/runs/731034181\n\n(the naming of the repository is confusing, but I'm really only testing `u/mjo/ticket/29493` on top of #29757).",
    "created_at": "2020-06-02T13:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414140",
    "user": "https://github.com/kliem"
}
```

I'm running tests here:

https://github.com/kliem/sage-test-27122/actions

e.g. the ubuntu eoan test will be here https://github.com/kliem/sage-test-27122/runs/731034181

(the naming of the repository is confusing, but I'm really only testing `u/mjo/ticket/29493` on top of #29757).



---

archive/issue_comments_414141.json:
```json
{
    "body": "Tests pass on OS X with homebrew's glpk.",
    "created_at": "2020-06-02T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414141",
    "user": "https://github.com/jhpalmieri"
}
```

Tests pass on OS X with homebrew's glpk.



---

archive/issue_comments_414142.json:
```json
{
    "body": "I've only had a chance to take a brief look. Just a quick comment that a possible concern is that exception types are changed by this ticket, which may break user code.",
    "created_at": "2020-06-02T20:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414142",
    "user": "https://github.com/mkoeppe"
}
```

I've only had a chance to take a brief look. Just a quick comment that a possible concern is that exception types are changed by this ticket, which may break user code.



---

archive/issue_comments_414143.json:
```json
{
    "body": "Replying to [comment:15 gh-kliem]:\n> I'm running tests here:\n> \n> https://github.com/kliem/sage-test-27122/actions\n> \n> e.g. the ubuntu eoan test will be here https://github.com/kliem/sage-test-27122/runs/731034181\n> \n> (the naming of the repository is confusing, but I'm really only testing `u/mjo/ticket/29493` on top of #29757).\n\nSeems to work fine. However, the github testing workflow doesn't work very smoothly right now.",
    "created_at": "2020-06-03T06:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414143",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:15 gh-kliem]:
> I'm running tests here:
> 
> https://github.com/kliem/sage-test-27122/actions
> 
> e.g. the ubuntu eoan test will be here https://github.com/kliem/sage-test-27122/runs/731034181
> 
> (the naming of the repository is confusing, but I'm really only testing `u/mjo/ticket/29493` on top of #29757).

Seems to work fine. However, the github testing workflow doesn't work very smoothly right now.



---

archive/issue_comments_414144.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> I've only had a chance to take a brief look. Just a quick comment that a possible concern is that exception types are changed by this ticket, which may break user code. \n> \n\nWell we invented the `GLPKError`. I would propose leaving `GLPKError` with a deprecation warning and also having it inherit from `ValueError`.\n\nThis way `except GLPKError` would still work. `except MIPSolverException` would sometimes not work anymore without a proper warning and the user will have to find out that this is sometimes a `ValueError` now.",
    "created_at": "2020-06-03T06:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414144",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:17 mkoeppe]:
> I've only had a chance to take a brief look. Just a quick comment that a possible concern is that exception types are changed by this ticket, which may break user code. 
> 

Well we invented the `GLPKError`. I would propose leaving `GLPKError` with a deprecation warning and also having it inherit from `ValueError`.

This way `except GLPKError` would still work. `except MIPSolverException` would sometimes not work anymore without a proper warning and the user will have to find out that this is sometimes a `ValueError` now.



---

archive/issue_comments_414145.json:
```json
{
    "body": "I don't think deprecating `GLPKError` makes sense here. If someone was *actually* catching a `GLPKError` in the only place it was documented, they'll now be getting a crash instead.\n\nThe other places where a `GLPKError` could have been raised are (still) undocumented. The `GenericBackend` interface is not quite done cooking in that regard. What happens if you ask for a variable that doesn't exist? What happens if try to set the type of a variable to a type that doesn't exist? The interface makes no promises. So the fact that one of the implementations now raises a different undocumented error from the previous undocumented error is something I don't think we have to be accountable for.",
    "created_at": "2020-06-08T15:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414145",
    "user": "https://github.com/orlitzky"
}
```

I don't think deprecating `GLPKError` makes sense here. If someone was *actually* catching a `GLPKError` in the only place it was documented, they'll now be getting a crash instead.

The other places where a `GLPKError` could have been raised are (still) undocumented. The `GenericBackend` interface is not quite done cooking in that regard. What happens if you ask for a variable that doesn't exist? What happens if try to set the type of a variable to a type that doesn't exist? The interface makes no promises. So the fact that one of the implementations now raises a different undocumented error from the previous undocumented error is something I don't think we have to be accountable for.



---

archive/issue_comments_414146.json:
```json
{
    "body": "\n```\nsage: from sage.misc.superseded import deprecation\nsage: class MyError(ValueError):\n....:     def __init__(self, s):\n....:         deprecation(1, 'foo')\n....:         return ValueError.__init__(self, s)\n....:     \nsage: try:\n....:     raise MyError(\"hello\")\n....: except MyError:\n....:     pass\n....: \n/home/jonathan/Applications/sage/src/bin/sage-ipython:2: DeprecationWarning: foo\nSee http://trac.sagemath.org/1 for details.\n  # -*- coding: utf-8 -*-\n```\n\n\nThis works fine. This is what I had in mind.",
    "created_at": "2020-06-08T15:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414146",
    "user": "https://github.com/kliem"
}
```


```
sage: from sage.misc.superseded import deprecation
sage: class MyError(ValueError):
....:     def __init__(self, s):
....:         deprecation(1, 'foo')
....:         return ValueError.__init__(self, s)
....:     
sage: try:
....:     raise MyError("hello")
....: except MyError:
....:     pass
....: 
/home/jonathan/Applications/sage/src/bin/sage-ipython:2: DeprecationWarning: foo
See http://trac.sagemath.org/1 for details.
  # -*- coding: utf-8 -*-
```


This works fine. This is what I had in mind.



---

archive/issue_comments_414147.json:
```json
{
    "body": "Actually, no.\n\nI had this in mind\n\n\n```\nsage: try:\n....:     raise ValueError(\"hello\")\n....: except MyError:\n....:     pass\n....: \n```\n\n\nAn this will not raise a deprecation warning. It won't even work (edited).",
    "created_at": "2020-06-08T15:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414147",
    "user": "https://github.com/kliem"
}
```

Actually, no.

I had this in mind


```
sage: try:
....:     raise ValueError("hello")
....: except MyError:
....:     pass
....: 
```


An this will not raise a deprecation warning. It won't even work (edited).



---

archive/issue_comments_414148.json:
```json
{
    "body": "Ok, I think I understand the problem now. I tried a few things, but I think it is just not possible.\n\nSo this ticket will possibly break users code and there is nothing we can do about it?",
    "created_at": "2020-06-08T16:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414148",
    "user": "https://github.com/kliem"
}
```

Ok, I think I understand the problem now. I tried a few things, but I think it is just not possible.

So this ticket will possibly break users code and there is nothing we can do about it?



---

archive/issue_comments_414149.json:
```json
{
    "body": "Replying to [comment:23 gh-kliem]:\n> \n> So this ticket will possibly break users code and there is nothing we can do about it?\n\nEvery bugfix carries some risk of breaking user code. Python has no notion of \"private\", and sage doesn't distinguish between public/private classes (exceptions, in this case), or use semantic versioning, or anything else like that as a heuristic aid. Instead we have deprecation warnings, but... every bugfix carries some risk of breaking user code. So whether or not to deprecate comes down to a judgment call: how likely is this to break running code, how much will it hurt if that happens, and how annoying would it be to avoid doing so?\n\nIn this case, I didn't get the impression that the API was at the level of stability where it makes sense for every bugfix to be a year-long endeavor. I feel much more guilty about introducing a crash where previously an exception was raised. Changing the default method to `simplex_then_intopt` tries hard to avoid that, though; and really, there's no way to get rid of the custom glpk patch without ripping that band-aid off at some point.",
    "created_at": "2020-06-08T17:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414149",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:23 gh-kliem]:
> 
> So this ticket will possibly break users code and there is nothing we can do about it?

Every bugfix carries some risk of breaking user code. Python has no notion of "private", and sage doesn't distinguish between public/private classes (exceptions, in this case), or use semantic versioning, or anything else like that as a heuristic aid. Instead we have deprecation warnings, but... every bugfix carries some risk of breaking user code. So whether or not to deprecate comes down to a judgment call: how likely is this to break running code, how much will it hurt if that happens, and how annoying would it be to avoid doing so?

In this case, I didn't get the impression that the API was at the level of stability where it makes sense for every bugfix to be a year-long endeavor. I feel much more guilty about introducing a crash where previously an exception was raised. Changing the default method to `simplex_then_intopt` tries hard to avoid that, though; and really, there's no way to get rid of the custom glpk patch without ripping that band-aid off at some point.



---

archive/issue_comments_414150.json:
```json
{
    "body": "I'm not overly concerned about breaking user code in this case.\nBut it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  \n\nA while back when I was working on cleaning up these backends, I introduced a number of `_test...` methods in `GenericBackend` to make sure that the API is actually the same; more could be added.",
    "created_at": "2020-06-08T18:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414150",
    "user": "https://github.com/mkoeppe"
}
```

I'm not overly concerned about breaking user code in this case.
But it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  

A while back when I was working on cleaning up these backends, I introduced a number of `_test...` methods in `GenericBackend` to make sure that the API is actually the same; more could be added.



---

archive/issue_comments_414151.json:
```json
{
    "body": "Replying to [comment:7 mjo]:\n> What problem was this patch trying to solve? \n\nI was not around when the patch was introduced, but nevertheless let me make a few comments on this.\n\n> The GLPK documentation states,\n> \n> > If some GLPK API routine detects erroneous or incorrect data passed by the application program,\n> > it writes appropriate diagnostic messages to the terminal and then abnormally terminates\n> > the application program.\n\n... and of course this is a rather unfortunate design for a library, and terrible for development in particular in an interactive environment. Basically, when working on new interfacing code, make one mistake and your session is killed.\n\nI guess that there was hope at the time that the patch could be upstreamed, but of course now we just have to accept that GLPK is a stable target. So we now simply have to accept that we have to duplicate all input validation checks that GLPK is already doing. Fine.\n\n> Is there any place that a user passes data directly to glpk that we can't inspect/preprocess first, to ensure that it's correct? \n\nI don't know the answer to this question.\n\n> If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.\n\nWell, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.",
    "created_at": "2020-06-08T18:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414151",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:7 mjo]:
> What problem was this patch trying to solve? 

I was not around when the patch was introduced, but nevertheless let me make a few comments on this.

> The GLPK documentation states,
> 
> > If some GLPK API routine detects erroneous or incorrect data passed by the application program,
> > it writes appropriate diagnostic messages to the terminal and then abnormally terminates
> > the application program.

... and of course this is a rather unfortunate design for a library, and terrible for development in particular in an interactive environment. Basically, when working on new interfacing code, make one mistake and your session is killed.

I guess that there was hope at the time that the patch could be upstreamed, but of course now we just have to accept that GLPK is a stable target. So we now simply have to accept that we have to duplicate all input validation checks that GLPK is already doing. Fine.

> Is there any place that a user passes data directly to glpk that we can't inspect/preprocess first, to ensure that it's correct? 

I don't know the answer to this question.

> If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.

Well, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.



---

archive/issue_comments_414152.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> I'm not overly concerned about breaking user code in this case.\n> But it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  \n> \n\nI considered this when fixing all of the methods that segfault. I had two choices in most cases: return garbage, or throw an error. For example,\n\n\n```\nsage: from sage.numerical.backends.generic_backend import get_solver\nsage: p = get_solver(solver=\"PPL\")\nsage: p.row(12)\n...\nIndexError: list index out of range\n\nsage: p = get_solver(solver=\"CVXOPT\")\nsage: p.row(12)\n([], [])\n```\n\n\nThat `IndexError` is an implementation detail since it tries to index a member variable list. Nothing is documented. But eliminating the option to segfault makes it more consistent, I guess? The methods should all be made to agree, of course, and the behavior documented. Another place I noticed some incongruity is that every backend returns garbage for the is-variable-foo methods:\n\n\n```\nsage: from sage.numerical.backends.generic_backend import get_solver\nsage: p = get_solver(solver=\"PPL\")\nsage: p.is_variable_binary(12)\nFalse\nsage: p.is_variable_integer(12)\nFalse\nsage: p.is_variable_continuous(12)\nTrue\nsage: p = get_solver(solver=\"CVXOPT\")\nsage: p.is_variable_binary(12)\nFalse\nsage: p.is_variable_integer(12)\nFalse\nsage: p.is_variable_continuous(12)\nTrue\nsage: p = get_solver(solver=\"GLPK\")\nsage: p.is_variable_binary(12)\nFalse\nsage: p.is_variable_integer(12)\nFalse\nsage: p.is_variable_continuous(12)\nFalse\n```\n\n\nAs the last line shows, I opted for the garbage `False` that is more intuitive to me than garbage `True`. But if I were doing it from scratch, that would also be a (documented in the interface) error.",
    "created_at": "2020-06-08T21:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414152",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:25 mkoeppe]:
> I'm not overly concerned about breaking user code in this case.
> But it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  
> 

I considered this when fixing all of the methods that segfault. I had two choices in most cases: return garbage, or throw an error. For example,


```
sage: from sage.numerical.backends.generic_backend import get_solver
sage: p = get_solver(solver="PPL")
sage: p.row(12)
...
IndexError: list index out of range

sage: p = get_solver(solver="CVXOPT")
sage: p.row(12)
([], [])
```


That `IndexError` is an implementation detail since it tries to index a member variable list. Nothing is documented. But eliminating the option to segfault makes it more consistent, I guess? The methods should all be made to agree, of course, and the behavior documented. Another place I noticed some incongruity is that every backend returns garbage for the is-variable-foo methods:


```
sage: from sage.numerical.backends.generic_backend import get_solver
sage: p = get_solver(solver="PPL")
sage: p.is_variable_binary(12)
False
sage: p.is_variable_integer(12)
False
sage: p.is_variable_continuous(12)
True
sage: p = get_solver(solver="CVXOPT")
sage: p.is_variable_binary(12)
False
sage: p.is_variable_integer(12)
False
sage: p.is_variable_continuous(12)
True
sage: p = get_solver(solver="GLPK")
sage: p.is_variable_binary(12)
False
sage: p.is_variable_integer(12)
False
sage: p.is_variable_continuous(12)
False
```


As the last line shows, I opted for the garbage `False` that is more intuitive to me than garbage `True`. But if I were doing it from scratch, that would also be a (documented in the interface) error.



---

archive/issue_comments_414153.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> \n> > If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.\n> \n> Well, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.\n> \n\nIf we keep the patch and ever take advantage of it, we'll be right back where we started, won't we?\n\nThe upstream maintainers and documentation have been pretty clear that you need to check the parameters you pass to GLPK. That's just the way the API works, and it really wasn't very much trouble to do. And so long as we do it, there's no urgent need for the error-recovery patch, because errors will never happen. The only real exception to my last statement is when you have an infeasible problem, ignore the warning, and set the method to `intopt_only` to skip the feasibility check performed by the continuous simplex solver. It's nice that we provide low-level access to that ability for people who really need it, but it's just that: low level access that you shouldn't use without reading the documentation and understanding what it does.\n\nTo summarize:\n\n* the patch is only helpful in a rare case (or when we use the API wrong)\n* ...and if you ignore a warning\n* ...and are wrong about how feasible your problem is\n* we can't take advantage of the patch in sagelib without breaking distros\n* the upstream developers have said \"don't do that\" multiple times\n\nEven if we left it as \"something for other people to use,\" I think it would be pretty annoying to write some sage code that works on your machine but not on your friend's because he's running debian and their glpk isn't patched.",
    "created_at": "2020-06-08T21:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414153",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:26 mkoeppe]:
> 
> > If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.
> 
> Well, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.
> 

If we keep the patch and ever take advantage of it, we'll be right back where we started, won't we?

The upstream maintainers and documentation have been pretty clear that you need to check the parameters you pass to GLPK. That's just the way the API works, and it really wasn't very much trouble to do. And so long as we do it, there's no urgent need for the error-recovery patch, because errors will never happen. The only real exception to my last statement is when you have an infeasible problem, ignore the warning, and set the method to `intopt_only` to skip the feasibility check performed by the continuous simplex solver. It's nice that we provide low-level access to that ability for people who really need it, but it's just that: low level access that you shouldn't use without reading the documentation and understanding what it does.

To summarize:

* the patch is only helpful in a rare case (or when we use the API wrong)
* ...and if you ignore a warning
* ...and are wrong about how feasible your problem is
* we can't take advantage of the patch in sagelib without breaking distros
* the upstream developers have said "don't do that" multiple times

Even if we left it as "something for other people to use," I think it would be pretty annoying to write some sage code that works on your machine but not on your friend's because he's running debian and their glpk isn't patched.



---

archive/issue_comments_414154.json:
```json
{
    "body": "Replying to [comment:28 mjo]:\n> Replying to [comment:26 mkoeppe]:\n> > \n> > > If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.\n> > \n> > Well, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.\n> > \n> \n> If we keep the patch and ever take advantage of it, we'll be right back where we started, won't we?\n\nNo, we won't, obviously.\n\nThe input checking that you add on this ticket is valuable because it helps avoid using the GLPK API incorrectly, as you explain correctly above.",
    "created_at": "2020-06-08T22:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414154",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:28 mjo]:
> Replying to [comment:26 mkoeppe]:
> > 
> > > If not, maybe we should just crash sage when glpk crashes and drop the patch, because any crash of glpk is a low-level sage programming error.
> > 
> > Well, I think the error recovery patch is still valuable for sage-the-distribution, so I don't think it should be removed. It adds value for Sage developers because it makes interactive development with the GLPK API simpler.
> > 
> 
> If we keep the patch and ever take advantage of it, we'll be right back where we started, won't we?

No, we won't, obviously.

The input checking that you add on this ticket is valuable because it helps avoid using the GLPK API incorrectly, as you explain correctly above.



---

archive/issue_comments_414155.json:
```json
{
    "body": "Replying to [comment:29 mkoeppe]:\n> \n> No, we won't, obviously.\n> \n> The input checking that you add on this ticket is valuable because it helps avoid using the GLPK API incorrectly, as you explain correctly above.\n> \n\nAre we talking about the same thing? I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero. If we keep that patch in sage-the-distribution, and if anyone ever relies on it, we would be back in the situation that prompted this ticket: some behavior depends on the custom patch to work, and it will break on distros that don't carry the patch.\n\nI'm also presuming that we don't want to enable that. But then how does keeping the patch around help anyone?",
    "created_at": "2020-06-08T23:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414155",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:29 mkoeppe]:
> 
> No, we won't, obviously.
> 
> The input checking that you add on this ticket is valuable because it helps avoid using the GLPK API incorrectly, as you explain correctly above.
> 

Are we talking about the same thing? I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero. If we keep that patch in sage-the-distribution, and if anyone ever relies on it, we would be back in the situation that prompted this ticket: some behavior depends on the custom patch to work, and it will break on distros that don't carry the patch.

I'm also presuming that we don't want to enable that. But then how does keeping the patch around help anyone?



---

archive/issue_comments_414156.json:
```json
{
    "body": "Replying to [comment:30 mjo]:\n> I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero.\n\nThat's right, I do not support removing the patch.\n\nBecause, as I said above:\n> It adds value for Sage developers because it makes interactive development with the GLPK API simpler.",
    "created_at": "2020-06-08T23:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414156",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:30 mjo]:
> I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero.

That's right, I do not support removing the patch.

Because, as I said above:
> It adds value for Sage developers because it makes interactive development with the GLPK API simpler.



---

archive/issue_comments_414157.json:
```json
{
    "body": "Replying to [comment:31 mkoeppe]:\n> Replying to [comment:30 mjo]:\n> > I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero.\n> \n> That's right, I do not support removing the patch.\n... and the error handler.",
    "created_at": "2020-06-08T23:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414157",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:31 mkoeppe]:
> Replying to [comment:30 mjo]:
> > I'm assuming that you're talking about the patch that upstream rejected and that I deleted, that resets the error state back to zero.
> 
> That's right, I do not support removing the patch.
... and the error handler.



---

archive/issue_comments_414158.json:
```json
{
    "body": "Replying to [comment:27 mjo]:\n> Replying to [comment:25 mkoeppe]:\n> > it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  \n> \n> I considered this when fixing all of the methods that segfault. I had two choices in most cases: return garbage, or throw an error. [...]\n> That `IndexError` is an implementation detail since it tries to index a member variable list. Nothing is documented. But eliminating the option to segfault makes it more consistent, I guess? \n\nYes, this is good.\n\n> The methods should all be made to agree, of course, and the behavior documented. Another place I noticed some incongruity is that every backend returns garbage for the is-variable-foo methods [...] I opted for the garbage `False` that is more intuitive to me than garbage `True`.\n\nSure, that's fine.\n\n> But if I were doing it from scratch, that would also be a (documented in the interface) error.\n\nI agree, and I would support introducing tighter error checking there (on some other ticket). This is clearly undefined behavior, and tightening the specification would be valuable.",
    "created_at": "2020-06-09T00:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414158",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:27 mjo]:
> Replying to [comment:25 mkoeppe]:
> > it would be worth checking (or commenting on, if you have checked already) whether the differences to other backends are decreased or increased by this change.  
> 
> I considered this when fixing all of the methods that segfault. I had two choices in most cases: return garbage, or throw an error. [...]
> That `IndexError` is an implementation detail since it tries to index a member variable list. Nothing is documented. But eliminating the option to segfault makes it more consistent, I guess? 

Yes, this is good.

> The methods should all be made to agree, of course, and the behavior documented. Another place I noticed some incongruity is that every backend returns garbage for the is-variable-foo methods [...] I opted for the garbage `False` that is more intuitive to me than garbage `True`.

Sure, that's fine.

> But if I were doing it from scratch, that would also be a (documented in the interface) error.

I agree, and I would support introducing tighter error checking there (on some other ticket). This is clearly undefined behavior, and tightening the specification would be valuable.



---

archive/issue_comments_414159.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n>\n> > That's right, I do not support removing the patch.\n> ... and the error handler.\n\nSome of the intermediate commits might otherwise be useful, but eliminating the patch and the error handler (that are causing test failures everywhere) was the whole point here =)",
    "created_at": "2020-06-09T01:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414159",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:32 mkoeppe]:
>
> > That's right, I do not support removing the patch.
> ... and the error handler.

Some of the intermediate commits might otherwise be useful, but eliminating the patch and the error handler (that are causing test failures everywhere) was the whole point here =)



---

archive/issue_comments_414160.json:
```json
{
    "body": "Let's see. \n\nThe doctest failure in `sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges` is solved by your changes using `glp_bf_exists`.\n\nThe doctests that relied on the error handler for index bound checking etc. are solved by your additions to the Cython functions.\n\nThe doctest for `sage.libs.glpk.error.setup_glpk_error_handler` had become inappropriate now that we can use system GLPKs, so removing the doctest (or marking it \"# optional - glpk_error_recovery\") is sufficient to fix this doctest failure.\nIt is not necessary to remove the error recovery feature for that.",
    "created_at": "2020-06-09T01:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414160",
    "user": "https://github.com/mkoeppe"
}
```

Let's see. 

The doctest failure in `sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges` is solved by your changes using `glp_bf_exists`.

The doctests that relied on the error handler for index bound checking etc. are solved by your additions to the Cython functions.

The doctest for `sage.libs.glpk.error.setup_glpk_error_handler` had become inappropriate now that we can use system GLPKs, so removing the doctest (or marking it "# optional - glpk_error_recovery") is sufficient to fix this doctest failure.
It is not necessary to remove the error recovery feature for that.



---

archive/issue_comments_414161.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> It is not necessary to remove the error recovery feature for that.\n\nI also had to change the default solver method, and remove the doctest that purposely crashed GLPK.\n\nDeleting the tests would have made the errors go away in the first place, but that doesn't solve the underlying problem: there are two fundamentally different behaviors, and you don't know which one you're going to get unless you know what distro your code will be running on (and what `./configure` options will be used to build sage). That problem is less prominent after some of these commits, but still lurking unless we get rid of the custom patch.\n\nIf I'm writing a new sage package and if I rely on being able to catch `GLPKError`, then as soon as I send it to someone running Ubuntu, it's going to crash. I'll probably post to the mailing list, be linked to this ticket, and ultimately decide that I should be sanitizing my input before passing it to GLPK for the best results. But then what good has the patch done me, except to waste some time on a false start?",
    "created_at": "2020-06-09T02:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414161",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:35 mkoeppe]:
> It is not necessary to remove the error recovery feature for that.

I also had to change the default solver method, and remove the doctest that purposely crashed GLPK.

Deleting the tests would have made the errors go away in the first place, but that doesn't solve the underlying problem: there are two fundamentally different behaviors, and you don't know which one you're going to get unless you know what distro your code will be running on (and what `./configure` options will be used to build sage). That problem is less prominent after some of these commits, but still lurking unless we get rid of the custom patch.

If I'm writing a new sage package and if I rely on being able to catch `GLPKError`, then as soon as I send it to someone running Ubuntu, it's going to crash. I'll probably post to the mailing list, be linked to this ticket, and ultimately decide that I should be sanitizing my input before passing it to GLPK for the best results. But then what good has the patch done me, except to waste some time on a false start?



---

archive/issue_comments_414162.json:
```json
{
    "body": "Replying to [comment:38 mjo]:\n> Replying to [comment:35 mkoeppe]:\n> > It is not necessary to remove the error recovery feature for that.\n> \n> I also had to change the default solver method, and remove the doctest that purposely crashed GLPK.\n\nYes, I know, see my updated description.",
    "created_at": "2020-06-09T02:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414162",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:38 mjo]:
> Replying to [comment:35 mkoeppe]:
> > It is not necessary to remove the error recovery feature for that.
> 
> I also had to change the default solver method, and remove the doctest that purposely crashed GLPK.

Yes, I know, see my updated description.



---

archive/issue_comments_414163.json:
```json
{
    "body": "Replying to [comment:38 mjo]:\n> Deleting the tests would have made the errors go away in the first place, but that doesn't solve the underlying problem: there are two fundamentally different behaviors, and you don't know which one you're going to get unless you know what distro your code will be running on (and what `./configure` options will be used to build sage). That problem is less prominent after some of these commits, but still lurking unless we get rid of the custom patch.\n\nIt is undefined behavior. We have a patch that makes it less deadly. It's a convenience for developers. I know that it has actually save my time during development (in contrast to the hypothetical developer that you are invoking), and as I have said above, I don't support removing the feature.\n\nIn any case, the removal is not necessary for this ticket. It is best to limit the scope of the ticket.",
    "created_at": "2020-06-09T02:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414163",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:38 mjo]:
> Deleting the tests would have made the errors go away in the first place, but that doesn't solve the underlying problem: there are two fundamentally different behaviors, and you don't know which one you're going to get unless you know what distro your code will be running on (and what `./configure` options will be used to build sage). That problem is less prominent after some of these commits, but still lurking unless we get rid of the custom patch.

It is undefined behavior. We have a patch that makes it less deadly. It's a convenience for developers. I know that it has actually save my time during development (in contrast to the hypothetical developer that you are invoking), and as I have said above, I don't support removing the feature.

In any case, the removal is not necessary for this ticket. It is best to limit the scope of the ticket.



---

archive/issue_comments_414164.json:
```json
{
    "body": "As a way forward, I have created #29829 for the removal of the patch (which I do not support). \n\nLet's narrow down the changes in the present ticket to the uncontroversial part.",
    "created_at": "2020-06-09T02:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414164",
    "user": "https://github.com/mkoeppe"
}
```

As a way forward, I have created #29829 for the removal of the patch (which I do not support). 

Let's narrow down the changes in the present ticket to the uncontroversial part.



---

archive/issue_comments_414165.json:
```json
{
    "body": "Replying to [comment:38 mjo]:\n> If I'm writing a new sage package and if I rely on being able to catch `GLPKError`\n\n... this appears to be a documentation issue. I have added a commit that addresses it.\n----\nNew commits:",
    "created_at": "2020-06-09T02:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414165",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:38 mjo]:
> If I'm writing a new sage package and if I rely on being able to catch `GLPKError`

... this appears to be a documentation issue. I have added a commit that addresses it.
----
New commits:



---

archive/issue_comments_414166.json:
```json
{
    "body": "The two removal commits are now on #29829.",
    "created_at": "2020-06-09T03:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414166",
    "user": "https://github.com/mkoeppe"
}
```

The two removal commits are now on #29829.



---

archive/issue_comments_414167.json:
```json
{
    "body": "Tests run at https://github.com/mkoeppe/sage/actions/runs/129317169",
    "created_at": "2020-06-09T03:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414167",
    "user": "https://github.com/mkoeppe"
}
```

Tests run at https://github.com/mkoeppe/sage/actions/runs/129317169



---

archive/issue_comments_414168.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-09T16:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414169.json:
```json
{
    "body": "New test at https://github.com/mkoeppe/sage/runs/755764195",
    "created_at": "2020-06-09T23:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414169",
    "user": "https://github.com/mkoeppe"
}
```

New test at https://github.com/mkoeppe/sage/runs/755764195



---

archive/issue_comments_414170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-09T23:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414171.json:
```json
{
    "body": "New tests at https://github.com/mkoeppe/sage/actions/runs/130367945",
    "created_at": "2020-06-10T02:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414171",
    "user": "https://github.com/mkoeppe"
}
```

New tests at https://github.com/mkoeppe/sage/actions/runs/130367945



---

archive/issue_comments_414172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T15:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414173.json:
```json
{
    "body": "Passes tests now - see for example https://github.com/mkoeppe/sage/runs/756778388",
    "created_at": "2020-06-10T15:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414173",
    "user": "https://github.com/mkoeppe"
}
```

Passes tests now - see for example https://github.com/mkoeppe/sage/runs/756778388



---

archive/issue_comments_414174.json:
```json
{
    "body": "I have also tested with https://github.com/mkoeppe/sage-numerical-interactive-mip (which uses some of these methods).\n\nI would be ready to set it to `positive_review`; but we need another reviewer for my (trivial) changes.",
    "created_at": "2020-06-10T17:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414174",
    "user": "https://github.com/mkoeppe"
}
```

I have also tested with https://github.com/mkoeppe/sage-numerical-interactive-mip (which uses some of these methods).

I would be ready to set it to `positive_review`; but we need another reviewer for my (trivial) changes.



---

archive/issue_comments_414175.json:
```json
{
    "body": "\n```\n+    We install this error handler so that an error does not lead to\n+    an immediate error exit of the process.  Instead, we raise a\n+    ``GLPKError`` for the convenience of developers.\n```\n\n\nThe *sage* process never exited, but the error left GLPK unusable from that point forward -- for example returning nothing instead of solving subsequent problems as in the ticket description. The error handler itself is fine; it's toggling the \"there was an error\" bit off afterwards that's causing all this trouble.\n\nI still think it's perverse to leave around 150 lines of code with a docstring that says \"don't use this,\" but where we are is not even locally optimal, so let's just do it.",
    "created_at": "2020-06-10T19:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414175",
    "user": "https://github.com/orlitzky"
}
```


```
+    We install this error handler so that an error does not lead to
+    an immediate error exit of the process.  Instead, we raise a
+    ``GLPKError`` for the convenience of developers.
```


The *sage* process never exited, but the error left GLPK unusable from that point forward -- for example returning nothing instead of solving subsequent problems as in the ticket description. The error handler itself is fine; it's toggling the "there was an error" bit off afterwards that's causing all this trouble.

I still think it's perverse to leave around 150 lines of code with a docstring that says "don't use this," but where we are is not even locally optimal, so let's just do it.



---

archive/issue_comments_414176.json:
```json
{
    "body": "Replying to [comment:55 mjo]:\n> 150 lines of code with a docstring that says \"don't use this,\" \n\n... \"for production\".",
    "created_at": "2020-06-10T19:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414176",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:55 mjo]:
> 150 lines of code with a docstring that says "don't use this," 

... "for production".



---

archive/issue_comments_414177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-10T19:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414177",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414178.json:
```json
{
    "body": "Thank you for doing this.",
    "created_at": "2020-06-10T19:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414178",
    "user": "https://github.com/kliem"
}
```

Thank you for doing this.



---

archive/issue_events_075190.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-21T22:37:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29256#event-75190"
}
```



---

archive/issue_comments_414179.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-21T22:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29256#issuecomment-414179",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
