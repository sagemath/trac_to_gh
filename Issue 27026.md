# Issue 27026: Upgrade to giac 1.5 fails to build with older libstdc++

archive/issues_027026.json:
```json
{
    "body": "CC:  @dimpase @frederichan-IMJPRG parisse @slel\n\n#26315 broke building giac on some systems that have a old-ish libstdc++.  It is completely mysterious to me *why* this broke when it worked before, and without a repository it's very difficult to determine what change between the versions is responsible, as there is little difference between the two versions in the relevant code.\n\nNevertheless, it can be fixed by explicitly using `std::isnan` and `std::isinf` so that there is no risk of them conflicting with the libc math.h equivalents thereof.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27263\n\n",
    "created_at": "2019-02-12T15:59:19Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Upgrade to giac 1.5 fails to build with older libstdc++",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27026",
    "user": "@embray"
}
```
CC:  @dimpase @frederichan-IMJPRG parisse @slel

#26315 broke building giac on some systems that have a old-ish libstdc++.  It is completely mysterious to me *why* this broke when it worked before, and without a repository it's very difficult to determine what change between the versions is responsible, as there is little difference between the two versions in the relevant code.

Nevertheless, it can be fixed by explicitly using `std::isnan` and `std::isinf` so that there is no risk of them conflicting with the libc math.h equivalents thereof.

Issue created by migration from https://trac.sagemath.org/ticket/27263





---

archive/issue_comments_380545.json:
```json
{
    "body": "Also I have no idea what the `FIR_LINUX` macro here means.  There is no documentation mentioning it and it is not defined anywhere.",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380545",
    "user": "@embray"
}
```

Also I have no idea what the `FIR_LINUX` macro here means.  There is no documentation mentioning it and it is not defined anywhere.



---

archive/issue_comments_380546.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380546",
    "user": "@embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_380547.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-12T16:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380547",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_380548.json:
```json
{
    "body": "Bad branch?",
    "created_at": "2019-02-12T16:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380548",
    "user": "@jdemeyer"
}
```

Bad branch?



---

archive/issue_comments_380549.json:
```json
{
    "body": "This might also have been caused by #26787.",
    "created_at": "2019-02-12T16:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380549",
    "user": "@jdemeyer"
}
```

This might also have been caused by #26787.



---

archive/issue_comments_380550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-12T16:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380550",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_380551.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> This might also have been caused by #26787.\n\nAccording to my research this occurs with or without `-std=c++11` but I haven't explicitly tested that.\n\nI will also try to bring it up upstream in case there is *any* idea.\n----\nNew commits:",
    "created_at": "2019-02-12T16:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380551",
    "user": "@embray"
}
```

Replying to [comment:3 jdemeyer]:
> This might also have been caused by #26787.

According to my research this occurs with or without `-std=c++11` but I haven't explicitly tested that.

I will also try to bring it up upstream in case there is *any* idea.
----
New commits:



---

archive/issue_comments_380552.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-12T16:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380552",
    "user": "@embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_380553.json:
```json
{
    "body": "I still don't fully understand what #26787 does though so it's possible.",
    "created_at": "2019-02-12T17:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380553",
    "user": "@embray"
}
```

I still don't fully understand what #26787 does though so it's possible.



---

archive/issue_comments_380554.json:
```json
{
    "body": "Okay, confirmed that it is #26787 after all.  If I just put `unset CXX` in the spkg-install for giac it builds.  Something like that might be better than patching...",
    "created_at": "2019-02-12T17:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380554",
    "user": "@embray"
}
```

Okay, confirmed that it is #26787 after all.  If I just put `unset CXX` in the spkg-install for giac it builds.  Something like that might be better than patching...



---

archive/issue_comments_380555.json:
```json
{
    "body": "Right now in `sage-env-config` I have\n\n\n```\nexport CONFIGURED_CXX=\"g++ -std=gnu++11 -std=gnu++11\"\n```\n\n\nI don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.  Perhaps this older gcc is not fully c++11-compatible?\n\nIn any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?",
    "created_at": "2019-02-12T17:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380555",
    "user": "@embray"
}
```

Right now in `sage-env-config` I have


```
export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
```


I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.  Perhaps this older gcc is not fully c++11-compatible?

In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?



---

archive/issue_comments_380556.json:
```json
{
    "body": "Why not just apply the patch? I'd rather not mess with environment variables.",
    "created_at": "2019-02-12T17:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380556",
    "user": "@jdemeyer"
}
```

Why not just apply the patch? I'd rather not mess with environment variables.



---

archive/issue_comments_380557.json:
```json
{
    "body": "I guess, I don't really know what impact the patch has on other systems. But it does seem clear to me: Just explicitly use the `isnan` in the `std` namespace.  I assume there's no reason that should go wrong...",
    "created_at": "2019-02-12T17:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380557",
    "user": "@embray"
}
```

I guess, I don't really know what impact the patch has on other systems. But it does seem clear to me: Just explicitly use the `isnan` in the `std` namespace.  I assume there's no reason that should go wrong...



---

archive/issue_comments_380558.json:
```json
{
    "body": "LGTM",
    "created_at": "2019-02-12T18:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380558",
    "user": "@dimpase"
}
```

LGTM



---

archive/issue_comments_380559.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-12T18:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380559",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_380560.json:
```json
{
    "body": "I think you should bump the `giac` patchlevel such that this upgrade is actually tested.",
    "created_at": "2019-02-12T18:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380560",
    "user": "@jdemeyer"
}
```

I think you should bump the `giac` patchlevel such that this upgrade is actually tested.



---

archive/issue_comments_380561.json:
```json
{
    "body": "Replying to [comment:9 embray]:\n> Right now in `sage-env-config` I have\n> \n> {{{\n> export CONFIGURED_CXX=\"g++ -std=gnu++11 -std=gnu++11\"\n> }}}\n> \n\nThe only way I think you can end up with that is for `CXX` to be `g++ -std=gnu++11` at configuration time. The macro will then happily add another one because it is fairly stupid.\n\n> I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.\n\nDon't think so but I am a C++ bigwig.\n\n>  Perhaps this older gcc is not fully c++11-compatible?\n>\n\nMost certainly. Before gcc-5 C++11 support was experimental and the implementation was not fixed in stone.\n \n> In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?\n\nI'd rather have that little patch here.",
    "created_at": "2019-02-13T01:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380561",
    "user": "@kiwifb"
}
```

Replying to [comment:9 embray]:
> Right now in `sage-env-config` I have
> 
> {{{
> export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
> }}}
> 

The only way I think you can end up with that is for `CXX` to be `g++ -std=gnu++11` at configuration time. The macro will then happily add another one because it is fairly stupid.

> I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.

Don't think so but I am a C++ bigwig.

>  Perhaps this older gcc is not fully c++11-compatible?
>

Most certainly. Before gcc-5 C++11 support was experimental and the implementation was not fixed in stone.
 
> In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?

I'd rather have that little patch here.



---

archive/issue_comments_380562.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> I think you should bump the `giac` patchlevel such that this upgrade is actually tested.\n\nIn theory yes, but this only matters for systems that otherwise simply cannot built giac, so you don't need to do this bumping for all practical purposes.",
    "created_at": "2019-02-13T08:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380562",
    "user": "@dimpase"
}
```

Replying to [comment:13 jdemeyer]:
> I think you should bump the `giac` patchlevel such that this upgrade is actually tested.

In theory yes, but this only matters for systems that otherwise simply cannot built giac, so you don't need to do this bumping for all practical purposes.



---

archive/issue_comments_380563.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-14T19:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27026#issuecomment-380563",
    "user": "@vbraun"
}
```

Resolution: fixed
