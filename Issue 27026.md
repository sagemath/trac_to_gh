# Issue 27026: Upgrade to giac 1.5 fails to build with older libstdc++

Issue created by migration from https://trac.sagemath.org/ticket/27263

Original creator: embray

Original creation time: 2019-02-12 15:59:19

CC:  dimpase frederichan parisse slelievre

#26315 broke building giac on some systems that have a old-ish libstdc++.  It is completely mysterious to me _why_ this broke when it worked before, and without a repository it's very difficult to determine what change between the versions is responsible, as there is little difference between the two versions in the relevant code.

Nevertheless, it can be fixed by explicitly using `std::isnan` and `std::isinf` so that there is no risk of them conflicting with the libc math.h equivalents thereof.


---

Comment by embray created at 2019-02-12 16:02:04

Also I have no idea what the `FIR_LINUX` macro here means.  There is no documentation mentioning it and it is not defined anywhere.


---

Comment by embray created at 2019-02-12 16:02:04

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2019-02-12 16:05:18

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2019-02-12 16:05:18

Bad branch?


---

Comment by jdemeyer created at 2019-02-12 16:05:56

This might also have been caused by #26787.


---

Comment by git created at 2019-02-12 16:47:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-02-12 16:47:52

Replying to [comment:3 jdemeyer]:
> This might also have been caused by #26787.

According to my research this occurs with or without `-std=c++11` but I haven't explicitly tested that.

I will also try to bring it up upstream in case there is _any_ idea.
----
New commits:


---

Comment by embray created at 2019-02-12 16:47:59

Changing status from needs_work to needs_review.


---

Comment by embray created at 2019-02-12 17:02:50

I still don't fully understand what #26787 does though so it's possible.


---

Comment by embray created at 2019-02-12 17:18:31

Okay, confirmed that it is #26787 after all.  If I just put `unset CXX` in the spkg-install for giac it builds.  Something like that might be better than patching...


---

Comment by embray created at 2019-02-12 17:21:14

Right now in `sage-env-config` I have


```
export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
```


I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.  Perhaps this older gcc is not fully c++11-compatible?

In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?


---

Comment by jdemeyer created at 2019-02-12 17:22:36

Why not just apply the patch? I'd rather not mess with environment variables.


---

Comment by embray created at 2019-02-12 17:32:46

I guess, I don't really know what impact the patch has on other systems. But it does seem clear to me: Just explicitly use the `isnan` in the `std` namespace.  I assume there's no reason that should go wrong...


---

Comment by dimpase created at 2019-02-12 18:23:47

LGTM


---

Comment by dimpase created at 2019-02-12 18:23:47

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-02-12 18:33:15

I think you should bump the `giac` patchlevel such that this upgrade is actually tested.


---

Comment by fbissey created at 2019-02-13 01:45:06

Replying to [comment:9 embray]:
> Right now in `sage-env-config` I have
> 
> {{{
> export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
> }}}
> 

The only way I think you can end up with that is for `CXX` to be `g++ -std=gnu++11` at configuration time. The macro will then happily add another one because it is fairly stupid.

> I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.

Don't think so but I am a C++ bigwig.

>  Perhaps this older gcc is not fully c++11-compatible?
>

Most certainly. Before gcc-5 C++11 support was experimental and the implementation was not fixed in stone.
 
> In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?

I'd rather have that little patch here.


---

Comment by dimpase created at 2019-02-13 08:17:23

Replying to [comment:13 jdemeyer]:
> I think you should bump the `giac` patchlevel such that this upgrade is actually tested.

In theory yes, but this only matters for systems that otherwise simply cannot built giac, so you don't need to do this bumping for all practical purposes.


---

Comment by vbraun created at 2019-02-14 19:45:44

Resolution: fixed
