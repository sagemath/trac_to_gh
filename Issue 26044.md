# Issue 26044: curl-config requires the bc command to work

Issue created by migration from https://trac.sagemath.org/ticket/26281

Original creator: embray

Original creation time: 2018-09-14 10:57:41

CC:  â€‹infinity0

As we found out in #24919 (see #24919#comment:63) the `curl-config` program that comes with curl, which we use to check the curl version, requires the standard `bc` command, which apparently on some systems is missing?

In a way this just means that the packaging of `curl` is broken since it should list `bc` as a runtime dependency.  But we can work around that by checking for it ourselves.

This issue _should_ be independent of #24919 since we already use `curl-config` to check for curl...


---

Comment by dimpase created at 2018-10-15 10:25:07

This looks like a Debian bug, as I see this on Debian, and they package (lib)curl.
By right, `curl-config` they ship must be fully functional, but it misses `bc` as a dependency.

I cc one of Debian people packaging Sagemath here.


---

Comment by dimpase created at 2018-10-28 08:39:39

discussed with upstream on https://github.com/curl/curl/issues/3143
and  upstream fixed it in https://github.com/curl/curl/pull/3174


---

Comment by embray created at 2018-10-28 11:35:31

Thanks.


---

Comment by embray created at 2018-10-28 11:36:06

I'm not sure what we should do in sage, if anything.  I suppose it might still be worth adding an explicit check for the bc program when installing curl :(


---

Comment by dimpase created at 2018-10-28 21:41:14

Replying to [comment:4 embray]:
> I'm not sure what we should do in sage, if anything.  I suppose it might still be worth adding an explicit check for the bc program when installing curl :(

we could just make `bc` required in the top `configure.ac`, calling `AC_CHECK_PROGRAM` or whatever the right macro is.


---

Comment by slelievre created at 2020-09-16 00:52:54

The upstream fix was merged in `curl 7.62.0`.

Rules for deciding whether to build curl are
described in `build/pkgs/curl/spkg-configure.m4`.

Currently the approach is based on `R`'s needs:

- build `curl` unless `curl >= 7.22` is found.

Which of the following should we change it to?

- build `curl` unless `curl >= 7.62` is found
- build `curl` unless either `curl >= 7.62` is found or `curl >= 7.22` and `bc` are found


---

Comment by dimpase created at 2020-09-16 08:26:12

Currently we do not build `curl` if `curl >= 7.22` (and, implcitly, `bc` - if the curl in question does need `bc` in its `curl-config`).

Adding an explicit check for `bc` (after our test for curl failed) would only improve error messages, but that's a rare event that a system has no `bc` installed.

Other potential improvements here would be to get rid of somewhat dodgy `LIBCURL_CHECK_CONFIG` and just use `PKG_CHECK_MODULES` (which doesn't need `bc`), or try `PKG_CHECK_MODULES`, and otherwise fall on `LIBCURL_CHECK_CONFIG`.

But all this is very minor.


---

Comment by dimpase created at 2020-09-16 08:26:12

Changing priority from major to minor.


---

Comment by slelievre created at 2020-09-16 18:50:52

So maybe:
- check for curl >= 7.62: if found, good
- if not found, check for curl >= 7.22 and bc: if found, good
- if not found: build curl


---

Comment by dimpase created at 2020-09-16 20:14:32

Replying to [comment:8 slelievre]:
> So maybe:
> - check for curl >= 7.62: if found, good
> - if not found, check for curl >= 7.22 and bc: if found, good
> - if not found: build curl

please see my edits
