# Issue 10543: Misc improvements to arithmetic

archive/issues_010543.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  jthurber @zimmermann6\n\nGeneric code clean-up such as line breaks, empty lines etc\n\n``n.digits()``\n\nBefore:\n\n```\nsage: n = 10**10000000-10**9999990\nsage: timeit('n.ndigits()')\n625 loops, best of 3: 46.6 \u00b5s per loop\nsage: timeit('(-n).ndigits()')\n25 loops, best of 3: 9.04 ms per loop\n```\n\n\n```\nsage: ZZ(0).ndigits()\n0\nsage: ZZ(0).ndigits(base=2)\n0\nsage: ZZ(0).nbits()\n1\n```\n\n\nAfter:\n\n```\nsage: n = 10**10000000-10**9999990\nsage: timeit('n.ndigits()')\n625 loops, best of 3: 1.02 \u00b5s per loop\nsage: timeit('(-n).ndigits()')\n125 loops, best of 3: 4.57 ms per loop\n```\n\n\n```\nsage: ZZ(0).ndigits()\n1\nsage: ZZ(0).ndigits(base=2)\n1\nsage: ZZ(0).nbits()\n1\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10596\n\n",
    "created_at": "2011-01-12T00:58:09Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Misc improvements to arithmetic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10543",
    "user": "spancratz"
}
```
Assignee: @aghitza

CC:  jthurber @zimmermann6

Generic code clean-up such as line breaks, empty lines etc

``n.digits()``

Before:

```
sage: n = 10**10000000-10**9999990
sage: timeit('n.ndigits()')
625 loops, best of 3: 46.6 µs per loop
sage: timeit('(-n).ndigits()')
25 loops, best of 3: 9.04 ms per loop
```


```
sage: ZZ(0).ndigits()
0
sage: ZZ(0).ndigits(base=2)
0
sage: ZZ(0).nbits()
1
```


After:

```
sage: n = 10**10000000-10**9999990
sage: timeit('n.ndigits()')
625 loops, best of 3: 1.02 µs per loop
sage: timeit('(-n).ndigits()')
125 loops, best of 3: 4.57 ms per loop
```


```
sage: ZZ(0).ndigits()
1
sage: ZZ(0).ndigits(base=2)
1
sage: ZZ(0).nbits()
1
```


Issue created by migration from https://trac.sagemath.org/ticket/10596





---

archive/issue_comments_110175.json:
```json
{
    "body": "Attachment [trac-10596.patch](tarball://root/attachments/some-uuid/ticket10596/trac-10596.patch) by spancratz created at 2011-01-12 04:01:57",
    "created_at": "2011-01-12T04:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110175",
    "user": "spancratz"
}
```

Attachment [trac-10596.patch](tarball://root/attachments/some-uuid/ticket10596/trac-10596.patch) by spancratz created at 2011-01-12 04:01:57



---

archive/issue_comments_110176.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-12T04:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110176",
    "user": "spancratz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110177.json:
```json
{
    "body": "Changing priority from major to trivial.",
    "created_at": "2011-01-12T04:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110177",
    "user": "spancratz"
}
```

Changing priority from major to trivial.



---

archive/issue_comments_110178.json:
```json
{
    "body": "I had the following failures to apply, 4.6.1.rc1 on OS X.\nThis doesn't have 5945 as a prerequisite, does it?\n\n\n```\n22:14:56johnthurber~/sage/sage-4.6.1.rc1/devel/sage$ hg qpush\napplying trac-10596.patch\npatching file sage/rings/integer.pyx\nHunk #10 FAILED at 1268\nHunk #37 succeeded at 3276 with fuzz 1 (offset -106 lines).\nHunk #42 FAILED at 3577\nHunk #58 succeeded at 4302 with fuzz 1 (offset -106 lines).\nHunk #62 succeeded at 4643 with fuzz 2 (offset -106 lines).\nHunk #73 FAILED at 5289\n3 out of 82 hunks FAILED -- saving rejects to file sage/rings/integer.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac-10596.patch\n```\n",
    "created_at": "2011-01-12T06:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110178",
    "user": "jthurber"
}
```

I had the following failures to apply, 4.6.1.rc1 on OS X.
This doesn't have 5945 as a prerequisite, does it?


```
22:14:56johnthurber~/sage/sage-4.6.1.rc1/devel/sage$ hg qpush
applying trac-10596.patch
patching file sage/rings/integer.pyx
Hunk #10 FAILED at 1268
Hunk #37 succeeded at 3276 with fuzz 1 (offset -106 lines).
Hunk #42 FAILED at 3577
Hunk #58 succeeded at 4302 with fuzz 1 (offset -106 lines).
Hunk #62 succeeded at 4643 with fuzz 2 (offset -106 lines).
Hunk #73 FAILED at 5289
3 out of 82 hunks FAILED -- saving rejects to file sage/rings/integer.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac-10596.patch
```




---

archive/issue_comments_110179.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-12T06:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110179",
    "user": "@adeines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_110180.json:
```json
{
    "body": "I had the same thing happen as well.",
    "created_at": "2011-01-12T06:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110180",
    "user": "@adeines"
}
```

I had the same thing happen as well.



---

archive/issue_comments_110181.json:
```json
{
    "body": "I'm sorry, I think this is because I was working on this with 4.6.0 rather than 4.6.1.rc0.  I will fix that this morning.  Sebastian",
    "created_at": "2011-01-12T17:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110181",
    "user": "spancratz"
}
```

I'm sorry, I think this is because I was working on this with 4.6.0 rather than 4.6.1.rc0.  I will fix that this morning.  Sebastian



---

archive/issue_comments_110182.json:
```json
{
    "body": "Attachment [trac-10596-461rc0.patch](tarball://root/attachments/some-uuid/ticket10596/trac-10596-461rc0.patch) by spancratz created at 2011-01-12 19:05:14\n\nVersion for 4.6.1.rc0",
    "created_at": "2011-01-12T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110182",
    "user": "spancratz"
}
```

Attachment [trac-10596-461rc0.patch](tarball://root/attachments/some-uuid/ticket10596/trac-10596-461rc0.patch) by spancratz created at 2011-01-12 19:05:14

Version for 4.6.1.rc0



---

archive/issue_comments_110183.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-13T23:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110183",
    "user": "@adeines"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110184.json:
```json
{
    "body": "All tests pass for me.  \n\nThere's some of code I don't understand . . . so I'm not giving this a positive review.",
    "created_at": "2011-01-13T23:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110184",
    "user": "@adeines"
}
```

All tests pass for me.  

There's some of code I don't understand . . . so I'm not giving this a positive review.



---

archive/issue_comments_110185.json:
```json
{
    "body": "*integer.pyx*: `ndigits()`: unsigned long b is never used. (rc0 patch version)",
    "created_at": "2011-01-14T16:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110185",
    "user": "@a-andre"
}
```

*integer.pyx*: `ndigits()`: unsigned long b is never used. (rc0 patch version)



---

archive/issue_comments_110186.json:
```json
{
    "body": "Hi Sebastian, \n\nHope you're well. Trivial comment: it's the done thing to put full names, not trac usernames, in the Author and Reviewer fields because they're used for compiling the release notes.\n\nLess trivial: can you perhaps do a micro-patch that gets rid of the unused variable in ndigits? The rest of the code looks fine to me, and it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting (it already conflicts with my patch at #10625, sigh).\n\nRegards, David",
    "created_at": "2011-01-18T08:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110186",
    "user": "@loefflerd"
}
```

Hi Sebastian, 

Hope you're well. Trivial comment: it's the done thing to put full names, not trac usernames, in the Author and Reviewer fields because they're used for compiling the release notes.

Less trivial: can you perhaps do a micro-patch that gets rid of the unused variable in ndigits? The rest of the code looks fine to me, and it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting (it already conflicts with my patch at #10625, sigh).

Regards, David



---

archive/issue_comments_110187.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-14T11:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110187",
    "user": "@mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_110188.json:
```json
{
    "body": "Replying to [comment:11 davidloeffler]:\n> it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting\n\nBitrotting happened: failed to apply trac-10596-461rc0.patch on sage-4.6.2.alpha4",
    "created_at": "2011-02-14T11:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110188",
    "user": "@mstreng"
}
```

Replying to [comment:11 davidloeffler]:
> it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting

Bitrotting happened: failed to apply trac-10596-461rc0.patch on sage-4.6.2.alpha4



---

archive/issue_comments_110189.json:
```json
{
    "body": "Rebased the patch by spancratz and added a patch that removes some trailing whitespaces.\n\nApply [attachment:trac_10596_remove_trailing_whitespaces.patch trac_10596_remove_trailing_whitespaces.patch] after [attachment:trac_10596.patch trac_10596.patch]",
    "created_at": "2011-11-13T17:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110189",
    "user": "@a-andre"
}
```

Rebased the patch by spancratz and added a patch that removes some trailing whitespaces.

Apply [attachment:trac_10596_remove_trailing_whitespaces.patch trac_10596_remove_trailing_whitespaces.patch] after [attachment:trac_10596.patch trac_10596.patch]



---

archive/issue_comments_110190.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-11-13T17:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110190",
    "user": "@a-andre"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110191.json:
```json
{
    "body": "Attachment [trac_10596_remove_trailing_whitespaces.patch](tarball://root/attachments/some-uuid/ticket10596/trac_10596_remove_trailing_whitespaces.patch) by @a-andre created at 2011-11-26 14:52:31",
    "created_at": "2011-11-26T14:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110191",
    "user": "@a-andre"
}
```

Attachment [trac_10596_remove_trailing_whitespaces.patch](tarball://root/attachments/some-uuid/ticket10596/trac_10596_remove_trailing_whitespaces.patch) by @a-andre created at 2011-11-26 14:52:31



---

archive/issue_comments_110192.json:
```json
{
    "body": "I removed the *ndigits()* part because problem was fixed in #11796.",
    "created_at": "2011-11-26T14:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110192",
    "user": "@a-andre"
}
```

I removed the *ndigits()* part because problem was fixed in #11796.



---

archive/issue_comments_110193.json:
```json
{
    "body": "The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?",
    "created_at": "2011-12-16T20:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110193",
    "user": "@JohnCremona"
}
```

The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?



---

archive/issue_comments_110194.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-12-16T20:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110194",
    "user": "@JohnCremona"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_110195.json:
```json
{
    "body": "Replying to [comment:17 cremona]:\n> The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?\n\nAll tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.",
    "created_at": "2011-12-16T21:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110195",
    "user": "@JohnCremona"
}
```

Replying to [comment:17 cremona]:
> The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?

All tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.



---

archive/issue_comments_110196.json:
```json
{
    "body": "Replying to [comment:18 cremona]:\n> Replying to [comment:17 cremona]:\n> > The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?\n> \n> All tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.\n\nThe warnings seem not to be caused by this patch at since when I popped the patch and rebuilt they came up again.  So, do they matter?",
    "created_at": "2011-12-16T21:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110196",
    "user": "@JohnCremona"
}
```

Replying to [comment:18 cremona]:
> Replying to [comment:17 cremona]:
> > The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?
> 
> All tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.

The warnings seem not to be caused by this patch at since when I popped the patch and rebuilt they came up again.  So, do they matter?



---

archive/issue_comments_110197.json:
```json
{
    "body": "Warnings are caused by lines like\n\n```\ncdef mpz_t tmp\nmpz_init(tmp)\n```\n\nThis seems to be a Cython problem, see http://trac.cython.org/cython_trac/ticket/714 and http://mail.python.org/pipermail/cython-devel/2011-September/001437.html, so warnings shouldn't matter.",
    "created_at": "2011-12-19T16:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110197",
    "user": "@a-andre"
}
```

Warnings are caused by lines like

```
cdef mpz_t tmp
mpz_init(tmp)
```

This seems to be a Cython problem, see http://trac.cython.org/cython_trac/ticket/714 and http://mail.python.org/pipermail/cython-devel/2011-September/001437.html, so warnings shouldn't matter.



---

archive/issue_comments_110198.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-12-19T16:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110198",
    "user": "@a-andre"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_110199.json:
```json
{
    "body": "See also comment:17:ticket:11761.",
    "created_at": "2011-12-19T16:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110199",
    "user": "@a-andre"
}
```

See also comment:17:ticket:11761.



---

archive/issue_comments_110200.json:
```json
{
    "body": "Replying to [comment:18 cremona]:\n> I would give a positive review were it not for those warnings.\n\nAnd #11761 shows that the warnings are ok.",
    "created_at": "2012-01-12T12:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110200",
    "user": "@mstreng"
}
```

Replying to [comment:18 cremona]:
> I would give a positive review were it not for those warnings.

And #11761 shows that the warnings are ok.



---

archive/issue_comments_110201.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-12T12:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110201",
    "user": "@mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110202.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-15T21:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110202",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_110203.json:
```json
{
    "body": "Apply trac_10596.patch, trac_10596_remove_trailing_whitespaces.patch\n\n(for the patchbot, so it understands the prerequisites for building #12116 against Sage 4.8)",
    "created_at": "2012-03-11T10:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10543#issuecomment-110203",
    "user": "@loefflerd"
}
```

Apply trac_10596.patch, trac_10596_remove_trailing_whitespaces.patch

(for the patchbot, so it understands the prerequisites for building #12116 against Sage 4.8)
