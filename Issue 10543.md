# Issue 10543: Misc improvements to arithmetic

Issue created by migration from https://trac.sagemath.org/ticket/10596

Original creator: spancratz

Original creation time: 2011-01-12 00:58:09

Assignee: AlexGhitza

CC:  jthurber zimmerma

Generic code clean-up such as line breaks, empty lines etc

``n.digits()``

Before:

```
sage: n = 10**10000000-10**9999990
sage: timeit('n.ndigits()')
625 loops, best of 3: 46.6 µs per loop
sage: timeit('(-n).ndigits()')
25 loops, best of 3: 9.04 ms per loop
```


```
sage: ZZ(0).ndigits()
0
sage: ZZ(0).ndigits(base=2)
0
sage: ZZ(0).nbits()
1
```


After:

```
sage: n = 10**10000000-10**9999990
sage: timeit('n.ndigits()')
625 loops, best of 3: 1.02 µs per loop
sage: timeit('(-n).ndigits()')
125 loops, best of 3: 4.57 ms per loop
```


```
sage: ZZ(0).ndigits()
1
sage: ZZ(0).ndigits(base=2)
1
sage: ZZ(0).nbits()
1
```



---

Attachment


---

Comment by spancratz created at 2011-01-12 04:18:58

Changing status from new to needs_review.


---

Comment by spancratz created at 2011-01-12 04:19:16

Changing priority from major to trivial.


---

Comment by jthurber created at 2011-01-12 06:20:01

I had the following failures to apply, 4.6.1.rc1 on OS X.
This doesn't have 5945 as a prerequisite, does it?


```
22:14:56johnthurber~/sage/sage-4.6.1.rc1/devel/sage$ hg qpush
applying trac-10596.patch
patching file sage/rings/integer.pyx
Hunk #10 FAILED at 1268
Hunk #37 succeeded at 3276 with fuzz 1 (offset -106 lines).
Hunk #42 FAILED at 3577
Hunk #58 succeeded at 4302 with fuzz 1 (offset -106 lines).
Hunk #62 succeeded at 4643 with fuzz 2 (offset -106 lines).
Hunk #73 FAILED at 5289
3 out of 82 hunks FAILED -- saving rejects to file sage/rings/integer.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac-10596.patch
```



---

Comment by aly.deines created at 2011-01-12 06:48:15

Changing status from needs_review to needs_work.


---

Comment by aly.deines created at 2011-01-12 06:48:15

I had the same thing happen as well.


---

Comment by spancratz created at 2011-01-12 17:55:06

I'm sorry, I think this is because I was working on this with 4.6.0 rather than 4.6.1.rc0.  I will fix that this morning.  Sebastian


---

Attachment

Version for 4.6.1.rc0


---

Comment by aly.deines created at 2011-01-13 23:25:32

Changing status from needs_work to needs_review.


---

Comment by aly.deines created at 2011-01-13 23:25:32

All tests pass for me.  

There's some of code I don't understand . . . so I'm not giving this a positive review.


---

Comment by aapitzsch created at 2011-01-14 16:57:18

_integer.pyx_: `ndigits()`: unsigned long b is never used. (rc0 patch version)


---

Comment by davidloeffler created at 2011-01-18 08:15:54

Hi Sebastian, 

Hope you're well. Trivial comment: it's the done thing to put full names, not trac usernames, in the Author and Reviewer fields because they're used for compiling the release notes.

Less trivial: can you perhaps do a micro-patch that gets rid of the unused variable in ndigits? The rest of the code looks fine to me, and it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting (it already conflicts with my patch at #10625, sigh).

Regards, David


---

Comment by mstreng created at 2011-02-14 11:36:52

Changing status from needs_review to needs_work.


---

Comment by mstreng created at 2011-02-14 11:36:52

Replying to [comment:11 davidloeffler]:
> it would be good to get this positively reviewed soon, because any patch that changes quite so many lines of code is going to be highly vulnerable to bitrotting

Bitrotting happened: failed to apply trac-10596-461rc0.patch on sage-4.6.2.alpha4


---

Comment by aapitzsch created at 2011-11-13 17:23:26

Rebased the patch by spancratz and added a patch that removes some trailing whitespaces.

Apply [attachment:trac_10596_remove_trailing_whitespaces.patch trac_10596_remove_trailing_whitespaces.patch] after [attachment:trac_10596.patch trac_10596.patch]


---

Comment by aapitzsch created at 2011-11-13 17:23:26

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by aapitzsch created at 2011-11-26 14:58:42

I removed the _ndigits()_ part because problem was fixed in #11796.


---

Comment by cremona created at 2011-12-16 20:53:17

The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?


---

Comment by cremona created at 2011-12-16 20:53:17

Changing status from needs_review to needs_info.


---

Comment by cremona created at 2011-12-16 21:41:08

Replying to [comment:17 cremona]:
> The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?

All tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.


---

Comment by cremona created at 2011-12-16 21:42:46

Replying to [comment:18 cremona]:
> Replying to [comment:17 cremona]:
> > The patches apply cleanly to 4.8.alpha4: but there are quite a few warning on rebuilding, about variables being referenced before assignment.  Does this matter?
> 
> All tests pass and docbuild is clean.  I would give a  positive review were it not for those warnings.  If someone knows that they are not serious, please tell me.

The warnings seem not to be caused by this patch at since when I popped the patch and rebuilt they came up again.  So, do they matter?


---

Comment by aapitzsch created at 2011-12-19 16:31:11

Warnings are caused by lines like

```
cdef mpz_t tmp
mpz_init(tmp)
```

This seems to be a Cython problem, see http://trac.cython.org/cython_trac/ticket/714 and http://mail.python.org/pipermail/cython-devel/2011-September/001437.html, so warnings shouldn't matter.


---

Comment by aapitzsch created at 2011-12-19 16:31:11

Changing status from needs_info to needs_review.


---

Comment by aapitzsch created at 2011-12-19 16:36:19

See also comment:17:ticket:11761.


---

Comment by mstreng created at 2012-01-12 12:12:20

Replying to [comment:18 cremona]:
> I would give a positive review were it not for those warnings.

And #11761 shows that the warnings are ok.


---

Comment by mstreng created at 2012-01-12 12:12:20

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-01-15 21:56:30

Resolution: fixed


---

Comment by davidloeffler created at 2012-03-11 10:26:05

Apply trac_10596.patch, trac_10596_remove_trailing_whitespaces.patch

(for the patchbot, so it understands the prerequisites for building #12116 against Sage 4.8)
