# Issue 11593: Sage's 'pkg-config' directory should always be added to PKG_CONFIG_PATH

Issue created by migration from https://trac.sagemath.org/ticket/11765

Original creator: leif

Original creation time: 2011-08-31 17:25:23

Assignee: leif

CC:  fbissey jhpalmieri

Keywords: pkgconfig .pc sage-env

Currently, `PKG_CONFIG_PATH` is only *set* to Sage's `pkg-config` directory (`$SAGE_ROOT/local/lib/pkgconfig/`) if it is empty (or not set at all).

The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.

The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the "global" environment, i.e. outside the Sage environment.


---

Comment by leif created at 2011-08-31 17:37:11

SCRIPTS repo. Based on Sage 4.7.2.alpha2.


---

Attachment


---

Comment by leif created at 2011-08-31 17:41:52

Changing status from new to needs_review.


---

Comment by fbissey created at 2011-08-31 22:15:24

I looked at the patch and the reasoning is sound. I cannot test the patch properly right now but it looks correct to me.


---

Comment by strogdon created at 2011-10-26 04:24:15

Changing status from needs_review to positive_review.


---

Comment by strogdon created at 2011-10-26 04:24:15

I encountered this pkg-config problem while building vanilla sage-4.7.2.rc0 in a gentoo prefix on two different debian machines. On a x86 machine the build broke at the R spkg and on an amd64 machine at the matplotlib spkg. In both situations the failure was due to an incompatibility resulting from trying to include headers for libpng15, my system libpng headers, instead of headers for the sage-installed libpng12. Applying this patch allowed the correct headers to be located and sage to be built on both machines. I give this a positive review. The patch may need to be rebased.


```
patching file sage-env
Hunk #2 succeeded at 261 (offset 7 lines).
```



---

Comment by strogdon created at 2011-10-26 15:30:14

Perhaps an explanation, which was pointed out to me by François, is in order as to why the patch is needed here. I had previously built sage-4.7.2.rc0 on a gentoo system without a problem. However, the build process broke when done from within a gentoo prefix. On gentoo PKG_CONFIG_PATH is not defined, by default, and thus there was no problem. But from within gentoo prefix PKG_CONFIG_PATH is defined. Thus the patch is needed there to prepend to PKG_CONFIG_PATH the sage paths so the correct .pc files can be found.


---

Comment by fbissey created at 2011-10-26 20:45:31

Changing priority from critical to blocker.


---

Comment by fbissey created at 2011-10-26 20:45:31

PKG_CONFIG_PATH is not defined on Gentoo full stop. Prefix or regular. So this may break sage in subtle ways. R-2.10.1 as shipped in sage may break in the build stage because it is not compatible with png-1.5.

I will elevate this to blocker and rebase it ASAP. Jeroen can decide whether it should be shipped in 4.7.2.


---

Comment by leif created at 2011-10-26 21:31:11

Replying to [comment:5 fbissey]:
> I will elevate this to blocker and rebase it ASAP.

Well, there's no fuzz, just a few lines offset, so you don't have to rebase the patch.


---

Attachment

SCRIPTS repo. Same patch rebased on Sage 4.7.2.rc0.


---

Comment by fbissey created at 2011-10-26 21:36:23

Well thanks that saves me the work :)


---

Comment by leif created at 2011-10-26 21:38:19

Replying to [comment:7 fbissey]:
> Well thanks that saves me the work :)

If it makes you happy... ;-)


---

Comment by jdemeyer created at 2011-10-27 13:45:33

Resolution: fixed
