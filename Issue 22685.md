# Issue 22685: Faster implementation of LLT polynomials

archive/issues_022685.json:
```json
{
    "body": "CC:  mariamonks @tscrim @anneschilling @saliola phubert\n\nKeywords: LLT polynomials\n\nThis ticket implements the LLT polynomials via the inv statistic.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22922\n\n",
    "created_at": "2017-05-01T19:38:44Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Faster implementation of LLT polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22685",
    "user": "https://trac.sagemath.org/admin/accounts/users/wpoh"
}
```
CC:  mariamonks @tscrim @anneschilling @saliola phubert

Keywords: LLT polynomials

This ticket implements the LLT polynomials via the inv statistic.

Issue created by migration from https://trac.sagemath.org/ticket/22922





---

archive/issue_comments_316150.json:
```json
{
    "body": "Hi Wencin,\n\nThank you for working on this feature! You need to stick to the Sage coding conventions to get your code into Sage, see http://doc.sagemath.org/html/en/developer/coding_basics.html\n\nIn particular, you need a one sentence description of each method, followed by a longer description and INPUT and OUTPUT. But most importantly, you need\n\n```\nEXAMPLES::\n\n    sage: Sym = SymmetricFunction(QQ)\n    sage: LLT = Sym.llt(3)\n```\n\netc which shows how to use the code and what output is expected. This serves also as tests that are run and checked with every new release, so this part is very important!\n\nIt would also be good if your code was integrated into the symmetric function setup, so that it can eventually used from there and replace the current implementation (if it is indeed correct and faster than the current implementation).\n\nAnne",
    "created_at": "2017-06-10T00:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316150",
    "user": "https://github.com/anneschilling"
}
```

Hi Wencin,

Thank you for working on this feature! You need to stick to the Sage coding conventions to get your code into Sage, see http://doc.sagemath.org/html/en/developer/coding_basics.html

In particular, you need a one sentence description of each method, followed by a longer description and INPUT and OUTPUT. But most importantly, you need

```
EXAMPLES::

    sage: Sym = SymmetricFunction(QQ)
    sage: LLT = Sym.llt(3)
```

etc which shows how to use the code and what output is expected. This serves also as tests that are run and checked with every new release, so this part is very important!

It would also be good if your code was integrated into the symmetric function setup, so that it can eventually used from there and replace the current implementation (if it is indeed correct and faster than the current implementation).

Anne



---

archive/issue_comments_316151.json:
```json
{
    "body": "Changing keywords from \"LLT polynomials\" to \"LLT polynomials, days88, IMA coding sprints\".",
    "created_at": "2017-08-21T16:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316151",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "LLT polynomials" to "LLT polynomials, days88, IMA coding sprints".



---

archive/issue_comments_316152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T04:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316153.json:
```json
{
    "body": "Hi Anne, Franco and Maria,\n\nI have just pushed the latest version of the code that computes the LLT polynomial using the inversion statistic. It has now been integrated in llt.py and no longer depends on the length of alphabet x_1,x_2,x_3,... Kindly take a look, try it out, or let me know if there are areas that could be improved.\n\nBest regards, \nWencin",
    "created_at": "2017-09-14T04:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316153",
    "user": "https://trac.sagemath.org/admin/accounts/users/wpoh"
}
```

Hi Anne, Franco and Maria,

I have just pushed the latest version of the code that computes the LLT polynomial using the inversion statistic. It has now been integrated in llt.py and no longer depends on the length of alphabet x_1,x_2,x_3,... Kindly take a look, try it out, or let me know if there are areas that could be improved.

Best regards, 
Wencin



---

archive/issue_comments_316154.json:
```json
{
    "body": "Hi Wencin,\n\nThank you! Could you please also post your timings of the new code compared to the old code?\n\nAnne",
    "created_at": "2017-09-14T04:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316154",
    "user": "https://github.com/anneschilling"
}
```

Hi Wencin,

Thank you! Could you please also post your timings of the new code compared to the old code?

Anne



---

archive/issue_comments_316155.json:
```json
{
    "body": "Attachment [LLT Runtimes.txt](tarball://root/attachments/some-uuid/ticket22922/LLT Runtimes.txt) by wpoh created at 2017-09-15 04:54:36\n\nRunning times for computing LLT polynomials based on tuples of partitions for up to a sequence of 3 partitions, with partition sizes at most 3. Timings are reported with existing implementation in Sage first, followed by the proposed implementation, based on the timeit command.",
    "created_at": "2017-09-15T04:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316155",
    "user": "https://trac.sagemath.org/admin/accounts/users/wpoh"
}
```

Attachment [LLT Runtimes.txt](tarball://root/attachments/some-uuid/ticket22922/LLT Runtimes.txt) by wpoh created at 2017-09-15 04:54:36

Running times for computing LLT polynomials based on tuples of partitions for up to a sequence of 3 partitions, with partition sizes at most 3. Timings are reported with existing implementation in Sage first, followed by the proposed implementation, based on the timeit command.



---

archive/issue_comments_316156.json:
```json
{
    "body": "Hi Anne,\n\nI have just attached a list of the running times with the running time for the existing implementation listed first, followed by the proposed one. Here are some selected examples:\n\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['t']))\nsage: L = Sym.llt(3)\nsage: timeit(\"g1 = L.cospin([[3],[3],[3]])\")\n5 loops, best of 3: 6.09 s per loop\nsage: timeit(\"g2 = L.llt_inv([[3],[3],[3]])\")\n5 loops, best of 3: 5.94 s per loop\n```\n\n\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['t']))\nsage: L = Sym.llt(3)\nsage: timeit(\"g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])\")\n5 loops, best of 3: 3.26 s per loop\nsage: timeit(\"g2 = L.llt_inv([[1,1,1],[1,1,1],[1,1,1]])\")\n5 loops, best of 3: 3.58 s per loop\n```\n\n\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['t']))\nsage: L = Sym.llt(3)\nsage: timeit(\"g1 = L.cospin([[2,1],[1,1],[2,1]])\")\n5 loops, best of 3: 4.76 s per loop\nsage: timeit(\"g2 = L.llt_inv([[2,1],[1,1],[2,1]])\")\n5 loops, best of 3: 2.98 s per loop\n```\n\n\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['t']))\nsage: L = Sym.llt(3)\nsage: timeit(\"g1 = L.cospin([[],[],[]])\")\n625 loops, best of 3: 354 \u00b5s per loop\nsage: timeit(\"g2 = L.llt_inv([[],[],[]])\")\n125 loops, best of 3: 3.66 ms per loop\n```\n\n\nBest regards,\nWencin",
    "created_at": "2017-09-15T05:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316156",
    "user": "https://trac.sagemath.org/admin/accounts/users/wpoh"
}
```

Hi Anne,

I have just attached a list of the running times with the running time for the existing implementation listed first, followed by the proposed one. Here are some selected examples:


```
sage: Sym = SymmetricFunctions(FractionField(QQ['t']))
sage: L = Sym.llt(3)
sage: timeit("g1 = L.cospin([[3],[3],[3]])")
5 loops, best of 3: 6.09 s per loop
sage: timeit("g2 = L.llt_inv([[3],[3],[3]])")
5 loops, best of 3: 5.94 s per loop
```



```
sage: Sym = SymmetricFunctions(FractionField(QQ['t']))
sage: L = Sym.llt(3)
sage: timeit("g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])")
5 loops, best of 3: 3.26 s per loop
sage: timeit("g2 = L.llt_inv([[1,1,1],[1,1,1],[1,1,1]])")
5 loops, best of 3: 3.58 s per loop
```



```
sage: Sym = SymmetricFunctions(FractionField(QQ['t']))
sage: L = Sym.llt(3)
sage: timeit("g1 = L.cospin([[2,1],[1,1],[2,1]])")
5 loops, best of 3: 4.76 s per loop
sage: timeit("g2 = L.llt_inv([[2,1],[1,1],[2,1]])")
5 loops, best of 3: 2.98 s per loop
```



```
sage: Sym = SymmetricFunctions(FractionField(QQ['t']))
sage: L = Sym.llt(3)
sage: timeit("g1 = L.cospin([[],[],[]])")
625 loops, best of 3: 354 Âµs per loop
sage: timeit("g2 = L.llt_inv([[],[],[]])")
125 loops, best of 3: 3.66 ms per loop
```


Best regards,
Wencin



---

archive/issue_comments_316157.json:
```json
{
    "body": "Hi Wencin,\n\nThank you for the timings. However, I am a little confused about the diff file for your branch. I was expecting to see just a new method in the file sage/combinat/sf/llt.py. Instead it looks like you put a new file called llt.py in the root of sage (plus some other new files). I suggest that you remove these files for the ticket and instead replace the file sage/combinat/sf/llt.py with your new version. Otherwise the commands\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['t']))\nsage: L = Sym.llt(3)\nL.llt_inv([[],[],[]])\n```\n\ndo not actually work.\n\nThank you,\n\nAnne",
    "created_at": "2017-09-15T05:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316157",
    "user": "https://github.com/anneschilling"
}
```

Hi Wencin,

Thank you for the timings. However, I am a little confused about the diff file for your branch. I was expecting to see just a new method in the file sage/combinat/sf/llt.py. Instead it looks like you put a new file called llt.py in the root of sage (plus some other new files). I suggest that you remove these files for the ticket and instead replace the file sage/combinat/sf/llt.py with your new version. Otherwise the commands

```
sage: Sym = SymmetricFunctions(FractionField(QQ['t']))
sage: L = Sym.llt(3)
L.llt_inv([[],[],[]])
```

do not actually work.

Thank you,

Anne



---

archive/issue_comments_316158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-21T04:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-24T04:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316160.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-24T04:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316161.json:
```json
{
    "body": "Something else you might be interested in for profiling code is `%lprun`:\n\nhttp://doc.sagemath.org/html/en/thematic_tutorials/profiling.html#python-level-line-by-line-profiling-lprun\n\n\n```\nsage: R = algebras.Schur(QQ, 4, 2)\nsage: x = R.an_element()\nsage: %lprun -f R.product_on_basis x * x\n```\n\nYou can also simultaneously profile multiple functions by adding an extra `-f function_name`.",
    "created_at": "2017-09-24T16:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316161",
    "user": "https://github.com/tscrim"
}
```

Something else you might be interested in for profiling code is `%lprun`:

http://doc.sagemath.org/html/en/thematic_tutorials/profiling.html#python-level-line-by-line-profiling-lprun


```
sage: R = algebras.Schur(QQ, 4, 2)
sage: x = R.an_element()
sage: %lprun -f R.product_on_basis x * x
```

You can also simultaneously profile multiple functions by adding an extra `-f function_name`.



---

archive/issue_comments_316162.json:
```json
{
    "body": "I did some old-school optimization of the current LLT polynomials. Since Wencin and Anne noticed that the current version uses the same mathematical algorithm as Wencin's newer version, we decided to focus more on doing the current improvements. This also includes some improvements to partitions. We now get\n\n```\nsage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(3)\nsage: %timeit g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])\n1 loop, best of 3: 853 ms per loop\nsage: %timeit g1 = L.cospin([[3],[3],[3]])\n1 loop, best of 3: 2.05 s per loop\nsage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(4)\nsage: %timeit g1 = L.cospin([[1,1],[3],[1],[2,1]])\n1 loop, best of 3: 10.1 s per loop\n```\n\nversus the old\n\n```\nsage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(3)\nsage: %timeit g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])\n1 loop, best of 3: 2.69 s per loop\nsage: %timeit g1 = L.cospin([[3],[3],[3]])\n1 loop, best of 3: 5.13 s per loop\nsage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(4)\nsage: %timeit g1 = L.cospin([[1,1],[3],[1],[2,1]])\n1 loop, best of 3: 24.4 s per loop\n```\n\n\nI did also do some optimizations to Wencin's code, which is available on this branch:\n\n```\npublic/combinat/faster_llt_polynomials-old\n```\n\nHowever, it was only around a 10-15% improvement.\n----\nNew commits:",
    "created_at": "2017-10-08T01:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316162",
    "user": "https://github.com/tscrim"
}
```

I did some old-school optimization of the current LLT polynomials. Since Wencin and Anne noticed that the current version uses the same mathematical algorithm as Wencin's newer version, we decided to focus more on doing the current improvements. This also includes some improvements to partitions. We now get

```
sage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(3)
sage: %timeit g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])
1 loop, best of 3: 853 ms per loop
sage: %timeit g1 = L.cospin([[3],[3],[3]])
1 loop, best of 3: 2.05 s per loop
sage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(4)
sage: %timeit g1 = L.cospin([[1,1],[3],[1],[2,1]])
1 loop, best of 3: 10.1 s per loop
```

versus the old

```
sage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(3)
sage: %timeit g1 = L.cospin([[1,1,1],[1,1,1],[1,1,1]])
1 loop, best of 3: 2.69 s per loop
sage: %timeit g1 = L.cospin([[3],[3],[3]])
1 loop, best of 3: 5.13 s per loop
sage: L = SymmetricFunctions(FractionField(QQ['t'])).llt(4)
sage: %timeit g1 = L.cospin([[1,1],[3],[1],[2,1]])
1 loop, best of 3: 24.4 s per loop
```


I did also do some optimizations to Wencin's code, which is available on this branch:

```
public/combinat/faster_llt_polynomials-old
```

However, it was only around a 10-15% improvement.
----
New commits:



---

archive/issue_comments_316163.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-08T01:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316163",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316164.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-08T04:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316164",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316165.json:
```json
{
    "body": "There is a doctest failure in integer_matrices.py\n\n```\nsage -t integer_matrices.py\n**********************************************************************\nFile \"integer_matrices.py\", line 219, in sage.combinat.integer_matrices.IntegerMatrices.cardinality\nFailed example:\n    len(IntegerMatrices([0], [0]).list())\nException raised:\n    Traceback (most recent call last):\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.integer_matrices.IntegerMatrices.cardinality[11]>\", line 1, in <module>\n        len(IntegerMatrices([Integer(0)], [Integer(0)]).list())\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/categories/finite_enumerated_sets.py\", line 255, in list\n        return self._list_from_iterator()\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/categories/finite_enumerated_sets.py\", line 359, in _list_from_iterator\n        result = list(self.__iter__())\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_matrices.py\", line 139, in __iter__\n        yield matrix(ZZ, x)\n      File \"sage/matrix/constructor.pyx\", line 797, in sage.matrix.constructor.MatrixFactory.__call__ (build/cythonized/sage/matrix/constructor.c:7281)\n        return MatrixSpace(ring, nrows, ncols, sparse=sparse)(entries)\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 554, in __call__\n        return self.matrix(entries, coerce, copy)\n      File \"/Applications/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 1563, in matrix\n        return MC(self, x, copy=copy, coerce=coerce)\n      File \"sage/matrix/matrix_integer_dense.pyx\", line 367, in sage.matrix.matrix_integer_dense.Matrix_integer_dense.__init__ (build/cythonized/sage/matrix/matrix_integer_dense.c:7156)\n        x = ZZ(entries_list[k])\n      File \"sage/structure/parent.pyx\", line 940, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9573)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 154, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4919)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 149, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4781)\n        return C._element_constructor(x)\n      File \"sage/rings/integer.pyx\", line 721, in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6673)\n        raise TypeError(\"unable to coerce %s to an integer\" % type(x))\n    TypeError: unable to coerce <class 'sage.combinat.composition.Compositions_all_with_category.element_class'> to an integer\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.combinat.integer_matrices.IntegerMatrices.cardinality\n    [51 tests, 1 failure, 0.79 s]\n----------------------------------------------------------------------\nsage -t integer_matrices.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 0.8 seconds\n    cumulative wall time: 0.8 seconds\n```\n",
    "created_at": "2017-10-08T04:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316165",
    "user": "https://github.com/anneschilling"
}
```

There is a doctest failure in integer_matrices.py

```
sage -t integer_matrices.py
**********************************************************************
File "integer_matrices.py", line 219, in sage.combinat.integer_matrices.IntegerMatrices.cardinality
Failed example:
    len(IntegerMatrices([0], [0]).list())
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.integer_matrices.IntegerMatrices.cardinality[11]>", line 1, in <module>
        len(IntegerMatrices([Integer(0)], [Integer(0)]).list())
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/categories/finite_enumerated_sets.py", line 255, in list
        return self._list_from_iterator()
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/categories/finite_enumerated_sets.py", line 359, in _list_from_iterator
        result = list(self.__iter__())
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_matrices.py", line 139, in __iter__
        yield matrix(ZZ, x)
      File "sage/matrix/constructor.pyx", line 797, in sage.matrix.constructor.MatrixFactory.__call__ (build/cythonized/sage/matrix/constructor.c:7281)
        return MatrixSpace(ring, nrows, ncols, sparse=sparse)(entries)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 554, in __call__
        return self.matrix(entries, coerce, copy)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 1563, in matrix
        return MC(self, x, copy=copy, coerce=coerce)
      File "sage/matrix/matrix_integer_dense.pyx", line 367, in sage.matrix.matrix_integer_dense.Matrix_integer_dense.__init__ (build/cythonized/sage/matrix/matrix_integer_dense.c:7156)
        x = ZZ(entries_list[k])
      File "sage/structure/parent.pyx", line 940, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9573)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 154, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4919)
        raise
      File "sage/structure/coerce_maps.pyx", line 149, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4781)
        return C._element_constructor(x)
      File "sage/rings/integer.pyx", line 721, in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6673)
        raise TypeError("unable to coerce %s to an integer" % type(x))
    TypeError: unable to coerce <class 'sage.combinat.composition.Compositions_all_with_category.element_class'> to an integer
**********************************************************************
1 item had failures:
   1 of  13 in sage.combinat.integer_matrices.IntegerMatrices.cardinality
    [51 tests, 1 failure, 0.79 s]
----------------------------------------------------------------------
sage -t integer_matrices.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.8 seconds
    cumulative wall time: 0.8 seconds
```




---

archive/issue_comments_316166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-08T07:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316167.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-08T07:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316167",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_316168.json:
```json
{
    "body": "This should fix it. There was a case that was missed that was not returning a list of a list.",
    "created_at": "2017-10-08T07:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316168",
    "user": "https://github.com/tscrim"
}
```

This should fix it. There was a case that was missed that was not returning a list of a list.



---

archive/issue_comments_316169.json:
```json
{
    "body": "Thank you! I can confirm that the new code gives a factor 2-3 speed up over the old version.",
    "created_at": "2017-10-08T17:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316169",
    "user": "https://github.com/anneschilling"
}
```

Thank you! I can confirm that the new code gives a factor 2-3 speed up over the old version.



---

archive/issue_comments_316170.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-08T17:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316170",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_021330.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-10-16T22:44:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22685#event-21330"
}
```



---

archive/issue_comments_316171.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-16T22:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22685#issuecomment-316171",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
