# Issue 10946: Bug in mapping to residue fields

archive/issues_010946.json:
```json
{
    "body": "Assignee: davidloeffler\n\nCC:  was justin ylchapuy\n\nKeywords: residue field\n\nSee #9417:\n\n```\n\nsage: K.<a> = NumberField(x^2+18*x+1)\nsage: P = K.ideal(2)\nsage: F = K.residue_field(P)\nsage: R = PolynomialRing(F, 'x')\nsage: R([0, a, a, 1])\nx^3 + abar*x^2 + abar*x\nsage: F(a)\n1\nsage: a.minpoly()\nx^2 + 18*x + 1\nsage: F.gen()\nabar\nsage: F.gen().minpoly()\nx^2 + x + 1\n```\n\nThe polynomial `x<sup>3+a*x</sup>2+a*x` reduced modulo P=(2) wrongly to `x<sup>3+abar*x</sup>2+abar*x`. Although the generator of the residue field F is suggestively called abar, it it *not* the reduction of a mod P (which is 1 mod P).\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11055\n\n",
    "created_at": "2011-03-26T22:52:09Z",
    "labels": [
        "number fields",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Bug in mapping to residue fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10946",
    "user": "cremona"
}
```
Assignee: davidloeffler

CC:  was justin ylchapuy

Keywords: residue field

See #9417:

```

sage: K.<a> = NumberField(x^2+18*x+1)
sage: P = K.ideal(2)
sage: F = K.residue_field(P)
sage: R = PolynomialRing(F, 'x')
sage: R([0, a, a, 1])
x^3 + abar*x^2 + abar*x
sage: F(a)
1
sage: a.minpoly()
x^2 + 18*x + 1
sage: F.gen()
abar
sage: F.gen().minpoly()
x^2 + x + 1
```

The polynomial `x<sup>3+a*x</sup>2+a*x` reduced modulo P=(2) wrongly to `x<sup>3+abar*x</sup>2+abar*x`. Although the generator of the residue field F is suggestively called abar, it it *not* the reduction of a mod P (which is 1 mod P).


Issue created by migration from https://trac.sagemath.org/ticket/11055





---

archive/issue_comments_117770.json:
```json
{
    "body": "Note that this is correct:\n\n```\nR([F(co) for co in [0,a,a,1]])\n```\n\nI think the problem lies in lines 94-108 of sage/rings/polynomial/polynomial_zz_pex.pyx, hence I am CC-int Yann L-C! Meanwhile I am using that work-around for #9417.",
    "created_at": "2011-03-27T18:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117770",
    "user": "cremona"
}
```

Note that this is correct:

```
R([F(co) for co in [0,a,a,1]])
```

I think the problem lies in lines 94-108 of sage/rings/polynomial/polynomial_zz_pex.pyx, hence I am CC-int Yann L-C! Meanwhile I am using that work-around for #9417.



---

archive/issue_comments_117771.json:
```json
{
    "body": "see my comments on #9389\n\npolynomial_zz_pex.pyx is not intended to be used for this base ring (maybe it could but it wasn't thought like this).\nThe constructor of the univariate polynomials ring should be more careful.\n\nAnd I'm sorry, but I won't have time to do this myself.",
    "created_at": "2011-03-28T21:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117771",
    "user": "ylchapuy"
}
```

see my comments on #9389

polynomial_zz_pex.pyx is not intended to be used for this base ring (maybe it could but it wasn't thought like this).
The constructor of the univariate polynomials ring should be more careful.

And I'm sorry, but I won't have time to do this myself.



---

archive/issue_comments_117772.json:
```json
{
    "body": "Thanks for reporting back.  I'll try to fix this myself, but in any case I was able to use a simple workaround.",
    "created_at": "2011-03-28T22:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117772",
    "user": "cremona"
}
```

Thanks for reporting back.  I'll try to fix this myself, but in any case I was able to use a simple workaround.



---

archive/issue_comments_117773.json:
```json
{
    "body": "fixed?",
    "created_at": "2015-08-25T15:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117773",
    "user": "jakobkroeker"
}
```

fixed?



---

archive/issue_comments_117774.json:
```json
{
    "body": "With 6.9.beta3 I see this:\n\n```\nK.<a> = NumberField(x^2+18*x+1)\nsage: P = K.ideal(2)\nsage: F = K.residue_field(P)\nsage: R = PolynomialRing(F, 'x')\nsage: R([0, a, a, 1])\nx^3 + x^2 + x\n```\n\nwhich shows that the original issue has been fixed, though I do not know where or when.\n\nI cannot see the \"won't fix\" option but that is what this should now get.",
    "created_at": "2015-08-25T15:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117774",
    "user": "cremona"
}
```

With 6.9.beta3 I see this:

```
K.<a> = NumberField(x^2+18*x+1)
sage: P = K.ideal(2)
sage: F = K.residue_field(P)
sage: R = PolynomialRing(F, 'x')
sage: R([0, a, a, 1])
x^3 + x^2 + x
```

which shows that the original issue has been fixed, though I do not know where or when.

I cannot see the "won't fix" option but that is what this should now get.



---

archive/issue_comments_117775.json:
```json
{
    "body": "Replying to [comment:9 cremona]:\n> With 6.9.beta3 I see this:\n> {{{\n> K.<a> = NumberField(x^2+18*x+1)\n> sage: P = K.ideal(2)\n> sage: F = K.residue_field(P)\n> sage: R = PolynomialRing(F, 'x')\n> sage: R([0, a, a, 1])\n> x^3 + x^2 + x\n> }}}\n> which shows that the original issue has been fixed, though I do not know where or when.\nIt might be #11239.",
    "created_at": "2015-08-25T16:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117775",
    "user": "pbruin"
}
```

Replying to [comment:9 cremona]:
> With 6.9.beta3 I see this:
> {{{
> K.<a> = NumberField(x^2+18*x+1)
> sage: P = K.ideal(2)
> sage: F = K.residue_field(P)
> sage: R = PolynomialRing(F, 'x')
> sage: R([0, a, a, 1])
> x^3 + x^2 + x
> }}}
> which shows that the original issue has been fixed, though I do not know where or when.
It might be #11239.



---

archive/issue_comments_117776.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-25T16:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117776",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_117777.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-25T16:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117777",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_117778.json:
```json
{
    "body": "Replying to [comment:9 cremona]:\n> I cannot see the \"won't fix\" option but that is what this should now get.\nI agree.",
    "created_at": "2015-08-25T16:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117778",
    "user": "pbruin"
}
```

Replying to [comment:9 cremona]:
> I cannot see the "won't fix" option but that is what this should now get.
I agree.



---

archive/issue_comments_117779.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2015-09-12T14:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10946#issuecomment-117779",
    "user": "vbraun"
}
```

Resolution: wontfix
