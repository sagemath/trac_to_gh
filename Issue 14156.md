# Issue 14156: patchbot broken by new doctesting framework

Issue created by migration from https://trac.sagemath.org/ticket/14360

Original creator: vbraun

Original creation time: 2013-03-26 16:28:46

Assignee: mvngu

CC:  robertwb roed

It seems the `-s` option was removed, and this is not just a problem on my patchbot. There is no working sage-5.9.x patchbot at the moment.

```
...
========== end plugins.docbuild ==========
$SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
Usage: sage -t [options] filenames

sage-runtests: error: no such option: -s
Traceback (most recent call last):
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py", line 443, in test_a_ticket
    do_or_die("$SAGE_ROOT/sage %s %s" % (test_cmd, ' '.join(test_dirs)))
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py", line 66, in do_or_die
    raise Exception, "%s %s" % (res, cmd)
Exception: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
2013-03-24 23:14:08 +0000
171 seconds
Traceback (most recent call last):
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py", line 443, in test_a_ticket
    do_or_die("$SAGE_ROOT/sage %s %s" % (test_cmd, ' '.join(test_dirs)))
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py", line 66, in do_or_die
    raise Exception, "%s %s" % (res, cmd)
Exception: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
Reporting 0 TestsFailed
0 TestsFailed
ok
Done reporting 0
```



---

Comment by roed created at 2013-03-26 16:33:49

Does anyone know what the `-s` option does?  I can't find any documentation in the old testing code.


---

Comment by roed created at 2013-03-26 16:43:16

Oh, I see: I didn't read the description closely enough.  This is fixed at https://github.com/robertwb/sage-patchbot: you should update your patchbot.  I'll send an e-mail to sage-devel.


---

Comment by robertwb created at 2013-03-28 03:47:52

http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.3.spkg


---

Comment by robertwb created at 2013-03-28 03:47:52

Changing status from new to needs_review.


---

Comment by roed created at 2013-03-28 03:58:36

Changing status from needs_review to positive_review.


---

Comment by roed created at 2013-03-28 03:58:36

Looks fine to me.


---

Comment by jdemeyer created at 2013-03-28 07:04:08

Changing component from doctest to optional packages.


---

Comment by jdemeyer created at 2013-03-28 07:05:38

`SPKG.txt` needs to be updated.


---

Comment by jdemeyer created at 2013-03-28 07:05:38

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-03-28 07:08:39

The package is missing an `hg` repository (not that I care that much since it's not a standard package).


---

Comment by jdemeyer created at 2013-03-28 07:11:57

The script `make-spkg.sh` should be renamed `spkg-dist` for consistency in naming with similar scripts (and obviously it would be nice if it were documented, but again I don't personally care that much).


---

Comment by jdemeyer created at 2013-03-28 07:13:45

In `SPKG.txt`, "Sage Patchbot 1.2" must be "patchbot-1.2" (imagine we ever make an automatic `SPKG.txt`-parsing tool).


---

Comment by vbraun created at 2013-05-14 08:26:13

For the record, the disk space requirements has increased quite a lot:

```
[patchbot@desktop sage-5.10.beta2]$ du -sh .
714G	.
```

Earlier versions stopped somewhere at the 50-100GB mark.


---

Comment by vbraun created at 2013-05-14 08:28:23

Though perhaps thats just because we run on more patches? Each of the 377 subdirectories `devel/sage-????` is about 1.8G.


---

Comment by vbraun created at 2013-05-15 14:50:34

Also, the patchbot doesn't check German docs. We tripped over this in #13213 where there was a doctest failure in `doc/de/tutorial/tour_advanced.rst` that the patchbot did not find.


---

Comment by vbraun created at 2013-05-16 09:35:00

Looks good to me!


---

Comment by vbraun created at 2013-05-16 09:35:00

Changing status from needs_work to positive_review.


---

Comment by schilly created at 2013-05-19 10:54:09

i've put the spkg on the server.


---

Comment by jdemeyer created at 2013-05-19 12:07:47

Resolution: fixed
