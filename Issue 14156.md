# Issue 14156: patchbot broken by new doctesting framework

archive/issues_014156.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @robertwb @roed314\n\nIt seems the `-s` option was removed, and this is not just a problem on my patchbot. There is no working sage-5.9.x patchbot at the moment.\n\n```\n...\n========== end plugins.docbuild ==========\n$SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage\nUsage: sage -t [options] filenames\n\nsage-runtests: error: no such option: -s\nTraceback (most recent call last):\n  File \"/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py\", line 443, in test_a_ticket\n    do_or_die(\"$SAGE_ROOT/sage %s %s\" % (test_cmd, ' '.join(test_dirs)))\n  File \"/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py\", line 66, in do_or_die\n    raise Exception, \"%s %s\" % (res, cmd)\nException: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage\n2013-03-24 23:14:08 +0000\n171 seconds\nTraceback (most recent call last):\n  File \"/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py\", line 443, in test_a_ticket\n    do_or_die(\"$SAGE_ROOT/sage %s %s\" % (test_cmd, ' '.join(test_dirs)))\n  File \"/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py\", line 66, in do_or_die\n    raise Exception, \"%s %s\" % (res, cmd)\nException: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage\nReporting 0 TestsFailed\n0 TestsFailed\nok\nDone reporting 0\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14360\n\n",
    "created_at": "2013-03-26T16:28:46Z",
    "labels": [
        "component: doctest",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "patchbot broken by new doctesting framework",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14156",
    "user": "https://github.com/vbraun"
}
```
Assignee: mvngu

CC:  @robertwb @roed314

It seems the `-s` option was removed, and this is not just a problem on my patchbot. There is no working sage-5.9.x patchbot at the moment.

```
...
========== end plugins.docbuild ==========
$SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
Usage: sage -t [options] filenames

sage-runtests: error: no such option: -s
Traceback (most recent call last):
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py", line 443, in test_a_ticket
    do_or_die("$SAGE_ROOT/sage %s %s" % (test_cmd, ' '.join(test_dirs)))
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py", line 66, in do_or_die
    raise Exception, "%s %s" % (res, cmd)
Exception: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
2013-03-24 23:14:08 +0000
171 seconds
Traceback (most recent call last):
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/patchbot.py", line 443, in test_a_ticket
    do_or_die("$SAGE_ROOT/sage %s %s" % (test_cmd, ' '.join(test_dirs)))
  File "/mnt/storage2TB/patchbot/Sage/sage-5.9.beta1/local/bin/patchbot/util.py", line 66, in do_or_die
    raise Exception, "%s %s" % (res, cmd)
Exception: 512 $SAGE_ROOT/sage -tp 4 -sagenb $SAGE_ROOT/devel/sage-0/doc/common $SAGE_ROOT/devel/sage-0/doc/en $SAGE_ROOT/devel/sage-0/doc/fr $SAGE_ROOT/devel/sage-0/sage
Reporting 0 TestsFailed
0 TestsFailed
ok
Done reporting 0
```


Issue created by migration from https://trac.sagemath.org/ticket/14360





---

archive/issue_comments_177501.json:
```json
{
    "body": "Does anyone know what the `-s` option does?  I can't find any documentation in the old testing code.",
    "created_at": "2013-03-26T16:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177501",
    "user": "https://github.com/roed314"
}
```

Does anyone know what the `-s` option does?  I can't find any documentation in the old testing code.



---

archive/issue_comments_177502.json:
```json
{
    "body": "Oh, I see: I didn't read the description closely enough.  This is fixed at https://github.com/robertwb/sage-patchbot: you should update your patchbot.  I'll send an e-mail to sage-devel.",
    "created_at": "2013-03-26T16:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177502",
    "user": "https://github.com/roed314"
}
```

Oh, I see: I didn't read the description closely enough.  This is fixed at https://github.com/robertwb/sage-patchbot: you should update your patchbot.  I'll send an e-mail to sage-devel.



---

archive/issue_comments_177503.json:
```json
{
    "body": "http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.3.spkg",
    "created_at": "2013-03-28T03:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177503",
    "user": "https://github.com/robertwb"
}
```

http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.3.spkg



---

archive/issue_comments_177504.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-28T03:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177504",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177505.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-28T03:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177505",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177506.json:
```json
{
    "body": "Looks fine to me.",
    "created_at": "2013-03-28T03:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177506",
    "user": "https://github.com/roed314"
}
```

Looks fine to me.



---

archive/issue_comments_177507.json:
```json
{
    "body": "Changing component from doctest to optional packages.",
    "created_at": "2013-03-28T07:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177507",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from doctest to optional packages.



---

archive/issue_comments_177508.json:
```json
{
    "body": "`SPKG.txt` needs to be updated.",
    "created_at": "2013-03-28T07:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177508",
    "user": "https://github.com/jdemeyer"
}
```

`SPKG.txt` needs to be updated.



---

archive/issue_comments_177509.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-03-28T07:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177509",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_177510.json:
```json
{
    "body": "The package is missing an `hg` repository (not that I care that much since it's not a standard package).",
    "created_at": "2013-03-28T07:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177510",
    "user": "https://github.com/jdemeyer"
}
```

The package is missing an `hg` repository (not that I care that much since it's not a standard package).



---

archive/issue_comments_177511.json:
```json
{
    "body": "The script `make-spkg.sh` should be renamed `spkg-dist` for consistency in naming with similar scripts (and obviously it would be nice if it were documented, but again I don't personally care that much).",
    "created_at": "2013-03-28T07:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177511",
    "user": "https://github.com/jdemeyer"
}
```

The script `make-spkg.sh` should be renamed `spkg-dist` for consistency in naming with similar scripts (and obviously it would be nice if it were documented, but again I don't personally care that much).



---

archive/issue_comments_177512.json:
```json
{
    "body": "In `SPKG.txt`, \"Sage Patchbot 1.2\" must be \"patchbot-1.2\" (imagine we ever make an automatic `SPKG.txt`-parsing tool).",
    "created_at": "2013-03-28T07:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177512",
    "user": "https://github.com/jdemeyer"
}
```

In `SPKG.txt`, "Sage Patchbot 1.2" must be "patchbot-1.2" (imagine we ever make an automatic `SPKG.txt`-parsing tool).



---

archive/issue_comments_177513.json:
```json
{
    "body": "For the record, the disk space requirements has increased quite a lot:\n\n```\n[patchbot@desktop sage-5.10.beta2]$ du -sh .\n714G\t.\n```\n\nEarlier versions stopped somewhere at the 50-100GB mark.",
    "created_at": "2013-05-14T08:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177513",
    "user": "https://github.com/vbraun"
}
```

For the record, the disk space requirements has increased quite a lot:

```
[patchbot@desktop sage-5.10.beta2]$ du -sh .
714G	.
```

Earlier versions stopped somewhere at the 50-100GB mark.



---

archive/issue_comments_177514.json:
```json
{
    "body": "Though perhaps thats just because we run on more patches? Each of the 377 subdirectories `devel/sage-????` is about 1.8G.",
    "created_at": "2013-05-14T08:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177514",
    "user": "https://github.com/vbraun"
}
```

Though perhaps thats just because we run on more patches? Each of the 377 subdirectories `devel/sage-????` is about 1.8G.



---

archive/issue_comments_177515.json:
```json
{
    "body": "Also, the patchbot doesn't check German docs. We tripped over this in #13213 where there was a doctest failure in `doc/de/tutorial/tour_advanced.rst` that the patchbot did not find.",
    "created_at": "2013-05-15T14:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177515",
    "user": "https://github.com/vbraun"
}
```

Also, the patchbot doesn't check German docs. We tripped over this in #13213 where there was a doctest failure in `doc/de/tutorial/tour_advanced.rst` that the patchbot did not find.



---

archive/issue_comments_177516.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2013-05-16T09:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177516",
    "user": "https://github.com/vbraun"
}
```

Looks good to me!



---

archive/issue_comments_177517.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-05-16T09:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177517",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_177518.json:
```json
{
    "body": "i've put the spkg on the server.",
    "created_at": "2013-05-19T10:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177518",
    "user": "https://github.com/haraldschilly"
}
```

i've put the spkg on the server.



---

archive/issue_comments_177519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-19T12:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14156#issuecomment-177519",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_013958.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2013-05-19T12:07:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14156",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14156#event-13958"
}
```
