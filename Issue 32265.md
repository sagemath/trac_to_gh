# Issue 32265: make WeierstrassIsomorphism behave (more) like EllipticCurveIsogeny

archive/issues_032265.json:
```json
{
    "body": "CC:  @defeo @JohnCremona\n\nKeywords: elliptic curves, isogenies, refactoring\n\nThis ticket is the obvious next step after #32388: We move lots of code from `EllipticCurveIsogeny` to `EllipticCurveHom`, and implement the missing `EllipticCurveHom` methods in `WeierstrassIsomorphism`.\n\nThis should make `WeierstrassIsomorphism` close to indistinguishable from `EllipticCurveIsogeny`.\n\nAll the really new code is in `weierstrass_morphism.py` and should be straightforward. The other changes are just moving things around and some small tweaks that shouldn't cause any observable changes in behaviour.\n\n(The only \"real\" dependency is #32388. I've merged the others into this branch too because it made sense, but in principle this could be rebased on top of #32388 alone if one of the others gets stalled for some reason.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/32502\n\n",
    "created_at": "2021-09-11T03:10:46Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "make WeierstrassIsomorphism behave (more) like EllipticCurveIsogeny",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32265",
    "user": "https://github.com/yyyyx4"
}
```
CC:  @defeo @JohnCremona

Keywords: elliptic curves, isogenies, refactoring

This ticket is the obvious next step after #32388: We move lots of code from `EllipticCurveIsogeny` to `EllipticCurveHom`, and implement the missing `EllipticCurveHom` methods in `WeierstrassIsomorphism`.

This should make `WeierstrassIsomorphism` close to indistinguishable from `EllipticCurveIsogeny`.

All the really new code is in `weierstrass_morphism.py` and should be straightforward. The other changes are just moving things around and some small tweaks that shouldn't cause any observable changes in behaviour.

(The only "real" dependency is #32388. I've merged the others into this branch too because it made sense, but in principle this could be rebased on top of #32388 alone if one of the others gets stalled for some reason.)

Issue created by migration from https://trac.sagemath.org/ticket/32502





---

archive/issue_comments_460104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-11T03:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460105.json:
```json
{
    "body": "See here for a diff without all the dependencies:\n* https://git.sagemath.org/sage.git/diff/?id=80b0bb11171daf79122859a83d0940bd3fd2423a&id2=8414b20850b468d0b498bab5ac0e2167f97052f5",
    "created_at": "2021-09-11T03:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460105",
    "user": "https://github.com/yyyyx4"
}
```

See here for a diff without all the dependencies:
* https://git.sagemath.org/sage.git/diff/?id=80b0bb11171daf79122859a83d0940bd3fd2423a&id2=8414b20850b468d0b498bab5ac0e2167f97052f5



---

archive/issue_comments_460106.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-11T03:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460106",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_460107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-11T03:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-14T09:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460109.json:
```json
{
    "body": "Sorry, I cannot review in depth; just a few things.\n\nSome `.. NOTE::` blocks are indented by only three spaces\ninstead of the required four. Please fix.\n\nPossible cosmetic changes (feel free to ignore):\n\n\n```diff\n-            sage: [E.multiplication_by_m_isogeny(m)(P) == m*P for m in (1,2,3,5,7,9)]\n-            [True, True, True, True, True, True]\n+            sage: all(E.multiplication_by_m_isogeny(m)(P) == m*P\n+            ....:     for m in (1, 2, 3, 5, 7, 9))\n+            True\n```\n\n\n\n```diff\n             sage: E = EllipticCurve('99.a1')\n             sage: E.multiplication_by_m_isogeny(5)\n-            Isogeny of degree 25 from Elliptic Curve defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30 over Rational Field to Elliptic Curve defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30 over Rational Field\n+            Isogeny of degree 25\n+              from Elliptic Curve\n+                defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30\n+                over Rational Field\n+              to Elliptic Curve\n+                defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30\n+                over Rational Field\n             sage: E.multiplication_by_m_isogeny(2).rational_maps()\n             ((1/4*x^4 + 33/4*x^2 - 121/2*x + 363/4)/(x^3 - 3/4*x^2 - 33/2*x + 121/4),\n-             (-1/256*x^7 + 1/128*x^6*y - 7/256*x^6 - 3/256*x^5*y - 105/256*x^5 - 165/256*x^4*y + 1255/256*x^4 + 605/128*x^3*y - 473/64*x^3 - 1815/128*x^2*y - 10527/256*x^2 + 2541/128*x*y + 4477/32*x - 1331/128*y - 30613/256)/(1/16*x^6 - 3/32*x^5 - 519/256*x^4 + 341/64*x^3 + 1815/128*x^2 - 3993/64*x + 14641/256))\n+             (-1/256*x^7 + 1/128*x^6*y - 7/256*x^6 - 3/256*x^5*y - 105/256*x^5\n+              - 165/256*x^4*y + 1255/256*x^4 + 605/128*x^3*y - 473/64*x^3\n+              - 1815/128*x^2*y - 10527/256*x^2 + 2541/128*x*y + 4477/32*x\n+              - 1331/128*y - 30613/256)/(1/16*x^6 - 3/32*x^5 - 519/256*x^4\n+              + 341/64*x^3 + 1815/128*x^2 - 3993/64*x + 14641/256))\n```\n\n\n\n```diff\n-            sage: [a == b for a in (wE,mE) for b in (wF,mF)]\n-            [False, False, False, False]\n+            sage: any(a == b for a in (wE, mE) for b in (wF, mF))\n+            False\n```\n\n\n\n```diff\n-        #TODO: could have a default implementation that simply\n-        #      returns the first component of rational_maps()\n+        # TODO: could have a default implementation that simply\n+        # returns the first component of rational_maps()\n```\n\n\n\n```diff\n             sage: psi = E1.isogeny(iso.kernel_polynomial(), codomain=E2); psi\n-            Isogeny of degree 1 from Elliptic Curve defined by y^2 + 11*x*y + 33*y = x^3 + 22*x^2 + 44*x + 55 over Rational Field to Elliptic Curve defined by y^2 + x*y = x^3 + x^2 - 684*x + 6681 over Rational Field\n+            Isogeny of degree 1\n+              from Elliptic Curve\n+                defined by y^2 + 11*x*y + 33*y = x^3 + 22*x^2 + 44*x + 55\n+                over Rational Field\n+              to Elliptic Curve\n+                defined by y^2 + x*y = x^3 + x^2 - 684*x + 6681\n+                over Rational Field\n```\n",
    "created_at": "2021-10-25T13:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460109",
    "user": "https://github.com/slel"
}
```

Sorry, I cannot review in depth; just a few things.

Some `.. NOTE::` blocks are indented by only three spaces
instead of the required four. Please fix.

Possible cosmetic changes (feel free to ignore):


```diff
-            sage: [E.multiplication_by_m_isogeny(m)(P) == m*P for m in (1,2,3,5,7,9)]
-            [True, True, True, True, True, True]
+            sage: all(E.multiplication_by_m_isogeny(m)(P) == m*P
+            ....:     for m in (1, 2, 3, 5, 7, 9))
+            True
```



```diff
             sage: E = EllipticCurve('99.a1')
             sage: E.multiplication_by_m_isogeny(5)
-            Isogeny of degree 25 from Elliptic Curve defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30 over Rational Field to Elliptic Curve defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30 over Rational Field
+            Isogeny of degree 25
+              from Elliptic Curve
+                defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30
+                over Rational Field
+              to Elliptic Curve
+                defined by y^2 + x*y + y = x^3 - x^2 - 17*x + 30
+                over Rational Field
             sage: E.multiplication_by_m_isogeny(2).rational_maps()
             ((1/4*x^4 + 33/4*x^2 - 121/2*x + 363/4)/(x^3 - 3/4*x^2 - 33/2*x + 121/4),
-             (-1/256*x^7 + 1/128*x^6*y - 7/256*x^6 - 3/256*x^5*y - 105/256*x^5 - 165/256*x^4*y + 1255/256*x^4 + 605/128*x^3*y - 473/64*x^3 - 1815/128*x^2*y - 10527/256*x^2 + 2541/128*x*y + 4477/32*x - 1331/128*y - 30613/256)/(1/16*x^6 - 3/32*x^5 - 519/256*x^4 + 341/64*x^3 + 1815/128*x^2 - 3993/64*x + 14641/256))
+             (-1/256*x^7 + 1/128*x^6*y - 7/256*x^6 - 3/256*x^5*y - 105/256*x^5
+              - 165/256*x^4*y + 1255/256*x^4 + 605/128*x^3*y - 473/64*x^3
+              - 1815/128*x^2*y - 10527/256*x^2 + 2541/128*x*y + 4477/32*x
+              - 1331/128*y - 30613/256)/(1/16*x^6 - 3/32*x^5 - 519/256*x^4
+              + 341/64*x^3 + 1815/128*x^2 - 3993/64*x + 14641/256))
```



```diff
-            sage: [a == b for a in (wE,mE) for b in (wF,mF)]
-            [False, False, False, False]
+            sage: any(a == b for a in (wE, mE) for b in (wF, mF))
+            False
```



```diff
-        #TODO: could have a default implementation that simply
-        #      returns the first component of rational_maps()
+        # TODO: could have a default implementation that simply
+        # returns the first component of rational_maps()
```



```diff
             sage: psi = E1.isogeny(iso.kernel_polynomial(), codomain=E2); psi
-            Isogeny of degree 1 from Elliptic Curve defined by y^2 + 11*x*y + 33*y = x^3 + 22*x^2 + 44*x + 55 over Rational Field to Elliptic Curve defined by y^2 + x*y = x^3 + x^2 - 684*x + 6681 over Rational Field
+            Isogeny of degree 1
+              from Elliptic Curve
+                defined by y^2 + 11*x*y + 33*y = x^3 + 22*x^2 + 44*x + 55
+                over Rational Field
+              to Elliptic Curve
+                defined by y^2 + x*y = x^3 + x^2 - 684*x + 6681
+                over Rational Field
```




---

archive/issue_comments_460110.json:
```json
{
    "body": "Thanks for having a look! I had just started applying your suggestions, but there are two sources of trouble:\n\n1. Most of the cosmetic changes are actually part of the dependencies and have just been merged.\n2. The erroneous indentation appears to be the norm rather than the exception in the `elliptic_curves` directory: There are almost a thousand lines of code indented with *4k+3* spaces! (The occurrences in the diff itself are not new either; they're the result of moving existing code to a different file.)\n\nTo keep things straightforward, my suggestion would be to ignore this here and deal with the problem all at once in a follow-up ticket. I had intended to clean up a few other quirks in the isogenies documentation at some point anyway.\n\n(The intermediate path would be to fix it already in the part of the code that we're touching here and leave the rest for later, but I don't see any real benefit in doing this. Let me know if you think differently.)",
    "created_at": "2021-10-25T16:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460110",
    "user": "https://github.com/yyyyx4"
}
```

Thanks for having a look! I had just started applying your suggestions, but there are two sources of trouble:

1. Most of the cosmetic changes are actually part of the dependencies and have just been merged.
2. The erroneous indentation appears to be the norm rather than the exception in the `elliptic_curves` directory: There are almost a thousand lines of code indented with *4k+3* spaces! (The occurrences in the diff itself are not new either; they're the result of moving existing code to a different file.)

To keep things straightforward, my suggestion would be to ignore this here and deal with the problem all at once in a follow-up ticket. I had intended to clean up a few other quirks in the isogenies documentation at some point anyway.

(The intermediate path would be to fix it already in the part of the code that we're touching here and leave the rest for later, but I don't see any real benefit in doing this. Let me know if you think differently.)



---

archive/issue_comments_460111.json:
```json
{
    "body": "You are right, these changes are for a different ticket.\nSorry for the noise.",
    "created_at": "2021-10-25T19:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460111",
    "user": "https://github.com/slel"
}
```

You are right, these changes are for a different ticket.
Sorry for the noise.



---

archive/issue_comments_460112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-30T03:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460113.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460113",
    "user": "https://github.com/mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_086205.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32265#event-86205"
}
```



---

archive/issue_comments_460114.json:
```json
{
    "body": "~~This was essentially reviewed as part of reviewing #32744,\nwasn't it?~~ (got that wrong, sorry)",
    "created_at": "2021-12-29T22:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460114",
    "user": "https://github.com/slel"
}
```

~~This was essentially reviewed as part of reviewing #32744,
wasn't it?~~ (got that wrong, sorry)



---

archive/issue_events_086206.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-12-29T22:40:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32265#event-86206"
}
```



---

archive/issue_events_086207.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-12-29T22:40:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32265#event-86207"
}
```



---

archive/issue_comments_460115.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-05T08:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460115",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_460116.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-01-05T09:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460116",
    "user": "https://github.com/yyyyx4"
}
```

Thank you!



---

archive/issue_events_086208.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-12T17:17:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32265#event-86208"
}
```



---

archive/issue_comments_460117.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-12T17:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32265#issuecomment-460117",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
