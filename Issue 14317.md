# Issue 14317: Fix Sage.app on OS X 10.4

archive/issues_014317.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  @kcrisman\n\nKeywords: mac app\n\nSage.app doesn't build on OS X 10.4 with error \n\n```\nCompileC build/Sage.build/Debug/Sage.build/Objects-normal/ppc/PreferencePanelController.o /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m normal ppc objective-c com.apple.compilers.gcc.4_0\n   cd /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app\n   /usr/bin/gcc-4.0 -x objective-c -arch ppc -pipe -std=gnu99 -Wno-trigraphs -fpascal-strings -fasm-blocks -g -O0 -Wreturn-type -Wunused-variable -fmessage-length=0 -mtune=G5 -fvisibility=hidden -mfix-and-continue -mmacosx-version-min=10.4 -iquote /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-generated-files.hmap -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-own-target-headers.hmap -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-all-target-headers.hmap -iquote /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-project-headers.hmap -F/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Debug -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Debug/include -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources -isysroot /Developer/SDKs/MacOSX10.4u.sdk -include /Library/Caches/com.apple.Xcode.503/SharedPrecompiledHeaders/Sage_Prefix-fekoqvarwfxuuqgwyquzfcvvikcr/Sage_Prefix.pch -c /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m -o /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Objects-normal/ppc/PreferencePanelController.o\n/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m:122: error: parse error before 'NSInteger'\n** BUILD FAILED **\nFailed to build Sage.app.\nIf you don't wish to build Sage.app set SAGE_APP_BUNDLE=no\n```\n\nSee this [thread on sage-devel](https://groups.google.com/d/msg/sage-devel/PKSWmrWhF_A/ezsZ98p7T9sJ).\n\nIssue created by migration from https://trac.sagemath.org/ticket/14521\n\n",
    "created_at": "2013-05-03T04:34:18Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Fix Sage.app on OS X 10.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14317",
    "user": "https://github.com/gvol"
}
```
Assignee: @williamstein

CC:  @kcrisman

Keywords: mac app

Sage.app doesn't build on OS X 10.4 with error 

```
CompileC build/Sage.build/Debug/Sage.build/Objects-normal/ppc/PreferencePanelController.o /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m normal ppc objective-c com.apple.compilers.gcc.4_0
   cd /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app
   /usr/bin/gcc-4.0 -x objective-c -arch ppc -pipe -std=gnu99 -Wno-trigraphs -fpascal-strings -fasm-blocks -g -O0 -Wreturn-type -Wunused-variable -fmessage-length=0 -mtune=G5 -fvisibility=hidden -mfix-and-continue -mmacosx-version-min=10.4 -iquote /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-generated-files.hmap -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-own-target-headers.hmap -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-all-target-headers.hmap -iquote /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Sage-project-headers.hmap -F/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Debug -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Debug/include -I/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources -isysroot /Developer/SDKs/MacOSX10.4u.sdk -include /Library/Caches/com.apple.Xcode.503/SharedPrecompiledHeaders/Sage_Prefix-fekoqvarwfxuuqgwyquzfcvvikcr/Sage_Prefix.pch -c /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m -o /Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/build/Sage.build/Debug/Sage.build/Objects-normal/ppc/PreferencePanelController.o
/Users/buildbot/build/sage/moufang-1/moufang_binary/build/sage-5.9/devel/ext-main/sage/ext/mac-app/PreferencePanelController.m:122: error: parse error before 'NSInteger'
** BUILD FAILED **
Failed to build Sage.app.
If you don't wish to build Sage.app set SAGE_APP_BUNDLE=no
```

See this [thread on sage-devel](https://groups.google.com/d/msg/sage-devel/PKSWmrWhF_A/ezsZ98p7T9sJ).

Issue created by migration from https://trac.sagemath.org/ticket/14521





---

archive/issue_comments_180485.json:
```json
{
    "body": "Attachment [14521_no_NSInteger.patch](tarball://root/attachments/some-uuid/ticket14521/14521_no_NSInteger.patch) by @jdemeyer created at 2013-05-03 09:05:15",
    "created_at": "2013-05-03T09:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180485",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14521_no_NSInteger.patch](tarball://root/attachments/some-uuid/ticket14521/14521_no_NSInteger.patch) by @jdemeyer created at 2013-05-03 09:05:15



---

archive/issue_comments_180486.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-03T09:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180486",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_180487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-03T10:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180487",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180488.json:
```json
{
    "body": "Works fine for me on 10.8. \n\nIf someone else can test on 10.5/6, that'll be good, though I can't see anything different happening (the change is more a post/pre-10.5 change inside OS X), hence the positive review.",
    "created_at": "2013-05-03T10:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180488",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

Works fine for me on 10.8. 

If someone else can test on 10.5/6, that'll be good, though I can't see anything different happening (the change is more a post/pre-10.5 change inside OS X), hence the positive review.



---

archive/issue_comments_180489.json:
```json
{
    "body": "I'm asking the dumb question... did anyone test the actual built Sage.app on these systems, not just building Sage.app?  Though I can't imagine this is going to be a problem, but still, without this patch\n\n```\n$ cd mac-app/\n$ grep -R NSInteger .\n./PreferencePanelController.m:- (void)alertDidEnd:(NSAlert *)alert returnCode:(NSInteger)returnCode contextInfo:(void *)contextInfo {\n$ grep -R long .\n./AppDelegate.m:// From here down are methods from NSApplicationDelegate, which probably do belong in another file.\n./loading-page.html:  <h3>If you think you have waited long enough...</h2>\n```\nfor what it's worth.\n\nI can try building the app on 10.7 later today.  I agree that it probably will not make a difference, though it's still worth trying on a few different ones *just* to make sure.",
    "created_at": "2013-05-03T12:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180489",
    "user": "https://github.com/kcrisman"
}
```

I'm asking the dumb question... did anyone test the actual built Sage.app on these systems, not just building Sage.app?  Though I can't imagine this is going to be a problem, but still, without this patch

```
$ cd mac-app/
$ grep -R NSInteger .
./PreferencePanelController.m:- (void)alertDidEnd:(NSAlert *)alert returnCode:(NSInteger)returnCode contextInfo:(void *)contextInfo {
$ grep -R long .
./AppDelegate.m:// From here down are methods from NSApplicationDelegate, which probably do belong in another file.
./loading-page.html:  <h3>If you think you have waited long enough...</h2>
```
for what it's worth.

I can try building the app on 10.7 later today.  I agree that it probably will not make a difference, though it's still worth trying on a few different ones *just* to make sure.



---

archive/issue_comments_180490.json:
```json
{
    "body": "Replying to [comment:3 kcrisman]:\n> I'm asking the dumb question... did anyone test the actual built Sage.app on these systems, not just building Sage.app?\n\nNot a dumb question. On OS X 10.4 PPC, I only tried *building* the Sage App.",
    "created_at": "2013-05-03T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180490",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 kcrisman]:
> I'm asking the dumb question... did anyone test the actual built Sage.app on these systems, not just building Sage.app?

Not a dumb question. On OS X 10.4 PPC, I only tried *building* the Sage App.



---

archive/issue_comments_180491.json:
```json
{
    "body": "I'm having trouble getting things to start on 10.7 with this.  The Sage terminal stuff works fine but in the notebook\n\n```\nexceptions.ImportError: No module named openid\n\nFailed to load application: No module named openid\n\n```\nand\n\n```\nsage/devel/sagenb/sagenb/notebook/run_notebook.py\", line 608, in notebook_run\n    raise socket.error\nsocket.error\n```\nThis sounds familiar with the NB upgrade but I don't know why this one change would have made it happen.  This is with 5.9.rc1, I believe.\n\nI'm currently bdisting 5.8.beta4 on 10.4 PPC but it will probably only be ready on Monday.\n\n---\nJust for reference, this was introduced in #10556.",
    "created_at": "2013-05-03T17:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180491",
    "user": "https://github.com/kcrisman"
}
```

I'm having trouble getting things to start on 10.7 with this.  The Sage terminal stuff works fine but in the notebook

```
exceptions.ImportError: No module named openid

Failed to load application: No module named openid

```
and

```
sage/devel/sagenb/sagenb/notebook/run_notebook.py", line 608, in notebook_run
    raise socket.error
socket.error
```
This sounds familiar with the NB upgrade but I don't know why this one change would have made it happen.  This is with 5.9.rc1, I believe.

I'm currently bdisting 5.8.beta4 on 10.4 PPC but it will probably only be ready on Monday.

---
Just for reference, this was introduced in #10556.



---

archive/issue_comments_180492.json:
```json
{
    "body": "In particular, yomcat, did you actually try a bdisted Sage with this?  Just asking - I assume yes, in which case I'm wondering what went wrong with mine...",
    "created_at": "2013-05-03T17:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180492",
    "user": "https://github.com/kcrisman"
}
```

In particular, yomcat, did you actually try a bdisted Sage with this?  Just asking - I assume yes, in which case I'm wondering what went wrong with mine...



---

archive/issue_comments_180493.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2013-05-03T17:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180493",
    "user": "https://github.com/kcrisman"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_180494.json:
```json
{
    "body": "Replying to [comment:6 kcrisman]:\n> In particular, yomcat, did you actually try a bdisted Sage with this?  \n\n\nNo, same as jdemeyer, I just built it.\n\nI ran it just now, and it worked fine. I'm with 5.9.rc1 as well.",
    "created_at": "2013-05-03T18:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180494",
    "user": "https://trac.sagemath.org/admin/accounts/users/yomcat"
}
```

Replying to [comment:6 kcrisman]:
> In particular, yomcat, did you actually try a bdisted Sage with this?  


No, same as jdemeyer, I just built it.

I ran it just now, and it worked fine. I'm with 5.9.rc1 as well.



---

archive/issue_comments_180495.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n> This sounds familiar with the NB upgrade but I don't know why this one change would have made it happen.\n\nI don't really understand this sentence. If you mean that you're using the upgraded notebook (not the one that came with Sage), then probably the problem isn't this ticket, but the notebook upgrade.",
    "created_at": "2013-05-04T12:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180495",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 kcrisman]:
> This sounds familiar with the NB upgrade but I don't know why this one change would have made it happen.

I don't really understand this sentence. If you mean that you're using the upgraded notebook (not the one that came with Sage), then probably the problem isn't this ticket, but the notebook upgrade.



---

archive/issue_comments_180496.json:
```json
{
    "body": "Indeed, I was using the upstream sagenb linked in, which definitely has something to do with it.  This *does* actually work on 10.4 - I have tried a bdist!  I am going to try this on a non-corrupted one on 10.7 now, and if that works then I think we should be okay.",
    "created_at": "2013-05-07T16:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180496",
    "user": "https://github.com/kcrisman"
}
```

Indeed, I was using the upstream sagenb linked in, which definitely has something to do with it.  This *does* actually work on 10.4 - I have tried a bdist!  I am going to try this on a non-corrupted one on 10.7 now, and if that works then I think we should be okay.



---

archive/issue_comments_180497.json:
```json
{
    "body": "Okay, 10.7 looks good as well.  Strange business.  Ivan, do you have any idea on whether this could conceivably break anything?",
    "created_at": "2013-05-07T18:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180497",
    "user": "https://github.com/kcrisman"
}
```

Okay, 10.7 looks good as well.  Strange business.  Ivan, do you have any idea on whether this could conceivably break anything?



---

archive/issue_comments_180498.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-07T18:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180498",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_180499.json:
```json
{
    "body": "Or, Jeroen, do we need to somehow test for this build?  You mentioned this on the sage-devel thread, but I haven't got a clue how to do it.",
    "created_at": "2013-05-07T18:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180499",
    "user": "https://github.com/kcrisman"
}
```

Or, Jeroen, do we need to somehow test for this build?  You mentioned this on the sage-devel thread, but I haven't got a clue how to do it.



---

archive/issue_comments_180500.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-07T18:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180500",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180501.json:
```json
{
    "body": "Replying to [comment:10 kcrisman]:\n> Okay, 10.7 looks good as well.  Strange business.  Ivan, do you have any idea on whether this could conceivably break anything?\n\n\nNo, I don't think this change could possibly break anything.  Of course, I didn't think NSInteger would break either. :-)  But NSInteger is just a long so it should be fine.  Unless of course Apple decides to change NSInteger to be something else in the next release...",
    "created_at": "2013-05-07T19:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180501",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:10 kcrisman]:
> Okay, 10.7 looks good as well.  Strange business.  Ivan, do you have any idea on whether this could conceivably break anything?


No, I don't think this change could possibly break anything.  Of course, I didn't think NSInteger would break either. :-)  But NSInteger is just a long so it should be fine.  Unless of course Apple decides to change NSInteger to be something else in the next release...



---

archive/issue_events_041329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:28:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14317#event-41329"
}
```



---

archive/issue_comments_180502.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-13T13:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14317#issuecomment-180502",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
