# Issue 10528: change Large Cremona database format and extend it

archive/issues_010528.json:
```json
{
    "body": "Assignee: cremona\n\nCC:  was justin\n\nKeywords: cremona, stein, watkins, elliptic curves, database\n\nConvert large cremona database from ZODB to mongodb.\n\nAdd more curves to the large cremona database from Stein-Watkins tables\n\nAdd more information to existing LCD in sage to include information from cremona tables 1-8\n\nIssue created by migration from https://trac.sagemath.org/ticket/10581\n\n",
    "created_at": "2011-01-10T20:43:29Z",
    "labels": [
        "elliptic curves",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "change Large Cremona database format and extend it",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10528",
    "user": "gagansekhon"
}
```
Assignee: cremona

CC:  was justin

Keywords: cremona, stein, watkins, elliptic curves, database

Convert large cremona database from ZODB to mongodb.

Add more curves to the large cremona database from Stein-Watkins tables

Add more information to existing LCD in sage to include information from cremona tables 1-8

Issue created by migration from https://trac.sagemath.org/ticket/10581





---

archive/issue_comments_109941.json:
```json
{
    "body": "Great idea.\n\n1. Something I was already planning to do.  My intention is to create the mogodb entries directly from the C++ programs which create the curve data files (much of which can be done with Sage scripts which I am already writing).\n\n2. Small problem:  what ids to use, when we do not have complete sets of isogeny classes for a given conductor?\n\n3. Good idea again;  can be handled along with 1.",
    "created_at": "2011-01-10T22:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109941",
    "user": "cremona"
}
```

Great idea.

1. Something I was already planning to do.  My intention is to create the mogodb entries directly from the C++ programs which create the curve data files (much of which can be done with Sage scripts which I am already writing).

2. Small problem:  what ids to use, when we do not have complete sets of isogeny classes for a given conductor?

3. Good idea again;  can be handled along with 1.



---

archive/issue_comments_109942.json:
```json
{
    "body": "Question on 2. How are ids determined?",
    "created_at": "2011-01-11T01:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109942",
    "user": "gagansekhon"
}
```

Question on 2. How are ids determined?



---

archive/issue_comments_109943.json:
```json
{
    "body": "Replying to [comment:2 gagansekhon]:\n> Question on 2. How are ids determined?\n\n3 components are concatenated:  (1) the conductor (positive integer); (2) the isogeny class (1 or more letters a..z); (3) the number of the curve in the class (positive integer).\n\nFor details of the coding in (2), and how the classes and curves are ordered, see \nThe elliptic curve database for conductors to 130000: \nANTS VII Proceedings: F.Hess, S.Pauli and M.Pohst (eds.), ANTS VII, Lecture Notes in Computer Science 4076 (2006), pages 11-29. http://dx.doi.org/10.1007/11792086_2",
    "created_at": "2011-01-11T09:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109943",
    "user": "cremona"
}
```

Replying to [comment:2 gagansekhon]:
> Question on 2. How are ids determined?

3 components are concatenated:  (1) the conductor (positive integer); (2) the isogeny class (1 or more letters a..z); (3) the number of the curve in the class (positive integer).

For details of the coding in (2), and how the classes and curves are ordered, see 
The elliptic curve database for conductors to 130000: 
ANTS VII Proceedings: F.Hess, S.Pauli and M.Pohst (eds.), ANTS VII, Lecture Notes in Computer Science 4076 (2006), pages 11-29. http://dx.doi.org/10.1007/11792086_2



---

archive/issue_comments_109944.json:
```json
{
    "body": "Regarding 1 & 3:  I am making good progress on Sage scripts to compute all the data in all the old-style files (i.e. tables 1-8)  taking as input just the \"short\" version of Table 1 (with only the optimal curve from each class).  There is no reason why these would not also work on the S-W database curves.  The only assumption is that the input file contains lines like\n\n```\n11 a 1 [0,-1,1,-10,-20] 0 5\n```\n\nwhere the first 3 fields are the label (in three parts, and the third part ==1 for optimal curves), then follow the a-invariants and the analytic rank and the torsion order.  (The latter could be omitted as it is easily recomputed, but not the rank!)\n\nI will attach a file I wrote at MSRI last June which gives the exact specification of the content of the 7 file types, for reference.",
    "created_at": "2011-01-11T14:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109944",
    "user": "cremona"
}
```

Regarding 1 & 3:  I am making good progress on Sage scripts to compute all the data in all the old-style files (i.e. tables 1-8)  taking as input just the "short" version of Table 1 (with only the optimal curve from each class).  There is no reason why these would not also work on the S-W database curves.  The only assumption is that the input file contains lines like

```
11 a 1 [0,-1,1,-10,-20] 0 5
```

where the first 3 fields are the label (in three parts, and the third part ==1 for optimal curves), then follow the a-invariants and the analytic rank and the torsion order.  (The latter could be omitted as it is easily recomputed, but not the rank!)

I will attach a file I wrote at MSRI last June which gives the exact specification of the content of the 7 file types, for reference.



---

archive/issue_comments_109945.json:
```json
{
    "body": "Attachment [file-format.txt](tarball://root/attachments/some-uuid/ticket10581/file-format.txt) by cremona created at 2011-01-11 14:57:16\n\nDescription of Cremona database files as at http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/",
    "created_at": "2011-01-11T14:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109945",
    "user": "cremona"
}
```

Attachment [file-format.txt](tarball://root/attachments/some-uuid/ticket10581/file-format.txt) by cremona created at 2011-01-11 14:57:16

Description of Cremona database files as at http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/



---

archive/issue_comments_109946.json:
```json
{
    "body": "Since you are already working on 1 and 3, I will start some version of 2. I am reading the lecture notes. But it might come down to simply converting Stein Watkins in a different format (as similar to yours as possible), but keep it as a separate database.",
    "created_at": "2011-01-14T00:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109946",
    "user": "gagansekhon"
}
```

Since you are already working on 1 and 3, I will start some version of 2. I am reading the lecture notes. But it might come down to simply converting Stein Watkins in a different format (as similar to yours as possible), but keep it as a separate database.



---

archive/issue_comments_109947.json:
```json
{
    "body": "After reading the labeling section of the paper, I have come up with the following conclusion.\n\n1. first isogeny in the list is A and first curve is 1, or\n2. try to follow the cremona format on the curves that are given, knowing the list is incomplete.\n\nin either case label could be 'sw37a1', identify that it is not Cremona label but a Stein-Watkins label. \n\nProblem with 1 is it is has no reasoning. \nProblem with 2 is it could be mistaken for Cremona label, since it would follow that algorithm.\n\nCurrently, I have been using 1. I will try to upload a patch with first 10^5 curves for review soon.",
    "created_at": "2011-01-14T02:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109947",
    "user": "gagansekhon"
}
```

After reading the labeling section of the paper, I have come up with the following conclusion.

1. first isogeny in the list is A and first curve is 1, or
2. try to follow the cremona format on the curves that are given, knowing the list is incomplete.

in either case label could be 'sw37a1', identify that it is not Cremona label but a Stein-Watkins label. 

Problem with 1 is it is has no reasoning. 
Problem with 2 is it could be mistaken for Cremona label, since it would follow that algorithm.

Currently, I have been using 1. I will try to upload a patch with first 10^5 curves for review soon.



---

archive/issue_comments_109948.json:
```json
{
    "body": "Is there any point in including SW curves of conductor < 130000 which are already in my database?\n\nFor conductor > 130000 I think it is a good idea to add the prefix sw.\n\nI have scripts to create all of the files in the format at http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/\nfrom a single file containing just one curve in each isogeny class, i.e. from a file like http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/allcurves.00000-09999 but only containing the lines where field #3 ==1 (and called curves.00000-09999).  \n\nSo all that would be needed for the SW part of this would be to create from the SW database such a file, but sorting the curves by conductor and then (arbitrarily, or intelligently) sorting the isogeny classes.\n\nNow if someone also re-writes the existing Sage scripts (in sage/databases/cremona.py) to create mogodb files instead of the old style db files, all that would be needed would be to run those after the ones I have written.  On the other hand, at this point there would be no point (perhaps) in having all the intermediate plain text files at all:  instead,  we could go directly from a single curves.* file to the complete mongodb.\n\nSmall asides: 1. in the scripts I am writing I used Magma's HeegnerPoint function to get generators for (some) rank 1 curves.  2. Despite what I said above I have not yet written the (easy) scripts for the aplist, degphi and intpts data files, since I have had other duties to perform...",
    "created_at": "2011-01-14T09:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109948",
    "user": "cremona"
}
```

Is there any point in including SW curves of conductor < 130000 which are already in my database?

For conductor > 130000 I think it is a good idea to add the prefix sw.

I have scripts to create all of the files in the format at http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/
from a single file containing just one curve in each isogeny class, i.e. from a file like http://www.warwick.ac.uk/staff/J.E.Cremona/ftp/data/allcurves.00000-09999 but only containing the lines where field #3 ==1 (and called curves.00000-09999).  

So all that would be needed for the SW part of this would be to create from the SW database such a file, but sorting the curves by conductor and then (arbitrarily, or intelligently) sorting the isogeny classes.

Now if someone also re-writes the existing Sage scripts (in sage/databases/cremona.py) to create mogodb files instead of the old style db files, all that would be needed would be to run those after the ones I have written.  On the other hand, at this point there would be no point (perhaps) in having all the intermediate plain text files at all:  instead,  we could go directly from a single curves.* file to the complete mongodb.

Small asides: 1. in the scripts I am writing I used Magma's HeegnerPoint function to get generators for (some) rank 1 curves.  2. Despite what I said above I have not yet written the (easy) scripts for the aplist, degphi and intpts data files, since I have had other duties to perform...



---

archive/issue_comments_109949.json:
```json
{
    "body": "I actually thought about question 2 on Thursday.\n\nUltimately this database might contain curves that come not only from the Cremona or Stein-Watkins tables but also from ABC`@`home data, Cremona's egros code, parameterizations of elliptic curves with prescribed torsion subgroups, taking quadratic twists, and whatever other dirty tricks we can think up.\n\nLet's say hypothetically that there are 25 isogeny classes in Stein-Watkins of conductor 240672 (I'm guessing there are far more). Then these should be labeled sw240672A to sw240672Y. A couple months down the road, I might then add (though some refereed process) the isogeny class of the elliptic curve [0, -1, 0, -13808832780322, -19750744373708998160]. This isogeny class should be called something like we240672Z, but people should be able to call it up from the label 240672Z. \n\nUntil we know all elliptic curves of conductor 240672 and it becomes something like we240672cn through John's scheme. \n\nWhen we know all elliptic curves with conductor less than or equal to 240672 then we can drop the prefix. Until then, someone curious about where this curve (with analytic order of sha 361) came from should probably be able to ask me.",
    "created_at": "2011-01-16T02:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109949",
    "user": "weigandt"
}
```

I actually thought about question 2 on Thursday.

Ultimately this database might contain curves that come not only from the Cremona or Stein-Watkins tables but also from ABC`@`home data, Cremona's egros code, parameterizations of elliptic curves with prescribed torsion subgroups, taking quadratic twists, and whatever other dirty tricks we can think up.

Let's say hypothetically that there are 25 isogeny classes in Stein-Watkins of conductor 240672 (I'm guessing there are far more). Then these should be labeled sw240672A to sw240672Y. A couple months down the road, I might then add (though some refereed process) the isogeny class of the elliptic curve [0, -1, 0, -13808832780322, -19750744373708998160]. This isogeny class should be called something like we240672Z, but people should be able to call it up from the label 240672Z. 

Until we know all elliptic curves of conductor 240672 and it becomes something like we240672cn through John's scheme. 

When we know all elliptic curves with conductor less than or equal to 240672 then we can drop the prefix. Until then, someone curious about where this curve (with analytic order of sha 361) came from should probably be able to ask me.



---

archive/issue_comments_109950.json:
```json
{
    "body": "This seems quite sensible to me -- but then perhaps I would say that, since the proposal is that my database is special and does not require any prefix, while everyone else's needs some qualification!\n\nIt's a pity that the label for an isogeny class is not (currently) something which is an intrinsic property of that class (unlike the conductor), so we can only have definitive labels when we know that we have all curves of a given conductor.  But I cannot think of an alternative which is short and simple.",
    "created_at": "2011-01-16T17:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109950",
    "user": "cremona"
}
```

This seems quite sensible to me -- but then perhaps I would say that, since the proposal is that my database is special and does not require any prefix, while everyone else's needs some qualification!

It's a pity that the label for an isogeny class is not (currently) something which is an intrinsic property of that class (unlike the conductor), so we can only have definitive labels when we know that we have all curves of a given conductor.  But I cannot think of an alternative which is short and simple.



---

archive/issue_comments_109951.json:
```json
{
    "body": "In light of #11587, can someone update the goals of this ticket?",
    "created_at": "2011-11-21T09:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109951",
    "user": "ohanar"
}
```

In light of #11587, can someone update the goals of this ticket?



---

archive/issue_comments_109952.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-04T12:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109952",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_109953.json:
```json
{
    "body": "I assume this ticket can be closed as \"invalid\" now, but perhaps John Cremona should confirm this.",
    "created_at": "2014-09-04T12:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109953",
    "user": "jdemeyer"
}
```

I assume this ticket can be closed as "invalid" now, but perhaps John Cremona should confirm this.



---

archive/issue_comments_109954.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-04T12:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109954",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109955.json:
```json
{
    "body": "I corrected item 1 since #11587 actually uses SQLITE.  As for 2 and 3, I think these are better left to the LMFDB project, where 3 is already done and work on 2 is ongoing.\n\nHence yes: close this ticket.",
    "created_at": "2014-09-04T12:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109955",
    "user": "cremona"
}
```

I corrected item 1 since #11587 actually uses SQLITE.  As for 2 and 3, I think these are better left to the LMFDB project, where 3 is already done and work on 2 is ongoing.

Hence yes: close this ticket.



---

archive/issue_comments_109956.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-09T14:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10528#issuecomment-109956",
    "user": "vbraun"
}
```

Resolution: fixed
