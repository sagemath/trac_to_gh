# Issue 25445: Add access methods to the genus.

Issue created by migration from Trac.

Original creator: sbrandhorst

Original creation time: 2018-06-28 07:43:12

CC:  annahaensch

The `GenusSymbol_global_ring` hides a lot of useful data from the user. 
This ticket adds some methods to access this information.


---

Comment by sbrandhorst created at 2018-06-28 12:14:04

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2018-06-28 12:14:04

New commits:


---

Comment by git created at 2018-07-18 14:39:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-29 06:58:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-09-13 18:53:33

I'm just taking a first pass at reviewing the ticket, but here are a few questions/observations:

1. Maybe this is answered in the dependencies, but why is the function `Genus` being defined for a symmetric matrix rather than for a quadratic form?  Doesn't it make more sense to make it a function on the class `QuadraticForm`

2. On line 1842 there is `det = determinant` that I think doesn't need to be there, and same with `rank = dimension` on line 1445.  It would be best to stick with dimension throughout the file, and replace the word rank wherever possible.  It looks like they are always taken to be synonymous anyhow, and `dim` is the function called to compute the dimension of a quadratic form.

3. According to the sage [General Conventions](http://doc.sagemath.org/html/en/developer/coding_basics.html#sage-documentation-style) your documentation should read `EXAMPLES:` with a single colon.  On the other hand, when you have WARNING/NOTE blocks those those be in the format `.. NOTE::` or `.. WARNING::` to put it as a Sphinx directive.

4. There are several instances of >= that should be replaces with `>0`.

I'll continue to look at things, but largely the file looks nice, and it's good to see this getting cleaned up and made useable!


---

Comment by annahaensch created at 2018-09-13 18:53:40

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2018-09-14 07:57:51

1. I think a symmetric matrix as entry point is good, because matrices are much more 
 common and stable than our quadratic form class. This makes the genus class 
 independent of the quadratic form class and thus more reusable.
 But we should add a method `genus` for quadratic forms and maybe deprecate
 `CS_genus_symbol_list`.
2. Indeed `dim` and `det` are compatible with quadratic forms. I like them best. 
   But why not keep the aliases rank and determinant? Can it hurt? If we do not, then 
   we need to deprecate the `rank` and `determinant` methods
 Also `signature_pair_of_matrix` is painfully long. Maybe just `signature_pair`?
3. As for the examples, whether of not there is a double colon depends on what comes 
   next. If it is more text, then a single colon. If it is a block of sage examples, 
   then a double colon. Can you point me at the lines you mean?
4. Yep.


---

Comment by git created at 2018-09-14 08:05:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-09-14 12:43:25

Replying to [comment:9 sbrandhorst]:
> 1. I think a symmetric matrix as entry point is good, because matrices are much more 
>  common and stable than our quadratic form class. This makes the genus class 
>  independent of the quadratic form class and thus more reusable.
>  But we should add a method `genus` for quadratic forms and maybe deprecate
>  `CS_genus_symbol_list`.

I'm not sure how exactly that works, but I would want to be able to construct a quadratic form, like `Q=QuadraticForm(ZZ,2,[1,2,2])` and then ask for `Q.Genus()`. Does what you propose make that happen?  Can we just add a Genus wrapper to the class QuadraticForm? If so, then I am happy.  I just think it should be as easy as possible to find for QF users. 

> 2. Indeed `dim` and `det` are compatible with quadratic forms. I like them best. 
>    But why not keep the aliases rank and determinant? Can it hurt? If we do not, then 
>    we need to deprecate the `rank` and `determinant` methods
>  Also `signature_pair_of_matrix` is painfully long. Maybe just `signature_pair`?

I understand, I didn't know that syntax was fixing aliases.  In that case, certainly keep it.  Regarding `signature_pair_of_matrix`, if I understand correctly it is just returning the signature of the original quadratic form (ie tuple of pos and neg Eigenvalues for the Hessian), such a function exists for the QuadraticForm class, and it is just called `signature`. It would be nice if these matched as closely as possible.  I am happy with `signature_pair`.

> 3. As for the examples, whether of not there is a double colon depends on what comes 
>    next. If it is more text, then a single colon. If it is a block of sage examples, 
>    then a double colon. Can you point me at the lines you mean?

Good to know, I never realized that.  Lines 926 and 1453 had the occurrences WARNING/NOTE that I mentioned, but it looks like you fixed those in the last commit.  

> 4. Yep.

It looks like one error was introduced in line 1356 `A non-negative` should read `A non-negative integer`

What is going on with the imports on your docstrings?  I suspect they shouldn't be there and the imports should be happening somewhere in the preamble or some other set of imports.


---

Comment by sbrandhorst created at 2018-09-14 12:53:22

1 Exactly. But let us keep that for a different ticket.
2 the equivalent would be `signature_vector` but that has 3 entries - one more for the zeros. But I guess that we can have signature and signature_pair
4 oops I will fix that.

The imports are there because nothing of this is in the global namespace at startup. So to use or doctest it, one has to import the names.


---

Comment by annahaensch created at 2018-09-14 12:54:32

> The imports are there because nothing of this is in the global namespace at startup. So to use or doctest it, one has to import the names.

Can we add it to the global namespace now or eventually?


---

Comment by sbrandhorst created at 2018-09-14 12:57:21

We could add the factory function `Genus` to the global namespace. But the other functions seem to be too specialized in my optinion. The global namespace is already quite bloated.


---

Comment by annahaensch created at 2018-09-14 14:07:44

Replying to [comment:14 sbrandhorst]:
> We could add the factory function `Genus` to the global namespace. But the other functions seem to be too specialized in my optinion. The global namespace is already quite bloated. 

I would like to see `Genus` in the global namespace.


---

Comment by git created at 2018-09-14 18:00:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-09-14 18:04:50

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-09-14 18:15:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-09-19 18:03:45

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-09-19 19:48:10

reviewer full name, please


---

Comment by vbraun created at 2018-09-20 19:22:58

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-09-20 19:22:58

Documentation doesn't build

```
[dochtml] OSError: /mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/quadratic_forms/genera/genus.py:docstring of sage.quadratic_forms.genera.genus.canonical_2_adic_compartments:45: WARNING: Content block expected for the "NOTE" directive; none found.
```



---

Comment by git created at 2018-09-20 20:12:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-09-20 20:13:18

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-10-02 12:09:25

You need to change `"""` to `r"""` at the beginning of every docstring that contains a latex macro such as \ZZ, \in, \{, etc

You then can use `pycodestyle --select=W605 	src/sage/quadratic_forms/genera/genus.py` if you want to check.


---

Comment by git created at 2018-10-02 22:51:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-10-02 22:52:49

O.K. this should be it.


---

Comment by chapoton created at 2018-10-03 11:50:47

And patchbot is green, so let us try again.


---

Comment by chapoton created at 2018-10-03 11:50:47

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-10-03 11:51:36

Thank you :-).


---

Comment by vbraun created at 2018-10-04 21:54:18

Resolution: fixed
