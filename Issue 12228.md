# Issue 12228: Get Python to build all needed stuff on FreeBSD

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2012-01-31 02:20:49

Assignee: pjeremy

CC:  pjeremy jpflori dimpase

On newer versions of FreeBSD, apparently there are some slight changes we need.  This is as reported by Stephen Montgomery-Smith on sage-devel, however with Python 2.6, not 2.7 as now used in Sage.

```

--- python-2.6.4.p13/src/setup.py-orig	2012-01-21 21:42:43.000000000 +0000
+++ python-2.6.4.p13/src/setup.py	2012-01-21 21:45:11.000000000 +0000
`@``@` -1273,16 +1273,24 `@``@`
                 )
             libraries = []
 
-        elif platform in ('freebsd4', 'freebsd5', 'freebsd6', 'freebsd7', 'freebsd8'):
+        elif platform in ('freebsd4', 'freebsd5', 'freebsd6'):
             # FreeBSD's P1003.1b semaphore support is very experimental
             # and has many known problems. (as of June 2008)
-            macros = dict(                  # FreeBSD
+            macros = dict(                  # FreeBSD 4-6
                 HAVE_SEM_OPEN=0,
                 HAVE_SEM_TIMEDWAIT=0,
                 HAVE_FD_TRANSFER=1,
                 )
             libraries = []
 
+        elif platform in ('freebsd7', 'freebsd8', 'freebsd9', 'freebsd10'):
+            macros = dict(                  # FreeBSD 7+
+                HAVE_SEM_OPEN=1,
+                HAVE_SEM_TIMEDWAIT=1,
+                HAVE_FD_TRANSFER=1,
+               )
+            libraries = []
+
         elif platform.startswith('openbsd'):
             macros = dict(                  # OpenBSD
                 HAVE_SEM_OPEN=0,            # Not implemented
```



---

Comment by stephen created at 2012-04-08 14:37:50

With sage 5.0.beta12, there are now no problems building python under FreeBSD.  This ticket can be closed.


---

Attachment


---

Attachment


---

Attachment


---

Comment by stephen created at 2012-04-22 04:18:23

It turns out that patches are necessary to python-2.7.  Otherwise

```
sage -t  -force_lib "devel/sage/sage/parallel/decorate.py"
```

fails.  All of the needed patches may be taken more or less directly from the FreeBSD port of python-2.7 http://www.freebsd.org/cgi/cvsweb.cgi/ports/lang/python27/files/ I have added the necessary patches to this trac ticket.


---

Comment by kcrisman created at 2012-06-20 19:23:29

Great, so we just need to make an spkg for this.


---

Comment by jpflori created at 2013-04-05 09:03:30

I'm currently testing 5.9.beta3 with Python 2.7.3 on different FreeBSd releases, I'll report here later when I get to the point of testing decorate.py.


---

Comment by jpflori created at 2013-04-05 09:05:48

(Note that I had no problems building Python and running it.)


---

Comment by jpflori created at 2013-05-28 09:44:20

These patches are indeed still needed.
Let's wait for 2.7.5 to get in at #14600 to include them.


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Comment by stephen created at 2013-05-28 12:17:10

I have upgraded the patches a little, to include all the patches from the python27 port in FreeBSD.  The extra stuff isn't needed to make python on sage build and pass all the internal tests.  But maybe it fixes some other problems for sage python on FreeBSD that we don't know about.  (Looking at the file sizes, I think it is only the setup.py patch that is different.)


---

Comment by mkoeppe created at 2020-08-17 16:38:58

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-17 16:38:58

Outdated spkg or build system ticket, should be closed


---

Comment by chapoton created at 2020-09-13 07:26:33

Resolution: invalid
