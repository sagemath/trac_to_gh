# Issue 12228: Get Python to build all needed stuff on FreeBSD

archive/issues_012228.json:
```json
{
    "body": "Assignee: pjeremy\n\nCC:  pjeremy jpflori dimpase\n\nOn newer versions of FreeBSD, apparently there are some slight changes we need.  This is as reported by Stephen Montgomery-Smith on sage-devel, however with Python 2.6, not 2.7 as now used in Sage.\n\n```\n\n--- python-2.6.4.p13/src/setup.py-orig\t2012-01-21 21:42:43.000000000 +0000\n+++ python-2.6.4.p13/src/setup.py\t2012-01-21 21:45:11.000000000 +0000\n@@ -1273,16 +1273,24 @@\n                 )\n             libraries = []\n \n-        elif platform in ('freebsd4', 'freebsd5', 'freebsd6', 'freebsd7', 'freebsd8'):\n+        elif platform in ('freebsd4', 'freebsd5', 'freebsd6'):\n             # FreeBSD's P1003.1b semaphore support is very experimental\n             # and has many known problems. (as of June 2008)\n-            macros = dict(                  # FreeBSD\n+            macros = dict(                  # FreeBSD 4-6\n                 HAVE_SEM_OPEN=0,\n                 HAVE_SEM_TIMEDWAIT=0,\n                 HAVE_FD_TRANSFER=1,\n                 )\n             libraries = []\n \n+        elif platform in ('freebsd7', 'freebsd8', 'freebsd9', 'freebsd10'):\n+            macros = dict(                  # FreeBSD 7+\n+                HAVE_SEM_OPEN=1,\n+                HAVE_SEM_TIMEDWAIT=1,\n+                HAVE_FD_TRANSFER=1,\n+               )\n+            libraries = []\n+\n         elif platform.startswith('openbsd'):\n             macros = dict(                  # OpenBSD\n                 HAVE_SEM_OPEN=0,            # Not implemented\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12400\n\n",
    "created_at": "2012-01-31T02:20:49Z",
    "labels": [
        "porting: BSD",
        "major",
        "bug"
    ],
    "title": "Get Python to build all needed stuff on FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12228",
    "user": "kcrisman"
}
```
Assignee: pjeremy

CC:  pjeremy jpflori dimpase

On newer versions of FreeBSD, apparently there are some slight changes we need.  This is as reported by Stephen Montgomery-Smith on sage-devel, however with Python 2.6, not 2.7 as now used in Sage.

```

--- python-2.6.4.p13/src/setup.py-orig	2012-01-21 21:42:43.000000000 +0000
+++ python-2.6.4.p13/src/setup.py	2012-01-21 21:45:11.000000000 +0000
@@ -1273,16 +1273,24 @@
                 )
             libraries = []
 
-        elif platform in ('freebsd4', 'freebsd5', 'freebsd6', 'freebsd7', 'freebsd8'):
+        elif platform in ('freebsd4', 'freebsd5', 'freebsd6'):
             # FreeBSD's P1003.1b semaphore support is very experimental
             # and has many known problems. (as of June 2008)
-            macros = dict(                  # FreeBSD
+            macros = dict(                  # FreeBSD 4-6
                 HAVE_SEM_OPEN=0,
                 HAVE_SEM_TIMEDWAIT=0,
                 HAVE_FD_TRANSFER=1,
                 )
             libraries = []
 
+        elif platform in ('freebsd7', 'freebsd8', 'freebsd9', 'freebsd10'):
+            macros = dict(                  # FreeBSD 7+
+                HAVE_SEM_OPEN=1,
+                HAVE_SEM_TIMEDWAIT=1,
+                HAVE_FD_TRANSFER=1,
+               )
+            libraries = []
+
         elif platform.startswith('openbsd'):
             macros = dict(                  # OpenBSD
                 HAVE_SEM_OPEN=0,            # Not implemented
```


Issue created by migration from https://trac.sagemath.org/ticket/12400





---

archive/issue_comments_142753.json:
```json
{
    "body": "With sage 5.0.beta12, there are now no problems building python under FreeBSD.  This ticket can be closed.",
    "created_at": "2012-04-08T14:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142753",
    "user": "stephen"
}
```

With sage 5.0.beta12, there are now no problems building python under FreeBSD.  This ticket can be closed.



---

archive/issue_comments_142754.json:
```json
{
    "body": "Attachment [spkg-patch-python-2.7.2.p4_-_src_Modules__ctypes_libffi_configure](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_Modules__ctypes_libffi_configure) by stephen created at 2012-04-22 04:16:19",
    "created_at": "2012-04-22T04:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142754",
    "user": "stephen"
}
```

Attachment [spkg-patch-python-2.7.2.p4_-_src_Modules__ctypes_libffi_configure](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_Modules__ctypes_libffi_configure) by stephen created at 2012-04-22 04:16:19



---

archive/issue_comments_142755.json:
```json
{
    "body": "Attachment [spkg-patch-python-2.7.2.p4_-_src_Modules_fcntlmodule.c](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_Modules_fcntlmodule.c) by stephen created at 2012-04-22 04:16:32",
    "created_at": "2012-04-22T04:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142755",
    "user": "stephen"
}
```

Attachment [spkg-patch-python-2.7.2.p4_-_src_Modules_fcntlmodule.c](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_Modules_fcntlmodule.c) by stephen created at 2012-04-22 04:16:32



---

archive/issue_comments_142756.json:
```json
{
    "body": "Attachment [spkg-patch-python-2.7.2.p4_-_src_setup.py](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_setup.py) by stephen created at 2012-04-22 04:16:58",
    "created_at": "2012-04-22T04:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142756",
    "user": "stephen"
}
```

Attachment [spkg-patch-python-2.7.2.p4_-_src_setup.py](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python-2.7.2.p4_-_src_setup.py) by stephen created at 2012-04-22 04:16:58



---

archive/issue_comments_142757.json:
```json
{
    "body": "It turns out that patches are necessary to python-2.7.  Otherwise\n\n```\nsage -t  -force_lib \"devel/sage/sage/parallel/decorate.py\"\n```\n\nfails.  All of the needed patches may be taken more or less directly from the FreeBSD port of python-2.7 http://www.freebsd.org/cgi/cvsweb.cgi/ports/lang/python27/files/ I have added the necessary patches to this trac ticket.",
    "created_at": "2012-04-22T04:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142757",
    "user": "stephen"
}
```

It turns out that patches are necessary to python-2.7.  Otherwise

```
sage -t  -force_lib "devel/sage/sage/parallel/decorate.py"
```

fails.  All of the needed patches may be taken more or less directly from the FreeBSD port of python-2.7 http://www.freebsd.org/cgi/cvsweb.cgi/ports/lang/python27/files/ I have added the necessary patches to this trac ticket.



---

archive/issue_comments_142758.json:
```json
{
    "body": "Great, so we just need to make an spkg for this.",
    "created_at": "2012-06-20T19:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142758",
    "user": "kcrisman"
}
```

Great, so we just need to make an spkg for this.



---

archive/issue_comments_142759.json:
```json
{
    "body": "I'm currently testing 5.9.beta3 with Python 2.7.3 on different FreeBSd releases, I'll report here later when I get to the point of testing decorate.py.",
    "created_at": "2013-04-05T09:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142759",
    "user": "jpflori"
}
```

I'm currently testing 5.9.beta3 with Python 2.7.3 on different FreeBSd releases, I'll report here later when I get to the point of testing decorate.py.



---

archive/issue_comments_142760.json:
```json
{
    "body": "(Note that I had no problems building Python and running it.)",
    "created_at": "2013-04-05T09:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142760",
    "user": "jpflori"
}
```

(Note that I had no problems building Python and running it.)



---

archive/issue_comments_142761.json:
```json
{
    "body": "These patches are indeed still needed.\nLet's wait for 2.7.5 to get in at #14600 to include them.",
    "created_at": "2013-05-28T09:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142761",
    "user": "jpflori"
}
```

These patches are indeed still needed.
Let's wait for 2.7.5 to get in at #14600 to include them.



---

archive/issue_comments_142762.json:
```json
{
    "body": "Attachment [spkg-patch-python_-_src_Doc_library_fcntl.rst](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Doc_library_fcntl.rst) by stephen created at 2013-05-28 12:13:43",
    "created_at": "2013-05-28T12:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142762",
    "user": "stephen"
}
```

Attachment [spkg-patch-python_-_src_Doc_library_fcntl.rst](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Doc_library_fcntl.rst) by stephen created at 2013-05-28 12:13:43



---

archive/issue_comments_142763.json:
```json
{
    "body": "Attachment [spkg-patch-python_-_src_Modules__ctypes_libffi_configure](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Modules__ctypes_libffi_configure) by stephen created at 2013-05-28 12:14:01",
    "created_at": "2013-05-28T12:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142763",
    "user": "stephen"
}
```

Attachment [spkg-patch-python_-_src_Modules__ctypes_libffi_configure](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Modules__ctypes_libffi_configure) by stephen created at 2013-05-28 12:14:01



---

archive/issue_comments_142764.json:
```json
{
    "body": "Attachment [spkg-patch-python_-_src_Modules_fcntlmodule.c](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Modules_fcntlmodule.c) by stephen created at 2013-05-28 12:14:21",
    "created_at": "2013-05-28T12:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142764",
    "user": "stephen"
}
```

Attachment [spkg-patch-python_-_src_Modules_fcntlmodule.c](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Modules_fcntlmodule.c) by stephen created at 2013-05-28 12:14:21



---

archive/issue_comments_142765.json:
```json
{
    "body": "Attachment [spkg-patch-python_-_src_Python_thread_pthread.h](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Python_thread_pthread.h) by stephen created at 2013-05-28 12:15:30",
    "created_at": "2013-05-28T12:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142765",
    "user": "stephen"
}
```

Attachment [spkg-patch-python_-_src_Python_thread_pthread.h](tarball://root/attachments/some-uuid/ticket12400/spkg-patch-python_-_src_Python_thread_pthread.h) by stephen created at 2013-05-28 12:15:30



---

archive/issue_comments_142766.json:
```json
{
    "body": "I have upgraded the patches a little, to include all the patches from the python27 port in FreeBSD.  The extra stuff isn't needed to make python on sage build and pass all the internal tests.  But maybe it fixes some other problems for sage python on FreeBSD that we don't know about.  (Looking at the file sizes, I think it is only the setup.py patch that is different.)",
    "created_at": "2013-05-28T12:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142766",
    "user": "stephen"
}
```

I have upgraded the patches a little, to include all the patches from the python27 port in FreeBSD.  The extra stuff isn't needed to make python on sage build and pass all the internal tests.  But maybe it fixes some other problems for sage python on FreeBSD that we don't know about.  (Looking at the file sizes, I think it is only the setup.py patch that is different.)



---

archive/issue_comments_142767.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-17T16:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142767",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142768.json:
```json
{
    "body": "Outdated spkg or build system ticket, should be closed",
    "created_at": "2020-08-17T16:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142768",
    "user": "mkoeppe"
}
```

Outdated spkg or build system ticket, should be closed



---

archive/issue_comments_142769.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-09-13T07:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12228#issuecomment-142769",
    "user": "chapoton"
}
```

Resolution: invalid
