# Issue 17635: SingularKernelFunction documentation doesn't work

archive/issues_017635.json:
```json
{
    "body": "I found the following during my debian experiments (sage's develop branch), but confirmed it using a vanilla sage 6.5 :\n\n```\nsage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce\nsage: help(poly_reduce)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-3-6f8ca6115b81> in <module>()\n----> 1 help(poly_reduce)\n\n/home/jpuydt/sage-6.5/local/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in help(module)\n   1455             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted\n   1456             docstr = 'Help on ' + str(module) + '\\n'\n-> 1457             docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\\n'\n   1458             pydoc.pager(docstr + _sage_getdoc_unformatted(module))\n   1459         else:\n\nAttributeError: 'sage.libs.singular.function.SingularKernelFunction' object has no attribute '__name__'\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/17872\n\n",
    "created_at": "2015-02-27T18:00:52Z",
    "labels": [
        "component: documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "SingularKernelFunction documentation doesn't work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17635",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
I found the following during my debian experiments (sage's develop branch), but confirmed it using a vanilla sage 6.5 :

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: help(poly_reduce)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-6f8ca6115b81> in <module>()
----> 1 help(poly_reduce)

/home/jpuydt/sage-6.5/local/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in help(module)
   1455             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted
   1456             docstr = 'Help on ' + str(module) + '\n'
-> 1457             docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n'
   1458             pydoc.pager(docstr + _sage_getdoc_unformatted(module))
   1459         else:

AttributeError: 'sage.libs.singular.function.SingularKernelFunction' object has no attribute '__name__'
```

Issue created by migration from https://trac.sagemath.org/ticket/17872





---

archive/issue_comments_235386.json:
```json
{
    "body": "Note that\n\n```\nsage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce\nsage: poly_reduce??\nType:            SingularKernelFunction\nString form:     NF (singular function)\nFile:            /opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/libs/singular/function.so\nDefinition:      poly_reduce(self, ring=None, interruptible=True, attributes=None, *args)\nSource:\ncdef class SingularKernelFunction(SingularFunction):\n    \"\"\"\n    EXAMPLES::\n...\n```\ndoes work",
    "created_at": "2015-02-27T23:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235386",
    "user": "https://github.com/videlec"
}
```

Note that

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: poly_reduce??
Type:            SingularKernelFunction
String form:     NF (singular function)
File:            /opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/libs/singular/function.so
Definition:      poly_reduce(self, ring=None, interruptible=True, attributes=None, *args)
Source:
cdef class SingularKernelFunction(SingularFunction):
    """
    EXAMPLES::
...
```
does work



---

archive/issue_comments_235387.json:
```json
{
    "body": "`@`vdelecroix: It works because it doesn't try to use the name, does it?\n\nWhat I find strange is that a name is set in function.pyx... (line 1156).",
    "created_at": "2015-03-01T21:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235387",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

`@`vdelecroix: It works because it doesn't try to use the name, does it?

What I find strange is that a name is set in function.pyx... (line 1156).



---

archive/issue_comments_235388.json:
```json
{
    "body": "Ok, I tried to study how things work : in src/sage/misc/sagedoc.py line 1477, the code just tries to read poly_reduce._ _name_ _, which doesn't exist. What bothers me is that in src/sage/libs/singular/function.pyx, if I add \"self._ _name_ _ = name\" here and there, I actually get *more* errors about _ _name_ _ not making sense!\n\nI must admit that python classes aren't my cup of tea...",
    "created_at": "2015-03-02T08:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235388",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Ok, I tried to study how things work : in src/sage/misc/sagedoc.py line 1477, the code just tries to read poly_reduce._ _name_ _, which doesn't exist. What bothers me is that in src/sage/libs/singular/function.pyx, if I add "self._ _name_ _ = name" here and there, I actually get *more* errors about _ _name_ _ not making sense!

I must admit that python classes aren't my cup of tea...



---

archive/issue_comments_235389.json:
```json
{
    "body": "Ok, I pushed a trivial patch which does the minimal amount of change... I'm pretty sure the right way would be to actually add the name somewhere, but since I don't know how to do that...\n\n---\nNew commits:",
    "created_at": "2015-03-02T21:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235389",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Ok, I pushed a trivial patch which does the minimal amount of change... I'm pretty sure the right way would be to actually add the name somewhere, but since I don't know how to do that...

---
New commits:



---

archive/issue_comments_235390.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-02T21:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235390",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235391.json:
```json
{
    "body": "Is this approach any better?\n\n```diff\ndiff --git a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx b/src/sage/algebras\nindex d275963..a3cc1e2 100644\n--- a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx\n+++ b/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx\n@@ -22,8 +22,8 @@ from sage.rings.polynomial.multi_polynomial_ideal import MPolynomialIdeal\n \n # Define some singular functions\n lib(\"freegb.lib\")\n-poly_reduce = singular_function(\"NF\")\n-singular_system=singular_function(\"system\")\n+poly_reduce = singular_function(\"NF\", custom_name='poly_reduce')\n+singular_system=singular_function(\"system\", custom_name='singular_system')\n \n #####################\n # Free algebra elements\ndiff --git a/src/sage/libs/singular/function.pxd b/src/sage/libs/singular/function.pxd\nindex 02937eb..ec8c752 100644\n--- a/src/sage/libs/singular/function.pxd\n+++ b/src/sage/libs/singular/function.pxd\n@@ -68,6 +68,7 @@ cdef class KernelCallHandler(BaseCallHandler):\n \n cdef class SingularFunction(SageObject):\n     cdef object _name\n+    cdef public __custom_name\n     cdef MPolynomialRing_libsingular _ring\n     cdef BaseCallHandler call_handler\n \ndiff --git a/src/sage/libs/singular/function.pyx b/src/sage/libs/singular/function.pyx\nindex 4a885df..f2a9ceb 100644\n--- a/src/sage/libs/singular/function.pyx\n+++ b/src/sage/libs/singular/function.pyx\n@@ -1568,7 +1568,7 @@ cdef class SingularKernelFunction(SingularFunction):\n         return cmd_n != -1\n \n \n-def singular_function(name):\n+def singular_function(name, custom_name=None):\n     \"\"\"\n     Construct a new libSingular function object for the given\n     ``name``.\n@@ -1754,9 +1754,14 @@ def singular_function(name):\n \n     cdef SingularFunction fnc\n     try:\n-        return SingularKernelFunction(name)\n+        f = SingularKernelFunction(name)\n     except NameError:\n-        return SingularLibraryFunction(name)\n+        f = SingularLibraryFunction(name)\n+    if custom_name is not None:\n+        f.__custom_name = custom_name\n+    else:\n+        f.__custom_name = name\n+    return f\n \n def lib(name):\n     \"\"\"\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex d024938..bae7f42 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -1474,7 +1474,10 @@ def help(module=None):\n         if hasattr(module, '_sage_doc_'):\n             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted\n             docstr = 'Help on ' + str(module) + '\\n'\n-            docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\\n' \n+            if hasattr(module, '__custom_name'):\n+                docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\\n'\n+            elif hasattr(module, '__name__'):\n+                docstr += 'Definition: ' + module.__custom_name + sage_getdef(module) + '\\n'\n             pydoc.pager(docstr + _sage_getdoc_unformatted(module))\n         else:\n             python_help(module)\n```\nIt's untested and may very well not be the right thing to do...",
    "created_at": "2015-03-02T21:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235391",
    "user": "https://github.com/jhpalmieri"
}
```

Is this approach any better?

```diff
diff --git a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx b/src/sage/algebras
index d275963..a3cc1e2 100644
--- a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx
+++ b/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx
@@ -22,8 +22,8 @@ from sage.rings.polynomial.multi_polynomial_ideal import MPolynomialIdeal
 
 # Define some singular functions
 lib("freegb.lib")
-poly_reduce = singular_function("NF")
-singular_system=singular_function("system")
+poly_reduce = singular_function("NF", custom_name='poly_reduce')
+singular_system=singular_function("system", custom_name='singular_system')
 
 #####################
 # Free algebra elements
diff --git a/src/sage/libs/singular/function.pxd b/src/sage/libs/singular/function.pxd
index 02937eb..ec8c752 100644
--- a/src/sage/libs/singular/function.pxd
+++ b/src/sage/libs/singular/function.pxd
@@ -68,6 +68,7 @@ cdef class KernelCallHandler(BaseCallHandler):
 
 cdef class SingularFunction(SageObject):
     cdef object _name
+    cdef public __custom_name
     cdef MPolynomialRing_libsingular _ring
     cdef BaseCallHandler call_handler
 
diff --git a/src/sage/libs/singular/function.pyx b/src/sage/libs/singular/function.pyx
index 4a885df..f2a9ceb 100644
--- a/src/sage/libs/singular/function.pyx
+++ b/src/sage/libs/singular/function.pyx
@@ -1568,7 +1568,7 @@ cdef class SingularKernelFunction(SingularFunction):
         return cmd_n != -1
 
 
-def singular_function(name):
+def singular_function(name, custom_name=None):
     """
     Construct a new libSingular function object for the given
     ``name``.
@@ -1754,9 +1754,14 @@ def singular_function(name):
 
     cdef SingularFunction fnc
     try:
-        return SingularKernelFunction(name)
+        f = SingularKernelFunction(name)
     except NameError:
-        return SingularLibraryFunction(name)
+        f = SingularLibraryFunction(name)
+    if custom_name is not None:
+        f.__custom_name = custom_name
+    else:
+        f.__custom_name = name
+    return f
 
 def lib(name):
     """
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index d024938..bae7f42 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -1474,7 +1474,10 @@ def help(module=None):
         if hasattr(module, '_sage_doc_'):
             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted
             docstr = 'Help on ' + str(module) + '\n'
-            docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n' 
+            if hasattr(module, '__custom_name'):
+                docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n'
+            elif hasattr(module, '__name__'):
+                docstr += 'Definition: ' + module.__custom_name + sage_getdef(module) + '\n'
             pydoc.pager(docstr + _sage_getdoc_unformatted(module))
         else:
             python_help(module)
```
It's untested and may very well not be the right thing to do...



---

archive/issue_comments_235392.json:
```json
{
    "body": "Hmmm... that adds a new custom name to the objects, and adds code to use that in the documentation, so modifies things in two places. Isn't it possible to just add the name the documentation code already expects?",
    "created_at": "2015-03-02T21:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235392",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Hmmm... that adds a new custom name to the objects, and adds code to use that in the documentation, so modifies things in two places. Isn't it possible to just add the name the documentation code already expects?



---

archive/issue_comments_235393.json:
```json
{
    "body": "With code like\n\n```\npoly_reduce = singular_function(\"NF\")\n```\nI'm not sure how to recover the string \"poly_reduce\".",
    "created_at": "2015-03-02T22:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235393",
    "user": "https://github.com/jhpalmieri"
}
```

With code like

```
poly_reduce = singular_function("NF")
```
I'm not sure how to recover the string "poly_reduce".



---

archive/issue_comments_235394.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\n> With code like\n> \n> ```\n> poly_reduce = singular_function(\"NF\")\n> ```\n> I'm not sure how to recover the string \"poly_reduce\".\n\n\nI am not sure what you want to achieve... but\n\n```\nsage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce\nsage: from sage.misc.dev_tools import find_object_modules\nsage: find_object_modules(poly_reduce)\n{'sage.algebras.letterplace.free_algebra_element_letterplace': ['poly_reduce']}\n```\n\nOn the other hand, adding a custom attribute to fix a special case is bad in my opinion. I find the approach used by Julien better.\n\nVincent",
    "created_at": "2015-03-03T16:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235394",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:8 jhpalmieri]:
> With code like
> 
> ```
> poly_reduce = singular_function("NF")
> ```
> I'm not sure how to recover the string "poly_reduce".


I am not sure what you want to achieve... but

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: from sage.misc.dev_tools import find_object_modules
sage: find_object_modules(poly_reduce)
{'sage.algebras.letterplace.free_algebra_element_letterplace': ['poly_reduce']}
```

On the other hand, adding a custom attribute to fix a special case is bad in my opinion. I find the approach used by Julien better.

Vincent



---

archive/issue_comments_235395.json:
```json
{
    "body": "Isn't the best solution to just add `__name__` to `SingularFunction` objects? I've created a branch with that fix applied and it seems to be working fine.\n\n---\nNew commits:",
    "created_at": "2015-05-19T20:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235395",
    "user": "https://github.com/malb"
}
```

Isn't the best solution to just add `__name__` to `SingularFunction` objects? I've created a branch with that fix applied and it seems to be working fine.

---
New commits:



---

archive/issue_comments_235396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-19T20:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235397.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-06T07:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235397",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235398.json:
```json
{
    "body": "does not apply",
    "created_at": "2015-09-06T07:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17635#issuecomment-235398",
    "user": "https://github.com/fchapoton"
}
```

does not apply
