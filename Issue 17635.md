# Issue 17635: SingularKernelFunction documentation doesn't work

Issue created by migration from https://trac.sagemath.org/ticket/17872

Original creator: Snark

Original creation time: 2015-02-27 18:00:52

I found the following during my debian experiments (sage's develop branch), but confirmed it using a vanilla sage 6.5 :

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: help(poly_reduce)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-6f8ca6115b81> in <module>()
----> 1 help(poly_reduce)

/home/jpuydt/sage-6.5/local/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in help(module)
   1455             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted
   1456             docstr = 'Help on ' + str(module) + '\n'
-> 1457             docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n'
   1458             pydoc.pager(docstr + _sage_getdoc_unformatted(module))
   1459         else:

AttributeError: 'sage.libs.singular.function.SingularKernelFunction' object has no attribute '__name__'
```



---

Comment by vdelecroix created at 2015-02-27 23:42:31

Note that

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: poly_reduce??
Type:            SingularKernelFunction
String form:     NF (singular function)
File:            /opt/sage_flatsurf/local/lib/python2.7/site-packages/sage/libs/singular/function.so
Definition:      poly_reduce(self, ring=None, interruptible=True, attributes=None, *args)
Source:
cdef class SingularKernelFunction(SingularFunction):
    """
    EXAMPLES::
...
```

does work


---

Comment by Snark created at 2015-03-01 21:53:13

`@`vdelecroix: It works because it doesn't try to use the name, does it?

What I find strange is that a name is set in function.pyx... (line 1156).


---

Comment by Snark created at 2015-03-02 08:36:11

Ok, I tried to study how things work : in src/sage/misc/sagedoc.py line 1477, the code just tries to read poly_reduce._ _name_ _, which doesn't exist. What bothers me is that in src/sage/libs/singular/function.pyx, if I add "self._ _name_ _ = name" here and there, I actually get *more* errors about _ _name_ _ not making sense!

I must admit that python classes aren't my cup of tea...


---

Comment by Snark created at 2015-03-02 21:09:41

Ok, I pushed a trivial patch which does the minimal amount of change... I'm pretty sure the right way would be to actually add the name somewhere, but since I don't know how to do that...
----
New commits:


---

Comment by Snark created at 2015-03-02 21:09:41

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2015-03-02 21:43:41

Is this approach any better?

```diff
diff --git a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx b/src/sage/algebras
index d275963..a3cc1e2 100644
--- a/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx
+++ b/src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx
@@ -22,8 +22,8 @@ from sage.rings.polynomial.multi_polynomial_ideal import MPolynomialIdeal
 
 # Define some singular functions
 lib("freegb.lib")
-poly_reduce = singular_function("NF")
-singular_system=singular_function("system")
+poly_reduce = singular_function("NF", custom_name='poly_reduce')
+singular_system=singular_function("system", custom_name='singular_system')
 
 #####################
 # Free algebra elements
diff --git a/src/sage/libs/singular/function.pxd b/src/sage/libs/singular/function.pxd
index 02937eb..ec8c752 100644
--- a/src/sage/libs/singular/function.pxd
+++ b/src/sage/libs/singular/function.pxd
@@ -68,6 +68,7 @@ cdef class KernelCallHandler(BaseCallHandler):
 
 cdef class SingularFunction(SageObject):
     cdef object _name
+    cdef public __custom_name
     cdef MPolynomialRing_libsingular _ring
     cdef BaseCallHandler call_handler
 
diff --git a/src/sage/libs/singular/function.pyx b/src/sage/libs/singular/function.pyx
index 4a885df..f2a9ceb 100644
--- a/src/sage/libs/singular/function.pyx
+++ b/src/sage/libs/singular/function.pyx
@@ -1568,7 +1568,7 @@ cdef class SingularKernelFunction(SingularFunction):
         return cmd_n != -1
 
 
-def singular_function(name):
+def singular_function(name, custom_name=None):
     """
     Construct a new libSingular function object for the given
     ``name``.
@@ -1754,9 +1754,14 @@ def singular_function(name):
 
     cdef SingularFunction fnc
     try:
-        return SingularKernelFunction(name)
+        f = SingularKernelFunction(name)
     except NameError:
-        return SingularLibraryFunction(name)
+        f = SingularLibraryFunction(name)
+    if custom_name is not None:
+        f.__custom_name = custom_name
+    else:
+        f.__custom_name = name
+    return f
 
 def lib(name):
     """
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index d024938..bae7f42 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -1474,7 +1474,10 @@ def help(module=None):
         if hasattr(module, '_sage_doc_'):
             from sage.misc.sageinspect import sage_getdef, _sage_getdoc_unformatted
             docstr = 'Help on ' + str(module) + '\n'
-            docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n' 
+            if hasattr(module, '__custom_name'):
+                docstr += 'Definition: ' + module.__name__ + sage_getdef(module) + '\n'
+            elif hasattr(module, '__name__'):
+                docstr += 'Definition: ' + module.__custom_name + sage_getdef(module) + '\n'
             pydoc.pager(docstr + _sage_getdoc_unformatted(module))
         else:
             python_help(module)
```

It's untested and may very well not be the right thing to do...


---

Comment by Snark created at 2015-03-02 21:56:25

Hmmm... that adds a new custom name to the objects, and adds code to use that in the documentation, so modifies things in two places. Isn't it possible to just add the name the documentation code already expects?


---

Comment by jhpalmieri created at 2015-03-02 22:15:43

With code like

```
poly_reduce = singular_function("NF")
```

I'm not sure how to recover the string "poly_reduce".


---

Comment by vdelecroix created at 2015-03-03 16:18:56

Replying to [comment:8 jhpalmieri]:
> With code like
> {{{
> poly_reduce = singular_function("NF")
> }}}
> I'm not sure how to recover the string "poly_reduce".

I am not sure what you want to achieve... but

```
sage: from sage.algebras.letterplace.free_algebra_element_letterplace import poly_reduce
sage: from sage.misc.dev_tools import find_object_modules
sage: find_object_modules(poly_reduce)
{'sage.algebras.letterplace.free_algebra_element_letterplace': ['poly_reduce']}
```


On the other hand, adding a custom attribute to fix a special case is bad in my opinion. I find the approach used by Julien better.

Vincent


---

Comment by malb created at 2015-05-19 20:11:02

Isn't the best solution to just add `__name__` to `SingularFunction` objects? I've created a branch with that fix applied and it seems to be working fine.
----
New commits:


---

Comment by git created at 2015-05-19 20:15:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-09-06 07:47:25

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-09-06 07:47:25

does not apply
