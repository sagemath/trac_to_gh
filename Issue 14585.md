# Issue 14585: Implement hyperplane arrangements

archive/issues_014585.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  dperkinson stefan @nathanncohen @rbeezer @vbraun\n\nThis is an active area of research, closely connected to\n* Graph Theory\n* Matroids\n* Linear Algebra\n\nI'm putting this in combinatorics, but I'm not sure where it belongs.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14789\n\n",
    "created_at": "2013-06-20T21:08:32Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Implement hyperplane arrangements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14585",
    "user": "https://github.com/kcrisman"
}
```
Assignee: sage-combinat

CC:  dperkinson stefan @nathanncohen @rbeezer @vbraun

This is an active area of research, closely connected to
* Graph Theory
* Matroids
* Linear Algebra

I'm putting this in combinatorics, but I'm not sure where it belongs.

Issue created by migration from https://trac.sagemath.org/ticket/14789





---

archive/issue_comments_185039.json:
```json
{
    "body": "Ping just because Trac doesn't send auto-updates when people attach things for some reason... Thanks, David!  Just think how long it will be once there are doctests ;-)",
    "created_at": "2013-06-24T20:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185039",
    "user": "https://github.com/kcrisman"
}
```

Ping just because Trac doesn't send auto-updates when people attach things for some reason... Thanks, David!  Just think how long it will be once there are doctests ;-)



---

archive/issue_comments_185040.json:
```json
{
    "body": "Something to get the ball rolling ...",
    "created_at": "2013-07-06T20:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185040",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Something to get the ball rolling ...



---

archive/issue_comments_185041.json:
```json
{
    "body": "Attachment [hyperplane.sage](tarball://root/attachments/some-uuid/ticket14789/hyperplane.sage) by @fchapoton created at 2013-07-11 20:02:49\n\nhere is a patch, build from the proposed file\n\nit need a lot of work, first to put coverage to 100% and make all tests pass..\n\nfor the moment, the coverage is\n\nSCORE sage/geometry/hyperplane_arrangement.py: 61.6% (45 of 73)\n\nand already 16 tests are failing",
    "created_at": "2013-07-11T20:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185041",
    "user": "https://github.com/fchapoton"
}
```

Attachment [hyperplane.sage](tarball://root/attachments/some-uuid/ticket14789/hyperplane.sage) by @fchapoton created at 2013-07-11 20:02:49

here is a patch, build from the proposed file

it need a lot of work, first to put coverage to 100% and make all tests pass..

for the moment, the coverage is

SCORE sage/geometry/hyperplane_arrangement.py: 61.6% (45 of 73)

and already 16 tests are failing



---

archive/issue_comments_185042.json:
```json
{
    "body": "here is better patch, passing all tests.",
    "created_at": "2013-07-12T09:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185042",
    "user": "https://github.com/fchapoton"
}
```

here is better patch, passing all tests.



---

archive/issue_comments_185043.json:
```json
{
    "body": "Attachment [trac_14789_hyperplane_arrgt.patch](tarball://root/attachments/some-uuid/ticket14789/trac_14789_hyperplane_arrgt.patch) by @fchapoton created at 2013-07-18 12:02:03",
    "created_at": "2013-07-18T12:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185043",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_14789_hyperplane_arrgt.patch](tarball://root/attachments/some-uuid/ticket14789/trac_14789_hyperplane_arrgt.patch) by @fchapoton created at 2013-07-18 12:02:03



---

archive/issue_comments_185044.json:
```json
{
    "body": "new patch, with coverage reaching 66% and tests passing",
    "created_at": "2013-07-18T12:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185044",
    "user": "https://github.com/fchapoton"
}
```

new patch, with coverage reaching 66% and tests passing



---

archive/issue_comments_185045.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-30T06:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185045",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_185046.json:
```json
{
    "body": "A screenshot.",
    "created_at": "2013-07-30T06:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185046",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

A screenshot.



---

archive/issue_comments_185047.json:
```json
{
    "body": "Attachment [hyp_screenshot.png](tarball://root/attachments/some-uuid/ticket14789/hyp_screenshot.png) by @fchapoton created at 2013-07-30 07:40:17\n\nwhich patch has to be applied ?",
    "created_at": "2013-07-30T07:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185047",
    "user": "https://github.com/fchapoton"
}
```

Attachment [hyp_screenshot.png](tarball://root/attachments/some-uuid/ticket14789/hyp_screenshot.png) by @fchapoton created at 2013-07-30 07:40:17

which patch has to be applied ?



---

archive/issue_comments_185048.json:
```json
{
    "body": "trac_14789_hyp_arrangement_7_29_13.patch is the only patch that should to be applied.\u200b",
    "created_at": "2013-08-01T07:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185048",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

trac_14789_hyp_arrangement_7_29_13.patch is the only patch that should to be applied.​



---

archive/issue_comments_185049.json:
```json
{
    "body": "for the bot:\n\napply trac_14789_hyp_arrangement_7_29_13.patch",
    "created_at": "2013-08-01T07:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185049",
    "user": "https://github.com/fchapoton"
}
```

for the bot:

apply trac_14789_hyp_arrangement_7_29_13.patch



---

archive/issue_comments_185050.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-01T17:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185050",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_185051.json:
```json
{
    "body": "something is wrong with the hg patch, it's almost empty.",
    "created_at": "2013-08-01T17:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185051",
    "user": "https://github.com/dimpase"
}
```

something is wrong with the hg patch, it's almost empty.



---

archive/issue_comments_185052.json:
```json
{
    "body": "I made a mistake when creating trac_14789_hyp_arrangement_7_29_13.patch (by not using hg add correctly).  I have fixed the problem and replaced \u200btrac_14789_hyp_arrangement_7_29_13.patch, using the same name.  I applied the patch to a fresh clone, just to make sure, and it is seems fine now.",
    "created_at": "2013-08-02T00:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185052",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

I made a mistake when creating trac_14789_hyp_arrangement_7_29_13.patch (by not using hg add correctly).  I have fixed the problem and replaced ​trac_14789_hyp_arrangement_7_29_13.patch, using the same name.  I applied the patch to a fresh clone, just to make sure, and it is seems fine now.



---

archive/issue_comments_185053.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-02T00:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185053",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_185054.json:
```json
{
    "body": "Attachment [trac_14789_hyp_arrangement_7_29_13.patch](tarball://root/attachments/some-uuid/ticket14789/trac_14789_hyp_arrangement_7_29_13.patch) by dperkinson created at 2013-08-02 01:04:09\n\nFirst complete version candidate; passes all tests, 100% coverage",
    "created_at": "2013-08-02T01:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185054",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Attachment [trac_14789_hyp_arrangement_7_29_13.patch](tarball://root/attachments/some-uuid/ticket14789/trac_14789_hyp_arrangement_7_29_13.patch) by dperkinson created at 2013-08-02 01:04:09

First complete version candidate; passes all tests, 100% coverage



---

archive/issue_comments_185055.json:
```json
{
    "body": "Very nice! I like the functionality but have a couple of suggestions to integrate it with the rest of Sage.\n\nThere is a lot of needless copy/deepcopy-ing. Most objects in Sage are immutable and don't need to be copied ever, you can just use/return the existing object. E.g. polyhedra are immutable. You should figure out whether you want your objects to be immutable, too. I suggest you make everything immutable, it is generally a big source of errors to make caching work with mutable stuff.\n\nCaching can be done with the ``@`cached_method` decorator, this is much easier to understand/maintain than a `__getattr__` hack.\n\nPlease no version number for individual files, Sage already has a version number.\n\nInstead of `__repr__`, you should implement `_repr_`, see http://www.sagemath.org/doc/developer/coding_in_python.html#special-sage-functions\n\nI think its confusing to have a `Hyperplane` in the global namespace that is not a `Polyhedron`. How about you replace it essentially with the arrangement consisting of a single-hyperplane. So instead of a special `add_hyperplane`, just use union:\n\n```\n    A = HyperplaneArrangement([[1,0,0],[0,1,1],[0,1,-1],[1,-1,0],[1,1,0]]) \n    B = A.union(HyperplaneArrangement([[1,1,1]]) \n    B = A.union([[1,1,1]])    # syntactic sugar for adding list of hyperplanes\n    B = A.union([1,1,1])      # syntactic sugar for adding single hyperplane\n    B = A & [1,1,1]           # operator notation\n```\n\nand pick an operator to overload (probably either plus or ampersand) as an alias for union.\n\nThe HyperplaneArrangement should be a Parent and individual hyperplanes its elements. Roughly:\n\n```\nclass Hyperplane(AffineSubspace, Element):\n\n    def __init__(self, parent, ...):\n        Element.__init__(self, parent=parent) \n\nclass HyperplaneArrangement(Parent):\n    \n    Element = Hyperplane\n\n    def __init__(self, ...):\n        Parent.__init__(self, base=base_ring, category=Sets())\n```\n\nand always use `hyperplane_arrangement.element_class()` instead of the plain `Hyperplane` class. This automatically gives you a `base_ring()` method (Sage generally uses `base_ring` instead of `base_field` even if it is only implemented for fields).",
    "created_at": "2013-08-02T03:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185055",
    "user": "https://github.com/vbraun"
}
```

Very nice! I like the functionality but have a couple of suggestions to integrate it with the rest of Sage.

There is a lot of needless copy/deepcopy-ing. Most objects in Sage are immutable and don't need to be copied ever, you can just use/return the existing object. E.g. polyhedra are immutable. You should figure out whether you want your objects to be immutable, too. I suggest you make everything immutable, it is generally a big source of errors to make caching work with mutable stuff.

Caching can be done with the ``@`cached_method` decorator, this is much easier to understand/maintain than a `__getattr__` hack.

Please no version number for individual files, Sage already has a version number.

Instead of `__repr__`, you should implement `_repr_`, see http://www.sagemath.org/doc/developer/coding_in_python.html#special-sage-functions

I think its confusing to have a `Hyperplane` in the global namespace that is not a `Polyhedron`. How about you replace it essentially with the arrangement consisting of a single-hyperplane. So instead of a special `add_hyperplane`, just use union:

```
    A = HyperplaneArrangement([[1,0,0],[0,1,1],[0,1,-1],[1,-1,0],[1,1,0]]) 
    B = A.union(HyperplaneArrangement([[1,1,1]]) 
    B = A.union([[1,1,1]])    # syntactic sugar for adding list of hyperplanes
    B = A.union([1,1,1])      # syntactic sugar for adding single hyperplane
    B = A & [1,1,1]           # operator notation
```

and pick an operator to overload (probably either plus or ampersand) as an alias for union.

The HyperplaneArrangement should be a Parent and individual hyperplanes its elements. Roughly:

```
class Hyperplane(AffineSubspace, Element):

    def __init__(self, parent, ...):
        Element.__init__(self, parent=parent) 

class HyperplaneArrangement(Parent):
    
    Element = Hyperplane

    def __init__(self, ...):
        Parent.__init__(self, base=base_ring, category=Sets())
```

and always use `hyperplane_arrangement.element_class()` instead of the plain `Hyperplane` class. This automatically gives you a `base_ring()` method (Sage generally uses `base_ring` instead of `base_field` even if it is only implemented for fields).



---

archive/issue_comments_185056.json:
```json
{
    "body": "for the bot:\n\napply only trac_14789_hyp_arrangement_7_29_13.patch\u200b",
    "created_at": "2013-08-02T09:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185056",
    "user": "https://github.com/fchapoton"
}
```

for the bot:

apply only trac_14789_hyp_arrangement_7_29_13.patch​



---

archive/issue_comments_185057.json:
```json
{
    "body": "Thanks very much for these thoughtful comments!  I will get to work on them (although I am on hiatus for a week+ to attend a conference).",
    "created_at": "2013-08-02T14:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185057",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Thanks very much for these thoughtful comments!  I will get to work on them (although I am on hiatus for a week+ to attend a conference).



---

archive/issue_comments_185058.json:
```json
{
    "body": "Sure, I'm at a conference right now ;-) Implementing the Parent / Element thing the first time is relatively difficult, don't hesitate to ask if you run into any problems.",
    "created_at": "2013-08-02T14:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185058",
    "user": "https://github.com/vbraun"
}
```

Sure, I'm at a conference right now ;-) Implementing the Parent / Element thing the first time is relatively difficult, don't hesitate to ask if you run into any problems.



---

archive/issue_comments_185059.json:
```json
{
    "body": "This is a wonderful addition to Sage. Just a couple comments (not a review, not even close):\n\n- There needs to be a way to call the empty hyperplane arrangement; this should not happen:\n\n\n```\nsage:  b = HyperplaneArrangement([])\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-5-df3005fcbc9c> in <module>()\n----> 1 b = HyperplaneArrangement([])\n\n/home/darij/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in __init__(self, A, K, check_for_duplicates)\n   1398             self._hyperplanes = [Hyperplane(h,K) for h in eqns]\n   1399         self._base_field = K\n-> 1400         self._dim = len(eqns[0])-1 # we trust the user on this point\n   1401         self._ambient_space = VectorSpace(K,self._dim)\n   1402 \n\nIndexError: list index out of range\nsage: \n```\n\n\n- The reference [RS] is available online ( http://math.mit.edu/~rstan/arrangements/arr.html ), and you should also correct its title (it's \"An Introduction to Hyperplane Arrangements\").\n\n- \"The default base field is QQ\": when you write something like that in a docstring, there is no reason not to put the QQ in double-backticks (``QQ``).\n\n- \"A hyperplane arrangement is *essential* is the normals to its hyperplane span \" the \"is\" should be an \"if\".\n\n- \"    Class for an affine space (a translation of a linear subspace). \" You want to say \"affine subspace\", not \"affine space\"!\n\n- Not sure if this is a good thing:\n\n\n```\nsage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])\nsage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])\nsage: a == b\nTrue\nsage: a.sign_vector((2, -2))\n[-1, 1]\nsage: b.sign_vector((2, -2))\n[1, -1]\n```\n\n\nThis, of course, is hard to avert unless you either make equality much more restrictive or use hyperplane arrangements that are lists, rather than sets, of hyperplanes. The latter might in fact be more useful in the long run -- e. g., what if I need to keep track of what happens to each hyperplane when I am changing base field, and I cannot assume that the hyperplanes keep their indices in the `.hyperplanes()` list because some hyperplanes might collapse on base change? I assume restriction to a hyperplane would lead to the same problem.\n\n- Double \"is\" in \"A *face* is is the\".\n\n- The [GZ] reference, like any other Transactions paper, is online: http://www.ams.org/journals/tran/1983-280-01/S0002-9947-1983-0712251-1/\n\n- In the definitions of the Catalan and braid arrangements (in their respective docstrings), replace i \\leq j by i < j.",
    "created_at": "2013-08-03T13:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185059",
    "user": "https://github.com/darijgr"
}
```

This is a wonderful addition to Sage. Just a couple comments (not a review, not even close):

- There needs to be a way to call the empty hyperplane arrangement; this should not happen:


```
sage:  b = HyperplaneArrangement([])
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-5-df3005fcbc9c> in <module>()
----> 1 b = HyperplaneArrangement([])

/home/darij/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in __init__(self, A, K, check_for_duplicates)
   1398             self._hyperplanes = [Hyperplane(h,K) for h in eqns]
   1399         self._base_field = K
-> 1400         self._dim = len(eqns[0])-1 # we trust the user on this point
   1401         self._ambient_space = VectorSpace(K,self._dim)
   1402 

IndexError: list index out of range
sage: 
```


- The reference [RS] is available online ( http://math.mit.edu/~rstan/arrangements/arr.html ), and you should also correct its title (it's "An Introduction to Hyperplane Arrangements").

- "The default base field is QQ": when you write something like that in a docstring, there is no reason not to put the QQ in double-backticks (``QQ``).

- "A hyperplane arrangement is *essential* is the normals to its hyperplane span " the "is" should be an "if".

- "    Class for an affine space (a translation of a linear subspace). " You want to say "affine subspace", not "affine space"!

- Not sure if this is a good thing:


```
sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
sage: a == b
True
sage: a.sign_vector((2, -2))
[-1, 1]
sage: b.sign_vector((2, -2))
[1, -1]
```


This, of course, is hard to avert unless you either make equality much more restrictive or use hyperplane arrangements that are lists, rather than sets, of hyperplanes. The latter might in fact be more useful in the long run -- e. g., what if I need to keep track of what happens to each hyperplane when I am changing base field, and I cannot assume that the hyperplanes keep their indices in the `.hyperplanes()` list because some hyperplanes might collapse on base change? I assume restriction to a hyperplane would lead to the same problem.

- Double "is" in "A *face* is is the".

- The [GZ] reference, like any other Transactions paper, is online: http://www.ams.org/journals/tran/1983-280-01/S0002-9947-1983-0712251-1/

- In the definitions of the Catalan and braid arrangements (in their respective docstrings), replace i \leq j by i < j.



---

archive/issue_comments_185060.json:
```json
{
    "body": "Replying to [comment:17 darij]:\n[...]\n> - Not sure if this is a good thing:\n> \n> {{{\n> sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])\n> sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])\n> sage: a == b\n> True\n[...]\n\nto me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.\nEspecially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.\n\nUntil this is sorted out, I'd rather think of disabling `==` all together.",
    "created_at": "2013-08-04T06:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185060",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:17 darij]:
[...]
> - Not sure if this is a good thing:
> 
> {{{
> sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> sage: a == b
> True
[...]

to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.

Until this is sorted out, I'd rather think of disabling `==` all together.



---

archive/issue_comments_185061.json:
```json
{
    "body": "A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So \"==\" perfectly clear and useful as it is.\n\nThe issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).\n\nCould you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?\n\nThanks very much for you comments.\n\n\nReplying to [comment:18 dimpase]:\n> Replying to [comment:17 darij]:\n> [...]\n> > - Not sure if this is a good thing:\n> > \n> > {{{\n> > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])\n> > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])\n> > sage: a == b\n> > True\n> [...]\n> \n> to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.\n> Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.\n> \n> Until this is sorted out, I'd rather think of disabling `==` all together.",
    "created_at": "2013-08-04T18:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185061",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So "==" perfectly clear and useful as it is.

The issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).

Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?

Thanks very much for you comments.


Replying to [comment:18 dimpase]:
> Replying to [comment:17 darij]:
> [...]
> > - Not sure if this is a good thing:
> > 
> > {{{
> > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> > sage: a == b
> > True
> [...]
> 
> to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
> Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.
> 
> Until this is sorted out, I'd rather think of disabling `==` all together.



---

archive/issue_comments_185062.json:
```json
{
    "body": "Sorry.  I meant to write: \"Two hyperplane arrangements are equal if their sets of hyperplanes are equal.  So \"==\" is perfectly clear and useful as it is.\"  I am traveling at the moment and a bit distracted. \n\nReplying to [comment:19 dperkinson]:\n> A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So \"==\" perfectly clear and useful as it is.\n> \n> The issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).\n> \n> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?\n> \n> Thanks very much for you comments.\n> \n> \n> Replying to [comment:18 dimpase]:\n> > Replying to [comment:17 darij]:\n> > [...]\n> > > - Not sure if this is a good thing:\n> > > \n> > > {{{\n> > > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])\n> > > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])\n> > > sage: a == b\n> > > True\n> > [...]\n> > \n> > to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.\n> > Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.\n> > \n> > Until this is sorted out, I'd rather think of disabling `==` all together.",
    "created_at": "2013-08-04T18:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185062",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Sorry.  I meant to write: "Two hyperplane arrangements are equal if their sets of hyperplanes are equal.  So "==" is perfectly clear and useful as it is."  I am traveling at the moment and a bit distracted. 

Replying to [comment:19 dperkinson]:
> A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So "==" perfectly clear and useful as it is.
> 
> The issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).
> 
> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?
> 
> Thanks very much for you comments.
> 
> 
> Replying to [comment:18 dimpase]:
> > Replying to [comment:17 darij]:
> > [...]
> > > - Not sure if this is a good thing:
> > > 
> > > {{{
> > > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> > > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> > > sage: a == b
> > > True
> > [...]
> > 
> > to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
> > Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.
> > 
> > Until this is sorted out, I'd rather think of disabling `==` all together.



---

archive/issue_comments_185063.json:
```json
{
    "body": "Replying to [comment:19 dperkinson]:\n> A hyperplane arrangement is a *set* of hyperplanes.\nThis needs to be said in the docs then. Indeed, currently one sees:\n\n``` \nString Form:<class 'sage.geometry.hyperplane_arrangement.HyperplaneArrangement'>\nFile:       /usr/local/src/sage/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.py\nDocstring:\n   The argument \"A\" is normally a list of hyperplanes or a list of\n   lists representing hyperplanes...\n```\n\n\n \n> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?\n\nJust take all the hyperplanes one obtains as affine spans of d-subsets of these points in d-dimensional space.\n\nI have also seen papers talking about the arrangement associated with a triangulation (there one takes  the facets of the\nsimplices in the triangulation as hyperplanes).",
    "created_at": "2013-08-04T20:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185063",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:19 dperkinson]:
> A hyperplane arrangement is a *set* of hyperplanes.
This needs to be said in the docs then. Indeed, currently one sees:

``` 
String Form:<class 'sage.geometry.hyperplane_arrangement.HyperplaneArrangement'>
File:       /usr/local/src/sage/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.py
Docstring:
   The argument "A" is normally a list of hyperplanes or a list of
   lists representing hyperplanes...
```


 
> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?

Just take all the hyperplanes one obtains as affine spans of d-subsets of these points in d-dimensional space.

I have also seen papers talking about the arrangement associated with a triangulation (there one takes  the facets of the
simplices in the triangulation as hyperplanes).



---

archive/issue_comments_185064.json:
```json
{
    "body": "I think it would be admissible for `==` to return `True` even if the hypersurface equations differ by an overall factor. But it might still be a good idea to pick some convention where the hypersurface equation is unique, e.g. scaling the first non-zero coordinate (or maybe largest absolute value) to one. This would also speed up comparison.\n\nOn the other hand, `==` should **not** check whether two arrangements are isomorphic by a GL rotation, or combinatorially, or any other version of a not necessarily unique isomorphism.",
    "created_at": "2013-08-04T21:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185064",
    "user": "https://github.com/vbraun"
}
```

I think it would be admissible for `==` to return `True` even if the hypersurface equations differ by an overall factor. But it might still be a good idea to pick some convention where the hypersurface equation is unique, e.g. scaling the first non-zero coordinate (or maybe largest absolute value) to one. This would also speed up comparison.

On the other hand, `==` should **not** check whether two arrangements are isomorphic by a GL rotation, or combinatorially, or any other version of a not necessarily unique isomorphism.



---

archive/issue_comments_185065.json:
```json
{
    "body": "I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?",
    "created_at": "2013-08-05T01:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185065",
    "user": "https://github.com/jhpalmieri"
}
```

I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?



---

archive/issue_comments_185066.json:
```json
{
    "body": "(Could you add the new file to the reference manual ?)",
    "created_at": "2013-08-06T08:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185066",
    "user": "https://github.com/nathanncohen"
}
```

(Could you add the new file to the reference manual ?)



---

archive/issue_events_042427.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14585#event-42427"
}
```



---

archive/issue_comments_185067.json:
```json
{
    "body": "Just as an FYI (not necessarily needed to implement this now!) we now have matroids in Sage at #7477.  So an enhancement request could be to have an arrangement return its associated matroid - and, for that matter, vice versa, if I understand correctly that matroids may be interpreted thus under some circumstances (but not related to the matroid of a central arrangement).  Anyway, whatever is right, we might want to do it someday.",
    "created_at": "2013-08-18T00:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185067",
    "user": "https://github.com/kcrisman"
}
```

Just as an FYI (not necessarily needed to implement this now!) we now have matroids in Sage at #7477.  So an enhancement request could be to have an arrangement return its associated matroid - and, for that matter, vice versa, if I understand correctly that matroids may be interpreted thus under some circumstances (but not related to the matroid of a central arrangement).  Anyway, whatever is right, we might want to do it someday.



---

archive/issue_comments_185068.json:
```json
{
    "body": "> I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?\n+1 to the question\n\nHowever, in this case maybe (maybe) it's okay.  Because the question is about \"which side of the hyperplane the point is on\" and that of course requires an orientation to each hyperplane, given by the equation, and naturally this list will depend on the order.  However, the documentation probably should include this example to point out that it definitely depends on the order you give the hyperplanes in, just in case some unsuspecting user might think otherwise.  A sign set probably wouldn't be of very much use.\n\nBy the way, I assume that we don't get\n\n```\na is b\nTrue\n```\n\nwhich I think *would* be a bug.",
    "created_at": "2013-08-18T00:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185068",
    "user": "https://github.com/kcrisman"
}
```

> I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?
+1 to the question

However, in this case maybe (maybe) it's okay.  Because the question is about "which side of the hyperplane the point is on" and that of course requires an orientation to each hyperplane, given by the equation, and naturally this list will depend on the order.  However, the documentation probably should include this example to point out that it definitely depends on the order you give the hyperplanes in, just in case some unsuspecting user might think otherwise.  A sign set probably wouldn't be of very much use.

By the way, I assume that we don't get

```
a is b
True
```

which I think *would* be a bug.



---

archive/issue_comments_185069.json:
```json
{
    "body": "wrong plot",
    "created_at": "2013-08-30T16:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185069",
    "user": "https://github.com/dimpase"
}
```

wrong plot



---

archive/issue_comments_185070.json:
```json
{
    "body": "Attachment [plot4.png](tarball://root/attachments/some-uuid/ticket14789/plot4.png) by @dimpase created at 2013-08-30 16:21:18\n\nThere is something strange happening with plotting the following \n\n```\nHyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])\n```\n\nSee the attached plot. Some lines are cut short...",
    "created_at": "2013-08-30T16:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185070",
    "user": "https://github.com/dimpase"
}
```

Attachment [plot4.png](tarball://root/attachments/some-uuid/ticket14789/plot4.png) by @dimpase created at 2013-08-30 16:21:18

There is something strange happening with plotting the following 

```
HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
```

See the attached plot. Some lines are cut short...



---

archive/issue_comments_185071.json:
```json
{
    "body": "Please try:\n\nsage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])\nsage: a.show(ranges=5)\n\nFor finer control of the ranges, please see the \"ranges\" option for a.plot and a.show.  Try a.plot? or a.show? .  Perhaps we could think about computing the \"optimal\" ranges for an arbitrary arrangement.\n\n\nReplying to [comment:28 dimpase]:\n> There is something strange happening with plotting the following \n> {{{\n> HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])\n> }}}\n> See the attached plot. Some lines are cut short...",
    "created_at": "2013-08-30T16:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185071",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Please try:

sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
sage: a.show(ranges=5)

For finer control of the ranges, please see the "ranges" option for a.plot and a.show.  Try a.plot? or a.show? .  Perhaps we could think about computing the "optimal" ranges for an arbitrary arrangement.


Replying to [comment:28 dimpase]:
> There is something strange happening with plotting the following 
> {{{
> HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> }}}
> See the attached plot. Some lines are cut short...



---

archive/issue_comments_185072.json:
```json
{
    "body": "Replying to [comment:29 dperkinson]:\n> Please try:\n> \n> sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])\n> sage: a.show(ranges=5)\n\nthe layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.",
    "created_at": "2013-08-31T14:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185072",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:29 dperkinson]:
> Please try:
> 
> sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> sage: a.show(ranges=5)

the layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.



---

archive/issue_comments_185073.json:
```json
{
    "body": "Yes.  Each hyperplane is parametrized.  The \"ranges\" option allows the plotting parameters to be adjusted individually, e.g.,\n\nsage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])\n\nPerhaps there is a way to make the parameters all large, then constrict the bounding box.\n\nReplying to [comment:30 dimpase]:\n> Replying to [comment:29 dperkinson]:\n> > Please try:\n> > \n> > sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])\n> > sage: a.show(ranges=5)\n> \n> the layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.\n> \n>",
    "created_at": "2013-08-31T15:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185073",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

Yes.  Each hyperplane is parametrized.  The "ranges" option allows the plotting parameters to be adjusted individually, e.g.,

sage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])

Perhaps there is a way to make the parameters all large, then constrict the bounding box.

Replying to [comment:30 dimpase]:
> Replying to [comment:29 dperkinson]:
> > Please try:
> > 
> > sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> > sage: a.show(ranges=5)
> 
> the layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.
> 
>



---

archive/issue_comments_185074.json:
```json
{
    "body": "Replying to [comment:31 dperkinson]:\n> Yes.  Each hyperplane is parametrized.  The \"ranges\" option allows the plotting parameters to be adjusted individually, e.g.,\n> \n> `sage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])`\n> \n> Perhaps there is a way to make the parameters all large, then constrict the bounding box.\n\n\nInspect the current layout, hyperplane by hyperplane, and find the box by computing maxima and minima of coordinates.\nThen adjust each hyperplane  to fit in the box.\n\nWell, I'm not saying this must happen on this ticket, but please open a followup ticket to address this.",
    "created_at": "2013-09-06T06:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185074",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:31 dperkinson]:
> Yes.  Each hyperplane is parametrized.  The "ranges" option allows the plotting parameters to be adjusted individually, e.g.,
> 
> `sage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])`
> 
> Perhaps there is a way to make the parameters all large, then constrict the bounding box.


Inspect the current layout, hyperplane by hyperplane, and find the box by computing maxima and minima of coordinates.
Then adjust each hyperplane  to fit in the box.

Well, I'm not saying this must happen on this ticket, but please open a followup ticket to address this.



---

archive/issue_comments_185075.json:
```json
{
    "body": "This looks like a bug in `num_regions()`:\n(stumbled upon this example in  a large set of 2d arrangements)\n\n```\nsage: a=HyperplaneArrangement([[1, 106, 106266],[83, 101, 157866],[111, 110, 186150], [453, 221, 532686], [407, 237, 516882],\n [55, 32, 75620], [221, 114, 289346], [452, 115, 474217], [406, 131, 453521], [28, 9, 32446], [287, 19, 271774], [241, 35, 244022],\n [231, 1, 210984], [185, 17, 181508], [23, -8, 16609]])\nsage: a.num_regions()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-3-cf364604935f> in <module>()\n----> 1 a.num_regions()\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in num_regions(self)\n   2283         if self.base_field().characteristic() != 0:\n   2284             raise TypeError('base field must have characteristic zero')\n-> 2285         return (-1)**self._dim*self.characteristic_polynomial(-1)\n   2286 \n   2287     def num_hyperplanes(self):\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in characteristic_polynomial(self, a)\n   2190             return self._characteristic_polynomial\n   2191         else:\n-> 2192             return self._characteristic_polynomial.subs(x=a)\n   2193 \n   2194     def poincare_polynomial(self, a=None):\n\n[...]\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in restriction(self, H)\n   3003         for T in new_hyperplanes:\n   3004             basis = T.linear_part().matrix()\n-> 3005             p = H._isomorphism_with_Kn(T.point())\n   3006             if basis.nrows() == 0:\n   3007                 eqn = [1] + list(p)\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in _isomorphism_with_Kn(self, v)\n    813             q = q.apply_map(lambda x: QQ(round(RR(x),2)))\n    814             u = q*G  # u is the approximately orthonormalized W\n--> 815             return u.solve_left(v-self.point())\n    816         else: # finite field\n    817             p = self.point()\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_left (sage/matrix/matrix2.c:4386)()\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_right (sage/matrix/matrix2.c:5242)()\n\n/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix._solve_right_general (sage/matrix/matrix2.c:6182)()\n\nValueError: matrix equation has no solutions\nsage: \n\n```\n",
    "created_at": "2013-09-11T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185075",
    "user": "https://github.com/dimpase"
}
```

This looks like a bug in `num_regions()`:
(stumbled upon this example in  a large set of 2d arrangements)

```
sage: a=HyperplaneArrangement([[1, 106, 106266],[83, 101, 157866],[111, 110, 186150], [453, 221, 532686], [407, 237, 516882],
 [55, 32, 75620], [221, 114, 289346], [452, 115, 474217], [406, 131, 453521], [28, 9, 32446], [287, 19, 271774], [241, 35, 244022],
 [231, 1, 210984], [185, 17, 181508], [23, -8, 16609]])
sage: a.num_regions()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-3-cf364604935f> in <module>()
----> 1 a.num_regions()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in num_regions(self)
   2283         if self.base_field().characteristic() != 0:
   2284             raise TypeError('base field must have characteristic zero')
-> 2285         return (-1)**self._dim*self.characteristic_polynomial(-1)
   2286 
   2287     def num_hyperplanes(self):

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in characteristic_polynomial(self, a)
   2190             return self._characteristic_polynomial
   2191         else:
-> 2192             return self._characteristic_polynomial.subs(x=a)
   2193 
   2194     def poincare_polynomial(self, a=None):

[...]

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in restriction(self, H)
   3003         for T in new_hyperplanes:
   3004             basis = T.linear_part().matrix()
-> 3005             p = H._isomorphism_with_Kn(T.point())
   3006             if basis.nrows() == 0:
   3007                 eqn = [1] + list(p)

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in _isomorphism_with_Kn(self, v)
    813             q = q.apply_map(lambda x: QQ(round(RR(x),2)))
    814             u = q*G  # u is the approximately orthonormalized W
--> 815             return u.solve_left(v-self.point())
    816         else: # finite field
    817             p = self.point()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_left (sage/matrix/matrix2.c:4386)()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_right (sage/matrix/matrix2.c:5242)()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix._solve_right_general (sage/matrix/matrix2.c:6182)()

ValueError: matrix equation has no solutions
sage: 

```




---

archive/issue_comments_185076.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-09-11T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185076",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_185077.json:
```json
{
    "body": "I'm still not particularly happy with the syntax. Especially handing around tuples isn't really that userfriendly. I would propose the following:\n\n```\nsage: H.<x,y,z> = HyperplaneArrangements(QQ)\n```\n\nas shortcut for\n\n```\nsage: H = HyperplaneArrangements(QQ, names='x, y, z')\nsage: H.inject_variables()\n```\n\nand then construct hyperplanes as \n\n```\nsage: hyperplane = x + 2*y + 3*z - 4\n```\n\nand hyperplane arrangements as \n\n```\nsage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)\nsage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional\nTrue\n```\n\nIf nobody objects then I'll work on that since I kind of need hyperplane arrangements now...",
    "created_at": "2013-10-10T22:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185077",
    "user": "https://github.com/vbraun"
}
```

I'm still not particularly happy with the syntax. Especially handing around tuples isn't really that userfriendly. I would propose the following:

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
```

as shortcut for

```
sage: H = HyperplaneArrangements(QQ, names='x, y, z')
sage: H.inject_variables()
```

and then construct hyperplanes as 

```
sage: hyperplane = x + 2*y + 3*z - 4
```

and hyperplane arrangements as 

```
sage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)
sage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional
True
```

If nobody objects then I'll work on that since I kind of need hyperplane arrangements now...



---

archive/issue_comments_185078.json:
```json
{
    "body": "The syntax you suggest is very nice for very small examples.  Using tuples is convenient for larger or for computer-generated examples.  (It's similar to the syntax for polyhedra in Sage, of course.)  So I would support your suggestion as long as it does not interfere with using tuples.\n\nThanks!",
    "created_at": "2013-10-10T22:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185078",
    "user": "https://trac.sagemath.org/admin/accounts/users/dperkinson"
}
```

The syntax you suggest is very nice for very small examples.  Using tuples is convenient for larger or for computer-generated examples.  (It's similar to the syntax for polyhedra in Sage, of course.)  So I would support your suggestion as long as it does not interfere with using tuples.

Thanks!



---

archive/issue_comments_185079.json:
```json
{
    "body": "Yes, agree. That would be natural using conversion syntax:\n\n```\nsage: H.<x,y,z> = HyperplaneArrangements(QQ)\nsage: H([4, 1, 2, 3])\nx + 2*y + 3*z + 4\n```\n\n\nOn a related note, I think the constant should be first for consistency with polyhedra:\n\n```\nsage: Polyhedron(ieqs=[(4,1,2,3)]).Hrepresentation()\n(An inequality (1, 2, 3) x + 4 >= 0,)\n```\n",
    "created_at": "2013-10-11T10:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185079",
    "user": "https://github.com/vbraun"
}
```

Yes, agree. That would be natural using conversion syntax:

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H([4, 1, 2, 3])
x + 2*y + 3*z + 4
```


On a related note, I think the constant should be first for consistency with polyhedra:

```
sage: Polyhedron(ieqs=[(4,1,2,3)]).Hrepresentation()
(An inequality (1, 2, 3) x + 4 >= 0,)
```




---

archive/issue_comments_185080.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> {{{\n> sage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)\n> sage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional\n> True\n> }}}\n> If nobody objects then I'll work on that since I kind of need hyperplane arrangements now...\n\nDon't use \"and\". It explicitly has shortcutting behaviour specified on it:\n\n```\nsage: 1 and 2\n2\nsage: a = 1; b = 2\nsage: b if a else a #it's specified to do this\n2\n```\n\nso departing from this behaviour would be very surprising.\n\nThe operator possibly available would be the \"bitwise\" `&`, but I doubt you want to repurpose it for union.? Being smart with overloading operators often comes back to bite you (see `%` for string formatting in python).\n\nAlso, since these are hyperplanes given by equations describing them, `and` could easily be interpreted as *intersection*. That's the most direct interpretation coming from the boolean meaning of the operator in sage.\n\nMultiplication would come closer if you think about the arrangement as a union of hyperplanes. Do you keep multiplicities?\n\nIf you think of the hyperplane arrangement as a collection of hyperplanes, then they should probably be modelled as a set of hyperplanes, and python does not overload any binary operation to take unions of sets.",
    "created_at": "2013-10-11T17:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185080",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:34 vbraun]:
> {{{
> sage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)
> sage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional
> True
> }}}
> If nobody objects then I'll work on that since I kind of need hyperplane arrangements now...

Don't use "and". It explicitly has shortcutting behaviour specified on it:

```
sage: 1 and 2
2
sage: a = 1; b = 2
sage: b if a else a #it's specified to do this
2
```

so departing from this behaviour would be very surprising.

The operator possibly available would be the "bitwise" `&`, but I doubt you want to repurpose it for union.? Being smart with overloading operators often comes back to bite you (see `%` for string formatting in python).

Also, since these are hyperplanes given by equations describing them, `and` could easily be interpreted as *intersection*. That's the most direct interpretation coming from the boolean meaning of the operator in sage.

Multiplication would come closer if you think about the arrangement as a union of hyperplanes. Do you keep multiplicities?

If you think of the hyperplane arrangement as a collection of hyperplanes, then they should probably be modelled as a set of hyperplanes, and python does not overload any binary operation to take unions of sets.



---

archive/issue_comments_185081.json:
```json
{
    "body": "Good point, forgot about the short-circuiting. Of course one could override `__nonzero__` but I'd rather not if it can be avoided.\n\nMultiplication has the wrong precedence, so thats out. Also, I don't think we should keep mulitplicities. \n\nBit ops are probably best. How about bit-or = `|`:\n\n```\nsage: arrangement = x + 2*y + 3*z - 4 | y - 7 | x + z\n```\n",
    "created_at": "2013-10-11T18:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185081",
    "user": "https://github.com/vbraun"
}
```

Good point, forgot about the short-circuiting. Of course one could override `__nonzero__` but I'd rather not if it can be avoided.

Multiplication has the wrong precedence, so thats out. Also, I don't think we should keep mulitplicities. 

Bit ops are probably best. How about bit-or = `|`:

```
sage: arrangement = x + 2*y + 3*z - 4 | y - 7 | x + z
```




---

archive/issue_comments_185082.json:
```json
{
    "body": "Replying to [comment:38 vbraun]:\n\n> Bit ops are probably best. How about bit-or = `|`:\n\nOut of the binary ops available that's probably the one that makes most sense. I don't think overloading binops has much precedent in sage/python, though, so it looks a little odd to me. Given how non-compact this notation is anyway, do we really need a compact way of combining hyperplanes?\n\nThere's another small problem: vector spaces in sage do not have variable names. In principle, given a vector space, there is a well-defined set of all hyperplane arrangements in that space. If we insist on giving names to the standard basis of the dual vector space, there would be multiple (determined by the names) and the user would be forced to come up with names if he/she wants to construct the collection.\n\nI agree that describing a hyperplane in n-space with a tuple of length n+1 feels a little uncomfortable: It should really be a vector in the dual space together with a scalar, i.e., a pair of an n-tuple and a scalar, which is awkward to work with by itself.\n\nWould it be better to let (a,b,c,d) mean a*x+b*y+c*z+d=0 (note the sign on the constant)? That's a little more like standard homogenization.\n\nPrecedent in other software dealing with hyperplane arrangements might be instructive?",
    "created_at": "2013-10-12T20:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185082",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:38 vbraun]:

> Bit ops are probably best. How about bit-or = `|`:

Out of the binary ops available that's probably the one that makes most sense. I don't think overloading binops has much precedent in sage/python, though, so it looks a little odd to me. Given how non-compact this notation is anyway, do we really need a compact way of combining hyperplanes?

There's another small problem: vector spaces in sage do not have variable names. In principle, given a vector space, there is a well-defined set of all hyperplane arrangements in that space. If we insist on giving names to the standard basis of the dual vector space, there would be multiple (determined by the names) and the user would be forced to come up with names if he/she wants to construct the collection.

I agree that describing a hyperplane in n-space with a tuple of length n+1 feels a little uncomfortable: It should really be a vector in the dual space together with a scalar, i.e., a pair of an n-tuple and a scalar, which is awkward to work with by itself.

Would it be better to let (a,b,c,d) mean a*x+b*y+c*z+d=0 (note the sign on the constant)? That's a little more like standard homogenization.

Precedent in other software dealing with hyperplane arrangements might be instructive?



---

archive/issue_comments_185083.json:
```json
{
    "body": "I'm working on making (d,a,b,c) mean a*x+b*y+c*z+d=0. So the sign is expected. And the order as well as the sign matches the notation used for polyhedra. If you want to avoid ambiguity then list/tuple plus scalar also define a hyperplane::\n\n```\nsage: H.<x,y> = HyperplaneArrangements(QQ)\nsage: H(x, y, x+y-1)\nArrangement <y | x | x + y - 1>\nsage: H([0,1,0], [0,0,1], [-1,1,1])\nArrangement <y | x | x + y - 1>\nsage: H([(1,1),0], [(2,3),-1], [(4,5),3])\nArrangement <x + y | 2*x + 3*y - 1 | 4*x + 5*y + 3>\n```\n",
    "created_at": "2013-10-13T14:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185083",
    "user": "https://github.com/vbraun"
}
```

I'm working on making (d,a,b,c) mean a*x+b*y+c*z+d=0. So the sign is expected. And the order as well as the sign matches the notation used for polyhedra. If you want to avoid ambiguity then list/tuple plus scalar also define a hyperplane::

```
sage: H.<x,y> = HyperplaneArrangements(QQ)
sage: H(x, y, x+y-1)
Arrangement <y | x | x + y - 1>
sage: H([0,1,0], [0,0,1], [-1,1,1])
Arrangement <y | x | x + y - 1>
sage: H([(1,1),0], [(2,3),-1], [(4,5),3])
Arrangement <x + y | 2*x + 3*y - 1 | 4*x + 5*y + 3>
```




---

archive/issue_comments_185084.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2013-10-13T21:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185084",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_185085.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-10-13T21:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185085",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_185086.json:
```json
{
    "body": "Almost finished...  here is Dima's example:\n\n```\n    sage: H.<x,y> = HyperplaneArrangements(QQ)\n    sage: h = H([(1, 106), 106266], [(83, 101), 157866], [(111, 110), 186150], [(453, 221), 532686], \n    ....:       [(407, 237), 516882], [(55, 32), 75620], [(221, 114), 289346], [(452, 115), 474217], \n    ....:       [(406, 131), 453521], [(28, 9), 32446], [(287, 19), 271774], [(241, 35), 244022],\n    ....:       [(231, 1), 210984], [(185, 17), 181508], [(23, -8), 16609])\n    sage: h.n_regions()\n    85\n```\n",
    "created_at": "2013-10-13T21:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185086",
    "user": "https://github.com/vbraun"
}
```

Almost finished...  here is Dima's example:

```
    sage: H.<x,y> = HyperplaneArrangements(QQ)
    sage: h = H([(1, 106), 106266], [(83, 101), 157866], [(111, 110), 186150], [(453, 221), 532686], 
    ....:       [(407, 237), 516882], [(55, 32), 75620], [(221, 114), 289346], [(452, 115), 474217], 
    ....:       [(406, 131), 453521], [(28, 9), 32446], [(287, 19), 271774], [(241, 35), 244022],
    ....:       [(231, 1), 210984], [(185, 17), 181508], [(23, -8), 16609])
    sage: h.n_regions()
    85
```




---

archive/issue_comments_185087.json:
```json
{
    "body": "Replying to [comment:42 vbraun]:\n> Almost finished...  here is Dima's example:\n> {{{\n> ...\n>     sage: h.n_regions()\n>     85\n> }}}\nHas it magically got fixed? ;\u2013)",
    "created_at": "2013-10-13T22:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185087",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:42 vbraun]:
> Almost finished...  here is Dima's example:
> {{{
> ...
>     sage: h.n_regions()
>     85
> }}}
Has it magically got fixed? ;–)



---

archive/issue_comments_185088.json:
```json
{
    "body": "Replying to [comment:43 dimpase]:\n\n> Has it magically got fixed? ;\u2013)\n\nAll sufficiently hard work is indistinguishable from magic ;-)\n\nIn case I haven't made it clear, the branch contains quite extensive modifications of the original patch.",
    "created_at": "2013-10-14T09:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185088",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:43 dimpase]:

> Has it magically got fixed? ;–)

All sufficiently hard work is indistinguishable from magic ;-)

In case I haven't made it clear, the branch contains quite extensive modifications of the original patch.



---

archive/issue_comments_185089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-14T12:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185090.json:
```json
{
    "body": "IMHO this is now finished. I'm happy to give positive review to everything that I haven't changed ;-)",
    "created_at": "2013-10-14T12:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185090",
    "user": "https://github.com/vbraun"
}
```

IMHO this is now finished. I'm happy to give positive review to everything that I haven't changed ;-)



---

archive/issue_comments_185091.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-14T12:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185091",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_185092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-16T12:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185093.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-27T22:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-29T21:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185095.json:
```json
{
    "body": "I've been using this ticket in #15328 and it works for me. If you want to review this ticket you can review up to 343ac2c, the further additions can easily be split into a separate ticket.",
    "created_at": "2013-10-30T14:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185095",
    "user": "https://github.com/vbraun"
}
```

I've been using this ticket in #15328 and it works for me. If you want to review this ticket you can review up to 343ac2c, the further additions can easily be split into a separate ticket.



---

archive/issue_comments_185096.json:
```json
{
    "body": "The thing I was beefing about with my `sign_vector` copypasta wasn't so much the handling of `==` (which would require us to fix the definition of a hyperplane arrangement in place more formally than mathematicians do), as the unpredictability of the output:\n\n```\nsage: h = H(x, y, x-1, y-1, y-1)\nsage: h.sign_vector((2,-2))\n(-1, -1, 1, 1)\nsage: h.restriction(y).sign_vector((2,))\n(-1, 1)\n```\n\nHow do I tell (without lots of overhead) which entry of the vector corresponds to which line?\n\nEDIT: Also there is a failing longtime doctest (failing because you forgot to provide the answer):\n\n```\nFile \"src/sage/geometry/hyperplane_arrangement/arrangement.py\", line 1438, in sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.regions\nFailed example:\n    len(chessboard.bounded_regions())   # long time, 359 ms on a Core i7\nExpected nothing\nGot:\n    64\n```\n\n\nEDIT2: Unfitting docstring:\n\n```\n    def unbounded_regions(self):\n        r\"\"\"\n        Return the relatively bounded regions of the arrangement.\n```\n\n\nEDIT3: It would be best to redefine `_an_element_` since it currently returns a hyperplane instead of a hyperplane arrangement:\n\n```\nsage: HyperplaneArrangements(QQ, ('x','y')).an_element()\nHyperplane x + 0*y + 0\n```\n\n\nEDIT4: Also, pyflakes report:\n\n```\nsrc/sage/geometry/hyperplane_arrangement/library.py:16: 'identity_matrix' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:21: 'expand' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:25: 'flatten' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:26: 'random' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:27: 'powerset' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:28: 'line' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:29: 'Color' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:30: 'Graphics' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:31: 'plot' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:31: 'parametric_plot' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:32: 'point' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:33: 'text' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:34: 'parametric_plot3d' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:35: 'text3d' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:36: 'lcm' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:37: 'GF' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:40: 'PolynomialRing' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:41: redefinition of unused 'QQ' from line 17\nsrc/sage/geometry/hyperplane_arrangement/library.py:42: 'RR' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:43: 'SageObject' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:44: 'var' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/library.py:44: 'SR' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/affine_subspace.py:71: 'QQ' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/affine_subspace.py:72: 'matrix' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/arrangement.py:327: 'coerce_binop' imported but unused\nsrc/sage/geometry/hyperplane_arrangement/arrangement.py:644: local variable 'AA' is assigned to but never used\nsrc/sage/geometry/hyperplane_arrangement/arrangement.py:873: local variable 'n' is assigned to but never used\n```\n",
    "created_at": "2013-11-07T00:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185096",
    "user": "https://github.com/darijgr"
}
```

The thing I was beefing about with my `sign_vector` copypasta wasn't so much the handling of `==` (which would require us to fix the definition of a hyperplane arrangement in place more formally than mathematicians do), as the unpredictability of the output:

```
sage: h = H(x, y, x-1, y-1, y-1)
sage: h.sign_vector((2,-2))
(-1, -1, 1, 1)
sage: h.restriction(y).sign_vector((2,))
(-1, 1)
```

How do I tell (without lots of overhead) which entry of the vector corresponds to which line?

EDIT: Also there is a failing longtime doctest (failing because you forgot to provide the answer):

```
File "src/sage/geometry/hyperplane_arrangement/arrangement.py", line 1438, in sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.regions
Failed example:
    len(chessboard.bounded_regions())   # long time, 359 ms on a Core i7
Expected nothing
Got:
    64
```


EDIT2: Unfitting docstring:

```
    def unbounded_regions(self):
        r"""
        Return the relatively bounded regions of the arrangement.
```


EDIT3: It would be best to redefine `_an_element_` since it currently returns a hyperplane instead of a hyperplane arrangement:

```
sage: HyperplaneArrangements(QQ, ('x','y')).an_element()
Hyperplane x + 0*y + 0
```


EDIT4: Also, pyflakes report:

```
src/sage/geometry/hyperplane_arrangement/library.py:16: 'identity_matrix' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:21: 'expand' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:25: 'flatten' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:26: 'random' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:27: 'powerset' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:28: 'line' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:29: 'Color' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:30: 'Graphics' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:31: 'plot' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:31: 'parametric_plot' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:32: 'point' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:33: 'text' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:34: 'parametric_plot3d' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:35: 'text3d' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:36: 'lcm' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:37: 'GF' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:40: 'PolynomialRing' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:41: redefinition of unused 'QQ' from line 17
src/sage/geometry/hyperplane_arrangement/library.py:42: 'RR' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:43: 'SageObject' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:44: 'var' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:44: 'SR' imported but unused
src/sage/geometry/hyperplane_arrangement/affine_subspace.py:71: 'QQ' imported but unused
src/sage/geometry/hyperplane_arrangement/affine_subspace.py:72: 'matrix' imported but unused
src/sage/geometry/hyperplane_arrangement/arrangement.py:327: 'coerce_binop' imported but unused
src/sage/geometry/hyperplane_arrangement/arrangement.py:644: local variable 'AA' is assigned to but never used
src/sage/geometry/hyperplane_arrangement/arrangement.py:873: local variable 'n' is assigned to but never used
```




---

archive/issue_comments_185097.json:
```json
{
    "body": "Here's the current version with my state of review. However there are two doctest failures. The first is that\n\n```\nsage: H.<x,y,z> = HyperplaneArrangements(QQ)\nsage: H(x) == 0\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 480, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 839, in execute\n        exec compiled in globs\n      File \"<doctest sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.__cmp__[2]>\", line 1, in <module>\n        H(x) == Integer(0)\n      File \"element.pyx\", line 914, in sage.structure.element.Element.__richcmp__ (sage/structure/element.c:8876)\n      File \"element.pyx\", line 855, in sage.structure.element.Element._richcmp (sage/structure/element.c:8221)\n      File \"coerce.pyx\", line 921, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:8568)\n      File \"coerce_maps.pyx\", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)\n      File \"coerce_maps.pyx\", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)\n      File \"/home/travis/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py\", line 2124, in _element_constructor_\n        raise ValueError('linear expression must be non-constant to define a hyperplane')\n    ValueError: linear expression must be non-constant to define a hyperplane\n```\n\nso it seems like it's trying to coerce 0 into `H`, but that is failing. The second is that 0-dimensional hyperplane arrangements don't have an `_an_element_()`. If we can't create 0-dim hyperplane arrangements, then we shouldn't allow things like `HyperplaneArrangements(QQ)`.\n\nI've taken care of the pyflakes report and the long doctest failure.\n----\nLast 10 new commits:",
    "created_at": "2013-11-08T01:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185097",
    "user": "https://github.com/tscrim"
}
```

Here's the current version with my state of review. However there are two doctest failures. The first is that

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H(x) == 0
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.__cmp__[2]>", line 1, in <module>
        H(x) == Integer(0)
      File "element.pyx", line 914, in sage.structure.element.Element.__richcmp__ (sage/structure/element.c:8876)
      File "element.pyx", line 855, in sage.structure.element.Element._richcmp (sage/structure/element.c:8221)
      File "coerce.pyx", line 921, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:8568)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py", line 2124, in _element_constructor_
        raise ValueError('linear expression must be non-constant to define a hyperplane')
    ValueError: linear expression must be non-constant to define a hyperplane
```

so it seems like it's trying to coerce 0 into `H`, but that is failing. The second is that 0-dimensional hyperplane arrangements don't have an `_an_element_()`. If we can't create 0-dim hyperplane arrangements, then we shouldn't allow things like `HyperplaneArrangements(QQ)`.

I've taken care of the pyflakes report and the long doctest failure.
----
Last 10 new commits:



---

archive/issue_comments_185098.json:
```json
{
    "body": "Changing keywords from \"\" to \"days54\".",
    "created_at": "2013-11-09T00:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185098",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "" to "days54".



---

archive/issue_comments_185099.json:
```json
{
    "body": "What is \n\n```\nsage: H.<x,y,z> = HyperplaneArrangements(QQ)\nsage: H(0)\n```\n\nsupposed to return? You could either argue the empty arrangement (neutral element in the additive semigroup) or the entire space defined by the degenerate \"hyperplane\" 0=0. I really don't want to allow that kind of degenerate hyperplanes. So that leaves us with the former, but I still find `H(0)` confusing and, by extension, `H(x) == 0`. \n\nThere is no easy way to find out which ambient hyperplane went where in `restriction()`, in particular it involves choices:\n\n```\nsage: H.<x,y> = HyperplaneArrangements(QQ)\nsage: H(x-y, x+y, x).restriction(x)\nArrangement <y>\n```\n\nSo its alwasy going to be convoluted. If you need to know the sign vector of a point in terms of the ambient space arrangement then just compute the sign vector there.\n\nI can fix up the 0-dimensional and empty arrangement case...",
    "created_at": "2013-12-23T14:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185099",
    "user": "https://github.com/vbraun"
}
```

What is 

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H(0)
```

supposed to return? You could either argue the empty arrangement (neutral element in the additive semigroup) or the entire space defined by the degenerate "hyperplane" 0=0. I really don't want to allow that kind of degenerate hyperplanes. So that leaves us with the former, but I still find `H(0)` confusing and, by extension, `H(x) == 0`. 

There is no easy way to find out which ambient hyperplane went where in `restriction()`, in particular it involves choices:

```
sage: H.<x,y> = HyperplaneArrangements(QQ)
sage: H(x-y, x+y, x).restriction(x)
Arrangement <y>
```

So its alwasy going to be convoluted. If you need to know the sign vector of a point in terms of the ambient space arrangement then just compute the sign vector there.

I can fix up the 0-dimensional and empty arrangement case...



---

archive/issue_comments_185100.json:
```json
{
    "body": "Ok since `H()` is equivalent to `H(0)` we'll have to go with it...",
    "created_at": "2013-12-23T14:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185100",
    "user": "https://github.com/vbraun"
}
```

Ok since `H()` is equivalent to `H(0)` we'll have to go with it...



---

archive/issue_comments_185101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-23T14:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185102.json:
```json
{
    "body": "Replying to [comment:56 vbraun]:\n> Ok since `H()` is equivalent to `H(0)` we'll have to go with it... \n\nThis is #8648.\n\nCurrently this works\n\n```\nsage: H.<x,y,z> = HyperplaneArrangements(QQ)\nsage: 0*x\nHyperplane 0*x + 0*y + 0*z + 0\nsage: H(0*x)\nEmpty hyperplane arrangement of dimension 3\n```\n\nbut this doesn't:\n\n```\nsage: H(0*x, 0*x)\nValueError: linear expression must be non-constant to define a hyperplane\n```\n\nI think the best course of action is to make this consistent by stripping out the degenerate hyperplanes. Alternatively we could treat the special case of a non-hyperplane `0` as referring to the empty arrangement as a workaround for #8648 and the equality test. Your thoughts?",
    "created_at": "2013-12-23T17:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185102",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:56 vbraun]:
> Ok since `H()` is equivalent to `H(0)` we'll have to go with it... 

This is #8648.

Currently this works

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: 0*x
Hyperplane 0*x + 0*y + 0*z + 0
sage: H(0*x)
Empty hyperplane arrangement of dimension 3
```

but this doesn't:

```
sage: H(0*x, 0*x)
ValueError: linear expression must be non-constant to define a hyperplane
```

I think the best course of action is to make this consistent by stripping out the degenerate hyperplanes. Alternatively we could treat the special case of a non-hyperplane `0` as referring to the empty arrangement as a workaround for #8648 and the equality test. Your thoughts?



---

archive/issue_comments_185103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-24T20:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_185104.json:
```json
{
    "body": "Agree, I disallowed `H(0*x)` in the new commit.",
    "created_at": "2013-12-24T21:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185104",
    "user": "https://github.com/vbraun"
}
```

Agree, I disallowed `H(0*x)` in the new commit.



---

archive/issue_comments_185105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-24T23:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185105",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_185106.json:
```json
{
    "body": "Looks good. Thanks.",
    "created_at": "2013-12-24T23:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185106",
    "user": "https://github.com/tscrim"
}
```

Looks good. Thanks.



---

archive/issue_comments_185107.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-26T14:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185107",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_042428.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-26T14:50:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14585#event-42428"
}
```



---

archive/issue_comments_185108.json:
```json
{
    "body": "Hello. I'm playing around with this branch now and I have a few questions.\n\nPerhaps the first question should be: since this is marked as \"closed\", should I ask my questions elsewhere?",
    "created_at": "2014-01-25T18:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185108",
    "user": "https://github.com/saliola"
}
```

Hello. I'm playing around with this branch now and I have a few questions.

Perhaps the first question should be: since this is marked as "closed", should I ask my questions elsewhere?



---

archive/issue_comments_185109.json:
```json
{
    "body": "yes, this is merged. Open a new ticket for defects/enhancements or ask general questions on sage-devel.",
    "created_at": "2014-01-25T23:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185109",
    "user": "https://github.com/vbraun"
}
```

yes, this is merged. Open a new ticket for defects/enhancements or ask general questions on sage-devel.



---

archive/issue_comments_185110.json:
```json
{
    "body": "See #18133 for Orlik-Solomon algebra.",
    "created_at": "2015-04-07T13:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14585#issuecomment-185110",
    "user": "https://github.com/kcrisman"
}
```

See #18133 for Orlik-Solomon algebra.
