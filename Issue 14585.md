# Issue 14585: Implement hyperplane arrangements

Issue created by migration from https://trac.sagemath.org/ticket/14789

Original creator: kcrisman

Original creation time: 2013-06-20 21:08:32

Assignee: sage-combinat

CC:  dperkinson stefan ncohen rbeezer vbraun

This is an active area of research, closely connected to
 * Graph Theory
 * Matroids
 * Linear Algebra

I'm putting this in combinatorics, but I'm not sure where it belongs.


---

Comment by kcrisman created at 2013-06-24 20:21:40

Ping just because Trac doesn't send auto-updates when people attach things for some reason... Thanks, David!  Just think how long it will be once there are doctests ;-)


---

Comment by dperkinson created at 2013-07-06 20:58:44

Something to get the ball rolling ...


---

Attachment

here is a patch, build from the proposed file

it need a lot of work, first to put coverage to 100% and make all tests pass..

for the moment, the coverage is

SCORE sage/geometry/hyperplane_arrangement.py: 61.6% (45 of 73)

and already 16 tests are failing


---

Comment by chapoton created at 2013-07-12 09:03:59

here is better patch, passing all tests.


---

Attachment


---

Comment by chapoton created at 2013-07-18 12:02:36

new patch, with coverage reaching 66% and tests passing


---

Comment by dperkinson created at 2013-07-30 06:21:12

Changing status from new to needs_review.


---

Comment by dperkinson created at 2013-07-30 06:25:53

A screenshot.


---

Attachment

which patch has to be applied ?


---

Comment by dperkinson created at 2013-08-01 07:15:50

trac_14789_hyp_arrangement_7_29_13.patch is the only patch that should to be applied.​


---

Comment by chapoton created at 2013-08-01 07:23:34

for the bot:

apply trac_14789_hyp_arrangement_7_29_13.patch


---

Comment by dimpase created at 2013-08-01 17:52:30

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2013-08-01 17:52:30

something is wrong with the hg patch, it's almost empty.


---

Comment by dperkinson created at 2013-08-02 00:11:28

I made a mistake when creating trac_14789_hyp_arrangement_7_29_13.patch (by not using hg add correctly).  I have fixed the problem and replaced ​trac_14789_hyp_arrangement_7_29_13.patch, using the same name.  I applied the patch to a fresh clone, just to make sure, and it is seems fine now.


---

Comment by dperkinson created at 2013-08-02 00:30:26

Changing status from needs_work to needs_review.


---

Attachment

First complete version candidate; passes all tests, 100% coverage


---

Comment by vbraun created at 2013-08-02 03:12:13

Very nice! I like the functionality but have a couple of suggestions to integrate it with the rest of Sage.

There is a lot of needless copy/deepcopy-ing. Most objects in Sage are immutable and don't need to be copied ever, you can just use/return the existing object. E.g. polyhedra are immutable. You should figure out whether you want your objects to be immutable, too. I suggest you make everything immutable, it is generally a big source of errors to make caching work with mutable stuff.

Caching can be done with the ``@`cached_method` decorator, this is much easier to understand/maintain than a `__getattr__` hack.

Please no version number for individual files, Sage already has a version number.

Instead of `__repr__`, you should implement `_repr_`, see http://www.sagemath.org/doc/developer/coding_in_python.html#special-sage-functions

I think its confusing to have a `Hyperplane` in the global namespace that is not a `Polyhedron`. How about you replace it essentially with the arrangement consisting of a single-hyperplane. So instead of a special `add_hyperplane`, just use union:

```
    A = HyperplaneArrangement([[1,0,0],[0,1,1],[0,1,-1],[1,-1,0],[1,1,0]]) 
    B = A.union(HyperplaneArrangement([[1,1,1]]) 
    B = A.union([[1,1,1]])    # syntactic sugar for adding list of hyperplanes
    B = A.union([1,1,1])      # syntactic sugar for adding single hyperplane
    B = A & [1,1,1]           # operator notation
```

and pick an operator to overload (probably either plus or ampersand) as an alias for union.

The HyperplaneArrangement should be a Parent and individual hyperplanes its elements. Roughly:

```
class Hyperplane(AffineSubspace, Element):

    def __init__(self, parent, ...):
        Element.__init__(self, parent=parent) 

class HyperplaneArrangement(Parent):
    
    Element = Hyperplane

    def __init__(self, ...):
        Parent.__init__(self, base=base_ring, category=Sets())
```

and always use `hyperplane_arrangement.element_class()` instead of the plain `Hyperplane` class. This automatically gives you a `base_ring()` method (Sage generally uses `base_ring` instead of `base_field` even if it is only implemented for fields).


---

Comment by chapoton created at 2013-08-02 09:18:38

for the bot:

apply only trac_14789_hyp_arrangement_7_29_13.patch​


---

Comment by dperkinson created at 2013-08-02 14:29:54

Thanks very much for these thoughtful comments!  I will get to work on them (although I am on hiatus for a week+ to attend a conference).


---

Comment by vbraun created at 2013-08-02 14:39:43

Sure, I'm at a conference right now ;-) Implementing the Parent / Element thing the first time is relatively difficult, don't hesitate to ask if you run into any problems.


---

Comment by darij created at 2013-08-03 13:52:22

This is a wonderful addition to Sage. Just a couple comments (not a review, not even close):

- There needs to be a way to call the empty hyperplane arrangement; this should not happen:


```
sage:  b = HyperplaneArrangement([])
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-5-df3005fcbc9c> in <module>()
----> 1 b = HyperplaneArrangement([])

/home/darij/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in __init__(self, A, K, check_for_duplicates)
   1398             self._hyperplanes = [Hyperplane(h,K) for h in eqns]
   1399         self._base_field = K
-> 1400         self._dim = len(eqns[0])-1 # we trust the user on this point
   1401         self._ambient_space = VectorSpace(K,self._dim)
   1402 

IndexError: list index out of range
sage: 
```


- The reference [RS] is available online ( http://math.mit.edu/~rstan/arrangements/arr.html ), and you should also correct its title (it's "An Introduction to Hyperplane Arrangements").

- "The default base field is QQ": when you write something like that in a docstring, there is no reason not to put the QQ in double-backticks (``QQ``).

- "A hyperplane arrangement is *essential* is the normals to its hyperplane span " the "is" should be an "if".

- "    Class for an affine space (a translation of a linear subspace). " You want to say "affine subspace", not "affine space"!

- Not sure if this is a good thing:


```
sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
sage: a == b
True
sage: a.sign_vector((2, -2))
[-1, 1]
sage: b.sign_vector((2, -2))
[1, -1]
```


This, of course, is hard to avert unless you either make equality much more restrictive or use hyperplane arrangements that are lists, rather than sets, of hyperplanes. The latter might in fact be more useful in the long run -- e. g., what if I need to keep track of what happens to each hyperplane when I am changing base field, and I cannot assume that the hyperplanes keep their indices in the `.hyperplanes()` list because some hyperplanes might collapse on base change? I assume restriction to a hyperplane would lead to the same problem.

- Double "is" in "A *face* is is the".

- The [GZ] reference, like any other Transactions paper, is online: http://www.ams.org/journals/tran/1983-280-01/S0002-9947-1983-0712251-1/

- In the definitions of the Catalan and braid arrangements (in their respective docstrings), replace i \leq j by i < j.


---

Comment by dimpase created at 2013-08-04 06:55:45

Replying to [comment:17 darij]:
[...]
> - Not sure if this is a good thing:
> 
> {{{
> sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> sage: a == b
> True
[...]

to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.

Until this is sorted out, I'd rather think of disabling `==` all together.


---

Comment by dperkinson created at 2013-08-04 18:14:51

A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So "==" perfectly clear and useful as it is.

The issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).

Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?

Thanks very much for you comments.


Replying to [comment:18 dimpase]:
> Replying to [comment:17 darij]:
> [...]
> > - Not sure if this is a good thing:
> > 
> > {{{
> > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> > sage: a == b
> > True
> [...]
> 
> to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
> Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.
> 
> Until this is sorted out, I'd rather think of disabling `==` all together.


---

Comment by dperkinson created at 2013-08-04 18:31:48

Sorry.  I meant to write: "Two hyperplane arrangements are equal if their sets of hyperplanes are equal.  So "==" is perfectly clear and useful as it is."  I am traveling at the moment and a bit distracted. 

Replying to [comment:19 dperkinson]:
> A hyperplane arrangement is a *set* of hyperplanes.  Two hyperplane arrangements are equal if their set of hyperplanes are equal.  So "==" perfectly clear and useful as it is.
> 
> The issue of isomorphism is separable and it would be nice to implement this.  There can be an isomorphism that arises from an affine change of coordinates of the ambient space, and there can be a combinatorial isomorphism, meaning an isomorphism of intersection posets (e.g., an arrangement and its essentialization).
> 
> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?
> 
> Thanks very much for you comments.
> 
> 
> Replying to [comment:18 dimpase]:
> > Replying to [comment:17 darij]:
> > [...]
> > > - Not sure if this is a good thing:
> > > 
> > > {{{
> > > sage:  a = HyperplaneArrangement([[2,4,6],[1,0,1]])
> > > sage:  b = HyperplaneArrangement([[1,0,1],[2,4,6]])
> > > sage: a == b
> > > True
> > [...]
> > 
> > to me, this is an indication of an issue that has to be carefully sorted out: namely, a notion of equality vs isomorphism.
> > Especially as one might think about creating arrangements from other data, e.g. often in my work I see arrangements obtained from a set of points by taking all the possible hyperplanes on them.
> > 
> > Until this is sorted out, I'd rather think of disabling `==` all together.


---

Comment by dimpase created at 2013-08-04 20:46:32

Replying to [comment:19 dperkinson]:
> A hyperplane arrangement is a *set* of hyperplanes.
This needs to be said in the docs then. Indeed, currently one sees:

``` 
String Form:<class 'sage.geometry.hyperplane_arrangement.HyperplaneArrangement'>
File:       /usr/local/src/sage/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.py
Docstring:
   The argument "A" is normally a list of hyperplanes or a list of
   lists representing hyperplanes...
```


 
> Could you be more precise about the other type of data that should determine a hyperplane arrangement?  The input would be a set of points.  From this set, how does one create a hyperplane arrangement?

Just take all the hyperplanes one obtains as affine spans of d-subsets of these points in d-dimensional space.

I have also seen papers talking about the arrangement associated with a triangulation (there one takes  the facets of the
simplices in the triangulation as hyperplanes).


---

Comment by vbraun created at 2013-08-04 21:28:30

I think it would be admissible for `==` to return `True` even if the hypersurface equations differ by an overall factor. But it might still be a good idea to pick some convention where the hypersurface equation is unique, e.g. scaling the first non-zero coordinate (or maybe largest absolute value) to one. This would also speed up comparison.

On the other hand, `==` should **not** check whether two arrangements are isomorphic by a GL rotation, or combinatorially, or any other version of a not necessarily unique isomorphism.


---

Comment by jhpalmieri created at 2013-08-05 01:22:06

I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?


---

Comment by ncohen created at 2013-08-06 08:29:49

(Could you add the new file to the reference manual ?)


---

Comment by kcrisman created at 2013-08-18 00:35:06

Just as an FYI (not necessarily needed to implement this now!) we now have matroids in Sage at #7477.  So an enhancement request could be to have an arrangement return its associated matroid - and, for that matter, vice versa, if I understand correctly that matroids may be interpreted thus under some circumstances (but not related to the matroid of a central arrangement).  Anyway, whatever is right, we might want to do it someday.


---

Comment by kcrisman created at 2013-08-18 00:42:49

> I think the original comment was that it is a little odd that you can have `a==b` return True while `a.sign_vector((2, -2))` returns something different from `b.sign_vector((2, -2))`. If they are really sets of hyperplanes, then the order in which those hyperplanes are specified should have no impact. So are they sets, or are they lists?
+1 to the question

However, in this case maybe (maybe) it's okay.  Because the question is about "which side of the hyperplane the point is on" and that of course requires an orientation to each hyperplane, given by the equation, and naturally this list will depend on the order.  However, the documentation probably should include this example to point out that it definitely depends on the order you give the hyperplanes in, just in case some unsuspecting user might think otherwise.  A sign set probably wouldn't be of very much use.

By the way, I assume that we don't get

```
a is b
True
```

which I think _would_ be a bug.


---

Comment by dimpase created at 2013-08-30 16:20:16

wrong plot


---

Attachment

There is something strange happening with plotting the following 

```
HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
```

See the attached plot. Some lines are cut short...


---

Comment by dperkinson created at 2013-08-30 16:36:44

Please try:

sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
sage: a.show(ranges=5)

For finer control of the ranges, please see the "ranges" option for a.plot and a.show.  Try a.plot? or a.show? .  Perhaps we could think about computing the "optimal" ranges for an arbitrary arrangement.


Replying to [comment:28 dimpase]:
> There is something strange happening with plotting the following 
> {{{
> HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> }}}
> See the attached plot. Some lines are cut short...


---

Comment by dimpase created at 2013-08-31 14:42:18

Replying to [comment:29 dperkinson]:
> Please try:
> 
> sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> sage: a.show(ranges=5)

the layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.


---

Comment by dperkinson created at 2013-08-31 15:32:22

Yes.  Each hyperplane is parametrized.  The "ranges" option allows the plotting parameters to be adjusted individually, e.g.,

sage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])

Perhaps there is a way to make the parameters all large, then constrict the bounding box.

Replying to [comment:30 dimpase]:
> Replying to [comment:29 dperkinson]:
> > Please try:
> > 
> > sage: a = HyperplaneArrangement([[1, 2, 5], [1, -2, -3], [3, -1, 1], [0, 1, 1], [2, -3, 3], [2, 1, -1]])
> > sage: a.show(ranges=5)
> 
> the layout is still weird, as I'd expect a box to be selected  and each line extending to the boundaries of the box. Currently it seems that each line has its own box, and they don't play together well.
> 
>


---

Comment by dimpase created at 2013-09-06 06:16:30

Replying to [comment:31 dperkinson]:
> Yes.  Each hyperplane is parametrized.  The "ranges" option allows the plotting parameters to be adjusted individually, e.g.,
> 
> `sage: a.show(ranges=[[-10,6],[-3,10],[-3,3],[-6,6],[-6,6],[-5,5]])`
> 
> Perhaps there is a way to make the parameters all large, then constrict the bounding box.


Inspect the current layout, hyperplane by hyperplane, and find the box by computing maxima and minima of coordinates.
Then adjust each hyperplane  to fit in the box.

Well, I'm not saying this must happen on this ticket, but please open a followup ticket to address this.


---

Comment by dimpase created at 2013-09-11 05:54:41

This looks like a bug in `num_regions()`:
(stumbled upon this example in  a large set of 2d arrangements)

```
sage: a=HyperplaneArrangement([[1, 106, 106266],[83, 101, 157866],[111, 110, 186150], [453, 221, 532686], [407, 237, 516882],
 [55, 32, 75620], [221, 114, 289346], [452, 115, 474217], [406, 131, 453521], [28, 9, 32446], [287, 19, 271774], [241, 35, 244022],
 [231, 1, 210984], [185, 17, 181508], [23, -8, 16609]])
sage: a.num_regions()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-3-cf364604935f> in <module>()
----> 1 a.num_regions()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in num_regions(self)
   2283         if self.base_field().characteristic() != 0:
   2284             raise TypeError('base field must have characteristic zero')
-> 2285         return (-1)**self._dim*self.characteristic_polynomial(-1)
   2286 
   2287     def num_hyperplanes(self):

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in characteristic_polynomial(self, a)
   2190             return self._characteristic_polynomial
   2191         else:
-> 2192             return self._characteristic_polynomial.subs(x=a)
   2193 
   2194     def poincare_polynomial(self, a=None):

[...]

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in restriction(self, H)
   3003         for T in new_hyperplanes:
   3004             basis = T.linear_part().matrix()
-> 3005             p = H._isomorphism_with_Kn(T.point())
   3006             if basis.nrows() == 0:
   3007                 eqn = [1] + list(p)

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement.pyc in _isomorphism_with_Kn(self, v)
    813             q = q.apply_map(lambda x: QQ(round(RR(x),2)))
    814             u = q*G  # u is the approximately orthonormalized W
--> 815             return u.solve_left(v-self.point())
    816         else: # finite field
    817             p = self.point()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_left (sage/matrix/matrix2.c:4386)()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.solve_right (sage/matrix/matrix2.c:5242)()

/home/dima/sage/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix._solve_right_general (sage/matrix/matrix2.c:6182)()

ValueError: matrix equation has no solutions
sage: 

```



---

Comment by dimpase created at 2013-09-11 05:54:41

Changing status from needs_review to needs_info.


---

Comment by vbraun created at 2013-10-10 22:14:22

I'm still not particularly happy with the syntax. Especially handing around tuples isn't really that userfriendly. I would propose the following:

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
```

as shortcut for

```
sage: H = HyperplaneArrangements(QQ, names='x, y, z')
sage: H.inject_variables()
```

and then construct hyperplanes as 

```
sage: hyperplane = x + 2*y + 3*z - 4
```

and hyperplane arrangements as 

```
sage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)
sage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional
True
```

If nobody objects then I'll work on that since I kind of need hyperplane arrangements now...


---

Comment by dperkinson created at 2013-10-10 22:57:39

The syntax you suggest is very nice for very small examples.  Using tuples is convenient for larger or for computer-generated examples.  (It's similar to the syntax for polyhedra in Sage, of course.)  So I would support your suggestion as long as it does not interfere with using tuples.

Thanks!


---

Comment by vbraun created at 2013-10-11 10:29:03

Yes, agree. That would be natural using conversion syntax:

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H([4, 1, 2, 3])
x + 2*y + 3*z + 4
```


On a related note, I think the constant should be first for consistency with polyhedra:

```
sage: Polyhedron(ieqs=[(4,1,2,3)]).Hrepresentation()
(An inequality (1, 2, 3) x + 4 >= 0,)
```



---

Comment by nbruin created at 2013-10-11 17:16:44

Replying to [comment:34 vbraun]:
> {{{
> sage: arrangement = (x + 2*y + 3*z - 4) and (y - 7) and (x + z)
> sage: arrangement == x + 2*y + 3*z - 4 and y - 7 and x + z     # brackets are optional
> True
> }}}
> If nobody objects then I'll work on that since I kind of need hyperplane arrangements now...

Don't use "and". It explicitly has shortcutting behaviour specified on it:

```
sage: 1 and 2
2
sage: a = 1; b = 2
sage: b if a else a #it's specified to do this
2
```

so departing from this behaviour would be very surprising.

The operator possibly available would be the "bitwise" `&`, but I doubt you want to repurpose it for union.? Being smart with overloading operators often comes back to bite you (see `%` for string formatting in python).

Also, since these are hyperplanes given by equations describing them, `and` could easily be interpreted as _intersection_. That's the most direct interpretation coming from the boolean meaning of the operator in sage.

Multiplication would come closer if you think about the arrangement as a union of hyperplanes. Do you keep multiplicities?

If you think of the hyperplane arrangement as a collection of hyperplanes, then they should probably be modelled as a set of hyperplanes, and python does not overload any binary operation to take unions of sets.


---

Comment by vbraun created at 2013-10-11 18:26:01

Good point, forgot about the short-circuiting. Of course one could override `__nonzero__` but I'd rather not if it can be avoided.

Multiplication has the wrong precedence, so thats out. Also, I don't think we should keep mulitplicities. 

Bit ops are probably best. How about bit-or = `|`:

```
sage: arrangement = x + 2*y + 3*z - 4 | y - 7 | x + z
```



---

Comment by nbruin created at 2013-10-12 20:58:20

Replying to [comment:38 vbraun]:

> Bit ops are probably best. How about bit-or = `|`:

Out of the binary ops available that's probably the one that makes most sense. I don't think overloading binops has much precedent in sage/python, though, so it looks a little odd to me. Given how non-compact this notation is anyway, do we really need a compact way of combining hyperplanes?

There's another small problem: vector spaces in sage do not have variable names. In principle, given a vector space, there is a well-defined set of all hyperplane arrangements in that space. If we insist on giving names to the standard basis of the dual vector space, there would be multiple (determined by the names) and the user would be forced to come up with names if he/she wants to construct the collection.

I agree that describing a hyperplane in n-space with a tuple of length n+1 feels a little uncomfortable: It should really be a vector in the dual space together with a scalar, i.e., a pair of an n-tuple and a scalar, which is awkward to work with by itself.

Would it be better to let (a,b,c,d) mean a*x+b*y+c*z+d=0 (note the sign on the constant)? That's a little more like standard homogenization.

Precedent in other software dealing with hyperplane arrangements might be instructive?


---

Comment by vbraun created at 2013-10-13 14:35:19

I'm working on making (d,a,b,c) mean a*x+b*y+c*z+d=0. So the sign is expected. And the order as well as the sign matches the notation used for polyhedra. If you want to avoid ambiguity then list/tuple plus scalar also define a hyperplane::

```
sage: H.<x,y> = HyperplaneArrangements(QQ)
sage: H(x, y, x+y-1)
Arrangement <y | x | x + y - 1>
sage: H([0,1,0], [0,0,1], [-1,1,1])
Arrangement <y | x | x + y - 1>
sage: H([(1,1),0], [(2,3),-1], [(4,5),3])
Arrangement <x + y | 2*x + 3*y - 1 | 4*x + 5*y + 3>
```



---

Comment by vbraun created at 2013-10-13 21:46:20

Changing status from needs_info to needs_work.


---

Comment by vbraun created at 2013-10-13 21:46:20

New commits:


---

Comment by vbraun created at 2013-10-13 21:46:20

Almost finished...  here is Dima's example:

```
    sage: H.<x,y> = HyperplaneArrangements(QQ)
    sage: h = H([(1, 106), 106266], [(83, 101), 157866], [(111, 110), 186150], [(453, 221), 532686], 
    ....:       [(407, 237), 516882], [(55, 32), 75620], [(221, 114), 289346], [(452, 115), 474217], 
    ....:       [(406, 131), 453521], [(28, 9), 32446], [(287, 19), 271774], [(241, 35), 244022],
    ....:       [(231, 1), 210984], [(185, 17), 181508], [(23, -8), 16609])
    sage: h.n_regions()
    85
```



---

Comment by dimpase created at 2013-10-13 22:15:18

Replying to [comment:42 vbraun]:
> Almost finished...  here is Dima's example:
> {{{
> ...
>     sage: h.n_regions()
>     85
> }}}
Has it magically got fixed? ;–)


---

Comment by vbraun created at 2013-10-14 09:38:06

Replying to [comment:43 dimpase]:

> Has it magically got fixed? ;–)

All sufficiently hard work is indistinguishable from magic ;-)

In case I haven't made it clear, the branch contains quite extensive modifications of the original patch.


---

Comment by git created at 2013-10-14 12:31:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-14 12:33:31

IMHO this is now finished. I'm happy to give positive review to everything that I haven't changed ;-)


---

Comment by vbraun created at 2013-10-14 12:33:31

Changing status from needs_work to needs_review.


---

Comment by git created at 2013-10-16 12:39:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-27 22:20:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-29 21:48:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-30 14:41:19

I've been using this ticket in #15328 and it works for me. If you want to review this ticket you can review up to 343ac2c, the further additions can easily be split into a separate ticket.


---

Comment by darij created at 2013-11-07 00:13:50

The thing I was beefing about with my `sign_vector` copypasta wasn't so much the handling of `==` (which would require us to fix the definition of a hyperplane arrangement in place more formally than mathematicians do), as the unpredictability of the output:

```
sage: h = H(x, y, x-1, y-1, y-1)
sage: h.sign_vector((2,-2))
(-1, -1, 1, 1)
sage: h.restriction(y).sign_vector((2,))
(-1, 1)
```

How do I tell (without lots of overhead) which entry of the vector corresponds to which line?

EDIT: Also there is a failing longtime doctest (failing because you forgot to provide the answer):

```
File "src/sage/geometry/hyperplane_arrangement/arrangement.py", line 1438, in sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.regions
Failed example:
    len(chessboard.bounded_regions())   # long time, 359 ms on a Core i7
Expected nothing
Got:
    64
```


EDIT2: Unfitting docstring:

```
    def unbounded_regions(self):
        r"""
        Return the relatively bounded regions of the arrangement.
```


EDIT3: It would be best to redefine `_an_element_` since it currently returns a hyperplane instead of a hyperplane arrangement:

```
sage: HyperplaneArrangements(QQ, ('x','y')).an_element()
Hyperplane x + 0*y + 0
```


EDIT4: Also, pyflakes report:

```
src/sage/geometry/hyperplane_arrangement/library.py:16: 'identity_matrix' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:21: 'expand' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:25: 'flatten' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:26: 'random' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:27: 'powerset' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:28: 'line' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:29: 'Color' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:30: 'Graphics' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:31: 'plot' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:31: 'parametric_plot' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:32: 'point' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:33: 'text' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:34: 'parametric_plot3d' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:35: 'text3d' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:36: 'lcm' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:37: 'GF' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:40: 'PolynomialRing' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:41: redefinition of unused 'QQ' from line 17
src/sage/geometry/hyperplane_arrangement/library.py:42: 'RR' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:43: 'SageObject' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:44: 'var' imported but unused
src/sage/geometry/hyperplane_arrangement/library.py:44: 'SR' imported but unused
src/sage/geometry/hyperplane_arrangement/affine_subspace.py:71: 'QQ' imported but unused
src/sage/geometry/hyperplane_arrangement/affine_subspace.py:72: 'matrix' imported but unused
src/sage/geometry/hyperplane_arrangement/arrangement.py:327: 'coerce_binop' imported but unused
src/sage/geometry/hyperplane_arrangement/arrangement.py:644: local variable 'AA' is assigned to but never used
src/sage/geometry/hyperplane_arrangement/arrangement.py:873: local variable 'n' is assigned to but never used
```



---

Comment by tscrim created at 2013-11-08 01:24:19

Here's the current version with my state of review. However there are two doctest failures. The first is that

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H(x) == 0
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.__cmp__[2]>", line 1, in <module>
        H(x) == Integer(0)
      File "element.pyx", line 914, in sage.structure.element.Element.__richcmp__ (sage/structure/element.c:8876)
      File "element.pyx", line 855, in sage.structure.element.Element._richcmp (sage/structure/element.c:8221)
      File "coerce.pyx", line 921, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:8568)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)
      File "/home/travis/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py", line 2124, in _element_constructor_
        raise ValueError('linear expression must be non-constant to define a hyperplane')
    ValueError: linear expression must be non-constant to define a hyperplane
```

so it seems like it's trying to coerce 0 into `H`, but that is failing. The second is that 0-dimensional hyperplane arrangements don't have an `_an_element_()`. If we can't create 0-dim hyperplane arrangements, then we shouldn't allow things like `HyperplaneArrangements(QQ)`.

I've taken care of the pyflakes report and the long doctest failure.
----
Last 10 new commits:


---

Comment by tscrim created at 2013-11-09 00:11:09

Changing keywords from "" to "days54".


---

Comment by vbraun created at 2013-12-23 14:17:23

What is 

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: H(0)
```

supposed to return? You could either argue the empty arrangement (neutral element in the additive semigroup) or the entire space defined by the degenerate "hyperplane" 0=0. I really don't want to allow that kind of degenerate hyperplanes. So that leaves us with the former, but I still find `H(0)` confusing and, by extension, `H(x) == 0`. 

There is no easy way to find out which ambient hyperplane went where in `restriction()`, in particular it involves choices:

```
sage: H.<x,y> = HyperplaneArrangements(QQ)
sage: H(x-y, x+y, x).restriction(x)
Arrangement <y>
```

So its alwasy going to be convoluted. If you need to know the sign vector of a point in terms of the ambient space arrangement then just compute the sign vector there.

I can fix up the 0-dimensional and empty arrangement case...


---

Comment by vbraun created at 2013-12-23 14:39:30

Ok since `H()` is equivalent to `H(0)` we'll have to go with it...


---

Comment by git created at 2013-12-23 14:49:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2013-12-23 17:21:21

Replying to [comment:56 vbraun]:
> Ok since `H()` is equivalent to `H(0)` we'll have to go with it... 

This is #8648.

Currently this works

```
sage: H.<x,y,z> = HyperplaneArrangements(QQ)
sage: 0*x
Hyperplane 0*x + 0*y + 0*z + 0
sage: H(0*x)
Empty hyperplane arrangement of dimension 3
```

but this doesn't:

```
sage: H(0*x, 0*x)
ValueError: linear expression must be non-constant to define a hyperplane
```

I think the best course of action is to make this consistent by stripping out the degenerate hyperplanes. Alternatively we could treat the special case of a non-hyperplane `0` as referring to the empty arrangement as a workaround for #8648 and the equality test. Your thoughts?


---

Comment by git created at 2013-12-24 20:58:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-12-24 21:02:13

Agree, I disallowed `H(0*x)` in the new commit.


---

Comment by tscrim created at 2013-12-24 23:13:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-12-24 23:13:38

Looks good. Thanks.


---

Comment by vbraun created at 2013-12-26 14:50:15

Resolution: fixed


---

Comment by saliola created at 2014-01-25 18:48:55

Hello. I'm playing around with this branch now and I have a few questions.

Perhaps the first question should be: since this is marked as "closed", should I ask my questions elsewhere?


---

Comment by vbraun created at 2014-01-25 23:35:53

yes, this is merged. Open a new ticket for defects/enhancements or ask general questions on sage-devel.


---

Comment by kcrisman created at 2015-04-07 13:11:46

See #18133 for Orlik-Solomon algebra.
