# Issue 28284: Bug of cartesian_product_iterator in Python3

Issue created by migration from https://trac.sagemath.org/ticket/28521

Original creator: SimonKing

Original creation time: 2019-09-20 07:29:59

Keywords: cartesian_product_iterator

In Sage-with-py3:

```
sage: list(cartesian_product_iterator([[],[1]]))
---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)
/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py in _xmrange_iter(iter_list, typ)
    138     curr_iters = [iter(i) for i in iter_list]
--> 139     curr_elt = [next(i) for i in curr_iters[:-1]] + [None]
    140     place = len(iter_list) - 1

/home/king/Sage/git/py3/local/lib/python3.7/site-packages/sage/misc/mrange.py in <listcomp>(.0)
    138     curr_iters = [iter(i) for i in iter_list]
--> 139     curr_elt = [next(i) for i in curr_iters[:-1]] + [None]
    140     place = len(iter_list) - 1

StopIteration: 

The above exception was the direct cause of the following exception:

RuntimeError                              Traceback (most recent call last)
<ipython-input-10-4d60fd891cf3> in <module>()
----> 1 list(cartesian_product_iterator([[],[Integer(1)]]))

RuntimeError: generator raised StopIteration
```

When the second instead of the first of the two lists is empty, things work:

```
sage: list(cartesian_product_iterator([[1],[]]))
[]
```


In Sage-with-py2, things work as well:

```
sage: list(cartesian_product_iterator([[],[1]]))
[]
```




---

Comment by dcoudert created at 2019-09-22 10:02:31

A simple fix. I don't know if there is a smatter way.
----
New commits:


---

Comment by dcoudert created at 2019-09-22 10:02:31

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2019-09-22 18:04:36

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-10-05 07:57:39

Resolution: fixed
