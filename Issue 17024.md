# Issue 17024: Coercions from the modular group to the Theta subgroup

archive/issues_017024.json:
```json
{
    "body": "CC:  snark mraum @videlec\n\nKeywords: hecke triangle group coercion\n\nThis ticket adds support for coercions from form spaces/rings over the full\nmodular group to form spaces/rings over the Theta subgroup (which are both\nHecke triangle groups). In all other cases coercions between groups are disabled\nsince there is no \"nice\" common subgroup.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17261\n\n",
    "created_at": "2014-10-30T13:37:01Z",
    "labels": [
        "component: modular forms",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Coercions from the modular group to the Theta subgroup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17024",
    "user": "https://github.com/jjermann"
}
```
CC:  snark mraum @videlec

Keywords: hecke triangle group coercion

This ticket adds support for coercions from form spaces/rings over the full
modular group to form spaces/rings over the Theta subgroup (which are both
Hecke triangle groups). In all other cases coercions between groups are disabled
since there is no "nice" common subgroup.


Issue created by migration from https://trac.sagemath.org/ticket/17261





---

archive/issue_comments_226045.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-30T16:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226045",
    "user": "https://github.com/jjermann"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-25T21:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-22T17:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226048.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-12T07:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226048",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226049.json:
```json
{
    "body": "Hmmmm... it doesn't seem to compile here... perhaps because I already compiled parts of sage from develop, while the branch is based off 6.6.beta1.\n\nCould you rebase it?",
    "created_at": "2015-03-12T07:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226049",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Hmmmm... it doesn't seem to compile here... perhaps because I already compiled parts of sage from develop, while the branch is based off 6.6.beta1.

Could you rebase it?



---

archive/issue_comments_226050.json:
```json
{
    "body": "Hi\n\nHmm, running \"make clean; make doc-clean; make\" worked for me.\nI'm a bit hesitant to rebase since I have a lot of work based on this branch.\nIs it 100% save to rebase? What would be the exact command?\nHow would I propagate this change to the other dependent branches?\n\nI could merge 6.6.beta3 instead?\n\nBest\nJonas",
    "created_at": "2015-03-12T18:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226050",
    "user": "https://github.com/jjermann"
}
```

Hi

Hmm, running "make clean; make doc-clean; make" worked for me.
I'm a bit hesitant to rebase since I have a lot of work based on this branch.
Is it 100% save to rebase? What would be the exact command?
How would I propagate this change to the other dependent branches?

I could merge 6.6.beta3 instead?

Best
Jonas



---

archive/issue_comments_226051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-12T19:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226052.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-12T19:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226052",
    "user": "https://github.com/jjermann"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226053.json:
```json
{
    "body": "Yes, of course cleaning and rebuilding would have done the trick, but the point is that you want a review so it gets into sage... so the code should be at least a little synchronized with the current state of sage.\n\nConcerning the question of whether to \"git rebase 6.6.beta3\" or \"git merge 6.6.beta3\", and what happens to other branches... I don't know exactly ; I think rebasing is better, but you might want to check if the sage developer manual has something about it (I think there's some kind of git crash-course within).",
    "created_at": "2015-03-12T20:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226053",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Yes, of course cleaning and rebuilding would have done the trick, but the point is that you want a review so it gets into sage... so the code should be at least a little synchronized with the current state of sage.

Concerning the question of whether to "git rebase 6.6.beta3" or "git merge 6.6.beta3", and what happens to other branches... I don't know exactly ; I think rebasing is better, but you might want to check if the sage developer manual has something about it (I think there's some kind of git crash-course within).



---

archive/issue_comments_226054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-12T22:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_226055.json:
```json
{
    "body": "I rebased on 6.6.beta3.",
    "created_at": "2015-03-12T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226055",
    "user": "https://github.com/jjermann"
}
```

I rebased on 6.6.beta3.



---

archive/issue_comments_226056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-16T16:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226056",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_226057.json:
```json
{
    "body": "Rebased on 6.7.beta1",
    "created_at": "2015-04-16T16:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226057",
    "user": "https://github.com/jjermann"
}
```

Rebased on 6.7.beta1



---

archive/issue_comments_226058.json:
```json
{
    "body": "I have just corrected the doc formatting in the readme file.\n----\nNew commits:",
    "created_at": "2015-09-13T18:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226058",
    "user": "https://github.com/fchapoton"
}
```

I have just corrected the doc formatting in the readme file.
----
New commits:



---

archive/issue_comments_226059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-13T18:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226060.json:
```json
{
    "body": "Question: Can/should I rebase on develop?\n\nI saw there was already a merge commit, so maybe not.\nIn any case this seems like a simple change, can we put this to reviewed?",
    "created_at": "2015-09-14T14:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226060",
    "user": "https://github.com/jjermann"
}
```

Question: Can/should I rebase on develop?

I saw there was already a merge commit, so maybe not.
In any case this seems like a simple change, can we put this to reviewed?



---

archive/issue_comments_226061.json:
```json
{
    "body": "I have done the merge with the latest develop in my commits. Sorry if this forces you to update your sage to the latest beta.\n\nI **may** have time to do a review, but I am not an expert in the field.",
    "created_at": "2015-09-14T14:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226061",
    "user": "https://github.com/fchapoton"
}
```

I have done the merge with the latest develop in my commits. Sorry if this forces you to update your sage to the latest beta.

I **may** have time to do a review, but I am not an expert in the field.



---

archive/issue_comments_226062.json:
```json
{
    "body": "Replying to [comment:20 chapoton]:\n> I have done the merge with the latest develop in my commits. Sorry if this forces you to update your sage to the latest beta.\n> \n> I **may** have time to do a review, but I am not an expert in the field.\n\nIt should be straight-forward, it's just that someone has to review it before it gets applied...\n\nAs a summary:\n\nBefore there were no relations (coercions) between spaces over different groups but actually for certain groups (namly infinity and 3) there is a (canonical) relation. For this case I modified it such that it coerces elements accordingly.",
    "created_at": "2015-09-14T14:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226062",
    "user": "https://github.com/jjermann"
}
```

Replying to [comment:20 chapoton]:
> I have done the merge with the latest develop in my commits. Sorry if this forces you to update your sage to the latest beta.
> 
> I **may** have time to do a review, but I am not an expert in the field.

It should be straight-forward, it's just that someone has to review it before it gets applied...

As a summary:

Before there were no relations (coercions) between spaces over different groups but actually for certain groups (namly infinity and 3) there is a (canonical) relation. For this case I modified it such that it coerces elements accordingly.



---

archive/issue_comments_226063.json:
```json
{
    "body": "Comparison to None should use \"group is None\" \ninstead of\n\n```\nif group == None\n```\n\ncurrently used in src/sage/modular/modform_hecketriangle/functors.py",
    "created_at": "2015-09-15T10:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226063",
    "user": "https://github.com/fchapoton"
}
```

Comparison to None should use "group is None" 
instead of

```
if group == None
```

currently used in src/sage/modular/modform_hecketriangle/functors.py



---

archive/issue_comments_226064.json:
```json
{
    "body": "Replying to [comment:22 chapoton]:\n> Comparison to None should use \"group is None\" \n> instead of\n> {{{\n> if group == None\n> }}}\n> currently used in src/sage/modular/modform_hecketriangle/functors.py\n\nDoes it mean the rest is ok/reviewed?",
    "created_at": "2015-09-15T19:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226064",
    "user": "https://github.com/jjermann"
}
```

Replying to [comment:22 chapoton]:
> Comparison to None should use "group is None" 
> instead of
> {{{
> if group == None
> }}}
> currently used in src/sage/modular/modform_hecketriangle/functors.py

Does it mean the rest is ok/reviewed?



---

archive/issue_comments_226065.json:
```json
{
    "body": "No, I just have not yet looked at the rest..",
    "created_at": "2015-09-15T20:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226065",
    "user": "https://github.com/fchapoton"
}
```

No, I just have not yet looked at the rest..



---

archive/issue_comments_226066.json:
```json
{
    "body": "Can you have a look at it? I am waiting for a review since a very very long time...",
    "created_at": "2015-09-22T15:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226066",
    "user": "https://github.com/jjermann"
}
```

Can you have a look at it? I am waiting for a review since a very very long time...



---

archive/issue_comments_226067.json:
```json
{
    "body": "In this kind of thing (appearing at least twice in your code):\n\n```\n+                num1   = el_f.numerator().subs(   x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).numerator()\n+                num2   = el_f.denominator().subs( x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).denominator()\n+                denom1 = el_f.denominator().subs( x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).numerator()\n+                denom2 = el_f.numerator().subs(   x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).denominator()\n```\n\nit is possible to substitute only twice. Please do so.\n\nCould you also please remove the following imports (if possible):\n\n```\nsrc/sage/modular/modform_hecketriangle/abstract_ring.py:21: 'bernoulli' imported but unused\nsrc/sage/modular/modform_hecketriangle/abstract_ring.py:21: 'sigma' imported but unused\nsrc/sage/modular/modform_hecketriangle/abstract_ring.py:26: 'HeckeTriangleGroup' imported but unused\nsrc/sage/modular/modform_hecketriangle/abstract_ring.py:27: 'rational_type' imported but unused\n```\n\n\nAfter that, and once the bot has given a green light again, I will agree to set a positive review.",
    "created_at": "2015-10-15T07:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226067",
    "user": "https://github.com/fchapoton"
}
```

In this kind of thing (appearing at least twice in your code):

```
+                num1   = el_f.numerator().subs(   x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).numerator()
+                num2   = el_f.denominator().subs( x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).denominator()
+                denom1 = el_f.denominator().subs( x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).numerator()
+                denom2 = el_f.numerator().subs(   x=(y**2 + 3*x)/ZZ(4), y=(9*x*y - y**3)/ZZ(8), z=(3*z - y)/ZZ(2)).denominator()
```

it is possible to substitute only twice. Please do so.

Could you also please remove the following imports (if possible):

```
src/sage/modular/modform_hecketriangle/abstract_ring.py:21: 'bernoulli' imported but unused
src/sage/modular/modform_hecketriangle/abstract_ring.py:21: 'sigma' imported but unused
src/sage/modular/modform_hecketriangle/abstract_ring.py:26: 'HeckeTriangleGroup' imported but unused
src/sage/modular/modform_hecketriangle/abstract_ring.py:27: 'rational_type' imported but unused
```


After that, and once the bot has given a green light again, I will agree to set a positive review.



---

archive/issue_comments_226068.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-15T14:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226068",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226069.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-15T17:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226069",
    "user": "https://github.com/jjermann"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226070.json:
```json
{
    "body": "Corrected. I rebased the branch on develop.\n----\nNew commits:",
    "created_at": "2015-10-15T17:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226070",
    "user": "https://github.com/jjermann"
}
```

Corrected. I rebased the branch on develop.
----
New commits:



---

archive/issue_comments_226071.json:
```json
{
    "body": "The theta expansion is kind of an interesting side remark (maybe)...",
    "created_at": "2015-10-15T21:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226071",
    "user": "https://github.com/jjermann"
}
```

The theta expansion is kind of an interesting side remark (maybe)...



---

archive/issue_comments_226072.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-16T07:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226072",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226073.json:
```json
{
    "body": "Attachment [theta_expansion.diff](tarball://root/attachments/some-uuid/ticket17261/theta_expansion.diff) by @fchapoton created at 2015-10-16 07:38:26\n\nok, bot is happy, positive review.",
    "created_at": "2015-10-16T07:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226073",
    "user": "https://github.com/fchapoton"
}
```

Attachment [theta_expansion.diff](tarball://root/attachments/some-uuid/ticket17261/theta_expansion.diff) by @fchapoton created at 2015-10-16 07:38:26

ok, bot is happy, positive review.



---

archive/issue_comments_226074.json:
```json
{
    "body": "Thanks. :-)",
    "created_at": "2015-10-16T15:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226074",
    "user": "https://github.com/jjermann"
}
```

Thanks. :-)



---

archive/issue_events_016457.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-10-16T18:42:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17024#event-16457"
}
```



---

archive/issue_comments_226075.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-16T18:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17024#issuecomment-226075",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
