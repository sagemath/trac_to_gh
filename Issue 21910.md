# Issue 21910: pyport.h from python2.7 sometimes clashes with c++ functions on OS X

archive/issues_021910.json:
```json
{
    "body": "The recent upgrade to `pynac-0.7.3` brought a flurry of compiling problem on OS X with the following kind of message\n\n```\n  CXX      libpynac_la-sum.lo\nIn file included from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/basic_ios.h:37:0,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ios:44,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ostream:38,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/iostream:39,\n                 from class_info.h:31,\n                 from registrar.h:30,\n                 from basic.h:40,\n                 from numeric.h:49,\n                 from inifcns.h:26,\n                 from sum.cpp:13:\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/locale_facets.h:247:53: error: macro \"toupper\" passed 2 arguments, but takes just 1\n       toupper(char_type *__lo, const char_type* __hi) const\n```\n\nThis is caused by definition of macros for `toupper` and other functions in `pyport.h` specifically on OS X. This is unsafe with C++ and the issue has been known in MacPort for years: https://trac.macports.org/ticket/44288. \n\nWe should adopt their patch for python.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22147\n\n",
    "created_at": "2017-01-07T08:32:15Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "title": "pyport.h from python2.7 sometimes clashes with c++ functions on OS X",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21910",
    "user": "fbissey"
}
```
The recent upgrade to `pynac-0.7.3` brought a flurry of compiling problem on OS X with the following kind of message

```
  CXX      libpynac_la-sum.lo
In file included from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/basic_ios.h:37:0,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ios:44,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ostream:38,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/iostream:39,
                 from class_info.h:31,
                 from registrar.h:30,
                 from basic.h:40,
                 from numeric.h:49,
                 from inifcns.h:26,
                 from sum.cpp:13:
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/locale_facets.h:247:53: error: macro "toupper" passed 2 arguments, but takes just 1
       toupper(char_type *__lo, const char_type* __hi) const
```

This is caused by definition of macros for `toupper` and other functions in `pyport.h` specifically on OS X. This is unsafe with C++ and the issue has been known in MacPort for years: https://trac.macports.org/ticket/44288. 

We should adopt their patch for python.


Issue created by migration from https://trac.sagemath.org/ticket/22147





---

archive/issue_comments_304077.json:
```json
{
    "body": "Python3 should be checked over as well.\n----\nNew commits:",
    "created_at": "2017-01-07T08:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304077",
    "user": "fbissey"
}
```

Python3 should be checked over as well.
----
New commits:



---

archive/issue_comments_304078.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-07T08:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304078",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_304079.json:
```json
{
    "body": "I note that the upstream python issue http://bugs.python.org/issue10910 is marked closed while there was never really a good solution in my opinion.\nAnyone can do something about this issue? Can it be re-opened, or do we need a new one.",
    "created_at": "2017-01-07T08:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304079",
    "user": "fbissey"
}
```

I note that the upstream python issue http://bugs.python.org/issue10910 is marked closed while there was never really a good solution in my opinion.
Anyone can do something about this issue? Can it be re-opened, or do we need a new one.



---

archive/issue_comments_304080.json:
```json
{
    "body": "The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?",
    "created_at": "2017-01-07T09:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304080",
    "user": "jdemeyer"
}
```

The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?



---

archive/issue_comments_304081.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?\nDepends what's in `pyport.h`, I cannot see any commit being linked to issue 10910. I can have a look at #22037 which would then be a preferred option to this ticket, but I am running out of time.",
    "created_at": "2017-01-07T09:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304081",
    "user": "fbissey"
}
```

Replying to [comment:3 jdemeyer]:
> The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?
Depends what's in `pyport.h`, I cannot see any commit being linked to issue 10910. I can have a look at #22037 which would then be a preferred option to this ticket, but I am running out of time.



---

archive/issue_comments_304082.json:
```json
{
    "body": "I just checked the python 2.7.13 tarball and the fix is in. So yes #22037 will fix the issue.",
    "created_at": "2017-01-07T09:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304082",
    "user": "fbissey"
}
```

I just checked the python 2.7.13 tarball and the fix is in. So yes #22037 will fix the issue.



---

archive/issue_comments_304083.json:
```json
{
    "body": "I won't be able to deal with this since I'll be off for a week. I am ok for this ticket to be marked duplicate and #22037 to be marked blocker instead. I see it is needing review so I am guessing it is good to go.",
    "created_at": "2017-01-07T11:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304083",
    "user": "fbissey"
}
```

I won't be able to deal with this since I'll be off for a week. I am ok for this ticket to be marked duplicate and #22037 to be marked blocker instead. I see it is needing review so I am guessing it is good to go.



---

archive/issue_comments_304084.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-07T11:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304084",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304085.json:
```json
{
    "body": "Still don't understand why it works on the OSX buildbot, oh well...",
    "created_at": "2017-01-07T14:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304085",
    "user": "vbraun"
}
```

Still don't understand why it works on the OSX buildbot, oh well...



---

archive/issue_comments_304086.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T18:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21910#issuecomment-304086",
    "user": "vbraun"
}
```

Resolution: fixed
