# Issue 21910: pyport.h from python2.7 sometimes clashes with c++ functions on OS X

Issue created by migration from https://trac.sagemath.org/ticket/22147

Original creator: fbissey

Original creation time: 2017-01-07 08:32:15

The recent upgrade to `pynac-0.7.3` brought a flurry of compiling problem on OS X with the following kind of message

```
  CXX      libpynac_la-sum.lo
In file included from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/basic_ios.h:37:0,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ios:44,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/ostream:38,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/iostream:39,
                 from class_info.h:31,
                 from registrar.h:30,
                 from basic.h:40,
                 from numeric.h:49,
                 from inifcns.h:26,
                 from sum.cpp:13:
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.rc2/local/include/c++/5.4.0/bits/locale_facets.h:247:53: error: macro "toupper" passed 2 arguments, but takes just 1
       toupper(char_type *__lo, const char_type* __hi) const
```

This is caused by definition of macros for `toupper` and other functions in `pyport.h` specifically on OS X. This is unsafe with C++ and the issue has been known in MacPort for years: https://trac.macports.org/ticket/44288. 

We should adopt their patch for python.



---

Comment by fbissey created at 2017-01-07 08:45:10

Python3 should be checked over as well.
----
New commits:


---

Comment by fbissey created at 2017-01-07 08:45:10

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-01-07 08:56:32

I note that the upstream python issue http://bugs.python.org/issue10910 is marked closed while there was never really a good solution in my opinion.
Anyone can do something about this issue? Can it be re-opened, or do we need a new one.


---

Comment by jdemeyer created at 2017-01-07 09:00:55

The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?


---

Comment by fbissey created at 2017-01-07 09:04:39

Replying to [comment:3 jdemeyer]:
> The Python issue was fixed in Python 2.7.13, so could it be that #22037 also fixes the problem?
Depends what's in `pyport.h`, I cannot see any commit being linked to issue 10910. I can have a look at #22037 which would then be a preferred option to this ticket, but I am running out of time.


---

Comment by fbissey created at 2017-01-07 09:10:29

I just checked the python 2.7.13 tarball and the fix is in. So yes #22037 will fix the issue.


---

Comment by fbissey created at 2017-01-07 11:12:32

I won't be able to deal with this since I'll be off for a week. I am ok for this ticket to be marked duplicate and #22037 to be marked blocker instead. I see it is needing review so I am guessing it is good to go.


---

Comment by jdemeyer created at 2017-01-07 11:46:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-07 14:33:06

Still don't understand why it works on the OSX buildbot, oh well...


---

Comment by vbraun created at 2017-01-21 18:00:59

Resolution: fixed
