# Issue 32801: pari(2^64) crashes Sage

Issue created by migration from https://trac.sagemath.org/ticket/33038

Original creator: pbruin

Original creation time: 2021-12-17 14:28:38

CC:  @kliem vdelecroix

In SageMath 9.5.beta8:

```
sage: pari(2^64)
Traceback (most recent call last):
...
SignalError: Segmentation fault
```

Another attempt:

```
sage: pari(2^64)
1334420292954149376986524197863817216
python3: malloc.c:3252: __libc_malloc: Assertion `!victim || chunk_is_mmapped (mem2chunk (victim)) || ar_ptr == arena_for_chunk (mem2chunk (victim))' failed.
------------------------------------------------------------------------
/home/peter/src/sage/local/lib/python3.9/site-packages/cysignals/signals.cpython-39-x86_64-linux-gnu.so(+0x7dbb)[0x7f2f4da9ddbb]
/home/peter/src/sage/local/lib/python3.9/site-packages/cysignals/signals.cpython-39-x86_64-linux-gnu.so(+0x7e69)[0x7f2f4da9de69]
/home/peter/src/sage/local/lib/python3.9/site-packages/cysignals/signals.cpython-39-x86_64-linux-gnu.so(+0xac9d)[0x7f2f4daa0c9d]
/lib64/libpthread.so.0(+0x121d0)[0x7f2f51aa31d0]
/lib64/libc.so.6(gsignal+0x13e)[0x7f2f517c263e]
/lib64/libc.so.6(abort+0x112)[0x7f2f517ac536]
/lib64/libc.so.6(+0x81818)[0x7f2f5180b818]
/lib64/libc.so.6(__libc_malloc+0x237)[0x7f2f518101e7]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(PyThread_allocate_lock+0x16)[0x7f2f51cb4b06]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x20ac13)[0x7f2f51d08c13]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0xe3936)[0x7f2f51be1936]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x590f)[0x7f2f51b6a23f]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x659e9)[0x7f2f51b639e9]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x6478)[0x7f2f51b6ada8]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x659e9)[0x7f2f51b639e9]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x6478)[0x7f2f51b6ada8]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x659e9)[0x7f2f51b639e9]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0xab42c)[0x7f2f51ba942c]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x20a378)[0x7f2f51d08378]
/home/peter/src/sage/local/lib/libpython3.9.so.1.0(+0x1b67b7)[0x7f2f51cb47b7]
/lib64/libpthread.so.0(+0x7d4e)[0x7f2f51a98d4e]
/lib64/libc.so.6(clone+0x3f)[0x7f2f51881faf]
------------------------------------------------------------------------
Attaching gdb to process id 22853.
```

Note that the number printed before the crash is a multiple of 2<sup>64</sup>.


---

Comment by @DaveWitteMorris created at 2021-12-17 17:38:11

FWIW, I am not seeing this problem (with 9.5b8 on MacOS 11.5.2):

```
sage: pari(2^64)
18446744073709551616
sage: pari(2^64+1)
18446744073709551617
sage: pari(2^64+1)
18446744073709551617
```



---

Comment by @DaveWitteMorris created at 2021-12-18 07:19:47

Also no problem with 9.5b8 on Ubuntu 20.04 (CoCalc).


---

Comment by pbruin created at 2021-12-21 18:56:07

Indeed, this crash only happens on one of the two (Linux) machines I am using.

From the stack trace, it looks like it might be related to the fact that PARI is now configured to use `libpthread`; see #30537.  Also comment:98:ticket:30423 might be related.
