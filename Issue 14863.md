# Issue 14863: ipython unnecessarily relies on sage-location

archive/issues_014863.json:
```json
{
    "body": "CC:  jondo\n\nThe interpreter line exchange for ipython should be done within spkg-install. The hack cannot be removed from sage-location otherwise.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15100\n\n",
    "created_at": "2013-08-26T11:00:33Z",
    "labels": [
        "packages: standard",
        "minor",
        "enhancement"
    ],
    "title": "ipython unnecessarily relies on sage-location",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14863",
    "user": "felixs"
}
```
CC:  jondo

The interpreter line exchange for ipython should be done within spkg-install. The hack cannot be removed from sage-location otherwise.

Issue created by migration from https://trac.sagemath.org/ticket/15100





---

archive/issue_comments_189572.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-26T11:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189572",
    "user": "felixs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_189573.json:
```json
{
    "body": "The \"hack\" you mention has nothing at all to do with `ipython`. What `sage-location` does affects **every** Python script in `$SAGE_LOCAL/bin`, so I don't see what this patch is trying to accomplish.",
    "created_at": "2013-09-02T12:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189573",
    "user": "jdemeyer"
}
```

The "hack" you mention has nothing at all to do with `ipython`. What `sage-location` does affects **every** Python script in `$SAGE_LOCAL/bin`, so I don't see what this patch is trying to accomplish.



---

archive/issue_comments_189574.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-09-02T12:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189574",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189575.json:
```json
{
    "body": "I don't fully understand. In which way does `sage-location` have nothing to do with `ipython` if it rewrites the first line of `ipython`?\n\nWhat else needs to be done in your opinion?",
    "created_at": "2013-09-02T12:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189575",
    "user": "felixs"
}
```

I don't fully understand. In which way does `sage-location` have nothing to do with `ipython` if it rewrites the first line of `ipython`?

What else needs to be done in your opinion?



---

archive/issue_comments_189576.json:
```json
{
    "body": "Replying to [comment:5 felixs]:\n> I don't fully understand. In which way does `sage-location` have nothing to do with `ipython` if it rewrites the first line of `ipython`?\nIt has nothing to do with `ipython` because `$SAGE_LOCAL/bin/ipython` is only one of the many scripts which are rewritten by `sage-location`.\n\nPerhaps you should explain why the \"hack\" in `sage-location` should be removed.",
    "created_at": "2013-09-02T12:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189576",
    "user": "jdemeyer"
}
```

Replying to [comment:5 felixs]:
> I don't fully understand. In which way does `sage-location` have nothing to do with `ipython` if it rewrites the first line of `ipython`?
It has nothing to do with `ipython` because `$SAGE_LOCAL/bin/ipython` is only one of the many scripts which are rewritten by `sage-location`.

Perhaps you should explain why the "hack" in `sage-location` should be removed.



---

archive/issue_comments_189577.json:
```json
{
    "body": "Every hack should be removed. Expecially the ones that implement things that can be achieved easily without hacks.\n\nHacks are often misleading and complicate issues. Getting rid of them needs more work, but this ticket is meant to just handle this particular case, I came across.\n\nThe whole story is: a doctest checks the first line in `$SAGE_LOCAL/bin/ipython`. This doctest will certainly fail, if ipython has been disabled (toplevel build system, #14796). That's why #14796, depends on #15105 (unhardwire paths). In the `ipython` case, unhardwiring paths can be simply achieved by removing the doctest. With this ticket, there is no doubt about how the first line in `ipython` looks like (in case it came from sage) and the doctest is unnecessary.",
    "created_at": "2013-09-02T12:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189577",
    "user": "felixs"
}
```

Every hack should be removed. Expecially the ones that implement things that can be achieved easily without hacks.

Hacks are often misleading and complicate issues. Getting rid of them needs more work, but this ticket is meant to just handle this particular case, I came across.

The whole story is: a doctest checks the first line in `$SAGE_LOCAL/bin/ipython`. This doctest will certainly fail, if ipython has been disabled (toplevel build system, #14796). That's why #14796, depends on #15105 (unhardwire paths). In the `ipython` case, unhardwiring paths can be simply achieved by removing the doctest. With this ticket, there is no doubt about how the first line in `ipython` looks like (in case it came from sage) and the doctest is unnecessary.



---

archive/issue_comments_189578.json:
```json
{
    "body": "Replying to [comment:7 felixs]:\n> Every hack should be removed. Expecially the ones that implement things that can be achieved easily without hacks.\nFine, go ahead and implement `sage-location` without hacks...\n\nBy special-casing `ipython` you are achieving absolutely nothing: the \"hack\" in `sage-location` still exists and you're just fooling the doctest.",
    "created_at": "2013-09-02T12:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189578",
    "user": "jdemeyer"
}
```

Replying to [comment:7 felixs]:
> Every hack should be removed. Expecially the ones that implement things that can be achieved easily without hacks.
Fine, go ahead and implement `sage-location` without hacks...

By special-casing `ipython` you are achieving absolutely nothing: the "hack" in `sage-location` still exists and you're just fooling the doctest.



---

archive/issue_comments_189579.json:
```json
{
    "body": "Replying to [comment:7 felixs]:\n> The whole story is: a doctest checks the first line in `$SAGE_LOCAL/bin/ipython`.\nSure, but even this doctest has nothing to do with `ipython`. It is only meant to check that `sage-location` worked.",
    "created_at": "2013-09-02T13:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189579",
    "user": "jdemeyer"
}
```

Replying to [comment:7 felixs]:
> The whole story is: a doctest checks the first line in `$SAGE_LOCAL/bin/ipython`.
Sure, but even this doctest has nothing to do with `ipython`. It is only meant to check that `sage-location` worked.



---

archive/issue_comments_189580.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> Fine, go ahead and implement `sage-location` without hacks...\n\nThis is one part of it. Tickets must be achievable.\n\n> By special-casing `ipython` you are achieving absolutely nothing: the \"hack\" in `sage-location` still exists and you're just fooling the doctest.\n\nI have fooled a *bogus* doctest. That's fine with me. What else do you suggest?",
    "created_at": "2013-09-02T14:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189580",
    "user": "felixs"
}
```

Replying to [comment:8 jdemeyer]:
> Fine, go ahead and implement `sage-location` without hacks...

This is one part of it. Tickets must be achievable.

> By special-casing `ipython` you are achieving absolutely nothing: the "hack" in `sage-location` still exists and you're just fooling the doctest.

I have fooled a *bogus* doctest. That's fine with me. What else do you suggest?



---

archive/issue_comments_189581.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-03T10:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189581",
    "user": "felixs"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189582.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-09-04T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189582",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_189583.json:
```json
{
    "body": "I still don't understand the point of this ticket. I think you should better explain what the problem is and why your patch fixes that problem.",
    "created_at": "2013-09-04T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189583",
    "user": "jdemeyer"
}
```

I still don't understand the point of this ticket. I think you should better explain what the problem is and why your patch fixes that problem.



---

archive/issue_comments_189584.json:
```json
{
    "body": "`sage-location` is meant to rewrite hardwired paths that contain `$SAGE_OLD_ROOT`, which is a sort of workaround (or, in the unconditional case, just \"hack\"). `ipython` does not depend on `$SAGE_ROOT` and there is no point in requiring this mechanism. Moreover, if `spkg-install` is self-contained, somebody might be able to read it and deduce how `ipython` on sage is installed and intended to work.\n\n(I agree that there are worse issues, but this one is particularly easy to fix.)",
    "created_at": "2013-09-04T08:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189584",
    "user": "felixs"
}
```

`sage-location` is meant to rewrite hardwired paths that contain `$SAGE_OLD_ROOT`, which is a sort of workaround (or, in the unconditional case, just "hack"). `ipython` does not depend on `$SAGE_ROOT` and there is no point in requiring this mechanism. Moreover, if `spkg-install` is self-contained, somebody might be able to read it and deduce how `ipython` on sage is installed and intended to work.

(I agree that there are worse issues, but this one is particularly easy to fix.)



---

archive/issue_comments_189585.json:
```json
{
    "body": "> there is no point in requiring this mechanism\nDepends what you mean. The path-rewriting is needed to be able to relocate the Sage install tree.\n\nLet me repeat this: By special-casing `ipython` you are achieving absolutely nothing: the \"hack\" in `sage-location` still exists and you're just fooling the doctest.\n\nA proper fix for the \"hack\" would fix all Python scripts, not just this one. What's the point of this special case?",
    "created_at": "2013-09-04T12:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189585",
    "user": "jdemeyer"
}
```

> there is no point in requiring this mechanism
Depends what you mean. The path-rewriting is needed to be able to relocate the Sage install tree.

Let me repeat this: By special-casing `ipython` you are achieving absolutely nothing: the "hack" in `sage-location` still exists and you're just fooling the doctest.

A proper fix for the "hack" would fix all Python scripts, not just this one. What's the point of this special case?



---

archive/issue_comments_189586.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n> > there is no point in requiring this mechanism\n> Depends what you mean. The path-rewriting is needed to be able to relocate the Sage install tree.\n\nWhat i mean is, there is no point in requiring the mechanism for `ipython`. Most (maybe not all) cases are like this.\n\n> Let me repeat this: By special-casing `ipython` you are achieving absolutely nothing: the \"hack\" in `sage-location` still exists and you're just fooling the doctest.\n\nthere's a proper doctest in #15146, that does not rely on a wrong ipython installation.\n\n> A proper fix for the \"hack\" would fix all Python scripts, not just this one. \n\nYes.\n\n> What's the point of this special case?\n\nI cannot fix all at once. But before the line has been merged, I will certainly not paste it into the other `spkg-install` files.",
    "created_at": "2013-09-04T12:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189586",
    "user": "felixs"
}
```

Replying to [comment:14 jdemeyer]:
> > there is no point in requiring this mechanism
> Depends what you mean. The path-rewriting is needed to be able to relocate the Sage install tree.

What i mean is, there is no point in requiring the mechanism for `ipython`. Most (maybe not all) cases are like this.

> Let me repeat this: By special-casing `ipython` you are achieving absolutely nothing: the "hack" in `sage-location` still exists and you're just fooling the doctest.

there's a proper doctest in #15146, that does not rely on a wrong ipython installation.

> A proper fix for the "hack" would fix all Python scripts, not just this one. 

Yes.

> What's the point of this special case?

I cannot fix all at once. But before the line has been merged, I will certainly not paste it into the other `spkg-install` files.



---

archive/issue_comments_189587.json:
```json
{
    "body": "Replying to [comment:15 felixs]:\n> > What's the point of this special case?\n> I cannot fix all at once.\nYou just gave a very good argument for keeping the `sage-location` \"hack\": it **does** rewrite all the paths at once without trouble. What's wrong with that?\n\nI think you still need to explain what the problem is that this ticket is trying to fix, I really don't understand it.",
    "created_at": "2013-09-05T07:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189587",
    "user": "jdemeyer"
}
```

Replying to [comment:15 felixs]:
> > What's the point of this special case?
> I cannot fix all at once.
You just gave a very good argument for keeping the `sage-location` "hack": it **does** rewrite all the paths at once without trouble. What's wrong with that?

I think you still need to explain what the problem is that this ticket is trying to fix, I really don't understand it.



---

archive/issue_comments_189588.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Replying to [comment:15 felixs]:\n> > > What's the point of this special case?\n> > I cannot fix all at once.\n> You just gave a very good argument for keeping the `sage-location` \"hack\":\n\nNo, I'm trying to make Sage a sane place. Something like this takes time.\n\n> it **does** rewrite all the paths at once without trouble. What's wrong with that?\n\nIt doesn't do anything useful in *most* cases. If there were no doctest looking at ipython i wouldn't even have noticed. A hack should always be restricted to things that require it. This is pretty similar to the problem about static atlas libraries (#15045): Its always better to not break/complicate things for *all* users just because one CPU/platform is broken/limitied/buggy.\n\n> I think you still need to explain what the problem is that this ticket is trying to fix, I really don't understand it.\n\nHere we go, a more formal argument. read http://en.wikipedia.org/wiki/Encapsulation_(object-oriented_programming). There is a file that takes care of the contents of a package (`spkg-install`). Nothing beyond that is required. Other routines/programs that mess wich package contents, like `sage-location` does, violate encapsulation. Encapsulation, in general, is useful to keep things comprehensible and simple.",
    "created_at": "2013-09-05T08:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189588",
    "user": "felixs"
}
```

Replying to [comment:16 jdemeyer]:
> Replying to [comment:15 felixs]:
> > > What's the point of this special case?
> > I cannot fix all at once.
> You just gave a very good argument for keeping the `sage-location` "hack":

No, I'm trying to make Sage a sane place. Something like this takes time.

> it **does** rewrite all the paths at once without trouble. What's wrong with that?

It doesn't do anything useful in *most* cases. If there were no doctest looking at ipython i wouldn't even have noticed. A hack should always be restricted to things that require it. This is pretty similar to the problem about static atlas libraries (#15045): Its always better to not break/complicate things for *all* users just because one CPU/platform is broken/limitied/buggy.

> I think you still need to explain what the problem is that this ticket is trying to fix, I really don't understand it.

Here we go, a more formal argument. read http://en.wikipedia.org/wiki/Encapsulation_(object-oriented_programming). There is a file that takes care of the contents of a package (`spkg-install`). Nothing beyond that is required. Other routines/programs that mess wich package contents, like `sage-location` does, violate encapsulation. Encapsulation, in general, is useful to keep things comprehensible and simple.



---

archive/issue_comments_189589.json:
```json
{
    "body": "I think we can close this as duplicate (sort of) of #15146.",
    "created_at": "2015-03-13T10:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189589",
    "user": "jdemeyer"
}
```

I think we can close this as duplicate (sort of) of #15146.



---

archive/issue_comments_189590.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2015-03-13T10:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189590",
    "user": "jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_189591.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2015-03-17T18:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14863#issuecomment-189591",
    "user": "vbraun"
}
```

Resolution: duplicate
