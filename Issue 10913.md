# Issue 10913: Categories for posets

archive/issues_010913.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat niles novoselt vbraun\n\nThis patch creates categories for posets and lattices, refactors the\nposet code, and add new features. It is under finalization on the\nSage-Combinat server:\n\nhttp://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/categories-posets-nt.patch\n\nSee the header there for a current description.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10998\n\n",
    "created_at": "2011-03-23T16:05:57Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Categories for posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10913",
    "user": "nthiery"
}
```
Assignee: sage-combinat

CC:  sage-combinat niles novoselt vbraun

This patch creates categories for posets and lattices, refactors the
poset code, and add new features. It is under finalization on the
Sage-Combinat server:

http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/categories-posets-nt.patch

See the header there for a current description.

Issue created by migration from https://trac.sagemath.org/ticket/10998





---

archive/issue_comments_117128.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2011-03-23T16:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117128",
    "user": "nthiery"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_117129.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-28T14:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117129",
    "user": "nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_117130.json:
```json
{
    "body": "Fixed trivial non commutation with trac_10193-graded_enumerated_sets-nt.patch in the Sage-Combinat queue. In principle the patch should now apply on vanilla sage + listed dependencies.",
    "created_at": "2011-04-04T22:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117130",
    "user": "nthiery"
}
```

Fixed trivial non commutation with trac_10193-graded_enumerated_sets-nt.patch in the Sage-Combinat queue. In principle the patch should now apply on vanilla sage + listed dependencies.



---

archive/issue_comments_117131.json:
```json
{
    "body": "Salut Nicolas,\n\nI must say: there is a lot of code where I don't really understand what you do, and why you do it. E.g., which code is generic enough to put in categories and which is not, how are examples organized, how do you properly test the code, ...\n\nIn my (not yet final) review patch, I place some questions on implementations, some suggestions for additional methods, and I fixed several typos.\n\nBest, Christian",
    "created_at": "2011-04-05T14:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117131",
    "user": "stumpc5"
}
```

Salut Nicolas,

I must say: there is a lot of code where I don't really understand what you do, and why you do it. E.g., which code is generic enough to put in categories and which is not, how are examples organized, how do you properly test the code, ...

In my (not yet final) review patch, I place some questions on implementations, some suggestions for additional methods, and I fixed several typos.

Best, Christian



---

archive/issue_comments_117132.json:
```json
{
    "body": "Replying to [comment:7 stumpc5]:\n\n> I must say: there is a lot of code where I don't really understand\n> what you do, and why you do it.\n\nHmm, more specific questions (like the one below) would be useful to\nget a constructive discussion :-)\n\n> E.g., which code is generic enough to put in categories and which is\n> not,\n\nThe rule of thumb is: does the code use the data structure or not?\nFor example, a method like has_top uses the internal hasse diagram,\nand therefore remains in Poset. On the other hand a method like\njoin_irreducibles just requires that there is a method \"lower_covers\",\nand so can be implemented generically in the category.\n\nBut that's just a rule thumb; I left in Poset all the code that was on\nthe edge, so as to avoid moving too much code around.\n\n> how are examples organized, how do you properly test the code, ...\n\nAre those questions about the category framework in general, or about\nthis specific patch?\n\n> In my (not yet final) review patch, I place some questions on\n> implementations, some suggestions for additional methods, and I\n> fixed several typos.\n\nOk, thanks!\n\nCheers,\n                       Nicolas",
    "created_at": "2011-04-05T15:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117132",
    "user": "nthiery"
}
```

Replying to [comment:7 stumpc5]:

> I must say: there is a lot of code where I don't really understand
> what you do, and why you do it.

Hmm, more specific questions (like the one below) would be useful to
get a constructive discussion :-)

> E.g., which code is generic enough to put in categories and which is
> not,

The rule of thumb is: does the code use the data structure or not?
For example, a method like has_top uses the internal hasse diagram,
and therefore remains in Poset. On the other hand a method like
join_irreducibles just requires that there is a method "lower_covers",
and so can be implemented generically in the category.

But that's just a rule thumb; I left in Poset all the code that was on
the edge, so as to avoid moving too much code around.

> how are examples organized, how do you properly test the code, ...

Are those questions about the category framework in general, or about
this specific patch?

> In my (not yet final) review patch, I place some questions on
> implementations, some suggestions for additional methods, and I
> fixed several typos.

Ok, thanks!

Cheers,
                       Nicolas



---

archive/issue_comments_117133.json:
```json
{
    "body": "Apply only trac_10998-categories-posets-nt.patch",
    "created_at": "2011-04-22T15:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117133",
    "user": "stumpc5"
}
```

Apply only trac_10998-categories-posets-nt.patch



---

archive/issue_comments_117134.json:
```json
{
    "body": "There where a few bad sphinx markup. I just pushed a review patch on sage-combinat queue. I let you decide if you want to fold it or upload it. \n\nCheers,\n\nFlorent",
    "created_at": "2011-04-22T22:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117134",
    "user": "hivert"
}
```

There where a few bad sphinx markup. I just pushed a review patch on sage-combinat queue. I let you decide if you want to fold it or upload it. 

Cheers,

Florent



---

archive/issue_comments_117135.json:
```json
{
    "body": "Folded; thanks!",
    "created_at": "2011-04-23T02:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117135",
    "user": "nthiery"
}
```

Folded; thanks!



---

archive/issue_comments_117136.json:
```json
{
    "body": "Fixed failing test.",
    "created_at": "2011-04-23T02:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117136",
    "user": "nthiery"
}
```

Fixed failing test.



---

archive/issue_comments_117137.json:
```json
{
    "body": "Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!",
    "created_at": "2011-04-23T03:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117137",
    "user": "nthiery"
}
```

Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!



---

archive/issue_comments_117138.json:
```json
{
    "body": "Replying to [comment:14 nthiery]:\n> Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!\n\nI also just spotted a few more wrong sphinx markup ! I'm fixing those.",
    "created_at": "2011-04-23T12:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117138",
    "user": "hivert"
}
```

Replying to [comment:14 nthiery]:
> Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!

I also just spotted a few more wrong sphinx markup ! I'm fixing those.



---

archive/issue_comments_117139.json:
```json
{
    "body": "Replying to [comment:15 hivert]:\n> Replying to [comment:14 nthiery]:\n> > Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!\n> \n> I also just spotted a few more wrong sphinx markup ! I'm fixing those.\n\nPlease see my new review patch on sage-combinat queue `trac_10998-categories-posets-docfix-fh.patch`",
    "created_at": "2011-04-23T13:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117139",
    "user": "hivert"
}
```

Replying to [comment:15 hivert]:
> Replying to [comment:14 nthiery]:
> > Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!
> 
> I also just spotted a few more wrong sphinx markup ! I'm fixing those.

Please see my new review patch on sage-combinat queue `trac_10998-categories-posets-docfix-fh.patch`



---

archive/issue_comments_117140.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-05T01:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117140",
    "user": "saliola"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_117141.json:
```json
{
    "body": "I started with a fresh install of sage-4.7.rc1 and applied the patches at #9065 and #10938, followed by the patch for this ticket on the sage-combinat queue. I get a the following doctest failures.\n\n```\nThe following tests failed:\n \n        sage -t  devel/sage-trac/sage/geometry/fan_morphism.py # 25 doctests failed                                    \n        sage -t  devel/sage-trac/sage/geometry/fan.py # 4 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_variety.py # 1 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_divisor.py # 3 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_chow_group.py # 10 doctests failed\n        sage -t  devel/sage-trac/sage/structure/sage_object.pyx # 1 doctests failed\n```\n\nI verified that they are not caused by the other patches. (I also get these errors on 4.6.2 with the sage-combinat patches applied.)\n\nI don't understand the problem. If you copy and paste the offending doctests into the sage command-line, I don't get the errors reported by the doctest system. Any ideas?",
    "created_at": "2011-05-05T01:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117141",
    "user": "saliola"
}
```

I started with a fresh install of sage-4.7.rc1 and applied the patches at #9065 and #10938, followed by the patch for this ticket on the sage-combinat queue. I get a the following doctest failures.

```
The following tests failed:
 
        sage -t  devel/sage-trac/sage/geometry/fan_morphism.py # 25 doctests failed                                    
        sage -t  devel/sage-trac/sage/geometry/fan.py # 4 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_variety.py # 1 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_divisor.py # 3 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_chow_group.py # 10 doctests failed
        sage -t  devel/sage-trac/sage/structure/sage_object.pyx # 1 doctests failed
```

I verified that they are not caused by the other patches. (I also get these errors on 4.6.2 with the sage-combinat patches applied.)

I don't understand the problem. If you copy and paste the offending doctests into the sage command-line, I don't get the errors reported by the doctest system. Any ideas?



---

archive/issue_comments_117142.json:
```json
{
    "body": "Oh right, I had forgotten about those. I tried a bit to find the problem, but to not avail yet.\n\nAndrey, would you have any clue?",
    "created_at": "2011-05-05T02:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117142",
    "user": "nthiery"
}
```

Oh right, I had forgotten about those. I tried a bit to find the problem, but to not avail yet.

Andrey, would you have any clue?



---

archive/issue_comments_117143.json:
```json
{
    "body": "Hi Nicolas, thanks for ccing me!\n\nGiven that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.\n\nThe problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be \"standalone\" and breaking this relation messes up everything that builds up on top of it.\n\nI'll try to trace it down further, but it may take me a few days due to traveling and conferencing...",
    "created_at": "2011-05-05T05:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117143",
    "user": "novoselt"
}
```

Hi Nicolas, thanks for ccing me!

Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.

The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be "standalone" and breaking this relation messes up everything that builds up on top of it.

I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...



---

archive/issue_comments_117144.json:
```json
{
    "body": "Replying to [comment:19 novoselt]:\n> Hi Nicolas, thanks for ccing me!\n> \n> Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.\n> \n> The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be \"standalone\" and breaking this relation messes up everything that builds up on top of it.\n> \n> I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...\n\nThanks!\n\nFor the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.",
    "created_at": "2011-05-05T05:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117144",
    "user": "nthiery"
}
```

Replying to [comment:19 novoselt]:
> Hi Nicolas, thanks for ccing me!
> 
> Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.
> 
> The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be "standalone" and breaking this relation messes up everything that builds up on top of it.
> 
> I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...

Thanks!

For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.



---

archive/issue_comments_117145.json:
```json
{
    "body": "Replying to [comment:20 nthiery]:\n> For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.\n\nYes, this is it. Repeating the failing code twice in the command line reproduced the error. This raises two questions:\n1) Out of curiosity: Why does it show up in doctests? Shouldn't the state of Sage be clean before running a new test?\n2) To the point: How to fix it?\n\nI really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.\n\nDoes uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.\n\nSo I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..",
    "created_at": "2011-05-05T05:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117145",
    "user": "novoselt"
}
```

Replying to [comment:20 nthiery]:
> For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.

Yes, this is it. Repeating the failing code twice in the command line reproduced the error. This raises two questions:
1) Out of curiosity: Why does it show up in doctests? Shouldn't the state of Sage be clean before running a new test?
2) To the point: How to fix it?

I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.

Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.

So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..



---

archive/issue_comments_117146.json:
```json
{
    "body": "Here is a reviewer patch. This applies on top of the latest version of Nicolas's patch that can be found on the sage-combinat queue. These are mostly documentation fixes.\n\nWith the exception of the issue highlighted above, I give a positive review to the changes.\n\n- someone needs to review my patch\n- someone needs to post a patch addressing the broken doctests",
    "created_at": "2011-05-05T16:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117146",
    "user": "saliola"
}
```

Here is a reviewer patch. This applies on top of the latest version of Nicolas's patch that can be found on the sage-combinat queue. These are mostly documentation fixes.

With the exception of the issue highlighted above, I give a positive review to the changes.

- someone needs to review my patch
- someone needs to post a patch addressing the broken doctests



---

archive/issue_comments_117147.json:
```json
{
    "body": "I made sure that the patches (on the sage-combinat queue) apply on top of Rob Beezer's recent patches surrounding posets (ticket numbers #11289, #11293, #11292). There was a slight conflict with #11289, so this patch now depends on #11289. I updated the description accordingly.",
    "created_at": "2011-05-05T18:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117147",
    "user": "saliola"
}
```

I made sure that the patches (on the sage-combinat queue) apply on top of Rob Beezer's recent patches surrounding posets (ticket numbers #11289, #11293, #11292). There was a slight conflict with #11289, so this patch now depends on #11289. I updated the description accordingly.



---

archive/issue_comments_117148.json:
```json
{
    "body": "My previous comment refers to the patches on the sage-combinat queue.",
    "created_at": "2011-05-05T18:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117148",
    "user": "saliola"
}
```

My previous comment refers to the patches on the sage-combinat queue.



---

archive/issue_comments_117149.json:
```json
{
    "body": "Changing keywords from \"\" to \"days30\".",
    "created_at": "2011-05-10T14:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117149",
    "user": "nthiery"
}
```

Changing keywords from "" to "days30".



---

archive/issue_comments_117150.json:
```json
{
    "body": "Trying to help the buildbot to do its job\n\nApply trac_10998-categories-posets-nt.patch\nApply trac_10998-review-fs.patch",
    "created_at": "2011-06-10T07:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117150",
    "user": "chapoton"
}
```

Trying to help the buildbot to do its job

Apply trac_10998-categories-posets-nt.patch
Apply trac_10998-review-fs.patch



---

archive/issue_comments_117151.json:
```json
{
    "body": "try again\n\nApply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch",
    "created_at": "2011-06-10T08:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117151",
    "user": "chapoton"
}
```

try again

Apply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch



---

archive/issue_comments_117152.json:
```json
{
    "body": "trying to help the bot again\n\nApply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch",
    "created_at": "2011-06-10T19:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117152",
    "user": "chapoton"
}
```

trying to help the bot again

Apply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch



---

archive/issue_comments_117153.json:
```json
{
    "body": "ok, the bot has found a HUNK problem in poset_examples.py \n\nCould somebody solve that ?",
    "created_at": "2011-06-10T20:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117153",
    "user": "chapoton"
}
```

ok, the bot has found a HUNK problem in poset_examples.py 

Could somebody solve that ?



---

archive/issue_comments_117154.json:
```json
{
    "body": "Replying to [comment:30 chapoton]:\n> ok, the bot has found a HUNK problem in poset_examples.py \n> \n> Could somebody solve that ?\n\nDone! There just remains the cone issue.",
    "created_at": "2011-06-14T10:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117154",
    "user": "nthiery"
}
```

Replying to [comment:30 chapoton]:
> ok, the bot has found a HUNK problem in poset_examples.py 
> 
> Could somebody solve that ?

Done! There just remains the cone issue.



---

archive/issue_comments_117155.json:
```json
{
    "body": "Btw: I reviewed and folded in Franco's reviewer's patch. Thanks Franco!",
    "created_at": "2011-06-14T10:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117155",
    "user": "nthiery"
}
```

Btw: I reviewed and folded in Franco's reviewer's patch. Thanks Franco!



---

archive/issue_comments_117156.json:
```json
{
    "body": "Hi Andrei,\n\nReplying to [comment:21 novoselt]:\n> 2) To the point: How to fix it?\n> \n> I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.\n> \n> Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.\n> \n> So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..\n\nI have (finally!) just looked at this again. I traced through the execution of `f.cone_containing(0)`, and did not find the place where the construction of the cone (and in particular its unique representation or not) depended on a poset. Could you give me a pointer? Or ideally, a minimal example where two cones are constructed involving the same poset, and where the cones should be different (but are not with this patch)?\n\nWe are both at FPSAC with Franco; it would be great if we could finish this patch today or tomorrow.\n\nThanks!",
    "created_at": "2011-06-14T11:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117156",
    "user": "nthiery"
}
```

Hi Andrei,

Replying to [comment:21 novoselt]:
> 2) To the point: How to fix it?
> 
> I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.
> 
> Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.
> 
> So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..

I have (finally!) just looked at this again. I traced through the execution of `f.cone_containing(0)`, and did not find the place where the construction of the cone (and in particular its unique representation or not) depended on a poset. Could you give me a pointer? Or ideally, a minimal example where two cones are constructed involving the same poset, and where the cones should be different (but are not with this patch)?

We are both at FPSAC with Franco; it would be great if we could finish this patch today or tomorrow.

Thanks!



---

archive/issue_comments_117157.json:
```json
{
    "body": "Hi Nicolas!\n\nWith the patch:\n\n```\nsage: F1 = FaceFan(lattice_polytope.octahedron(3))\nsage: F2 = FaceFan(lattice_polytope.octahedron(3))\nsage: F1 == F2\nTrue\nsage: F1 is F2\nFalse\nsage: F1(2)[0]\n2-d cone of Rational polyhedral fan in 3-d lattice N\nsage: F1(2)[0].ambient() is F1\nTrue\nsage: F2(2)[0].ambient() is F2\nFalse\n```\n\n\nThe last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:\n* Make cone lattices of fans which are \"==\" but not \"is\" distinct. This should fix the issue without any complications as it will basically restore the current state.\n* Make \"==\" and \"is\" comparisons the same for fans. I think that this is undesirable as there are arguments for making \"==\" be the mathematical equivalence, which is even weaker than the current behaviour.\n* Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make \"==\" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. \n\nNote: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.\n\nSo, in short, I prefer to be able to create different posets of cones for fans which are \"==\".\n\nThank you,\nAndrey",
    "created_at": "2011-06-14T17:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117157",
    "user": "novoselt"
}
```

Hi Nicolas!

With the patch:

```
sage: F1 = FaceFan(lattice_polytope.octahedron(3))
sage: F2 = FaceFan(lattice_polytope.octahedron(3))
sage: F1 == F2
True
sage: F1 is F2
False
sage: F1(2)[0]
2-d cone of Rational polyhedral fan in 3-d lattice N
sage: F1(2)[0].ambient() is F1
True
sage: F2(2)[0].ambient() is F2
False
```


The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:
* Make cone lattices of fans which are "==" but not "is" distinct. This should fix the issue without any complications as it will basically restore the current state.
* Make "==" and "is" comparisons the same for fans. I think that this is undesirable as there are arguments for making "==" be the mathematical equivalence, which is even weaker than the current behaviour.
* Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make "==" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. 

Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.

So, in short, I prefer to be able to create different posets of cones for fans which are "==".

Thank you,
Andrey



---

archive/issue_comments_117158.json:
```json
{
    "body": "Changing keywords from \"days30\" to \"days30, sd31\".",
    "created_at": "2011-06-14T17:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117158",
    "user": "novoselt"
}
```

Changing keywords from "days30" to "days30, sd31".



---

archive/issue_comments_117159.json:
```json
{
    "body": "Replying to [comment:34 novoselt]:\n> Hi Nicolas!\n> \n> With the patch:\n> {{{\n> sage: F1 = FaceFan(lattice_polytope.octahedron(3))\n> sage: F2 = FaceFan(lattice_polytope.octahedron(3))\n> sage: F1 == F2\n> True\n> sage: F1 is F2\n> False\n> sage: F1(2)[0]\n> 2-d cone of Rational polyhedral fan in 3-d lattice N\n> sage: F1(2)[0].ambient() is F1\n> True\n> sage: F2(2)[0].ambient() is F2\n> False\n> }}}\n> \n> The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:\n>  * Make cone lattices of fans which are \"==\" but not \"is\" distinct. This should fix the issue without any complications as it will basically restore the current state.\n>  * Make \"==\" and \"is\" comparisons the same for fans. I think that this is undesirable as there are arguments for making \"==\" be the mathematical equivalence, which is even weaker than the current behaviour.\n>  * Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make \"==\" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. \n> \n> Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.\n> \n> So, in short, I prefer to be able to create different posets of cones for fans which are \"==\".\n\nThanks a lot! I'll look at this tonight.\n\nI am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?",
    "created_at": "2011-06-14T17:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117159",
    "user": "nthiery"
}
```

Replying to [comment:34 novoselt]:
> Hi Nicolas!
> 
> With the patch:
> {{{
> sage: F1 = FaceFan(lattice_polytope.octahedron(3))
> sage: F2 = FaceFan(lattice_polytope.octahedron(3))
> sage: F1 == F2
> True
> sage: F1 is F2
> False
> sage: F1(2)[0]
> 2-d cone of Rational polyhedral fan in 3-d lattice N
> sage: F1(2)[0].ambient() is F1
> True
> sage: F2(2)[0].ambient() is F2
> False
> }}}
> 
> The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:
>  * Make cone lattices of fans which are "==" but not "is" distinct. This should fix the issue without any complications as it will basically restore the current state.
>  * Make "==" and "is" comparisons the same for fans. I think that this is undesirable as there are arguments for making "==" be the mathematical equivalence, which is even weaker than the current behaviour.
>  * Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make "==" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. 
> 
> Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.
> 
> So, in short, I prefer to be able to create different posets of cones for fans which are "==".

Thanks a lot! I'll look at this tonight.

I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?



---

archive/issue_comments_117160.json:
```json
{
    "body": "Replying to [comment:35 nthiery]:\n> I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?\n\nWhen a fan computes its cone lattice, it constructs all of the required cones (which are bound to the correct fan) and then converts them into a poset. All further methods work with this poset. Since now posets are unique and involve \"==\" checks for fans and cones, the poset of the second fan is treated as the same one as the first one, so the second fan gets a poset of cones bound to the first fan. The precise method of fans is `_compute_cone_lattice`.\n\nNow, I have actually realized, that it will have the same issue for cones, it just does not break the existent doctests yet:\n\n```\nsage: C1 = Cone([(0,1)])\nsage: C2 = Cone([(0,1)])\nsage: C1 == C2\nTrue\nsage: C1 is C2\nFalse\nsage: C1.facets()[0]\n0-d face of 1-d cone in 2-d lattice N\nsage: C1.facets()[0].ambient() is C1\nTrue\nsage: C2.facets()[0].ambient() is C1\nTrue\nsage: C2.facets()[0].ambient() is C2\nFalse\n```\n\nThe code for cones is in `face_lattice` method. Again, I don't want to get the same posets even for cones that have the same order of rays, and there are arguments that \"==\" should treat rays as sets. So it would be nice to force different posets for \"==\" objects.\n\nWhy exactly are posets unique? Isn't it expensive to check that two posets are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup> elements, how long would it take to check their equality? Maybe elements of posets should be unique, but not posets themselves?",
    "created_at": "2011-06-14T18:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117160",
    "user": "novoselt"
}
```

Replying to [comment:35 nthiery]:
> I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?

When a fan computes its cone lattice, it constructs all of the required cones (which are bound to the correct fan) and then converts them into a poset. All further methods work with this poset. Since now posets are unique and involve "==" checks for fans and cones, the poset of the second fan is treated as the same one as the first one, so the second fan gets a poset of cones bound to the first fan. The precise method of fans is `_compute_cone_lattice`.

Now, I have actually realized, that it will have the same issue for cones, it just does not break the existent doctests yet:

```
sage: C1 = Cone([(0,1)])
sage: C2 = Cone([(0,1)])
sage: C1 == C2
True
sage: C1 is C2
False
sage: C1.facets()[0]
0-d face of 1-d cone in 2-d lattice N
sage: C1.facets()[0].ambient() is C1
True
sage: C2.facets()[0].ambient() is C1
True
sage: C2.facets()[0].ambient() is C2
False
```

The code for cones is in `face_lattice` method. Again, I don't want to get the same posets even for cones that have the same order of rays, and there are arguments that "==" should treat rays as sets. So it would be nice to force different posets for "==" objects.

Why exactly are posets unique? Isn't it expensive to check that two posets are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup> elements, how long would it take to check their equality? Maybe elements of posets should be unique, but not posets themselves?



---

archive/issue_comments_117161.json:
```json
{
    "body": "> Why exactly are posets unique? Isn't it expensive to check that two posets\n> are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup>\n> elements, how long would it take to check their equality? Maybe elements of\n> posets should be unique, but not posets themselves?\n\nAs far as I understood, there is not check for equivalence, is it ? Actually,\nI'm not sure what you mean by equivalence opposed to equality. However I see\nno reason why two posets with the same element and the same ordering should be\ndifferent object: mathematically they are the same set with the same\nordering...\n\nMore pragmatically, I have some code using poset as key for hash tables. At\nfirst I didn't ensure that posets were unique then the code end-up spending\nall the time comparing poset that is comparing the underlying graph.\n\nIn my opinion, if you need to see two equal poset as different, this is\nbecause you have some more information on those poset (eg: some tag saying\nwhere it come from). If it is the case, I have the feeling that you should\ninherit a class from poset which adds the tag and use it for comparison and\ncreation so that two differently tagged posets will be different for is as for\n==.\n\nMy two cents,\n\nFlorent",
    "created_at": "2011-06-14T21:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117161",
    "user": "hivert"
}
```

> Why exactly are posets unique? Isn't it expensive to check that two posets
> are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup>
> elements, how long would it take to check their equality? Maybe elements of
> posets should be unique, but not posets themselves?

As far as I understood, there is not check for equivalence, is it ? Actually,
I'm not sure what you mean by equivalence opposed to equality. However I see
no reason why two posets with the same element and the same ordering should be
different object: mathematically they are the same set with the same
ordering...

More pragmatically, I have some code using poset as key for hash tables. At
first I didn't ensure that posets were unique then the code end-up spending
all the time comparing poset that is comparing the underlying graph.

In my opinion, if you need to see two equal poset as different, this is
because you have some more information on those poset (eg: some tag saying
where it come from). If it is the case, I have the feeling that you should
inherit a class from poset which adds the tag and use it for comparison and
creation so that two differently tagged posets will be different for is as for
==.

My two cents,

Florent



---

archive/issue_comments_117162.json:
```json
{
    "body": "As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.\n\nIn this cases fans and cones report that \"==\" is true for all the elements and therefore the posets are considered to be the same and become a unique object.\n\nHowever for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.\n\nI agree that we have here more structure than poset itself but it is basically the question of \"the same\" and \"isomorphic\". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.",
    "created_at": "2011-06-14T21:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117162",
    "user": "novoselt"
}
```

As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.

In this cases fans and cones report that "==" is true for all the elements and therefore the posets are considered to be the same and become a unique object.

However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.

I agree that we have here more structure than poset itself but it is basically the question of "the same" and "isomorphic". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.



---

archive/issue_comments_117163.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-23T10:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117163",
    "user": "nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_117164.json:
```json
{
    "body": "The updated patch fixes the issue with cones and fans by adding a ``key`` argument to FinitePoset. Using it, equal but not identical Cone's and Fan's create distinct posets.\nI also folded in Christian's order_complex fix.\n\nTo me the whole thing seems ready to go.\n\nSorry, I screwed up and refreshed my changes directly in the main patch. So I have attached a diff between the previous and new version. It's not super-readable, but it should point to those few places that need review.",
    "created_at": "2011-06-23T10:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117164",
    "user": "nthiery"
}
```

The updated patch fixes the issue with cones and fans by adding a ``key`` argument to FinitePoset. Using it, equal but not identical Cone's and Fan's create distinct posets.
I also folded in Christian's order_complex fix.

To me the whole thing seems ready to go.

Sorry, I screwed up and refreshed my changes directly in the main patch. So I have attached a diff between the previous and new version. It's not super-readable, but it should point to those few places that need review.



---

archive/issue_comments_117165.json:
```json
{
    "body": "Replying to [comment:38 novoselt]:\n> As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.\n\nCorrect.\n\n> However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.\n\nTo me this sounds like two cones/fans shall be equal (as in A==B) only if they really have the same ambient space / ... and otherwise be only isomorphic (as in A.is_isomorphic(B)). \nIn general, equality is often used by Python at a very low level, e.g. for hash table lookups. So it should be fast and simple.\n\nAnyway, this does not need to be settled now, and we can discuss this more efficiently face to face at the next occasion.\n\n> I agree that we have here more structure than poset itself but it is basically the question of \"the same\" and \"isomorphic\". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.\n\nWe definitely have had such use cases as well. However we were lucky enough that we usually wanted to add some more structure, or change a bit the structure, and in those cases we would either derive a new class, or use a facade parent together with Cat.IsomorphicObjects() to transfer the part of the structure that was to be kept.\n\nBut we could think of generalizing the use of a key=`...` in UniqueRepresentation as I used here for posets.\n\nCheers,\n                      Nicolas",
    "created_at": "2011-06-23T10:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117165",
    "user": "nthiery"
}
```

Replying to [comment:38 novoselt]:
> As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.

Correct.

> However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.

To me this sounds like two cones/fans shall be equal (as in A==B) only if they really have the same ambient space / ... and otherwise be only isomorphic (as in A.is_isomorphic(B)). 
In general, equality is often used by Python at a very low level, e.g. for hash table lookups. So it should be fast and simple.

Anyway, this does not need to be settled now, and we can discuss this more efficiently face to face at the next occasion.

> I agree that we have here more structure than poset itself but it is basically the question of "the same" and "isomorphic". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.

We definitely have had such use cases as well. However we were lucky enough that we usually wanted to add some more structure, or change a bit the structure, and in those cases we would either derive a new class, or use a facade parent together with Cat.IsomorphicObjects() to transfer the part of the structure that was to be kept.

But we could think of generalizing the use of a key=`...` in UniqueRepresentation as I used here for posets.

Cheers,
                      Nicolas



---

archive/issue_comments_117166.json:
```json
{
    "body": "Hi Nicolas, thanks for the reply!\n\nChanges to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate. In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.\n\nGeneralizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!\n\nAndrey",
    "created_at": "2011-06-23T19:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117166",
    "user": "novoselt"
}
```

Hi Nicolas, thanks for the reply!

Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate. In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.

Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!

Andrey



---

archive/issue_comments_117167.json:
```json
{
    "body": "Replying to [comment:41 novoselt]:\n> Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate.\n\nNope. I just went this way because it was the quickest to setup to get this patch done. Worst case, a bit of getstate/setstate magic will do the job.\n\n> In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.\n\nOk.\n\n> Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!\n\nOk. I'll keep this in mind, and wait until we get enough other use cases.\n\nThanks Andrey for your fast review.",
    "created_at": "2011-06-23T20:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117167",
    "user": "nthiery"
}
```

Replying to [comment:41 novoselt]:
> Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate.

Nope. I just went this way because it was the quickest to setup to get this patch done. Worst case, a bit of getstate/setstate magic will do the job.

> In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.

Ok.

> Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!

Ok. I'll keep this in mind, and wait until we get enough other use cases.

Thanks Andrey for your fast review.



---

archive/issue_comments_117168.json:
```json
{
    "body": "Christian, Franco: any chances for one of you to check my latest changes shortly? Then we could be done, and get this in 4.7.2.\n\nThanks in advance,\n                   Nicolas",
    "created_at": "2011-06-23T20:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117168",
    "user": "nthiery"
}
```

Christian, Franco: any chances for one of you to check my latest changes shortly? Then we could be done, and get this in 4.7.2.

Thanks in advance,
                   Nicolas



---

archive/issue_comments_117169.json:
```json
{
    "body": "The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. \n\nIf it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.",
    "created_at": "2011-07-07T22:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117169",
    "user": "vbraun"
}
```

The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. 

If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.



---

archive/issue_comments_117170.json:
```json
{
    "body": "I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?\n\nAs an example, I tried\n\n```\nsage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })\nsage: D.plot(label_elements=False)\n\nsage: D.show()\nsage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}\nsage: D.show(element_labels=elm_labs)\n```\n\n\nIn both cases, I see the numbers as labels.\n\nBest, Christian",
    "created_at": "2011-08-10T00:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117170",
    "user": "stumpc5"
}
```

I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?

As an example, I tried

```
sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })
sage: D.plot(label_elements=False)

sage: D.show()
sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}
sage: D.show(element_labels=elm_labs)
```


In both cases, I see the numbers as labels.

Best, Christian



---

archive/issue_comments_117171.json:
```json
{
    "body": "Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)",
    "created_at": "2011-12-29T16:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117171",
    "user": "novoselt"
}
```

Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)



---

archive/issue_comments_117172.json:
```json
{
    "body": "Replying to [comment:48 novoselt]:\n> Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)\n\nI really want to get rid of it. I should have more time working on Sage shortly, so hopefully that will be soon!\n                      Nicolas",
    "created_at": "2012-01-08T19:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117172",
    "user": "nthiery"
}
```

Replying to [comment:48 novoselt]:
> Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)

I really want to get rid of it. I should have more time working on Sage shortly, so hopefully that will be soon!
                      Nicolas



---

archive/issue_comments_117173.json:
```json
{
    "body": "I get numerous mismatches when applying the patch on top of sage-5.0.prealpha0. I think it is due to #11900. Since #11900 is merged, I suggest to rebase the patch from here.",
    "created_at": "2012-01-27T09:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117173",
    "user": "SimonKing"
}
```

I get numerous mismatches when applying the patch on top of sage-5.0.prealpha0. I think it is due to #11900. Since #11900 is merged, I suggest to rebase the patch from here.



---

archive/issue_comments_117174.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-27T09:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117174",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_117175.json:
```json
{
    "body": "Replying to [comment:47 stumpc5]:\n> I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?\n> \n> As an example, I tried\n> {{{\n> sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })\n> sage: D.plot(label_elements=False)\n> \n> sage: D.show()\n> sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}\n> sage: D.show(element_labels=elm_labs)\n> }}}\n> \n> In both cases, I see the numbers as labels.\n\nFixed and tested in the updated patch!",
    "created_at": "2012-02-08T00:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117175",
    "user": "nthiery"
}
```

Replying to [comment:47 stumpc5]:
> I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?
> 
> As an example, I tried
> {{{
> sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })
> sage: D.plot(label_elements=False)
> 
> sage: D.show()
> sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}
> sage: D.show(element_labels=elm_labs)
> }}}
> 
> In both cases, I see the numbers as labels.

Fixed and tested in the updated patch!



---

archive/issue_comments_117176.json:
```json
{
    "body": "Replying to [comment:46 vbraun]:\n> The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. \n> \n> If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.\n\nThanks for the suggestion. I implemented this in the latest version of my patch!",
    "created_at": "2012-02-08T01:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117176",
    "user": "nthiery"
}
```

Replying to [comment:46 vbraun]:
> The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. 
> 
> If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.

Thanks for the suggestion. I implemented this in the latest version of my patch!



---

archive/issue_comments_117177.json:
```json
{
    "body": "Changing keywords from \"days30, sd31\" to \"days30, sd31,Cernay2012\".",
    "created_at": "2012-02-08T01:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117177",
    "user": "nthiery"
}
```

Changing keywords from "days30, sd31" to "days30, sd31,Cernay2012".



---

archive/issue_comments_117178.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-08T01:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117178",
    "user": "nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_117179.json:
```json
{
    "body": "The latest version of the patch is here and in the Sage-Combinat queue. Florent will make the final review tomorrow morning.",
    "created_at": "2012-02-08T01:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117179",
    "user": "nthiery"
}
```

The latest version of the patch is here and in the Sage-Combinat queue. Florent will make the final review tomorrow morning.



---

archive/issue_comments_117180.json:
```json
{
    "body": "Patch to be applied on the sagenb repo",
    "created_at": "2012-02-08T10:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117180",
    "user": "nthiery"
}
```

Patch to be applied on the sagenb repo



---

archive/issue_comments_117181.json:
```json
{
    "body": "Attachment [trac_10998-categories-posets-sagenb-nt.patch](tarball://root/attachments/some-uuid/ticket10998/trac_10998-categories-posets-sagenb-nt.patch) by nthiery created at 2012-02-08 10:23:45",
    "created_at": "2012-02-08T10:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117181",
    "user": "nthiery"
}
```

Attachment [trac_10998-categories-posets-sagenb-nt.patch](tarball://root/attachments/some-uuid/ticket10998/trac_10998-categories-posets-sagenb-nt.patch) by nthiery created at 2012-02-08 10:23:45



---

archive/issue_comments_117182.json:
```json
{
    "body": "Attachment [trac_10998-categories-posets-nt.patch](tarball://root/attachments/some-uuid/ticket10998/trac_10998-categories-posets-nt.patch) by nthiery created at 2012-02-09 00:41:12\n\nFinal patch uploaded, after polishing of the doc and a final failing doctest. Crossreviewed with Florent. All tests pass. Positive review!\n\nThanks everyone!",
    "created_at": "2012-02-09T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117182",
    "user": "nthiery"
}
```

Attachment [trac_10998-categories-posets-nt.patch](tarball://root/attachments/some-uuid/ticket10998/trac_10998-categories-posets-nt.patch) by nthiery created at 2012-02-09 00:41:12

Final patch uploaded, after polishing of the doc and a final failing doctest. Crossreviewed with Florent. All tests pass. Positive review!

Thanks everyone!



---

archive/issue_comments_117183.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-09T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117183",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_117184.json:
```json
{
    "body": "Wow, you win the award for longest commit message.",
    "created_at": "2012-02-09T19:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117184",
    "user": "jdemeyer"
}
```

Wow, you win the award for longest commit message.



---

archive/issue_comments_117185.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10913#issuecomment-117185",
    "user": "jdemeyer"
}
```

Resolution: fixed
