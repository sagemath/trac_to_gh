# Issue 15849: Python 3 preparation: Py2 vs. Py3 return value of write() in doctests

Issue created by migration from Trac.

Original creator: wluebbe

Original creation time: 2014-04-07 15:35:55

Keywords: python3

The write() function does return nothing in Py2

```
>>> sys.version
'2.7.5+ (default, Feb 27 2014, 19:37:08) \n[GCC 4.8.1]'
>>> with open("tracked", "w") as f: f.write("boo")
... 
>>> 
```

while in Py3 it returns the number of bytes written

```
>>> sys.version
'3.3.2+ (default, Feb 28 2014, 00:52:16) \n[GCC 4.8.1]'
>>> with open("tracked", "w") as f: f.write("boo")
... 
3
>>> 
```

This can be unified by adding something like `ignore =`

```
>>> sys.version
'3.3.2+ (default, Feb 28 2014, 00:52:16) \n[GCC 4.8.1]'
>>> with open("tracked", "w") as f: ignore = f.write("boo")
... 
>>> 
```

About 79 py module are effected.


---

Comment by jdemeyer created at 2016-05-02 13:36:45

Changing component from distribution to python3.


---

Comment by jhpalmieri created at 2017-04-21 20:44:15

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2017-04-21 20:44:15

New commits:


---

Comment by jhpalmieri created at 2017-04-21 20:48:59

I used `_ = file.open('...')`, since `_` is commonly used as an ignored variable in Python. Also, `_` has a special meaning at the command line: the result of the previous command. But `_` is treated differently in doctesting: in `libs/pari/tests.py`, if I use

```
    sage: _ = gpfile.file.write("polcyclo(5)\n")
```

on line 187, then on line 377,

```
    sage: _.Strchr()
```

the doctesting framework thinks that `_` still refers to the result of the call to `write`. I would say this is a bug in the doctesting framework. To get around it, I used a double underscore on line 187 (and the previous few lines) in `lib/pari/tests.py`.


---

Comment by tscrim created at 2017-04-24 19:41:04

Needs a rebase, but LGTM otherwise.


---

Comment by git created at 2017-04-24 19:51:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2017-04-24 19:52:34

Okay, rebased.


---

Comment by tscrim created at 2017-04-24 19:53:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-25 17:34:31

Resolution: fixed
