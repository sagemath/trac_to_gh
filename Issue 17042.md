# Issue 17042: Fix java version detection

Issue created by migration from https://trac.sagemath.org/ticket/17279

Original creator: jdemeyer

Original creation time: 2014-11-03 09:21:15

CC:  fbissey vbraun gutow kcrisman strogdon jdemeyer

Since the Java requirements have gone up, the version detection in `src/sage/interfaces/jmoldata.py` should be fixed.


---

Comment by vbraun created at 2014-11-03 09:28:06

Or jmol should be compiled to run on older JREs if possible ;-)


---

Comment by fbissey created at 2014-11-03 09:45:07

Replying to [comment:2 vbraun]:
> Or jmol should be compiled to run on older JREs if possible ;-)
Whichever but we have to agree quickly. Do we want to require java 1.7 as a minimum? Is there a good reason to ditch java 1.6?


---

Comment by fbissey created at 2014-11-03 09:47:34

Actually the current code in sage check for version as far back as 1.5 and would be unhappy with 1.8.

```
        import re
        java_version = re.search("version.*[1][.][567]", version)
        return java_version is not None
```

so some fix will be in order anyway.


---

Comment by gutow created at 2014-11-03 14:51:27

Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.

I recommend "java_version = re.search("version.*[1][.][78]", version)"  and if we run into problems with version 8 JVMs we back up.


---

Comment by vbraun created at 2014-11-03 15:06:31

Seems like they intentionally require 1.7+, so we should just require that.


---

Comment by kcrisman created at 2014-11-03 17:42:23

> Good, the version checking is still in there.  This needs to be changed to not accept anything less than java 7.  I think Jmol will work with java 8, but have not done any testing.
Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.
> Seems like they intentionally require 1.7+, so we should just require that.
Yup.  Wow, that is a bit of a change.  Sorry, Jeroen :(


---

Comment by gutow created at 2014-11-03 19:57:00

Replying to [comment:8 kcrisman]:
> Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.
JSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.

It is quite possible that the wiki is behind.  I'll put it on our todo list.


---

Comment by kcrisman created at 2014-11-03 19:58:50

> > Jonathan, do we need Java 1.7 to view jsmol things, though?  Also, that means the wiki for jmol is pretty out of date.
> JSmol and Jmol work without the backend.  The backend is presently just used to make the nice static pictures, without it a less pretty Tachyon image is generated.  Ultimately, the backend should be used to package the data as well.  The present packaging method is not terribly efficient or flexible.

Wait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.


---

Comment by gutow created at 2014-11-03 21:02:22

Replying to [comment:10 kcrisman]:
> Wait, wait.  So is Java 1.7+ necessary to view Jmol applets from the command line?  Exactly what is it that needs 1.7?  
Yes, because from the command line you run the Jmol application which is a java application and now requires a recent JVM.  A side note.  I looked carefully at how we comile Jmol. Interestingly, we actually compile Jmol to be 1.6+ compatible, but it looks like the external gettext libraries now require 1.7+ and we're not about to rewrite those.  So people may only run into this problem if they are using translations.
>If it's just the static images, then we could fail gracefully in the notebook to Tachyon images when the Java is not recent enough.   If I'm not understanding this properly, sorry for the noise.
We already do that except that we were still accepting JVM >1.5, which no longer works.  I think we have to accept only 1.7+.


---

Comment by fbissey created at 2014-11-03 21:08:23

OK thanks for all that information it is time to start committing now. There is the spot mentioned above and at least one that I can easily find in the FAQ. I should be done with those in the next 15mn.


---

Comment by fbissey created at 2014-11-03 21:23:40

OK minimal change in the code but the documentation clearly needs a dusting. Especially in the wake of jsmol. Someone should review what I wrote and may be come with a paragraph about it.
----
New commits:


---

Comment by fbissey created at 2014-11-03 21:23:40

Changing status from new to needs_review.


---

Comment by gutow created at 2014-11-03 22:50:48

Something has happened to the trac changelog.  I get an error about malformed xml when I try git trac checkout.


---

Comment by gutow created at 2014-11-03 23:37:53

OK, I was able to clone the branch...I'll work with that.


---

Comment by gutow created at 2014-11-03 23:51:02

That didn't work either.  I'll just hand copy the patch...


---

Comment by fbissey created at 2014-11-04 00:17:42

Please correct my cruft while you are at it: "use at a Java" yuk.


---

Comment by gutow created at 2014-11-04 01:16:39

OK, I think this last commit is a reasonable update to the faq.
----
New commits:


---

Comment by gutow created at 2014-11-04 01:22:07

No! 'sage -dev push --ticket 17279' only seems to have added the last couple of lines of the rewrite.  I'm giving up on the trac/git combination.  Here's the corrected text.

The default live 3-D plotting for Sage 6.4+ uses
`Jmol/JSmol <http://jmol.sourceforge.net>`_
for viewing. From the command line the Jmol Java application is used,
and for in browser viewing either pure javascript or a Java applet
is used.  By default in browsers pure javascript is used to avoid
the problems with some browsers that do not support java applet
plugins (namely Chrome).  On each browser worksheet there is a
checkbox which must be checked before a 3-D plot is generated if
the user wants to use the Java applet (the applet is a little faster
with complex plots).
The most likely reason for a malfunction is that you do not have
a Java Run Time Environment (JRE) installed or you have one older than
version 1.7.  If things work from the command line another possibility
is that your browser does not have the proper plugin to support Java
applets (at present, 2014, plugins do not work with most versions of
Chrome).  Make sure you have installed either the IcedTea browser
plugin (for linux see your package manager), see:
`IcedTea <http://icedtea.classpath.org/wiki/IcedTea-Web>`_,
or the Oracle Java plugin see:
`Java <https://java.com/en/download/help/index_installing.xml>`_.

If you are using a Sage server over the web and even javascript rendering 
does not work, you may have a problem with your browser's javascript
engine or have it turned off.


---

Comment by gutow created at 2014-11-04 01:40:01

I'm confused.  This commit â€‹656c12 looks OK, but the final commit only has the last couple of lines.  It appears that resolving the conflict between the two updates confused things.  Or am I just not understanding?


---

Comment by fbissey created at 2014-11-04 01:49:01

I am sure you did it the recommended way but it is all there. Thank you for rewriting that bit of faq.


---

Comment by kcrisman created at 2014-11-04 14:45:15

This is pretty awesome, thanks.  I can't test this since I don't have a bad java :-) but presumably Jeroen can and of course the change is quite minimal.  In terms of the doc, I would just suggest that

```
+with complex plots).
+The most likely reason for a malfunction is that you do not have
```

have a newline in between, because otherwise Sphinx will turn it into one enormous paragraph, I think.  Nice work!


---

Comment by fbissey created at 2014-11-04 21:51:44

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2014-11-04 21:51:44

Done. Putting this to positive review then.
----
New commits:


---

Comment by kcrisman created at 2014-11-05 12:58:31

Great.


---

Comment by vbraun created at 2014-11-06 11:15:11

Resolution: fixed
