# Issue 11354: count_points() error for generic schemes. (includes patch)

archive/issues_011354.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nsage raises an error when trying to count the number of points of a subscheme of an affine scheme.\n\nSee, for instance:\n\nsage: F=FiniteField(3)\nsage: R.<x,y>=F[]\nsage: A=AffineSpace(F,2)\nsage: I=R.ideal(x<sup>2-y</sup>2-1)\nsage: S=A.subscheme(I)\nsage: S.count_points(2)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n\n/home/mmarco/sage-4.6.2/<ipython console> in <module>()\n\n/usr/lib64/python2.7/site-packages/sage/schemes/generic/scheme.py in count_points(self, n)\n    531             F1 = GF(q**i, name='z')\n    532             S1 = self.base_extend(F1)\n--> 533             a.append(len(S1.rational_points()))\n    534         return(a)\n    535     \n\n/usr/lib64/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.py in rational_points(self, F, bound)\n   1129                 raise TypeError, \"Unable to enumerate points over %s.\"%F\n   1130         try:\n-> 1131             return X.points()\n   1132         except TypeError:\n   1133             raise TypeError, \"Unable to enumerate points over %s.\"%F\n\n/usr/lib64/python2.7/site-packages/sage/schemes/generic/homset.py in points(self, B)\n    162         except TypeError:\n    163             raise TypeError, \"Domain of argument must be of the form Spec(S).\"\n--> 164         if is_RationalField(R) or R == Z:\n    165             if not B > 0:\n    166                 raise TypeError, \"A positive bound B (= %s) must be specified.\"%B\n\nNameError: global name 'Z' is not defined\n\nIssue created by migration from https://trac.sagemath.org/ticket/11526\n\n",
    "created_at": "2011-06-21T14:25:20Z",
    "labels": [
        "algebraic geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "count_points() error for generic schemes. (includes patch)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11354",
    "user": "mmarco"
}
```
Assignee: AlexGhitza

sage raises an error when trying to count the number of points of a subscheme of an affine scheme.

See, for instance:

sage: F=FiniteField(3)
sage: R.<x,y>=F[]
sage: A=AffineSpace(F,2)
sage: I=R.ideal(x<sup>2-y</sup>2-1)
sage: S=A.subscheme(I)
sage: S.count_points(2)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)

/home/mmarco/sage-4.6.2/<ipython console> in <module>()

/usr/lib64/python2.7/site-packages/sage/schemes/generic/scheme.py in count_points(self, n)
    531             F1 = GF(q**i, name='z')
    532             S1 = self.base_extend(F1)
--> 533             a.append(len(S1.rational_points()))
    534         return(a)
    535     

/usr/lib64/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.py in rational_points(self, F, bound)
   1129                 raise TypeError, "Unable to enumerate points over %s."%F
   1130         try:
-> 1131             return X.points()
   1132         except TypeError:
   1133             raise TypeError, "Unable to enumerate points over %s."%F

/usr/lib64/python2.7/site-packages/sage/schemes/generic/homset.py in points(self, B)
    162         except TypeError:
    163             raise TypeError, "Domain of argument must be of the form Spec(S)."
--> 164         if is_RationalField(R) or R == Z:
    165             if not B > 0:
    166                 raise TypeError, "A positive bound B (= %s) must be specified."%B

NameError: global name 'Z' is not defined

Issue created by migration from https://trac.sagemath.org/ticket/11526





---

archive/issue_comments_125687.json:
```json
{
    "body": "Attachment [trac_11526_solves_error.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_solves_error.patch) by mmarco created at 2011-06-21 14:31:07",
    "created_at": "2011-06-21T14:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125687",
    "user": "mmarco"
}
```

Attachment [trac_11526_solves_error.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_solves_error.patch) by mmarco created at 2011-06-21 14:31:07



---

archive/issue_comments_125688.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-24T11:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125688",
    "user": "mmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_125689.json:
```json
{
    "body": "The patch makes sense, it fixes a bug in the method points() of the class SchemeHomset_affine_coordinates. \n\nNote: the same typo (Z instead of ZZ) seems to occur in the method points() of the class SchemeHomset_projective_coordinates_ring, which is not implemented yet.",
    "created_at": "2011-10-30T18:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125689",
    "user": "davideklund"
}
```

The patch makes sense, it fixes a bug in the method points() of the class SchemeHomset_affine_coordinates. 

Note: the same typo (Z instead of ZZ) seems to occur in the method points() of the class SchemeHomset_projective_coordinates_ring, which is not implemented yet.



---

archive/issue_comments_125690.json:
```json
{
    "body": "In addition to fixing the bug, the patch includes a doctest illustrating this.",
    "created_at": "2011-10-30T18:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125690",
    "user": "davideklund"
}
```

In addition to fixing the bug, the patch includes a doctest illustrating this.



---

archive/issue_comments_125691.json:
```json
{
    "body": "Attachment [trac_11526_bugfix_with_doctest.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_doctest.patch) by davideklund created at 2011-10-30 18:38:25\n\nThe patch trac_11526_bugfix_with_doctest.patch was made using Sage 4.7.1.",
    "created_at": "2011-10-30T18:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125691",
    "user": "davideklund"
}
```

Attachment [trac_11526_bugfix_with_doctest.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_doctest.patch) by davideklund created at 2011-10-30 18:38:25

The patch trac_11526_bugfix_with_doctest.patch was made using Sage 4.7.1.



---

archive/issue_comments_125692.json:
```json
{
    "body": "Now that you're working on the docstring anyway, it would be good to add INPUT and OUTPUT sections to it, as is the standard convention.",
    "created_at": "2011-11-06T18:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125692",
    "user": "johanbosman"
}
```

Now that you're working on the docstring anyway, it would be good to add INPUT and OUTPUT sections to it, as is the standard convention.



---

archive/issue_comments_125693.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-11-06T18:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125693",
    "user": "johanbosman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_125694.json:
```json
{
    "body": "Attachment [trac_11526_bugfix_with_docstring.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_docstring.patch) by davideklund created at 2011-11-21 10:58:12\n\nIn addition to earlier changes, the patch includes INPUT and OUTPUT info.",
    "created_at": "2011-11-21T10:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125694",
    "user": "davideklund"
}
```

Attachment [trac_11526_bugfix_with_docstring.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_docstring.patch) by davideklund created at 2011-11-21 10:58:12

In addition to earlier changes, the patch includes INPUT and OUTPUT info.



---

archive/issue_comments_125695.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-11-21T11:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125695",
    "user": "davideklund"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_125696.json:
```json
{
    "body": "The patch trac_11526_bugfix_with_docstring.patch was made using Sage 4.7.1.",
    "created_at": "2011-11-21T11:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125696",
    "user": "davideklund"
}
```

The patch trac_11526_bugfix_with_docstring.patch was made using Sage 4.7.1.



---

archive/issue_comments_125697.json:
```json
{
    "body": "The same patch as above together with the fix in the projective case.",
    "created_at": "2011-12-09T08:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125697",
    "user": "fschulze"
}
```

The same patch as above together with the fix in the projective case.



---

archive/issue_comments_125698.json:
```json
{
    "body": "Attachment [trac_11526_bugfix_with_docstring.2.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_docstring.2.patch) by saraedum created at 2011-12-09 10:00:10\n\nfixes the bug (also for the projective case), docstring with Input and Output.",
    "created_at": "2011-12-09T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125698",
    "user": "saraedum"
}
```

Attachment [trac_11526_bugfix_with_docstring.2.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_bugfix_with_docstring.2.patch) by saraedum created at 2011-12-09 10:00:10

fixes the bug (also for the projective case), docstring with Input and Output.



---

archive/issue_comments_125699.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-09T10:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125699",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_125700.json:
```json
{
    "body": "Attachment [trac_11526_final.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_final.patch) by saraedum created at 2011-12-09 10:38:19\n\nApply trac_11526_final.patch\n\nTested against sage-4.8.alpha3 and doctests pass.\n\n[attachment:trac_11526_final.patch] is identical to [trac_11526_bugfix_with_docstring.2.patch] except for the commit message which I replaced with something that makes hopefully more sense to somebody who does not know this ticket. \n\nWe still don't have a docstring for SchemeHomset?_projective_coordinates_ring.points() but I guess that is acceptable since there wasn't any before and it's not implemented anyway.\n\nI'm unsure if \"Reviewers\" should only mention the person who clicked \"positive review\" or everybody who was part of the review process. Anyway, I added some authors and reviewers, I hope nobody minds.\n\nBtw. davideklund, your name is not in the AccountNamesMappedtoRealNames on the trac wiki start page.",
    "created_at": "2011-12-09T10:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125700",
    "user": "saraedum"
}
```

Attachment [trac_11526_final.patch](tarball://root/attachments/some-uuid/ticket11526/trac_11526_final.patch) by saraedum created at 2011-12-09 10:38:19

Apply trac_11526_final.patch

Tested against sage-4.8.alpha3 and doctests pass.

[attachment:trac_11526_final.patch] is identical to [trac_11526_bugfix_with_docstring.2.patch] except for the commit message which I replaced with something that makes hopefully more sense to somebody who does not know this ticket. 

We still don't have a docstring for SchemeHomset?_projective_coordinates_ring.points() but I guess that is acceptable since there wasn't any before and it's not implemented anyway.

I'm unsure if "Reviewers" should only mention the person who clicked "positive review" or everybody who was part of the review process. Anyway, I added some authors and reviewers, I hope nobody minds.

Btw. davideklund, your name is not in the AccountNamesMappedtoRealNames on the trac wiki start page.



---

archive/issue_comments_125701.json:
```json
{
    "body": "I fixed this long ago in #11599 which also contains some other important additions IMHO. I think it would be more productive if somebody could review #11599.",
    "created_at": "2011-12-09T11:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125701",
    "user": "vbraun"
}
```

I fixed this long ago in #11599 which also contains some other important additions IMHO. I think it would be more productive if somebody could review #11599.



---

archive/issue_comments_125702.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-12-10T10:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11354#issuecomment-125702",
    "user": "jdemeyer"
}
```

Resolution: fixed
