# Issue 18767: Do not search old-style spkgs

archive/issues_018767.json:
```json
{
    "body": "As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ\n\nIssue created by migration from https://trac.sagemath.org/ticket/19004\n\n",
    "closed_at": "2015-08-21T01:56:10Z",
    "created_at": "2015-08-09T08:49:35Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Do not search old-style spkgs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18767",
    "user": "https://github.com/vbraun"
}
```
As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ

Issue created by migration from https://trac.sagemath.org/ticket/19004





---

archive/issue_comments_255926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-09T09:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_255927.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-09T09:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255927",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_255928.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2015-08-09T09:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255928",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_255929.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-08-09T09:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255929",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_255930.json:
```json
{
    "body": "```\n$ tox\n[...]\n  py26: commands succeeded\n  py27: commands succeeded\n  py33: commands succeeded\n  py34: commands succeeded\n  congratulations :)\n```",
    "created_at": "2015-08-09T09:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255930",
    "user": "https://github.com/vbraun"
}
```

```
$ tox
[...]
  py26: commands succeeded
  py27: commands succeeded
  py33: commands succeeded
  py34: commands succeeded
  congratulations :)
```



---

archive/issue_comments_255931.json:
```json
{
    "body": "What does `Levenshtein Distance` do here? It should be in `src/sage/coding/`...",
    "created_at": "2015-08-10T20:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255931",
    "user": "https://github.com/dimpase"
}
```

What does `Levenshtein Distance` do here? It should be in `src/sage/coding/`...



---

archive/issue_comments_255932.json:
```json
{
    "body": "Its here so we can suggest similarly-named packages\n\n```\n$ ./build/bin/sage-package apropos python\nDid you mean: cython, ipython, python2, python3, patch?\n```\n`sage_bootstrap` must work without Sage for the obvious chicken-and-egg reasons, so no, we can't put it anywhere else.",
    "created_at": "2015-08-10T20:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255932",
    "user": "https://github.com/vbraun"
}
```

Its here so we can suggest similarly-named packages

```
$ ./build/bin/sage-package apropos python
Did you mean: cython, ipython, python2, python3, patch?
```
`sage_bootstrap` must work without Sage for the obvious chicken-and-egg reasons, so no, we can't put it anywhere else.



---

archive/issue_comments_255933.json:
```json
{
    "body": "Re \"call the new package manager\", how long will it be \"new\"? Maybe this should just say \"Call Sage's package manager\".",
    "created_at": "2015-08-10T21:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255933",
    "user": "https://github.com/jhpalmieri"
}
```

Re "call the new package manager", how long will it be "new"? Maybe this should just say "Call Sage's package manager".



---

archive/issue_comments_255934.json:
```json
{
    "body": "To clarify: if you want to install an old-style spkg, do you need to download the spkg file manually and then do `sage -i FILE`?",
    "created_at": "2015-08-10T21:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255934",
    "user": "https://github.com/jhpalmieri"
}
```

To clarify: if you want to install an old-style spkg, do you need to download the spkg file manually and then do `sage -i FILE`?



---

archive/issue_comments_255935.json:
```json
{
    "body": "on the wishlist:\n\nHaving as answer `patch` when asking for `python` is funny ;-) And having `cython` first is bad as well. Could you weight the Levenshtein distance. Reasonable parameters for your purpose might be:\n- deletion: 1\n- addition: 1\n- exchange: 2  (so basically this would count for one deletion + one addition)\n\n`patch` would then be out if I count well (would be distance 6) and `cython` will appear after `python2` and `python3` (would be distance `2` against `1`).",
    "created_at": "2015-08-10T22:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255935",
    "user": "https://github.com/videlec"
}
```

on the wishlist:

Having as answer `patch` when asking for `python` is funny ;-) And having `cython` first is bad as well. Could you weight the Levenshtein distance. Reasonable parameters for your purpose might be:
- deletion: 1
- addition: 1
- exchange: 2  (so basically this would count for one deletion + one addition)

`patch` would then be out if I count well (would be distance 6) and `cython` will appear after `python2` and `python3` (would be distance `2` against `1`).



---

archive/issue_comments_255936.json:
```json
{
    "body": "We'll call it new until New Hall changes its name, easy.\n\nBoth `sage -i /path/to/old.spkg` and `sage -i http://url/to/old.spkg` still work.\n\nAd hoc weighting the distance is so passe, we should train a RNN on command line input! This is obviously a good investment of time and developer effort.",
    "created_at": "2015-08-10T23:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255936",
    "user": "https://github.com/vbraun"
}
```

We'll call it new until New Hall changes its name, easy.

Both `sage -i /path/to/old.spkg` and `sage -i http://url/to/old.spkg` still work.

Ad hoc weighting the distance is so passe, we should train a RNN on command line input! This is obviously a good investment of time and developer effort.



---

archive/issue_comments_255937.json:
```json
{
    "body": "Also on the wishlist: the suggestions should also include relevant old-style packages, perhaps with a suitable warning (while we don't want someone to install the old \"python\" package, we should be happy to have them install the \"p_group_cohomology\" package).",
    "created_at": "2015-08-10T23:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255937",
    "user": "https://github.com/jhpalmieri"
}
```

Also on the wishlist: the suggestions should also include relevant old-style packages, perhaps with a suitable warning (while we don't want someone to install the old "python" package, we should be happy to have them install the "p_group_cohomology" package).



---

archive/issue_comments_255938.json:
```json
{
    "body": "Any actionable suggestions or should I just go with the original plan and delete the spkgs from the server?",
    "created_at": "2015-08-13T20:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255938",
    "user": "https://github.com/vbraun"
}
```

Any actionable suggestions or should I just go with the original plan and delete the spkgs from the server?



---

archive/issue_comments_255939.json:
```json
{
    "body": "So what will happen to the `p_group_cohomology` package, for example? Will it completely disappear from the lists of available packages? If this is the plan, then I object. We would need some sort of official deprecation period for old-style packages, and at the end of that period (which could be strictly enforced, unlike some of our other deprecation time tables), then we delete all old-style packages.",
    "created_at": "2015-08-16T15:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255939",
    "user": "https://github.com/jhpalmieri"
}
```

So what will happen to the `p_group_cohomology` package, for example? Will it completely disappear from the lists of available packages? If this is the plan, then I object. We would need some sort of official deprecation period for old-style packages, and at the end of that period (which could be strictly enforced, unlike some of our other deprecation time tables), then we delete all old-style packages.



---

archive/issue_comments_255940.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> some of our other deprecation time tables\n\n[off topic] A deprecation is not a time table: deprecated code MAY be removed after one year, it's not that it SHOULD be removed.",
    "created_at": "2015-08-16T21:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255940",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 jhpalmieri]:
> some of our other deprecation time tables

[off topic] A deprecation is not a time table: deprecated code MAY be removed after one year, it's not that it SHOULD be removed.



---

archive/issue_comments_255941.json:
```json
{
    "body": "Nothing will happen to the `p_group_cohomology` package. You can install it by specifying its path or url. The only change is that installing `python` will no longer automatically download the ancient python spkg.",
    "created_at": "2015-08-16T22:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255941",
    "user": "https://github.com/vbraun"
}
```

Nothing will happen to the `p_group_cohomology` package. You can install it by specifying its path or url. The only change is that installing `python` will no longer automatically download the ancient python spkg.



---

archive/issue_comments_255942.json:
```json
{
    "body": "I'm sorry, I'm confused again. Are you just proposing the changes in the branch, or also to remove files from the server? It's important that commands like `sage --optional` still list the old-style packages. If you actually remove them from the server, that won't happen, right?\n\n```\n$ sage -i p_group_cohomology\nAttempting to download package p_group_cohomology\nError: could not find a package matching p_group_cohomology\n       Try 'sage --package list' to see the available packages\n       There is no package similar to p_group_cohomology\n```\nThen since `sage --package list` doesn't actually list `p_group_cohomology`, it is not clear how someone is supposed to find out about it or find its URL. `sage --optional` does list it, but doesn't say how to obtain it. If I were a novice user, I would be confused about whether this was a valid package or not.\n\nIt might be better if, instead of deleting item 2b, it behaved differently: it should never install a package, but only print a warning, something like: \"Old-style Sage package available from <URL>. Run <CMD> to install it. Only do this if you know what you're doing.\" In addition, it should print the apropos message (probably first), so someone running `sage -i python` will be given appropriate advice.",
    "created_at": "2015-08-16T23:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255942",
    "user": "https://github.com/jhpalmieri"
}
```

I'm sorry, I'm confused again. Are you just proposing the changes in the branch, or also to remove files from the server? It's important that commands like `sage --optional` still list the old-style packages. If you actually remove them from the server, that won't happen, right?

```
$ sage -i p_group_cohomology
Attempting to download package p_group_cohomology
Error: could not find a package matching p_group_cohomology
       Try 'sage --package list' to see the available packages
       There is no package similar to p_group_cohomology
```
Then since `sage --package list` doesn't actually list `p_group_cohomology`, it is not clear how someone is supposed to find out about it or find its URL. `sage --optional` does list it, but doesn't say how to obtain it. If I were a novice user, I would be confused about whether this was a valid package or not.

It might be better if, instead of deleting item 2b, it behaved differently: it should never install a package, but only print a warning, something like: "Old-style Sage package available from <URL>. Run <CMD> to install it. Only do this if you know what you're doing." In addition, it should print the apropos message (probably first), so someone running `sage -i python` will be given appropriate advice.



---

archive/issue_comments_255943.json:
```json
{
    "body": "Nobody in their right mind is going to want to install the old python spkg. Its akin to handing out razor blades to babies if you just tell people to type in this other command to install the python spkg. The entire mashing-up old (and almost always broken) and new packages is insane, and technically savvy users trip over it on a daily basis. As documented on sage-devel. \n\nThis ticket doesn't change `sage --optional`, but IMHO its just as insane that it mashes old and new spkgs together. In any case, this is not what this ticket is about. \n\nIf you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url. Weighted against the very real and documented risk that people get confused about standard packages, this is a no-brainer to me.",
    "created_at": "2015-08-17T07:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255943",
    "user": "https://github.com/vbraun"
}
```

Nobody in their right mind is going to want to install the old python spkg. Its akin to handing out razor blades to babies if you just tell people to type in this other command to install the python spkg. The entire mashing-up old (and almost always broken) and new packages is insane, and technically savvy users trip over it on a daily basis. As documented on sage-devel. 

This ticket doesn't change `sage --optional`, but IMHO its just as insane that it mashes old and new spkgs together. In any case, this is not what this ticket is about. 

If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url. Weighted against the very real and documented risk that people get confused about standard packages, this is a no-brainer to me.



---

archive/issue_comments_255944.json:
```json
{
    "body": "Replying to [comment:17 vbraun]:\n> Nobody in their right mind is going to want to install the old python spkg.\n\n\nAbsolutely.\n\n> If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url.\n\n\nOkay, but Simon's package is not being distributed outside of Sage: you are proposing with this ticket to move it outside of Sage. I think a deprecation period makes a lot of sense, giving the late-adopters time to update their old-style packages. It is not reasonable, on the other hand, to just say \"we are immediately deleting all old-style packages from the servers with no warning.\"",
    "created_at": "2015-08-17T14:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255944",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:17 vbraun]:
> Nobody in their right mind is going to want to install the old python spkg.


Absolutely.

> If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url.


Okay, but Simon's package is not being distributed outside of Sage: you are proposing with this ticket to move it outside of Sage. I think a deprecation period makes a lot of sense, giving the late-adopters time to update their old-style packages. It is not reasonable, on the other hand, to just say "we are immediately deleting all old-style packages from the servers with no warning."



---

archive/issue_comments_255945.json:
```json
{
    "body": "Well fine then we shall be completely utterly broken for a year, to the extent that William can't even install anything. Cool.",
    "created_at": "2015-08-17T19:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255945",
    "user": "https://github.com/vbraun"
}
```

Well fine then we shall be completely utterly broken for a year, to the extent that William can't even install anything. Cool.



---

archive/issue_comments_255946.json:
```json
{
    "body": "How about this, instead: for old-style packages, if the apropos function finds anything, just print that message and exit. If it doesn't find anything, search the servers and print the URL of the matching package, with instructions on how to install it. Not perfect, but it doesn't just dump all of the old packages.\n\nI also didn't say we had to wait a year. Three months might be enough warning.",
    "created_at": "2015-08-17T19:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255946",
    "user": "https://github.com/jhpalmieri"
}
```

How about this, instead: for old-style packages, if the apropos function finds anything, just print that message and exit. If it doesn't find anything, search the servers and print the URL of the matching package, with instructions on how to install it. Not perfect, but it doesn't just dump all of the old packages.

I also didn't say we had to wait a year. Three months might be enough warning.



---

archive/issue_comments_255947.json:
```json
{
    "body": "How about we move the spkgs to http://old.files.sagemath.org/spkg/archive/ and have apropos print that url if it can't find anything.",
    "created_at": "2015-08-17T20:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255947",
    "user": "https://github.com/vbraun"
}
```

How about we move the spkgs to http://old.files.sagemath.org/spkg/archive/ and have apropos print that url if it can't find anything.



---

archive/issue_comments_255948.json:
```json
{
    "body": "That sounds okay to me.",
    "created_at": "2015-08-17T20:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255948",
    "user": "https://github.com/jhpalmieri"
}
```

That sounds okay to me.



---

archive/issue_comments_255949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T21:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_255950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T21:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_255951.json:
```json
{
    "body": "Actually, http://files.sagemath.org/spkg/ is a better link.\n\nThe spkgs can actualy stay where they are now if we don't search for them.\n\n---\nNew commits:",
    "created_at": "2015-08-17T21:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255951",
    "user": "https://github.com/vbraun"
}
```

Actually, http://files.sagemath.org/spkg/ is a better link.

The spkgs can actualy stay where they are now if we don't search for them.

---
New commits:



---

archive/issue_comments_255952.json:
```json
{
    "body": "It's not ideal (http://files.sagemath.org/spkg/ is not the friendliest web site), but it's basically good enough for me. I would suggest either of the following changes:\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex a9f68a6..9c0c00c 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -57,6 +57,25 @@\n # Avoid surprises with character ranges [a-z] in regular expressions\n export LC_ALL=C\n \n+usage()\n+{\n+cat <<EOF\n+Usage: sage -i <options> <package name>\n+\n+If <package name> is a URL, download and install it. If it is a file\n+name, install it. Otherwise, search Sage's list of packages (see 'sage\n+--package list') for a matching package, and if a match is found,\n+install it.\n+\n+Options:\n+   -f: force install a package even if the same version is already installed\n+   -s: do not delete temporary build directory\n+   -c: after installing, run the test suite for the spkg\n+   -d: only download the package\n+\n+EOF\n+}\n+\n # error_msg(header, command)\n # This is for printing an error message if something went wrong.\n # The first argument is the header to print, the second argument should\n@@ -152,8 +171,8 @@ fi\n # Handle special command-line options\n ##################################################################\n if [ $# -eq 0 ]; then\n-    echo \"Currently installed packages:\"\n-    exec ls -1 \"$SAGE_SPKG_INST\"\n+    usage\n+    exit 0\n fi\n \n # Options have to come in a specific order,\n```\nor\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex a9f68a6..2ddd35b 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -153,7 +153,7 @@ fi\n ##################################################################\n if [ $# -eq 0 ]; then\n     echo \"Currently installed packages:\"\n-    exec ls -1 \"$SAGE_SPKG_INST\"\n+    exec sage-list-packages installed\n fi\n \n # Options have to come in a specific order,\n```\nI have a slight preference for the first, since `sage -i <pkg>` is not very well documented. I also don't think that `sage -i` (with no arguments) is documented anywhere, so maybe it's not a terrible idea to change its behavior. Or we could use the second change and add a `-h` flag for the usage message.\n\n(My goal here is to not leave someone completely baffled if they want to install an old-style package.)\n\nMeanwhile, it would be good to reiterate on sage-devel that old-style packages are on the way out, so people who maintain them should update to new-style packages ASAP.",
    "created_at": "2015-08-17T22:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255952",
    "user": "https://github.com/jhpalmieri"
}
```

It's not ideal (http://files.sagemath.org/spkg/ is not the friendliest web site), but it's basically good enough for me. I would suggest either of the following changes:

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index a9f68a6..9c0c00c 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -57,6 +57,25 @@
 # Avoid surprises with character ranges [a-z] in regular expressions
 export LC_ALL=C
 
+usage()
+{
+cat <<EOF
+Usage: sage -i <options> <package name>
+
+If <package name> is a URL, download and install it. If it is a file
+name, install it. Otherwise, search Sage's list of packages (see 'sage
+--package list') for a matching package, and if a match is found,
+install it.
+
+Options:
+   -f: force install a package even if the same version is already installed
+   -s: do not delete temporary build directory
+   -c: after installing, run the test suite for the spkg
+   -d: only download the package
+
+EOF
+}
+
 # error_msg(header, command)
 # This is for printing an error message if something went wrong.
 # The first argument is the header to print, the second argument should
@@ -152,8 +171,8 @@ fi
 # Handle special command-line options
 ##################################################################
 if [ $# -eq 0 ]; then
-    echo "Currently installed packages:"
-    exec ls -1 "$SAGE_SPKG_INST"
+    usage
+    exit 0
 fi
 
 # Options have to come in a specific order,
```
or

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index a9f68a6..2ddd35b 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -153,7 +153,7 @@ fi
 ##################################################################
 if [ $# -eq 0 ]; then
     echo "Currently installed packages:"
-    exec ls -1 "$SAGE_SPKG_INST"
+    exec sage-list-packages installed
 fi
 
 # Options have to come in a specific order,
```
I have a slight preference for the first, since `sage -i <pkg>` is not very well documented. I also don't think that `sage -i` (with no arguments) is documented anywhere, so maybe it's not a terrible idea to change its behavior. Or we could use the second change and add a `-h` flag for the usage message.

(My goal here is to not leave someone completely baffled if they want to install an old-style package.)

Meanwhile, it would be good to reiterate on sage-devel that old-style packages are on the way out, so people who maintain them should update to new-style packages ASAP.



---

archive/issue_comments_255953.json:
```json
{
    "body": "I'm fine with either, can you add a commit?",
    "created_at": "2015-08-18T17:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255953",
    "user": "https://github.com/vbraun"
}
```

I'm fine with either, can you add a commit?



---

archive/issue_comments_255954.json:
```json
{
    "body": "Sure, here you go.",
    "created_at": "2015-08-18T22:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255954",
    "user": "https://github.com/jhpalmieri"
}
```

Sure, here you go.



---

archive/issue_comments_255955.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-20T13:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255955",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_255956.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-21T01:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18767#issuecomment-255956",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052917.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-21T01:56:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18767",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18767#event-52917"
}
```
