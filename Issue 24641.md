# Issue 24641: function? shows wrong docstring

archive/issues_024641.json:
```json
{
    "body": "The function `function()` from `symbolic/function_factory.py` allows to create symbolic functions on the command line, and it has an excellent docstring which is not shown with `function?` because the function is wrapped by `function()` from `calculus/var.pyx`. Part of the var function needs to be in Cython for specific reason.\n\nThis ticket moves the global function to the one in `function_factory.py`, leaving the part that needs to be in Cython inside `var.pyx`, merging docstrings, and so making it all accessible with `function?`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24878\n\n",
    "created_at": "2018-03-01T16:28:19Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "function? shows wrong docstring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24641",
    "user": "@rwst"
}
```
The function `function()` from `symbolic/function_factory.py` allows to create symbolic functions on the command line, and it has an excellent docstring which is not shown with `function?` because the function is wrapped by `function()` from `calculus/var.pyx`. Part of the var function needs to be in Cython for specific reason.

This ticket moves the global function to the one in `function_factory.py`, leaving the part that needs to be in Cython inside `var.pyx`, merging docstrings, and so making it all accessible with `function?`.

Issue created by migration from https://trac.sagemath.org/ticket/24878





---

archive/issue_comments_345591.json:
```json
{
    "body": "Work on this uncovered that many doctests weren't adapted to the deprecation ticket #17447 but passed nonetheless for some reason.",
    "created_at": "2018-03-02T15:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345591",
    "user": "@rwst"
}
```

Work on this uncovered that many doctests weren't adapted to the deprecation ticket #17447 but passed nonetheless for some reason.



---

archive/issue_comments_345592.json:
```json
{
    "body": "Why not simply copy the good docstring to the `function` function in `src/sage/calcular/var.pyx`? Seems like the simplest solution...",
    "created_at": "2018-03-02T16:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345592",
    "user": "@jdemeyer"
}
```

Why not simply copy the good docstring to the `function` function in `src/sage/calcular/var.pyx`? Seems like the simplest solution...



---

archive/issue_comments_345593.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-03T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345593",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_345594.json:
```json
{
    "body": "So I merged the docstrings.\n----\nNew commits:",
    "created_at": "2018-03-03T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345594",
    "user": "@rwst"
}
```

So I merged the docstrings.
----
New commits:



---

archive/issue_comments_345595.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-28T20:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345595",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_345596.json:
```json
{
    "body": "The patchbot shows failing tests that seems related to the branch:\n\n```\nsage -t --long src/sage/calculus/var.pyx\n**********************************************************************\nFile \"src/sage/calculus/var.pyx\", line 219, in sage.calculus.var.function\nFailed example:\n    g.substitute_function(cr, cos)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 551, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 961, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.calculus.var.function[4]>\", line 1, in <module>\n        g.substitute_function(cr, cos)\n    NameError: name 'g' is not defined\n**********************************************************************\nFile \"src/sage/calculus/var.pyx\", line 222, in sage.calculus.var.function\nFailed example:\n    g.substitute_function(cr, (sin(x) + cos(x)).function(x))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 551, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 961, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.calculus.var.function[5]>\", line 1, in <module>\n        g.substitute_function(cr, (sin(x) + cos(x)).function(x))\n    NameError: name 'g' is not defined\n**********************************************************************\n1 item had failures:\n   2 of  65 in sage.calculus.var.function\n    [95 tests, 2 failures, 1.47 s]\n```\n",
    "created_at": "2018-04-28T20:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345596",
    "user": "@seblabbe"
}
```

The patchbot shows failing tests that seems related to the branch:

```
sage -t --long src/sage/calculus/var.pyx
**********************************************************************
File "src/sage/calculus/var.pyx", line 219, in sage.calculus.var.function
Failed example:
    g.substitute_function(cr, cos)
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 551, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 961, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.var.function[4]>", line 1, in <module>
        g.substitute_function(cr, cos)
    NameError: name 'g' is not defined
**********************************************************************
File "src/sage/calculus/var.pyx", line 222, in sage.calculus.var.function
Failed example:
    g.substitute_function(cr, (sin(x) + cos(x)).function(x))
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 551, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 961, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.var.function[5]>", line 1, in <module>
        g.substitute_function(cr, (sin(x) + cos(x)).function(x))
    NameError: name 'g' is not defined
**********************************************************************
1 item had failures:
   2 of  65 in sage.calculus.var.function
    [95 tests, 2 failures, 1.47 s]
```




---

archive/issue_comments_345597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-30T08:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_345598.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-30T08:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345598",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_345599.json:
```json
{
    "body": "I would start the EXAMPLES with this one:\n\n\n```\nWe create a formal function called supersin ::\n\n[...]\n```\n\n\nand I would put the following block \n\n\n```\n   In Sage 4.0, basic arithmetic with unevaluated functions is no\n   longer supported:\n\n      sage: x = var('x')\n      sage: f = function('f')\n      sage: 2*f\n      Traceback (most recent call last):\n      ...\n      TypeError: unsupported operand parent(s) for *: 'Integer Ring' and '<class\n 'sage.symbolic.function_factory.NewSymbolicFunction'>'\n\n   You now need to evaluate the function in order to do the\n   arithmetic:\n\n      sage: 2*f(x)\n      2*f(x)\n\n   In Sage 4.0, you need to use \"substitute_function()\" to replace all\n   occurrences of a function with another:\n\n      sage: var('a, b')\n      (a, b)\n      sage: cr = function('cr')\n      sage: f = cr(a)\n      sage: g = f.diff(a).integral(b)\n      sage: g\n      b*diff(cr(a), a)\n      sage: g.substitute_function(cr, cos)\n      -b*sin(a)\n\n      sage: g.substitute_function(cr, (sin(x) + cos(x)).function(x))\n      b*(cos(a) - sin(a))\n```\n\n\nsomewhere more below. Do you agree?",
    "created_at": "2018-05-01T08:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345599",
    "user": "@seblabbe"
}
```

I would start the EXAMPLES with this one:


```
We create a formal function called supersin ::

[...]
```


and I would put the following block 


```
   In Sage 4.0, basic arithmetic with unevaluated functions is no
   longer supported:

      sage: x = var('x')
      sage: f = function('f')
      sage: 2*f
      Traceback (most recent call last):
      ...
      TypeError: unsupported operand parent(s) for *: 'Integer Ring' and '<class
 'sage.symbolic.function_factory.NewSymbolicFunction'>'

   You now need to evaluate the function in order to do the
   arithmetic:

      sage: 2*f(x)
      2*f(x)

   In Sage 4.0, you need to use "substitute_function()" to replace all
   occurrences of a function with another:

      sage: var('a, b')
      (a, b)
      sage: cr = function('cr')
      sage: f = cr(a)
      sage: g = f.diff(a).integral(b)
      sage: g
      b*diff(cr(a), a)
      sage: g.substitute_function(cr, cos)
      -b*sin(a)

      sage: g.substitute_function(cr, (sin(x) + cos(x)).function(x))
      b*(cos(a) - sin(a))
```


somewhere more below. Do you agree?



---

archive/issue_comments_345600.json:
```json
{
    "body": "Agreed. Please go ahead.",
    "created_at": "2018-05-01T10:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345600",
    "user": "@rwst"
}
```

Agreed. Please go ahead.



---

archive/issue_comments_345601.json:
```json
{
    "body": "Feel free to change the status to positive review if you agree with the commit.\n----\nNew commits:",
    "created_at": "2018-05-01T14:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345601",
    "user": "@seblabbe"
}
```

Feel free to change the status to positive review if you agree with the commit.
----
New commits:



---

archive/issue_comments_345602.json:
```json
{
    "body": "Thanks.",
    "created_at": "2018-05-02T12:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345602",
    "user": "@rwst"
}
```

Thanks.



---

archive/issue_comments_345603.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-02T12:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345603",
    "user": "@rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_345604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-09T09:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24641#issuecomment-345604",
    "user": "@vbraun"
}
```

Resolution: fixed
