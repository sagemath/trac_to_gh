# Issue 24641: function? shows wrong docstring

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2018-03-01 16:28:19

The function `function()` from `symbolic/function_factory.py` allows to create symbolic functions on the command line, and it has an excellent docstring which is not shown with `function?` because the function is wrapped by `function()` from `calculus/var.pyx`. Part of the var function needs to be in Cython for specific reason.

This ticket moves the global function to the one in `function_factory.py`, leaving the part that needs to be in Cython inside `var.pyx`, merging docstrings, and so making it all accessible with `function?`.


---

Comment by rws created at 2018-03-02 15:20:46

Work on this uncovered that many doctests weren't adapted to the deprecation ticket #17447 but passed nonetheless for some reason.


---

Comment by jdemeyer created at 2018-03-02 16:20:57

Why not simply copy the good docstring to the `function` function in `src/sage/calcular/var.pyx`? Seems like the simplest solution...


---

Comment by rws created at 2018-03-03 07:09:27

Changing status from new to needs_review.


---

Comment by rws created at 2018-03-03 07:09:27

So I merged the docstrings.
----
New commits:


---

Comment by slabbe created at 2018-04-28 20:36:35

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2018-04-28 20:36:35

The patchbot shows failing tests that seems related to the branch:

```
sage -t --long src/sage/calculus/var.pyx
**********************************************************************
File "src/sage/calculus/var.pyx", line 219, in sage.calculus.var.function
Failed example:
    g.substitute_function(cr, cos)
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 551, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 961, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.var.function[4]>", line 1, in <module>
        g.substitute_function(cr, cos)
    NameError: name 'g' is not defined
**********************************************************************
File "src/sage/calculus/var.pyx", line 222, in sage.calculus.var.function
Failed example:
    g.substitute_function(cr, (sin(x) + cos(x)).function(x))
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 551, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 961, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.var.function[5]>", line 1, in <module>
        g.substitute_function(cr, (sin(x) + cos(x)).function(x))
    NameError: name 'g' is not defined
**********************************************************************
1 item had failures:
   2 of  65 in sage.calculus.var.function
    [95 tests, 2 failures, 1.47 s]
```



---

Comment by git created at 2018-04-30 08:58:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-04-30 08:59:29

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2018-05-01 08:28:10

I would start the EXAMPLES with this one:


```
We create a formal function called supersin ::

[...]
```


and I would put the following block 


```
   In Sage 4.0, basic arithmetic with unevaluated functions is no
   longer supported:

      sage: x = var('x')
      sage: f = function('f')
      sage: 2*f
      Traceback (most recent call last):
      ...
      TypeError: unsupported operand parent(s) for *: 'Integer Ring' and '<class
 'sage.symbolic.function_factory.NewSymbolicFunction'>'

   You now need to evaluate the function in order to do the
   arithmetic:

      sage: 2*f(x)
      2*f(x)

   In Sage 4.0, you need to use "substitute_function()" to replace all
   occurrences of a function with another:

      sage: var('a, b')
      (a, b)
      sage: cr = function('cr')
      sage: f = cr(a)
      sage: g = f.diff(a).integral(b)
      sage: g
      b*diff(cr(a), a)
      sage: g.substitute_function(cr, cos)
      -b*sin(a)

      sage: g.substitute_function(cr, (sin(x) + cos(x)).function(x))
      b*(cos(a) - sin(a))
```


somewhere more below. Do you agree?


---

Comment by rws created at 2018-05-01 10:36:10

Agreed. Please go ahead.


---

Comment by slabbe created at 2018-05-01 14:57:47

Feel free to change the status to positive review if you agree with the commit.
----
New commits:


---

Comment by rws created at 2018-05-02 12:37:26

Thanks.


---

Comment by rws created at 2018-05-02 12:37:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-09 09:49:47

Resolution: fixed
