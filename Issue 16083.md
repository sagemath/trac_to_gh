# Issue 16083: Handle finite slices for infinite enumerate sets

archive/issues_016083.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat nthiery darij\n\nKeywords: infinite enumerated set slices\n\nGiven an infinite enumerated set `I`, I'd still expect this to work (and it's very handy):\n\n```\nsage: Partitions()[:5]\n[[], [1], [2], [1, 1], [3]]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16320\n\n",
    "created_at": "2014-05-10T02:16:37Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "title": "Handle finite slices for infinite enumerate sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16083",
    "user": "tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat nthiery darij

Keywords: infinite enumerated set slices

Given an infinite enumerated set `I`, I'd still expect this to work (and it's very handy):

```
sage: Partitions()[:5]
[[], [1], [2], [1, 1], [3]]
```


Issue created by migration from https://trac.sagemath.org/ticket/16320





---

archive/issue_comments_209505.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-10T02:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209505",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_209506.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-05-10T02:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209506",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_209507.json:
```json
{
    "body": "Hellooooooo Travis !!\n\nOkay, this looks very cool but I have two questions:\n\n1) Right now, if an infinite enumerated sets wants to implement `__getitem__` differently (as unrank can be VERY slow) then the slicing feature will be overwritten. Is there a way to avoid that ?\n\n2) To me, computing the slice [:15] should call `__iter__`, which may have been overwritten too. What d you think ?\n\nThose are probems I see with how this is implemented in your branch, but I do not know how to make it better, so I just ask. I am running all tests right now, and if they pass this branch can be set to `positive_review` if we cannot solve any of the problems above `:-)`\n\nNathann",
    "created_at": "2014-05-10T11:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209507",
    "user": "ncohen"
}
```

Hellooooooo Travis !!

Okay, this looks very cool but I have two questions:

1) Right now, if an infinite enumerated sets wants to implement `__getitem__` differently (as unrank can be VERY slow) then the slicing feature will be overwritten. Is there a way to avoid that ?

2) To me, computing the slice [:15] should call `__iter__`, which may have been overwritten too. What d you think ?

Those are probems I see with how this is implemented in your branch, but I do not know how to make it better, so I just ask. I am running all tests right now, and if they pass this branch can be set to `positive_review` if we cannot solve any of the problems above `:-)`

Nathann



---

archive/issue_comments_209508.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-10T17:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209508",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209509.json:
```json
{
    "body": "1) This is a generic implementation (i.e. think in an abstract class), so I can't do anything about when it's overwritten except possibly adding it in in each of those classes directly (which I don't want to do). I would instead recommend having those classes implement `unrank`, if also to avoid ambiguity with things like `ZZ['x']`.\n\n2) Done.",
    "created_at": "2014-05-10T17:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209509",
    "user": "tscrim"
}
```

1) This is a generic implementation (i.e. think in an abstract class), so I can't do anything about when it's overwritten except possibly adding it in in each of those classes directly (which I don't want to do). I would instead recommend having those classes implement `unrank`, if also to avoid ambiguity with things like `ZZ['x']`.

2) Done.



---

archive/issue_comments_209510.json:
```json
{
    "body": "This kind of slices can indeed come up handy; thanks for implementing\nthem!\n\nCould we put it instead in `EnumeratedSets`? This would just require updating\na bit the bound checks, possibly testing if ``self in\nSets().Infinite()``, right?\n\nAlso please make the doc read along the following lines::\n\n```\nReturn the `i`-th element of ``self``, or the slice ...\n\nINPUT:\n...\n\n.. WARNING::\n\n    This method is only meant as a convenience shorthand for\n    ``self.unrank(i)`` and ``self.foo(...)`` respectively, for casual\n    use (e.g. in interactive sessions). Subclasses are hereby\n    explicitly permitted to overload ``__getitem__`` with a different\n    semantic, typically for enumerated sets that are naturally indexed\n    by some `I` not of the form `\\{0,1,...\\}`.\n\n    ... EXAMPLE HERE, typically with an infinite family ...\n\n    In particular, generic code *should not* use this shorthand.\n```\n\n\nAny suggestion for the name `foo` we should use for the analog of\nunrank for slices?\n\nCheers,\n                        Nicolas",
    "created_at": "2014-05-11T18:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209510",
    "user": "nthiery"
}
```

This kind of slices can indeed come up handy; thanks for implementing
them!

Could we put it instead in `EnumeratedSets`? This would just require updating
a bit the bound checks, possibly testing if ``self in
Sets().Infinite()``, right?

Also please make the doc read along the following lines::

```
Return the `i`-th element of ``self``, or the slice ...

INPUT:
...

.. WARNING::

    This method is only meant as a convenience shorthand for
    ``self.unrank(i)`` and ``self.foo(...)`` respectively, for casual
    use (e.g. in interactive sessions). Subclasses are hereby
    explicitly permitted to overload ``__getitem__`` with a different
    semantic, typically for enumerated sets that are naturally indexed
    by some `I` not of the form `\{0,1,...\}`.

    ... EXAMPLE HERE, typically with an infinite family ...

    In particular, generic code *should not* use this shorthand.
```


Any suggestion for the name `foo` we should use for the analog of
unrank for slices?

Cheers,
                        Nicolas



---

archive/issue_comments_209511.json:
```json
{
    "body": "How about we just use `unrank`? Alternatively perhaps `slice` or `range`?",
    "created_at": "2014-05-11T19:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209511",
    "user": "tscrim"
}
```

How about we just use `unrank`? Alternatively perhaps `slice` or `range`?



---

archive/issue_comments_209512.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> How about we just use `unrank`? Alternatively perhaps `slice` or `range`?\n\nUsing `unrank` puts more burden on subclasses that implement `unrank`: they would also need to take care of slices. Having a separate method for slices makes it easy to, e.g. provide default implementations for `slice` in term of `unrank` (or in term of `unrank` and `next` or ...).\n\nOther than this, I have no particular preference yet. Another possibility: `unrank_range`.\n\nCheers,",
    "created_at": "2014-05-11T20:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209512",
    "user": "nthiery"
}
```

Replying to [comment:7 tscrim]:
> How about we just use `unrank`? Alternatively perhaps `slice` or `range`?

Using `unrank` puts more burden on subclasses that implement `unrank`: they would also need to take care of slices. Having a separate method for slices makes it easy to, e.g. provide default implementations for `slice` in term of `unrank` (or in term of `unrank` and `next` or ...).

Other than this, I have no particular preference yet. Another possibility: `unrank_range`.

Cheers,



---

archive/issue_comments_209513.json:
```json
{
    "body": "Helloooooooo !!!\n\n> 1) This is a generic implementation (i.e. think in an abstract class), so I can't do anything about when it's overwritten except possibly adding it in in each of those classes directly (which I don't want to do). I would instead recommend having those classes implement `unrank`, if also to avoid ambiguity with things like `ZZ['x']`.\n> \n> 2) Done.\n\nOkayokay, then the result is good to me.. Too bad we cannot solve this once and for all `:-)`\n\nNathann",
    "created_at": "2014-05-12T09:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209513",
    "user": "ncohen"
}
```

Helloooooooo !!!

> 1) This is a generic implementation (i.e. think in an abstract class), so I can't do anything about when it's overwritten except possibly adding it in in each of those classes directly (which I don't want to do). I would instead recommend having those classes implement `unrank`, if also to avoid ambiguity with things like `ZZ['x']`.
> 
> 2) Done.

Okayokay, then the result is good to me.. Too bad we cannot solve this once and for all `:-)`

Nathann



---

archive/issue_comments_209514.json:
```json
{
    "body": "Grr...polymorphism would be nice. `unrank_range` would be okay for me; want me to implement that Nicolas?",
    "created_at": "2014-05-12T21:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209514",
    "user": "tscrim"
}
```

Grr...polymorphism would be nice. `unrank_range` would be okay for me; want me to implement that Nicolas?



---

archive/issue_comments_209515.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> Grr...polymorphism would be nice.\n\nYou bet ...\n\n> `unrank_range` would be okay for me; want me to implement that Nicolas?\n\nIf that's ok with you, please go ahead!",
    "created_at": "2014-05-12T22:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209515",
    "user": "nthiery"
}
```

Replying to [comment:10 tscrim]:
> Grr...polymorphism would be nice.

You bet ...

> `unrank_range` would be okay for me; want me to implement that Nicolas?

If that's ok with you, please go ahead!



---

archive/issue_comments_209516.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T22:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209516",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209517.json:
```json
{
    "body": "Done.",
    "created_at": "2014-05-12T22:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209517",
    "user": "tscrim"
}
```

Done.



---

archive/issue_comments_209518.json:
```json
{
    "body": "Thanks Travis!\n\nThe logic is broken for finite enumerated sets:\n\n```\nsage: F = FiniteEnumeratedSet([1,2,3])\nsage: F[1:]\n...\nTypeError: range() integer end argument expected, got NoneType.\n```\n\n(in the current examples, `.list()` has already been called, so this piece of the code was not exercised). It might be an option to call `__getitem__` from `EnumeratedSets` to avoid duplicating the logic.\n\nPlease also add the warnings along the lines of [comment:6].",
    "created_at": "2014-05-13T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209518",
    "user": "nthiery"
}
```

Thanks Travis!

The logic is broken for finite enumerated sets:

```
sage: F = FiniteEnumeratedSet([1,2,3])
sage: F[1:]
...
TypeError: range() integer end argument expected, got NoneType.
```

(in the current examples, `.list()` has already been called, so this piece of the code was not exercised). It might be an option to call `__getitem__` from `EnumeratedSets` to avoid duplicating the logic.

Please also add the warnings along the lines of [comment:6].



---

archive/issue_comments_209519.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-13T17:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209519",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209520.json:
```json
{
    "body": "Fixed, added, and updated.",
    "created_at": "2014-05-13T17:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209520",
    "user": "tscrim"
}
```

Fixed, added, and updated.



---

archive/issue_comments_209521.json:
```json
{
    "body": "Thanks. ``__getitem__`` is no more needed in finite enumerated sets, right?\n\nAh, and I just thought: if it's easy to add functional crosslinks to ``unrank`` and ``unrank_range``, that would be a nice addition.\n\nCheers,\n                             Nicolas",
    "created_at": "2014-05-13T20:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209521",
    "user": "nthiery"
}
```

Thanks. ``__getitem__`` is no more needed in finite enumerated sets, right?

Ah, and I just thought: if it's easy to add functional crosslinks to ``unrank`` and ``unrank_range``, that would be a nice addition.

Cheers,
                             Nicolas



---

archive/issue_comments_209522.json:
```json
{
    "body": "The `__getitem__` I have for finite enumerated sets should be faster than calling through `unrank()`. I can't add crosslinks because there is no explicitly defined function `unrank` (at least that I could find).",
    "created_at": "2014-05-13T20:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209522",
    "user": "tscrim"
}
```

The `__getitem__` I have for finite enumerated sets should be faster than calling through `unrank()`. I can't add crosslinks because there is no explicitly defined function `unrank` (at least that I could find).



---

archive/issue_comments_209523.json:
```json
{
    "body": "> The `__getitem__` I have for finite enumerated sets should be faster than calling through unrank().\n\nIt seems to just duplicate the code of `unrank_range` for finite enumerated sets (which you made fast), and the `__getitem__` of enumerated sets will call that `unrank_range` anyway.\n\n> I can't add crosslinks because there is no explicitly defined function unrank (at least that I could find). \n\nToo bad, we really should have an optional abstract method for `unrank` ...",
    "created_at": "2014-05-13T21:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209523",
    "user": "nthiery"
}
```

> The `__getitem__` I have for finite enumerated sets should be faster than calling through unrank().

It seems to just duplicate the code of `unrank_range` for finite enumerated sets (which you made fast), and the `__getitem__` of enumerated sets will call that `unrank_range` anyway.

> I can't add crosslinks because there is no explicitly defined function unrank (at least that I could find). 

Too bad, we really should have an optional abstract method for `unrank` ...



---

archive/issue_comments_209524.json:
```json
{
    "body": "It's an extra function call (plus some extra logic); so it's a micro optimization but still some speed:\n\n```\nsage: def foo():\n....:     return 5\n....: \nsage: def bar():\n....:     return foo()\n....: \nsage: %timeit foo()\n1000000 loops, best of 3: 504 ns per loop\nsage: %timeit bar()\n1000000 loops, best of 3: 773 ns per loop\n```\n\nplus it's only a few lines, so I don't see much harm.",
    "created_at": "2014-05-13T22:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209524",
    "user": "tscrim"
}
```

It's an extra function call (plus some extra logic); so it's a micro optimization but still some speed:

```
sage: def foo():
....:     return 5
....: 
sage: def bar():
....:     return foo()
....: 
sage: %timeit foo()
1000000 loops, best of 3: 504 ns per loop
sage: %timeit bar()
1000000 loops, best of 3: 773 ns per loop
```

plus it's only a few lines, so I don't see much harm.



---

archive/issue_comments_209525.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> It's an extra function call (plus some extra logic); so it's a micro optimization but still some speed:\n> {{{\n> sage: def foo():\n> ....:     return 5\n> ....: \n> sage: def bar():\n> ....:     return foo()\n> ....: \n> sage: %timeit foo()\n> 1000000 loops, best of 3: 504 ns per loop\n> sage: %timeit bar()\n> 1000000 loops, best of 3: 773 ns per loop\n> }}}\n> plus it's only a few lines, so I don't see much harm.\n\nNot much I agree. Yet, in general, unless when we really are in a critical path/section, I'd rather not start manually inlining method calls. If you add the extra slice and so on the optimization does not make such a big difference, and it still introduces some duplication: you have to explicitly look at the code to see that it's doing the same thing. And if someone has a better `unrank_range` (granted, this is unlikely), you don't beneficiate from it automatically.\n\nCheers,\n                                                    Nicolas",
    "created_at": "2014-05-14T22:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209525",
    "user": "nthiery"
}
```

Replying to [comment:20 tscrim]:
> It's an extra function call (plus some extra logic); so it's a micro optimization but still some speed:
> {{{
> sage: def foo():
> ....:     return 5
> ....: 
> sage: def bar():
> ....:     return foo()
> ....: 
> sage: %timeit foo()
> 1000000 loops, best of 3: 504 ns per loop
> sage: %timeit bar()
> 1000000 loops, best of 3: 773 ns per loop
> }}}
> plus it's only a few lines, so I don't see much harm.

Not much I agree. Yet, in general, unless when we really are in a critical path/section, I'd rather not start manually inlining method calls. If you add the extra slice and so on the optimization does not make such a big difference, and it still introduces some duplication: you have to explicitly look at the code to see that it's doing the same thing. And if someone has a better `unrank_range` (granted, this is unlikely), you don't beneficiate from it automatically.

Cheers,
                                                    Nicolas



---

archive/issue_comments_209526.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-15T21:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209526",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-15T21:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209527",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209528.json:
```json
{
    "body": "Changed (under slight protest). However I did uncover other bugs, in that we needed to better handle negative values and larger than len stopping conditions.",
    "created_at": "2014-05-15T21:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209528",
    "user": "tscrim"
}
```

Changed (under slight protest). However I did uncover other bugs, in that we needed to better handle negative values and larger than len stopping conditions.



---

archive/issue_comments_209529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-26T03:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209529",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209530.json:
```json
{
    "body": "some failing doctests, see patchbot report",
    "created_at": "2015-04-08T06:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209530",
    "user": "chapoton"
}
```

some failing doctests, see patchbot report



---

archive/issue_comments_209531.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-08T06:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209531",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-10T23:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209532",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209533.json:
```json
{
    "body": "Ah, the little tidbits I've forgotten...",
    "created_at": "2016-03-10T23:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209533",
    "user": "tscrim"
}
```

Ah, the little tidbits I've forgotten...



---

archive/issue_comments_209534.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-10T23:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209534",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209535.json:
```json
{
    "body": "What about an iterator counterpart?\n\n```\ndef iterator(self, start=None, end=None, backward=False):\n    r\"\"\"\n    Iterates over the item in this set between the rank ``start`` and ``end``.\n    \"\"\"\n```\n\nthat would even be more useful (e.g. parallel loops).\n\nThen we can make a cross implementation in the `ParentMethods` (i.e. `__iter__` calling `iterator` and `iterator` calling `__iter__`). Or possibly using `unrank`.\n\nWhat do you think?",
    "created_at": "2016-03-11T20:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209535",
    "user": "vdelecroix"
}
```

What about an iterator counterpart?

```
def iterator(self, start=None, end=None, backward=False):
    r"""
    Iterates over the item in this set between the rank ``start`` and ``end``.
    """
```

that would even be more useful (e.g. parallel loops).

Then we can make a cross implementation in the `ParentMethods` (i.e. `__iter__` calling `iterator` and `iterator` calling `__iter__`). Or possibly using `unrank`.

What do you think?



---

archive/issue_comments_209536.json:
```json
{
    "body": "This breaks several doctests, some of which indicate things we definitely should support, specifically negative indices. Probably should try `self.list()[i]` first in `__getitem__` for enumerated sets and for finite enumerated sets, we should do `self.list()[i]` if `i < 0`.\n\nWe probably should also rewrite the iterator and listing methods for (finite?) enumerated sets to use a lazy list, but I think that is best on a follow-up.\n\nFor an `iterator` method, I would call it `iterator_range` for consistency, but I'm not opposed to it. Moreover, the logic from `unrank_range` could probably all be moved there and `unrank_range` just returns a list constructed from `iterator_range`.",
    "created_at": "2016-03-11T23:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209536",
    "user": "tscrim"
}
```

This breaks several doctests, some of which indicate things we definitely should support, specifically negative indices. Probably should try `self.list()[i]` first in `__getitem__` for enumerated sets and for finite enumerated sets, we should do `self.list()[i]` if `i < 0`.

We probably should also rewrite the iterator and listing methods for (finite?) enumerated sets to use a lazy list, but I think that is best on a follow-up.

For an `iterator` method, I would call it `iterator_range` for consistency, but I'm not opposed to it. Moreover, the logic from `unrank_range` could probably all be moved there and `unrank_range` just returns a list constructed from `iterator_range`.



---

archive/issue_comments_209537.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-11T23:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209537",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-12T00:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209538",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209539.json:
```json
{
    "body": "Alright, so I tried to allow the iterator to go over the infinite sets if `stop` was not specified. I also had to implement some methods for Galois groups `G` as they did not have `list(G) == G.list()`, but they will be faster than the generic implementation this way too.\n\nI'm slightly worried we will see a speed regression on finite enumerated sets because it will be repeatedly calling `unrank`, which is asymptotically significantly slower than created the full list of elements and pulling from that (i.e., it is implicitly using a cache). My intuition tells me that this will not likely be used in practice (well, at least doing something like `P[i]` in a tight loop), but perhaps your experience/intuition says different?",
    "created_at": "2016-03-12T01:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209539",
    "user": "tscrim"
}
```

Alright, so I tried to allow the iterator to go over the infinite sets if `stop` was not specified. I also had to implement some methods for Galois groups `G` as they did not have `list(G) == G.list()`, but they will be faster than the generic implementation this way too.

I'm slightly worried we will see a speed regression on finite enumerated sets because it will be repeatedly calling `unrank`, which is asymptotically significantly slower than created the full list of elements and pulling from that (i.e., it is implicitly using a cache). My intuition tells me that this will not likely be used in practice (well, at least doing something like `P[i]` in a tight loop), but perhaps your experience/intuition says different?



---

archive/issue_comments_209540.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-12T01:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209540",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209541.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-15T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209541",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209542.json:
```json
{
    "body": "you should use \"next(it)\" and not \"it.next()\" (for python3 compatibility)",
    "created_at": "2016-05-15T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209542",
    "user": "chapoton"
}
```

you should use "next(it)" and not "it.next()" (for python3 compatibility)



---

archive/issue_comments_209543.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-26T10:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209543",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209544.json:
```json
{
    "body": "Fixed. I also rebased the branch (hence the new name) to clean up the history slightly.\n----\nLast 10 new commits:",
    "created_at": "2016-05-26T10:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209544",
    "user": "tscrim"
}
```

Fixed. I also rebased the branch (hence the new name) to clean up the history slightly.
----
Last 10 new commits:



---

archive/issue_comments_209545.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-06T17:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209545",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-06T17:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209546",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209547.json:
```json
{
    "body": "The code is good, but can we be sure that the new `__getitem__` on `EnumeratedSets` does not override an older, better `__getitem__` on `EnumeratedSets` or one of its subclasses? (I suppose the change to Galois groups was an instance of precisely this problem.)",
    "created_at": "2016-10-06T17:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209547",
    "user": "darij"
}
```

The code is good, but can we be sure that the new `__getitem__` on `EnumeratedSets` does not override an older, better `__getitem__` on `EnumeratedSets` or one of its subclasses? (I suppose the change to Galois groups was an instance of precisely this problem.)



---

archive/issue_comments_209548.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-06T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209548",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209549.json:
```json
{
    "body": "Setting positive_review, but tagging a couple more people for the case the changes trigger some landmine somwehere far away (the new `__getitem__` on `EnumeratedSets` seems to override the more hands-off `__getitem__` on `Parent`; I might imagine that for some subclasses of `EnumeratedSets`, the latter gives better results or is faster).",
    "created_at": "2016-10-07T19:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209549",
    "user": "darij"
}
```

Setting positive_review, but tagging a couple more people for the case the changes trigger some landmine somwehere far away (the new `__getitem__` on `EnumeratedSets` seems to override the more hands-off `__getitem__` on `Parent`; I might imagine that for some subclasses of `EnumeratedSets`, the latter gives better results or is faster).



---

archive/issue_comments_209550.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-07T19:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209550",
    "user": "darij"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_209551.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16083#issuecomment-209551",
    "user": "vbraun"
}
```

Resolution: fixed
