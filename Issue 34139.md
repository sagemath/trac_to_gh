# Issue 34139: Set_object_enumerated should be in FiniteEnumeratedSets()

archive/issues_034139.json:
```json
{
    "body": "CC:  @tscrim\n\n\n```\nsage: Set([0, 1, 2, 3])\n{0, 1, 2, 3}\nsage: _.category()\nCategory of finite sets\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34376\n\n",
    "created_at": "2022-08-16T20:36:15Z",
    "labels": [
        "categories",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Set_object_enumerated should be in FiniteEnumeratedSets()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34139",
    "user": "@mkoeppe"
}
```
CC:  @tscrim


```
sage: Set([0, 1, 2, 3])
{0, 1, 2, 3}
sage: _.category()
Category of finite sets
```


Issue created by migration from https://trac.sagemath.org/ticket/34376





---

archive/issue_comments_484316.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-08-17T18:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484316",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_484317.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-17T20:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484317",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T00:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484318",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484319.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-18T00:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484319",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484320.json:
```json
{
    "body": "You shouldn't need the `cardinality()` method as that should be given by the category.\n\nYou can simplify these checks:\n\n```diff\n-        if all(S in Sets().Finite() for S in (X, Y)):\n-            category = category.Finite()\n         if all(S in Sets().Enumerated() for S in (X, Y)):\n             category = category.Enumerated()\n         if any(S in Sets().Infinite() for S in (X, Y)):\n             category = category.Infinite()\n+        elif all(S in Sets().Finite() for S in (X, Y)):\n+            category = category.Finite()\n         Set_object_binary.__init__(self, X, Y, \"union\", \"\\\\cup\", category=category)\n```\n\n\n```diff\n-        if X in Sets().Finite():\n-            category = category.Finite()\n         if X in Sets().Enumerated():\n             category = category.Enumerated()\n+        if X in Sets().Finite():\n+            category = category.Finite()\n+        elif X in Sets().Infinite() and Y in Sets().Finite():\n-        if X in Sets().Infinite() and Y in Sets().Finite():\n             category = category.Infinite()\n         Set_object_binary.__init__(self, X, Y, \"difference\", \"-\", category=category)\n```\n\n\nI am also slightly worried about this change:\n\n```diff\ndiff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py\nindex 563a802..e1dcbd8 100644\n--- a/src/sage/categories/enumerated_sets.py\n+++ b/src/sage/categories/enumerated_sets.py\n@@ -137,7 +137,7 @@ class EnumeratedSets(CategoryWithAxiom):\n             sage: S = EnumeratedSets()(Set([1, 2, 3])); S\n             {1, 2, 3}\n             sage: S.category()\n-            Category of facade finite enumerated sets\n+            Category of finite enumerated sets\n \n         Also Python3 range are now accepted::\n \n```\n\nCan you explain why this happened? I can't see the reason immediately from your changes.",
    "created_at": "2022-08-18T02:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484320",
    "user": "@tscrim"
}
```

You shouldn't need the `cardinality()` method as that should be given by the category.

You can simplify these checks:

```diff
-        if all(S in Sets().Finite() for S in (X, Y)):
-            category = category.Finite()
         if all(S in Sets().Enumerated() for S in (X, Y)):
             category = category.Enumerated()
         if any(S in Sets().Infinite() for S in (X, Y)):
             category = category.Infinite()
+        elif all(S in Sets().Finite() for S in (X, Y)):
+            category = category.Finite()
         Set_object_binary.__init__(self, X, Y, "union", "\\cup", category=category)
```


```diff
-        if X in Sets().Finite():
-            category = category.Finite()
         if X in Sets().Enumerated():
             category = category.Enumerated()
+        if X in Sets().Finite():
+            category = category.Finite()
+        elif X in Sets().Infinite() and Y in Sets().Finite():
-        if X in Sets().Infinite() and Y in Sets().Finite():
             category = category.Infinite()
         Set_object_binary.__init__(self, X, Y, "difference", "-", category=category)
```


I am also slightly worried about this change:

```diff
diff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py
index 563a802..e1dcbd8 100644
--- a/src/sage/categories/enumerated_sets.py
+++ b/src/sage/categories/enumerated_sets.py
@@ -137,7 +137,7 @@ class EnumeratedSets(CategoryWithAxiom):
             sage: S = EnumeratedSets()(Set([1, 2, 3])); S
             {1, 2, 3}
             sage: S.category()
-            Category of facade finite enumerated sets
+            Category of finite enumerated sets
 
         Also Python3 range are now accepted::
 
```

Can you explain why this happened? I can't see the reason immediately from your changes.



---

archive/issue_comments_484321.json:
```json
{
    "body": "Thanks! I agree with these simplifications.\n\nI'll investigate how the facade got lost",
    "created_at": "2022-08-18T03:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484321",
    "user": "@mkoeppe"
}
```

Thanks! I agree with these simplifications.

I'll investigate how the facade got lost



---

archive/issue_comments_484322.json:
```json
{
    "body": "By the way, should these `Set_object` parents all become facade parents?",
    "created_at": "2022-08-18T03:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484322",
    "user": "@mkoeppe"
}
```

By the way, should these `Set_object` parents all become facade parents?



---

archive/issue_comments_484323.json:
```json
{
    "body": "I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.",
    "created_at": "2022-08-18T03:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484323",
    "user": "@tscrim"
}
```

I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.



---

archive/issue_comments_484324.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> I am also slightly worried about this change:\n> {{{#!diff\n> diff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py\n> index 563a802..e1dcbd8 100644\n> --- a/src/sage/categories/enumerated_sets.py\n> +++ b/src/sage/categories/enumerated_sets.py\n> `@``@` -137,7 +137,7 `@``@` class EnumeratedSets(CategoryWithAxiom):\n>              sage: S = EnumeratedSets()(Set([1, 2, 3])); S\n>              {1, 2, 3}\n>              sage: S.category()\n> -            Category of facade finite enumerated sets\n> +            Category of finite enumerated sets\n>  \n>          Also Python3 range are now accepted::\n>  \n> }}}\n> Can you explain why this happened?\n\nSet([1, 2, 3]) is already in `EnumeratedSets()`, so passing `EnumeratedSets._call_` does not have to construct another wrapper.",
    "created_at": "2022-08-18T03:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484324",
    "user": "@mkoeppe"
}
```

Replying to [comment:8 tscrim]:
> I am also slightly worried about this change:
> {{{#!diff
> diff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py
> index 563a802..e1dcbd8 100644
> --- a/src/sage/categories/enumerated_sets.py
> +++ b/src/sage/categories/enumerated_sets.py
> `@``@` -137,7 +137,7 `@``@` class EnumeratedSets(CategoryWithAxiom):
>              sage: S = EnumeratedSets()(Set([1, 2, 3])); S
>              {1, 2, 3}
>              sage: S.category()
> -            Category of facade finite enumerated sets
> +            Category of finite enumerated sets
>  
>          Also Python3 range are now accepted::
>  
> }}}
> Can you explain why this happened?

Set([1, 2, 3]) is already in `EnumeratedSets()`, so passing `EnumeratedSets._call_` does not have to construct another wrapper.



---

archive/issue_comments_484325.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T03:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484325",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484326.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n>> should these Set_object parents all become facade parents?\n> I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.\n\nI'll do this in #34387",
    "created_at": "2022-08-18T03:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484326",
    "user": "@mkoeppe"
}
```

Replying to [comment:11 tscrim]:
>> should these Set_object parents all become facade parents?
> I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.

I'll do this in #34387



---

archive/issue_comments_484327.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T03:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484327",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484328.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> You shouldn't need the `cardinality()` method as that should be given by the category.\n\nThe new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.\n\nNow why exactly `Set_object_binary` subclasses `Set_object` is another question but not one for this ticket",
    "created_at": "2022-08-18T05:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484328",
    "user": "@mkoeppe"
}
```

Replying to [comment:8 tscrim]:
> You shouldn't need the `cardinality()` method as that should be given by the category.

The new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.

Now why exactly `Set_object_binary` subclasses `Set_object` is another question but not one for this ticket



---

archive/issue_comments_484329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T05:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484329",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484330.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> Replying to [comment:8 tscrim]:\n> > You shouldn't need the `cardinality()` method as that should be given by the category.\n> \n> The new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.\n\nAh, because of `Set_object`. Then we should change things in the base class. Perhaps `Set_object.is_finite()` should also test the category?",
    "created_at": "2022-08-19T01:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484330",
    "user": "@tscrim"
}
```

Replying to [comment:17 mkoeppe]:
> Replying to [comment:8 tscrim]:
> > You shouldn't need the `cardinality()` method as that should be given by the category.
> 
> The new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.

Ah, because of `Set_object`. Then we should change things in the base class. Perhaps `Set_object.is_finite()` should also test the category?



---

archive/issue_comments_484331.json:
```json
{
    "body": "Good idea.",
    "created_at": "2022-08-19T01:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484331",
    "user": "@mkoeppe"
}
```

Good idea.



---

archive/issue_comments_484332.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-19T01:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484332",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484333.json:
```json
{
    "body": "This ended up being a good test:\n\n```\nsage: X = S.difference(T); X\nSet-theoretic difference of Set of elements of Rational Field and Set of elements of Integer Ring\nsage: X.category()\nCategory of sets\n```\n\nbecause `QQ` does have a (canonical) enumeration that isn't recognized by Sage:\n\n```\nsage: QQ in EnumeratedSets()\nFalse\n```\n\nHowever, fixing that is for another ticket.",
    "created_at": "2022-08-20T05:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484333",
    "user": "@tscrim"
}
```

This ended up being a good test:

```
sage: X = S.difference(T); X
Set-theoretic difference of Set of elements of Rational Field and Set of elements of Integer Ring
sage: X.category()
Category of sets
```

because `QQ` does have a (canonical) enumeration that isn't recognized by Sage:

```
sage: QQ in EnumeratedSets()
False
```

However, fixing that is for another ticket.



---

archive/issue_comments_484334.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-20T05:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484334",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484335.json:
```json
{
    "body": "Yes, I was briefly surprised by this one.",
    "created_at": "2022-08-20T06:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484335",
    "user": "@mkoeppe"
}
```

Yes, I was briefly surprised by this one.



---

archive/issue_comments_484336.json:
```json
{
    "body": "By the way, I'm a bit annoyed by `EnumeratedSets.ParentMethods.__getitem__` (which is the same as unrank). Do you think people use that at all?",
    "created_at": "2022-08-20T06:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484336",
    "user": "@mkoeppe"
}
```

By the way, I'm a bit annoyed by `EnumeratedSets.ParentMethods.__getitem__` (which is the same as unrank). Do you think people use that at all?



---

archive/issue_comments_484337.json:
```json
{
    "body": "It is quite possible that people in combinatorics use it. For example, things like\n\n```\nsage: ASM = AlternatingSignMatrices(4)\nsage: ASM[1:3]\n[\n[0 1 0 0]  [1 0 0 0]\n[1 0 0 0]  [0 0 1 0]\n[0 0 1 0]  [0 1 0 0]\n[0 0 0 1], [0 0 0 1]\n]\n```\n\nshould call it (the implementation does a redirect to the category).",
    "created_at": "2022-08-20T06:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484337",
    "user": "@tscrim"
}
```

It is quite possible that people in combinatorics use it. For example, things like

```
sage: ASM = AlternatingSignMatrices(4)
sage: ASM[1:3]
[
[0 1 0 0]  [1 0 0 0]
[1 0 0 0]  [0 0 1 0]
[0 0 1 0]  [0 1 0 0]
[0 0 0 1], [0 0 0 1]
]
```

should call it (the implementation does a redirect to the category).



---

archive/issue_comments_484338.json:
```json
{
    "body": "There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. \n\nAlso one could maybe have something like an `as_sequence` method that would return a `SequenceView` (and thus give [] and slicing), see #32100\n\nBut that's for another ticket. Thanks for the review!",
    "created_at": "2022-08-20T06:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484338",
    "user": "@mkoeppe"
}
```

There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. 

Also one could maybe have something like an `as_sequence` method that would return a `SequenceView` (and thus give [] and slicing), see #32100

But that's for another ticket. Thanks for the review!



---

archive/issue_comments_484339.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. \n\nThat would negate a fair part of the category framework, it removes the fact that an enumerated set should (generally) behave like a list, and essentially every `EnumeratedSet` would have this proposed mixin class (thus being a code smell for why isn't in the category).\n\n> But that's for another ticket. Thanks for the review!\n\nIndeed. No problem.",
    "created_at": "2022-08-21T23:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484339",
    "user": "@tscrim"
}
```

Replying to [comment:26 mkoeppe]:
> There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. 

That would negate a fair part of the category framework, it removes the fact that an enumerated set should (generally) behave like a list, and essentially every `EnumeratedSet` would have this proposed mixin class (thus being a code smell for why isn't in the category).

> But that's for another ticket. Thanks for the review!

Indeed. No problem.



---

archive/issue_comments_484340.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-30T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34139#issuecomment-484340",
    "user": "@vbraun"
}
```

Resolution: fixed
