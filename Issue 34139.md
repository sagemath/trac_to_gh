# Issue 34139: Set_object_enumerated should be in FiniteEnumeratedSets()

Issue created by migration from https://trac.sagemath.org/ticket/34376

Original creator: mkoeppe

Original creation time: 2022-08-16 20:36:15

CC:  tscrim


```
sage: Set([0, 1, 2, 3])
{0, 1, 2, 3}
sage: _.category()
Category of finite sets
```



---

Comment by mkoeppe created at 2022-08-17 18:47:52

New commits:


---

Comment by git created at 2022-08-17 20:35:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-18 00:26:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-18 00:32:31

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-08-18 02:38:42

You shouldn't need the `cardinality()` method as that should be given by the category.

You can simplify these checks:

```diff
-        if all(S in Sets().Finite() for S in (X, Y)):
-            category = category.Finite()
         if all(S in Sets().Enumerated() for S in (X, Y)):
             category = category.Enumerated()
         if any(S in Sets().Infinite() for S in (X, Y)):
             category = category.Infinite()
+        elif all(S in Sets().Finite() for S in (X, Y)):
+            category = category.Finite()
         Set_object_binary.__init__(self, X, Y, "union", "\\cup", category=category)
```


```diff
-        if X in Sets().Finite():
-            category = category.Finite()
         if X in Sets().Enumerated():
             category = category.Enumerated()
+        if X in Sets().Finite():
+            category = category.Finite()
+        elif X in Sets().Infinite() and Y in Sets().Finite():
-        if X in Sets().Infinite() and Y in Sets().Finite():
             category = category.Infinite()
         Set_object_binary.__init__(self, X, Y, "difference", "-", category=category)
```


I am also slightly worried about this change:

```diff
diff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py
index 563a802..e1dcbd8 100644
--- a/src/sage/categories/enumerated_sets.py
+++ b/src/sage/categories/enumerated_sets.py
@@ -137,7 +137,7 @@ class EnumeratedSets(CategoryWithAxiom):
             sage: S = EnumeratedSets()(Set([1, 2, 3])); S
             {1, 2, 3}
             sage: S.category()
-            Category of facade finite enumerated sets
+            Category of finite enumerated sets
 
         Also Python3 range are now accepted::
 
```

Can you explain why this happened? I can't see the reason immediately from your changes.


---

Comment by mkoeppe created at 2022-08-18 03:06:11

Thanks! I agree with these simplifications.

I'll investigate how the facade got lost


---

Comment by mkoeppe created at 2022-08-18 03:06:56

By the way, should these `Set_object` parents all become facade parents?


---

Comment by tscrim created at 2022-08-18 03:11:51

I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.


---

Comment by mkoeppe created at 2022-08-18 03:28:22

Replying to [comment:8 tscrim]:
> I am also slightly worried about this change:
> {{{#!diff
> diff --git a/src/sage/categories/enumerated_sets.py b/src/sage/categories/enumerated_sets.py
> index 563a802..e1dcbd8 100644
> --- a/src/sage/categories/enumerated_sets.py
> +++ b/src/sage/categories/enumerated_sets.py
> `@``@` -137,7 +137,7 `@``@` class EnumeratedSets(CategoryWithAxiom):
>              sage: S = EnumeratedSets()(Set([1, 2, 3])); S
>              {1, 2, 3}
>              sage: S.category()
> -            Category of facade finite enumerated sets
> +            Category of finite enumerated sets
>  
>          Also Python3 range are now accepted::
>  
> }}}
> Can you explain why this happened?

Set([1, 2, 3]) is already in `EnumeratedSets()`, so passing `EnumeratedSets._call_` does not have to construct another wrapper.


---

Comment by git created at 2022-08-18 03:33:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-18 03:35:52

Replying to [comment:11 tscrim]:
>> should these Set_object parents all become facade parents?
> I think so. All of the various constructions (e.g., `__iter__`, `list`, etc.) all return objects whose parent is not the `Set`.

I'll do this in #34387


---

Comment by git created at 2022-08-18 03:47:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-18 05:08:03

Replying to [comment:8 tscrim]:
> You shouldn't need the `cardinality()` method as that should be given by the category.

The new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.

Now why exactly `Set_object_binary` subclasses `Set_object` is another question but not one for this ticket


---

Comment by git created at 2022-08-18 05:50:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-19 01:30:59

Replying to [comment:17 mkoeppe]:
> Replying to [comment:8 tscrim]:
> > You shouldn't need the `cardinality()` method as that should be given by the category.
> 
> The new method `Set_object_intersection.cardinality` needs to override `Set_object.cardinality`.

Ah, because of `Set_object`. Then we should change things in the base class. Perhaps `Set_object.is_finite()` should also test the category?


---

Comment by mkoeppe created at 2022-08-19 01:45:44

Good idea.


---

Comment by git created at 2022-08-19 01:49:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-20 05:45:30

This ended up being a good test:

```
sage: X = S.difference(T); X
Set-theoretic difference of Set of elements of Rational Field and Set of elements of Integer Ring
sage: X.category()
Category of sets
```

because `QQ` does have a (canonical) enumeration that isn't recognized by Sage:

```
sage: QQ in EnumeratedSets()
False
```

However, fixing that is for another ticket.


---

Comment by tscrim created at 2022-08-20 05:45:30

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-08-20 06:07:39

Yes, I was briefly surprised by this one.


---

Comment by mkoeppe created at 2022-08-20 06:09:37

By the way, I'm a bit annoyed by `EnumeratedSets.ParentMethods.__getitem__` (which is the same as unrank). Do you think people use that at all?


---

Comment by tscrim created at 2022-08-20 06:12:34

It is quite possible that people in combinatorics use it. For example, things like

```
sage: ASM = AlternatingSignMatrices(4)
sage: ASM[1:3]
[
[0 1 0 0]  [1 0 0 0]
[1 0 0 0]  [0 0 1 0]
[0 0 1 0]  [0 1 0 0]
[0 0 0 1], [0 0 0 1]
]
```

should call it (the implementation does a redirect to the category).


---

Comment by mkoeppe created at 2022-08-20 06:19:35

There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. 

Also one could maybe have something like an `as_sequence` method that would return a `SequenceView` (and thus give [] and slicing), see #32100

But that's for another ticket. Thanks for the review!


---

Comment by tscrim created at 2022-08-21 23:55:15

Replying to [comment:26 mkoeppe]:
> There's probably a better solution for getting this kind of syntax when it's convenient, maybe using a mixin class (like the mixin classes `Set_boolean_operators` etc.). Having it in the category feels a bit misplaced. 

That would negate a fair part of the category framework, it removes the fact that an enumerated set should (generally) behave like a list, and essentially every `EnumeratedSet` would have this proposed mixin class (thus being a code smell for why isn't in the category).

> But that's for another ticket. Thanks for the review!

Indeed. No problem.


---

Comment by vbraun created at 2022-08-30 19:05:14

Resolution: fixed
