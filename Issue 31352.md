# Issue 31352: Normaliz 3.8.10, PyNormaliz 2.14

Issue created by migration from https://trac.sagemath.org/ticket/31589

Original creator: mkoeppe

Original creation time: 2021-03-31 19:26:25

CC:  winfried jipilab @kliem

A smaller update to Normaliz, providing a better solution to the `TriangulationGenerators` issues (see #30531/#30569)

Previous update in #30704.

Next big update: #31588 Normaliz with e-antic 1.0




---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by mkoeppe created at 2021-05-18 04:25:57

Here's the update but now something needs to be adjusted in our code...

```
    PyNormaliz_cpp.NormalizError: Some error in the normaliz input data detected: Unknown ConeProperty string "TriangulationGenerators"
```

----
New commits:


---

Comment by Winfried created at 2021-05-18 08:01:48

The TriangulationGenerators had a very short life in version 3.8.9. In 3.8.10 triangulations  and related types of decompositions are now bundled with their "reference generators". Have a look at PyNormaliz.py and NormalizModule.cpp.


---

Comment by @kliem created at 2021-05-18 13:05:49

There is another big problem after upgrading: The `NormalizError` is not caught correctly from the sage shell (works fine in `ipython`, so maybe does not play nicely with cysignals).


```
sage: from PyNormaliz import *                                                                                                                                                                                                                                                 
sage: C = Cone(cone = [[1,0],[0,1]])                                                                                                                                                                                                                                           
sage: NmzResult(C.cone, 'AllGeneratorsTriangulation')                                                                                                                                                                                                                          
[[[[0, 1], 1, []]], [[0, 1], [1, 0]]]
sage: NmzResult(C.cone, 'AllGeneratorsTriangul')                                                                                                                                                                                                                               
------------------------------------------------------------------------
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x95eb)[0x7fb4e21a25eb]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xb848)[0x7fb4e21a4848]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x1033c)[0x7fb4e21a933c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7fb4e5b59730]
/lib/x86_64-linux-gnu/libc.so.6(gsignal+0x10b)[0x7fb4e55d37bb]
/lib/x86_64-linux-gnu/libc.so.6(abort+0x121)[0x7fb4e55be535]
/lib/x86_64-linux-gnu/libgcc_s.so.1(+0x3358)[0x7fb4e213d358]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/PyNormaliz_cpp.cpython-37m-x86_64-linux-gnu.so(+0xdd9c)[0x7fb25ec8bd9c]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/PyNormaliz_cpp.cpython-37m-x86_64-linux-gnu.so(+0x215c0)[0x7fb25ec9f5c0]
python3(_PyMethodDef_RawFastCallKeywords+0x224)[0x5d88a4]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7fb4e55c009b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1182.
GNU gdb (Debian 8.2.1-2+b3) 8.2.1
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word".
[New LWP 1258]
[New LWP 1260]
[New LWP 1261]
[New LWP 1262]
[New LWP 1263]
[New LWP 1264]
[New LWP 1265]
[New LWP 1266]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
0x00007fb4e5b590ca in __waitpid (pid=1269, stat_loc=0x0, options=0)
    at ../sysdeps/unix/sysv/linux/waitpid.c:30

Stack backtrace
---------------
    at ../sysdeps/unix/sysv/linux/waitpid.c:30
        resultvar = 18446744073709551104
        sc_cancel_oldtype = 0
        sc_ret = <optimized out>
#1  0x00007fb4e21a4743 in print_enhanced_backtrace ()
    at build/src/cysignals/implementation.c:579
        parent_pid = 1182
        pid = <optimized out>
#2  0x00007fb4e21a4885 in sigdie (sig=sig@entry=6, 
    s=s@entry=0x7fb4e21aac00 "Unhandled SIGABRT: An abort() occurred.")
    at build/src/cysignals/implementation.c:605
No locals.
#3  0x00007fb4e21a933c in sigdie_for_sig (inside=0, sig=6)
    at build/src/cysignals/implementation.c:175
No locals.
#4  cysigs_signal_handler (sig=6) at build/src/cysignals/implementation.c:278
        inside = <optimized out>
#5  <signal handler called>
No locals.
#6  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
        set = {__val = {0, 0, 0, 0, 140404071281033, 140735024796720, 
            140735024796016, 70370368, 140735024796016, 140735024796720, 0, 
            70370368, 140735024796016, 41, 0, 140414863847016}}
        pid = <optimized out>
        tid = <optimized out>
        ret = <optimized out>
#7  0x00007fb4e55be535 in __GI_abort () at abort.c:79
        save_stage = 1
        act = {__sigaction_handler = {sa_handler = 0x0, sa_sigaction = 0x0}, 
          sa_mask = {__val = {0 <repeats 13 times>, 130843, 70370368, 
              140735024797024}}, sa_flags = 1831408448, 
          sa_restorer = 0x7fff6d291430}
        sigs = {__val = {32, 0 <repeats 15 times>}}
#8  0x00007fb4e213d358 in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1
No symbol table info available.
#9  0x00007fb25ec8bd9c in __gnu_cxx::new_allocator<char>::~new_allocator (
    this=<optimized out>, this=<optimized out>)
    at /usr/include/c++/8/ext/new_allocator.h:86
No locals.
#10 std::allocator<char>::~allocator (this=<optimized out>, 
    this=<optimized out>) at /usr/include/c++/8/bits/allocator.h:139
No locals.
#11 std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_Alloc_hider::~_Alloc_hider (this=<optimized out>, this=<optimized out>)
    at /usr/include/c++/8/bits/basic_string.h:139
No locals.
#12 std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::~basic_string (this=<optimized out>, this=<optimized out>)
    at /usr/include/c++/8/bits/basic_string.h:657
No locals.
#13 _NmzResultImpl<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >(libnormaliz::Cone<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >*, _object*, void*) [clone .isra.995] [clone .lto_priv.83] (C=<optimized out>, prop_obj=<optimized out>, 
    nf=<optimized out>) at NormalizModule.cpp:1597
        prop = ""
        p = <optimized out>
        notComputed = {CPs = std::bitset}
        outputtype = <optimized out>
        tmpHandler = <optimized out>
        is_HSOP = <optimized out>
        is_HSOP = <optimized out>
        grad = <optimized out>
        denom = <optimized out>
        return_list = <optimized out>
        hull = <optimized out>
        projection = <optimized out>
#14 0x00007fb25ec9f5c0 in _NmzResult (self=<optimized out>, 
    args=<optimized out>, kwargs=0x0) at NormalizModule.cpp:1832
        cone_ptr = <optimized out>
        cone = 0x7fb4e126c960
        prop = 0x7fb25e758618
        result = 0x0
#15 0x00000000005d88a4 in _PyMethodDef_RawFastCallKeywords ()
No symbol table info available.
#16 0x0000000000552373 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#17 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#18 0x0000000000558f25 in ?? ()
No symbol table info available.
#19 0x00000000005d8833 in _PyMethodDef_RawFastCallKeywords ()
No symbol table info available.
#20 0x0000000000552373 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#21 0x00000000004d37a6 in ?? ()
No symbol table info available.
#22 0x000000000054fb25 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#23 0x00000000004d37a6 in ?? ()
No symbol table info available.
#24 0x000000000054fb25 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#25 0x00000000004d37a6 in ?? ()
No symbol table info available.
#26 0x00000000004d76a1 in _PyMethodDescr_FastCallKeywords ()
No symbol table info available.
#27 0x00000000005526a8 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#28 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#29 0x000000000054e5ac in _PyEval_EvalFrameDefault ()
No symbol table info available.
#30 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#31 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#32 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#33 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#34 0x000000000054b1f0 in ?? ()
No symbol table info available.
#35 0x000000000054f45e in _PyEval_EvalFrameDefault ()
No symbol table info available.
#36 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#37 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#38 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#39 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#40 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#41 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#42 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#43 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#44 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#45 0x000000000054e0a3 in PyEval_EvalCode ()
No symbol table info available.
#46 0x0000000000630ce2 in ?? ()
No symbol table info available.
#47 0x0000000000630d97 in PyRun_FileExFlags ()
No symbol table info available.
#48 0x00000000006319ff in PyRun_SimpleFileExFlags ()
No symbol table info available.
#49 0x000000000065432e in ?? ()
No symbol table info available.
#50 0x000000000065468e in _Py_UnixMain ()
No symbol table info available.
#51 0x00007fb4e55c009b in __libc_start_main (main=0x4bc560 <main>, argc=3, 
    argv=0x7fff6d2930f8, init=<optimized out>, fini=<optimized out>, 
    rtld_fini=<optimized out>, stack_end=0x7fff6d2930e8)
    at ../csu/libc-start.c:308
        self = <optimized out>
        result = <optimized out>
        unwind_buf = {cancel_jmp_buf = {{jmp_buf = {0, -1977610188322685730, 
                6164064, 140735024804080, 0, 0, 1977296402553060574, 
                2010809338179042526}, mask_was_saved = 0}}, priv = {pad = {
              0x0, 0x0, 0x7fff6d293118, 0x7fb4e5c12190}, data = {prev = 0x0, 
              cleanup = 0x0, canceltype = 1831416088}}}
        not_first_call = <optimized out>
#52 0x00000000005e0e8a in _start ()
No symbol table info available.
[Inferior 1 (process 1182) detached]
30	../sysdeps/unix/sysv/linux/waitpid.c: No such file or directory.
Traceback (most recent call last):
  File "<string>", line 25, in <module>
ModuleNotFoundError: No module named 'Cython'
Error while executing Python code.
Saved trace to /srv/public/kliem/.sage/crash_logs/crash_juhvwxxn.log
------------------------------------------------------------------------
Unhandled SIGABRT: An abort() occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Aborted
```



---

Comment by @kliem created at 2021-05-18 13:31:47

New commits:


---

Comment by @kliem created at 2021-05-18 13:51:06

Seems to work now, except for that one BIG issue that the error catching is completely broken.

It has nothing to do with that specific use case. As soons as you use `PyNormaliz` in sage and not in ipython it fails:


```
sage: from PyNormaliz import *                                                                                                                                                                                                                                                 
sage: C = Cone(cone = [[1,0],[0,1]])                                                                                                                                                                                                                                           
sage: C = Cone(cone = [[1,0],[0]])                                                                                                                                                                                                                                             
------------------------------------------------------------------------
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x95eb)[0x7f1239f1e5eb]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xb848)[0x7f1239f20848]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x1033c)[0x7f1239f2533c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f123d8d5730]
/lib/x86_64-linux-gnu/libc.so.6(gsignal+0x10b)[0x7f123d34f7bb]
/lib/x86_64-linux-gnu/libc.so.6(abort+0x121)[0x7f123d33a535]
/lib/x86_64-linux-gnu/libgcc_s.so.1(+0x3358)[0x7f1239eb9358]
/srv/public/kliem/sage/local/lib/libnormaliz.so.3(_ZN11libnormaliz4ConeI10__gmp_exprIA1_12__mpz_structS3_EE25process_multi_input_innerERSt3mapINS_4Type9InputTypeESt6vectorIS9_IS4_SaIS4_EESaISB_EESt4lessIS8_ESaISt4pairIKS8_SD_EEE+0x2894)[0x7f0fb6738764]
/srv/public/kliem/sage/local/lib/libnormaliz.so.3(_ZN11libnormaliz4ConeI10__gmp_exprIA1_12__mpz_structS3_EE19process_multi_inputERKSt3mapINS_4Type9InputTypeESt6vectorIS9_IS1_IA1_12__mpq_structSB_ESaISC_EESaISE_EESt4lessIS8_ESaISt4pairIKS8_SG_EEE+0x2f)[0x7f0fb673c25f]
/srv/public/kliem/sage/local/lib/python3.7/site-packages/PyNormaliz_cpp.cpython-37m-x86_64-linux-gnu.so(+0x30d39)[0x7f0fb6a2ed39]
python3(PyCFunction_Call+0xaa)[0x5d8f4a]
python3(_PyEval_EvalFrameDefault+0x5139)[0x5531e9]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallDict+0x34e)[0x5da6fe]
python3[0x591533]
python3(_PyObject_FastCallKeywords+0x129)[0x5d9c59]
python3[0x54b3c1]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f123d33c09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 8074.
GNU gdb (Debian 8.2.1-2+b3) 8.2.1
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word".
[New LWP 8150]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
0x00007f123d8d50ca in __waitpid (pid=8154, stat_loc=0x0, options=0)
    at ../sysdeps/unix/sysv/linux/waitpid.c:30

Stack backtrace
---------------
    at ../sysdeps/unix/sysv/linux/waitpid.c:30
        resultvar = 18446744073709551104
        sc_cancel_oldtype = 0
        sc_ret = <optimized out>
#1  0x00007f1239f20743 in print_enhanced_backtrace ()
    at build/src/cysignals/implementation.c:579
        parent_pid = 8074
        pid = <optimized out>
#2  0x00007f1239f20885 in sigdie (sig=sig@entry=6, 
    s=s@entry=0x7f1239f26c00 "Unhandled SIGABRT: An abort() occurred.")
    at build/src/cysignals/implementation.c:605
No locals.
#3  0x00007f1239f2533c in sigdie_for_sig (inside=0, sig=6)
    at build/src/cysignals/implementation.c:175
No locals.
#4  cysigs_signal_handler (sig=6) at build/src/cysignals/implementation.c:278
        inside = <optimized out>
#5  <signal handler called>
No locals.
#6  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
        set = {__val = {0, 0, 0, 0, 139705465385353, 140723136350640, 
            140723136349936, 61173312, 140723136349936, 140723136350640, 0, 
            61173312, 140723136349936, 48, 0, 139716257934952}}
        pid = <optimized out>
        tid = <optimized out>
        ret = <optimized out>
#7  0x00007f123d33a535 in __GI_abort () at abort.c:79
        save_stage = 1
        act = {__sigaction_handler = {sa_handler = 0x0, sa_sigaction = 0x0}, 
          sa_mask = {__val = {0 <repeats 13 times>, 130843, 61173312, 
              140723136350944}}, sa_flags = -1467103040, 
          sa_restorer = 0x7ffca88dc9b0}
        sigs = {__val = {32, 0 <repeats 15 times>}}
#8  0x00007f1239eb9358 in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1
No symbol table info available.
#9  0x00007f0fb6738764 in libnormaliz::Matrix<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >::~Matrix (this=<optimized out>, __in_chrg=<optimized out>)
    at ./libnormaliz/matrix.h:53
No locals.
#10 libnormaliz::Cone<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >::process_multi_input_inner (this=this@entry=0x3dc0e30, 
    multi_input_data=std::map with 1 element) at libnormaliz/cone.cpp:851
        __PRETTY_FUNCTION__ = "void libnormaliz::Cone<Integer>::process_multi_input_inner(std::map<libnormaliz::Type::InputType, std::vector<std::vector<Integer> > >&) [with Integer = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>]"
        it = <optimized out>
        gen_error = <optimized out>
        inhom_corr = <optimized out>
        InhomExcludedFaces = {nr = 0, nc = 0, 
          elem = std::vector of length 0, capacity 0}
        lf = std::vector of length 0, capacity 0
        LatticeGenerators = {nr = 0, nc = 139705459795680, 
          elem = std::vector of length -22727535274, capacity -22727535274 = {
            <error reading variable>
        cone_sat_eq = <optimized out>
        cone_sat_cong = <optimized out>
        cone_sat_ineq = <optimized out>
#11 0x00007f0fb673c25f in libnormaliz::Cone<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >::process_multi_input (this=this@entry=0x3dc0e30, 
    multi_input_data_const=std::map with 1 element) at libnormaliz/cone.cpp:615
        multi_input_data_ZZ = std::map with 1 element = {
          [libnormaliz::Type::cone] = std::vector of length 2, capacity 2 = {
            std::vector of length 2, capacity 2 = {{mp = {{_mp_alloc = 1, 
                    _mp_size = 1, _mp_d = 0x3065f40}}}, {mp = {{_mp_alloc = 1, 
                    _mp_size = 0, _mp_d = 0x30d1ad0}}}}, 
            std::vector of length 1, capacity 1 = {{mp = {{_mp_alloc = 1, 
                    _mp_size = 0, _mp_d = 0x30fbba0}}}}}}
#12 0x00007f0fb6a2ed39 in libnormaliz::Cone<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >::Cone<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> > (
    multi_input_data=..., this=<optimized out>, this=<optimized out>, 
    multi_input_data=...) at /usr/include/c++/8/bits/stl_bvector.h:222
No locals.
#13 _NmzConeIntern<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> > (
    kwargs=<optimized out>) at NormalizModule.cpp:976
        polynomial = ""
        C = <optimized out>
        return_container = <optimized out>
        input = std::map with 1 element = {
          [libnormaliz::Type::cone] = std::vector of length 2, capacity 2 = {
            std::vector of length 2, capacity 2 = {{mp = {{_mp_num = {
                      _mp_alloc = 1, _mp_size = 1, _mp_d = 0x2cfd780}, 
                    _mp_den = {_mp_alloc = 1, _mp_size = 1, 
                      _mp_d = 0x2cfd7a0}}}}, {mp = {{_mp_num = {_mp_alloc = 1, 
                      _mp_size = 0, _mp_d = 0x2f90890}, _mp_den = {
                      _mp_alloc = 1, _mp_size = 1, _mp_d = 0x31feb10}}}}}, 
            std::vector of length 1, capacity 1 = {{mp = {{_mp_num = {
                      _mp_alloc = 1, _mp_size = 0, _mp_d = 0x389cfb0}, 
                    _mp_den = {_mp_alloc = 1, _mp_size = 1, 
                      _mp_d = 0x389cfd0}}}}}}}
        grading_polynomial = false
        input = <optimized out>
        grading_polynomial = <optimized out>
        polynomial = <optimized out>
        C = <optimized out>
        return_container = <optimized out>
        keys = <optimized out>
        values = <optimized out>
        length = <optimized out>
        i = <optimized out>
        type_string = <optimized out>
        current_value = <optimized out>
        Mat = <optimized out>
        e = <optimized out>
#14 _NmzCone (self=<optimized out>, args=<optimized out>, 
    kwargs=<optimized out>) at NormalizModule.cpp:1096
        string_for_long = 0x7f0fb6a323fa "CreateAsLongLong"
        create_as_long_long = <optimized out>
        string_for_renf = 0x7f0fb6a3240b "number_field"
        create_as_renf = <optimized out>
#15 0x00000000005d8f4a in PyCFunction_Call ()
No symbol table info available.
#16 0x00000000005531e9 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#17 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#18 0x00000000005da6fe in _PyFunction_FastCallDict ()
No symbol table info available.
#19 0x0000000000591533 in ?? ()
No symbol table info available.
#20 0x00000000005d9c59 in _PyObject_FastCallKeywords ()
No symbol table info available.
#21 0x000000000054b3c1 in ?? ()
No symbol table info available.
#22 0x000000000054f45e in _PyEval_EvalFrameDefault ()
No symbol table info available.
#23 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#24 0x0000000000558f25 in ?? ()
No symbol table info available.
#25 0x00000000005d8833 in _PyMethodDef_RawFastCallKeywords ()
No symbol table info available.
#26 0x0000000000552373 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#27 0x00000000004d37a6 in ?? ()
No symbol table info available.
#28 0x000000000054fb25 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#29 0x00000000004d37a6 in ?? ()
No symbol table info available.
#30 0x000000000054fb25 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#31 0x00000000004d37a6 in ?? ()
No symbol table info available.
#32 0x00000000004d76a1 in _PyMethodDescr_FastCallKeywords ()
No symbol table info available.
#33 0x00000000005526a8 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#34 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#35 0x000000000054e5ac in _PyEval_EvalFrameDefault ()
No symbol table info available.
#36 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#37 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#38 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#39 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#40 0x000000000054b1f0 in ?? ()
No symbol table info available.
#41 0x000000000054f45e in _PyEval_EvalFrameDefault ()
No symbol table info available.
#42 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#43 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#44 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#45 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#46 0x00000000005d94f2 in _PyFunction_FastCallKeywords ()
No symbol table info available.
#47 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#48 0x00000000005d91fc in _PyFunction_FastCallKeywords ()
No symbol table info available.
#49 0x000000000054e7e0 in _PyEval_EvalFrameDefault ()
No symbol table info available.
#50 0x000000000054bcc2 in _PyEval_EvalCodeWithName ()
No symbol table info available.
#51 0x000000000054e0a3 in PyEval_EvalCode ()
No symbol table info available.
#52 0x0000000000630ce2 in ?? ()
No symbol table info available.
#53 0x0000000000630d97 in PyRun_FileExFlags ()
No symbol table info available.
#54 0x00000000006319ff in PyRun_SimpleFileExFlags ()
No symbol table info available.
#55 0x000000000065432e in ?? ()
No symbol table info available.
#56 0x000000000065468e in _Py_UnixMain ()
No symbol table info available.
#57 0x00007f123d33c09b in __libc_start_main (main=0x4bc560 <main>, argc=3, 
    argv=0x7ffca88e0338, init=<optimized out>, fini=<optimized out>, 
    rtld_fini=<optimized out>, stack_end=0x7ffca88e0328)
    at ../csu/libc-start.c:308
        self = <optimized out>
        result = <optimized out>
        unwind_buf = {cancel_jmp_buf = {{jmp_buf = {0, 6802578844880594517, 
                6164064, 140723136365360, 0, 0, -6800773277373307307, 
                -6898415358150449579}, mask_was_saved = 0}}, priv = {pad = {
              0x0, 0x0, 0x7ffca88e0358, 0x7f123d98e190}, data = {prev = 0x0, 
              cleanup = 0x0, canceltype = -1467088040}}}
        not_first_call = <optimized out>
#58 0x00000000005e0e8a in _start ()
No symbol table info available.
[Inferior 1 (process 8074) detached]
30	../sysdeps/unix/sysv/linux/waitpid.c: No such file or directory.
Python Exception <class 'ValueError'> Cannot find type class std::map<libnormaliz::Type::InputType, std::vector<std::vector<__gmp_expr<__mpz_struct [1], __mpz_struct [1]>, std::allocator<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> > >, std::allocator<std::vector<__gmp_expr<__mpz_struct [1], __mpz_struct [1]>, std::allocator<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> > > > >, std::less<libnormaliz::Type::InputType>, std::allocator<std::pair<libnormaliz::Type::InputType const, std::vector<std::vector<__gmp_expr<__mpz_struct [1], __mpz_struct [1]>, std::allocator<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> > >, std::allocator<std::vector<__gmp_expr<__mpz_struct [1], __mpz_struct [1]>, std::allocator<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> > > > > > > >::_Rep_type: 
Python Exception <class 'ValueError'> Cannot find type const class std::map<libnormaliz::Type::InputType, std::vector<std::vector<__gmp_expr<__mpq_struct [1], __mpq_struct [1]>, std::allocator<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> > >, std::allocator<std::vector<__gmp_expr<__mpq_struct [1], __mpq_struct [1]>, std::allocator<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> > > > >, std::less<libnormaliz::Type::InputType>, std::allocator<std::pair<libnormaliz::Type::InputType const, std::vector<std::vector<__gmp_expr<__mpq_struct [1], __mpq_struct [1]>, std::allocator<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> > >, std::allocator<std::vector<__gmp_expr<__mpq_struct [1], __mpq_struct [1]>, std::allocator<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> > > > > > > >::_Rep_type: 
Traceback (most recent call last):
  File "<string>", line 25, in <module>
ModuleNotFoundError: No module named 'Cython'
Error while executing Python code.
Saved trace to /srv/public/kliem/.sage/crash_logs/crash_64_q_whr.log
```



---

Comment by Winfried created at 2021-05-18 13:56:49

Please explain for me: is there something to be done in PyNormaliz?


---

Comment by @kliem created at 2021-05-18 14:10:58

I only wish I would know.

If there is something that changed in the error handling in normaliz that would be good to know.


---

Comment by Winfried created at 2021-05-18 14:15:00

I am quite sure that nothing has changed on the Normaliz side. I am also not aware of any intended changes in PyNormaliz. Have you tried to run PyNormaliz outside of Sage?

Does the spoiled error handling concern all kinds of errors or only specific ones?


---

Comment by @kliem created at 2021-05-18 14:52:34

The installed Normaliz and PyNormaliz work fine in ipython (via ‘sage -sh‘). It only happens in the sage shell/sages modified ipython and apparently effects all kinds of Normaliz Errors.


---

Comment by mkoeppe created at 2021-05-18 16:35:24

I can't reproduce this problem here on macOS


---

Comment by @kliem created at 2021-05-18 16:46:39

Something in sage's build chain is messed up. I would say.

I fetched this ticket and ran `make build` and nothing happened. It did NOT update pynormaliz. I first thought my office computer didn't have pynormaliz anymore for some reason, but it's the same on my home laptop.

Then force updating `normaliz` did not trigger updating `pynormaliz`.

I have to run `sage -i pynormaliz` to trigger the update.


---

Comment by @kliem created at 2021-05-18 18:01:56

The above still holds, however I can't reproduce the errors on by ubuntu laptop. So maybe I messed my sage up on the other one. I'll dist-clean and report on the success.


---

Comment by mkoeppe created at 2021-05-18 18:24:38

works for me on macOS


---

Comment by mkoeppe created at 2021-05-18 18:24:44

Changing status from new to needs_review.


---

Comment by @kliem created at 2021-05-18 18:37:33

Why did you remove my commit?
----
New commits:


---

Comment by @kliem created at 2021-05-18 19:25:03

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2021-05-18 19:25:03

Strange, the problem does not go away when running `make distclean`, but also not when going back onto develop and downgrading (as mentioned before `make build` does not trigger updating).

However, the problem seems completely unrelated to the update.


---

Comment by @kliem created at 2021-05-18 19:28:14

Changing status from positive_review to needs_review.


---

Comment by @kliem created at 2021-05-18 19:28:14

I changed cherry-picked my commit to fix the triangulation. I hope this is ok.
----
New commits:


---

Comment by mkoeppe created at 2021-05-18 19:38:00

Replying to [comment:18 gh-kliem]:
> Why did you remove my commit?

Sorry, by mistake. Thanks for fixing it


---

Comment by mkoeppe created at 2021-05-18 19:38:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-05-26 21:58:48

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2021-05-26 21:58:48

Merge conflict


---

Comment by mkoeppe created at 2021-05-26 22:28:51

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2021-05-26 22:28:51

New commits:


---

Comment by vbraun created at 2021-06-19 20:58:31

Resolution: fixed
