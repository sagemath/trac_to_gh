# Issue 26462: PariError RgX_to_ser (l <= 2) when computing dual isogeny

archive/issues_026462.json:
```json
{
    "body": "Keywords: pari, isogeny, power series\n\nHello,\n\nI stumbled on a PariError when trying to compute the dual of a 2<sup>8</sup>-degree isogeny using Sage. The following code reproduces the issue on my local sage-8.1 build running PARI 2.9.4 on Ubuntu 18.04 64bit, and on aleph.sagemath.org running sage-8.4 and PARI 2.11.0.\n\n\n```python\nsage: p = 417942208511\nsage: Fp2, i = GF(p^2, modulus=[1,0,1], name='i').objgen()\nsage: E = EllipticCurve(Fp2, [1, 0])\nsage: R = E.point([148664587359*i + 249094580166 , 117953016727*i + \n218000575119 ])\nsage: assert(R.order() == 256)\nsage: phi = E.isogeny(R)\nsage: phi.dual()  # raises \"PariError: bug in RgX_to_ser (l <= 2), please report\"\n```\n\n\nI sent a bug report to PARI/GP available at https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2092\n\n\nFrom the Traceback (attached below) the error seems to be specifically in some power series code in PARI, but it's hard (for me) to come up with the equivalent C or GP from the Cython calls. From the PARI side they suggested me to bring the issue up also to your attention.\n\nCheers\n\nFernando\n\n\n```\nPariError                                 Traceback (most recent call last)\n<ipython-input-1-fd6f0bb03659> in <module>()\n       4 R = E.point([Integer(148664587359)*i + Integer(249094580166) , \nInteger(117953016727)*i + Integer(218000575119) ])\n       5 phi = E.isogeny(R)\n----> 6 phi.dual()  # raises \"PariError: bug in RgX_to_ser (l <= 2), \nplease report\"\n\n/usr/lib/python2.7/dist-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.pyc \nin dual(self)\n    3422         # trac 7096\n    3423         # this should take care of the case when the isogeny is \nnot normalized.\n-> 3424         u = self.formal()[1]\n    3425         isom = WeierstrassIsomorphism(E2pr, (u/F(d), 0, 0, 0))\n    3426\n\n/usr/lib/python2.7/dist-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.pyc \nin formal(self, prec)\n    3500         if yh.valuation() != -3:\n    3501             raise RuntimeError(\"yh has valuation %s (should be \n-3)\" % yh.valuation())\n-> 3502         fh = f(xh,yh)\n    3503         if fh.valuation() != -2:\n    3504             raise RuntimeError(\"fh has valuation %s (should be \n-2)\" % fh.valuation())\n\nsage/rings/fraction_field_element.pyx in \nsage.rings.fraction_field_element.FractionFieldElement.__call__ \n(build/cythonized/sage/rings/fraction_field_element.c:5157)()\n\n/usr/lib/python2.7/dist-packages/sage/rings/polynomial/multi_polynomial_element.pyc \nin __call__(self, *x, **kwds)\n     148         y = K(0)\n     149         for (m,c) in iteritems(self.element().dict()):\n--> 150             y += c*prod([ x[i]**m[i] for i in range(n) if m[i] \n!= 0])\n     151         return y\n     152\n\nsage/structure/element.pyx in sage.structure.element.Element.__add__ \n(build/cythonized/sage/structure/element.c:10803)()\n\nsage/rings/laurent_series_ring_element.pyx in \nsage.rings.laurent_series_ring_element.LaurentSeries._add_ \n(build/cythonized/sage/rings/laurent_series_ring_element.c:8778)()\n\nsage/rings/power_series_ring_element.pyx in \nsage.rings.power_series_ring_element.PowerSeries.__lshift__ \n(build/cythonized/sage/rings/power_series_ring_element.c:12408)()\n\nsage/structure/parent.pyx in sage.structure.parent.Parent.__call__ \n(build/cythonized/sage/structure/parent.c:9606)()\n\nsage/structure/coerce_maps.pyx in \nsage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args \n(build/cythonized/sage/structure/coerce_maps.c:5403)()\n\nsage/structure/coerce_maps.pyx in \nsage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args \n(build/cythonized/sage/structure/coerce_maps.c:5242)()\n\n/usr/lib/python2.7/dist-packages/sage/rings/power_series_ring.pyc in \n_element_constructor_(self, f, prec, check)\n     805             else:\n     806                 raise TypeError(\"Can only convert series into \nring with same variable name.\")\n--> 807         return self.element_class(self, f, prec, check=check)\n     808\n     809     def construction(self):\n\nsage/rings/power_series_pari.pyx in \nsage.rings.power_series_pari.PowerSeries_pari.__init__ \n(build/cythonized/sage/rings/power_series_pari.c:5954)()\n\ncypari2/gen.pyx in cypari2.gen.Gen.Ser()\n\ncypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()\n\nPariError: bug in RgX_to_ser (l <= 2), please report\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26699\n\n",
    "created_at": "2018-11-13T14:00:26Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "PariError RgX_to_ser (l <= 2) when computing dual isogeny",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26462",
    "user": "https://github.com/fvirdia"
}
```
Keywords: pari, isogeny, power series

Hello,

I stumbled on a PariError when trying to compute the dual of a 2<sup>8</sup>-degree isogeny using Sage. The following code reproduces the issue on my local sage-8.1 build running PARI 2.9.4 on Ubuntu 18.04 64bit, and on aleph.sagemath.org running sage-8.4 and PARI 2.11.0.


```python
sage: p = 417942208511
sage: Fp2, i = GF(p^2, modulus=[1,0,1], name='i').objgen()
sage: E = EllipticCurve(Fp2, [1, 0])
sage: R = E.point([148664587359*i + 249094580166 , 117953016727*i + 
218000575119 ])
sage: assert(R.order() == 256)
sage: phi = E.isogeny(R)
sage: phi.dual()  # raises "PariError: bug in RgX_to_ser (l <= 2), please report"
```


I sent a bug report to PARI/GP available at https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2092


From the Traceback (attached below) the error seems to be specifically in some power series code in PARI, but it's hard (for me) to come up with the equivalent C or GP from the Cython calls. From the PARI side they suggested me to bring the issue up also to your attention.

Cheers

Fernando


```
PariError                                 Traceback (most recent call last)
<ipython-input-1-fd6f0bb03659> in <module>()
       4 R = E.point([Integer(148664587359)*i + Integer(249094580166) , 
Integer(117953016727)*i + Integer(218000575119) ])
       5 phi = E.isogeny(R)
----> 6 phi.dual()  # raises "PariError: bug in RgX_to_ser (l <= 2), 
please report"

/usr/lib/python2.7/dist-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.pyc 
in dual(self)
    3422         # trac 7096
    3423         # this should take care of the case when the isogeny is 
not normalized.
-> 3424         u = self.formal()[1]
    3425         isom = WeierstrassIsomorphism(E2pr, (u/F(d), 0, 0, 0))
    3426

/usr/lib/python2.7/dist-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.pyc 
in formal(self, prec)
    3500         if yh.valuation() != -3:
    3501             raise RuntimeError("yh has valuation %s (should be 
-3)" % yh.valuation())
-> 3502         fh = f(xh,yh)
    3503         if fh.valuation() != -2:
    3504             raise RuntimeError("fh has valuation %s (should be 
-2)" % fh.valuation())

sage/rings/fraction_field_element.pyx in 
sage.rings.fraction_field_element.FractionFieldElement.__call__ 
(build/cythonized/sage/rings/fraction_field_element.c:5157)()

/usr/lib/python2.7/dist-packages/sage/rings/polynomial/multi_polynomial_element.pyc 
in __call__(self, *x, **kwds)
     148         y = K(0)
     149         for (m,c) in iteritems(self.element().dict()):
--> 150             y += c*prod([ x[i]**m[i] for i in range(n) if m[i] 
!= 0])
     151         return y
     152

sage/structure/element.pyx in sage.structure.element.Element.__add__ 
(build/cythonized/sage/structure/element.c:10803)()

sage/rings/laurent_series_ring_element.pyx in 
sage.rings.laurent_series_ring_element.LaurentSeries._add_ 
(build/cythonized/sage/rings/laurent_series_ring_element.c:8778)()

sage/rings/power_series_ring_element.pyx in 
sage.rings.power_series_ring_element.PowerSeries.__lshift__ 
(build/cythonized/sage/rings/power_series_ring_element.c:12408)()

sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ 
(build/cythonized/sage/structure/parent.c:9606)()

sage/structure/coerce_maps.pyx in 
sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args 
(build/cythonized/sage/structure/coerce_maps.c:5403)()

sage/structure/coerce_maps.pyx in 
sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args 
(build/cythonized/sage/structure/coerce_maps.c:5242)()

/usr/lib/python2.7/dist-packages/sage/rings/power_series_ring.pyc in 
_element_constructor_(self, f, prec, check)
     805             else:
     806                 raise TypeError("Can only convert series into 
ring with same variable name.")
--> 807         return self.element_class(self, f, prec, check=check)
     808
     809     def construction(self):

sage/rings/power_series_pari.pyx in 
sage.rings.power_series_pari.PowerSeries_pari.__init__ 
(build/cythonized/sage/rings/power_series_pari.c:5954)()

cypari2/gen.pyx in cypari2.gen.Gen.Ser()

cypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()

PariError: bug in RgX_to_ser (l <= 2), please report
```


Issue created by migration from https://trac.sagemath.org/ticket/26699





---

archive/issue_comments_371883.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-01-09T10:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26462#issuecomment-371883",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_events_066153.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-09T10:27:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26462",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26462#event-66153"
}
```



---

archive/issue_events_066154.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-09T10:27:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26462",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26462#event-66154"
}
```
