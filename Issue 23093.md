# Issue 23093: Broken typeset in pdf export of Jupyter notebook

Issue created by migration from https://trac.sagemath.org/ticket/23330

Original creator: egourgoulhon

Original creation time: 2017-06-27 14:26:24

In the Jupyter notebook, typeset outputs, either obtained by `show` or by `%display latex`, are no longer typeset in the pdf file generated by File->Download as->PDF via LaTeX (.pdf).

See https://groups.google.com/d/msg/sage-devel/LC_4PSjyx2M/I9ip8c0bCAAJ for more details, and in particular https://groups.google.com/d/msg/sage-devel/LC_4PSjyx2M/coAzvbo1CAAJ


---

Comment by egourgoulhon created at 2017-06-27 14:37:58

Changing keywords from "" to "jupyter pdf".


---

Comment by was created at 2017-06-27 17:47:13

See also: https://github.com/sagemathinc/cocalc/issues/2030


---

Comment by embray created at 2018-07-25 09:35:14

As discussed on sage-devel, we need to make the Sage kernel be more explicit about when the output's mimetype is text/latex (instead of using text/html, which is generally unnecessary--I don't think we need to wrap the output in an HTML fragment or `<script type="text/math">`.  I could be wrong, but I think that might be a vestige from older versions of IPython notebook...


---

Comment by egourgoulhon created at 2019-05-19 13:02:19

A solution could be to use Jupyter's native rich output for LaTeX, not the Sage's mechanism through the IPython extension %display. For this, it suffices to implement the method `_repr_latex_` to all Sage objects, i.e. add the following to `SageObject`:

```
    def _repr_latex_(self):
        from sage.misc.latex import latex
        return '$' + str(latex(self)) + '$'
```

See e.g. [this presentation](https://github.com/ipython/ipython-in-depth/blob/master/examples/IPython%20Kernel/Custom%20Display%20Logic.ipynb) of Jupyter display logic.
This solves the pdf issue reported here.


---

Comment by egourgoulhon created at 2019-05-22 08:52:05

See https://groups.google.com/d/msg/sage-devel/nP7PKQyqxKw/IAWZb9nlAAAJ for a related sage-devel discussion.


---

Comment by @VincentVanlaer created at 2020-06-18 12:43:21

Changing status from new to needs_review.


---

Comment by @VincentVanlaer created at 2020-06-18 12:43:21

New commits:


---

Comment by egourgoulhon created at 2020-06-18 20:21:11

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2020-06-18 20:21:11

Thank you very much for the fix!
I've tested it on a few notebooks and everything works perfectly.


---

Comment by vbraun created at 2020-06-22 22:34:37

Resolution: fixed


---

Comment by egourgoulhon created at 2021-03-25 08:12:51

The fix introduced here broke ipywidgets in Jupyter notebooks, see #31513.
