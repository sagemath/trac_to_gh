# Issue 28158: Bug in is_weil_polynomial

Issue created by migration from https://trac.sagemath.org/ticket/28395

Original creator: kedlaya

Original creation time: 2019-08-24 19:01:40

Keywords: Weil polynomial

This is a bug:

```
sage: P.<t> = QQ[]
sage: u = t^10 + 4*t^9 + 8*t^8 + 18*t^7 + 81*t^6 + 272*t^5 + 567*t^4 + 882*t^3 + 2744*t^2 + 9604*t + 16807
sage: [abs(x[0])^2 for x in u.roots(CC)]
[7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000,
 7.00000000000000]
sage: u.is_weil_polynomial() # Should return True
False
```



---

Comment by kedlaya created at 2019-08-24 19:25:06

Changing status from new to needs_review.


---

Comment by kedlaya created at 2019-08-24 19:25:06

The underlying bug is in `trace_polynomial`:

```
sage: Q[t] = t
sage: u  = t^4 + 3*t^2 + 1
sage: u.trace_polynomial() ## First answer should be t^2+1
(t^2 + t + 1, 1, 1)
```

The code is currently accessing the leading coefficient without checking the degree; the corner case that triggers this bug is when the expected "leading" coefficient is zero, and so the wrong coefficient is accessed instead.
----
New commits:


---

Comment by chapoton created at 2019-08-25 06:05:31

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-08-25 06:05:31

ok, looks good. Thanks a lot.


---

Comment by vbraun created at 2019-08-28 19:54:57

Resolution: fixed
