# Issue 25290: missing wrappers in ComplexBallField

archive/issues_025290.json:
```json
{
    "body": "CC:  dimpase \u200bfredrik.johansson mmezzarobba slelievre\n\nWith Sage 8.2:\n\n```\nsage: C=ComplexBallField(100)\nsage: C.integral(lambda x,_:cosh(x),0,1)\n...\nTypeError: no canonical coercion from Real Field with 53 bits of precision to Complex ball field with 100 bits of precision\n```\n\nSame with `sqrt` and constants:\n\n```\nsage: C.integral(lambda x,_:sqrt(2),0,1)\n...\nTypeError: no canonical coercion from Symbolic Ring to Complex ball field with 100 bits of precision\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25527\n\n",
    "created_at": "2018-06-07T10:08:41Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "title": "missing wrappers in ComplexBallField",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25290",
    "user": "zimmerma"
}
```
CC:  dimpase ​fredrik.johansson mmezzarobba slelievre

With Sage 8.2:

```
sage: C=ComplexBallField(100)
sage: C.integral(lambda x,_:cosh(x),0,1)
...
TypeError: no canonical coercion from Real Field with 53 bits of precision to Complex ball field with 100 bits of precision
```

Same with `sqrt` and constants:

```
sage: C.integral(lambda x,_:sqrt(2),0,1)
...
TypeError: no canonical coercion from Symbolic Ring to Complex ball field with 100 bits of precision
```


Issue created by migration from https://trac.sagemath.org/ticket/25527





---

archive/issue_comments_356506.json:
```json
{
    "body": "It looks like all the ordinary (cosh, sinh, tanh, coth) hyperbolic functions are missing.\n\nHere is also a list of some other unwrapped functions, copied from an old email (this list is maybe slightly out of date):\n\n* arb_sec, arb_csc, arb_sech, arb_csch, acb_sec, acb_csc, acb_sech, acb_csch\n* acb_expm1, arb_sinc, arb_sinc_pi, acb_sinc, acb_sinc_pi\n* arb_sgn, acb_sgn, acb_csgn\n* Lambert W function\n* Everything in the acb_elliptic module\n* Everything in the arb_hypgeom module\n* can_round methods\n* Fresnel integrals\n* Different versions of incomplete gamma functions\n* Incomplete beta function\n* arb_bernoulli_poly_ui, acb_bernoulli_poly_ui + bernoulli/euler/partition numbers\n* Real matrices (I didn't see if there was an issue for this already)\n* FFT\n* A lot of power series methods\n* Maybe _acb_vec_unit_roots\n* Dirichlet L-functions\n* Interface to hypergeometric 2F1 for parameters differing by integers\n\nAlso:\n*  acb_real_abs, acb_real_sgn, acb_real_heaviside, acb_real_floor, acb_real_ceil, acb_real_max, acb_real_min, acb_real_sqrtpos",
    "created_at": "2018-06-07T12:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356506",
    "user": "fredrik.johansson"
}
```

It looks like all the ordinary (cosh, sinh, tanh, coth) hyperbolic functions are missing.

Here is also a list of some other unwrapped functions, copied from an old email (this list is maybe slightly out of date):

* arb_sec, arb_csc, arb_sech, arb_csch, acb_sec, acb_csc, acb_sech, acb_csch
* acb_expm1, arb_sinc, arb_sinc_pi, acb_sinc, acb_sinc_pi
* arb_sgn, acb_sgn, acb_csgn
* Lambert W function
* Everything in the acb_elliptic module
* Everything in the arb_hypgeom module
* can_round methods
* Fresnel integrals
* Different versions of incomplete gamma functions
* Incomplete beta function
* arb_bernoulli_poly_ui, acb_bernoulli_poly_ui + bernoulli/euler/partition numbers
* Real matrices (I didn't see if there was an issue for this already)
* FFT
* A lot of power series methods
* Maybe _acb_vec_unit_roots
* Dirichlet L-functions
* Interface to hypergeometric 2F1 for parameters differing by integers

Also:
*  acb_real_abs, acb_real_sgn, acb_real_heaviside, acb_real_floor, acb_real_ceil, acb_real_max, acb_real_min, acb_real_sqrtpos



---

archive/issue_comments_356507.json:
```json
{
    "body": "Yes, there are still a number of functions missing\u2014but I'm not sure it makes sense to open tickets about that unless you are planning to add the necessary wrappers.\n\nHowever, this:\n\nReplying to [ticket:25527 zimmerma]:\n> Same with `sqrt` and constants:\n> {{{\n> sage: C.integral(lambda x,_:sqrt(2),0,1)\n> ...\n> TypeError: no canonical coercion from Symbolic Ring to Complex ball field with 100 bits of precision\n> }}}\n\nis intentional. What you should be doing is:\n\n\n```\nsage: CBF.integral(lambda x, _: CBF(2).sqrt(), 0, 1)\n[1.414213562373095 +/- 2.99e-16]\n```\n\n\nof if you really want to use the global `sqrt()` function:\n\n\n```\nsage: CBF.integral(lambda x, _: sqrt(CBF(2)), 0, 1)\n[1.414213562373095 +/- 2.99e-16]\n```\n",
    "created_at": "2018-06-07T12:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356507",
    "user": "mmezzarobba"
}
```

Yes, there are still a number of functions missing—but I'm not sure it makes sense to open tickets about that unless you are planning to add the necessary wrappers.

However, this:

Replying to [ticket:25527 zimmerma]:
> Same with `sqrt` and constants:
> {{{
> sage: C.integral(lambda x,_:sqrt(2),0,1)
> ...
> TypeError: no canonical coercion from Symbolic Ring to Complex ball field with 100 bits of precision
> }}}

is intentional. What you should be doing is:


```
sage: CBF.integral(lambda x, _: CBF(2).sqrt(), 0, 1)
[1.414213562373095 +/- 2.99e-16]
```


of if you really want to use the global `sqrt()` function:


```
sage: CBF.integral(lambda x, _: sqrt(CBF(2)), 0, 1)
[1.414213562373095 +/- 2.99e-16]
```




---

archive/issue_comments_356508.json:
```json
{
    "body": "Marc, please could you explain why it is intentional? And for example why the constant `2` does not need to be explicitly converted to `CBF` in the following?\n\n```\nsage: CBF.integral(lambda x, _: sqrt(x+2), 0, 1)\n[1.57849254104856 +/- 2.25e-15]\n```\n",
    "created_at": "2018-06-08T09:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356508",
    "user": "zimmerma"
}
```

Marc, please could you explain why it is intentional? And for example why the constant `2` does not need to be explicitly converted to `CBF` in the following?

```
sage: CBF.integral(lambda x, _: sqrt(x+2), 0, 1)
[1.57849254104856 +/- 2.25e-15]
```




---

archive/issue_comments_356509.json:
```json
{
    "body": "Replying to [comment:4 zimmerma]:\n> Marc, please could you explain why it is intentional? And for example why the constant `2` does not need to be explicitly converted to `CBF` in the following?\n> {{{\n> sage: CBF.integral(lambda x, _: sqrt(x+2), 0, 1)\n> [1.57849254104856 +/- 2.25e-15]\n> }}}\n\nBecause `2` is an element of `ZZ`, which coerces into `CBF`, so that `x + 2` returns an element of `CBF`, and then `sqrt()` of an element of `CBF` returns an element of `CBF`. Whereas `sqrt(2)` returns an element of `SR`, which does not (and should not) coerce into `CBF`.",
    "created_at": "2018-06-08T12:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356509",
    "user": "mmezzarobba"
}
```

Replying to [comment:4 zimmerma]:
> Marc, please could you explain why it is intentional? And for example why the constant `2` does not need to be explicitly converted to `CBF` in the following?
> {{{
> sage: CBF.integral(lambda x, _: sqrt(x+2), 0, 1)
> [1.57849254104856 +/- 2.25e-15]
> }}}

Because `2` is an element of `ZZ`, which coerces into `CBF`, so that `x + 2` returns an element of `CBF`, and then `sqrt()` of an element of `CBF` returns an element of `CBF`. Whereas `sqrt(2)` returns an element of `SR`, which does not (and should not) coerce into `CBF`.



---

archive/issue_comments_356510.json:
```json
{
    "body": "That also goes for `I` (it would be so much nicer if such constants by default lived in `QQbar` or something like it instead of `SymbolicRing`...).",
    "created_at": "2018-06-08T13:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356510",
    "user": "fredrik.johansson"
}
```

That also goes for `I` (it would be so much nicer if such constants by default lived in `QQbar` or something like it instead of `SymbolicRing`...).



---

archive/issue_comments_356511.json:
```json
{
    "body": "Replying to [comment:6 fredrik.johansson]:\n> That also goes for `I` (it would be so much nicer if such constants by default lived in `QQbar` or something like it instead of `SymbolicRing`...).\n\nIt has been a plan for a long time to bind the global `I` to an element of \u211a[i] (see #18036), but there were backward compatibility concerns and perhaps other issues... I'll probably try reviving that ticket one day, though.",
    "created_at": "2018-06-08T14:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356511",
    "user": "mmezzarobba"
}
```

Replying to [comment:6 fredrik.johansson]:
> That also goes for `I` (it would be so much nicer if such constants by default lived in `QQbar` or something like it instead of `SymbolicRing`...).

It has been a plan for a long time to bind the global `I` to an element of ℚ[i] (see #18036), but there were backward compatibility concerns and perhaps other issues... I'll probably try reviving that ticket one day, though.



---

archive/issue_comments_356512.json:
```json
{
    "body": "Changing keywords from \"\" to \"CBF\".",
    "created_at": "2021-11-16T16:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356512",
    "user": "slelievre"
}
```

Changing keywords from "" to "CBF".



---

archive/issue_comments_356513.json:
```json
{
    "body": "note that the first example now works with Sage 9.1 (not tried with more recent versions):\n\n```\nsage: C = ComplexBallField(100)\nsage: C.integral(lambda x, _: cosh(x), 0, 1)\n[1.1752011936438014568823818506 +/- 2.32e-29]\n```\n\nThe second example (with `sqrt`) still fails with 9.1.",
    "created_at": "2021-11-16T16:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356513",
    "user": "zimmerma"
}
```

note that the first example now works with Sage 9.1 (not tried with more recent versions):

```
sage: C = ComplexBallField(100)
sage: C.integral(lambda x, _: cosh(x), 0, 1)
[1.1752011936438014568823818506 +/- 2.32e-29]
```

The second example (with `sqrt`) still fails with 9.1.



---

archive/issue_comments_356514.json:
```json
{
    "body": "Something like this works (with merged, but not yet in latest beta, changes): \n\n```\nage: C.integral(lambda x, _: CBF(sqrt(2)), 0, 1)\n[1.414213562373095 +/- 5.21e-16]\nsage: C.integral(lambda x, _: sqrt(x), 0, 1)\n[0.67388733867904916156919930316 +/- 3.76e-30] + [+/- 2.50e-36]*I\n```\n",
    "created_at": "2021-11-16T17:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356514",
    "user": "dimpase"
}
```

Something like this works (with merged, but not yet in latest beta, changes): 

```
age: C.integral(lambda x, _: CBF(sqrt(2)), 0, 1)
[1.414213562373095 +/- 5.21e-16]
sage: C.integral(lambda x, _: sqrt(x), 0, 1)
[0.67388733867904916156919930316 +/- 3.76e-30] + [+/- 2.50e-36]*I
```




---

archive/issue_comments_356515.json:
```json
{
    "body": "the examples from comment [comment:10] already work with Sage 9.1. However, the example from the description with `sqrt(2)` does not work.",
    "created_at": "2021-11-17T08:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356515",
    "user": "zimmerma"
}
```

the examples from comment [comment:10] already work with Sage 9.1. However, the example from the description with `sqrt(2)` does not work.



---

archive/issue_comments_356516.json:
```json
{
    "body": "here is a similar thing (with SR instead of a lambda) that works (with #32871 - but perhaps it's not needed):\n\n```\nsage: CBF(integral(sqrt(2), (x, 0, 1)))\n[1.414213562373095 +/- 5.21e-16]\nsage: C(integral(sqrt(2), (x, 0, 1)))\n[1.41421356237309504880168872421 +/- 2.41e-30]\n```\n\n\nwe had a discussion about a very similar setting (with RBF in place of CBF), and Marc convinced me that having to call conversion to RBF in real_arb.pyx (resp. to CBF in complex_arb.pyx)\nis not desirable - and coersion alone need not work if you go SR->RBF (or CDF).",
    "created_at": "2021-11-17T13:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356516",
    "user": "dimpase"
}
```

here is a similar thing (with SR instead of a lambda) that works (with #32871 - but perhaps it's not needed):

```
sage: CBF(integral(sqrt(2), (x, 0, 1)))
[1.414213562373095 +/- 5.21e-16]
sage: C(integral(sqrt(2), (x, 0, 1)))
[1.41421356237309504880168872421 +/- 2.41e-30]
```


we had a discussion about a very similar setting (with RBF in place of CBF), and Marc convinced me that having to call conversion to RBF in real_arb.pyx (resp. to CBF in complex_arb.pyx)
is not desirable - and coersion alone need not work if you go SR->RBF (or CDF).



---

archive/issue_comments_356517.json:
```json
{
    "body": "about the examples from comment [comment:12], since `integral(sqrt(2), (x, 0, 1))` evaluates to `sqrt(2)`, this is nothing else than `CBF(sqrt(2))`.",
    "created_at": "2021-11-17T14:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356517",
    "user": "zimmerma"
}
```

about the examples from comment [comment:12], since `integral(sqrt(2), (x, 0, 1))` evaluates to `sqrt(2)`, this is nothing else than `CBF(sqrt(2))`.



---

archive/issue_comments_356518.json:
```json
{
    "body": "well, it's rather `CBF.sqrt(2)`, which doesn't work, and won't get fixed.",
    "created_at": "2021-11-17T15:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356518",
    "user": "dimpase"
}
```

well, it's rather `CBF.sqrt(2)`, which doesn't work, and won't get fixed.



---

archive/issue_comments_356519.json:
```json
{
    "body": "if we don't even have `CBF.sqrt(2)` then I would not be hoping that `CBF.<... some pyhthon code with SR(sqrt(2))...>` would be working.",
    "created_at": "2021-11-17T15:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356519",
    "user": "dimpase"
}
```

if we don't even have `CBF.sqrt(2)` then I would not be hoping that `CBF.<... some pyhthon code with SR(sqrt(2))...>` would be working.



---

archive/issue_comments_356520.json:
```json
{
    "body": "Replying to [comment:11 zimmerma]:\n> the examples from comment [comment:10] already work with Sage 9.1. However, the example from the description with `sqrt(2)` does not work.\n\nSee [comment:3 these] [comment:5 comments] about that example.",
    "created_at": "2021-11-17T17:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25290#issuecomment-356520",
    "user": "mmezzarobba"
}
```

Replying to [comment:11 zimmerma]:
> the examples from comment [comment:10] already work with Sage 9.1. However, the example from the description with `sqrt(2)` does not work.

See [comment:3 these] [comment:5 comments] about that example.
