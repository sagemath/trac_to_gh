# Issue 29815: ubuntu-eoan-i386: cvxopt build fails

archive/issues_029815.json:
```json
{
    "body": "CC:  dimpase mjo tmonteil jsp\n\nhttps://github.com/mkoeppe/sage/runs/829178243\n\n\n```\n   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include -I/sage/local/include -I/usr/include/python3.7m -c src/C/umfpack.c -o build/temp.linux-x86_64-3.7/src/C/umfpack.o\n    src/C/umfpack.c:23:10: fatal error: umfpack.h: No such file or directory\n       23 | #include \"umfpack.h\"\n          |          ^~~~~~~~~~~\n    compilation terminated.\n    error: command 'gcc' failed with exit status 1\n    Running setup.py install for cvxopt: finished with status 'error'\n```\n\n\n\nIt looks like there is some ABI confusion. This is supposed to be a 32-bit build, but it seems like cvxopt is doing a 64-bit build.\n\nThis build uses system `suitesparse`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30052\n\n",
    "created_at": "2020-07-03T04:17:52Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "ubuntu-eoan-i386: cvxopt build fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29815",
    "user": "mkoeppe"
}
```
CC:  dimpase mjo tmonteil jsp

https://github.com/mkoeppe/sage/runs/829178243


```
   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include -I/sage/local/include -I/usr/include/python3.7m -c src/C/umfpack.c -o build/temp.linux-x86_64-3.7/src/C/umfpack.o
    src/C/umfpack.c:23:10: fatal error: umfpack.h: No such file or directory
       23 | #include "umfpack.h"
          |          ^~~~~~~~~~~
    compilation terminated.
    error: command 'gcc' failed with exit status 1
    Running setup.py install for cvxopt: finished with status 'error'
```



It looks like there is some ABI confusion. This is supposed to be a 32-bit build, but it seems like cvxopt is doing a 64-bit build.

This build uses system `suitesparse`.

Issue created by migration from https://trac.sagemath.org/ticket/30052





---

archive/issue_comments_423446.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-07-14T17:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423446",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_423447.json:
```json
{
    "body": "I see the same error on Rasbrian.\n(a 32-bit Debian ARM clone)",
    "created_at": "2020-07-14T17:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423447",
    "user": "dimpase"
}
```

I see the same error on Rasbrian.
(a 32-bit Debian ARM clone)



---

archive/issue_comments_423448.json:
```json
{
    "body": "IIRC Debian puts its suitesparse headers in `/usr/include/suitesparse` instead of `/usr/include`. Could that be the problem here?",
    "created_at": "2020-07-14T20:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423448",
    "user": "mjo"
}
```

IIRC Debian puts its suitesparse headers in `/usr/include/suitesparse` instead of `/usr/include`. Could that be the problem here?



---

archive/issue_comments_423449.json:
```json
{
    "body": "To answer my own question, it's probably half of the problem. The other half is that the guessing in cvxopt's setup.py is not sufficiently advanced:\n\n\n```\n# Guess SUITESPARSE_LIB_DIR and SUITESPARSE_INC_DIR                             \nif sys.platform.startswith(\"darwin\"):\n    # macOS                                                                     \n    SUITESPARSE_LIB_DIR = '/usr/local/lib'\n    SUITESPARSE_INC_DIR = '/usr/local/include'\nelse:\n    if glob(\"/usr/lib/x86_64-linux-gnu/libsuitesparse*\"):\n        # Ubuntu/Debian                                                         \n\tSUITESPARSE_LIB_DIR = \"/usr/lib/x86_64-linux-gnu\"\n        SUITESPARSE_INC_DIR = \"/usr/include/suitesparse\"\n    elif glob(\"/usr/lib64/libsuitesparse*\"):\n\t# CentOS/Fedora/RedHat                                                  \n        SUITESPARSE_LIB_DIR = \"/usr/lib64\"\n        SUITESPARSE_INC_DIR = \"/usr/include/suitesparse\"\n    else:\n        # Default                                                               \n        SUITESPARSE_LIB_DIR = '/usr/lib'\n\tSUITESPARSE_INC_DIR = '/usr/include'\n```\n",
    "created_at": "2020-07-14T20:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423449",
    "user": "mjo"
}
```

To answer my own question, it's probably half of the problem. The other half is that the guessing in cvxopt's setup.py is not sufficiently advanced:


```
# Guess SUITESPARSE_LIB_DIR and SUITESPARSE_INC_DIR                             
if sys.platform.startswith("darwin"):
    # macOS                                                                     
    SUITESPARSE_LIB_DIR = '/usr/local/lib'
    SUITESPARSE_INC_DIR = '/usr/local/include'
else:
    if glob("/usr/lib/x86_64-linux-gnu/libsuitesparse*"):
        # Ubuntu/Debian                                                         
	SUITESPARSE_LIB_DIR = "/usr/lib/x86_64-linux-gnu"
        SUITESPARSE_INC_DIR = "/usr/include/suitesparse"
    elif glob("/usr/lib64/libsuitesparse*"):
	# CentOS/Fedora/RedHat                                                  
        SUITESPARSE_LIB_DIR = "/usr/lib64"
        SUITESPARSE_INC_DIR = "/usr/include/suitesparse"
    else:
        # Default                                                               
        SUITESPARSE_LIB_DIR = '/usr/lib'
	SUITESPARSE_INC_DIR = '/usr/include'
```




---

archive/issue_comments_423450.json:
```json
{
    "body": "good point, and the reason for failure on ARM, as there\none has \n\n`/usr/lib/arm-linux-gnueabihf/libsuitesparseconfig.so`",
    "created_at": "2020-07-14T21:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423450",
    "user": "dimpase"
}
```

good point, and the reason for failure on ARM, as there
one has 

`/usr/lib/arm-linux-gnueabihf/libsuitesparseconfig.so`



---

archive/issue_comments_423451.json:
```json
{
    "body": "see https://github.com/cvxopt/cvxopt/issues/174",
    "created_at": "2020-07-14T21:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423451",
    "user": "dimpase"
}
```

see https://github.com/cvxopt/cvxopt/issues/174



---

archive/issue_comments_423452.json:
```json
{
    "body": "Is there a patch yet?",
    "created_at": "2020-07-27T12:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423452",
    "user": "mkoeppe"
}
```

Is there a patch yet?



---

archive/issue_comments_423453.json:
```json
{
    "body": "The update to 1.2.5 (on the branch) does not fix this issue.\n----\nNew commits:",
    "created_at": "2020-08-12T19:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423453",
    "user": "mkoeppe"
}
```

The update to 1.2.5 (on the branch) does not fix this issue.
----
New commits:



---

archive/issue_comments_423454.json:
```json
{
    "body": "Also fails on `ubuntu-groovy-standard` (https://github.com/sagemath/sage/runs/1000600749)",
    "created_at": "2020-08-19T18:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423454",
    "user": "mkoeppe"
}
```

Also fails on `ubuntu-groovy-standard` (https://github.com/sagemath/sage/runs/1000600749)



---

archive/issue_comments_423455.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-08-19T19:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423455",
    "user": "mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_423456.json:
```json
{
    "body": "ok, let me have a go at it.",
    "created_at": "2020-08-24T07:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423456",
    "user": "dimpase"
}
```

ok, let me have a go at it.



---

archive/issue_comments_423457.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-08-24T07:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423457",
    "user": "dimpase"
}
```

New commits:



---

archive/issue_comments_423458.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-24T09:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423458",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423459.json:
```json
{
    "body": "this allows to build CVXOPT on !Debian/Rasbrian ARM. Have yet to check other archs",
    "created_at": "2020-08-24T09:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423459",
    "user": "dimpase"
}
```

this allows to build CVXOPT on !Debian/Rasbrian ARM. Have yet to check other archs



---

archive/issue_comments_423460.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-24T09:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423460",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423461.json:
```json
{
    "body": "tests run on https://github.com/sagemath/sage/pull/96",
    "created_at": "2020-08-24T09:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423461",
    "user": "dimpase"
}
```

tests run on https://github.com/sagemath/sage/pull/96



---

archive/issue_comments_423462.json:
```json
{
    "body": "Successfully built cvxopt on `docker-ubuntu-eoan-i386-standard-python3_spkg` (on top of #27754)",
    "created_at": "2020-08-24T20:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423462",
    "user": "mkoeppe"
}
```

Successfully built cvxopt on `docker-ubuntu-eoan-i386-standard-python3_spkg` (on top of #27754)



---

archive/issue_comments_423463.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-25T00:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423463",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423464.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-30T08:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29815",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29815#issuecomment-423464",
    "user": "vbraun"
}
```

Resolution: fixed
