# Issue 29815: ubuntu-eoan-i386: cvxopt build fails

Issue created by migration from https://trac.sagemath.org/ticket/30052

Original creator: mkoeppe

Original creation time: 2020-07-03 04:17:52

CC:  dimpase mjo tmonteil jsp

https://github.com/mkoeppe/sage/runs/829178243


```
   gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include -I/sage/local/include -I/usr/include/python3.7m -c src/C/umfpack.c -o build/temp.linux-x86_64-3.7/src/C/umfpack.o
    src/C/umfpack.c:23:10: fatal error: umfpack.h: No such file or directory
       23 | #include "umfpack.h"
          |          ^~~~~~~~~~~
    compilation terminated.
    error: command 'gcc' failed with exit status 1
    Running setup.py install for cvxopt: finished with status 'error'
```



It looks like there is some ABI confusion. This is supposed to be a 32-bit build, but it seems like cvxopt is doing a 64-bit build.

This build uses system `suitesparse`.


---

Comment by mkoeppe created at 2020-07-14 17:40:32

Changing priority from major to critical.


---

Comment by dimpase created at 2020-07-14 17:44:05

I see the same error on Rasbrian.
(a 32-bit Debian ARM clone)


---

Comment by mjo created at 2020-07-14 20:54:13

IIRC Debian puts its suitesparse headers in `/usr/include/suitesparse` instead of `/usr/include`. Could that be the problem here?


---

Comment by mjo created at 2020-07-14 20:56:44

To answer my own question, it's probably half of the problem. The other half is that the guessing in cvxopt's setup.py is not sufficiently advanced:


```
# Guess SUITESPARSE_LIB_DIR and SUITESPARSE_INC_DIR                             
if sys.platform.startswith("darwin"):
    # macOS                                                                     
    SUITESPARSE_LIB_DIR = '/usr/local/lib'
    SUITESPARSE_INC_DIR = '/usr/local/include'
else:
    if glob("/usr/lib/x86_64-linux-gnu/libsuitesparse*"):
        # Ubuntu/Debian                                                         
	SUITESPARSE_LIB_DIR = "/usr/lib/x86_64-linux-gnu"
        SUITESPARSE_INC_DIR = "/usr/include/suitesparse"
    elif glob("/usr/lib64/libsuitesparse*"):
	# CentOS/Fedora/RedHat                                                  
        SUITESPARSE_LIB_DIR = "/usr/lib64"
        SUITESPARSE_INC_DIR = "/usr/include/suitesparse"
    else:
        # Default                                                               
        SUITESPARSE_LIB_DIR = '/usr/lib'
	SUITESPARSE_INC_DIR = '/usr/include'
```



---

Comment by dimpase created at 2020-07-14 21:10:20

good point, and the reason for failure on ARM, as there
one has 

`/usr/lib/arm-linux-gnueabihf/libsuitesparseconfig.so`


---

Comment by dimpase created at 2020-07-14 21:20:18

see https://github.com/cvxopt/cvxopt/issues/174


---

Comment by mkoeppe created at 2020-07-27 12:36:38

Is there a patch yet?


---

Comment by mkoeppe created at 2020-08-12 19:15:07

The update to 1.2.5 (on the branch) does not fix this issue.
----
New commits:


---

Comment by mkoeppe created at 2020-08-19 18:23:56

Also fails on `ubuntu-groovy-standard` (https://github.com/sagemath/sage/runs/1000600749)


---

Comment by mkoeppe created at 2020-08-19 19:05:05

Changing priority from critical to blocker.


---

Comment by dimpase created at 2020-08-24 07:38:18

ok, let me have a go at it.


---

Comment by dimpase created at 2020-08-24 07:53:25

New commits:


---

Comment by git created at 2020-08-24 09:29:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-08-24 09:33:45

this allows to build CVXOPT on !Debian/Rasbrian ARM. Have yet to check other archs


---

Comment by dimpase created at 2020-08-24 09:33:45

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-08-24 09:37:37

tests run on https://github.com/sagemath/sage/pull/96


---

Comment by mkoeppe created at 2020-08-24 20:10:22

Successfully built cvxopt on `docker-ubuntu-eoan-i386-standard-python3_spkg` (on top of #27754)


---

Comment by mkoeppe created at 2020-08-25 00:22:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-30 08:39:31

Resolution: fixed
