# Issue 32094: refresh sage-fixdoctests using argparse

archive/issues_032094.json:
```json
{
    "body": "CC:  tscrim slelievre @kliem\n\npart of #31366\n\nalso full flake8 cleanup of the modified file\n\nIssue created by migration from https://trac.sagemath.org/ticket/32331\n\n",
    "created_at": "2021-08-03T19:14:00Z",
    "labels": [
        "scripts",
        "major",
        "enhancement"
    ],
    "title": "refresh sage-fixdoctests using argparse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32094",
    "user": "chapoton"
}
```
CC:  tscrim slelievre @kliem

part of #31366

also full flake8 cleanup of the modified file

Issue created by migration from https://trac.sagemath.org/ticket/32331





---

archive/issue_comments_458369.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458369",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_458370.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-03T19:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458370",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458371.json:
```json
{
    "body": "One thing that could be considered a regression is that if I do something like\n\n```\n./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py\n```\n\nthen I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.",
    "created_at": "2021-08-05T05:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458371",
    "user": "tscrim"
}
```

One thing that could be considered a regression is that if I do something like

```
./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py
```

then I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.



---

archive/issue_comments_458372.json:
```json
{
    "body": "ok, I see.\n\nWe could introduce an option `-o, --output` and try to handle multiple input files.\n\nOr stay with the principle that this is to fix just one single file ?",
    "created_at": "2021-08-05T06:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458372",
    "user": "chapoton"
}
```

ok, I see.

We could introduce an option `-o, --output` and try to handle multiple input files.

Or stay with the principle that this is to fix just one single file ?



---

archive/issue_comments_458373.json:
```json
{
    "body": "I think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.",
    "created_at": "2021-08-05T13:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458373",
    "user": "tscrim"
}
```

I think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.



---

archive/issue_comments_458374.json:
```json
{
    "body": "I do not see how to distinguish between the incorrect use\n\n```\nsage --fixdoctests a.py b.py\n```\n\nwhere the intention is to fix both a.py and b.py inplace ; and the correct use\n\n```\nsage --fixdoctests a.py b.py\n```\n\nwhere the intention is to write a corrected copy of a.py in b.py.\n\nIn the second case, it could very well be that b.py is existing already, as in the first case.\n\nI think one can reasonably keep the current behaviour, which is indeed documented.",
    "created_at": "2021-08-05T14:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458374",
    "user": "chapoton"
}
```

I do not see how to distinguish between the incorrect use

```
sage --fixdoctests a.py b.py
```

where the intention is to fix both a.py and b.py inplace ; and the correct use

```
sage --fixdoctests a.py b.py
```

where the intention is to write a corrected copy of a.py in b.py.

In the second case, it could very well be that b.py is existing already, as in the first case.

I think one can reasonably keep the current behaviour, which is indeed documented.



---

archive/issue_comments_458375.json:
```json
{
    "body": "I agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like\n\n```\nsage --fixdoctests a.py b.py c.py\n```\n\nthat `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.",
    "created_at": "2021-08-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458375",
    "user": "tscrim"
}
```

I agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like

```
sage --fixdoctests a.py b.py c.py
```

that `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.



---

archive/issue_comments_458376.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458376",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458377.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-05T21:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32094#issuecomment-458377",
    "user": "vbraun"
}
```

Resolution: fixed
