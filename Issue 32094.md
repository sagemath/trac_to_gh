# Issue 32094: refresh sage-fixdoctests using argparse

Issue created by migration from https://trac.sagemath.org/ticket/32331

Original creator: chapoton

Original creation time: 2021-08-03 19:14:00

CC:  tscrim slelievre @kliem

part of #31366

also full flake8 cleanup of the modified file


---

Comment by chapoton created at 2021-08-03 19:15:06

New commits:


---

Comment by chapoton created at 2021-08-03 19:15:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-08-05 05:18:40

One thing that could be considered a regression is that if I do something like

```
./sage --fixdoctests src/sage/combinat/q_analogues.py src/sage/combinat/rsk.py src/sage/combinat/fqsym.py
```

then I now get that `rsk.py` is an empty file, whereas the old behavior left `rsk.py` alone. So what we get is a new file with no output when the is erroneous input passed. There might not be a way around this because that is how `argparse` works, but I wanted to ask before giving the go-ahead with this.


---

Comment by chapoton created at 2021-08-05 06:35:53

ok, I see.

We could introduce an option `-o, --output` and try to handle multiple input files.

Or stay with the principle that this is to fix just one single file ?


---

Comment by tscrim created at 2021-08-05 13:09:31

I think it is fine to handle just one file, which I believe is documented. It is more if someone gives it bad input (and it realizes this) that it doesn't change any files. However, this isn't really a big deal. I think the current branch is fine, but I wanted to see if there was an easy fix to prevent this from happening.


---

Comment by chapoton created at 2021-08-05 14:43:57

I do not see how to distinguish between the incorrect use

```
sage --fixdoctests a.py b.py
```

where the intention is to fix both a.py and b.py inplace ; and the correct use

```
sage --fixdoctests a.py b.py
```

where the intention is to write a corrected copy of a.py in b.py.

In the second case, it could very well be that b.py is existing already, as in the first case.

I think one can reasonably keep the current behaviour, which is indeed documented.


---

Comment by tscrim created at 2021-08-05 22:28:58

I agree that we cannot distinguish between improper use and proper use. What I was saying is if someone does improper use like

```
sage --fixdoctests a.py b.py c.py
```

that `b.py` is not overwritten with a blank file (previously it did not). However, I doubt we can easily fix this, so I am setting this to a positive review.


---

Comment by tscrim created at 2021-08-05 22:28:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-09-05 21:38:30

Resolution: fixed
