# Issue 31571: AA cannot convert real elements from a quadratic field

Issue created by migration from https://trac.sagemath.org/ticket/31808

Original creator: tscrim

Original creation time: 2021-05-11 00:39:07

CC:  vdelecroix mmezzarobba mjo

Keywords: AA, conversion

Broken by #31628:

```
sage: C.<I> = QuadraticField(-1)
sage: AA(C.one())
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-175efcbd0268> in <module>
----> 1 AA(C.one())

~/sage-build/local/lib/python3.9/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9335)()
    896         if mor is not None:
    897             if no_extra_args:
--> 898                 return mor._call_(x)
    899             else:
    900                 return mor._call_with_args(x, args, kwds)

~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4622)()
    159                 print(type(C), C)
    160                 print(type(C._element_constructor), C._element_constructor)
--> 161             raise
    162 
    163     cpdef Element _call_with_args(self, x, args=(), kwds={}):

~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4514)()
    154         cdef Parent C = self._codomain
    155         try:
--> 156             return C._element_constructor(x)
    157         except Exception:
    158             if print_warnings:

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in _element_constructor_(self, x)
   1108                 raise ValueError("Cannot coerce algebraic number with non-zero imaginary part to algebraic real")
   1109         elif hasattr(x, '_algebraic_'):
-> 1110             return x._algebraic_(AA)
   1111         return AlgebraicReal(x)
   1112 

~/sage-build/local/lib/python3.9/site-packages/sage/rings/number_field/number_field_element_quadratic.pyx in sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_gaussian._algebraic_ (build/cythonized/sage/rings/number_field/number_field_element_quadratic.cpp:19840)()
   2419             return qqbar.AlgebraicNumber(self)
   2420         elif parent is qqbar.AA and self[1].is_zero():
-> 2421             return qqbar.AlgebraicReal(self)
   2422         else:
   2423             raise ValueError(f"unable to convert {self!r} to an element of {parent!r}")

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, x)
   5178             -1.414213562373095?
   5179         """
-> 5180         AlgebraicNumber_base.__init__(self, AA, x)
   5181         self._ensure_real()
   5182 

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, parent, x)
   3501                 self._descr = ANExtensionElement(QQbar_I_generator, QQbar_I_nf([x[0], -x[1]]))
   3502         else:
-> 3503             raise TypeError("Illegal initializer for algebraic number")
   3504 
   3505         prec = 64

TypeError: Illegal initializer for algebraic number
```



---

Comment by tscrim created at 2021-05-11 00:59:28

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-05-11 00:59:28

We should just split off the real part to `AA`. Simple fix.
----
New commits:


---

Comment by git created at 2021-05-11 01:11:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-05-11 01:13:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-05-11 01:22:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2021-05-11 01:23:46

I redid it to use `parts`, which is guaranteed to have a pair of rational numbers as output.


---

Comment by mmezzarobba created at 2021-05-11 07:20:49

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2021-05-11 07:20:49

Thank you!


---

Comment by vbraun created at 2021-05-27 20:29:30

Resolution: fixed
