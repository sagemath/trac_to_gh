# Issue 12589: Givaro's (3.2.13.rc1) C++ headers don't conform to C++11

Issue created by migration from Trac.

Original creator: leif

Original creation time: 2012-03-27 18:12:07

Assignee: leif

CC:  cpernet malb mariah

Keywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg

This breaks the build of its test suite as well as of the Sage library *with* (e.g.) *GCC 4.7.x*.

I already have an spkg fixing this, i.e., the offending headers.


---

Comment by leif created at 2012-03-27 19:46:11

Diff between the previous spkg in Sage and my new p4 spkg. For reference / review only.


---

Attachment


---

Comment by leif created at 2012-03-27 20:00:48

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-03-28 08:30:28

This is something which should be reported upstream (sending them the patch of course).


---

Comment by jdemeyer created at 2012-03-28 08:34:44

If adding the -I flag is not necessary, then why add it while saying it is not needed?

```
# It shouldn't be necessary to add Sage's include directory here, 
# since we configure with '--with-gmp=...'. 
# Also, '-I...' should normally be added to (just) CPPFLAGS. 
CFLAGS="$CFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
CXXFLAGS="$CXXFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
```



---

Comment by jdemeyer created at 2012-03-28 08:36:38

Don't Cython modules have proper dependency checking these days?  Then the "touching" part might not be needed.


---

Comment by leif created at 2012-03-28 16:20:28

Replying to [comment:4 jdemeyer]:
> If adding the -I flag is not necessary, then why add it while saying it is not needed?
> {{{
> # It shouldn't be necessary to add Sage's include directory here, 
> # since we configure with '--with-gmp=...'. 
> # Also, '-I...' should normally be added to (just) CPPFLAGS. 
> CFLAGS="$CFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
> CXXFLAGS="$CXXFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
> }}}

I haven't added this, nor have I checked that it works, i.e., builds, without that (although I'm pretty sure it would) -- that's why I wrote _"shouldn't be necessary"_, not _"isn't needed"_.

One side effect of adding it is that the test suite is built with the headers installed into Sage, which isn't all bad, but I can try to remove it later, although quite unrelated to the purpose of this ticket.

W.r.t. `touch`ing: It doesn't hurt.  Moreover, the installed headers might have timestamps earlier than those of the Python extension modules, such that Cython probably won't notice that they're "new".


---

Comment by leif created at 2012-03-28 16:29:43

Replying to [comment:3 jdemeyer]:
> This is something which should be reported upstream (sending them the patch of course).

I cc'ed the spkg maintainers, which include ClÃ©ment Pernet, according to `SPKG.txt` also the upstream contact.

Note that (as already mentioned elsewhere) the version currently in Sage is a _release candidate_, dated 2008 IIRC.


---

Comment by leif created at 2012-04-08 02:59:56

Added a reference to #12444.


---

Comment by ddrake created at 2012-04-17 06:59:01

The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.


---

Comment by leif created at 2012-04-17 22:02:39

Replying to [comment:9 ddrake]:
> The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything 

Fine.

> except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.

Nope, I haven't added casts, but (roughly speaking) qualified the names of (mostly, I think) member functions used in _template_ class member functions, i.e.,

```c++
template <class Foo>
void Bar<Foo>::bar() // member function bar() of class Bar, which is parameterized by a class Foo
{
    Bar<Foo>::baz(); // call with qualified [function] name; 
                     // baz() here is [also] a member function of [template] class Bar
}
```

instead of

```c++
...
{
    baz(); // call with unqualified [function] name
}
```

I could have used

```c++
...
{
    this->baz();
}
```

instead in most (if not all) cases as well; cf. Andrew Ohana's changes at #12444 (which I unfortunately found only after I made my own changes).


---

Comment by leif created at 2012-04-17 22:31:26

(Note that just using `baz()` wouldn't be a problem if it was already declared as a "direct" member function of `Bar`; problems arise if `baz()` isn't yet known at the point of the template definition, e.g. because it is inherited from a class which is a template parameter.  I rather wanted to explain the `Bar<Foo>::` prefix above.)


---

Comment by Snark created at 2012-05-14 14:05:48

givaro-3.2.13.rc1.p3 from 5.0.rc1 built well already, but I still gave a try to :
a84996518e39a1197eaf63562d8fe734  givaro-3.2.13.rc1.p4.spkg
and it built well too on my debian x86_64 box using gcc 4.7.0.


---

Comment by Snark created at 2012-05-15 11:30:28

Upstream latest version 3.5.0 doesn't compile with gcc 4.7 ; but their trunk does. I have written them to know when a new release will be available.

Did you discuss your patch with upstream?


---

Comment by Snark created at 2012-05-16 17:55:47

Upstream just released 3.6.0 today -- just upgrade!


---

Attachment


---

Comment by jdemeyer created at 2012-05-26 01:04:02

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg sd40.5".


---

Comment by jdemeyer created at 2012-05-26 01:47:13

Diff between leif's 3.2.13.rc1.p4 and my 3.2.13.p0 spkg. For reference / review only.


---

Attachment

This works and passes tests on sage.math with GCC-4.7.0 and with some 4.6.x on Mac OS X, and all the changes make sense, so I think this is ready to go as well.


---

Comment by kcrisman created at 2012-05-26 03:41:21

Changing status from needs_review to positive_review.


---

Comment by Snark created at 2012-05-26 09:26:54

Why not just upgrade to upstream 3.6.0 ?


---

Comment by jdemeyer created at 2012-06-02 13:42:19

Resolution: fixed
