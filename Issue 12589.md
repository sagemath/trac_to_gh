# Issue 12589: Givaro's (3.2.13.rc1) C++ headers don't conform to C++11

archive/issues_012589.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  @ClementPernet @malb mariah\n\nKeywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg\n\nThis breaks the build of its test suite as well as of the Sage library **with** (e.g.) **GCC 4.7.x**.\n\nI already have an spkg fixing this, i.e., the offending headers.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12761\n\n",
    "created_at": "2012-03-27T18:12:07Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0.1",
    "title": "Givaro's (3.2.13.rc1) C++ headers don't conform to C++11",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12589",
    "user": "@nexttime"
}
```
Assignee: @nexttime

CC:  @ClementPernet @malb mariah

Keywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg

This breaks the build of its test suite as well as of the Sage library **with** (e.g.) **GCC 4.7.x**.

I already have an spkg fixing this, i.e., the offending headers.

Issue created by migration from https://trac.sagemath.org/ticket/12761





---

archive/issue_comments_149700.json:
```json
{
    "body": "Diff between the previous spkg in Sage and my new p4 spkg. For reference / review only.",
    "created_at": "2012-03-27T19:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149700",
    "user": "@nexttime"
}
```

Diff between the previous spkg in Sage and my new p4 spkg. For reference / review only.



---

archive/issue_comments_149701.json:
```json
{
    "body": "Attachment [givaro-3.2.13.rc1.p3-p4.diff](tarball://root/attachments/some-uuid/ticket12761/givaro-3.2.13.rc1.p3-p4.diff) by @nexttime created at 2012-03-27 20:00:48",
    "created_at": "2012-03-27T20:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149701",
    "user": "@nexttime"
}
```

Attachment [givaro-3.2.13.rc1.p3-p4.diff](tarball://root/attachments/some-uuid/ticket12761/givaro-3.2.13.rc1.p3-p4.diff) by @nexttime created at 2012-03-27 20:00:48



---

archive/issue_comments_149702.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-27T20:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149702",
    "user": "@nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149703.json:
```json
{
    "body": "This is something which should be reported upstream (sending them the patch of course).",
    "created_at": "2012-03-28T08:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149703",
    "user": "@jdemeyer"
}
```

This is something which should be reported upstream (sending them the patch of course).



---

archive/issue_comments_149704.json:
```json
{
    "body": "If adding the -I flag is not necessary, then why add it while saying it is not needed?\n\n```\n# It shouldn't be necessary to add Sage's include directory here, \n# since we configure with '--with-gmp=...'. \n# Also, '-I...' should normally be added to (just) CPPFLAGS. \nCFLAGS=\"$CFLAGS -fPIC -I\\\"$SAGE_LOCAL/include\\\"\" \nCXXFLAGS=\"$CXXFLAGS -fPIC -I\\\"$SAGE_LOCAL/include\\\"\" \n```\n",
    "created_at": "2012-03-28T08:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149704",
    "user": "@jdemeyer"
}
```

If adding the -I flag is not necessary, then why add it while saying it is not needed?

```
# It shouldn't be necessary to add Sage's include directory here, 
# since we configure with '--with-gmp=...'. 
# Also, '-I...' should normally be added to (just) CPPFLAGS. 
CFLAGS="$CFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
CXXFLAGS="$CXXFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
```




---

archive/issue_comments_149705.json:
```json
{
    "body": "Don't Cython modules have proper dependency checking these days?  Then the \"touching\" part might not be needed.",
    "created_at": "2012-03-28T08:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149705",
    "user": "@jdemeyer"
}
```

Don't Cython modules have proper dependency checking these days?  Then the "touching" part might not be needed.



---

archive/issue_comments_149706.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> If adding the -I flag is not necessary, then why add it while saying it is not needed?\n> {{{\n> # It shouldn't be necessary to add Sage's include directory here, \n> # since we configure with '--with-gmp=...'. \n> # Also, '-I...' should normally be added to (just) CPPFLAGS. \n> CFLAGS=\"$CFLAGS -fPIC -I\\\"$SAGE_LOCAL/include\\\"\" \n> CXXFLAGS=\"$CXXFLAGS -fPIC -I\\\"$SAGE_LOCAL/include\\\"\" \n> }}}\n\nI haven't added this, nor have I checked that it works, i.e., builds, without that (although I'm pretty sure it would) -- that's why I wrote *\"shouldn't be necessary\"*, not *\"isn't needed\"*.\n\nOne side effect of adding it is that the test suite is built with the headers installed into Sage, which isn't all bad, but I can try to remove it later, although quite unrelated to the purpose of this ticket.\n\nW.r.t. `touch`ing: It doesn't hurt.  Moreover, the installed headers might have timestamps earlier than those of the Python extension modules, such that Cython probably won't notice that they're \"new\".",
    "created_at": "2012-03-28T16:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149706",
    "user": "@nexttime"
}
```

Replying to [comment:4 jdemeyer]:
> If adding the -I flag is not necessary, then why add it while saying it is not needed?
> {{{
> # It shouldn't be necessary to add Sage's include directory here, 
> # since we configure with '--with-gmp=...'. 
> # Also, '-I...' should normally be added to (just) CPPFLAGS. 
> CFLAGS="$CFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
> CXXFLAGS="$CXXFLAGS -fPIC -I\"$SAGE_LOCAL/include\"" 
> }}}

I haven't added this, nor have I checked that it works, i.e., builds, without that (although I'm pretty sure it would) -- that's why I wrote *"shouldn't be necessary"*, not *"isn't needed"*.

One side effect of adding it is that the test suite is built with the headers installed into Sage, which isn't all bad, but I can try to remove it later, although quite unrelated to the purpose of this ticket.

W.r.t. `touch`ing: It doesn't hurt.  Moreover, the installed headers might have timestamps earlier than those of the Python extension modules, such that Cython probably won't notice that they're "new".



---

archive/issue_comments_149707.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> This is something which should be reported upstream (sending them the patch of course).\n\nI cc'ed the spkg maintainers, which include Cl\u00e9ment Pernet, according to `SPKG.txt` also the upstream contact.\n\nNote that (as already mentioned elsewhere) the version currently in Sage is a *release candidate*, dated 2008 IIRC.",
    "created_at": "2012-03-28T16:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149707",
    "user": "@nexttime"
}
```

Replying to [comment:3 jdemeyer]:
> This is something which should be reported upstream (sending them the patch of course).

I cc'ed the spkg maintainers, which include ClÃ©ment Pernet, according to `SPKG.txt` also the upstream contact.

Note that (as already mentioned elsewhere) the version currently in Sage is a *release candidate*, dated 2008 IIRC.



---

archive/issue_comments_149708.json:
```json
{
    "body": "Added a reference to #12444.",
    "created_at": "2012-04-08T02:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149708",
    "user": "@nexttime"
}
```

Added a reference to #12444.



---

archive/issue_comments_149709.json:
```json
{
    "body": "The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.",
    "created_at": "2012-04-17T06:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149709",
    "user": "@dandrake"
}
```

The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.



---

archive/issue_comments_149710.json:
```json
{
    "body": "Replying to [comment:9 ddrake]:\n> The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything \n\nFine.\n\n> except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.\n\nNope, I haven't added casts, but (roughly speaking) qualified the names of (mostly, I think) member functions used in *template* class member functions, i.e.,\n\n```c++\ntemplate <class Foo>\nvoid Bar<Foo>::bar() // member function bar() of class Bar, which is parameterized by a class Foo\n{\n    Bar<Foo>::baz(); // call with qualified [function] name; \n                     // baz() here is [also] a member function of [template] class Bar\n}\n```\n\ninstead of\n\n```c++\n...\n{\n    baz(); // call with unqualified [function] name\n}\n```\n\nI could have used\n\n```c++\n...\n{\n    this->baz();\n}\n```\n\ninstead in most (if not all) cases as well; cf. Andrew Ohana's changes at #12444 (which I unfortunately found only after I made my own changes).",
    "created_at": "2012-04-17T22:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149710",
    "user": "@nexttime"
}
```

Replying to [comment:9 ddrake]:
> The new spkg actually builds and passes tests (such as they are) on skynet/cicero. I can give a positive review to everything 

Fine.

> except your new header patches; they seem simple enough (almost all of it is just casting things to other types, right?) but I don't know enough C++ to be confident about that.

Nope, I haven't added casts, but (roughly speaking) qualified the names of (mostly, I think) member functions used in *template* class member functions, i.e.,

```c++
template <class Foo>
void Bar<Foo>::bar() // member function bar() of class Bar, which is parameterized by a class Foo
{
    Bar<Foo>::baz(); // call with qualified [function] name; 
                     // baz() here is [also] a member function of [template] class Bar
}
```

instead of

```c++
...
{
    baz(); // call with unqualified [function] name
}
```

I could have used

```c++
...
{
    this->baz();
}
```

instead in most (if not all) cases as well; cf. Andrew Ohana's changes at #12444 (which I unfortunately found only after I made my own changes).



---

archive/issue_comments_149711.json:
```json
{
    "body": "(Note that just using `baz()` wouldn't be a problem if it was already declared as a \"direct\" member function of `Bar`; problems arise if `baz()` isn't yet known at the point of the template definition, e.g. because it is inherited from a class which is a template parameter.  I rather wanted to explain the `Bar<Foo>::` prefix above.)",
    "created_at": "2012-04-17T22:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149711",
    "user": "@nexttime"
}
```

(Note that just using `baz()` wouldn't be a problem if it was already declared as a "direct" member function of `Bar`; problems arise if `baz()` isn't yet known at the point of the template definition, e.g. because it is inherited from a class which is a template parameter.  I rather wanted to explain the `Bar<Foo>::` prefix above.)



---

archive/issue_comments_149712.json:
```json
{
    "body": "givaro-3.2.13.rc1.p3 from 5.0.rc1 built well already, but I still gave a try to :\na84996518e39a1197eaf63562d8fe734  givaro-3.2.13.rc1.p4.spkg\nand it built well too on my debian x86_64 box using gcc 4.7.0.",
    "created_at": "2012-05-14T14:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149712",
    "user": "Snark"
}
```

givaro-3.2.13.rc1.p3 from 5.0.rc1 built well already, but I still gave a try to :
a84996518e39a1197eaf63562d8fe734  givaro-3.2.13.rc1.p4.spkg
and it built well too on my debian x86_64 box using gcc 4.7.0.



---

archive/issue_comments_149713.json:
```json
{
    "body": "Upstream latest version 3.5.0 doesn't compile with gcc 4.7 ; but their trunk does. I have written them to know when a new release will be available.\n\nDid you discuss your patch with upstream?",
    "created_at": "2012-05-15T11:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149713",
    "user": "Snark"
}
```

Upstream latest version 3.5.0 doesn't compile with gcc 4.7 ; but their trunk does. I have written them to know when a new release will be available.

Did you discuss your patch with upstream?



---

archive/issue_comments_149714.json:
```json
{
    "body": "Upstream just released 3.6.0 today -- just upgrade!",
    "created_at": "2012-05-16T17:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149714",
    "user": "Snark"
}
```

Upstream just released 3.6.0 today -- just upgrade!



---

archive/issue_comments_149715.json:
```json
{
    "body": "Attachment [12761_givaro_depends.patch](tarball://root/attachments/some-uuid/ticket12761/12761_givaro_depends.patch) by @jdemeyer created at 2012-05-25 23:27:04",
    "created_at": "2012-05-25T23:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149715",
    "user": "@jdemeyer"
}
```

Attachment [12761_givaro_depends.patch](tarball://root/attachments/some-uuid/ticket12761/12761_givaro_depends.patch) by @jdemeyer created at 2012-05-25 23:27:04



---

archive/issue_comments_149716.json:
```json
{
    "body": "Changing keywords from \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg\" to \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg sd40.5\".",
    "created_at": "2012-05-26T01:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149716",
    "user": "@jdemeyer"
}
```

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg sd40.5".



---

archive/issue_comments_149717.json:
```json
{
    "body": "Diff between leif's 3.2.13.rc1.p4 and my 3.2.13.p0 spkg. For reference / review only.",
    "created_at": "2012-05-26T01:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149717",
    "user": "@jdemeyer"
}
```

Diff between leif's 3.2.13.rc1.p4 and my 3.2.13.p0 spkg. For reference / review only.



---

archive/issue_comments_149718.json:
```json
{
    "body": "Attachment [givaro-3.2.13.p0.diff](tarball://root/attachments/some-uuid/ticket12761/givaro-3.2.13.p0.diff) by @kcrisman created at 2012-05-26 03:35:15\n\nThis works and passes tests on sage.math with GCC-4.7.0 and with some 4.6.x on Mac OS X, and all the changes make sense, so I think this is ready to go as well.",
    "created_at": "2012-05-26T03:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149718",
    "user": "@kcrisman"
}
```

Attachment [givaro-3.2.13.p0.diff](tarball://root/attachments/some-uuid/ticket12761/givaro-3.2.13.p0.diff) by @kcrisman created at 2012-05-26 03:35:15

This works and passes tests on sage.math with GCC-4.7.0 and with some 4.6.x on Mac OS X, and all the changes make sense, so I think this is ready to go as well.



---

archive/issue_comments_149719.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-26T03:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149719",
    "user": "@kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149720.json:
```json
{
    "body": "Why not just upgrade to upstream 3.6.0 ?",
    "created_at": "2012-05-26T09:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149720",
    "user": "Snark"
}
```

Why not just upgrade to upstream 3.6.0 ?



---

archive/issue_comments_149721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-02T13:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12589#issuecomment-149721",
    "user": "@jdemeyer"
}
```

Resolution: fixed
