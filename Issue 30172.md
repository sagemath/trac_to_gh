# Issue 30172: Optional ideal parameter for normalize_coordinates

Issue created by migration from https://trac.sagemath.org/ticket/30409

Original creator: @EnderWannabe

Original creation time: 2020-08-20 19:11:43

CC:  bhutz paulfili

Keywords: gsoc20

In niche use cases, it is helpful to normalize a dynamical system defined over a number field with respect to a p-adic absolute value. By adding an optional ideal parameter, we allow for normalization with respect to a p-adic absolute value. In this context, normalization is scaling so that one coefficient has absolute value 1 while the rest have absolute value less than 1.


---

Comment by @EnderWannabe created at 2020-08-20 19:12:24

Changing status from new to needs_review.


---

Comment by @EnderWannabe created at 2020-08-20 19:12:24

New commits:


---

Comment by bhutz created at 2020-08-21 20:30:53

merge conflict


---

Comment by bhutz created at 2020-08-21 20:30:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-24 14:41:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-24 14:42:14

Changing status from needs_work to needs_review.


---

Comment by @EnderWannabe created at 2020-08-24 23:23:49

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2020-08-25 16:07:18

This initial implementation looks ok, but I'd like to see the ability to pass in a valuation as well, instead of only an ideal.


---

Comment by git created at 2020-08-25 20:08:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-25 20:08:18

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2020-08-27 14:21:29

Only one complaint here. I think it would be better to use **kwds and allow ideal= or valuation= instead of overloading the ideal parameter.

Otherwise, the functionality works as expected.


I was able to produce some cases where the phrasing of the error messages was not quite aligned with the issue, but these are not cases where the function should be working.


```
P.<x,y>=ProjectiveSpace(QQbar,1)
f=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])
f.normalize_coordinates(ideal=QQbar(3))
ValueError: ideal was defined over QQ, but the base ring of this morphism is Algebraic Field
```

This is not an ideal defined over QQ, rather it is the ideal (1) in QQbar.


Similarly, this is an ideal contrary to what the error says

```
P.<x,y>=ProjectiveSpace(QQbar,1)
f=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])
f.normalize_coordinates(ideal=QQbar.ideal(3))
TypeError: ideal must be an ideal or a valuation, not Principal ideal (1) of Algebraic Field
```


I'm not suggesting you special case things like QQbar in your error messages. Rather perhaps make the language somewhat more general. In this second you could say, must be a prime ideal or valuation. The first error may not a bigger language change.


---

Comment by bhutz created at 2020-08-27 14:21:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-28 15:18:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-28 15:19:26

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2020-08-28 20:54:13

Those errors I think are less confusing.

two things

 - **kwds is what should be used

 - the kwds should be in a keywords: block of the INPUT section,


---

Comment by bhutz created at 2020-08-28 20:54:13

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-28 21:09:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-28 21:09:40

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2020-08-28 21:17:39

You need to change the kwargs in the code to match


```
ideal = kwargs.pop('ideal', None)
```


and the other one.


---

Comment by bhutz created at 2020-08-28 21:17:39

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-29 13:59:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-29 13:59:31

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2020-08-31 19:32:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-06 21:51:08

Resolution: fixed
