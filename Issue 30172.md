# Issue 30172: Optional ideal parameter for normalize_coordinates

archive/issues_030172.json:
```json
{
    "body": "CC:  bhutz paulfili\n\nKeywords: gsoc20\n\nIn niche use cases, it is helpful to normalize a dynamical system defined over a number field with respect to a p-adic absolute value. By adding an optional ideal parameter, we allow for normalization with respect to a p-adic absolute value. In this context, normalization is scaling so that one coefficient has absolute value 1 while the rest have absolute value less than 1.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30409\n\n",
    "created_at": "2020-08-20T19:11:43Z",
    "labels": [
        "dynamics",
        "minor",
        "enhancement"
    ],
    "title": "Optional ideal parameter for normalize_coordinates",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30172",
    "user": "@EnderWannabe"
}
```
CC:  bhutz paulfili

Keywords: gsoc20

In niche use cases, it is helpful to normalize a dynamical system defined over a number field with respect to a p-adic absolute value. By adding an optional ideal parameter, we allow for normalization with respect to a p-adic absolute value. In this context, normalization is scaling so that one coefficient has absolute value 1 while the rest have absolute value less than 1.

Issue created by migration from https://trac.sagemath.org/ticket/30409





---

archive/issue_comments_430003.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-20T19:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430003",
    "user": "@EnderWannabe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430004.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-08-20T19:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430004",
    "user": "@EnderWannabe"
}
```

New commits:



---

archive/issue_comments_430005.json:
```json
{
    "body": "merge conflict",
    "created_at": "2020-08-21T20:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430005",
    "user": "bhutz"
}
```

merge conflict



---

archive/issue_comments_430006.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-21T20:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430006",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430007.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-24T14:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430007",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430008.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-24T14:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430008",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430009.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-24T23:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430009",
    "user": "@EnderWannabe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430010.json:
```json
{
    "body": "This initial implementation looks ok, but I'd like to see the ability to pass in a valuation as well, instead of only an ideal.",
    "created_at": "2020-08-25T16:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430010",
    "user": "bhutz"
}
```

This initial implementation looks ok, but I'd like to see the ability to pass in a valuation as well, instead of only an ideal.



---

archive/issue_comments_430011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-25T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430011",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430012.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-25T20:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430012",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430013.json:
```json
{
    "body": "Only one complaint here. I think it would be better to use **kwds and allow ideal= or valuation= instead of overloading the ideal parameter.\n\nOtherwise, the functionality works as expected.\n\n\nI was able to produce some cases where the phrasing of the error messages was not quite aligned with the issue, but these are not cases where the function should be working.\n\n\n```\nP.<x,y>=ProjectiveSpace(QQbar,1)\nf=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])\nf.normalize_coordinates(ideal=QQbar(3))\nValueError: ideal was defined over QQ, but the base ring of this morphism is Algebraic Field\n```\n\nThis is not an ideal defined over QQ, rather it is the ideal (1) in QQbar.\n\n\nSimilarly, this is an ideal contrary to what the error says\n\n```\nP.<x,y>=ProjectiveSpace(QQbar,1)\nf=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])\nf.normalize_coordinates(ideal=QQbar.ideal(3))\nTypeError: ideal must be an ideal or a valuation, not Principal ideal (1) of Algebraic Field\n```\n\n\nI'm not suggesting you special case things like QQbar in your error messages. Rather perhaps make the language somewhat more general. In this second you could say, must be a prime ideal or valuation. The first error may not a bigger language change.",
    "created_at": "2020-08-27T14:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430013",
    "user": "bhutz"
}
```

Only one complaint here. I think it would be better to use **kwds and allow ideal= or valuation= instead of overloading the ideal parameter.

Otherwise, the functionality works as expected.


I was able to produce some cases where the phrasing of the error messages was not quite aligned with the issue, but these are not cases where the function should be working.


```
P.<x,y>=ProjectiveSpace(QQbar,1)
f=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])
f.normalize_coordinates(ideal=QQbar(3))
ValueError: ideal was defined over QQ, but the base ring of this morphism is Algebraic Field
```

This is not an ideal defined over QQ, rather it is the ideal (1) in QQbar.


Similarly, this is an ideal contrary to what the error says

```
P.<x,y>=ProjectiveSpace(QQbar,1)
f=DynamicalSystem([x^2 + 2*x*y + 3*y^2, 4*y^2 + 5*x*y+7*x^2])
f.normalize_coordinates(ideal=QQbar.ideal(3))
TypeError: ideal must be an ideal or a valuation, not Principal ideal (1) of Algebraic Field
```


I'm not suggesting you special case things like QQbar in your error messages. Rather perhaps make the language somewhat more general. In this second you could say, must be a prime ideal or valuation. The first error may not a bigger language change.



---

archive/issue_comments_430014.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-27T14:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430014",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-28T15:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430015",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430016.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-28T15:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430016",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430017.json:
```json
{
    "body": "Those errors I think are less confusing.\n\ntwo things\n\n- **kwds is what should be used\n\n- the kwds should be in a keywords: block of the INPUT section,",
    "created_at": "2020-08-28T20:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430017",
    "user": "bhutz"
}
```

Those errors I think are less confusing.

two things

- **kwds is what should be used

- the kwds should be in a keywords: block of the INPUT section,



---

archive/issue_comments_430018.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-28T20:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430018",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-28T21:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430020.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-28T21:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430020",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430021.json:
```json
{
    "body": "You need to change the kwargs in the code to match\n\n\n```\nideal = kwargs.pop('ideal', None)\n```\n\n\nand the other one.",
    "created_at": "2020-08-28T21:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430021",
    "user": "bhutz"
}
```

You need to change the kwargs in the code to match


```
ideal = kwargs.pop('ideal', None)
```


and the other one.



---

archive/issue_comments_430022.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-28T21:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430022",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-29T13:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430024.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-29T13:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430024",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430025.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-31T19:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430025",
    "user": "bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430026.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-06T21:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30172#issuecomment-430026",
    "user": "vbraun"
}
```

Resolution: fixed
