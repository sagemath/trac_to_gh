# Issue 11617: compile python with ssl-support if possible

Issue created by migration from Trac.

Original creator: FrankPolte

Original creation time: 2011-09-11 07:38:38

Assignee: tbd

I wanted to use couchdb, but it was a real pain to find a way:

http://wiki.sagemath.org/couchdb

We should find a way that it will compile with ssl-support. A lot of other python eggs need this too.

[The attached file is just the changed python*.spkg](http://wiki.sagemath.org/couchdb)


---

Comment by leif created at 2011-09-11 12:36:53

Replying to [ticket:11789 FrankPolte]:
> We should find a way that it will compile with ssl-support. A lot of other python eggs need this too.

I haven't had any problems on Ubuntu (10.04.3 LTS) importing `ssl` (or `_ssl`).

I.e., after installing the (Debian) package `libssl-dev` (which includes the necessary header files, in contrast to `libssl`), then reinstalling our current Python 2.6.4.p11 spkg (with `sage -f ...`, to *f*orce reinstallation), all worked fine.

(Haven't tried to install couchdb into Sage's Python though.)

I agree that the documentation on how to [`easy_`]install Python packages for use with Sage could certainly be better.



 
For SSL, which is (or [should be](http://www.eff.org/press/archives/2011/04/19-0)) ubiquitous, we could do a prerequisite check (although it _currently_ isn't required by any part of Sage) _before_ building Sage or its Python package, or at least test whether importing `ssl` works after installation, and issue a warning otherwise. (We already test that other crucial Python core packages _are_ functional after the build, i.e., can be imported without errors at least, and exit with a more or less appropriate error message in case some don't.)

Unfortunately, running Python's own test suite gives a few (irrelevant) errors on almost any system, also depending on the configuration.


---

Attachment

Replying to [comment:2 leif]:

> Replying to [ticket:11789 FrankPolte]:
> > We should find a way that it will compile with ssl-support. A lot of other python eggs need this too.
> I haven't had any problems on Ubuntu (10.04.3 LTS) importing `ssl` (or `_ssl`). I.e., after installing the (Debian) package `libssl-dev` (which includes the necessary header files, in contrast to `libssl`), then reinstalling our current Python 2.6.4.p11 spkg (with `sage -f ...`, to *f*orce reinstallation), all worked fine. (Haven't tried to install couchdb into Sage's Python though.)
> 
> For me that doesn't worked. The problem was. that couchdb uses a special module called: HTTPSConnection which is juat there if SSL was directly compiled into the python-kernel. Installing OpenSSL or other SSL-packages doesn't helped me at all.
> 
> I agree that the documentation on how to [`easy_`]install Python packages for use with Sage could certainly be better.
> Yes there should be  wiki- or docu-page! It was a real pain for me to get it running. 
> 
> Btw. couchdb and other database modules are quite useful to get the result out of the box into other systems like web server or get data from them. I think this is really nice. But there is no need for creating spkg files if easy_install is working fine, especially for wrappers like couchdb.


---

Comment by FrankPolte created at 2011-09-11 13:50:26

Sorry here my answer again better to read:

 For me that doesn't worked. The problem was. that couchdb uses a  special module called: HTTPSConnection which is juat there if SSL was  directly compiled into the python-kernel. Installing OpenSSL or other  SSL-packages doesn't helped me at all.

And: Yes there should be  wiki- or docu-page to easy_install! 
It was a real pain for me to get it running.   
Btw. couchdb and other database modules are quite useful to get the  result out of the box into other systems like web server or get data  from them. I think this is really nice. But there is no need for  creating spkg files if easy_install is working fine, especially for  wrappers like couchdb.


---

Comment by leif created at 2011-09-11 14:44:49

Changing status from new to needs_info.


---

Comment by leif created at 2011-09-11 14:44:49

Replying to [comment:4 FrankPolte]:
> For me that doesn't worked. The problem was. that couchdb uses a  special module called: HTTPSConnection which is juat there if SSL was  directly compiled into the python-kernel. Installing OpenSSL or other  SSL-packages doesn't helped me at all.

Hmmm, I still cannot reproduce what exactly failed for you.

After reinstalling our *unmodified* Python spkg, with the `libssl-dev` Debian package installed in advance, the following all works for me:

```sh
$ ./sage --sh -c "easy_install http://pypi.python.org/packages/2.6/C/CouchDB/CouchDB-0.8-py2.6.egg#md5=b47f8fe5f0c76d7c45bf8e4805d43de4"

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

Downloading http://pypi.python.org/packages/2.6/C/CouchDB/CouchDB-0.8-py2.6.egg#md5=b47f8fe5f0c76d7c45bf8e4805d43de4
Processing CouchDB-0.8-py2.6.egg
creating /tmp/Sage/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/CouchDB-0.8-py2.6.egg
Extracting CouchDB-0.8-py2.6.egg to /tmp/Sage/sage-4.7.2.alpha2/local/lib/python2.6/site-packages
Adding CouchDB 0.8 to easy-install.pth file
Installing couchdb-dump script to /tmp/Sage/sage-4.7.2.alpha2/local/bin
Installing couchpy script to /tmp/Sage/sage-4.7.2.alpha2/local/bin
Installing couchdb-load script to /tmp/Sage/sage-4.7.2.alpha2/local/bin
Installing couchdb-replicate script to /tmp/Sage/sage-4.7.2.alpha2/local/bin

Installed /tmp/Sage/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/CouchDB-0.8-py2.6.egg
Processing dependencies for CouchDB==0.8
Finished processing dependencies for CouchDB==0.8
Exited Sage subshell.
```


Then, from Sage:

```
sage: import ssl
sage: import _ssl
sage: import couchdb
sage: from httplib import HTTPSConnection
sage: 
```


So does something else fail in a later stage when using `couchdb`?

(If so, we could include any necessary changes into our standard Python spkg, such that nobody would have to manually make changes to it, unless the build would fail in case e.g. `libssl-dev`, or other prerequisites, weren't available. It should be possible to circumvent the latter though, probably by additional changes.)




> And: Yes there should be  wiki- or docu-page to easy_install! 
> It was a real pain for me to get it running.

Sorry for that.

Feel free to also contribute to e.g. the [Sage Installation Guide](http://sagemath.org/doc/installation/) or the [FAQ](http://sagemath.org/doc/faq/); any improvements are always welcome.


---

Comment by FrankPolte created at 2011-09-12 00:26:10

I see. I just imported couchdb without the ssl and _ssl packages. But now it's working for me anyway. I will give the link to this trac in the wiki as well. Your way is easier and my is more python-couchdb-native, everybody should decide for his/her-self.


---

Comment by jdemeyer created at 2012-09-03 13:30:26

Seems this can be closed then.


---

Comment by jdemeyer created at 2012-09-03 13:30:26

Resolution: worksforme


---

Comment by kini created at 2012-09-05 10:07:28

FrankPolte: leif was not saying that you must import ssl and _ssl before importing couchdb. He was just demonstrating that one can import ssl and _ssl, and then demonstrating that one can import couchdb. So his way is not more "python-couchdb-native". I think there was just some weirdness on your system which eventually happened to go away.
