# Issue 27062: docker docbuild is slow

Issue created by migration from https://trac.sagemath.org/ticket/27299

Original creator: saraedum

Original creation time: 2019-02-15 20:43:18

CC:  embray jdemeyer slelievre

In the lastest beta 8.7.beta4, the docker builds fail their self test. Namely we run make and then we time another run of make (after deleting some cheap build artifacts.) This second run takes 400 seconds since this beta.

Have there been any changes to sphinx that could cause this? For some reason we seem to be rebuilding most of the reference manual:

```
[dochtml] [combinat ] updating environment: 0 added, 199 changed, 0 removed
```


---

Comment by saraedum created at 2019-02-15 20:44:20

The full log is here: https://gitlab-artifacts.s3.amazonaws.com/f3/fa/f3fa641922367cad0a37d11c9acdcc7d8893cb31dee45476ec37fd87f16ca468/2019_02_15/162222618/164521009/job.log?response-content-type=text/plain%3B%20charset%3Dutf-8&response-content-disposition=inline&X-Amz-Expires=600&X-Amz-Date=20190215T203601Z&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAJTOFWQ3GL4O3Q3FA/20190215/us-east-1/s3/aws4_request&X-Amz-SignedHeaders=host&X-Amz-Signature=b0fb458e6737dac19eff37f1ef53b49f7548caaa2282dc56cf60d1f1ddb60e33


---

Comment by saraedum created at 2019-02-15 21:08:08

Ok. This is unrelated to the latest beta. This changed earlier most likely. Anyway, the docbuild is taking too long at the moment at rebuilding. At least in the docker setup. It might be that we are throwing something away that is needed for the caching by now. But I doubt it because it used to work but there were always a few files that failed to be taken from the cacheâ€¦


---

Comment by embray created at 2019-02-18 15:49:51

I noticed this as well.  I wasn't sure if it was a fluke or what, or if the docbuild just...got slower for some unexplained reason.  

Could you point out where the "cheap build artifacts" are being deleted?  Is there an easy way I can run this test locally so I could maybe find out where it changed (e.g. by running git bisect)?


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by saraedum created at 2019-09-15 19:17:40

This is essentially adressed in #28502 though this does not seem to be the full answer yet.


---

Comment by saraedum created at 2019-09-15 19:17:40

Changing status from new to needs_review.


---

Comment by saraedum created at 2019-09-15 19:17:46

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-10-07 07:46:19

Resolution: duplicate
