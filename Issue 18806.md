# Issue 18806: Move configuration part of build/make/install to configure

archive/issues_018806.json:
```json
{
    "body": "Most of what `build/make/install` does really belongs in `configure`, in particular creating `build/make/Makefile`. This ticket moves that part to `configure` and adjusts the top-level build system to make this work.\n\nThere are two advantages:\n1. Running `make` is a lot simpler and hence faster.\n2. It allows using `./configure` to configure the list of packages (note that this ticket does not implement that, it just makes it possible to implement that in future tickets)\n\nThere is an important change for developers: any change to the list or versions of packages will require a run of `./configure` to take effect. Note that `./configure` will be re-run automatically if `./configure` itself changes, which happens with every Sage version. So there is no need to manually rerun `./configure` if you're just switching between versions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19043\n\n",
    "created_at": "2015-08-16T21:20:54Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Move configuration part of build/make/install to configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18806",
    "user": "jdemeyer"
}
```
Most of what `build/make/install` does really belongs in `configure`, in particular creating `build/make/Makefile`. This ticket moves that part to `configure` and adjusts the top-level build system to make this work.

There are two advantages:
1. Running `make` is a lot simpler and hence faster.
2. It allows using `./configure` to configure the list of packages (note that this ticket does not implement that, it just makes it possible to implement that in future tickets)

There is an important change for developers: any change to the list or versions of packages will require a run of `./configure` to take effect. Note that `./configure` will be re-run automatically if `./configure` itself changes, which happens with every Sage version. So there is no need to manually rerun `./configure` if you're just switching between versions.

Issue created by migration from https://trac.sagemath.org/ticket/19043





---

archive/issue_comments_257201.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-08-16T21:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257201",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_257202.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-16T21:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257202",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_257203.json:
```json
{
    "body": "I would be willing to review this.",
    "created_at": "2015-09-21T13:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257203",
    "user": "tscrim"
}
```

I would be willing to review this.



---

archive/issue_comments_257204.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-21T15:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257204",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_257205.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-21T15:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257205",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_257206.json:
```json
{
    "body": "Rebased. I know the git history looks funny, but you really should just review the result, not the individual commits.",
    "created_at": "2015-09-21T15:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257206",
    "user": "jdemeyer"
}
```

Rebased. I know the git history looks funny, but you really should just review the result, not the individual commits.



---

archive/issue_comments_257207.json:
```json
{
    "body": "I don't care about having a \"perfect\" history (and normally review the final diff from `develop`).\n\nOverall it looks good from my testing. However, I'm not quite sure about this\n\n> There is an important change for developers: any change to the list or versions of packages will require a run of `./configure` to take effect.\n\nTo make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`? If so, then I think we should put something about this in the spkg development guide. Also, is `configure` updated on beta version changes or just on stable releases?\n\nAlso is there a reason why you moved the \"if root\" test lower in the file? I would think we'd want such build failures to happen as early on as possible.",
    "created_at": "2015-09-21T17:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257207",
    "user": "tscrim"
}
```

I don't care about having a "perfect" history (and normally review the final diff from `develop`).

Overall it looks good from my testing. However, I'm not quite sure about this

> There is an important change for developers: any change to the list or versions of packages will require a run of `./configure` to take effect.

To make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`? If so, then I think we should put something about this in the spkg development guide. Also, is `configure` updated on beta version changes or just on stable releases?

Also is there a reason why you moved the "if root" test lower in the file? I would think we'd want such build failures to happen as early on as possible.



---

archive/issue_comments_257208.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> To make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`?\nYes.\n\n> If so, then I think we should put something about this in the spkg development guide.\nOK, I see your point. I'd rather make that a separate ticket, there might be other changes to the spkg development guide I want to make.\n\n> Also, is `configure` updated on beta version changes or just on stable releases?\nAll releases, beta and stable. So in practice, you only really need to run `./configure` manually if you yourself are working on a package (as author or reviewer). If the package upgrade happens as part of a Sage version bump, no special action is needed.\n\n> Also is there a reason why you moved the \"if root\" test lower in the file?\nThere is no real particular reason, it felt more logical to put it where it currently is.\n\n> I would think we'd want such build failures to happen as early on as possible.\nWhy?",
    "created_at": "2015-09-21T17:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257208",
    "user": "jdemeyer"
}
```

Replying to [comment:10 tscrim]:
> To make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`?
Yes.

> If so, then I think we should put something about this in the spkg development guide.
OK, I see your point. I'd rather make that a separate ticket, there might be other changes to the spkg development guide I want to make.

> Also, is `configure` updated on beta version changes or just on stable releases?
All releases, beta and stable. So in practice, you only really need to run `./configure` manually if you yourself are working on a package (as author or reviewer). If the package upgrade happens as part of a Sage version bump, no special action is needed.

> Also is there a reason why you moved the "if root" test lower in the file?
There is no real particular reason, it felt more logical to put it where it currently is.

> I would think we'd want such build failures to happen as early on as possible.
Why?



---

archive/issue_comments_257209.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> Replying to [comment:10 tscrim]:\n> > To make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`?\n> Yes.\n> \n> > If so, then I think we should put something about this in the spkg development guide.\n> OK, I see your point. I'd rather make that a separate ticket, there might be other changes to the spkg development guide I want to make.\n\nFair enough, but let's make that spkg dev guide update ticket a blocker.\n\n> > Also, is `configure` updated on beta version changes or just on stable releases?\n> All releases, beta and stable. So in practice, you only really need to run `./configure` manually if you yourself are working on a package (as author or reviewer). If the package upgrade happens as part of a Sage version bump, no special action is needed.\n\nThanks for the explanation.\n\n> > Also is there a reason why you moved the \"if root\" test lower in the file?\n> There is no real particular reason, it felt more logical to put it where it currently is.\n> \n> > I would think we'd want such build failures to happen as early on as possible.\n> Why?\n\nI feel that some of those configuration steps could take some time, just to have it fail for an unrelated reason. However I don't really care about this; it was more out of curiosity.",
    "created_at": "2015-09-21T17:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257209",
    "user": "tscrim"
}
```

Replying to [comment:11 jdemeyer]:
> Replying to [comment:10 tscrim]:
> > To make sure I understand correctly, does this mean that anytime we want to do a version bump of packages (or add one), we have to manually run `$SAGE_ROOT/configure`?
> Yes.
> 
> > If so, then I think we should put something about this in the spkg development guide.
> OK, I see your point. I'd rather make that a separate ticket, there might be other changes to the spkg development guide I want to make.

Fair enough, but let's make that spkg dev guide update ticket a blocker.

> > Also, is `configure` updated on beta version changes or just on stable releases?
> All releases, beta and stable. So in practice, you only really need to run `./configure` manually if you yourself are working on a package (as author or reviewer). If the package upgrade happens as part of a Sage version bump, no special action is needed.

Thanks for the explanation.

> > Also is there a reason why you moved the "if root" test lower in the file?
> There is no real particular reason, it felt more logical to put it where it currently is.
> 
> > I would think we'd want such build failures to happen as early on as possible.
> Why?

I feel that some of those configuration steps could take some time, just to have it fail for an unrelated reason. However I don't really care about this; it was more out of curiosity.



---

archive/issue_comments_257210.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-21T17:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257210",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_257211.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> Fair enough, but let's make that spkg dev guide update ticket a blocker.\nI created #19267. I don't believe that pure documentation tickets should be blockers. But given that we have not yet reached the \"rc\" phase, I think there is still time.",
    "created_at": "2015-09-22T09:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257211",
    "user": "jdemeyer"
}
```

Replying to [comment:12 tscrim]:
> Fair enough, but let's make that spkg dev guide update ticket a blocker.
I created #19267. I don't believe that pure documentation tickets should be blockers. But given that we have not yet reached the "rc" phase, I think there is still time.



---

archive/issue_comments_257212.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-22T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257212",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_257213.json:
```json
{
    "body": "OSX doesn't build gcc any more with this ticket, but just fails with `configure: error: Exiting, since a Fortran compiler was not found.`\n\nhttp://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20full/builds/95/steps/compile_1/logs/stdio",
    "created_at": "2015-09-22T15:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257213",
    "user": "vbraun"
}
```

OSX doesn't build gcc any more with this ticket, but just fails with `configure: error: Exiting, since a Fortran compiler was not found.`

http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20full/builds/95/steps/compile_1/logs/stdio



---

archive/issue_comments_257214.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2015-09-22T15:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257214",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_257215.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2015-09-22T15:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257215",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_257216.json:
```json
{
    "body": "Most likely, you didn't apply this branch properly: it needs an updated `upstream/configure-NNN.tar.gz` if the system you test it on doesn't have autotools.",
    "created_at": "2015-09-22T15:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257216",
    "user": "jdemeyer"
}
```

Most likely, you didn't apply this branch properly: it needs an updated `upstream/configure-NNN.tar.gz` if the system you test it on doesn't have autotools.



---

archive/issue_comments_257217.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-22T15:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257217",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_257218.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-22T15:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257218",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_257219.json:
```json
{
    "body": "I don't understand why `./bootstrap -d` wasn't run though in your logs. Is there anything funny in your build system affecting `configure`?",
    "created_at": "2015-09-22T15:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257219",
    "user": "jdemeyer"
}
```

I don't understand why `./bootstrap -d` wasn't run though in your logs. Is there anything funny in your build system affecting `configure`?



---

archive/issue_comments_257220.json:
```json
{
    "body": "Or anything in your buildbot affecting timestamps as a whole? What happens if you replace `distclean` by `maintainer-clean`?",
    "created_at": "2015-09-22T15:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257220",
    "user": "jdemeyer"
}
```

Or anything in your buildbot affecting timestamps as a whole? What happens if you replace `distclean` by `maintainer-clean`?



---

archive/issue_comments_257221.json:
```json
{
    "body": "Its the same machine that you also have an account for. It compiles fine without this ticket. \n\nIf this ticket needs an updated confball then it should be committed, too. The change in confball needs to be in some commit, otherwise the buildbot can't test it.",
    "created_at": "2015-09-22T16:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257221",
    "user": "vbraun"
}
```

Its the same machine that you also have an account for. It compiles fine without this ticket. 

If this ticket needs an updated confball then it should be committed, too. The change in confball needs to be in some commit, otherwise the buildbot can't test it.



---

archive/issue_comments_257222.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-09-22T16:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257222",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_257223.json:
```json
{
    "body": "> If this ticket needs an updated confball then it should be committed, too.\nIt's the first time I hear this. I thought that was the job of the release manager when creating the sdist?",
    "created_at": "2015-09-22T16:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257223",
    "user": "jdemeyer"
}
```

> If this ticket needs an updated confball then it should be committed, too.
It's the first time I hear this. I thought that was the job of the release manager when creating the sdist?



---

archive/issue_comments_257224.json:
```json
{
    "body": "I need more information about the buildbot setup, otherwise I don't know what to do. From your logs, it looks like `./bootstrap` isn't even run, so just updating the confball won't help in that case.",
    "created_at": "2015-09-22T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257224",
    "user": "jdemeyer"
}
```

I need more information about the buildbot setup, otherwise I don't know what to do. From your logs, it looks like `./bootstrap` isn't even run, so just updating the confball won't help in that case.



---

archive/issue_comments_257225.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-09-22T17:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257225",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_257226.json:
```json
{
    "body": "Is this what you need?\n----\nNew commits:",
    "created_at": "2015-09-22T17:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257226",
    "user": "jdemeyer"
}
```

Is this what you need?
----
New commits:



---

archive/issue_comments_257227.json:
```json
{
    "body": "The confball is updated during release but ideally we can test a ticket before the release...\n\nThe buildbot just pulls the source and runs `make -j8 -k start` on the OSX machine.",
    "created_at": "2015-09-22T18:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257227",
    "user": "vbraun"
}
```

The confball is updated during release but ideally we can test a ticket before the release...

The buildbot just pulls the source and runs `make -j8 -k start` on the OSX machine.



---

archive/issue_comments_257228.json:
```json
{
    "body": "Thats not the file:\n\n```\n$ md5 configure-114.tar.gz \nMD5 (configure-114.tar.gz) = 0413a0763d9b33111d11f03f720429a2\n```\n",
    "created_at": "2015-09-22T19:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257228",
    "user": "vbraun"
}
```

Thats not the file:

```
$ md5 configure-114.tar.gz 
MD5 (configure-114.tar.gz) = 0413a0763d9b33111d11f03f720429a2
```




---

archive/issue_comments_257229.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-09-22T19:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257229",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_257230.json:
```json
{
    "body": "I will deal with it on #19266.\n----\nNew commits:",
    "created_at": "2015-09-23T07:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257230",
    "user": "jdemeyer"
}
```

I will deal with it on #19266.
----
New commits:



---

archive/issue_comments_257231.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-09-23T13:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257231",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_257232.json:
```json
{
    "body": "Since the confball will be handled on #19266, we're back to positive review (I tested it with the one Jeroen provided after running a checksum fix).",
    "created_at": "2015-09-23T13:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257232",
    "user": "tscrim"
}
```

Since the confball will be handled on #19266, we're back to positive review (I tested it with the one Jeroen provided after running a checksum fix).



---

archive/issue_comments_257233.json:
```json
{
    "body": "Volker, can you please try to merge this in the next beta? Otherwise there will be a conflict with the `configure` version.",
    "created_at": "2015-09-23T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257233",
    "user": "jdemeyer"
}
```

Volker, can you please try to merge this in the next beta? Otherwise there will be a conflict with the `configure` version.



---

archive/issue_comments_257234.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-23T20:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18806#issuecomment-257234",
    "user": "vbraun"
}
```

Resolution: fixed
