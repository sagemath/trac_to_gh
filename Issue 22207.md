# Issue 22207: ipy install: Fix very incomplete logic in symlink()

Issue created by migration from Trac.

Original creator: infinity0

Original creation time: 2017-02-25 15:33:32

CC:  mjo




---

Comment by infinity0 created at 2017-02-25 15:35:17

Changing priority from major to minor.


---

Comment by infinity0 created at 2017-02-25 15:35:17

Changing type from PLEASE CHANGE to defect.


---

Comment by infinity0 created at 2017-02-25 15:35:17

Changing component from PLEASE CHANGE to build.


---

Comment by infinity0 created at 2017-02-25 15:35:17

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-02-25 17:21:50

Hi,

The branch in this one was unset!?


---

Comment by infinity0 created at 2017-02-25 17:28:10

New commits:


---

Comment by infinity0 created at 2017-03-11 17:22:38

Ping?


---

Comment by jdemeyer created at 2017-06-21 14:58:23

If you want to check whether two directories are equal, the simplest way is [os.path.samefile](https://docs.python.org/2/library/os.path.html#os.path.samefile) which is exactly meant for that.


---

Comment by jdemeyer created at 2017-06-21 14:58:23

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2018-04-01 20:38:13

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2018-04-01 20:38:13

I tried to use `samefile`. I couldn't run doctests locally cause my Sage is rebuilding. Let's see what the patchbot thinks about this.
----
New commits:


---

Comment by git created at 2018-04-21 20:21:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-21 20:22:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-25 17:53:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-29 17:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-05-13 09:35:09

If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.

I don't like the default

```
    else:
        # Something that we did not expect happened.
        # Let's hope for the best, and let symlink fail with an error
        # that is easier to debug.
        pass
```

Shouldn't a `raise RuntimeError` be more appropriate?


---

Comment by vdelecroix created at 2018-05-13 09:35:09

Changing status from needs_review to needs_info.


---

Comment by saraedum created at 2018-05-14 12:48:08

Replying to [comment:13 vdelecroix]:
> If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.
I guess it's there for a reason. I do not want to break the installation on some obscure platform.

> I don't like the default
> {{{
>     else:
>         # Something that we did not expect happened.
>         # Let's hope for the best, and let symlink fail with an error
>         # that is easier to debug.
>         pass
> }}}
> Shouldn't a `raise RuntimeError` be more appropriate?
Why? If symlink works, then we don't care. If it fails, then it is going to produce a good error message on its own.


---

Comment by saraedum created at 2018-05-14 12:48:16

Changing status from needs_info to needs_review.


---

Comment by git created at 2018-06-21 10:01:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2018-06-21 10:03:22

vdelecroix, could I ask you to have another look here/comment on my replies to your remarks?


---

Comment by git created at 2018-07-04 16:05:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2018-07-07 14:17:01

There is one failing doctest that is totally unrelated, so this is ready for review.


---

Comment by saraedum created at 2018-07-28 12:30:37

The Cygwin patchbot failed, but that's because it cannot build mpir for some reason. Nothing that happened in this ticket I think.


---

Comment by jdemeyer created at 2019-02-01 16:56:48

Could you remind me what this ticket is trying to fix?


---

Comment by jdemeyer created at 2019-02-01 16:58:43

Also: instead of parsing a bunch of `errno` values, I prefer to check behavior (i.e. does file X exist?).


---

Comment by mjo created at 2021-12-01 01:15:10

Is this still an issue? The patch still applies and mostly looks good to me, although I don't think we should `pass` on an unexpected `OSError`. I'd rather see the real problem than whatever additionally goes wrong when we try to `os.symlink()` it. Eventually, we will have collected the full range of possible `OSError` in the list with explanations for why we re-raise or ignore them.
