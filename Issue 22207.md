# Issue 22207: ipy install: Fix very incomplete logic in symlink()

archive/issues_022207.json:
```json
{
    "body": "CC:  @orlitzky\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22444\n\n",
    "created_at": "2017-02-25T15:33:32Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "ipy install: Fix very incomplete logic in symlink()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22207",
    "user": "https://github.com/infinity0"
}
```
CC:  @orlitzky



Issue created by migration from https://trac.sagemath.org/ticket/22444





---

archive/issue_comments_308136.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2017-02-25T15:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308136",
    "user": "https://github.com/infinity0"
}
```

Changing priority from major to minor.



---

archive/issue_comments_308137.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-02-25T15:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308137",
    "user": "https://github.com/infinity0"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_308138.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2017-02-25T15:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308138",
    "user": "https://github.com/infinity0"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_308139.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-25T15:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308139",
    "user": "https://github.com/infinity0"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308140.json:
```json
{
    "body": "Hi,\n\nThe branch in this one was unset!?",
    "created_at": "2017-02-25T17:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308140",
    "user": "https://github.com/videlec"
}
```

Hi,

The branch in this one was unset!?



---

archive/issue_comments_308141.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-25T17:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308141",
    "user": "https://github.com/infinity0"
}
```

New commits:



---

archive/issue_comments_308142.json:
```json
{
    "body": "Ping?",
    "created_at": "2017-03-11T17:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308142",
    "user": "https://github.com/infinity0"
}
```

Ping?



---

archive/issue_comments_308143.json:
```json
{
    "body": "If you want to check whether two directories are equal, the simplest way is [os.path.samefile](https://docs.python.org/2/library/os.path.html#os.path.samefile) which is exactly meant for that.",
    "created_at": "2017-06-21T14:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308143",
    "user": "https://github.com/jdemeyer"
}
```

If you want to check whether two directories are equal, the simplest way is [os.path.samefile](https://docs.python.org/2/library/os.path.html#os.path.samefile) which is exactly meant for that.



---

archive/issue_comments_308144.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-21T14:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308144",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_308145.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-01T20:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308145",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_308146.json:
```json
{
    "body": "I tried to use `samefile`. I couldn't run doctests locally cause my Sage is rebuilding. Let's see what the patchbot thinks about this.\n----\nNew commits:",
    "created_at": "2018-04-01T20:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308146",
    "user": "https://github.com/saraedum"
}
```

I tried to use `samefile`. I couldn't run doctests locally cause my Sage is rebuilding. Let's see what the patchbot thinks about this.
----
New commits:



---

archive/issue_comments_308147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T20:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T20:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308149.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-25T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-29T17:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308151.json:
```json
{
    "body": "If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.\n\nI don't like the default\n\n```\n    else:\n        # Something that we did not expect happened.\n        # Let's hope for the best, and let symlink fail with an error\n        # that is easier to debug.\n        pass\n```\n\nShouldn't a `raise RuntimeError` be more appropriate?",
    "created_at": "2018-05-13T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308151",
    "user": "https://github.com/videlec"
}
```

If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.

I don't like the default

```
    else:
        # Something that we did not expect happened.
        # Let's hope for the best, and let symlink fail with an error
        # that is easier to debug.
        pass
```

Shouldn't a `raise RuntimeError` be more appropriate?



---

archive/issue_comments_308152.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-05-13T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308152",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_events_058708.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-13T09:35:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22207#event-58708"
}
```



---

archive/issue_comments_308153.json:
```json
{
    "body": "Replying to [comment:13 vdelecroix]:\n> If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.\nI guess it's there for a reason. I do not want to break the installation on some obscure platform.\n\n> I don't like the default\n> {{{\n>     else:\n>         # Something that we did not expect happened.\n>         # Let's hope for the best, and let symlink fail with an error\n>         # that is easier to debug.\n>         pass\n> }}}\n> Shouldn't a `raise RuntimeError` be more appropriate?\nWhy? If symlink works, then we don't care. If it fails, then it is going to produce a good error message on its own.",
    "created_at": "2018-05-14T12:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308153",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:13 vdelecroix]:
> If `errno.EEXIST` can not happen, then it would better be deleted and handled by the `else`.
I guess it's there for a reason. I do not want to break the installation on some obscure platform.

> I don't like the default
> {{{
>     else:
>         # Something that we did not expect happened.
>         # Let's hope for the best, and let symlink fail with an error
>         # that is easier to debug.
>         pass
> }}}
> Shouldn't a `raise RuntimeError` be more appropriate?
Why? If symlink works, then we don't care. If it fails, then it is going to produce a good error message on its own.



---

archive/issue_comments_308154.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-05-14T12:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308154",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_308155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-21T10:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308156.json:
```json
{
    "body": "vdelecroix, could I ask you to have another look here/comment on my replies to your remarks?",
    "created_at": "2018-06-21T10:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308156",
    "user": "https://github.com/saraedum"
}
```

vdelecroix, could I ask you to have another look here/comment on my replies to your remarks?



---

archive/issue_comments_308157.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-04T16:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308157",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308158.json:
```json
{
    "body": "There is one failing doctest that is totally unrelated, so this is ready for review.",
    "created_at": "2018-07-07T14:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308158",
    "user": "https://github.com/saraedum"
}
```

There is one failing doctest that is totally unrelated, so this is ready for review.



---

archive/issue_comments_308159.json:
```json
{
    "body": "The Cygwin patchbot failed, but that's because it cannot build mpir for some reason. Nothing that happened in this ticket I think.",
    "created_at": "2018-07-28T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308159",
    "user": "https://github.com/saraedum"
}
```

The Cygwin patchbot failed, but that's because it cannot build mpir for some reason. Nothing that happened in this ticket I think.



---

archive/issue_comments_308160.json:
```json
{
    "body": "Could you remind me what this ticket is trying to fix?",
    "created_at": "2019-02-01T16:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308160",
    "user": "https://github.com/jdemeyer"
}
```

Could you remind me what this ticket is trying to fix?



---

archive/issue_comments_308161.json:
```json
{
    "body": "Also: instead of parsing a bunch of `errno` values, I prefer to check behavior (i.e. does file X exist?).",
    "created_at": "2019-02-01T16:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308161",
    "user": "https://github.com/jdemeyer"
}
```

Also: instead of parsing a bunch of `errno` values, I prefer to check behavior (i.e. does file X exist?).



---

archive/issue_comments_308162.json:
```json
{
    "body": "Is this still an issue? The patch still applies and mostly looks good to me, although I don't think we should `pass` on an unexpected `OSError`. I'd rather see the real problem than whatever additionally goes wrong when we try to `os.symlink()` it. Eventually, we will have collected the full range of possible `OSError` in the list with explanations for why we re-raise or ignore them.",
    "created_at": "2021-12-01T01:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22207#issuecomment-308162",
    "user": "https://github.com/orlitzky"
}
```

Is this still an issue? The patch still applies and mostly looks good to me, although I don't think we should `pass` on an unexpected `OSError`. I'd rather see the real problem than whatever additionally goes wrong when we try to `os.symlink()` it. Eventually, we will have collected the full range of possible `OSError` in the list with explanations for why we re-raise or ignore them.
