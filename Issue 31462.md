# Issue 31462: setuptools/pip/pkgconfig upgrade for Sage 9.4

Issue created by migration from https://trac.sagemath.org/ticket/31699

Original creator: mkoeppe

Original creation time: 2021-04-19 20:02:56

CC:  fbissey jhpalmieri

https://repology.org/projects/p/?inrepo=sagemath


---

Comment by git created at 2021-05-11 23:04:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-05-11 23:21:23

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-05-11 23:28:36

Changing status from needs_review to needs_work.


---

Comment by fbissey created at 2021-05-11 23:28:51

This looks like just a package update ticket right. 

I guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.


---

Comment by mkoeppe created at 2021-05-11 23:30:58

`importlib_metadata` has a "build-system requires": `setuptools_scm[toml]`


---

Comment by mkoeppe created at 2021-05-11 23:32:36

Replying to [comment:6 fbissey]:
> I guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.

Actually it's quite relevant for us in the context of the modularized trees. We currently cannot use pip for building wheels because it does not handle our symlinks correctly. This new feature has the potential for fixing this -- but I have not checked it.


---

Comment by mkoeppe created at 2021-05-11 23:40:38

Replying to [comment:7 mkoeppe]:
> `importlib_metadata` has a "build-system requires": `setuptools_scm[toml]`
and also an "install-requires": `typing-extensions`


---

Comment by fbissey created at 2021-05-11 23:43:41

OK, that's a new package. I am not sure what the implication for `setuptools_scm` is. Does it need an extra plugin? Does it mean it needs to be installed a certain way? In which case why isn't it just a different package altogether?


---

Comment by fbissey created at 2021-05-11 23:48:42

OK, I get it. We need to add a new package for `toml` so it can use it. Could as well put it directly in `build-system requires`. Never mind.


---

Comment by git created at 2021-05-11 23:50:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-12 00:02:34

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2021-05-12 00:08:02

LGTM.


---

Comment by fbissey created at 2021-05-12 00:08:02

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-05-12 00:23:14

Thanks!


---

Comment by jhpalmieri created at 2021-05-28 05:24:48

Where is the tarball for the new version of pkgconfig?


---

Comment by git created at 2021-05-28 05:29:19

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2021-05-28 05:29:19

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-05-28 05:30:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-28 05:31:01

Thanks for catching this!


---

Comment by dimpase created at 2021-05-29 00:09:56

lgtm


---

Comment by dimpase created at 2021-05-29 00:09:56

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-05-29 00:15:02

Thanks!


---

Comment by vbraun created at 2021-06-19 20:58:22

Resolution: fixed


---

Comment by chapoton created at 2021-06-21 14:19:15

It seems that the upgrade of pip broke something. Pip does not build with system python 3.8.2 on ubuntu 20.04, complaining about tornado missing gen. Undoing the upgrade fixes that.


---

Comment by dimpase created at 2021-06-21 15:03:54

full log please


---

Comment by mkoeppe created at 2021-06-21 15:04:48

Yes, there seems to be a weird interaction with our `tornado` installation in incremental builds. Removing the `tornado` installation in `site-packages` breaks the vicious cycle.


---

Comment by mkoeppe created at 2021-06-21 15:15:54

Let's see if a further upgrade of pip fixes the issues.

This item looks promising:
https://pip.pypa.io/en/stable/news/#v21-1
"Prevent packages already-installed alongside with pip to be injected into an isolated build environment during build-time dependency population."


---

Comment by mkoeppe created at 2021-06-21 15:20:13

I've opened #32022 for the pip upgrade, haven't tried yet
