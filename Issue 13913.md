# Issue 13913: Jordan normal form not computed for nilpotent matrix over rational function field / polynomials cannot be factored over rational function field

archive/issues_013913.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nCC:  itolkov sage-combinat\n\nKeywords: polynomials, factorization, jordan normal form\n\nThe manual for the jordan_form method on a matrix explicitly claims that the Jordan form is computed over arbitrary fields as long as the characteristic polynomial splits over there. This should particularly imply that the Jordan normal form of a nilpotent matrix is always computed. Unfortunately, this is not so:\n\n\n```\nsage: Qx = PolynomialRing(QQ, 'x11, x12, x13, x21, x22, x23, x31, x32, x33')\nsage: x11, x12, x13, x21, x22, x23, x31, x32, x33 = Qx.gens()\nsage: M = matrix(Qx, [[0, 0, x31], [0, 0, x21], [0, 0, 0]])\nsage: M**3\n[0 0 0]\n[0 0 0]\n[0 0 0]\nsage: N = M.base_extend(Qx.fraction_field())\nsage: N\n[  0   0 x31]\n[  0   0 x21]\n[  0   0   0]\nsage: N.base_ring() \nFraction Field of Multivariate Polynomial Ring in x11, x12, x13, x21, x22, x23, x31, x32, x33 over Rational Field\nsage: N.jordan_form()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n\n/home/darij/sage-5.6/<ipython console> in <module>()\n\n/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.jordan_form (sage/matrix/matrix2.c:43627)()\n\n/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:35063)()\n\nNotImplementedError: root finding for this polynomial not implemented\n```\n\n\nThis seems to boil down to polynomial factorization over function fields not being implemented:\n\n\n```\nsage: N.characteristic_polynomial().factor()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n\n/home/darij/sage-5.6/<ipython console> in <module>()\n\n/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.factor (sage/rings/polynomial/polynomial_element.c:24161)()\n\nNotImplementedError: \n```\n\n\nUnfortunately, I have no idea how to debug, let alone fix, things in C code, so I have nothing positive to contribute on this issue. Maybe a workaround is adding a new key \"nilpotent\" to the jordan_form method which, when set to True, skips the factorization of the characteristic polynomial and lets sage know that the matrix is nilpotent? In my personal experience, nilpotent matrices are the ones with the most interesting Jordan forms, and skipping the useless factorization would probably save quite some CPU cycles for them.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14117\n\n",
    "created_at": "2013-02-14T14:43:20Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Jordan normal form not computed for nilpotent matrix over rational function field / polynomials cannot be factored over rational function field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13913",
    "user": "darij"
}
```
Assignee: AlexGhitza

CC:  itolkov sage-combinat

Keywords: polynomials, factorization, jordan normal form

The manual for the jordan_form method on a matrix explicitly claims that the Jordan form is computed over arbitrary fields as long as the characteristic polynomial splits over there. This should particularly imply that the Jordan normal form of a nilpotent matrix is always computed. Unfortunately, this is not so:


```
sage: Qx = PolynomialRing(QQ, 'x11, x12, x13, x21, x22, x23, x31, x32, x33')
sage: x11, x12, x13, x21, x22, x23, x31, x32, x33 = Qx.gens()
sage: M = matrix(Qx, [[0, 0, x31], [0, 0, x21], [0, 0, 0]])
sage: M**3
[0 0 0]
[0 0 0]
[0 0 0]
sage: N = M.base_extend(Qx.fraction_field())
sage: N
[  0   0 x31]
[  0   0 x21]
[  0   0   0]
sage: N.base_ring() 
Fraction Field of Multivariate Polynomial Ring in x11, x12, x13, x21, x22, x23, x31, x32, x33 over Rational Field
sage: N.jordan_form()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/home/darij/sage-5.6/<ipython console> in <module>()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.jordan_form (sage/matrix/matrix2.c:43627)()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:35063)()

NotImplementedError: root finding for this polynomial not implemented
```


This seems to boil down to polynomial factorization over function fields not being implemented:


```
sage: N.characteristic_polynomial().factor()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/home/darij/sage-5.6/<ipython console> in <module>()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.factor (sage/rings/polynomial/polynomial_element.c:24161)()

NotImplementedError: 
```


Unfortunately, I have no idea how to debug, let alone fix, things in C code, so I have nothing positive to contribute on this issue. Maybe a workaround is adding a new key "nilpotent" to the jordan_form method which, when set to True, skips the factorization of the characteristic polynomial and lets sage know that the matrix is nilpotent? In my personal experience, nilpotent matrices are the ones with the most interesting Jordan forms, and skipping the useless factorization would probably save quite some CPU cycles for them.

Issue created by migration from https://trac.sagemath.org/ticket/14117





---

archive/issue_comments_173391.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-15T03:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173391",
    "user": "darij"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_173392.json:
```json
{
    "body": "Attachment [trac_14117-jordan_normal_form-v1.py](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-v1.py) by darij created at 2013-05-15 03:54:25\n\nslightly improved",
    "created_at": "2013-05-15T03:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173392",
    "user": "darij"
}
```

Attachment [trac_14117-jordan_normal_form-v1.py](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-v1.py) by darij created at 2013-05-15 03:54:25

slightly improved



---

archive/issue_comments_173393.json:
```json
{
    "body": "Thanks for the CC. I'm somewhat new here, anything I should do?",
    "created_at": "2013-05-15T04:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173393",
    "user": "itolkov"
}
```

Thanks for the CC. I'm somewhat new here, anything I should do?



---

archive/issue_comments_173394.json:
```json
{
    "body": "Hi -- I cc'ed you since I saw you working on the Jordan normal form today, so I'm wondering if you can provide some comments, maybe even a review...",
    "created_at": "2013-05-15T04:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173394",
    "user": "darij"
}
```

Hi -- I cc'ed you since I saw you working on the Jordan normal form today, so I'm wondering if you can provide some comments, maybe even a review...



---

archive/issue_comments_173395.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-15T11:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173395",
    "user": "lftabera"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_173396.json:
```json
{
    "body": "With your example\n\n\n```\nsage: M.jordan_form(eigenvalues=[(0,3)])\n[0 1|0]\n[0 0|0]\n[---+-]\n[0 0|0]\nsage: M.jordan_form(eigenvalues=[(1,3)])\n[]\n```\n\n\nThe code should not return the second but raise a type of error. Also, add to the doctest a test with your eigenvalues option with transformation=True to make sure it works as expected.\n\nAs a matter of style, avoid blank lines containing only blanckspaces (up to the indent level) in your code. I think this is not enforced though.",
    "created_at": "2013-05-15T11:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173396",
    "user": "lftabera"
}
```

With your example


```
sage: M.jordan_form(eigenvalues=[(0,3)])
[0 1|0]
[0 0|0]
[---+-]
[0 0|0]
sage: M.jordan_form(eigenvalues=[(1,3)])
[]
```


The code should not return the second but raise a type of error. Also, add to the doctest a test with your eigenvalues option with transformation=True to make sure it works as expected.

As a matter of style, avoid blank lines containing only blanckspaces (up to the indent level) in your code. I think this is not enforced though.



---

archive/issue_comments_173397.json:
```json
{
    "body": "Good point about the error raising! I'll do it later today, when I have time. I am going to add a check variable that defaults to True so that the checking is only done when it is True, though; otherwise the speed advantage of this might be significantly diminished. (Checking is best done by just comparing the characteristic polynomial to the product of (X-eigenvalue)^(multiplicity) , or is there a better way?)\n\nI didn't know that blank lines should not be indented! This makes my life easier, since I actually thought they *should* be indented...",
    "created_at": "2013-05-15T17:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173397",
    "user": "darij"
}
```

Good point about the error raising! I'll do it later today, when I have time. I am going to add a check variable that defaults to True so that the checking is only done when it is True, though; otherwise the speed advantage of this might be significantly diminished. (Checking is best done by just comparing the characteristic polynomial to the product of (X-eigenvalue)^(multiplicity) , or is there a better way?)

I didn't know that blank lines should not be indented! This makes my life easier, since I actually thought they *should* be indented...



---

archive/issue_comments_173398.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-16T01:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173398",
    "user": "darij"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_173399.json:
```json
{
    "body": "version 2",
    "created_at": "2013-05-16T01:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173399",
    "user": "darij"
}
```

version 2



---

archive/issue_comments_173400.json:
```json
{
    "body": "Attachment [trac_14117-jordan_normal_form-v2.py](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-v2.py) by darij created at 2013-06-22 23:04:44\n\nOooops, I've just noticed that I gave the patch the extension .py rather than .patch. Anyway, here comes a new version, with a few typos fixed.",
    "created_at": "2013-06-22T23:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173400",
    "user": "darij"
}
```

Attachment [trac_14117-jordan_normal_form-v2.py](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-v2.py) by darij created at 2013-06-22 23:04:44

Oooops, I've just noticed that I gave the patch the extension .py rather than .patch. Anyway, here comes a new version, with a few typos fixed.



---

archive/issue_comments_173401.json:
```json
{
    "body": "Attachment [trac_14117-jordan_normal_form-dg-v3.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v3.patch) by darij created at 2013-06-22 23:04:59\n\nversion 3",
    "created_at": "2013-06-22T23:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173401",
    "user": "darij"
}
```

Attachment [trac_14117-jordan_normal_form-dg-v3.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v3.patch) by darij created at 2013-06-22 23:04:59

version 3



---

archive/issue_comments_173402.json:
```json
{
    "body": "patchbot:\n\napply trac_14117-jordan_normal_form-dg-v3.patch",
    "created_at": "2013-07-16T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173402",
    "user": "darij"
}
```

patchbot:

apply trac_14117-jordan_normal_form-dg-v3.patch



---

archive/issue_comments_173403.json:
```json
{
    "body": "Any idea why one of the patchbot machines reports PluginFailed?",
    "created_at": "2013-07-23T15:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173403",
    "user": "darij"
}
```

Any idea why one of the patchbot machines reports PluginFailed?



---

archive/issue_comments_173404.json:
```json
{
    "body": "One very minor point, instead of `Polyring(1)`, it's better to use `Polyring.one()` to take advantage of caching. Once you've made this change, you can set this to positive review on my behalf.\n\nBest,\n\nTravis",
    "created_at": "2013-10-02T15:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173404",
    "user": "tscrim"
}
```

One very minor point, instead of `Polyring(1)`, it's better to use `Polyring.one()` to take advantage of caching. Once you've made this change, you can set this to positive review on my behalf.

Best,

Travis



---

archive/issue_comments_173405.json:
```json
{
    "body": "reviewed version",
    "created_at": "2013-10-02T17:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173405",
    "user": "darij"
}
```

reviewed version



---

archive/issue_comments_173406.json:
```json
{
    "body": "Attachment [trac_14117-jordan_normal_form-dg-v4.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v4.patch) by darij created at 2013-10-02 17:10:49\n\nreviewed version",
    "created_at": "2013-10-02T17:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173406",
    "user": "darij"
}
```

Attachment [trac_14117-jordan_normal_form-dg-v4.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v4.patch) by darij created at 2013-10-02 17:10:49

reviewed version



---

archive/issue_comments_173407.json:
```json
{
    "body": "Attachment [trac_14117-jordan_normal_form-dg-v4.2.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v4.2.patch) by darij created at 2013-10-02 17:11:13\n\nThank you!\n\nFor the patchbot:\n\napply trac_14117-jordan_normal_form-dg-v4.patch",
    "created_at": "2013-10-02T17:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173407",
    "user": "darij"
}
```

Attachment [trac_14117-jordan_normal_form-dg-v4.2.patch](tarball://root/attachments/some-uuid/ticket14117/trac_14117-jordan_normal_form-dg-v4.2.patch) by darij created at 2013-10-02 17:11:13

Thank you!

For the patchbot:

apply trac_14117-jordan_normal_form-dg-v4.patch



---

archive/issue_comments_173408.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-02T17:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173408",
    "user": "darij"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_173409.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-07T06:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13913#issuecomment-173409",
    "user": "jdemeyer"
}
```

Resolution: fixed
