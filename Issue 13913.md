# Issue 13913: Jordan normal form not computed for nilpotent matrix over rational function field / polynomials cannot be factored over rational function field

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2013-02-14 14:43:20

Assignee: AlexGhitza

CC:  itolkov sage-combinat

Keywords: polynomials, factorization, jordan normal form

The manual for the jordan_form method on a matrix explicitly claims that the Jordan form is computed over arbitrary fields as long as the characteristic polynomial splits over there. This should particularly imply that the Jordan normal form of a nilpotent matrix is always computed. Unfortunately, this is not so:


```
sage: Qx = PolynomialRing(QQ, 'x11, x12, x13, x21, x22, x23, x31, x32, x33')
sage: x11, x12, x13, x21, x22, x23, x31, x32, x33 = Qx.gens()
sage: M = matrix(Qx, [[0, 0, x31], [0, 0, x21], [0, 0, 0]])
sage: M**3
[0 0 0]
[0 0 0]
[0 0 0]
sage: N = M.base_extend(Qx.fraction_field())
sage: N
[  0   0 x31]
[  0   0 x21]
[  0   0   0]
sage: N.base_ring() 
Fraction Field of Multivariate Polynomial Ring in x11, x12, x13, x21, x22, x23, x31, x32, x33 over Rational Field
sage: N.jordan_form()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/home/darij/sage-5.6/<ipython console> in <module>()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.jordan_form (sage/matrix/matrix2.c:43627)()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:35063)()

NotImplementedError: root finding for this polynomial not implemented
```


This seems to boil down to polynomial factorization over function fields not being implemented:


```
sage: N.characteristic_polynomial().factor()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/home/darij/sage-5.6/<ipython console> in <module>()

/home/darij/sage-5.6/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.factor (sage/rings/polynomial/polynomial_element.c:24161)()

NotImplementedError: 
```


Unfortunately, I have no idea how to debug, let alone fix, things in C code, so I have nothing positive to contribute on this issue. Maybe a workaround is adding a new key "nilpotent" to the jordan_form method which, when set to True, skips the factorization of the characteristic polynomial and lets sage know that the matrix is nilpotent? In my personal experience, nilpotent matrices are the ones with the most interesting Jordan forms, and skipping the useless factorization would probably save quite some CPU cycles for them.


---

Comment by darij created at 2013-05-15 03:48:41

Changing status from new to needs_review.


---

Attachment

slightly improved


---

Comment by itolkov created at 2013-05-15 04:34:45

Thanks for the CC. I'm somewhat new here, anything I should do?


---

Comment by darij created at 2013-05-15 04:36:45

Hi -- I cc'ed you since I saw you working on the Jordan normal form today, so I'm wondering if you can provide some comments, maybe even a review...


---

Comment by lftabera created at 2013-05-15 11:54:23

Changing status from needs_review to needs_work.


---

Comment by lftabera created at 2013-05-15 11:54:23

With your example


```
sage: M.jordan_form(eigenvalues=[(0,3)])
[0 1|0]
[0 0|0]
[---+-]
[0 0|0]
sage: M.jordan_form(eigenvalues=[(1,3)])
[]
```


The code should not return the second but raise a type of error. Also, add to the doctest a test with your eigenvalues option with transformation=True to make sure it works as expected.

As a matter of style, avoid blank lines containing only blanckspaces (up to the indent level) in your code. I think this is not enforced though.


---

Comment by darij created at 2013-05-15 17:12:37

Good point about the error raising! I'll do it later today, when I have time. I am going to add a check variable that defaults to True so that the checking is only done when it is True, though; otherwise the speed advantage of this might be significantly diminished. (Checking is best done by just comparing the characteristic polynomial to the product of (X-eigenvalue)^(multiplicity) , or is there a better way?)

I didn't know that blank lines should not be indented! This makes my life easier, since I actually thought they *should* be indented...


---

Comment by darij created at 2013-05-16 01:45:42

Changing status from needs_work to needs_review.


---

Comment by darij created at 2013-05-16 01:50:12

version 2


---

Attachment

Oooops, I've just noticed that I gave the patch the extension .py rather than .patch. Anyway, here comes a new version, with a few typos fixed.


---

Attachment

version 3


---

Comment by darij created at 2013-07-16 19:18:44

patchbot:

apply trac_14117-jordan_normal_form-dg-v3.patch


---

Comment by darij created at 2013-07-23 15:07:24

Any idea why one of the patchbot machines reports PluginFailed?


---

Comment by tscrim created at 2013-10-02 15:23:31

One very minor point, instead of `Polyring(1)`, it's better to use `Polyring.one()` to take advantage of caching. Once you've made this change, you can set this to positive review on my behalf.

Best,

Travis


---

Comment by darij created at 2013-10-02 17:10:48

reviewed version


---

Attachment

reviewed version


---

Attachment

Thank you!

For the patchbot:

apply trac_14117-jordan_normal_form-dg-v4.patch


---

Comment by darij created at 2013-10-02 17:12:38

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-10-07 06:49:29

Resolution: fixed
