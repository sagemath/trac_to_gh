# Issue 27289: Boltzmann samplers for combinatorial grammars

archive/issues_027289.json:
```json
{
    "body": "CC:  tmonteil matthieudien martinpepin mantepse\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27526\n\n",
    "created_at": "2019-03-21T17:16:42Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Boltzmann samplers for combinatorial grammars",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27289",
    "user": "@Kerl13"
}
```
CC:  tmonteil matthieudien martinpepin mantepse



Issue created by migration from https://trac.sagemath.org/ticket/27526





---

archive/issue_comments_384667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-19T11:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384668.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-19T12:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384668",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-19T20:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384669",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-20T15:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T12:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384671",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T13:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384672",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384673.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-21T13:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384673",
    "user": "MatthieuDien"
}
```

New commits:



---

archive/issue_comments_384674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-21T16:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384674",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-22T13:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-22T18:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384676",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-25T07:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384677",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-27T09:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384678",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384679.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-28T10:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384679",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-05T09:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384680",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384681.json:
```json
{
    "body": "Please have a look at the patchbot warnings (click on the color round icon on top of the page) and in particular the plugins results.\n----\nNew commits:",
    "created_at": "2019-07-15T06:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384681",
    "user": "chapoton"
}
```

Please have a look at the patchbot warnings (click on the color round icon on top of the page) and in particular the plugins results.
----
New commits:



---

archive/issue_comments_384682.json:
```json
{
    "body": "Hi Martin!\n\nthe species implementation is currently undergoing the long awaited overhaul.  Travis and I have just finished a lazy series implementation, which is much more robust than what we had previously.  Ticket #32367 replaces the old (and somewhat unreliable) LazyPowerSeries with our new one.\n\nDo you think we should try to see whether a uniform user interface for defining a grammar is possible?",
    "created_at": "2022-09-08T18:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384682",
    "user": "mantepse"
}
```

Hi Martin!

the species implementation is currently undergoing the long awaited overhaul.  Travis and I have just finished a lazy series implementation, which is much more robust than what we had previously.  Ticket #32367 replaces the old (and somewhat unreliable) LazyPowerSeries with our new one.

Do you think we should try to see whether a uniform user interface for defining a grammar is possible?



---

archive/issue_comments_384683.json:
```json
{
    "body": "Replying to [comment:27 Martin Rubey]:\n> Hi Martin!\n> \n> the species implementation is currently undergoing the long awaited overhaul.  Travis and I have just finished a lazy series implementation, which is much more robust than what we had previously.  Ticket #32367 replaces the old (and somewhat unreliable) LazyPowerSeries with our new one.\n> \n> Do you think we should try to see whether a uniform user interface for defining a grammar is possible?\n\nHi all ! To be transparent, we had an informal discussion this afternoon with Martin P\u00e9pin about that same issue !\n\nIf you remember, a long time ago (before covid), i proposed to have a general meeting of all people interested in making a plan for the whole analytic combinatorics stuff in Sage (species, ore algebras, (multi-variate, lazy, etc) power series, Bolzmann samplers, singularity analysis, asymptotic expansions, etc). Most people answered positively but wanted to postpone the date, unfortunately the delays were too short as the grant was ending. Maybe, we could revive the idea. What do you think ?",
    "created_at": "2022-09-08T19:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384683",
    "user": "tmonteil"
}
```

Replying to [comment:27 Martin Rubey]:
> Hi Martin!
> 
> the species implementation is currently undergoing the long awaited overhaul.  Travis and I have just finished a lazy series implementation, which is much more robust than what we had previously.  Ticket #32367 replaces the old (and somewhat unreliable) LazyPowerSeries with our new one.
> 
> Do you think we should try to see whether a uniform user interface for defining a grammar is possible?

Hi all ! To be transparent, we had an informal discussion this afternoon with Martin Pépin about that same issue !

If you remember, a long time ago (before covid), i proposed to have a general meeting of all people interested in making a plan for the whole analytic combinatorics stuff in Sage (species, ore algebras, (multi-variate, lazy, etc) power series, Bolzmann samplers, singularity analysis, asymptotic expansions, etc). Most people answered positively but wanted to postpone the date, unfortunately the delays were too short as the grant was ending. Maybe, we could revive the idea. What do you think ?



---

archive/issue_comments_384684.json:
```json
{
    "body": "I am all for it!  I have no teaching in February.  Until then, zoom and email is fine for me!",
    "created_at": "2022-09-08T19:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384684",
    "user": "mantepse"
}
```

I am all for it!  I have no teaching in February.  Until then, zoom and email is fine for me!



---

archive/issue_comments_384685.json:
```json
{
    "body": "Hi!\n\nFirst an important note: Matthieu and I (temporarily) moved away from this ticket about 3 years ago as we decided to implement a standalone python library [available here (usainboltz)](https://gitlab.com/ParComb/usain-boltz). This means that the branch tied to this ticket is obsolete and should not be used.\n\nThat being said:\n\n1. It doesn't prevent us from adding usainboltz to sage! Adding it as an optional package seems right to me (is it?)\n\n2. I agree with you that having a uniform user interface for defining grammars would be great. And the species, if they work, seem to be a very good candidate to me. I'd love to see some nice integration with usainboltz (and other existing tools) so that sampling objects described by a species becomes as simple as:\n\n\n```python\n>>> sampler = my_specy.get_boltzmann_sampler()\n>>> sampler(size_in=[1000, 2000])\n<some big object>\n```\n\n\nI'm all in to work on this as well!",
    "created_at": "2022-09-09T12:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384685",
    "user": "MartinPepin"
}
```

Hi!

First an important note: Matthieu and I (temporarily) moved away from this ticket about 3 years ago as we decided to implement a standalone python library [available here (usainboltz)](https://gitlab.com/ParComb/usain-boltz). This means that the branch tied to this ticket is obsolete and should not be used.

That being said:

1. It doesn't prevent us from adding usainboltz to sage! Adding it as an optional package seems right to me (is it?)

2. I agree with you that having a uniform user interface for defining grammars would be great. And the species, if they work, seem to be a very good candidate to me. I'd love to see some nice integration with usainboltz (and other existing tools) so that sampling objects described by a species becomes as simple as:


```python
>>> sampler = my_specy.get_boltzmann_sampler()
>>> sampler(size_in=[1000, 2000])
<some big object>
```


I'm all in to work on this as well!



---

archive/issue_comments_384686.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T18:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384686",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384687.json:
```json
{
    "body": "I added usainboltz as a pip package following https://doc.sagemath.org/html/en/developer/packaging.html#python-based-packages.\n\nBut something must be wrong with what I did, I can't install usainboltz using `sage -i`:\n\n\n```\n$ ./sage -i usainboltz\n[ a log of log about sage checking if it needs to rebuild stuff ]\nError: package 'usainboltz' not found\nNote: if it is an old-style package, installing these is no longer supported\n```\n\n\nNote that `./sage --optional` and `./sage --info usainboltz` both see usainboltz. I might need a bit of help to understand what is happening.",
    "created_at": "2022-09-13T18:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384687",
    "user": "MartinPepin"
}
```

I added usainboltz as a pip package following https://doc.sagemath.org/html/en/developer/packaging.html#python-based-packages.

But something must be wrong with what I did, I can't install usainboltz using `sage -i`:


```
$ ./sage -i usainboltz
[ a log of log about sage checking if it needs to rebuild stuff ]
Error: package 'usainboltz' not found
Note: if it is an old-style package, installing these is no longer supported
```


Note that `./sage --optional` and `./sage --info usainboltz` both see usainboltz. I might need a bit of help to understand what is happening.



---

archive/issue_comments_384688.json:
```json
{
    "body": "It worked well for me, i could successfully execute `binarytrees.ipynb`.",
    "created_at": "2022-09-13T19:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384688",
    "user": "tmonteil"
}
```

It worked well for me, i could successfully execute `binarytrees.ipynb`.



---

archive/issue_comments_384689.json:
```json
{
    "body": "I would replace `boltzmann` with `Boltzmann` in the title but apart from that, it looks good to me.",
    "created_at": "2022-09-13T19:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384689",
    "user": "tmonteil"
}
```

I would replace `boltzmann` with `Boltzmann` in the title but apart from that, it looks good to me.



---

archive/issue_comments_384690.json:
```json
{
    "body": "Changing component from combinatorics to packages: optional.",
    "created_at": "2022-09-13T19:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384690",
    "user": "tmonteil"
}
```

Changing component from combinatorics to packages: optional.



---

archive/issue_comments_384691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384691",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384692.json:
```json
{
    "body": "\n```\n+Usainboltz: fast Boltzmann random generation of tree-like structures\n+====================================================================\n```\n\nthis line should start with lowercase",
    "created_at": "2022-09-13T20:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384692",
    "user": "mkoeppe"
}
```


```
+Usainboltz: fast Boltzmann random generation of tree-like structures
+====================================================================
```

this line should start with lowercase



---

archive/issue_comments_384693.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T20:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384693",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384694.json:
```json
{
    "body": "Once you are happy with your changes, you can set the \"Action\" to \"needs review\".",
    "created_at": "2022-09-13T20:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384694",
    "user": "tmonteil"
}
```

Once you are happy with your changes, you can set the "Action" to "needs review".



---

archive/issue_comments_384695.json:
```json
{
    "body": "Replying to [comment:40 Thierry Monteil]:\n> Once you are happy with your changes, you can set the \"Action\" to \"needs review\".\n\nOh right, thanks for recalling me the usual workflow, I'm not used to it yet ^^\n\nI'm a bit frustrated that I could not test it. I started a new `make build` which seems to want to recompile some stuff. I'll try to test again tomorrow when it's done and update the Action field afterward",
    "created_at": "2022-09-13T21:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384695",
    "user": "MartinPepin"
}
```

Replying to [comment:40 Thierry Monteil]:
> Once you are happy with your changes, you can set the "Action" to "needs review".

Oh right, thanks for recalling me the usual workflow, I'm not used to it yet ^^

I'm a bit frustrated that I could not test it. I started a new `make build` which seems to want to recompile some stuff. I'll try to test again tomorrow when it's done and update the Action field afterward



---

archive/issue_comments_384696.json:
```json
{
    "body": "Replying to [comment:34 Thierry Monteil]:\n> It worked well for me, i could successfully execute `binarytrees.ipynb`.\n\nI still don't manage to `sage -i usainboltz` (even on a fresh clone after having built sage with `make build`) it seems that usainboltz should appear in the output of `make list` but it doesn't. Rebuilding `build/make/Makefile` doesn't help either.",
    "created_at": "2022-09-14T12:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384696",
    "user": "MartinPepin"
}
```

Replying to [comment:34 Thierry Monteil]:
> It worked well for me, i could successfully execute `binarytrees.ipynb`.

I still don't manage to `sage -i usainboltz` (even on a fresh clone after having built sage with `make build`) it seems that usainboltz should appear in the output of `make list` but it doesn't. Rebuilding `build/make/Makefile` doesn't help either.



---

archive/issue_comments_384697.json:
```json
{
    "body": "Ok now it works! Sorry for the noise, there had been a problem at `make configure` that I didn't spot when I built sage",
    "created_at": "2022-09-14T14:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384697",
    "user": "MartinPepin"
}
```

Ok now it works! Sorry for the noise, there had been a problem at `make configure` that I didn't spot when I built sage



---

archive/issue_comments_384698.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-14T14:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384698",
    "user": "MartinPepin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384699.json:
```json
{
    "body": "\n```\n+++ b/build/pkgs/usainboltz/dependencies\n@@ -0,0 +1,4 @@\n+$(PYTHON) cython | $(PYTHON_TOOLCHAIN)\n```\n\nIt's better to put `cython` after the `|`, to make it an order-only dependency",
    "created_at": "2022-09-14T14:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384699",
    "user": "mkoeppe"
}
```


```
+++ b/build/pkgs/usainboltz/dependencies
@@ -0,0 +1,4 @@
+$(PYTHON) cython | $(PYTHON_TOOLCHAIN)
```

It's better to put `cython` after the `|`, to make it an order-only dependency



---

archive/issue_comments_384700.json:
```json
{
    "body": "On macOS (with clang)\n\n```\n[usainboltz]       gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -Isrc/xoshiro -Isrc/usainboltz -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -c src/usainboltz/cpp_simulator.cpp -o build/temp.macosx-10.14-x86_64-cpython-38/src/usainboltz/cpp_simulator.o\n[usainboltz]       In file included from src/usainboltz/cpp_simulator.cpp:7:\n[usainboltz]       src/usainboltz/cpp_simulator.hpp:45:7: error: union member '_as_product' has a non-trivial copy constructor\n[usainboltz]           } _as_product;\n[usainboltz]             ^\n[usainboltz]       src/usainboltz/cpp_simulator.hpp:44:28: note: because field of type 'std::vector<CRule *>' has a user-provided copy constructor\n[usainboltz]             std::vector<CRule *> args;\n[usainboltz]                                  ^\n[usainboltz]       /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1/vector:581:5: note: declared here\n[usainboltz]           vector(const vector& __x);\n[usainboltz]           ^\n[usainboltz]       In file included from src/usainboltz/cpp_simulator.cpp:7:\n[usainboltz]       src/usainboltz/cpp_simulator.hpp:50:37: error: a space is required between consecutive right angle brackets (use '> >')\n[usainboltz]             std::vector<std::vector<double>> weights;\n[usainboltz]                                           ^~\n[usainboltz]                                           > >\n```\n",
    "created_at": "2022-09-14T14:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384700",
    "user": "mkoeppe"
}
```

On macOS (with clang)

```
[usainboltz]       gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -Isrc/xoshiro -Isrc/usainboltz -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -c src/usainboltz/cpp_simulator.cpp -o build/temp.macosx-10.14-x86_64-cpython-38/src/usainboltz/cpp_simulator.o
[usainboltz]       In file included from src/usainboltz/cpp_simulator.cpp:7:
[usainboltz]       src/usainboltz/cpp_simulator.hpp:45:7: error: union member '_as_product' has a non-trivial copy constructor
[usainboltz]           } _as_product;
[usainboltz]             ^
[usainboltz]       src/usainboltz/cpp_simulator.hpp:44:28: note: because field of type 'std::vector<CRule *>' has a user-provided copy constructor
[usainboltz]             std::vector<CRule *> args;
[usainboltz]                                  ^
[usainboltz]       /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1/vector:581:5: note: declared here
[usainboltz]           vector(const vector& __x);
[usainboltz]           ^
[usainboltz]       In file included from src/usainboltz/cpp_simulator.cpp:7:
[usainboltz]       src/usainboltz/cpp_simulator.hpp:50:37: error: a space is required between consecutive right angle brackets (use '> >')
[usainboltz]             std::vector<std::vector<double>> weights;
[usainboltz]                                           ^~
[usainboltz]                                           > >
```




---

archive/issue_comments_384701.json:
```json
{
    "body": "I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG",
    "created_at": "2022-09-14T15:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384701",
    "user": "mkoeppe"
}
```

I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG



---

archive/issue_comments_384702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-14T15:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384702",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384703.json:
```json
{
    "body": "> It's better to put `cython` after the `|`, to make it an order-only dependency\n\nGood point, sorry I missed that",
    "created_at": "2022-09-14T15:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384703",
    "user": "MartinPepin"
}
```

> It's better to put `cython` after the `|`, to make it an order-only dependency

Good point, sorry I missed that



---

archive/issue_comments_384704.json:
```json
{
    "body": "Replying to [comment:46 Matthias K\u00f6ppe]:\n> On macOS (with clang)\n> {{{\n> [usainboltz]       src/usainboltz/cpp_simulator.hpp:50:37: error: a space is required between consecutive right angle brackets (use '> >')\n> [usainboltz]             std::vector<std::vector<double>> weights;\n> [usainboltz]                                           ^~\n> }}}\n\nI was not aware of that issue, thanks for reporting, I'll add clang to usainboltz' CI",
    "created_at": "2022-09-14T15:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384704",
    "user": "MartinPepin"
}
```

Replying to [comment:46 Matthias Köppe]:
> On macOS (with clang)
> {{{
> [usainboltz]       src/usainboltz/cpp_simulator.hpp:50:37: error: a space is required between consecutive right angle brackets (use '> >')
> [usainboltz]             std::vector<std::vector<double>> weights;
> [usainboltz]                                           ^~
> }}}

I was not aware of that issue, thanks for reporting, I'll add clang to usainboltz' CI



---

archive/issue_comments_384705.json:
```json
{
    "body": "Probably needs `-std=c++11` or something like this",
    "created_at": "2022-09-14T15:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384705",
    "user": "mkoeppe"
}
```

Probably needs `-std=c++11` or something like this



---

archive/issue_comments_384706.json:
```json
{
    "body": "Replying to [comment:47 Matthias K\u00f6ppe]:\n> I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG\n\nYes it is indeed interesting. How do I benefit from this?\nWill sage's pip use the optional `cvxpy` package if I add it as a dependency? Or do I need to switch to the `normal` package format for usainboltz`? I'll be happy to do so if it's considered better.\n\nBtw, Thierry told me a few days ago that our (only \u201creal\u201d dependency `paganini` might be of interest for sage as well. Another good reason to package everything as `normal`?",
    "created_at": "2022-09-14T15:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384706",
    "user": "MartinPepin"
}
```

Replying to [comment:47 Matthias Köppe]:
> I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG

Yes it is indeed interesting. How do I benefit from this?
Will sage's pip use the optional `cvxpy` package if I add it as a dependency? Or do I need to switch to the `normal` package format for usainboltz`? I'll be happy to do so if it's considered better.

Btw, Thierry told me a few days ago that our (only “real” dependency `paganini` might be of interest for sage as well. Another good reason to package everything as `normal`?



---

archive/issue_comments_384707.json:
```json
{
    "body": "Replying to [comment:51 Matthias K\u00f6ppe]:\n> Probably needs `-std=c++11` or something like this\n\nI'll check that but I think I prefer to follow the error message's suggestion if it makes the library compatible with more compilers / compiler versions",
    "created_at": "2022-09-14T15:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384707",
    "user": "MartinPepin"
}
```

Replying to [comment:51 Matthias Köppe]:
> Probably needs `-std=c++11` or something like this

I'll check that but I think I prefer to follow the error message's suggestion if it makes the library compatible with more compilers / compiler versions



---

archive/issue_comments_384708.json:
```json
{
    "body": "See #32074 for detailed info on compiler supported by Sage & related software",
    "created_at": "2022-09-14T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384708",
    "user": "mkoeppe"
}
```

See #32074 for detailed info on compiler supported by Sage & related software



---

archive/issue_comments_384709.json:
```json
{
    "body": "Replying to [comment:46 Matthias K\u00f6ppe]:\n\nI fixed the compilation issue with clang (at list on my setup).\n\nWould you mind checking whether `sage -pip install git+https://gitlab.com/ParComb/usain-boltz#master` works for you before I release a new version? That would be really nice.\n\nA few warnings are to be expected because cython does not produce fully c++11 compatible code (https://github.com/cython/cython/pull/4687). I don't know to what extent this is a problem.\n\n> On macOS (with clang)\n> {{{\n> [usainboltz]       gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -Isrc/xoshiro -Isrc/usainboltz -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -c src/usainboltz/cpp_simulator.cpp -o build/temp.macosx-10.14-x86_64-cpython-38/src/usainboltz/cpp_simulator.o\n> [...]\n> }}}\n\nBy the way, I just noticed you seemed to use gcc from the log you pasted.\nIs this a mistake or is `gcc` an alias for `clang` in your setup?",
    "created_at": "2022-09-19T10:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384709",
    "user": "MartinPepin"
}
```

Replying to [comment:46 Matthias Köppe]:

I fixed the compilation issue with clang (at list on my setup).

Would you mind checking whether `sage -pip install git+https://gitlab.com/ParComb/usain-boltz#master` works for you before I release a new version? That would be really nice.

A few warnings are to be expected because cython does not produce fully c++11 compatible code (https://github.com/cython/cython/pull/4687). I don't know to what extent this is a problem.

> On macOS (with clang)
> {{{
> [usainboltz]       gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -Isrc/xoshiro -Isrc/usainboltz -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -c src/usainboltz/cpp_simulator.cpp -o build/temp.macosx-10.14-x86_64-cpython-38/src/usainboltz/cpp_simulator.o
> [...]
> }}}

By the way, I just noticed you seemed to use gcc from the log you pasted.
Is this a mistake or is `gcc` an alias for `clang` in your setup?



---

archive/issue_comments_384710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-19T15:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384710",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-19T15:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384711",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384712.json:
```json
{
    "body": "I could finally get my hands on a mac this afternoon so I could test the compilation there and release a new version, sorry for the noise",
    "created_at": "2022-09-19T15:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384712",
    "user": "MartinPepin"
}
```

I could finally get my hands on a mac this afternoon so I could test the compilation there and release a new version, sorry for the noise



---

archive/issue_comments_384713.json:
```json
{
    "body": "Replying to [comment:55 Martin P\u00e9pin]:\n> By the way, I just noticed you seemed to use gcc from the log you pasted.\n> Is this a mistake or is `gcc` an alias for `clang` in your setup?\n\nOn macOS, the `gcc` binary provided by Xcode is a compatibility shim around Apple's version of clang.",
    "created_at": "2022-09-19T16:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384713",
    "user": "mkoeppe"
}
```

Replying to [comment:55 Martin Pépin]:
> By the way, I just noticed you seemed to use gcc from the log you pasted.
> Is this a mistake or is `gcc` an alias for `clang` in your setup?

On macOS, the `gcc` binary provided by Xcode is a compatibility shim around Apple's version of clang.



---

archive/issue_comments_384714.json:
```json
{
    "body": "Replying to [comment:52 Martin P\u00e9pin]:\n> Replying to [comment:47 Matthias K\u00f6ppe]:\n> > I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG\n> \n> Yes it is indeed interesting. How do I benefit from this?\n\n#34251 is waiting for reviewers...\n\n> Will sage's pip use the optional `cvxpy` package if I add it as a dependency? Or do I need to switch to the `normal` package format for usainboltz`? I'll be happy to do so if it's considered better.\n\nWhen #34251 is merged, we should add `cvxpy` to `build/pkgs/usainboltz/dependencies`.\nThis will avoid the conflict (possible races in parallel builds) between installing `cvxpy` from our package and getting `cvxpy`.\n\nThere's no need to switch `usainboltz` to `normal`.",
    "created_at": "2022-09-19T16:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384714",
    "user": "mkoeppe"
}
```

Replying to [comment:52 Martin Pépin]:
> Replying to [comment:47 Matthias Köppe]:
> > I see that `cvxpy` is a dependency of this package. You may be interested in #34251, which adds it as an SPKG
> 
> Yes it is indeed interesting. How do I benefit from this?

#34251 is waiting for reviewers...

> Will sage's pip use the optional `cvxpy` package if I add it as a dependency? Or do I need to switch to the `normal` package format for usainboltz`? I'll be happy to do so if it's considered better.

When #34251 is merged, we should add `cvxpy` to `build/pkgs/usainboltz/dependencies`.
This will avoid the conflict (possible races in parallel builds) between installing `cvxpy` from our package and getting `cvxpy`.

There's no need to switch `usainboltz` to `normal`.



---

archive/issue_comments_384715.json:
```json
{
    "body": "Replying to [comment:52 Martin P\u00e9pin]:\n> Btw, Thierry told me a few days ago that our (only \u201creal\u201d dependency `paganini` might be of interest for sage as well.\n\nI can't comment on this; it's outside of my domain of mathematical expertise.\n\n>  Another good reason to package everything as `normal`?\n\nNo, I'd say it's best to set things up as `pip` packages as you did. The additional maintenance burden (upgrade tickets) with `normal` packages is typically only warranted if we have tight integration of the provided functionality in Sage.",
    "created_at": "2022-09-19T17:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384715",
    "user": "mkoeppe"
}
```

Replying to [comment:52 Martin Pépin]:
> Btw, Thierry told me a few days ago that our (only “real” dependency `paganini` might be of interest for sage as well.

I can't comment on this; it's outside of my domain of mathematical expertise.

>  Another good reason to package everything as `normal`?

No, I'd say it's best to set things up as `pip` packages as you did. The additional maintenance burden (upgrade tickets) with `normal` packages is typically only warranted if we have tight integration of the provided functionality in Sage.



---

archive/issue_comments_384716.json:
```json
{
    "body": "Oh, now I see you have made the switch to `normal` packages already on the new branch.\nThen it's best to merge the branch of #34251 here. The current branch can't be tested because `cvxpy` is not a package",
    "created_at": "2022-09-19T17:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384716",
    "user": "mkoeppe"
}
```

Oh, now I see you have made the switch to `normal` packages already on the new branch.
Then it's best to merge the branch of #34251 here. The current branch can't be tested because `cvxpy` is not a package



---

archive/issue_comments_384717.json:
```json
{
    "body": "\n```\ndiff --git a/build/pkgs/optas/dependencies b/build/pkgs/optas/dependencies\nnew file mode 100644\nindex 00000000..7d1ace1\n--- /dev/null\n+++ b/build/pkgs/optas/dependencies\n@@ -0,0 +1,4 @@\n+$(PYTHON) | $(PYTHON_TOOLCHAIN) gcc\n```\n\nThere's no need for the `gcc` here. This dependency is implicit for all packages.",
    "created_at": "2022-09-19T17:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384717",
    "user": "mkoeppe"
}
```


```
diff --git a/build/pkgs/optas/dependencies b/build/pkgs/optas/dependencies
new file mode 100644
index 00000000..7d1ace1
--- /dev/null
+++ b/build/pkgs/optas/dependencies
@@ -0,0 +1,4 @@
+$(PYTHON) | $(PYTHON_TOOLCHAIN) gcc
```

There's no need for the `gcc` here. This dependency is implicit for all packages.



---

archive/issue_comments_384718.json:
```json
{
    "body": "Other than that, it's looking good",
    "created_at": "2022-09-19T17:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384718",
    "user": "mkoeppe"
}
```

Other than that, it's looking good



---

archive/issue_comments_384719.json:
```json
{
    "body": "Replying to [comment:61 Matthias K\u00f6ppe]:\n> #34251 is waiting for reviewers...\n\nI think I can do that!",
    "created_at": "2022-09-19T18:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27289#issuecomment-384719",
    "user": "MartinPepin"
}
```

Replying to [comment:61 Matthias Köppe]:
> #34251 is waiting for reviewers...

I think I can do that!
