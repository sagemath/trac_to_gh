# Issue 14691: Segfault when exponentiating an integer with I.pyobject()

Issue created by migration from Trac.

Original creator: eviatarbach

Original creation time: 2013-07-15 23:44:22

Assignee: burcin

Try, for example, `2^I.pyobject()`.

This is a critical issue since any method of a class inheriting from `BuiltinFunction` will receive the I pyobject if I is passed as an argument to the function.


---

Comment by vbraun created at 2013-07-16 02:50:16

Infinite recursion

```
#473 0x00007fffdf203eaf in __pyx_pf_4sage_5rings_8rational_8Rational_100__pow__ (
    __pyx_v_self=<sage.rings.rational.Rational at remote 0x576f470>, 
    __pyx_v_n=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, __pyx_v_dummy=<optimized out>) at sage/rings/rational.c:18767
#474 0x00007ffff7c3f806 in ternary_op (op_name=<synthetic pointer>, op_slot=48, z=None, 
    w=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, v=<sage.rings.rational.Rational at remote 0x576f470>) at Objects/abstract.c:1065
#475 PyNumber_Power (v=<optimized out>, w=<optimized out>, z=None) at Objects/abstract.c:1255
#476 0x00007fffd4847e64 in __pyx_pf_4sage_5rings_12number_field_20number_field_element_18NumberFieldElement_68__pow__ (__pyx_v_dummy=<optimized out>, __pyx_v_exp=<optimized out>, 
    __pyx_v_base=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x576e890>) at sage/rings/number_field/number_field_element.cpp:14267
#477 __pyx_pw_4sage_5rings_12number_field_20number_field_element_18NumberFieldElement_69__pow__ (
    __pyx_v_base=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x576e890>, 
    __pyx_v_exp=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, __pyx_v_dummy=<optimized out>)
    at sage/rings/number_field/number_field_element.cpp:14010
#478 0x00007ffff7c3f84c in ternary_op (op_name=<synthetic pointer>, op_slot=48, z=None, 
    w=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, 
    v=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x576e890>) at Objects/abstract.c:1065
#479 PyNumber_Power (v=<optimized out>, 
    w=w`@`entry=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, z=None) at Objects/abstract.c:1255
#480 0x00007fffdf203eaf in __pyx_pf_4sage_5rings_8rational_8Rational_100__pow__ (
    __pyx_v_self=<sage.rings.rational.Rational at remote 0x576f410>, 
    __pyx_v_n=<sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic at remote 0x25357d0>, __pyx_v_dummy=<optimized out>) at sage/rings/rational.c:18767
```



---

Comment by rws created at 2014-03-02 08:42:51

Pingpong between parent and base.

`rings/rational.pyx` (`Rational._pow_()`):

```
            if PY_TYPE_CHECK(n, Element):
                return (<Element>n)._parent(self)**n
            try:
                return n.parent()(self)**n
```

`rings/number_field/number_field_element.pyx` (`NumberFieldElement._pow_()`):

```
            from sage.symbolic.ring import SR
            try:
                res = QQ(base)**exp
            except TypeError:
                pass
```

So which one to fix?


---

Comment by rws created at 2014-03-02 10:18:02

This passes all tests in rings, and adds some tests. If you change it please keep the tests.
----
New commits:


---

Comment by rws created at 2014-03-02 10:18:02

Changing status from new to needs_review.


---

Comment by git created at 2014-03-12 07:46:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-04-07 22:43:12

Changing keywords from "" to "days57".


---

Comment by vbraun created at 2014-04-07 22:43:12

Looks good to me, but can you remove the commented-out block? If you want to know what was there before there is always git. Lots of code has been edited at one point, if everybody would have left commented-out crap around then the source would be really hard to read.


---

Comment by rws created at 2014-04-08 06:35:37

New commits:


---

Comment by rws created at 2014-04-08 06:35:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-08 10:16:14


```
sage -t --long src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 3207, in sage.symbolic.expression.Expression.__pow__
Failed example:
    t^(1/2)
Expected:
    2*sqrt(2)
Got:
    sqrt(8)
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 3209, in sage.symbolic.expression.Expression.__pow__
Failed example:
    (t^2)^(1/4)
Expected:
    2*4^(1/4)
Got:
    64^(1/4)
**********************************************************************
```

So that what it was about, we want the simplified symbolic form. We should just try `QQ(base)**QQ(exp)`, the `QQ.__pow__` method will then find the simplified form.


---

Comment by vbraun created at 2014-04-08 10:16:55

Changing status from positive_review to needs_work.


---

Comment by rws created at 2014-04-08 15:13:50

Indeed, that works, and tests OK --long in symbolic/ and rings/ and not long elsewhere.
----
New commits:


---

Comment by rws created at 2014-04-08 15:13:50

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-04-08 15:19:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-04-09 09:39:35

Resolution: fixed
