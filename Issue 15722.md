# Issue 15722: The hash function of combinatorial free module elements should depend on the parent

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2014-03-17 11:17:32

CC:  tscrim aschilling

It would be desirable to make the hash value of (combinatorial) free
module elements depend on the hash value of the parent. However this
currently breaks some code (see
e.g. sage.combinat.crystals.kyoto_path_model.KyotoPathModel).

This code indeed assumes, in dictionary look-ups, that an element of
some free module over ZZ and its counter part over QQ (in the case at
hand, the weight lattice and the weight space), comparing as equal
because of a coercion, have the same hash value.

Yet another case of equality using coercion being harmful:
http://wiki.sagemath.org/EqualityCoercion



---

Comment by tscrim created at 2014-03-17 15:11:36

Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?


---

Comment by nthiery created at 2014-03-17 16:33:51

Replying to [comment:1 tscrim]:
> Nicolas, do you have a preliminary branch that you could post (or is this the #15931 branch?) or could post the errors/doctest failures?

Sorry, I should have provided steps to reproduce. Checkout branch #15931 at commit a2bbe7f297caeb73bda1f8ce31af9ee21b90a26b, and run the tests on the Kyoto path model.


---

Comment by tscrim created at 2014-03-28 02:11:26

I haven't merged in the latest #15931, but instead started with the a2bbe7f297 commit. The fix for the Kyoto path model is that I was passing in elements of the weight space, whereas the `Epsilon()/Phi()` methods returned an element of the weight lattice. I've added an additional check for robustness.
----
New commits:


---

Comment by git created at 2014-04-09 02:07:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-15 02:43:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-04-20 15:34:53

I've merged the branch into #16193 and set that as a dependency.
