# Issue 21407: Bug in derivatives of some functions to the index var

Issue created by migration from https://trac.sagemath.org/ticket/21644

Original creator: rws

Original creation time: 2016-10-05 06:36:36


```
sage: gen_laguerre(n,a,x).diff(a)
-gen_laguerre(n - 1, a + 1, x)
sage: gen_laguerre(n,a,x).diff(x)
-gen_laguerre(n - 1, a + 1, x)

sage: derivative(hermite(n,x),x)
2*n*hermite(n - 1, x)
sage: derivative(hermite(n,x),n)
2*n*hermite(n - 1, x)
```

so something is badly wrong with recognizing the diff. parameter.


---

Comment by mafra created at 2016-10-05 18:13:51

I have a patch for this issue (at least for gen_laguerre, my copy of sage doesn't have a derivative method for hermite).

The bug was in handling the diff_param choice, the 'else' branch had the return value for when diff_param was x, but that means that anything that didn't match
the ifs before would return the derivative wrt x from the 'else' branch.

The attached patch fixes this (and adds proper handling to laguerre as well)


---

Comment by mafra created at 2016-10-05 18:14:42

Patch to fix issue with gen_laguerre derivative


---

Attachment

`@`mafra you should create and post a git branch of your patch to this ticket. Then one that is done, you can put your (real) name as the author and set it to needs review.


---

Comment by mafra created at 2016-10-05 23:52:42

New commits:


---

Comment by mafra created at 2016-10-05 23:52:42

Changing status from new to needs_review.


---

Comment by rws created at 2016-10-06 06:07:04

That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.

BTW Pynac fixes also get Python doctests, partly in the https://github.com/pynac/sage branches (which get merged with the Pynac upgrade ticket into Sage), and partly with separate Sage tickets.


---

Comment by rws created at 2016-10-06 06:36:25

The hermite fix is in https://github.com/pynac/pynac/commit/20222d00281b2ab30970a407a8fb3e8fee93e07a


---

Comment by rws created at 2016-10-06 06:47:39

However, see #21655 for a later enhancement.


---

Comment by git created at 2016-10-06 08:31:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mafra created at 2016-10-06 08:35:46

Replying to [comment:6 rws]:
> That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.

Ok, I did that now. But I was not sure if I should have rebased the new patch into the previous one or not, and when I decided to push I got an error message saying that I needed to 'pull'
first. After pulling an automatic merge was done, so now there are three commits in this branch.

Should I have rebased the doctest patch into the previous one? Would that require a 'forced' git push?


---

Comment by rws created at 2016-10-06 09:01:55

The merge commit would not have been necessary if you had done `git co t/21644/bug_in_derivatives_of_some_functions_to_the_index_var` on your machine, added the doctest commt, and finally `git trac push`. But it's no heavy disaster.


---

Comment by rws created at 2016-10-06 09:01:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-10-21 07:03:49

Resolution: fixed
