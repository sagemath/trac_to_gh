# Issue 13380: Add rcm to matrix/matrix2.pyx

archive/issues_013380.json:
```json
{
    "body": "Assignee: r.gaia.cs\n\nCC:  embray\n\nKeywords: matrix, rcm\n\nIt will be great to have the RCM (Reverse Cuthill-McKee) for a matrix.\n\nNote that #13583 is for graphs while this is for matrix. The reason to implement the same algorithm twice is because speedy.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13584\n\n",
    "created_at": "2012-10-08T14:16:53Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "title": "Add rcm to matrix/matrix2.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13380",
    "user": "r.gaia.cs"
}
```
Assignee: r.gaia.cs

CC:  embray

Keywords: matrix, rcm

It will be great to have the RCM (Reverse Cuthill-McKee) for a matrix.

Note that #13583 is for graphs while this is for matrix. The reason to implement the same algorithm twice is because speedy.

Issue created by migration from https://trac.sagemath.org/ticket/13584





---

archive/issue_comments_164604.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-08T14:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164604",
    "user": "r.gaia.cs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164605.json:
```json
{
    "body": "Attachment [trac_13584-matrix_rcm.patch](tarball://root/attachments/some-uuid/ticket13584/trac_13584-matrix_rcm.patch) by r.gaia.cs created at 2012-10-15 13:07:11",
    "created_at": "2012-10-15T13:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164605",
    "user": "r.gaia.cs"
}
```

Attachment [trac_13584-matrix_rcm.patch](tarball://root/attachments/some-uuid/ticket13584/trac_13584-matrix_rcm.patch) by r.gaia.cs created at 2012-10-15 13:07:11



---

archive/issue_comments_164606.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-05-13T08:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164606",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_164607.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-18T16:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164607",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164608.json:
```json
{
    "body": "\n```\n[matrices ] docstring of sage.matrix.matrix2.Matrix:8: WARNING: Definition list ends without a blank line; unexpected unindent.\n[matrices ] docstring of sage.matrix.matrix2.Matrix:16: WARNING: Definition list ends without a blank line; unexpected unindent.\n[matrices ] docstring of sage.matrix.matrix2.Matrix.C:2: WARNING: Definition list ends without a blank line; unexpected unindent.\n```\n",
    "created_at": "2014-05-18T16:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164608",
    "user": "rws"
}
```


```
[matrices ] docstring of sage.matrix.matrix2.Matrix:8: WARNING: Definition list ends without a blank line; unexpected unindent.
[matrices ] docstring of sage.matrix.matrix2.Matrix:16: WARNING: Definition list ends without a blank line; unexpected unindent.
[matrices ] docstring of sage.matrix.matrix2.Matrix.C:2: WARNING: Definition list ends without a blank line; unexpected unindent.
```




---

archive/issue_comments_164609.json:
```json
{
    "body": "I have formatted the doc. There is a doctest missing.\n----\nNew commits:",
    "created_at": "2015-02-14T09:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164609",
    "user": "chapoton"
}
```

I have formatted the doc. There is a doctest missing.
----
New commits:



---

archive/issue_comments_164610.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-14T13:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164610",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164611.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-14T13:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164611",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164612.json:
```json
{
    "body": "There are various Cython issues:\n1. (*) The code cannot be interrupted, see [http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling)\n2. Sometimes there is `cdef int i` when there is no `i`.\n3. When you use `for i in xrange(n)`, you should declare the type of `i`.\n4. You can replace `xrange()` by `range()` in such code.\n5. More generally, try to declare the types of your variables.\n6. (*) When you `cdef` a type, make sure it is correct. In particular `ncols()` is not an `int`!\n7. Instead of `matrix.ncols()`, in Cython you can use `matrix._ncols`.\n8. About the private methods you add (like `_find_pseudo_peripheral_node`): you should consider making them `cpdef` for speed.\n\nThe (*) items must be fixed, the rest are suggestions.",
    "created_at": "2015-02-14T14:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164612",
    "user": "jdemeyer"
}
```

There are various Cython issues:
1. (*) The code cannot be interrupted, see [http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling)
2. Sometimes there is `cdef int i` when there is no `i`.
3. When you use `for i in xrange(n)`, you should declare the type of `i`.
4. You can replace `xrange()` by `range()` in such code.
5. More generally, try to declare the types of your variables.
6. (*) When you `cdef` a type, make sure it is correct. In particular `ncols()` is not an `int`!
7. Instead of `matrix.ncols()`, in Cython you can use `matrix._ncols`.
8. About the private methods you add (like `_find_pseudo_peripheral_node`): you should consider making them `cpdef` for speed.

The (*) items must be fixed, the rest are suggestions.



---

archive/issue_comments_164613.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-14T14:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164613",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164614.json:
```json
{
    "body": "Some more comments:\n\n9. What is the point of having `_adj_list` when we already have `nonzero_positions_in_row`? If you are not happy with the diagonal terms you can either remove them from the output of `nonzero_positions_in_row` or add an optional argument. You can also adapt `_adj` accordingly.\n\n10. The design is very ugly. If you need several methods to achieve a task then create a new class to handle them. It is a nonsense to add 6 private very specific methods (that will furthermore not appear in the documentation). Having an independent class can also be useful to avoid duplication with #13583.\n\n21. The call\n   {{{\n   if self[i,j] != 0:\n      ...\n   }}}\n   is very slow compared to\n   {{{\n   if self.get_unsafe(i,j):\n      ...\n   }}}\n   The latter avoids a creation of tuple, conversions between C variables and Python variables and a coercion (the `0` in the first version is a Python int).",
    "created_at": "2015-02-14T14:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164614",
    "user": "vdelecroix"
}
```

Some more comments:

9. What is the point of having `_adj_list` when we already have `nonzero_positions_in_row`? If you are not happy with the diagonal terms you can either remove them from the output of `nonzero_positions_in_row` or add an optional argument. You can also adapt `_adj` accordingly.

10. The design is very ugly. If you need several methods to achieve a task then create a new class to handle them. It is a nonsense to add 6 private very specific methods (that will furthermore not appear in the documentation). Having an independent class can also be useful to avoid duplication with #13583.

21. The call
   {{{
   if self[i,j] != 0:
      ...
   }}}
   is very slow compared to
   {{{
   if self.get_unsafe(i,j):
      ...
   }}}
   The latter avoids a creation of tuple, conversions between C variables and Python variables and a coercion (the `0` in the first version is a Python int).



---

archive/issue_comments_164615.json:
```json
{
    "body": "Since your code is about 400 lines, I also suggest to add your code to a new module instead of making `matrix2.pyx` (already the second largest file in Sage) even bigger. Your method in `matrix2.pyx` could just call\n\n```\nfrom sage.matrix.rcm cimport rcm\n\nclass Matrix2(...):\n    ...\n    def reverse_cuthill_mckee(...)\n        \"\"\"\n        doctests...\n        \"\"\"\n        return rcm(...)\n```\n",
    "created_at": "2015-02-14T14:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164615",
    "user": "jdemeyer"
}
```

Since your code is about 400 lines, I also suggest to add your code to a new module instead of making `matrix2.pyx` (already the second largest file in Sage) even bigger. Your method in `matrix2.pyx` could just call

```
from sage.matrix.rcm cimport rcm

class Matrix2(...):
    ...
    def reverse_cuthill_mckee(...)
        """
        doctests...
        """
        return rcm(...)
```




---

archive/issue_comments_164616.json:
```json
{
    "body": "Hellooooo everybody,\n\nI was not aware of this ticket, and it seems that we work on very similar topics. I implemented this recently, which is the exact (and much slower) version of the problem that the `RCM` tries to solve. \n\nhttp://www.sagemath.org/doc/reference/graphs/sage/graphs/graph_decompositions/bandwidth.html\n\nWhen you will have decided where exactly the new module will be, can you think of adding a 'seealso' from this heuristic to the graph's 'bandwidth' function, and conversely?\n\nThaaaaaaaaaaanks,\n\nNathann",
    "created_at": "2015-03-12T07:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164616",
    "user": "ncohen"
}
```

Hellooooo everybody,

I was not aware of this ticket, and it seems that we work on very similar topics. I implemented this recently, which is the exact (and much slower) version of the problem that the `RCM` tries to solve. 

http://www.sagemath.org/doc/reference/graphs/sage/graphs/graph_decompositions/bandwidth.html

When you will have decided where exactly the new module will be, can you think of adding a 'seealso' from this heuristic to the graph's 'bandwidth' function, and conversely?

Thaaaaaaaaaaanks,

Nathann



---

archive/issue_comments_164617.json:
```json
{
    "body": "Marco -> Marc",
    "created_at": "2015-10-09T10:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164617",
    "user": "vdelecroix"
}
```

Marco -> Marc



---

archive/issue_comments_164618.json:
```json
{
    "body": "I don't think I ever touched that code.",
    "created_at": "2015-10-15T14:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164618",
    "user": "mmezzarobba"
}
```

I don't think I ever touched that code.



---

archive/issue_comments_164619.json:
```json
{
    "body": "I'm OK if we close this as out of date.",
    "created_at": "2015-10-15T15:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164619",
    "user": "r.gaia.cs"
}
```

I'm OK if we close this as out of date.



---

archive/issue_comments_164620.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-14T10:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164620",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164621.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-11T20:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164621",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_164622.json:
```json
{
    "body": "obsolete, please close",
    "created_at": "2019-03-11T20:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164622",
    "user": "chapoton"
}
```

obsolete, please close



---

archive/issue_comments_164623.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2019-03-12T12:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164623",
    "user": "embray"
}
```

Resolution: wontfix



---

archive/issue_comments_164624.json:
```json
{
    "body": "If you say so.",
    "created_at": "2019-03-12T12:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13380",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13380#issuecomment-164624",
    "user": "embray"
}
```

If you say so.
