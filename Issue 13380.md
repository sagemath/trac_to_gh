# Issue 13380: Add rcm to matrix/matrix2.pyx

Issue created by migration from https://trac.sagemath.org/ticket/13584

Original creator: r.gaia.cs

Original creation time: 2012-10-08 14:16:53

Assignee: r.gaia.cs

CC:  embray

Keywords: matrix, rcm

It will be great to have the RCM (Reverse Cuthill-McKee) for a matrix.

Note that #13583 is for graphs while this is for matrix. The reason to implement the same algorithm twice is because speedy.


---

Comment by r.gaia.cs created at 2012-10-08 14:28:53

Changing status from new to needs_review.


---

Attachment


---

Comment by rws created at 2014-05-13 08:19:30

New commits:


---

Comment by rws created at 2014-05-18 16:44:18

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-05-18 16:44:18


```
[matrices ] docstring of sage.matrix.matrix2.Matrix:8: WARNING: Definition list ends without a blank line; unexpected unindent.
[matrices ] docstring of sage.matrix.matrix2.Matrix:16: WARNING: Definition list ends without a blank line; unexpected unindent.
[matrices ] docstring of sage.matrix.matrix2.Matrix.C:2: WARNING: Definition list ends without a blank line; unexpected unindent.
```



---

Comment by chapoton created at 2015-02-14 09:35:25

I have formatted the doc. There is a doctest missing.
----
New commits:


---

Comment by git created at 2015-02-14 13:50:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-02-14 13:53:11

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-02-14 14:21:56

There are various Cython issues:
1. (*) The code cannot be interrupted, see [http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://www.sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling)
1. Sometimes there is `cdef int i` when there is no `i`.
1. When you use `for i in xrange(n)`, you should declare the type of `i`.
1. You can replace `xrange()` by `range()` in such code.
1. More generally, try to declare the types of your variables.
1. (*) When you `cdef` a type, make sure it is correct. In particular `ncols()` is not an `int`!
1. Instead of `matrix.ncols()`, in Cython you can use `matrix._ncols`.
1. About the private methods you add (like `_find_pseudo_peripheral_node`): you should consider making them `cpdef` for speed.

The (*) items must be fixed, the rest are suggestions.


---

Comment by jdemeyer created at 2015-02-14 14:21:56

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-02-14 14:28:59

Some more comments:

9. What is the point of having `_adj_list` when we already have `nonzero_positions_in_row`? If you are not happy with the diagonal terms you can either remove them from the output of `nonzero_positions_in_row` or add an optional argument. You can also adapt `_adj` accordingly.

10. The design is very ugly. If you need several methods to achieve a task then create a new class to handle them. It is a nonsense to add 6 private very specific methods (that will furthermore not appear in the documentation). Having an independent class can also be useful to avoid duplication with #13583.

11. The call
  {{{
  if self[i,j] != 0:
      ...
  }}}
  is very slow compared to
  {{{
  if self.get_unsafe(i,j):
      ...
  }}}
  The latter avoids a creation of tuple, conversions between C variables and Python variables and a coercion (the `0` in the first version is a Python int).


---

Comment by jdemeyer created at 2015-02-14 14:31:32

Since your code is about 400 lines, I also suggest to add your code to a new module instead of making `matrix2.pyx` (already the second largest file in Sage) even bigger. Your method in `matrix2.pyx` could just call

```
from sage.matrix.rcm cimport rcm

class Matrix2(...):
    ...
    def reverse_cuthill_mckee(...)
        """
        doctests...
        """
        return rcm(...)
```



---

Comment by ncohen created at 2015-03-12 07:39:49

Hellooooo everybody,

I was not aware of this ticket, and it seems that we work on very similar topics. I implemented this recently, which is the exact (and much slower) version of the problem that the `RCM` tries to solve. 

http://www.sagemath.org/doc/reference/graphs/sage/graphs/graph_decompositions/bandwidth.html

When you will have decided where exactly the new module will be, can you think of adding a 'seealso' from this heuristic to the graph's 'bandwidth' function, and conversely?

Thaaaaaaaaaaanks,

Nathann


---

Comment by vdelecroix created at 2015-10-09 10:41:54

Marco -> Marc


---

Comment by mmezzarobba created at 2015-10-15 14:05:00

I don't think I ever touched that code.


---

Comment by r.gaia.cs created at 2015-10-15 15:25:11

I'm OK if we close this as out of date.


---

Comment by chapoton created at 2018-12-14 10:30:24

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-03-11 20:15:56

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-03-11 20:15:56

obsolete, please close


---

Comment by embray created at 2019-03-12 12:19:13

Resolution: wontfix


---

Comment by embray created at 2019-03-12 12:19:13

If you say so.
