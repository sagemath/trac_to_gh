# Issue 33885: Bug is_planar() test for directed graph

archive/issues_033885.json:
```json
{
    "body": "There may be a bug in is_planar() implementation for directed graph, we have a case which return false instead of true for the below planar test,\n\n\n```\n  #!div style=\"font-size: 80%\"\n  {{{#!python\n     # Multiplicity [1,5]\n     G = [ [1,2], [1,4], [1,5], [2,3], [2,4], [2,5], [3,4], [3,5], [4,5], [5,1] ]\n     G1 = Graph(G)\n     G2 = DiGraph(G)\n     G1.is_planar() # True\n     G2.is_planar() # False => Should be true\n  }}}\n```\n\n\nNote that it does not seem to be a problem of cycle, since it works for the case\n\n\n```\n  #!div style=\"font-size: 80%\"\n  {{{#!python\n     # Multiplicity [1,5]\n     G = [ [1,2] , [2,1] ]\n     G1 = Graph(G)\n     G2 = DiGraph(G)\n     G1.is_planar() # True\n     G2.is_planar() # True !\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34122\n\n",
    "created_at": "2022-07-06T14:06:34Z",
    "labels": [
        "graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Bug is_planar() test for directed graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33885",
    "user": "@gdolle"
}
```
There may be a bug in is_planar() implementation for directed graph, we have a case which return false instead of true for the below planar test,


```
  #!div style="font-size: 80%"
  {{{#!python
     # Multiplicity [1,5]
     G = [ [1,2], [1,4], [1,5], [2,3], [2,4], [2,5], [3,4], [3,5], [4,5], [5,1] ]
     G1 = Graph(G)
     G2 = DiGraph(G)
     G1.is_planar() # True
     G2.is_planar() # False => Should be true
  }}}
```


Note that it does not seem to be a problem of cycle, since it works for the case


```
  #!div style="font-size: 80%"
  {{{#!python
     # Multiplicity [1,5]
     G = [ [1,2] , [2,1] ]
     G1 = Graph(G)
     G2 = DiGraph(G)
     G1.is_planar() # True
     G2.is_planar() # True !
```


Issue created by migration from https://trac.sagemath.org/ticket/34122





---

archive/issue_comments_481181.json:
```json
{
    "body": "Changing priority from minor to critical.",
    "created_at": "2022-07-07T04:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481181",
    "user": "@DaveWitteMorris"
}
```

Changing priority from minor to critical.



---

archive/issue_comments_481182.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-07T04:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481182",
    "user": "@DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_481183.json:
```json
{
    "body": "Thanks for pointing out the bug. This is a fundamental error in basic functionality, so I increased the priority to \"critical\". \n\nThe code applied an inequality to digraphs that is only valid for graphs.  A digraph without loops or multiple edges can have twice as many edges as the corresponding graph (because each undirected edge in a graph can be replaced with two oppositely directed edges in a digraph), so it is not true that a digraph with `self.size() > 3 * self.order() - 6` cannot be planar. \n----\nNew commits:",
    "created_at": "2022-07-07T04:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481183",
    "user": "@DaveWitteMorris"
}
```

Thanks for pointing out the bug. This is a fundamental error in basic functionality, so I increased the priority to "critical". 

The code applied an inequality to digraphs that is only valid for graphs.  A digraph without loops or multiple edges can have twice as many edges as the corresponding graph (because each undirected edge in a graph can be replaced with two oppositely directed edges in a digraph), so it is not true that a digraph with `self.size() > 3 * self.order() - 6` cannot be planar. 
----
New commits:



---

archive/issue_comments_481184.json:
```json
{
    "body": "Changing keywords from \"\" to \"digraph, planar\".",
    "created_at": "2022-07-07T04:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481184",
    "user": "@DaveWitteMorris"
}
```

Changing keywords from "" to "digraph, planar".



---

archive/issue_comments_481185.json:
```json
{
    "body": "Good catch. Thank you both for reporting and fixing the issue.",
    "created_at": "2022-07-11T16:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481185",
    "user": "@dcoudert"
}
```

Good catch. Thank you both for reporting and fixing the issue.



---

archive/issue_comments_481186.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-11T16:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481186",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_481187.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2022-07-12T05:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481187",
    "user": "@DaveWitteMorris"
}
```

Thanks for the review!



---

archive/issue_comments_481188.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-17T18:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33885#issuecomment-481188",
    "user": "@vbraun"
}
```

Resolution: fixed
