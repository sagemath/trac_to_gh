# Issue 12673: Incorrect doctest in sage/misc/functional.py

archive/issues_012673.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman\n\nWe currently have,\n\n\n```\nsage: a, b, c = var(\"a, b, c\")\nsage: v = vector([a, b, c])\nsage: bool(norm(v).simplify_full() == sqrt(a^2 + b^2 + c^2))\nTrue\n```\n\n\nwhich is true enough if a,b,c are real. The current doctest \"works\" because somewhere along the line, `simplify_full()` assumes that they're real. So in effect, this doctest is confirming incorrect behavior.\n\nThe proper fix is to explicitly assume that a,b,c are real.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12845\n\n",
    "created_at": "2012-04-15T18:26:33Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Incorrect doctest in sage/misc/functional.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12673",
    "user": "mjo"
}
```
Assignee: burcin

CC:  kcrisman

We currently have,


```
sage: a, b, c = var("a, b, c")
sage: v = vector([a, b, c])
sage: bool(norm(v).simplify_full() == sqrt(a^2 + b^2 + c^2))
True
```


which is true enough if a,b,c are real. The current doctest "works" because somewhere along the line, `simplify_full()` assumes that they're real. So in effect, this doctest is confirming incorrect behavior.

The proper fix is to explicitly assume that a,b,c are real.

Issue created by migration from https://trac.sagemath.org/ticket/12845





---

archive/issue_comments_151345.json:
```json
{
    "body": "Add assumptions and use simplify() instead of simplify_full().",
    "created_at": "2012-04-15T18:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151345",
    "user": "mjo"
}
```

Add assumptions and use simplify() instead of simplify_full().



---

archive/issue_comments_151346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-15T18:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151346",
    "user": "mjo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_151347.json:
```json
{
    "body": "Attachment [sage-trac_12845.patch](tarball://root/attachments/some-uuid/ticket12845/sage-trac_12845.patch) by mjo created at 2012-04-15 18:32:01",
    "created_at": "2012-04-15T18:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151347",
    "user": "mjo"
}
```

Attachment [sage-trac_12845.patch](tarball://root/attachments/some-uuid/ticket12845/sage-trac_12845.patch) by mjo created at 2012-04-15 18:32:01



---

archive/issue_comments_151348.json:
```json
{
    "body": "Should there also be another ticket for fixing the bug of the real assumption?",
    "created_at": "2012-04-16T00:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151348",
    "user": "novoselt"
}
```

Should there also be another ticket for fixing the bug of the real assumption?



---

archive/issue_comments_151349.json:
```json
{
    "body": "Replying to [comment:2 novoselt]:\n> Should there also be another ticket for fixing the bug of the real assumption?\n\nYes, there are at least two, #12737 and #12780. I separated this patch out because I wound up fixing the same doctest twice.\n\nThe first bug, \"fixed\" by #12737 is that `simplify_radical()` ignores the domain anyway and goes nuts. \"Simplify\" there is really a misnomer, so the fix that I settled on was to remove it from `simplify_full()`:\n\n\n```\nsage: bool(norm(v).simplify_radical() == sqrt(a^2 + b^2 + c^2))\nTrue\n```\n\n\nThe second more sneaky bug, #12780, is that `simplify_log()` sets the Maxima domain to `real` before it performs its simplifications. Thus,\n\n\n```\nsage: bool(norm(v).simplify_log() == sqrt(a^2 + b^2 + c^2))    \nTrue\n```\n\n\nI think the fix there is straightforward: don't do that. This was the only doctest affected by not setting the domain to `real` during `simplify_log()`.",
    "created_at": "2012-04-16T01:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151349",
    "user": "mjo"
}
```

Replying to [comment:2 novoselt]:
> Should there also be another ticket for fixing the bug of the real assumption?

Yes, there are at least two, #12737 and #12780. I separated this patch out because I wound up fixing the same doctest twice.

The first bug, "fixed" by #12737 is that `simplify_radical()` ignores the domain anyway and goes nuts. "Simplify" there is really a misnomer, so the fix that I settled on was to remove it from `simplify_full()`:


```
sage: bool(norm(v).simplify_radical() == sqrt(a^2 + b^2 + c^2))
True
```


The second more sneaky bug, #12780, is that `simplify_log()` sets the Maxima domain to `real` before it performs its simplifications. Thus,


```
sage: bool(norm(v).simplify_log() == sqrt(a^2 + b^2 + c^2))    
True
```


I think the fix there is straightforward: don't do that. This was the only doctest affected by not setting the domain to `real` during `simplify_log()`.



---

archive/issue_comments_151350.json:
```json
{
    "body": "Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...",
    "created_at": "2012-05-25T05:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151350",
    "user": "kcrisman"
}
```

Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...



---

archive/issue_comments_151351.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-25T15:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151351",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_151352.json:
```json
{
    "body": "Attachment [trac_12845-reviewer.patch](tarball://root/attachments/some-uuid/ticket12845/trac_12845-reviewer.patch) by kcrisman created at 2012-05-25 15:49:58\n\nApply sage-trac_12845.patch and trac_12845-reviewer.patch.",
    "created_at": "2012-05-25T15:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151352",
    "user": "kcrisman"
}
```

Attachment [trac_12845-reviewer.patch](tarball://root/attachments/some-uuid/ticket12845/trac_12845-reviewer.patch) by kcrisman created at 2012-05-25 15:49:58

Apply sage-trac_12845.patch and trac_12845-reviewer.patch.



---

archive/issue_comments_151353.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n> Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...\n\nYeah, thanks, I just forgot to add it.",
    "created_at": "2012-05-26T15:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151353",
    "user": "mjo"
}
```

Replying to [comment:5 kcrisman]:
> Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...

Yeah, thanks, I just forgot to add it.



---

archive/issue_comments_151354.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-05T11:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12673#issuecomment-151354",
    "user": "jdemeyer"
}
```

Resolution: fixed
