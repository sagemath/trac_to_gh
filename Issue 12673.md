# Issue 12673: Incorrect doctest in sage/misc/functional.py

Issue created by migration from Trac.

Original creator: mjo

Original creation time: 2012-04-15 18:26:33

Assignee: burcin

CC:  kcrisman

We currently have,


```
sage: a, b, c = var("a, b, c")
sage: v = vector([a, b, c])
sage: bool(norm(v).simplify_full() == sqrt(a^2 + b^2 + c^2))
True
```


which is true enough if a,b,c are real. The current doctest "works" because somewhere along the line, `simplify_full()` assumes that they're real. So in effect, this doctest is confirming incorrect behavior.

The proper fix is to explicitly assume that a,b,c are real.


---

Comment by mjo created at 2012-04-15 18:31:34

Add assumptions and use simplify() instead of simplify_full().


---

Comment by mjo created at 2012-04-15 18:32:01

Changing status from new to needs_review.


---

Attachment


---

Comment by novoselt created at 2012-04-16 00:52:02

Should there also be another ticket for fixing the bug of the real assumption?


---

Comment by mjo created at 2012-04-16 01:04:24

Replying to [comment:2 novoselt]:
> Should there also be another ticket for fixing the bug of the real assumption?

Yes, there are at least two, #12737 and #12780. I separated this patch out because I wound up fixing the same doctest twice.

The first bug, "fixed" by #12737 is that `simplify_radical()` ignores the domain anyway and goes nuts. "Simplify" there is really a misnomer, so the fix that I settled on was to remove it from `simplify_full()`:


```
sage: bool(norm(v).simplify_radical() == sqrt(a^2 + b^2 + c^2))
True
```


The second more sneaky bug, #12780, is that `simplify_log()` sets the Maxima domain to `real` before it performs its simplifications. Thus,


```
sage: bool(norm(v).simplify_log() == sqrt(a^2 + b^2 + c^2))    
True
```


I think the fix there is straightforward: don't do that. This was the only doctest affected by not setting the domain to `real` during `simplify_log()`.


---

Comment by kcrisman created at 2012-05-25 05:41:34

Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...


---

Comment by kcrisman created at 2012-05-25 15:49:58

Changing status from needs_review to positive_review.


---

Attachment

Apply sage-trac_12845.patch and trac_12845-reviewer.patch.


---

Comment by mjo created at 2012-05-26 15:53:32

Replying to [comment:5 kcrisman]:
> Do you have to `forget()` anything for doctests to work properly?  I think it's good form to do so at the end of any assumptions tests...

Yeah, thanks, I just forgot to add it.


---

Comment by jdemeyer created at 2012-06-05 11:53:49

Resolution: fixed
