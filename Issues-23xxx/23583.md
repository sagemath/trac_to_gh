# Issue 23583: py3: some more richcmp in schemes, rings, and combinat

archive/issues_023346.json:
```json
{
    "assignees": [],
    "body": "another step one our looong road to python3\n\n**CC:**  @tscrim @jdemeyer @jhpalmieri\n\n**Branch/Commit:** [e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/23583\n\n",
    "closed_at": "2017-08-21T19:24:06Z",
    "created_at": "2017-08-05T09:39:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: some more richcmp in schemes, rings, and combinat",
    "type": "issue",
    "updated_at": "2017-08-21T19:24:06Z",
    "url": "https://github.com/sagemath/sage/issues/23583",
    "user": "https://github.com/fchapoton"
}
```
another step one our looong road to python3

**CC:**  @tscrim @jdemeyer @jhpalmieri

**Branch/Commit:** [e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)

**Reviewer:** Travis Scrimshaw

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/23583





---

archive/issue_events_285169.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285169"
}
```



---

archive/issue_events_285170.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285170"
}
```



---

archive/issue_events_285171.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285171"
}
```



---

archive/issue_comments_357470.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3\">a13e1be</a></td><td><code>py3: a few more richcmp in species, rings and schemes</code></td></tr></table>\n",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357470",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>**Comment 1:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3">a13e1be</a></td><td><code>py3: a few more richcmp in species, rings and schemes</code></td></tr></table>




---

archive/issue_comments_357471.json:
```json
{
    "body": "**Commit:** [a13e1be80087097a69d1564ec47f75331f1309e3](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357471",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [a13e1be80087097a69d1564ec47f75331f1309e3](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)



---

archive/issue_events_285172.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:41:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285172"
}
```



---

archive/issue_comments_357472.json:
```json
{
    "body": "**Branch:** [u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357472",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)



---

archive/issue_comments_357473.json:
```json
{
    "body": "**Changing commit** from \"[a13e1be80087097a69d1564ec47f75331f1309e3](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)\" to \"[d4cbf615c76094ea4d84904ac85458757d8ae97a](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)\".",
    "created_at": "2017-08-05T15:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357473",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a13e1be80087097a69d1564ec47f75331f1309e3](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)" to "[d4cbf615c76094ea4d84904ac85458757d8ae97a](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)".



---

archive/issue_comments_357474.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a\">d4cbf61</a></td><td><code>trac 23583 fixing doctests</code></td></tr></table>\n",
    "created_at": "2017-08-05T15:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357474",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>**Comment 2:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a">d4cbf61</a></td><td><code>trac 23583 fixing doctests</code></td></tr></table>




---

archive/issue_comments_357475.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nI do not understand why this change is needed:\n\n```diff\n@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):\n \n         A = self.ambient_space()\n         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)\n-        C.sort()\n+        C.sort(key=lambda sch: sch.defining_polynomials())\n         C.set_immutable()\n         self.__irreducible_components = C\n         return C\n```\nOtherwise LGTM.",
    "created_at": "2017-08-06T05:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357475",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>**Comment 3:**</a>
I do not understand why this change is needed:

```diff
@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):
 
         A = self.ambient_space()
         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)
-        C.sort()
+        C.sort(key=lambda sch: sch.defining_polynomials())
         C.set_immutable()
         self.__irreducible_components = C
         return C
```
Otherwise LGTM.



---

archive/issue_comments_357476.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nThis is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.\n\nI do not quite understand why this is so, but this works.",
    "created_at": "2017-08-06T06:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357476",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'>**Comment 4:**</a>
This is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.

I do not quite understand why this is so, but this works.



---

archive/issue_comments_357477.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nI might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.\n\nAlso, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.",
    "created_at": "2017-08-06T15:19:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357477",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'>**Comment 5:**</a>
I might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.

Also, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.



---

archive/issue_comments_357478.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nI have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891\">e19d833</a></td><td><code>py3: richcmp for some files in combinat, rings and schemes folders</code></td></tr></table>\n",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357478",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'>**Comment 6:**</a>
I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891">e19d833</a></td><td><code>py3: richcmp for some files in combinat, rings and schemes folders</code></td></tr></table>




---

archive/issue_comments_357479.json:
```json
{
    "body": "**Changing commit** from \"[d4cbf615c76094ea4d84904ac85458757d8ae97a](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)\" to \"[e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)\".",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357479",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[d4cbf615c76094ea4d84904ac85458757d8ae97a](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)" to "[e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)".



---

archive/issue_comments_357480.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)\" to \"[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)\".",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357480",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)" to "[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)".



---

archive/issue_comments_357481.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-08-18T09:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357481",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_357482.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nReplying to [@fchapoton](#comment%3A6):\n> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).\n\nI am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.",
    "created_at": "2017-08-18T09:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357482",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>**Comment 7:**</a>
Replying to [@fchapoton](#comment%3A6):
> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).

I am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.



---

archive/issue_events_285173.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-18T09:23:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285173"
}
```



---

archive/issue_events_285174.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-18T09:23:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285174"
}
```



---

archive/issue_comments_357483.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)\" to \"[e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)\".",
    "created_at": "2017-08-21T19:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-357483",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)" to "[e19d83302fbad98926adb4ea5146971a9452b891](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)".



---

archive/issue_events_285175.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-21T19:24:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285175"
}
```



---

archive/issue_events_285176.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "aff66a3b3746d1759c95383a5b3f6cb25a1751a0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-21T19:24:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-285176"
}
```
