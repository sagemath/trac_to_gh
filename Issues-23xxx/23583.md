# Issue 23583: py3: some more richcmp in schemes, rings, and combinat

archive/issues_023346.json:
```json
{
    "assignees": [],
    "body": "another step one our looong road to python3\n\nCC:  @tscrim @jdemeyer @jhpalmieri\n\nBranch/Commit: **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23583_\n\n",
    "closed_at": "2017-08-21T19:24:06Z",
    "created_at": "2017-08-05T09:39:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: some more richcmp in schemes, rings, and combinat",
    "type": "issue",
    "updated_at": "2017-08-21T19:24:06Z",
    "url": "https://github.com/sagemath/sage/issues/23583",
    "user": "https://github.com/fchapoton"
}
```
another step one our looong road to python3

CC:  @tscrim @jdemeyer @jhpalmieri

Branch/Commit: **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**

Reviewer: **Travis Scrimshaw**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/23583_





---

archive/issue_events_329622.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329622"
}
```



---

archive/issue_events_329623.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329623"
}
```



---

archive/issue_events_329624.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329624"
}
```



---

archive/issue_events_329625.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329625"
}
```



---

archive/issue_comments_354843.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3\"><code>a13e1be</code></a></td><td><code>py3: a few more richcmp in species, rings and schemes</code></td></tr></table>\n",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354843",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3"><code>a13e1be</code></a></td><td><code>py3: a few more richcmp in species, rings and schemes</code></td></tr></table>




---

archive/issue_comments_354844.json:
```json
{
    "body": "Commit: **[`a13e1be`](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)**",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354844",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`a13e1be`](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)**



---

archive/issue_events_329626.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T09:41:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329626"
}
```



---

archive/issue_comments_354845.json:
```json
{
    "body": "Branch: **[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)**",
    "created_at": "2017-08-05T09:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354845",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)**



---

archive/issue_comments_354846.json:
```json
{
    "body": "Changed commit from **[`a13e1be`](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)** to **[`d4cbf61`](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)**",
    "created_at": "2017-08-05T15:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354846",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a13e1be`](https://github.com/sagemath/sagetrac-mirror/commit/a13e1be80087097a69d1564ec47f75331f1309e3)** to **[`d4cbf61`](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)**



---

archive/issue_comments_354847.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a\"><code>d4cbf61</code></a></td><td><code>trac 23583 fixing doctests</code></td></tr></table>\n",
    "created_at": "2017-08-05T15:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354847",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a"><code>d4cbf61</code></a></td><td><code>trac 23583 fixing doctests</code></td></tr></table>




---

archive/issue_comments_354848.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI do not understand why this change is needed:\n\n```diff\n@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):\n \n         A = self.ambient_space()\n         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)\n-        C.sort()\n+        C.sort(key=lambda sch: sch.defining_polynomials())\n         C.set_immutable()\n         self.__irreducible_components = C\n         return C\n```\nOtherwise LGTM.",
    "created_at": "2017-08-06T05:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354848",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

I do not understand why this change is needed:

```diff
@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):
 
         A = self.ambient_space()
         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)
-        C.sort()
+        C.sort(key=lambda sch: sch.defining_polynomials())
         C.set_immutable()
         self.__irreducible_components = C
         return C
```
Otherwise LGTM.



---

archive/issue_comments_354849.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.\n\nI do not quite understand why this is so, but this works.",
    "created_at": "2017-08-06T06:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354849",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

This is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.

I do not quite understand why this is so, but this works.



---

archive/issue_comments_354850.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.\n\nAlso, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.",
    "created_at": "2017-08-06T15:19:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354850",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.

Also, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.



---

archive/issue_comments_354851.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891\"><code>e19d833</code></a></td><td><code>py3: richcmp for some files in combinat, rings and schemes folders</code></td></tr></table>\n",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354851",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891"><code>e19d833</code></a></td><td><code>py3: richcmp for some files in combinat, rings and schemes folders</code></td></tr></table>




---

archive/issue_comments_354852.json:
```json
{
    "body": "Changed commit from **[`d4cbf61`](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)** to **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354852",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`d4cbf61`](https://github.com/sagemath/sagetrac-mirror/commit/d4cbf615c76094ea4d84904ac85458757d8ae97a)** to **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**



---

archive/issue_comments_354853.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)** to **[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)**",
    "created_at": "2017-08-18T06:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354853",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/chapoton/23583](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583)** to **[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)**



---

archive/issue_comments_354854.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-08-18T09:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354854",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_354855.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@fchapoton](#comment:6):\n> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).\n\nI am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.",
    "created_at": "2017-08-18T09:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354855",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@fchapoton](#comment:6):
> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).

I am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.



---

archive/issue_events_329627.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-18T09:23:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329627"
}
```



---

archive/issue_events_329628.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-18T09:23:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329628"
}
```



---

archive/issue_comments_354856.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)** to **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**",
    "created_at": "2017-08-21T19:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23583#issuecomment-354856",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/23583_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23583_bare)** to **[`e19d833`](https://github.com/sagemath/sagetrac-mirror/commit/e19d83302fbad98926adb4ea5146971a9452b891)**



---

archive/issue_events_329629.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-21T19:24:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329629"
}
```



---

archive/issue_events_329630.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "aff66a3b3746d1759c95383a5b3f6cb25a1751a0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-21T19:24:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23583",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23583#event-329630"
}
```
