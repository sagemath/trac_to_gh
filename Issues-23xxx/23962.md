# Issue 23962: rank() of elliptic curves should always consult Cremona database

archive/issues_023725.json:
```json
{
    "body": "\n```\nsage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\nsage: E2 = EllipticCurve('571a1')\nsage: E2.rank()\nUnable to compute the rank with certainty (lower bound=0).\nThis could be because Sha(E/Q)[2] is nontrivial.\nTry calling something like two_descent(second_limit=13) on the\ncurve then trying this command again.  You could also try rank\nwith only_use_mwrank=False.\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-3-d3aae2f31e01> in <module>()\n----> 1 E2.rank()\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n   2119                     print(\"with only_use_mwrank=False.\")\n   2120                     del E.__mwrank_curve\n-> 2121                     raise RuntimeError('Rank not provably correct.')\n   2122                 else:\n   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n\nRuntimeError: Rank not provably correct.\n```\n\nThe problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n\nThe solution seems easy: **always** look up the rank of elliptic curves in the database.\n\nI am also simplifying and cleaning up the implementation of `rank()` a bit.\n\n---\n\nThis ticket leads to random doctest failures (which is how this was originally reported):\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/sha_tate.py\", line 915, in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound\nFailed example:\n    sh.two_selmer_bound()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound[1]>\", line 1, in <module>\n        sh.two_selmer_bound()\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 934, in two_selmer_bound\n        r = E.rank()\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2121, in rank\n        raise RuntimeError('Rank not provably correct.')\n    RuntimeError: Rank not provably correct.\n**********************************************************************\n1 item had failures:\n   1 of  10 in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound\n    [155 tests, 1 failure, 55.87 s]\n```\n\n**CC:**  @JohnCremona\n\n**Branch/Commit:** [3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)\n\n**Reviewer:** Maarten Derickx, John Cremona\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/23962\n\n",
    "closed_at": "2017-10-15T09:22:29Z",
    "created_at": "2017-10-03T22:18:39Z",
    "labels": [
        "component: elliptic curves",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "rank() of elliptic curves should always consult Cremona database",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23962",
    "user": "https://github.com/koffie"
}
```

```
sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
sage: E2 = EllipticCurve('571a1')
sage: E2.rank()
Unable to compute the rank with certainty (lower bound=0).
This could be because Sha(E/Q)[2] is nontrivial.
Try calling something like two_descent(second_limit=13) on the
curve then trying this command again.  You could also try rank
with only_use_mwrank=False.
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-3-d3aae2f31e01> in <module>()
----> 1 E2.rank()

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
   2119                     print("with only_use_mwrank=False.")
   2120                     del E.__mwrank_curve
-> 2121                     raise RuntimeError('Rank not provably correct.')
   2122                 else:
   2123                     misc.verbose("Warning -- rank not proven correct", level=1)

RuntimeError: Rank not provably correct.
```

The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.

The solution seems easy: **always** look up the rank of elliptic curves in the database.

I am also simplifying and cleaning up the implementation of `rank()` a bit.

---

This ticket leads to random doctest failures (which is how this was originally reported):

```
sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/sha_tate.py", line 915, in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound
Failed example:
    sh.two_selmer_bound()
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound[1]>", line 1, in <module>
        sh.two_selmer_bound()
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 934, in two_selmer_bound
        r = E.rank()
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 2121, in rank
        raise RuntimeError('Rank not provably correct.')
    RuntimeError: Rank not provably correct.
**********************************************************************
1 item had failures:
   1 of  10 in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound
    [155 tests, 1 failure, 55.87 s]
```

**CC:**  @JohnCremona

**Branch/Commit:** [3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)

**Reviewer:** Maarten Derickx, John Cremona

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/23962





---

archive/issue_comments_432475.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis might come from #23544.",
    "created_at": "2017-10-04T01:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432475",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
This might come from #23544.



---

archive/issue_comments_432476.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short), it is probably one of the dependencies of #23881 where it is introduced see  [ticket:23881#comment:52  the discussion starting at comment 52].\n+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T09:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432476",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short), it is probably one of the dependencies of #23881 where it is introduced see  [ticket:23881#comment:52  the discussion starting at comment 52].
+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_comments_432477.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [tscrim](#comment%3A1):\n> This might come from #23544.\n\n\nI don't think so. I was reported om sage-release to fail on Sage 8.1.beta7.\n\nThe code seems to involve the Cremona database and the `eclib` library, not PARI/GP.\n\nI don't understand the failure though: the curve is contained in the small Cremona database which is installed by default. So the rank should just be read from the database.",
    "created_at": "2017-10-04T09:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432477",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Replying to [tscrim](#comment%3A1):
> This might come from #23544.


I don't think so. I was reported om sage-release to fail on Sage 8.1.beta7.

The code seems to involve the Cremona database and the `eclib` library, not PARI/GP.

I don't understand the failure though: the curve is contained in the small Cremona database which is installed by default. So the rank should just be read from the database.



---

archive/issue_events_069623.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "rename": {
        "from": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py",
        "to": "Uniqueness of elliptic curves causes data not to be read from Cremona database"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69623"
}
```



---

archive/issue_comments_432478.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,31 @@\n-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n+\n+```\n+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n+sage: E2 = EllipticCurve('571a1')\n+sage: E2.rank()\n+Unable to compute the rank with certainty (lower bound=0).\n+This could be because Sha(E/Q)[2] is nontrivial.\n+Try calling something like two_descent(second_limit=13) on the\n+curve then trying this command again.  You could also try rank\n+with only_use_mwrank=False.\n+---------------------------------------------------------------------------\n+RuntimeError                              Traceback (most recent call last)\n+<ipython-input-3-d3aae2f31e01> in <module>()\n+----> 1 E2.rank()\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n+   2119                     print(\"with only_use_mwrank=False.\")\n+   2120                     del E.__mwrank_curve\n+-> 2121                     raise RuntimeError('Rank not provably correct.')\n+   2122                 else:\n+   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n+\n+RuntimeError: Rank not provably correct.\n+```\n+\n+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n+\n+This leads to random doctest failures:\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432478",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,31 @@
-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
+
+```
+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
+sage: E2 = EllipticCurve('571a1')
+sage: E2.rank()
+Unable to compute the rank with certainty (lower bound=0).
+This could be because Sha(E/Q)[2] is nontrivial.
+Try calling something like two_descent(second_limit=13) on the
+curve then trying this command again.  You could also try rank
+with only_use_mwrank=False.
+---------------------------------------------------------------------------
+RuntimeError                              Traceback (most recent call last)
+<ipython-input-3-d3aae2f31e01> in <module>()
+----> 1 E2.rank()
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
+   2119                     print("with only_use_mwrank=False.")
+   2120                     del E.__mwrank_curve
+-> 2121                     raise RuntimeError('Rank not provably correct.')
+   2122                 else:
+   2123                     misc.verbose("Warning -- rank not proven correct", level=1)
+
+RuntimeError: Rank not provably correct.
+```
+
+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.
+
+This leads to random doctest failures:
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_comments_432479.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2017-10-04T10:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432479",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_432480.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,31 +1,4 @@\n-\n-```\n-sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n-sage: E2 = EllipticCurve('571a1')\n-sage: E2.rank()\n-Unable to compute the rank with certainty (lower bound=0).\n-This could be because Sha(E/Q)[2] is nontrivial.\n-Try calling something like two_descent(second_limit=13) on the\n-curve then trying this command again.  You could also try rank\n-with only_use_mwrank=False.\n----------------------------------------------------------------------------\n-RuntimeError                              Traceback (most recent call last)\n-<ipython-input-3-d3aae2f31e01> in <module>()\n-----> 1 E2.rank()\n-\n-/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n-   2119                     print(\"with only_use_mwrank=False.\")\n-   2120                     del E.__mwrank_curve\n--> 2121                     raise RuntimeError('Rank not provably correct.')\n-   2122                 else:\n-   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n-\n-RuntimeError: Rank not provably correct.\n-```\n-\n-The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n-\n-This leads to random doctest failures:\n+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432480",
    "user": "https://github.com/koffie"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,31 +1,4 @@
-
-```
-sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
-sage: E2 = EllipticCurve('571a1')
-sage: E2.rank()
-Unable to compute the rank with certainty (lower bound=0).
-This could be because Sha(E/Q)[2] is nontrivial.
-Try calling something like two_descent(second_limit=13) on the
-curve then trying this command again.  You could also try rank
-with only_use_mwrank=False.
----------------------------------------------------------------------------
-RuntimeError                              Traceback (most recent call last)
-<ipython-input-3-d3aae2f31e01> in <module>()
-----> 1 E2.rank()
-
-/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
-   2119                     print("with only_use_mwrank=False.")
-   2120                     del E.__mwrank_curve
--> 2121                     raise RuntimeError('Rank not provably correct.')
-   2122                 else:
-   2123                     misc.verbose("Warning -- rank not proven correct", level=1)
-
-RuntimeError: Rank not provably correct.
-```
-
-The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.
-
-This leads to random doctest failures:
+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_comments_432481.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe rank should, but maybe the two_selmer_bound which might be different from the rank is not read from the database.",
    "created_at": "2017-10-04T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432481",
    "user": "https://github.com/koffie"
}
```

<a id='comment:4'></a>
The rank should, but maybe the two_selmer_bound which might be different from the rank is not read from the database.



---

archive/issue_events_069624.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "rename": {
        "from": "Uniqueness of elliptic curves causes data not to be read from Cremona database",
        "to": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69624"
}
```



---

archive/issue_comments_432482.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer\" to \"\".",
    "created_at": "2017-10-04T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432482",
    "user": "https://github.com/koffie"
}
```

**Changing author** from "Jeroen Demeyer" to "".



---

archive/issue_comments_432483.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,31 @@\n-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n+\n+```\n+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n+sage: E2 = EllipticCurve('571a1')\n+sage: E2.rank()\n+Unable to compute the rank with certainty (lower bound=0).\n+This could be because Sha(E/Q)[2] is nontrivial.\n+Try calling something like two_descent(second_limit=13) on the\n+curve then trying this command again.  You could also try rank\n+with only_use_mwrank=False.\n+---------------------------------------------------------------------------\n+RuntimeError                              Traceback (most recent call last)\n+<ipython-input-3-d3aae2f31e01> in <module>()\n+----> 1 E2.rank()\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n+   2119                     print(\"with only_use_mwrank=False.\")\n+   2120                     del E.__mwrank_curve\n+-> 2121                     raise RuntimeError('Rank not provably correct.')\n+   2122                 else:\n+   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n+\n+RuntimeError: Rank not provably correct.\n+```\n+\n+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n+\n+This leads to random doctest failures:\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432483",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,31 @@
-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
+
+```
+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
+sage: E2 = EllipticCurve('571a1')
+sage: E2.rank()
+Unable to compute the rank with certainty (lower bound=0).
+This could be because Sha(E/Q)[2] is nontrivial.
+Try calling something like two_descent(second_limit=13) on the
+curve then trying this command again.  You could also try rank
+with only_use_mwrank=False.
+---------------------------------------------------------------------------
+RuntimeError                              Traceback (most recent call last)
+<ipython-input-3-d3aae2f31e01> in <module>()
+----> 1 E2.rank()
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
+   2119                     print("with only_use_mwrank=False.")
+   2120                     del E.__mwrank_curve
+-> 2121                     raise RuntimeError('Rank not provably correct.')
+   2122                 else:
+   2123                     misc.verbose("Warning -- rank not proven correct", level=1)
+
+RuntimeError: Rank not provably correct.
+```
+
+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.
+
+This leads to random doctest failures:
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_events_069625.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "rename": {
        "from": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py",
        "to": "Uniqueness of elliptic curves causes data not to be read from Cremona database"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69625"
}
```



---

archive/issue_comments_432484.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2017-10-04T10:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432484",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_432485.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer\" to \"\".",
    "created_at": "2017-10-04T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432485",
    "user": "https://github.com/koffie"
}
```

**Changing author** from "Jeroen Demeyer" to "".



---

archive/issue_comments_432486.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,31 +1,4 @@\n-\n-```\n-sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n-sage: E2 = EllipticCurve('571a1')\n-sage: E2.rank()\n-Unable to compute the rank with certainty (lower bound=0).\n-This could be because Sha(E/Q)[2] is nontrivial.\n-Try calling something like two_descent(second_limit=13) on the\n-curve then trying this command again.  You could also try rank\n-with only_use_mwrank=False.\n----------------------------------------------------------------------------\n-RuntimeError                              Traceback (most recent call last)\n-<ipython-input-3-d3aae2f31e01> in <module>()\n-----> 1 E2.rank()\n-\n-/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n-   2119                     print(\"with only_use_mwrank=False.\")\n-   2120                     del E.__mwrank_curve\n--> 2121                     raise RuntimeError('Rank not provably correct.')\n-   2122                 else:\n-   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n-\n-RuntimeError: Rank not provably correct.\n-```\n-\n-The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n-\n-This leads to random doctest failures:\n+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432486",
    "user": "https://github.com/koffie"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,31 +1,4 @@
-
-```
-sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
-sage: E2 = EllipticCurve('571a1')
-sage: E2.rank()
-Unable to compute the rank with certainty (lower bound=0).
-This could be because Sha(E/Q)[2] is nontrivial.
-Try calling something like two_descent(second_limit=13) on the
-curve then trying this command again.  You could also try rank
-with only_use_mwrank=False.
----------------------------------------------------------------------------
-RuntimeError                              Traceback (most recent call last)
-<ipython-input-3-d3aae2f31e01> in <module>()
-----> 1 E2.rank()
-
-/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
-   2119                     print("with only_use_mwrank=False.")
-   2120                     del E.__mwrank_curve
--> 2121                     raise RuntimeError('Rank not provably correct.')
-   2122                 else:
-   2123                     misc.verbose("Warning -- rank not proven correct", level=1)
-
-RuntimeError: Rank not provably correct.
-```
-
-The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.
-
-This leads to random doctest failures:
+On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_comments_432487.json:
```json
{
    "body": "<a id='comment:6'></a>\nSorry ignore my last comment, I should have read the full traceback",
    "created_at": "2017-10-04T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432487",
    "user": "https://github.com/koffie"
}
```

<a id='comment:6'></a>
Sorry ignore my last comment, I should have read the full traceback



---

archive/issue_events_069626.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "rename": {
        "from": "Uniqueness of elliptic curves causes data not to be read from Cremona database",
        "to": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69626"
}
```



---

archive/issue_comments_432488.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,35 @@\n-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::\n+\n+```\n+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n+sage: E2 = EllipticCurve('571a1')\n+sage: E2.rank()\n+Unable to compute the rank with certainty (lower bound=0).\n+This could be because Sha(E/Q)[2] is nontrivial.\n+Try calling something like two_descent(second_limit=13) on the\n+curve then trying this command again.  You could also try rank\n+with only_use_mwrank=False.\n+---------------------------------------------------------------------------\n+RuntimeError                              Traceback (most recent call last)\n+<ipython-input-3-d3aae2f31e01> in <module>()\n+----> 1 E2.rank()\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)\n+   2119                     print(\"with only_use_mwrank=False.\")\n+   2120                     del E.__mwrank_curve\n+-> 2121                     raise RuntimeError('Rank not provably correct.')\n+   2122                 else:\n+   2123                     misc.verbose(\"Warning -- rank not proven correct\", level=1)\n+\n+RuntimeError: Rank not provably correct.\n+```\n+\n+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.\n+\n+The solution seems easy: **always** look up the rank of elliptic curves in the database.\n+\n+---\n+\n+This ticket to random doctest failures (which is how this was originally reported):\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432488",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,35 @@
-On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short)::
+
+```
+sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
+sage: E2 = EllipticCurve('571a1')
+sage: E2.rank()
+Unable to compute the rank with certainty (lower bound=0).
+This could be because Sha(E/Q)[2] is nontrivial.
+Try calling something like two_descent(second_limit=13) on the
+curve then trying this command again.  You could also try rank
+with only_use_mwrank=False.
+---------------------------------------------------------------------------
+RuntimeError                              Traceback (most recent call last)
+<ipython-input-3-d3aae2f31e01> in <module>()
+----> 1 E2.rank()
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in rank(self, use_database, verbose, only_use_mwrank, algorithm, proof)
+   2119                     print("with only_use_mwrank=False.")
+   2120                     del E.__mwrank_curve
+-> 2121                     raise RuntimeError('Rank not provably correct.')
+   2122                 else:
+   2123                     misc.verbose("Warning -- rank not proven correct", level=1)
+
+RuntimeError: Rank not provably correct.
+```
+
+The problem is that `E1` and `E2` are the same curve, but constructed in a different way. When the first line is removed, the rank computation works. The reason is that `EllipticCurve('571a1')` looks up the elliptic curve in the Cremona database (which includes the fact that the rank is 0) but **only if the curve does not exist already**.
+
+The solution seems easy: **always** look up the rank of elliptic curves in the database.
+
+---
+
+This ticket to random doctest failures (which is how this was originally reported):
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_events_069627.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "rename": {
        "from": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py",
        "to": "rank() of elliptic curves should always consult Cremona database"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69627"
}
```



---

archive/issue_comments_432489.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2017-10-04T10:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432489",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_432490.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -27,6 +27,8 @@\n \n The solution seems easy: **always** look up the rank of elliptic curves in the database.\n \n+I am also simplifying and cleaning up the implementation of `rank()` a bit.\n+\n ---\n \n This ticket to random doctest failures (which is how this was originally reported):\n``````\n",
    "created_at": "2017-10-04T10:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432490",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -27,6 +27,8 @@
 
 The solution seems easy: **always** look up the rank of elliptic curves in the database.
 
+I am also simplifying and cleaning up the implementation of `rank()` a bit.
+
 ---
 
 This ticket to random doctest failures (which is how this was originally reported):
``````




---

archive/issue_comments_432491.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -31,7 +31,7 @@\n \n ---\n \n-This ticket to random doctest failures (which is how this was originally reported):\n+This ticket leads to random doctest failures (which is how this was originally reported):\n \n ```\n sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n``````\n",
    "created_at": "2017-10-04T10:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432491",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -31,7 +31,7 @@
 
 ---
 
-This ticket to random doctest failures (which is how this was originally reported):
+This ticket leads to random doctest failures (which is how this was originally reported):
 
 ```
 sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
``````




---

archive/issue_comments_432492.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)",
    "created_at": "2017-10-04T11:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432492",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)



---

archive/issue_comments_432493.json:
```json
{
    "body": "**Commit:** [96765dc2be80e53bee137853ebf85ec9e40681c1](https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1)",
    "created_at": "2017-10-04T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432493",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [96765dc2be80e53bee137853ebf85ec9e40681c1](https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1)



---

archive/issue_comments_432494.json:
```json
{
    "body": "<a id='comment:11'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1\">96765dc</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>\n",
    "created_at": "2017-10-04T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432494",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1">96765dc</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>




---

archive/issue_comments_432495.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-10-04T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432495",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_432496.json:
```json
{
    "body": "<a id='comment:12'></a>\nAs far as I can tell :\n\n* `EllipticCurve` is standard\n* therefore, *<some elliptic_curve>*`.rank()` is also standard\n* `database_cremona_ellcurve` is optional\n\nIf you wish to *always* consult Cremona database in any case, `database_cremona_ellcurve` should become standard.\n\nUnless I am gravely mistaken, of course...",
    "created_at": "2017-10-04T13:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432496",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:12'></a>
As far as I can tell :

* `EllipticCurve` is standard
* therefore, *<some elliptic_curve>*`.rank()` is also standard
* `database_cremona_ellcurve` is optional

If you wish to *always* consult Cremona database in any case, `database_cremona_ellcurve` should become standard.

Unless I am gravely mistaken, of course...



---

archive/issue_comments_432497.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2017-10-04T13:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432497",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_432498.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [charpent](#comment%3A12):\n> If you wish to *always* consult Cremona database in any case\n\n\nThere is a small database which is standard. So consulting \"the\" Cremona database really means: the large one if that's installed, otherwise the small one.\n\nAlso, I'm not saying that consulting always must succeed. The code to get the rank from the database is wrapped in a `try:`/`except LookupError:` block and I'm not changing that.",
    "created_at": "2017-10-04T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [charpent](#comment%3A12):
> If you wish to *always* consult Cremona database in any case


There is a small database which is standard. So consulting "the" Cremona database really means: the large one if that's installed, otherwise the small one.

Also, I'm not saying that consulting always must succeed. The code to get the rank from the database is wrapped in a `try:`/`except LookupError:` block and I'm not changing that.



---

archive/issue_comments_432499.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2017-10-04T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432499",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_432500.json:
```json
{
    "body": "<a id='comment:14'></a>\nA couple of comments.\n\n1. When the new output incudes something like \"(guess = 0)\" it is not a guess, it is a proved lower bound.  (Not saying a lot if it is zero, but it can be positive).   Please change \"guess\" to \"lower bound\".\n\n2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.  I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.  How does this behave now?",
    "created_at": "2017-10-04T14:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432500",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
A couple of comments.

1. When the new output incudes something like "(guess = 0)" it is not a guess, it is a proved lower bound.  (Not saying a lot if it is zero, but it can be positive).   Please change "guess" to "lower bound".

2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.  I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.  How does this behave now?



---

archive/issue_comments_432501.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [cremona](#comment%3A14):\n>    2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.\n\n\nThis is just a simplification. I found the code dealing with the dict rather complicated. A simple tuple `(rank, proven)` does the job too.",
    "created_at": "2017-10-04T14:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432501",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [cremona](#comment%3A14):
>    2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.


This is just a simplification. I found the code dealing with the dict rather complicated. A simple tuple `(rank, proven)` does the job too.



---

archive/issue_comments_432502.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [cremona](#comment%3A14):\n> I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.\n\n\nNeither the old nor the new code deals with that. But you are right that it should.",
    "created_at": "2017-10-04T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432502",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [cremona](#comment%3A14):
> I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.


Neither the old nor the new code deals with that. But you are right that it should.



---

archive/issue_comments_432503.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-10-04T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432503",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_432504.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a\">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>\n",
    "created_at": "2017-10-04T15:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>




---

archive/issue_comments_432505.json:
```json
{
    "body": "**Changing commit** from \"[96765dc2be80e53bee137853ebf85ec9e40681c1](https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1)\" to \"[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)\".",
    "created_at": "2017-10-04T15:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[96765dc2be80e53bee137853ebf85ec9e40681c1](https://github.com/sagemath/sagetrac-mirror/commit/96765dc2be80e53bee137853ebf85ec9e40681c1)" to "[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)".



---

archive/issue_comments_432506.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-10-04T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432506",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_432507.json:
```json
{
    "body": "<a id='comment:18'></a>\nFixed the caching of non-proven output from `eclib` and the exception message.",
    "created_at": "2017-10-04T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432507",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Fixed the caching of non-proven output from `eclib` and the exception message.



---

archive/issue_comments_432508.json:
```json
{
    "body": "<a id='comment:19'></a>\nHi Jeroen, \n\nVery nice that you found out the cause. I'm trying to see the link to your example and the doctest failure. Because your example fails 100% of the time while the doctest only fails sporadically. Is the explanation that the curve E1 is actually already created on\nline 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?\n\nIn the mean time I was able to replicate the doctest failure on arando. I needed to test it with `sage -t --global-iterations 1000` before an error showed up. It started failing on the 775th iteration and then it kept failing until the 798th doctest. This might indicate that the randomness might depend on the system load (objects being garbage collected sooner maybe).\n\nP.s. I think it would be good to add the doctest:\n\n```\n    sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n    sage: E2 = EllipticCurve('571a1')\n    sage: E2.rank()\n    0\n```\nat the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a\">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>\n",
    "created_at": "2017-10-04T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432508",
    "user": "https://github.com/koffie"
}
```

<a id='comment:19'></a>
Hi Jeroen, 

Very nice that you found out the cause. I'm trying to see the link to your example and the doctest failure. Because your example fails 100% of the time while the doctest only fails sporadically. Is the explanation that the curve E1 is actually already created on
line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?

In the mean time I was able to replicate the doctest failure on arando. I needed to test it with `sage -t --global-iterations 1000` before an error showed up. It started failing on the 775th iteration and then it kept failing until the 798th doctest. This might indicate that the randomness might depend on the system load (objects being garbage collected sooner maybe).

P.s. I think it would be good to add the doctest:

```
    sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
    sage: E2 = EllipticCurve('571a1')
    sage: E2.rank()
    0
```
at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr></table>




---

archive/issue_comments_432509.json:
```json
{
    "body": "<a id='comment:20'></a>\nTHanks!   Positive review once tests pass and Maarten is happy.",
    "created_at": "2017-10-04T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432509",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'></a>
THanks!   Positive review once tests pass and Maarten is happy.



---

archive/issue_comments_432510.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mderickx](#comment%3A19):\n> Is the explanation that the curve E1 is actually already created on\n> line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?\n\n\nExactly.",
    "created_at": "2017-10-04T15:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432510",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [mderickx](#comment%3A19):
> Is the explanation that the curve E1 is actually already created on
> line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?


Exactly.



---

archive/issue_comments_432511.json:
```json
{
    "body": "<a id='comment:22'></a>\nFYI, a `make ptestlong` started *before* Cremona's [ticket:23962#comment:14 comment] passed with no errors whatsoever.\n\nIt seems to me that [ticket:23962#comment:20 comment 20] implies yet another patch-push-test cycle. I'll refrain from `ptest`ing it until that.",
    "created_at": "2017-10-04T15:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432511",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:22'></a>
FYI, a `make ptestlong` started *before* Cremona's [ticket:23962#comment:14 comment] passed with no errors whatsoever.

It seems to me that [ticket:23962#comment:20 comment 20] implies yet another patch-push-test cycle. I'll refrain from `ptest`ing it until that.



---

archive/issue_comments_432512.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mderickx](#comment%3A19):\n> I think it would be good to add the doctest:\n> \n> ```\n>     sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n>     sage: E2 = EllipticCurve('571a1')\n>     sage: E2.rank()\n>     0\n> ```\n> at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.\n\n\nThat's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.\n\n(*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!",
    "created_at": "2017-10-04T15:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432512",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [mderickx](#comment%3A19):
> I think it would be good to add the doctest:
> 
> ```
>     sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
>     sage: E2 = EllipticCurve('571a1')
>     sage: E2.rank()
>     0
> ```
> at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.


That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.

(*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!



---

archive/issue_comments_432513.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jdemeyer](#comment%3A23):\n> \n> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!\n\n\nWe are working on an api for the LMFDB which would make it easy to get all this data (and more) using only an internet connection, making the optional database almost redundant.",
    "created_at": "2017-10-04T15:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432513",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>
Replying to [jdemeyer](#comment%3A23):
> 
> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!


We are working on an api for the LMFDB which would make it easy to get all this data (and more) using only an internet connection, making the optional database almost redundant.



---

archive/issue_comments_432514.json:
```json
{
    "body": "<a id='comment:25'></a>\n> That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.\n> \n> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!\n\n\nThanks for this explanation, the test itself suffices, and I am happy with the rest of the code (although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency).\n\nI would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).",
    "created_at": "2017-10-04T16:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432514",
    "user": "https://github.com/koffie"
}
```

<a id='comment:25'></a>
> That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.
> 
> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!


Thanks for this explanation, the test itself suffices, and I am happy with the rest of the code (although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency).

I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).



---

archive/issue_comments_432515.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mderickx](#comment%3A25):\n> although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency.\n\n\nThat's true but I wanted to leave that for a separate ticket.\n\n> I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).\n\n\nOK. Does this ticket have positive review from you apart from that documentation issue?",
    "created_at": "2017-10-05T08:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432515",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [mderickx](#comment%3A25):
> although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency.


That's true but I wanted to leave that for a separate ticket.

> I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).


OK. Does this ticket have positive review from you apart from that documentation issue?



---

archive/issue_comments_432516.json:
```json
{
    "body": "**Changing commit** from \"[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)\" to \"[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)\".",
    "created_at": "2017-10-05T08:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)" to "[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)".



---

archive/issue_comments_432517.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76\">7b9206c</a></td><td><code>Show that rank is known when constructing curve from database</code></td></tr></table>\n",
    "created_at": "2017-10-05T08:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76">7b9206c</a></td><td><code>Show that rank is known when constructing curve from database</code></td></tr></table>




---

archive/issue_comments_432518.json:
```json
{
    "body": "<a id='comment:28'></a>\nI added a small extra test. Is this what you had in mind?",
    "created_at": "2017-10-05T08:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432518",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
I added a small extra test. Is this what you had in mind?



---

archive/issue_comments_432519.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)\" to \"[public/23962](https://github.com/sagemath/sagetrac-mirror/tree/public/23962)\".",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432519",
    "user": "https://github.com/koffie"
}
```

**Changing branch** from "[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)" to "[public/23962](https://github.com/sagemath/sagetrac-mirror/tree/public/23962)".



---

archive/issue_comments_432520.json:
```json
{
    "body": "**Changing commit** from \"[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)\" to \"[48eaa0aa8c3573e266d6264e04b0cf9eeda873cb](https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb)\".",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432520",
    "user": "https://github.com/koffie"
}
```

**Changing commit** from "[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)" to "[48eaa0aa8c3573e266d6264e04b0cf9eeda873cb](https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb)".



---

archive/issue_comments_432521.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Maarten Derickx\".",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432521",
    "user": "https://github.com/koffie"
}
```

**Changing author** from "Jeroen Demeyer" to "Jeroen Demeyer, Maarten Derickx".



---

archive/issue_comments_432522.json:
```json
{
    "body": "**Reviewer:** Maarten Derickx",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432522",
    "user": "https://github.com/koffie"
}
```

**Reviewer:** Maarten Derickx



---

archive/issue_comments_432523.json:
```json
{
    "body": "<a id='comment:29'></a>\nThe change I had in mind was slightly different. I agree with the code you have written till now, so that part gets positive review from me. Do you agree with my added extra explanation in the test?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb\">48eaa0a</a></td><td><code>Trac #23962: explain why we use database by default</code></td></tr></table>\n",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432523",
    "user": "https://github.com/koffie"
}
```

<a id='comment:29'></a>
The change I had in mind was slightly different. I agree with the code you have written till now, so that part gets positive review from me. Do you agree with my added extra explanation in the test?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb">48eaa0a</a></td><td><code>Trac #23962: explain why we use database by default</code></td></tr></table>




---

archive/issue_comments_432524.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-10-05T12:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432524",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_432525.json:
```json
{
    "body": "<a id='comment:30'></a>\nThe fact that \"Elliptic curves are globally unique even if they are initialized differently\" is already tested in `src/sage/schemes/elliptic_curves/constructor.py`\n\nSo there is no need for the extra test\n\n```\n        Elliptic curves are globally unique even if they are initialized differently::\n\n            sage: E1 = EllipticCurve([-517, -4528])\n            sage: E2 = EllipticCurve('1888b1')\n            sage: E1 is E2\n            True\n```",
    "created_at": "2017-10-05T12:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432525",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
The fact that "Elliptic curves are globally unique even if they are initialized differently" is already tested in `src/sage/schemes/elliptic_curves/constructor.py`

So there is no need for the extra test

```
        Elliptic curves are globally unique even if they are initialized differently::

            sage: E1 = EllipticCurve([-517, -4528])
            sage: E2 = EllipticCurve('1888b1')
            sage: E1 is E2
            True
```



---

archive/issue_comments_432526.json:
```json
{
    "body": "<a id='comment:31'></a>\nYes, I know, but I like my doctest to tell a story, this is mainly an example leading up to the explanatory text coming after it.",
    "created_at": "2017-10-05T13:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432526",
    "user": "https://github.com/koffie"
}
```

<a id='comment:31'></a>
Yes, I know, but I like my doctest to tell a story, this is mainly an example leading up to the explanatory text coming after it.



---

archive/issue_comments_432527.json:
```json
{
    "body": "<a id='comment:32'></a>\nOK, fine. Could you just remove the duplicate blank line and limit your lines to 72 characters in length?",
    "created_at": "2017-10-05T14:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
OK, fine. Could you just remove the duplicate blank line and limit your lines to 72 characters in length?



---

archive/issue_comments_432528.json:
```json
{
    "body": "<a id='comment:33'></a>\nIn order to move forward with this blocker ticket, I suggest to merge the code here and move the discussion about the docs to a new ticket: #23974\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a\">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76\">7b9206c</a></td><td><code>Show that rank is known when constructing curve from database</code></td></tr></table>\n",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432528",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
In order to move forward with this blocker ticket, I suggest to merge the code here and move the discussion about the docs to a new ticket: #23974

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a">3cff14c</a></td><td><code>rank() of elliptic curves should always consult Cremona database</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76">7b9206c</a></td><td><code>Show that rank is known when constructing curve from database</code></td></tr></table>




---

archive/issue_comments_432529.json:
```json
{
    "body": "**Changing branch** from \"[public/23962](https://github.com/sagemath/sagetrac-mirror/tree/public/23962)\" to \"[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)\".",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432529",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[public/23962](https://github.com/sagemath/sagetrac-mirror/tree/public/23962)" to "[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)".



---

archive/issue_comments_432530.json:
```json
{
    "body": "**Changing commit** from \"[48eaa0aa8c3573e266d6264e04b0cf9eeda873cb](https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb)\" to \"[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)\".",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432530",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[48eaa0aa8c3573e266d6264e04b0cf9eeda873cb](https://github.com/sagemath/sagetrac-mirror/commit/48eaa0aa8c3573e266d6264e04b0cf9eeda873cb)" to "[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)".



---

archive/issue_comments_432531.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer, Maarten Derickx\" to \"Jeroen Demeyer\".",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432531",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Jeroen Demeyer, Maarten Derickx" to "Jeroen Demeyer".



---

archive/issue_comments_432532.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432532",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_432533.json:
```json
{
    "body": "**Changing commit** from \"[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)\" to \"[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)\".",
    "created_at": "2017-10-06T10:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7b9206cb121643c70a974b502d352bb1afeb8b76](https://github.com/sagemath/sagetrac-mirror/commit/7b9206cb121643c70a974b502d352bb1afeb8b76)" to "[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)".



---

archive/issue_comments_432534.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2017-10-06T10:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_432535.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. New commits:",
    "created_at": "2017-10-06T10:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. New commits:



---

archive/issue_comments_432536.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-10-06T10:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432536",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_432537.json:
```json
{
    "body": "**Changing reviewer** from \"Maarten Derickx\" to \"Maarten Derickx, John Cremona\".",
    "created_at": "2017-10-06T13:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432537",
    "user": "https://github.com/koffie"
}
```

**Changing reviewer** from "Maarten Derickx" to "Maarten Derickx, John Cremona".



---

archive/issue_comments_432538.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)\" to \"[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)\".",
    "created_at": "2017-10-15T09:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23962#issuecomment-432538",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/doctest_failure_in_src_sage_schemes_elliptic_curves_sha_tate_py)" to "[3cff14c2ea4863634fac9f9009f65efcecbf6b1a](https://github.com/sagemath/sagetrac-mirror/commit/3cff14c2ea4863634fac9f9009f65efcecbf6b1a)".



---

archive/issue_events_069628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T09:22:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23962",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23962#event-69628"
}
```
