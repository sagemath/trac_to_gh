# Issue 23304: hold=True does not always prevent evaluation

archive/issues_023067.json:
```json
{
    "body": "\n```\nsage: x = SR.var(x)\nsage: x + 1/3\nx + 1/3\nsage: (x + 1/3).power(2, hold=True)\n(x + 1/3)^2\nsage: (x + 1/3).power(2, hold=True).mul(2, hold=True) # <<< evaluates!\n2*(1/9*(3*x + 1)^2)\nsage: (x + 1/3).mul(2, hold=True)\n2*(x + 1/3)\n```\n\nReported as https://github.com/pynac/pynac/issues/262\n\n**CC:**  @davewittemorris @slel\n\n**Branch:** [u/chapoton/23304](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23304)\n\n**Commit:** [277efed42215b451b8fb1b502b6964951a1031cc](https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc)\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Status:** needs_work\n\n**Dependencies:** #10035\n\nIssue created by migration from https://trac.sagemath.org/ticket/23304\n\n",
    "created_at": "2017-06-22T12:12:49Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "hold=True does not always prevent evaluation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23304",
    "user": "https://github.com/mezzarobba"
}
```

```
sage: x = SR.var(x)
sage: x + 1/3
x + 1/3
sage: (x + 1/3).power(2, hold=True)
(x + 1/3)^2
sage: (x + 1/3).power(2, hold=True).mul(2, hold=True) # <<< evaluates!
2*(1/9*(3*x + 1)^2)
sage: (x + 1/3).mul(2, hold=True)
2*(x + 1/3)
```

Reported as https://github.com/pynac/pynac/issues/262

**CC:**  @davewittemorris @slel

**Branch:** [u/chapoton/23304](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23304)

**Commit:** [277efed42215b451b8fb1b502b6964951a1031cc](https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc)

**Upstream:** Fixed upstream, in a later stable release.

**Author:** Frédéric Chapoton

**Status:** needs_work

**Dependencies:** #10035

Issue created by migration from https://trac.sagemath.org/ticket/23304





---

archive/issue_comments_418981.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee also #21754 and #21758.",
    "created_at": "2017-07-01T06:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418981",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
See also #21754 and #21758.



---

archive/issue_events_067874.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-07-01T06:35:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67874"
}
```



---

archive/issue_comments_418982.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2017-07-01T06:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418982",
    "user": "https://github.com/rwst"
}
```

**Changing upstream** from "N/A" to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_418983.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,3 +10,5 @@\n sage: (x + 1/3).mul(2, hold=True)\n 2*(x + 1/3)\n ```\n+\n+Reported as https://github.com/pynac/pynac/issues/262\n``````\n",
    "created_at": "2017-07-01T06:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418983",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,3 +10,5 @@
 sage: (x + 1/3).mul(2, hold=True)
 2*(x + 1/3)
 ```
+
+Reported as https://github.com/pynac/pynac/issues/262
``````




---

archive/issue_comments_418984.json:
```json
{
    "body": "**Dependencies:** #10035",
    "created_at": "2017-09-03T07:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418984",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #10035



---

archive/issue_events_067875.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-03T07:52:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67875"
}
```



---

archive/issue_events_067876.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-03T07:52:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67876"
}
```



---

archive/issue_comments_418985.json:
```json
{
    "body": "<a id='comment:3'></a>\nOperations like this are now better done in a hold context. With #10035:\n\n```\nsage: hold.start()\nsage: x + 1/3\nx + 1/3\nsage: (x + 1/3)^2\n(x + 1/3)^2\nsage: (x + 1/3)^2*2\n2*(x + 1/3)^2\nsage: (x + 1/3)*2\n2*(x + 1/3)\n```",
    "created_at": "2017-09-03T07:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418985",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
Operations like this are now better done in a hold context. With #10035:

```
sage: hold.start()
sage: x + 1/3
x + 1/3
sage: (x + 1/3)^2
(x + 1/3)^2
sage: (x + 1/3)^2*2
2*(x + 1/3)^2
sage: (x + 1/3)*2
2*(x + 1/3)
```



---

archive/issue_comments_418986.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Developers acknowledge bug.\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2017-09-03T07:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418986",
    "user": "https://github.com/rwst"
}
```

**Changing upstream** from "Reported upstream. Developers acknowledge bug." to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_418987.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe upstream fix in Pynac was merged in Pynac 0.7.11.\n\nThe upgrade to Pynac 0.7.11 was done in #23820, merged in Sage 8.1.beta6.\n\nIn the present ticket we should add a doctest.",
    "created_at": "2020-09-17T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418987",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>
The upstream fix in Pynac was merged in Pynac 0.7.11.

The upgrade to Pynac 0.7.11 was done in #23820, merged in Sage 8.1.beta6.

In the present ticket we should add a doctest.



---

archive/issue_events_067877.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-17T23:42:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67877"
}
```



---

archive/issue_events_067878.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-17T23:42:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67878"
}
```



---

archive/issue_events_067879.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67879"
}
```



---

archive/issue_events_067880.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67880"
}
```



---

archive/issue_comments_418988.json:
```json
{
    "body": "<a id='comment:5'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418988",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_067881.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67881"
}
```



---

archive/issue_events_067882.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67882"
}
```



---

archive/issue_events_067883.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67883"
}
```



---

archive/issue_events_067884.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67884"
}
```



---

archive/issue_comments_418989.json:
```json
{
    "body": "<a id='comment:9'></a>\nhere is a doctest\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc\">277efed</a></td><td><code>adding doctest for ticket 23304</code></td></tr></table>\n",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418989",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
here is a doctest

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc">277efed</a></td><td><code>adding doctest for ticket 23304</code></td></tr></table>




---

archive/issue_comments_418990.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418990",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_418991.json:
```json
{
    "body": "**Branch:** [u/chapoton/23304](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23304)",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418991",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23304](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23304)



---

archive/issue_comments_418992.json:
```json
{
    "body": "**Commit:** [277efed42215b451b8fb1b502b6964951a1031cc](https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc)",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418992",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [277efed42215b451b8fb1b502b6964951a1031cc](https://github.com/sagemath/sagetrac-mirror/commit/277efed42215b451b8fb1b502b6964951a1031cc)



---

archive/issue_comments_418993.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418993",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_418994.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-02-15T02:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418994",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_418995.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think that using `hold=true` should give the same result as using a hold context:\n\n```\nsage: with hold:\n....:     (x + 1/3).power(2).mul(2)\n2*(x + 1/3)^2\n```\nBut the proposed doctest validates `2*(1/9*(3*x + 1)^2)`, so I don't think we want this doctest.\n\nGinac (and therefore pynac) was not designed with \"hold\" in mind (see also #31597), so I think it will take considerable effort to fix the many problems, but fixing the specific problem on this ticket might not be hard.  I might have time to work on these issues in the next few months, but it's great if someone else wants to do it.\n\nOne possibility would be to have two tickets: one ticket to add a doctest for the hold context right now (because it already gives a good answer), and another ticket (which will remain open) for fixing `hold = true`.",
    "created_at": "2022-02-15T02:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23304#issuecomment-418995",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:10'></a>
I think that using `hold=true` should give the same result as using a hold context:

```
sage: with hold:
....:     (x + 1/3).power(2).mul(2)
2*(x + 1/3)^2
```
But the proposed doctest validates `2*(1/9*(3*x + 1)^2)`, so I don't think we want this doctest.

Ginac (and therefore pynac) was not designed with "hold" in mind (see also #31597), so I think it will take considerable effort to fix the many problems, but fixing the specific problem on this ticket might not be hard.  I might have time to work on these issues in the next few months, but it's great if someone else wants to do it.

One possibility would be to have two tickets: one ticket to add a doctest for the hold context right now (because it already gives a good answer), and another ticket (which will remain open) for fixing `hold = true`.



---

archive/issue_events_067885.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67885"
}
```



---

archive/issue_events_067886.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67886"
}
```



---

archive/issue_events_067887.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67887"
}
```



---

archive/issue_events_067888.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23304",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23304#event-67888"
}
```
